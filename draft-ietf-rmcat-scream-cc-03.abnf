qdelay_fraction_t = qdelay/qdelay_target
qdelay_fraction_avg = (1-QDELAY_WEIGHT)*qdelay_fraction_avg+
          QDELAY_WEIGHT*qdelay_fraction_t
a = R(qdelay_fraction_hist,1)/R(qdelay_fraction_hist,0)
qdelay_trend = min(1.0,max(0.0,a*qdelay_fraction_avg))
qdelay_trend_mem = max(0.99*qdelay_trend_mem, qdelay_trend)

in_fast_increase = false
cwnd_last_max = cwnd
cwnd = max(min_cwnd,cwnd*BETA_LOSS)
cwnd = max(min_cwnd,cwnd*BETA_ECN)
scale_t = max(0.2,min(1.0,(4*(cwnd-cwnd_last_max)/cwnd_i)^2))

in_fast_increase = false
cwnd_last_max = cwnd
cwnd = cwnd+bytes_newly_acked*scale_t
off_target_t = (qdelay_target - qdelay) / qdelay_target

gain_t = GAIN
cwnd = min(cwnd, max_bytes_in_flight*MAX_BYTES_IN_FLIGHT_HEAD_ROOM)
cwnd = max(cwnd, MIN_CWND)



qdelay_norm_t = qdelay / QDELAY_TARGET_LOW
qdelay_norm_var_t = VARIANCE(qdelay_norm_history(100))
qdelay_norm_avg_t = AVERAGE(qdelay_norm_history(20))
qdelay_target = qdelay_norm_avg_t*QDELAY_TARGET_LO*1.1
qdelay_target = min(QDELAY_TARGET_HI, qdelay_target)
qdelay_target = max(QDELAY_TARGET_LO, qdelay_target)

send_wnd = cwnd+MSS-bytes_in_flight
send_wnd = cwnd-bytes_in_flight

target_bitrate_last_max = target_bitrate
target_bitrate = max(BETA_R* target_bitrate, TARGET_BITRATE_MIN)
scale_t = (target_bitrate - target_bitrate_last_max)/
          target_bitrate_last_max
increment_t = RAMP_UP_SPEED*RATE_ADJUST_INTERVAL*
                   (1.0-min(1.0, qdelay_trend/0.2))
current_rate_t = max(rate_transmit, rate_ack)
pre_congestion = min(1.0, max(0.0, qdelay_fraction_avg-0.3)/0.7)
target_bitrate=current_rate_t*(1.0-PRE_CONGESTION_GUARD*
             pre_congestion)-TX_QUEUE_SIZE_FACTOR *rtp_queue_size
rate_media_limit = max(br, max(rate_media,rtp_rate_median))
target_bitrate = min(target_bitrate, rate_media_limit)
target_bitrate = min(TARGET_BITRATE_MAX,
        max(TARGET_BITRATE_MIN,target_bitrate))


PRE_CONGESTION_GUARD=0, the effect is a somewhat faster rate increase
n=N-k
n=1
pace_bitrate = max (50000, cwnd* 8 / s_rtt)

t_pace = rtp_size * 8 / pace_bitrate

rate_fb = min(50,max(10,rate_media/20000))
fb_int = 1.0/min(50,max(10,rate_media/20000))

cwnd = max(MIN_CWND, cwnd*(1.0-0.5* n_q /n))

