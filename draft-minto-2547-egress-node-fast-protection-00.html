<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>2547 egress PE Fast Failure Protection</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Specification of Requirements">
<link href="#rfc.section.3" rel="Chapter" title="3 Terminology">
<link href="#rfc.section.4" rel="Chapter" title="4 Reference topology">
<link href="#rfc.section.5" rel="Chapter" title="5 Theory of Operation">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Protector and Protection Models">
<link href="#rfc.section.5.1.1" rel="Chapter" title="5.1.1 Co-located protector">
<link href="#rfc.section.5.1.2" rel="Chapter" title="5.1.2 Centralized protector">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Context Identifier and VPN prefixes.">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Context Identifier Advertisement by IGP">
<link href="#rfc.section.5.3.1" rel="Chapter" title="5.3.1 Context-identifier advertised as stub router. ">
<link href="#rfc.section.5.3.1.1" rel="Chapter" title="5.3.1.1 ISIS context-node ">
<link href="#rfc.section.5.3.1.2" rel="Chapter" title="5.3.1.2 OSPF context-node">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Forwarding State on Protector PE">
<link href="#rfc.section.5.4.1" rel="Chapter" title="5.4.1 Alternate egress PE for protected prefix.">
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Bypass LSP">
<link href="#rfc.section.5.5.1" rel="Chapter" title="5.5.1 RSVP-TE Signaled Bypass LSP and Backup LSP">
<link href="#rfc.section.5.5.2" rel="Chapter" title="5.5.2 LDP Signaled Bypass LSP">
<link href="#rfc.section.6" rel="Chapter" title="6  Egress node Failure">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document specifies a mechanism for protecting RFC2547 based VPN service against egress node failure. The mechanism enables local repair to be performed immediately upon a egress node failure. In particular, the router at point of local repair (PLR) can redirect VPN traffic to a protector to repair in the order of tens of milliseconds, achieving fast protection that is comparable to MPLS fast reroute." />
  <meta name="description" content="This document specifies a mechanism for protecting RFC2547 based VPN service against egress node failure. The mechanism enables local repair to be performed immediately upon a egress node failure. In particular, the router at point of local repair (PLR) can redirect VPN traffic to a protector to repair in the order of tens of milliseconds, achieving fast protection that is comparable to MPLS fast reroute." />
  <meta name="keywords" content="2547, l3vpn, protection, local repair, fast reroute" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">J.M. Jeganathan</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">M.  Konstantynowicz</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">H. Gredler</td>
</tr>
<tr>
<td class="left">Expires: April 27, 2012</td>
<td class="right"></td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Juniper Networks</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 25, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">2547 egress PE Fast Failure Protection<br />
  <span class="filename">draft-minto-2547-egress-node-fast-protection-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies a mechanism for protecting RFC2547 based VPN service against egress node failure. The mechanism enables local repair to be performed immediately upon a egress node failure. In particular, the router at point of local repair (PLR) can redirect VPN traffic to a protector to repair in the order of tens of milliseconds, achieving fast protection that is comparable to MPLS fast reroute.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 27, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Specification of Requirements</a>
</li>
<li>3.   <a href="#rfc.section.3">Terminology</a>
</li>
<li>4.   <a href="#rfc.section.4">Reference topology</a>
</li>
<li>5.   <a href="#rfc.section.5">Theory of Operation</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Protector and Protection Models</a>
</li>
<li>5.1.1.   <a href="#rfc.section.5.1.1">Co-located protector</a>
</li>
<li>5.1.2.   <a href="#rfc.section.5.1.2">Centralized protector</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Context Identifier and VPN prefixes.</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Context Identifier Advertisement by IGP</a>
</li>
<li>5.3.1.   <a href="#rfc.section.5.3.1">Context-identifier advertised as stub router. </a>
</li>
<li>5.3.1.1.   <a href="#rfc.section.5.3.1.1">ISIS context-node </a>
</li>
<li>5.3.1.2.   <a href="#rfc.section.5.3.1.2">OSPF context-node</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">Forwarding State on Protector PE</a>
</li>
<li>5.4.1.   <a href="#rfc.section.5.4.1">Alternate egress PE for protected prefix.</a>
</li>
<li>5.5.   <a href="#rfc.section.5.5">Bypass LSP</a>
</li>
<li>5.5.1.   <a href="#rfc.section.5.5.1">RSVP-TE Signaled Bypass LSP and Backup LSP</a>
</li>
<li>5.5.2.   <a href="#rfc.section.5.5.2">LDP Signaled Bypass LSP</a>
</li>
<li>6.   <a href="#rfc.section.6"> Egress node Failure</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Acknowledgements</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">This document specifies a mechanism for protecting RFC2547 based VPN against egress PE failure. The procedures in this document are relevant only when a VPN site is multi-homed to two or more PEs. This is designed on the basis of MPLS context specific label switching [RFC 5331].  Fast-protection refers to the ability to provide local repair upon a failure in the order of tens of milliseconds, which is comparable to MPLS fast-reroute [RFC 4090]. This is achieved by establishing local protection as close to a failure as possible. Compared with the existing global repair mechanisms that rely on control plane convergence, these procedures can provide faster restoration for VPN traffic. However, they are intended to complement the global repair mechanisms, rather than replacing them in any way.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Specification of Requirements</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Terminology</h1>
<p id="rfc.section.3.p.1">Protected PE: A PE which request protection for minimum one VPN prefix.</p>
<p id="rfc.section.3.p.2">Protected prefix: A VPN prefix that required protection in case of Protected PE goes down.</p>
<p id="rfc.section.3.p.3">Protector: A router which protect one or more VPN prefix when a Protected PE goes down.</p>
<p id="rfc.section.3.p.4">BGP nexthop: A nexthop advertised in the BGP-Update for the VPN prefix by a BGP speaker.</p>
<p id="rfc.section.3.p.5">VPN label: A label advertised by a BGP speaker for set of VPN prefixes. This label can be per-VRF label or per nexthop label or per prefix label.</p>
<p id="rfc.section.3.p.6">Transport LSP: A LSP setup to BGP nexthop either by LDP or RSVP.</p>
<p id="rfc.section.3.p.7">Alternative egress PE: A PE originates same IP prefix as Protected prefix in a same VPN.</p>
<p id="rfc.section.3.p.8">VPN transport LSP: A Transport LSP that carries VPN traffic.</p>
<p id="rfc.section.3.p.9">Context table: A context-specific label space routing table. This table is per is populated with VPN labels advertised by the protected-PE.</p>
<p id="rfc.section.3.p.10">Context node: A stub router advertised into IGP by protected PE for a context-identifier.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Reference topology</h1>
<p id="rfc.section.4.p.1">This document refers to the following topologies to describe various roles and solution.</p>
<div id="#rfc.figure.1"></div>
<div id="#Topology-1"></div>
<p></p>
<pre>


                  .......................
                  .                     .
   +-------+--CE1----PE1            PE4----CE5---+-------+
   | red   |      .     \           /   .        | red   |
   | site1 |      .      \         /    .        | site2 |
   +-------+--CE2-----+   P--P--PLR1  +----CE6---+-------+
                  .   |  /   |   | \  | .
                  .   PE2    RR  |  PE5 .
                  .   |  \   |   | /  | .
   +-------+--CE3-----+   P--P--PLR2  +----CE7--+-------+  
   | blue  |      .      /        \     .       |blue   |
   | site1 |      .     /          \    .       |site2  |  
   +-------+--CE4-----PE3           PE6----CE8--+-------+
                  .                     .
                  .                     .
                  .......................
           </pre>
<p></p>
<p id="rfc.section.4.p.2">In Topology-1 two VPNs red and blue with two sites multihomed with PEs. Let assume blue and red VPN site2 prefixes required egress protection in case of PE5 goes down. PE5 is protected PE for site2 prefixes for both VPN. PE4 is alternate PE for red site2 prefixes. PE6 is alternate PE for blue site2 prefixes. For PE4 could act as protector for red VPN site2 and PE6 could acts as protector for blue VPN site2.  This model is co-located protector model. RR could act as protector for both red and blue VPN site2. This is Centralized protector model (A PE protecting set of VPNs and not connected to any VPN site).</p>
<div id="#rfc.figure.2"></div>
<div id="#Topologgy-2"></div>
<pre> 
                  .......................
                  .                     .
   +-------+--CE1----PE1            PE4----CE5---+-------+
   | red   |      .     \           /   .        | red   |
   | site1 |      .      \         /    .        | site2 |
   +-------+--CE2-----+   P--P--PLR1  +----CE6---+-------+
                  .   |  /   |   | \  | .
                  .   PE2    RR  |  PE5 .
                  .   |  \   |   | /  | .
   +-------+--CE3-----+   P--P--PLR2  +----CE7--+-------+  
   | red   |      .      /        \     .       |red    |
   | site5 |      .     /          \    .       |site4  |  
   +-------+--CE4-----PE3           PE6----CE8--+-------+
                  .                     .
                  .                     .
                  .......................
</pre>
<p id="rfc.section.4.p.3">In Topology-2 has a VPNs red with four sites and multihomed with PEs.  Let assume red VPN site2 and site4 prefixes required egress protection in case of PE5 goes down. PE5 is protected PE for site2, site4 prefixes for red VPN. PE4 is alternate PE for site2 prefixes. PE6 is alternate PE for site4 prefixes. Either PE4 or PE6 could act as protector. This is a slight variation of the co-located model.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#theory" id="theory">Theory of Operation</a>
</h1>
<p id="rfc.section.5.p.1">The Egress PEs attached to multi-homed site export VPN prefixes with different route distinguisher, different nexthop but with same route target. The other PEs attached to other sites with same VPN import these route into VRF creates more than one path to multi-homed sites. When one egress PE goes down all VPN traffic towards the multihomed site moved to alternate egress PEs attached to the multi-homed site. This is done by ingress PE. The VPN traffic going via failed PE get dropped in penultimate hop router until ingress PE reroute VPN traffic. Even though connectivity of multi-homed site is not bound to an egress PE the transport LSP bind to egress PE. As result of down transport LSP VPN traffic getting dropped in P router. This document specifies a mechanism that repair VPN traffic at point of failure (typically a P router which penultimate hop of the transport LSP) and still keep P router unaware of the VPN information with the help of protector (a new role). The PLR (point of local repair) send VPN traffic to protector through bypass LSP incase of egress PE failure. This protector send VPN traffic received from PLR to the alternative egress PE until the ingress reroute traffic to alternate egress PE.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Protector and Protection Models</h1>
<p id="rfc.section.5.1.p.1">Protector, is a new role for the egress PE failure local repair.  This protector role could be played by a PE(alternate egress PE) or any other nodes which participates in VPN control plane for VPN prefixes that required egress node protection. Hence, there are two protection models based on the location and role of a protector.</p>
<h1 id="rfc.section.5.1.1">
<a href="#rfc.section.5.1.1">5.1.1.</a> Co-located protector</h1>
<p id="rfc.section.5.1.1.p.1">In this model, the protector is a alternate egress PE for a protected prefix. It is co-located with the alternate PE for the protected prefix, and it has a direct connection to the multi-homed site that originate the protected prefix. In the event of an egress node failure, the protector receives traffic from the PLR, and sends the traffic to the multi-homed site. In the topology-1 PE4 could act as protector for red VPN site2 and PE6 could acts as protector for blue VPN site2. This model is co-located protector model. RR could act as protector for both red and blue VPN site2. This is Centralized protector model (A PE protecting set of VPNs and not connected to any VPN site).</p>
<p id="rfc.section.5.1.1.p.2">A slight variant of this model is, protector is not alternate PE for a protected prefix but has same VRF. In the topology-2 either PE4 or PE6 could act as protector. This is example for the above model.</p>
<h1 id="rfc.section.5.1.2">
<a href="#rfc.section.5.1.2">5.1.2.</a> Centralized protector</h1>
<p id="rfc.section.5.1.2.p.1">In this model, the protector serves as a centralized protector MAY NOT have a direct connection to multi-homed site. This model can be played by existing PEs or other PEs. In the event of an egress PE failure, protector MUST send the traffic to a alternate egress PE with VPN label advertised alternate egress PE for the prefix which in turn sends the traffic to the multi-homed site. In the topology-1 RR could act as protector for both red and blue VPN site2. This is Centralized protector model (A PE protecting set of VPNs and not connected to any VPN site).</p>
<p id="rfc.section.5.1.2.p.2">A network MAY use either protection model or a combination of both, depending on requirements.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Context Identifier and VPN prefixes.</h1>
<p id="rfc.section.5.2.p.1">The context-identifier is an IP address that is either globally unique or unique in the private address space of the routing domain.  In Egress PE each VPN prefix is assigned to context-identifier. The granularity of a context identifier is {Egress PE, VPN prefix} tuple.  However, a given context identifier MAY be assigned to one or multiple VPN prefix.</p>
<p id="rfc.section.5.2.p.2">Possible context identifier assignments are </p>

<ul>
<li>Unique context-identifier for all VPN prefixes, both VPN-IPv4 and VPN-IPv6.</li>
<li>Unique context-identifier per address family.</li>
<li>Unique context-identifier per site for all VPN prefixes, both VPN-IPv4 and VPN-IPv6.</li>
<li>Unique context-identifier per site per address family.</li>
<li>Unique context-identifier per CE address (nexthop).</li>
<li>Unique context identifier for each prefix.</li>
</ul>
<p id="rfc.section.5.2.p.3">The first one is coarsest granularity of a context identifier and the last one is finest granularity of a context identifier. While all of the above options are possible in principle, their practical usage is likely to vary widely, as not all of them may be of practical usage. A given context identifier MUST NOT be used by more than one protected PE. The egress PE that required protection for a VPN prefix MUST put context-identifier as nexthop in BGP update. This context-identifier as nexthop indicates to protector that this prefix need protection. For e.g. In topology 1 PE5(protected PE) advertise VPN prefixes with context-identifier as BGP nexthop.</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> <a href="#context_id" id="context_id">Context Identifier Advertisement by IGP</a>
</h1>
<p id="rfc.section.5.3.p.1">IGP MUST advertise context identifiers to allow computation of TE paths for bypass LSPs and VPN transport LSPs that are destined for context identifiers. Context identifiers MUST be advertised a stub router in IGP and TE. Advertised as a stub router allow operator to deploy egress protection without upgrading all P routers.</p>
<p id="rfc.section.5.3.p.2">A protected PE MUST advertise a context identifier as a stub router to TE domain and in IGP. Also Protected PE MUST advertise a link to the stub router.</p>
<p id="rfc.section.5.3.p.3">A protector MUST advertise link to stub router advertised by protected PE in IGP and TE.</p>
<h1 id="rfc.section.5.3.1">
<a href="#rfc.section.5.3.1">5.3.1.</a> Context-identifier advertised as stub router. </h1>
<p id="rfc.section.5.3.1.p.1">Context-identifier advertised as stub router required two parts.  A node representation (context-node) and links to the node. The protected PE and protector advertise link to context-node and protected PE advertise context-node.</p>
<p id="rfc.section.5.3.1.p.2">The protected PE will advertise context-node in to IGP. The router-id of the context-node is context-identifier. The system-ID is derived from the context-identifier with BCD encoding. The resulting system-ID MUST be unique with in IGP routing domain.  Context-node advertised with two unnumbered transit links with MAX routable link metric to protected PE and protector. For TE these unnumbered links advertised with zero bandwidth and MAX TE metric.  Other TE characteristic of TE links could be configured to advertise. The router-ID or system-ID of the protector could be dynamically learned from the IGP link state database or could be configured in protected PE.</p>
<p id="rfc.section.5.3.1.p.3">Protected PE MUST advertise unnumbered transit link with metric 1 and TE metric 1 to context-node. Protector MUST advertise unnumbered transit link with maximum routable link metric and maximum TE metric to the context-node. Other TE characteristic of the links could be configured and advertised in to TE.</p>
<h1 id="rfc.section.5.3.1.1">
<a href="#rfc.section.5.3.1.1">5.3.1.1.</a> ISIS context-node </h1>
<p id="rfc.section.5.3.1.1.p.1">Only zeroth fragment of the context-node is only valid. All Other fragments SHOULD be ignored. Zeroth fragment MUST include area address TLV and MAY include hostname TLV.</p>
<p id="rfc.section.5.3.1.1.p.2">The set of area addresses advertised MUST be a subset of the set of Area Addresses advertised in the protected LSP number zero at the corresponding level. Preferably, the advertisement SHOULD be syntactically identical to that included in the normal LSP number zero at the corresponding level. The hostname could be set as &lt;context-identifier+ protected PE hostname&gt;.</p>
<p id="rfc.section.5.3.1.1.p.3">The Overload (OL) MUST be set to 1. The Attached (ATT), and Partition Repair (P) bits MUST be set to 0.</p>
<h1 id="rfc.section.5.3.1.2">
<a href="#rfc.section.5.3.1.2">5.3.1.2.</a> OSPF context-node</h1>
<p id="rfc.section.5.3.1.2.p.1">The advertising router and Link State ID of router LSA MUST be context-identifier. All options bits in router LSA MUST be set to zero. The number of links MUST be 2.</p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> <a href="#forwarding" id="forwarding">Forwarding State on Protector PE</a>
</h1>
<p id="rfc.section.5.4.p.1">A protector maintain the forwarding state in context-specific label spaces on a per protected PE basis. In particular, the protector MUST learn the VPN label by participating the VPN routing and also MUST keep all routes associated with VPN it required to protect.</p>
<p id="rfc.section.5.4.p.2">For each VPN label with an associated context-identifier protector MUST map the context identifier to a context-specific label space [RFC 5331], and program the VPN label in that label space in forwarding plane. For each VPN prefix that required protection programmed in the forwarding plane with BGP nexthop to alternate egress PE. This VPN label in the context-specific label space identify the layer-3 forwarding table that need to lookup to send it alternate egress PE.  The protector MAY maintain only VPN prefix originated with-in the multi-homed site for given {egress PE, VPN}. These VPN labels in context table and VPN context table will not be used in forwarding after ingress reroute the traffic to alternative PE. Protector MUST delete VPN label and the VPN context table after ingress reroute the traffic. This shall be achieved with a timer. This timer default value is 180 seconds.</p>
<h1 id="rfc.section.5.4.1">
<a href="#rfc.section.5.4.1">5.4.1.</a> Alternate egress PE for protected prefix.</h1>
<p id="rfc.section.5.4.1.p.1">Any route with BGP nexthop which has the following properties </p>

<ul class="empty">
<li>Exact matching route-target set (RD may be different)</li>
<li>Exact matching Prefix part (not RD)</li>
</ul>
<p id="rfc.section.5.4.1.p.2">will be eligible as alternate egress PE for prefix.</p>
<h1 id="rfc.section.5.5">
<a href="#rfc.section.5.5">5.5.</a> <a href="#bypass" id="bypass">Bypass LSP</a>
</h1>
<p id="rfc.section.5.5.p.1">An LSP MUST be either manually or automatically provisioned on a PLR to enable the PLR to send traffic to a protector, in the event of an egress PE failure. This LSP is referred to as a bypass LSP. The bypass LSP MUST be a LSP with ultimate hop popping (UHP) [RFC 3031].  That is, the protector MUST assign an un-reserved label to the bypass LSP. When the protector PE receives VPN packets on the bypass LSP from a PLR, it MUST rely on the bypass LSP's UHP label to determine the context-specific label space to forward the packets.</p>
<h1 id="rfc.section.5.5.1">
<a href="#rfc.section.5.5.1">5.5.1.</a> <a href="#rsvp_bypass" id="rsvp_bypass">RSVP-TE Signaled Bypass LSP and Backup LSP</a>
</h1>
<p id="rfc.section.5.5.1.p.1">If a bypass LSP is an RSVP-TE signaled LSP, its destination MUST be the context identifier of the protected VPN prefix. The path taken by the bypass LSP MAY be statically configured or dynamically computed by CSPF. The signaling of the bypass LSP MUST be triggered by the "local protection desired" and "node protection desired" bits in SESSION_ATTRIBUTE of Path message of the transport LSP [RFC 2205, RFC 3209, RFC 4090]. After the bypass LSP is established, the PLR MUST set the "local protection available" and "node protection" bits in RRO of Resv message of the transport LSP. The protector MUST terminate the backup LSP as an egress. Once the local repair takes effect, the PLR MUST set the "local protection in use" bit in RRO of Resv message of the transport LSP.</p>
<h1 id="rfc.section.5.5.2">
<a href="#rfc.section.5.5.2">5.5.2.</a> <a href="#ldp_bypass" id="ldp_bypass">LDP Signaled Bypass LSP</a>
</h1>
<p id="rfc.section.5.5.2.p.1">If it is LDP LSP then LDP FEC for this LSP MUST be the context identifier of the protected segment. Prefix LFA with node protection can be used for bypass LSP computation.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#link_failure" id="link_failure"> Egress node Failure</a>
</h1>
<p id="rfc.section.6.p.1">This section summarizes the procedures egress protection described above section for completeness. A Egress PE and a protector both advertise the context identifier of a protected prefixes in IGP as a stub link or stub router, with the egress PE advertising a lower metric and protector with maximum metric. The PLR establishes a UHP bypass LSP to the protector. The destination address of the bypass LSP is the context identifier. The protector programs forwarding state in such a way that packets received on the bypass LSP will be forwarded based on VPN label in the context table, and prefix lookup in VPN context table.  The context table identified by the UHP label of the bypass LSP, i.e.  the context identifier.</p>
<p id="rfc.section.6.p.2">When the penultimate Hop router receives a VPN packet from the MPLS network, if the egress PE is down, the PLR tunnels the packet through the bypass LSP to the protector. The protector PE identifies the forwarding context of the egress PE based on the top label of the packet which is the UHP label of the bypass LSP. Then forwards protector the packet based on a second label lookup in the protected PE's context label space followed by layer-3 lookup in the VPN context table. These UHP label, context table label and layer-3 lookup results in forwarding the packet to the site or send it to alternate egress PE based on protector model.</p>
<p id="rfc.section.6.p.3">For E.g. In topology-1 RR is act as Protector and PE5 required protection for red, blue site2 prefixes. As red, blue site2 VPN prefixes advertised with context-identifier, the protector set up the forwarding table for prefixes from site2 with alternative egress PE as nexthop.  When PLR detects PE5 failure it send to protector through bypass LSP. In protector the top label identify the context space table. VPN label in the context table identify the VPN layer-3 forwarding table with contains site2 prefixes with alternate PE as nexthop. A Layer-3 lookup gives mpls path to alternate egress PE and protector forward packet to alternate egress PE and reach to the site2.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.7.p.1">The security considerations discussed in RFC 5036, RFC 5331, RFC 3209, and RFC 4090 apply to this document.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#ack" id="ack">Acknowledgements</a>
</h1>
<p id="rfc.section.8.p.1">This document leverages work done by Yakov Rekhter and several others on LSP tail-end protection. Thanks to Nischal Sheth, Nitin Bahadur, Yimin shen for their contribution.</p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC5331">[RFC5331]</b></td>
<td class="top">
<a>Aggarwal, R.</a>, <a>Rekhter, Y.</a> and <a>E. Rosen</a>, "<a href="http://tools.ietf.org/html/rfc5331">MPLS Upstream Label Assignment and Context-Specific Label Space</a>", RFC 5331, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4364">[RFC4364]</b></td>
<td class="top">
<a>Rekhter, Y.</a> and <a>E. Rosen</a>, "<a href="http://tools.ietf.org/html/rfc4364">BGP/MPLS IP Virtual Private Networks (VPNs)</a>", RFC 4364, February  2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5036">[RFC5036]</b></td>
<td class="top">
<a>Andersson, L.</a>, <a>Minei, I.</a> and <a>B. Thomas</a>, "<a href="http://tools.ietf.org/html/rfc5036">LDP Specification</a>", RFC 5036, October 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2205">[RFC2205]</b></td>
<td class="top">
<a href="mailto:Braden@ISI.EDU" title="USC Information Sciences Institute">Braden, B.</a>, <a href="mailto:lixia@cs.ucla.edu" title="UCLA Computer Science Department">Zhang, L.</a>, <a href="mailto:Berson@ISI.EDU" title="USC Information Sciences Institute">Berson, S.</a>, <a href="mailto:Herzog@WATSON.IBM.COM" title="IBM T. J. Watson Research Center">Herzog, S.</a> and <a href="mailto:jamin@EECS.UMICH.EDU" title="University of Michigan">S. Jamin</a>, "<a href="http://tools.ietf.org/html/rfc2205">Resource ReSerVation Protocol (RSVP) -- Version 1 Functional Specification</a>", RFC 2205, September 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3209">[RFC3209]</b></td>
<td class="top">
<a>Awduche, D.</a>, <a>Berger, L.</a>, <a>Gan, D.</a>, <a>Li, T.</a>, <a>Srinivasan, V.</a> and <a>G. Swallow</a>, "<a href="http://tools.ietf.org/html/rfc3209">RSVP-TE: Extensions to RSVP for LSP Tunnels</a>", RFC 3209, December 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4090">[RFC4090]</b></td>
<td class="top">
<a>Pan, P.</a>, <a>Swallow, G.</a> and <a>A. Atlas</a>, "<a href="http://tools.ietf.org/html/rfc4090">Fast Reroute Extensions to RSVP-TE for LSP Tunnels</a>", RFC 4090, May 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3471">[RFC3471]</b></td>
<td class="top">
<a>Berger, L.</a>, "<a href="http://tools.ietf.org/html/rfc3471">Generalized Multi-Protocol Label Switching (GMPLS) Signaling Functional Description</a>", RFC 3471, January 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3031">[RFC3031]</b></td>
<td class="top">
<a>Rosen, E.</a>, <a>Viswanathan, A.</a> and <a>R. Callon</a>, "<a href="http://tools.ietf.org/html/rfc3031">Multiprotocol Label Switching Architecture</a>", RFC 3031, January 2001.</td>
</tr>
<tr>
<td class="reference"><b id="LDP-UPSTREAM">[LDP-UPSTREAM]</b></td>
<td class="top">
<a title="Juniper Networks">Aggarwal, R</a> and <a title="France Telecom">J. L. Le Roux</a>, "<a href="http://tools.ietf.org/html/draft-ietf-mpls-ldp-upstream">MPLS Upstream Label Assignment for LDP</a>", Internet-Draft draft-ietf-mpls-ldp-upstream, 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RSVP-NON-PHP-OOB">[RSVP-NON-PHP-OOB]</b></td>
<td class="top">
<a title="Cisco Systems, Inc">Ali, A</a>, <a title="Cisco Systems, Inc">Swallow, Z</a> and <a title="Juniper Networks">R Aggarwal</a>, "<a href="http://tools.ietf.org/html/draft-ietf-mpls-rsvp-te-no-php-oob-mapping">Non PHP Behavior and out-of-band mapping for RSVP-TE LSPs</a>", Internet-Draft draft-ietf-mpls-rsvp-te-no-php-oob-mapping, 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC5920">[RFC5920]</b></td>
<td class="top">
<a>Fang, L.</a>, "<a href="http://tools.ietf.org/html/rfc5920">Security Framework for MPLS and GMPLS Networks</a>", RFC 5920, July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5286">[RFC5286]</b></td>
<td class="top">
<a>Atlas, A</a> and <a>A Zinin</a>, "<a href="http://tools.ietf.org/html/rfc5920">Basic Specification for IP Fast Reroute: Loop-Free Alternates</a>", RFC 5920, September  2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5714">[RFC5714]</b></td>
<td class="top">
<a>Shand, M</a> and <a>S Bryant</a>, "<a href="http://tools.ietf.org/html/rfc5714">IP Fast Reroute Framework</a>", RFC 5714, January  2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jeyananth Minto Jeganathan</span> 
	  <span class="n hidden">
		<span class="family-name">Jeganathan</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks</span>
	<span class="adr">
	  <span>1194 N Mathilda Avenue</span>

	  <span class="vcardline">
		<span class="locality">Sunnyvale</span>,  
		<span class="region">CA</span> 
		<span class="code">94089</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:minto@juniper.net">minto@juniper.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Maciek Konstantynowicz</span> 
	  <span class="n hidden">
		<span class="family-name"> Konstantynowicz</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks</span>
	<span class="adr">
	  <span>1194 N Mathilda Avenue</span>

	  <span class="vcardline">
		<span class="locality">Sunnyvale</span>,  
		<span class="region">CA</span> 
		<span class="code">94089</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:maciek@juniper.net">maciek@juniper.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Hannes Gredler</span> 
	  <span class="n hidden">
		<span class="family-name">Gredler</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks</span>
	<span class="adr">
	  <span>1194 N Mathilda Avenue</span>

	  <span class="vcardline">
		<span class="locality">Sunnyvale</span>,  
		<span class="region">CA</span> 
		<span class="code">94089</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:hannes@juniper.net">hannes@juniper.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn"></span> 
	  <span class="n hidden">
		<span class="family-name"></span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	
  </address>
</div>

</body>
</html>