<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Displaying Downgraded Messages for Email Address Internationalization</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Displaying Downgraded Messages for Email Address Internationalization">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Email Address Internationalization</td><td class="header">K. Fujiwara</td></tr>
<tr><td class="header">(EAI)</td><td class="header">JPRS</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">B. Leiba</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">Huawei Technologies</td></tr>
<tr><td class="header">Expires: June 4, 2010</td><td class="header">December 01, 2009</td></tr>
</table></td></tr></table>
<h1><br />Displaying Downgraded Messages for Email Address Internationalization<br />draft-ietf-eai-downgraded-display-03.txt</h1>

<h3>Abstract</h3>

<p>
This document describes a method for displaying downgraded messages
which originally contained internationalized E-mail addresses or
internationalized header fields.
    
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on June 4, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#anchor1">2.</a>&nbsp;
Terminology<br />
<a href="#converting">3.</a>&nbsp;
Converting downgraded message headers for display<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#considerations">3.1.</a>&nbsp;
Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#process">3.2.</a>&nbsp;
The process<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#envelope-preservation">3.2.1.</a>&nbsp;
No reconstruction of the Envelope Information Preservation Header Fields<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#address-preservation">3.2.2.</a>&nbsp;
Reconstructing the Address Header Fields' Preservation Header Fields<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#unknown-preservation">3.2.3.</a>&nbsp;
The Unknown Header Fields' Preservation Header Fields<br />
<a href="#security">4.</a>&nbsp;
Security considerations<br />
<a href="#anchor2">5.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor3">6.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor4">7.</a>&nbsp;
Change History<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">7.1.</a>&nbsp;
draft-fujiwara-eai-downgraded-display: Version 00<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">7.2.</a>&nbsp;
draft-ietf-eai-downgraded-display: Version 00<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">7.3.</a>&nbsp;
draft-ietf-eai-downgraded-display: Version 01<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">7.4.</a>&nbsp;
draft-ietf-eai-downgraded-display: Version 02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">7.5.</a>&nbsp;
draft-ietf-eai-downgraded-display: Version 03<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#anchor12">Appendix&nbsp;A.</a>&nbsp;
Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">A.1.</a>&nbsp;
Displaying example<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
	The Email Address Internationalization (UTF8SMTP) extension document set
	<a class='info' href='#RFC4952'>[RFC4952]<span> (</span><span class='info'>Klensin, J. and Y. Ko, &ldquo;Overview and Framework for Internationalized Email,&rdquo; July&nbsp;2007.</span><span>)</span></a>
	<a class='info' href='#RFC5336'>[RFC5336]<span> (</span><span class='info'>Yao, J. and W. Mao, &ldquo;SMTP Extension for Internationalized Email Addresses,&rdquo; September&nbsp;2008.</span><span>)</span></a>
	<a class='info' href='#RFC5335'>[RFC5335]<span> (</span><span class='info'>Abel, Y., &ldquo;Internationalized Email Headers,&rdquo; September&nbsp;2008.</span><span>)</span></a>
	<a class='info' href='#RFC5337'>[RFC5337]<span> (</span><span class='info'>Newman, C. and A. Melnikov, &ldquo;Internationalized Delivery Status and Disposition Notifications,&rdquo; September&nbsp;2008.</span><span>)</span></a>
	expands Email address structure, syntax and Email header format.
	To avoid rejection of internationalized Email messages,
	the downgrading mechanism <a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a>
	converts an internationalized message to a traditional Email message
	when a server in the delivery path does not support the UTF8SMTP extension.
	The downgraded message is a traditional Email message,
	except the message has "Downgraded-" header fields.
	
</p>
<p>
	A perfect reverse-function of the downgrading does not exist
	because the encoding defined in <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> is not exactly reversible
	and Received header field downgrading may remove FOR clause information.
	The restoration of the downgrading should be done once at the final
	destination of the downgraded message such as MUAs or IMAP servers.
	This document describes the restoration methods for displaying downgraded messages
	in MUAs.
	
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>
      The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", 
	"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL"
      in this document are to be interpreted as described in RFC
      2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
    
</p>
<p>
   Specialized terms used in this specification are defined in the
   EAI overview <a class='info' href='#RFC4952'>[RFC4952]<span> (</span><span class='info'>Klensin, J. and Y. Ko, &ldquo;Overview and Framework for Internationalized Email,&rdquo; July&nbsp;2007.</span><span>)</span></a> or in
	<a class='info' href='#RFC5321'>[RFC5321]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a><a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a>,
	MIME documents
		<a class='info' href='#RFC2045'>[RFC2045]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a>
		<a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a>
		<a class='info' href='#RFC2183'>[RFC2183]<span> (</span><span class='info'>Troost, R., Dorner, S., and K. Moore, &ldquo;Communicating Presentation Information in Internet Messages: The Content-Disposition Header Field,&rdquo; August&nbsp;1997.</span><span>)</span></a>
		<a class='info' href='#RFC2231'>[RFC2231]<span> (</span><span class='info'>Freed, N. and K. Moore, &ldquo;MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations,&rdquo; November&nbsp;1997.</span><span>)</span></a>.
    
</p>
<p>
	This document depends on
	<a class='info' href='#RFC5335'>[RFC5335]<span> (</span><span class='info'>Abel, Y., &ldquo;Internationalized Email Headers,&rdquo; September&nbsp;2008.</span><span>)</span></a> and
	<a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a>.
	Key words used in these document are used in this document, too.
    
</p>
<p>
	The term "MIME decode" is used for both "encoded-word" decoding defined by <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> and
	MIME parameter value decoding defined by <a class='info' href='#RFC2231'>[RFC2231]<span> (</span><span class='info'>Freed, N. and K. Moore, &ldquo;MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations,&rdquo; November&nbsp;1997.</span><span>)</span></a>.
    
</p>
<a name="converting"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Converting downgraded message headers for display</h3>

<a name="considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Considerations</h3>

<p>
	The order of some header fields (such as "Resent-*" fields) is
	significant.  The process of regenerating the original fields
	from the downgraded ones MUST NOT reorder the fields.
      
</p>
<p>
	In order to regenerate a field from a specific downgraded
	header field, it's necessary to find the corresponding
	replacement in the current message.  If the corresponding
	field can not be found, the downgraded header field in
	question can not be regenerated and used.
      
</p>
<a name="process"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
The process</h3>

<p>
	A MUA MAY decode and re-generate the original header fields of
	the message (MTAs and MDAs SHOULD NOT attempt to do this; it
	SHOULD be left to the MUA).  This procedure can be used to
	approximately reverse the Downgrade process, but it will not
	always construct the original header fields exactly.
      
</p>
<p>
	Three types of Downgraded header fields are described in section 3
	of <a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a>:
    </p>
<ol class="text">
<li>"Envelope Information Preservation Header Fields", described in RFC5504 section 3.1 and in <a class='info' href='#envelope-preservation'>Section&nbsp;3.2.1<span> (</span><span class='info'>No reconstruction of the Envelope Information Preservation Header Fields</span><span>)</span></a>, below.
</li>
<li>"Address Header Fields' Preservation Header Fields", described in RFC5504 section 3.2 and in <a class='info' href='#address-preservation'>Section&nbsp;3.2.2<span> (</span><span class='info'>Reconstructing the Address Header Fields' Preservation Header Fields</span><span>)</span></a>, below.
</li>
<li>"Unknown Header Fields' Preservation Header Fields", described in RFC5504 section 3.3 and in <a class='info' href='#unknown-preservation'>Section&nbsp;3.2.3<span> (</span><span class='info'>The Unknown Header Fields' Preservation Header Fields</span><span>)</span></a>, below.
</li>
</ol><p>
      
</p>
<p>
	After processing Downgraded header fields, decode all header fields, as described in <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> and <a class='info' href='#RFC2231'>[RFC2231]<span> (</span><span class='info'>Freed, N. and K. Moore, &ldquo;MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations,&rdquo; November&nbsp;1997.</span><span>)</span></a>.
      
</p>
<a name="envelope-preservation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
No reconstruction of the Envelope Information Preservation Header Fields</h3>

<p>
	  Envelope Information Preservation Header Fields are new
	  fields that might have been added by the downgrade process.
	  Because they do not represent fields that appeared in the
	  original message, this process is not applicable to them.
        
</p>
<a name="address-preservation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2"></a><h3>3.2.2.&nbsp;
Reconstructing the Address Header Fields' Preservation Header Fields</h3>

<p>
	  Reconstructing Address Header Fields' Preservation Header Fields is OPTIONAL, and
	  a decision MAY be made on each field, individually.  In particular, it might be less
	  important to process the Resent-* header fields, so an implementation MAY choose to
	  skip those.
	
</p>
<p>
	  To construct a displayable copy of a header field from one
	  of these downgraded header fields, follow this procedure:
          </p>
<blockquote class="text"><dl>
<dt>1. </dt>
<dd>
	      In an edit buffer, create a new header field:"
	    
</dd>
<dt>1a. </dt>
<dd>
	      For the field name, remove the "Downgraded-" prefix from
	      the downgraded field name.  For example,
	      "Downgraded-From" becomes "From", and
	      "Downgraded-Resent-To" becomes "Resent-To".
	    
</dd>
<dt>1b. </dt>
<dd>
	      For the field value, decode the MIME-encoded value of
	      the downgraded field according to <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a>.
	    
</dd>
<dt>2. </dt>
<dd>
	      If the header field is one that can only appear once,
	      according to the table in <a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a>
	      section 3.6 ("From", "Sender", "To", "CC", "BCC",
	      "Reply-To"), locate the corresponding field in the
	      message's headers, and skip to step 9.  Otherwise,
	      continue with step 3.
	    
</dd>
<dt>3. </dt>
<dd>
	      Apply "Email Header Fields Downgrading", defined in
	      section 5 of <a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a>, to the field in
	      the edit buffer, but do not prepend the "Downgraded-"
	      prefix.  Put the result into comparison buffer 1.
	    
</dd>
<dt>4. </dt>
<dd>
	      Canonicalize the header fields in the comparison buffer:
	      
<ol class="text">
<li>
		  Unfold all header field continuation lines as
		  described in <a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a>.
		
</li>
<li>
		  Ensure that there is one space character before and
		  one after the &lt;mailbox-list&gt; separator ",".
		  If a space character is missing, insert one.
		
</li>
<li>
		  Ensure that there is one space character before and
		  one after each &lt;comment&gt;.  If a space character is
		  missing, insert one.
		
</li>
<li>
		  Decode each &lt;encoded-word&gt; whose charset is "UTF-8".
		
</li>
<li>
		  Convert all sequences of one or more WSP characters
		  to a single space character.  WSP characters here
		  include those before and after a line-folding
		  boundary.
		
</li>
<li>
		  Delete all WSP characters at the end of each unfolded header
		  field value.
		
</li>
<li>
		  Delete any WSP characters remaining before and after
		  the colon separating the header field name from the
		  header field value, retaining the colon separator.
		
</li>
</ol>
	    
</dd>
<dt>5. </dt>
<dd>
	      Locate the first instance of the corresponding field in
	      the message's headers.
	    
</dd>
<dt>6. </dt>
<dd>
	      Canonicalize the located field as in step 4, and put the result
	      into comparison buffer 2.
	    
</dd>
<dt>7. </dt>
<dd>
	      Compare the header field in comparison buffer 1 with the header
	      field in comparison buffer 2.  If they match, go to step 9.
	    
</dd>
<dt>8. </dt>
<dd>
	      Locate the next instance of the corresponding field in
	      the message's headers.  If one is found, go to step 6.
	      If none is found, stop: you can not use this downgraded
	      field because you can't find its replacement in the
	      message.
	    
</dd>
<dt>9. </dt>
<dd>
	      Replace the located header field with the one in the edit buffer.
	      You MUST NOT reorder the header fields when you do this; it's
	      important to replace the field in place.
	    
</dd>
</dl></blockquote><p>
	
</p>
<a name="unknown-preservation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.3"></a><h3>3.2.3.&nbsp;
The Unknown Header Fields' Preservation Header Fields</h3>

<p>
	  The Unknown Header Fields' Preservation Header Fields SHOULD be
	  left as they are unless the MUA has special knowledge of a particular field.
	  An MUA with such knowledge MAY use the procedure in <a class='info' href='#address-preservation'>Section&nbsp;3.2.2<span> (</span><span class='info'>Reconstructing the Address Header Fields' Preservation Header Fields</span><span>)</span></a>,
	  above, for those fields that it knows about.
    
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security considerations</h3>

<p>
   While information in any email header should usually be treated with
   some suspicion, current email systems commonly employ various
   mechanisms and protocols to make the information more trustworthy.
   For example, an organization's boundary MTA can modify "From:" lines
   so that messages arriving from outside the organization are easily
   distinguishable from internal emails. As a result of that rewriting,
   it might not be possible to reconstruct the "Downgraded-From" header field.
	
</p>
<p>
   A MUA MAY emphasize bogus or broken Address Header Fields' Preservation Header Fields found in step 8 of
   <a class='info' href='#address-preservation'>Section&nbsp;3.2.2<span> (</span><span class='info'>Reconstructing the Address Header Fields' Preservation Header Fields</span><span>)</span></a>.
    
</p>
<p>
   Hiding the information from the actual header fields when using the
   "Downgraded-" header fields does not cause loss of information if
   generating MIME decoded header fields in step 1
   of <a class='info' href='#address-preservation'>Section&nbsp;3.2.2<span> (</span><span class='info'>Reconstructing the Address Header Fields' Preservation Header Fields</span><span>)</span></a>
   and
   the comparison done in step 8
   are successful.
   To ensure that no information is lost, a MUA
   SHOULD have a function that uses the actual message that was
   received (with/without MIME decoding) to render the message.
    
</p>
<p>
See "Security considerations" section in <a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a> and <a class='info' href='#RFC4952'>[RFC4952]<span> (</span><span class='info'>Klensin, J. and Y. Ko, &ldquo;Overview and Framework for Internationalized Email,&rdquo; July&nbsp;2007.</span><span>)</span></a> for more discussion.
    
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>
This document makes no requests for IANA action. This section can be
removed by the RFC Editor before publication.
    
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Acknowledgements</h3>

<p>
	This document was separated from <a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a>.
	Both documents were developed in the EAI WG.  Significant
	comments and suggestions were received from
	John Klensin, Harald Alvestrand, Chris Newman, Randall Gellens,
	Charles Lindsey, Marcos Sanz, Alexey Melnikov, Pasi Eronen,
	Frank Ellermann, Edward Lewis, S. Moonesamy and JET members.
    
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Change History</h3>

<p>
	This section is used for tracking the update of this document.  Will be
	removed after finalize.
    
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
draft-fujiwara-eai-downgraded-display: Version 00</h3>

<p>
	</p>
<ul class="text">
<li>Initial version
</li>
<li>It is separated from Appendix A of draft-ietf-eai-downgrade-05.txt
</li>
</ul><p>
	
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
draft-ietf-eai-downgraded-display: Version 00</h3>

<p>
	</p>
<ul class="text">
<li>Submitted as a working group draft
</li>
</ul><p>
	
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
draft-ietf-eai-downgraded-display: Version 01</h3>

<p>
	</p>
<ul class="text">
<li>Prohibited and removed Displaying Technique 1
</li>
<li>Added new texts to Security Considerations
</li>
</ul><p>
	
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
draft-ietf-eai-downgraded-display: Version 02</h3>

<p>
	</p>
<ul class="text">
<li>updated by comments from Chair's review and AD's review
</li>
<li>Fixed references
</li>
<li>Rewrote section 4 to be more comprehensible
</li>
<li>Added bogus or broken "Downgraded-" header fields
</li>
<li>Added sentences in Security considerations
</li>
</ul><p>
	
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5"></a><h3>7.5.&nbsp;
draft-ietf-eai-downgraded-display: Version 03</h3>

<p>
	</p>
<ul class="text">
<li>Section 3 (formerly 3 and 4) was rewritten by Barry Leiba.
</li>
</ul><p>
	
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2045">[RFC2045]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2045">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>,&rdquo; RFC&nbsp;2045, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2045.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2047">[RFC2047]</a></td>
<td class="author-text"><a href="mailto:moore@cs.utk.edu">Moore, K.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2047">MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text</a>,&rdquo; RFC&nbsp;2047, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2047.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2047.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2047.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2183">[RFC2183]</a></td>
<td class="author-text"><a href="mailto:rens@century.com">Troost, R.</a>, <a href="mailto:sdorner@qualcomm.com">Dorner, S.</a>, and <a href="mailto:moore@cs.utk.edu">K. Moore</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2183">Communicating Presentation Information in Internet Messages: The Content-Disposition Header Field</a>,&rdquo; RFC&nbsp;2183, August&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2183.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2183.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2183.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2231">[RFC2231]</a></td>
<td class="author-text"><a href="mailto:ned.freed@innosoft.com">Freed, N.</a> and <a href="mailto:moore@cs.utk.edu">K. Moore</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2231">MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations</a>,&rdquo; RFC&nbsp;2231, November&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2231.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2231.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2231.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4952">[RFC4952]</a></td>
<td class="author-text">Klensin, J. and Y. Ko, &ldquo;<a href="http://tools.ietf.org/html/rfc4952">Overview and Framework for Internationalized Email</a>,&rdquo; RFC&nbsp;4952, July&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4952.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5322">[RFC5322]</a></td>
<td class="author-text"><a href="mailto:presnick@qualcomm.com">Resnick, P., Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc5322">Internet Message Format</a>,&rdquo; RFC&nbsp;5322, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5322.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc5322.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc5322.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5335">[RFC5335]</a></td>
<td class="author-text">Abel, Y., &ldquo;<a href="http://tools.ietf.org/html/rfc5335">Internationalized Email Headers</a>,&rdquo; RFC&nbsp;5335, September&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5335.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5504">[RFC5504]</a></td>
<td class="author-text">Fujiwara, K. and Y. Yoneya, &ldquo;<a href="http://tools.ietf.org/html/rfc5504">Downgrading Mechanism for Email Address Internationalization</a>,&rdquo; RFC&nbsp;5504, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5504.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC5321">[RFC5321]</a></td>
<td class="author-text">Klensin, J., &ldquo;<a href="http://tools.ietf.org/html/rfc5321">Simple Mail Transfer Protocol</a>,&rdquo; RFC&nbsp;5321, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5321.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5336">[RFC5336]</a></td>
<td class="author-text">Yao, J. and W. Mao, &ldquo;<a href="http://tools.ietf.org/html/rfc5336">SMTP Extension for Internationalized Email Addresses</a>,&rdquo; RFC&nbsp;5336, September&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5336.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5337">[RFC5337]</a></td>
<td class="author-text">Newman, C. and A. Melnikov, &ldquo;<a href="http://tools.ietf.org/html/rfc5337">Internationalized Delivery Status and Disposition Notifications</a>,&rdquo; RFC&nbsp;5337, September&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5337.txt">TXT</a>).</td></tr>
</table>

<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Examples</h3>

<p>
	This section shows a example of displaying a downgraded message.
	First, an example of the original UTF8SMTP message and its downgraded message are
	shown. The example comes from "Example 1" of <a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a> and
	three header fields, "Unknown-Field", "Resent-From", and "Resent-To", are added.
	The example UTF8SMTP message is shown in <a class='info' href='#example-originaleaismtpsession'>Figure&nbsp;1<span> (</span><span class='info'>Original message</span><span>)</span></a>.
	
</p>
<p>
	<br /><hr class="insert" />
<a name="example-originaleaismtpsession"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: NON-ASCII-SUBJECT
Unknown-Field: NON-ASCII-Unknown
From: DISPLAY-local &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
To: DISPLAY-remote1 &lt;NON-ASCII-remote1@example.net
 &lt;ASCII-remote1@example.net&gt;&gt;
Cc: DISPLAY-remote2 &lt;NON-ASCII-remote2@example.org&gt;
Resent-From: DISPLAY-remote1 &lt;NON-ASCII-remote1@example.net
 &lt;ASCII-remote1@example.net&gt;&gt;
Resent-To: DISPLAY-reto &lt;NON-ASCII-reto@example.net
 &lt;ASCII-reto@example.net&gt;&gt;
Date: DATE

MAIL_BODY

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Original message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

	
</p>
<p>
	Delivered downgraded message is shown in <a class='info' href='#example-headerconversiondowngrading'>Figure&nbsp;2<span> (</span><span class='info'>Downgraded message</span><span>)</span></a>.
	Return-Path header will be added by the final destination MTA.
	Some of Received: header fields may be added.
	<br /><hr class="insert" />
<a name="example-headerconversiondowngrading"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Return-Path: &lt;ASCII-local@example.com&gt;
Received: ...
Downgraded-Mail-From: =?UTF-8?Q?&lt;NON-ASCII-local@example.com_?=
 =?UTF-8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
Downgraded-Rcpt-To: =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_?=
 =?UTF-8?Q?&lt;ASCII-remote1@example.net&gt;&gt;?=
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: =?UTF-8?Q?NON-ASCII-SUBJECT?=
Downgraded-Unknown-Field: =?UTF-8?Q?NON-ASCII-Unknown?=
From: =?UTF-8?Q?DISPLAY-local?= &lt;ASCII-local@example.com&gt;
Downgraded-From: =?UTF-8?Q?DISPLAY-local_&lt;NON-ASCII-local@example.com_?=
 =?UTF-8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
To: =?UTF-8?Q?DISPLAY-remote1?= &lt;ASCII-remote1@example.net&gt;
Downgraded-To: =?UTF-8?Q?DISPLAY-remote1_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_&lt;ASCII-remote1@example.net&gt;&gt;?=
Cc: =?UTF-8?Q?DISPLAY-remote2?= Internationalized address
 =?UTF-8?Q?NON-ASCII-remote2@example.org?= removed:;
Downgraded-Cc: =?UTF-8?Q?DISPLAY-remote2_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote2@example.org&gt;?=
Resent-From: =?UTF-8?Q?DISPLAY-remote1?= &lt;ASCII-remote1@example.net&gt;
Downgraded-Resent-From: =?UTF-8?Q?DISPLAY-remote1_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_&lt;ASCII-remote1@example.net&gt;&gt;?=
Resent-To: =?UTF-8?Q?DISPLAY-reto?= &lt;ASCII-reto@example.net&gt;
Downgraded-Resent-To: =?UTF-8?Q?DISPLAY-reto_?=
 =?UTF-8?Q?&lt;NON-ASCII-reto@example.net_&lt;ASCII-reto@example.net&gt;&gt;?=
Date: DATE

MAIL_BODY

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Downgraded message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
	<a class='info' href='#example-mimedecoded'>Figure&nbsp;3<span> (</span><span class='info'>MIME decoded message</span><span>)</span></a> shows MIME decoded message of
	<a class='info' href='#example-headerconversiondowngrading'>Figure&nbsp;2<span> (</span><span class='info'>Downgraded message</span><span>)</span></a>.
	The recipient can read the original From, To, Cc and Unknown-Field header fields as
	Downgraded-From, Downgraded-To, Downgraded-Cc and Downgraded-Unknown-Field header fields.
	<br /><hr class="insert" />
<a name="example-mimedecoded"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Return-Path: &lt;ASCII-local@example.com&gt;
Received: ...
Downgraded-Mail-From: &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
Downgraded-Rcpt-To: &lt;NON-ASCII-remote1@example.net
 &lt;ASCII-remote1@example.net&gt;&gt;
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: NON-ASCII-SUBJECT
Downgraded-Unknown-Field: NON-ASCII-Unknown
From: DISPLAY-local &lt;ASCII-local@example.com&gt;
Downgraded-From: DISPLAY-local &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
To: DISPLAY-remote1 &lt;ASCII-remote1@example.net&gt;
Downgraded-To: DISPLAY-remote1 &lt;NON-ASCII-remote1@example.net
 &lt;ASCII-remote1@example.net&gt;&gt;
Cc: DISPLAY-remote2 Internationalized address
 NON-ASCII-remote2@example.org removed:;
Downgraded-Cc: DISPLAY-remote2 &lt;NON-ASCII-remote2@example.org&gt;
Resent-From: DISPLAY-remote1 &lt;ASCII-remote1@example.net&gt;
Downgraded-Resent-From: DISPLAY-remote1
 &lt;NON-ASCII-remote1@example.net &lt;ASCII-remote1@example.net&gt;&gt;
Resent-To: DISPLAY-reto &lt;ASCII-reto@example.net&gt;
Downgraded-Resent-To: DISPLAY-reto
 &lt;NON-ASCII-reto@example.net &lt;ASCII-reto@example.net&gt;&gt;
Date: DATE

MAIL_BODY

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: MIME decoded message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


      
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Displaying example</h3>

<p>
	This example shows how to display the message in 
	<a class='info' href='#example-headerconversiondowngrading'>Figure&nbsp;2<span> (</span><span class='info'>Downgraded message</span><span>)</span></a>, above,
	using the process defined in <a class='info' href='#converting'>Section&nbsp;3<span> (</span><span class='info'>Converting downgraded message headers for display</span><span>)</span></a>.
	For simplicity, we will show the reconstruction of all the
	applicable fields at once.
      
</p>
<p>
    Selecting all Downgraded-* fields gives this:
      
</p>
<p>
	<br /><hr class="insert" />
<a name="all-downgraded-fields"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Downgraded-Mail-From: =?UTF-8?Q?&lt;NON-ASCII-local@example.com_?=
 =?UTF-8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
Downgraded-Rcpt-To: =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_?=
 =?UTF-8?Q?&lt;ASCII-remote1@example.net&gt;&gt;?=
Downgraded-Unknown-Field: =?UTF-8?Q?NON-ASCII-Unknown?=
Downgraded-From: =?UTF-8?Q?DISPLAY-local_&lt;NON-ASCII-local@example.com_?=
 =?UTF-8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
Downgraded-To: =?UTF-8?Q?DISPLAY-remote1_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_&lt;ASCII-remote1@example.net&gt;&gt;?=
Downgraded-Cc: =?UTF-8?Q?DISPLAY-remote2_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote2@example.org&gt;?=
Downgraded-Resent-From: =?UTF-8?Q?DISPLAY-remote1_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_&lt;ASCII-remote1@example.net&gt;&gt;?=
Downgraded-Resent-To: =?UTF-8?Q?DISPLAY-reto_?=
 =?UTF-8?Q?&lt;NON-ASCII-reto@example.net_&lt;ASCII-reto@example.net&gt;&gt;?=

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Downgraded header fields&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

	
</p>
<p>
    Two of the fields, Downgraded-Mail-From and Downgraded-Rcpt-To, are
    Envelope Information Preservation Header Fields, and will not be reconstructed.
    One field, Downgraded-Unknown-Field, is an Unknown Header Fields' Preservation
    Header Field, and will also not be reconstructed.  That leaves these to be
    reconstructed, the Address Header Fields' Preservation Header Fields:
      
</p>
<p>
	<br /><hr class="insert" />
<a name="step0"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Downgraded-From: =?UTF-8?Q?DISPLAY-local_&lt;NON-ASCII-local@example.com_?=
 =?UTF-8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
Downgraded-To: =?UTF-8?Q?DISPLAY-remote1_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_&lt;ASCII-remote1@example.net&gt;&gt;?=
Downgraded-Cc: =?UTF-8?Q?DISPLAY-remote2_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote2@example.org&gt;?=
Downgraded-Resent-From: =?UTF-8?Q?DISPLAY-remote1_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_&lt;ASCII-remote1@example.net&gt;&gt;?=
Downgraded-Resent-To: =?UTF-8?Q?DISPLAY-reto_?=
 =?UTF-8?Q?&lt;NON-ASCII-reto@example.net_&lt;ASCII-reto@example.net&gt;&gt;?=

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: Header fields for the reconstruction&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

	
</p>
<p>
	Now, perform Step 1, creating temporary fields.
      
</p>
<p>
	<br /><hr class="insert" />
<a name="step1"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

From: DISPLAY-local &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
To: DISPLAY-remote1 &lt;NON-ASCII-remote1@example.net
 &lt;ASCII-remote1@example.net&gt;&gt;
Cc: DISPLAY-remote2 &lt;NON-ASCII-remote2@example.org&gt;
Resent-From: DISPLAY-remote1
 &lt;NON-ASCII-remote1@example.net &lt;ASCII-remote1@example.net&gt;&gt;
Resent-To: DISPLAY-reto
 &lt;NON-ASCII-reto@example.net &lt;ASCII-reto@example.net&gt;&gt;

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: Output of Step 1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
    In step 2, we set aside the "From", "To", and "Cc" fields, and continue to step 3
    with just "Resent-From" and "Resent-To" (the fields that may appear more than once).
    The fields we set aside will be picked up again later, in step 9.
	
</p>
<p>
	Perform Steps 3 and 4. The edit buffer contains re-generated ASCII header fields,
	canonicalized.
	
</p>
<p>
	<br /><hr class="insert" />
<a name="step4"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Resent-From: =?UTF-8?Q?DISPLAY-remote1?= &lt;ASCII-remote1@example.net&gt;
Resent-To: =?UTF-8?Q?DISPLAY-reto?= &lt;ASCII-reto@example.net&gt;

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: The edit buffer (output of Step 4)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
	  Perform Steps 5 to 7, comparison, for each header field.  Both the Resent-From and
	  Resent-To fields will match, and we will proceed to step 9.  (Step 8, iteration,
	  does not apply in this example.
	
</p>
<p>
	  Perform step 9, replacing all applicable fields, without changing the order.  Then
	  do MIME decoding on everything, for display.
	
</p>
<p>
	<br /><hr class="insert" />
<a name="step9"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Return-Path: &lt;ASCII-local@example.com&gt;
Received: ...
Downgraded-Mail-From: &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
Downgraded-Rcpt-To: &lt;NON-ASCII-remote1@example.net&gt;
 &lt;ASCII-remote1@example.net&gt;
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: NON-ASCII-SUBJECT
Downgraded-Unknown-Field: NON-ASCII-Unknown
From: DISPLAY-local &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
To: DISPLAY-remote1 &lt;NON-ASCII-remote1@example.net
 &lt;ASCII-remote1@example.net&gt;&gt;
Cc: DISPLAY-remote2 &lt;NON-ASCII-remote2@example.org&gt;
Resent-From: DISPLAY-remote1 &lt;NON-ASCII-remote1@example.net
 &lt;ASCII-remote1@example.net&gt;&gt;
Resent-To: DISPLAY-reto &lt;NON-ASCII-reto@example.net
 &lt;ASCII-reto@example.net&gt;&gt;
Date: DATE

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: The final result&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
	As a result, in this simple example, some original header fields are now displayed in their
	original form.
	Differences between <a class='info' href='#example-originaleaismtpsession'>Figure&nbsp;1<span> (</span><span class='info'>Original message</span><span>)</span></a> and <a class='info' href='#step9'>Figure&nbsp;8<span> (</span><span class='info'>The final result</span><span>)</span></a> are Return-Path, Downgraded-Mail-From, Downgraded-Rcpt-To, and Downgraded-Unknown-Field.
      
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kazunori Fujiwara</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan Registry Services Co., Ltd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chiyoda First Bldg. East 13F, 3-8-1 Nishi-Kanda</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chiyoda-ku, Tokyo  101-0065</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81-3-5215-8451</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:fujiwara@jprs.co.jp">fujiwara@jprs.co.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Barry Leiba</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 646 827 0648</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:barryleiba@computer.org">barryleiba@computer.org</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://internetmessagingtechnology.org/">http://internetmessagingtechnology.org/</a></td></tr>
</table>
</body></html>
