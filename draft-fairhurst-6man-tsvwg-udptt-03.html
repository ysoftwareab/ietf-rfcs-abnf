<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>The UDP Tunnel Transport mode</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="The UDP Tunnel Transport mode">
<meta name="keywords" content="template">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Engineering Task Force</td><td class="header">G. Fairhurst</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">University of Aberdeen</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">February 10, 2010</td></tr>
<tr><td class="header">Expires: August 14, 2010</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />The UDP Tunnel Transport mode<br />draft-fairhurst-6man-tsvwg-udptt-03</h1>

<h3>Abstract</h3>

<p>This document proposes a standards track protocol called the UDP
      Tunnel Transport. This protocol updates the UDP processing of RFC 2460
      for IPv6 hosts and routers. The update enables a sender to generate a
      UDP datagram where the UDP checksum is replaced by a header check
      determined only by the protocol header information. For this use, the
      document also updates the way the IPv6 UDP length field is interpreted.
      This mode is intended to minimise the processing cost for the transport
      of tunnel packets using UDP.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on August 14, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Background<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.</a>&nbsp;
Use of UDP Tunnels <br />
<a href="#the_update">2.</a>&nbsp;
Update to RFC 2460 to support UDTT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.1.</a>&nbsp;
Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.2.</a>&nbsp;
UDPTT Next Header Value<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.3.</a>&nbsp;
UDPTT Header Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.4.</a>&nbsp;
UDP and UDPTT Datagrams with no payload<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">2.5.</a>&nbsp;
Calculation of IPv6 UDPTT Header Check<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">2.6.</a>&nbsp;
Multicast support for UDPTT<br />
<a href="#anchor10">3.</a>&nbsp;
Using UDPTT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">3.1.</a>&nbsp;
UDPTT Usage Guidelines<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">3.2.</a>&nbsp;
Requirements for Tunnelled Protocols<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">3.3.</a>&nbsp;
Backwards compatibility with RFC 2460<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">3.4.</a>&nbsp;
 Middlebox Traversal and Incremental Checksum Update<br />
<a href="#Acknowledgements">4.</a>&nbsp;
Acknowledgements<br />
<a href="#IANA">5.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">6.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">7.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">7.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">7.2.</a>&nbsp;
Informative References<br />
<a href="#app-additional">Appendix&nbsp;A.</a>&nbsp;
Why do we need a checksum? <br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">A.1.</a>&nbsp;
IPv4 Compatibility<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">A.2.</a>&nbsp;
Why not set the IPv6 UDP checksum to zero?<br />
<a href="#anchor19">Appendix&nbsp;B.</a>&nbsp;
Applicability for AMT<br />
<a href="#anchor20">Appendix&nbsp;C.</a>&nbsp;
Document Change History<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The UDP Tunnel Transport (UDPTT) is a protocol that updates the User
      Datagram Protocol (UDP) processing of <a class='info' href='#RFC2460'>RFC2460<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a> [RFC2460] for IPv6 hosts and routers. UDPTT is
      intended to transport datagrams that carry tunnel-encapsulated packets.
      It is not intended as a general purpose transport, since it is
      applicable only for cases where the tunnel application can provide a set
      of checks on the correctness of the received payload.
</p>
<p>A UDPTT end point may be either a host or a router. The tunneling
      protocol introduces a header check that validates the delivery of the
      packet to the correct transport endpoint. This check is not intended as
      an authentication check (in the manner of a security protocol), but is
      introduced to reduce the probability that the endpoint stacks receive
      erroneous packets that may corrupt internal state, introduce unnecessary
      packet processing, or lead to ambiguous packet counts.
</p>
<p>The way in which the header check is computed in UDPTT will usually
      result in a constant value for each UDPTT flow. This value may be cached
      as a part of the tunnel endpoint flow state. Once the tunnel has been
      created, this requires a receiver to perform a 16-bit comparison
      operation, rather than a 1's complement checksum. This approach was
      driven by a desire to eliminate expensive computation in routers that
      may need to handle many flows operating at high rate.
</p>
<p>The next section provides background information on UDP variants and
      the use of UDP for tunneling. Section 2 defines the UDPTT protocol and
      section 3 provides information about the use of UDPTT.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Background</h3>

<p>UDP is defined in <a class='info' href='#RFC0768'>[RFC0768]<span> (</span><span class='info'>Postel, J., &ldquo;User Datagram Protocol,&rdquo; August&nbsp;1980.</span><span>)</span></a>. This supports two
        checksum behaviours when used with IPv4. The normal behaviour is for
        the sender to calculate a checksum over a block of data that includes
        a pseudo header and the UDP datagram payload. The receiver validates
        this checksum to verify delivery to the intended transport
        endpoint.
</p>
<p>The UDP header includes a 16-bit one's complement checksum that
        provides a statistical guarantee that the payload was not corrupted in
        transit. It also allows the receiver to verify that the endpoint was
        the intended destination of the datagram, because it includes a pseudo
        header that covers the IP addresses, port numbers, transport payload
        length, and Next Header/Protocol value corresponding to the UDP
        transport protocol. The length field verifies that the datagram is not
        truncated or padded. The checksum therefore protects an application
        against receiving corrupted payload data in place of, or in addition
        to, the data that was sent. Applications are recommended to enable UDP
        checksums <a class='info' href='#RFC5405'>[RFC5405]<span> (</span><span class='info'>Eggert, L. and G. Fairhurst, &ldquo;Unicast UDP Usage Guidelines for Application Designers,&rdquo; November&nbsp;2008.</span><span>)</span></a>, although <a class='info' href='#RFC0768'>UDP<span> (</span><span class='info'>Postel, J., &ldquo;User Datagram Protocol,&rdquo; August&nbsp;1980.</span><span>)</span></a> [RFC0768] permits the option to be disabled when
        used with IPv4.
</p>
<p>Unlike IPv4, when UDP datagrams are originated by an IPv6 node, the
        UDP checksum is not optional. The use of the UDP checksum is required
        when applications transmit UDP over IPv6 <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a>, since there is no network-layer integrity
        check. UDPTT provides an alternative intended to achieve at least
        equivalent protection to using IPv4 (with the associated header
        checksum) and UDP (with the checksum disabled).
</p>
<p><a class='info' href='#RFC3828'>UDP-Lite<span> (</span><span class='info'>Larzon, L-A., Degermark, M., Pink, S., Jonsson, L-E., and G. Fairhurst, &ldquo;The Lightweight User Datagram Protocol (UDP-Lite),&rdquo; July&nbsp;2004.</span><span>)</span></a> [RFC3828] provides a checksum with an
        optional partial coverage. When using this option, a datagram is
        divided into a sensitive part (covered by the checksum) and an
        insensitive part (not covered by the checksum). Errors in the
        insensitive part will not cause the packet to be discarded by the
        transport layer at the receiving host. When the checksum covers the
        entire packet, which should be the default, UDP-Lite is semantically
        identical to UDP. UDP-Lite is specified for use with IPv4 and IPv6,
        and uses an IP protocol type (or IPv6 next header) with a value of 136
        decimal.
</p>
<p>While UDP-Lite benefits from differential link error treatment,
        where the packet header is afforded higher protection on a radio link
        compared to the payload, this is explicitly not the goal of UDPTT. For
        UDPTT, the payload is expected to be protected by other integrity
        checks, and generally all parts of the packet will seek equal
        protection, as for UDP and TCP. Since UDP-Lite also includes the total
        packet length (extracted from the IP module), the calculated checksum
        depends on the size of the encapsulated packet, whereas in UDPTT, the
        checksum protection does not validate the actual size of the transport
        layer payload.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Use of UDP Tunnels </h3>

<p>One increasingly popular use of UDP is as a tunneling protocol,
        where a tunnel endpoint encapsulates the packets of another protocol
        inside UDP datagrams and transmits them to another tunnel endpoint.
        Using UDP as a tunneling protocol is attractive when the payload
        protocol is not supported by middleboxes that may exist along the
        path, because many middleboxes support transmission using UDP. In this
        use, the receiving endpoint decapsulates the UDP datagrams and
        forwards the original packets contained in the payload <a class='info' href='#RFC5405'>[RFC5405]<span> (</span><span class='info'>Eggert, L. and G. Fairhurst, &ldquo;Unicast UDP Usage Guidelines for Application Designers,&rdquo; November&nbsp;2008.</span><span>)</span></a>. Tunnels establish virtual links that appear
        to directly connect locations that are distant in the physical
        Internet topology and can be used to create virtual (private)
        networks.
</p>
<p>This is expected to be the normal use of UDPTT, where UDPTT may
        replace UDP as the tunnel transport when there is a desire to reduce
        processing costs at the tunnel endpoints. The end point for the UDPTT
        may be either a host or a router.
</p>
<p>{Note: The current specification targets use with IPv6, however the
        method may also be applicable to IPv4}
</p>
<a name="the_update"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Update to RFC 2460 to support UDTT</h3>

<p>This section defines the update to IPv6 [RFC2460], if this document
      is approved for publication by the IETF.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
UDPTT Next Header Value</h3>

<p>UDPTT datagrams are carried in the payload of IPv6 packets. UDP and
        UDPTT share the next header protocol number (decimal 17) and are
        differentiated only by the Length of the IP payload.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
UDPTT Header Format</h3>

<p>The UDPTT header is shown in figure <a class='info' href='#udptt_format'>Figure&nbsp;1<span> (</span><span class='info'>UDPTT Header Format</span><span>)</span></a>. This format resembles that of UDP.
</p><br /><hr class="insert" />
<a name="udptt_format"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre> 0              15 16             31
+--------+--------+--------+--------+
|     Source      |   Destination   |
|      Port       |      Port       |
+--------+--------+--------+--------+
|                 |     Header      |
|    0x0008       |      Check      |
+--------+--------+--------+--------+
|                                   |
:           UDPTT Payload           :
|  (no additional integrity check)  |
+-----------------------------------+</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: UDPTT Header Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
</p>
<p>The source and destination ports are used in the same way as for
        UDP and UDP-Lite. UDPTT places the constant value 0x0008 in the
        position occupied by the Length field in UDP and the Checksum Coverage
        Field in UDP-Lite. The value of 0x0008 is legal for both UDP and
        UDP-Lite.
</p>
<p>The length of the payload part is determined from the size
        information provided by the IP module in the same manner as for <a class='info' href='#RFC0793'>TCP<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> [RFC0793].
</p>
<p>The Header Check field is a 16-bit value calculated as specified in
        the next section. This value is set by the sender and validated by the
        receiver.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
UDP and UDPTT Datagrams with no payload</h3>

<p>It is expected that UDPTT datagrams will carry a
        tunnel-encapsulated packet as payload. A UDPTT datagram with no
        payload is indistinguishable from a UDP datagram with no payload. Both
        have the same representation on the wire, and the same semantics at
        the sender and receiver. There is no need for a receiver to
        differentiate these packets.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Calculation of IPv6 UDPTT Header Check</h3>

<p>The Header Check is computed as the 16-bit one's complement of the
        one's complement sum <a class='info' href='#RFC1071'>[RFC1071]<span> (</span><span class='info'>Braden, R., Borman, D., Partridge, C., and W. Plummer, &ldquo;Computing the Internet checksum,&rdquo; September&nbsp;1988.</span><span>)</span></a> of a pseudo-header
        of information collected from the IPv6 and UDPTT header fields.
</p>
<p>The following illustration shows the UDPTT pseudo-header for
        IPv6:
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>   0            7 8            15 16            23 24             31
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                                                               +
   |                                                               |
   +                         Source Address                        +
   |                                                               |
   +                                                               +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                                                               +
   |                                                               |
   +                      Destination Address                      +
   |                                                               |
   +                                                               +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         0x0000000008                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      zero                     | Next H value  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;UDPTT Pseudo header fields&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p></p>
<ul class="text">
<li>As in UDP, if the IPv6 packet carrying the UDPTT datagrams also
            carries an additional extension header that contains a Routing
            header, the Destination Address used in the pseudo-header is that
            of the final destination. At the originating node, that address
            will be in the last element of the Routing header; at the
            recipient(s), that address will be in the Destination Address
            field of the IPv6 header <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a>.
</li>
<li>The pseudo header of UDPTT is different from the pseudo header
            of UDP in one way: This pseudo header replaces the Upper-Layer
            Packet Length field, with a constant of 8. This value is identical
            to the Upper-Layer Packet Length field that would be returned by a
            compliant IPv6 UDP stack with no transport-layer payload <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a>. (It differs from the value that would
            have been used by UDP-Lite, which utilises the length reported by
            the IP Module in the pseudo header). Encapsulated packets need to
            include their own methods to verify integrity and correct payload
            length.
</li>
<li>The Next H value in the pseudo-header is the value specified
            for UDP (17 decimal). This value will differ from the Next Header
            value in the IPv6 header if there are extension headers between
            the IPv6 header and the upper-layer header.
</li>
</ul>

<p>Prior to computation, the Header Check field MUST be set to zero.
        If the computed checksum is zero, it is transmitted as all ones (the
        equivalent in one's complement arithmetic) <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a> specifies that IPv6 receivers must discard
        UDP datagrams containing a zero checksum, and should log the error.
        This processing is preserved in this update.
</p>
<p>The way in which the Header check is computed in UDPTT will usually
        result in a constant value for each UDP flow. This value may be cached
        as part of the tunnel endpoint flow state. Once the tunnel has been
        created, a sender MAY insert the cached value instead of computing the
        checksum, and a receiver may then use a 16-bit comparison of the
        received value against the cached value, rather than a 1's complement
        checksum. This approach may be desirable to minimise expensive
        computation in routers that need to handle many UDPTT flows operating
        at high rate.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6"></a><h3>2.6.&nbsp;
Multicast support for UDPTT</h3>

<p>Like UDP and UDP-Lite, UDPTT MAY be used as a transport for
        multicast datagrams.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Using UDPTT</h3>

<p>This section provides information for implementors and users of
      UDPTT.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
UDPTT Usage Guidelines</h3>

<p>Implementors may use UDPTT in the same way as UDP providing that
        the application does not need UDPTT to validate the
        tunnel-encapsulated packet. The protocol is not constrained to the
        semantics of one particular tunnel usage, and is believed compatible
        with a range of tunnel mechanisms. If the tunnel requires greater
        assurance that tunnel-encapsulated packet is correct or has been
        delivered to the correct end point (e.g. where control data is carried
        over UDPTT), then the tunnel encapsulation MUST introduce its own
        integrity checks. This is consistent with the expected behaviour of
        IETF-defined tunnel encapsulations.
</p>
<p>IPv6 Jumbograms are not supported in the UDPTT protocol. If
        required, such packets may be sent using UDP.
</p>
<p>The <a class='info' href='#RFC5405'>UDP Usage Guidelines<span> (</span><span class='info'>Eggert, L. and G. Fairhurst, &ldquo;Unicast UDP Usage Guidelines for Application Designers,&rdquo; November&nbsp;2008.</span><span>)</span></a> [RFC5405] provides
        guidance for application designers the use of UDP to support
        tunneling. These guidelines also apply to this protocol.
</p>
<p>Unlike UDP, UDPTT does not validate the Length field of the IP
        header when calculating the transport checksum. This design decision
        was driven by the goal that the checksum value should not normally
        change from packet to packet within a single transport flow. The
        omission of this value is a relaxation of the integrity check.
        Therefore:
</p>
<p></p>
<ul class="text">
<li>A tunnel receiver MUST discard UDPTT packets where the UDPTT
            payload size is less than the minimum required by the tunnelled
            protocol being transported.
</li>
<li>Application stacks SHOULD provide a way for a tunnel endpoint
            to identify whether UDPTT is to be used. This could be identified
            by a socket option, or similar operating system mechanism. A
            sender uses the socket option to include data in a UDPTT datagram
            (beyond the base UDP header), the receiver uses this to ensure the
            protocol stack passes data based on the Upper Layer payload,
            rather than the UDP header).
</li>
</ul>

<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Requirements for Tunnelled Protocols</h3>

<p>This section identifies the requirements for protocols transported
        within the payload of a UDPTT datagram.
</p>
<p>Specifically, these requirements dictate that:
</p>
<p></p>
<ul class="text">
<li>An inner IPv4 (or IPv6) packet with a UDP checksum equal to
            zero MUST NOT be tunneled.
</li>
<li>The tunneling protocol and implementation MUST NOT be used to
            transport IPv4 or IPv6 packets that use network-layer
            fragmentation.
</li>
<li>A receiver MUST check the size of the tunnel-encapsulated
            packet based on information contained in the tunnel-encapsulated
            packet. A tunnel receiver MUST discard any tunnel-encapsulated
            packets where the reported length of the tunnelled packet is
            different to that reported by the IP module (reduced by the size
            of any header extensions present).
</li>
<li>A packet encapsulated over UDPTT MAY also use the UDPTT tunnel
            encapsulation mode, that is, tunnels may be recursively
            encpauslated. However, the inner encapsulated packet MUST provide
            an integrity check of the transported payload information (e.g.
            the inner encapsulated IPv6 packet MUST NOT itself use UDPTT or be
            an IPv4 UDP datagram with the checksum disabled).
</li>
<li>A tunnel protocol that introduces control information MUST
            provide its own integrity check methods (e.g. validating the
            integrity of all control information and the length of the control
            packet).
</li>
<li>Non-IP inner packets MUST use a CRC or other mechanism for
            checking packet length and integrity.
</li>
</ul>

<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Backwards compatibility with RFC 2460</h3>

<p>There are three possible behaviours when a UDPTT datagram is
        received by an IPv6 host that only supports UDP <a class='info' href='#RFC2460'>as defined in<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a> [RFC2460].
</p>
<p></p>
<ol class="text">
<li>A receiver checksum algorithm that uses the transport header
            Length field to calculate the UDP checksum (<a class='info' href='#RFC2460'>as defined for UDP in<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a> [RFC2460]) will result in a
            valid checksum. However, the number of bytes forwarded to the
            upper layer, is dependent on how the payload length is interpreted
            when forwarding to the upper layer. An implementation could
            forward a number of bytes corresponding to the UDP Length field
            (i.e. 8 bytes), removing the payload part. Since the UDP Length
            could be interpreted as indicating there is no payload part. This
            behaviour would result in an application receiving null UDP
            datagrams. Application designers are encouraged to design their
            applications to be robust to reception of such datagrams <a class='info' href='#RFC5405'>[RFC5405]<span> (</span><span class='info'>Eggert, L. and G. Fairhurst, &ldquo;Unicast UDP Usage Guidelines for Application Designers,&rdquo; November&nbsp;2008.</span><span>)</span></a>. Since no data is passed to the
            application, there is no danger of inserting unwanted bytes into
            the data stream at the receiver. This behaviour is safe, but no
            tunnel can be established until the stack is updated to support
            UDPTT.
</li>
<li>A receiver with a checksum that uses the Upper-Layer Packet
            Length from the UDP Length field, and forwards a number of bytes
            corresponding to the IP Length field (less any extension headers
            present). This receiver will calculate a correct checksum. The
            transport layer will forward the UDP datagram towards the
            application with the payload part. This is also the expected
            behaviour for UDPTT. The application using the transport service
            will receive a set of bytes that are bit protected and therefore
            may have been modified in transit. Since the UDP payload length is
            not verified, the number of bytes could also be modified in
            transit. This behaviour may not be what was intended by a UDP
            application developer. A tunnel application designed for UDPTT can
            use this behaviour.
</li>
<li>A receiver with a checksum that uses the IP Length field is not
            compliant with <a class='info' href='#RFC2460'>UDP defined in<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a> [RFC2460]).
            This receiver will silently discard the packet, because a
            mismatching pseudo header would cause the UDP checksum to fail.
            This behaviour is safe, but no tunnel can be established until the
            stack is updated to support UDPTT.
</li>
</ol>

<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
 Middlebox Traversal and Incremental Checksum Update</h3>

<p>Middlebox traversal needs to be considered when planning the
        deployment of any new transport protocol. Middleboxes are known to
        exist that verify the correctness of the UDP header. Following
        publication of this specification it is expected that middleboxes will
        support UDPTT:
</p>
<p></p>
<ul class="text">
<li>Middleboxes MUST NOT truncate IPv6 datagrams the UDP Header
            Length is 8 and the IP length exceeds this length.
</li>
<li>If required to update the transport checksum (UDPTT Header
            Check), a middlebox MAY use the <a class='info' href='#RFC1141'>incremental
            checksum update procedure<span> (</span><span class='info'>Mallory, T. and A. Kullberg, &ldquo;Incremental updating of the Internet checksum,&rdquo; January&nbsp;1990.</span><span>)</span></a> [RFC1141].
</li>
<li>If required to validate the transport checksum (UDPTT Header
            Check), a middlebox MUST use the method defined in this document
            for IPv6 packets with a UDP length of 8.
</li>
</ul><p>This document does not modify the requirement that IPv6
        receivers must discard UDP datagrams containing a zero checksum <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a>.
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Acknowledgements</h3>

<p>The author greatfuly acknowledges inputs provided by Magnus
      Westerlund and Marshall Eubanks on the first version of the draft.
      Discussion and inputs were provided by Philip Chimento to draft -01.
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>The IANA IPv6 Next Header registry entry for the decimal value 17
      needs to reference this document in addition to the RFC 2460.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>Transport checksums provide the first stage of protection for the
      stack, although they can not be considered authentication mechanisms.
      These checks are also desirable to ensure packet counters correctly log
      actual activity, and can spot unusual behaviours.
</p>
<p>Section 3.3 describes middlebox traversal. Firewalls and other
      security devices may need to be updated to correctly process UDPTT
      datagrams.
</p>
<p>UDPTT presents a possibility of an attack where an attacker sends a
      flood of 'empty' UDPTT datagrams towards a tunnel endpoint. Datagram
      applications should be designed to safely receive null datagrams, there
      is therefore no danger that the tunnel receiver will insert unwanted
      bytes in the application stream, such packets can contribute to the load
      of a receiving tunnel server and any middleboxes that process the UDPTT
      packet stream.
</p>
<p>Unlike UDP, the UDPTT Header Check does not validate the length field
      of the IP header when calculating the transport checksum. This design
      decision was driven by the goal that the checksum value does not
      normally change from packet to packet within a single transport flow.
      The omission of this value is a relaxation of the integrity check.
      However, a UDPTT application is required to provide its own integrity
      check methods. If the IP length field of a UDPTT datagram was modified
      in transit, a reduced value would result in "truncation" of the packet
      payload, whereas an increase in value would result in additional data
      after the intended payload. Endpoints are required to discard any
      datagrams with an inconsistent length (after accounting for any
      extension headers that may be present).
</p>
<p>Endpoints that enable the use of UDPTT in the same port number range
      as used for UDP SHOULD provide a method to allow a sending and receiving
      application to indicate which port use a specific mode. This could be
      performed using a socket option call to allow an application to request
      use of the UDPTT semantics.
</p>
<p>UDPTT is compatible with the IPsec Encapsulation Security Protocol,
      <a class='info' href='#RFC4303'>ESP<span> (</span><span class='info'>Kent, S., &ldquo;IP Encapsulating Security Payload (ESP),&rdquo; December&nbsp;2005.</span><span>)</span></a> [RFC4303], and the Authentication Header, <a class='info' href='#RFC4302'>AH<span> (</span><span class='info'>Kent, S., &ldquo;IP Authentication Header,&rdquo; December&nbsp;2005.</span><span>)</span></a> [RFC4302]. This may be used to encapsulated a UDPTT
      packet, although this introduces processing that may not be desirable in
      some deployment scenarios. IPsec may be used within a
      tunnel-encapsulated packet.
</p>
<p>A section describes issues relating to backwards compatibility in
      hosts. This section may also be applicable to middleboxes that
      manipulate the transport-layer information.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC0791">[RFC0791]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc791">Internet Protocol</a>,&rdquo; STD&nbsp;5, RFC&nbsp;791, September&nbsp;1981 (<a href="http://www.rfc-editor.org/rfc/rfc791.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC0793">[RFC0793]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc793">Transmission Control Protocol</a>,&rdquo; STD&nbsp;7, RFC&nbsp;793, September&nbsp;1981 (<a href="http://www.rfc-editor.org/rfc/rfc793.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1071">[RFC1071]</a></td>
<td class="author-text">Braden, R., Borman, D., Partridge, C., and W. Plummer, &ldquo;<a href="http://tools.ietf.org/html/rfc1071">Computing the Internet checksum</a>,&rdquo; RFC&nbsp;1071, September&nbsp;1988 (<a href="http://www.rfc-editor.org/rfc/rfc1071.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2460">[RFC2460]</a></td>
<td class="author-text"><a href="mailto:deering@cisco.com">Deering, S.</a> and <a href="mailto:hinden@iprg.nokia.com">R. Hinden</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>,&rdquo; RFC&nbsp;2460, December&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2460.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2460.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2460.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ID-UDP-Z">[ID-UDP-Z]</a></td>
<td class="author-text">&ldquo;IPv6 UDP Checksum Considerations,&rdquo; 2010.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC0768">[RFC0768]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc768">User Datagram Protocol</a>,&rdquo; STD&nbsp;6, RFC&nbsp;768, August&nbsp;1980 (<a href="http://www.rfc-editor.org/rfc/rfc768.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1141">[RFC1141]</a></td>
<td class="author-text"><a href="mailto:tmallory@CCV.BBN.COM">Mallory, T.</a> and <a href="mailto:akullberg@BBN.COM">A. Kullberg</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1141">Incremental updating of the Internet checksum</a>,&rdquo; RFC&nbsp;1141, January&nbsp;1990 (<a href="http://www.rfc-editor.org/rfc/rfc1141.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3828">[RFC3828]</a></td>
<td class="author-text">Larzon, L-A., Degermark, M., Pink, S., Jonsson, L-E., and G. Fairhurst, &ldquo;<a href="http://tools.ietf.org/html/rfc3828">The Lightweight User Datagram Protocol (UDP-Lite)</a>,&rdquo; RFC&nbsp;3828, July&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3828.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4302">[RFC4302]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4302">IP Authentication Header</a>,&rdquo; RFC&nbsp;4302, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4302.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4303">[RFC4303]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4303">IP Encapsulating Security Payload (ESP)</a>,&rdquo; RFC&nbsp;4303, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4303.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5405">[RFC5405]</a></td>
<td class="author-text">Eggert, L. and G. Fairhurst, &ldquo;<a href="http://tools.ietf.org/html/rfc5405">Unicast UDP Usage Guidelines for Application Designers</a>,&rdquo; BCP&nbsp;145, RFC&nbsp;5405, November&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5405.txt">TXT</a>).</td></tr>
</table>

<a name="app-additional"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Why do we need a checksum? </h3>

<p>Guidance on the use of UDP checksums with IPv6 is provided in UDP
      <a class='info' href='#ID-UDP-Z'>[ID&#8209;UDP&#8209;Z]<span> (</span><span class='info'>, &ldquo;IPv6 UDP Checksum Considerations,&rdquo; 2010.</span><span>)</span></a>.
</p>
<p>Previous research showed malformed packets can be received across the
      Internet, a side effect of broken internal processing (internal transfer
      errors) in routers or hosts. When the checksum is used with UDP/IPv6, it
      significantly reduces the impact of such errors, reducing the
      probability of undetected corruption of state (and data) on both the
      host stack and the applications using the transport service.
</p>
<p>Corruption in the network may result in: </p>
<ul class="text">
<li>a datagram being mis-delivered to the wrong host/router or the
          wring transport entity within a host/router. Such a datagram should
          be discarded.
</li>
<li>a datagram payload being corrupted and delivered to the intended
          host/router transport entity. Such a datagram needs to be either
          discarded or correctly processed by an application that has its own
          integrity checks.
</li>
<li>a datagram payload being truncated by corruption of the length
          field. Such a datagram needs to be discarded.
</li>
</ul><p>The decision to omit an integrity check at the IPv6 level means
      that the transport check is overloaded with many functions including
      validating: </p>
<ul class="text">
<li>the endpoint address was not corrupted within a router - this
          packet was meant for this destination and a wrong header has not
          been spliced to a different payload.
</li>
<li>the extension header processing is correctly delimited - the
          start of data has not been corrupted. The protocol types does this
          also to some extent.
</li>
<li>reassembly processing, when used.
</li>
<li>the length of the payload.
</li>
<li>the port values - i.e. the correct application gets the payload
          (applications should also check source ports/address).
</li>
<li>the payload integrity.
</li>
</ul>

<p>In IPv4, the first 4 checks are made by the IPv4 header checksum.
</p>
<p>In IPv6, this checking occurs within the stack using the UDP checksum
      information. UDPTT also performs these checks (with the exception of the
      length field, which UDPTT performs using the tunnel encapsulated
      packet).
</p>
<p>An IPv6 node also relies on the header information to determine
      whether to send an ICMPv6 error message and to determine the node to
      which this is sent. Corrupted information may lead to misdelivery to an
      unintended application socket on an unexpected host.
</p>
<p>In tunnel encapsulations, payload integrity and length verification
      may be provided by higher layer tunnel encapsulations (often using the
      IPv4, UDP, UDP-Lite, or TCP checksums).
</p>
<p>There are implications on the detectability of mis-delivery of a
      packet to an incorrect endpoint/socket, and the robustness of the
      Internet infrastructure.
</p>
<p>The IETF has defined other tunneling protocols that do not include a
      check value. However, these are typically layered directly over the
      Internet layer (identified by the upper layer type field) and are not
      also used as endpoint transport protocols. Specifically packets are only
      delivered to protocol modules that process a specific next header value.
      The next header field therefore provides a first-level check of correct
      demultiplexing. Since the UDP port space is shared many diverse
      application, this check is not available when UDP is used as transport
      and therefore the demultiplexing relies solely on the destination port
      number.
</p>
<p>Deterministic reporting of statistics is desirable: router/endpoint
      MIBs and other statistics gathering methods have the ability to detect
      this type of error, rather than recording this as valid traffic between
      spurious endpoints.
</p>
<p>Some IPv6 aware middleware and firewalls may drop or truncate UDPTT
      datagrams.
</p>
<p>{Note: The author would be glad to know of specific cases of
      truncation and other behaviours.}
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
IPv4 Compatibility</h3>

<p>The current version of this document does not specify encapsulation
        using IPv4 <a class='info' href='#RFC0791'>[RFC0791]<span> (</span><span class='info'>Postel, J., &ldquo;Internet Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>. For this network protocol.
        UDP is permitted to disable the UDP checksum and rely on the IPv4
        header checksum.
</p>
<p>{Note: Future versions of this document could also consider support
        for IPv4 if the WG considers this useful|}
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Why not set the IPv6 UDP checksum to zero?</h3>

<p>{This section to be expanded in future revisions}
</p>
<p>Topics to be discussed:</p>
<ul class="text">
<li>The role of a router and host are not fixed. It can not be
            assumed that a particular protocol (or transport mode) will only
            be used on a specific type of network node (e.g. the UDP checksum
            can be disabled only on a router). In IPv6, a node may select a
            role of a router or host on a per interface basis. Protocol
            changes intended for one specific use are often re-used for
            different applications.
</li>
<li>Why ignore checksum on reception is niave
</li>
<li>Behaviour of NAT/Middleboxes needs to be updated for UDPTT and
            for UDP cksum==0
</li>
<li>Implications on host acting as routers and transport end
            points.
</li>
<li>Requires restrictions on recursive tunnels that are not
            necessary with UDPTT
</li>
</ul>

<p>
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Applicability for AMT</h3>

<p>This specification is intended to be suited to use with "Automatic IP
      Multicast Without Explicit Tunnels", also known as "AMT". AMT currently
      specifies UDP as the transport protocol for tunneled packets; that is,
      the outer packet carrying a tunneled (inner) packet. The specification
      is for packets carrying tunneled multicast data only. In AMT, the UDP
      checksum in the UDP header of the outer packet SHOULD be 0 (See
      draft-ietf-mboned-auto-multicast-09, Section 6.6). However RFC 2460
      (IPv6) explicitly states that IPv6 receivers MUST discard UDP packets
      with a 0 checksum. So, while sending a UDP packet with a 0 checksum is
      permitted in IPv4 packets, it is explicitly forbidden in IPv6 packets.
      The computation of an additional checksum, when the inner packet(s) are
      already adequately protected, is seen to be an unwarranted burden on
      nodes implementing lightweight tunneling protocols.
</p>
<p>The intention is that UDPTT offers a safe alternate approach to the
      IPv6 method currently defined in AMT.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
Document Change History</h3>

<p>{RFC EDITOR NOTE: This section must be deleted prior to
      publication}
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Individual Draft 00 </dt>
<dd>This is the first presentation of
          this document.
</dd>
<dt>Draft -01</dt>
<dd>Phil Chimento helped define changes to
          improve the protocol. 
<ul class="text">
<li>Added text on excluding the header length value in the pseudo
              header for the UDPTT Header Check.
</li>
<li>Rewrote security considerations
</li>
<li>Added caveats for protocols using UDPTT
</li>
</ul>
</dd>
<dt>Draft -02</dt>
<dd>
<ul class="text">
<li>Fixed typos from XML formatting
</li>
<li>Added some text on ICMP
</li>
<li>Middleboxes MUST use UDPTT semantics for UDPTT
</li>
<li>Added more text on why UDP cksum==0 may be bad
</li>
<li>Added text on UDPTT API needs
</li>
<li>Allowed recursion, of UDPTT, but not final inner protocol
</li>
</ul>
</dd>
<dt>Draft -03</dt>
<dd>Fixed typos and added reference to "IPv6 UDP
          Checksum Considerations"
</dd>
<dt>Issues </dt>
<dd>
<ul class="text">
<li>More detailed analysis of the UDP cksum==0 case could be
              added
</li>
</ul>
</dd>
</dl></blockquote>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Godred Fairhurst</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">University of Aberdeen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">School of Engineering</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Aberdeen, AB24 3UE,   </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Scotland, UK</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:gorry@erg.abdn.ac.uk">gorry@erg.abdn.ac.uk</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.erg.abdn.ac.uk/users/gorry">http://www.erg.abdn.ac.uk/users/gorry</a></td></tr>
</table>
</body></html>
