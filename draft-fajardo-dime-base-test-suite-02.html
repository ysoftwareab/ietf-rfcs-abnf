<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Diameter Base Protocol Interoperability Test
      Suite</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Diameter Base Protocol Interoperability Test
      Suite">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">DIME</td><td class="header">V. Fajardo</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Telcordia Technologies</td></tr>
<tr><td class="header">Expires: January 14, 2010</td><td class="header">A. McNamee</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Openet-Telecom</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">H. Tschofenig</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Nokia Siemens Networks</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">J. Bournelle</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">France Telecom R&amp;D</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">July 13, 2009</td></tr>
</table></td></tr></table>
<h1><br />Diameter Base Protocol Interoperability Test
      Suite<br />draft-fajardo-dime-base-test-suite-02.txt</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on January 14, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p> This document describes a collection of test cases to be used for Diameter base protocol
        interoperability testing. 
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<a href="#sec-base">3.</a>&nbsp;
Diameter Base Protocol Test Suite<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-base-req">3.1.</a>&nbsp;
Required<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-base-req-conn">3.1.1.</a>&nbsp;
Connectivity and Peering<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-base-req-route">3.1.2.</a>&nbsp;
Routing<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-base-req-agent">3.1.3.</a>&nbsp;
Relay Agent<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-base-req-agent1">3.1.4.</a>&nbsp;
Redirection Agent<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-base-optional">3.2.</a>&nbsp;
Optional<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-base-opt-conn1">3.2.1.</a>&nbsp;
General Statemachine<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-base-opt-conn2">3.2.2.</a>&nbsp;
Dynamic Peer Discovery<br />
<a href="#sec-app">4.</a>&nbsp;
Diameter Base Protocol Application Support<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-app-cmn-req-auth">4.1.</a>&nbsp;
Authentication and/or Authorization<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-app-cmn-req-auth1">4.1.1.</a>&nbsp;
Stateful Session<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-app-cmn-req-auth2">4.1.2.</a>&nbsp;
Stateless Session<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-app-cmn-req-acct">4.2.</a>&nbsp;
Accounting<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-app-cmn-req-acct1">4.2.1.</a>&nbsp;
Client Session<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-app-cmn-req-acct2">4.2.2.</a>&nbsp;
Server Session<br />
<a href="#section-security-considerations">5.</a>&nbsp;
Security Considerations<br />
<a href="#anchor3">6.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">7.</a>&nbsp;
Normative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> The document is meant to aid in the identifying the functional test cases of a Diameter
        implementation. The Diameter interoperability test suites are categorized by required and
        optional functionality. The required functionality is the baseline capability that an
        implementation must support to allow basic interoperability for that category. Optional
        functionality covers features that not all implementations support or may wish to test. This
        document also covers test suites for common application support provided by the diameter
        base protocol. 
</p>
<p> At its current state, this document provides only a collection of test cases designed for
        interoperability. Test plans may be included in future revisions of this work or maybe
        provided in some other document. 
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p> The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD
        NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as
        described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>. 
</p>
<p> Within this document the terms defined in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> refer to the
        functionality that has to be provided by an implementation for the usage within this
        interoperability test document. 
</p>
<a name="sec-base"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Diameter Base Protocol Test Suite</h3>

<p> All implementation must conform to <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. 
</p>
<a name="sec-base-req"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Required</h3>

<a name="sec-base-req-conn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
Connectivity and Peering</h3>

<p> Implementations must conform to Section 5.6 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. Typical test
            topology for statemachine test uses peer pairs as shown in <a class='info' href='#fig-peer-fsm-01'>Figure&nbsp;1<span> (</span><span class='info'>Peer Statemachine Test Topology</span><span>)</span></a>. It is left to the testers if one-to-many or many-to-one
            connections will be performed to test scalability and loading. The test cases described
            below references <a class='info' href='#fig-peer-fsm-01'>Figure&nbsp;1<span> (</span><span class='info'>Peer Statemachine Test Topology</span><span>)</span></a> below. <br /><hr class="insert" />
<a name="fig-peer-fsm-01"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      +--------+                   +--------+
      |Vendor A|&lt;---wired link----&gt;|Vendor B|
      +--------+                   +--------+

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Peer Statemachine Test Topology&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

          
</p>
<a name="sec-base-req-conn1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.1"></a><h3>3.1.1.1.&nbsp;
Capabilities Negotiation</h3>

<p> Implementations must be able to perform at least the following behavior described in
              Section 5.3 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. </p>
<ul class="text">
<li> Positive test for establishment of connection with test pairs advertising
                  support for common application ids (auth, accounting or vendor). Vendor A
                  initiates transport connection to B and trigger the process. 
</li>
<li> Positive test for establishment of connection with test pairs of which one of
                  them is advertising support for only relay app and no other app is in common. 
</li>
<li> Positive test for establishment of connection advertising the relay app in auth
                  app id, acct app id &amp; VSA. 
</li>
<li> Positive test for establishment of connection with test pairs advertising
                  support common transport security, specifically the use of TLS and/or IPSec. It is
                  left up to the participants to generate appropriate keys and certificates specific
                  for this test. Vendor A initiates transport connection to B and trigger the
                  process and advertised proper Inband-Security support. 
</li>
<li> Positive test for DWR/DWA exchange after connection is established. Vendor A and
                  B both exchange watchdogs as per Section 3.4.1 of <a class='info' href='#RFC3539'>[RFC3539]<span> (</span><span class='info'>Aboba, B. and J. Wood, &ldquo;Authentication, Authorization and Accounting (AAA) Transport Profile,&rdquo; June&nbsp;2003.</span><span>)</span></a>. 
</li>
<li> Negative test where DIAMETER_NO_COMMON_APPLICATION is returned by a peer with no
                  common application id (auth, accounting or vendor). Intentionally configure vendor
                  A not to advertise any applications, different applications than B or vendor id's
                  known only to A. 
</li>
<li> Negative test where DIAMETER_NO_COMMON_SECURITY is returned by a peer with no
                  common application id. Intentionally configure vendor A to send
                  Inband-Security-AVP with value 1 (TLS) that B will not support. 
</li>
<li> Negative test for unknown peers. Use of DIAMETER_UNKNOWN_PEER or silent discard
                  to disconnect unknown peers. Intentionally configure vendor A to send an
                  origin-host that is not in B's peer table. 
</li>
<li> Negative test case for TLS handshake failure. In the case where the negotiated
                  Inband-Security involves subsequent TLS negotiation, participants can simulate a
                  TLS handshake failure (i.e. via invalid certificates, TLS/SSL version mis-match
                  etc) that must result in the peers being disconnected. 
</li>
</ul><p> Verification of each test result can be done manually. 
</p>
<a name="sec-base-req-conn2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.2"></a><h3>3.1.1.2.&nbsp;
Election</h3>

<p> This test case refers to Section 5.6.4 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. Responders must
              be able to resolve contention with initiator peers. </p>
<ul class="text">
<li> Positive test for establishment of connection with responder having higher
                  identity than initiator. Vendor A initiates connection followed by B doing the
                  same a few milliseconds later. Vendor A having a higher identity should close B's
                  connection attempt. 
</li>
<li> Positive test for disconnection with initiator having lower identity than the
                  responder. Vendor A initiates a connection followed by B doing the same a few
                  milliseconds later. Vendor A having a lower identity should close its initial
                  connection attempt. 
</li>
<li> Negative test for disconnection when initiator and responder have equal
                  identity. Vendor A and B will advertise the equal identity. Verify that both peers
                  closed the connection. 
</li>
</ul><p> Verification of test results can be done manually. 
</p>
<a name="sec-base-req-conn3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.3"></a><h3>3.1.1.3.&nbsp;
Disconnection</h3>

<p> Implementations must conform to Section 5.6.4 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> and
              Section 3.4.1 of <a class='info' href='#RFC3539'>[RFC3539]<span> (</span><span class='info'>Aboba, B. and J. Wood, &ldquo;Authentication, Authorization and Accounting (AAA) Transport Profile,&rdquo; June&nbsp;2003.</span><span>)</span></a>. Peers must be able to quickly determine
              disconnection events. Verification of test results can be done manually. </p>
<ul class="text">
<li> Positive test for peer disconnection using DPR/DPA exchange. Vendor A initiates
                  shutdown while connected to B. Implementations behavior may vary depending on
                  disconnection cause such as an eventual connection retry if a disconnection cause
                  of REBOOTING is received. 
</li>
<li> Positive test for detecting disconnection via system level events (i.e.,
                  transport resets, socket error, system link-down signals, etc). Implementation
                  must be able to initiate failover procedure. Implementation should also attempt
                  re-connection with lost peer. Hard disconnection of vendor A and B's wired link
                  can be done to simulate this scenario. 
</li>
<li> Positive test for detecting disconnection via watchdog timeout. If there is no
                  activity after a watchdog timer expires with pending request then the peer becomes
                  suspect and implementation must be able to initiate failover procedure. <a class='info' href='#RFC3539'>[RFC3539]<span> (</span><span class='info'>Aboba, B. and J. Wood, &ldquo;Authentication, Authorization and Accounting (AAA) Transport Profile,&rdquo; June&nbsp;2003.</span><span>)</span></a> suggest a minimum watchdog timeout at 6 sec. Vendor B can
                  setup a transport level filter to silently drop AAA traffic from B to simulate
                  unresponsiveness of B. 
</li>
<li> Positive test for resetting connection after at least two(2) watchdog has
                  expired. If a connection is already suspect, the peers must reset the connection.
                  Vendor A or B can setup a transport level filter to silently drop AAA traffic and
                  simulate unresponsiveness of both peers. 
</li>
</ul><p> Verification of test results can be done manually. 
</p>
<a name="sec-base-req-conn4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.4"></a><h3>3.1.1.4.&nbsp;
Re-Connection Algorithms</h3>

<p> Implementations must conform to Section 2.1 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. Although a
              vendor can implement other algorithms and policies than those proposed in <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>, a default reconnection scheme must be implemented. </p>
<ul class="text">
<li> Positive test for peer re-connection after disconnection has been detected. The
                  link between vendor A and B is temporarily disconnected until such time that
                  disconnection is detected by both peers. The link can then be restored to test the
                  re-connection behavior of both peers. Verify that at least three(3) watchdog
                  exchanges occur before both peers are no longer suspect. 
</li>
</ul><p>
            
</p>
<a name="sec-base-req-conn5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.5"></a><h3>3.1.1.5.&nbsp;
Failover and Failback</h3>

<p> Implementations must conform to Section 5.4.5 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> and
              Section 3.4.2 of <a class='info' href='#RFC3539'>[RFC3539]<span> (</span><span class='info'>Aboba, B. and J. Wood, &ldquo;Authentication, Authorization and Accounting (AAA) Transport Profile,&rdquo; June&nbsp;2003.</span><span>)</span></a>. Testing failover mechanism requires
              alternate peer connections. A basic ring topology to test failover and failback is
              shown in <a class='info' href='#fig-peer-fsm-02'>Figure&nbsp;2<span> (</span><span class='info'>Failover Test Topology</span><span>)</span></a> where vendor A has a primary route to vendor
              C via vendor B and secondary route via vendor D. The same symmetry is applied to all
              other vendors. As an example, vendor C has a symmetric topology where D is its primary
              connection and B is its secondary. This allows the same tests to be performed for all
              vendors. For testing failover on vendor A and B, link0 can be disconnected. For vendor
              C and D, link2 can be disconnected and so on. <br /><hr class="insert" />
<a name="fig-peer-fsm-02"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                   +---------+
                   |Vendor B |
                   +---------+
                  /           \
               link0         link3
     +---------+/               \+---------+
     |Vendor A |                 |Vendor C |
     +---------+\               /+---------+
               link1         link2
                  \+---------+/
                   |Vendor D |
                   +---------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Failover Test Topology&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
 The enumerated test cases refers only to vendor A but can be applied to any
              of the vendor implementations in <a class='info' href='#fig-peer-fsm-02'>Figure&nbsp;2<span> (</span><span class='info'>Failover Test Topology</span><span>)</span></a>. Conditions for a
              positive test requires that realm routes to C is present in A and host routing is not
              used. Initial traffic should flow from A to C via B (as the primary peer of A). </p>
<ul class="text">
<li> Positive test for failover when link0 is disconnected. Vendor A should have
                  pending requests queued prior to disconnection. Upon disconnection (see <a class='info' href='#sec-base-req-conn3'>Section&nbsp;3.1.1.3<span> (</span><span class='info'>Disconnection</span><span>)</span></a>), verify that the pending request with T-flag set
                  has been forwarded to C via D. 
</li>
<li> Positive test for failover by using device watchdog as a means of triggering
                  link0 disconnection. Vendor A should have pending requests queued prior to
                  disconnection. Upon disconnection (see <a class='info' href='#sec-base-req-conn3'>Section&nbsp;3.1.1.3<span> (</span><span class='info'>Disconnection</span><span>)</span></a>),
                  verify that the pending request with T-flag set has been forwarded to C via D. 
</li>
<li> Positive test for failback when link0 is restored and re-connection succeeds
                  (See <a class='info' href='#sec-base-req-conn4'>Section&nbsp;3.1.1.4<span> (</span><span class='info'>Re-Connection Algorithms</span><span>)</span></a>). Verify that new request message is
                  routed back to B. 
</li>
<li> Negative test to generate DIAMETER_UNABLE_TO_DELIVER on answer message from B to
                  A when Destination-Host is set to C. This can be simulated when link3 is
                  disconnected and Vendor C is not reachable from Vendor. Note that alternate path
                  via Vendor D should not be used. 
</li>
<li> Negative test to detect duplicate messages on C. Vendor B can disable watchdog
                  processing but still allow request message forwarding. This makes B a suspect peer
                  from A and trigger failover procedure. Forwarding of queue request will then be
                  done through D. However, the original request messages would have reached C via B.
                
</li>
</ul><p>
            
</p>
<a name="sec-base-req-route"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2"></a><h3>3.1.2.&nbsp;
Routing</h3>

<p> Implementation must conform to Section 6 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. A basic topology
            to test Diameter routing is shown in <a class='info' href='#fig-routing-01'>Figure&nbsp;3<span> (</span><span class='info'>Routing Test Topology</span><span>)</span></a> where vendor A and
            vendor B can deploy two(2) Diameter peers to test host, realm and answer message
            routing. Vendor A1 and A2 shares the same realm (realmA). Vendor B1 and B2 share a
            different realm (realmB). Test between both realms are symmetric although the
            description focuses mostly to vendor A for editorial reasons. The topology is also
            designed so that multi-hop forwarding, message loopback and agent configuration can be
            tested. Note that some test cases in this section require link disconnection overlap
            with the test cases outline in <a class='info' href='#sec-base-req-conn3'>Section&nbsp;3.1.1.3<span> (</span><span class='info'>Disconnection</span><span>)</span></a>. An implementation
            experiencing link disconnection must update its peer and realm route table accordingly.
            Verification for usage of proper routing AVPs in Section 6.7 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>
            must be done when testing routing functionality. <br /><hr class="insert" />
<a name="fig-routing-01"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                   +---------+
                   |Vendor A2| (realmA)
                   +---------+
                  /     |     \
      (realmA) link1    |    link2
     +---------+/       |       \+---------+
     |Vendor A1|      link0      |Vendor B2| (realmB)
     +---------+\       |       /+---------+
               link4    |    link3
                  \+---------+/
                   |Vendor B1|
                   +---------+
                    (realmB)

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Routing Test Topology&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

          
</p>
<a name="sec-base-req-route1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2.1"></a><h3>3.1.2.1.&nbsp;
Peer Based Request Routing</h3>

<p> Implementation must conform to Section 6.1.5 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. In order
              to perform the test cases the peer requesting the AAA routing must have the
              destination-host and the destination-realm present in the request message. </p>
<ul class="text">
<li> Positive test for request forwarding from originator. Request messages generated
                  from A1 should reach B2 via B1 if destination-host of the request is B2 and
                  destination-realm is realmB and all links are up. A1 must perform realm routing to
                  reach B1 and B1 must perform forwarding to reach B2. Verification of routing can
                  be done manually if message has reached B2 via link4 and link3. 
</li>
<li> Positive test for multi-hop request forwarding. Request messages generated from
                  A1 with destination-host B2 and destination-realm realmB should reach B2 via A2
                  and B1 if all links are up except for link4 and link2. A1 and A2 must perform
                  realm routing while B1 performs forwarding. A1 and A2 must be able to route the
                  request message to B1 even if it does not have B2 in its peer table. Verification
                  of routing can be done manually if message has reached B2 via link1, link0 and
                  link3. 
</li>
<li> Negative test for request forwarding. If a request message generated from A1 has
                  a destination-host B2 and destination-realm realmB with all links up except for
                  link0, link2 and link4 then A2 must send an answer message to A1 with result-code
                  DIAMETER_UNABLE_TO_DELIVER. Verification can be done manually if the answer
                  message has reached A1 with E-bit set. 
</li>
</ul><p>
            
</p>
<a name="sec-base-req-route2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2.2"></a><h3>3.1.2.2.&nbsp;
Realm Based Routing</h3>

<p> Implementation must conform to Section 6.1 and Section 6.1.6 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. Test cases for realm-based request routing must have
              destination-realm present but must not have destination-host present in the request
              message. Note that there is some test overlap with the test cases defined in <a class='info' href='#sec-base-req-route1'>Section&nbsp;3.1.2.1<span> (</span><span class='info'>Peer Based Request Routing</span><span>)</span></a>. </p>
<ul class="text">
<li> Positive test for request routing from originator. Request messages generated
                  from A1 should reach B2 via B1 if the destination-realm is realmB and all links
                  are up. A1 and B1 must perform realm routing to reach B2. The request must have an
                  id (app, auth or vendor) that B1 must route and B2 must process locally.
                  Verification of routing can be done manually if message has reached B2 via link4
                  and link3. 
</li>
<li> Positive test for multi-hop request routing. Request messages generated from A1
                  with destination-realm realmB should reach B2 via A2 and B1 if all links are up
                  except for link4 and link2. A1, A2 and B1 must perform realm routing. The request
                  must have an id (app, auth or vendor) that A1, A2 and B1 must route and B2 must
                  process locally. Verification of routing can be done manually if message has
                  reached B2 via link1, link0 and link3. 
</li>
<li> Negative test for request routing. If a request message generated from A1 has a
                  destination-realm realmB with all links up except for link0, link2 and link4 then
                  A2 must send an answer message to A1 with result-code DIAMETER_UNABLE_TO_DELIVER.
                  Verification can be done manually if the answer message has reached A1 with E-bit
                  set. 
</li>
</ul><p>
            
</p>
<a name="sec-base-req-route3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2.3"></a><h3>3.1.2.3.&nbsp;
Answer Message Routing</h3>

<p> Implementations must conform to Section 6.2 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. Answer
              routing can be verified using test cases in <a class='info' href='#sec-base-req-route1'>Section&nbsp;3.1.2.1<span> (</span><span class='info'>Peer Based Request Routing</span><span>)</span></a> and
                <a class='info' href='#sec-base-req-route2'>Section&nbsp;3.1.2.2<span> (</span><span class='info'>Realm Based Routing</span><span>)</span></a>. 
</p>
<a name="sec-base-req-route4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2.4"></a><h3>3.1.2.4.&nbsp;
Loop Detection</h3>

<p> Implementation must conform to Section 6.1.3 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. All
              forwarders must verify that their local identity is not present in the route-record of
              the request. If it is present, the forwarder must send an answer with result-code
              DIAMETER_LOOP_DETECTED. If it is not present, implementations must also insert
              route-records into the request messages. </p>
<ul class="text">
<li> Positive test for loop detection can be done if a request originating from A1
                  has a destination-realm realmA and A1 is configure to route request for realmA to
                  A2, A2 will route request for realmA to B1 and B1 will route request back to A1.
                  Though A1 originated the request, it must be able to send an answer message with
                  the E-bit set through the request path. 
</li>
</ul><p>
            
</p>
<a name="sec-base-req-agent"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.3"></a><h3>3.1.3.&nbsp;
Relay Agent</h3>

<p> Implementations must conform to Section 2.8.1, 6.1.8 and 6.2.2 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. The topology shown in <a class='info' href='#fig-routing-01'>Figure&nbsp;3<span> (</span><span class='info'>Routing Test Topology</span><span>)</span></a> is also used
            for testing relay agent functionality. Note that an overlap exists with the test case
            described in <a class='info' href='#sec-base-req-route'>Section&nbsp;3.1.2<span> (</span><span class='info'>Routing</span><span>)</span></a> when testing relay agents and those
            test cases should be used here as well. Verification for usage of routing AVPs in
            Section 6.7 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> must be done when testing agent functionality.
            Testing of proxy agents that keep vendor specific state, such as proxy-info,
            proxy-state, proxy-host, is out of scope of this document and can be done in parallel or
            independent of the test cases enumerated here. 
</p>
<a name="sec-base-req-agent1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.4"></a><h3>3.1.4.&nbsp;
Redirection Agent</h3>

<p> Implementation must conform to Section 6.1.7 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. Verification
            can be made by inspecting the redirect answer message whether the result-code is set to
            DIAMETER_REDIRECT_INDICATION with the E-bit enabled and redirect-hosts added. </p>
<ul class="text">
<li> Positive test for redirection. Request messages generated from A1 should reach B2
                via B1 using redirect from A2 and all links are up except link0 and link2. A1 must
                be configured to forward request message for realmB/B2 via A2. A2 must be configured
                to act as a redirect agent and signal a redirect indication to A1 to use B1 instead.
                Verification of redirection can be done manually if messages have reached B2 and
                re-direct indication was processed by A1. 
</li>
</ul><p>
          
</p>
<a name="sec-base-optional"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Optional</h3>

<p> Implementations must conform to Section 5.6 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. Test topology
          uses <a class='info' href='#fig-peer-fsm-01'>Figure&nbsp;1<span> (</span><span class='info'>Peer Statemachine Test Topology</span><span>)</span></a>. This section describes optional test cases.
</p>
<a name="sec-base-opt-conn1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
General Statemachine</h3>

<p> Implementations must conform to Section 5.6.1 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. The same
            topology in <a class='info' href='#fig-peer-fsm-01'>Figure&nbsp;1<span> (</span><span class='info'>Peer Statemachine Test Topology</span><span>)</span></a> can be used to perform the test scenarios
            listed in this section. </p>
<ul class="text">
<li> Negative test for non-CEA message received during CER/CEA exchange. Silent discard
                and peer disconnection. Vendor B can initiate a non Diameter server listening on a
                Diameter defined port number to simulate unrecognizable messages from vendor B. Or
                the AAA peer of vendor B is modified to generate a non-CEA message once a transport
                connection setup has been initiated. Verify that vendor A has closed the connection.
              
</li>
</ul><p>
          
</p>
<a name="sec-base-opt-conn2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2"></a><h3>3.2.2.&nbsp;
Dynamic Peer Discovery</h3>

<p> Implementations must conform to Section 5.3 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>.
            Implementations must be able to perform at least the following behavior. </p>
<ul class="text">
<li> Positive test for establishment of connection with unknown peer. The topology for
                this test is <a class='info' href='#fig-peer-fsm-01'>Figure&nbsp;1<span> (</span><span class='info'>Peer Statemachine Test Topology</span><span>)</span></a>. Test case is dependent on
                implementation accepting dynamic peer table updates. In such case, lifetime of new
                peer entry should be check against lifetime of connection. Intentionally configure
                vendor A to send an origin-host that is not in B's peer table. Verification of
                result can be done manually by inspecting the resulting peer table of B. 
</li>
<li> Positive test after redirection (<a class='info' href='#sec-base-req-agent1'>Section&nbsp;3.1.4<span> (</span><span class='info'>Redirection Agent</span><span>)</span></a>). The
                topology for this test is <a class='info' href='#fig-routing-01'>Figure&nbsp;3<span> (</span><span class='info'>Routing Test Topology</span><span>)</span></a>. Additional verification
                can be done if <a class='info' href='#sec-base-req-agent1'>Section&nbsp;3.1.4<span> (</span><span class='info'>Redirection Agent</span><span>)</span></a> is successful. Redirect-host
                routes can be cached by an implementation as a new route entry. Same scenarios as in
                the redirect test case except subsequent request messages will be forwarded to B1 by
                A1. Verify that only the initial message results in a redirect process. 
</li>
</ul><p>
          
</p>
<a name="sec-app"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Diameter Base Protocol Application Support</h3>

<a name="sec-app-cmn-req-auth"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Authentication and/or Authorization</h3>

<p> Applications intending to use authentication and/or authorization must conform to the
          statemachine specification in Section 8.1 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. Since these test
          cases are session level, any topology can be used by a pair of vendors performing
          interoperability. The minimum topology will be based on <a class='info' href='#fig-peer-fsm-01'>Figure&nbsp;1<span> (</span><span class='info'>Peer Statemachine Test Topology</span><span>)</span></a>.
          Note that majority of these test are performed as part of other Diameter application test
          cases. Therefore, implementations must be able to comply with these common cases. 
</p>
<a name="sec-app-cmn-req-auth1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1"></a><h3>4.1.1.&nbsp;
Stateful Session</h3>

<p> Implementations must conform to Section 8.1 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>.
            Implementations must be able to perform at least the following behavior. </p>
<ul class="text">
<li> Positive test for proper stateful session establishment. Verify that
                auth-session-state with STATE_MAINTAINED is enforced in the client session. Verify
                that auth-session-lifetime and auth-session-grace-period are negotiated properly and
                enforced between vendor implementations. Must conform to Section 8.4 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. 
</li>
<li> Positive test for proper stateful session re-auth. Verify server initiated RAR/RAA
                exchange occurs on auth-lifetime and auth-grace period expiration. Must conform to
                Section 8.3 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. 
</li>
<li> Positive test for proper stateful session disconnection. Verify client initiated
                STR/STA exchange occurs for auth failure and session timeout. Verify values of
                auth-lifetime and auth-grace period against session-lifetime according to Section
                8.9 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. Verify application id value carried by the STR/STA
                message is that of the target application. 
</li>
<li> Positive test for proper stateful session disconnection. Verify server initiated
                ASR/ASA exchange occurs when server decides to discontinue service. Implementations
                that allow for hard session termination should be able to perform these tests. Must
                conform to Section 8.5 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. Verify application id value
                carried by the STR/STA message is that of the target application. 
</li>
<li> Positive test for proper stateful session disconnection using origin-state-id.
                Verify a vendor implementation can at least cleanup stateful sessions once it has
                received a value of origin-state-id greater than a previously known value from the
                same issuer. Verification can be done in the absence of an STR/STA exchange. Must
                conform to Section 8.6 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. 
</li>
</ul><p>
          
</p>
<a name="sec-app-cmn-req-auth2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2"></a><h3>4.1.2.&nbsp;
Stateless Session</h3>

<p> Implementations must conform to Section 8.1 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>.
            Implementations must be able to perform at least the following behavior. </p>
<ul class="text">
<li> Positive test for proper stateless session establishment. Verify that
                auth-session-state negotiation between vendor implementation with
                NO_STATE_MAINTAINED is enforced in the client session. 
</li>
<li> Positive test for proper stateless session disconnection. Verify that
                session-lifetime is enforced in the client session. 
</li>
</ul><p>
          
</p>
<a name="sec-app-cmn-req-acct"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Accounting</h3>

<p> Applications intending to use Diameter accounting may conform to Section 8.2 and 9 of
            <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> if the particular application has not already defined its own
          statemachine. Since these test cases are also session level, any topology can be used by a
          pair of vendors performing interoperability. The minimum topology will be based on <a class='info' href='#fig-peer-fsm-01'>Figure&nbsp;1<span> (</span><span class='info'>Peer Statemachine Test Topology</span><span>)</span></a>. Note that majority of these test are performed as part of
          other Diameter application test cases. Therefore, implementations must be able to comply
          with these common cases. 
</p>
<a name="sec-app-cmn-req-acct1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Client Session</h3>

<p> Implementations must conform to Section 8.2 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>.
            Implementations must be able to perform at least the following behavior. Verification of
            test results for these cases can be done manually. </p>
<ul class="text">
<li> Positive test for proper client session establishment. Verify that sub-session id
                is supported and that the client can support event record generation at the least.
                Verify that the client should at least be able to support DELIVER_AND_GRANT. Test
                entities must be able to configure their server implementation to send this avp.
                Must conform to Section 9.4 and 9.8.7 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. 
</li>
<li> Positive test for proper client session termination. Verify that session
                termination causes transmission of stop record events if any and that all records
                generated are accounted for. Validation of accounting records can be Diameter
                application specific and is left to the tester to confirm. 
</li>
<li> Negative test for client session when server reports a failure. Verify that client
                session can cope wistatemachine draft submissionth failed accounting starts or
                server storage failure and act accordingly based on Section 8.2 <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. Behavior of the client can be policy and implementation
                specific and is left to the tester to confirm. Failed accounting starts and storage
                failures can be simulated by mis-configuration of the server test peer. 
</li>
<li> Negative test for client session when connectivity fails. Verify that client
                session can cope with connectivity failure and act accordingly based on Section 9.4
                  <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. The test can overlap with <a class='info' href='#sec-base-req-conn3'>Section&nbsp;3.1.1.3<span> (</span><span class='info'>Disconnection</span><span>)</span></a> and <a class='info' href='#sec-base-req-conn5'>Section&nbsp;3.1.1.5<span> (</span><span class='info'>Failover and Failback</span><span>)</span></a>. 
</li>
</ul><p>
          
</p>
<a name="sec-app-cmn-req-acct2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Server Session</h3>

<p> Implementations must conform to Section 8.2 and 9 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>.
            Implementations must be able to perform at least the following behavior. Verification of
            test results for these cases can be done manually. Since server sessions must support
            record storage it is left to the testers to validate storage (Section 9.5 <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>), sequencing and co-relation (Section 9.6 <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>)
            of records. </p>
<ul class="text">
<li> Positive test for proper server session establishment. Verify that sub-session id
                is supported and that the server enforces record generation on the client based on
                accounting-record-type. Verify that supervision timer is enforced when using
                stateful sessions. Must conform to Section 9.5 of <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. 
</li>
<li> Positive test for proper server session termination. Verify that expiration of
                supervision timer in a stateful session terminates both client and server session on
                any vendor implementation. 
</li>
<li> Negative test for server session when local storage failure occurs. Verify that
                server can notify client of its state and act accordingly based on Section 8.2 of
                  <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>. Validation is policy and implementation specific and is
                left to the tester to confirm. Storage failure can be simulated by mis-configuration
                on the server test peer. This test is mostly a local validation but it can be used
                in parallel with <a class='info' href='#sec-app-cmn-req-acct1'>Section&nbsp;4.2.1<span> (</span><span class='info'>Client Session</span><span>)</span></a>. 
</li>
</ul><p>
          
</p>
<a name="section-security-considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p> This document defines test cases and therefore tests various aspects of the Diameter base
        specification and various Diameter applications. 
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p> This document does not require actions by IANA. 
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3539">[RFC3539]</a></td>
<td class="author-text">Aboba, B. and J. Wood, &ldquo;<a href="http://tools.ietf.org/html/rfc3539">Authentication, Authorization and Accounting (AAA) Transport Profile</a>,&rdquo; RFC&nbsp;3539, June&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3539.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3588">[RFC3588]</a></td>
<td class="author-text">Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>,&rdquo; RFC&nbsp;3588, September&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3588.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Victor Fajardo</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Telcordia Technologies</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1 Telcordia Drive #1S-222</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Piscataway, NJ  08854</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:vfajardo@research.telcordia.com">vfajardo@research.telcordia.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Alan McNamee</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Openet Telecom Inc</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">6 Beckett Way, Park West Business Park</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Clondalkin, Dublin  12</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ireland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+353 1 620 4600</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:alan.mcnamee@openet-telecom.com">alan.mcnamee@openet-telecom.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hannes Tschofenig</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia Siemens Networks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Linnoitustie 6</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Espoo  02600</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+358 (50) 4871445</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Hannes.Tschofenig@gmx.net">Hannes.Tschofenig@gmx.net</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.tschofenig.priv.at">http://www.tschofenig.priv.at</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Julien Bournelle</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France Telecom R&amp;D</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">38-4O rue du general Leclerc</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Issy-Les-Moulineaux  92794</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:julien.bournelle@orange-ftgroup.com">julien.bournelle@orange-ftgroup.com</a></td></tr>
</table>
</body></html>
