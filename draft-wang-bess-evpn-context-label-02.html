<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Context Label for MPLS EVPN</title>
<meta content="Yubao Wang" name="author">
<meta content="Bing Song" name="author">
<meta content="
       EVPN is designed to provide a better VPLS service than   and [RFC4762], and EVPN indeed introduced many new features which couldn't be achieved in those old VPLS implementions. But EVPN didn't inherit all features of old VPLS, and a few issues arises for EVPN only. 
       Some of these issues can be imputed to the MP2P nature of EVPN labels. The PW label in old VPLS is a label for P2P VC, so it contains more context than a identifier in dataplane for it's VSI instance.But the EVPN label just identifies it's VSI instnace and it can't stand for the ingress PE in dataplane. So the following issues arises with MPLS EVPN service: 
       
         MPLS EVPN statistics can't be done per ingress PE. 
         MPLS EVPN can't support hub/spoke use case which the spoke PE can only connect to each other by the hub PE. 
         MPLS EVPN can't support AR REPLICATOR. 
         MPLS EVPN can't support anycast SR-MPLS tunnel on the SPE nodes. 
       
       This document introduces a compound label stack to take advantage of both P2P VC and MP2P evpn labels. 
    " name="description">
<meta content="xml2rfc 2.45.3" name="generator">
<meta content="EVPN, Context, Label, VC" name="keyword">
<meta content="draft-wang-bess-evpn-context-label-02" name="ietf.draft">
<link href="/tmp/draft-wang-bess-evpn-context-label-02-4r8l3mm2.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Avoid wrapping of URLs in references */
@media screen {
  .references a {
    white-space: nowrap;
  }
}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">EVPN Context Label</td>
<td class="right">June 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Wang &amp; Song</td>
<td class="center">Expires 12 December 2020</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">BESS WG</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-06-10" class="published">10 June 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2020-12-12">12 December 2020</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">Y. Wang</div>
<div class="org">ZTE Corporation</div>
</div>
<div class="author">
      <div class="author-name">B. Song</div>
<div class="org">ZTE Corporation</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Context Label for MPLS EVPN</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">EVPN is designed to provide a better VPLS service than <span>[<a href="#RFC4761" class="xref">RFC4761</a>]</span> and [RFC4762], and EVPN indeed introduced many new features which couldn't be achieved in those old VPLS implementions. But EVPN didn't inherit all features of old VPLS, and a few issues arises for EVPN only.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">Some of these issues can be imputed to the MP2P nature of EVPN labels. The PW label in old VPLS is a label for P2P VC, so it contains more context than a identifier in dataplane for it's VSI instance.But the EVPN label just identifies it's VSI instnace and it can't stand for the ingress PE in dataplane. So the following issues arises with MPLS EVPN service:<a href="#section-abstract-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-abstract-3.1">MPLS EVPN statistics can't be done per ingress PE.<a href="#section-abstract-3.1" class="pilcrow">¶</a>
</li>
<li class="normal" id="section-abstract-3.2">MPLS EVPN can't support hub/spoke use case which the spoke PE can only connect to each other by the hub PE.<a href="#section-abstract-3.2" class="pilcrow">¶</a>
</li>
<li class="normal" id="section-abstract-3.3">MPLS EVPN can't support AR REPLICATOR.<a href="#section-abstract-3.3" class="pilcrow">¶</a>
</li>
<li class="normal" id="section-abstract-3.4">MPLS EVPN can't support anycast SR-MPLS tunnel on the SPE nodes.<a href="#section-abstract-3.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-abstract-4">This document introduces a compound label stack to take advantage of both P2P VC and MP2P evpn labels.<a href="#section-abstract-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 12 December 2020.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-terminology-and-acronyms" class="xref">Terminology and Acronyms</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-problem-statement" class="xref">Problem Statement</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-using-vc-label-to-add-conte" class="xref">Using VC Label to Add Context Data to EVPN Flows</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1" class="keepWithNext"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-the-shared-context-vcs" class="xref">The Shared Context VCs</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-the-per-evi-context-vcs" class="xref">The per-EVI Context VCs</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-signalling-for-shared-conte" class="xref">Signalling for Shared Context VCs</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-kompella-signalling-for-con" class="xref">Kompella Signalling for Context VC</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-sr-mpls-signalling-for-csl-" class="xref">SR-MPLS signalling for CSL-based Context VC</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-signalling-for-per-evi-cont" class="xref">Signalling for per-EVI Context VCs</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-construct-leaf-a-d-route-fo" class="xref">Construct Leaf A-D Route for IR</a><a href="#section-toc.1-1.5.2.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="xref">5.1.1</a>.  <a href="#name-advertising-per-platform-vc" class="xref">Advertising Per-platform VC Label</a><a href="#section-toc.1-1.5.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="xref">5.1.2</a>.  <a href="#name-advertising-context-specifi" class="xref">Advertising Context-Specific VC label</a><a href="#section-toc.1-1.5.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-establish-ingress-replicati" class="xref">Establish Ingress Replication List by Leaf A-D Route</a><a href="#section-toc.1-1.5.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-backward-compatibility" class="xref">Backward Compatibility</a><a href="#section-toc.1-1.5.2.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-solutions" class="xref">Solutions</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-solution-for-source-squelch" class="xref">Solution for Source-Squelching in Hub-Spoke Scenarios</a><a href="#section-toc.1-1.6.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-solution-for-per-ingress-st" class="xref">Solution for per ingress statistics</a><a href="#section-toc.1-1.6.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-solution-for-ar-replicator-" class="xref">Solution for AR REPLICATOR in MPLS EVPN</a><a href="#section-toc.1-1.6.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-solution-for-anycast-tunnel" class="xref">Solution for anycast tunnel usage on SPE</a><a href="#section-toc.1-1.6.2.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.6.2.4.2.1">
                    <p id="section-toc.1-1.6.2.4.2.1.1"><a href="#section-6.4.1" class="xref">6.4.1</a>.  <a href="#name-control-plane" class="xref">Control-plane</a><a href="#section-toc.1-1.6.2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.6.2.4.2.2">
                    <p id="section-toc.1-1.6.2.4.2.2.1"><a href="#section-6.4.2" class="xref">6.4.2</a>.  <a href="#name-data-plane" class="xref">Data-plane</a><a href="#section-toc.1-1.6.2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-acknowledgements" class="xref">Acknowledgements</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.10.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.10.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty compact" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-appendix.a" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
</li>
</ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-terminology-and-acronyms">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-terminology-and-acronyms" class="section-name selfRef">Terminology and Acronyms</a>
      </h2>
<p id="section-1-1">
  This document uses the following acronyms and terms:<a href="#section-1-1" class="pilcrow">¶</a></p>
<ul class="ulEmpty normal">
<li class="ulEmpty normal" id="section-1-2.1">
   BUM - Broadcast, Unknown unicast, and Multicast.<a href="#section-1-2.1" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.2">
   CE - Customer Edge equipment.<a href="#section-1-2.2" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.3">
   PE - Provider Edge equipment.<a href="#section-1-2.3" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.4">
   OPE - Originating PE - the original Router of an EVPN route.<a href="#section-1-2.4" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.5">
   ORIP - Originating Router's IP address.<a href="#section-1-2.5" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.6">
   Root ORIP - The ORIP in the Route Key field of a Leaf A-D route is called as that Leaf A-D route's Root ORIP. 
               The Route Key field is the "Route Type specific" field of an PMSI route for which that Leaf A-D route is generated. 
    When that PMSI route is an IMET route, that Leaf A-D route's root ORIP is that IMET route's "Originating Router's IP Address".<a href="#section-1-2.6" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.7">
   Leaf ORIP - The "Originator's Addr" field of the "Route Type specific" field of a Leaf A-D route is called as that Leaf A-D route's Leaf ORIP.<a href="#section-1-2.7" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.8">
   Self ORIP - The Leaf ORIP of a Leaf A-D route is also called as that Leaf A-D route's "self ORIP".<a href="#section-1-2.8" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.9">
   PTA - PMSI Tunnel Attribute.<a href="#section-1-2.9" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.10">
   PTA label - The MPLS label field of PMSI Tunnel Attribute.<a href="#section-1-2.10" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.11">
   PTA flags - The flags field of PMSI Tunnel Attribute.<a href="#section-1-2.11" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.12">
   IR - Ingress Replication.<a href="#section-1-2.12" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.13">
   AR - Assisted Replication.<a href="#section-1-2.13" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.14">
   IR PTA - PMSI Tunnel Attribute with tunnel-type = IR.<a href="#section-1-2.14" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.15">
   AR PTA - PMSI Tunnel Attribute with tunnel-type = AR.<a href="#section-1-2.15" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.16">
   IRL - Ingress Replication List, the list for Ingress-Replication BUM packets forwarding.<a href="#section-1-2.16" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.17">
   LS - Label Space.<a href="#section-1-2.17" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.18">CL - Context Label, A "context label" is one label that 
   identifies a label table in which the label immediately below the
   context label should be looked up.  It is defined in <span>[<a href="#RFC5331" class="xref">RFC5331</a>]</span> section 3.<a href="#section-1-2.18" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.19">
   CLS - Context Label Space, a Label Space that is identified by a Context Label. 
         In <span>[<a href="#RFC5331" class="xref">RFC5331</a>]</span>, it is called as "Context-specific Label Space".<a href="#section-1-2.19" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.20">
   CLS ID - Context Label Space ID, which is defined in <span>[<a href="#I-D.ietf-bess-mvpn-evpn-aggregation-label" class="xref">I-D.ietf-bess-mvpn-evpn-aggregation-label</a>]</span>.<a href="#section-1-2.20" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.21">
   CSL - Context-Specific Label, a MPLS label that is allocated in a Context Label Space (CLS) which is identified by a CL.
         Note that a CSL is totally different from a CL. A CL itself is typically allocated in the per-platform label space.<a href="#section-1-2.21" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.22">
   CSL-Entry - Context-Specific Label Entry, a specific MPLS label allocated in a specific Context Label Space (CLS).<a href="#section-1-2.22" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.23">
   EVI - EVPN Instance.<a href="#section-1-2.23" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.24">
   EVPN label - The MPLS label in an EVPN route.<a href="#section-1-2.24" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.25">
   EVI label - A MPLS label identifies an EVPN Instance (EVI)<a href="#section-1-2.25" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.26">
   Admin EVI - A EVPN Instance (EVI) that is responsible for specific signalling work for other EVIs.<a href="#section-1-2.26" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.27">
   EC - Extended Community<a href="#section-1-2.27" class="pilcrow">¶</a>
</li>
<li class="ulEmpty normal" id="section-1-2.28">
   SR-TL - Segment Routing (SR) Tunnel Label (TL).<a href="#section-1-2.28" class="pilcrow">¶</a>
</li>
</ul>
</section>
<section id="section-2">
      <h2 id="name-problem-statement">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-problem-statement" class="section-name selfRef">Problem Statement</a>
      </h2>
<p id="section-2-1">EVPN is designed to provide a better VPLS service than RFC4761/RFC4762, and EVPN indeed introduced many new features which couldn't be achieved in those old VPLS implemention.But EVPN didn't inherit all features of old VPLS, and a few issues arises for EVPN only.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Some of these issues can be imputed to the MP2P nature of EVPN labels. The PW label in old VPLS is a label for P2P VC, so it contains more context than a identifier in dataplane for it's VSI instance. But the EVPN label just identifies it's VSI instnace and it can't stand for the ingress PE in dataplane. So the following issues arises with MPLS EVPN service:<a href="#section-2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-3.1">MPLS EVPN statistics can't be done per ingress PE. All flows from remote PEs share the same statistics on egress PE, because they share the same EVPN label and the egress PE can't pick them out in the dataplane.<a href="#section-2-3.1" class="pilcrow">¶</a>
</li>
<li class="normal" id="section-2-3.2">MPLS EVPN can't support hub/spoke usecase, where the spoke PEs can only connect to each other through the hub PE. Especially when at least two of the spoke PEs are connected to a common route reflector.<a href="#section-2-3.2" class="pilcrow">¶</a>
</li>
<li class="normal" id="section-2-3.3">MPLS EVPN can't work as an AR-REPLICATOR. Because the AR-REPLICATOR will apply replication for the ingress AR-LEAF too. But a packet shoud not be sent back to the AR-LEAF where it is received from.<a href="#section-2-3.3" class="pilcrow">¶</a>
</li>
<li class="normal" id="section-2-3.4">MPLS EVPN SPE cannot make use of SR-MPLS anycast tunnel because the two SPEs of the anycast tunnel will assign different EVPN labels for the same EVPN route.<a href="#section-2-3.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-2-4">So this document introduces an compound label stack to take advantage of both P2P VC and MP2P EVPN labels.<a href="#section-2-4" class="pilcrow">¶</a></p>
</section>
<section id="section-3">
      <h2 id="name-using-vc-label-to-add-conte">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-using-vc-label-to-add-conte" class="section-name selfRef">Using VC Label to Add Context Data to EVPN Flows</a>
      </h2>
<p id="section-3-1">In order to add as much context as old VPLS to EVPN data packet, 
  We can construct a infrastructure by a full-mesh of context-VCs among the EVPN PEs.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">Take the context-VCs between PE-i and PE-j as an example, 
  VC-ij is the context-VC from PE-i to PE-j, and VC-ji is the context-VC from PE-j to PE-i. 
  The VC-ij identifies the PE-i node on PE-j. The VC-ji identifies PE-j node on PE-i. 
  The VC-label for VC-ij is called as L-ij, and the VC-label for VC-ji is called as L-ji.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">So the PE-i can push the L-ij onto the EVPN data packet for PE-j to distinguish the packet of PE-i from other data packets. 
  Because the L-ij identifies the ingress PE of the data packet.<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4">There are two styles of context-VC in this draft. 
  One style is named as shared context-VC, the other style is named as per-EVI context VC.<a href="#section-3-4" class="pilcrow">¶</a></p>
<section id="section-3.1">
        <h3 id="name-the-shared-context-vcs">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-the-shared-context-vcs" class="section-name selfRef">The Shared Context VCs</a>
        </h3>
<p id="section-3.1-1">The shared context-VCs are dedicated to identify the context for a data packet while the EVPN label still identifies the EVPN instance.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">Note that typically a shared context VC can be shared by all the EVPN instances between it's ingress PE and egress PE. 
 In other words, we don't have to establish a dedicated mesh of context VCs for each specified EVPN service. 
 So we called the shared context VCs as a common infrastructure for those EVPN services.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
</section>
<section id="section-3.2">
        <h3 id="name-the-per-evi-context-vcs">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-the-per-evi-context-vcs" class="section-name selfRef">The per-EVI Context VCs</a>
        </h3>
<p id="section-3.2-1">The per-EVI context VCs are used to identify both the context (typically the ingress-PE) and the EVPN instance for a data packet at the same time. 
 In other words, we have to establish a dedicated set of per-EVI context VCs for each specified EVPN service.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-4">
      <h2 id="name-signalling-for-shared-conte">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-signalling-for-shared-conte" class="section-name selfRef">Signalling for Shared Context VCs</a>
      </h2>
<p id="section-4-1">The VCs of a context VC infrastructure are set up by a context VC container, the container implements a VC signalling to set up the VCs. 
  There are two existing signalling protocol can be reused to set up context VCs for a context VC container.<a href="#section-4-1" class="pilcrow">¶</a></p>
<section id="section-4.1">
        <h3 id="name-kompella-signalling-for-con">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-kompella-signalling-for-con" class="section-name selfRef">Kompella Signalling for Context VC</a>
        </h3>
<p id="section-4.1-1">The signalling used by a Kompella VPLS instance per <span>[<a href="#RFC4761" class="xref">RFC4761</a>]</span> can also be used by a context VC container.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">Different from the ordinary Kompella VPLS instances, a context VC container only use the signalling to set up the context VCs. They are the same in signalling but different in dataplane. Take the PW between PE-i and PE-j as an example, it is constructed by VC-ij and VC-ji, and none of the two context VCs will identify a MAC-VRF. In other words the PW is a context PW.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">Note that the context VC containers don't have a MAC-VRF or a MAC-table, they are just containers for context VC.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
</section>
<div id="sect-SR-CP">
<section id="section-4.2">
        <h3 id="name-sr-mpls-signalling-for-csl-">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-sr-mpls-signalling-for-csl-" class="section-name selfRef">SR-MPLS signalling for CSL-based Context VC</a>
        </h3>
<p id="section-4.2-1">SR-MPLS signalling is very similar to the singleton pattern of Kompella VPLS in the signalling behaviors, in spite of their different data plane and service procedure. 
  The SID is similar to the VE-ID, the SRGB is similar to the label block.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">So the established LSPs of the SR-MPLS signalling can be reinterpreted as context VCs in another label space named S.
  These context VCs use the same label values as those SR-LSPs but they are established at the same time in different label spaces. 
  Take the VC-ij as an example, its label value L-ij is the same as the SID label for PE-i (The label for the SR-LSP destined to PEi) in PE-j's SRGB. 
  But the VC-ij are established in the context label space S which is identified by a static label, the static label is the CL of label space S. 
  VC-ij may not be established in the same label space as that SID label for PE-i.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">The context VC signalling may be <span>[<a href="#RFC8665" class="xref">RFC8665</a>]</span>, <span>[<a href="#RFC8666" class="xref">RFC8666</a>]</span>, <span>[<a href="#RFC8667" class="xref">RFC8667</a>]</span>. 
  The context VC may be established along with SR-LSPs.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">Note that the context VC label is a Context-specific Label (CSL), that's why the context-VC is called CSL-based context-VC. 
                The CL of the SR-Signalling-Based Context-VCs may be the same value in the same domain. 
 In such case, the PEs in that domain don't have to signal the CL to each other.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<span id="name-encapsulation-of-csl-based-"></span><div id="CLS-based-VC-Figure">
<figure id="figure-1">
          <div class="artwork art-text alignCenter" id="section-4.2-5.1">
<pre>
        +---------------------------------+
        |  underlay ethernet header       |
        +---------------------------------+
        |  PSN tunnel label               |
        +---------------------------------+
        |  EVPN label                     |
        +---------------------------------+
        |  Static CL for Label Space S    |
        +---------------------------------+
        |  Context VC Label = L-ij        |
        +---------------------------------+
        |  overlay ethernet or IP header  |
        +---------------------------------+

</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-encapsulation-of-csl-based-" class="selfRef">Encapsulation of CSL-based Context VC</a>
          </figcaption></figure>
</div>
<p id="section-4.2-6">Note that the static CL is the context label for L-ij, while the L-ij is the context label for the payload.<a href="#section-4.2-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
<section id="section-5">
      <h2 id="name-signalling-for-per-evi-cont">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-signalling-for-per-evi-cont" class="section-name selfRef">Signalling for per-EVI Context VCs</a>
      </h2>
<p id="section-5-1">The IMET route per <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span> have a corresponding route-type in MVPN. It is, in effect, the Intra-AS I-PMSI route per <span>[<a href="#RFC6514" class="xref">RFC6514</a>]</span>. 
  The difference between them is that an IMET route won't handle a responding Leaf A-D route, but an Intra-AS I-PMSI route will.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">The Leaf A-D route per <span>[<a href="#I-D.ietf-bess-evpn-bum-procedure-updates" class="xref">I-D.ietf-bess-evpn-bum-procedure-updates</a>]</span> is required for per-EVI context VCs. 
  In this draft, we use the Leaf A-D route with IR-PTA to establish per-EVI context-VCs. 
  The Leaf A-D route is generated for an IMET route.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">It is an update for <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span>. The backward compatibility will be described in <a href="#sect-compatibility" class="xref">Section 5.3</a>.<a href="#section-5-3" class="pilcrow">¶</a></p>
<div id="sect-leaf-ad">
<section id="section-5.1">
        <h3 id="name-construct-leaf-a-d-route-fo">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-construct-leaf-a-d-route-fo" class="section-name selfRef">Construct Leaf A-D Route for IR</a>
        </h3>
<p id="section-5.1-1">PE1 will construct a Leaf A-D route with IR-PTA for EVI1 in response to an IMET route R1 with IR-PTA. 
  The IMET route R1 is received from PE2 previously. 
             The key fields of the IMET route is included in the "Route Key" field of the Leaf A-D route (say R2) along with the ORIP of PE1 itself.
  We call the ORIP of PE1 itself as the Leaf A-D route's "self-ORIP" in order to distinguish it from the Leaf A-D route's Root-ORIP.
  So the "Route Type sepcific" field of the Leaf A-D route is per &lt;EVI1, PE2&gt; basis.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<div id="sect-adv-per-platform-vc">
<section id="section-5.1.1">
          <h4 id="name-advertising-per-platform-vc">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-advertising-per-platform-vc" class="section-name selfRef">Advertising Per-platform VC Label</a>
          </h4>
<p id="section-5.1.1-1">The MPLS label field in the IR-PTA of the Leaf A-D route is allocated per &lt;EVI1, PE2&gt; basis in per-platform label space on PE1. 
      So the per-EVI context VC can identify the EVI1 too.<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1.1-2">Note that PE1 may already advertise an IMET route R3 to PE2 before the advertisement of above Leaf A-D route.<a href="#section-5.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-adv-csl-based-vc">
<section id="section-5.1.2">
          <h4 id="name-advertising-context-specifi">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-advertising-context-specifi" class="section-name selfRef">Advertising Context-Specific VC label</a>
          </h4>
<p id="section-5.1.2-1">Note that the per &lt;EVI,Ingress PE&gt; basis label allocation (see <a href="#sect-adv-per-platform-vc" class="xref">Section 5.1.1</a>) 
  may consume too many  labels in per-platform label space. 
  Sometimes we want to use the same EVPN label in all Leaf A-D routes and IMET routes of the same EVI.
  So we allocate a context-specific label (CSL) for a context VC in this section.<a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
<p id="section-5.1.2-2">The EVPN label is still allocated from per-platform label space, 
          and it identifies the EVPN instance as per [RFC7432]. 
  But it also identifies a context label space CLS1.
  The VC label of the context VC is allocated in CLS1. 
  So we say that the VC label is a context-specific VC label.<a href="#section-5.1.2-2" class="pilcrow">¶</a></p>
<p id="section-5.1.2-3"> We introduce a new BGP Extended Community called Context-specific Label (CSL) Entry Extended Community, 
  the CSL-Entry EC has the same format as the Context Label Space ID Extended Community (Section 3.1 of <span>[<a href="#I-D.ietf-bess-mvpn-evpn-aggregation-label" class="xref">I-D.ietf-bess-mvpn-evpn-aggregation-label</a>]</span>) except for a few notable differences.<a href="#section-5.1.2-3" class="pilcrow">¶</a></p>
<p id="section-5.1.2-4">The "sub-type" field of the CSL-Entry EC has a different codepoint from the CLS-ID EC.
              The ID-Value of the CSL-Entry EC is a MPLS label in a context-specific label space identified by the PTA label.
              And the MPLS label in the CSL-Entry EC will be pushed onto the label stack before the PTA label by the ingress PE.
              Typically, the MPLS label of the CSL-Entry EC is a downstream assigned label, which means that it will be used as an outgoing label by the PE receiving the CSL-Entry EC, not as incomming label.<a href="#section-5.1.2-4" class="pilcrow">¶</a></p>
<p id="section-5.1.2-5">When constructing the Leaf A-D route, the IR-PTA label is the EVPN Label, as per [RFC7432]. 
          But the ID-value in the CSL-Entry EC is a label (say L1) that is allocated per TPE basis in CLS1.
                 In fact, L1 is the context-specific VC label of the context VC of that ingress TPE.   
          That's why the context VC is called as CSL-based context VC. 
          So the CLS1-specific VC label need to be pushed onto the label stack before EVPN Label (which identifies CLS1) on ingress PEs.<a href="#section-5.1.2-5" class="pilcrow">¶</a></p>
<p id="section-5.1.2-6"> Note that the CSL-Entry ECs (for different EVIs) received from the same TPE may be the same label,
          because that all EVI labels on the same PE may identify the same Context-specific Label Space (CLS).
                 So we can select a single EVI to use the Leaf A-D route with CSL-Entry EC in such case.
                 This EVI is called as administrating EVI (admin-EVI). 
          The context VC label carried in the Leaf A-D routes of the admin-EVI will be used to take the place of the PTA label of the IMET route with the same ORIP in all other ordinary EVIs in such case.
          Note that all other ordinary EVIs don't use the Leaf A-D routes with IR-PTA in their signalling procedures, they use ordinary IMET routes instead.
                 The admin-EVI need to be configured on all EVPN-PEs in such case.<a href="#section-5.1.2-6" class="pilcrow">¶</a></p>
<p id="section-5.1.2-7">Such encapsulation is illustrated as the following figure:<a href="#section-5.1.2-7" class="pilcrow">¶</a></p>
<span id="name-encapsulation-of-evi-specif"></span><div id="Payload-Context-Figure">
<figure id="figure-2">
            <div class="artwork art-text alignCenter" id="section-5.1.2-8.1">
<pre>
                     +---------------------------------+
                     |  underlay ethernet header       |
                     +---------------------------------+
                     |  PSN tunnel label               |
                     +---------------------------------+
                     |  EVPN label                     |
                     +---------------------------------+
                     |  Context VC Label               |
                     +---------------------------------+
                     |  overlay ethernet or IP header  |
                     +---------------------------------+

</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-encapsulation-of-evi-specif" class="selfRef">Encapsulation of EVI-Specific VC Label for EVPN Payload</a>
            </figcaption></figure>
</div>
<p id="section-5.1.2-9">Note that the Context-VC Label here is not the CLS-ID of the EVPN Label. 
              But the EVPN label is the CLS-ID of the Context-VC Label. 
  That's why the CLS-ID EC of <span>[<a href="#I-D.ietf-bess-mvpn-evpn-aggregation-label" class="xref">I-D.ietf-bess-mvpn-evpn-aggregation-label</a>]</span> is not appropriate for such encapsulation.<a href="#section-5.1.2-9" class="pilcrow">¶</a></p>
<p id="section-5.1.2-10">Note that when the PTA label is changed to a new value (caused by the BGP nexthop rewriting) by the SPE nodes, 
  the CSL-Entry in the same EVPN route won't be rewrite. This is similar to the behavior of ESI Label EC of EAD per ES route.<a href="#section-5.1.2-10" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-irl">
<section id="section-5.2">
        <h3 id="name-establish-ingress-replicati">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-establish-ingress-replicati" class="section-name selfRef">Establish Ingress Replication List by Leaf A-D Route</a>
        </h3>
<p id="section-5.2-1">PE2 receives the responding Leaf A-D route (say R2) of the IMET route R1 which is previously advertised by itself,
  and PE2 preiously received an IMET route R3 with the same ORIP as the self-ORIP of R2 .
  Given that R1,R2 and R3 both have a IR-PTA, PE2 SHOULD use R2 to install the Ingress Replication List (IRL) item for PE1 instead,
  and R3 will not used to install the IRL-item for PE1 from then on.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">Note that when R2 included a CSL-Entry EC, the ID-value of the CSL-Entry EC will be used as the outgoing label of the IRL-item.
  The MPLS label of the IR-PTA will be used as the context label (CL) of the CSL-Entry in NHLFE.
  No ILM entry will be installed for the CSL of R2 on PE2.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-compatibility">
<section id="section-5.3">
        <h3 id="name-backward-compatibility">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-backward-compatibility" class="section-name selfRef">Backward Compatibility</a>
        </h3>
<p id="section-5.3-1">In <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span>, the LIR flag of IMET route is required to be zero when it is advertised and to be ignored on receipt.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">It means that the LIR flag is reserved by IMET routes, but it technically can be used in the future. 
  What should the LIR flag be restrained in the future use is no more severer than any other reserved PTA flags in the IMET routes.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">So when PE2 set the LIR flag to one in the IMET route and send it to PE1, PE2 won't expect that the IMET route must be responded by a Leaf A-D. 
  When the corresponding Leaf A-D route can't be received from PE1, the IMET route from PE1 still be used as per <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span>.
  But when PE1 is a new PE following this draft, PE1 will indeed respond a Leaf A-D route for the IMET route.<a href="#section-5.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
<section id="section-6">
      <h2 id="name-solutions">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-solutions" class="section-name selfRef">Solutions</a>
      </h2>
<div id="sect-solution-spoke-pe">
<section id="section-6.1">
        <h3 id="name-solution-for-source-squelch">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-solution-for-source-squelch" class="section-name selfRef">Solution for Source-Squelching in Hub-Spoke Scenarios</a>
        </h3>
<span id="name-hub-pe-and-spoke-pes"></span><div id="Spoke-Figure">
<figure id="figure-3">
          <div class="artwork art-text alignCenter" id="section-6.1-1.1">
<pre>
    PEs1--------RR1--------PEh---------RR2--------PEs3
                /
    PEs2-------/

</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-hub-pe-and-spoke-pes" class="selfRef">Hub PE and Spoke PEs</a>
          </figcaption></figure>
</div>
<p id="section-6.1-2">Now take above use case for example, there are three spoke PEs and one hub PE. The spoke PEs are PEs1, PEs2 and PEs3. The hub PE is PEh. Two of the spoke PEs (PEs1 and PEs2) are connected to the same RR group and the third one connects to another RR group.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">Although we can advertise different EVPN labels for different RR groups, we can't advertise different EVPN labels for PEs1 and PEs2.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4">But PEh can request PEs1 or PEs2 to push the label of the context VC from them to PEh. Benefit from the context VC label, PEh can distinguish where the packet from, in other words, PEh can decide where the packet can't be sent to.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1-5">The signaling for the hub PE to request the spoke PE to push the context VC label will be added in future versions.<a href="#section-6.1-5" class="pilcrow">¶</a></p>
<p id="section-6.1-6">Note that although PEs1 and PEs2 can receive EVPN routes from each other they won't import these routes because of the hub/spoke behaviors.<a href="#section-6.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-solution-statistics">
<section id="section-6.2">
        <h3 id="name-solution-for-per-ingress-st">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-solution-for-per-ingress-st" class="section-name selfRef">Solution for per ingress statistics</a>
        </h3>
<p id="section-6.2-1">We use CSL-based per-EVI context-VCs(see <a href="#sect-adv-csl-based-vc" class="xref">Section 5.1.2</a>) to do per-ingress statistics.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">Note that The per-platform label space can be used as CLS1 at the same time. 
  In such case, the inner context-VC label is similar to the downstream-assigned ESI-label in ILM-lookup behavior.
  Such context-VC is very similar to the shared context VC too.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2-3"> Note that when PE1 sends a Leaf A-D route with a CSL-Entry EC to PE2,
      but PE2 don't recognize the CSL-Entry EC, then PE2 will encapsulate the EVPN label without the inner context-VC label.
         If CLS1 is actually identical to the per-platform label space, this will work as well as [RFC7432], 
  although the per-ingress statistics can't be executed.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<p id="section-6.2-4">
  Note that legacy PEs will not send a Leaf A-D route in response to an IMET route even if the LIR flag in the IMET route is set to one.
  So when legacy PEs and new PEs following this section coexist in the same EVI, 
  they can interwork well, but only the new PEs can do per-ingress statistics.<a href="#section-6.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-6.3">
        <h3 id="name-solution-for-ar-replicator-">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-solution-for-ar-replicator-" class="section-name selfRef">Solution for AR REPLICATOR in MPLS EVPN</a>
        </h3>
<span id="name-ar-replicator-in-mpls-evpn"></span><div id="AR-Figure">
<figure id="figure-4">
          <div class="artwork art-text alignCenter" id="section-6.3-1.1">
<pre>
    LEAF1--------REPLICATOR1--------RNVE1
                     /
    LEAF2-----------/

</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-ar-replicator-in-mpls-evpn" class="selfRef">AR REPLICATOR in MPLS EVPN</a>
          </figcaption></figure>
</div>
<p id="section-6.3-2">When REPLICATOR1 node recieves an IMET Route with AR-role = AR-LEAF from LEAF1 node, REPLICATOR1 SHOLD respond to it with an Leaf A-D route with AR-PTA.
     The MPLS label field of the AR-PTA (say AR-PTA Label) will be allocated following the same rules as the IR-PTA Label in <a href="#sect-leaf-ad" class="xref">Section 5.1</a>. 
     When ALEAF1 receives above Leaf A-D route, the Leaf A-D route is treated as a Replicator-AR route for the same ORIP, and then the control-plane procedures works following <span>[<a href="#I-D.ietf-bess-evpn-optimized-ir" class="xref">I-D.ietf-bess-evpn-optimized-ir</a>]</span>. 
        When REPLICATOR1 receives data packets from the AR-PTA Label, REPLICATOR1 will do source-squelching for LEAF1 which means that these data packets will not be forwarded back to LEAF1.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3">
     Note that the old Replicator-AR route which is in terms of IMET route will not be used by MPLS EVPN AR-REPLICATOR.
     Because that the Leaf A-D routes will take it's place per AR-LEAF basis.
     But the old Regular-IR route can still be used by MPLS EVPN AR-REPLICATORs.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
<p id="section-6.3-4">
 Note that the AR-REPLICATOR don't have to set the LIR flag of its IMET routes to one. 
 We suggest that when receiving an IMET route with AR-role = AR-LEAF and tunnel-encapsulation = MPLS,
 the above Leaf A-D route SHOULD be generated for that IMET route, even if the LIR flag is set to zero.<a href="#section-6.3-4" class="pilcrow">¶</a></p>
</section>
<section id="section-6.4">
        <h3 id="name-solution-for-anycast-tunnel">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-solution-for-anycast-tunnel" class="section-name selfRef">Solution for anycast tunnel usage on SPE</a>
        </h3>
<span id="name-spe-with-anycast-tunnel"></span><div id="Anycast-Figure">
<figure id="figure-5">
          <div class="artwork art-text alignCenter" id="section-6.4-1.1">
<pre>
       /--------SPE1-------\
     TPE1                   TPE2
       \--------SPE2-------/

</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-spe-with-anycast-tunnel" class="selfRef">SPE with Anycast Tunnel</a>
          </figcaption></figure>
</div>
<p id="section-6.4-2">Now take above use case for example, the two SPEs are the egress nodes of an anycast SR-MPLS tunnel. 
  The anycast SR-MPLS tunnel is used to transport flows from TPE1 to either SPE1 or SPE2 according to load balancing procedures. 
  So SPE1 and SPE2 have to advertise the same EVPN label independently for a given EVPN route.<a href="#section-6.4-2" class="pilcrow">¶</a></p>
<div id="sect-spe-anycast-cp">
<section id="section-6.4.1">
          <h4 id="name-control-plane">
<a href="#section-6.4.1" class="section-number selfRef">6.4.1. </a><a href="#name-control-plane" class="section-name selfRef">Control-plane</a>
          </h4>
<p id="section-6.4.1-1">In fact, SPE1 and SPE2 can simply inherit the EVPN label (say EVL4) from TPE2, 
      and they advertise it to TPE1 along with a context-VC label (say VCL4). 
      The context-VC label is for the shared context-VC from TPE2 to SPE1 or SPE2. 
          We can make the VC labels from TPE2 to SPE1 and SPE2 have the same value through configuring.<a href="#section-6.4.1-1" class="pilcrow">¶</a></p>
<p id="section-6.4.1-2">
  Note that the context-VCs can be established according to <a href="#sect-SR-CP" class="xref">Section 4.2</a>.
  Note that VCL4 has the same value as the SR-LSP to TPE2 according to <a href="#sect-SR-CP" class="xref">Section 4.2</a>.
  Note that VCL4 identify a Label Space (say TPE2-specific CLS) that is dedicated to turning the EVPN label received from TPE2 into an incoming label on the SPEs. 
  When SPE1 receives EVPN labels from different TPEs, SPE1 MUST use different CLS to install the corresponding ILM entry for Label swapping.<a href="#section-6.4.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-spe-anycast-dp">
<section id="section-6.4.2">
          <h4 id="name-data-plane">
<a href="#section-6.4.2" class="section-number selfRef">6.4.2. </a><a href="#name-data-plane" class="section-name selfRef">Data-plane</a>
          </h4>
<p id="section-6.4.2-1">The label stack on the anycast SR-MPLS tunnel is constructed by TPE1 as the following:<a href="#section-6.4.2-1" class="pilcrow">¶</a></p>
<span id="name-anycast-spe-dataplane"></span><div id="Anycast-SPE-Figure">
<figure id="figure-6">
            <div class="artwork art-text alignCenter" id="section-6.4.2-2.1">
<pre>
        +---------------------------------+
        |  underlay ethernet header       |
        +---------------------------------+
        |  Anycast SR-TL = SR_LSP_to_SPEx |
        +---------------------------------+
        |  Static CL = CL4                |
        +---------------------------------+
        |  Context-VC Label = VCL4        |
        +---------------------------------+
        |  EVPN label = EVL4              |
        +---------------------------------+
        |  overlay ethernet or IP header  |
        +---------------------------------+

</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-anycast-spe-dataplane" class="selfRef">Anycast SPE dataplane</a>
            </figcaption></figure>
</div>
<p id="section-6.4.2-3">Note that the SR Tunnel Label (TL) in the label stack is the SR-LSP label from TPE1 to the SPE1 or SPE2.<a href="#section-6.4.2-3" class="pilcrow">¶</a></p>
<p id="section-6.4.2-4">Note that the context-VC is also constructed in a context label space (say CLS4), 
      the label space CLS4 is identified by a static label (say CL4). 
      And the CLS4 is identified by the same CL4 on all PEs of the service domain. 
      so the label stacks on the anycast tunnel are the same for SPE1 and SPE2.<a href="#section-6.4.2-4" class="pilcrow">¶</a></p>
<p id="section-6.4.2-5">Then SPE1/SPE2 will perform ILM lookup for the EVPN label in the "TPE2-specific label space" which is identified by the context-VC label VCL4.
  The label operation will be swap, and the new outgoing EVPN label will be the same value.<a href="#section-6.4.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</section>
<div id="Security">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">This section will be added in future versions.<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IANA">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-8-1">The IANA considerations for CSL-Entry EC in <a href="#sect-adv-csl-based-vc" class="xref">Section 5.1.2</a> will be added in future versions.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-acknowledgements">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-9-1">The authors would like to thank the following for their comments and
   review of this document:<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">Benchong Xu.<a href="#section-9-2" class="pilcrow">¶</a></p>
</section>
<section id="section-10">
      <h2 id="name-references">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-bess-evpn-bum-procedure-updates">[I-D.ietf-bess-evpn-bum-procedure-updates]</dt>
<dd>
<span class="refAuthor">Zhang, Z.</span><span class="refAuthor">, Lin, W.</span><span class="refAuthor">, Rabadan, J.</span><span class="refAuthor">, Patel, K.</span><span class="refAuthor">, and A. Sajassi</span>, <span class="refTitle">"Updates on EVPN BUM Procedures"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-evpn-bum-procedure-updates-08</span>, <time datetime="2019-11-18">18 November 2019</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-bess-evpn-bum-procedure-updates-08">https://tools.ietf.org/html/draft-ietf-bess-evpn-bum-procedure-updates-08</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-bess-evpn-optimized-ir">[I-D.ietf-bess-evpn-optimized-ir]</dt>
<dd>
<span class="refAuthor">Rabadan, J.</span><span class="refAuthor">, Sathappan, S.</span><span class="refAuthor">, Lin, W.</span><span class="refAuthor">, Katiyar, M.</span><span class="refAuthor">, and A. Sajassi</span>, <span class="refTitle">"Optimized Ingress Replication solution for EVPN"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-evpn-optimized-ir-06</span>, <time datetime="2018-10-19">19 October 2018</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-bess-evpn-optimized-ir-06">https://tools.ietf.org/html/draft-ietf-bess-evpn-optimized-ir-06</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-bess-mvpn-evpn-aggregation-label">[I-D.ietf-bess-mvpn-evpn-aggregation-label]</dt>
<dd>
<span class="refAuthor">Zhang, Z.</span><span class="refAuthor">, Rosen, E.</span><span class="refAuthor">, Lin, W.</span><span class="refAuthor">, Li, Z.</span><span class="refAuthor">, and I. Wijnands</span>, <span class="refTitle">"MVPN/EVPN Tunnel Aggregation with Common Labels"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-mvpn-evpn-aggregation-label-03</span>, <time datetime="2019-10-24">24 October 2019</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-bess-mvpn-evpn-aggregation-label-03">https://tools.ietf.org/html/draft-ietf-bess-mvpn-evpn-aggregation-label-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6514">[RFC6514]</dt>
<dd>
<span class="refAuthor">Aggarwal, R.</span><span class="refAuthor">, Rosen, E.</span><span class="refAuthor">, Morin, T.</span><span class="refAuthor">, and Y. Rekhter</span>, <span class="refTitle">"BGP Encodings and Procedures for Multicast in MPLS/BGP IP VPNs"</span>, <span class="seriesInfo">RFC 6514</span>, <span class="seriesInfo">DOI 10.17487/RFC6514</span>, <time datetime="2012-02">February 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6514">https://www.rfc-editor.org/info/rfc6514</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7432">[RFC7432]</dt>
<dd>
<span class="refAuthor">Sajassi, A., Ed.</span><span class="refAuthor">, Aggarwal, R.</span><span class="refAuthor">, Bitar, N.</span><span class="refAuthor">, Isaac, A.</span><span class="refAuthor">, Uttaro, J.</span><span class="refAuthor">, Drake, J.</span><span class="refAuthor">, and W. Henderickx</span>, <span class="refTitle">"BGP MPLS-Based Ethernet VPN"</span>, <span class="seriesInfo">RFC 7432</span>, <span class="seriesInfo">DOI 10.17487/RFC7432</span>, <time datetime="2015-02">February 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7432">https://www.rfc-editor.org/info/rfc7432</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC4761">[RFC4761]</dt>
<dd>
<span class="refAuthor">Kompella, K., Ed.</span><span class="refAuthor"> and Y. Rekhter, Ed.</span>, <span class="refTitle">"Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling"</span>, <span class="seriesInfo">RFC 4761</span>, <span class="seriesInfo">DOI 10.17487/RFC4761</span>, <time datetime="2007-01">January 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4761">https://www.rfc-editor.org/info/rfc4761</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5331">[RFC5331]</dt>
<dd>
<span class="refAuthor">Aggarwal, R.</span><span class="refAuthor">, Rekhter, Y.</span><span class="refAuthor">, and E. Rosen</span>, <span class="refTitle">"MPLS Upstream Label Assignment and Context-Specific Label Space"</span>, <span class="seriesInfo">RFC 5331</span>, <span class="seriesInfo">DOI 10.17487/RFC5331</span>, <time datetime="2008-08">August 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5331">https://www.rfc-editor.org/info/rfc5331</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8665">[RFC8665]</dt>
<dd>
<span class="refAuthor">Psenak, P., Ed.</span><span class="refAuthor">, Previdi, S., Ed.</span><span class="refAuthor">, Filsfils, C.</span><span class="refAuthor">, Gredler, H.</span><span class="refAuthor">, Shakir, R.</span><span class="refAuthor">, Henderickx, W.</span><span class="refAuthor">, and J. Tantsura</span>, <span class="refTitle">"OSPF Extensions for Segment Routing"</span>, <span class="seriesInfo">RFC 8665</span>, <span class="seriesInfo">DOI 10.17487/RFC8665</span>, <time datetime="2019-12">December 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8665">https://www.rfc-editor.org/info/rfc8665</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8666">[RFC8666]</dt>
<dd>
<span class="refAuthor">Psenak, P., Ed.</span><span class="refAuthor"> and S. Previdi, Ed.</span>, <span class="refTitle">"OSPFv3 Extensions for Segment Routing"</span>, <span class="seriesInfo">RFC 8666</span>, <span class="seriesInfo">DOI 10.17487/RFC8666</span>, <time datetime="2019-12">December 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8666">https://www.rfc-editor.org/info/rfc8666</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8667">[RFC8667]</dt>
<dd>
<span class="refAuthor">Previdi, S., Ed.</span><span class="refAuthor">, Ginsberg, L., Ed.</span><span class="refAuthor">, Filsfils, C.</span><span class="refAuthor">, Bashandy, A.</span><span class="refAuthor">, Gredler, H.</span><span class="refAuthor">, and B. Decraene</span>, <span class="refTitle">"IS-IS Extensions for Segment Routing"</span>, <span class="seriesInfo">RFC 8667</span>, <span class="seriesInfo">DOI 10.17487/RFC8667</span>, <time datetime="2019-12">December 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8667">https://www.rfc-editor.org/info/rfc8667</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="section-appendix.a">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Yubao Wang</span></div>
<div dir="auto" class="left"><span class="org">ZTE Corporation</span></div>
<div dir="auto" class="left"><span class="street-address">No. 50 Software Ave, Yuhuatai Distinct</span></div>
<div dir="auto" class="left"><span class="locality">Nanjing</span></div>
<div dir="auto" class="left"><span class="country-name">China</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:yubao.wang2008@hotmail.com" class="email">yubao.wang2008@hotmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Bing Song</span></div>
<div dir="auto" class="left"><span class="org">ZTE Corporation</span></div>
<div dir="auto" class="left"><span class="street-address">No. 50 Software Ave, Yuhuatai Distinct</span></div>
<div dir="auto" class="left"><span class="locality">Nanjing</span></div>
<div dir="auto" class="left"><span class="country-name">China</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:song.bing@zte.com.cn" class="email">song.bing@zte.com.cn</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
