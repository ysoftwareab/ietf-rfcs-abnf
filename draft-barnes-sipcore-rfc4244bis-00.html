<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>An Extension to the Session Initiation
    Protocol (SIP) for Request History Information</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="An Extension to the Session Initiation
    Protocol (SIP) for Request History Information">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">M. Barnes</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">F. Audet</td></tr>
<tr><td class="header">Obsoletes: <a href='http://tools.ietf.org/html/rfcRFC4244'>RFC4244</a></td><td class="header">Nortel</td></tr>
<tr><td class="header">(if&nbsp;approved)</td><td class="header">June 04, 2009</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: December 6, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />An Extension to the Session Initiation
    Protocol (SIP) for Request History Information<br />draft-barnes-sipcore-rfc4244bis-00.txt</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on December 6, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This document defines a standard mechanism for capturing the history
      information associated with a Session Initiation Protocol (SIP) request.
      This capability enables many enhanced services by providing the
      information as to how and why a call arrives at a specific application
      or user. This document defines a new optional SIP header, History-Info,
      for capturing the history information in requests.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Overview">1.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">1.2.</a>&nbsp;
Conventions and Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#background">1.3.</a>&nbsp;
Background: Why define a Generic Request History Header?<br />
<a href="#requirements">2.</a>&nbsp;
Request History Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#secreq">2.1.</a>&nbsp;
Security Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#privacyreq">2.2.</a>&nbsp;
Privacy Requirements<br />
<a href="#solution">3.</a>&nbsp;
Request History Information Description<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#optional">3.1.</a>&nbsp;
Optionality of History-Info<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#privacy">3.2.</a>&nbsp;
Ensuring the Privacy of History-Info<br />
<a href="#protocol">4.</a>&nbsp;
Request History Information Protocol Details<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#structure">4.1.</a>&nbsp;
Protocol Structure of History-Info<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#example">4.2.</a>&nbsp;
Protocol examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#usage">4.3.</a>&nbsp;
Protocol Usage<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uac">4.3.1.</a>&nbsp;
User Agent Client (UAC) Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uas">4.3.2.</a>&nbsp;
User Agent Server (UAS) Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#proxy">4.3.3.</a>&nbsp;
Proxy Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#redirect">4.3.4.</a>&nbsp;
Redirect Server Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#callflows">4.4.</a>&nbsp;
Example Call Flows with History-Info Header<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#basic">4.4.1.</a>&nbsp;
Basic Call with History-Info<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#entirePrivacy">4.4.2.</a>&nbsp;
History-Info with Privacy Header<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#entryPrivacy">4.4.3.</a>&nbsp;
Privacy Header for a Specific History-Info Entry<br />
<a href="#application">5.</a>&nbsp;
Application Considerations<br />
<a href="#security">6.</a>&nbsp;
Security Considerations<br />
<a href="#iana">7.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#header">7.1.</a>&nbsp;
Registration of New SIP History-Info Header<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">7.2.</a>&nbsp;
Registration of &quot;history&quot; for SIP Privacy Header<br />
<a href="#anchor3">8.</a>&nbsp;
Contributors<br />
<a href="#anchor4">9.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor5">10.</a>&nbsp;
Changes since last Version<br />
<a href="#rfc.references1">11.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">11.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">11.2.</a>&nbsp;
Informative References<br />
<a href="#appendix">Appendix&nbsp;A.</a>&nbsp;
Detailed call flows<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#fork">A.1.</a>&nbsp;
Sequentially Forking (History-Info in Response)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#voicemail">A.2.</a>&nbsp;
Voicemail<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#acd">A.3.</a>&nbsp;
Automatic Call Distribution<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<a name="Overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Overview</h3>

<p>Many services that SIP is anticipated to support require the
        ability to determine why and how the call arrived at a specific
        application. Examples of such services include (but are not limited
        to) sessions initiated to call centers via "click to talk" SIP Uniform
        Resource Locators (URLs) on a web page, "call history/logging" style
        services within intelligent "call management" software for SIP User
        Agents (UAs), and calls to voicemail servers. Although SIP implicitly
        provides the redirect/retarget capabilities that enable calls to be
        routed to chosen applications, there is currently no standard
        mechanism within SIP for communicating the history of such a request.
        This "request history" information allows the receiving application to
        determine hints about how and why the call arrived at the
        application/user.
</p>
<p>This document defines a SIP header, History-Info, to provide a
        standard mechanism for capturing the request history information to
        enable a wide variety of services for networks and end-users. The
        History-Info header provides a building block for development of new
        services.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Conventions and Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>The term "retarget" is used in this document to refer to the
        process of a Proxy Server/User Agent Client (UAC) changing a Uniform
        Resource Identifier (URI) in a request based on a lookup in a location
        service and thus changing the target of the request.
</p>
<p>The term "forward" is used consistent with the terminology in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>. However, it should be noted that uses the
        term "forwarding" to describe a proxy's handling of requests for
        domains for which is not responsible, as well as to describe the basic
        "forwarding" of a request (in section 16.6) once a target has been
        determined, whether it's a "retargeted", "redirected" or "forwarded"
        request. Thus, the usage of "forward" in this document, other than in
        reference to the usage in section 16.6 of <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, refers to the request being forwarded to a
        next hop proxy.
</p>
<p>The terms "location service" and "redirect" are used consistent
        with the terminology in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="background"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Background: Why define a Generic Request History Header?</h3>

<p>SIP implicitly provides retargeting, redirection and forwarding
        capabilities that enable calls to be routed to specific applications
        as defined in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>. The term 'retarget' is
        used in this document to refer to the process of a Proxy Server/User
        Agent Client (UAC) changing a Uniform Resource Identifier (URI) in a
        request based on a lookup in a location service and thus changing the
        target of the request. The target(s) for a user can be created through
        registration or other means, which are outside the scope of this
        document and <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>. The rules for determining
        request targets as described in Section 16.5 of <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>.
</p>
<p>The motivation for capturing the request history is that in the
        process of retargeting and forwarding a request, old routing
        information can be forever lost. This lost information may be
        important history that allows elements to which the call is retargeted
        to process the call in a locally defined, application-specific manner.
        This document defines a mechanism for transporting the request
        history. It does not define any application-specific behavior for a
        Proxy or UA upon receipt of the information. Indeed, such behavior
        should be a local decision for the recipient application.
</p>
<p>Current network applications provide the ability for elements
        involved with the call to exchange additional information relating to
        how and why the call was routed to a particular destination. The
        following are examples of such applications:
</p>
<p></p>
<ol class="text">
<li>Web "referral" applications, whereby an application residing
            within a web server determines that a visitor to a website has
            arrived at the site via an "associate" site that will receive some
            "referral" commission for generating this traffic
</li>
<li>Email forwarding whereby the forwarded-to user obtains a
            "history" of who sent the email to whom and at what time
</li>
<li>Traditional telephony services such as voicemail, call-center
            "automatic call distribution", and "follow-me" style services
</li>
</ol>

<p>Several of the aforementioned applications currently define
        application-specific mechanisms through which it is possible to obtain
        the necessary history information.
</p>
<p>In addition, request history information could be used to enhance
        basic SIP functionality by providing the following,: </p>
<ul class="text">
<li>Some diagnostic information for debugging SIP requests. (Note
            that the diagnostic utility of this mechanism is limited by the
            fact that its use by entities that retarget is optional.)
</li>
<li>Capturing aliases and Globally Routable User Agent URIs (GRUUs)
            <a class='info' href='#I-D.ietf-sip-gruu'>[I&#8209;D.ietf&#8209;sip&#8209;gruu]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Obtaining and Using Globally Routable User Agent (UA) URIs (GRUU) in the  Session Initiation Protocol (SIP),&rdquo; October&nbsp;2007.</span><span>)</span></a>, which can be overwritten
            by a home proxy upon receipt of the initial request.
</li>
<li>Facilitating the use of limited use addresses (minted on
            demand) and sub-addressing.
</li>
<li>Preserving service specific URIs that can be overwritten by a
            downstream proxy, such as those defined in <a class='info' href='#RFC3087'>[RFC3087]<span> (</span><span class='info'>Campbell, B. and R. Sparks, &ldquo;Control of Service Context using SIP Request-URI,&rdquo; April&nbsp;2001.</span><span>)</span></a>, and control of network announcements and
            IVR with SIP URI <a class='info' href='#RFC4240'>[RFC4240]<span> (</span><span class='info'>Burger, E., Van Dyke, J., and A. Spitzer, &ldquo;Basic Network Media Services with SIP,&rdquo; December&nbsp;2005.</span><span>)</span></a>.
</li>
<li>A stronger security solution for SIP. A side effect is that
            each proxy that captures the "request history" information in a
            secure manner provides an additional means (without requiring
            signed keys) for the original requestor to be assured that the
            request was properly retargeted.
</li>
</ul>

<a name="requirements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Request History Requirements</h3>

<p>The following list constitutes a set of requirements for a "Request
      History" capability.
</p>
<p></p>
<ol class="text">
<li>CAPABILITY-req: The "Request History" capability provides a
          capability to inform proxies and UAs involved in processing a
          request about the history/progress of that request. Although this is
          inherently provided when the retarget is in response to a SIP
          redirect, it is deemed useful for non-redirect retargeting
          scenarios, as well.
</li>
<li>GENERATION-req: "Request History" information is generated when
          the request is retargeted or forwarded (to a next hop proxy). 
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>In some scenarios, it might be possible for more than one
              instance of retargeting to occur within the same Proxy. A proxy
              should also generate Request History information for the
              'internal retargeting'.
</dd>
<dt>B.</dt>
<dd>An entity (UA or proxy) retargeting in response to a redirect
              or REFER should include any Request History information from the
              redirect/REFER in the new request.
</dd>
</dl></blockquote>
</li>
<li>ISSUER-req: "Request History" information can be generated by a
          UA or proxy. It can be passed in both requests and responses.
</li>
<li>CONTENT-req: The "Request History" information for each
          occurrence of retargeting or forwarding shall include the
          following:
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>The new URI or address to which the request is in the process
              of being retargeted or forwarded,
</dd>
<dt>B.</dt>
<dd>The URI or address from which the request was retargeted or
              forwarded,
</dd>
<dt>C.</dt>
<dd>An indication as to whether the request was retargeted versus
              forwarded,
</dd>
<dt>D.</dt>
<dd>The reason for the Request-URI or address modification,
</dd>
<dt>E.</dt>
<dd>Chronological ordering of the Request History
              information.
</dd>
</dl></blockquote>
</li>
<li>REQUEST-VALIDITY-req: Request History is applicable to requests
          not sent within an established dialog (e.g., INVITE, REGISTER,
          MESSAGE, and OPTIONS).
</li>
<li>BACKWARDS-req: Request History information may be passed from the
          generating entity backwards towards the UAC. This is needed to
          enable services that inform the calling party about the dialog
          establishment attempts.
</li>
<li>FORWARDS-req: Request History information may also be included by
          the generating entity in the request, if it is forwarded
          onwards.
</li>
</ol>

<a name="secreq"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Security Requirements</h3>

<p>The Request History information is being inserted by a network
        element retargeting a Request, resulting in a slightly different
        problem than the basic SIP header problem, thus requiring specific
        consideration. It is recognized that these security requirements can
        be generalized to a basic requirement of being able to secure
        information that is inserted by proxies.
</p>
<p>The potential security problems include the following: </p>
<ol class="text">
<li>A rogue application could insert a bogus Request History entry
            either by adding an additional entry as a result of retargeting or
            entering invalid information.
</li>
<li>A rogue application could re-arrange the Request History
            information to change the nature of the end application or to
            mislead the receiver of the information.
</li>
<li>A rogue application could delete some or all of the Request
            History information.
</li>
</ol>

<p>Thus, a security solution for "Request History" must meet the
        following requirements: </p>
<ol class="text">
<li>SEC-req-1: The entity receiving the Request History must be
            able to determine whether any of the previously added Request
            History content has been altered.
</li>
<li>SEC-req-2: The ordering of the Request History information must
            be preserved at each instance of retargeting.
</li>
<li>SEC-req-3: The entity receiving the information conveyed by the
            Request History must be able to authenticate the entity providing
            the request.
</li>
<li>SEC-req-4: To ensure the confidentiality of the Request History
            information, only entities that process the request should have
            visibility to the information.
</li>
</ol>

<p>It should be noted that these security requirements apply to any
        entity making use of the Request History information, either by
        retargeting and capturing the information, or as an application making
        use of the information received in either a Request or Response.
</p>
<a name="privacyreq"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Privacy Requirements</h3>

<p>Since the Request-URI that is captured could inadvertently reveal
        information about the originator, there are general privacy
        requirements that MUST be met: </p>
<ol class="text">
<li>PRIV-req-1: The entity retargeting the Request must ensure that
            it maintains the network-provided privacy (as described in <a class='info' href='#RFC3323'>[RFC3323]<span> (</span><span class='info'>Peterson, J., &ldquo;A Privacy Mechanism for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2002.</span><span>)</span></a>) associated with the Request as it is
            retargeted or forwarded.
</li>
<li>PRIV-req-2: The entity receiving the Request History must
            maintain the privacy associated with the information. In addition,
            local policy at a proxy may identify privacy requirements
            associated with the Request-URI being captured in the Request
            History information.
</li>
<li>PRIV-req-3: Request History information subject to privacy
            shall not be included in ougoing messages unless it is protected
            as described in <a class='info' href='#RFC3323'>[RFC3323]<span> (</span><span class='info'>Peterson, J., &ldquo;A Privacy Mechanism for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2002.</span><span>)</span></a> (i.e.,
            anonymized).
</li>
</ol>

<a name="solution"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Request History Information Description</h3>

<p>The fundamental functionality provided by the request history
      information is the ability to inform proxies and UAs involved in
      processing a request about the history or progress of that request
      (CAPABILITY-req). The solution is to capture the Request-URIs as a
      request is forwarded in a new header for SIP messages: History-Info
      (CONTENT-req). This allows for the capturing of the history of a request
      that would be lost with the normal SIP processing involved in the
      subsequent forwarding of the request. This solution proposes no changes
      in the fundamental determination of request targets or in the request
      forwarding as defined in Sections 16.5 and 16.6 of the SIP protocol
      specification <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>.
</p>
<p>The History-Info header can appear in any request not associated with
      an established dialog (e.g., INVITE, REGISTER, MESSAGE, REFER and
      OPTIONS, PUBLISH and SUBSCRIBE, etc.) (REQUEST-VALIDITY-req) and any
      valid response to these requests (ISSUER-req).
</p>
<p>The History-Info header is added to a Request when a new request is
      created by a UAC or forwarded by a Proxy, or when the target of a
      request is changed. The term "retarget" refers to this changing of the
      target of a request and the subsequent forwarding of that request. It
      should be noted that retargeting only occurs when the Request-URI
      indicates a domain for which the processing entity is responsible. In
      terms of the SIP protocol, the processing associated with retargeting is
      described in Sections 16.5 and 16.6 of <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>.
      As described in Section 16.5 of <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, it is
      possible for the target of a request to be changed by the same proxy
      multiple times (referred to as 'internal retargeting' in <a class='info' href='#requirements'>Section&nbsp;2<span> (</span><span class='info'>Request History Requirements</span><span>)</span></a>), as the proxy MAY add targets to the
      target set after beginning Request Forwarding. Section 16.6 of <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> describes Request Forwarding. It is during this
      process of Request Forwarding that the History Information is captured
      as an optional, additional header field. Thus, the addition of the
      History-Info header does not impact fundamental SIP Request Forwarding.
      An entity (UA or proxy) changing the target of a request in response to
      a redirect or REFER SHOULD also propagate any History-Info header from
      the initial Request in the new request (GENERATION-req,
      FORWARDS-req).
</p>
<a name="optional"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Optionality of History-Info</h3>

<p>The History-Info header is optional in that neither UAs nor Proxies
        are required to support it. A new Supported header, "histinfo", is
        included in the Request send by a UAC to indicate whether the
        History-Info header should be returned in Responses (BACKWARDS-req).
        In addition to the "histinfo" Supported header, local policy
        determines whether or not the header added to any request is
        anonymized (as per <a class='info' href='#RFC3323'>[RFC3323]<span> (</span><span class='info'>Peterson, J., &ldquo;A Privacy Mechanism for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2002.</span><span>)</span></a>).
</p>
<a name="privacy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Ensuring the Privacy of History-Info</h3>

<p>Since the History-Info header can inadvertently reveal information
        about the requestor as described in <a class='info' href='#RFC3323'>[RFC3323]<span> (</span><span class='info'>Peterson, J., &ldquo;A Privacy Mechanism for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2002.</span><span>)</span></a>,
        the Privacy header SHOULD be used to determine whether an intermediary
        can include the History-Info header in a Request that it receives and
        forwards (PRIV-req-2) or that it retargets (PRIV-req-1). Thus, the
        History- Info header SHOULD NOT be included in Requests where the
        requestor has indicated a priv-value of Session- or Header-level
        privacy.
</p>
<p>In addition, the History-Info header can reveal general routing
        information, which may be viewed by a specific intermediary or
        network, to be subject to privacy restrictions. Thus, local policy MAY
        also be used to determine whether to include the History-Info header
        at all, whether to capture a specific Request-URI in the header as is,
        whether it be included only in the Request as it is retargeted within
        a specific domain, or whether it is anonymized when being retargeted
        outside a specific domain (PRIV-req-3). The latter two cases can be
        accomplished with a new priv-value, history, added to the Privacy
        header <a class='info' href='#RFC3323'>[RFC3323]<span> (</span><span class='info'>Peterson, J., &ldquo;A Privacy Mechanism for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2002.</span><span>)</span></a>. The details as to the use of
        the new priv-value with the Privacy header are provided in section
        <a class='info' href='#protocol'>Section&nbsp;4<span> (</span><span class='info'>Request History Information Protocol Details</span><span>)</span></a>.
</p>
<p>It is recognized that satisfying the privacy requirements can
        impact the functionality of this solution by overriding the request to
        generate the information. As with the optionality and security
        requirements, applications making use of History-Info SHOULD address
        any impact this may have or MUST explain why it does not impact the
        application.
</p>
<a name="protocol"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Request History Information Protocol Details</h3>

<p>This section contains the details and usage of the proposed new SIP
      protocol elements. It also discusses the security aspects of the
      solution.
</p>
<a name="structure"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Protocol Structure of History-Info</h3>

<p>History-Info is a header field as defined by <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>. It is an optional header field and MAY
        appear in any request or response not associated with a dialog or
        which starts a dialog. For example, History-Info MAY appear in INVITE,
        REGISTER, MESSAGE, REFER, OPTIONS, SUBSCRIBE, and PUBLISH and any
        valid responses, plus NOTIFY requests that initiate a dialog.
</p>
<p>The History-Info header carries the following information, with the
        mandatory parameters required when the header is included in a request
        or response:
</p>
<p></p>
<ul class="text">
<li>Targeted-to-URI (hi-targeted-to-uri): A mandatory parameter for
            capturing the Request-URI for the specific Request as it is
            forwarded.
</li>
<li>Index (hi-index): A mandatory parameter for History-Info
            reflecting the chronological order of the information, indexed to
            also reflect the forking and nesting of requests. The format for
            this parameter is a string of digits, separated by dots to
            indicate the number of forward hops and retargets. This results in
            a tree representation of the history of the request, with the
            lowest-level index reflecting a branch of the tree. By adding the
            new entries in order (i.e., following existing entries per the
            details in <a class='info' href='#addhi'>Section&nbsp;4.3.3.1<span> (</span><span class='info'>Adding the History-Info Header to Requests </span><span>)</span></a>), including the index and
            securing the header, the ordering of the History-Info headers in
            the request is assured (SEC-req-2). In addition, applications may
            extract a variety of metrics (total number of retargets, total
            number of retargets from a specific branch, etc.) based upon the
            index values.
</li>
<li>Reason: An optional parameter for History-Info, reflected in
            the History-Info header by including the Reason Header <a class='info' href='#RFC3326'>[RFC3326]<span> (</span><span class='info'>Schulzrinne, H., Oran, D., and G. Camarillo, &ldquo;The Reason Header Field for the Session Initiation Protocol (SIP),&rdquo; December&nbsp;2002.</span><span>)</span></a> escaped in the hi-targeted-to-uri. A
            reason is not included for a hi-targeted-to-uri when it is first
            added in a History-Info header, but rather is added when the
            retargeting actually occurs in the same situations in which the
            retarget parameter is added.
</li>
<li>Privacy: An optional parameter for History-Info, reflected in
            the History-Info header field values by including the Privacy
            Header <a class='info' href='#RFC3323'>[RFC3323]<span> (</span><span class='info'>Peterson, J., &ldquo;A Privacy Mechanism for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2002.</span><span>)</span></a> with a priv-value of
            "history" escaped in the hi- targeted-to-uri or by adding the
            Privacy header with a priv-value of "history" to the Request. The
            latter case indicates that the History-Info headers SHOULD be
            anonymized prior to forwarding or they SHOULD NOT be forwarded,
            whereas the use of the Privacy header escaped in the
            hi-targeted-to-uri means that a specific hi-entry SHOULD be
            anonymized or it SHOULD NOT be forwarded. It is RECOMMENDED that
            the entries be anonymized, rather than not forwarded, to minimize
            the impact on applications making use of the History-Info
            header.
</li>
<li>Target (hi-target): A mandatory parameter for the History-Info
            indicating the reason for the new target, based on the procedures
            of 16.5/<a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>. Note that hi-target is not
            added for a hi-entry when it is first added in a History-Info
            header field, but rather is added when the retargeting actually
            occurs - i.e., the parameter indicates that the specific
            hi-targeted-to-uri was retargeted and thus the previous
            information in the request-URI is "lost". Note that retargeting
            only occurs when the hi-targeted-to-uri indicates a domain for
            which the processing entity is responsible. Thus, it would be the
            same processing entity that initially added the hi-targeted-to-URI
            to the header that would be adding the retarget parameter. Upon
            receipt of a request or response containing the History-Info
            header, a UA can determine the "lost" target for a specific
            request by traversing the HI entries in reverse order to find the
            first one tagged with the retarget parameter. The following values
            are defined:
<ul class="text">
<li>"noop": There is no change whatsoever in the target. The
                Request-URI is unchanged. This would apply for example when a
                proxy merely forwards a request to a next hop proxy and loose
                routing is used.
</li>
<li>"predetermined": This is the case where retargeting is
                predetermined by the content of the request itself, i.e., the
                Request-URI contained a maddr, the domain of the Request-URI
                indicates a domain the proxy is not responsible for, or strict
                routing is used and the request is forwarded to another
                proxy.
</li>
<li>"reg-uri": The Request-URI is replaced with a registered
                Contact bound to the AOR indicated by the Request-URI. For
                example, if the REGISTER message had a To header field with
                the AOR &lt;sip:bob@example.com&gt;, and a Contact header
                field of &lt;sip:bob@192.168.0.3&gt; , the Request-URI
                &lt;sip:bob@example.com&gt; would be changed to
                &lt;sip:bob@192.168.0.3&gt;.
</li>
<li>"reg-uri-alias": The Request-URI is replaced with a
                registered Contact bound to an AOR that is an alias of the
                Request-URI. An AOR is an Alias of another AOR if both
                entities belong to the same implicit registration set, are
                linked to the same profile and have the same data configured.
                For example, if
                &lt;sip:+14085551212@example.com;user=phone&gt; and
                &lt;sip:bob.smith@example.com&gt; are configured as aliases
                for the AOR sip:bob@example.com&gt; (where the registered
                Contact of &lt;sip:bob@192.168.0.3&gt; is bound to
                &lt;sip:bob@example.com&gt;, a Request-URI of
                &lt;sip:bob.smith@example.com&gt; or
                &lt;sip:+14085551212@example.com;user=phone&gt; would be
                changed to &lt;sip:bob@192.168.0.3&gt;.
</li>
<li>"mapped": The Request-URI is replaced with another URI that
                is not a Contact associated with the AOR in the Request-URI or
                one of its aliases. For example, this would apply when the
                request is retargeted to a different user.
</li>
<li>
<blockquote class="text">
<p>OPEN ISSUE: The values for hi-target are tentative and
                    are still behing debated. They will be changed to reflect
                    the consensus so that it is meaningful to the applications
                    such as those described in <a class='info' href='#I-D.rosenberg-sip-target-uri-delivery'>[I&#8209;D.rosenberg&#8209;sip&#8209;target&#8209;uri&#8209;delivery]<span> (</span><span class='info'>Rosenberg, J., Elburg, H., Holmberg, C., Audet, F., and S. Schubert, &ldquo;Delivery of Request-URI Targets to User Agents,&rdquo; March&nbsp;2009.</span><span>)</span></a> and
                    is unambigous with regards to SIP terminology in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>. For example, it has been
                    suggested that "noop" and "predetermined" be combined into
                    a single value.
</p>
</blockquote>
</li>
</ul>
</li>
<li>Extension (hi-extension): An optional parameter to allow for
            future optional extensions. As per <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>,
            any implementation not understanding an extension should ignore
            it.
</li>
</ul>

<p>The following summarizes the syntax of the History-Info header,
        based upon the standard SIP syntax <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
History-Info = "History-Info" HCOLON hi-entry *(COMMA hi-entry)

hi-entry = hi-targeted-to-uri SEMI hi-index *(SEMI hi-target)
           *( SEMI hi-extension )

hi-targeted-to-uri = name-addr

hi-index = "index" EQUAL 1*DIGIT *("." 1*DIGIT)

hi-target = "noop" / "predetermined" / "reg-uri"
            / "reg-uri-alias" / "mapped"

hi-extension = generic-param

</pre></div>
<a name="example"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Protocol examples</h3>

<p>The following provides some examples of the History-Info header.
        Note that the backslash and CRLF between the fields in the examples
        below are for readability purposes only.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
History-Info: &lt;sip:UserA@ims.example.com&gt;;index=1;foo=bar

History-Info: &lt;sip:UserA@ims.example.com?Reason=SIP%3B\
              cause%3D302&gt;;index=1.1;mapped,\
              &lt;sip:UserB@example.com?Privacy=history&amp;Reason=SIP%3B\
              cause%3D486&gt;;index=1.2;mapped,\
              &lt;sip:45432@192.168.0.3&gt;;index=1.3;reg-uri</pre></div>
<a name="usage"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Protocol Usage</h3>

<p>This section describes the processing specific to UAs and Proxies
        for the History-Info header, the "histinfo" option tag, and the priv-
        value of "history". As discussed in <a class='info' href='#background'>Section&nbsp;1.3<span> (</span><span class='info'>Background: Why define a Generic Request History Header?</span><span>)</span></a>,
        the fundamental objective is to capture the target Request-URIs as a
        request is forwarded. This allows for the capturing of the history of
        a request that would be lost due to subsequent (re)targeting and
        forwarding. To accomplish this for the entire history of a request,
        either the UAC must capture the Request-URI in a History-Info header
        in the initial request or a proxy must add a History-Info header with
        both a hi-entry for the Request-URI in the initial request and a
        hi-entry for the target Request-URI as the request is forwarded. The
        basic processing is for each entity forwarding a request to add a
        hi-entry for the target Request-URI, updating the index and adding the
        Reason and Retarget parameters as appropriate for any retargeted
        Request-URIs.
</p>
<a name="uac"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1"></a><h3>4.3.1.&nbsp;
User Agent Client (UAC) Behavior</h3>

<p>The UAC SHOULD include the "histinfo" option tag in the Supported
          header in any request not associated with an established dialog for
          which the UAC would like the History-Info header in the response. In
          addition, the UAC MAY add a History-Info header, using the
          Request-URI of the request as the hi-target-to-uri, in which case
          the index MUST be set to a value of 1 in the hi-entry. As a result,
          intermediaries and the UAS will know at least the original
          Request-URI, and if the Request-URI was modified by a previous hop.
          Normally, UACs are not expected to include a History-Info header in
          an initial request as it is more of a Proxy function; the reason it
          is allowed is for B2BUAs who are performing proxy-like functions
          like routing.
</p>
<p>In the case where a UAC receives a 3xx response with a Contact
          header, the UAC SHOULD maintain the previous hi-entry(s) in the
          request. The previous (last) hi-entry in the response SHOULD have a
          an hi-target parameter which had been added by the entity that
          returned the 3xx response, if the entity has implemented this
          specification. If there is no hi-target parameter in the previous
          hi-entry, the UAC MUST NOT add an hi-target parameter to the
          hi-entry.
</p>
<p>In either case, a new hi-entry MUST then be added for the URI
          from the Contact header (which becomes the new Request-URI). In this
          case, the index is created by reading and incrementing the value of
          the index from the previous hi-entry, thus following the same rules
          as those prescribed for a proxy in retargeting, described in <a class='info' href='#indexhi'>Section&nbsp;4.3.3.1.3<span> (</span><span class='info'>Indexing in the History-Info Header</span><span>)</span></a>.
</p>
<p>A UAC that does not want the History-Info header added due to
          privacy considerations MUST include a Privacy header with a
          priv-value(s) of "session", "header", or "history" in the
          request.
</p>
<p>With the exception of the processing of a 3xx response described
          above, the processing of the History-Info header received in the
          Response is application specific and outside the scope of this
          document. However, the validity of the information SHOULD be ensured
          prior to any application usage. For example, the entries can be
          evaluated to determine gaps in indices, which could indicate that an
          entry has been maliciously removed or removed for privacy reasons.
          Either way, an application may want to be aware of potentially
          missing information.
</p>
<a name="uas"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.2"></a><h3>4.3.2.&nbsp;
User Agent Server (UAS) Behavior</h3>

<p>The processing of the information in the History-Info header by a
          UAS in a Request depends upon local policy and specific applications
          at the UAS that might make use of the information. Prior to any
          application usage of the information, the validity SHOULD be
          ascertained. For example, the entries MAY be evaluated to determine
          gaps in indices, which could indicate that an entry has been
          maliciously removed or removed for privacy reasons. Either way, an
          application MAY want to be aware of potentially missing
          information.
</p>
<p>If the "histinfo" option tag is received in a request, the UAS
          MUST include any History-Info received in the request in the
          subsequent response.
</p>
<a name="proxy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.3"></a><h3>4.3.3.&nbsp;
Proxy Behavior</h3>

<a name="addhi"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.3.1"></a><h3>4.3.3.1.&nbsp;
Adding the History-Info Header to Requests </h3>

<p>A proxy conforming to this specification MUST add a hi-entry as
            it forwards a Request. Section 16.6 of <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> defines the steps to be followed as the
            proxy forwards a Request. Step 5 prescribes the addition of
            optional headers. Although this would seem the appropriate step
            for adding the History-Info header, the interaction with Step 6,
            "Postprocess routing information", and the impact of a strict
            route in the Route header could result in the Request-URI being
            changed; thus, adding the History-Info header between Steps 8
            (adding Via header) and 9 (adding Content-Length) is RECOMMENDED.
            Note that in the case of loose routing, the Request-URI does not
            change during the forwarding of a Request; thus, the capturing of
            History-Info for such a request results in duplicate Request-URIs
            with different indices, and with hi-target set to "noop." The
            hi-entry MUST be added following any hi-entry received in the
            request being forwarded. Additionally, if a request is received
            that doesn't include a History-Info header, the proxy MAY add a
            History-Info header with a hi-entry preceding the one being added
            for the current request being forwarded. The index for this
            hi-entry is MUST start at 1. The following subsections define the
            details of creating the information associated with each
            hi-entry.
</p>
<a name="privacyhi"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.3.1.1"></a><h3>4.3.3.1.1.&nbsp;
Privacy in the History-Info Header</h3>

<p>If there is a Privacy header in the request with a priv-value
              of "session", "header", or "history", a hi-entry SHOULD be
              added, if the request is being forwarded to a Request-URI
              associated with a domain for which the processing entity is
              responsible (and provided local policy supports the History-Info
              header, etc.). If a request is being forwarded to a Request-URI
              associated with a domain for which the proxy is not responsible
              and there is a Privacy header in the request with a priv-value
              of "session", "header", or "history", the proxy MAY anonymize
              hi-entry(s) as per <a class='info' href='#RFC3323'>[RFC3323]<span> (</span><span class='info'>Peterson, J., &ldquo;A Privacy Mechanism for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2002.</span><span>)</span></a> prior to
              forwarding, depending upon local policy and whether the proxy
              might know a priori that it can rely on a downstream privacy
              service to apply the requested privacy.
</p>
<p>If a request is being forwarded to a Request-URI associated
              with a domain for which the proxy is not responsible and local
              policy requires privacy associated with any, or with specific,
              hi-entries it has added, any hi-entry with a priv-value of
              "history" SHOULD be anonymized prior to forwarding.
</p>
<a name="reasonhi"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.3.1.2"></a><h3>4.3.3.1.2.&nbsp;
Reason in the History-Info Header</h3>

<p>For retargets that are the result of an explicit SIP
              response, a Reason MUST be associated with the
              hi-targeted-to-uri. If the SIP response does not include a
              Reason header, the SIP Response Code that triggered the
              retargeting MUST be included as the Reason associated with the
              hi-targeted-to-uri that has been retargeted. If the response
              contains a non-SIP Reason header (e.g., Q.850), it MUST be
              captured as an additional Reason associated with the
              hi-targeted-to- uri that has been retargeted, along with the SIP
              Response Code. If the Reason header is a SIP reason, then it
              MUST be used as the Reason associated with the
              hi-targeted-to-uri rather than the SIP response code.
</p>
<p>For retargets as a result of timeouts or internal events, a
              Reason MAY be associated with the hi-targeted-to-uri that has
              been retargeted.
</p>
<p>The addition of the Reason should occur prior to the
              forwarding of the request (which may add a new hi-entry with a
              new hi-targeted-to- uri) as it is associated with the
              hi-targeted-to-uri that has been retargeted, since it reflects
              the reason why the Request to that specific URI was not
              successful.
</p>
<a name="indexhi"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.3.1.3"></a><h3>4.3.3.1.3.&nbsp;
Indexing in the History-Info Header</h3>

<p>In order to maintain ordering and accurately reflect the
              nesting and retargeting of the request, an index MUST be
              included along with the Targeted-to-URI being captured. Per the
              syntax in <a class='info' href='#structure'>Section&nbsp;4.1<span> (</span><span class='info'>Protocol Structure of History-Info</span><span>)</span></a>, the index consists
              of a dot-delimited series of digits (e.g., 1.1.2). Each dot
              reflects a hop or level of nesting; thus, the number of hops is
              determined by the total number of dots. Within each level, the
              integer reflects the number of peer entities to which the
              request has been routed. Thus, the indexing results in a logical
              tree representation for the history of the Request. For each
              level of indexing, the index MUST start at 1. An increment of 1
              MUST be used for advancing to a new branch.
</p>
<p>The basic rules for adding the index are summarized as
              follows: </p>
<ol class="text">
<li>Basic Forwarding: In the case of a Request that is being
                  forwarded, the index is determined by adding another level
                  of indexing since the depth/length of the branch is
                  increasing. To accomplish this, the proxy reads the value
                  from the History-Info header in the received request, if
                  available, and adds another level of indexing by appending
                  the dot delimiter followed by an initial index for the new
                  level of 1. For example, if the index in the last
                  History-Info header field in the received request is 1.1,
                  this proxy would initialize its index to 1.1.1 and forward
                  the request.
</li>
<li>Retargeting within a Proxy - 1st instance: For the first
                  instance of retargeting within a Proxy, the calculation of
                  the index follows that prescribed for basic forwarding.
</li>
<li>Retargeting within a Proxy - subsequent instance: For
                  each subsequent retargeting of a request by the same proxy,
                  another branch is added. With the index for each new branch
                  calculated by incrementing the last/lowest digit at the
                  current level, the index in the next request forwarded by
                  this same proxy, following the example above, would be
                  1.1.2.
</li>
<li>Retargeting based upon a Response: In the case of
                  retargeting due to a specific response (e.g., 302), the
                  index would be calculated per rule 3. That is, the
                  lowest/last digit of the index is incremented (i.e., a new
                  branch is created), with the increment of 1. For example, if
                  the index in the History-Info header of the received request
                  was 1.2, then the index in the History-Info header field for
                  the new hi-targeted- to-URI would be 1.3.
</li>
<li>Retargeting the request in parallel (forking): If the
                  request forwarding is done in parallel, the index MUST be
                  captured for each forked request per the rules above, with
                  each new Request having a unique index. The only difference
                  in the messaging for this scenario and the messaging
                  produced per basic proxy retargeting in rules 2 and 3 is
                  these forwarded requests do not have History-Info entries
                  associated with their peers. The proxy builds the subsequent
                  response (or request) using the aggregated information
                  associated with each of those requests and including the
                  header entries in the order indicated by the indexing.
                  Responses are processed as described in Section 16.7 of
                  <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> with the aggregated
                  History-Info entries processed similar to Step 7 "Aggregate
                  Authentication Header Field Values".
</li>
</ol>

<a name="addtarget"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.3.1.4"></a><h3>4.3.3.1.4.&nbsp;
Request Target in the History-Info Header</h3>

<p>An hi-target attribute MUST be included in a request
              forwarded by a proxy. The addition of the hi-target parameter
              MUST occur prior to the forwarding of the request (which may add
              a new hi-entry with a new hi-targeted-to- uri) as it is
              associated with the hi-targeted-to-uri that has been
              retargeted.
</p>
<p>If the incoming request already contains a History-Info
              header field, and the hi-targeted-to-uri in the last hi-entry is
              identical to the Request-URI of the received request, the proxy
              MUST add a hi-target attribute with value "noop" to that
              hi-entry. In the case that the request did not contain a
              History-Info header, or if the last hi-entry is not identical to
              the Request-URI of the received request, the proxy MUST add
              another History-Info header field value as described in <a class='info' href='#addhi'>Section&nbsp;4.3.3.1<span> (</span><span class='info'>Adding the History-Info Header to Requests </span><span>)</span></a> and MUST add a hi-target attribute to
              this hi-entry.
</p>
<p>If the Request-URI itself predetermined the routing as per
              the procedures of 16.5/<a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, i.e., if
              there was a maddr parameter, or if the domain indicates a domain
              that the proxy is not responsible for, or strict routing is used
              and the request is forwarded to another proxy, the hi-target
              attribute MUST be set to "predetermined."
</p>
<p>If the Request-URI is being replaced with a registered
              Contact header, bound to the AOR indicated by the Request-URI,
              the hi-target attribute MUST be set to "reg-uri."
</p>
<p>If the Request-URI is replaced with a registered Contact
              bound to an AOR that is an alias of the Request-URI, the
              hi-target attribute MUST be set to "reg-uri-alias."
</p>
<p>If the request is being forwarded based on the receipt of a
              3xx response with a Contact header and the previous (last)
              hi-entry already has an hi-target parameter, then another
              hi-target attribute MUST not be added to the hi-entry. This
              would occur in the case of a redirect server that has
              implemented this specification.
</p>
<p>In all other cases, the Request-URI is replaced with another
              URI that is not a Contact associated with the AOR in the
              Request-URI or one of its aliases. In this case, the hi-target
              attribute MUST be set to "mapped."
</p>
<p>The index is set as defined in <a class='info' href='#indexhi'>Section&nbsp;4.3.3.1.3<span> (</span><span class='info'>Indexing in the History-Info Header</span><span>)</span></a>.
</p>
<p>Once the proxy has translated the Request-URI into a contact
              URI based on a location service lookup, it MUST add an
              additional hi-entry containing the Contact URI for each request
              to be forwarded as described in <a class='info' href='#addhi'>Section&nbsp;4.3.3.1<span> (</span><span class='info'>Adding the History-Info Header to Requests </span><span>)</span></a>.
              The hi-target attribute MUST NOT be added to this hi-entry.
</p>
<a name="hiresponse"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.3.2"></a><h3>4.3.3.2.&nbsp;
Sending History-Info in Responses</h3>

<p>A proxy that receives a Request with the "histinfo" option tag
            SHOULD return captured History-Info in subsequent, non-100
            provisional, and final responses to the Request. The proxy MUST
            add the reason to the last hi-entry received in the request to the
            last hi-entry in the response. For non-3XXresponses, the proxy
            MUST NOT add a hi-target attribute to the last hi-entry received
            in the request to the last hi-entry in the response. For 3XX
            response, the proxy MUST add the hi-target attribute to the last
            hi-entry received in the request to the last hi-entry in the
            response per the rules defined in <a class='info' href='#addtarget'>Section&nbsp;4.3.3.1.4<span> (</span><span class='info'>Request Target in the History-Info Header</span><span>)</span></a>.
</p>
<p>The processing of History-Info in responses follows the
            methodology described in Section 16.7 of <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, with the processing of History-Info
            headers adding an additional step, just before Step 9, "Forwarding
            the Response".
</p>
<a name="redirect"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.4"></a><h3>4.3.4.&nbsp;
Redirect Server Behavior</h3>

<p>A redirect server SHOULD include the History-Info headers
          received in the request in the 3XX response. The redirect server
          MUST also add the appropriate hi-target attribute to the last
          hi-entry received in the request to the last hi-entry in the
          response per the rules defined in <a class='info' href='#addtarget'>Section&nbsp;4.3.3.1.4<span> (</span><span class='info'>Request Target in the History-Info Header</span><span>)</span></a>.
</p>
<a name="callflows"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Example Call Flows with History-Info Header</h3>

<p>This section contains some basic call examples using the
        History-Info header, including the use of privacy and the hi-target
        attribute. All the examples in this section are using loose routing
        procedures. If strict routing procedures were used, instead of entries
        with hi-target set to "noop", there would be entries with hi-target
        set to "predetermined" instead.
</p>
<p>The formatting in these scenarios is for visual purposes; thus,
        backslash and CRLF are used between the fields for readability and the
        headers in the URI are not shown properly formatted for escaping.
        Refer to <a class='info' href='#example'>Section&nbsp;4.2<span> (</span><span class='info'>Protocol examples</span><span>)</span></a> for the proper formatting.
        Additional detailed scenarios are available in the <a class='info' href='#appendix'>Appendix&nbsp;A<span> (</span><span class='info'>Detailed call flows</span><span>)</span></a>.
</p>
<a name="basic"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.1"></a><h3>4.4.1.&nbsp;
Basic Call with History-Info</h3>

<p>In this example, Alice (sip:alice@atlanta.example.com) calls Bob
          (sip:bob@biloxi.example.com). Alice's home proxy
          (sip:atlanta.example.com) forwards the request to Bob's proxy
          (sip:biloxi.example.com). When the request arrives at
          sip:biloxi.example.com, it does a location service lookup for
          bob@biloxi.example.com and changes the target of the request to
          Bob's Contact URI provided as part of normal SIP registration.
</p>
<p>One important thing illustrated by this call flow is that without
          History-Info, Bob would "lose" the target information, including any
          parameters in the request URI. Bob can now recover that information
          by looking for the last hi-entry marked as "reg-uri" or
          "reg-uri-alias" hi-target.
</p><br /><hr class="insert" />
<a name="basicFlow"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Alice   atlanta.example.com  biloxi.example.com   Bob
|                |                |                |
|   INVITE sip:bob@biloxi.example.com;p=x          |
|---------------&gt;|                |                |
| Supported: histinfo             |                |
|                |                |                |
|                |   INVITE sip:bob@biloxi.example.com;p=x
|                |---------------&gt;|                |
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1;noop
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1.1
|                |                |                |
|                |                |   INVITE sip:bob@192.0.2.3
|                |                |---------------&gt;|
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1;noop
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1.1;reg-uri
| History-Info: &lt;sip:bob@192.0.2.3&gt;;index=1.1.1
|                |                |                |
|                |                |     200        |
|                |                |&lt;---------------|
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1;noop
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1.1;reg-uri
| History-Info: &lt;sip:bob@192.0.2.3&gt;;index=1.1.1
|                |                |                |
|                |     200        |                |
|                |&lt;---------------|                |
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1;noop
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1.1;reg-uri
| History-Info: &lt;sip:bob@192.0.2.3&gt;;index=1.1.1
|                |                |                |
|     200        |                |                |
|&lt;---------------|                |                |
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1;noop
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1.1;reg-uri
| History-Info: &lt;sip:bob@192.0.2.3;index=1.1.1
|                |                |                |
|     ACK        |                |                |
|---------------&gt;|    ACK         |                |
|                |---------------&gt;|     ACK        |
|                |                |---------------&gt;|
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Basic Call&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="entirePrivacy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.2"></a><h3>4.4.2.&nbsp;
History-Info with Privacy Header</h3>

<p>The next example provides the basic call scenario <a class='info' href='#basic'>Section&nbsp;4.4.1<span> (</span><span class='info'>Basic Call with History-Info</span><span>)</span></a> using one of the privacy mechanisms, with
          sip:biloxi.example.com adding the Privacy header indicating that the
          History-Info header information is anonymized outside the
          biloxi.example.com domain. This scenario highlights the potential
          functionality lost with the use of "history" privacy in the Privacy
          header for the entire request and the need for careful consideration
          on the use of privacy for History-Info.
</p><br /><hr class="insert" />
<a name="entirePrivacyFlow"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Alice   atlanta.example.com  biloxi.example.com   Bob
|                |                |                |
|   INVITE sip:bob@biloxi.example.com;p=x          |
|---------------&gt;|                |                |
| Supported: histinfo             |                |
|                |                |                |
|                |   INVITE sip:bob@biloxi.example.com;p=x
|                |---------------&gt;|                |
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1;noop
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1.1
|                |                |                |
|                |                | INVITE sip:bob@192.0.2.3
|                |                |---------------&gt;|
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1;noop
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1.1;reg-uri
| History-Info: &lt;sip:bob@192.0.2.3&gt;;index=1.1.1
|                |                |                |
|                |                |     200        |
|                |                |&lt;---------------|
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1;noop
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1.1;reg-uri
| History-Info: &lt;sip:bob@192.0.2.3&gt;;index=1.1.1
|                |                |                |
|                |     200        |                |
|                |&lt;---------------|                |
| History-Info: &lt;sip:anonymous@anonymous.invalid&gt;;index=1;noop
| History-Info: &lt;sip:anonymous@anonymous.invalid&gt;;index=1.1;reg-uri
| History-Info: &lt;sip:anonymous@anonymous.invalid&gt;;index=1.1.1
|                |                |                |
|     200        |                |                |
|&lt;---------------|                |                |
| History-Info: &lt;sip:anonymous@anonymous.invalid&gt;;index=1;noop
| History-Info: &lt;sip:anonymous@anonymous.invalid&gt;;index=1.1;reg-uri
| History-Info: &lt;sip:anonymous@anonymous.invalid&gt;;index=1.1.1
|                |                |                |
|     ACK        |                |                |
|---------------&gt;|    ACK         |                |
|                |---------------&gt;|     ACK        |
|                |                |---------------&gt;|
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Example with Privacy Header&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="entryPrivacy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.3"></a><h3>4.4.3.&nbsp;
Privacy Header for a Specific History-Info Entry</h3>

<p>This example also provides the basic call scenario <a class='info' href='#basic'>Section&nbsp;4.4.1<span> (</span><span class='info'>Basic Call with History-Info</span><span>)</span></a> using one of the privacy mechanisms, however,
          due to local policy at sip:biloxi.example.com, only the final
          hi-entry in the History-Info, which is Bob's local URI, contains a
          priv-value of "history", thus providing Alice with some information
          about the history of the request, but anonymizing Bob's local
          URI.
</p><br /><hr class="insert" />
<a name="entryPrivacyFlow"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Alice   atlanta.example.com  biloxi.example.com   Bob
|                |                |                |
|   INVITE sip:bob@biloxi.example.com;p=x          |
|---------------&gt;|                |                |
| Supported: histinfo             |                |
|                |                |                |
|                |   INVITE sip:bob@biloxi.example.com;p=x
|                |---------------&gt;|                |
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1;noop
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1.1
|                |                |                |
|                |                |   INVITE sip:bob@192.0.2.3
|                |                |---------------&gt;|
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1;noop
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1.1;reg-uri
| History-Info: &lt;sip:bob@192.0.2.3?Privacy=history&gt;;index=1.1.1
|                |                |                |
|                |                |     200        |
|                |                |&lt;---------------|
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1;noop
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1.1;reg-uri
| History-Info: &lt;sip:bob@192.0.2.3?Privacy=history&gt;;index=1.1.1
|                |                |                |
|                |     200        |                |
|                |&lt;---------------|                |
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1;noop
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1.1;reg-uri
| History-Info: &lt;sip:anonymous@anynymous.invalid&gt;;index=1.1.1
|                |                |                |
|     200        |                |                |
|&lt;---------------|                |                |
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1;noop
| History-Info: &lt;sip:bob@biloxi.example.com;p=x&gt;;index=1.1;reg-uri
| History-Info: &lt;sip:anonymous@anynymous.invalid&gt;;index=1.1.1
|                |                |                |
|     ACK        |                |                |
|---------------&gt;|    ACK         |                |
|                |---------------&gt;|     ACK        |
|                |                |---------------&gt;|

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Example with Privacy Header for Specific URI&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="application"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Application Considerations</h3>

<p>As seen by the example scenarios in the <a class='info' href='#appendix'>Appendix&nbsp;A<span> (</span><span class='info'>Detailed call flows</span><span>)</span></a>, History-Info provides a very flexible
      building block that can be used by intermediaries and UAs for a variety
      of services. As such, any services making use of History-Info must be
      designed with the following considerations:
</p>
<p></p>
<ol class="text">
<li>History-Info is optional; thus, a service MUST define default
          behavior for requests and responses not containing History-Info
          headers.
</li>
<li>History-Info may be impacted by privacy considerations.
          Applications requiring History-Info need to be aware that if
          Header-, Session-, or History-level privacy is requested by a UA (or
          imposed by an intermediary) that History-Info may not be available
          in a request or response. This would be addressed by an application
          in the same manner as the previous consideration by ensuring there
          is reasonable default behavior should the information not be
          available.
</li>
<li>History-Info may be impacted by local policy. Each application
          making use of the History-Info header SHOULD address the impacts of
          the local policies on the specific application (e.g., what
          specification of local policy is optimally required for a specific
          application and any potential limitations imposed by local policy
          decisions). Note that this is related to the optionality and privacy
          considerations identified in 1 and 2 above, but goes beyond that.
          For example, due to the optionality and privacy considerations, an
          entity may receive only partial History-Info entries; will this
          suffice? Note that this would be a limitation for debugging
          purposes, but might be perfectly satisfactory for some models
          whereby only the information from a specific intermediary is
          required.
</li>
</ol>

<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>This document defines a new header for SIP. The use of the Transport
      Layer Security (TLS) protocol <a class='info' href='#RFC5246'>[RFC5246]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a> as a
      mechanism to ensure the overall confidentiality of the History-Info
      headers (SEC- req-4) is strongly RECOMMENDED. This results in
      History-Info having at least the same level of security as other headers
      in SIP that are inserted by intermediaries. With TLS, History-Info
      headers are no less, nor no more, secure than other SIP headers, which
      generally have even more impact on the subsequent processing of SIP
      sessions than the History-Info header.
</p>
<p>With the level of security provided by TLS (SEC-req-3), the
      information in the History-Info header can thus be evaluated to
      determine if information has been removed by evaluating the indices for
      gaps (SEC-req-1, SEC-req-2). It would be up to the application to define
      whether it can make use of the information in the case of missing
      entries.
</p>
<p>Note that while using the SIPS scheme (as per <a class='info' href='#I-D.ietf-sip-sips'>[I&#8209;D.ietf&#8209;sip&#8209;sips]<span> (</span><span class='info'>Audet, F., &ldquo;The use of the SIPS URI Scheme in the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2008.</span><span>)</span></a>) protects History-Info from tampering
      by arbitrary parties outside the SIP message path, all the
      intermediaries on the path are trusted implicitly. A malicious
      intermediary could arbitrarily delete, rewrite, or modify History- Info.
      This specification does not attempt to prevent or detect attacks by
      malicious intermediaries.
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>This document requires several IANA registrations detailed in the
      following sections.
</p>
<a name="header"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Registration of New SIP History-Info Header</h3>

<p>This document defines a new SIP header field name: History-Info and
        a new option tag: histinfo. The following changes have been made to
        http:///www.iana.org/assignments/sip-parameters The following row has
        been added to the header field section:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Header Name             Compact Form               Reference
-----------             ------------               ---------
History-Info               none                    [RFCXXXX]

</pre></div>
<p>The following has been added to the Options Tags section:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Name          Description                          Reference
----          -----------                          ---------
histinfo      When used with the Supported header, [RFCXXXX]
              this option tag indicates the UAC
              supports the History Information to be
              captured for requests and returned in
              subsequent responses.  This tag is not
              used in a Proxy-Require or Require
              header field since support of
              History-Info is optional.

</pre></div>
<p>Note to RFC Editor: Please replace RFC XXXX with the RFC number of
        this specification.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Registration of &quot;history&quot; for SIP Privacy Header</h3>

<p>This document defines a new priv-value for the SIP Privacy header:
        history The following changes have been made to
        http://www.iana.org/assignments/sip-priv-values The following has been
        added to the registration for the SIP Privacy header:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Name      Description               Registrant   Reference
----      -----------               ----------   ---------
history   Privacy requested for     Mary Barnes  [RFCXXXX]
          History-Info header(s)    mary.barnes@nortel.com

</pre></div>
<p>Note to RFC Editor: Please replace RFC XXXX with the RFC number of
        this specification.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Contributors</h3>

<p>Cullen Jennings, Mark Watson, and Jon Peterson contributed to the
      development of the initial requirements for <a class='info' href='#RFC4244'>[RFC4244]<span> (</span><span class='info'>Barnes, M., &ldquo;An Extension to the Session Initiation Protocol (SIP) for Request History Information,&rdquo; November&nbsp;2005.</span><span>)</span></a>.
</p>
<p>Jonathan Rosenberg produced the initial document that provided the
      basis for the addition of the "target" parameter to the History-Info
      header, as well as some content for this document.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Acknowledgements</h3>

<p>The editor would like to acknowledge the constructive feedback
      provided by Robert Sparks, Paul Kyzivat, Scott Orton, John Elwell, Nir
      Chen, Palash Jain, Brian Stucker, Norma Ng, Anthony Brown, Jayshree
      Bharatia, Jonathan Rosenberg, Eric Burger, Martin Dolly, Roland Jesske,
      Takuya Sawada, Sebastien Prouvost, and Sebastien Garcin in the
      development of <a class='info' href='#RFC4244'>[RFC4244]<span> (</span><span class='info'>Barnes, M., &ldquo;An Extension to the Session Initiation Protocol (SIP) for Request History Information,&rdquo; November&nbsp;2005.</span><span>)</span></a>. The editor would like to
      acknowledge the significant input from Rohan Mahy on some of the
      normative aspects of the ABNF for <a class='info' href='#RFC4244'>[RFC4244]<span> (</span><span class='info'>Barnes, M., &ldquo;An Extension to the Session Initiation Protocol (SIP) for Request History Information,&rdquo; November&nbsp;2005.</span><span>)</span></a>,
      particularly around the need for and format of the index and around the
      security aspects.
</p>
<p>Many thanks to Hans Eric Van Elburg, Christer Holmberg and Shida
      Shubert for the help on this update to <a class='info' href='#RFC4244'>[RFC4244]<span> (</span><span class='info'>Barnes, M., &ldquo;An Extension to the Session Initiation Protocol (SIP) for Request History Information,&rdquo; November&nbsp;2005.</span><span>)</span></a>,
      especially regarding the requirements for preserving target-URI
      information all the way to the UAS. Thanks to Ian Elz for his feedback
      on privacy.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Changes since last Version</h3>

<p>NOTE TO THE RFC-Editor: Please remove this section prior to
      publication as an RFC.
</p>
<p>Changes from RFC4244 to individual -00:</p>
<ol class="text">
<li>Clarified that HI captures both retargeting as well as cases of
          just forwarding a request.
</li>
<li>Added descriptions of the usage of the terms "retarget",
          "forward" and "redirect" to the terminology section.
</li>
<li>Added additional examples for the functionality provided by HI
          for core SIP.
</li>
<li>Added hi-target parameter values to HI header to ABNF and
          protocol description, as well as defining proxy, UAC and UAS
          behavior for the parameter.
</li>
<li>Simplified example call flow in section 4.5. Moved previous call
          flow to appendix.
</li>
<li>Fixed ABNF per RFC4244 errata "dot" -&gt; "." and added new
          parameter.
</li>
<li>Fixed all the examples. Made sure loose routing was used in all
          of them.
</li>
<li>Removed example where a proxy using strict routing is using
          History-Info for avoiding trying same route twice.
</li>
<li>Remove redundant Redirect Server example.
</li>
<li>Index are now mandated to start at "1" instead of
          recommended.
</li>
<li>Clarified 3xx behavior as the entity sending the 3XX response
          MUST add the hi-target attribute to the previous hi-entry to ensure
          that it is appropriately tagged (i.e., it's the only one that knows
          how the contact in the 3xx was determined.)
</li>
<li>Removed lots of ambiguity by making many "MAYs" into "SHOULDs"
          and "some "SHOULDs" into "MUSTs".
</li>
<li>Privacy is now recommended to be done by anonymizing entries as
          per RFC 3323 instead of by removing or omitting hi-entry(s).
</li>
<li>Requirement for TLS is now same level as per RFC 3261.
</li>
</ol>

<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3261">[RFC3261]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3326">[RFC3326]</a></td>
<td class="author-text">Schulzrinne, H., Oran, D., and G. Camarillo, &ldquo;<a href="http://tools.ietf.org/html/rfc3326">The Reason Header Field for the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;3326, December&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3326.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3323">[RFC3323]</a></td>
<td class="author-text">Peterson, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3323">A Privacy Mechanism for the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;3323, November&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3323.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5246">[RFC5246]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>,&rdquo; RFC&nbsp;5246, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5246.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4244">[RFC4244]</a></td>
<td class="author-text">Barnes, M., &ldquo;<a href="http://tools.ietf.org/html/rfc4244">An Extension to the Session Initiation Protocol (SIP) for Request History Information</a>,&rdquo; RFC&nbsp;4244, November&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4244.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sip-gruu">[I-D.ietf-sip-gruu]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-gruu-15.txt">Obtaining and Using Globally Routable User Agent (UA) URIs (GRUU) in the  Session Initiation Protocol (SIP)</a>,&rdquo; draft-ietf-sip-gruu-15 (work in progress), October&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-gruu-15.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sip-sips">[I-D.ietf-sip-sips]</a></td>
<td class="author-text">Audet, F., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-sips-09.txt">The use of the SIPS URI Scheme in the Session Initiation Protocol (SIP)</a>,&rdquo; draft-ietf-sip-sips-09 (work in progress), November&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-sips-09.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.rosenberg-sip-target-uri-delivery">[I-D.rosenberg-sip-target-uri-delivery]</a></td>
<td class="author-text">Rosenberg, J., Elburg, H., Holmberg, C., Audet, F., and S. Schubert, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-rosenberg-sip-target-uri-delivery-01.txt">Delivery of Request-URI Targets to User Agents</a>,&rdquo; draft-rosenberg-sip-target-uri-delivery-01 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-rosenberg-sip-target-uri-delivery-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3087">[RFC3087]</a></td>
<td class="author-text">Campbell, B. and R. Sparks, &ldquo;<a href="http://tools.ietf.org/html/rfc3087">Control of Service Context using SIP Request-URI</a>,&rdquo; RFC&nbsp;3087, April&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3087.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4240">[RFC4240]</a></td>
<td class="author-text">Burger, E., Van Dyke, J., and A. Spitzer, &ldquo;<a href="http://tools.ietf.org/html/rfc4240">Basic Network Media Services with SIP</a>,&rdquo; RFC&nbsp;4240, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4240.txt">TXT</a>).</td></tr>
</table>

<a name="appendix"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Detailed call flows</h3>

<p>The scenarios in this section provide sample use cases for the
      History-Info header for informational purposes only. They are not
      intended to be normative.
</p>
<a name="fork"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Sequentially Forking (History-Info in Response)</h3>

<p>This scenario highlights an example where the History-Info in the
        response is useful to an application or user that originated the
        request.
</p>
<p>Alice sends a call to Bob via sip:example.com. The proxy
        sip:example.com sequentially tries Bob on a SIP UA that has bound a
        contact with the sip:bob@example.com AOR, and then several alternate
        addresses (Office and Home) unsuccessfully before sending a response
        to Alice. In this example, note that Office and Home are not the same
        AOR as sip:bob@example.com, but rather different AORs that have been
        configured as alternate contacts for Bob in the proxy. In other words,
        Office and Bob are not bound through SIP Registration with Bob's AOR.
        This type of arrangement is common for example when a "routing" rule
        to a PSTN number is manually configured in a Proxy.
</p>
<p>This scenario is provided to show that by providing the
        History-Info to Alice, the end-user or an application at Alice could
        make a decision on how best to attempt finding Bob. Without this
        mechanism, Alice might well attempt Office (and thus Home) and then
        re-attempt Home on a third manual attempt at reaching Bob. With this
        mechanism, either the end-user or application could know that Bob is
        not answering in the Office, and his busy on his home phone. If there
        were an alternative address for Bob known to this end-user or
        application, that hasn't been attempted, then either the application
        or the end- user could attempt that. The intent here is to highlight
        an example of the flexibility of this mechanism that enables
        applications well beyond SIP as it is certainly well beyond the scope
        of this document to prescribe detailed applications.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Alice   example.com            Bob     Office    Home
|            |                  |        |        |
| INVITE F1  |                  |        |        |
|-----------&gt;|    INVITE F2     |        |        |
|            |-----------------&gt;|        |        |
| 100 Trying F3                 |        |        |
|&lt;-----------|  302 Move Temporarily F4  |        |
|            |&lt;-----------------|        |        |
|            |   ACK F5         |        |        |
|            |-----------------&gt;|        |        |
|            |       INVITE F6           |        |
|            |--------------------------&gt;|        |
|            |      180 Ringing F7       |        |
|            |&lt;--------------------------|        |
|  180 Ringing F8                        |        |
|&lt;-----------|   retransmit INVITE       |        |
|            |--------------------------&gt;|        |
|            |      ( timeout )          |        |
|            |             INVITE F9              |
|            |-----------------------------------&gt;|
|            |           100 Trying F10           |
|            |&lt;-----------------------------------|
|            |           486 Busy Here F11        |
|            |&lt;-----------------------------------|
|  486 Busy Here F12                              |
|&lt;-----------|             ACK F13                |
|            |-----------------------------------&gt;|
|  ACK F14   |                                    |
|-----------&gt;|                                    |

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>Message Details

F1 INVITE alice -&gt; example.com

INVITE sip:alice@example.com SIP/2.0
Via: SIP/2.0/TCP 192.0.2.3:5060
From: Alice &lt;sip:alice@example.com&gt;
To: Bob &lt;sip:bob@example.com&gt;
Supported: histinfo
Call-Id: 12345600@example.com
CSeq: 1 INVITE
Contact: Alice &lt;sip:alice@192.0.2.3&gt;
Content-Type: application/sdp
Content-Length: &lt;appropriate value&gt;
&lt;!-- SDP Not Shown --&gt;

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>F2 INVITE  example.com -&gt; Bob

INVITE sip:bob@192.0.2.4 SIP/2.0
Via: SIP/2.0/TCP proxy.example.com:5060
Via: SIP/2.0/TCP 192.0.2.3:5060
From: Alice &lt;sip:alice@example.com&gt;
To: Bob &lt;sip:bob@example.com&gt;
Supported: histinfo
Call-Id: 12345600@example.com
CSeq: 1 INVITE
Record-Route: &lt;sip:proxy.example.com;lr&gt;
History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
History-Info: &lt;sip:bob@192.0.2.4&gt;;index=1.1
Contact: Alice &lt;sip:alice@192.0.2.3&gt;
Content-Type: application/sdp
Content-Length: &lt;appropriate value&gt;
&lt;!-- SDP Not Shown --&gt;

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>F3 100 Trying example.com -&gt; alice

SIP/2.0 100 Trying
Via: SIP/2.0/TCP 192.0.2.3:5060
From: Alice &lt;sip:alice@example.com&gt;
To: Bob &lt;sip:bob@example.com&gt;
Call-Id: 12345600@example.com
CSeq: 1 INVITE
Content-Length: 0

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>F4 302 Moved Temporarily Bob -&gt; example.com

SIP/2.0 302 Moved Temporarily
Via: SIP/2.0/TCP proxy.example.com:5060
Via: SIP/2.0/TCP 192.0.2.3:5060
From: Alice &lt;sip:alice@example.com&gt;
To: Bob &lt;sip:bob@example.com&gt;;tag=3
Call-Id: 12345600@example.com
CSeq: 1 INVITE
Record-Route: &lt;sip:proxy.example.com;lr&gt;
History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
History-Info: &lt;sip:bob@192.0.2.4&gt;;index=1.1
Contact: &lt;sip:office@example.com&gt;
Content-Length: 0

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>F5 ACK 192.0.2.4 -&gt; Bob

ACK sip:home@example.com SIP/2.0
Via: SIP/2.0/TCP proxy.example.com:5060
From: Alice &lt;sip:alice@example.com&gt;
To: Bob &lt;sip:bob@example.com&gt;
Call-Id: 12345600@example.com
CSeq: 1 ACK
Content-Length: 0

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>F6 INVITE example.com -&gt; office

INVITE sip:office@192.0.2.3.com SIP/2.0
Via: SIP/2.0/TCP proxy.example.com:5060;branch=2
Via: SIP/2.0/TCP 192.0.2.3:5060
From: Alice &lt;sip:alice@example.com&gt;
To: Bob &lt;sip:bob@example.com&gt;
Supported: histinfo
Call-Id: 12345600@example.com
Record-Route: &lt;sip:proxy.example.com;lr&gt;
History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
History-Info: &lt;sip:bob@192.0.2.4?Reason=SIP;cause=302&gt;;\
              index=1.1;mapped
History-Info: &lt;sip:office@example.com&gt;;index=1.2;reg-uri
History-Info: &lt;sip:office@192.0.2.5&gt;;index=1.2.1
CSeq: 1 INVITE
Contact: Alice &lt;sip:alice@192.0.2.3&gt;
Content-Type: application/sdp
Content-Length: &lt;appropriate value&gt;
&lt;!-- SDP Not Shown --&gt;

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>F7 180 Ringing office -&gt; example.com

SIP/2.0 180 Ringing
Via: SIP/2.0/TCP proxy.example.com:5060;branch=2
Via: SIP/2.0/TCP 192.0.2.3:5060
From: Alice &lt;sip:alice@example.com&gt;
To: Bob &lt;sip:bob@example.com&gt;;tag=5
Supported: histinfo
Call-ID: 12345600@example.com
Record-Route: &lt;sip:proxy.example.com;lr&gt;
History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
History-Info: &lt;sip:bob@192.0.2.4?Reason=SIP;cause=302&gt;;\
              index=1.1;mapped
History-Info: &lt;sip:office@example.com&gt;;index=1.2;reg-uri
History-Info: &lt;sip:office@192.0.2.5&gt;;index=1.2.1
CSeq: 1 INVITE
Content-Length: 0

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>F8 180 Ringing example.com -&gt; alice

SIP/2.0 180 Ringing
Via: SIP/2.0/TCP example.com:5060
From: Alice &lt;sip:alice@example.com&gt;
To: Bob &lt;sip:bob@example.com&gt;
Supported: histinfo
Call-Id: 12345600@example.com
History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
History-Info: &lt;sip:bob@192.0.2.4?Reason=SIP;cause=302&gt;;\
              index=1.1;mapped
History-Info: &lt;sip:office@example.com&gt;;index=1.2;reg-uri
History-Info: &lt;sip:office@192.0.2.5&gt;;index=1.2.1
CSeq: 1 INVITE
Content-Length: 0

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>F9 INVITE example.com -&gt; home

INVITE sip:home@192.0.2.6 SIP/2.0
Via: SIP/2.0/TCP proxy.example.com:5060;branch=3
Via: SIP/2.0/TCP 192.0.2.3:5060
From: Alice &lt;sip:alice@example.com&gt;
To: Bob &lt;sip:bob@example.com&gt;
Supported: histinfo
Call-Id: 12345600@example.com
Record-Route: &lt;sip:proxy.example.com;lr&gt;
History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
History-Info: &lt;sip:bob@192.0.2.4?Reason=SIP;cause=302&gt;;\
              index=1.1;mapped
History-Info: &lt;sip:office@example.com&gt;;index=1.2;reg-uri
History-Info: &lt;sip:office@192.0.2.5?Reason=SIP;cause=480&gt;;\
              index=1.2.1;mapped
History-Info: &lt;sip:home@example.com&gt;;index=1.3;reg-uri
History-Info: &lt;sip:home@192.0.2.6&gt;;index=1.3.1
CSeq: 1 INVITE
Contact: Alice &lt;sip:alice@192.0.2.3&gt;
Content-Type: application/sdp
Content-Length: &lt;appropriate value&gt;
&lt;!-- SDP Not Shown --&gt;

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>F10 100 Trying home -&gt; example.com

SIP/2.0 100 Trying
Via: SIP/2.0/TCP proxy.example.com:5060;branch=3
Via: SIP/2.0/TCP 192.0.2.3:5060
From: Alice &lt;sip:alice@example.com&gt;
To: Bob &lt;sip:bob@example.com&gt;
Call-Id: 12345600@example.com
CSeq: 1 INVITE
Content-Length: 0

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>F11 486 Busy Here home -&gt; example.com

SIP/2.0  486 Busy Here
Via: SIP/2.0/TCP proxy.example.com:5060;branch=3
Via: SIP/2.0/TCP 192.0.2.3:5060
From: Alice &lt;sip:alice@example.com&gt;
To: Bob &lt;sip:bob@example.com&gt;
Call-Id: 12345600@example.com
Record-Route: &lt;sip:proxy.example.com;lr&gt;
History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
History-Info: &lt;sip:bob@192.0.2.4?Reason=SIP;cause=302&gt;;\
              index=1.1;mapped
History-Info: &lt;sip:office@example.com&gt;;index=1.2;reg-uri
History-Info: &lt;sip:office@192.0.2.5?Reason=SIP;cause=480&gt;;\
              index=1.2.1;mapped
History-Info: &lt;sip:home@example.com&gt;;index=1.3;reg-uri
History-Info: &lt;sip:home@192.0.2.6&gt;;index=1.3.1
CSeq: 1 INVITE
Content-Length: 0

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>F12 486 Busy Here example.com -&gt; alice

SIP/2.0  486 Busy Here
Via: SIP/2.0/TCP 192.0.2.3:5060
From: Alice &lt;sip:alice@example.com&gt;
To: Bob &lt;sip:bob@example.com&gt;
Call-Id: 12345600@example.com
History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
History-Info: &lt;sip:bob@192.0.2.4?Reason=SIP;cause=302&gt;;\
              index=1.1;mapped
History-Info: &lt;sip:office@example.com&gt;;index=1.2;reg-uri
History-Info: &lt;sip:office@192.0.2.5?Reason=SIP;cause=480&gt;;\
              index=1.2.1;mapped
History-Info: &lt;sip:home@example.com&gt;;index=1.3;reg-uri
History-Info: &lt;sip:home@192.0.2.6&gt;;index=1.3.1
CSeq: 1 INVITE
Content-Length: 0

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>F13 ACK example.com -&gt; home

ACK sip:home@example.com SIP/2.0
Via: SIP/2.0/TCP proxy.example.com:5060
From: Alice &lt;sip:alice@example.com&gt;
To: Bob &lt;sip:bob@example.com&gt;
Call-Id: 12345600@example.com
CSeq: 1 ACK
Content-Length: 0

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>F14 ACK alice -&gt; example.com

ACK sip:bob@example.com SIP/2.0
Via: SIP/2.0/TCP 192.0.2.3:5060
From: Alice &lt;sip:alice@example.com&gt;
To: Bob &lt;sip:bob@example.com&gt;
Call-Id: 12345600@example.com
Route: &lt;sip:proxy.example.com;lr&gt;
CSeq: 1 ACK
Content-Length: 0

</pre></div>
<a name="voicemail"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Voicemail</h3>

<p>This scenario highlights an example where the History-Info in the
        request is primarily of use by an edge service (e.g., voicemail
        server). It should be noted that this is not intended to be a complete
        specification for this specific edge service as it is quite likely
        that additional information is needed by the edge service.
        History-Info is just one building block that this service makes use
        of.
</p>
<p>Alice called Bob, which had been forwarded to Carol, which
        forwarded to VM (voicemail server). Based upon the retargeted URIs and
        Reasons (and other information) in the INVITE, the VM server makes a
        policy decision about what mailbox to use, which greeting to play,
        etc.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Alice      example.com       Bob          Carol        VM

| INVITE sip:bob@example.com  |             |          |
|-------------&gt;|              |             |          |
|              | INVITE sip:bob@192.0.2.3   |          |
|              |-------------&gt;|             |          |
  History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
  History-Info: &lt;sip:bob@192.0.2.3&gt;;index=1.1
|              |              |             |          |
|  100 Trying  |              |             |          |
|&lt;-------------| 302 Moved Temporarily      |          |
|              |&lt;-------------|             |          |
  History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
  History-Info: &lt;sip:bob@192.0.2.3&gt;;index=1.1
|              |              |             |          |
|              | INVITE sip:Carol@192.0.2.4 |          |
|              |---------------------------&gt;|          |
  History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
  History-Info: &lt;sip:bob@192.0.2.3&gt;;index=1.1;mapped
  History-Info: &lt;sip:carol@example.com&gt;;index=2;reg-uri
  History-Info: &lt;sip:carol@192.0.2.4&gt;;index=2.1
|              |              |             |          |
|              |         180 Ringing        |          |
|              |&lt;---------------------------|          |
  History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
  History-Info: &lt;sip:bob@192.0.2.3&gt;;index=1.1;mapped
  History-Info: &lt;sip:carol@example.com&gt;;index=2;reg-uri
  History-Info: &lt;sip:carol@192.0.2.4&gt;;index=2.1
|              |              |             |          |
| 180 Ringing  |              |             |          |
|&lt;-------------|              |             |          |
|              |              |             |          |
|  . . .       |      retransmit INVITE     |          |
|              |---------------------------&gt;|          |
  History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
  History-Info: &lt;sip:bob@192.0.2.3&gt;;index=1.1;mapped
  History-Info: &lt;sip:carol@example.com&gt;;index=2;reg-uri
  History-Info: &lt;sip:carol@192.0.2.4&gt;;index=2.1
|  . . .       |              |             |          |
|              |       (timeout)            |          |
|              |              |             |          |
|              | INVITE sip:vm@192.0.2.5               |
|              |--------------------------------------&gt;|
  History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
  History-Info: &lt;sip:bob@192.0.2.3&gt;;index=1.1;mapped
  History-Info: &lt;sip:carol@example.com&gt;;index=2;reg-uri
  History-Info: &lt;sip:carol@192.0.2.4&gt;;index=2.1;mapped
  History-Info: &lt;sip:vm@example.com&gt;;index=3;reg-uri
  History-Info: &lt;sip:vm@192.0.2.5&gt;;index=3.1
|              |              |             |          |
|              |               200 OK                  |
|              |&lt;--------------------------------------|
  History-Info: &lt;sip:bob@example.com&gt;;index=1;reg-uri
  History-Info: &lt;sip:bob@192.0.2.3&gt;;index=1.1;mapped
  History-Info: &lt;sip:carol@example.com&gt;;index=2;reg-uri
  History-Info: &lt;sip:carol@192.0.2.4&gt;;index=2.1;mapped
  History-Info: &lt;sip:vm@example.com&gt;;index=3;reg-uri
  History-Info: &lt;sip:vm@192.0.2.5&gt;;index=3.1
|   200 OK     |              |             |          |
|&lt;-------------|              |             |          |
|              |              |             |          |
|     ACK      |              |             |          |
|-------------&gt;|                    ACK                |
|              |--------------------------------------&gt;|

</pre></div>
<a name="acd"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Automatic Call Distribution</h3>

<p>This scenario highlights an example of an Automatic Call
        Distribution service, where the agents are divided into groups based
        upon the type of customers they handle. In this example, the Gold
        customers are given higher priority than Silver customers, so a Gold
        call would get serviced even if all the agents servicing the Gold
        group were busy, by retargeting the request to the Silver Group for
        delivery to an agent. Upon receipt of the call at the agent assigned
        to handle the incoming call, based upon the History-Info header in the
        message, the application at the agent can provide an indication that
        this is a Gold call, from how many groups it might have overflowed
        before reaching the agent, etc. and thus can be handled appropriately
        by the agent.
</p>
<p>For scenarios whereby calls might overflow from the Silver to the
        Gold, clearly the alternate group identification, internal routing, or
        actual agent that handles the call should not be sent to UA1. Thus,
        for this scenario, one would expect that the Proxy would not support
        the sending of the History-Info in the response, even if requested by
        Alice.
</p>
<p>As with the other examples, this is not prescriptive of how one
        would do this type of service but an example of a subset of processing
        that might be associated with such a service. In addition, this
        example is not addressing any aspects of Agent availability, which
        might also be done via a SIP interface.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Alice       example.com     Gold          Silver       Agent

|              |              |             |            |
| INVITE sip:Gold@example.com |             |            |
|-------------&gt;|              |             |            |
| Supported: histinfo
|              |              |             |            |
|              |  INVITE sip:Gold@example.com            |
|              |-------------&gt;|             |            |
  History-Info: &lt;sip:Gold@example.com&gt;;index=1;noop
  History-Info: &lt;sip:Gold@gold.example.com&gt;;index=1.1
|              |              |             |            |
|              |  302 Moved Temporarily     |            |
|              |&lt;-------------|             |            |
  History-Info: &lt;sip:Gold@example.com&gt;;index=1;noop
  History-Info: &lt;sip:Gold@gold.example.com&gt;;index=1.1
  Contact: &lt;sip:Silver@example.com&gt;
               |              |             |            |
|              |  INVITE sip:Silver@example.com          |
|              |---------------------------&gt;|            |
  History-Info: &lt;sip:Gold@example.com&gt;;index=1;noop
  History-Info: &lt;sip:Gold@gold.example.com?Reason=SIP;cause=302&gt;;\
                index=1.1;mapped
  History-Info: &lt;sip:Silver@example.com&gt;;index=2;noop
  History-Info: &lt;sip:Silver@silver.example.com&gt;;index=2.1
|              |              |             |            |
|              |              | INVITE sip:Silver@192.0.2.7
|              |              |             |-----------&gt;|
  History-Info: &lt;sip:Gold@example.com&gt;;index=1;noop
  History-Info: &lt;sip:Gold@gold.example.com?Reason=SIP;cause=302&gt;;\
                index=1.1;mapped
  History-Info: &lt;sip:Silver@example.com&gt;;index=2;noop
  History-Info: &lt;sip:Silver@silver.example.com&gt;;index=2.1;reg-id
  History-Info: &lt;sip:Silver@192.0.2.7&gt;;index=2.1.1&gt;
|              |              |             |            |
|              |              |             |  200 OK    |
|              |              |             |&lt;-----------|
  History-Info: &lt;sip:Gold@example.com&gt;;index=1;noop
  History-Info: &lt;sip:Gold@gold.example.com?Reason=SIP;cause=302&gt;;\
                index=1.1;mapped
  History-Info: &lt;sip:Silver@example.com&gt;;index=2;noop
  History-Info: &lt;sip:Silver@silver.example.com&gt;;index=2.1;reg-id
  History-Info: &lt;sip:Silver@192.0.2.7&gt;;index=2.1.1&gt;
|              |              |             |            |
|              |         200 OK             |            |
|              |&lt;---------------------------|            |
  History-Info: &lt;sip:Gold@example.com&gt;;index=1;noop
  History-Info: &lt;sip:Gold@gold.example.com?Reason=SIP;cause=302&gt;;\
                index=1.1;mapped
  History-Info: &lt;sip:Silver@example.com&gt;;index=2;noop
  History-Info: &lt;sip:Silver@silver.example.com&gt;;index=2.1;reg-id
  History-Info: &lt;sip:Silver@192.0.2.7&gt;;index=2.1.1&gt;
|              |              |             |            |
   200 OK      |              |             |            |
|&lt;-------------|              |             |            |
|              |              |             |            |
|    ACK       |              |             |            |
|-------------&gt;|                  ACK                    |
|              |----------------------------------------&gt;|

</pre></div>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mary Barnes</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nortel</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Richardson, TX  </td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mary.barnes@nortel.com">mary.barnes@nortel.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Francois Audet</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nortel</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">4655 Great America Parkway</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Santa Clara, CA  95054</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:audet@nortel.com">audet@nortel.com</a></td></tr>
</table>
</body></html>
