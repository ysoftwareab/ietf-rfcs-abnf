



EXTRA                                                       K. Murchison
Internet-Draft                                               B. Gondwana
Updates: 5230, 5435 (if approved)                               FastMail
Intended status: Standards Track                         August 12, 2018
Expires: February 13, 2019


                Sieve Extension: File Carbon Copy (Fcc)
                     draft-ietf-extra-sieve-fcc-04

Abstract

   The Sieve Email Filtering Language provides a number of action
   commands, some of which can generate additional messages on behalf of
   the user.  This document defines an extension to such commands to
   allow a copy of any generated message to be filed into a target
   mailbox.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on February 13, 2019.

Copyright Notice

   Copyright (c) 2018 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of




Murchison & Gondwana    Expires February 13, 2019               [Page 1]

Internet-Draft                  Sieve Fcc                    August 2018


   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Conventions Used in This Document . . . . . . . . . . . . . .   3
   3.  Tagged Argument ":fcc"  . . . . . . . . . . . . . . . . . . .   3
     3.1.  Format of Filed Messages  . . . . . . . . . . . . . . . .   3
     3.2.  Interaction with the Vacation Action  . . . . . . . . . .   4
     3.3.  Interaction with the Notify Action  . . . . . . . . . . .   5
       3.3.1.  Notification-Capability "fcc" . . . . . . . . . . . .   5
     3.4.  Compatibility with Other Actions  . . . . . . . . . . . .   6
     3.5.  Interaction with Fileinto Extensions  . . . . . . . . . .   6
       3.5.1.  Imap4flags Extension  . . . . . . . . . . . . . . . .   6
       3.5.2.  Mailbox Extension . . . . . . . . . . . . . . . . . .   7
       3.5.3.  Special-Use Extension . . . . . . . . . . . . . . . .   7
       3.5.4.  Extended Example  . . . . . . . . . . . . . . . . . .   7
   4.  Implementation Status . . . . . . . . . . . . . . . . . . . .   8
   5.  Security Considerations . . . . . . . . . . . . . . . . . . .   8
   6.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   8
     6.1.  Registration of Sieve Extension . . . . . . . . . . . . .   8
     6.2.  Registration of Notification-Capability
           Parameter . . . . . . . . . . . . . . . . . . . . . . . .   9
   7.  Acknowledgments . . . . . . . . . . . . . . . . . . . . . . .   9
   8.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   9
     8.1.  Normative References  . . . . . . . . . . . . . . . . . .   9
     8.2.  Informative References  . . . . . . . . . . . . . . . . .  11
     8.3.  URIs  . . . . . . . . . . . . . . . . . . . . . . . . . .  11
   Appendix A.  Change History (To be removed by RFC Editor before
                publication) . . . . . . . . . . . . . . . . . . . .  12
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  13

1.  Introduction

   The Sieve Email Filtering Language [RFC5228] provides a number of
   action commands, some of which can generate additional messages on
   behalf of the user.  It is sometimes desirable to have an archive of
   the messages generated by these commands.

   This extension defines a new optional tagged argument ":fcc" to
   action commands which generate additional messages to allow a copy of
   the generated message to be filed into a target mailbox.

   The capability string associated with this extension is "fcc".

   Each action that generates additional messages will need to specify
   how it interfacts with :fcc.  This document also specifies the



Murchison & Gondwana    Expires February 13, 2019               [Page 2]

Internet-Draft                  Sieve Fcc                    August 2018


   interaction of :fcc with the Vacation [RFC5230] and Notify [RFC5435]
   extensions.

2.  Conventions Used in This Document

   Conventions for notations are as in Section 1.1 of [RFC5228],
   including use of the "Usage:" label for the definition of action and
   tagged arguments syntax.

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14 [1] [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

3.  Tagged Argument ":fcc"

   For convenience, the "FCC" syntax element is defined here using ABNF
   [RFC4234] so that it can be augmented by other extensions.

   FCC = ":fcc" <mailbox: string>

   If the optional ":fcc" argument is specified with an action that
   generates an additional message, it instructs the Sieve interpreter
   to file a copy of the generated message into the target mailbox.  The
   syntax and semantics of the mailbox argument MUST match those of the
   mailbox argument to the "fileinto" action specified in Section 4.1 of
   [RFC5228].  If the specified mailbox doesn't exist, the
   implementation MAY treat it as an error, create the mailbox, or file
   the message into an implementation-defined mailbox.

3.1.  Format of Filed Messages

   Copies of messages filed into a mailbox via this extension are
   REQUIRED to be in Internet Message Format [RFC5322].  Some messages
   generated by Sieve actions might already conform to this format and
   MAY be filed without modification.  Messages generated in other
   formats MUST be encapsulated using constructs from [RFC5322] and MIME
   ([RFC2045], [RFC2046], [RFC2047]).

   The general requirements for encapsulating the copies of messages to
   be filed are the following:

   o  Date: The Date header field is REQUIRED and SHOULD be set to the
      date and time when the message was generated.






Murchison & Gondwana    Expires February 13, 2019               [Page 3]

Internet-Draft                  Sieve Fcc                    August 2018


   o  From: The From header field is REQUIRED and SHOULD be set to the
      email address of the owner of the Sieve script, unless explicitly
      overridden by rules for encapsulating a particular message type.

   o  To: The To header field is OPTIONAL and MAY be set to the email
      address of the recipient of the generated message, if available.

   o  Subject: The Subject header field is OPTIONAL and MAY be generated
      as follows: The subject is set to the characters "Fcc: " followed
      by the subject of the message being processed by the Sieve
      interpreter.

   o  In-Reply-To: The In-Reply-To header field is OPTIONAL and MAY be
      set to the Message-ID of the message being processed by the Sieve
      interpreter.

   o  Message Body: The body of the filed message is REQUIRED and is
      composed of one or more MIME-parts containing the generated
      message and any related metadata.  The Content-Type header
      field(s) MUST be set to the appropriate MIME types.  If any of the
      MIME-parts include 8-bit or binary data, the Content-Transfer-
      Encoding header field(s) MUST be set accordingly.

3.2.  Interaction with the Vacation Action

   This document extends the "vacation" [RFC5230] action (see also
   "vacation-seconds" [RFC6131]) to optionally store a copy of the auto-
   reply messages into a target mailbox.

   Usage:   vacation [FCC]
                     [":days" number | ":seconds" number]
                     [":subject" string]
                     [":from" string]
                     [":addresses" string-list]
                     [":mime"]
                     [":handle" string]
                     <reason: string>

   Example:

   require ["vacation", "fcc"];

   vacation :days 7
            :from "hemingway@example.com" "Gone Fishin'"
            :fcc "INBOX.Sent";

   Vacation auto-reply messages are MIME-compliant and MAY be filed into
   the target mailbox without modification.



Murchison & Gondwana    Expires February 13, 2019               [Page 4]

Internet-Draft                  Sieve Fcc                    August 2018


3.3.  Interaction with the Notify Action

   This document extends the "notify" [RFC5435] action to optionally
   store a copy of the notification messages into a target mailbox.

   Usage:   notify [FCC]
                   [":from" string]
                   [":importance" <"1" / "2" / "3">]
                   [":options" string-list]
                   [":message" string]
                   <method: string>

   Example:

   require ["enotify", "fcc"];

   notify :fcc "INBOX.Sent"
          :message "You got mail!"
          "mailto:ken@example.com";

   Messages generated using the "mailto" [RFC5436] notification method
   are MIME-compliant and MAY be filed into the target mailbox without
   modification.

   Messages generated by other notification methods (e.g. "xmpp"
   [RFC5437]) MUST be encapsulated per Section 3.1 before being filed.
   The body of the filed message MUST include the :message parameter and
   MAY include one or more of the :from, :importance, or :options
   parameters.  The MIME-type(s) of the body part(s) used to encapsulate
   the parameters is an implementation decision.

   An implementation MAY only support :fcc in conjunction with a subset
   of the notification methods it supports.  An error occurs if :fcc is
   combined with a notification method that doesn't support it.
   Notification methods that support :fcc can be discovered at run-time
   using the mechanism described below (Section 3.3.1).

3.3.1.  Notification-Capability "fcc"

   This document defines a new notification-capability value "fcc" for
   use with the notify_method_capability test (see Section 5 of
   [RFC5435].  For the "fcc" notification-capability, the
   notify_method_capability test can match one of the following key-list
   values:

   yes  A copy of the notification message sent using the method
      identified by the notification-uri can be filed into a target
      mailbox.



Murchison & Gondwana    Expires February 13, 2019               [Page 5]

Internet-Draft                  Sieve Fcc                    August 2018


   no A copy of the notification message sent using the method
      identified by the notification-uri can not be filed into a target
      mailbox.

   Example:

   require ["enotify", "fcc"];

   if notify_method_capability "xmpp:" "Fcc" "yes" {
       notify :fcc "INBOX.Sent"
              :message "You got mail"
              "xmpp:ken@example.com?message;subject=SIEVE";
   } else {
       notify :fcc "INBOX.Sent"
              :message "You got mail!"
              "mailto:ken@example.com";
   }

3.4.  Compatibility with Other Actions

   The "fcc" extension is not compatible with any Sieve action that does
   not generate an additional message on behalf of the user.  It is an
   error for a script to use the ":fcc" tagged argument with any such
   action.

   Future extensions that define actions that generate additional
   messages on behalf of the user should describe their compatibility
   with ":fcc", and how to MIME-encapsulate the message, if required.

3.5.  Interaction with Fileinto Extensions

   The "fcc" extension can be used with some tagged arguments defined in
   extensions to the "fileinto" action.  The sections below describe its
   interaction with currently defined extensions.  Tagged arguments in
   future extensions to the "fileinto" command should describe their
   interaction with ":fcc", if any.

   When any "fileinto" extension arguments are used with ":fcc", the
   MUST have the same syntax and semantics as they do with "fileinto".

3.5.1.  Imap4flags Extension

   This document extends the definition of the ":flags" [RFC5232] tagged
   argument so that it can optionally be used with the ":fcc" argument.

   FCC =/ [":flags" <list-of-flags: string-list>]





Murchison & Gondwana    Expires February 13, 2019               [Page 6]

Internet-Draft                  Sieve Fcc                    August 2018


   If the optional ":flags" argument is specified with ":fcc", it
   instructs the Sieve interpreter to set the IMAP4 flags provided in
   the subsequent argument when the generated message is filed into the
   target mailbox.

3.5.2.  Mailbox Extension

   This document extends the definition of the ":create" [RFC5490]
   tagged argument so that it can optionally be used with the ":fcc"
   argument.

   FCC =/ [":create"]

   If the optional ":create" argument is specified with ":fcc", it
   instructs the Sieve interpreter to create the target mailbox, if
   needed, before attempting to file the generated message into the
   target mailbox.

3.5.3.  Special-Use Extension

   This document extends the definition of the ":specialuse"
   [I-D.ietf-extra-sieve-special-use] tagged argument so that it can
   optionally be used with the ":fcc" argument.

   FCC =/ [":specialuse" <special-use-flag: string>]

   If the optional ":specialuse" argument is specified with ":fcc", it
   instructs the Sieve interpreter to check whether a mailbox exists
   with the specific special-use flag assigned to it.  If such a mailbox
   exists, the generated message is filed into the special-use mailbox.
   Otherwise, the generated message is filed into the target mailbox.

   If both the optional ":specialuse" and ":create" arguments are
   specified with ":fcc", the Sieve interpreter is instructed to create
   the target mailbox per Section 4.1 of
   [I-D.ietf-extra-sieve-special-use], if needed.

3.5.4.  Extended Example

require ["vacation", "fcc", "mailbox", "special-use", "imap4flags"];

vacation :days 7
         :from "hemingway@example.com" "Gone Fishin'"
         :fcc "INBOX.Sent" :specialuse "\\Sent" :create :flags ["\\Seen"];







Murchison & Gondwana    Expires February 13, 2019               [Page 7]

Internet-Draft                  Sieve Fcc                    August 2018


4.  Implementation Status

   < RFC Editor: before publication please remove this section and the
   reference to [RFC7942] >

   This section records the status of known implementations of the
   protocol defined by this specification at the time of posting of this
   Internet-Draft, and is based on a proposal described in [RFC7942].
   The description of implementations in this section is intended to
   assist the IETF in its decision processes in progressing drafts to
   RFCs.  Please note that the listing of any individual implementation
   here does not imply endorsement by the IETF.  Furthermore, no effort
   has been spent to verify the information presented here that was
   supplied by IETF contributors.  This is not intended as, and must not
   be construed to be, a catalog of available implementations or their
   features.  Readers are advised to note that other implementations may
   exist.

   According to [RFC7942], "this will allow reviewers and working groups
   to assign due consideration to documents that have the benefit of
   running code, which may serve as evidence of valuable experimentation
   and feedback that have made the implemented protocols more mature.
   It is up to the individual working groups to use this information as
   they see fit".

4.1.  Cyrus Server

   The open source Cyrus Server [2] project is a highly scalable
   enterprise mail system which supports Sieve email filtering at the
   point of final delivery.  This production level Sieve implementation
   supports all of the requirements described in this document.  This
   implementation is freely distributable under a BSD style license from
   Computing Services at Carnegie Mellon University [3].

5.  Security Considerations

   The "fcc" extension does not raise any other security considerations
   that are not already present in [RFC5228], [RFC5230], [RFC5435], and
   [RFC6131].

6.  IANA Considerations

6.1.  Registration of Sieve Extension

      To: iana@iana.org

      Subject: Registration of new Sieve extension




Murchison & Gondwana    Expires February 13, 2019               [Page 8]

Internet-Draft                  Sieve Fcc                    August 2018


      Capability name: fcc

      Description: Adds the ":fcc" parameter to Sieve action commands
      that generate additional messages.

      RFC number: RFC XXXX

      Contact address: The Sieve discussion list <sieve@ietf.org>

6.2.  Registration of Notification-Capability Parameter

      To: iana@iana.org

      Subject: Registration of a new notification-capability parameter

      Capability name: fcc

      Description: Returns whether a copy of the notification message
      sent using the method identified by the notification-uri parameter
      to the notify_method_capability test can be filed into a target
      mailbox.

      Syntax: Can contain one of two values: "yes" or "no".  Values MUST
      be in lowercase.

      Permanent and readily available reference(s): This RFC

      Contact information: The Sieve discussion list <ietf-mta-
      filters@imc.org>

7.  Acknowledgments

   The authors would like to thank the following individuals for
   contributing their ideas and support for writing this specification:
   Ned Freed, Stan Kalisch, and Alexey Melnikov.

8.  References

8.1.  Normative References

   [I-D.ietf-extra-sieve-special-use]
              Bosch, S., "Sieve Email Filtering: Delivering to Special-
              Use Mailboxes", draft-ietf-extra-sieve-special-use-02
              (work in progress), March 2018.







Murchison & Gondwana    Expires February 13, 2019               [Page 9]

Internet-Draft                  Sieve Fcc                    August 2018


   [RFC2045]  Freed, N. and N. Borenstein, "Multipurpose Internet Mail
              Extensions (MIME) Part One: Format of Internet Message
              Bodies", RFC 2045, DOI 10.17487/RFC2045, November 1996,
              <https://www.rfc-editor.org/info/rfc2045>.

   [RFC2046]  Freed, N. and N. Borenstein, "Multipurpose Internet Mail
              Extensions (MIME) Part Two: Media Types", RFC 2046,
              DOI 10.17487/RFC2046, November 1996,
              <https://www.rfc-editor.org/info/rfc2046>.

   [RFC2047]  Moore, K., "MIME (Multipurpose Internet Mail Extensions)
              Part Three: Message Header Extensions for Non-ASCII Text",
              RFC 2047, DOI 10.17487/RFC2047, November 1996,
              <https://www.rfc-editor.org/info/rfc2047>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC4234]  Crocker, D., Ed. and P. Overell, "Augmented BNF for Syntax
              Specifications: ABNF", RFC 4234, DOI 10.17487/RFC4234,
              October 2005, <https://www.rfc-editor.org/info/rfc4234>.

   [RFC5228]  Guenther, P., Ed. and T. Showalter, Ed., "Sieve: An Email
              Filtering Language", RFC 5228, DOI 10.17487/RFC5228,
              January 2008, <https://www.rfc-editor.org/info/rfc5228>.

   [RFC5230]  Showalter, T. and N. Freed, Ed., "Sieve Email Filtering:
              Vacation Extension", RFC 5230, DOI 10.17487/RFC5230,
              January 2008, <https://www.rfc-editor.org/info/rfc5230>.

   [RFC5232]  Melnikov, A., "Sieve Email Filtering: Imap4flags
              Extension", RFC 5232, DOI 10.17487/RFC5232, January 2008,
              <https://www.rfc-editor.org/info/rfc5232>.

   [RFC5322]  Resnick, P., Ed., "Internet Message Format", RFC 5322,
              DOI 10.17487/RFC5322, October 2008,
              <https://www.rfc-editor.org/info/rfc5322>.

   [RFC5435]  Melnikov, A., Ed., Leiba, B., Ed., Segmuller, W., and T.
              Martin, "Sieve Email Filtering: Extension for
              Notifications", RFC 5435, DOI 10.17487/RFC5435, January
              2009, <https://www.rfc-editor.org/info/rfc5435>.







Murchison & Gondwana    Expires February 13, 2019              [Page 10]

Internet-Draft                  Sieve Fcc                    August 2018


   [RFC5490]  Melnikov, A., "The Sieve Mail-Filtering Language --
              Extensions for Checking Mailbox Status and Accessing
              Mailbox Metadata", RFC 5490, DOI 10.17487/RFC5490, March
              2009, <https://www.rfc-editor.org/info/rfc5490>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

8.2.  Informative References

   [RFC5321]  Klensin, J., "Simple Mail Transfer Protocol", RFC 5321,
              DOI 10.17487/RFC5321, October 2008,
              <https://www.rfc-editor.org/info/rfc5321>.

   [RFC5429]  Stone, A., Ed., "Sieve Email Filtering: Reject and
              Extended Reject Extensions", RFC 5429,
              DOI 10.17487/RFC5429, March 2009,
              <https://www.rfc-editor.org/info/rfc5429>.

   [RFC5436]  Leiba, B. and M. Haardt, "Sieve Notification Mechanism:
              mailto", RFC 5436, DOI 10.17487/RFC5436, January 2009,
              <https://www.rfc-editor.org/info/rfc5436>.

   [RFC5437]  Saint-Andre, P. and A. Melnikov, "Sieve Notification
              Mechanism: Extensible Messaging and Presence Protocol
              (XMPP)", RFC 5437, DOI 10.17487/RFC5437, January 2009,
              <https://www.rfc-editor.org/info/rfc5437>.

   [RFC6131]  George, R. and B. Leiba, "Sieve Vacation Extension:
              "Seconds" Parameter", RFC 6131, DOI 10.17487/RFC6131, July
              2011, <https://www.rfc-editor.org/info/rfc6131>.

   [RFC7942]  Sheffer, Y. and A. Farrel, "Improving Awareness of Running
              Code: The Implementation Status Section", BCP 205,
              RFC 7942, DOI 10.17487/RFC7942, July 2016,
              <https://www.rfc-editor.org/info/rfc7942>.

8.3.  URIs

   [1] https://tools.ietf.org/html/bcp14

   [2] http://www.cyrusimap.org/

   [3] http://www.cmu.edu/computing/






Murchison & Gondwana    Expires February 13, 2019              [Page 11]

Internet-Draft                  Sieve Fcc                    August 2018


Appendix A.  Change History (To be removed by RFC Editor before
             publication)

   Changes since draft-ietf-extra-sieve-fcc-03:

   o  Fixed typo in ABNF.

   Changes since draft-ietf-extra-sieve-fcc-02:

   o  Updated Keywords boilerplate.

   o  Noted that :fcc mailbox argument and any fileinto extension
      arguments used wth :fcc have the same syntax and semantics as they
      have with fileinto.

   o  Removed section on [e]Reject.

   o  Added "fcc" notification-capability.

   o  Added Implementation Status section.

   o  Editorial changes from Ned Freed.

   Changes since draft-ietf-extra-sieve-fcc-01:

   o  Added text discussing how to handle generated messages that are
      not in MIME format.

   o  Adjusted ABNF so that tagged arguments that supplement :fcc no
      longer appear as positional.

   Changes since draft-ietf-extra-sieve-fcc-00:

   o  Updated abstract with text from Ned.

   o  Added support for :fcc to notify extension.

   o  Prohibit use of :fcc with reject and ereject extensions.

   o  Added registration of the extension with IANA.

   o  Added Acknowledgments.

   o  Minor editorial changes.







Murchison & Gondwana    Expires February 13, 2019              [Page 12]

Internet-Draft                  Sieve Fcc                    August 2018


Authors' Addresses

   Kenneth Murchison
   FastMail US LLC
   1315 Walnut Street - Suite 320
   Philadelphia, PA  19107
   USA

   Email: murch@fastmailteam.com


   Bron Gondwana
   FastMail Pty Ltd
   Level 2, 114 William Street
   Melbourne, VIC  3000
   Australia

   Email: brong@fastmailteam.com

































Murchison & Gondwana    Expires February 13, 2019              [Page 13]
