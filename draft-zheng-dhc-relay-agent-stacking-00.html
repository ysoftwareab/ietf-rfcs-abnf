<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>DHCP Relay Agent Stacking</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="DHCP Relay Agent Stacking">
<meta name="keywords" content="option 82, stacking, Relay Agent Option, DHCP">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Dynamic Host Configuration WG</td><td class="header">R. Zheng</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">H. Li</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Z. Zhang</td></tr>
<tr><td class="header">Expires: April 22, 2010</td><td class="header">Huawei Technologies</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 19, 2009</td></tr>
</table></td></tr></table>
<h1><br />DHCP Relay Agent Stacking<br />draft-zheng-dhc-relay-agent-stacking-00</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 22, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>According to RFC 3046, there is only one DHCP Option 82 allowed in a
      certain DHCP message. This document describes several cases that need
      more than one Relay Agent to add link information. Proposed method is to
      have different Relay Agents add multiple DHCP Option 82.
</p>
<h3>Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>, &ldquo;,&rdquo; .</span><span>)</span></a> [RFC2119].
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#Intro">1.</a>&nbsp;
Introduction<br />
<a href="#Design">2.</a>&nbsp;
Multi-level Access Loop Identification Scenarios<br />
<a href="#specification">3.</a>&nbsp;
Stacking DHCP Option 82 Syntax<br />
<a href="#anchor1">4.</a>&nbsp;
Agent Operation<br />
<a href="#anchor2">5.</a>&nbsp;
Applicability<br />
<a href="#anchor3">6.</a>&nbsp;
Security Considerations<br />
<a href="#anchor4">7.</a>&nbsp;
IANA Consideration<br />
<a href="#rfc.references1">8.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="Intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>In a typical DSL access network, DHCP Relay Agent Option is used to
      carry the access loop identification, which identifies the access loop
      of the user and is useful for troubleshooting and policy management
      functions. In FTTC/FTTB scenarios of PON system, there are multiple
      subscribers behind an ONU and both OLT and ONU's slot/port information
      are needed to identify a use accurately. However, a DHCP Relay Agent
      does NOT add a "second" relay agent option, when it receives a DHCP
      packet with a Relay Agent Information option already present from a
      trusted circuit, according to chapter 2.1 of <a class='info' href='#RFC3046'>[RFC3046]<span> (</span><span class='info'>IETF, &ldquo;DHCP Relay Agent Information Option,&rdquo; January&nbsp;2001.</span><span>)</span></a>.
</p>
<p>As described in<a class='info' href='#draft-huang-dhc-relay-ps-00'>[draft&#8209;huang&#8209;dhc&#8209;relay&#8209;ps&#8209;00]<span> (</span><span class='info'>IETF, &ldquo;Line identification in IPv6 Router Solicitation           messages,&rdquo; July &nbsp;2009.</span><span>)</span></a>,
      when a layer 3 switch is installed for a 20 floor building and a layer 2
      switch is installed at each floor inside this building, there is a
      policy delivery problem if only one relay agent inserts access loop
      identification.
</p>
<p>If we define a new sub-option, DHCP Relay Agents appending access
      loop identification to existing DHCP Option 82 will have to identify the
      information inserted by other Relay Agents previously, which is
      complicated. Another reason not to do so, is that some options can't be
      changed because of the signature. Define a new option x is also a bad
      choice because of incompatibility with legacy device.
</p>
<p>What is proposed is to insert multiple DHCP Option 82 to a DHCP
      packet. Stacking DHCP Option 82 is much simpler and is able to void the
      problems mentioned above.
</p>
<a name="Design"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Multi-level Access Loop Identification Scenarios</h3>

<p>There are at least two cases where multi-level access loop
      identification is needed to be carried in DHCP packets.
</p>
<p>A typical PON FTTB/FTTC network includes OLT, ONU and ODN, as
      depicted in figure 1. ONU can be Multi-Dwelling Unit (MDU) or
      Multi-Tenant Unit (MTU). In this case, ONU provides network access for
      multiple residential users or multiple business users via DSL or
      Ethernet typically. In order to locate a user precisely from a DHCP
      message via Option 82, ONU need add a user's access loop identification
      on which port the user is attached, while OLT need add PON port where
      the ONU is attached. Therefore, two DHCP Relay Agents reside in ONU and
      OLT respectively.
</p>
<p><br /><hr class="insert" />
<a name="PON"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 +---------+
 |AAA      |
 |server   |       /---\                               +-------+
 +---------+     /-/   \\                              |       |----User
           \     |      |                            / |  MDU  |
          +------+      \    +-------+    +-----+  /   |       |----User
          |BRAS  |Layer 2\   |OLT    |    |ODN  |/     +-------+
          |/BNG  |network----|       |----|     |\
          +------+       |   +-------+    +-----+ \   +-------+
             |  |        |                         \  |       |----User
  +--------+ /   \\       |                          \|  MTU  |
  |DHCP    |/     \-------/                           |       |----User
  |server  |                                          +-------+
  +--------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: FTTB/FTTC network with PON&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p>Another case is cascaded LAN system, which port information of
      multi-level LAN switches is needed to locate a user. There is more
      information of this case in<a class='info' href='#draft-huang-dhc-relay-ps-00'>[draft&#8209;huang&#8209;dhc&#8209;relay&#8209;ps&#8209;00]<span> (</span><span class='info'>IETF, &ldquo;Line identification in IPv6 Router Solicitation           messages,&rdquo; July &nbsp;2009.</span><span>)</span></a>. Figure 2 depicts an
      example of this case. Both curb switch and floor switch need add access
      loop identifier to DHCP Option 82. That means there are two levels of
      DHCP Relay Agents.
</p>
<p><br /><hr class="insert" />
<a name="LAN"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                /--------\
              /-/        \\
              |           \\      +--------+    +--------+
  +------+    |            \\     |        |    |        |----User
  |DHCP  |----| Aggregation \\----|curb    |----|floor   |
  |server|    | network      |    |switch  |    |switch  |
  +------+    |             //    |        |    |        |----User
              \\          /-/     +--------+    +--------+
               \-\       //
                 \-------/
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Cascaded LAN access system&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<a name="specification"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Stacking DHCP Option 82 Syntax</h3>

<p>There is no change to the syntax specified in <a class='info' href='#RFC3046'>[RFC3046]<span> (</span><span class='info'>IETF, &ldquo;DHCP Relay Agent Information Option,&rdquo; January&nbsp;2001.</span><span>)</span></a>(DHCP Relay Agent Information Option) in a
      Type-Length-Value format.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Agent Operation</h3>

<p>A trusted circuit of a DHCP Relay Agent is attached by a trusted
      downstream (closer to client) network element, which is between the
      current DHCP Relay Agent and the client. The current DHCP Relay Agent
      MAY add a DHCP relay agent option but not set the giaddr field. In the
      case of multi-level DHCP Relay Agent, the current DHCP Relay Agent can
      add a "second" relay agent option to a DHCP packet that has a DHCP relay
      agent option which was added by a trusted DHCP Relay Agent attached to
      the trusted circuit. The DHCP packet will further be forwarded per
      normal DHCP relay agent operations, setting the giaddr field as it deems
      appropriate.
</p>
<p>A DHCP relay agent adding a Relay Agent Information field SHALL
      always add it as the last option (but before 'End Option' 255, if
      present) in the DHCP options field of any recognized BOOTP or DHCP
      packet. When there are multiple DHCP Option 82 in a packet, the options
      should be arranged in the order of time sequence.
</p>
<p>The Relay Agent Information option echoed by a server MUST be removed
      by either the relay agent or the trusted downstream network element
      which added it when forwarding a server-to-client response back to the
      client. If there are multiple DHCP Option 82 in a DHCP packet, Option 82
      added previously will become the last option (but before 'End Option'
      255, if present) in the DHCP options field after last option82 is
      striped.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Applicability</h3>

<p>Option 82 stacking is practicable in the scenario of multiple Relay
      Agents between DHCP client and DHCP server. Multiple Relay Agents are
      especially common in FTTB/FTTC with PON or multi-level switches based
      access network.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>This document has no security effect on current mechanism in
      addressing security attacks.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Consideration</h3>

<p>No requests to IANA.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text">&ldquo;<a href="http://tools.ietf.org/rfc/rfc2119.txt"></a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3046">[RFC3046]</a></td>
<td class="author-text">IETF, &ldquo;<a href="http://tools.ietf.org/rfc/rfc3046.txt">DHCP Relay Agent Information Option</a>,&rdquo; January&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="draft-huang-dhc-relay-ps-00">[draft-huang-dhc-relay-ps-00]</a></td>
<td class="author-text">IETF, &ldquo;<a href="http://tools.ietf.org/id/draft-krishnan-6man-rs-mark-03.txt">Line identification in IPv6 Router Solicitation
          messages</a>,&rdquo; July &nbsp;2009.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ruobin Zheng</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Shenzhen,   </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86-755-28972352</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:robin@huawei.com">robin@huawei.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href=""></a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hongyu Li</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Shenzhen,   </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86-755-28973567</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:lihy@huawei.com">lihy@huawei.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href=""></a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Zhongjian Zhang</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Shenzhen,   </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86-755-28978503</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:zhangzhongjian@huawei.com">zhangzhongjian@huawei.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href=""></a></td></tr>
</table>
</body></html>
