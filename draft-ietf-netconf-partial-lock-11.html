<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Partial Lock RPC for NETCONF</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Partial Lock RPC for NETCONF">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">NETCONF</td><td class="header">B. Lengyel</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Ericsson</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">M. Bjorklund</td></tr>
<tr><td class="header">Expires: April 23, 2010</td><td class="header">Tail-f Systems</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 20, 2009</td></tr>
</table></td></tr></table>
<h1><br />Partial Lock RPC for NETCONF<br />draft-ietf-netconf-partial-lock-11</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 23, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>The NETCONF protocol defines the lock and unlock RPCs, used to
                lock entire configuration datastores. In some situations, a way
                to lock only parts of a configuration 
                datastore is required. This document defines a capability-based extension to 
                the NETCONF protocol for locking portions of a configuration datastore. 
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Definition of Terms<br />
<a href="#anchor3">2.</a>&nbsp;
Partial Locking Capability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.1.1.</a>&nbsp;
Usage Scenarios<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">2.2.</a>&nbsp;
Dependencies<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">2.3.</a>&nbsp;
Capability Identifier<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">2.4.</a>&nbsp;
New Operations<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#partial-lock-operation">2.4.1.</a>&nbsp;
&lt;partial-lock><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">2.4.2.</a>&nbsp;
&lt;partial-unlock><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">2.5.</a>&nbsp;
Modifications to Existing Operations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">2.6.</a>&nbsp;
Interactions with Other Capabilities<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">2.6.1.</a>&nbsp;
Candidate Configuration Capability<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">2.6.2.</a>&nbsp;
Confirmed Commit Capability<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">2.6.3.</a>&nbsp;
Distinct Startup Capability<br />
<a href="#anchor19">3.</a>&nbsp;
Security Considerations<br />
<a href="#anchor20">4.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor21">5.</a>&nbsp;
Appendix A  -  XML Schema for Partial Locking (normative)<br />
<a href="#anchor22">6.</a>&nbsp;
Appendix B  - YANG Module for Partial Locking (non-normative)<br />
<a href="#anchor23">7.</a>&nbsp;
Appendix C - Usage Example - Reserving nodes for future editing (non-normative)<br />
<a href="#anchor24">8.</a>&nbsp;
Appendix D  -  Change Log<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">8.1.</a>&nbsp;
10-11<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">8.2.</a>&nbsp;
09-10<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">8.3.</a>&nbsp;
08-09<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">8.4.</a>&nbsp;
07-08<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">8.5.</a>&nbsp;
06-07<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor30">8.6.</a>&nbsp;
05-06<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">8.7.</a>&nbsp;
04-05<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">8.8.</a>&nbsp;
03-04<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor33">8.9.</a>&nbsp;
02-03<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor34">8.10.</a>&nbsp;
01-02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor35">8.11.</a>&nbsp;
00-01<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor36">8.12.</a>&nbsp;
-00<br />
<a href="#anchor37">9.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
            The <a class='info' href='#NETCONF'>[NETCONF]<span> (</span><span class='info'>Enns, R., &ldquo;NETCONF Configuration Protocol,&rdquo; December&nbsp;2006.</span><span>)</span></a> protocol describes the lock and unlock operations
            that operate on entire configuration datastores. Often,
            multiple management sessions need to be able to modify the 
            configuration of a managed device in parallel. In these cases, locking
            only parts of a configuration 
            datastore is needed. This document defines a capability based extension to the NETCONF protocol to
            support partial locking of the NETCONF running datastore using a mechanism
            based on the existing XPath filtering mechanisms.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Definition of Terms</h3>

<p>
                    The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
                    &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;NOT RECOMMENDED&quot;, &quot;MAY&quot;, and
                    &quot;OPTIONAL&quot; in this document are to be interpreted as described in BCP 14, <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
                
</p>
<p>
                    Additionally the following terms are defined:
                    </p>
<ul class="text">
<li>Instance Identifier: an XPath expression identifying a 
                            specific node in the conceptual XML datastore. 
                            It contains an absolute path expression in abbreviated syntax,
                            where predicates are used only to specify values for nodes defined as keys to
                            distinguish multiple instances.
</li>
<li>Scope of the lock: initially the set of nodes returned by the XPath expressions in a successful
                            partial-lock operation. The set might be modified if some of the nodes are deleted by the session owning the lock. 
                        
</li>
<li>Protected area: the set of nodes that are protected from modification by the lock. 
                            This set consists of nodes in the scope of the lock and nodes in subtrees under them.
</li>
</ul><p>      
                
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Partial Locking Capability</h3>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Overview</h3>

<p>
                    The :partial-lock capability indicates that the device supports
                    the locking of its configuration with a more limited scope than a complete 
                    configuration datastore. The scope to be locked is specified by using restricted or full XPath expressions.
                    Partial locking only affects configuration data and only the running datastore.
                    The candidate or the start-up datastore are not affected.  
                    <br />
<br />

                    The system MUST ensure that configuration resources
                    covered by the lock are not modified by other
                    NETCONF or non-NETCONF management operations such as
                    SNMP and the CLI.
                    <br />
<br />

                    The duration of the partial lock begins when the partial lock is
                    granted and lasts until (1) either the corresponding &lt;partial-unlock> operation 
                    succeeds or (2) the NETCONF session terminates.
                    <br />
<br />

                    A NETCONF session MAY have multiple parts of the running datastore
                    locked using partial lock operations. 
                    <br />
<br />

                    The &lt;partial-lock> operation returns a 
                    lock-id to identify each successfully acquired lock.
                    The lock-id is unique at any given time for a NETCONF server for all partial-locks 
                    granted to any NETCONF or non-NETCONF sessions.
                    
                
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.1"></a><h3>2.1.1.&nbsp;
Usage Scenarios</h3>

<p>
                        In the following we describe a few scenarios for partial locking. 
                        Besides the two described here, there 
                        are many other usage scenarios possible.
                    
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.1.1"></a><h3>2.1.1.1.&nbsp;
Multiple managers handling the writable running datastore with overlapping sections</h3>

<p>
                            Multiple managers are handling the same NETCONF agent simultaneously. 
                            The agent is handled via the writable running datastore.
                            Each manager has his or her own task, which might involve 
                            the modification of overlapping sections of the datastore. 
                            <br />
<br />

                            After collecting and analyzing input and preparing the 
                            NETCONF operations off-line, 
                            the manager locks the areas that are important for his task
                            using one single &lt;partial-lock> operation.
                            The manager executes a number of &lt;edit-config> operations to modify 
                            the configuration, then releases the partial-lock. 
                            The lock should be held for the shortest possible time (e.g. seconds rather then minutes). 
                            The manager should collect all human input before locking anything.
                            As each manager locks only a part of the data model, usually multiple operators can 
                            execute the &lt;edit-config> operations simultaneously.
                         
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.1.2"></a><h3>2.1.1.2.&nbsp;
Multiple managers handling the writable running datastore, distinct management areas</h3>

<p>
                            Multiple managers are handling the same NETCONF agent simultaneously. 
                            The agent is handled via the writable running datastore.
                            The agent's data model contains a number of well defined separate
                            areas that can be configured without impacting other areas. An
                            example can be a server with multiple applications running on it, or
                            a number of a network elements with a common NETCONF agent for
                            management.                            
                            <br />
<br />

                            Each manager has his or her own task, which does not involve the modification 
                            of overlapping sections of the datastore. 
                            <br />
<br />

                            The manager locks his area with a &lt;partial-lock> operation, 
                            uses a number of &lt;edit-config> commands to modify it, 
                            later releases the lock.
                            As each manager has his functional area assigned to him, 
                            and he locks only that area, multiple managers can edit 
                            the configuration simultaneously.
                            Locks can be held for extended periods (e.g. minutes, hours), 
                            as this will not hinder other managers.
                            <br />
<br />

                            This scenario assumes that the global lock operation 
                            from <a class='info' href='#NETCONF'>[NETCONF]<span> (</span><span class='info'>Enns, R., &ldquo;NETCONF Configuration Protocol,&rdquo; December&nbsp;2006.</span><span>)</span></a> is not used. 
                        
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Dependencies</h3>

<p>The device MUST support restricted XPath expressions in the select element, 
                    as described in <a class='info' href='#partial-lock-operation'>Section&nbsp;2.4.1<span> (</span><span class='info'>&lt;partial-lock></span><span>)</span></a>.
                    Optionally, if the :xpath capability is also supported 
                    (as defined in <a class='info' href='#NETCONF'>[NETCONF]<span> (</span><span class='info'>Enns, R., &ldquo;NETCONF Configuration Protocol,&rdquo; December&nbsp;2006.</span><span>)</span></a> chapter 8.9. XPath Capability), 
                    the device MUST also support using any 
                    XPath 1.0 expression in the select element.
                
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Capability Identifier</h3>

<p>urn:ietf:params:netconf:capability:partial-lock:1.0
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
New Operations</h3>

<a name="partial-lock-operation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.1"></a><h3>2.4.1.&nbsp;
&lt;partial-lock></h3>

<p>
                    The &lt;partial-lock> operation allows the client to lock a portion of
                    the running datastore. The portion to lock is specified with XPath 
                    expressions in the "select" elements  
                    in the &lt;partial-lock> operation. Each XPath expression 
                    MUST return a node set. 
                    <br />
<br />

                    When a NETCONF session holds a lock on a node, no other session or
                    non-NETCONF mechanism of the system can change that node or any node
                    in the hierarchy of nodes beneath it.
                    <br />
<br />

                    Locking a node protects the node itself and 
                    the complete subtree under the node from modification by others. 
                    The set of locked nodes is called the scope of the lock, while all the 
                    locked nodes and the nodes in the subtrees under them make up the protected area.
                    <br />
<br />

                    The XPath expressions are evaluated only once at lock time. 
                    Thereafter, the scope of the lock is maintained as a set of nodes, 
                    i.e. the returned nodeset, and not by the XPath expression. 
                    If the configuration data is later altered in a way that 
                    would make the original XPath  
                    expressions evaluate to a different set of nodes, this does not affect the 
                    scope of the partial lock.  
                    <br />
<br />

                    Let's say the agent's data model includes a list of interface nodes. 
                    If the XPath expression in the partial lock operation covers all interface nodes at locking, 
                    the scope of the lock will be maintained as the list of interface nodes at the time 
                    when the lock was granted. If someone later creates a new interface, this new
                    interface will not be included in the locked-nodes list created 
                    previously so the new interface will not be locked.
                    <br />
<br />

                    A &lt;partial-lock> operation MUST be handled atomically by the NETCONF 
                    server. The server either locks all requested parts of the datastore or none.  
                    If during the &lt;partial-lock> operation one of the requested parts cannot be locked, the 
                    server MUST unlock all parts that have already been locked during that operation. 
                    <br />
<br />

                    If a node in the scope of the lock is deleted by the session owning the lock, it is removed from the 
                    scope of the lock, so any other session or non-NETCONF mechanism can recreate it. 
                    If all nodes in the scope of the lock are deleted, the 
                    lock will still be present. However, its scope will become empty (since the lock will 
                    not cover any nodes).
                    <br />
<br />

                    A NETCONF server that supports partial locking MUST be able to grant multiple simultaneous partial locks to a 
                    single NETCONF session. If the protected area of the individual locks overlap, nodes in the 
                    common area MUST be protected until all of the overlapping locks are released.                    
                    <br />
<br />

                    A partial lock operation MUST fail if:
                   </p>
<ul class="text">
<li>Any NETCONF session (including the current session) owns the
                       global lock on the running datastore.
</li>
<li>Any part of the area to be protected is already locked (or protected by partial locking) 
                           by another management session, including other NETCONF sessions using 
                           &lt;partial-lock> or any other non-NETCONF management method.
</li>
<li>The requesting user is not successfully authenticated.
</li>
<li>The NETCONF server implements access control, and the locking user 
                           does not have sufficient 
                            access rights. The exact handling of access rights is outside the 
                            scope of this document, but it is assumed that there is an access 
                            control system that MAY deny or allow the partial lock operation.
</li>
</ul><p>
                    The &lt;partial-lock> operation is designed for simplicity, so when a partial 
                    lock is executed you get what you asked for: a set of nodes that are 
                    locked for writing. As a consequence users must observe the following: 
                    </p>
<ul class="text">
<li>Locking does not affect read operations.
</li>
<li>If part of the running datastore is locked, this has no effect on any unlocked parts of the datastore. 
                            If this is a problem (e.g., changes depend on data values or nodes outside the protected  
                            part of the datastore), these nodes SHOULD be included in the protected area of the lock.
</li>
<li>Configuration data can be edited both inside and outside the protected area of a 
                            lock. It is the responsibility of the NETCONF client application to lock all relevant parts of the datastore that 
                            are crucial for a specific management action.
</li>
</ul><p>
                    <br />
<br />

                    Note: The &lt;partial-lock> operation does not modify the global &lt;lock> operation defined in the base 
                    NETCONF Protocol  <a class='info' href='#NETCONF'>[NETCONF]<span> (</span><span class='info'>Enns, R., &ldquo;NETCONF Configuration Protocol,&rdquo; December&nbsp;2006.</span><span>)</span></a>. If part of the running  
                    datastore is already locked by &lt;partial-lock>, then a global lock for the running datastore MUST fail even 
                    if the global lock is requested by the NETCONF session that owns the partial lock. 
                
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.1.1"></a><h3>2.4.1.1.&nbsp;
Parameters, Result, Examples</h3>

<p>
                        Parameters:
                        </p>
<blockquote class="text"><dl>
<dt>select:</dt>
<dd>One or more 'select' elements, each  
                                containing an XPath expression.  The XPath expression is
                                evaluated in a context where the context node is the root of the
                                server's conceptual data model,
                                and the set of namespace declarations are those in scope on the
                                select element.
                                <br />
                            
                                The nodes returned from the select expressions are reported in
                                the rpc-reply message.
                                <br />
<br />

                                Each select expression MUST return a node set, and at least one of the 
                                node sets MUST be non-empty. 
                                <br />
<br />

                                If the device supports the :xpath capability, any valid XPath 1.0 expression can 
                                be used. If the device does not support the :xpath capability, the XPath 
                                expression MUST be limited to an Instance Identifier expression.
                                An Instance Identifier is an absolute path expression in abbreviated syntax,
                                where predicates are used only to specify values for nodes defined as keys to
                                distinguish multiple instances.
                            
</dd>
</dl></blockquote><p>
                       <br />

                       
<p>Example: Lock virtual router 1 and interface eth1
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

 &lt;nc:rpc
   xmlns="urn:ietf:params:xml:ns:netconf:partial-lock:1.0"
   xmlns:nc="urn:ietf:params:xml:ns:netconf:base:1.0"
   message-id="135"&gt;
     &lt;partial-lock&gt;
         &lt;select xmlns:rte="http://example.com/ns/route"&gt;
             /rte:routing/rte:virtualRouter[rte:routerName='router1']
         &lt;/select&gt;
         &lt;select xmlns:if="http://example.com/ns/interface"&gt;
             /if:interfaces/if:interface[if:id='eth1']
         &lt;/select&gt;
      &lt;/partial-lock&gt;
 &lt;/nc:rpc&gt;

 &lt;nc:rpc-reply
   xmlns:nc="urn:ietf:params:xml:ns:netconf:base:1.0"
   xmlns="urn:ietf:params:xml:ns:netconf:partial-lock:1.0"
   message-id="135"&gt;
     &lt;lock-id&gt;127&lt;/lock-id&gt;
     &lt;locked-node xmlns:rte="http://example.com/ns/route"&gt;
         /rte:routing/rte:virtualRouter[rte:routerName='router1']
     &lt;/locked-node&gt;
     &lt;locked-node xmlns:if="http://example.com/ns/interface"&gt;
         /if:interfaces/if:interface[if:id='eth1']
     &lt;/locked-node&gt;
 &lt;/nc:rpc-reply&gt;
</pre></div>
                              <br />
<br />

                        Note: The XML Schema in <a class='info' href='#NETCONF'>[NETCONF]<span> (</span><span class='info'>Enns, R., &ldquo;NETCONF Configuration Protocol,&rdquo; December&nbsp;2006.</span><span>)</span></a> has a known bug which requires the
                        &lt;data> XML element in a &lt;rpc-reply>.  This means that the above
                        examples will not validate using the XML Schema found in
                        <a class='info' href='#NETCONF'>[NETCONF]<span> (</span><span class='info'>Enns, R., &ldquo;NETCONF Configuration Protocol,&rdquo; December&nbsp;2006.</span><span>)</span></a>. 
                        <br />
<br />

                        Positive Response:
                        <br />
<br />

                        If the device was able to satisfy the request, an &lt;rpc-reply> is
                        sent with a &lt;lock-id> element (lock identifier) in the &lt;rpc-reply> element.
                        A list of locked nodes is also returned in Instance Identifier format.
                        <br />
<br />

                        Negative Response:
                        <br />
<br />

                       If any select expression is an invalid XPath expression, the
                       &lt;error-tag> is 'invalid-value'.
                       <br />
<br />
                             
                       If any select expression returns something other than a node set, the
                       &lt;error-tag> is 'invalid-value', and the &lt;error-app-tag> is 'not-a-node-set'.
                       <br />
<br />

                       If all the select expressions return an empty node set, the &lt;error-tag> is 
                       'operation-failed', and the &lt;error-app-tag> is 'no-matches'.
                       <br />
<br />

                       If the :xpath capability is not supported and the XPath 
                       expression is not an Instance Identifier,
                       the &lt;error-tag> is 'invalid-value', the &lt;error-app-tag> is 'invalid-lock-specification'.
                       <br />
<br />

                        If access control denies the partial lock, the &lt;error-tag>
                        is 'access-denied'. Access control SHOULD be checked before checking for conflicting locks to 
                        avoid giving out information about other sessions to an unauthorized client.
                       <br />
<br />

                        If a lock is already held by another session on any node within the subtrees to be
                        locked, the &lt;error-tag> element is 'lock-denied' and the
                        &lt;error-info> element includes the &lt;session-id> of the lock
                        owner. If the lock is held by a non-NETCONF session, a
                        &lt;session-id> of 0 (zero) SHOULD be included. The same error response is returned if 
                        the requesting session already holds the (global) lock for the running datastore.
                        <br />
<br />

                        If needed the returned session-id may 
                        be used to &lt;kill-session> the NETCONF session holding the lock.                        
                        <br />
<br />

                        

<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.1.2"></a><h3>2.4.1.2.&nbsp;
Deadlock Avoidance</h3>

<p>
                         As with most locking systems, it is possible that two management sessions trying to lock different 
                         parts of the configuration could become dead-locked. 
                         To avoid this situation, clients SHOULD lock
                         everything they need in one operation. If locking fails, the client
                         MUST back-off, release any previously acquired locks, and SHOULD
                         retry the procedure after waiting some randomized time interval.
                         <br />
<br />
                         
                     
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.2"></a><h3>2.4.2.&nbsp;
&lt;partial-unlock></h3>

<p>The operation unlocks the parts of the running datastore that were previously 
                      locked using &lt;partial-lock> during the same session. The operation unlocks the 
                      parts that are covered by the lock identified by the lock-id parameter. 
                      In case of multiple potentially overlapping locks, only the lock identified 
                      by the lock-id is removed.
                      <br />
<br />

                        Parameters:
                        </p>
<blockquote class="text"><dl>
<dt>lock-id:</dt>
<dd>Identity of the lock to be unlocked.
                              This lock-id MUST have been received as a response to a lock request
                              by the manager during the current session, and MUST NOT have
                              been sent in a previous unlock request.
                            
</dd>
</dl></blockquote><p>
                        <br />

                        
<p>Example: Unlock a previously created lock
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   &lt;nc:rpc xmlns="urn:ietf:params:xml:ns:netconf:partial-lock:1.0"
     xmlns:nc="urn:ietf:params:xml:ns:netconf:base:1.0"
     message-id="136"&gt;
       &lt;partial-unlock&gt;
         &lt;lock-id&gt;127&lt;/lock-id&gt;
       &lt;/partial-unlock&gt;
   &lt;/nc:rpc&gt;

</pre></div>
                       <br />
<br />

                       Positive Response:
                      <br />
<br />

                      If the device was able to satisfy the request, an &lt;rpc-reply> is
                      sent that contains an &lt;ok> element. A positive response MUST 
                      be sent even if all of the locked parts of the datastore have already been deleted.
                      <br />
<br />

                      Negative Response:
                      <br />
<br />

                      If the &lt;lock-id> parameter does not identify a lock which is owned
                      by the session, an 'invalid-value' error is returned.
                  

<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Modifications to Existing Operations</h3>

<p>A successful partial lock will cause a subsequent operation to fail if that operation attempts to modify 
                    nodes in the protected area of the lock  
                    and is executed in a NETCONF session other than the session that has been granted the lock. 
                    The &lt;error-tag>  'in-use' and the &lt;error-app-tag> 'locked' is returned. 
                    All operations that modify the running datastore are affected, including: &lt;edit-config>, &lt;copy-config>, 
                    &lt;delete-config>, &lt;commit> and &lt;discard-changes>.
                    If partial lock prevents &lt;edit-config> modifying some data, but the 
                    operation includes the continue-on-error option, modification of other 
                    parts of the datastore, which are not protected by partial locking, might 
                    still succeed.                    
                    <br />
<br />

                    If the datastore contains nodes locked by partial lock, this will cause the (global) &lt;lock> operation to fail. The 
                    &lt;error-tag> element 'lock-denied' and an 
                    &lt;error-info> element including the &lt;session-id> of the lock
                    owner will be returned. If the lock is held by a non-NETCONF session, a
                    &lt;session-id> of 0 (zero) is returned.
                    <br />
<br />
                    
                    All of these operations are affected only if they are targeting the running datastore.
                
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6"></a><h3>2.6.&nbsp;
Interactions with Other Capabilities</h3>

<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6.1"></a><h3>2.6.1.&nbsp;
Candidate Configuration Capability</h3>

<p>
                      The candidate datastore can not be locked using the &lt;partial-lock> operation.
                    
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6.2"></a><h3>2.6.2.&nbsp;
Confirmed Commit Capability</h3>

<p>
                        If:
                   	    </p>
<ul class="text">
<li>a partial lock is requested for the running datastore, and
</li>
<li>the NETCONF server implements the :confirmed-commit capability, and
</li>
<li>there was a recent confirmed &lt;commit> operation where the confirming  &lt;commit> operation has not been received
</li>
</ul><p>
			            then the lock MUST be denied, because if the confirmation does not arrive, 
			            the running datastore MUST be rolled back to its state before the commit.
                        The NETCONF server might therefore need to modify the configuration.
                        <br />

                        In this case the &lt;error-tag>  'in-use' and the 
                        &lt;error-app-tag> 'outstanding-confirmed-commit' 
                        is returned.
                    
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6.3"></a><h3>2.6.3.&nbsp;
Distinct Startup Capability</h3>

<p>The startup datastore can not be locked using the &lt;partial-lock> operation.
                  
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Security Considerations</h3>

<p>
            The same considerations are relevant as for the base NETCONF Protocol  <a class='info' href='#NETCONF'>[NETCONF]<span> (</span><span class='info'>Enns, R., &ldquo;NETCONF Configuration Protocol,&rdquo; December&nbsp;2006.</span><span>)</span></a>.
            &lt;partial-lock> and &lt;partial-unlock> RPCs MUST only be allowed for an authenticated user.
            &lt;partial-lock> and &lt;partial-unlock> RPCs SHOULD only be allowed for an authorized user. 
            However as NETCONF access control is not standardized and not a mandatory part 
            of a NETCONF implementation, it is strongly recommended, 
            but OPTIONAL. (although nearly all implementations include some kind of access control)          
            <br />
<br />

            A lock (either a partial lock or a global lock) might prevent other users from configuring the system.
            The following mechanisms are in place to prevent the misuse of this possibility:
            </p>
<blockquote class="text">
<p>A user, that is not successfully authenticated, MUST NOT be granted a partial lock.
</p>
<p>Only an authorized user SHOULD be able to request a partial lock.
</p>
<p>The partial lock is automatically released when a session is terminated regardless of how the session ends.
</p>
<p>The &lt;kill-session> operation makes it possible to terminate other users's sessions.
</p>
<p>The NETCONF server MAY log partial lock requests in an audit trail.
</p>
<p>
</p>
</blockquote><p>
            A lock that is hung for some reason (e.g., a broken TCP connection that the server has not yet recognised) can be released 
            using another NETCONF session by explicitly killing the session owning that lock using the &lt;kill-session> operation.
            <br />
<br />

            Partial locking is not an authorization mechanism; it SHOULD NOT be used to provide security or access control. 
            Partial locking SHOULD only be used as a mechanism for providing consistency 
            when multiple managers are trying to configure the node.
            It is vital that users easily understand the exact scope of a lock. 
            This is why the scope is determined when granting a lock and is not modified thereafter.
        
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
IANA Considerations</h3>

<p>This document registers one capability identifier URN from the 
            "Network Configuration Protocol (NETCONF) Capability URNs" registry, 
            and one URI for the NETCONF XML namespace in the "IETF XML registry" <a class='info' href='#RFC3688'>[RFC3688]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>. 
            Note that the capability URN is compliant to <a class='info' href='#NETCONF'>[NETCONF]<span> (</span><span class='info'>Enns, R., &ldquo;NETCONF Configuration Protocol,&rdquo; December&nbsp;2006.</span><span>)</span></a> section 10.3.
            
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left" width="20%"><col align="left">
<tr><th align="left">Index</th><th align="left">Capability Identifier</th></tr>
<tr>
<td align="left">:partial-lock</td>
<td align="left">urn:ietf:params:netconf:capability:partial-lock:1.0</td>
</tr>
</table>
<br clear="all" />

<p>URI: urn:ietf:params:xml:ns:netconf:partial-lock:1.0
            <br />
<br />

            Registrant Contact: The IESG.
            <br />
<br />
    
             XML: N/A, the requested URI is an XML namespace.
            
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Appendix A  -  XML Schema for Partial Locking (normative)</h3>

<p>                        
                The following XML Schema defines the &lt;partial-lock> and &lt;partial-unlock> operations:
                <br />
<br />

-- RFC Ed.: Insert license information for code as appropriate
                <br />

                &lt;CODE BEGINS>
                <br />

                </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns="urn:ietf:params:xml:ns:netconf:partial-lock:1.0"
    xmlns:nc="urn:ietf:params:xml:ns:netconf:base:1.0"
    targetNamespace="urn:ietf:params:xml:ns:netconf:partial-lock:1.0"
    elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;

    &lt;xs:annotation&gt;
        &lt;xs:documentation&gt;
            Schema defining the partial-lock and unlock operations.
            organization "IETF NETCONF Working Group"

            contact
            Netconf Working Group
            Mailing list: netconf@ietf.org
            Web: http://www.ietf.org/html.charters/netconf-charter.html

            Balazs Lengyel
            balazs.lengyel@ericsson.com"

            revision 2009-10-19
            description Initial version, published as RFC yyyy.
-- RFC Ed.: replace yyyy with actual RFC number and remove this note.
        &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;

    &lt;xs:import namespace="urn:ietf:params:xml:ns:netconf:base:1.0"
        schemaLocation="urn:ietf:params:xml:ns:netconf:base:1.0"/&gt;

    &lt;xs:simpleType name="lock-id-type"&gt;
        &lt;xs:annotation&gt;
            &lt;xs:documentation&gt;
                A number identifying a specific
                partial-lock granted to a session.
                It is allocated by the system, and SHOULD
                be used in the unlock operation.
            &lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
        &lt;xs:restriction base="xs:unsignedInt"/&gt;
    &lt;/xs:simpleType&gt;

    &lt;xs:complexType name="partialLockType"&gt;
        &lt;xs:annotation&gt;
            &lt;xs:documentation&gt;
                A NETCONF operation that locks parts of
                  the running datastore.
            &lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
        &lt;xs:complexContent&gt;
            &lt;xs:extension base="nc:rpcOperationType"&gt;
                &lt;xs:sequence&gt;
                    &lt;xs:element name="select" type="xs:string"
                        maxOccurs="unbounded"&gt;
                        &lt;xs:annotation&gt;
                          &lt;xs:documentation&gt;
                            XPath expression that specifies the scope
                            of the lock. An Instance Identifier
                            expression must be used unless the :xpath
                            capability is supported in which case any
                            XPath 1.0 expression is allowed.
                          &lt;/xs:documentation&gt;
                        &lt;/xs:annotation&gt;
                    &lt;/xs:element&gt;
                &lt;/xs:sequence&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:complexContent&gt;
    &lt;/xs:complexType&gt;

    &lt;xs:complexType name="partialUnLockType"&gt;
        &lt;xs:annotation&gt;
            &lt;xs:documentation&gt;
                A NETCONF operation that releases a previously acquired
                partial-lock.
            &lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
        &lt;xs:complexContent&gt;
            &lt;xs:extension base="nc:rpcOperationType"&gt;
                &lt;xs:sequence&gt;
                    &lt;xs:element name="lock-id" type="lock-id-type"&gt;
                        &lt;xs:annotation&gt;
                          &lt;xs:documentation&gt;
                            Identifies the lock to be released. MUST
                            be the value received in the response to
                            the partial-lock operation.
                          &lt;/xs:documentation&gt;
                        &lt;/xs:annotation&gt;
                    &lt;/xs:element&gt;
                &lt;/xs:sequence&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:complexContent&gt;
    &lt;/xs:complexType&gt;

    &lt;!-- &lt;partial-lock&gt; operation --&gt;
    &lt;xs:element name="partial-lock" type="partialLockType"
        substitutionGroup="nc:rpcOperation"/&gt;

    &lt;!-- &lt;partial-unlock&gt; operation --&gt;
    &lt;xs:element name="partial-unlock" type="partialUnLockType"
        substitutionGroup="nc:rpcOperation"/&gt;

    &lt;!-- reply to &lt;partial-lock&gt; --&gt;

    &lt;xs:complexType name="contentPartInPartialLockReplyType"&gt;
        &lt;xs:annotation&gt;
            &lt;xs:documentation&gt;
                The content of the reply to a successful
                partial-lock request MUST conform to this complex type.
            &lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
        &lt;xs:sequence&gt;
            &lt;xs:element name="lock-id" type="lock-id-type"&gt;
              &lt;xs:annotation&gt;
                &lt;xs:documentation&gt;
                  Identifies the lock to be released. Must be the value
                  received in the response to a partial-lock operation.
                &lt;/xs:documentation&gt;
              &lt;/xs:annotation&gt;
            &lt;/xs:element&gt;
            &lt;xs:element name="locked-node" type="xs:string"
                maxOccurs="unbounded"&gt;
                &lt;xs:annotation&gt;
                    &lt;xs:documentation&gt;
                        List of locked nodes in the running datastore.
                    &lt;/xs:documentation&gt;
                &lt;/xs:annotation&gt;
            &lt;/xs:element&gt;
        &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
</pre></div><p>
    
              <br />

              &lt;CODE ENDS>
              <br />
            
            
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Appendix B  - YANG Module for Partial Locking (non-normative)</h3>

<p>The following YANG module defines the &lt;partial-lock> and &lt;partial-unlock> operations. 
                The YANG language is defined in <a class='info' href='#I-D.ietf-netmod-yang'>[I&#8209;D.ietf&#8209;netmod&#8209;yang]<span> (</span><span class='info'>Bjorklund, M., &ldquo;YANG - A data modeling language for NETCONF,&rdquo; July&nbsp;2009.</span><span>)</span></a>.
              <br />
<br />

-- RFC Ed.: Insert license information for code as appropriate
              <br />

              &lt;CODE BEGINS>
              <br />

              </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
module ietf-netconf-partial-lock {

  namespace urn:ietf:params:xml:ns:netconf:partial-lock:1.0;
  prefix pl;

  organization "IETF Network Configuration (netconf) Working Group";

  contact
   "Netconf Working Group
    Mailing list: netconf@ietf.org
    Web: http://www.ietf.org/html.charters/netconf-charter.html

    Balazs Lengyel
    Ericsson
    balazs.lengyel@ericsson.com";

  description
   "This YANG module defines the &lt;partial-lock&gt; and
    &lt;partial-unlock&gt; operations.";

  revision 2009-10-19 {
    description
     "Initial version, published as RFC yyyy.";
     // RFC Ed.: replace yyyy with actual RFC number &amp; remove this note.
  }

  typedef lock-id-type {
    type uint32;
    description
     "A number identifying a specific partial-lock granted to a session.
      It is allocated by the system, and SHOULD be used in the
      partial-unlock operation.";
  }

  rpc partial-lock {
    description
     "A NETCONF operation that locks parts of the running datastore.";
    input {
      leaf-list select {
        type string;
        min-elements 1;
        description
         "XPath expression that specifies the scope of the lock.
          An Instance Identifier expression MUST be used unless the
          :xpath capability is supported, in which case any XPath 1.0
          expression is allowed.";
      }
    }
    output {
      leaf lock-id {
        type lock-id-type;
        description
         "Identifies the lock, if granted. The lock-id SHOULD be
          used in the partial-unlock rpc.";
      }
      leaf-list locked-node {
        type instance-identifier;
        min-elements 1;
        description
         "List of locked nodes in the running datastore";
      }
    }
  }

  rpc partial-unlock {
    description
     "A NETCONF operation that releases a previously acquired
      partial-lock.";
    input {
      leaf lock-id {
        type lock-id-type;
        description
         "Identifies the lock to be released. MUST be the value
          received in the response to a partial-lock operation.";
      }
    }
  }
}

</pre></div><p>

              <br />

              &lt;CODE ENDS>
              <br />

            
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Appendix C - Usage Example - Reserving nodes for future editing (non-normative)</h3>

<p>
                Partial lock cannot be used to lock non-existent nodes, which would effectively attempt to reserve them for future use. 
                To guarantee that a node cannot be created by some other session, the
                parent node should be locked, the top level node of the new subtree created, and then locked 
                with another &lt;partial-lock> operation. After this, the lock on the parent node should be removed.
            
</p>
<p>In this chapter an example illustrating the above is given.
                <br />
<br />

                We want to create &lt;user> Joe under &lt;users>, and start editing it. 
                Editing might take a number of minutes.
                We want to immediately lock Joe so no one will touch it before we are finished with the editing. 
                <br />
<br />

                We also want to minimize locking other parts of the running datastore as multiple managers might 
                be adding users near simultaneously.
                <br />
<br />

                First we check what users are already defined. 
                
<p>Step 1 - Read existing users
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

&lt;rpc message-id="101"
    xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"&gt;
  &lt;get-config&gt;
    &lt;source&gt;
      &lt;running/&gt;
    &lt;/source&gt;
    &lt;filter type="subtree"&gt;
      &lt;top xmlns="http://example.com/users"&gt;
        &lt;users/&gt;
      &lt;/top&gt;
    &lt;/filter&gt;
  &lt;/get-config&gt;
&lt;/rpc&gt;

</pre></div>
                <br />
<br />

                The NETCONF server sends the following reply.                
                
<p>Step 2 - Receiving existing data
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

&lt;rpc-reply message-id="101"
     xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"&gt;
  &lt;data&gt;
    &lt;top xmlns="http://example.com/users"&gt;
      &lt;users&gt;
        &lt;user&gt;
          &lt;name&gt;fred&lt;/name&gt;
          &lt;phone&gt;8327&lt;/phone&gt;
        &lt;/user&gt;
      &lt;/users&gt;
    &lt;/top&gt;
  &lt;/data&gt;
&lt;/rpc-reply&gt;

</pre></div>
                <br />
<br />

                We want to add the new user "Joe" and immediately lock him 
                using partial locking. The way to do this, is to first lock all &lt;user> nodes by locking the &lt;users> node.
                <br />
<br />

                Note that if we would lock all the &lt;user> nodes using the select 
                expression '/usr:top/usr:users/usr:user' ; this would not lock the new user "Joe", which we will create after locking. 
                So we rather have to lock the &lt;users> node.
                
<p>Step 3 - Lock users
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;nc:rpc
  xmlns:nc="urn:ietf:params:xml:ns:netconf:base:1.0"
  xmlns="urn:ietf:params:xml:ns:netconf:partial-lock:1.0"
      message-id="102"&gt;
  &lt;partial-lock&gt;
    &lt;select xmlns:usr="http://example.com/users"&gt;
      /usr:top/usr:users
    &lt;/select&gt;
  &lt;/partial-lock&gt;
&lt;/nc:rpc&gt;
</pre></div>
                <br />
<br />

                The NETCONF server grants the partial lock. The scope 
                of the lock includes only the &lt;users> node. The lock 
                protects the &lt;users> node and all &lt;user> nodes below it from 
                modification (by other sessions).               
                
<p>Step 4 - Receive lock
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;nc:rpc-reply
  xmlns:nc="urn:ietf:params:xml:ns:netconf:base:1.0"
  xmlns="urn:ietf:params:xml:ns:netconf:partial-lock:1.0"
  message-id="102"&gt;
    &lt;lock-id&gt;1&lt;/lock-id&gt;
    &lt;locked-node xmlns:usr="http://example.com/users"&gt;
        /usr:top/usr:users
    &lt;/locked-node&gt;
&lt;/nc:rpc-reply&gt;
</pre></div>
                <br />
<br />

                Next we create user Joe. Joe is protected by the lock 
                received above, as it is under the sub-tree rooted at the &lt;users> node.
                
<p>Step 5 - Create user Joe
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;rpc message-id="103"
     xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"&gt;
  &lt;edit-config&gt;
    &lt;target&gt;
      &lt;running/&gt;
    &lt;/target&gt;
    &lt;config&gt;
      &lt;top xmlns:usr="http://example.com/users"&gt;
        &lt;users&gt;
          &lt;user&gt;
            &lt;name&gt;Joe&lt;/name&gt;
          &lt;/user&gt;
        &lt;/users&gt;
      &lt;/top&gt;
    &lt;/config&gt;
  &lt;/edit-config&gt;
&lt;/rpc&gt;
</pre></div>
                <br />
<br />

                We receive a positive reply to the &lt;edit-config> (not shown).
                Next we request a lock, that locks only &lt;user> Joe, and release the lock on the &lt;users> node. 
                This will allow other managers to create additional new users.                
                
<p>Step 6 - Lock user Joe
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;nc:rpc
  xmlns:nc="urn:ietf:params:xml:ns:netconf:base:1.0"
  xmlns="urn:ietf:params:xml:ns:netconf:partial-lock:1.0"
      message-id="104"&gt;
  &lt;partial-lock&gt;
    &lt;select xmlns:usr="http://example.com/users"&gt;
      /usr:top/usr:users/user[usr:name="Joe"]"
    &lt;/select&gt;
  &lt;/partial-lock&gt;
&lt;/nc:rpc&gt;
</pre></div>
                <br />
<br />

                The NETCONF server grants the partial lock. The scope 
                of this second lock includes only the &lt;user> node with name Joe. The lock 
                protects all data below this particular &lt;user> node.               
                
<p>Step 7 - Receive lock
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;nc:rpc-reply
  xmlns:nc="urn:ietf:params:xml:ns:netconf:base:1.0"
  xmlns="urn:ietf:params:xml:ns:netconf:partial-lock:1.0"
  message-id="104"&gt;
    &lt;lock-id&gt;2&lt;/lock-id&gt;
    &lt;locked-node xmlns:usr="http://example.com/users"&gt;
        /usr:top/usr:users/user[usr:name="Joe"]"
    &lt;/locked-node&gt;
&lt;/nc:rpc-reply&gt;
</pre></div>
                <br />
<br />

                The scope of the second lock is the &lt;user> node Joe. It protects this &lt;user> 
                node and any data below it (e.g. phone number).
                At this point of time these nodes are protected both by the first and second lock.
                Next we unlock the other &lt;user>s and the &lt;users> node, to allow other managers 
                to work on them. We still keep the second lock, so the &lt;user> node Joe and the sub-tree below is still protected.                
                
<p>Step 8 - Release lock on &lt;users>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;nc:rpc xmlns="urn:ietf:params:xml:ns:netconf:partial-lock:1.0"
    xmlns:nc="urn:ietf:params:xml:ns:netconf:base:1.0"
    message-id="105"&gt;
  &lt;partial-unlock&gt;
    &lt;lock-id&gt;1&lt;/lock-id&gt;
  &lt;/partial-unlock&gt;
&lt;/nc:rpc&gt;
</pre></div>
            

<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Appendix D  -  Change Log</h3>

<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
10-11</h3>

<p>Minor clarifications
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
09-10</h3>

<p>Clarifications
</p>
<p>Only the running datastore can be locked
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
08-09</h3>

<p>Clarifications
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
07-08</h3>

<p>Clarifications
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5"></a><h3>8.5.&nbsp;
06-07</h3>

<p>Changed XSD and YANG to allow additional proprietary datastores to be locked.
</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6"></a><h3>8.6.&nbsp;
05-06</h3>

<p>Added usage example
</p>
<p>Clarified error messages
</p>
<p>Clarified interaction with edit-config continue-on-error
</p>
<p>Improved YANG: indentation, canonical order, contact info
</p>
<p>Added usage example in appendix C
</p>
<p>Synchronized YANG and XSD
</p>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.7"></a><h3>8.7.&nbsp;
04-05</h3>

<p>Language and editorial updates
</p>
<p>all app-tags are with dashes without spaces
</p>
<p>Added usage scenarios
</p>
<p>Changed encoding
</p>
<p>Clarified definitions, separated scope of lock and protected area
</p>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.8"></a><h3>8.8.&nbsp;
03-04</h3>

<p>Minor clarifications
</p>
<p>Added list of locked-nodes to the output of partial-lock.
</p>
<p>Added &lt;target> wrapper around datastore names.
</p>
<p>Allowed atomic/one operation locking of datastore parts in multiple datastores.
</p>
<p>Improved English (hopefully)
</p>
<p>Removed the &lt;data> element from rpc-reply following the text of rfc4741.
</p>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.9"></a><h3>8.9.&nbsp;
02-03</h3>

<p>Minor clarifications
</p>
<p>Same descriptions in XSD and YANG.
</p>
<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.10"></a><h3>8.10.&nbsp;
01-02</h3>

<p>Made XSD normative
</p>
<p>Clarified that no specific access control is assumed.
</p>
<p>Clarified that non-existing nodes are NOT covered by the lock, even if they where existing and covered by the lock when it was originally granted.
</p>
<p>Some rewording
</p>
<p>Added app-tags for two of the error cases.
</p>
<p>Made YANG an informative reference
</p>
<p>Enhanced security considerations.
</p>
<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.11"></a><h3>8.11.&nbsp;
00-01</h3>

<p>Added YANG module.
</p>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.12"></a><h3>8.12.&nbsp;
-00</h3>

<p>Created from draft-lengyel-ngo-partial-lock-01.txt
</p>
<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Acknowledgements</h3>

<p>Thanks to Andy Bierman, Sharon Chisholm, Phil Shafer , David Harrington, Mehmet Ersue, 
                Wes Hardaker, Juergen Schoenwaelder, Washam Fan and 
                many other members of the NETCONF WG for providing important input to this document.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="NETCONF">[NETCONF]</a></td>
<td class="author-text">Enns, R., &ldquo;<a href="http://tools.ietf.org/html/rfc4741">NETCONF Configuration Protocol</a>,&rdquo; RFC&nbsp;4741, December&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4741.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3688">[RFC3688]</a></td>
<td class="author-text">Mealling, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3688">The IETF XML Registry</a>,&rdquo; BCP&nbsp;81, RFC&nbsp;3688, January&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3688.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-netmod-yang">[I-D.ietf-netmod-yang]</a></td>
<td class="author-text">Bjorklund, M., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-netmod-yang-07.txt">YANG - A data modeling language for NETCONF</a>,&rdquo; draft-ietf-netmod-yang-07 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-netmod-yang-07.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Balazs Lengyel</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ericsson</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:balazs.lengyel@ericsson.com">balazs.lengyel@ericsson.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Martin Bjorklund</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tail-f Systems</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mbj@tail-f.com">mbj@tail-f.com</a></td></tr>
</table>
</body></html>
