B-HIT = sha1(HIT || N), with N a random value and || the 
KI-Auth-key = g(r1, r2, EPC-Code) 
    
f= sha1(r1 || r2 || EPC-Code), where || is the concatenation 
KI-Auth-key = g(r1, r2, EPC-Code) 
    
EPC = 0123456789abcdefcdab 
    
K = HMAC-SHA1(r1 | r2, EPC-Code) 
    
Y = f(r1, r2, EPC-Code) = HMAC-SHA1(K, CT1 | "Type 0001 key") 
    
K = HMAC-SHA1(r1 | r2, EPC-Code) 
    
Y = HMAC-SHA1(K, CT2 | "Type 0001 key") 
    
Y = f(r1, r2, EPC-Code) = H1 | H2 | Hi | Hn 
    

 
                            HIP support for RFIDs         October 2012 
 
Hi = HMAC-SHA1(r1 | r2, Ki:j) 
    
RFID-Index = an p**(n-1) + an-1 p**(n-2) +    a1 
    
K-Auth-Key = HMAC-H(r1 | r2, RFID-Index) 
    
CLA=00, INS=C2, P1=00, P2=00. The P3 byte is set to null in order to 
DB = JCSystem.makeTransientByteArray(DBSIZE, 
                                         JCSystem.CLEAR-ON-DESELECT); 
    
tl   = Util.getShort(pkt,(short)(off+2)); 
off =(short)(off+tl) ; 
tl= (short) (tp+tl); 
      
size = apdu.setIncomingAndReceive();    
size = apdu.setIncomingAndReceive();   
len  = Util.makeShort((byte)0,buffer[6]); 
len  = (short)(len << 3); 
len  = (short)(len+(short)8)   ; 
      
size = (short)(len-(short)40); 
      
off= GetAttOffset(buffer,(short)45,size,R-T); 
len = Util.getShort(buffer,(short)(off+2)); 
pad = Util.getShort(buffer,(short)(off+4)); 
len = (short)(len-pad-6); 
      
len-r1=len; 
off= GetAttOffset(buffer,(short)45,size,HIP-T-TRANSFORM)      ; 
      
len = Util.getShort(buffer,(short)(off+2)); 
pad = Util.getShort(buffer,(short)(off+4)); 
len = (short)(len-pad-6); 
      
off=(short)40; 
len = Set-Att(HIP-T-TRANSFORM,algo1, 
                   (short)0,(short)algo1.length,buffer,off); 
off = (short)(off+len); 
len = Set-Att(R-T,DB,(short)(off-R1+len-r1),len-r2,buffer,off); 
off = (short)(off+len); 
len = Set-Att(F-T,DB,off-FT,(short)20,buffer,off); 
off = (short)(off+len); 
len = Set-Att(Signature-T,null,(short)0,(short)20,buffer,off); 
size= (short)(off+len); 
