<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Basic HIP Extensions for Traversal of
         Network Address Translators and Firewalls</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Basic HIP Extensions for Traversal of
         Network Address Translators and Firewalls">
<meta name="keywords" content="HIP, host identity protocol, host identity payload, NAT traversal, NAT traversal">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">HIP Working Group</td><td class="header">M. Komu</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">HIIT</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">T. Henderson</td></tr>
<tr><td class="header">Expires: August 28, 2008</td><td class="header">The Boeing Company</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">P. Matthews</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Avaya</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">H. Tschofenig</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Nokia Siemens Networks</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">A. Ker&auml;nen</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">J. Mel&eacute;n</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Ericsson Research Nomadiclab</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">M. Bagnulo</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Huawei Lab at UC3M</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">February 25, 2008</td></tr>
</table></td></tr></table>
<h1><br />Basic HIP Extensions for Traversal of
         Network Address Translators and Firewalls<br />draft-ietf-hip-nat-traversal-03.txt</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on August 28, 2008.</p>

<h3>Abstract</h3>

<p> The Host Identity Protocol (HIP) provides a new namespace that can be used for uniquely
            identifying hosts. Existing HIP experimental specifications do not specify protocol
            operations across Network Address Translators (NATs).
</p>
<p> This document specifies NAT traversal extensions for HIP. The HIP shim layer is located
            between the network and transport layer, the extensions can also provide a more
            general-purpose NAT traversal support for higher-layer networking applications. The
            extensions are based on the use of the The Interactive Connectivity Establishment (ICE)
            methodology to discover a working path between two end-hosts. Using the specified
            extensions, two HIP-capable hosts are able to communicate with each other even when both
            nodes are behind NATs or firewalls. 
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#sec:intro">1.</a>&nbsp;
Introduction<br />
<a href="#anchor1">2.</a>&nbsp;
Terminology<br />
<a href="#sec:protocol">3.</a>&nbsp;
Protocol Description<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec:registration">3.1.</a>&nbsp;
Relay Registration and NAT Detection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">3.2.</a>&nbsp;
Base Exchange via HIP Relay<br />
<a href="#sec:connectivity">4.</a>&nbsp;
Connectivity Tests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec:nat_transform">4.1.</a>&nbsp;
NAT Transformation Negotiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">4.2.</a>&nbsp;
ICE Procedure<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">4.3.</a>&nbsp;
NAT Keep-alives<br />
<a href="#sec:format">5.</a>&nbsp;
Packet Formats<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec:udphip">5.1.</a>&nbsp;
HIP Control Packets<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec:keep-alive">5.2.</a>&nbsp;
Keep-Alives<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec:rel-reg-params">5.3.</a>&nbsp;
Relay and Registration Parameters<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec:locator_format">5.4.</a>&nbsp;
LOCATOR Parameter<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec:relay-hmac">5.5.</a>&nbsp;
RELAY_HMAC<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">5.6.</a>&nbsp;
Registration Types<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec:udpesp">5.7.</a>&nbsp;
HIP ESP Data Packet Formats<br />
<a href="#anchor6">6.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">6.1.</a>&nbsp;
Privacy Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">6.2.</a>&nbsp;
Opportunistic Mode<br />
<a href="#anchor9">7.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor10">8.</a>&nbsp;
Contributors<br />
<a href="#anchor11">9.</a>&nbsp;
Acknowlegements<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#firewalls">Appendix&nbsp;A.</a>&nbsp;
Firewall Traversal<br />
<a href="#sec:no_relay">Appendix&nbsp;B.</a>&nbsp;
Base Exchange without ICE Connectivity Checks<br />
<a href="#sec:interoperability">Appendix&nbsp;C.</a>&nbsp;
IPv4-IPv6 Interoperability<br />
<a href="#anchor14">Appendix&nbsp;D.</a>&nbsp;
Base Exchange through a Rendezvous Server<br />
<a href="#anchor15">Appendix&nbsp;E.</a>&nbsp;
Document Revision History<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="sec:intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> HIP <a class='info' href='#I-D.ietf-hip-base'>[I&#8209;D.ietf&#8209;hip&#8209;base]<span> (</span><span class='info'>Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;Host Identity Protocol,&rdquo; October&nbsp;2007.</span><span>)</span></a> is defined as a protocol that runs directly over
            IPv4 or IPv6. This approach is known to have problems traversing NATs. Several different
            types of NATs exist, see <a class='info' href='#RFC2663'>[RFC2663]<span> (</span><span class='info'>Srisuresh, P. and M. Holdrege, &ldquo;IP Network Address Translator (NAT) Terminology and Considerations,&rdquo; August&nbsp;1999.</span><span>)</span></a>. This document describes HIP
            extensions for the traversal of both Network Address Translator (NAT) and Network
            Address and Port Translator (NAPT) middleboxes. Additionally, it covers firewalls to a
            certain extend (see <a class='info' href='#firewalls'>Appendix&nbsp;A<span> (</span><span class='info'>Firewall Traversal</span><span>)</span></a> for a more detailed discussion). The
            document generally uses the term NAT to refer to these types of middleboxes. A detailed
            description of HIP problems with traversing legacy middleboxes is documented in <a class='info' href='#I-D.irtf-hiprg-nat'>[I&#8209;D.irtf&#8209;hiprg&#8209;nat]<span> (</span><span class='info'>Stiemerling, M., &ldquo;NAT and Firewall Traversal Issues of Host Identity Protocol (HIP)  Communication,&rdquo; March&nbsp;2007.</span><span>)</span></a>. 
</p>
<p> NAT devices do not operate consistently even though a recommended behavior is described
            in <a class='info' href='#RFC4787'>[RFC4787]<span> (</span><span class='info'>Audet, F. and C. Jennings, &ldquo;Network Address Translation (NAT) Behavioral Requirements for Unicast UDP,&rdquo; January&nbsp;2007.</span><span>)</span></a>. The HIP protocol extensions in this document make as few
            assumptions as possible about the behavior of the NAT devices so that NAT traversal will
            work even with legacy NAT devices. The purpose of these extensions is to allow two
            HIP-enabled hosts to communicate with each other even if one or both communicating hosts
            are in private address realms. With some legacy NAT devices, utilizing the shortest path
            between two end hosts located behind NATs is not possible without relaying the traffic
            through a relay, such as a TURN server <a class='info' href='#I-D.ietf-behave-p2p-state'>[I&#8209;D.ietf&#8209;behave&#8209;p2p&#8209;state]<span> (</span><span class='info'>Srisuresh, P., Ford, B., and D. Kegel, &ldquo;State of Peer-to-Peer(P2P) Communication Across Network Address  Translators(NATs),&rdquo; November&nbsp;2007.</span><span>)</span></a>. As a
            consequence, the TURN server increases the roundtrip delay and may become a point of
            network congestion. With the extensions described in this document, hosts try to avoid
            the use of such a relay when possible. 
</p>
<p> A distinction must be made between a HIP rendezvous server (defined in <a class='info' href='#I-D.ietf-hip-rvs'>[I&#8209;D.ietf&#8209;hip&#8209;rvs]<span> (</span><span class='info'>Laganier, J. and L. Eggert, &ldquo;Host Identity Protocol (HIP) Rendezvous Extension,&rdquo; June&nbsp;2006.</span><span>)</span></a>) and a HIP Relay, defined herein. HIP rendezvous servers
            solve initial contact and mobility related problems in networks without NATs. HIP Relay
            solve the same problems, in addition to NAT traversal problems. HIP Relay servers can be
            used both in NATted and non-NATted networks. 
</p>
<p> Both rendezvous and relay services forward HIP control packets, but the main difference
            is that the rendezvous service forwards only the initial I1 packet of the base exchange
            while all other HIP control packets are sent directly between the communicating hosts.
            In contrast, the relay service relays all HIP control packets because p2p-unfriendly NAT
            devices drop the packets otherwise <a class='info' href='#I-D.ietf-behave-p2p-state'>[I&#8209;D.ietf&#8209;behave&#8209;p2p&#8209;state]<span> (</span><span class='info'>Srisuresh, P., Ford, B., and D. Kegel, &ldquo;State of Peer-to-Peer(P2P) Communication Across Network Address  Translators(NATs),&rdquo; November&nbsp;2007.</span><span>)</span></a>. The peers
            use the control channel to communicate their current locators to each other to find a
            direct path for carrying ESP encapsulated data traffic. A direct path between the hosts
            enables efficient delivery of data traffic without relaying of ESP packets through an
            intermediary TURN server. The direct path is searched using connectivity tests. 
</p>
<p> The basis for the connectivity tests is ICE <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a>. 
</p>
<p><a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> describes ICE as follows: 
</p>
<p>
            </p>
<blockquote class="text">
<p>"The Interactive Connectivity Establishment (ICE) methodology is a technique for
                  NAT traversal for UDP-based media streams (though ICE can be extended to handle
                  other transport protocols, such as TCP) established by the offer/answer model. ICE
                  is an extension to the offer/answer model, and works by including a multiplicity
                  of IP addresses and ports in SDP offers and answers, which are then tested for
                  connectivity by peer-to-peer connectivity checks. The IP addresses and ports
                  included in the SDP and the connectivity checks are performed using the revised
                  STUN specification <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>, now renamed to
                  Session Traversal Utilities for NAT." 
</p>
</blockquote><p>
         
</p>
<p> ICE for SIP is specified in <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> and ICE for non-SIP
            protocols is specified in <a class='info' href='#I-D.rosenberg-mmusic-ice-nonsip'>[I&#8209;D.rosenberg&#8209;mmusic&#8209;ice&#8209;nonsip]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Guidelines for Usage of Interactive Connectivity Establishment (ICE) by non  Session Initiation Protocol (SIP) Protocols,&rdquo; July&nbsp;2008.</span><span>)</span></a>. 
</p>
<p> Two hosts communicate their peer address set (typically consisting of IP address and
            port number pairs) to each other in the HIP base exchange. They are then paired with the
            locally operational address of the other end point and prioritized according to some
            policy. These address sets are then tested sequentially based on the procedure specified
            in ICE. Both sides participate in the connectivity tests. The tests also determine
            whether operational address pairs and select the preferred address pair to be used for
            subsequent communication.
</p>
<p>As a summary, the extensions in this document 
</p>
<p>
            </p>
<ul class="text">
<li>illustrate how to encapsulate HIP packets in UDP
</li>
<li>refer to the UDP encapsulation of IPsec ESP packets defined in Section 2.1 of RFC
                  3948 <a class='info' href='#RFC3948'>[RFC3948]<span> (</span><span class='info'>Huttunen, A., Swander, B., Volpe, V., DiBurro, L., and M. Stenberg, &ldquo;UDP Encapsulation of IPsec ESP Packets,&rdquo; January&nbsp;2005.</span><span>)</span></a>
               
</li>
<li>define how a node interacts with a HIP rendezvous server (defined in <a class='info' href='#I-D.ietf-hip-rvs'>[I&#8209;D.ietf&#8209;hip&#8209;rvs]<span> (</span><span class='info'>Laganier, J. and L. Eggert, &ldquo;Host Identity Protocol (HIP) Rendezvous Extension,&rdquo; June&nbsp;2006.</span><span>)</span></a>) when middleboxes are present 
</li>
<li>describe a methodology to determine operational address pairs between two end
                  hosts based on ICE.
</li>
</ul><p>
         
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p> The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD
            NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as
            described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>. 
</p>
<p>This document borrows terminology from <a class='info' href='#I-D.ietf-hip-base'>[I&#8209;D.ietf&#8209;hip&#8209;base]<span> (</span><span class='info'>Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;Host Identity Protocol,&rdquo; October&nbsp;2007.</span><span>)</span></a>, <a class='info' href='#I-D.ietf-hip-mm'>[I&#8209;D.ietf&#8209;hip&#8209;mm]<span> (</span><span class='info'>Henderson, T., &ldquo;End-Host Mobility and Multihoming with the Host Identity Protocol,&rdquo; March&nbsp;2007.</span><span>)</span></a>, <a class='info' href='#RFC4423'>[RFC4423]<span> (</span><span class='info'>Moskowitz, R. and P. Nikander, &ldquo;Host Identity Protocol (HIP) Architecture,&rdquo; May&nbsp;2006.</span><span>)</span></a>, <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a>, and <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>.
            Additionally, the following terms are used:
</p>
<p>
            </p>
<blockquote class="text"><dl>
<dt>
                  Rendezvous server:</dt>
<dd><br />
 A host
                  that forwards I1 packets to the Responder<br />
<br />

</dd>
<dt>HIP Relay:</dt>
<dd><br />
 A host that forwards all HIP
                  control packets between an Initiator and Responder<br />
<br />

</dd>
<dt>TURN server:</dt>
<dd><br />
 A server that forwards data
                  traffic between two end-hosts<br />
<br />

</dd>
<dt>Locator:</dt>
<dd><br />
 A name that controls how the packet
                  is routed through the network and demultiplexed by the end host. It may include a
                  concatenation of traditional network addresses such as an IPv6 address and
                  end-to-end identifiers such as an ESP SPI. It may also include transport port
                  numbers or IPv6 Flow Labels as demultiplexing context, or it may simply be a
                  network address. <a class='info' href='#I-D.ietf-hip-mm'>[I&#8209;D.ietf&#8209;hip&#8209;mm]<span> (</span><span class='info'>Henderson, T., &ldquo;End-Host Mobility and Multihoming with the Host Identity Protocol,&rdquo; March&nbsp;2007.</span><span>)</span></a> "Address" is used in this
                  document as a synonym for locator.<br />
<br />

               
</dd>
<dt>Transport address:</dt>
<dd><br />
 Transport layer port and
                  the corresponding IPv4/v6 address<br />
<br />

</dd>
<dt>Candidate:</dt>
<dd><br />
 A transport address that has not
                  been verified yet for reachability using ICE<br />
<br />

</dd>
<dt>Host candidate:</dt>
<dd><br />
 An IPv4 or IPv6 address of a
                  network interface of a host<br />
<br />

</dd>
<dt>Server reflexive transport candidate:</dt>
<dd><br />
 A
                  translated transport address of a host as observed by a HIP Relay or a STUN server<br />
<br />

</dd>
<dt>Peer reflexive transport candidate:</dt>
<dd><br />
 A
                  translated transport address of a host as observed by its peer<br />
<br />

</dd>
<dt>Relayed transport candidate:</dt>
<dd><br />
 A transport
                  address that exists on a TURN server. If a permission exists, packets that arrive
                  at this address are relayed towards the TURN client. 
</dd>
</dl></blockquote><p>
         
</p>
<a name="sec:protocol"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Protocol Description</h3>

<p> This section describes the normative behavior of the protocol extension. Examples of
            packet exchanges are provided for illustration purposes.
</p>
<a name="sec:registration"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Relay Registration and NAT Detection</h3>

<p> HIP rendezvous servers are used in non-NATted environments and their use is
               described in <a class='info' href='#I-D.ietf-hip-rvs'>[I&#8209;D.ietf&#8209;hip&#8209;rvs]<span> (</span><span class='info'>Laganier, J. and L. Eggert, &ldquo;Host Identity Protocol (HIP) Rendezvous Extension,&rdquo; June&nbsp;2006.</span><span>)</span></a>. This section specifies a new role for
               these rendezvous servers to act as HIP Relays. HIP Relays forward HIP control packets
               between the Initiator and the Responder. TURN servers <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a> are used for relaying ESP traffic. A host SHOULD
               register to a TURN server before registering to a HIP Relay to guarantee that the
               host can accept ESP traffic immediately after HIP Relay registration. 
</p>
<p> A HIP relay forwards UDP-encapsulated HIP traffic, and in future extensions, a relay
               may also forward TCP-encapsulated traffic. The HIP Relay forwards HIP control
               packets.  NAT traversal for HIP between two
               end-hosts may require the use of relays in certain scenarios. A successful NAT
               traversal therefore requires at least the Responder located behind a NAT to register
               with a HIP Relay.
               
            
</p>
<p> A HIP Relay MUST silently drop packets to a HIP Relay Client that has not previously
               registered with the HIP Relay. The registration process follows the generic
               registration extensions defined in <a class='info' href='#I-D.ietf-hip-registration'>[I&#8209;D.ietf&#8209;hip&#8209;registration]<span> (</span><span class='info'>Laganier, J., &ldquo;Host Identity Protocol (HIP) Registration Extension,&rdquo; June&nbsp;2006.</span><span>)</span></a> and is
               illustrated in <a class='info' href='#fig:reg'>Figure&nbsp;1<span> (</span><span class='info'>Example Registration to a HIP Relay</span><span>)</span></a>. 
</p><br /><hr class="insert" />
<a name="fig:reg"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
HIP                                                      HIP
Relay                                                    Relay
Client                                                   Server
  |   1. UDP(I1)                                           |
  +-------------------------------------------------------&gt;|
  |                                                        |
  |   2. UDP(R1(REG_INFO(RELAY_UDP_HIP)))                  |
  |&lt;-------------------------------------------------------+
  |                                                        |
  |   3. UDP(I2(REG_REQ(RELAY_UDP_HIP)))                   |
  +-------------------------------------------------------&gt;|
  |                                                        |
  |   4. UDP(R2(REG_RES(RELAY_UDP_HIP), REG_FROM))         |
  |&lt;-------------------------------------------------------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Example Registration to a HIP Relay&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p> In step 1, the Initiator starts the registration procedure by sending an I1 packet
               over UDP. It is RECOMMENDED that the Initiator selects a random port number from the ephemeral
               port range 49152-65535 for initiating a base exchange. However, the allocated port
               MUST be maintained until all of the corresponding HIP Associations are closed.
               Alternatively, a host MAY also use a single fixed port for initiating all outgoing
               connections. 
</p>
<p> In step 2, the Responder lists the services that it supports in the R1 packet. The
               support for HIP-over-UDP relaying is denoted by the RELAY_UDP_HIP value. The R1 does not contain any
                NAT transform parameter (see <a class='info' href='#sec:nat_transform'>Section&nbsp;4.1<span> (</span><span class='info'>NAT Transformation Negotiation</span><span>)</span></a>)
                as discussed in <a class='info' href='#sec:no_relay'>Appendix&nbsp;B<span> (</span><span class='info'>Base Exchange without ICE Connectivity Checks</span><span>)</span></a>.
</p>
<p> In step 3, the Initiator selects the services it registers for and lists them in the
               REG_REQ parameter. In this example, the Initiator registers for HIP Relay service. 
</p>
<p>In step 4, the Responder concludes the registration procedure with an R2 packet and
               acknowledges the registered services in the REG_RES parameter. The Responder may also
               denote unsuccessful registrations in the REG_FAILED parameter in R2. The Responder
               also includes a REG_FROM parameter that contains the transport address of the client
               as observed by the Relay (Server Reflexive candidate). After the registration, the
               Initiator needs to send periodically NAT keep-alives. 
</p>
<p> There are different ways for an Initiator to learn it's publically visible IP
               address and port that are referred to as the "server reflexive transport candidate"
               in this document. This document makes use of two ways:
</p>
<p>
               </p>
<ul class="text">
<li>The Relay client may use STUN servers to detect the server reflexive locator,
                     as described in <a class='info' href='#I-D.ietf-behave-p2p-state'>[I&#8209;D.ietf&#8209;behave&#8209;p2p&#8209;state]<span> (</span><span class='info'>Srisuresh, P., Ford, B., and D. Kegel, &ldquo;State of Peer-to-Peer(P2P) Communication Across Network Address  Translators(NATs),&rdquo; November&nbsp;2007.</span><span>)</span></a>. 
</li>
<li>Alternatively, the Relay Client can learn it from the REG_FROM parameter when
                     registering to a Relay.
</li>
</ul><p>
            
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Base Exchange via HIP Relay</h3>

<p> It is RECOMMENDED that the Initiator sends an I1 packet encapsulated in UDP when it
               is destined to an IPv4 address of the Responder. Respectively, the Responder MUST
               respond to a such I1 packet with an R1 packet over the transport layer and using the
               same transport protocol. The rest of the base exchange, I2 and R2, MUST also use the
               same transport layer.
</p><br /><hr class="insert" />
<a name="fig:bex"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
I                            HIP Relay                          R
| 1. UDP(I1)                   |                                |
+-----------------------------&gt;| 2. UDP(I1(RELAY_FROM))         |
|                              +-------------------------------&gt;|
|                              |                                |
|                              | 3. UDP(R1(RELAY_TO))           |
| 4. UDP(R1(RELAY_TO))         |&lt;-------------------------------+
|&lt;-----------------------------+                                |
|                              |                                |
| 5. UDP(I2(LOCATOR))          |                                |
+-----------------------------&gt;|                                |
|                              | 6. UDP(I2(LOCATOR,RELAY_FROM)) |
|                              +-------------------------------&gt;|
|                              |                                |
|                              | 7. UDP(R2(LOCATOR,RELAY_TO))   |
| 8. UDP(R2(LOCATOR,RELAY_TO)) |&lt;-------------------------------+
|&lt;-----------------------------+                                |
|                              |                                |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Base Exchange via a HIP Relay&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p> In step 1 of <a class='info' href='#fig:bex'>Figure&nbsp;2<span> (</span><span class='info'>Base Exchange via a HIP Relay</span><span>)</span></a>, the Initiator sends an I1 packet over the
               transport layer to the HIT of the Responder. The source address is one of the
               locators of the host. The locators of the end-hosts are referred as "host candidates"
               in this document. 
</p>
<p> In step 2, the HIP Relay receives the I1 packet at port HIPPORT. If the destination
               HIT belongs to a registered Responder, the Relay processes the packet. Otherwise, the
               Relay MUST drop the packet silently. The Relay appends a RELAY_FROM parameter to the
               I1 packet which constains the transport source address and port of the I1 as observed
               by the Relay. The Relay protects the I1 packet with RELAY_HMAC as described in <a class='info' href='#I-D.ietf-hip-rvs'>[I&#8209;D.ietf&#8209;hip&#8209;rvs]<span> (</span><span class='info'>Laganier, J. and L. Eggert, &ldquo;Host Identity Protocol (HIP) Rendezvous Extension,&rdquo; June&nbsp;2006.</span><span>)</span></a>, except that the parameter type is different. The
               Relay changes the source and destination ports and IP addresses of the packet to
               match the values the Responder used when registering to the Relay, i.e., the reverse
               of the R2 used in the registration. The Relay MUST recalculate the transport checksum
               and forward the packet to the Responder.
</p>
<p> In step 3, the Responder receives the I1 packet. The Responder processes it
               according to the rules in <a class='info' href='#I-D.ietf-hip-base'>[I&#8209;D.ietf&#8209;hip&#8209;base]<span> (</span><span class='info'>Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;Host Identity Protocol,&rdquo; October&nbsp;2007.</span><span>)</span></a>. In addition, the
               Responder validates the RELAY_HMAC according to <a class='info' href='#I-D.ietf-hip-rvs'>[I&#8209;D.ietf&#8209;hip&#8209;rvs]<span> (</span><span class='info'>Laganier, J. and L. Eggert, &ldquo;Host Identity Protocol (HIP) Rendezvous Extension,&rdquo; June&nbsp;2006.</span><span>)</span></a> and
               silenty drops the packet if the validation fails. The Responder replies with an R1
               packet to which it includes a RELAY_TO parameter. The RELAY_TO parameter contains
               same information as the RELAY_FROM parameter, i.e., Initiator transport address, but
               the type of the parameter is different. The RELAY_TO parameter is not integrity
               protected by the signature of the R1 to allow pre-created R1 packets at the
               Responder. 
</p>
<p> In step 4, the Relay receives the R1 packet. The Relay drops the packet silently if
               the source HIT belongs to an unregistered host. The Relay MAY verify the signature of
               the R1 packet and drop it if the signature is invalid. Otherwise, the Relay rewrites
               to source address and port, changes the destination address and port to match
               RELAY_TO information, recalculates transport checksum and forwards the packet. 
</p>
<p> In step 5, the Initiator receives the R1 packet and processes it according to <a class='info' href='#I-D.ietf-hip-base'>[I&#8209;D.ietf&#8209;hip&#8209;base]<span> (</span><span class='info'>Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;Host Identity Protocol,&rdquo; October&nbsp;2007.</span><span>)</span></a>. It replies with an I2 packet that uses the
               destination transport address of R1 as the source address and port. The I2 contains a
               LOCATOR parameter that lists all the ICE candidates (offer) of the Initiator. 
               The candidates are encoded using the format defined in 
               <a class='info' href='#sec:locator_format'>Section&nbsp;5.4<span> (</span><span class='info'>LOCATOR Parameter</span><span>)</span></a>.
</p>
<p> In step 6, the Relay receives the I2 packet. The relay appends a RELAY_FROM and a
               RELAY_HMAC to the I2 packet as in the second step. 
</p>
<p> In step 7, the Responder receives the I2 packet and processes it according to <a class='info' href='#I-D.ietf-hip-base'>[I&#8209;D.ietf&#8209;hip&#8209;base]<span> (</span><span class='info'>Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;Host Identity Protocol,&rdquo; October&nbsp;2007.</span><span>)</span></a>. It replies with a R2 packet and includes a RELAY_TO
               parameter as in step three. The R2 packet includes a LOCATOR parameter that lists all
               the ICE candidates (answer) of the Responder. The RELAY_TO parameter is protected by the HMAC. 
</p>
<p> In step 8, the Relay processes the R2 as described in step four. The Relay forwards
               the packet to the Responder. 
</p>
<a name="sec:connectivity"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Connectivity Tests</h3>

<a name="sec:nat_transform"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
NAT Transformation Negotiation</h3>

<p> This section describes usage of a new optional transform parameter type. The
               presence of the parameter in HIP base exchange means that the host supports all of
               the extensions defined in this document. If the transform parameter is used, hosts
               MUST use a password for STUN HMACs that is drawn from the DH keying material.
                
</p>
<p> The transform parameter applies both to the registration to the HIP Relay as well as
               to a base exchange between end-hosts. The transform negotiation in base exchange is
               illustrated in <a class='info' href='#fig:nat_transform'>Figure&nbsp;3<span> (</span><span class='info'>Negotiation of NAT Transforms</span><span>)</span></a>. 
</p><br /><hr class="insert" />
<a name="fig:nat_transform"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
Initiator                                                Responder
  | 1. UDP(I1)                                                   |
  +-------------------------------------------------------------&gt;|
  |                                                              |
  | 2. UDP(R1(.., NAT_TRANSFORM(list of transforms), ..))        |
  |&lt;-------------------------------------------------------------+
  |                                                              |
  | 3. UDP(I2(.., NAT_TRANSFORM(selected transform), LOCATOR..)) |
  +-------------------------------------------------------------&gt;|
  |                                                              |
  | 4. UDP(R2(.., LOCATOR, ..))                                  |
  |&lt;-------------------------------------------------------------+
  |                   ....                                       |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Negotiation of NAT Transforms&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p> In step 1, the Initiator sends an I1 to the Responder. In step 2, the Responder
               responds with an R1. The R1 contains a list of transforms the Responder supports in
               NAT_TRANSFORM parameter as shown in <a class='info' href='#tbl:locator_transform'>Table&nbsp;1<span> (</span><span class='info'>Locator Transformations</span><span>)</span></a>. 
</p><br /><hr class="insert" />
<a name="tbl:locator_transform"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Transform Type</th><th align="left">Purpose</th></tr>
<tr>
<td align="left">RESERVED</td>
<td align="left">Reserved for future use</td>
</tr>
<tr>
<td align="left">ICE-STUN-UDP</td>
<td align="left">UDP encapsulated control and data traffic with ICE-based connectivity tests using
                  STUN messages</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 1: Locator Transformations&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p> In step 3, the Initiator sends an I2 that includes a NAT_TRANSFORM parameter. It
               contains the transform type selected by the Initiator from the list of transforms
               offered by the Responder. The I2 also includes the locators of the Initiator in a
               LOCATOR parameter. 
</p>
<p> In step 4, the Responder concludes the base exchange with an R2 packet. The
               Responder includes a LOCATOR parameter in the R2 packet. 
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
ICE Procedure</h3>

<p> Hosts exchange HIP control packets through the HIP Relay. Connectivity tests
               are, however, directly exchanged between the address pairs to determine operational
               address pairs. If a working direct path between the hosts is found, also the HIP 
               control traffic MAY start using it.
</p>
<p> The base exchange is completed with an R2 packet. Then, the state of the HIP
               associations at both peers is ESTABLISHED, but the peers MUST NOT allow any ESP
               traffic until the connectivity tests are performed successfully. All of the locators,
               except the HIP Relay address, are in UNVERIFIED state. In the connectivity tests, the
               hosts test connectivity between different locator pairs in order to find a working
               one. The connectivity tests are illustrated in <a class='info' href='#fig:connectivity'>Figure&nbsp;4<span> (</span><span class='info'>Connectivity tests</span><span>)</span></a>. In
               this example, both hosts are behind NATs. 
</p><br /><hr class="insert" />
<a name="fig:connectivity"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
I                            HIP Relay                          R
| 2. UDP(R2(LOCATOR,RELAY_TO))  | 1. UDP(R2(LOCATOR,RELAY_TO))  |
|&lt;------------------------------+-------------------------------|
|                                                               |
|           3. Connectivity tests for address pairs             |
|&lt;-------------------------------------------------------------&gt;|
|                                                               |
|           4. HIP UPDATE for preferred address pair            |
|&lt;-------------------------------------------------------------&gt;|
|                                                               |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Connectivity tests&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p> In steps 1 and 2, the R2 packet is relayed from the Responder through the Relay to
               the Initiator.
</p>
<p>Afterwards, connectivity tests are started based on the procedure described in <a class='info' href='#I-D.rosenberg-mmusic-ice-nonsip'>[I&#8209;D.rosenberg&#8209;mmusic&#8209;ice&#8209;nonsip]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Guidelines for Usage of Interactive Connectivity Establishment (ICE) by non  Session Initiation Protocol (SIP) Protocols,&rdquo; July&nbsp;2008.</span><span>)</span></a> by using the candiates previously
               exchanged in the HIP base exchange.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
NAT Keep-alives</h3>

<p>Data channel keepalives are STUN Binding Indications. Keepalives MUST be sent every
               20 seconds at the minimum when the channel is idle. To implement failure tolerance, a
               host SHOULD have smaller keepalive period. When data traffic is exchanged between the
               end points then no further STUN keepalives need to be exchanged.
</p>
<a name="sec:format"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Packet Formats</h3>

<p> The following subsections define the parameter and packet encodings. All values MUST be
            in network byte order. 
</p>
<a name="sec:udphip"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
HIP Control Packets</h3>
<br /><hr class="insert" />
<a name="fig:udphip"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        Source Port            |      Destination Port         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Length              |           Checksum            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       32 bits of zeroes                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                    HIP Header and Parameters                  ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: Format for UDP-encapsulated HIP Control Packets&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
               HIP control packets are encapsulated in UDP packets like in Section 2.2 of
               <a class='info' href='#RFC3948'>[RFC3948]<span> (</span><span class='info'>Huttunen, A., Swander, B., Volpe, V., DiBurro, L., and M. Stenberg, &ldquo;UDP Encapsulation of IPsec ESP Packets,&rdquo; January&nbsp;2005.</span><span>)</span></a>, "rules for encapsulating IKE messages", except that a
               different port number is used. <a class='info' href='#fig:udphip'>Figure&nbsp;5<span> (</span><span class='info'>Format for UDP-encapsulated HIP Control Packets</span><span>)</span></a> shows the encapsulation:
               UDP header is followed by 32 zero bits that can be used to differentiate HIP control
               packets from ESP packets. The HIP header and parameters follow the conventions of
                  <a class='info' href='#I-D.ietf-hip-base'>[I&#8209;D.ietf&#8209;hip&#8209;base]<span> (</span><span class='info'>Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;Host Identity Protocol,&rdquo; October&nbsp;2007.</span><span>)</span></a> with the exception that the HIP header checksum
               MUST be zero. The HIP header checksum is zero for two reasons. First, the UDP header
               contains already a checksum. Second, the checksum definition in <a class='info' href='#I-D.ietf-hip-base'>[I&#8209;D.ietf&#8209;hip&#8209;base]<span> (</span><span class='info'>Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;Host Identity Protocol,&rdquo; October&nbsp;2007.</span><span>)</span></a> includes the IP addresses in the checksum
               calculation. The NATs unaware of HIP cannot recompute the HIP checksum after changing
               IP addresses. 
</p>
<p> A HIP Relay or a Responder without a relay MUST listen at transport port HIPPORT for
               incoming UDP-encapsulated HIP control packets. 
</p>
<a name="sec:keep-alive"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Keep-Alives</h3>

<p> Control and data channel keep-alives are STUN Binding Indications, as defined in
                  <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>. They use the same UDP header as the
               HIP control packets but there is no non-ESP-marker between the UDP header and the
               STUN header. STUN messages are demultiplexed from ESP and HIP control messages using
               the STUN markers, such as the magic cookie value.
               
            
</p>
<a name="sec:rel-reg-params"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Relay and Registration Parameters</h3>
<br /><hr class="insert" />
<a name="fig:udpparams"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             Type              |             Length            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                            Address                            |
|                                                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             Port              |           Transport           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Type        [ TBD by IANA:
              RELAY_FROM: (63998 = 2^16 - 2^11 + 2^9 - 2)
              RELAY_TO:   (64002 = 2^16 - 2^11 + 2^9 + 2)
              REG_FROM: (64010 = 2^16 - 2^11 + 2^9 + 10) ]

Length      20
Address     An IPv6 address or an IPv4 address in "IPv4-compatible
            IPv6 address" format
Port        Transport port number; zero when plain IP is used
Transport   Transport protocol type; zero for UDP
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: Format for the RELAY_FROM, 
RELAY_TO and REG_FROM parameters&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p> Format of the RELAY_FROM, RELAY_TO and REG_FROM parameters is shown in <a class='info' href='#fig:udpparams'>Figure&nbsp;6<span> (</span><span class='info'>Format for the RELAY_FROM,  RELAY_TO and REG_FROM parameters</span><span>)</span></a>. Parameters are identical except for the type field. 
</p>
<a name="sec:locator_format"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
LOCATOR Parameter</h3>

<p> The generic LOCATOR parameter format is the same as in <a class='info' href='#I-D.ietf-hip-mm'>[I&#8209;D.ietf&#8209;hip&#8209;mm]<span> (</span><span class='info'>Henderson, T., &ldquo;End-Host Mobility and Multihoming with the Host Identity Protocol,&rdquo; March&nbsp;2007.</span><span>)</span></a>. However, presenting ICE candidates requires a new
               locator type. The generic and NAT traversal specific locator parameters are illustrated in
                  <a class='info' href='#fig:locator'>Figure&nbsp;7<span> (</span><span class='info'>LOCATOR parameter</span><span>)</span></a>. 
</p><br /><hr class="insert" />
<a name="fig:locator"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             Type              |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Traffic Type  |  Locator Type | Locator Length|  Reserved   |P|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Locator Lifetime                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            Locator                            |
|                                                               |
|                                                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
.                                                               .
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Traffic Type  |  Loc Type = 2 | Locator Length|  Reserved   |P|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Locator Lifetime                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Transport Port            |  Transp. Proto|     Kind      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Priority                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              SPI                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            Locator                            |
|                                                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: LOCATOR parameter&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p> The individual fields in the LOCATOR parameter are described in <a class='info' href='#tbl:locator'>Table&nbsp;2<span> (</span><span class='info'>Fields of the LOCATOR parameter</span><span>)</span></a>. 
</p><br /><hr class="insert" />
<a name="tbl:locator"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">Field</th><th align="left">Value(s)</th><th align="left">Purpose</th></tr>
<tr>
<td align="left">Type</td>
<td align="left">193</td>
<td align="left">Parameter type</td>
</tr>
<tr>
<td align="left">Length</td>
<td align="left">Variable</td>
<td align="left">Length in octets, excluding Type and Length fields and padding</td>
</tr>
<tr>
<td align="left">Traffic Type</td>
<td align="left">0-2</td>
<td align="left">Is the locator for HIP signaling (1), for ESP (2), or for both (0)</td>
</tr>
<tr>
<td align="left">Locator Type</td>
<td align="left">2</td>
<td align="left">"Transport address" locator type</td>
</tr>
<tr>
<td align="left">Locator Length</td>
<td align="left">7</td>
<td align="left">Length of the Locator field in 4-octet units</td>
</tr>
<tr>
<td align="left">Reserved</td>
<td align="left">0</td>
<td align="left">Reserved for future extensions</td>
</tr>
<tr>
<td align="left">Preferred (P) bit</td>
<td align="left">0</td>
<td align="left">Not used for transport address locators; MUST be ignored by the receiver.</td>
</tr>
<tr>
<td align="left">Locator Lifetime</td>
<td align="left">Variable</td>
<td align="left">Locator lifetime in seconds</td>
</tr>
<tr>
<td align="left">Transport Port</td>
<td align="left">Variable</td>
<td align="left">Transport layer port number</td>
</tr>
<tr>
<td align="left">Transport Protocol</td>
<td align="left">0</td>
<td align="left">0 for UDP</td>
</tr>
<tr>
<td align="left">Kind</td>
<td align="left">Variable</td>
<td align="left">0 for host, 1 for server reflexive, 2 for peer reflexive or 3 for relayed address</td>
</tr>
<tr>
<td align="left">Priority</td>
<td align="left">Variable</td>
<td align="left">Locator's priority as described in <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a></td>
</tr>
<tr>
<td align="left">SPI</td>
<td align="left">Variable</td>
<td align="left">SPI value which the host expects to see in incoming ESP packets that use this
                  locator</td>
</tr>
<tr>
<td align="left">Locator</td>
<td align="left">Variable</td>
<td align="left">IPv6 address or an "IPv4-compatible IPv6 address" format IPv4 address <a class='info' href='#RFC3513'>[RFC3513]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;Internet Protocol Version 6 (IPv6) Addressing Architecture,&rdquo; April&nbsp;2003.</span><span>)</span></a>, obfuscated by XORring it with the owner's HIT</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 2: Fields of the LOCATOR parameter&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="sec:relay-hmac"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
RELAY_HMAC</h3>

<p> The RELAY_HMAC parameter value has the TLV type 65520 (2^16 - 2^5 + 2^4). It has the
               same semantics as RVS_HMAC <a class='info' href='#I-D.ietf-hip-rvs'>[I&#8209;D.ietf&#8209;hip&#8209;rvs]<span> (</span><span class='info'>Laganier, J. and L. Eggert, &ldquo;Host Identity Protocol (HIP) Rendezvous Extension,&rdquo; June&nbsp;2006.</span><span>)</span></a>. 
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.6"></a><h3>5.6.&nbsp;
Registration Types</h3>

<p> The REG_INFO, REQ_REQ, REG_RESP and REG_FAILED parameters contain values for HIP
               Relay registration. The value for RELAY_UDP_HIP is 2. The value for RELAY_UDP_ESP is
               3. 
</p>
<a name="sec:udpesp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.7"></a><h3>5.7.&nbsp;
HIP ESP Data Packet Formats</h3>

<p>
               <a class='info' href='#RFC3948'>[RFC3948]<span> (</span><span class='info'>Huttunen, A., Swander, B., Volpe, V., DiBurro, L., and M. Stenberg, &ldquo;UDP Encapsulation of IPsec ESP Packets,&rdquo; January&nbsp;2005.</span><span>)</span></a> describes UDP encapsulation of the IPsec ESP transport and
               tunnel mode. On the wire the HIP ESP packets do not differ from the transport mode
               ESP and thus the encapsulation of the HIP ESP packets is same as the UDP
               encapsulation transport mode ESP. 
</p>
<p> During the HIP base exchange, the two peers exchange parameters that enable them to
               define a pair of IPsec ESP security associations (SAs), as described in <a class='info' href='#I-D.ietf-hip-esp'>[I&#8209;D.ietf&#8209;hip&#8209;esp]<span> (</span><span class='info'>Jokela, P., &ldquo;Using ESP transport format with HIP,&rdquo; June&nbsp;2007.</span><span>)</span></a>. When two peers perform a UDP-encapsulated base
               exchange, they MUST define a pair of IPsec SAs that produces UDP-encapsulated ESP
               data traffic. 
</p>
<p> The management of encryption/authentication protocols and security parameter indices
               (SPIs) is defined in <a class='info' href='#I-D.ietf-hip-esp'>[I&#8209;D.ietf&#8209;hip&#8209;esp]<span> (</span><span class='info'>Jokela, P., &ldquo;Using ESP transport format with HIP,&rdquo; June&nbsp;2007.</span><span>)</span></a>. The UDP encapsulation format
               and processing of HIP ESP traffic is described in Section 6.1 of <a class='info' href='#I-D.ietf-hip-esp'>[I&#8209;D.ietf&#8209;hip&#8209;esp]<span> (</span><span class='info'>Jokela, P., &ldquo;Using ESP transport format with HIP,&rdquo; June&nbsp;2007.</span><span>)</span></a>. 
</p>
<p> Section 5.1 of <a class='info' href='#RFC3948'>[RFC3948]<span> (</span><span class='info'>Huttunen, A., Swander, B., Volpe, V., DiBurro, L., and M. Stenberg, &ldquo;UDP Encapsulation of IPsec ESP Packets,&rdquo; January&nbsp;2005.</span><span>)</span></a> describes a security issue for the UDP
               encapsulation in the standard IP tunnel mode when two hosts behind different NATs
               have the same private IP address and initiate communication to the same Responder in
               the public Internet. The Responder cannot distinguish between two hosts, because
               security associations are based on the same inner IP addresses. 
</p>
<p> This issue does not exist with the UDP encapsulation of HIP ESP transport format
               because the Responder use HITs to distinguish between different communication
               instances. 
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Privacy Considerations</h3>

<p> The LOCATORs are sent XORed format in plain text in favour of inspection at
               HIP-aware middleboxes in the future. The current draft does not specify encrypted
               versions of LOCATORs even though it could be beneficial for privacy reasons. 
</p>
<p> It is possible that an Initiator or Responder may not want to reveal all of its
               locators to its peer. For example, a host may not want to reveal the internal
               topology of the private address realm and it discards host addresses. Such behavior
               creates non-optimal paths when the hosts are located behind the same NAT. Especially,
               this could be a problem with a legacy NAT that does not support routing from the
               private address realm back to itself through the outer address of the NAT. This
               scenario is referred to as the hairpin problem <a class='info' href='#I-D.ietf-behave-p2p-state'>[I&#8209;D.ietf&#8209;behave&#8209;p2p&#8209;state]<span> (</span><span class='info'>Srisuresh, P., Ford, B., and D. Kegel, &ldquo;State of Peer-to-Peer(P2P) Communication Across Network Address  Translators(NATs),&rdquo; November&nbsp;2007.</span><span>)</span></a>. With such a legacy NAT, the only option left
               would be to use a relayed transport address from a TURN server. As a consequence, a
               host may support locator-based privacy by leaving out the reflexive candidates. Using
               only host candidates can produce suboptimal paths possibly causing congestion. 
</p>
<p> The use of HIP Relays or TURN Relays can be useful for protection against
               Denial-of-Service attacks. If a Responder reveals only its HIP and ESP relay
               candidates to malign Initiators, the Initiators can only attack the relays that does
               not prevent the Responder from initiating new outgoing connections if a path around
               the relay exists. 
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Opportunistic Mode</h3>

<p> A HIP Relay should have one address per Relay Client when a HIP Relay is serving
               more than one Relay Clients and is willing to support opportunistic mode. Otherwise,
               it cannot be guaranteed that the Relay can deliver the I1 packet to the intended
               recipient. 
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p> This section is to be interpreted according to <a class='info' href='#RFC2434'>[RFC2434]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; October&nbsp;1998.</span><span>)</span></a>. 
</p>
<p> This draft currently uses a UDP port in the "Dynamic and/or Private Port" and HIPPORT.
            Upon publication of this document, IANA is requested to register a UDP port and the RFC
            editor is requested to change all occurrences of port HIPPORT to the port IANA has
            registered. The HIPPORT number 50500 should be used for initial experimentation. 
</p>
<p> This document updates the IANA Registry for HIP Parameter Types by assigning new HIP
            Parameter Type values for the new HIP Parameters: RELAY_FROM, RELAY_TO and REG_FROM
            (defined in <a class='info' href='#sec:rel-reg-params'>Section&nbsp;5.3<span> (</span><span class='info'>Relay and Registration Parameters</span><span>)</span></a>) and RELAY_HMAC (defined in 
            <a class='info' href='#sec:relay-hmac'>Section&nbsp;5.5<span> (</span><span class='info'>RELAY_HMAC</span><span>)</span></a>). 
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Contributors</h3>

<p> Marcelo Bagnulo, Jan Mel&eacute;n, Simon Schuetz, Martin Stiemerling, Lars Eggert, Vivien
            Schmitt, Abhinav Pathak and Andrei Gurtov have contributed to the initial versions of
            this draft. 
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Acknowlegements</h3>

<p> Thanks for Jonathan Rosenberg and the rest of the MMUSIC WG folks for the excellent
            work on ICE. In addition, the authors would like to thank Andrei Gurtov, Tobias Heer,
            Teemu Koponen, Juhana Mattila, Jeffrey M. Ahrenholz, Thomas Henderson, Kristian Slavov,
            Janne Lindqvist, Pekka Nikander, Lauri Silvennoinen, Jukka Ylitalo, Juha Heinanen,
            Joakim Koskela, Samu Varjonen, Dan Wing, Hannes Tschofenig, Jan Mel&eacute;n, Jani
            Hautakorpi and Ari Ker&auml;nen For their comments on this document. 
</p>
<p>Miika Komu is working in the Networking Research group at Helsinki Institute for
            Information Technology (HIIT). The InfraHIP project was funded by Tekes, Telia-Sonera,
            Elisa, Nokia, the Finnish Defence Forces, and Ericsson and Birdstep. 
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-rfc3489bis">[I-D.ietf-behave-rfc3489bis]</a></td>
<td class="author-text">Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-rfc3489bis-18.txt">Session Traversal Utilities for (NAT) (STUN)</a>,&rdquo; draft-ietf-behave-rfc3489bis-18 (work in progress), July&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-rfc3489bis-18.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-turn">[I-D.ietf-behave-turn]</a></td>
<td class="author-text">Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-turn-16.txt">Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN)</a>,&rdquo; draft-ietf-behave-turn-16 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-turn-16.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-hip-base">[I-D.ietf-hip-base]</a></td>
<td class="author-text">Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-hip-base-10.txt">Host Identity Protocol</a>,&rdquo; draft-ietf-hip-base-10 (work in progress), October&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-hip-base-10.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-hip-esp">[I-D.ietf-hip-esp]</a></td>
<td class="author-text">Jokela, P., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-hip-esp-06.txt">Using ESP transport format with HIP</a>,&rdquo; draft-ietf-hip-esp-06 (work in progress), June&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-hip-esp-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-hip-mm">[I-D.ietf-hip-mm]</a></td>
<td class="author-text">Henderson, T., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-hip-mm-05.txt">End-Host Mobility and Multihoming with the Host Identity Protocol</a>,&rdquo; draft-ietf-hip-mm-05 (work in progress), March&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-hip-mm-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-hip-registration">[I-D.ietf-hip-registration]</a></td>
<td class="author-text">Laganier, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-hip-registration-02.txt">Host Identity Protocol (HIP) Registration Extension</a>,&rdquo; draft-ietf-hip-registration-02 (work in progress), June&nbsp;2006 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-hip-registration-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-hip-rvs">[I-D.ietf-hip-rvs]</a></td>
<td class="author-text">Laganier, J. and L. Eggert, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-hip-rvs-05.txt">Host Identity Protocol (HIP) Rendezvous Extension</a>,&rdquo; draft-ietf-hip-rvs-05 (work in progress), June&nbsp;2006 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-hip-rvs-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mmusic-ice">[I-D.ietf-mmusic-ice]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-19.txt">Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols</a>,&rdquo; draft-ietf-mmusic-ice-19 (work in progress), October&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-19.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.rosenberg-mmusic-ice-nonsip">[I-D.rosenberg-mmusic-ice-nonsip]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-rosenberg-mmusic-ice-nonsip-01.txt">Guidelines for Usage of Interactive Connectivity Establishment (ICE) by non  Session Initiation Protocol (SIP) Protocols</a>,&rdquo; draft-rosenberg-mmusic-ice-nonsip-01 (work in progress), July&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-rosenberg-mmusic-ice-nonsip-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2434">[RFC2434]</a></td>
<td class="author-text"><a href="mailto:narten@raleigh.ibm.com">Narten, T.</a> and <a href="mailto:Harald@Alvestrand.no">H. Alvestrand</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2434">Guidelines for Writing an IANA Considerations Section in RFCs</a>,&rdquo; BCP&nbsp;26, RFC&nbsp;2434, October&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2434.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2434.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2434.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3513">[RFC3513]</a></td>
<td class="author-text">Hinden, R. and S. Deering, &ldquo;<a href="http://tools.ietf.org/html/rfc3513">Internet Protocol Version 6 (IPv6) Addressing Architecture</a>,&rdquo; RFC&nbsp;3513, April&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3513.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4423">[RFC4423]</a></td>
<td class="author-text">Moskowitz, R. and P. Nikander, &ldquo;<a href="http://tools.ietf.org/html/rfc4423">Host Identity Protocol (HIP) Architecture</a>,&rdquo; RFC&nbsp;4423, May&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4423.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-p2p-state">[I-D.ietf-behave-p2p-state]</a></td>
<td class="author-text">Srisuresh, P., Ford, B., and D. Kegel, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-p2p-state-06.txt">State of Peer-to-Peer(P2P) Communication Across Network Address  Translators(NATs)</a>,&rdquo; draft-ietf-behave-p2p-state-06 (work in progress), November&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-p2p-state-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.irtf-hiprg-nat">[I-D.irtf-hiprg-nat]</a></td>
<td class="author-text">Stiemerling, M., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-irtf-hiprg-nat-04.txt">NAT and Firewall Traversal Issues of Host Identity Protocol (HIP)  Communication</a>,&rdquo; draft-irtf-hiprg-nat-04 (work in progress), March&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-irtf-hiprg-nat-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2663">[RFC2663]</a></td>
<td class="author-text"><a href="mailto:srisuresh@lucent.com">Srisuresh, P.</a> and <a href="mailto:holdrege@lucent.com">M. Holdrege</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2663">IP Network Address Translator (NAT) Terminology and Considerations</a>,&rdquo; RFC&nbsp;2663, August&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2663.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3948">[RFC3948]</a></td>
<td class="author-text">Huttunen, A., Swander, B., Volpe, V., DiBurro, L., and M. Stenberg, &ldquo;<a href="http://tools.ietf.org/html/rfc3948">UDP Encapsulation of IPsec ESP Packets</a>,&rdquo; RFC&nbsp;3948, January&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3948.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4787">[RFC4787]</a></td>
<td class="author-text">Audet, F. and C. Jennings, &ldquo;<a href="http://tools.ietf.org/html/rfc4787">Network Address Translation (NAT) Behavioral Requirements for Unicast UDP</a>,&rdquo; BCP&nbsp;127, RFC&nbsp;4787, January&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4787.txt">TXT</a>).</td></tr>
</table>

<a name="firewalls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Firewall Traversal</h3>

<p> This section describes firewall traversal issues separately from NAT issues. When the
            Initiator or the Responder of a HIP association is behind a firewall, additional issues
            arise. The firewall discussion applies both to IPv4 and IPv6 addressing. 
</p>
<p> The NAT traversal mechanisms described in this document require that the firewall -
            stateful or not - allows UDP traffic. At the minimum, successful firewall control packet
            traversal requires that the host behind the firewall is allowed to communicate packets
            with a HIP Relay (or a Responder without HIP Relay) that is listening on UDP port
            HIPPORT. Successful ESP data packet traversal requires the same for the TURN server. For
            unrelayed traffic, the destination port HIPPORT should be open at the firewall to all
            hosts behind the firewall. 
</p>
<p> Most firewall implementations support "UDP connection tracking", i.e., after a host
            behind a firewall has initiated UDP communication to the public Internet, the firewall
            accepts UDP response traffic in the return direction. If no such return traffic arrives
            for a specific period of time, the firewall stops accepting the given IP address and
            port pair. The mechanisms described in this document already enable traversal of such
            firewalls, if the keep-alive interval used is less than the refresh interval of the
            firewall. 
</p>
<p> When the Initiator is behind a firewall, the NAT traversal mechanisms described in this
            document depend on the ability to initiate communication via UDP to the destination port
            HIPPORT from arbitrary source ports and to receive UDP response traffic from that port
            to the chosen source port. If the Initiator is behind a firewall that does not support
            "UDP connection tracking", the NAT traversal mechanisms described in this document can
            still be supported, if the firewall allows permanently inbound UDP traffic from the port
            HIPPORT and destined to arbitrary source IP addresses and UDP ports. 
</p>
<p> When the Responder is behind a firewall, the NAT traversal mechanisms described in this
            document depend on the ability to send and receive UDP traffic originating from HIPPORT
            of the HIP Relays and TURN servers. When end-to-end traffic is preferred, arbitrary
            source IP addresses and ports are required. 
</p>
<a name="sec:no_relay"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Base Exchange without ICE Connectivity Checks</h3>

<p>
In certain network environments, the ICE connectivity tests can be
omitted to reduce initial connection set up latency because base
exchange acts an implicit connectivity test itself. There are three
assumptions about such as environments. First, the Responder should
have a long-term, fixed locator in the network. Second, the Responder
should not have a HIP Relay configured for itself. Third, the
Initiator can reach the Responder by simply UDP encapsulating HIP and
ESP packets to the host. Detecting and configuring this particular
scenario is prone administrative failure unless carefully planned.

</p>
<p>
In such a scenario, the Initiator sends an I1 packet over UDP to the
Responder. The Responder replies with a R1 packet that does not
contain the transform parameter as explained in
<a class='info' href='#sec:nat_transform'>Section&nbsp;4.1<span> (</span><span class='info'>NAT Transformation Negotiation</span><span>)</span></a>. The Initiator receives the R1
packet and determines from the absence of the transform and RELAY_TO
parameters that ICE connectivity tests can be omitted with the
Responder. Finally, the hosts set up IPsec security associations using
the locators observed from the concluding I2 and R2 packets of the
base exchange without ICE connectivity tests.

</p>
<a name="sec:interoperability"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
IPv4-IPv6 Interoperability</h3>

<p>
Currently Relay Client and Server do not have to run any ICE connectivity
tests as described in <a class='info' href='#sec:no_relay'>Appendix&nbsp;B<span> (</span><span class='info'>Base Exchange without ICE Connectivity Checks</span><span>)</span></a>.  However, it could
be useful for IPv4-IPv6 interoperability when the Relay Server actually
includes both the NAT transform parameter and multiple locators in R2.
The interoperability benefit is that the Relay could support IPv4-based
Initiators and IPv6-based Responders by converting the network headers and
recalculating UDP checksums.

</p>
<p>
Such an approach is underspecified in this document currently. It is not yet
recommended because it may consume resources at the Relay and requires
also similar conversion support at the TURN relay for data packets.

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D"></a><h3>Appendix D.&nbsp;
Base Exchange through a Rendezvous Server</h3>

<p>
This section describes handling for a scenario where Initiator looks
up the information of the Responder from DNS and discovers a RVS
record <a class='info' href='#I-D.ietf-hip-rvs'>[I&#8209;D.ietf&#8209;hip&#8209;rvs]<span> (</span><span class='info'>Laganier, J. and L. Eggert, &ldquo;Host Identity Protocol (HIP) Rendezvous Extension,&rdquo; June&nbsp;2006.</span><span>)</span></a>. In such a case, the
Initiator uses its own HIP Relay to forward HIP traffic to the Rendezvous
server. The Initiator will send the I1 message using the its HIP Relay server
which will then forward it to the RVS server of the responder. The responder
will send the R1 packet directly to the Initiator's HIP Relay server and the
following I2 and R2 packets are also sent directly using the Relay.

</p>
<p>
In case the Initiator is not able to distinguish which records are RVS 
address records and which are Responders address records, then the Initiator 
SHOULD first try to contact the Responder directly and if none of the 
addresses is reachable it MAY try out them using its own HIP Relay as described 
in the above.

</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.E"></a><h3>Appendix E.&nbsp;
Document Revision History</h3>

<p>To be removed upon publication
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left" width="85%">
<tr><th align="left">Revision</th><th align="left">Comments</th></tr>
<tr>
<td align="left">draft-ietf-nat-traversal-00</td>
<td align="left">Initial version.</td>
</tr>
<tr>
<td align="left">draft-ietf-nat-traversal-01</td>
<td align="left">Draft based on RVS.</td>
</tr>
<tr>
<td align="left">draft-ietf-nat-traversal-02</td>
<td align="left">Draft based on Relay proxies and ICE concepts.</td>
</tr>
<tr>
<td align="left">draft-ietf-nat-traversal-03</td>
<td align="left">Draft based on STUN/ICE formats.</td>
</tr>
</table>
<br clear="all" />

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Miika Komu</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Helsinki Institute for Information Technology</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Metsanneidonkuja 4</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Espoo</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+358503841531</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text">+35896949768</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:miika@iki.fi">miika@iki.fi</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.hiit.fi/">http://www.hiit.fi/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Thomas Henderson</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">The Boeing Company</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.O. Box 3707</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Seattle, WA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:thomas.r.henderson@boeing.com">thomas.r.henderson@boeing.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Philip Matthews</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Avaya</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">100 Innovation Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ottawa, Ontario  K2K 3G7</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Canada</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 613 592 4343 224</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:philip_matthews@magma.ca">philip_matthews@magma.ca</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hannes Tschofenig</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia Siemens Networks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Linnoitustie 6</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Espoo  02600</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+358 (50) 4871445</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Hannes.Tschofenig@gmx.net">Hannes.Tschofenig@gmx.net</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.tschofenig.com">http://www.tschofenig.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ari Ker&auml;nen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ericsson Research Nomadiclab</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hirsalantie 11</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">02420 Jorvas</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+358 9 2991</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ari.keranen@ericsson.com">ari.keranen@ericsson.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jan Mel&eacute;n</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ericsson Research Nomadiclab</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hirsalantie 11</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">02420 Jorvas</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+358 9 2991</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jan.melen@ericsson.com">jan.melen@ericsson.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Marcelo Bagnulo</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Lab at UC3M</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Av. Universidad 30</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Leganes, Madrid  28911</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Spain</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">34 91 6249500</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:marcelo@it.uc3m.es">marcelo@it.uc3m.es</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.it.uc3m.es/">http://www.it.uc3m.es/</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
