Internet Engineering Task Force                            Juha Heinanen
INTERNET DRAFT                                             Telia Finland
Expires November 1999                                        Roch Guerin
                                              University of Pennsylvania
                                                               May, 1999

                    A Single Rate Three Color Marker
                 <draft-heinanen-diffserv-srtcm-01.txt>

Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet- Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   Distribution of this memo is unlimited.

Abstract

   This document defines a Single Rate Three Color Marker (srTCM), which
   can be used as component in a Diffserv traffic conditioner [RFC2475,
   RFC2474].  The srTCM meters a traffic stream and marks its packets
   according to three traffic parameters, Committed Information Rate
   (CIR), Committed Burst Size (CBS), and Excess Burst Size (EBS), to be
   either green, yellow, or red.  A packet is marked green if it doesn't
   exceed the CBS, yellow if it does exceed the CBS, but not the EBS,
   and red otherwise.

Heinanen & Guerin   A Single Rate Three Color Marker            [Page 1]

INTERNET DRAFT                                                 May, 1999

1. Introduction

   The Single Rate Three Color Marker (srTCM) meters an IP packet stream
   and marks its packets either green, yellow, or red.  Marking is based
   on a Committed Information Rate (CIR) and two associated burst sizes,
   a Committed Burst Size (CBS) and an Excess Burst Size (EBS).  A
   packet is marked green if it doesn't exceed the CBS, yellow if it
   does exceed the CBS, but not the EBS, and red otherwise.  The srTCM
   is useful, for example, for ingress policing of a service, where only
   the length, not the peak rate, of the burst determines service
   eligibility.

   The Meter meters each packet and passes the packet and the metering
   result to the Marker:

                            +------------+
                            |   Result   |
                            |            V
                        +-------+    +--------+
                        |       |    |        |
      Packet Stream ===>| Meter |===>| Marker |===> Marked Packet Stream
                        |       |    |        |
                        +-------+    +--------+

   The Meter operates in one of two modes.  In the Color-Blind mode, the
   Meter assumes that the packet stream is uncolored.  In the Color-
   Aware mode the Meter assumes that some preceding entity has pre-
   colored the incoming packet stream so that each packet is either
   green, yellow, or red.  The details of the pre-coloring process,
   including handling of error scenarios, and how the Meter determines
   the color of a pre-colored packet are DS domain specific and outside
   the scope of this document.

   The Marker (re)colors an IP packet according to the results of the
   Meter.  The color is coded in the DS field [Nichols] of the packet in
   a PHB specific manner (see section 4 for an example).

   A companion document [Heinanen1] describes another three color
   marker, called a Two Rate Three Color Maker (trTCM), where packets
   are marked based on two rates and two burst sizes.

2. Configuration

   The srTCM is configured by setting its mode and by assigning values
   to three traffic parameters: a Committed Information Rate (CIR), a
   Committed Burst Size (CBS), and an Excess Burst Size (EBS).

   The CIR is measured in bytes of IP packets per second, i.e., it

Heinanen & Guerin   A Single Rate Three Color Marker            [Page 2]

INTERNET DRAFT                                                 May, 1999

   includes the IP header, but not link specific headers.

   The CBS and the EBS and are measured in bytes.  The CBS and EBS MUST
   be configured so that at least one of them is larger than 0.  It is
   RECOMMENDED that when the value of the CBS or the EBS is larger than
   0, it is larger than or equal to the size of the largest possible IP
   packet in the stream.

3. Metering

   The behavior of the Meter is specified in terms of its mode and two
   token buckets, C and E, which both share the common rate CIR.  The
   maximum size of the token bucket C is CBS and the maximum size of the
   token bucket E is EBS.

   The token buckets C and E are initially (at time 0) full, i.e., the
   token count Tc(0) = CBS and the token count Te(0) = EBS.  Thereafter,
   the token counts Tc and Te are updated CIR times per second as
   follows:

     o If Tc is less than CBS, Tc is incremented by one, else

     o if Te is less then EBS, Te is incremented by one, else

     o neither Tc nor Te is incremented.

   When a packet of size B bytes arrives at time t, the following
   happens if the srTCM is configured to operate in the Color-Blind
   mode:

     o If Tc(t)-B >= 0, the packet is green and Tc is decremented by B
       down to the minimum value of 0, else

     o if Te(t)-B >= 0, the packets is yellow and Te is decremented by B
       down to the minimum value of 0, else

     o the packet is red and neither Tc nor Te is decremented.

   When a packet of size B bytes arrives at time t, the following
   happens if the srTCM is configured to operate in the Color-Aware
   mode:

     o If the packet has been precolored as green and Tc(t)-B >= 0, the
       packet is green and Tc is decremented by B down to the minimum
       value of 0, else

     o If the packet has been precolored as green or yellow and if
       Te(t)-B >= 0, the packets is yellow and Te is decremented by B

Heinanen & Guerin   A Single Rate Three Color Marker            [Page 3]

INTERNET DRAFT                                                 May, 1999

       down to the minimum value of 0, else

     o the packet is red and neither Tc nor Te is decremented.

   Note that according to the above rules, marking of a packet with a
   given color requires that there be enough tokens of that color to
   accommodate the entire packet.  Other marking policies are clearly
   possible. The above policy was chosen in order guarantee a
   deterministic behavior where the volume of green packets is never
   smaller than what has been determined by the CIR and CBS, i.e.,
   tokens of a given color are always spent on packets of that color.

   The actual implementation of a Meter doesn't need to be modeled
   according to the above formal specification.

4. Marking

   The Marker reflects the metering result by setting the DS field of
   the packet to a particular codepoint.  In case of the AF PHB
   [Heinanen2], the color can be coded as the drop precedence of the
   packet.

5. Service Example

   The srTCM can be used to mark a packet stream in a service, where
   different, decreasing levels of assurances (either absolute or
   relative) are given to packets which are green, yellow, or red.  For
   example, a service may discard all red packets, because they exceeded
   both the committed and excess burst sizes, forward yellow packets as
   best effort, and forward green packets with a low drop probability.

6. Security Concerns

   The srTCM has no known security concerns.

7. References

   [Heinanen1] J. Heinanen and R. Guerin, A Two Rate Three Color Marker.
   Internet draft draft-heinanen-diffserv-trtcm-01.txt, May 1999.

   [Heinanen2] J. Heinanen, et al., Assured Forwarding PHB Group.
   Internet draft draft-ietf-diffserv-af-06.txt, February 1999.

   [Nichols] K. Nichols and B. Carpenter, Format for Diffserv Working
   Group Traffic Conditioner Drafts. Internet draft draft-ietf-diffserv-
   traffcon-format-00.txt, February 1999.

   [RFC2474] K. Nichols, et al., Definition of the Differentiated

Heinanen & Guerin   A Single Rate Three Color Marker            [Page 4]

INTERNET DRAFT                                                 May, 1999

   Services Field (DS Field) in the IPv4 and IPv6 Headers.  RFC 2474,
   December 1998.

   [RFC2475] S. Blake, et al., An Architecture for Differentiated
   Services. RFC 2475, December 1998.

8. Author Addresses

   Juha Heinanen
   Telia Finland, Inc.
   Myyrmaentie 2
   01600 Vantaa, Finland
   Email: jh@telia.fi

   Roch Guerin
   University of Pennsylvania
   Department of Electrical Engineering, Rm 376 GRW
   200 South 33rd Street
   Philadelphia, PA 19104
   Email: guerin@ee.upenn.edu

Heinanen & Guerin   A Single Rate Three Color Marker            [Page 5]
