<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Mobile IP Interactive Connectivity Establishment (M-ICE)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Mobile IP Interactive Connectivity Establishment (M-ICE)">
<meta name="keywords" content="Internet-Draft, ICE, E2E Connectivity, Mobile IP">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">MIP6</td><td class="header">H. Tschofenig</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Nokia Siemens Networks</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">G. Bajko</td></tr>
<tr><td class="header">Expires: August 28, 2008</td><td class="header">Nokia</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">February 25, 2008</td></tr>
</table></td></tr></table>
<h1><br />Mobile IP Interactive Connectivity Establishment (M-ICE)<br />draft-tschofenig-mip6-ice-02.txt</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on August 28, 2008.</p>

<h3>Abstract</h3>

<p>This document describes how the Interactive Connectivity Establishment (ICE) methodology
        can be used for Mobile IP to determine whether end-to-end communication is possible. ICE
        makes use of the Session Traversal Utilities for NAT (STUN) protocol in addition to
        mechanisms for checking connectivity between peers. After running the ICE the two MIP end
        points will be able to communicate directly or through a relay via Network Address
        Translators (NATs), Network Address and Port Translators (NAPTs) and firewalls.
</p>
<p>This document addresses also the problems raised in RFC 4487 "Mobile IPv6 and Firewalls:
        Problem Statement".
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#introduction">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">1.1.</a>&nbsp;
Gathering Candidate Addresses<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.2.</a>&nbsp;
Connectivity Checks<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.3.</a>&nbsp;
Sorting Candidates<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">1.4.</a>&nbsp;
Frozen Candidates<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">1.5.</a>&nbsp;
Security for Checks<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">1.6.</a>&nbsp;
Concluding M-ICE<br />
<a href="#terminology">2.</a>&nbsp;
Terminology<br />
<a href="#anchor7">3.</a>&nbsp;
Design Choices<br />
<a href="#anchor8">4.</a>&nbsp;
Sending the Initial Offer<br />
<a href="#anchor9">5.</a>&nbsp;
Receiving the Initial Offer<br />
<a href="#anchor10">6.</a>&nbsp;
Receipt of the Initial Answer<br />
<a href="#anchor11">7.</a>&nbsp;
Performing Connectivity Checks<br />
<a href="#anchor12">8.</a>&nbsp;
Concluding ICE Processing<br />
<a href="#anchor13">9.</a>&nbsp;
Subsequent Offer/Answer Exchanges<br />
<a href="#anchor14">10.</a>&nbsp;
Keepalives<br />
<a href="#candidate-exchange">11.</a>&nbsp;
Attribute Encoding<br />
<a href="#anchor15">12.</a>&nbsp;
Demultiplexing MIP and STUN messages<br />
<a href="#anchor16">13.</a>&nbsp;
Example<br />
<a href="#anchor17">14.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">14.1.</a>&nbsp;
Attacks on Connectivity Checks<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">14.2.</a>&nbsp;
Attacks on Address Gathering<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">14.3.</a>&nbsp;
Attacks on the Offer/Answer Exchanges<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">14.4.</a>&nbsp;
Insider Attacks<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">14.4.1.</a>&nbsp;
MIP Amplification Attack<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">14.4.2.</a>&nbsp;
STUN Amplification Attack<br />
<a href="#anchor24">15.</a>&nbsp;
IAB Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">15.1.</a>&nbsp;
Problem Definition<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">15.2.</a>&nbsp;
Exit Strategy<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">15.3.</a>&nbsp;
Brittleness Introduced by M-ICE<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">15.4.</a>&nbsp;
Requirements for a Long Term Solution<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">15.5.</a>&nbsp;
Issues with Existing NAPT Boxes<br />
<a href="#anchor30">16.</a>&nbsp;
Contributors<br />
<a href="#anchor31">17.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">18.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">18.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">18.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> In a typical Mobile IP deployment, there are two endpoints, mobile node and correspondent
        nodes, which want to communicate. They are able to communicate indirectly via a combination
        of Mobile IP signaling and reverse tunneling. A couple of different extensions are available
        for Mobile IP that allow multiple care-of addresses, IPv4/IPv6 interworking and different
        routes to be used through the network.
</p>
<p>Unfortunately, it is likely that some of the available paths do not work due to
        connectivity problems caused by firewalling behavior. The VoIP community has investigated
        these problems extensively and developed a protocols and a methodology to systematically
        perform connectivity checks in order to determine a working path between the two end points.
        The Interactive Connectivity Establishment (ICE) specification describes how the Session
        Traversal Utilities for NAT (STUN) protocol can be used to execute these checks. This
        document suggests to utilize the ICE methodology and if possible STUN for Mobile IP, both
        Mobile IPv4 and Mobile IPv6. We call this usage Mobile IP - ICE, M-ICE for short. 
</p>
<p>
        </p>
<blockquote class="text">
<p>This document, however, concentrates on Mobile IPv6 as a starting point. A future
            version of this document will also describe the operation using Mobile IPv4. The ideal
            outcome is that the best available path through the network can be chosen when Mobile IP
            is used regardless of the MIP version and the environmental problems the two end points
            are facing. 
</p>
</blockquote><p>
      
</p>
<p> At the beginning of the M-ICE process, the end points are ignorant of their own
        topologies. They might or might not be behind a NAT (or multiple tiers of NATs) and might be
        behind firewalls that limit the ability to communicate in different ways between the end
        points. M-ICE allows these end points to discover enough information about their topologies
        to potentially find one or more paths by which they can communicate. 
</p>
<p><a class='info' href='#overview'>Figure&nbsp;1<span> (</span><span class='info'>Overview</span><span>)</span></a> shows a typical environment for M-ICE deployment. The two end
        points are labelled L and R (for left and right, which helps visualize call flows). Both L
        and R are behind their own respective NATs or firewalls though they may not be aware of it.
        The type of NAT or firewall and their properties are also unknown. L and R are capable of
        engaging in an end-to-end mobility protocol exchange. This exchange will occur through
        mobility anchor points, such as Home Agents. 
</p>
<p>In this architecture the ICE functionality of TURN servers is provided by the Home Agent
        via reverse tunneling. In this document we assume that the STUN server is co-located with
        the Home Agent since it is convenient from a security and configuration point of view even
        though it is, from a solution point of view, not necessary.
</p>
<p>
        <br /><hr class="insert" />
<a name="overview"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      +--------+         Mobility           +--------+
      | Home   |         Signalling         | Home   |
      | Agent/ |----------------------------| Agent/ |
      | STUN   |                            | STUN   |
      | Server |                            | Server |
      +--------+                            +--------+
          ^                                     ^
          |                                     |
          |                                     |
Mobility  |                                     |Mobility
Signalling|                                     |Signalling
          |                                     |
          |                                     |
      +---v----+                            +---v----+
      | FW/NAT |                            | FW/NAT |
      +---^----+                            +---^----+
          |                                     |
          |                                     |
          v                                     v
      +--------+                            +--------+
      | Agent  |                            |  Agent |
      |   L    |                            |    R   |
      +--------+                            +--------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Overview&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>The basic idea behind M-ICE is as follows: each end point has a variety of candidate
        TRANSPORT ADDRESSES (combination of IP address, transport protocol (UDP), and port) it could
        use to communicate with the other end point.
</p>
<p>
        </p>
<blockquote class="text">
<p>To avoid unnecessary UDP encapsulation of end-to-end traffic in case there is no need
            todo so, it is also possible to consider using IP addresses rather than focusing
            exclusively on TRANSPORT ADDRESSES. For example, two MIP hosts behind the same NAT do
            not need to use UDP encapsulation. If there is no NAT or firewall between the two
            communicating nodes then there is again no need to provide support for UDP
            encapsulation. A future version of this document will provide support for this
            functionality.
</p>
</blockquote><p>
      
</p>
<p>Potentially, any of L's candidate transport addresses can be used to communicate with any
        of R's candidate transport addresses. In practice, however, many combinations do not work.
        For instance, if L and R are both behind NATs, their directly attached interface addresses
        (e.g., 192.168.1.100) are unlikely to be able to communicate. The purpose of M-ICE is to
        discover which pairs of addresses will work. The way that M-ICE does this is to
        systematically try all possible pairs (in a carefully sorted order) until it finds one or
        more that works. Once found, the best pair is used for subsequent communication between the
        hosts.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Gathering Candidate Addresses</h3>

<p>In order to execute ICE, an agent has to identify all of its address candidates. A
          CANDIDATE is a transport address - a combination of IP address and port for a particular
          transport protocol.
</p>
<p>This document uses three types of candidates:
</p>
<p>
          </p>
<ol class="text">
<li>One viable candidate is a transport address obtained directly from a local interface.
              Such a candidate is called a HOST CANDIDATE.
</li>
<li>Translated addresses on the public side of a NAT (called SERVER REFLEXIVE
              CANDIDATES). This address is obtained via STUN.
</li>
<li>Addresses obtained via relaying traffic through a Home Agent, called RELAYED
              CANDIDATES.
</li>
</ol><p>
        
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Connectivity Checks</h3>

<p>Once L has gathered all of its candidates, it orders them in highest to lowest priority
          and sends them to R over the signalling channel. We refer to the signaling channel to the
          end-to-end MIP exchange. The extension to exchange candidates can be found in <a class='info' href='#candidate-exchange'>Section&nbsp;11<span> (</span><span class='info'>Attribute Encoding</span><span>)</span></a>.
</p>
<p>When R receives the L's MIP message, R performs the same candidate gathering process and
          responds with its own list of candidates. At the end of this process, each agent has a
          complete list of both its candidates and its peer's candidates. It pairs them up,
          resulting in CANDIDATE PAIRS. To see which pairs work, each agent schedules a series of
          connectivity CHECKS. Each check is a STUN transaction that the client will perform on a
          particular candidate pair by sending a STUN request from the local candidate to the remote
          candidate; a response indicates there is connectivity to the peer using that candidate
          address.
</p>
<p>It is important to note that the STUN requests are sent to and from the exact same IP
          addresses and ports that will be used for subsequent data traffic.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Sorting Candidates</h3>

<p>Because the algorithm above searches all candidate pairs, if a working pair exists it
          will eventually find it no matter what order the candidates are tried in. In order to
          produce faster (and better) results, the candidates are sorted in a specified order. The
          resulting list of sorted candidate pairs is called the CHECK LIST.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
Frozen Candidates</h3>

<p>The concept of frozen candidates is not applied when ICE is applied to MIP. [Editor's
          Note: More investigations are needed to evaluate whether this is indeed true and the
          concept of frozen candidates can be ignored.]
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.5"></a><h3>1.5.&nbsp;
Security for Checks</h3>

<p>Because the ICE algorithm is used to discover which addresses can be used to send traffic
          between two end points, it is important to ensure that the process cannot be hijacked to
          send traffic to the wrong location. Each STUN connectivity check is covered by a message
          authentication code (MAC). There are two ways to generate the keying material for this
          MAC. Either keying material is derived from the keying material generated by the return
          routability procedure or new keying material is distributed separately as excercised in
          ICE. </p>
<blockquote class="text">
<p>This document currently uses the latter technique without a strong preference. 
</p>
</blockquote><p> In any case, this MAC provides message integrity and data origin authentication,
          thus stopping an attacker from forging or modifying connectivity check messages.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.6"></a><h3>1.6.&nbsp;
Concluding M-ICE</h3>

<p>ICE checks are performed in a specific sequence, so that high priority candidate pairs
          are checked first, followed by lower priority ones.
</p>
<a name="terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
        "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in
        RFC 2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>This document heavily relies on the terminology introduced in <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Design Choices</h3>

<p>The work in this document is guided by the following design choices, namely:
</p>
<p>
        </p>
<ul class="text">
<li>The offer/answer exchange described in ICE <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> is
            mapped to the end-to-end MIP signaling exchange. For end-to-end communication this
            document assumes that MIPv6 signaling are allowed to be exchanged between the mobile
            node and the correspondent node. When Network Address Translators and firewalls are
            located along the path then direct end-to-end communication between the two end points
            is typically not possible and hence this protocol interaction is provided via MIP Home
            Agents. The functionality described in <a class='info' href='#I-D.bajko-mip6-rrtfw'>[I&#8209;D.bajko&#8209;mip6&#8209;rrtfw]<span> (</span><span class='info'>Bajko, G., &ldquo;Firewall friendly Return-Routability Test (RRT) for Mobile IPv6,&rdquo; February&nbsp;2008.</span><span>)</span></a> is used.
</li>
<li>We assume that MIP initiators and MIP responders implement and use STUN. For performing
            connectivity checks a couple of other alternatives are, however, possible: <br />
<br />

<blockquote class="text">
<p>It would be possible to utilize the SHIM6 REAchability Protocol (REAP) <a class='info' href='#I-D.ietf-shim6-failure-detection'>[I&#8209;D.ietf&#8209;shim6&#8209;failure&#8209;detection]<span> (</span><span class='info'>Arkko, J. and I. Beijnum, &ldquo;Failure Detection and Locator Pair Exploration Protocol for IPv6  Multihoming,&rdquo; June&nbsp;2008.</span><span>)</span></a> but STUN provides the same support
                with a more likely chance for widespread deployment. REAP currently only provides
                IPv6 support. It it obviously possible to turn a protocol in any other one. 
</p>
<p>Custom MIP messages could be created.
</p>
</blockquote>
            <br />
<br />

</li>
<li>If one peer does not support STUN then the optimal results of M-ICE cannot be provided.
            There is, however, the ability to make use of STUN LITE when a host is on the public
            address space and known not to be behind a firewall.
</li>
<li>Obtaining Relay Addresses from STUN <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>, formerly
            known as TURN, is intentionally not used in this document. For MIP, the Home Agent
            tunneling functionality is used instead of TURN.
</li>
<li>This document makes use of the UDP-encapsulated of MIP packets, as specified in <a class='info' href='#I-D.ietf-mip6-nemo-v4traversal'>[I&#8209;D.ietf&#8209;mip6&#8209;nemo&#8209;v4traversal]<span> (</span><span class='info'>Soliman, H., &ldquo;Mobile IPv6 support for dual stack Hosts and Routers (DSMIPv6),&rdquo; November&nbsp;2007.</span><span>)</span></a>.
</li>
<li>This document focuses only on the data exchange between the two end points rather than
            on the communication between a mobile node and the Home Agent or on the ability to allow
            MIP signaling messages to traverse NATs and firewalls.
</li>
<li>Each STUN connectivity check is covered by a message authentication code (MAC)
            generated based on keying material derived from information carried in MIP messages, see
              <a class='info' href='#candidate-exchange'>Section&nbsp;11<span> (</span><span class='info'>Attribute Encoding</span><span>)</span></a>. Alternatively, keying material could be derived
            from the return routability test procedure.
</li>
</ul><p>
      
</p>
<p>Note that the ICE description assumes usage within a VoIP environment where individual
        flows are controlled. However, the protocol interaction described in this document operates
        at a lower layer where application specific message flows are not visible. When a CANDIDATE
        PAIR, consisting of two TRANSPORT ADDRESSES, is created then it will typically refer to
        multiple flows then traffic between two end points experiences UDP encapsulation (due to the
        need to traverse a NAT or a stateful packet filtering firewall).
</p>
<p>The descriptions in the ICE specification related to SIP, ANAT, RTP, RTCP, third party call
        control, preconditions, forking, etc. are not applicable to MIP and are not included in this
        document. <br />
<br />
</p>
<blockquote class="text">
<p>From an editorial point of view it would be possible to copy-and-paste relevant parts
            of the ICE specification and to remove VoIP specific descriptions but for this version
            of the document we did not follow this approach.
</p>
</blockquote>

<p>The main accomplishment of this document is the reuse of the well-established ICE
        specification that builds on STUN. STUN enjoys widespread implementation support and maximum
        code re-use was one of the design criteria for this document.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Sending the Initial Offer</h3>

<p>In order to send the initial offer in an offer/answer exchange, an agent must (1) gather
        candidates, (2) prioritize them, (3) choose default candidates, and then (4) formulate and
        send them to the other peer.
</p>
<p>Section 4 of ICE <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> is applicable to this document with
        the following two exceptions: First, TURN is not used in this document but instead similar
        functionality is accomplished via a Home Agent. Second, the description regarding encoding
        of candidates in SDP is not applicable and replaced by a MIP specific encoding described in
          <a class='info' href='#candidate-exchange'>Section&nbsp;11<span> (</span><span class='info'>Attribute Encoding</span><span>)</span></a>.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Receiving the Initial Offer</h3>

<p>When an agent receives an initial offer, it will check if the offerer supports sufficient
        ICE functionality to proceed (i.e., if both offerer and answerer are lite implementations,
        ICE cannot proceed), determine its own role, gather candidates, prioritize them, choose
        default candidates, encode and send an answer, and for full implementations, form the check
        lists and begin connectivity checks.
</p>
<p>Again, the description regarding encoding of candidates in SDP is not applicable to this
        document and is replaced by a MIP specific encoding described in <a class='info' href='#candidate-exchange'>Section&nbsp;11<span> (</span><span class='info'>Attribute Encoding</span><span>)</span></a>. Note that only the encoding is different but not the
        semantic. As such, the description in Section 5 of <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> is
        applicable to this document.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Receipt of the Initial Answer</h3>

<p>Section 6 of ICE <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> describes the procedures that an
        agent follows when it receives the answer from the peer. It verifies that its peer supports
        ICE, determines its role, and for full implementations, forms the check list and begins
        performing periodic checks.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Performing Connectivity Checks</h3>

<p>Section 7 of ICE <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> describes how connectivity checks are
        performed using STUN <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a> and the content of that
        section is fully applicable to this document.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Concluding ICE Processing</h3>

<p>The description in Section 8 of ICE <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> illustrates
        processing rules that apply only to full implementations. Concluding ICE involves nominating
        pairs by the controlling agent and updating of state machinery
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Subsequent Offer/Answer Exchanges</h3>

<p>Either agent may generate a subsequent offer at any time. The rules in Section 9 of ICE
          <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> will cause the controlling agent to send an updated
        offer at the conclusion of ICE processing when ICE has selected different candidate pairs
        from the default pairs. Section 9 of ICE <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> defines rules
        for construction of subsequent offers and answers.
</p>
<p>Note that the term "media stream" in Section 9 of ICE <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a>
        translates to an individual UDP-encapsulated data flow exchanged between the two MIP end
        points.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Keepalives</h3>

<p>Section 10 of ICE <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> describes a keepalive mechanism. The
        RTP description, such as RTP No-Op and RTP comfort noise, is not applicable to this
        document. Other useful keepalive techniques are described in <a class='info' href='#I-D.marjou-behave-app-rtp-keepalive'>[I&#8209;D.marjou&#8209;behave&#8209;app&#8209;rtp&#8209;keepalive]<span> (</span><span class='info'>Marjou, X., &ldquo;Application Mechanism for maintaining alive the Network Address Translator  (NAT) mappings associated to RTP flows.,&rdquo; February&nbsp;2007.</span><span>)</span></a> and may be useful for MIP; a recommendation
        will be made in a subsequent version of this document.
</p>
<a name="candidate-exchange"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Attribute Encoding</h3>

<p>To accomplish the same functionality this specification needs to reuse the semantic, but
        not necessarily the encoding, of seven attributes defined in the ICE specification <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a>, namely "candidate", "remote-candidates", "ice-lite",
        "ice-mismatch", "ice-ufrag", "ice-pwd" and "ice-options".
</p>
<p>Section 15.1 to Section 15.5 of ICE <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> describe the
        semantic of the attributes.
</p>
<p>
        <br /><hr class="insert" />
<a name="attribute-encoding"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      MIP-ICE Mobility Options Format:

      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Type          |           Header Len          |# of candidates|
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |           Checksum            |L|M|         Reserved          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                                                               |
      +                                                               +
      |                       Ice-pwd                                 |
      +                                                               +
      |                                                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | ice-ufrag                     |     ice-options (var)        ...
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                 Candidate 1                                   .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                 Candidate 2                                   .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                 Candidate n                                   .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Where L: ice-lite
      M: ice-mismatch
      # of candidates: the number of candidates carried by this option

      Ice-options:

      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  Length       | Data ...

      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


      Candidate:

      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | ver   |         Length                | type  |   comp-id     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |    transport  |       Reserved                                |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                       Priority                                |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                    Connection-address                         .
      |                                                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |    port                        |  rel-port                    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                    Rel-address                                .
      |                                                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      The fields have the following meaning:

      ver: IP address version contained in Connection-address and
           Rel-address fields

      type: cand-type as defined in ICE

      comp-id: component-id as defined in ICE

      transport: transport address

      priority: sender priority assigned to the connection-address, as
                defined in ICE

      connection-address: IP address, 32 bit if ver=4 and 128 bit if
                          ver=6

      port: port number

      rel-port: port number, as defined in ICE

      rel-address: IP address, as defined in ICE
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Attribute Encoding&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Demultiplexing MIP and STUN messages</h3>

<p>When MIP and STUN messages are run over the same port it is necessary to demultiplex them.
        For this usage it is necessary to have a FINGERPRINT attribute in place, as defined in <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>.
</p>
<p>A STUN packet always has the fixed value 0x2112A442 in its Magic Cookie field (bits 32-64
        from the beginning of the UDP payload).
</p>
<p>
        <br /><hr class="insert" />
<a name="stun-header"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0 0|     STUN Message Type     |         Message Length        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0 0 1 0 0 0 0 1 0 0 0 1 0 0 1 0 1 0 1 0 0 1 0 0 0 1 0 0 0 0 1 0|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                 . . .
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: STUN Header&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>In this same offset from the UDP header, the MIP header has the Checksum field and the
        start of the Message Data field. The concatenation of the Checksum field and the first 16
        bits of the Message Data field may coincide with the STUN Magic Cookie.
</p>
<p>
        <br /><hr class="insert" />
<a name="MIP_header"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Payload Proto |  Header Len   |   MH Type     |   Reserved    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Checksum            |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
   |                                                               |
   .                                                               .
   .                       Message Data                            .
   .                                                               .
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    0                   1                   2                   3
                                 . . .
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: MIP Header&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>When the value in that place equals the value of the STUN Magic Cookie, the presence of the
        STUN FINGERPRINT attribute tells unambigously whether this is a STUN message or not.
</p>
<p>A future version will also discuss the demultiplexing when UDP encapsulation is not
      used.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Example</h3>

<p>[Editor's Note: An example will be provided in the next version of the document.]
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
Security Considerations</h3>

<p>There are several types of attacks possible in an M-ICE system. This section considers
        these attacks and their countermeasures.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.1"></a><h3>14.1.&nbsp;
Attacks on Connectivity Checks</h3>

<p>An attacker might attempt to disrupt the STUN connectivity checks. Ultimately, all of
          these attacks fool an agent into thinking something incorrect about the results of the
          connectivity checks. The possible false conclusions an attacker can try and cause are:
</p>
<p>
          </p>
<blockquote class="text"><dl>
<dt>False Invalid:</dt>
<dd><br />
 An attacker can fool a pair of
              agents into thinking a candidate pair is invalid, when it isn't. This can be used to
              cause an agent to prefer a different candidate (such as one injected by the attacker),
              or to disrupt a call by forcing all candidates to fail. <br />
<br />

</dd>
<dt>False Valid:</dt>
<dd><br />
An attacker can fool a pair of agents
              into thinking a candidate pair is valid, when it isn't. This can cause an agent to
              proceed with a session, but then not be able to receive any data traffic.<br />
<br />

</dd>
<dt>False Peer-Reflexive Candidate:</dt>
<dd><br />
An attacker can
              cause an agent to discover a new peer reflexive candidate, when it shouldn't have.
              This can be used to redirect data traffic to a DoS target or to the attacker, for
              eavesdropping or other purposes. <br />
<br />

</dd>
<dt>False Valid on False Candidate:</dt>
<dd><br />
 An attacker has
              already convinced an agent that there is a candidate with an address that doesn't
              actually route to that agent (for example, by injecting a false peer reflexive
              candidate or false server reflexive candidate). It must then launch an attack that
              forces the agents to believe that this candidate is valid.
</dd>
</dl></blockquote><p>
        
</p>
<p>Of the various techniques for creating faked STUN messages described in <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>, many are not applicable for the connectivity
          checks. Compromises of STUN servers are not much of a concern, since the STUN servers are
          embedded in endpoints and distributed throughout the network. Thus, compromising the
          peer's embedded STUN server is equivalent to compromising the end point, and if that
          happens, far more problematic attacks are possible than those against ICE.
</p>
<p>Injection of fake responses and relaying modified requests all can be handled in ICE with
          the countermeasures discussed below.
</p>
<p>To force the false invalid result, the attacker has to wait for the connectivity check
          from one of the agents to be sent. When it is, the attacker needs to inject a fake
          response with an unrecoverable error response, such as a 600. However, since the candidate
          is, in fact, valid, the original request may reach the peer agent, and result in a success
          response. The attacker needs to force this packet or its response to be dropped, through a
          DoS attack, layer 2 network disruption, or other technique. If it doesn't do this, the
          success response will also reach the originator, alerting it to a possible attack.
          Fortunately, this attack is mitigated completely through the STUN message integrity
          mechanism. The attacker needs to inject a fake response, and in order for this response to
          be processed, the attacker needs the password. If the candidates are exchange in MIP
          messages and therefore secured, the attacker will not have the password.
</p>
<p>Forcing the fake valid result works in a similar way. The agent needs to wait for the
          Binding Request from each agent, and inject a fake success response. The attacker won't
          need to worry about disrupting the actual response since, if the candidate is not valid,
          it presumably wouldn't be received anyway. However, like the fake invalid attack, this
          attack is mitigated completely through the STUN message integrity and offer/answer
          security techniques.
</p>
<p>Forcing the false peer reflexive candidate result can be done either with fake requests
          or responses, or with replays. We consider the fake requests and responses case first. It
          requires the attacker to send a Binding Request to one agent with a source IP address and
          port for the false candidate. In addition, the attacker must wait for a Binding Request
          from the other agent, and generate a fake response with a XOR-MAPPED-ADDRESS attribute
          containing the false candidate. Like the other attacks described here, this attack is
          mitigated by the STUN message integrity mechanisms and secure offer/answer exchanges.
</p>
<p>Forcing the false peer reflexive candidate result with packet replays is different. The
          attacker waits until one of the agents sends a check. It intercepts this request, and
          replays it towards the other agent with a faked source IP address. It must also prevent
          the original request from reaching the remote agent, either by launching a DoS attack to
          cause the packet to be dropped, or forcing it to be dropped using layer 2 mechanisms. The
          replayed packet is received at the other agent, and accepted, since the integrity check
          passes (the integrity check cannot and does not cover the source IP address and port). It
          is then responded to. This response will contain a XOR- MAPPED-ADDRESS with the false
          candidate, and will be sent to that false candidate. The attacker must then receive it and
          relay it towards the originator.
</p>
<p>The other agent will then initiate a connectivity check towards that false candidate.
          This validation needs to succeed. This requires the attacker to force a false valid on a
          false candidate. Injecting of fake requests or responses to achieve this goal is prevented
          using the integrity mechanisms of STUN and the offer/answer exchange. Thus, this attack
          can only be launched through replays. To do that, the attacker must intercept the check
          towards this false candidate, and replay it towards the other agent. Then, it must
          intercept the response and replay that back as well.
</p>
<p>This attack is very hard to launch unless the attacker is identified by the fake
          candidate. This is because it requires the attacker to intercept and replay packets sent
          by two different hosts. If both agents are on different networks (for example, across the
          public Internet), this attack can be hard to coordinate, since it needs to occur against
          two different endpoints on different parts of the network at the same time.
</p>
<p>If the attacker them self is identified by the fake candidate the attack is easier to
          coordinate. However, since MIP utilizes IPsec ESP to protect the data traffic end-to-end,
          the attacker will not be able to inspect any application data, they will only be able to
          discard them. However, this attack requires the agent to disrupt packets in order to block
          the connectivity check from reaching the target. In that case, if the goal is to disrupt
          the end-to-end communication, its much easier to just disrupt it with the same mechanism,
          rather than attack ICE.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.2"></a><h3>14.2.&nbsp;
Attacks on Address Gathering</h3>

<p>ICE endpoints make use of STUN for gathering candidates from a STUN server in the
          network. This is corresponds to the Binding Discovery usage of STUN described in <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>. As a consequence, the attacks against STUN itself
          that are described in that specification can still be used against the binding discovery
          usage when utilized with ICE.
</p>
<p>However, the additional mechanisms provided by ICE actually counteract such attacks,
          making binding discovery with STUN more secure when combined with ICE.
</p>
<p>Consider an attacker which is able to provide an agent with a faked mapped address in a
          STUN Binding Request that is used for address gathering. This is the primary attack
          primitive described in <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>. This address will be
          used as a server reflexive candidate in the ICE exchange. For this candidate to actually
          be used for media, the attacker must also attack the connectivity checks, and in
          particular, force a false valid on a false candidate. This attack is very hard to launch
          if the false address identifies a fourth party (neither the offerer, answerer, or
          attacker), since it requires attacking the checks generated by each agent in the session.
</p>
<p>If the attacker elects not to attack the connectivity checks, the worst it can do is
          prevent the server reflexive candidate from being used. However, if the peer agent has at
          least one candidate that is reachable by the agent under attack, the STUN connectivity
          checks themselves will provide a peer reflexive candidate that can be used for the
          exchange of media. Peer reflexive candidates are generally preferred over server reflexive
          candidates. As such, an attack solely on the STUN address gathering will normally have no
          impact on a session at all.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.3"></a><h3>14.3.&nbsp;
Attacks on the Offer/Answer Exchanges</h3>

<p>An attacker that can modify or disrupt the offer/answer exchanges themselves can readily
          launch a variety of attacks with M-ICE. They could direct data traffic to a target of a
          DoS attack, they could insert themselves into the data exchange, and so on. The security
          considerations of MIP apply.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.4"></a><h3>14.4.&nbsp;
Insider Attacks</h3>

<p>In addition to attacks where the attacker is a third party trying to insert fake offers,
          answers or STUN messages, there are several attacks possible with ICE when the attacker is
          an authenticated and valid participant in the M-ICE exchange.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.4.1"></a><h3>14.4.1.&nbsp;
MIP Amplification Attack</h3>

<p>In this attack, the attacker initiates communication to other agents, and maliciously
            includes the IP address and port of a DoS target as the destination for data traffic
            signaled in the MIP exchange.
</p>
<p>This could causes substantial amplification; a single offer/answer exchange can create
            a continuing flood of data packets, possibly at high rates (consider video sources).
            This attack is not specific to ICE, but ICE can help provide remediation.
</p>
<p>Specifically, if ICE is used, the agent receiving the malicious SDP will first perform
            connectivity checks to the target of media before sending media there. If this target is
            a third party host, the checks will not succeed, and media is never sent.
</p>
<p>Unfortunately, ICE doesn't help if its not used, in which case an attacker could simply
            send the offer without the ICE parameters. However, in environments where the set of
            clients are known, and limited to ones that support ICE, the server can reject any
            offers or answers that don't indicate ICE support.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.4.2"></a><h3>14.4.2.&nbsp;
STUN Amplification Attack</h3>

<p>The STUN amplification attack is similar to the MIP amplification attack. However,
            instead of data packets being directed to the target, STUN connectivity checks are
            directed to the target. The attacker sends an offer with a large number of candidates,
            say 50. The answerer receives the offer, and starts its checks, which are directed at
            the target, and consequently, never generate a response. The answerer will start a new
            connectivity check every 20ms, and each check is a STUN transaction consisting of 7
            transmissions of a message 65 bytes in length (plus 28 bytes for the IP/UDP header) that
            runs for 7.9 seconds, for a total of 58 bytes/second per transaction on average. In the
            worst case, there can be 395 transactions in progress at once (7.9 seconds divided by
            20ms), for a total of 182 kbps, just for STUN requests.
</p>
<p>It is impossible to eliminate the amplification, but the volume can be reduced through
            a variety of heuristics. Agents SHOULD limit the total number of connectivity checks
            they perform to 100. Additionally, agents MAY limit the number of candidates they'll
            accept in an offer or answer.
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15"></a><h3>15.&nbsp;
IAB Considerations</h3>

<p>The IAB has studied the problem of "Unilateral Self Address Fixing", which is the general
        process by which a agent attempts to determine its address in another realm on the other
        side of a NAT through a collaborative protocol reflection mechanism <a class='info' href='#RFC3424'>[RFC3424]<span> (</span><span class='info'>Daigle, L. and IAB, &ldquo;IAB Considerations for UNilateral Self-Address Fixing (UNSAF) Across Network Address Translation,&rdquo; November&nbsp;2002.</span><span>)</span></a>. M-ICE is an example of a protocol that performs this type of function. Interestingly,
        the process for M-ICE is not unilateral, but bilateral, and the difference has a significant
        impact on the issues raised by IAB. M-ICE can be considered a B-SAF (Bilateral Self-Address
        Fixing) protocol, rather than an UNSAF protocol. Regardless, the IAB has mandated that any
        protocols developed for this purpose document a specific set of considerations. This section
        meets those requirements.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.1"></a><h3>15.1.&nbsp;
Problem Definition</h3>

<p>From RFC 3424 <a class='info' href='#RFC3424'>[RFC3424]<span> (</span><span class='info'>Daigle, L. and IAB, &ldquo;IAB Considerations for UNilateral Self-Address Fixing (UNSAF) Across Network Address Translation,&rdquo; November&nbsp;2002.</span><span>)</span></a> any UNSAF proposal must provide:
</p>
<p>Precise definition of a specific, limited-scope problem that is to be solved with the
          UNSAF proposal. A short term fix should not be generalized to solve other problems; this
          is why "short term fixes usually aren't".
</p>
<p>The specific problems being solved by M-ICE are:
</p>
<p>Provide a means for two peers to determine the set of transport addresses which can be
          used for communication.
</p>
<p>Provide a means for resolving many of the limitations of other UNSAF mechanisms by
          wrapping them in an additional layer of processing (the M-ICE methodology).
</p>
<p>Provide a means for a agent to determine an address that is reachable by another peer
          with which it wishes to communicate.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2"></a><h3>15.2.&nbsp;
Exit Strategy</h3>

<p>From RFC 3424, any UNSAF proposal must provide:
</p>
<p>Description of an exit strategy/transition plan. The better short term fixes are the ones
          that will naturally see less and less use as the appropriate technology is deployed.
</p>
<p>M-ICE itself doesn't easily get phased out. However, it is useful even in a globally
          connected Internet, to serve as a means for detecting whether communication paths are
          disrupted. M-ICE also helps prevent certain security attacks which have nothing to do with
          NAT. However, what M-ICE does is help phase out other UNSAF mechanisms. M-ICE effectively
          selects amongst those mechanisms, prioritizing ones that are better, and deprioritizing
          ones that are worse. Local IPv6 addresses can be preferred. As NATs begin to dissipate as
          IPv6 is introduced, server reflexive and relayed candidates (both forms of UNSAF
          mechanisms) simply never get used, because higher priority connectivity exists to the
          native host candidates. Therefore, the servers get used less and less, and can eventually
          be remove when their usage goes to zero.
</p>
<p>Indeed, M-ICE can assist in the transition from IPv4 to IPv6. It can be used to determine
          whether to use IPv6 or IPv4 when two dual-stack hosts communicate. It can also allow a
          network with both 6to4 and native v6 connectivity to determine which address to use when
          communicating with a peer.
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.3"></a><h3>15.3.&nbsp;
Brittleness Introduced by M-ICE</h3>

<p>From RFC3424, any UNSAF proposal must provide:
</p>
<p>Discussion of specific issues that may render systems more "brittle". For example,
          approaches that involve using data at multiple network layers create more dependencies,
          increase debugging challenges, and make it harder to transition.
</p>
<p>M-ICE uses ICE that is utilizes <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a> instead of
          traditional STUN, RFC 3489 <a class='info' href='#RFC3489'>[RFC3489]<span> (</span><span class='info'>Rosenberg, J., Weinberger, J., Huitema, C., and R. Mahy, &ldquo;STUN - Simple Traversal of User Datagram Protocol (UDP) Through Network Address Translators (NATs),&rdquo; March&nbsp;2003.</span><span>)</span></a>). RFC 3489 has several points of
          brittleness. One of them is the discovery process which requires a agent to try and
          classify the type of NAT it is behind. This process is error-prone. With M-ICE, that
          discovery process is simply not used. Rather than unilaterally assessing the validity of
          the address, its validity is dynamically determined by measuring connectivity to a peer.
          The process of determining connectivity is very robust.
</p>
<p>Another point of brittleness in traditional STUN is that it assumes that the STUN server
          is on the public Internet. Interestingly, with M-ICE, that is not necessary. There can be
          a multitude of STUN servers in a variety of address realms. ICE will discover the one that
          has provided a usable address.
</p>
<p>The most troubling point of brittleness in traditional STUN is that it does not work in
          all network topologies. In cases where there is a shared NAT between each agent and the
          STUN server, traditional STUN may not work. With ICE, that restriction is removed.
</p>
<p>Traditional STUN also introduces some security considerations. Fortunately, those
          security considerations are also mitigated by ICE.
</p>
<p>Consequently, ICE serves to repair the brittleness introduced in other UNSAF mechanisms,
          and does not introduce any additional brittleness into the system.
</p>
<p>With M-ICE Home Agents are used and they are assumed to be located on the public Internet
          to allow MIP to work.
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.4"></a><h3>15.4.&nbsp;
Requirements for a Long Term Solution</h3>

<p>From RFC 3424, any UNSAF proposal must provide:
</p>
<p>Identify requirements for longer term, sound technical solutions -- contribute to the
          process of finding the right longer term solution.
</p>
<p>M-ICE provides a long term solution by utilizing ICE concepts that have received a lot of
          peer review in the VoIP community and to apply them to MIP. The only other possible long
          term solutions are (a) to get rid of middleboxes, such as NATs and firewalls or to (b)
          interact with them. Regarding (b) extensions for STUN to allow the protocol to be deployed
          on NATs and firewalls is currently being investigated in <a class='info' href='#I-D.wing-behave-nat-control-stun-usage'>[I&#8209;D.wing&#8209;behave&#8209;nat&#8209;control&#8209;stun&#8209;usage]<span> (</span><span class='info'>Wing, D., Rosenberg, J., and H. Tschofenig, &ldquo;Discovering, Querying, and Controlling Firewalls and NATs,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.5"></a><h3>15.5.&nbsp;
Issues with Existing NAPT Boxes</h3>

<p>From RFC 3424, any UNSAF proposal must provide:
</p>
<p>Discussion of the impact of the noted practical issues with existing, deployed NA[P]Ts
          and experience reports.
</p>
<p>A number of NAT boxes are now being deployed into the market which try and provide
          "generic" ALG functionality. These generic ALGs hunt for IP addresses, either in text or
          binary form within a packet, and rewrite them if they match a binding. This interferes
          with traditional STUN. However, the update to STUN <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a> uses an encoding which hides these binary
          addresses from generic ALGs.
</p>
<p>Existing NAPT boxes have non-deterministic and typically short expiration times for
          UDP-based bindings. This requires implementations to send periodic keepalives to maintain
          those bindings. ICE uses a default of 15s, which is a very conservative estimate.
          Eventually, over time, as NAT boxes become compliant to behave <a class='info' href='#RFC4787'>[RFC4787]<span> (</span><span class='info'>Audet, F. and C. Jennings, &ldquo;Network Address Translation (NAT) Behavioral Requirements for Unicast UDP,&rdquo; January&nbsp;2007.</span><span>)</span></a>,
          this minimum keepalive will become deterministic and well-known, and the ICE timers can be
          adjusted. Having a way to discover and control the minimum keepalive interval would be far
          better still.
</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16"></a><h3>16.&nbsp;
Contributors</h3>

<p> We would like to thank Thomas Schreck for his contributions to various aspects in this
        document. 
</p>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.17"></a><h3>17.&nbsp;
Acknowledgments</h3>

<p>The authors would like to thank Jonathan Rosenberg for his work on the ICE specification.
        This document copy-and-pastes text from the ICE specification. Hence, all the credits go to
        Jonathan.
</p>
<p>Finally, Dan Wing and Philip Matthews helped us with the work on HIP-ICE. 
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.18"></a><h3>18.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>18.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mmusic-ice">[I-D.ietf-mmusic-ice]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-19.txt">Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols</a>,&rdquo; draft-ietf-mmusic-ice-19 (work in progress), October&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-19.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3775">[RFC3775]</a></td>
<td class="author-text">Johnson, D., Perkins, C., and J. Arkko, &ldquo;<a href="http://tools.ietf.org/html/rfc3775">Mobility Support in IPv6</a>,&rdquo; RFC&nbsp;3775, June&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3775.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>18.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-turn">[I-D.ietf-behave-turn]</a></td>
<td class="author-text">Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-turn-16.txt">Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN)</a>,&rdquo; draft-ietf-behave-turn-16 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-turn-16.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-shim6-failure-detection">[I-D.ietf-shim6-failure-detection]</a></td>
<td class="author-text">Arkko, J. and I. Beijnum, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-shim6-failure-detection-13.txt">Failure Detection and Locator Pair Exploration Protocol for IPv6  Multihoming</a>,&rdquo; draft-ietf-shim6-failure-detection-13 (work in progress), June&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-shim6-failure-detection-13.txt">TXT</a>, <a href="http://www.ietf.org/internet-drafts/draft-ietf-shim6-failure-detection-13.pdf">PDF</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3489">[RFC3489]</a></td>
<td class="author-text">Rosenberg, J., Weinberger, J., Huitema, C., and R. Mahy, &ldquo;<a href="http://tools.ietf.org/html/rfc3489">STUN - Simple Traversal of User Datagram Protocol (UDP) Through Network Address Translators (NATs)</a>,&rdquo; RFC&nbsp;3489, March&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3489.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-rfc3489bis">[I-D.ietf-behave-rfc3489bis]</a></td>
<td class="author-text">Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-rfc3489bis-18.txt">Session Traversal Utilities for (NAT) (STUN)</a>,&rdquo; draft-ietf-behave-rfc3489bis-18 (work in progress), July&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-rfc3489bis-18.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3424">[RFC3424]</a></td>
<td class="author-text">Daigle, L. and IAB, &ldquo;<a href="http://tools.ietf.org/html/rfc3424">IAB Considerations for UNilateral Self-Address Fixing (UNSAF) Across Network Address Translation</a>,&rdquo; RFC&nbsp;3424, November&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3424.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.wing-behave-nat-control-stun-usage">[I-D.wing-behave-nat-control-stun-usage]</a></td>
<td class="author-text">Wing, D., Rosenberg, J., and H. Tschofenig, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-wing-behave-nat-control-stun-usage-05.txt">Discovering, Querying, and Controlling Firewalls and NATs</a>,&rdquo; draft-wing-behave-nat-control-stun-usage-05 (work in progress), October&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-wing-behave-nat-control-stun-usage-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4474">[RFC4474]</a></td>
<td class="author-text">Peterson, J. and C. Jennings, &ldquo;<a href="http://tools.ietf.org/html/rfc4474">Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;4474, August&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4474.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-monami6-multiplecoa">[I-D.ietf-monami6-multiplecoa]</a></td>
<td class="author-text">Wakikawa, R., Devarapalli, V., Tsirtsis, G., Ernst, T., and K. Nagami, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-monami6-multiplecoa-14.txt">Multiple Care-of Addresses Registration</a>,&rdquo; draft-ietf-monami6-multiplecoa-14 (work in progress), May&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-monami6-multiplecoa-14.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mip6-nemo-v4traversal">[I-D.ietf-mip6-nemo-v4traversal]</a></td>
<td class="author-text">Soliman, H., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mip6-nemo-v4traversal-06.txt">Mobile IPv6 support for dual stack Hosts and Routers (DSMIPv6)</a>,&rdquo; draft-ietf-mip6-nemo-v4traversal-06 (work in progress), November&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mip6-nemo-v4traversal-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mip4-dsmipv4">[I-D.ietf-mip4-dsmipv4]</a></td>
<td class="author-text">Tsirtsis, G., Park, V., and H. Soliman, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mip4-dsmipv4-10.txt">Dual Stack Mobile IPv4</a>,&rdquo; draft-ietf-mip4-dsmipv4-10 (work in progress), January&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mip4-dsmipv4-10.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.marjou-behave-app-rtp-keepalive">[I-D.marjou-behave-app-rtp-keepalive]</a></td>
<td class="author-text">Marjou, X., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-marjou-behave-app-rtp-keepalive-01.txt">Application Mechanism for maintaining alive the Network Address Translator  (NAT) mappings associated to RTP flows.</a>,&rdquo; draft-marjou-behave-app-rtp-keepalive-01 (work in progress), February&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-marjou-behave-app-rtp-keepalive-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4787">[RFC4787]</a></td>
<td class="author-text">Audet, F. and C. Jennings, &ldquo;<a href="http://tools.ietf.org/html/rfc4787">Network Address Translation (NAT) Behavioral Requirements for Unicast UDP</a>,&rdquo; BCP&nbsp;127, RFC&nbsp;4787, January&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4787.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.bajko-mip6-rrtfw">[I-D.bajko-mip6-rrtfw]</a></td>
<td class="author-text">Bajko, G., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-bajko-mip6-rrtfw-03.txt">Firewall friendly Return-Routability Test (RRT) for Mobile IPv6</a>,&rdquo; draft-bajko-mip6-rrtfw-03 (work in progress), February&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-bajko-mip6-rrtfw-03.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hannes Tschofenig</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia Siemens Networks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Linnoitustie 6</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Espoo  02600</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+358 (50) 4871445</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Hannes.Tschofenig@nsn.com">Hannes.Tschofenig@nsn.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.tschofenig.com">http://www.tschofenig.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gabor Bajko</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia</td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
