<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Domain Name Assertions</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Domain Name Assertions">
<meta name="keywords" content="Jabber, XML, XMPP, delegation, federation, proof, security">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">J. Lindberg</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Google</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">S. Farrell</td></tr>
<tr><td class="header">Expires: July 18, 2010</td><td class="header">NewBay Software</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">January 14, 2010</td></tr>
</table></td></tr></table>
<h1><br />Domain Name Assertions<br />draft-ietf-xmpp-dna-00</h1>

<h3>Abstract</h3>

<p>An application-level approach to asserting and proving the delegated ownership of a domain name for XMPP.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on July 18, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#acks">2.</a>&nbsp;
Acknowledgements<br />
<a href="#glossary">3.</a>&nbsp;
Glossary<br />
<a href="#reqs">4.</a>&nbsp;
Requirements<br />
<a href="#genericusecases">5.</a>&nbsp;
Generic Use Cases<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#assertions">5.1.</a>&nbsp;
Assertions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#valid">5.2.</a>&nbsp;
Validation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#invalid">5.3.</a>&nbsp;
Invalidation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#challenge">5.4.</a>&nbsp;
Requesting proof with a challenge<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#impossible">5.5.</a>&nbsp;
No proof possible<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#proof">5.6.</a>&nbsp;
Proving a challenge<br />
<a href="#attribute-cert">6.</a>&nbsp;
Attribute Certificate Proof<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">6.1.</a>&nbsp;
Attribute Certificate Issuer Profile<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">6.2.</a>&nbsp;
Attribute Certificate Profile<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">6.3.</a>&nbsp;
Access Identity Values<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">6.3.1.</a>&nbsp;
XMPP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">6.4.</a>&nbsp;
Attribute Certificate Signature Algorithms<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">6.5.</a>&nbsp;
Proof Encoding<br />
<a href="#federation">7.</a>&nbsp;
DNA for XMPP Federation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dnssrv">7.1.</a>&nbsp;
DNS SRV lookups<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls">7.2.</a>&nbsp;
Certificates during Start-TLS<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#disco">7.3.</a>&nbsp;
Discovering Support<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#initiation">7.4.</a>&nbsp;
Turning on DNA<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#origin">7.5.</a>&nbsp;
Asserting new domains<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#proactive-challenge">7.6.</a>&nbsp;
Proactive challenges<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#proactive-validation">7.7.</a>&nbsp;
Proactive validation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#reuse">7.8.</a>&nbsp;
Reusing streams<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#impl">7.9.</a>&nbsp;
Implementation notes<br />
<a href="#clients">8.</a>&nbsp;
DNA for XMPP client connections<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#announce">8.1.</a>&nbsp;
Announcing Support<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#clientchallenge">8.2.</a>&nbsp;
Client challenges for proof<br />
<a href="#iana">9.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-ns-dna">9.1.</a>&nbsp;
XML Namespace Name for DNA<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">9.2.</a>&nbsp;
URN space for standard DNA Proof Types<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">9.3.</a>&nbsp;
DNA Proof Registry<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">9.4.</a>&nbsp;
Object Identifiers<br />
<a href="#i18n">10.</a>&nbsp;
Internationalization Considerations<br />
<a href="#security">11.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">12.</a>&nbsp;
Normative References<br />
<a href="#schema">Appendix&nbsp;A.</a>&nbsp;
RELAX NG XML Schema<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>As large hosting providers begin providing XMPP services for multiple domains, several issues with previous mechanisms for server-to-server federation have become apparent.
</p>
<p>A large number of sockets are currently required between hosting providers.  Although servers may attempt to piggyback whenever possible, the possibility exists that 2*N*M sockets will be created (where N is the number of domains on one hosting provider, and M is the number of domains on another hosting provider).  The goal would be that the number of sockets was dependent on load or deployment considerations.
</p>
<p>In order to enable or require encryption, the hosting provider must create a separate socket for each hostname pair and have access to a X.509 certificate that is signed by a widely-trusted CA and includes both the public and private keys.  Customers of hosting providers might be uncomfortable with the level of trust this requires.
</p>
<p>This document lays out an approach known as Domain Name Assertions (DNA) that allows providers to effectively host XMPP services on behalf of other companies, and might be expanded later to support other protocols.
</p>
<a name="acks"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Acknowledgements</h3>

<p>The original version of this specification was written by Joe Hildebrand and Sean Turner.
</p>
<a name="glossary"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Glossary</h3>

<p>
        </p>
<blockquote class="text"><dl>
<dt>Hosted domain</dt>
<dd>An XMPP domain whose network services are delegated to a third party.
</dd>
<dt>Hosting provider</dt>
<dd>A business entity that provides services for one or more domains that it does not directly and fully control.
</dd>
<dt>Self-hosted domain</dt>
<dd>A domain whose owner acts as its hosting provider.
</dd>
<dt>Delegation</dt>
<dd>A ceremony that acts as proof of the intent of the owner of a hosted domain to cede control to a hosting provider for a given protocol.
</dd>
<dt>Widely-trusted CA</dt>
<dd>For open communities, a Certificate Authority whose certificate that is trusted by multiple web browsers by default.  For closed communities, a Certificate Authority that is trusted by all members of that community.
</dd>
<dt>Sender Domain</dt>
<dd>The domain associated with the 'from' address on a stanza to be sent across a federation boundary.
</dd>
<dt>Target Domain</dt>
<dd>The domain associated with the 'to' address on a stanza to be sent across a federation boundary.
</dd>
<dt>Originating Server</dt>
<dd>The machine that wants to send a message from an entity at the Sender Domain to an entity at the Target Domain and thus is attempting to establish a connection between the two servers.
</dd>
<dt>Receiving Server</dt>
<dd>The machine to which the Originating Server has opened a connection for the purpose of sending a message from the Sender Domain to the Target Domain.
</dd>
<dt>Asserting Entity</dt>
<dd>A system element (such as a server) asserting a given domain name as an identity.
</dd>
<dt>Validating Entity</dt>
<dd>A system element (such as a client or server) that checks a given identity asserted by an asserting entity.
</dd>
<dt>Asserted Domain</dt>
<dd>A domain name asserted by either side of a conversation.  validating entities may require assertions to be backed up with proof.
</dd>
<dt>Proof</dt>
<dd>A secure mechanism through which a validating entity can ascertain that an asserting entity has authority for the asserted domain, either directly or indirectly (by delegation).
</dd>
</dl></blockquote><p>
      
</p>
<a name="reqs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Requirements</h3>

<p>
        </p>
<ol class="text">
<li>A hosting provider MUST be able to service domains for which it cannot obtain certificates signed by a widely-trusted CA.
</li>
<li>All network traffic (except for initial handshakes) MUST be encrypted in a manner not subject to man-in-the-middle attacks.
</li>
<li>The number of socket connections between hosting providers MUST NOT be a function of the number of domains hosted by either provider.
</li>
<li>Connections MUST be usable in either direction, if allowed by policy and deployment considerations.
</li>
<li>The owners of the hosted domain MUST NOT be required to give out private keying material associated with any certificate they own that has been signed by a widely-trusted CA.
</li>
<li>The owners of the hosted domain MUST be allowed to choose the frequency with which they wish to perform the delegation ceremony.
</li>
<li>The owners of the hosted domain MUST be allowed to revoke their delegation at any time.
</li>
<li>Multiple mechanisms for proving delegation MUST be possible.
</li>
<li>It MUST be possible for new assertions to be added to a stream at any point after the stream is fully established, but before the stream is closed
</li>
</ol><p>
      
</p>
<a name="genericusecases"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Generic Use Cases</h3>

<p>The DNA mechanism can be used for multiple different protocols.  In particular, client-to-server XMPP and server-to-server XMPP are discussed herein, but the general approach could be used for non-XMPP protocols such as SMTP or IMAP.  As such, the protocol syntax offered here is normative for XMPP, but merely illustrative for other protocols, which will need their own protocol bindings.
</p>
<p>The following domain names are used in the examples in this section:
      </p>
<blockquote class="text"><dl>
<dt>asserted.tld</dt>
<dd>The domain name being asserted.
</dd>
</dl></blockquote><p>
      
</p>
<a name="assertions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Assertions</h3>

<p>The asserting entity asserts a domain name through the use of an "assert" element.  Assertions MUST contain a "from" attribute naming the domain name that is being asserted.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;assert xmlns='urn:ietf:params:xml:ns:dna' from='asserted.tld'/&gt;</pre></div>
<a name="valid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Validation</h3>

<p>When the validating entity has been satisified that the asserting entity is authoritative for the domain name asserted, it MUST send a "valid" element.  At this point, the asserting entity MAY send stanzas to the validating entity containing from addresses in the asserted and validated domain.
</p>
<p>Validating entities SHOULD respond to a domain name assertion without asking for further proof when the domain name asserted is represented in the certificate offered by the asserting entity according to the rules set out in <a class='info' href='#rfc3920bis'>[rfc3920bis]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; September&nbsp;2009.</span><span>)</span></a>.
</p>
<p>Validating entities MAY respond to a domain name assertion without asking for further proof when the domain name asserted is known to be associated with the asserting entity through some other secure means such as DNSSEC, caching, or local knowledge.  In the DNSSEC case, the server hostname in the SRV record used to connect SHOULD be looked for in the certificate offered by the asserting entity, according to the rules set out in <a class='info' href='#rfc3920bis'>[rfc3920bis]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; September&nbsp;2009.</span><span>)</span></a>.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;valid xmlns='urn:ietf:params:xml:ns:dna' to='asserted.tld'/&gt;</pre></div>
<a name="invalid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Invalidation</h3>

<p>When the validating entity does not accept proof offered by the asserting entity, or it no longer trusts the proof (for example due to the proof timing out or being revoked), it sends the asserting entity an "invalid" element.  The asserting entity MUST NOT send any stanzas to the validating entity containing from addresses in the invalidated domain without performing another validation.
</p>
<p>Invalid responses MAY be given in direct response to an assertion if the validating entity has reason to believe that no proof is possible.  Examples that would cause this response include a blocking list or a negative cache.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;invalid xmlns='urn:ietf:params:xml:ns:dna' to='asserted.tld'/&gt;</pre></div>
<a name="challenge"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Requesting proof with a challenge</h3>

<p>If an assertion cannot be validated immediately, the validating entity may ask for further proof.  Inside the "challenge" element, at least one form of proof that will be acceptable MUST be given to the asserting entity.  If an acceptable proof format is not available for the asserted domain, the validating entity MUST return an invalid response proactively.
</p>
<p>A "proof" element designates a type of proof that would be acceptable to the verifying entity.  The "type" attribute of the "proof" element MUST be a valid URI.  A registry of proof types will be created with the IANA (see <a class='info' href='#iana'>Section&nbsp;9<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>).  Standard proof types will begin with "urn:ietf:params:dna:proof:". Custom proofs should be signaled with a "type" attribute value containing a full URI under the control of the defining party.  Proof types MUST be compared for equality using the rules for comparing URIs.
</p>
<p>Some proof types MAY require information or nonces from the validating entity.  If so, the specification for that proof type MUST specify extensions to the "proof" element in a new namespace.
</p>
<p>In some protocols, a challenge MAY be sent without an assertion, if the validating entity has reason to believe that the entity with which it is talking is authoritative for a given domain.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;challenge xmlns='urn:ietf:params:xml:ns:dna' to='asserted.tld'&gt;
  &lt;proof xmlns='urn:ietf:params:dna:proof:attribute-cert'/&gt;
  &lt; type='http://example.com/proof/custom'/&gt;
&lt;/challenge&gt;</pre></div>
<a name="impossible"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
No proof possible</h3>

<p>If the validating entity requires proof, but will not accept proof by a means that the asserting entity has available for the asserted domain, the asserting entity MUST respond with an "impossible" element.  The validating entity MUST NOT send a "valid" or "invalid" element in response, and MUST NOT accept stanzas from the asserted domain on this connection unless some other assertion works in the future.
</p>
<p>The "impossible" element MAY be sent after full validation, if the asserting entity would like to retract the assertion.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;impossible xmlns='urn:ietf:params:xml:ns:dna' from='asserted.tld'/&gt;</pre></div>
<a name="proof"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.6"></a><h3>5.6.&nbsp;
Proving a challenge</h3>

<p>If an asserting entity thinks it can prove a given assertion when challenged, it sends that proof in a "proof" element.  The REQUIRED "type" attribute specifies the chosen proof type, and the REQUIRED "from" attribute specifies the domain being proved.  Each proof type MUST specify the format of the contents of the "proof" element.  Suggestions for formats include Base64-encoded binary as character data or structured XML in a new namespace.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;proof xmlns='urn:ietf:params:xml:ns:dna'
       from='asserted.tld'
       type='urn:ietf:params:dna:proof:attribute-cert'&gt;
  (Base64-encoded attribute certificate)
&lt;/proof&gt;</pre></div>
<a name="attribute-cert"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Attribute Certificate Proof</h3>

<p>When an asserting entity has been delegated responsibility for hosting a given domain, an Attribute Certificate MUST be used to prove the delegation. The proof type URI associated with attribute certificates SHALL be 'urn:ietf:params:dna:proof:attribute-cert' (EDITOR'S NOTE: We will work with IANA to come up with a good URN. This is just a placeholder.)
</p>
<p>The certificate that signed the attribute certificate MUST have been acceptable as proof of ownership of a given domain for the protocol in question, according to the rules in <a class='info' href='#rfc3920bis'>[rfc3920bis]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; September&nbsp;2009.</span><span>)</span></a>. Validating entities SHOULD try prepending the asserted domain with "www." and re-checking for name matches before rejecting the signing certificate, in order to allow for easier deployments using existing web certificates as proof.
</p>
<p>Each protocol that is delegated will be assigned its own OID to identify a service and whether the entity can act as a server or client.  These values will be included in the Access Identifier attribute, from <a class='info' href='#I-D.ietf-pkix-3281update'>[I&#8209;D.ietf&#8209;pkix&#8209;3281update]<span> (</span><span class='info'>Housley, R., Farrell, S., and S. Turner, &ldquo;An Internet Attribute Certificate Profile for Authorization,&rdquo; April&nbsp;2009.</span><span>)</span></a>.  This document defines the OIDs for XMPP.  Other documents may specify additional OIDs.
</p>
<p>The remaining paragraphs in this section profile the attribute certificate issuers public key certificate and the attribute certificate.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Attribute Certificate Issuer Profile</h3>

<p>The following is a profile of the attribute certificate issuer's public key certificate, which is as per <a class='info' href='#I-D.ietf-pkix-3281update'>[I&#8209;D.ietf&#8209;pkix&#8209;3281update]<span> (</span><span class='info'>Housley, R., Farrell, S., and S. Turner, &ldquo;An Internet Attribute Certificate Profile for Authorization,&rdquo; April&nbsp;2009.</span><span>)</span></a>:

        </p>
<ul class="text">
<li>The issuer's certificate MUST conform to <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</li>
<li>The issuer's certificate MUST have a keyUsage extension with the digitalSignature bit set.
</li>
<li>The issuer's certificate MUST NOT have a basicConstraints extension with the cA BOOLEAN set to TRUE.
</li>
</ul><p>
        
</p>
<p>In addition to the <a class='info' href='#I-D.ietf-pkix-3281update'>[I&#8209;D.ietf&#8209;pkix&#8209;3281update]<span> (</span><span class='info'>Housley, R., Farrell, S., and S. Turner, &ldquo;An Internet Attribute Certificate Profile for Authorization,&rdquo; April&nbsp;2009.</span><span>)</span></a> requirements, the subject name MUST be non-NULL in the attribute certificate issuer's public key certificate.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Attribute Certificate Profile</h3>

<p>The attribute certificate issued MUST conform to <a class='info' href='#I-D.ietf-pkix-3281update'>[I&#8209;D.ietf&#8209;pkix&#8209;3281update]<span> (</span><span class='info'>Housley, R., Farrell, S., and S. Turner, &ldquo;An Internet Attribute Certificate Profile for Authorization,&rdquo; April&nbsp;2009.</span><span>)</span></a>.  There are options in that profile and the following profiles those options:
        </p>
<ul class="text">
<li>The holder field MUST be the baseCertificateID.
</li>
<li>The attributes field MUST include the Access Identity attribute, as specified in Section 4.4.2 of <a class='info' href='#I-D.ietf-pkix-3281update'>[I&#8209;D.ietf&#8209;pkix&#8209;3281update]<span> (</span><span class='info'>Housley, R., Farrell, S., and S. Turner, &ldquo;An Internet Attribute Certificate Profile for Authorization,&rdquo; April&nbsp;2009.</span><span>)</span></a>.  Both the service and ident fields' GeneralName choice MUST be registeredID.  The service and ident fields MUST be as defined in Section 5.3.  Other attributes MAY be included.
</li>
<li>The extensions field MUST include the non-critical noRevAvail extension, as defined in Section 4.3.6 of <a class='info' href='#I-D.ietf-pkix-3281update'>[I&#8209;D.ietf&#8209;pkix&#8209;3281update]<span> (</span><span class='info'>Housley, R., Farrell, S., and S. Turner, &ldquo;An Internet Attribute Certificate Profile for Authorization,&rdquo; April&nbsp;2009.</span><span>)</span></a>, to indicate that no revocation information is available from the attribute certificate issuer.
</li>
<li>The extensions field MAY include:
          
<ul class="text">
<li>The authorityKeyIdentifier extension if the issuer has more than one key pair.
</li>
<li>The issuerAltName extension if the issuer's certificate includes the subjectAltName extension.  If included issuerAltName MUST be marked non-critical.
</li>
</ul>
          
</li>
</ul><p>
        
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Access Identity Values</h3>

<p>The following paragraphs define the service and ident values for the delegated protocols.  Currently, only values for XMPP are defined.  A later version of this document or another document may specify additional values for other protocols.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.1"></a><h3>6.3.1.&nbsp;
XMPP</h3>

<p>When XMPP is delegated the following procedures MUST be followed.
</p>
<p>The service field MUST be id-xmpp.  The following object identifier identifies that the AC holder supports XMPP:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>id-xmpp OBJECT IDENTIFIER ::= { TBD }</pre></div>
<p>The ident field MUST be either id-xmpp-client or id-xmpp-server.  Both id-xmpp-client and id-xmpp-server MAY appear in the same attribute certificate.  Note that the Access Identity attribute will be multi-valued when both id-xmpp-client and id-xmpp-server are present.
</p>
<p>The following object identifier identifies the AC holder as the XMPP client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>id-xmpp-client OBJECT IDENTIFIER ::= { id-xmpp 0 }</pre></div>
<p>The following object identifier identifies the AC holder as the XMPP server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>id-xmpp-server OBJECT IDENTIFIER ::= { id-xmpp 1 }</pre></div>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
Attribute Certificate Signature Algorithms</h3>

<p>The issuer MUST support signing attribute certificate with the PKCS #1 version 1.5 signature algorithm with SHA-256, as specified in <a class='info' href='#RFC4055'>[RFC4055]<span> (</span><span class='info'>Schaad, J., Kaliski, B., and R. Housley, &ldquo;Additional Algorithms and Identifiers for RSA Cryptography for use in the Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; June&nbsp;2005.</span><span>)</span></a>.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.5"></a><h3>6.5.&nbsp;
Proof Encoding</h3>

<p>The attribute certificate, the issuer's certificate, and all of the CA certificates in the trust chain of the signing certificate back to the trust anchor are encoded as a "certs-only" SMIME message, as per <a class='info' href='#I-D.ietf-smime-3851bis'>[I&#8209;D.ietf&#8209;smime&#8209;3851bis]<span> (</span><span class='info'>Ramsdell, B. and S. Turner, &ldquo;Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.2 Message  Specification,&rdquo; May&nbsp;2009.</span><span>)</span></a> (i.e, a degenerate SignedData with no content just certificates).  The resulting message is then Base64 encoded, as per Section 6.8 of <a class='info' href='#RFC2045'>[RFC2045]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a>.   The end result is then transmitted as the character data of a "proof" element.
</p>
<a name="federation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
DNA for XMPP Federation</h3>

<p>Two XMPP servers, each of which hosts multiple domains that they do not directly control, desire to connect in order to exchange traffic for at least two of those domains (one on either side).
</p>
<p>The following domain names are used in the examples:
      </p>
<blockquote class="text"><dl>
<dt>target.tld</dt>
<dd>The domain portion of the JID in the to address of the stanza that caused this connection to be initiated.
</dd>
<dt>othertarget.tld</dt>
<dd>The domain portion of the JID in the to address of a stanza being sent across a stream that was originally started to talk to target.tld.
</dd>
<dt>targetprovider.tld</dt>
<dd>The hosting provider for target.tld.
</dd>
<dt>server.targetprovider.tld</dt>
<dd>A server with XMPP federation services at the target's hosting provider.
</dd>
<dt>originator.tld</dt>
<dd>The domain portion of the JID in the from address of the stanza that caused this connection to be initiated.
</dd>
<dt>originatingprovider.tld</dt>
<dd>The hosting provider for target.tld.
</dd>
<dt>server.originatingprovider.tld</dt>
<dd>A server with XMPP federation services at the originator's hosting provider.
</dd>
</dl></blockquote><p>
      
</p>
<a name="dnssrv"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
DNS SRV lookups</h3>

<p>In a delegated hosting scenario, DNS SRV records are REQUIRED, since otherwise the hosting provider will never be contacted for the target domain.  As specified by <a class='info' href='#rfc3920bis'>[rfc3920bis]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; September&nbsp;2009.</span><span>)</span></a> the originating server looks up the target domain to find a list of receiving servers.  If the originating server already has a connection to the IP address represented by one of these servers (perhaps because it is communicating with another domain hosted by this provider), it MAY reuse that stream (see Stream Reuse).  If the originating server does not have a connection it wants to reuse, it performs the SRV algorithm to select an SRV record and makes a TCP connection to the server and port specified by the selected SRV record.
</p>
<p>Unless assured by a mechanism such as DNSSEC, the originating server MUST NOT trust the information received from the DNS SRV as proof that the target domain has been delegated to the receiving server.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>% dig +short -t SRV _xmpp-server._tcp.target.tld
0 1 5269 server.targetprovider.tld</pre></div>
<a name="tls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Certificates during Start-TLS</h3>

<p>The first step during stream negotiation MUST be Start-TLS.  The receiving server MUST offer a certificate signed by a widely-trusted CA.  The receiving server MUST require a client certificate.  The certificate offered by the originating server MUST be signed be a widely-trusted CA.  Both sides MUST check the certificate offered to it for validity (e.g. time period, signatures, and trust anchor), but MUST NOT disconnect when the certificate received does not contain a name matching its expectations.
</p>
<p>The names on these certificates SHOULD be associated with the relevant hosting provider, and need not be related to the domains being hosted.  If the certificates have the name of the server offered in the SRV record, it MAY be possible to use DNSSEC for proof in the future.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>CN=server.targetprovider.tld</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>CN=server.originatingprovider.tld</pre></div>
<a name="disco"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Discovering Support</h3>

<p>To and from addresses are REQUIRED in the stream:stream tag.  These represent the first domain pair associated with this stream, and are the domain names from the stanza that caused this connection to be established.
</p>
<p>To announce its support for DNA, the receiving server asserts its identity in the stream features following TLS negotiation.  
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;stream:features&gt;
  &lt;assert xmlns='urn:ietf:params:xml:ns:dna' from='target.tld'/&gt;
&lt;/stream:features&gt;
</pre></div>
<a name="initiation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
Turning on DNA</h3>

<p>If the originating server supports DNA, it looks for an assertion in the stream features.  If it finds none, it MAY fall back on another means of verifying the identiy of the target server, if allowed by local policy.
</p>
<p>Originating servers that support DNA talking to target servers that declare support for DNA MUST NOT send protocol other than DNA negotations until they are able to validate the assertion offered by the target server in the stream features.  The first validation proves to the originating server that it is talking to a server authoritative for the target domain, so that it is safe to use this domain in "to" addresses on this stream.
</p>
<p>Once an originating server completes this first validation it signals that it is willing and able to participate in bi-directional XMPP federation traffic, as long as all of the domains required have been asserted and validated at least once on this stream.
</p>
<p>If the originating server does not require more proof (due to a certificate match or DNSSEC-verified delegation), it may send a "valid" element without requesting proof first, as in all DNA interactions.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;challenge xmlns='urn:ietf:params:xml:ns:dna' to='target.tld'&gt;
  &lt;proof type='urn:ietf:params:dna:proof:attribute-cert'/&gt;
&lt;/challenge&gt;
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;proof xmlns='urn:ietf:params:xml:ns:dna'
       from='target.tld'
       type='urn:ietf:params:dna:proof:attribute-cert'&gt;
  (Base64-encoded attribute certificate)
&lt;/proof&gt;</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;valid xmlns='urn:ietf:params:xml:ns:dna' to='target.tld'/&gt;</pre></div>
<a name="origin"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5"></a><h3>7.5.&nbsp;
Asserting new domains</h3>

<p>Before either side sends stanzas on a given stream, it MUST ensure that the other side will accept those stanzas by asserting the domain in the "from" attribute of those stanzas, and waiting for a "valid" response before sending the stanzas in question.
</p>
<p>The originating server MUST therefore send its own assertion after accepting the target domain's assertion.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;assert xmlns='urn:ietf:params:xml:ns:dna' from='originator.tld'/&gt;</pre></div>
<a name="proactive-challenge"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.6"></a><h3>7.6.&nbsp;
Proactive challenges</h3>

<p>Before either side sends stanzas on a given stream, it MUST ensure that the other side is authoriative for the domain in the "to" attribute on those stanzas.  If the sender has already accepted an assertion on this stream, and that assertion has not been revoked with an "impossible" element, no action is required.  Otherwise, the sender can proactively request proof for that domain by sending a challenge even though the other side has not sent an assertion for that domain yet.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;challenge xmlns='urn:ietf:params:xml:ns:dna' to='othertarget.tld'&gt;
  &lt;proof type='urn:ietf:params:dna:proof:attribute-cert'/&gt;
&lt;/challenge&gt;</pre></div>
<a name="proactive-validation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.7"></a><h3>7.7.&nbsp;
Proactive validation</h3>

<p>When two hosting providers connect, they may have previous knowledge (perhaps from a cache) of which domains they will trust on the new connection.  If so, either side MAY send as many "valid" elements as desired, even though the other side has not sent assertions for those domain.
</p>
<p>The server receiving these proactive validations MUST NOT change its self-image (which domains it thinks it is authoritative for), but SHOULD NOT send assertions for these domains on this stream.  If the server receiving a proactive validation is no long authoritative for a given domain, it MUST send an "impossible" element, at which point the sender MUST remove the receiver from any cache and not send any stanzas on this stream to the given domain.
</p>
<p>Any cache of DNA information SHOULD be associated with the certificate offerred by the relevant server, and SHOULD be checked for revocation if possible, according to local policy.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;valid xmlns='urn:ietf:params:xml:ns:dna' to='target1.tld'/&gt;
&lt;valid xmlns='urn:ietf:params:xml:ns:dna' to='target2.tld'/&gt;
&lt;valid xmlns='urn:ietf:params:xml:ns:dna' to='target3.tld'/&gt;</pre></div>
<a name="reuse"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.8"></a><h3>7.8.&nbsp;
Reusing streams</h3>

<p>DNA streams are bi-directional, and may have an aribtrary number of domains validated in either direction, at any point in the lifetime of the stream.  Before sending a stanza on a given stream, the sender MUST ensure that "valid" elements have been exchanged according to the above rules for both the "to" and "from" address, and that no "invalid" or "impossible" element has revoked an assertion.
</p>
<p>An "impossible" or "invalid" element SHOULD NOT cause the rest of the stream to become invalidated in either directions.  When these elements are seen, they SHOULD merely change the list of domains that are valid on that stream.  If no domains are valid on the stream, the stream MAY be closed immediately, or MAY be left open if desired.  If left open, the stream MUST NOT be used for stanza traffic until domains are asserted as needed for the desired domains.
</p>
<p>Domains that are marked as "invalid" or "impossible" SHOULD NOT be retried on the same stream unless new information has become available, in order to prevent assertion storms.
</p>
<a name="impl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.9"></a><h3>7.9.&nbsp;
Implementation notes</h3>

<p>If the first server-to-server validation exchange fails, the parties MAY keep the connection open (perhaps for a shorter than is usual) in case another domain pair would need a connection between these servers.
</p>
<p>Ensure that only one challenge is outstanding on a given connection for a given domain.  Ensure that only one assertion or one proof is outstanding on a given connection for a given domain.
</p>
<a name="clients"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
DNA for XMPP client connections</h3>

<p>Hosting providers have a similar problem for client to server connections.  Clients need to ensure that they are talking to an authoritative server for the domain they intend to log in to.  Typically, this is done by examining the certificate offered by the server during TLS negotiation, according to the rules in <a class='info' href='#rfc3920bis'>[rfc3920bis]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; September&nbsp;2009.</span><span>)</span></a>.  However, hosting providers will typically not have access to a valid certificate for the target domain and its associated private key.  DNA can be used for the hosting provider to prove that hosting services have been delegated to it.
</p>
<a name="announce"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Announcing Support</h3>

<p>To announce its support for DNA, the server asserts its identity in the stream features following TLS negotiation.  The server MUST offer the identity of the domain specified in the client's stream header "to" attribute.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;stream:features&gt;
  &lt;assert xmlns='urn:ietf:params:xml:ns:dna' from='target.tld'/&gt;
&lt;/stream:features&gt;</pre></div>
<a name="clientchallenge"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Client challenges for proof</h3>

<p>To utilize the server's DNA assertion, the client performs Start-TLS per <a class='info' href='#rfc3920bis'>[rfc3920bis]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; September&nbsp;2009.</span><span>)</span></a>, however, if the client does not find a name match on the offered certificate, it does not disconnect immediately.  Instead, if the server offers an assertion, it can use the name from that assertion to ask the server for proof of delegation.
</p>
<p>Subsequent protocol follows the generic use cases above, with the exception that alternate or additional domain names MUST NOT be asserted.  If the server returns an "impossible" element, the server MUST terminate the stream.  If the client sends an "invalid" element, the client MUST terminate the stream.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;challenge xmlns='urn:ietf:params:xml:ns:dna' to='asserted.tld'&gt;
  &lt;proof type='urn:ietf:params:dna:proof:attribute-cert'/&gt;
&lt;/challenge&gt;</pre></div>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<a name="iana-ns-dna"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
XML Namespace Name for DNA</h3>

<p>A URN sub-namespace for Domain Name Assertion (DNA) negotiation data in the Extensible Messaging and Presence Protocol (XMPP) is defined as follows.  (This namespace name adheres to the format defined in .)
</p>
<p></p>
<blockquote class="text"><dl>
<dt>URI:</dt>
<dd>urn:ietf:params:xml:ns:dna
</dd>
<dt>Specification:</dt>
<dd>XXXX
</dd>
<dt>Description:</dt>
<dd>This is the XML namespace name for Domain Name Assertion (DNA) negotiation data in the Extensible Messaging and Presence Protocol (XMPP) as defined by XXXX.
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, XMPP Working Group, &lt;xmppwg@xmpp.org&gt;
</dd>
</dl></blockquote>

<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
URN space for standard DNA Proof Types</h3>

<p>A URN sub-namespace for DNA is defined as follows.  (This namespace name adheres to the format defined in .)
</p>
<p></p>
<blockquote class="text"><dl>
<dt>URI:</dt>
<dd>urn:ietf:params:dna:proof
</dd>
<dt>Specification:</dt>
<dd>XXXX
</dd>
<dt>Description:</dt>
<dd>This is the sub-namespace for standardized Domain Name Assertion (DNA) proof types as defined by XXXX.
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, XMPP Working Group, &lt;xmppwg@xmpp.org&gt;
</dd>
</dl></blockquote>

<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3"></a><h3>9.3.&nbsp;
DNA Proof Registry</h3>

<p>The URNs inside urn:ietf:params:dna:proof
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.4"></a><h3>9.4.&nbsp;
Object Identifiers</h3>

<p>The following OIDs are defined in Section 5.3 of this document:
        </p>
<ul class="text">
<li>id-xmpp
</li>
<li>id-xmpp-client
</li>
<li>id-xmpp-server
</li>
</ul><p>
        
</p>
<a name="i18n"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Internationalization Considerations</h3>

<p>The domains offered MUST conform to all of the rules for "Domain Identitifiers", as specified in &rfc3920bis;, including (but not limited to) the rules for syntax, cannonicalization and comparison.
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Security Considerations</h3>

<p>TBD.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="rfc3920bis">[rfc3920bis]</a></td>
<td class="author-text">Saint-Andre, P., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-xmpp-3920bis-02.txt">Extensible Messaging and Presence Protocol (XMPP): Core</a>,&rdquo; draft-ietf-xmpp-3920bis-02 (work in progress), September&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-xmpp-3920bis-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-pkix-3281update">[I-D.ietf-pkix-3281update]</a></td>
<td class="author-text">Housley, R., Farrell, S., and S. Turner, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-pkix-3281update-05.txt">An Internet Attribute Certificate Profile for Authorization</a>,&rdquo; draft-ietf-pkix-3281update-05 (work in progress), April&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-pkix-3281update-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-smime-3851bis">[I-D.ietf-smime-3851bis]</a></td>
<td class="author-text">Ramsdell, B. and S. Turner, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-smime-3851bis-11.txt">Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.2 Message  Specification</a>,&rdquo; draft-ietf-smime-3851bis-11 (work in progress), May&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-smime-3851bis-11.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2045">[RFC2045]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2045">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>,&rdquo; RFC&nbsp;2045, November&nbsp;1996 (<a href="ftp://ftp.isi.edu/in-notes/rfc2045.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4055">[RFC4055]</a></td>
<td class="author-text">Schaad, J., Kaliski, B., and R. Housley, &ldquo;<a href="http://tools.ietf.org/html/rfc4055">Additional Algorithms and Identifiers for RSA Cryptography for use in the Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>,&rdquo; RFC&nbsp;4055, June&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc4055.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5280">[RFC5280]</a></td>
<td class="author-text">Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;<a href="http://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>,&rdquo; RFC&nbsp;5280, May&nbsp;2008 (<a href="ftp://ftp.isi.edu/in-notes/rfc5280.txt">TXT</a>).</td></tr>
</table>

<a name="schema"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
RELAX NG XML Schema</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
default namespace = "urn:ietf:params:xml:ns:dna"

# Intent: Internationalized Domain Name (simplisitic view)
domain = xsd:string { pattern = "(\p{L}|\p{N})(\p{L}|\p{N}|\p{M}|-)*"
"(\.(\p{L}|\p{N})(\p{L}|\p{N}|\p{M}|-)*)*"}

assert = element assert {
  attribute from { domain }
}

valid = element valid {
  attribute to { domain }
}

invalid = element valid {
  attribute to { domain }
}

proof = element proof {
 attribute type { xsd:anyURI },
 attribute from { domain }?,
 text?
}

challenge = element challenge {
  proof+
}

start = assert | valid | invalid | proof | challenge
</pre></div>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jonas Lindberg</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Google</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jonasl@google.com">jonasl@google.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Stephen Farrell</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NewBay Software</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:sfarrell@newbay.com">sfarrell@newbay.com</a></td></tr>
</table>
</body></html>
