<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Protected Headers for Cryptographic E-mail</title>
<meta content="Bjarni RÃºnar Einarsson" name="author">
<meta content="juga" name="author">
<meta content="Daniel Kahn Gillmor" name="author">
<meta content="
       This document describes a common strategy to extend the end-to-end cryptographic protections provided by PGP/MIME, etc. to protect message headers in addition to message bodies.
In addition to protecting the authenticity and integrity of headers via signatures, it also describes how to preserve the confidentiality of the Subject header. 
    " name="description">
<meta content="xml2rfc 2.37.2" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-autocrypt-lamps-protected-headers-02" name="ietf.draft">
<link href="/tmp/draft-protected-headers-69ACl7.xml" type="application/rfc+xml" rel="alternate">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Avoid wrapping of URLs in references */
@media screen {
  .references a {
    white-space: nowrap;
  }
}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin: 0 0 0.25em 0;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}</style>
<link href="rfc-local.css" type="text/css" rel="stylesheet">
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Protected Headers for Cryptographic E-mail</td>
<td class="right">December 2019</td>
</tr></thead>
<tfoot><tr>
<td class="left">Einarsson, et al.</td>
<td class="center">Expires 22 June 2020</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">openpgp</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-autocrypt-lamps-protected-headers-02</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2019-12-20" class="published">20 December 2019</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2020-06-22">22 June 2020</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">B.R. Einarsson</div>
<div class="org">Mailpile ehf</div>
</div>
<div class="author">
      <div class="author-name">. juga</div>
<div class="org">Independent</div>
</div>
<div class="author">
      <div class="author-name">D.K. Gillmor</div>
<div class="org">ACLU</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Protected Headers for Cryptographic E-mail</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes a common strategy to extend the end-to-end cryptographic protections provided by PGP/MIME, etc. to protect message headers in addition to message bodies.
In addition to protecting the authenticity and integrity of headers via signatures, it also describes how to preserve the confidentiality of the Subject header.<a href="#section-abstract-1" class="pilcrow">Â¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 22 June 2020.<a href="#section-boilerplate.1-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2019 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">â²</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.Â Â <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1"><a href="#section-1.1" class="xref">1.1</a>.Â Â <a href="#name-requirements-language" class="xref">Requirements Language</a><a href="#section-toc.1-1.1.2.1.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1"><a href="#section-1.2" class="xref">1.2</a>.Â Â <a href="#name-terminology" class="xref">Terminology</a><a href="#section-toc.1-1.1.2.2.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1.2.2.2.1">
                    <p id="section-toc.1-1.1.2.2.2.1.1"><a href="#section-1.2.1" class="xref">1.2.1</a>.Â Â <a href="#name-user-facing-headers" class="xref">User-Facing Headers</a><a href="#section-toc.1-1.1.2.2.2.1.1" class="pilcrow">Â¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-toc.1-1.1.2.2.2.2">
                    <p id="section-toc.1-1.1.2.2.2.2.1"><a href="#section-1.2.2" class="xref">1.2.2</a>.Â Â <a href="#name-structural-headers" class="xref">Structural Headers</a><a href="#section-toc.1-1.1.2.2.2.2.1" class="pilcrow">Â¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.Â Â <a href="#name-protected-headers-summary" class="xref">Protected Headers Summary</a><a href="#section-toc.1-1.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.Â Â <a href="#name-cryptographic-mime-message-" class="xref">Cryptographic MIME Message Structure</a><a href="#section-toc.1-1.3.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.Â Â <a href="#name-cryptographic-layers" class="xref">Cryptographic Layers</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="xref">3.1.1</a>.Â Â <a href="#name-pgp-mime-cryptographic-laye" class="xref">PGP/MIME Cryptographic Layers</a><a href="#section-toc.1-1.3.2.1.2.1.1" class="pilcrow">Â¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="xref">3.1.2</a>.Â Â <a href="#name-s-mime-cryptographic-layers" class="xref">S/MIME Cryptographic Layers</a><a href="#section-toc.1-1.3.2.1.2.2.1" class="pilcrow">Â¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.Â Â <a href="#name-cryptographic-envelope" class="xref">Cryptographic Envelope</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.Â Â <a href="#name-cryptographic-payload" class="xref">Cryptographic Payload</a><a href="#section-toc.1-1.3.2.3.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="xref">3.3.1</a>.Â Â <a href="#name-simple-cryptographic-payloa" class="xref">Simple Cryptographic Payloads</a><a href="#section-toc.1-1.3.2.3.2.1.1" class="pilcrow">Â¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a href="#section-3.3.2" class="xref">3.3.2</a>.Â Â <a href="#name-multilayer-cryptographic-en" class="xref">Multilayer Cryptographic Envelopes</a><a href="#section-toc.1-1.3.2.3.2.2.1" class="pilcrow">Â¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-toc.1-1.3.2.3.2.3">
                    <p id="section-toc.1-1.3.2.3.2.3.1"><a href="#section-3.3.3" class="xref">3.3.3</a>.Â Â <a href="#name-a-baroque-example" class="xref">A Baroque Example</a><a href="#section-toc.1-1.3.2.3.2.3.1" class="pilcrow">Â¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.Â Â <a href="#name-exposed-headers-are-outside" class="xref">Exposed Headers are Outside</a><a href="#section-toc.1-1.3.2.4.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.Â Â <a href="#name-message-composition" class="xref">Message Composition</a><a href="#section-toc.1-1.4.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.Â Â <a href="#name-copying-all-headers" class="xref">Copying All Headers</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.Â Â <a href="#name-confidential-subject" class="xref">Confidential Subject</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.Â Â <a href="#name-obscured-headers" class="xref">Obscured Headers</a><a href="#section-toc.1-1.4.2.3.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.Â Â <a href="#name-message-composition-without" class="xref">Message Composition without Protected Headers</a><a href="#section-toc.1-1.4.2.4.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.Â Â <a href="#name-message-composition-with-pr" class="xref">Message Composition with Protected Headers</a><a href="#section-toc.1-1.4.2.5.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.Â Â <a href="#name-legacy-display" class="xref">Legacy Display</a><a href="#section-toc.1-1.5.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.Â Â <a href="#name-message-generation-includin" class="xref">Message Generation: Including a Legacy Display Part</a><a href="#section-toc.1-1.5.2.1.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="xref">5.1.1</a>.Â Â <a href="#name-legacy-display-transformati" class="xref">Legacy Display Transformation</a><a href="#section-toc.1-1.5.2.1.2.1.1" class="pilcrow">Â¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="xref">5.1.2</a>.Â Â <a href="#name-when-to-generate-legacy-dis" class="xref">When to Generate Legacy Display</a><a href="#section-toc.1-1.5.2.1.2.2.1" class="pilcrow">Â¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.Â Â <a href="#name-message-rendering-omitting-" class="xref">Message Rendering: Omitting a Legacy Display Part</a><a href="#section-toc.1-1.5.2.2.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="xref">5.2.1</a>.Â Â <a href="#name-legacy-display-detection-al" class="xref">Legacy Display Detection Algorithm</a><a href="#section-toc.1-1.5.2.2.2.1.1" class="pilcrow">Â¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.Â Â <a href="#name-legacy-display-is-decorativ" class="xref">Legacy Display is Decorative and Transitional</a><a href="#section-toc.1-1.5.2.3.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.Â Â <a href="#name-message-interpretation" class="xref">Message Interpretation</a><a href="#section-toc.1-1.6.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.Â Â <a href="#name-reverse-copying" class="xref">Reverse-Copying</a><a href="#section-toc.1-1.6.2.1.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.Â Â <a href="#name-signature-invalidation" class="xref">Signature Invalidation</a><a href="#section-toc.1-1.6.2.2.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.Â Â <a href="#name-the-legacy-display-part" class="xref">The Legacy Display Part</a><a href="#section-toc.1-1.6.2.3.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.Â Â <a href="#name-replying-to-a-message-with-" class="xref">Replying to a Message with Obscured Headers</a><a href="#section-toc.1-1.6.2.4.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.Â Â <a href="#name-common-pitfalls-and-guideli" class="xref">Common Pitfalls and Guidelines</a><a href="#section-toc.1-1.7.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.Â Â <a href="#name-misunderstood-obscured-subj" class="xref">Misunderstood Obscured Subjects</a><a href="#section-toc.1-1.7.2.1.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.Â Â <a href="#name-reply-forward-losing-subjec" class="xref">Reply/Forward Losing Subjects</a><a href="#section-toc.1-1.7.2.2.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.Â Â <a href="#name-usability-impact-of-reduced" class="xref">Usability Impact of Reduced Metadata</a><a href="#section-toc.1-1.7.2.3.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="xref">7.4</a>.Â Â <a href="#name-usability-impact-of-obscure" class="xref">Usability Impact of Obscured Message-ID</a><a href="#section-toc.1-1.7.2.4.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a href="#section-7.5" class="xref">7.5</a>.Â Â <a href="#name-usability-impact-of-obscured" class="xref">Usability Impact of Obscured From/To/Cc</a><a href="#section-toc.1-1.7.2.5.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.7.2.6">
                <p id="section-toc.1-1.7.2.6.1"><a href="#section-7.6" class="xref">7.6</a>.Â Â <a href="#name-mailing-list-header-modific" class="xref">Mailing List Header Modifications</a><a href="#section-toc.1-1.7.2.6.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.Â Â <a href="#name-comparison-with-other-heade" class="xref">Comparison with Other Header Protection Schemes</a><a href="#section-toc.1-1.8.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.Â Â <a href="#name-s-mime-31-header-protection" class="xref">S/MIME 3.1 Header Protection</a><a href="#section-toc.1-1.8.2.1.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.Â Â <a href="#name-the-content-type-property-f" class="xref">The Content-Type Property "forwarded=no" {forwarded=no}</a><a href="#section-toc.1-1.8.2.2.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.Â Â <a href="#name-pep-header-protection" class="xref">pEp Header Protection</a><a href="#section-toc.1-1.8.2.3.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="xref">8.4</a>.Â Â <a href="#name-dkim" class="xref">DKIM</a><a href="#section-toc.1-1.8.2.4.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="xref">8.5</a>.Â Â <a href="#name-s-mime-secure-headers" class="xref">S/MIME "Secure Headers"</a><a href="#section-toc.1-1.8.2.5.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.8.2.6">
                <p id="section-toc.1-1.8.2.6.1"><a href="#section-8.6" class="xref">8.6</a>.Â Â <a href="#name-triple-wrapping" class="xref">Triple-Wrapping</a><a href="#section-toc.1-1.8.2.6.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.Â Â <a href="#name-test-vectors" class="xref">Test Vectors</a><a href="#section-toc.1-1.9.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.Â Â <a href="#name-signed-pgp-mime-message-wit" class="xref">Signed PGP/MIME Message with Protected Headers</a><a href="#section-toc.1-1.9.2.1.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.Â Â <a href="#name-s-mime-multipart-signed-mes" class="xref">S/MIME multipart/signed Message with Protected Headers</a><a href="#section-toc.1-1.9.2.2.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="xref">9.3</a>.Â Â <a href="#name-s-mime-application-pkcs7-mi" class="xref">S/MIME application/pkcs7-mime SignedData Message with Protected Headers</a><a href="#section-toc.1-1.9.2.3.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="xref">9.4</a>.Â Â <a href="#name-signed-and-encrypted-pgp-mi" class="xref">Signed and Encrypted PGP/MIME Message with Protected Headers</a><a href="#section-toc.1-1.9.2.4.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="xref">9.5</a>.Â Â <a href="#name-signed-and-encrypted-s-mime" class="xref">Signed and Encrypted S/MIME Message with Protected Headers</a><a href="#section-toc.1-1.9.2.5.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.9.2.6">
                <p id="section-toc.1-1.9.2.6.1"><a href="#section-9.6" class="xref">9.6</a>.Â Â <a href="#name-signed-and-encrypted-pgp-mim" class="xref">Signed and Encrypted PGP/MIME Message with Protected Headers and Legacy Display Part</a><a href="#section-toc.1-1.9.2.6.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.9.2.7">
                <p id="section-toc.1-1.9.2.7.1"><a href="#section-9.7" class="xref">9.7</a>.Â Â <a href="#name-multilayer-pgp-mime-message" class="xref">Multilayer PGP/MIME Message with Protected Headers</a><a href="#section-toc.1-1.9.2.7.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.9.2.8">
                <p id="section-toc.1-1.9.2.8.1"><a href="#section-9.8" class="xref">9.8</a>.Â Â <a href="#name-multilayer-pgp-mime-message-" class="xref">Multilayer PGP/MIME Message with Protected Headers and Legacy Display Part</a><a href="#section-toc.1-1.9.2.8.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.9.2.9">
                <p id="section-toc.1-1.9.2.9.1"><a href="#section-9.9" class="xref">9.9</a>.Â Â <a href="#name-signed-and-encrypted-s-mime-" class="xref">Signed and Encrypted S/MIME Message with Protected Headers and Legacy Display</a><a href="#section-toc.1-1.9.2.9.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.9.2.10">
                <p id="section-toc.1-1.9.2.10.1"><a href="#section-9.10" class="xref">9.10</a>.Â <a href="#name-encrypted-only-unsigned-s-m" class="xref">Encrypted-only (unsigned) S/MIME Message with Protected Headers and Legacy Display</a><a href="#section-toc.1-1.9.2.10.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.9.2.11">
                <p id="section-toc.1-1.9.2.11.1"><a href="#section-9.11" class="xref">9.11</a>.Â <a href="#name-encrypted-only-unsigned-pgp" class="xref">Encrypted-only (unsigned) PGP/MIME Message with Protected Headers and Legacy Display</a><a href="#section-toc.1-1.9.2.11.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.9.2.12">
                <p id="section-toc.1-1.9.2.12.1"><a href="#section-9.12" class="xref">9.12</a>.Â <a href="#name-an-unfortunately-complex-ex" class="xref">An Unfortunately Complex Example</a><a href="#section-toc.1-1.9.2.12.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>.Â <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.10.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>.Â <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.11.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.Â Â <a href="#name-subject-leak" class="xref">Subject Leak</a><a href="#section-toc.1-1.11.2.1.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.Â Â <a href="#name-signature-replay" class="xref">Signature Replay</a><a href="#section-toc.1-1.11.2.2.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#section-11.3" class="xref">11.3</a>.Â Â <a href="#name-participant-modification" class="xref">Participant Modification</a><a href="#section-toc.1-1.11.2.3.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>.Â <a href="#name-privacy-considerations" class="xref">Privacy Considerations</a><a href="#section-toc.1-1.12.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="xref">13</a>.Â <a href="#name-document-considerations" class="xref">Document Considerations</a><a href="#section-toc.1-1.13.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="xref">13.1</a>.Â Â <a href="#name-document-history" class="xref">Document History</a><a href="#section-toc.1-1.13.2.1.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="xref">14</a>.Â <a href="#name-acknowledgements" class="xref">Acknowledgements</a><a href="#section-toc.1-1.14.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="xref">15</a>.Â <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.15.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.15.2.1">
                <p id="section-toc.1-1.15.2.1.1"><a href="#section-15.1" class="xref">15.1</a>.Â Â <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.15.2.1.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.15.2.2">
                <p id="section-toc.1-1.15.2.2.1"><a href="#section-15.2" class="xref">15.2</a>.Â Â <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.15.2.2.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#section-appendix.a" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.16.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">E-mail end-to-end security with OpenPGP and S/MIME standards can provide integrity, authentication, non-repudiation and confidentiality to the body of a MIME e-mail message.
However, PGP/MIME (<span>[<a href="#RFC3156" class="xref">RFC3156</a>]</span>) alone does not protect message headers.
And the structure to protect headers defined in S/MIME 3.1 (<span>[<a href="#RFC3851" class="xref">RFC3851</a>]</span>) has not seen widespread adoption.<a href="#section-1-1" class="pilcrow">Â¶</a></p>
<p id="section-1-2">This document defines a scheme, "Protected Headers for Cryptographic E-mail", which has been adopted by multiple existing e-mail clients in order to extend the cryptographic protections provided by PGP/MIME to also protect the message headers.
This scheme is also applicable to S/MIME <span>[<a href="#RFC8551" class="xref">RFC8551</a>]</span>.<a href="#section-1-2" class="pilcrow">Â¶</a></p>
<p id="section-1-3">This document describes how these protections can be applied to cryptographically signed messages, and also discusses some of the challenges of encrypting many transit-oriented headers.<a href="#section-1-3" class="pilcrow">Â¶</a></p>
<p id="section-1-4">It offers guidance for protecting the confidentiality of non-transit-oriented headers like Subject, and also offers a means to preserve backwards compatibility so that an encrypted Subject remains available to recipients using software that does not implement support for the Protected Headers scheme.<a href="#section-1-4" class="pilcrow">Â¶</a></p>
<p id="section-1-5">The document also discusses some of the compatibility constraints and usability concerns which motivated the design of the scheme, as well as limitations and a comparison with other proposals.<a href="#section-1-5" class="pilcrow">Â¶</a></p>
<p id="section-1-6">This technique has already proven itself as a useful building block for other improvements to cryptographic e-mail, such as the Autocrypt Level 1.1 (<span>[<a href="#Autocrypt" class="xref">Autocrypt</a>]</span>) "Gossip" mechanism.<a href="#section-1-6" class="pilcrow">Â¶</a></p>
<div id="requirements-language">
<section id="section-1.1">
        <h3 id="name-requirements-language">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-requirements-language" class="section-name selfRef">Requirements Language</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-1.2">
        <h3 id="name-terminology">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.2-1">For the purposes of this document, we define the following concepts:<a href="#section-1.2-1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-1.2-2.1">
            <em>MUA</em> is short for Mail User Agent; an e-mail client.<a href="#section-1.2-2.1" class="pilcrow">Â¶</a>
</li>
          <li id="section-1.2-2.2">
            <em>Protection</em> of message data refers to cryptographic encryption and/or signatures, providing confidentiality, authenticity or both.<a href="#section-1.2-2.2" class="pilcrow">Â¶</a>
</li>
          <li id="section-1.2-2.3">
            <em>Cryptographic Layer</em>, <em>Cryptographic Envelope</em> and <em>Cryptographic Payload</em> are defined in <a href="#cryptographic-structure" class="xref">Section 3</a><a href="#section-1.2-2.3" class="pilcrow">Â¶</a>
</li>
          <li id="section-1.2-2.4">
            <em>Original Headers</em> are the <span>[<a href="#RFC5322" class="xref">RFC5322</a>]</span> message headers as known to the sending MUA at the time of message composition.<a href="#section-1.2-2.4" class="pilcrow">Â¶</a>
</li>
          <li id="section-1.2-2.5">
            <em>Protected Headers</em> are any headers protected by the scheme described in this document.<a href="#section-1.2-2.5" class="pilcrow">Â¶</a>
</li>
          <li id="section-1.2-2.6">
            <em>Exposed Headers</em> are any headers outside the Cryptographic Payload (protected or not).<a href="#section-1.2-2.6" class="pilcrow">Â¶</a>
</li>
          <li id="section-1.2-2.7">
            <em>Obscured Headers</em> are any Protected Headers which have been modified or removed from the set of Exposed Headers.<a href="#section-1.2-2.7" class="pilcrow">Â¶</a>
</li>
          <li id="section-1.2-2.8">
            <em>Legacy Display Part</em> is a MIME construct which provides visibility for users of legacy clients of data from the Original Headers which may have been removed or obscured from the Exposed Headers. It is defined in <a href="#legacy-display" class="xref">Section 5</a>.<a href="#section-1.2-2.8" class="pilcrow">Â¶</a>
</li>
          <li id="section-1.2-2.9">
            <em>User-Facing Headers</em> are explained and enumerated in <a href="#user-facing-headers" class="xref">Section 1.2.1</a>.<a href="#section-1.2-2.9" class="pilcrow">Â¶</a>
</li>
          <li id="section-1.2-2.10">
            <em>Structural Headers</em> are documented in <a href="#structural-headers" class="xref">Section 1.2.2</a>.<a href="#section-1.2-2.10" class="pilcrow">Â¶</a>
</li>
        </ul>
<div id="user-facing-headers">
<section id="section-1.2.1">
          <h4 id="name-user-facing-headers">
<a href="#section-1.2.1" class="section-number selfRef">1.2.1. </a><a href="#name-user-facing-headers" class="section-name selfRef">User-Facing Headers</a>
          </h4>
<p id="section-1.2.1-1">Of all the headers that an e-mail message may contain, only a handful are typically presented directly to the user.
The user-facing headers are:<a href="#section-1.2.1-1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-1.2.1-2.1">
              <code>Subject</code><a href="#section-1.2.1-2.1" class="pilcrow">Â¶</a>
</li>
            <li id="section-1.2.1-2.2">
              <code>From</code><a href="#section-1.2.1-2.2" class="pilcrow">Â¶</a>
</li>
            <li id="section-1.2.1-2.3">
              <code>To</code><a href="#section-1.2.1-2.3" class="pilcrow">Â¶</a>
</li>
            <li id="section-1.2.1-2.4">
              <code>Cc</code><a href="#section-1.2.1-2.4" class="pilcrow">Â¶</a>
</li>
            <li id="section-1.2.1-2.5">
              <code>Date</code><a href="#section-1.2.1-2.5" class="pilcrow">Â¶</a>
</li>
            <li id="section-1.2.1-2.6">
              <code>Reply-To</code><a href="#section-1.2.1-2.6" class="pilcrow">Â¶</a>
</li>
            <li id="section-1.2.1-2.7">
              <code>Followup-To</code><a href="#section-1.2.1-2.7" class="pilcrow">Â¶</a>
</li>
          </ul>
<p id="section-1.2.1-3">The above is a complete list.  No other headers are considered "user-facing".<a href="#section-1.2.1-3" class="pilcrow">Â¶</a></p>
<p id="section-1.2.1-4">Other headers may affect the visible rendering of the message (e.g., <code>References</code> and <code>In-Reply-To</code> may affect the placement of a message in a threaded discussion), but they are not directly displayed to the user and so are not considered "user-facing" for the purposes of this document.<a href="#section-1.2.1-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="structural-headers">
<section id="section-1.2.2">
          <h4 id="name-structural-headers">
<a href="#section-1.2.2" class="section-number selfRef">1.2.2. </a><a href="#name-structural-headers" class="section-name selfRef">Structural Headers</a>
          </h4>
<p id="section-1.2.2-1">A message header whose name begins with <code>Content-</code> is referred to in this document as a "structural" header.<a href="#section-1.2.2-1" class="pilcrow">Â¶</a></p>
<p id="section-1.2.2-2">These headers indicate something about the specific MIME part they are attached to, and cannot be transferred or copied to other parts without endangering the readability of the message.<a href="#section-1.2.2-2" class="pilcrow">Â¶</a></p>
<p id="section-1.2.2-3">This includes (but is not limited to):<a href="#section-1.2.2-3" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-1.2.2-4.1">
              <code>Content-Type</code><a href="#section-1.2.2-4.1" class="pilcrow">Â¶</a>
</li>
            <li id="section-1.2.2-4.2">
              <code>Content-Transfer-Encoding</code><a href="#section-1.2.2-4.2" class="pilcrow">Â¶</a>
</li>
            <li id="section-1.2.2-4.3">
              <code>Content-Disposition</code><a href="#section-1.2.2-4.3" class="pilcrow">Â¶</a>
</li>
          </ul>
<p id="section-1.2.2-5">Note that no "user-facing" headers (<a href="#user-facing-headers" class="xref">Section 1.2.1</a>) are also "structural" headers.  Of course, many headers are neither "user-facing" nor "structural".<a href="#section-1.2.2-5" class="pilcrow">Â¶</a></p>
<p id="section-1.2.2-6">FIXME: are there any non-<code>Content-*</code> headers we should consider as structural?<a href="#section-1.2.2-6" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="protected-headers-summary">
<section id="section-2">
      <h2 id="name-protected-headers-summary">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-protected-headers-summary" class="section-name selfRef">Protected Headers Summary</a>
      </h2>
<p id="section-2-1">The Protected Headers scheme relies on three backward-compatible changes to a cryptographically-protected e-mail message:<a href="#section-2-1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-2-2.1">Headers known to the composing MUA at message composition time are (in addition to their typical placement as Exposed Headers on the outside of the message) also present in the MIME header of the root of the Cryptographic Payload.
These Protected Headers share cryptographic properties with the rest of the Cryptographic Payload.<a href="#section-2-2.1" class="pilcrow">Â¶</a>
</li>
        <li id="section-2-2.2">When the Cryptographic Envelope includes encryption, any Exposed Header MAY be <em>obscured</em> by a transformation (including deletion).<a href="#section-2-2.2" class="pilcrow">Â¶</a>
</li>
        <li id="section-2-2.3">If the composing MUA intends to obscure any user-facing headers, it MAY add a decorative "Legacy Display" MIME part to the Cryptographic Payload which additionally duplicates the original values of the obscured user-facing headers.<a href="#section-2-2.3" class="pilcrow">Â¶</a>
</li>
      </ul>
<p id="section-2-3">When a composing MUA encrypts a message, it SHOULD obscure the <code>Subject:</code> header, by using the literal string <code>...</code> (three U+002E FULL STOP characters) as the value of the exposed <code>Subject:</code> header.<a href="#section-2-3" class="pilcrow">Â¶</a></p>
<p id="section-2-4">When a receiving MUA encounters a message with a Cryptographic Envelope, it treats the headers of the Cryptographic Payload as belonging to the message itself, not just the subpart.
In particular, when rendering a header for any such message, the renderer SHOULD prefer the header's Protected value over its Exposed value.<a href="#section-2-4" class="pilcrow">Â¶</a></p>
<p id="section-2-5">A receiving MUA that understands Protected Headers and discovers a Legacy Display part SHOULD hide the Legacy Display part when rendering the message.<a href="#section-2-5" class="pilcrow">Â¶</a></p>
<p id="section-2-6">The following sections contain more detailed discussion.<a href="#section-2-6" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="cryptographic-structure">
<section id="section-3">
      <h2 id="name-cryptographic-mime-message-">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-cryptographic-mime-message-" class="section-name selfRef">Cryptographic MIME Message Structure</a>
      </h2>
<p id="section-3-1">Implementations use the structure of an e-mail message to protect the headers.
This section establishes some conventions about how to think about message structure.<a href="#section-3-1" class="pilcrow">Â¶</a></p>
<div id="cryptographic-layer">
<section id="section-3.1">
        <h3 id="name-cryptographic-layers">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-cryptographic-layers" class="section-name selfRef">Cryptographic Layers</a>
        </h3>
<p id="section-3.1-1">"Cryptographic Layer" refers to a MIME substructure that supplies some cryptographic protections to an internal MIME subtree.
The internal subtree is known as the "protected part" though of course it may itself be a multipart object.<a href="#section-3.1-1" class="pilcrow">Â¶</a></p>
<p id="section-3.1-2">In the diagrams below, <span class="unicode">"â§" (DOWNWARDS ARROW FROM BAR, U+21A7)</span> indicates "decrypts to", and <span class="unicode">"â©" (DOWNWARDS WHITE ARROW, U+21E9)</span> indicates "unwraps to".<a href="#section-3.1-2" class="pilcrow">Â¶</a></p>
<div id="pgpmime-cryptographic-layers">
<section id="section-3.1.1">
          <h4 id="name-pgp-mime-cryptographic-laye">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-pgp-mime-cryptographic-laye" class="section-name selfRef">PGP/MIME Cryptographic Layers</a>
          </h4>
<p id="section-3.1.1-1">For PGP/MIME <span>[<a href="#RFC3156" class="xref">RFC3156</a>]</span> there are two forms of Cryptographic Layers, signing and encryption.<a href="#section-3.1.1-1" class="pilcrow">Â¶</a></p>
<div id="pgpmime-multipart-signed">
<section id="section-3.1.1.1">
            <h5 id="name-pgp-mime-signing-cryptograp">
<a href="#section-3.1.1.1" class="section-number selfRef">3.1.1.1. </a><a href="#name-pgp-mime-signing-cryptograp" class="section-name selfRef">PGP/MIME Signing Cryptographic Layer (multipart/signed)</a>
            </h5>
<div class="artwork art-text alignLeft" id="section-3.1.1.1-1">
<pre>
ââ¬â´multipart/signed; protocol="application/pgp-signature"
 âââ´[protected part]
 âââ´application/pgp-signature
</pre><a href="#section-3.1.1.1-1" class="pilcrow">Â¶</a>
</div>
</section>
</div>
<div id="pgpmime-multipart-encrypted">
<section id="section-3.1.1.2">
            <h5 id="name-pgp-mime-encryption-cryptog">
<a href="#section-3.1.1.2" class="section-number selfRef">3.1.1.2. </a><a href="#name-pgp-mime-encryption-cryptog" class="section-name selfRef">PGP/MIME Encryption Cryptographic Layer (multipart/encrypted)</a>
            </h5>
<div class="artwork art-text alignLeft" id="section-3.1.1.2-1">
<pre>
ââ¬â´multipart/encrypted
 âââ´application/pgp-encrypted
 âââ´application/octet-stream
  â§ (decrypts to)
  âââ´[protected part]
</pre><a href="#section-3.1.1.2-1" class="pilcrow">Â¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="smime-cryptographic-layers">
<section id="section-3.1.2">
          <h4 id="name-s-mime-cryptographic-layers">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-s-mime-cryptographic-layers" class="section-name selfRef">S/MIME Cryptographic Layers</a>
          </h4>
<p id="section-3.1.2-1">For S/MIME <span>[<a href="#RFC8551" class="xref">RFC8551</a>]</span>, there are four forms of Cryptographic Layers: multipart/signed, PKCS#7 signed-data, PKCS7 enveloped-data, PKCS7 authEnveloped-data.<a href="#section-3.1.2-1" class="pilcrow">Â¶</a></p>
<div id="smime-multipart-signed">
<section id="section-3.1.2.1">
            <h5 id="name-s-mime-multipart-signed-cry">
<a href="#section-3.1.2.1" class="section-number selfRef">3.1.2.1. </a><a href="#name-s-mime-multipart-signed-cry" class="section-name selfRef">S/MIME Multipart Signed Cryptographic Layer</a>
            </h5>
<div class="artwork art-text alignLeft" id="section-3.1.2.1-1">
<pre>
ââ¬â´multipart/signed; protocol="application/pkcs7-signature"
 âââ´[protected part]
 âââ´application/pkcs7-signature
</pre><a href="#section-3.1.2.1-1" class="pilcrow">Â¶</a>
</div>
</section>
</div>
<div id="smime-pkcs7-signed-data">
<section id="section-3.1.2.2">
            <h5 id="name-s-mime-pkcs7-signed-data-cr">
<a href="#section-3.1.2.2" class="section-number selfRef">3.1.2.2. </a><a href="#name-s-mime-pkcs7-signed-data-cr" class="section-name selfRef">S/MIME PKCS7 signed-data Cryptographic Layer</a>
            </h5>
<div class="artwork art-text alignLeft" id="section-3.1.2.2-1">
<pre>
âââ´application/pkcs7-mime; smime-type="signed-data"
 â© (unwraps to)
 âââ´[protected part]
</pre><a href="#section-3.1.2.2-1" class="pilcrow">Â¶</a>
</div>
</section>
</div>
<div id="smime-pkcs7-enveloped-data">
<section id="section-3.1.2.3">
            <h5 id="name-s-mime-pkcs7-enveloped-data">
<a href="#section-3.1.2.3" class="section-number selfRef">3.1.2.3. </a><a href="#name-s-mime-pkcs7-enveloped-data" class="section-name selfRef">S/MIME PKCS7 enveloped-data Cryptographic Layer</a>
            </h5>
<div class="artwork art-text alignLeft" id="section-3.1.2.3-1">
<pre>
âââ´application/pkcs7-mime; smime-type="enveloped-data"
 â§ (decrypts to)
 âââ´[protected part]
</pre><a href="#section-3.1.2.3-1" class="pilcrow">Â¶</a>
</div>
</section>
</div>
<div id="smime-pkcs7-authenveloped-data">
<section id="section-3.1.2.4">
            <h5 id="name-s-mime-pkcs7-authenveloped-">
<a href="#section-3.1.2.4" class="section-number selfRef">3.1.2.4. </a><a href="#name-s-mime-pkcs7-authenveloped-" class="section-name selfRef">S/MIME PKCS7 authEnveloped-data Cryptographic Layer</a>
            </h5>
<div class="artwork art-text alignLeft" id="section-3.1.2.4-1">
<pre>
âââ´application/pkcs7-mime; smime-type="authEnveloped-data"
 â§ (decrypts to)
 âââ´[protected part]
</pre><a href="#section-3.1.2.4-1" class="pilcrow">Â¶</a>
</div>
<p id="section-3.1.2.4-2">Note that <code>enveloped-data</code> (<a href="#smime-pkcs7-enveloped-data" class="xref">Section 3.1.2.3</a>) and <code>authEnveloped-data</code> (<a href="#smime-pkcs7-authenveloped-data" class="xref">Section 3.1.2.4</a>) have identical message structure and semantics.
The only difference between the two is ciphertext malleability.<a href="#section-3.1.2.4-2" class="pilcrow">Â¶</a></p>
<p id="section-3.1.2.4-3">The examples in this document only include <code>enveloped-data</code>, but the implications for that layer apply to <code>authEnveloped-data</code> as well.<a href="#section-3.1.2.4-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="pkcs7-compression-is-not-a-cryptographic-layer">
<section id="section-3.1.2.5">
            <h5 id="name-pkcs7-compression-is-not-a-">
<a href="#section-3.1.2.5" class="section-number selfRef">3.1.2.5. </a><a href="#name-pkcs7-compression-is-not-a-" class="section-name selfRef">PKCS7 Compression is NOT a Cryptographic Layer</a>
            </h5>
<p id="section-3.1.2.5-1">The Cryptographic Message Syntax (CMS) provides a MIME compression layer (<code>smime-type="compressed-data"</code>), as defined in <span>[<a href="#RFC3274" class="xref">RFC3274</a>]</span>.
While the compression layer is technically a part of CMS, it is not considered a Cryptographic Layer for the purposes of this document.<a href="#section-3.1.2.5-1" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="cryptographic-envelope">
<section id="section-3.2">
        <h3 id="name-cryptographic-envelope">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-cryptographic-envelope" class="section-name selfRef">Cryptographic Envelope</a>
        </h3>
<p id="section-3.2-1">The Cryptographic Envelope is the largest contiguous set of Cryptographic Layers of an e-mail message starting with the outermost MIME type (that is, with the Content-Type of the message itself).<a href="#section-3.2-1" class="pilcrow">Â¶</a></p>
<p id="section-3.2-2">If the Content-Type of the message itself is not a Cryptographic Layer, then the message has no cryptographic envelope.<a href="#section-3.2-2" class="pilcrow">Â¶</a></p>
<p id="section-3.2-3">"Contiguous" in the definition above indicates that if a Cryptographic Layer is the protected part of another Cryptographic Layer, the layers together comprise a single Cryptographic Envelope.<a href="#section-3.2-3" class="pilcrow">Â¶</a></p>
<p id="section-3.2-4">Note that if a non-Cryptographic Layer intervenes, all Cryptographic Layers within the non-Cryptographic Layer <em>are not</em> part of the Cryptographic Envelope (see the example in <a href="#baroque-example" class="xref">Section 3.3.3</a>).<a href="#section-3.2-4" class="pilcrow">Â¶</a></p>
<p id="section-3.2-5">Note also that the ordering of the Cryptographic Layers implies different cryptographic properties.
A signed-then-encrypted message is different than an encrypted-then-signed message.<a href="#section-3.2-5" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="cryptographic-payload">
<section id="section-3.3">
        <h3 id="name-cryptographic-payload">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-cryptographic-payload" class="section-name selfRef">Cryptographic Payload</a>
        </h3>
<p id="section-3.3-1">The Cryptographic Payload of a message is the first non-Cryptographic Layer - the "protected part" - within the Cryptographic Envelope.
Since the Cryptographic Payload itself is a MIME part, it has its own set of headers.<a href="#section-3.3-1" class="pilcrow">Â¶</a></p>
<p id="section-3.3-2">Protected headers are placed on (and read from) the Cryptographic Payload, and should be considered to have the same cryptographic properties as the message itself.<a href="#section-3.3-2" class="pilcrow">Â¶</a></p>
<div id="simple-cryptographic-payloads">
<section id="section-3.3.1">
          <h4 id="name-simple-cryptographic-payloa">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-simple-cryptographic-payloa" class="section-name selfRef">Simple Cryptographic Payloads</a>
          </h4>
<p id="section-3.3.1-1">As described above, if the "protected part" identified in <a href="#pgpmime-multipart-signed" class="xref">Section 3.1.1.1</a> or <a href="#pgpmime-multipart-encrypted" class="xref">Section 3.1.1.2</a> is not itself a Cryptographic Layer, that part <em>is</em> the Cryptographic Payload.<a href="#section-3.3.1-1" class="pilcrow">Â¶</a></p>
<p id="section-3.3.1-2">If the application wants to generate a message that is both encrypted and signed, it MAY use the simple MIME structure from <a href="#pgpmime-multipart-encrypted" class="xref">Section 3.1.1.2</a> by ensuring that the <span>[<a href="#RFC4880" class="xref">RFC4880</a>]</span> Encrypted Message within the <code>application/octet-stream</code> part contains an <span>[<a href="#RFC4880" class="xref">RFC4880</a>]</span> Signed Message.<a href="#section-3.3.1-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="multilayer-cryptographic-envelopes">
<section id="section-3.3.2">
          <h4 id="name-multilayer-cryptographic-en">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-multilayer-cryptographic-en" class="section-name selfRef">Multilayer Cryptographic Envelopes</a>
          </h4>
<p id="section-3.3.2-1">It is possible to construct a Cryptographic Envelope consisting of multiple layers for PGP/MIME, typically of the following structure:<a href="#section-3.3.2-1" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.2-2">
<pre>
A ââ¬â´multipart/encrypted
B  âââ´application/pgp-encrypted
C  âââ´application/octet-stream
D   â§ (decrypts to)
E   ââ¬â´multipart/signed
F    âââ´[Cryptographic Payload]
G    âââ´application/pgp-signature
</pre><a href="#section-3.3.2-2" class="pilcrow">Â¶</a>
</div>
<p id="section-3.3.2-3">When handling such a message, the properties of the Cryptographic Envelope are derived from the series <code>A</code>, <code>E</code>.<a href="#section-3.3.2-3" class="pilcrow">Â¶</a></p>
<p id="section-3.3.2-4">As noted in <a href="#simple-cryptographic-payloads" class="xref">Section 3.3.1</a>, PGP/MIME applications also have a simpler MIME construction available with the same cryptographic properties.<a href="#section-3.3.2-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="baroque-example">
<section id="section-3.3.3">
          <h4 id="name-a-baroque-example">
<a href="#section-3.3.3" class="section-number selfRef">3.3.3. </a><a href="#name-a-baroque-example" class="section-name selfRef">A Baroque Example</a>
          </h4>
<p id="section-3.3.3-1">Consider a message with the following overcomplicated structure:<a href="#section-3.3.3-1" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.3-2">
<pre>
H ââ¬â´multipart/encrypted
I  âââ´application/pgp-encrypted
J  âââ´application/octet-stream
K   â§ (decrypts to)
L   ââ¬â´multipart/signed
M    ââ¬â´multipart/mixed
N    âââ¬â´multipart/signed
O    âââââ´text/plain
P    âââââ´application/pgp-signature
Q    ââââ´text/plain
R    âââ´application/pgp-signature
</pre><a href="#section-3.3.3-2" class="pilcrow">Â¶</a>
</div>
<p id="section-3.3.3-3">The 3 Cryptographic Layers in such a message are rooted in parts <code>H</code>, <code>L</code>, and <code>N</code>.
But the Cryptographic Envelope of the message consists only of the properties derived from the series <code>H</code>, <code>L</code>.
The Cryptographic Payload of the message is part <code>M</code>.<a href="#section-3.3.3-3" class="pilcrow">Â¶</a></p>
<p id="section-3.3.3-4">It is NOT RECOMMENDED to generate messages with such complicated structures.
Even if a receiving MUA can parse this structure properly, it is nearly impossible to render in a way that the user can reason about the cryptographic properties of part <code>O</code> compared to part <code>Q</code>.<a href="#section-3.3.3-4" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="exposed-headers-are-outside">
<section id="section-3.4">
        <h3 id="name-exposed-headers-are-outside">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-exposed-headers-are-outside" class="section-name selfRef">Exposed Headers are Outside</a>
        </h3>
<p id="section-3.4-1">The Cryptographic Envelope fully encloses the Cryptographic Payload, whether the message is signed or encrypted or both.
The Exposed Headers are considered to be outside of both.<a href="#section-3.4-1" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="message-composition">
<section id="section-4">
      <h2 id="name-message-composition">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-message-composition" class="section-name selfRef">Message Composition</a>
      </h2>
<p id="section-4-1">This section describes the composition of a cryptographically-protected message with Protected Headers.<a href="#section-4-1" class="pilcrow">Â¶</a></p>
<p id="section-4-2">We document legacy composition of cryptographically-protected messages (without protected headers) in <a href="#legacy-composition" class="xref">Section 4.4</a>, and then describe a revised version of that algorithm in <a href="#protected-header-composition" class="xref">Section 4.5</a> that produces conformant Protected Headers.<a href="#section-4-2" class="pilcrow">Â¶</a></p>
<div id="copying-all-headers">
<section id="section-4.1">
        <h3 id="name-copying-all-headers">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-copying-all-headers" class="section-name selfRef">Copying All Headers</a>
        </h3>
<p id="section-4.1-1">All non-structural headers known to the composing MUA are copied to the MIME header of the Cryptographic Payload.
The composing MUA SHOULD protect all known non-structural headers in this way.<a href="#section-4.1-1" class="pilcrow">Â¶</a></p>
<p id="section-4.1-2">If the composing MUA omits protection for some of the headers, the receiving MUA will have difficulty reasoning about the integrity of the headers (see <a href="#signature-replay" class="xref">Section 11.2</a>).<a href="#section-4.1-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="confidential-subject">
<section id="section-4.2">
        <h3 id="name-confidential-subject">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-confidential-subject" class="section-name selfRef">Confidential Subject</a>
        </h3>
<p id="section-4.2-1">When a message is encrypted, the Subject should be obscured by replacing the Exposed Subject with three periods: <code>...</code><a href="#section-4.2-1" class="pilcrow">Â¶</a></p>
<p id="section-4.2-2">This value (<code>...</code>) was chosen because it is believed to be language agnostic and avoids communicating any potentially misleading information to the recipient (see <a href="#misunderstood-obscured-subjects" class="xref">Section 7.1</a> for a more detailed discussion).<a href="#section-4.2-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="obscured-headers">
<section id="section-4.3">
        <h3 id="name-obscured-headers">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-obscured-headers" class="section-name selfRef">Obscured Headers</a>
        </h3>
<p id="section-4.3-1">Due to compatibility and usability concerns, a Mail User Agent SHOULD NOT obscure any of: <code>From</code>, <code>To</code>, <code>Cc</code>, <code>Message-ID</code>, <code>References</code>, <code>Reply-To</code>, <code>In-Reply-To</code>, (FIXME: MORE?) unless the user has indicated they have security constraints which justify the potential downsides (see <a href="#common-pitfalls" class="xref">Section 7</a> for a more detailed discussion).<a href="#section-4.3-1" class="pilcrow">Â¶</a></p>
<p id="section-4.3-2">Aside from that limitation, this specification does not at this time define or limit the methods a MUA may use to convert Exposed Headers into Obscured Headers.<a href="#section-4.3-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="legacy-composition">
<section id="section-4.4">
        <h3 id="name-message-composition-without">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-message-composition-without" class="section-name selfRef">Message Composition without Protected Headers</a>
        </h3>
<p id="section-4.4-1">This section roughly describes the steps that a legacy MUA might use to compose a cryptographically-protected message <em>without</em> Protected Headers.<a href="#section-4.4-1" class="pilcrow">Â¶</a></p>
<p id="section-4.4-2">The message composition algorithm takes three parameters:<a href="#section-4.4-2" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.4-3.1">
            <code>origbody</code>: the traditional unprotected message body as a well-formed MIME tree (possibly just a single MIME leaf part).
As a well-formed MIME tree, <code>origbody</code> already has structural headers present (see <a href="#structural-headers" class="xref">Section 1.2.2</a>).<a href="#section-4.4-3.1" class="pilcrow">Â¶</a>
</li>
          <li id="section-4.4-3.2">
            <code>origheaders</code>: the intended non-structural headers for the message, represented here as a table mapping from header names to header values..
For example, <code>origheaders['From']</code> refers to the value of the <code>From</code> header that the composing MUA would typically place on the message before sending it.<a href="#section-4.4-3.2" class="pilcrow">Â¶</a>
</li>
          <li id="section-4.4-3.3">
            <code>crypto</code>: The series of cryptographic protections to apply (for example, "sign with the secret key corresponding to OpenPGP certificate X, then encrypt to OpenPGP certificates X and Y").
This is a routine that accepts a MIME tree as input (the Cryptographic Payload), wraps the input in the appropriate Cryptographic Envelope, and returns the resultant MIME tree as output,<a href="#section-4.4-3.3" class="pilcrow">Â¶</a>
</li>
        </ul>
<p id="section-4.4-4">The algorithm returns a MIME object that is ready to be injected into the mail system:<a href="#section-4.4-4" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.4-5.1">Apply <code>crypto</code> to <code>origbody</code>, yielding MIME tree <code>output</code><a href="#section-4.4-5.1" class="pilcrow">Â¶</a>
</li>
          <li id="section-4.4-5.2">
            <p id="section-4.4-5.2.1">For header name <code>h</code> in <code>origheaders</code>:<a href="#section-4.4-5.2.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.4-5.2.2.1">Set header <code>h</code> of <code>output</code> to <code>origheaders[h]</code><a href="#section-4.4-5.2.2.1" class="pilcrow">Â¶</a>
</li>
            </ul>
</li>
          <li id="section-4.4-5.3">Return <code>output</code><a href="#section-4.4-5.3" class="pilcrow">Â¶</a>
</li>
        </ul>
</section>
</div>
<div id="protected-header-composition">
<section id="section-4.5">
        <h3 id="name-message-composition-with-pr">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-message-composition-with-pr" class="section-name selfRef">Message Composition with Protected Headers</a>
        </h3>
<p id="section-4.5-1">A reasonable sequential algorithm for composing a message <em>with</em> protected headers takes two more parameters in addition to <code>origbody</code>, <code>origheaders</code>, and <code>crypto</code>:<a href="#section-4.5-1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.5-2.1">
            <code>obscures</code>: a table of headers to be obscured during encryption, mapping header names to their obscuring values.
For example, this document recommends only obscuring the subject, so that would be represented by the single-entry table <code>obscures = {'Subject': '...'}</code>.
If header <code>Foo</code> is to be deleted entirely, <code>obscures['Foo']</code> should be set to the special value <code>null</code>.<a href="#section-4.5-2.1" class="pilcrow">Â¶</a>
</li>
          <li id="section-4.5-2.2">
            <code>legacy</code>: a boolean value, indicating whether any recipient of the message is believed to have a legacy client (that is, a MUA that is capable of decryption, but does not understand protected headers).<a href="#section-4.5-2.2" class="pilcrow">Â¶</a>
</li>
        </ul>
<p id="section-4.5-3">The revised algorithm for applying cryptographic protection to a message is as follows:<a href="#section-4.5-3" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.5-4.1">
            <p id="section-4.5-4.1.1">if <code>crypto</code> contains encryption, and <code>legacy</code> is <code>true</code>, and <code>obscures</code> contains any user-facing headers (see <a href="#user-facing-headers" class="xref">Section 1.2.1</a>), wrap <code>orig</code> in a structure that carries a Legacy Display part:<a href="#section-4.5-4.1.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.5-4.1.2.1">Create a new MIME leaf part <code>legacydisplay</code> with header <code>Content-Type: text/plain; protected-headers="v1"</code><a href="#section-4.5-4.1.2.1" class="pilcrow">Â¶</a>
</li>
              <li id="section-4.5-4.1.2.2">
                <p id="section-4.5-4.1.2.2.1">For each obscured header name <code>obh</code> in <code>obscures</code>:<a href="#section-4.5-4.1.2.2.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.5-4.1.2.2.2.1">
                    <p id="section-4.5-4.1.2.2.2.1.1">If <code>obh</code> is user-facing:<a href="#section-4.5-4.1.2.2.2.1.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.5-4.1.2.2.2.1.2.1">Add <code>obh: origheaders[ob]</code> to the body of <code>legacydisplay</code>.  For example, if <code>origheaders['Subject']</code> is <code>lunch plans?</code>, then add the line <code>Subject: lunch plans?</code> to the body of <code>legacydisplay</code><a href="#section-4.5-4.1.2.2.2.1.2.1" class="pilcrow">Â¶</a>
</li>
                    </ul>
</li>
                </ul>
</li>
              <li id="section-4.5-4.1.2.3">Construct a new MIME part <code>wrapper</code> with <code>Content-Type: multipart/mixed</code><a href="#section-4.5-4.1.2.3" class="pilcrow">Â¶</a>
</li>
              <li id="section-4.5-4.1.2.4">Give <code>wrapper</code> exactly two subparts: <code>legacydisplay</code> and <code>origbody</code>, in that order.<a href="#section-4.5-4.1.2.4" class="pilcrow">Â¶</a>
</li>
              <li id="section-4.5-4.1.2.5">Let <code>payload</code> be MIME part <code>wrapper</code><a href="#section-4.5-4.1.2.5" class="pilcrow">Â¶</a>
</li>
            </ul>
</li>
          <li id="section-4.5-4.2">
            <p id="section-4.5-4.2.1">Otherwise:<a href="#section-4.5-4.2.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.5-4.2.2.1">Let <code>payload</code> be MIME part <code>origbody</code><a href="#section-4.5-4.2.2.1" class="pilcrow">Â¶</a>
</li>
            </ul>
</li>
          <li id="section-4.5-4.3">
            <p id="section-4.5-4.3.1">For each header name <code>h</code> in <code>origheaders</code>:<a href="#section-4.5-4.3.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.5-4.3.2.1">Set header <code>h</code> of MIME part <code>payload</code> to <code>origheaders[h]</code><a href="#section-4.5-4.3.2.1" class="pilcrow">Â¶</a>
</li>
            </ul>
</li>
          <li id="section-4.5-4.4">Set the <code>protected-headers</code> parameter on the <code>Content-Type</code> of <code>payload</code> to <code>v1</code><a href="#section-4.5-4.4" class="pilcrow">Â¶</a>
</li>
          <li id="section-4.5-4.5">Apply <code>crypto</code> to <code>payload</code>, producing MIME tree <code>output</code><a href="#section-4.5-4.5" class="pilcrow">Â¶</a>
</li>
          <li id="section-4.5-4.6">
            <p id="section-4.5-4.6.1">If <code>crypto</code> contains encryption:<a href="#section-4.5-4.6.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.5-4.6.2.1">
                <p id="section-4.5-4.6.2.1.1">For each obscured header name <code>obh</code> in <code>obscures</code>:<a href="#section-4.5-4.6.2.1.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.5-4.6.2.1.2.1">
                    <p id="section-4.5-4.6.2.1.2.1.1">If <code>obscures[obh]</code> is <code>null</code>:<a href="#section-4.5-4.6.2.1.2.1.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.5-4.6.2.1.2.1.2.1">Drop <code>obh</code> from <code>origheaders</code><a href="#section-4.5-4.6.2.1.2.1.2.1" class="pilcrow">Â¶</a>
</li>
                    </ul>
</li>
                  <li id="section-4.5-4.6.2.1.2.2">
                    <p id="section-4.5-4.6.2.1.2.2.1">Else:<a href="#section-4.5-4.6.2.1.2.2.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.5-4.6.2.1.2.2.2.1">Set <code>origheaders[obh]</code> to <code>obscures[obh]</code><a href="#section-4.5-4.6.2.1.2.2.2.1" class="pilcrow">Â¶</a>
</li>
                    </ul>
</li>
                </ul>
</li>
            </ul>
</li>
          <li id="section-4.5-4.7">
            <p id="section-4.5-4.7.1">For each header name <code>h</code> in <code>origheaders</code>:<a href="#section-4.5-4.7.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4.5-4.7.2.1">Set header <code>h</code> of <code>output</code> to <code>origheaders[h]</code><a href="#section-4.5-4.7.2.1" class="pilcrow">Â¶</a>
</li>
            </ul>
</li>
          <li id="section-4.5-4.8">return <code>output</code><a href="#section-4.5-4.8" class="pilcrow">Â¶</a>
</li>
        </ul>
<p id="section-4.5-5">Note that both new parameters, <code>obscured</code> and <code>legacy</code>, are effectively ignored if <code>crypto</code> does not contain encryption.
This is by design, because they are irrelevant for signed-only cryptographic protections.<a href="#section-4.5-5" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="legacy-display">
<section id="section-5">
      <h2 id="name-legacy-display">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-legacy-display" class="section-name selfRef">Legacy Display</a>
      </h2>
<p id="section-5-1">MUAs typically display user-facing headers (<a href="#user-facing-headers" class="xref">Section 1.2.1</a>) directly to the user.
An encrypted message may be read by a decryption-capable legacy MUA that is unaware of this standard.
The user of such a legacy client risks losing access to any obscured headers.<a href="#section-5-1" class="pilcrow">Â¶</a></p>
<p id="section-5-2">This section presents a workaround to mitigate this risk by restructuring the Cryptographic Payload before encrypting to include a "Legacy Display" part.<a href="#section-5-2" class="pilcrow">Â¶</a></p>
<div id="message-generation-including-a-legacy-display-part">
<section id="section-5.1">
        <h3 id="name-message-generation-includin">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-message-generation-includin" class="section-name selfRef">Message Generation: Including a Legacy Display Part</a>
        </h3>
<p id="section-5.1-1">A generating MUA that wants to make an Obscured Subject (or any other user-facing header) visible to a recipient using a legacy MUA SHOULD modify the Cryptographic Payload by wrapping the intended body of the message in a <code>multipart/mixed</code> MIME part that prefixes the intended body with a Legacy Display part.<a href="#section-5.1-1" class="pilcrow">Â¶</a></p>
<p id="section-5.1-2">The Legacy Display part MUST be of Content-Type <code>text/plain</code> or <code>text/rfc822-headers</code> (<code>text/plain</code> is RECOMMENDED), and MUST contain a <code>protected-headers</code> parameter whose value is <code>v1</code>.
It SHOULD be marked with <code>Content-Disposition: inline</code> to encourage recipients to render it.<a href="#section-5.1-2" class="pilcrow">Â¶</a></p>
<p id="section-5.1-3">The contents of the Legacy Display part MUST be only the user-facing headers that the sending MUA intends to obscure after encryption.<a href="#section-5.1-3" class="pilcrow">Â¶</a></p>
<p id="section-5.1-4">The original body (now a subpart) SHOULD also be marked with <code>Content-Disposition: inline</code> to discourage legacy clients from presenting it as an attachment.<a href="#section-5.1-4" class="pilcrow">Â¶</a></p>
<div id="legacy-display-transformation">
<section id="section-5.1.1">
          <h4 id="name-legacy-display-transformati">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-legacy-display-transformati" class="section-name selfRef">Legacy Display Transformation</a>
          </h4>
<p id="section-5.1.1-1">Consider a message whose Cryptographic Payload, before encrypting, that would have a traditional <code>multipart/alternative</code> structure:<a href="#section-5.1.1-1" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.1.1-2">
<pre>
X ââ¬â´multipart/alternative
Y  âââ´text/plain
Z  âââ´text/html
</pre><a href="#section-5.1.1-2" class="pilcrow">Â¶</a>
</div>
<p id="section-5.1.1-3">When adding a Legacy Display part, this structure becomes:<a href="#section-5.1.1-3" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.1.1-4">
<pre>
V ââ¬â´multipart/mixed
W  âââ´text/plain ("Legacy Display" part)
X  ââ¬â´multipart/alternative ("original body")
Y   âââ´text/plain
Z   âââ´text/html
</pre><a href="#section-5.1.1-4" class="pilcrow">Â¶</a>
</div>
<p id="section-5.1.1-5">Note that with the inclusion of the Legacy Display part, the Cryptographic Payload is the <code>multipart/mixed</code> part (part <code>V</code> in the example above), so Protected Headers should be placed at that part.<a href="#section-5.1.1-5" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="when-to-generate-legacy-display">
<section id="section-5.1.2">
          <h4 id="name-when-to-generate-legacy-dis">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-when-to-generate-legacy-dis" class="section-name selfRef">When to Generate Legacy Display</a>
          </h4>
<p id="section-5.1.2-1">A MUA SHOULD transform a Cryptographic Payload to include a Legacy Display part only when:<a href="#section-5.1.2-1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-5.1.2-2.1">The message is going to be encrypted, and<a href="#section-5.1.2-2.1" class="pilcrow">Â¶</a>
</li>
            <li id="section-5.1.2-2.2">At least one user-facing header (see <a href="#user-facing-headers" class="xref">Section 1.2.1</a>) is going to be obscured<a href="#section-5.1.2-2.2" class="pilcrow">Â¶</a>
</li>
          </ul>
<p id="section-5.1.2-3">Additionally, if the sender knows that the recipient's MUA is capable of interpreting Protected Headers, it SHOULD NOT attempt to include a Legacy Display part.
(Signalling such a capability is out of scope for this document)<a href="#section-5.1.2-3" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="no-render-legacy-display">
<section id="section-5.2">
        <h3 id="name-message-rendering-omitting-">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-message-rendering-omitting-" class="section-name selfRef">Message Rendering: Omitting a Legacy Display Part</a>
        </h3>
<p id="section-5.2-1">A MUA that understands Protected Headers may receive an encrypted message that contains a Legacy Display part.
Such an MUA SHOULD avoid rendering the Legacy Display part to the user at all, since it is aware of and can render the actual Protected Headers.<a href="#section-5.2-1" class="pilcrow">Â¶</a></p>
<p id="section-5.2-2">If a Legacy Display part is detected, the Protected Headers should still be pulled from the Cryptographic Payload (part <code>V</code> in the example above), but the body of message SHOULD be rendered as though it were only the original body (part <code>X</code> in the example above).<a href="#section-5.2-2" class="pilcrow">Â¶</a></p>
<div id="legacy-display-detection-algorithm">
<section id="section-5.2.1">
          <h4 id="name-legacy-display-detection-al">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-legacy-display-detection-al" class="section-name selfRef">Legacy Display Detection Algorithm</a>
          </h4>
<p id="section-5.2.1-1">A receiving MUA acting on a message SHOULD detect the presence of a Legacy Display part and the corresponding "original body" with the following simple algorithm:<a href="#section-5.2.1-1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-5.2.1-2.1">Check that all of the following are true for the message:<a href="#section-5.2.1-2.1" class="pilcrow">Â¶</a>
</li>
            <li id="section-5.2.1-2.2">The Cryptographic Envelope must contain an encrypting Cryptographic Layer<a href="#section-5.2.1-2.2" class="pilcrow">Â¶</a>
</li>
            <li id="section-5.2.1-2.3">The Cryptographic Payload must have a <code>Content-Type</code> of <code>multipart/mixed</code><a href="#section-5.2.1-2.3" class="pilcrow">Â¶</a>
</li>
            <li id="section-5.2.1-2.4">The Cryptographic Payload must have exactly two subparts<a href="#section-5.2.1-2.4" class="pilcrow">Â¶</a>
</li>
            <li id="section-5.2.1-2.5">The first subpart of the Cryptographic Payload must have a <code>Content-Type</code> of <code>text/plain</code> or <code>text/rfc822-headers</code><a href="#section-5.2.1-2.5" class="pilcrow">Â¶</a>
</li>
            <li id="section-5.2.1-2.6">The first subpart of the Cryptographic Payload's <code>Content-Type</code> must contain a property of <code>protected-headers</code>, and its value must be <code>v1</code>.<a href="#section-5.2.1-2.6" class="pilcrow">Â¶</a>
</li>
            <li id="section-5.2.1-2.7">If all of the above are true, then the first subpart is the Legacy Display part, and the second subpart is the "original body".  Otherwise, the message does not have a Legacy Display part.<a href="#section-5.2.1-2.7" class="pilcrow">Â¶</a>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="legacy-display-is-decorative-and-transitional">
<section id="section-5.3">
        <h3 id="name-legacy-display-is-decorativ">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-legacy-display-is-decorativ" class="section-name selfRef">Legacy Display is Decorative and Transitional</a>
        </h3>
<p id="section-5.3-1">As the above makes clear, the Legacy Display part is strictly decorative, for the benefit of legacy decryption-capable MUAs that may handle the message.
As such, the existence of the Legacy Display part and its <code>multipart/mixed</code> wrapper are part of a transition plan.<a href="#section-5.3-1" class="pilcrow">Â¶</a></p>
<p id="section-5.3-2">As the number of decryption-capable clients that understand Protected Headers grows in comparison to the number of legacy decryption-capable clients, it is expected that some senders will decide to stop generating Legacy Display parts entirely.<a href="#section-5.3-2" class="pilcrow">Â¶</a></p>
<p id="section-5.3-3">A MUA developer concerned about accessiblity of the Subject header for their users of encrypted mail when Legacy Display parts are omitted SHOULD implement the Protected Headers scheme described in this document.<a href="#section-5.3-3" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="message-interpretation">
<section id="section-6">
      <h2 id="name-message-interpretation">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-message-interpretation" class="section-name selfRef">Message Interpretation</a>
      </h2>
<p id="section-6-1">This document does not currently provide comprehensive recommendations on how to interpret Protected Headers. This is deliberate; research and development is still ongoing. We also recognize that the tolerance of different user groups for false positives (benign conditions misidentified as security risks), vs. their need for strong protections varies a great deal and different MUAs will take different approaches as a result.<a href="#section-6-1" class="pilcrow">Â¶</a></p>
<p id="section-6-2">Some common approaches are discussed below.<a href="#section-6-2" class="pilcrow">Â¶</a></p>
<div id="reverse-copying">
<section id="section-6.1">
        <h3 id="name-reverse-copying">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-reverse-copying" class="section-name selfRef">Reverse-Copying</a>
        </h3>
<p id="section-6.1-1">One strategy for interpreting Protected Headers on an incoming message is to simply ignore any Exposed Header for which a Protected counterpart is available.
This is often implemented as a copy operation (copying header back out of the Cryptographic Payload into the main message header) within the code which takes care of parsing the message.<a href="#section-6.1-1" class="pilcrow">Â¶</a></p>
<p id="section-6.1-2">A MUA implementing this strategy should pay special attention to any user facing headers (<a href="#user-facing-headers" class="xref">Section 1.2.1</a>).
If a message has Protected Headers, and a user-facing header is among the Exposed Headers but missing from the Protected Headers, then an MUA implementing this strategy SHOULD delete the identified Exposed Header before presenting the message to the user.<a href="#section-6.1-2" class="pilcrow">Â¶</a></p>
<p id="section-6.1-3">This strategy does not risk raising a false alarm about harmless deviations, but conversely it does nothing to inform the user if they are under attack.
This strategy does successfully mitigate and thwart some attacks, including signature replay attacks (<a href="#signature-replay" class="xref">Section 11.2</a>) and participant modification attacks (<a href="#participant-modification" class="xref">Section 11.3</a>).<a href="#section-6.1-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="signature-invalidation">
<section id="section-6.2">
        <h3 id="name-signature-invalidation">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-signature-invalidation" class="section-name selfRef">Signature Invalidation</a>
        </h3>
<p id="section-6.2-1">An alternate strategy for interpreting Protected Headers is to consider the cryptographic signature on a message to be invalid if the Exposed Headers deviate from their Protected counterparts.<a href="#section-6.2-1" class="pilcrow">Â¶</a></p>
<p id="section-6.2-2">This state should be presented to the user using the same interface as other signature verification failures.<a href="#section-6.2-2" class="pilcrow">Â¶</a></p>
<p id="section-6.2-3">A MUA implementing this strategy MAY want to make a special exception for the <code>Subject:</code> header, to avoid invalidating the signature on any signed and encrypted message with a confidential subject.<a href="#section-6.2-3" class="pilcrow">Â¶</a></p>
<p id="section-6.2-4">Note that simple signature invalidation may be insufficient to defend against a participant modification attack (<a href="#participant-modification" class="xref">Section 11.3</a>).<a href="#section-6.2-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="the-legacy-display-part">
<section id="section-6.3">
        <h3 id="name-the-legacy-display-part">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-the-legacy-display-part" class="section-name selfRef">The Legacy Display Part</a>
        </h3>
<p id="section-6.3-1">This part is purely decorative, for the benefit of any recipient using a legacy decryption-capable MUA.
See <a href="#no-render-legacy-display" class="xref">Section 5.2</a> for details and recommendations on how to handle the Legacy Display part.<a href="#section-6.3-1" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="replying-to-a-message-with-obscured-headers">
<section id="section-6.4">
        <h3 id="name-replying-to-a-message-with-">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-replying-to-a-message-with-" class="section-name selfRef">Replying to a Message with Obscured Headers</a>
        </h3>
<p id="section-6.4-1">When replying to a message, many MUAs copy headers from the original message into their reply.<a href="#section-6.4-1" class="pilcrow">Â¶</a></p>
<p id="section-6.4-2">When replying to an encrypted message, users expect the replying MUA to generate an encrypted message if possible.
If encryption is not possible, and the reply will be cleartext, users typically want the MUA to avoid leaking previously-encrypted content into the cleartext of the reply.<a href="#section-6.4-2" class="pilcrow">Â¶</a></p>
<p id="section-6.4-3">For this reason, an MUA replying to an encrypted message with Obscured Headers SHOULD NOT leak the cleartext of any Obscured Headers into the cleartext of the reply, whether encrypted or not.<a href="#section-6.4-3" class="pilcrow">Â¶</a></p>
<p id="section-6.4-4">In particular, the contents of any Obscured Protected Header from the original message SHOULD NOT be placed in the Exposed Headers of the reply message.<a href="#section-6.4-4" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="common-pitfalls">
<section id="section-7">
      <h2 id="name-common-pitfalls-and-guideli">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-common-pitfalls-and-guideli" class="section-name selfRef">Common Pitfalls and Guidelines</a>
      </h2>
<p id="section-7-1">Among the MUA authors who already implemented most of this specification,
several alternative or more encompassing specifications were discussed and
sometimes tried out in practice. This section highlights a few "pitfalls" and
guidelines based on these discussions and lessons learned.<a href="#section-7-1" class="pilcrow">Â¶</a></p>
<div id="misunderstood-obscured-subjects">
<section id="section-7.1">
        <h3 id="name-misunderstood-obscured-subj">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-misunderstood-obscured-subj" class="section-name selfRef">Misunderstood Obscured Subjects</a>
        </h3>
<p id="section-7.1-1">There were many discussions around what text phrase to use to obscure the <code>Subject:</code>.
Text phrases such as <code>Encrypted Message</code> were tried but resulted in both localization problems and user confusion.<a href="#section-7.1-1" class="pilcrow">Â¶</a></p>
<p id="section-7.1-2">If the natural language phrase for the obscured <code>Subject:</code> is not localized (e.g. just English <code>Encrypted Message</code>), then it may be incomprehensible to a non-English-speaking recipient who uses a legacy MUA that renders the obscured <code>Subject:</code> directly.<a href="#section-7.1-2" class="pilcrow">Â¶</a></p>
<p id="section-7.1-3">On the other hand, if it is localized based on the sender's MUA language settings, there is no guarantee that the recipient prefers the same language as the sender (consider a German speaker sending English text to an Anglophone).
There is no standard way for a sending MUA to infer the language preferred by the recipient (aside from statistical inference of language based on the composed message, which would in turn leak information about the supposedly-confidential message body).<a href="#section-7.1-3" class="pilcrow">Â¶</a></p>
<p id="section-7.1-4">Furthermore, implementors found that the phrase <code>Encrypted Message</code> in the subject line was sometimes understood by users to be an indication from the MUA that the message was actually encrypted.
In practice, when some MUA failed to encrypt a message in a thread that started off with an obscured <code>Subject:</code>, the value <code>Re: Encrypted Message</code> was retained even on those cleartext replies, resulting in user confusion.<a href="#section-7.1-4" class="pilcrow">Â¶</a></p>
<p id="section-7.1-5">In contrast, using <code>...</code> as the obscured <code>Subject:</code> was less likely to be seen as an indicator from the MUA of message encryption, and it also neatly sidesteps the localization problems.<a href="#section-7.1-5" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="replyforward-losing-subjects">
<section id="section-7.2">
        <h3 id="name-reply-forward-losing-subjec">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-reply-forward-losing-subjec" class="section-name selfRef">Reply/Forward Losing Subjects</a>
        </h3>
<p id="section-7.2-1">When the user of a legacy MUA replies to or forwards a message where the Subject has been obscured, it is likely that the new subject will be <code>Fwd: ...</code> or <code>Re: ...</code> (or the localized equivalent).
This breaks an important feature: people are used to continuity of subject within a thread.  It is especially unfortunate when a new participant is added to a conversation who never saw the original subject.<a href="#section-7.2-1" class="pilcrow">Â¶</a></p>
<p id="section-7.2-2">At this time, there is no known workaround for this problem. The only solution is to upgrade the MUA to support Protected Headers.<a href="#section-7.2-2" class="pilcrow">Â¶</a></p>
<p id="section-7.2-3">The authors consider this to be only a minor concern in cases where encryption is being used because confidentiality is important.
However, in more opportunistic cases, where encryption is being used routinely regardless of the sensitivity of message contents, this cost becomes higher.<a href="#section-7.2-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="usability-impact-of-reduced-metadata">
<section id="section-7.3">
        <h3 id="name-usability-impact-of-reduced">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-usability-impact-of-reduced" class="section-name selfRef">Usability Impact of Reduced Metadata</a>
        </h3>
<p id="section-7.3-1">Many mail user agents maintain an index of message metadata (including header data), which is used to rapidly construct mailbox overviews and search result listings.
If the process which generates this index does not have access to the encrypted payload of a message, or does not implement Protected Headers, then the index will only contain the obscured versions Exposed Headers, in particular an obscured Subject of <code>...</code>.<a href="#section-7.3-1" class="pilcrow">Â¶</a></p>
<p id="section-7.3-2">For sensitive message content, especially in a hosted MUA-as-a-service situation ("webmail") where the metadata index is maintained and stored by a third party, this may be considered a feature as the subject is protected from the third-party.
However, for more routine communications, this harms usability and goes against user expectations.<a href="#section-7.3-2" class="pilcrow">Â¶</a></p>
<p id="section-7.3-3">Two simple workarounds exist for this use case:<a href="#section-7.3-3" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal" id="section-7.3-4">
          <li id="section-7.3-4.1">If the metadata index is considered secure enough to handle confidential data,
the protected content may be stored directly in the index once it has been decrypted.<a href="#section-7.3-4.1" class="pilcrow">Â¶</a>
</li>
          <li id="section-7.3-4.2">If the metadata index is not trusted, the protected content could be re-encrypted
and encrypted versions stored in the index instead, which are then decrypted by
the client at display time.<a href="#section-7.3-4.2" class="pilcrow">Â¶</a>
</li>
        </ol>
<p id="section-7.3-5">In both cases, the process which decrypts the message and processes the Protected Headers must be able to update the metadata index.<a href="#section-7.3-5" class="pilcrow">Â¶</a></p>
<p id="section-7.3-6">FIXME: add notes about research topics and other non-simple workarounds, like oblivious server-side indexing, or searching on encrypted data.<a href="#section-7.3-6" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="obscured-message-id">
<section id="section-7.4">
        <h3 id="name-usability-impact-of-obscure">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-usability-impact-of-obscure" class="section-name selfRef">Usability Impact of Obscured Message-ID</a>
        </h3>
<p id="section-7.4-1">Current MUA implementations rely on the outermost Message-ID 
for message processing and indexing purposes. This processing
often happens before any decryption is even attempted. 
Attempting to send a message with an obscured Message-ID header
would result in several MUAs not correctly processing the message,
and would likely be seen as a degradation by users.<a href="#section-7.4-1" class="pilcrow">Â¶</a></p>
<p id="section-7.4-2">Furthermore, a legacy MUA replying to a message with an obscured <code>Message-ID:</code> would be likely to produce threading information (<code>References:</code>, <code>In-Reply-To:</code>) that would be misunderstood by the original sender.
Implementors generally disapprove of breaking threads.<a href="#section-7.4-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="usability-impact-of-obscured-fromtocc">
<section id="section-7.5">
        <h3 id="name-usability-impact-of-obscured">
<a href="#section-7.5" class="section-number selfRef">7.5. </a><a href="#name-usability-impact-of-obscured" class="section-name selfRef">Usability Impact of Obscured From/To/Cc</a>
        </h3>
<p id="section-7.5-1">The impact of obscuring <code>From:</code>, <code>To:</code>, and <code>Cc:</code> headers has similar issues as discussed with obscuring the <code>Message-ID:</code> header in <a href="#obscured-message-id" class="xref">Section 7.4</a>.<a href="#section-7.5-1" class="pilcrow">Â¶</a></p>
<p id="section-7.5-2">In addition, obscuring these headers is likely to cause difficulties for a legacy client attempting formulate a correct reply (or "reply all") to a given message.<a href="#section-7.5-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="mailing-list-header-modifications">
<section id="section-7.6">
        <h3 id="name-mailing-list-header-modific">
<a href="#section-7.6" class="section-number selfRef">7.6. </a><a href="#name-mailing-list-header-modific" class="section-name selfRef">Mailing List Header Modifications</a>
        </h3>
<p id="section-7.6-1">Some popular mailing-list implementations will modify the Exposed Headers of a message in specific, benign ways. In particular, it is common to add markers to the <code>Subject</code> line, and it is also common to modify either <code>From</code> or <code>Reply-To</code> in order to make sure replies go to the list instead of directly to the author of an individual post.<a href="#section-7.6-1" class="pilcrow">Â¶</a></p>
<p id="section-7.6-2">Depending on how the MUA resolves discrepancies between the Protected Headers and the Exposed Headers of a received message, these mailing list "features" may either break or the MUA may incorrectly interpret them as a security breach.<a href="#section-7.6-2" class="pilcrow">Â¶</a></p>
<p id="section-7.6-3">Implementors may for this reason choose to implement slightly different strategies for resolving discrepancies, if a message is known to come from such a mailing list. MUAs should at the very least avoid presenting false alarms in such cases.<a href="#section-7.6-3" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="comparison-with-other-header-protection-schemes">
<section id="section-8">
      <h2 id="name-comparison-with-other-heade">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-comparison-with-other-heade" class="section-name selfRef">Comparison with Other Header Protection Schemes</a>
      </h2>
<p id="section-8-1">Other header protection schemes have been proposed (in the IETF and elsewhere) that are distinct from this mechanism.
This section documents the differences between those earlier mechanisms and this one, and hypothesizes why it has seen greater interoperable adoption.<a href="#section-8-1" class="pilcrow">Â¶</a></p>
<p id="section-8-2">The distinctions include:<a href="#section-8-2" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-8-3.1">backward compatibility with legacy clients<a href="#section-8-3.1" class="pilcrow">Â¶</a>
</li>
        <li id="section-8-3.2">compatibility across PGP/MIME and S/MIME<a href="#section-8-3.2" class="pilcrow">Â¶</a>
</li>
        <li id="section-8-3.3">protection for both confidentiality and signing<a href="#section-8-3.3" class="pilcrow">Â¶</a>
</li>
      </ul>
<div id="smime-31">
<section id="section-8.1">
        <h3 id="name-s-mime-31-header-protection">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-s-mime-31-header-protection" class="section-name selfRef">S/MIME 3.1 Header Protection</a>
        </h3>
<p id="section-8.1-1">S/MIME 3.1 (<span>[<a href="#RFC3851" class="xref">RFC3851</a>]</span>) introduces header protection via <code>message/rfc822</code> header parts.<a href="#section-8.1-1" class="pilcrow">Â¶</a></p>
<p id="section-8.1-2">The problem with this mechanism is that many legacy clients encountering such a message were likely to interpret it as either a forwarded message, or as an unreadable substructure.<a href="#section-8.1-2" class="pilcrow">Â¶</a></p>
<p id="section-8.1-3">For signed messages, this is particularly problematic - a message that would otherwise have been easily readable by a client that knows nothing about signed messages suddenly shows up as a message-within-a-message, just by virtue of signing.  This has an impact on <em>all</em> clients, whether they are cryptographically-capable or not.<a href="#section-8.1-3" class="pilcrow">Â¶</a></p>
<p id="section-8.1-4">For encrypted messages, whose interpretation only matters on the smaller set of cryptographically-capable legacy clients, the resulting message rendering is awkward at best.<a href="#section-8.1-4" class="pilcrow">Â¶</a></p>
<p id="section-8.1-5">Furthermore, formulating a reply to such a message on a legacy client can also leave the user with badly-structured quoted and attributed content.<a href="#section-8.1-5" class="pilcrow">Â¶</a></p>
<p id="section-8.1-6">Additionally, a message deliberately forwarded in its own right (without preamble or adjacent explanatory notes) could potentially be confused with a message using the declared structure.<a href="#section-8.1-6" class="pilcrow">Â¶</a></p>
<p id="section-8.1-7">The mechanism described here allows cryptographically-incapable legacy MUAs to read and handle cleartext signed messages without any modifications, and permits cryptographically-capable legacy MUAs to handle encrypted messages without any modifications.<a href="#section-8.1-7" class="pilcrow">Â¶</a></p>
<p id="section-8.1-8">In particular, the Legacy Display part described in <a href="#legacy-display" class="xref">Section 5</a> makes it feasible for a conformant MUA to generate messages with obscured Subject lines that nonetheless give access to the obscured Subject header for recipients with legacy MUAs.<a href="#section-8.1-8" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="the-content-type-property-forwardedno-forwardedno">
<section id="section-8.2">
        <h3 id="name-the-content-type-property-f">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-the-content-type-property-f" class="section-name selfRef">The Content-Type Property "forwarded=no" {forwarded=no}</a>
        </h3>
<p id="section-8.2-1">Section A.1.2 of <span>[<a href="#I-D.draft-ietf-lamps-header-protection-requirements-01" class="xref">I-D.draft-ietf-lamps-header-protection-requirements-01</a>]</span> refers to a proposal that attempts to mitigate one of the drawbacks of the scheme described in S/MIME 3.1 (<a href="#smime-31" class="xref">Section 8.1</a>).<a href="#section-8.2-1" class="pilcrow">Â¶</a></p>
<p id="section-8.2-2">In particular, using the Content-Type property <code>forwarded="no"</code> allows <em>non-legacy</em> clients to distinguish between deliberately forwarded messages and those intended to use the defined structure for header protection.<a href="#section-8.2-2" class="pilcrow">Â¶</a></p>
<p id="section-8.2-3">However, this fix has no impact on the confusion experienced by legacy clients.<a href="#section-8.2-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="pep-header-protection">
<section id="section-8.3">
        <h3 id="name-pep-header-protection">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-pep-header-protection" class="section-name selfRef">pEp Header Protection</a>
        </h3>
<p id="section-8.3-1"><span>[<a href="#I-D.draft-luck-lamps-pep-header-protection-03" class="xref">I-D.draft-luck-lamps-pep-header-protection-03</a>]</span> is applicable only to signed+encrypted mail, and does not contemplate protection of signed-only mail.<a href="#section-8.3-1" class="pilcrow">Â¶</a></p>
<p id="section-8.3-2">In addition, the pEp header protection involved for "pEp message format 2" has an additional <code>multipart/mixed</code>  layer designed to facilitate transfer of OpenPGP Transferable Public Keys, which seems orthogonal to the effort to protect headers.<a href="#section-8.3-2" class="pilcrow">Â¶</a></p>
<p id="section-8.3-3">Finally, that draft suggests that the exposed Subject header be one of "=?utf-8?Q?p=E2=89=A1p?=", "pEp", or "Encrypted message".
"pEp" is a mysterious choice for most users, and see <a href="#misunderstood-obscured-subjects" class="xref">Section 7.1</a> for more commentary on why "Encrypted message" is likely to be problematic.<a href="#section-8.3-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="dkim">
<section id="section-8.4">
        <h3 id="name-dkim">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-dkim" class="section-name selfRef">DKIM</a>
        </h3>
<p id="section-8.4-1"><span>[<a href="#RFC6736" class="xref">RFC6736</a>]</span> offers DKIM, which is often used to sign headers associated with a message.<a href="#section-8.4-1" class="pilcrow">Â¶</a></p>
<p id="section-8.4-2">DKIM is orthogonal to the work described in this document, since it is typically done by the domain operator and not the end user generating the original message.
That is, DKIM is not "end-to-end" and does not represent the intent of the entity generating the message.<a href="#section-8.4-2" class="pilcrow">Â¶</a></p>
<p id="section-8.4-3">Furthermore, a DKIM signer does not have access to headers inside an encrypted Cryptographic Layer, and a DKIM verifier cannot effectively use DKIM to verify such confidential headers.<a href="#section-8.4-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="smime-secure-headers">
<section id="section-8.5">
        <h3 id="name-s-mime-secure-headers">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-s-mime-secure-headers" class="section-name selfRef">S/MIME "Secure Headers"</a>
        </h3>
<p id="section-8.5-1"><span>[<a href="#RFC7508" class="xref">RFC7508</a>]</span> describes a mechanism that embeds message header fields in the S/MIME signature using ASN.1.<a href="#section-8.5-1" class="pilcrow">Â¶</a></p>
<p id="section-8.5-2">The mechanism proposed in that draft is undefined for use with PGP/MIME.
While all S/MIME clients must be able to handle CMS and ASN.1 as well as MIME, a standard that works at the MIME layer itself should be applicable to any MUA that can work with MIME, regardess of whether end-to-end security layers are provided by S/MIME or PGP/MIME.<a href="#section-8.5-2" class="pilcrow">Â¶</a></p>
<p id="section-8.5-3">That mechanism also does not propose a means to provide confidentiality protection for headers within an encrypted-but-not-signed message.<a href="#section-8.5-3" class="pilcrow">Â¶</a></p>
<p id="section-8.5-4">Finally, that mechanism offers no equivalent to the Legacy Display described in <a href="#legacy-display" class="xref">Section 5</a>.
Instead, sender and receiver are expected to negotiate in some unspecified way to ensure that it is safe to remove or modify Exposed Headers in an encrypted message.<a href="#section-8.5-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="triple-wrapping">
<section id="section-8.6">
        <h3 id="name-triple-wrapping">
<a href="#section-8.6" class="section-number selfRef">8.6. </a><a href="#name-triple-wrapping" class="section-name selfRef">Triple-Wrapping</a>
        </h3>
<p id="section-8.6-1"><span>[<a href="#RFC2634" class="xref">RFC2634</a>]</span> defines "Triple Wrapping" as a means of providing cleartext signatures over signed and encrypted material.
This can be used in combination with the mechanism described in <span>[<a href="#RFC7508" class="xref">RFC7508</a>]</span> to authenticate some headers for transport using S/MIME.<a href="#section-8.6-1" class="pilcrow">Â¶</a></p>
<p id="section-8.6-2">But it does not offer confidentiality protection for the protected headers, and the signer of the outer layer of a triple-wrapped message may not be the originator of the message either.<a href="#section-8.6-2" class="pilcrow">Â¶</a></p>
<p id="section-8.6-3">In practice on today's Internet, DKIM (<span>[<a href="#RFC6736" class="xref">RFC6736</a>]</span> provides a more widely-accepted cryptographic header-verification-for-transport mechanism  than triple-wrapped messages.<a href="#section-8.6-3" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="test-vectors">
<section id="section-9">
      <h2 id="name-test-vectors">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-test-vectors" class="section-name selfRef">Test Vectors</a>
      </h2>
<p id="section-9-1">The subsections below provide example messages that implement the Protected Header scheme.<a href="#section-9-1" class="pilcrow">Â¶</a></p>
<p id="section-9-2">The secret keys and OpenPGP certificates from <span>[<a href="#I-D.draft-bre-openpgp-samples-00" class="xref">I-D.draft-bre-openpgp-samples-00</a>]</span> can be used to decrypt and verify the PGP/MIME messages.<a href="#section-9-2" class="pilcrow">Â¶</a></p>
<p id="section-9-3">The secret keys and X.509 certificates from <span>[<a href="#I-D.draft-dkg-lamps-samples-01" class="xref">I-D.draft-dkg-lamps-samples-01</a>]</span> can be used to decrypt and verify the S/MIME messages.<a href="#section-9-3" class="pilcrow">Â¶</a></p>
<p id="section-9-4">All test vectors are provided in textual source form as <span>[<a href="#RFC5322" class="xref">RFC5322</a>]</span> messages.<a href="#section-9-4" class="pilcrow">Â¶</a></p>
<p id="section-9-5">For easy access to these test vectors, they are also available at <code>imap://bob@protected-headers.cmrg.net/inbox</code> using any password for authentication.
This IMAP account is read-only, and any flags set or cleared on the messages will persist only for the duration of the specific IMAP session.<a href="#section-9-5" class="pilcrow">Â¶</a></p>
<div id="test-vector-pgp-signed-only">
<section id="section-9.1">
        <h3 id="name-signed-pgp-mime-message-wit">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-signed-pgp-mime-message-wit" class="section-name selfRef">Signed PGP/MIME Message with Protected Headers</a>
        </h3>
<p id="section-9.1-1">This shows a clearsigned PGP/MIME message.  Its MIME message structure is:<a href="#section-9.1-1" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.1-2">
<pre>
ââ¬â´multipart/signed
 âââ´text/plain â Cryptographic Payload
 âââ´application/pgp-signature
</pre><a href="#section-9.1-2" class="pilcrow">Â¶</a>
</div>
<p id="section-9.1-3">Note that if this message had been generated without Protected Headers, then an attacker with access to it could modify the Subject without invalidating the signature.
Such an attacker could cause Bob to think that Alice wanted to cancel the contract with BarCorp instead of FooCorp.<a href="#section-9.1-3" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.1-4">
<pre>
Received: from localhost (localhost [127.0.0.1]); Sun, 20 Oct 2019
 09:00:17 -0400 (UTC-04:00)
MIME-Version: 1.0
Content-Type: multipart/signed; boundary="fee";
 protocol="application/pgp-signature"; micalg="pgp-sha512"
From: Alice Lovelace &lt;alice@openpgp.example&gt;
To: Bob Babbage &lt;bob@openpgp.example&gt;
Date: Sun, 20 Oct 2019 09:00:00 -0400
Subject: The FooCorp contract
Message-ID: &lt;pgpmime-signed@protected-headers.example&gt;

--fee
Content-Type: text/plain; charset="us-ascii"; protected-headers="v1"
From: Alice Lovelace &lt;alice@openpgp.example&gt;
To: Bob Babbage &lt;bob@openpgp.example&gt;
Date: Sun, 20 Oct 2019 09:00:00 -0400
Subject: The FooCorp contract
Message-ID: &lt;pgpmime-signed@protected-headers.example&gt;

Bob, we need to cancel this contract.

Please start the necessary processes to make that happen today.

(this is the 'pgpmime-signed' message)

Thanks, Alice
-- 
Alice Lovelace
President
Example Corp

--fee
content-type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----

wnUEARYKAB0FAl2sWlAWIQTrhbtfozp14V6UTmPyMVUMT0fjjgAKCRDyMVUMT0fj
jtl0AQDtIsRWZVCjbB3TISlcyxLpBfwjaXXV0is5+c4Gd2NNgwEAipDF3m5zIt7t
29cFwQusmCqKqKfdJUf6HOUPF5L/zAI=
=+M9u
-----END PGP SIGNATURE-----

--fee--
</pre><a href="#section-9.1-4" class="pilcrow">Â¶</a>
</div>
</section>
</div>
<div id="test-vector-smime-multipart-signed">
<section id="section-9.2">
        <h3 id="name-s-mime-multipart-signed-mes">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-s-mime-multipart-signed-mes" class="section-name selfRef">S/MIME multipart/signed Message with Protected Headers</a>
        </h3>
<p id="section-9.2-1">This shows a signed-only S/MIME message using the <code>multipart/signed</code> style (see Section 3.5.3 of <span>[<a href="#RFC8551" class="xref">RFC8551</a>]</span>).  Its MIME message structure is:<a href="#section-9.2-1" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.2-2">
<pre>
ââ¬â´multipart/signed
 âââ´text/plain â Cryptographic Payload
 âââ´application/pkcs7-signature
</pre><a href="#section-9.2-2" class="pilcrow">Â¶</a>
</div>
<p id="section-9.2-3">Note that if this message had been generated without Protected Headers, then an attacker with access to it could modify the Subject without invalidating the signature.
Such an attacker could cause Bob to think that Alice wanted to cancel the contract with BarCorp instead of FooCorp.<a href="#section-9.2-3" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.2-4">
<pre>
Received: from localhost (localhost [127.0.0.1]); Tue, 26 Nov 2019
 20:03:17 -0400 (UTC-04:00)
MIME-Version: 1.0
Content-Type: multipart/signed; boundary="179";
 protocol="application/pkcs7-signature"; micalg="sha-256"
From: Alice Lovelace &lt;alice@smime.example&gt;
To: Bob Babbage &lt;bob@smime.example&gt;
Date: Tue, 26 Nov 2019 20:03:00 -0400
Subject: The FooCorp contract
Message-ID: &lt;smime-multipart-signed@protected-headers.example&gt;

--179
Content-Type: text/plain; charset="us-ascii"; protected-headers="v1"
From: Alice Lovelace &lt;alice@smime.example&gt;
To: Bob Babbage &lt;bob@smime.example&gt;
Date: Tue, 26 Nov 2019 20:03:00 -0400
Subject: The FooCorp contract
Message-ID: &lt;smime-multipart-signed@protected-headers.example&gt;

Bob, we need to cancel this contract.

Please start the necessary processes to make that happen today.

(this is the 'smime-multipart-signed' message)

Thanks, Alice
-- 
Alice Lovelace
President
Example Corp

--179
Content-Transfer-Encoding: base64
Content-Type: application/pkcs7-signature; name="smime.p7s"

MIIFhQYJKoZIhvcNAQcCoIIFdjCCBXICAQExDTALBglghkgBZQMEAgEwCwYJKoZI
hvcNAQcBoIIDcjCCA24wggJWoAMCAQICFGeCtFlzUkvB9HFHGWrw/RGKqkwLMA0G
CSqGSIb3DQEBDQUAMC0xKzApBgNVBAMTIlNhbXBsZSBMQU1QUyBDZXJ0aWZpY2F0
ZSBBdXRob3JpdHkwIBcNMTkxMTIwMDY1NDE4WhgPMjA1MjA5MjcwNjU0MThaMBkx
FzAVBgNVBAMTDkFsaWNlIExvdmVsYWNlMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
MIIBCgKCAQEAw+6t+WXRtiQM8yRjWQ2fbFewCodIZUX6BY02TeZuEXoEAGEsmoON
6LlotcUTdGr39FE2K8IytOKkXVexswgAqBCqv8YjVDrI3yV82wrm5Td32TDlw7IS
igak4ZSu+UowPQs8YO3oxqImP4onZNHvdZ3it9EggmgUyZX0dmQ6z5O9yDzHpLMa
E2rXxfYcPXQwPvx4tcqbTf2htEP7PYnBa8a+sts0F7I7kD5ozGYI9dGg/XGs1lYE
WAoH5YZgNFdbkJdcKG2FPAwFcVZ/hoGm6soxkDKMrYSCtBp+fqH8MV11DP821PoO
vtSEnaF8UURbaths2yKpAB2WUJvgW5xa4QIDAQABo4GXMIGUMAwGA1UdEwEB/wQC
MAAwHgYDVR0RBBcwFYETYWxpY2VAc21pbWUuZXhhbXBsZTATBgNVHSUEDDAKBggr
BgEFBQcDBDAPBgNVHQ8BAf8EBQMDB6AAMB0GA1UdDgQWBBSsLlRapP1VGK8u6GZE
ONEl0dcAeTAfBgNVHSMEGDAWgBS3Uk1zwIg9ssN6WgzzlPf3gKJ32zANBgkqhkiG
9w0BAQ0FAAOCAQEAe+qOGM+8q1UhXKV6i63BrXSOKvd2iglxAggszUC6eMnrIem6
6mmRzSbcGHCeU6m1MpvYSe9IiROIxjTfsgGUdZbbXtBxSmCASjOBCbphvvtoam1G
i8+LZdOgR2kDwr//TYjWO6vUfXPwerNWMx4cKpFobdmvgLYCeAZKRvoPjJmTEFfw
KO0cCxSifTpTFiwZhFxXKSCTdB6T2rE9JxJfzJqLUrvvEZwpQIt8hX8kym/vKw+1
cbsl3rag2enVP/f4qg/0mUuzkCI8sLXd+N5gAs9wdUZRcTB0gOnUAH9m7RrpqkdC
ogKdypGEQHj6GiamJAe2WndOp4BZdBtBRzjfuzGCAdkwggHVAgEBMEUwLTErMCkG
A1UEAxMiU2FtcGxlIExBTVBTIENlcnRpZmljYXRlIEF1dGhvcml0eQIUZ4K0WXNS
S8H0cUcZavD9EYqqTAswCwYJYIZIAWUDBAIBoGkwGAYJKoZIhvcNAQkDMQsGCSqG
SIb3DQEHATAcBgkqhkiG9w0BCQUxDxcNMTkxMTI3MDAwMzAwWjAvBgkqhkiG9w0B
CQQxIgQgGeoQw8WDmjB606EKGR5n1oMuV7Te1VjfA2oB2ebW390wDQYJKoZIhvcN
AQEBBQAEggEABblYEWSnYyzL3jTS3AoPr93YKksIZr5q/b8Y5/1rMxdYxPm+iReO
RHRgpbFQeiqZXzRXtMohfoIkh7RmdQoSV4OpwiUmNU+f0ZEAu8cMVJM6gdyUD+1D
JwDNr+YNLV/1UUGhqx0FExOa/4O92KYBD4eRQw4KDWrkfh9dlSj0Bsl4thrZYGLz
e7ut3FN5TBruZfmqMy50xZ9yUW91YyQUBLiIcuF185y5ZW/aQCxBKBbrNNGXLJbo
8yKFJqSPiWZvwUmVQvfgL182hg823OJTtP4VImcUakTF0+k+BM//qqKXYrlX/tZn
QzG+4ZH/XM1vgHl7ShjHS6TSOHz2ODqD6Q==

--179--
</pre><a href="#section-9.2-4" class="pilcrow">Â¶</a>
</div>
</section>
</div>
<div id="test-vector-smime-onepart-signed">
<section id="section-9.3">
        <h3 id="name-s-mime-application-pkcs7-mi">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-s-mime-application-pkcs7-mi" class="section-name selfRef">S/MIME application/pkcs7-mime SignedData Message with Protected Headers</a>
        </h3>
<p id="section-9.3-1">This shows a signed-only S/MIME message using the <code>multipart/pkcs7-mime</code> style (see Section 3.5.2 of <span>[<a href="#RFC8551" class="xref">RFC8551</a>]</span>).  Its MIME message structure is:<a href="#section-9.3-1" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.3-2">
<pre>
âââ´application/pkcs7-mime smime-type="signed-data"
 â© (unwraps to)
 âââ´text/plain â Cryptographic Payload
</pre><a href="#section-9.3-2" class="pilcrow">Â¶</a>
</div>
<p id="section-9.3-3">Note that if this message had been generated without Protected Headers, then an attacker with access to it could modify the Subject without invalidating the signature.
Such an attacker could cause Bob to think that Alice wanted to cancel the contract with BarCorp instead of FooCorp.<a href="#section-9.3-3" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.3-4">
<pre>
Received: from localhost (localhost [127.0.0.1]); Tue, 26 Nov 2019
 20:06:17 -0400 (UTC-04:00)
Content-Transfer-Encoding: base64
Content-Type: application/pkcs7-mime; name="smime.p7m";
 smime-type="signed-data"
MIME-Version: 1.0
From: Alice Lovelace &lt;alice@smime.example&gt;
To: Bob Babbage &lt;bob@smime.example&gt;
Date: Tue, 26 Nov 2019 20:06:00 -0400
Subject: The FooCorp contract
Message-ID: &lt;smime-onepart-signed@protected-headers.example&gt;

MIIHhQYJKoZIhvcNAQcCoIIHdjCCB3ICAQExDTALBglghkgBZQMEAgEwggIJBgkq
hkiG9w0BBwGgggH6BIIB9kNvbnRlbnQtVHlwZTogdGV4dC9wbGFpbjsgY2hhcnNl
dD0idXMtYXNjaWkiOyBwcm90ZWN0ZWQtaGVhZGVycz0idjEiDQpGcm9tOiBBbGlj
ZSBMb3ZlbGFjZSA8YWxpY2VAc21pbWUuZXhhbXBsZT4NClRvOiBCb2IgQmFiYmFn
ZSA8Ym9iQHNtaW1lLmV4YW1wbGU+DQpEYXRlOiBUdWUsIDI2IE5vdiAyMDE5IDIw
OjA2OjAwIC0wNDAwDQpTdWJqZWN0OiBUaGUgRm9vQ29ycCBjb250cmFjdA0KTWVz
c2FnZS1JRDogPHNtaW1lLW9uZXBhcnQtc2lnbmVkQHByb3RlY3RlZC1oZWFkZXJz
LmV4YW1wbGU+DQoNCkJvYiwgd2UgbmVlZCB0byBjYW5jZWwgdGhpcyBjb250cmFj
dC4NCg0KUGxlYXNlIHN0YXJ0IHRoZSBuZWNlc3NhcnkgcHJvY2Vzc2VzIHRvIG1h
a2UgdGhhdCBoYXBwZW4gdG9kYXkuDQoNCih0aGlzIGlzIHRoZSAnc21pbWUtb25l
cGFydC1zaWduZWQnIG1lc3NhZ2UpDQoNClRoYW5rcywgQWxpY2UNCi0tIA0KQWxp
Y2UgTG92ZWxhY2UNClByZXNpZGVudA0KRXhhbXBsZSBDb3JwDQqgggNyMIIDbjCC
AlagAwIBAgIUZ4K0WXNSS8H0cUcZavD9EYqqTAswDQYJKoZIhvcNAQENBQAwLTEr
MCkGA1UEAxMiU2FtcGxlIExBTVBTIENlcnRpZmljYXRlIEF1dGhvcml0eTAgFw0x
OTExMjAwNjU0MThaGA8yMDUyMDkyNzA2NTQxOFowGTEXMBUGA1UEAxMOQWxpY2Ug
TG92ZWxhY2UwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDD7q35ZdG2
JAzzJGNZDZ9sV7AKh0hlRfoFjTZN5m4RegQAYSyag43ouWi1xRN0avf0UTYrwjK0
4qRdV7GzCACoEKq/xiNUOsjfJXzbCublN3fZMOXDshKKBqThlK75SjA9Czxg7ejG
oiY/iidk0e91neK30SCCaBTJlfR2ZDrPk73IPMeksxoTatfF9hw9dDA+/Hi1yptN
/aG0Q/s9icFrxr6y2zQXsjuQPmjMZgj10aD9cazWVgRYCgflhmA0V1uQl1wobYU8
DAVxVn+GgabqyjGQMoythIK0Gn5+ofwxXXUM/zbU+g6+1ISdoXxRRFtq2GzbIqkA
HZZQm+BbnFrhAgMBAAGjgZcwgZQwDAYDVR0TAQH/BAIwADAeBgNVHREEFzAVgRNh
bGljZUBzbWltZS5leGFtcGxlMBMGA1UdJQQMMAoGCCsGAQUFBwMEMA8GA1UdDwEB
/wQFAwMHoAAwHQYDVR0OBBYEFKwuVFqk/VUYry7oZkQ40SXR1wB5MB8GA1UdIwQY
MBaAFLdSTXPAiD2yw3paDPOU9/eAonfbMA0GCSqGSIb3DQEBDQUAA4IBAQB76o4Y
z7yrVSFcpXqLrcGtdI4q93aKCXECCCzNQLp4yesh6brqaZHNJtwYcJ5TqbUym9hJ
70iJE4jGNN+yAZR1ltte0HFKYIBKM4EJumG++2hqbUaLz4tl06BHaQPCv/9NiNY7
q9R9c/B6s1YzHhwqkWht2a+AtgJ4BkpG+g+MmZMQV/Ao7RwLFKJ9OlMWLBmEXFcp
IJN0HpPasT0nEl/MmotSu+8RnClAi3yFfyTKb+8rD7VxuyXetqDZ6dU/9/iqD/SZ
S7OQIjywtd343mACz3B1RlFxMHSA6dQAf2btGumqR0KiAp3KkYRAePoaJqYkB7Za
d06ngFl0G0FHON+7MYIB2TCCAdUCAQEwRTAtMSswKQYDVQQDEyJTYW1wbGUgTEFN
UFMgQ2VydGlmaWNhdGUgQXV0aG9yaXR5AhRngrRZc1JLwfRxRxlq8P0RiqpMCzAL
BglghkgBZQMEAgGgaTAYBgkqhkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3
DQEJBTEPFw0xOTExMjcwMDA2MDBaMC8GCSqGSIb3DQEJBDEiBCAKDM98nuDl98sK
i4SDvP2xlxr2SdV/xNVYs6SeGCBRuTANBgkqhkiG9w0BAQEFAASCAQAcryWkSIbG
rrc/aDF1Z4KRnoRpr+fOutQSLV7k0Tgezt+X/kJCIiuLvjUxLrTux1yUWCKUPb6T
KLYASPJpwDXrNzqmGs1pJmWHTZwUhbFVXt16FaQZkDSATtvhQU39Rsot2j1pP/UV
J7+5FPQwNc4dt7MFW7jU4TBHo2VrzjZ2K8ioELPxsixOCAp3ytkhf1Umw6bC5M/u
oWjsa6xzAl4fw5+pxZw0JdbrYn5kmPiekSsYy2/+yOwzrtIYtHW5dY7DoWWXDXtD
cmCGHkO8qry+MnMy3PwvXiX0warQo1fnhXB5tlk2K9YdiDcOtnAshEBXAudnxlPK
JGzeJVUfbfM0
</pre><a href="#section-9.3-4" class="pilcrow">Â¶</a>
</div>
<p id="section-9.3-5">Unwrapping the PKCS7 SignedData yields the following internal message:<a href="#section-9.3-5" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.3-6">
<pre>
Content-Type: text/plain; charset="us-ascii"; protected-headers="v1"
From: Alice Lovelace &lt;alice@smime.example&gt;
To: Bob Babbage &lt;bob@smime.example&gt;
Date: Tue, 26 Nov 2019 20:06:00 -0400
Subject: The FooCorp contract
Message-ID: &lt;smime-onepart-signed@protected-headers.example&gt;

Bob, we need to cancel this contract.

Please start the necessary processes to make that happen today.

(this is the 'smime-onepart-signed' message)

Thanks, Alice
-- 
Alice Lovelace
President
Example Corp
</pre><a href="#section-9.3-6" class="pilcrow">Â¶</a>
</div>
</section>
</div>
<div id="pgp-encryptedsigned">
<section id="section-9.4">
        <h3 id="name-signed-and-encrypted-pgp-mi">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-signed-and-encrypted-pgp-mi" class="section-name selfRef">Signed and Encrypted PGP/MIME Message with Protected Headers</a>
        </h3>
<p id="section-9.4-1">This shows a simple encrypted PGP/MIME message with protected headers.
The encryption also contains a signature in the OpenPGP Message structure.
Its MIME message structure is:<a href="#section-9.4-1" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.4-2">
<pre>
ââ¬â´multipart/encrypted
 âââ´application/pgp-encrypted
 âââ´application/octet-stream
   â§ (decrypts to)
   âââ´text/plain â Cryptographic Payload
</pre><a href="#section-9.4-2" class="pilcrow">Â¶</a>
</div>
<p id="section-9.4-3">The <code>Subject:</code> header is successfully obscured.<a href="#section-9.4-3" class="pilcrow">Â¶</a></p>
<p id="section-9.4-4">Note that if this message had been generated without Protected Headers, then an attacker with access to it could have read the Subject.
Such an attacker would know details about Alice and Bob's business that they wanted to keep confidential.<a href="#section-9.4-4" class="pilcrow">Â¶</a></p>
<p id="section-9.4-5">The protected headers also protect the authenticity of subject line as well.<a href="#section-9.4-5" class="pilcrow">Â¶</a></p>
<p id="section-9.4-6">The session key for this message's Cryptographic Layer is an AES-256 key with value <code>8df4b2d27d5637138ac6de46415661be0bd01ed12ecf8c1db22a33cf3ede82f2</code> (in hex).<a href="#section-9.4-6" class="pilcrow">Â¶</a></p>
<p id="section-9.4-7">If Bob's MUA is capable of interpreting these protected headers, it should render the <code>Subject:</code> of this message as <code>BarCorp contract signed, let's go!</code>.<a href="#section-9.4-7" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.4-8">
<pre>
Received: from localhost (localhost [127.0.0.1]); Mon, 21 Oct 2019
 07:09:28 -0700 (UTC-07:00)
MIME-Version: 1.0
Content-Type: multipart/encrypted; boundary="ca4";
 protocol="application/pgp-encrypted"
From: Alice Lovelace &lt;alice@openpgp.example&gt;
To: Bob Babbage &lt;bob@openpgp.example&gt;
Date: Mon, 21 Oct 2019 07:09:00 -0700
Message-ID: &lt;pgpmime-sign+enc@protected-headers.example&gt;
Subject: ...

--ca4
content-type: application/pgp-encrypted

Version: 1

--ca4
content-type: application/octet-stream

-----BEGIN PGP MESSAGE-----

wV4DR2b2udXyHrYSAQdAH1KRyK7qZzNpI7TVprCPo/aOTW9R5hBKcTkKES1Fo3Yw
mtDplfGFN2JMzQ1OVbe2gbcyhrYfs+7Fd4eoZ0geE2cUYn5M951I0se1W+MdMZ/j
wcDMA3wvqk35PDeyAQv/ePyXTBTU98wzM5LcwhWZcCmxCtTgqHmjJmymQKQqJuCA
flrZPG6V6RyidGwmJYf2uDdmlhAHxFbYAalkI+/V3SnO5OSejKvspUtuRnBOW8Ps
luWQ6ANww/o4y/2/SkIodRmwaIBbs/4CaDQivSeBueHnPu0EqxTBNI47dQx9mkdB
Z5PsucuUVSq2SmdIrCM9aLyoUF60NVhdp3mYQaVH12dX19wjZtclTR74t66I/Wsc
FHONiGii/ioJS9LGllnaRiS7carLbtw0s2yJJZPZeRozMPi0o8zgne77wdoF+NyU
LkGtqXvLbPPA9SDGTHgkJ6H+wUhh0OGWebYwpN3F6R7Su1OlYRkQ8kokOmJmZokg
qhDueENW2RsZIg06sydGFaRY5BoGe2EBkcXUVBWqYEMH3Zxz/kAEylVY5sZOqcae
PAlvTF6Y4nNVGVylUvcuJ4DsQbi2AueD7Tl28ha1xJTkzlHlt4UyU878eUfdVLOM
FF+hwbxlo6RBT4uurMee0sHrAUDHma9Kx6XrALINbIl5lfMKKXnKhfQYpfbYbz8J
jVFz0zCxMqmdHZLe/G9mxoksvXrbFf8b5DHfDYGCRvbj+CzERo6KCceaVSpKVGL8
xiwHrjg+vwfn9EG9j+vp3jB39wES/IZZThSnf0JvJA4ePVnfbxcxMqgg/S2isyHf
NAp89ZlX5mznom9efKUoojodNNFsMIt+YNaHEtnjZl+BXstGkXXOiurEt5HuEyRz
+cyjwpnQChz6PuY0Ehsj42mMyGa3167H2kIqtKtxIfl5/qm1df1mlEc7SpmU+uHV
58D22bl/Ukr8vmFu09z7V2U7zXz+FtohuVpeTr3l0UVEFEGIQT4JUqxiavZqMsZE
6DKj6X+fzXdxMyrDd/lD2ikZdllqTuvsuuiFW1OtEbuIKRoYUl6u8t44/KYoHCQK
BWXhyh7lPpfOGkemA3KY0D7yG4caTWmN5GSskGyKqQjiCxa0jKqT1qfNBTxBh4/6
8Ijf/cmlSNjC6ghzuwtNG7wr0mSC0pjQsl7b16Im7FOmP67pputqcFrZOIzVbrS8
vVe0+1X3/5VnmYHCilaI41ln3wGRTlC/j4lIoGNGlJJ9LeOz0DlfIwfIy9aVUDXo
48awW8hYu4Ck42GIJQP9HsQ9fbFzHmyUHhS4h+xGXHTbPFqiPyzsoAT8KDTLMj4y
CKWaqmqXMkuaD7hMc42xW8ziq2ZXZCv1ajDclbkg5rx9R6n4dZL6Cajt7wK2mMHt
giNkCqLU2LuPhw/R9comDDJPFmb6WB/PBrnTrUwrFy4/6du5uK09kwLIUu82UVhm
5xHVqybxIkHGeVNXqRSe3M3w8ERbkXqNp3s7BrGGb1bYdlrPf8h1PTeWi9vfXUdn
wFHr0g3xjeQ9orvJZl5jPuk5NryF2J/iNEh7+sE=
=NT2A
-----END PGP MESSAGE-----

--ca4--
</pre><a href="#section-9.4-8" class="pilcrow">Â¶</a>
</div>
<p id="section-9.4-9">Unwrapping the Cryptographic Layer yields the following content:<a href="#section-9.4-9" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.4-10">
<pre>
From: Alice Lovelace &lt;alice@openpgp.example&gt;
To: Bob Babbage &lt;bob@openpgp.example&gt;
Date: Mon, 21 Oct 2019 07:09:00 -0700
Subject: BarCorp contract signed, let's go!
Content-Type: text/plain; charset="us-ascii"; protected-headers="v1"
Message-ID: &lt;pgpmime-sign+enc@protected-headers.example&gt;

Hi Bob!

I just signed the contract with BarCorp and they've set us up with
an account on their system for testing.

The account information is:

        Site: https://barcorp.example/
    Username: examplecorptest
    Password: correct-horse-battery-staple

Please get the account set up and apply the test harness.

Let me know when you've got some results.

(this is the 'pgpmime-sign+enc' message)

Thanks, Alice
-- 
Alice Lovelace
President
Example Corp
</pre><a href="#section-9.4-10" class="pilcrow">Â¶</a>
</div>
</section>
</div>
<div id="smime-sign-enc">
<section id="section-9.5">
        <h3 id="name-signed-and-encrypted-s-mime">
<a href="#section-9.5" class="section-number selfRef">9.5. </a><a href="#name-signed-and-encrypted-s-mime" class="section-name selfRef">Signed and Encrypted S/MIME Message with Protected Headers</a>
        </h3>
<p id="section-9.5-1">This shows a simple signed and encrypted S/MIME message with protected headers.
Its MIME message structure is:<a href="#section-9.5-1" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.5-2">
<pre>
âââ´application/pkcs7-mime smime-type="enveloped-data"
 â§ (decrypts to)
 âââ´application/pkcs7-mime smime-type="signed-data"
  â© (unwraps to)
  âââ´text/plain â Cryptographic Payload
</pre><a href="#section-9.5-2" class="pilcrow">Â¶</a>
</div>
<p id="section-9.5-3">The <code>Subject:</code> header is successfully obscured.<a href="#section-9.5-3" class="pilcrow">Â¶</a></p>
<p id="section-9.5-4">Note that if this message had been generated without Protected Headers, then an attacker with access to it could have read the Subject.
Such an attacker would know details about Alice and Bob's business that they wanted to keep confidential.<a href="#section-9.5-4" class="pilcrow">Â¶</a></p>
<p id="section-9.5-5">The protected headers also protect the authenticity of subject line as well.<a href="#section-9.5-5" class="pilcrow">Â¶</a></p>
<p id="section-9.5-6">The session key for this message's Cryptographic Layer is an AES-256 key with value <code>12e2551896f77e24ce080153cda27dddd789d399bdd87757e65655d956f5f0b7</code> (in hex).<a href="#section-9.5-6" class="pilcrow">Â¶</a></p>
<p id="section-9.5-7">If Bob's MUA is capable of interpreting these protected headers, it should render the <code>Subject:</code> of this message as <code>BarCorp contract signed, let's go!</code>.<a href="#section-9.5-7" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.5-8">
<pre>
Received: from localhost (localhost [127.0.0.1]); Wed, 27 Nov 2019
 01:15:28 -0700 (UTC-07:00)
MIME-Version: 1.0
Content-Transfer-Encoding: base64
Content-Type: application/pkcs7-mime; name="smime.p7m";
 smime-type="enveloped-data"
From: Alice Lovelace &lt;alice@smime.example&gt;
To: Bob Babbage &lt;bob@smime.example&gt;
Date: Wed, 27 Nov 2019 01:15:00 -0700
Message-ID: &lt;smime-sign+enc@protected-headers.example&gt;
Subject: ...

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
</pre><a href="#section-9.5-8" class="pilcrow">Â¶</a>
</div>
<p id="section-9.5-9">Unwrapping the outer Cryptographic Layer of this message yields the following MIME part (with its own Cryptographic Layer):<a href="#section-9.5-9" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.5-10">
<pre>
Content-Transfer-Encoding: base64
Content-Type: application/pkcs7-mime; name="smime.p7m";
 smime-type="signed-data"

MIIIkwYJKoZIhvcNAQcCoIIIhDCCCIACAQExDTALBglghkgBZQMEAgEwggMXBgkq
hkiG9w0BBwGgggMIBIIDBEZyb206IEFsaWNlIExvdmVsYWNlIDxhbGljZUBzbWlt
ZS5leGFtcGxlPg0KVG86IEJvYiBCYWJiYWdlIDxib2JAc21pbWUuZXhhbXBsZT4N
CkRhdGU6IFdlZCwgMjcgTm92IDIwMTkgMDE6MTU6MDAgLTA3MDANClN1YmplY3Q6
IEJhckNvcnAgY29udHJhY3Qgc2lnbmVkLCBsZXQncyBnbyENCkNvbnRlbnQtVHlw
ZTogdGV4dC9wbGFpbjsgY2hhcnNldD0idXMtYXNjaWkiOyBwcm90ZWN0ZWQtaGVh
ZGVycz0idjEiDQpNZXNzYWdlLUlEOiA8c21pbWUtc2lnbitlbmNAcHJvdGVjdGVk
LWhlYWRlcnMuZXhhbXBsZT4NCg0KSGkgQm9iIQ0KDQpJIGp1c3Qgc2lnbmVkIHRo
ZSBjb250cmFjdCB3aXRoIEJhckNvcnAgYW5kIHRoZXkndmUgc2V0IHVzIHVwIHdp
dGgNCmFuIGFjY291bnQgb24gdGhlaXIgc3lzdGVtIGZvciB0ZXN0aW5nLg0KDQpU
aGUgYWNjb3VudCBpbmZvcm1hdGlvbiBpczoNCg0KICAgICAgICBTaXRlOiBodHRw
czovL2JhcmNvcnAuZXhhbXBsZS8NCiAgICBVc2VybmFtZTogZXhhbXBsZWNvcnB0
ZXN0DQogICAgUGFzc3dvcmQ6IGNvcnJlY3QtaG9yc2UtYmF0dGVyeS1zdGFwbGUN
Cg0KUGxlYXNlIGdldCB0aGUgYWNjb3VudCBzZXQgdXAgYW5kIGFwcGx5IHRoZSB0
ZXN0IGhhcm5lc3MuDQoNCkxldCBtZSBrbm93IHdoZW4geW91J3ZlIGdvdCBzb21l
IHJlc3VsdHMuDQoNCih0aGlzIGlzIHRoZSAnc21pbWUtc2lnbitlbmMnIG1lc3Nh
Z2UpDQoNClRoYW5rcywgQWxpY2UNCi0tIA0KQWxpY2UgTG92ZWxhY2UNClByZXNp
ZGVudA0KRXhhbXBsZSBDb3JwDQqgggNyMIIDbjCCAlagAwIBAgIUZ4K0WXNSS8H0
cUcZavD9EYqqTAswDQYJKoZIhvcNAQENBQAwLTErMCkGA1UEAxMiU2FtcGxlIExB
TVBTIENlcnRpZmljYXRlIEF1dGhvcml0eTAgFw0xOTExMjAwNjU0MThaGA8yMDUy
MDkyNzA2NTQxOFowGTEXMBUGA1UEAxMOQWxpY2UgTG92ZWxhY2UwggEiMA0GCSqG
SIb3DQEBAQUAA4IBDwAwggEKAoIBAQDD7q35ZdG2JAzzJGNZDZ9sV7AKh0hlRfoF
jTZN5m4RegQAYSyag43ouWi1xRN0avf0UTYrwjK04qRdV7GzCACoEKq/xiNUOsjf
JXzbCublN3fZMOXDshKKBqThlK75SjA9Czxg7ejGoiY/iidk0e91neK30SCCaBTJ
lfR2ZDrPk73IPMeksxoTatfF9hw9dDA+/Hi1yptN/aG0Q/s9icFrxr6y2zQXsjuQ
PmjMZgj10aD9cazWVgRYCgflhmA0V1uQl1wobYU8DAVxVn+GgabqyjGQMoythIK0
Gn5+ofwxXXUM/zbU+g6+1ISdoXxRRFtq2GzbIqkAHZZQm+BbnFrhAgMBAAGjgZcw
gZQwDAYDVR0TAQH/BAIwADAeBgNVHREEFzAVgRNhbGljZUBzbWltZS5leGFtcGxl
MBMGA1UdJQQMMAoGCCsGAQUFBwMEMA8GA1UdDwEB/wQFAwMHoAAwHQYDVR0OBBYE
FKwuVFqk/VUYry7oZkQ40SXR1wB5MB8GA1UdIwQYMBaAFLdSTXPAiD2yw3paDPOU
9/eAonfbMA0GCSqGSIb3DQEBDQUAA4IBAQB76o4Yz7yrVSFcpXqLrcGtdI4q93aK
CXECCCzNQLp4yesh6brqaZHNJtwYcJ5TqbUym9hJ70iJE4jGNN+yAZR1ltte0HFK
YIBKM4EJumG++2hqbUaLz4tl06BHaQPCv/9NiNY7q9R9c/B6s1YzHhwqkWht2a+A
tgJ4BkpG+g+MmZMQV/Ao7RwLFKJ9OlMWLBmEXFcpIJN0HpPasT0nEl/MmotSu+8R
nClAi3yFfyTKb+8rD7VxuyXetqDZ6dU/9/iqD/SZS7OQIjywtd343mACz3B1RlFx
MHSA6dQAf2btGumqR0KiAp3KkYRAePoaJqYkB7Zad06ngFl0G0FHON+7MYIB2TCC
AdUCAQEwRTAtMSswKQYDVQQDEyJTYW1wbGUgTEFNUFMgQ2VydGlmaWNhdGUgQXV0
aG9yaXR5AhRngrRZc1JLwfRxRxlq8P0RiqpMCzALBglghkgBZQMEAgGgaTAYBgkq
hkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3DQEJBTEPFw0xOTExMjcwODE1
MDBaMC8GCSqGSIb3DQEJBDEiBCC5A+mnkPofr5VZKP+y+n5m21txluYikOynnkYb
tCaH+jANBgkqhkiG9w0BAQEFAASCAQAgfVYYJu+aUcWjlFOT//l8p4LOBcB3WBEa
x7msyZcptuaJtWaLedzgwi+nGHfhl/02wzTvCjx+LTHGouU83ILpEdDAxEDqzNgd
gEJF7wswM7N31PhjpQyH+HbrJTH0tF+/xREgCG14yRs5yAXOkvkFDmd55svukInx
eSb97LhQHQGpJLh5FBstWWBKQitNn8eB3g6h+c43zp4nBXoS2aFiUvYdWugw4QHW
7T7dcSX5gAEHt/dm2q4oH0g9YtHmRpOmqdNQSuMkR7vomEkOkv2XWmlf3znKWe8Q
Pd1ihgrhOASyT1oBmnpEVwvsSkhqoxkGcrrSefUZy5h0wKfNSqRW
</pre><a href="#section-9.5-10" class="pilcrow">Â¶</a>
</div>
<p id="section-9.5-11">Unwrapping the inner Cryptographic Layer yields the Cryptographic Payload:<a href="#section-9.5-11" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.5-12">
<pre>
From: Alice Lovelace &lt;alice@smime.example&gt;
To: Bob Babbage &lt;bob@smime.example&gt;
Date: Wed, 27 Nov 2019 01:15:00 -0700
Subject: BarCorp contract signed, let's go!
Content-Type: text/plain; charset="us-ascii"; protected-headers="v1"
Message-ID: &lt;smime-sign+enc@protected-headers.example&gt;

Hi Bob!

I just signed the contract with BarCorp and they've set us up with
an account on their system for testing.

The account information is:

        Site: https://barcorp.example/
    Username: examplecorptest
    Password: correct-horse-battery-staple

Please get the account set up and apply the test harness.

Let me know when you've got some results.

(this is the 'smime-sign+enc' message)

Thanks, Alice
-- 
Alice Lovelace
President
Example Corp
</pre><a href="#section-9.5-12" class="pilcrow">Â¶</a>
</div>
</section>
</div>
<div id="signed-and-encrypted-pgpmime-message-with-protected-headers-and-legacy-display-part">
<section id="section-9.6">
        <h3 id="name-signed-and-encrypted-pgp-mim">
<a href="#section-9.6" class="section-number selfRef">9.6. </a><a href="#name-signed-and-encrypted-pgp-mim" class="section-name selfRef">Signed and Encrypted PGP/MIME Message with Protected Headers and Legacy Display Part</a>
        </h3>
<p id="section-9.6-1">If Alice's MUA wasn't sure whether Bob's MUA would know to render the obscured <code>Subject:</code> header correctly, it might include a legacy display part in the cryptographic payload.<a href="#section-9.6-1" class="pilcrow">Â¶</a></p>
<p id="section-9.6-2">This PGP/MIME message is structured in the following way:<a href="#section-9.6-2" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.6-3">
<pre>
ââ¬â´multipart/encrypted
 âââ´application/pgp-encrypted
 âââ´application/octet-stream
   â§ (decrypts to)
   ââ¬â´multipart/mixed â Cryptographic Payload
    âââ´text/plain â Legacy Display Part
    âââ´text/plain
</pre><a href="#section-9.6-3" class="pilcrow">Â¶</a>
</div>
<p id="section-9.6-4">The example below shows the same message as <a href="#pgp-encryptedsigned" class="xref">Section 9.4</a>.<a href="#section-9.6-4" class="pilcrow">Â¶</a></p>
<p id="section-9.6-5">If Bob's MUA is capable of handling protected headers, the two messages should render in the same way as the message in <a href="#pgp-encryptedsigned" class="xref">Section 9.4</a>, because it will know to omit the Legacy Display part as documented in <a href="#no-render-legacy-display" class="xref">Section 5.2</a>.<a href="#section-9.6-5" class="pilcrow">Â¶</a></p>
<p id="section-9.6-6">But if Bob's MUA is capable of decryption but is unaware of protected headers, it will likely render the Legacy Display part for him so that he can at least see the originally-intended <code>Subject:</code> line.<a href="#section-9.6-6" class="pilcrow">Â¶</a></p>
<p id="section-9.6-7">For this message, the session key is an AES-256 key with value <code>95a71b0e344cce43a4dd52c5fd01deec5118290bfd0792a8a733c653a12d223e</code> (in hex).<a href="#section-9.6-7" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.6-8">
<pre>
Received: from localhost (localhost [127.0.0.1]); Mon, 21 Oct 2019
 07:18:28 -0700 (UTC-07:00)
MIME-Version: 1.0
Content-Type: multipart/encrypted; boundary="924";
 protocol="application/pgp-encrypted"
From: Alice Lovelace &lt;alice@openpgp.example&gt;
To: Bob Babbage &lt;bob@openpgp.example&gt;
Date: Mon, 21 Oct 2019 07:18:00 -0700
Message-ID: &lt;pgpmime-sign+enc+legacy-disp@protected-headers.example&gt;
Subject: ...

--924
content-type: application/pgp-encrypted

Version: 1

--924
content-type: application/octet-stream

-----BEGIN PGP MESSAGE-----

wV4DR2b2udXyHrYSAQdAXX1u0LNgj2o6biKu64RULx3PY/gcetRoyNOWNoXG8zow
LF4DhnBs27vQkh1BIU4KmJFOwwjLwuRvS/J4NvCqqcEYwiPdhp5q5ftn7wrq2W5s
wcDMA3wvqk35PDeyAQv+M8gxGXm9ecpcotEX+9OM9EY5N8V7FmZ6ydRpBXgWvCpB
Nr6qk9OsOvIlhiN1IJbl73mEb5LdMj3wtRwGP3DB4AoPabIMXh/hCcNAhaWusVH0
AK33oDjH3rhntORMveOqq4QhRzUGR1ctYWRNBXgKC/n3Bmp7mHAzfb4RyBGXDXsI
TCXAb2qDnk06vTCVaHJ/ggBInSb12iYPkhDtoxbNFOP7U97lSVgSoDels6TRDfpb
9K667gVyhkTnBvys+EqWbe7Bz5MJqxn9NQxh7HTdY2kXSKGGe1DUrAzLKRpT78fQ
O02DLHR9EUh30hYQEPnuKAdYHJquXB5UiObJpQ5UDEt3MsvObUD7k21MQk5K6iyh
1wcxtXm/kPqQ3eOpVm8iaRve/VrpZEgA0/9PcvQJ0VCWQ/fZEBVmh3ojIoZF9WJE
jB3FwPS2lVLJhaZFTGU7xOKsz/x0K2M8meAsa7nx0TaetmieRA2L+wBaHhoUz77L
9ihYlIBPNvkb49jnF3ft0sI2AYM9DWi3Ki7uWnw/Ue7jiu8dseBTvuxXU7XYPS+l
k3nqqtCKjDziq+ojjw3+ahsfNNIrcFTizjZqGG5AK+dwjiTY3T4fJ4b07513+2uj
/tJE7p6IuuxlE+qlpI1PrX7JFHpihbxsWnwT2RBgo+sdeVko3HbyWtfLnfwI+eNo
njB1DvhWg4C61ilnbRU+osbnZSoSqJSdHCHqn06YfL75sdHrhDiXzV5+LPiaqHoD
S1wOLknIFD91GO3PXaae3ENJgE9CFz4v0jNw2+kASuH80DwnKiMQrmG78rY4u652
HcO2p0ZQAX2QeK0UidSjQQaKRtz5sys6QUbS46lgMSnHljQun4g8hlvoDH/7Zz4a
kMgbZj7TRPU2EaApRX9JZub7nD9ODJkqtLJef9ncmI3QwBjClXy1sL/olUhUjFAZ
VNbbInqEba+LLio4HUozBAjrVVWOrAt776lBSR4n72DdMjMKZ5osxPLtAVce9KeV
s1cdKffbF4VDoe97eRq5ua4KJW/c+8WGW1u/vzPA7Zj6rR+gaWKqw4rnlys4+M2b
LHugg+cF0k/sEfrmEuHyefYvms9Ht2icbiSTbqN+ApXuC9QtNRb/XnEw5lCH+dBO
EYm/W0qSDXMcvoZaZ379uFkXqiECLF11iA3K89BV1VXFXgatnLHbNBdpm+mmJlz+
MY0NTCASFv0Bri4Y7j6kSOZMnfol+84j/nVCpBej8QrXqbpL+/6xrBURcA1Sb+Xu
XRF1Veybr1bj1Tcp7aDLzZtQ8pk+8zyxy9dOePPcBDZlnDXCALf9eXJ/HX/6EYNT
3Oh+kmF7UxghUGUnyTfBMhnBD5oNi+OGVyDWyRv5jfYc5FWwXOmcRjigPlofLmo9
7eLOmYMmp0L2DdNiVer/Dl5g8HRSVaRceHJVUrNM+M2xzCkdrTHJSh7MBU0TwUd+
RXYQgfPu8xbeouLnSTVC5Kuul3VA8Q1/Y6KcjQTgjNvrOzjHTxjKek5fokNxvFQj
1fkAIM9w2k0=
=+l7i
-----END PGP MESSAGE-----

--924--
</pre><a href="#section-9.6-8" class="pilcrow">Â¶</a>
</div>
<p id="section-9.6-9">Decrypting the Cryptographic Layer yields the following content:<a href="#section-9.6-9" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.6-10">
<pre>
From: Alice Lovelace &lt;alice@openpgp.example&gt;
To: Bob Babbage &lt;bob@openpgp.example&gt;
Date: Mon, 21 Oct 2019 07:18:00 -0700
Subject: BarCorp contract signed, let's go!
Content-Type: multipart/mixed; boundary="6ae"; protected-headers="v1"
Message-ID: &lt;pgpmime-sign+enc+legacy-disp@protected-headers.example&gt;

--6ae
content-type: text/plain; protected-headers="v1"
Content-Disposition: inline

Subject: BarCorp contract signed, let's go!

--6ae
Content-Type: text/plain; charset="us-ascii"

Hi Bob!

I just signed the contract with BarCorp and they've set us up with
an account on their system for testing.

The account information is:

        Site: https://barcorp.example/
    Username: examplecorptest
    Password: correct-horse-battery-staple

Please get the account set up and apply the test harness.

Let me know when you've got some results.

(this is the 'pgpmime-sign+enc+legacy-disp' message)

Thanks, Alice
-- 
Alice Lovelace
President
Example Corp

--6ae--
</pre><a href="#section-9.6-10" class="pilcrow">Â¶</a>
</div>
</section>
</div>
<div id="multilayer-pgpmime-message-with-protected-headers">
<section id="section-9.7">
        <h3 id="name-multilayer-pgp-mime-message">
<a href="#section-9.7" class="section-number selfRef">9.7. </a><a href="#name-multilayer-pgp-mime-message" class="section-name selfRef">Multilayer PGP/MIME Message with Protected Headers</a>
        </h3>
<p id="section-9.7-1">Some mailers may generate signed and encrypted messages with a multilayer cryptographic envelope.
We show here how such a mailer might generate the same message as <a href="#pgp-encryptedsigned" class="xref">Section 9.4</a>.<a href="#section-9.7-1" class="pilcrow">Â¶</a></p>
<p id="section-9.7-2">A typical PGP/MIME message like this has the following structure:<a href="#section-9.7-2" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.7-3">
<pre>
ââ¬â´multipart/encrypted
 âââ´application/pgp-encrypted
 âââ´application/octet-stream
  â§ (decrypts to)
  ââ¬â´multipart/signed
   âââ´text/plain â Cryptographic Payload
   âââ´application/pgp-signature
</pre><a href="#section-9.7-3" class="pilcrow">Â¶</a>
</div>
<p id="section-9.7-4">For this message, the session key is an AES-256 key with value <code>5e67165ed1516333daeba32044f88fd75d4a9485a563d14705e41d31fb61a9e9</code> (in hex).<a href="#section-9.7-4" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.7-5">
<pre>
Received: from localhost (localhost [127.0.0.1]); Mon, 21 Oct 2019
 07:12:28 -0700 (UTC-07:00)
MIME-Version: 1.0
Content-Type: multipart/encrypted; boundary="024";
 protocol="application/pgp-encrypted"
From: Alice Lovelace &lt;alice@openpgp.example&gt;
To: Bob Babbage &lt;bob@openpgp.example&gt;
Date: Mon, 21 Oct 2019 07:12:00 -0700
Message-ID: &lt;pgpmime-layered@protected-headers.example&gt;
Subject: ...

--024
content-type: application/pgp-encrypted

Version: 1

--024
content-type: application/octet-stream

-----BEGIN PGP MESSAGE-----

wV4DR2b2udXyHrYSAQdApTCCVZLqLBNWL55la9dZGbO1aPtMkIFXYo8DOKgIpCcw
gm5VfqOECRjoZqCwveFWGqRknz0lc+eau5fcbenmEW8J1E0FjpoBEnFo9vYb6PrU
wcDMA3wvqk35PDeyAQwAwiuMTVdntVxYn6dnGUoaga2txqCsxioqn4JgfmGrIfBf
+BEHyt/a43rWwfi3QycCKg483Fqx0YG3HHJEiiwdFmE3XdoHmTRKfHuSiyzCNxPz
AK2cwloBtD3w6zs+mOY7Ytq83ghyBeX0aGmgCZqGhL60In5Qu+w3Vmxc19d2+BTs
ZOJzxcHACRvq2tD0RRmyhjWKqVdd2akllMy1pcXLIediUiEI5MA3TaWUk/uVDsUq
S6JtL0dEy0s49Z+flcGfEyGCGU6TqV0Yun0bl3A7/OJjYC+75eCv89s/q4W1UM1M
psO2X7xNlhgREncwvaoQbvfVfSlxHgWGCZDL8+O/7XC5EDyK4LAR912SG4Desr9e
k9Fn3bH6Tt71vpH0nByKCh0m2/apFEMLXSq7DMiJEN4spbc4D3iBnxYqEH99e052
KNjrHaoG59bZ6TNJj/JN+E5sQzDxic00O4Qccg9M7iFh6eBLOuBhBpRxbeoXQkl3
1mzI8XpyFoGu0HH0I0Cs0sJGAUnVvA0LGq7wjKpy0bWQlB2YVCKU6C8GnX6GUcLm
SMovYhGKfpb+LUu+UM1BZ9vd9D/tsMd2WBw5tM1ncfRuSTOhVeFgTEGiCrBn7sdb
UFTV+jb5CktQMwj5vWlVPhMIUeISwoAQJ1ONuOqFnVTJ2bZOdxZeV6NDYPYCERuR
Sh980UxdjGLvw/LtMThKJRUr3S2TcmKSwGen5a96S+lAAmMJN5wLrH+X76UuRvV+
O7m6KDasO+fEIWXKYHGjJI1On8MnkVE4dSDKgUNukVRoBAB9Iqn11zWb6IX7f11M
k8C+8F5Y1xxEG3CCeYdTKSiIkDvBV8oFGrFCYXWO2bLWFpCZ0t2qDfWX5SvXj+EZ
KxAiZobwQEw16WYp4Mk0Ppf0UrBXkfnLBieRgO4o5j5Y//EXKpv8TSBxRbeOVfRk
x11HNbaNeBtID4N2HfjsqUX3y2ZH3m7HWLwkQeX6Yw5qqSWQjC8fklxOku+brAaM
ayudhVFKiD5PVfe1NrVv5dDSbj5VyQkoESi2zLmd4SLoFIMp8/lfSnpl0ZF4krFb
wIF8wd+zT2307fN4DRKjuqFVr0Yl8oh9iPJN0xXSyygeo+JWWfYPu41vf+viRZMh
aj1nhJoa9UghiYfXuDu+VjzZuM22C/9gVbXMSuY1PaKffBleTNhCT7JWlmhNBW6t
ouH6dZ2X6OlXECmByzKy+d8Dun21G2nLuE82QP9y7/QZ2g+OSWZAA2IIDiH2tEIb
8CNSVwZXNpSeqH5u3+aRE1M5EzslbLU78Ryrxt6lNAzEHD42Fif+qaH0WW52wV2H
vnaxJW0yQ1o4W6W+BPtKqtE7t8JgTEtxldKHIdWCMXg2isxWMMIE12QEc26+bQnz
h+kDrTqxtp8rSfhLSQi4TRoudxx8mMjwFEWnRIFRQG7eGNPaqZYF3dz/neN/fy0p
Jbf1gFJAtrSIlOOaZ+iT864OtcaLOHkOLNGEuyJR1dOC9tuyldarvKR0v0i4jhY6
UxDkknDkq0IzTmczFyAH3lBLRPMZNZ1z
=YU4k
-----END PGP MESSAGE-----

--024--
</pre><a href="#section-9.7-5" class="pilcrow">Â¶</a>
</div>
<p id="section-9.7-6">Decrypting the encryption Cryptographic Layer yields the following content:<a href="#section-9.7-6" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.7-7">
<pre>
Content-Type: multipart/signed; boundary="80b";
 protocol="application/pgp-signature"; micalg="pgp-sha512"

--80b
From: Alice Lovelace &lt;alice@openpgp.example&gt;
To: Bob Babbage &lt;bob@openpgp.example&gt;
Date: Mon, 21 Oct 2019 07:12:00 -0700
Subject: BarCorp contract signed, let's go!
Content-Type: text/plain; charset="us-ascii"; protected-headers="v1"
Message-ID: &lt;pgpmime-layered@protected-headers.example&gt;

Hi Bob!

I just signed the contract with BarCorp and they've set us up with
an account on their system for testing.

The account information is:

        Site: https://barcorp.example/
    Username: examplecorptest
    Password: correct-horse-battery-staple

Please get the account set up and apply the test harness.

Let me know when you've got some results.

(this is the 'pgpmime-layered' message)

Thanks, Alice
-- 
Alice Lovelace
President
Example Corp

--80b
content-type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----

wnUEARYKAB0FAl2tvLAWIQTrhbtfozp14V6UTmPyMVUMT0fjjgAKCRDyMVUMT0fj
jjiqAPwOjOQI/Sr3vG0hiAKmfBgmB7VhKiUbfFWKRaWKkzJ/kAD/eOjMNvaZ5MG1
fw6xQXpB1vRrY9Ttz3zr+TfLnfHFwQM=
=4v4Q
-----END PGP SIGNATURE-----

--80b--
</pre><a href="#section-9.7-7" class="pilcrow">Â¶</a>
</div>
<p id="section-9.7-8">Note the placement of the Protected Headers on the Cryptographic Payload specifically, which is not the immediate child of the encryption Cryptographic Layer.<a href="#section-9.7-8" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="pgp-multilayer-legacy-display">
<section id="section-9.8">
        <h3 id="name-multilayer-pgp-mime-message-">
<a href="#section-9.8" class="section-number selfRef">9.8. </a><a href="#name-multilayer-pgp-mime-message-" class="section-name selfRef">Multilayer PGP/MIME Message with Protected Headers and Legacy Display Part</a>
        </h3>
<p id="section-9.8-1">And, a mailer that generates a multilayer cryptographic envelope might want to provide a Legacy Display part, if it is unsure of the capabilities of the recipient's MUA.
We show here how such a mailer might generate the same message as <a href="#pgp-encryptedsigned" class="xref">Section 9.4</a>.<a href="#section-9.8-1" class="pilcrow">Â¶</a></p>
<p id="section-9.8-2">Such a PGP/MIME message might have the following structure:<a href="#section-9.8-2" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.8-3">
<pre>
ââ¬â´multipart/encrypted
 âââ´application/pgp-encrypted
 âââ´application/octet-stream
  â§ (decrypts to)
  ââ¬â´multipart/signed
   ââ¬â´multipart/mixed â Cryptographic Payload
   ââââ´text/plain â Legacy Display Part
   ââââ´text/plain
   âââ´application/pgp-signature
</pre><a href="#section-9.8-3" class="pilcrow">Â¶</a>
</div>
<p id="section-9.8-4">For this message, the session key is an AES-256 key with value <code>b346a2a50fa0cf62895b74e8c0d2ad9e3ee1f02b5d564c77d879caaee7a0aa70</code> (in hex).<a href="#section-9.8-4" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.8-5">
<pre>
Received: from localhost (localhost [127.0.0.1]); Mon, 21 Oct 2019
 07:21:28 -0700 (UTC-07:00)
MIME-Version: 1.0
Content-Type: multipart/encrypted; boundary="32c";
 protocol="application/pgp-encrypted"
From: Alice Lovelace &lt;alice@openpgp.example&gt;
To: Bob Babbage &lt;bob@openpgp.example&gt;
Date: Mon, 21 Oct 2019 07:21:00 -0700
Message-ID: &lt;pgpmime-layered+legacy-disp@protected-headers.example&gt;
Subject: ...

--32c
content-type: application/pgp-encrypted

Version: 1

--32c
content-type: application/octet-stream

-----BEGIN PGP MESSAGE-----

wV4DR2b2udXyHrYSAQdAC1Ly2OZdEVNBoA4HUfvQJgdpSkelPzYiPR/TWOapEx0w
gPck9O1y4gnu01fnptzYiIaZKMWis7jPqmH2jQRhnG1Q0JKS1PeCfTS9207oQiD1
wcDMA3wvqk35PDeyAQwAqIL7jcN2Rm5u4qhMfvT7by7nUKCOaP/H+kMPIsXP2Kxf
MlRVnrrsCgJ6j5htt48HGddpEgLlZceK3vg8WlRWSpMstpdGxxE7HZqXHKMNk8V+
8EVWlHGWBmxisA7/JOOrt4HQJnHm01drIXgWjIA+Vpu/zFA542qQH78jr9Ghhp/C
Q32VOrCY/PsFxabPIYS9wWh1Ym3+VQFndCVSpxCZHs1Qilt9XGj4X712QcvgL2Pp
glaulvNob899dOIo4Noj7p+cx4yMkWpi9dqHuOme23aixieBbzQopzY3gleVgXhc
HFhUzje7DybtVq0em4xpNPWxq2b+WBeu+SvXFo2buHhWmMClbKf6gggod3CRKcPt
h5MLF3dFE1kj3BOLxJqFOIny2EhWZvvmDQgG4uncEGo1siQhEiutQL2WClzuHGzs
T8eEHKeATEPqRQHm395Ivr5btQ8gg4tnIkfBBULPgnEfY07Llc+393a0MgW9bLbn
UZTmNIsS1FKXYzHxpUAD0sKBAe03UKSoYJ5b5yBghMZCCS9L9dm8llJVsMh022DC
lMPpRsSm79hnFww0+Yud+i4z24C8WdivWBNoZz0M1hA5cwoQoXaxalL5GpZ/UWAd
XNC6QwaCB2ioTFueq8SJAHzur2V89FMUuPmSaB3yO72vko/468nLnjwCcZDpbWCS
fVwcTz8bvyZfcYA2ugRPii4NM1+bYJHHtr6CIojN0FkE5tOLAxO4vPAx5CYABTm7
HQn063YJJlTtJB1SJWMzmK5vqxtXFeOByc/msdQX8goxS3G6RNPVHabESaqVrG4i
F+TyzqiMFTZdLjiJXiKcFHwDoLUwA/FxkA5/BwRCM5LX3LITAvvqYy0TkaQH0SeN
bfqCf4kWzuNhTfZM3wFgaA+FvYC8M7PKiE9y1+TiWEUqMa+j0rcrf2+Nzt8mT6WU
eQRwf9XzgmPVNarQpStomff6dJVaxloNCwKKk3LtGRWkV0EIbKtFwPi+M7h3BgWn
NQHVT1MXXV8LyKipH1ZpB3WUHjGqL13esOFwR4W+U9/qzgn6kN7kZP+yj0qXutCR
GsjoVvwN6FU8cjv4nK1H65cobBAqP0iWEvLt1e351cwQWwUL1V/B3jWM3Wqui/hR
lOQ9TW/WdP1/VT2Heb3503IJKJYntOMcT8aYooCLUCQmx1g4Ks1y4hP5mlLurjdv
qBrvDNbRsW27GnyuUm8/oS1qpYS0gIrMe4BMXpwLca6xvXElNcm2Lo1Oqh3MhW5J
IVjGkQDV2vM76qsfBdpHebO0XBKfccyx9wZDO9MOAOXVO8o/yh8H/Mcn/sOpaVsv
gdf6JElYfwCOd7J44ymzonw0kbC6F7UZgpWlY5gGlga2EPwwaFkTH22D8MHOrwKA
JBJCvaGxEmzrV4WlaE77LUJoDs6chIF/GKcntsBvvyvjsrFLPK/2/RtrUEkP2G4e
svWDdqSECPYEFYMvzfJMwa2G0uXCLiATP8NTSleOcZ9sPkE9Ul62JVJ+y/tOz8z/
oZ4SdrgAEdJSbWbyev8bd1WCbRnOyOxuQHmVmhtCm4Ps506+sGWL+PDnywrwvyP7
X1b8YpYCWaHS8md9AW2Jgcdj6p3Hc2Bs7zlMqzsc0pdvXRs=
=Fb+8
-----END PGP MESSAGE-----

--32c--
</pre><a href="#section-9.8-5" class="pilcrow">Â¶</a>
</div>
<p id="section-9.8-6">Unwrapping the encryption Cryptographic Layer yields the following content:<a href="#section-9.8-6" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.8-7">
<pre>
Content-Type: multipart/signed; boundary="03a";
 protocol="application/pgp-signature"; micalg="pgp-sha512"

--03a
From: Alice Lovelace &lt;alice@openpgp.example&gt;
To: Bob Babbage &lt;bob@openpgp.example&gt;
Date: Mon, 21 Oct 2019 07:21:00 -0700
Subject: BarCorp contract signed, let's go!
Content-Type: multipart/mixed; boundary="6ae"; protected-headers="v1"
Message-ID: &lt;pgpmime-layered+legacy-disp@protected-headers.example&gt;

--6ae
content-type: text/plain; protected-headers="v1"
Content-Disposition: inline

Subject: BarCorp contract signed, let's go!

--6ae
Content-Type: text/plain; charset="us-ascii"

Hi Bob!

I just signed the contract with BarCorp and they've set us up with
an account on their system for testing.

The account information is:

        Site: https://barcorp.example/
    Username: examplecorptest
    Password: correct-horse-battery-staple

Please get the account set up and apply the test harness.

Let me know when you've got some results.

(this is the 'pgpmime-layered+legacy-disp' message)

Thanks, Alice
-- 
Alice Lovelace
President
Example Corp

--6ae--

--03a
content-type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----

wnUEARYKAB0FAl2tvswWIQTrhbtfozp14V6UTmPyMVUMT0fjjgAKCRDyMVUMT0fj
js14AQD2GOrZXkuKxZPY0l6AJFKiAFphRt+5V9gj3HEXKvQKPAD/bZy+vW9j1+e4
MLiOb1ojjFocLx/6MvQBoI3P9a591Qs=
=l8GL
-----END PGP SIGNATURE-----

--03a--
</pre><a href="#section-9.8-7" class="pilcrow">Â¶</a>
</div>
</section>
</div>
<div id="smime-sign-enc-legacy">
<section id="section-9.9">
        <h3 id="name-signed-and-encrypted-s-mime-">
<a href="#section-9.9" class="section-number selfRef">9.9. </a><a href="#name-signed-and-encrypted-s-mime-" class="section-name selfRef">Signed and Encrypted S/MIME Message with Protected Headers and Legacy Display</a>
        </h3>
<p id="section-9.9-1">This shows the same signed and encrypted S/MIME message as <a href="#smime-sign-enc" class="xref">Section 9.5</a>, but formulated with a Legacy Display part so that
Its MIME message structure is:<a href="#section-9.9-1" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.9-2">
<pre>
âââ´application/pkcs7-mime smime-type="enveloped-data"
 â§ (decrypts to)
 âââ´application/pkcs7-mime smime-type="signed-data"
  â© (unwraps to)
  ââ¬â´multipart/mixed â Cryptographic Payload
   âââ´text/plain â Legacy Display Part
   âââ´text/plain 445 bytes
</pre><a href="#section-9.9-2" class="pilcrow">Â¶</a>
</div>
<p id="section-9.9-3">The <code>Subject:</code> header is successfully obscured.<a href="#section-9.9-3" class="pilcrow">Â¶</a></p>
<p id="section-9.9-4">Note that if this message had been generated without Protected Headers, then an attacker with access to it could have read the Subject.
Such an attacker would know details about Alice and Bob's business that they wanted to keep confidential.<a href="#section-9.9-4" class="pilcrow">Â¶</a></p>
<p id="section-9.9-5">The protected headers also protect the authenticity of subject line as well.<a href="#section-9.9-5" class="pilcrow">Â¶</a></p>
<p id="section-9.9-6">The session key for this message's Cryptographic Layer is an AES-256 key with value <code>09e8f2a19d9e97deea7d51ee7d401be8763ab0377b6f30a68206e0bed4a0baec</code> (in hex).<a href="#section-9.9-6" class="pilcrow">Â¶</a></p>
<p id="section-9.9-7">If Bob's MUA is capable of interpreting these protected headers, it should render the <code>Subject:</code> of this message as <code>BarCorp contract signed, let's go!</code>.<a href="#section-9.9-7" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.9-8">
<pre>
Received: from localhost (localhost [127.0.0.1]); Wed, 27 Nov 2019
 01:24:28 -0700 (UTC-07:00)
MIME-Version: 1.0
Content-Transfer-Encoding: base64
Content-Type: application/pkcs7-mime; name="smime.p7m";
 smime-type="enveloped-data"
From: Alice Lovelace &lt;alice@smime.example&gt;
To: Bob Babbage &lt;bob@smime.example&gt;
Date: Wed, 27 Nov 2019 01:24:00 -0700
Message-ID: &lt;smime-sign+enc+legacy-disp@protected-headers.example&gt;
Subject: ...

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
mi1JBjXLAT3pEJDh8b3Lpgw=
</pre><a href="#section-9.9-8" class="pilcrow">Â¶</a>
</div>
<p id="section-9.9-9">Unwrapping the outer Cryptographic Layer of this message yields the following MIME part (with its own Cryptographic Layer):<a href="#section-9.9-9" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.9-10">
<pre>
Content-Transfer-Encoding: base64
Content-Type: application/pkcs7-mime; name="smime.p7m";
 smime-type="signed-data"

MIIJdQYJKoZIhvcNAQcCoIIJZjCCCWICAQExDTALBglghkgBZQMEAgEwggP5Bgkq
hkiG9w0BBwGgggPqBIID5kZyb206IEFsaWNlIExvdmVsYWNlIDxhbGljZUBzbWlt
ZS5leGFtcGxlPg0KVG86IEJvYiBCYWJiYWdlIDxib2JAc21pbWUuZXhhbXBsZT4N
CkRhdGU6IFdlZCwgMjcgTm92IDIwMTkgMDE6MjQ6MDAgLTA3MDANClN1YmplY3Q6
IEJhckNvcnAgY29udHJhY3Qgc2lnbmVkLCBsZXQncyBnbyENCkNvbnRlbnQtVHlw
ZTogbXVsdGlwYXJ0L21peGVkOyBib3VuZGFyeT0iNmFlIjsgcHJvdGVjdGVkLWhl
YWRlcnM9InYxIg0KTWVzc2FnZS1JRDogPHNtaW1lLXNpZ24rZW5jK2xlZ2FjeS1k
aXNwQHByb3RlY3RlZC1oZWFkZXJzLmV4YW1wbGU+DQoNCi0tNmFlDQpjb250ZW50
LXR5cGU6IHRleHQvcGxhaW47IHByb3RlY3RlZC1oZWFkZXJzPSJ2MSINCkNvbnRl
bnQtRGlzcG9zaXRpb246IGlubGluZQ0KDQpTdWJqZWN0OiBCYXJDb3JwIGNvbnRy
YWN0IHNpZ25lZCwgbGV0J3MgZ28hDQoNCi0tNmFlDQpDb250ZW50LVR5cGU6IHRl
eHQvcGxhaW47IGNoYXJzZXQ9InVzLWFzY2lpIg0KDQpIaSBCb2IhDQoNCkkganVz
dCBzaWduZWQgdGhlIGNvbnRyYWN0IHdpdGggQmFyQ29ycCBhbmQgdGhleSd2ZSBz
ZXQgdXMgdXAgd2l0aA0KYW4gYWNjb3VudCBvbiB0aGVpciBzeXN0ZW0gZm9yIHRl
c3RpbmcuDQoNClRoZSBhY2NvdW50IGluZm9ybWF0aW9uIGlzOg0KDQogICAgICAg
IFNpdGU6IGh0dHBzOi8vYmFyY29ycC5leGFtcGxlLw0KICAgIFVzZXJuYW1lOiBl
eGFtcGxlY29ycHRlc3QNCiAgICBQYXNzd29yZDogY29ycmVjdC1ob3JzZS1iYXR0
ZXJ5LXN0YXBsZQ0KDQpQbGVhc2UgZ2V0IHRoZSBhY2NvdW50IHNldCB1cCBhbmQg
YXBwbHkgdGhlIHRlc3QgaGFybmVzcy4NCg0KTGV0IG1lIGtub3cgd2hlbiB5b3Un
dmUgZ290IHNvbWUgcmVzdWx0cy4NCg0KKHRoaXMgaXMgdGhlICdzbWltZS1zaWdu
K2VuYytsZWdhY3ktZGlzcCcgbWVzc2FnZSkNCg0KVGhhbmtzLCBBbGljZQ0KLS0g
DQpBbGljZSBMb3ZlbGFjZQ0KUHJlc2lkZW50DQpFeGFtcGxlIENvcnANCg0KLS02
YWUtLQ0KoIIDcjCCA24wggJWoAMCAQICFGeCtFlzUkvB9HFHGWrw/RGKqkwLMA0G
CSqGSIb3DQEBDQUAMC0xKzApBgNVBAMTIlNhbXBsZSBMQU1QUyBDZXJ0aWZpY2F0
ZSBBdXRob3JpdHkwIBcNMTkxMTIwMDY1NDE4WhgPMjA1MjA5MjcwNjU0MThaMBkx
FzAVBgNVBAMTDkFsaWNlIExvdmVsYWNlMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
MIIBCgKCAQEAw+6t+WXRtiQM8yRjWQ2fbFewCodIZUX6BY02TeZuEXoEAGEsmoON
6LlotcUTdGr39FE2K8IytOKkXVexswgAqBCqv8YjVDrI3yV82wrm5Td32TDlw7IS
igak4ZSu+UowPQs8YO3oxqImP4onZNHvdZ3it9EggmgUyZX0dmQ6z5O9yDzHpLMa
E2rXxfYcPXQwPvx4tcqbTf2htEP7PYnBa8a+sts0F7I7kD5ozGYI9dGg/XGs1lYE
WAoH5YZgNFdbkJdcKG2FPAwFcVZ/hoGm6soxkDKMrYSCtBp+fqH8MV11DP821PoO
vtSEnaF8UURbaths2yKpAB2WUJvgW5xa4QIDAQABo4GXMIGUMAwGA1UdEwEB/wQC
MAAwHgYDVR0RBBcwFYETYWxpY2VAc21pbWUuZXhhbXBsZTATBgNVHSUEDDAKBggr
BgEFBQcDBDAPBgNVHQ8BAf8EBQMDB6AAMB0GA1UdDgQWBBSsLlRapP1VGK8u6GZE
ONEl0dcAeTAfBgNVHSMEGDAWgBS3Uk1zwIg9ssN6WgzzlPf3gKJ32zANBgkqhkiG
9w0BAQ0FAAOCAQEAe+qOGM+8q1UhXKV6i63BrXSOKvd2iglxAggszUC6eMnrIem6
6mmRzSbcGHCeU6m1MpvYSe9IiROIxjTfsgGUdZbbXtBxSmCASjOBCbphvvtoam1G
i8+LZdOgR2kDwr//TYjWO6vUfXPwerNWMx4cKpFobdmvgLYCeAZKRvoPjJmTEFfw
KO0cCxSifTpTFiwZhFxXKSCTdB6T2rE9JxJfzJqLUrvvEZwpQIt8hX8kym/vKw+1
cbsl3rag2enVP/f4qg/0mUuzkCI8sLXd+N5gAs9wdUZRcTB0gOnUAH9m7RrpqkdC
ogKdypGEQHj6GiamJAe2WndOp4BZdBtBRzjfuzGCAdkwggHVAgEBMEUwLTErMCkG
A1UEAxMiU2FtcGxlIExBTVBTIENlcnRpZmljYXRlIEF1dGhvcml0eQIUZ4K0WXNS
S8H0cUcZavD9EYqqTAswCwYJYIZIAWUDBAIBoGkwGAYJKoZIhvcNAQkDMQsGCSqG
SIb3DQEHATAcBgkqhkiG9w0BCQUxDxcNMTkxMTI3MDgyNDAwWjAvBgkqhkiG9w0B
CQQxIgQgX1r//iHA8sj6FZnDpQl9jK7M6APu04IWNEm5nuSzt7MwDQYJKoZIhvcN
AQEBBQAEggEAaeYcpNS5ON33UDUWO/kaIOKbD1JQRDsoldNC/UNlO1X1PzvL43sR
g77FEV6bcl3kWReTz5aYHr4PFjoQspeGWQvQpeUW8bIlZ5nxb5O/zUcx62mbciHZ
C2quuvTBGoJRfxMTD6pCPoyRW9PF2o9O4eB8lORQ0xML3jXb3oN1EF0nFXXs7Fe7
8KRWA4FVldJDrgRLGdrrF73kvpTZuVGkMYb2sCosRiBO+rk0LFvOcBIQO3DjbBEM
dy5zeex+eN5WMbI+lFJt8eM0fDQencMHIp2AmP4AVAashtXomx7ZIMI/fDdVxlx0
OcDnTZCx0+vVBfM7d6TE91Uky6ELrMbq/Q==
</pre><a href="#section-9.9-10" class="pilcrow">Â¶</a>
</div>
<p id="section-9.9-11">Unwrapping the inner Cryptographic Layer yields the Cryptographic Payload, which includes the Legacy Display part:<a href="#section-9.9-11" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.9-12">
<pre>
From: Alice Lovelace &lt;alice@smime.example&gt;
To: Bob Babbage &lt;bob@smime.example&gt;
Date: Wed, 27 Nov 2019 01:24:00 -0700
Subject: BarCorp contract signed, let's go!
Content-Type: multipart/mixed; boundary="6ae"; protected-headers="v1"
Message-ID: &lt;smime-sign+enc+legacy-disp@protected-headers.example&gt;

--6ae
content-type: text/plain; protected-headers="v1"
Content-Disposition: inline

Subject: BarCorp contract signed, let's go!

--6ae
Content-Type: text/plain; charset="us-ascii"

Hi Bob!

I just signed the contract with BarCorp and they've set us up with
an account on their system for testing.

The account information is:

        Site: https://barcorp.example/
    Username: examplecorptest
    Password: correct-horse-battery-staple

Please get the account set up and apply the test harness.

Let me know when you've got some results.

(this is the 'smime-sign+enc+legacy-disp' message)

Thanks, Alice
-- 
Alice Lovelace
President
Example Corp

--6ae--
</pre><a href="#section-9.9-12" class="pilcrow">Â¶</a>
</div>
</section>
</div>
<div id="smime-encrypted-only">
<section id="section-9.10">
        <h3 id="name-encrypted-only-unsigned-s-m">
<a href="#section-9.10" class="section-number selfRef">9.10. </a><a href="#name-encrypted-only-unsigned-s-m" class="section-name selfRef">Encrypted-only (unsigned) S/MIME Message with Protected Headers and Legacy Display</a>
        </h3>
<p id="section-9.10-1">This shows the same encrypted message as <a href="#smime-sign-enc-legacy" class="xref">Section 9.9</a>, but formulated without a signature layer, so it is "encrypted-only".<a href="#section-9.10-1" class="pilcrow">Â¶</a></p>
<p id="section-9.10-2">Note that the lack of any signature layer means that the only forms of cryptographic protection these header receive is confidentiality.<a href="#section-9.10-2" class="pilcrow">Â¶</a></p>
<p id="section-9.10-3">An arbitrary adversary could forge a message with arbitrary headers (and content), and package it in this same form.
Consequently, the only thing "protected" about the headers in this example is confidentiality for any obscured headers (just the <code>Subject</code> in this case).<a href="#section-9.10-3" class="pilcrow">Â¶</a></p>
<p id="section-9.10-4">Presenting the cryptographic properties of the headers of such a message in a meaningful way to the end user is a subtle and challenging task, which this document cannot cover.<a href="#section-9.10-4" class="pilcrow">Â¶</a></p>
<p id="section-9.10-5">Its MIME message structure is:<a href="#section-9.10-5" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.10-6">
<pre>
âââ´application/pkcs7-mime smime-type="enveloped-data"
 â§ (decrypts to)
 ââ¬â´multipart/mixed â Cryptographic Payload
  âââ´text/plain â Legacy Display
  âââ´text/plain
</pre><a href="#section-9.10-6" class="pilcrow">Â¶</a>
</div>
<p id="section-9.10-7">For this message, the session key is an AES-256 key with value <code>e94f6aaef7f14d6ceeac770c46d7f4885e81fbeaf1462d0fdadfce6c581525e2</code> (in hex).<a href="#section-9.10-7" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.10-8">
<pre>
Received: from localhost (localhost [127.0.0.1]); Wed, 27 Nov 2019
 01:27:28 -0700 (UTC-07:00)
MIME-Version: 1.0
Content-Transfer-Encoding: base64
Content-Type: application/pkcs7-mime; name="smime.p7m";
 smime-type="enveloped-data"
From: Alice Lovelace &lt;alice@smime.example&gt;
To: Bob Babbage &lt;bob@smime.example&gt;
Date: Wed, 27 Nov 2019 01:27:00 -0700
Message-ID: &lt;smime-enc+legacy-disp@protected-headers.example&gt;
Subject: ...

MIIG5QYJKoZIhvcNAQcDoIIG1jCCBtICAQAxggLCMIIBXQIBADBFMC0xKzApBgNV
BAMTIlNhbXBsZSBMQU1QUyBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkCFCJT7jBtAgsf
As31ycE+Ot95phvCMA0GCSqGSIb3DQEBAQUABIIBADEhlzhFzYj6tUAdsRCrSiLl
d9cgKtlAesJ4cDY4szFWAbnwrCmEcFxjFDUOjbfQCYCG80Sxd+xntni73I7PI2rR
QLjk3w9VhLwFRyzy7qyJi2CavjKTxysX9f36+FXA+THfVQRM5ypiyYJg91X51PNX
hJj3DHrnxqKeSl/z1hdt9r+s6XAUCBSvL99BGnODWhNIZtPDzt8fMNcgarfw+D5F
IZJb6+wX30tkztHkpHHKrrDPveyfnlS/p06Gi3ekrrhBtMQMRb9PA/E+ivDPktsm
aKg0Oauw4oZSKW3f4ukYhbnndbbagNsnTfs/QFy/p+hhKTrfCd0h1N8mTzedVX0w
ggFdAgEAMEUwLTErMCkGA1UEAxMiU2FtcGxlIExBTVBTIENlcnRpZmljYXRlIEF1
dGhvcml0eQIUZ4K0WXNSS8H0cUcZavD9EYqqTAswDQYJKoZIhvcNAQEBBQAEggEA
FaK5QaPXJ133D2uybQt//oeDm6PkCAFW9YVOgjnLLz6FD54Dt2i1KCQu1Xlg9W3P
1zJdYXOftDgilylNfmt/muEsvbRfFtMWUq0VGirHz//BWmY2cW/ocinFO514iviL
MLE1umsXRNwVIVIk/uh7AmqXjPkRZgRgIMUbSbtmW4DDja+ZM0vmqFQ1iUIlApth
FpjFfPDHHD8isLTbGi2iK6dEN3DIJFGbg5o3nK6yAhVZ7x3LfFNSNVDDSY5mPFG9
Vm6uRgEE3Y5P6DbXXo6MHTgg0XY2f4y6MEWhOg37NT9aFAfzBBxJ1oSBWpOOfZnV
K1DvAwPaemSRz9oWDcBM8DCCBAUGCSqGSIb3DQEHATAUBggqhkiG9w0DBwQIsFkN
8DEx8muAggPgWGF2WsPq3/a9jUa5GA0YFPiINuETCGTNaEXiVxnT0h0CF+EhZ0T2
HFCiZEM0dzO05zt9WdVvAREaCSh7ZWG9D9wJF9x+tqQbzMuJ2AdKuoOH73kClvkx
pHxANLhkY7hzIqRb/eLG5D7Xh8iCDiFecXDh7EHqD/R+sfLN9aHKOcKyY36kesBQ
R8aHZbbFnnD+oXSDNIPcntGG3BSGMxsWuOp+rpTKeIHWFIungDNKsLIy3kWleENw
FVIcjUF6QhI1HYW6BeXuVq40GV2OOkmB24rYEW1Jg0hAtY+5rn2mRoyxvUC87bjQ
hLu6xgPmhun9J324eM5aYVwkmVBnRW9hyxClZ7Sv0zlL7lGQ0VQG+zWHeJ+h/M2j
mQpLgAUEGxxNCm5ASHuXPIN6pSvrOVplrT8kKLPpmMYEwmTX2/rBO4P8I8uNrqYD
AyX8p0/l2ArczkWzGTz2luBahrD+cTZPApe5SeyXOxWBl1Lmb0G8o4twBeeBLiHP
XwYvttx0JYG/hc/lmMpEemJqwj9uZ3wGD03dIhhDX2Oj4ek/7jT6yqJh8C1H+PqA
+HNfNXsFQDrRORoqJS8YVEiYRDQNyePy2ugzLTh88nPtJp92hY7bk9zl3AYaiVFH
+szlLoyzfM9D+geZemR8XfI2ijGnrWMlnyPah/zA6J6RwemhuiMklZGYG85hMU9H
K4CFVM+m7xYxKpwFVnmkVZjzWInirJhehElhtCXpx/IFGxH9CPbCyEZV1WVStrl/
0fWTGicMXez6hVQCadWCXy96/eLIXOrC54gSoIJX2TD6jdVEu1YptutyGI6KdQ2p
yXwhs98Uj7DM3nmFeAcjjN3e8pPoX7aG8eP+MfmHlWN6jA44jMaJmIdp9J20g74J
MdjvnHa/cGibW/RamPiFObN0F94A83vcpUfU/zZ8cFHi/3/lN6Rm9+3/giGRZa9E
Y6e2/CEq1cUbPQ09fPwRJmjZCfDce71DKe+ZFGdYtFR7JwDEeZ6BB4Ff4rXctcWD
PgUJqUGv/SXBcFn4cNUK9MYYqVu1ovd/T7FMf+i3c5MH6BRCvft/i5aeBR+A26Gk
2awtBPYdHW6+AslrFjncBbtPDlU6vX9AWuC0k0MQYnNkTWS8gTvsriXJZ6Zu5iFE
ExNuFz7YcnMKnguOn2ph5azzeMm83AYzWXzZPu3mdr5Siuu/Ke38oADKP+BZ08Za
XVvKvvfnRPXO9kG9hgvEMRU9KOcxn82XoGPNZib+9SPa2zYx5P6HX1Bqe/cmKAen
FKEiJLSTP2/pc6AWAICqJl978HaUHfMFiN7jEUppAifpAWqNcIGSW5w=
</pre><a href="#section-9.10-8" class="pilcrow">Â¶</a>
</div>
<p id="section-9.10-9">Unwrapping the single-layer Cryptographic Envelope of this message yields the following MIME structure:<a href="#section-9.10-9" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.10-10">
<pre>
From: Alice Lovelace &lt;alice@smime.example&gt;
To: Bob Babbage &lt;bob@smime.example&gt;
Date: Wed, 27 Nov 2019 01:27:00 -0700
Subject: BarCorp contract signed, let's go!
Content-Type: multipart/mixed; boundary="6ae"; protected-headers="v1"
Message-ID: &lt;smime-enc+legacy-disp@protected-headers.example&gt;

--6ae
content-type: text/plain; protected-headers="v1"
Content-Disposition: inline

Subject: BarCorp contract signed, let's go!

--6ae
Content-Type: text/plain; charset="us-ascii"

Hi Bob!

I just signed the contract with BarCorp and they've set us up with
an account on their system for testing.

The account information is:

        Site: https://barcorp.example/
    Username: examplecorptest
    Password: correct-horse-battery-staple

Please get the account set up and apply the test harness.

Let me know when you've got some results.

(this is the 'smime-enc+legacy-disp' message)

Thanks, Alice
-- 
Alice Lovelace
President
Example Corp

--6ae--
</pre><a href="#section-9.10-10" class="pilcrow">Â¶</a>
</div>
</section>
</div>
<div id="encrypted-only-unsigned-pgpmime-message-with-protected-headers-and-legacy-display">
<section id="section-9.11">
        <h3 id="name-encrypted-only-unsigned-pgp">
<a href="#section-9.11" class="section-number selfRef">9.11. </a><a href="#name-encrypted-only-unsigned-pgp" class="section-name selfRef">Encrypted-only (unsigned) PGP/MIME Message with Protected Headers and Legacy Display</a>
        </h3>
<p id="section-9.11-1">This shows a comparable encrypted-only (unsigned) message, like <a href="#smime-encrypted-only" class="xref">Section 9.10</a> , but using PGP/MIME instead of S/MIME.<a href="#section-9.11-1" class="pilcrow">Â¶</a></p>
<p id="section-9.11-2">Note that the lack of any signature layer means that the only forms of cryptographic protection these header receive is confidentiality.<a href="#section-9.11-2" class="pilcrow">Â¶</a></p>
<p id="section-9.11-3">An arbitrary adversary could forge a message with arbitrary headers (and content), and package it in this same form.
Consequently, the only thing "protected" about the headers in this example is confidentiality for any obscured headers (just the <code>Subject</code> in this case).<a href="#section-9.11-3" class="pilcrow">Â¶</a></p>
<p id="section-9.11-4">Presenting the cryptographic properties of the headers of such a message in a meaningful way to the end user is a subtle and challenging task, which this document cannot cover.<a href="#section-9.11-4" class="pilcrow">Â¶</a></p>
<p id="section-9.11-5">Its MIME message structure is:<a href="#section-9.11-5" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.11-6">
<pre>
ââ¬â´multipart/encrypted
 âââ´application/pgp-encrypted
 âââ´application/octet-stream
  â§ (decrypts to)
  ââ¬â´multipart/mixed â Cryptographic Payload
   âââ´text/plain â Legacy Display
   âââ´text/plain
</pre><a href="#section-9.11-6" class="pilcrow">Â¶</a>
</div>
<p id="section-9.11-7">For this message, the session key is an AES-256 key with value <code>4f3e7e3cb4a49747f88d232601fa98a29d7427e8f80882464cfbca3dcb847356</code> (in hex).<a href="#section-9.11-7" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.11-8">
<pre>
Received: from localhost (localhost [127.0.0.1]); Mon, 21 Oct 2019
 07:30:28 -0700 (UTC-07:00)
MIME-Version: 1.0
Content-Type: multipart/encrypted; boundary="c07";
 protocol="application/pgp-encrypted"
From: Alice Lovelace &lt;alice@openpgp.example&gt;
To: Bob Babbage &lt;bob@openpgp.example&gt;
Date: Mon, 21 Oct 2019 07:30:00 -0700
Message-ID: &lt;pgpmime-enc+legacy-disp@protected-headers.example&gt;
Subject: ...

--c07
content-type: application/pgp-encrypted

Version: 1

--c07
content-type: application/octet-stream

-----BEGIN PGP MESSAGE-----

wV4DR2b2udXyHrYSAQdAX8p0+U8WbFNtCeGX5no1X1mSPqdmwrJIVWVZT8LS/yIw
lv+vor/Wsh7cKBofs1yIlPR4u/01EKjj+XkgD+h1BEtHDHp9ckuzBHmOI6YL0AZU
wcDMA3wvqk35PDeyAQwAiGcX6KN1jS+gHFAUcWWvc672CPPOhIhS91BGz4MMiV/G
Prm+dwIE5V7I6Sh7XMEons1Z7EdUbpxP/OufCTQwrkXlzTTIt/0TMZkZxpDvLPpA
EzkdW2edtMhbTtqbGzjXgOsBVqnRZP6CaTfCba5tsVFOJ8XO+WL1ARQSDVKWPuob
uXT+s4sZIam0JjnrxGYCD5NTjQt4UUmxlyXxQLEwN90wMLs8DrQ5kxcMHUU6kjDT
7icQRtsuIXXzrj0AVie0/Vd1ItKjrIo3eMvpi8G3GtB5VXYB2RPGKY6/cMISYGbx
s7aJVlWOTrriO4p4vFiOI6iM1YOdinbgCbzTXK+aYJpw5TmG/V5sHfRQXu77HBll
8BZdC+s6v5MWSdB9qVyvnd/e97mfi+ySa4Lw4yeLJFz7OeuL8C1SeQWhTmWIkwn6
FjiLFoxzkkLUE8vxcAYIUuzFMPCUEeXjH8EoLBwFz4jDOTQ4FJqn61v9AEiJS4P4
mkgKdrvGqCSkZu6DpLgi0sGGAYu7ECCJLDcNTM6/S6o9AU9LcJJPgbd2wIylJyFY
D6ygG0D5skuKRsJ7I/VJLx5SI6rkfTqd+vXcVcEX7vuhFAap988haqxS4fsFb/0L
CeLwZH94Y9hAP7Rz/hDiwHKcV1S0eAFFEfZ3u7kmMM2+o7zePIeimHbjSDjSAts5
GhZV7UDFyy6RnhSYgTNHwOhZToEPPLbHOmTzNZNp3tiS3apvYe6Yx9fCspd63Cet
tW5Y0vCpHO0hJPIIv0ucVZsstn56SDBaYh70Fgq7M5UeK3AZ5KvH4cee4qd0KBgK
JZXBtIsoMICQj6Xw7ecmwPO5huh1EQ0cfqdSuEu+k2ifgnOMAPe85syK/d4yVxUB
wSj7Jk5r2Ytqe8ZXVoM4kYIKxVpuXmxb78KoUPvBUkLzqOMHwYpk2BjPQjZ8xqL7
oKQ8ywpm90SBB7DCgES7oIgrG5ZMovqVkNppdJ3TrvkdgWtctbGe/Pb1WapMamQ/
a99+zfc9k63hDV6GW7mM7AiTO5cqkOvYEYnJShTpszf0eiIe+smM/3As4HJstCx7
Wiej+lM/Rqxp81nP8R78+al6iyIdbHZ6LSxD5vKgZbhT3OQng0goZ3XQZXmIV/cZ
hVpPIEDgUzQi3qJq9POPejosLQZhU41kOcyDdLZmPm7OIRG7+b2X8JRbmhtg8FMA
szxT753uRpiGsKYb3dmOX9JYcDVbe9gFoIj2PktU2L96I9J79IVn9gtEeMYdR6Xn
w9rKgAyGiieepz5ygl9cRaGVFfLnesAB
=zBUs
-----END PGP MESSAGE-----

--c07--
</pre><a href="#section-9.11-8" class="pilcrow">Â¶</a>
</div>
<p id="section-9.11-9">Unwrapping the single-layer Cryptographic Envelope of this message yields the following MIME structure:<a href="#section-9.11-9" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.11-10">
<pre>
From: Alice Lovelace &lt;alice@openpgp.example&gt;
To: Bob Babbage &lt;bob@openpgp.example&gt;
Date: Mon, 21 Oct 2019 07:30:00 -0700
Subject: BarCorp contract signed, let's go!
Content-Type: multipart/mixed; boundary="6ae"; protected-headers="v1"
Message-ID: &lt;pgpmime-enc+legacy-disp@protected-headers.example&gt;

--6ae
content-type: text/plain; protected-headers="v1"
Content-Disposition: inline

Subject: BarCorp contract signed, let's go!

--6ae
Content-Type: text/plain; charset="us-ascii"

Hi Bob!

I just signed the contract with BarCorp and they've set us up with
an account on their system for testing.

The account information is:

        Site: https://barcorp.example/
    Username: examplecorptest
    Password: correct-horse-battery-staple

Please get the account set up and apply the test harness.

Let me know when you've got some results.

(this is the 'pgpmime-enc+legacy-disp' message)

Thanks, Alice
-- 
Alice Lovelace
President
Example Corp

--6ae--
</pre><a href="#section-9.11-10" class="pilcrow">Â¶</a>
</div>
</section>
</div>
<div id="an-unfortunately-complex-example">
<section id="section-9.12">
        <h3 id="name-an-unfortunately-complex-ex">
<a href="#section-9.12" class="section-number selfRef">9.12. </a><a href="#name-an-unfortunately-complex-ex" class="section-name selfRef">An Unfortunately Complex Example</a>
        </h3>
<p id="section-9.12-1">For all of the potential complexity of the Cryptographic Envelope, the Cryptographic Payload itself can be complex.
The Cryptographic Envelope in this example is the same as (<a href="#pgp-multilayer-legacy-display" class="xref">Section 9.8</a>).
The Cryptographic Payload has protected headers and a legacy display part (also the same as <a href="#pgp-multilayer-legacy-display" class="xref">Section 9.8</a>), but in addition Alice's MUA composes a message with both plaintext and HTML variants, and Alice includes a single attachment as well.<a href="#section-9.12-1" class="pilcrow">Â¶</a></p>
<p id="section-9.12-2">While this PGP/MIME message is complex, a modern MUA could also plausibly generate such a structure based on reasonable commands from the user composing the message (e.g., Alice composes the message with a rich text editor, and attaches a file to the message).<a href="#section-9.12-2" class="pilcrow">Â¶</a></p>
<p id="section-9.12-3">The key takeaway of this example is that the complexity of the Cryptographic Payload (which may contain a Legacy Display part) is independent of and distinct from the complexity of the Cryptographic Envelope.<a href="#section-9.12-3" class="pilcrow">Â¶</a></p>
<p id="section-9.12-4">This message has the following structure:<a href="#section-9.12-4" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.12-5">
<pre>
ââ¬â´multipart/encrypted
 âââ´application/pgp-encrypted
 âââ´application/octet-stream
  â§ (decrypts to)
  ââ¬â´multipart/signed
   ââ¬â´multipart/mixed â Cryptographic Payload
   ââââ´text/plain â Legacy Display Part
   âââ¬â´multipart/mixed
   â ââ¬â´multipart/alternative
   â ââââ´text/plain
   â ââââ´text/html
   â âââ´text/x-diff â attachment
   âââ´application/pgp-signature
</pre><a href="#section-9.12-5" class="pilcrow">Â¶</a>
</div>
<p id="section-9.12-6">For this message, the session key is an AES-256 key with value <code>1c489cfad9f3c0bf3214bf34e6da42b7f64005e59726baa1b17ffdefe6ecbb52</code> (in hex).<a href="#section-9.12-6" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.12-7">
<pre>
Received: from localhost (localhost [127.0.0.1]); Mon, 21 Oct 2019
 07:33:28 -0700 (UTC-07:00)
MIME-Version: 1.0
Content-Type: multipart/encrypted; boundary="241";
 protocol="application/pgp-encrypted"
From: Alice Lovelace &lt;alice@openpgp.example&gt;
To: Bob Babbage &lt;bob@openpgp.example&gt;
Date: Mon, 21 Oct 2019 07:33:00 -0700
Message-ID: &lt;unfortunately-complex@protected-headers.example&gt;
Subject: ...

--241
content-type: application/pgp-encrypted

Version: 1

--241
content-type: application/octet-stream

-----BEGIN PGP MESSAGE-----

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
=wxHa
-----END PGP MESSAGE-----

--241--
</pre><a href="#section-9.12-7" class="pilcrow">Â¶</a>
</div>
<p id="section-9.12-8">Unwrapping the encryption Cryptographic Layer yields the following content:<a href="#section-9.12-8" class="pilcrow">Â¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.12-9">
<pre>
Content-Type: multipart/signed; boundary="c72";
 protocol="application/pgp-signature"; micalg="pgp-sha512"

--c72
From: Alice Lovelace &lt;alice@openpgp.example&gt;
To: Bob Babbage &lt;bob@openpgp.example&gt;
Date: Mon, 21 Oct 2019 07:33:00 -0700
Subject: BarCorp contract signed, let's go!
Content-Type: multipart/mixed; boundary="6ae"; protected-headers="v1"
Message-ID: &lt;unfortunately-complex@protected-headers.example&gt;

--6ae
content-type: text/plain; protected-headers="v1"
Content-Disposition: inline

Subject: BarCorp contract signed, let's go!

--6ae
Content-Type: multipart/mixed; boundary="8df"

--8df
Content-Type: multipart/alternative; boundary="32c"

--32c
Content-Type: text/plain; charset="us-ascii"

Hi Bob!

I just signed the contract with BarCorp and they've set us up with
an account on their system for testing.

The account information is:

        Site: https://barcorp.example/
    Username: examplecorptest
    Password: correct-horse-battery-staple

Please get the account set up and apply the test harness.

Let me know when you've got some results.

(this is the 'unfortunately-complex' message)

Thanks, Alice
-- 
Alice Lovelace
President
Example Corp

--32c
Content-Type: text/html; charset="us-ascii"

&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;Hi Bob!
&lt;/p&gt;&lt;p&gt;
I just signed the contract with BarCorp and they've set us up with
 an account on their system for testing.
&lt;/p&gt;&lt;p&gt;
The account information is:
&lt;/p&gt;&lt;dl&gt;
&lt;dt&gt;Site&lt;/dt&gt;&lt;dd&gt;
&lt;a href="https://barcorp.example/"&gt;https://barcorp.example/&lt;/a&gt;
&lt;/dd&gt;
&lt;dt&gt;Username&lt;/dt&gt;&lt;dd&gt;&lt;tt&gt;examplecorptest&lt;/tt&gt;&lt;/dd&gt;
&lt;dt&gt;Password&lt;/dt&gt;&lt;dd&gt;correct-horse-battery-staple&lt;/dd&gt;
&lt;/dl&gt;&lt;p&gt;
Please get the account set up and apply the test harness.
&lt;/p&gt;&lt;p&gt;
Let me know when you've got some results.
&lt;/p&gt;&lt;p&gt;
(this is the 'unfortunately-complex' message)
&lt;/p&gt;&lt;p&gt;
Thanks, Alice&lt;br/&gt;
-- &lt;br/&gt;
Alice Lovelace&lt;br/&gt;
President&lt;br/&gt;
Example Corp&lt;br/&gt;
&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;

--32c--

--8df
Content-Type: text/x-diff; charset="us-ascii"
Content-Disposition: inline; filename="testharness-config.diff"

diff -ruN a/testharness.cfg b/testharness.cfg
--- a/testharness.cfg
+++ b/testharness.cfg
@@ -13,3 +13,8 @@
 endpoint = https://openpgp.example/test/
 username = testuser
 password = MJVMZlHR75mILg
+
+[barcorp]
+endpoint = https://barcorp.example/
+username = examplecorptest
+password = correct-horse-battery-staple

--8df--

--6ae--

--c72
content-type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----

wnUEARYKAB0FAl2twZwWIQTrhbtfozp14V6UTmPyMVUMT0fjjgAKCRDyMVUMT0fj
jnUTAP9YDBbjItEr14L3f/hpRDdkiexX96wHRZOZlP4VlsPbmgEA/zNQ5GZxOW70
EyF6maqK0Dedw/FXsbL32iFiXMGaTgY=
=EuL1
-----END PGP SIGNATURE-----

--c72--
</pre><a href="#section-9.12-9" class="pilcrow">Â¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-10-1">FIXME: register content-type parameter for legacy-display part<a href="#section-10-1" class="pilcrow">Â¶</a></p>
<p id="section-10-2">MAYBE: provide a list of user-facing headers, or a new "user-facing" column in some table of known RFC5322 headers?<a href="#section-10-2" class="pilcrow">Â¶</a></p>
<p id="section-10-3">MAYBE: provide a comparable indicator for which headers are "structural" ?<a href="#section-10-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-11">
      <h2 id="name-security-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-11-1">This document describes a technique that can be used to defend against two security vulnerabilities in traditional end-to-end encrypted e-mail.<a href="#section-11-1" class="pilcrow">Â¶</a></p>
<div id="subject-leak">
<section id="section-11.1">
        <h3 id="name-subject-leak">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-subject-leak" class="section-name selfRef">Subject Leak</a>
        </h3>
<p id="section-11.1-1">While e-mail structure considers the Subject header to be part of the message metadata, nearly all users consider the Subject header to be part of the message content.<a href="#section-11.1-1" class="pilcrow">Â¶</a></p>
<p id="section-11.1-2">As such, a user sending end-to-end encrypted e-mail may inadvertently leak sensitive material in the Subject line.<a href="#section-11.1-2" class="pilcrow">Â¶</a></p>
<p id="section-11.1-3">If the user's MUA uses Protected Headers and obscures the Subject header as described in <a href="#confidential-subject" class="xref">Section 4.2</a> then they can avoid this breach of confidentiality.<a href="#section-11.1-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="signature-replay">
<section id="section-11.2">
        <h3 id="name-signature-replay">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-signature-replay" class="section-name selfRef">Signature Replay</a>
        </h3>
<p id="section-11.2-1">A message without Protected Headers may be subject to a signature replay attack, which attempts to violate the recipient's expectations about message authenticity and integrity.
Such an attack works by taking a message delivered in one context (e.g., to someone else, at a different time, with a different subject, in reply to a different message), and replaying it with different message headers.<a href="#section-11.2-1" class="pilcrow">Â¶</a></p>
<p id="section-11.2-2">A MUA that generates all its signed messages with Protected Headers gives recipients the opportunity to avoid falling victim to this attack.<a href="#section-11.2-2" class="pilcrow">Â¶</a></p>
<p id="section-11.2-3">Guidance for how a message recipient can use Protected Headers to defend against a signature replay attack are out of scope for this document.<a href="#section-11.2-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="participant-modification">
<section id="section-11.3">
        <h3 id="name-participant-modification">
<a href="#section-11.3" class="section-number selfRef">11.3. </a><a href="#name-participant-modification" class="section-name selfRef">Participant Modification</a>
        </h3>
<p id="section-11.3-1">A trivial (if detectable) attack by an active network adversary is to insert an additional e-mail address in a <code>To</code> or <code>Cc</code> or <code>Reply-To</code> or <code>From</code> header.
This is a staging attack against message confidentiality - it relies on followup action by the recipient.<a href="#section-11.3-1" class="pilcrow">Â¶</a></p>
<p id="section-11.3-2">For an encrypted message that is part of an ongoing discussion where users are accustomed to doing "reply all", such an insertion would cause the replying MUA to encrypt the replying message to the additional party, giving them access to the conversation.
If the replying MUA quotes and attributes cleartext from the original message within the reply, then the attacker learns the contents of the encrypted message.<a href="#section-11.3-2" class="pilcrow">Â¶</a></p>
<p id="section-11.3-3">As certificate discovery becomes more automated and less noticeable to the end user, this is an increasing risk.<a href="#section-11.3-3" class="pilcrow">Â¶</a></p>
<p id="section-11.3-4">An MUA that rejects Exposed Headers in favor of Protected Headers should be able to avoid this attack when replying to a signed message.<a href="#section-11.3-4" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="privacy-considerations">
<section id="section-12">
      <h2 id="name-privacy-considerations">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy Considerations</a>
      </h2>
<p id="section-12-1">This document only explicitly contemplates confidentiality protection for the Subject header, but not for other headers which may leak associational metadata.
For example, <code>From</code> and <code>To</code> and <code>Cc</code> and <code>Reply-To</code> and <code>Date</code> and <code>Message-Id</code> and <code>References</code> and <code>In-Reply-To</code> are not explicitly necessary for messages in transit, since the SMTP envelope carries all necessary routing information, but an encrypted <span>[<a href="#RFC5322" class="xref">RFC5322</a>]</span> message as described in this document will contain all this associational metadata in the clear.<a href="#section-12-1" class="pilcrow">Â¶</a></p>
<p id="section-12-2">Although this document does not provide guidance for protecting the privacy of this metadata directly, it offers a platform upon which thoughtful implementations may experiment with obscuring additional e-mail headers.<a href="#section-12-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="document-considerations">
<section id="section-13">
      <h2 id="name-document-considerations">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-document-considerations" class="section-name selfRef">Document Considerations</a>
      </h2>
<p id="section-13-1">[ RFC Editor: please remove this section before publication ]<a href="#section-13-1" class="pilcrow">Â¶</a></p>
<p id="section-13-2">This document is currently edited as markdown.  Minor editorial changes can be suggested via merge requests at https://github.com/autocrypt/protected-headers or by e-mail to the authors.  Please direct all significant commentary to the public IETF LAMPS mailing list: spasm@ietf.org<a href="#section-13-2" class="pilcrow">Â¶</a></p>
<div id="document-history">
<section id="section-13.1">
        <h3 id="name-document-history">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-document-history" class="section-name selfRef">Document History</a>
        </h3>
<p id="section-13.1-1">Significant changes between version -01 and -02:<a href="#section-13.1-1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-13.1-2.1">Added S/MIME test vectors in addition to PGP/MIME<a href="#section-13.1-2.1" class="pilcrow">Â¶</a>
</li>
          <li id="section-13.1-2.2">Legacy Display parts should now be <code>text/plain</code> and not <code>text/rfc822-headers</code><a href="#section-13.1-2.2" class="pilcrow">Â¶</a>
</li>
          <li id="section-13.1-2.3">Cryptographic Payload must have <code>protected-headers</code> parameter set to <code>v1</code><a href="#section-13.1-2.3" class="pilcrow">Â¶</a>
</li>
          <li id="section-13.1-2.4">Test vector sample Message-Ids have been normalized<a href="#section-13.1-2.4" class="pilcrow">Â¶</a>
</li>
          <li id="section-13.1-2.5">Added encrypted-only (unsigned) test vectors, at the suggestion of Russ Housley<a href="#section-13.1-2.5" class="pilcrow">Â¶</a>
</li>
        </ul>
<p id="section-13.1-3">Changes between version -00 and -01:<a href="#section-13.1-3" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-13.1-4.1">Credit Randall for "correct horse battery staple".<a href="#section-13.1-4.1" class="pilcrow">Â¶</a>
</li>
          <li id="section-13.1-4.2">Adjust test vectors to ensure no line in the generated .txt format exceeds 72 chars.<a href="#section-13.1-4.2" class="pilcrow">Â¶</a>
</li>
          <li id="section-13.1-4.3">Minor formatting cleanup to appease idnits.<a href="#section-13.1-4.3" class="pilcrow">Â¶</a>
</li>
          <li id="section-13.1-4.4">Update references to more recent documents (RFC 2822 -&gt; 5322, -00 to -01 of draft-ietf-lamps-header-protection-requirements).<a href="#section-13.1-4.4" class="pilcrow">Â¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="acknowledgements">
<section id="section-14">
      <h2 id="name-acknowledgements">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-14-1">The set of constructs and algorithms in this document has a previous working title of "Memory Hole", but that title is no longer used as different implementations gained experience in working with it.<a href="#section-14-1" class="pilcrow">Â¶</a></p>
<p id="section-14-2">These ideas were tested and fine-tuned in part by the loose collaboration of MUA developers known as <span>[<a href="#Autocrypt" class="xref">Autocrypt</a>]</span>.<a href="#section-14-2" class="pilcrow">Â¶</a></p>
<p id="section-14-3">Additional feedback and useful guidance was contributed by attendees of the OpenPGP e-mail summit (<span>[<a href="#OpenPGP-Email-Summit-2019" class="xref">OpenPGP-Email-Summit-2019</a>]</span>).<a href="#section-14-3" class="pilcrow">Â¶</a></p>
<p id="section-14-4">The following people have contributed implementation experience, documentation, critique, and other feedback:<a href="#section-14-4" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-14-5.1">Holger Krekel<a href="#section-14-5.1" class="pilcrow">Â¶</a>
</li>
        <li id="section-14-5.2">Patrick Brunschwig<a href="#section-14-5.2" class="pilcrow">Â¶</a>
</li>
        <li id="section-14-5.3">Vincent Breitmoser<a href="#section-14-5.3" class="pilcrow">Â¶</a>
</li>
        <li id="section-14-5.4">Edwin Taylor<a href="#section-14-5.4" class="pilcrow">Â¶</a>
</li>
        <li id="section-14-5.5">Alexey Melnikov<a href="#section-14-5.5" class="pilcrow">Â¶</a>
</li>
        <li id="section-14-5.6">Russ Housley<a href="#section-14-5.6" class="pilcrow">Â¶</a>
</li>
      </ul>
<p id="section-14-6">The password example used in <a href="#test-vectors" class="xref">Section 9</a> comes from <span>[<a href="#xkcd936" class="xref">xkcd936</a>]</span>.<a href="#section-14-6" class="pilcrow">Â¶</a></p>
</section>
</div>
<section id="section-15">
      <h2 id="name-references">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-15.1">
        <h3 id="name-normative-references">
<a href="#section-15.1" class="section-number selfRef">15.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dt id="RFC3156">[RFC3156]</dt>
        <dd>
<span class="refAuthor">Elkins, M.</span><span class="refAuthor">, Del Torto, D.</span><span class="refAuthor">, Levien, R.</span><span class="refAuthor">, and T. Roessler</span>, <span class="refTitle">"MIME Security with OpenPGP"</span>, <span class="seriesInfo">RFC 3156</span>, <span class="seriesInfo">DOI 10.17487/RFC3156</span>, <time datetime="2001-08">August 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3156">https://www.rfc-editor.org/info/rfc3156</a>&gt;</span>. </dd>
<dt id="RFC4880">[RFC4880]</dt>
        <dd>
<span class="refAuthor">Callas, J.</span><span class="refAuthor">, Donnerhacke, L.</span><span class="refAuthor">, Finney, H.</span><span class="refAuthor">, Shaw, D.</span><span class="refAuthor">, and R. Thayer</span>, <span class="refTitle">"OpenPGP Message Format"</span>, <span class="seriesInfo">RFC 4880</span>, <span class="seriesInfo">DOI 10.17487/RFC4880</span>, <time datetime="2007-11">November 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4880">https://www.rfc-editor.org/info/rfc4880</a>&gt;</span>. </dd>
<dt id="RFC5322">[RFC5322]</dt>
        <dd>
<span class="refAuthor">Resnick, P., Ed.</span>, <span class="refTitle">"Internet Message Format"</span>, <span class="seriesInfo">RFC 5322</span>, <span class="seriesInfo">DOI 10.17487/RFC5322</span>, <time datetime="2008-10">October 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5322">https://www.rfc-editor.org/info/rfc5322</a>&gt;</span>. </dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
</dl>
</section>
<section id="section-15.2">
        <h3 id="name-informative-references">
<a href="#section-15.2" class="section-number selfRef">15.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="Autocrypt">[Autocrypt]</dt>
        <dd>
<span class="refTitle">"Autocrypt Specification 1.1"</span>, <time datetime="2019-10-13">13 October 2019</time>, <span>&lt;<a href="https://autocrypt.org/level1.html">https://autocrypt.org/level1.html</a>&gt;</span>. </dd>
<dt id="I-D.draft-bre-openpgp-samples-00">[I-D.draft-bre-openpgp-samples-00]</dt>
        <dd>
<span class="refAuthor">Einarsson, B.</span><span class="refAuthor">, juga, j.</span><span class="refAuthor">, and D. Gillmor</span>, <span class="refTitle">"OpenPGP Example Keys and Certificates"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-bre-openpgp-samples-00</span>, <time datetime="2019-10-15">15 October 2019</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-bre-openpgp-samples-00.txt">http://www.ietf.org/internet-drafts/draft-bre-openpgp-samples-00.txt</a>&gt;</span>. </dd>
<dt id="I-D.draft-dkg-lamps-samples-01">[I-D.draft-dkg-lamps-samples-01]</dt>
        <dd>
<span class="refAuthor">Gillmor, D.</span>, <span class="refTitle">"S/MIME Example Keys and Certificates"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-dkg-lamps-samples-01</span>, <time datetime="2019-11-20">20 November 2019</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-dkg-lamps-samples-01.txt">http://www.ietf.org/internet-drafts/draft-dkg-lamps-samples-01.txt</a>&gt;</span>. </dd>
<dt id="I-D.draft-ietf-lamps-header-protection-requirements-01">[I-D.draft-ietf-lamps-header-protection-requirements-01]</dt>
        <dd>
<span class="refAuthor">Melnikov, A.</span><span class="refAuthor"> and B. Hoeneisen</span>, <span class="refTitle">"Problem Statement and Requirements for Header Protection"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lamps-header-protection-requirements-01</span>, <time datetime="2019-10-29">29 October 2019</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lamps-header-protection-requirements-01.txt">http://www.ietf.org/internet-drafts/draft-ietf-lamps-header-protection-requirements-01.txt</a>&gt;</span>. </dd>
<dt id="I-D.draft-luck-lamps-pep-header-protection-03">[I-D.draft-luck-lamps-pep-header-protection-03]</dt>
        <dd>
<span class="refAuthor">Luck, C.</span>, <span class="refTitle">"pretty Easy privacy (pEp): Progressive Header Disclosure"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-luck-lamps-pep-header-protection-03</span>, <time datetime="2019-07-05">5 July 2019</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-luck-lamps-pep-header-protection-03.txt">http://www.ietf.org/internet-drafts/draft-luck-lamps-pep-header-protection-03.txt</a>&gt;</span>. </dd>
<dt id="OpenPGP-Email-Summit-2019">[OpenPGP-Email-Summit-2019]</dt>
        <dd>
<span class="refTitle">"OpenPGP Email Summit 2019"</span>, <time datetime="2019-10-13">13 October 2019</time>, <span>&lt;<a href="https://wiki.gnupg.org/OpenPGPEmailSummit201910">https://wiki.gnupg.org/OpenPGPEmailSummit201910</a>&gt;</span>. </dd>
<dt id="RFC2634">[RFC2634]</dt>
        <dd>
<span class="refAuthor">Hoffman, P., Ed.</span>, <span class="refTitle">"Enhanced Security Services for S/MIME"</span>, <span class="seriesInfo">RFC 2634</span>, <span class="seriesInfo">DOI 10.17487/RFC2634</span>, <time datetime="1999-06">June 1999</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2634">https://www.rfc-editor.org/info/rfc2634</a>&gt;</span>. </dd>
<dt id="RFC3274">[RFC3274]</dt>
        <dd>
<span class="refAuthor">Gutmann, P.</span>, <span class="refTitle">"Compressed Data Content Type for Cryptographic Message Syntax (CMS)"</span>, <span class="seriesInfo">RFC 3274</span>, <span class="seriesInfo">DOI 10.17487/RFC3274</span>, <time datetime="2002-06">June 2002</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3274">https://www.rfc-editor.org/info/rfc3274</a>&gt;</span>. </dd>
<dt id="RFC3851">[RFC3851]</dt>
        <dd>
<span class="refAuthor">Ramsdell, B., Ed.</span>, <span class="refTitle">"Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.1 Message Specification"</span>, <span class="seriesInfo">RFC 3851</span>, <span class="seriesInfo">DOI 10.17487/RFC3851</span>, <time datetime="2004-07">July 2004</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3851">https://www.rfc-editor.org/info/rfc3851</a>&gt;</span>. </dd>
<dt id="RFC6736">[RFC6736]</dt>
        <dd>
<span class="refAuthor">Brockners, F.</span><span class="refAuthor">, Bhandari, S.</span><span class="refAuthor">, Singh, V.</span><span class="refAuthor">, and V. Fajardo</span>, <span class="refTitle">"Diameter Network Address and Port Translation Control Application"</span>, <span class="seriesInfo">RFC 6736</span>, <span class="seriesInfo">DOI 10.17487/RFC6736</span>, <time datetime="2012-10">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6736">https://www.rfc-editor.org/info/rfc6736</a>&gt;</span>. </dd>
<dt id="RFC7508">[RFC7508]</dt>
        <dd>
<span class="refAuthor">Cailleux, L.</span><span class="refAuthor"> and C. Bonatti</span>, <span class="refTitle">"Securing Header Fields with S/MIME"</span>, <span class="seriesInfo">RFC 7508</span>, <span class="seriesInfo">DOI 10.17487/RFC7508</span>, <time datetime="2015-04">April 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7508">https://www.rfc-editor.org/info/rfc7508</a>&gt;</span>. </dd>
<dt id="RFC8551">[RFC8551]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span><span class="refAuthor">, Ramsdell, B.</span><span class="refAuthor">, and S. Turner</span>, <span class="refTitle">"Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 4.0 Message Specification"</span>, <span class="seriesInfo">RFC 8551</span>, <span class="seriesInfo">DOI 10.17487/RFC8551</span>, <time datetime="2019-04">April 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8551">https://www.rfc-editor.org/info/rfc8551</a>&gt;</span>. </dd>
<dt id="xkcd936">[xkcd936]</dt>
      <dd>
<span class="refAuthor">Munroe, R.</span>, <span class="refTitle">"xkcd: Password Strength"</span>, <time datetime="2011-08-10">10 August 2011</time>, <span>&lt;<a href="https://www.xkcd.com/936/">https://www.xkcd.com/936/</a>&gt;</span>. </dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="section-appendix.a">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Bjarni RÃºnar Einarsson</span></div>
<div dir="auto" class="left"><span class="org">Mailpile ehf</span></div>
<div dir="auto" class="left"><span class="street-address">Baronsstigur</span></div>
<div dir="auto" class="left"><span class="country-name">Iceland</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:bre@mailpile.is" class="email">bre@mailpile.is</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">juga</span></div>
<div dir="auto" class="left"><span class="org">Independent</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:juga@riseup.net" class="email">juga@riseup.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Daniel Kahn Gillmor</span></div>
<div dir="auto" class="left"><span class="org">American Civil Liberties Union</span></div>
<div dir="auto" class="left"><span class="street-address">125 Broad St.</span></div>
<div dir="auto" class="left">
<span class="locality">New York, NY</span>,  <span class="postal-code">10004</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:dkg@fifthhorseman.net" class="email">dkg@fifthhorseman.net</a>
</div>
</address>
</section>
</div>
<script>var toc = document.getElementById("toc");
var tocToggle = toc.querySelector("h2");
var tocNav = toc.querySelector("nav");

// mobile menu toggle
tocToggle.onclick = function(event) {
    if (window.innerWidth < 1024) {
 var tocNavDisplay = tocNav.currentStyle ? tocNav.currentStyle.display : getComputedStyle(tocNav, null).display;
 if (tocNavDisplay == "none") {
     tocNav.style.display = "block";
 } else {
     tocNav.style.display = "none";
 }
    }
}

// toc anchor scroll to anchor
tocNav.addEventListener("click", function (event) {
    event.preventDefault();
    if (event.target.nodeName == 'A') {
 if (window.innerWidth < 1024) {
     tocNav.style.display = "none";
 }
 var href = event.target.getAttribute("href");
 var anchorId = href.substr(1);
 var anchor =  document.getElementById(anchorId);
 anchor.scrollIntoView(true);
 window.history.pushState("","",href);
    }
});

// switch toc mode when window resized
window.onresize = function () {
    if (window.innerWidth < 1024) {
 tocNav.style.display = "none";
    } else {
 tocNav.style.display = "block";
    }
}
</script>
</body>
</html>
