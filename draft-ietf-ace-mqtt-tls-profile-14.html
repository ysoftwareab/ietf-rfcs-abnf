<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Message Queuing Telemetry Transport (MQTT)-TLS profile of Authentication and Authorization for Constrained Environments (ACE) Framework</title>
<meta content="Cigdem Sengul" name="author">
<meta content="Anthony Kirby" name="author">
<meta content="
       
                This document specifies a profile for the ACE (Authentication and Authorization for Constrained
                Environments) framework to enable authorization in a Message Queuing Telemetry Transport
                (MQTT)-based publish-subscribe messaging system.
                Proof-of-possession keys, bound to OAuth2.0 access tokens, are used to authenticate and authorize
                MQTT Clients. The protocol relies on TLS for confidentiality and MQTT server (broker) authentication.
       
    " name="description">
<meta content="xml2rfc 3.12.2" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-ace-mqtt-tls-profile-14" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.2
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.7.1
    pycountry 22.1.10
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.27.1
    setuptools 59.6.0
    six 1.16.0
    WeasyPrint 52.5
-->
<link href="/tmp/draft-ietf-ace-mqtt-tls-profile-dtjvdhhx.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">MQTT-TLS profile of ACE</td>
<td class="right">February 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Sengul &amp; Kirby</td>
<td class="center">Expires 21 August 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">ACE Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-ace-mqtt-tls-profile-14</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-02-17" class="published">17 February 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-08-21">21 August 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">C.S. Sengul</div>
<div class="org">Brunel University</div>
</div>
<div class="author">
      <div class="author-name">A.K. Kirby</div>
<div class="org">Oxbotica</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Message Queuing Telemetry Transport (MQTT)-TLS profile of Authentication and Authorization for Constrained Environments (ACE) Framework</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">
                This document specifies a profile for the ACE (Authentication and Authorization for Constrained
                Environments) framework to enable authorization in a Message Queuing Telemetry Transport
                (MQTT)-based publish-subscribe messaging system.
                Proof-of-possession keys, bound to OAuth2.0 access tokens, are used to authenticate and authorize
                MQTT Clients. The protocol relies on TLS for confidentiality and MQTT server (broker) authentication.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo-2">
<a href="#name-status-of-this-memo-2" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 21 August 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice-2">
<a href="#name-copyright-notice-2" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents-2">
<a href="#name-table-of-contents-2" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction-2" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-requirements-language" class="xref">Requirements Language</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-ace-related-terminology" class="xref">ACE-Related Terminology</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="xref">1.3</a>.  <a href="#name-mqtt-related-terminology" class="xref">MQTT-Related Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-authorizing-connection-requ" class="xref">Authorizing Connection Requests</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-client-token-request-to-the" class="xref">Client Token Request to the Authorization Server (AS)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-client-connection-request-t" class="xref">Client Connection Request to the Broker (C)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1"><a href="#section-2.2.1" class="xref">2.2.1</a>.  <a href="#name-overview-of-client-rs-authe" class="xref">Overview of Client-RS Authentication Methods over TLS and MQTT</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a href="#section-2.2.2" class="xref">2.2.2</a>.  <a href="#name-authz-info-the-authorizatio" class="xref">authz-info: The Authorization Information Topic</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3">
                    <p id="section-toc.1-1.2.2.2.2.3.1"><a href="#section-2.2.3" class="xref">2.2.3</a>.  <a href="#name-client-authentication-over-" class="xref">Client Authentication over TLS</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3.2.1">
                        <p id="section-toc.1-1.2.2.2.2.3.2.1.1"><a href="#section-2.2.3.1" class="xref">2.2.3.1</a>.  <a href="#name-raw-public-key-mode" class="xref">Raw Public Key Mode</a></p>
</li>
                      <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3.2.2">
                        <p id="section-toc.1-1.2.2.2.2.3.2.2.1"><a href="#section-2.2.3.2" class="xref">2.2.3.2</a>.  <a href="#name-pre-shared-key-mode" class="xref">Pre-Shared Key Mode</a></p>
</li>
                    </ul>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4">
                    <p id="section-toc.1-1.2.2.2.2.4.1"><a href="#section-2.2.4" class="xref">2.2.4</a>.  <a href="#name-client-authentication-over-m" class="xref">Client Authentication over MQTT</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4.2.1">
                        <p id="section-toc.1-1.2.2.2.2.4.2.1.1"><a href="#section-2.2.4.1" class="xref">2.2.4.1</a>.  <a href="#name-transporting-the-access-tok" class="xref">Transporting the Access Token Inside the MQTT CONNECT</a></p>
</li>
                      <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4.2.2">
                        <p id="section-toc.1-1.2.2.2.2.4.2.2.1"><a href="#section-2.2.4.2" class="xref">2.2.4.2</a>.  <a href="#name-authentication-using-auth-p" class="xref">Authentication Using AUTH Property</a></p>
</li>
                    </ul>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.5">
                    <p id="section-toc.1-1.2.2.2.2.5.1"><a href="#section-2.2.5" class="xref">2.2.5</a>.  <a href="#name-broker-token-validation" class="xref">Broker Token Validation</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-token-scope-and-authorizati" class="xref">Token Scope and Authorization</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="xref">2.4</a>.  <a href="#name-broker-response-to-client-c" class="xref">Broker Response to Client Connection Request</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4.2.1">
                    <p id="section-toc.1-1.2.2.4.2.1.1"><a href="#section-2.4.1" class="xref">2.4.1</a>.  <a href="#name-unauthorized-request-and-th" class="xref">Unauthorized Request and the Optional Authorization Server Discovery</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4.2.2">
                    <p id="section-toc.1-1.2.2.4.2.2.1"><a href="#section-2.4.2" class="xref">2.4.2</a>.  <a href="#name-authorization-success" class="xref">Authorization Success</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-authorizing-publish-and-sub" class="xref">Authorizing PUBLISH and SUBSCRIBE Packets</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-publish-packets-from-the-pu" class="xref">PUBLISH Packets from the Publisher Client to the Broker</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-publish-packets-from-the-br" class="xref">PUBLISH Packets from the Broker to the Subscriber Clients</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-authorizing-subscribe-packe" class="xref">Authorizing SUBSCRIBE Packets</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-token-expiration-update-and" class="xref">Token Expiration, Update and Reauthentication</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-handling-disconnections-and" class="xref">Handling Disconnections and Retained Messages</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-reduced-protocol-interactio" class="xref">Reduced Protocol Interactions for MQTT v3.1.1</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-token-transport" class="xref">Token Transport</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-handling-authorization-erro" class="xref">Handling Authorization Errors</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-iana-considerations-2" class="xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-tls-exporter-label-registra" class="xref">TLS Exporter Label Registration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-media-type-registration" class="xref">Media Type Registration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-ace-oauth-profile-registrat" class="xref">ACE OAuth Profile Registration</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-considerations-2" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-privacy-considerations" class="xref">Privacy Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-references-2" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-normative-references-2" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-informative-references-2" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-checklist-for-profile-requi" class="xref">Checklist for profile requirements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-B" class="xref">Appendix B</a>.  <a href="#name-document-updates" class="xref">Document Updates</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-C" class="xref"></a><a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-D" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction-2">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction-2" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">
                This document specifies a profile for the ACE framework <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.
                In this profile, Clients and Servers (Brokers) use MQTT to exchange Application Messages.
                The protocol relies on TLS for communication security between entities. The MQTT protocol interactions
                are described based on the <span><a href="#MQTT-OASIS-Standard-v5" class="xref">MQTT v5.0 - the OASIS Standard</a> [<a href="#MQTT-OASIS-Standard-v5" class="xref">MQTT-OASIS-Standard-v5</a>]</span>.
                Since it is expected that MQTT deployments will continue to support MQTT v3.1.1 clients,
         this document also describes a reduced set of protocol interactions for
                <span><a href="#MQTT-OASIS-Standard" class="xref">MQTT v3.1.1 - the OASIS Standard</a> [<a href="#MQTT-OASIS-Standard" class="xref">MQTT-OASIS-Standard</a>]</span>.
         However, MQTT v5.0 is the RECOMMENDED version as it works more naturally
                with ACE-style authentication and authorization.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">
                MQTT is a publish-subscribe protocol, and
                after connecting to the MQTT Server (Broker), a Client can publish and subscribe to multiple topics.
                The Broker, which acts as the Resource Server (RS), is responsible for distributing messages published 
                by the publishers to their subscribers. In the rest of the
                document, the terms "RS", "MQTT Server" and "Broker" are used interchangeably.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">
                Messages are published under a Topic Name,
                and subscribers subscribe to the Topic Names to receive the corresponding messages.
                The Broker uses the Topic Name in a published message to determine which
                subscribers to relay the messages to.
                In this document, topics, more specifically, Topic Names, are treated as resources.
                The Clients are assumed to have identified the publish/subscribe topics of interest out-of-band
                (topic discovery is not a feature of the MQTT protocol).
                A Resource Owner can pre-configure policies at the Authorization Server (AS) 
                that give Clients publish or subscribe permissions to different topics.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">
                Clients prove their permission to publish and subscribe to topics hosted on an MQTT broker
                using an access token, bound to a proof-of-possession (PoP) key.
                This document describes how to authorize the following exchanges between the
                Clients and the Broker.<a href="#section-1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-5.1">Connection requests from the Clients to the Broker<a href="#section-1-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-5.2">Publish requests from the Clients to the Broker and from the Broker to the Clients<a href="#section-1-5.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-5.3">Subscribe requests from the Clients to the Broker<a href="#section-1-5.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-1-6">
                Clients use the MQTT PUBLISH packet to publish to a topic.
                This document does not protect the payload of the PUBLISH packet from the Broker. Hence,
                the payload is not signed or encrypted specifically for the subscribers. This functionality may 
                be implemented using the proposal outlined in the 
                <span><a href="#I-D.ietf-ace-pubsub-profile" class="xref">ACE Pub-Sub Profile</a> [<a href="#I-D.ietf-ace-pubsub-profile" class="xref">I-D.ietf-ace-pubsub-profile</a>]</span>.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">
                To provide communication confidentiality and Broker authentication to the MQTT clients, TLS is used, and
                TLS 1.3 <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span> is RECOMMENDED. This document makes the same assumptions as Section 4 of the
         <span><a href="#I-D.ietf-ace-oauth-authz" class="xref">ACE framework</a> [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span> regarding Client and RS
                registration with the AS and setting up the keying material.
                While the Client-Broker exchanges are only over MQTT, the required Client-AS and
                RS-AS interactions are described for HTTPS-based communication <span>[<a href="#RFC7230" class="xref">RFC7230</a>]</span>, 
                using 'application/ace+json'
                content type, and unless otherwise specified, using JSON encoding. The token MAY be a
                reference or JSON Web Token (JWT) <span>[<a href="#RFC7519" class="xref">RFC7519</a>]</span>.
                For JWTs, this document follows <span>[<a href="#RFC7800" class="xref">RFC7800</a>]</span>
                for PoP semantics for JWTs, and the mechanisms for providing and verifying proof-of-possession
                are detailed in  <a href="#connect_v5" class="xref">Section 2.2</a>. The Client-AS and RS-AS MAY also use protocols other than HTTP,
                e.g. Constrained Application Protocol (CoAP) <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> or MQTT; it is recommended
                that TLS is used to secure these communication channels between Client-AS and RS-AS.
                Implementations MAY also use "application/ace+cbor" content type, and CBOR encoding <span>[<a href="#RFC8949" class="xref">RFC8949</a>]</span>, and
                CBOR Web Token (CWT) <span>[<a href="#RFC8392" class="xref">RFC8392</a>]</span> and associated PoP semantics to reduce the protocol memory and bandwidth
                requirements.  For more information, see <span><a href="#RFC8747" class="xref">Proof-of-Possession Key
                Semantics for CBOR Web Tokens (CWTs)</a> [<a href="#RFC8747" class="xref">RFC8747</a>]</span>.  
                A JWT token uses JOSE, while a CWT token uses COSE <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span> for security protection.<a href="#section-1-7" class="pilcrow">¶</a></p>
<section id="section-1.1">
        <h3 id="name-requirements-language">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-requirements-language" class="section-name selfRef">Requirements Language</a>
        </h3>
<p id="section-1.1-1">
                    The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
                    "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",  "MAY", and "OPTIONAL" in this
                    document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span>,
                     when, and only when, they appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-1.2">
        <h3 id="name-ace-related-terminology">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-ace-related-terminology" class="section-name selfRef">ACE-Related Terminology</a>
        </h3>
<p id="section-1.2-1">
                    Certain security-related terms such as "authentication", "authorization", "confidentiality", "(data)
                    integrity", "message authentication code", and "verify" are taken from  <span>[<a href="#RFC4949" class="xref">RFC4949</a>]</span>.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">
                    The terminology for entities in the architecture is defined in OAuth 2.0 <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span> such as "Client" (C),
                     "Resource Server" (RS) and "Authorization Server" (AS).<a href="#section-1.2-2" class="pilcrow">¶</a></p>
<p id="section-1.2-3">
                    The term "resource" is used to refer to an MQTT Topic Name, which is defined in <a href="#mqtt-defs" class="xref">Section 1.3</a>.
                    Hence, the "Resource Owner" is any entity that can authoritatively speak for the topic.
                    This document also defines a Client Authorization Server for Clients that are not 
                    able to support HTTP.<a href="#section-1.2-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-1.2-4">
          <dt id="section-1.2-4.1">Client Authorization Server (CAS)</dt>
          <dd style="margin-left: 4.0em" id="section-1.2-4.2">
                  An entity that prepares and endorses authentication and authorization data for a Client, 
                  and communicates using HTTPS to the AS.<a href="#section-1.2-4.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
<div id="mqtt-defs">
<section id="section-1.3">
        <h3 id="name-mqtt-related-terminology">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-mqtt-related-terminology" class="section-name selfRef">MQTT-Related Terminology</a>
        </h3>
<p id="section-1.3-1">
                    The document describes message exchanges as MQTT protocol interactions. The Clients are MQTT Clients,
                    which connect to the Broker to publish and subscribe to Application Messages, labelled
                    with their topics. For additional information,
                    please refer to the <span><a href="#MQTT-OASIS-Standard-v5" class="xref">MQTT v5.0
                     - the OASIS Standard</a> [<a href="#MQTT-OASIS-Standard-v5" class="xref">MQTT-OASIS-Standard-v5</a>]</span> or the <span><a href="#MQTT-OASIS-Standard" class="xref">MQTT v3.1.1
                      - the OASIS Standard</a> [<a href="#MQTT-OASIS-Standard" class="xref">MQTT-OASIS-Standard</a>]</span>.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-1.3-2">
          <dt id="section-1.3-2.1">MQTTS</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-2.2">
                            Secured transport profile of MQTT.  MQTTS runs over TLS.<a href="#section-1.3-2.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.3">Broker</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-2.4">
                            The Server in MQTT. It acts as an intermediary between the Clients that publish Application Messages
                            and the Clients that made Subscriptions. The Broker acts as the Resource Server for the Clients.<a href="#section-1.3-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.5">Client</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-2.6">
                            A device or program that uses MQTT.<a href="#section-1.3-2.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.7">Session</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-2.8">
                            A stateful interaction between a Client and a Broker.
                            Some Sessions last only as long as the network connection;
                            others can span multiple network connections.<a href="#section-1.3-2.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.9">Application Message</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-2.10">
                            The data carried by the MQTT protocol. The data has an associated Quality-of-Service (QoS) level and Topic
                            Name.<a href="#section-1.3-2.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.11">MQTT Control Packet</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-2.12">
                           The MQTT protocol operates by exchanging a series of MQTT Control packets.
                           Each packet is composed of a Fixed Header, a Variable Header (depending
                           on the control packet type) and a Payload.<a href="#section-1.3-2.12" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.13">UTF-8 encoded string</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-2.14">
                            A string prefixed with a two-byte length field that gives the number of bytes in a UTF-8 encoded string itself.
                            Unless stated otherwise, all UTF-8 encoded strings can have any length in the range 0 to 65535 bytes.<a href="#section-1.3-2.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.15">Binary Data</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-2.16">
                            Binary Data is represented by a two-byte length field which indicates the number of data bytes, followed by that number of bytes. 
                            Thus, the length of Binary Data is limited to the range of 0 to 65,535 Bytes.<a href="#section-1.3-2.16" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.17">Variable Byte Integer</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-2.18">
                            Variable Byte Integer is encoded using an encoding scheme that uses a single byte for values up to 127. 
                            For larger values, the least significant seven bits of each byte encode the data, 
                            and the most significant bit is used to indicate whether there are bytes following in
                            the representation. Thus, each byte encodes 128 values and a "continuation bit". 
                            The maximum number of bytes in the Variable Byte Integer field is four.<a href="#section-1.3-2.18" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.19">QoS level</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-2.20">
                            The level of assurance for the delivery of an Application Message. The QoS level can be 0-2,
                            where 0 indicates "At most once delivery", 1 "At least once delivery", and 2 "Exactly once delivery".<a href="#section-1.3-2.20" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.21">Property</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-2.22">
                            The last field of the Variable Header is a set of properties
                            for several MQTT control packets (e.g. CONNECT, CONNACK).
                            A Property consists of an Identifier that defines its usage and data type, followed by a value.
                            The Identifier is encoded as a Variable Byte Integer. For example, the "Authentication Data" property
                            uses the Identifier 22.<a href="#section-1.3-2.22" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.23">Topic Name</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-2.24">
                            The label attached to an Application Message, which is matched to a Subscription.<a href="#section-1.3-2.24" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.25">Subscription</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-2.26">
                            A Subscription comprises a Topic Filter and a maximum QoS. A Subscription is associated with a single session.<a href="#section-1.3-2.26" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.27">Topic Filter</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-2.28">
                            An expression that indicates interest in one or more Topic Names. Topic Filters may include
                            wildcards.<a href="#section-1.3-2.28" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-1.3-3">
                    MQTT sends various control packets across a network connection.
                    The following is not an exhaustive list, and the control packets that are not relevant for
                    authorization are not explained.
                    These include, for instance, the PUBREL and PUBCOMP packets used in the 4-step handshake required
                    for QoS level 2.<a href="#section-1.3-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-1.3-4">
          <dt id="section-1.3-4.1">CONNECT</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-4.2">
                            Client request to connect to the Broker. This is
                            the first packet sent by a Client.<a href="#section-1.3-4.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.3">CONNACK</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-4.4">
                            The Broker connection acknowledgment. CONNACK packets
                            contain return codes indicating either a success or an error state
                            in response to a Client's CONNECT packet.<a href="#section-1.3-4.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.5">AUTH</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-4.6">
                            Authentication Exchange. An AUTH control packet is sent from the Client to the Broker or
                            from the Broker to the Client as part of an extended authentication exchange.
                            AUTH Properties include Authentication Method and Authentication Data.
                            The Authentication Method is set in the CONNECT packet, and consequent
                            AUTH packets follow the same Authentication Method.
                            The contents of the Authentication Data are defined by the Authentication Method.<a href="#section-1.3-4.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.7">PUBLISH</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-4.8">
                            Publish request sent from a publishing Client to the Broker, or from the Broker to a
                            subscribing Client.<a href="#section-1.3-4.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.9">PUBACK</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-4.10">
                            Response to a PUBLISH request with QoS level 1. A PUBACK can be sent from the Broker to a
                            Client or from a Client to the Broker.<a href="#section-1.3-4.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.11">PUBREC</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-4.12">
                            Response to PUBLISH request with QoS level 2. PUBREC can be sent from the Broker to a
                            Client or from a Client to the Broker.<a href="#section-1.3-4.12" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.13">SUBSCRIBE</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-4.14">
                            Subscribe request sent from a Client.<a href="#section-1.3-4.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.15">SUBACK</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-4.16">
                            Subscribe acknowledgment.<a href="#section-1.3-4.16" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.17">PINGREQ</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-4.18">
                 A ping request sent from a Client to the Broker.  It signals to the Broker that the Client is alive and
                 is used to confirm that the Broker is also alive. The "Keep Alive" period is set in the CONNECT packet.<a href="#section-1.3-4.18" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.19">PINGRESP</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-4.20">
                 Response sent by the Broker to the Client in response to PINGREQ. It indicates the Broker is alive.<a href="#section-1.3-4.20" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.21">Will</dt>
          <dd style="margin-left: 4.0em" id="section-1.3-4.22">
                            If the network connection is not closed normally, the Broker sends a last Will message
                            for the Client if the Client provided one in its CONNECT packet.
                            If the Will Flag is set in the CONNECT flags, then the payload of the CONNECT packet includes information
                            about the Will. The information consists of the Will Properties, Will Topic,
                            and Will Payload fields.<a href="#section-1.3-4.22" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
<div id="token_acquisition">
<section id="section-2">
      <h2 id="name-authorizing-connection-requ">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-authorizing-connection-requ" class="section-name selfRef">Authorizing Connection Requests</a>
      </h2>
<p id="section-2-1">
            This section specifies how Client connections are authorized by the AS, 
            and verified by the MQTT Broker. <a href="#protocol_flow" class="xref">Figure 1</a> shows the basic protocol flow 
            during connection setup. The token request and response use the token endpoint 
            at the AS, specified for HTTP-based interactions in Section 5.8 of the <span><a href="#I-D.ietf-ace-oauth-authz" class="xref">ACE framework</a> [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. 
            Steps (D) and (E) are optional and use the introspection endpoint specified in Section 5.9 of the ACE framework.
            The discussion in this document assumes that the Client and the Broker use HTTPS to communicate 
            with the AS via these endpoints. The Client and the Broker use MQTT to communicate between them.
            The C-AS and Broker-AS communication MAY be implemented using protocols other than HTTPS,
            e.g. CoAP or MQTT.  Whatever protocol is used for C-AS and Broker-AS communications must provide mutual
            authentication, confidentiality protection, and integrity protection.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">
            If the Client is resource-constrained or does not support HTTPS, a separate Client Authorization Server
            may carry out the token request on behalf of the Client, and later, onboard the Client with the token.
            The interactions between a Client and its Client Authorization Server for token
            onboarding and support for MQTTS-based token requests at the AS are out of the scope of this document.<a href="#section-2-2" class="pilcrow">¶</a></p>
<span id="name-connection-setup"></span><div id="protocol_flow">
<figure id="figure-1">
        <div class="alignLeft art-text artwork" id="section-2-3.1">
<pre>
                          +---------------------+
                          | Client              |
                          |                     |
   +---(A) Token request--| Client -            |
   |                      | Authorization       |
   |   +-(B) Access token-&gt; Server Interface    |
   |   |                  |       (HTTPS)       |
   |   |                  |_____________________|
   |   |                  |                     |
+--v-------------+        |  Pub/Sub Interface  |
|  Authorization |        |     (MQTTS)         |
|  Server        |        +-----------^---------+
|________________|            |       |
   |    ^             (C)Connection  (F)Connection
   |    |               request +    response
   |    |               access token  |
   |    |                     |       |
   |    |                 +---v--------------+
   |    |                 |   Broker (MQTTS) |
   |    |                 |__________________|
   |    +(D)Introspection-|                  |
   |   request (optional) | RS-AS interface  |
   |                      |     (HTTPS)      |
   +-(E)Introspection----&gt;|__________________|
     response (optional)
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-connection-setup" class="selfRef">Connection setup</a>
        </figcaption></figure>
</div>
<section id="section-2.1">
        <h3 id="name-client-token-request-to-the">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-client-token-request-to-the" class="section-name selfRef">Client Token Request to the Authorization Server (AS)</a>
        </h3>
<p id="section-2.1-1">
                The first step in the protocol flow (Figure 1 (A)) is the token acquisition by the Client
                from the AS. The Client and the AS MUST perform mutual authentication.
                The Client requests an access token from the AS as
                described in Section 5.8.1 of the <span><a href="#I-D.ietf-ace-oauth-authz" class="xref">ACE framework</a> [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. 
                The document follows the procedures defined in Section 3.2.1 of the <span><a href="#I-D.ietf-ace-dtls-authorize" class="xref">DTLS profile</a> [<a href="#I-D.ietf-ace-dtls-authorize" class="xref">I-D.ietf-ace-dtls-authorize</a>]</span>

                for RPK, and in Section 3.3.1 of the same document for PSK.
                However, the content type of the request is set to 'application/ace+json', 
                and the AS uses JSON in the payload of its responses to the Client and the RS.
                As explained earlier, implementations MAY also use "application/ace+cbor" content type.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2"> On receipt of the token request, AS verifies the request. 
                If the AS successfully verifies the access token request and authorizes the Client for the
                indicated audience (i.e., RS) and scopes (i.e., publish/subscribe permissions over topics as described
                in <a href="#scope" class="xref">Section 2.3</a>),
                the AS issues an access token (Figure 1 (B)).<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">The response includes the parameters described
                in Section 5.8.2 of <span><a href="#I-D.ietf-ace-oauth-authz" class="xref">the ACE framework</a> [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.
                For RPK, the parameters are as described 
                in Section 3.2.1 of the <span><a href="#I-D.ietf-ace-dtls-authorize" class="xref">DTLS profile</a> [<a href="#I-D.ietf-ace-dtls-authorize" class="xref">I-D.ietf-ace-dtls-authorize</a>]</span>. 
                For PSK, the document follows Section 3.3.1 of the <span><a href="#I-D.ietf-ace-dtls-authorize" class="xref">DTLS profile</a> [<a href="#I-D.ietf-ace-dtls-authorize" class="xref">I-D.ietf-ace-dtls-authorize</a>]</span>.
                In both cases,  if the response contains an "ace_profile" parameter, this parameter is set 

                to "mqtt_tls".
                The returned token is a Proof-of-Possession (PoP) token by default.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">
                This document follows <span>[<a href="#RFC7800" class="xref">RFC7800</a>]</span> for PoP semantics for JWTs 
                (CWTs can also be used). The PoP token includes a 'cnf' parameter with a symmetric or asymmetric PoP key.
                Note that the contents of the web tokens (including the 'cnf' parameter) are to be consumed by the RS 
                and not the Client (the Client obtains the key information in a different manner).
                The RPK case is handled as described in  in Section 3.2.1 of the <span><a href="#I-D.ietf-ace-dtls-authorize" class="xref">DTLS profile</a> [<a href="#I-D.ietf-ace-dtls-authorize" class="xref">I-D.ietf-ace-dtls-authorize</a>]</span>.
                For the PSK, the procedures apply with the following exceptions to accommodate 
                JWT and JOSE use. 
                In this case, the AS adds a "cnf" parameter to the access information 
                carrying  <span><a href="#RFC7517" class="xref">a JWK (JSON Web Key)</a> [<a href="#RFC7517" class="xref">RFC7517</a>]</span> object that contains 
                 either the symmetric key itself or a key identifier that can be used by the RS to 
                 determine the secret key it shares with the Client. 
                The JWT is created as explained in Section 7 of <span>[<a href="#RFC7519" class="xref">RFC7519</a>]</span>, 
                 and the JWT MUST include <span><a href="#RFC7516" class="xref">JWE</a> [<a href="#RFC7516" class="xref">RFC7516</a>]</span>.
                If CWT/COSE is used this information MUST be inside the "COSE_Key" object, 
                and MUST be encrypted using a "COSE_Encrypt0" structure.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.1-5"> The AS returns error responses for JSON-based interactions
                following Section 5.2 of <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>.
                When CBOR is used, the interactions MUST implement
                Section 5.8.3 of the <span><a href="#I-D.ietf-ace-oauth-authz" class="xref">ACE framework</a> [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.<a href="#section-2.1-5" class="pilcrow">¶</a></p>
</section>
<div id="connect_v5">
<section id="section-2.2">
        <h3 id="name-client-connection-request-t">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-client-connection-request-t" class="section-name selfRef">Client Connection Request to the Broker (C)</a>
        </h3>
<div id="auth_options">
<section id="section-2.2.1">
          <h4 id="name-overview-of-client-rs-authe">
<a href="#section-2.2.1" class="section-number selfRef">2.2.1. </a><a href="#name-overview-of-client-rs-authe" class="section-name selfRef">Overview of Client-RS Authentication Methods over TLS and MQTT</a>
          </h4>
<p id="section-2.2.1-1">
                    Unless the Client publishes and subscribes to only public topics, the Client and the Broker MUST perform mutual authentication.
                    The Client MUST authenticate to the Broker either over MQTT or TLS before performing any other action.
                    For MQTT, the options are "None" and "ace".
                    For TLS, the options are "Anon" for an anonymous client,
                    and "Known(RPK/PSK)" for Raw Public Keys (RPK) <span>[<a href="#RFC7250" class="xref">RFC7250</a>]</span> and Pre-Shared Keys (PSK), respectively.
                    The "None" and "Anon" options do not provide client authentication but can be used either
                    during authentication or in combination with authentication at the other layer.
                    When the Client uses TLS:Anon,MQTT:None, the Client can only publish or subscribe to public topics.
                    Thus, the client authentication procedures involve the following possible combinations:<a href="#section-2.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.1-2.1">TLS:Anon,MQTT:None: This option is used only for the topics that do not require authorization,
                            including the "authz-info" topic. Publishing to the "authz-info" topic is described in <a href="#app-authzinfo" class="xref">Section 2.2.2</a>.<a href="#section-2.2.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.2.1-2.2">TLS:Anon,MQTT:ace: The token is transported inside the CONNECT packet and MUST be
                            validated using one of the methods described in <a href="#app-authzinfo" class="xref">Section 2.2.2</a>. This option also supports
                            a tokenless connection request for AS discovery.  As per <span><a href="#I-D.ietf-ace-oauth-authz" class="xref">ACE framework</a> [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>, 
                            a separate step is needed to determine whether the discovered AS URI is authorized to act as an AS.<a href="#section-2.2.1-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.2.1-2.3">TLS:Known(RPK/PSK),MQTT:none: This specification supports client authentication with TLS with Raw Public
                            Keys (RPK) <span>[<a href="#RFC7250" class="xref">RFC7250</a>]</span> and with Pre-Shared Keys (PSK) following the procedures 
                            described in <span><a href="#I-D.ietf-ace-dtls-authorize" class="xref">DTLS profile</a> [<a href="#I-D.ietf-ace-dtls-authorize" class="xref">I-D.ietf-ace-dtls-authorize</a>]</span>. 
                             For the RPK, the Client
                            MUST have published the token to the "authz-info" topic. For the PSK, the token MAY be published to the "authz-info" topic, 
                            or MAY be, alternatively, 
                            provided as a  "PSK identity" (e.g. "identity" in the "identities" field in the client's "pre_shared_key" extension in TLS 1.3).<a href="#section-2.2.1-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.2.1-2.4">TLS:Known(RPK/PSK),MQTT:ace: This option SHOULD NOT be chosen as the token transported in the CONNECT
                            overwrites any permissions passed during the TLS authentication.<a href="#section-2.2.1-2.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-2.2.1-3">
                     It is RECOMMENDED that the Client implements TLS:Anon,MQTT:ace as the first choice when working with protected topics.
                     However, MQTT v3.1.1 clients that do not prefer to overload username and password fields 
                     for ACE (as described in <a href="#MQTTv311" class="xref">Section 6</a>) MAY implement TLS:Known(RPK/PSK),MQTT:none, and
                     consequently TLS:Anon,MQTT:None to submit their token to "authz-info".<a href="#section-2.2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.2.1-4">
                     The Broker MUST support TLS:Anon,MQTT:ace.
                     To support Clients with different capabilities, the Broker MAY provide multiple client authentication options,
                     e.g. support TLS:Known(RPK),MQTT:none and TLS:Anon,MQTT:None,
                     to enable RPK-based client authentication.<a href="#section-2.2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.2.1-5">
                    The Client MUST authenticate the Broker during the TLS handshake.
                    If the Client authentication uses TLS:Known(RPK/PSK),
                    then the Broker is authenticated using the respective method.
                    Otherwise, to authenticate the Broker, the client MUST validate a
                    public key from a X.509 certificate or an RPK from the Broker against the
                    'rs_cnf' parameter in the token response.
                    The AS MAY include the thumbprint of the RS's X.509 certificate in the 'rs_cnf'
                    (thumbprint as defined in <span>[<a href="#I-D.ietf-cose-x509" class="xref">I-D.ietf-cose-x509</a>]</span>). In this case,
                    the client MUST validate the RS certificate against this thumbprint.<a href="#section-2.2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="app-authzinfo">
<section id="section-2.2.2">
          <h4 id="name-authz-info-the-authorizatio">
<a href="#section-2.2.2" class="section-number selfRef">2.2.2. </a><a href="#name-authz-info-the-authorizatio" class="section-name selfRef">authz-info: The Authorization Information Topic</a>
          </h4>
<p id="section-2.2.2-1">
                    In the cases when the Client must transport the token to the Broker first,
                    the Client connects to the Broker to publish its token to the "authz-info" topic.
                    The "authz-info" topic MUST be publish-only (i.e., the Clients are not allowed to subscribe to it).
                    "authz-info" is not protected, and hence, the Client uses the TLS:Anon,MQTT:None option over a TLS connection.
                    After publishing the token, the Client disconnects from the Broker and is expected to reconnect
                    using client authentication over TLS (i.e., TLS:Known(RPK/PSK),MQTT:none).<a href="#section-2.2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2-2">
                    The Broker stores and indexes all tokens received to the "authz-info" topic in its key store
                    (similar to the <span><a href="#I-D.ietf-ace-dtls-authorize" class="xref">DTLS profile for ACE</a> [<a href="#I-D.ietf-ace-dtls-authorize" class="xref">I-D.ietf-ace-dtls-authorize</a>]</span>).
                    This profile follows the recommendation of
                    Section 5.10.1 of the <span><a href="#I-D.ietf-ace-oauth-authz" class="xref">ACE framework</a> [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>,
                    and expects that the Broker stores only one token per proof-of-possession key, and any other
                    token linked to the same key overwrites an existing token.<a href="#section-2.2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2.2-3">
                    The Broker MUST verify the validity of the token
                    (i.e., through local validation or introspection, if the token is a reference)
                    as described in <a href="#token_validation" class="xref">Section 2.2.5</a>.
                    If the token is not valid, the Broker MUST discard the token.
                    Depending on the QoS level of the PUBLISH packet, the Broker returns
                    the error response as a PUBACK, PUBREC, or DISCONNECT packet as explained below.<a href="#section-2.2.2-3" class="pilcrow">¶</a></p>
<p id="section-2.2.2-4">
                    If the QoS level is equal to 0, and the token is invalid or the claims
                    cannot be obtained in the case of an introspected token, the Broker MUST
                    send a DISCONNECT packet with the reason code '0x87 (Not authorized)'.
                    If the PUBLISH payload does not parse to a token, the RS MUST send a DISCONNECT with
                    the reason code '0x99 (Payload format invalid)'.<a href="#section-2.2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.2.2-5">
                    If the QoS level of the PUBLISH packet is greater than or equal to 1, and the token is invalid, or
                    the claims cannot be obtained in the case of an introspected token,
                    the Broker MUST send the reason code 0x87 ('Not authorized') in the PUBACK or PUBREC.  If the PUBLISH payload does not parse to a token,
                    the PUBACK/PUBREC reason code is '0x99 (Payload format invalid)'.<a href="#section-2.2.2-5" class="pilcrow">¶</a></p>
<p id="section-2.2.2-6">
                    It must be noted that when the RS sends the 'Not authorized' response, this corresponds
                    to the token being invalid, and not that the actual PUBLISH packet was not authorized.
                    Given that the "authz-info" is a public topic, this response is not
                    expected to cause confusion.<a href="#section-2.2.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="auth-TLS">
<section id="section-2.2.3">
          <h4 id="name-client-authentication-over-">
<a href="#section-2.2.3" class="section-number selfRef">2.2.3. </a><a href="#name-client-authentication-over-" class="section-name selfRef">Client Authentication over TLS</a>
          </h4>
<p id="section-2.2.3-1">
                 This document supports TLS with Raw Public Keys (RPK) 
                <span>[<a href="#RFC7250" class="xref">RFC7250</a>]</span> and with Pre-Shared Keys (PSK).
                The TLS session setup follows 
                <span><a href="#I-D.ietf-ace-dtls-authorize" class="xref">DTLS profile for ACE</a> [<a href="#I-D.ietf-ace-dtls-authorize" class="xref">I-D.ietf-ace-dtls-authorize</a>]</span>, 
                  as the profile applies to TLS equally well 
                  <span>[<a href="#I-D.ietf-ace-extend-dtls-authorize" class="xref">I-D.ietf-ace-extend-dtls-authorize</a>]</span>. 
                When there are exceptions to the DTLS profile, these are explicitly 
                stated in the document.
                If TLS 1.2 is used, <span>[<a href="#RFC7925" class="xref">RFC7925</a>]</span> describes 
                how TLS can be used for constrained devices, alongside recommended cipher suites. 
                Additionally, TLS 1.2 implementations MUST use "Extended Master Secret" <span>[<a href="#RFC7627" class="xref">RFC7627</a>]</span>
                to incorporate the handshake transcript into the master secret.  TLS implementations SHOULD use the

                SNI (Server Name Indication) <span>[<a href="#RFC6066" class="xref">RFC6066</a>]</span> and APLN (Application-Layer Protocol Negotiation) 
                <span>[<a href="#RFC7301" class="xref">RFC7301</a>]</span> extensions.<a href="#section-2.2.3-1" class="pilcrow">¶</a></p>
<div id="TLS-RPK">
<section id="section-2.2.3.1">
            <h5 id="name-raw-public-key-mode">
<a href="#section-2.2.3.1" class="section-number selfRef">2.2.3.1. </a><a href="#name-raw-public-key-mode" class="section-name selfRef">Raw Public Key Mode</a>
            </h5>
<p id="section-2.2.3.1-1">
                 This document follows the procedures defined in Section 3.2.2 of
                 <span><a href="#I-D.ietf-ace-dtls-authorize" class="xref">DTLS profile for ACE</a> [<a href="#I-D.ietf-ace-dtls-authorize" class="xref">I-D.ietf-ace-dtls-authorize</a>]</span> with 
                 the following exceptions. 
                 The client MUST upload the access token to the Broker using the method specified in 
                 <a href="#app-authzinfo" class="xref">Section 2.2.2</a> before initiating the handshake.<a href="#section-2.2.3.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="TLS-PSK">
<section id="section-2.2.3.2">
            <h5 id="name-pre-shared-key-mode">
<a href="#section-2.2.3.2" class="section-number selfRef">2.2.3.2. </a><a href="#name-pre-shared-key-mode" class="section-name selfRef">Pre-Shared Key Mode</a>
            </h5>
<p id="section-2.2.3.2-1">
                 This document follows the procedures defined in Section 3.3.2 of
                 <span><a href="#I-D.ietf-ace-dtls-authorize" class="xref">DTLS profile for ACE</a> [<a href="#I-D.ietf-ace-dtls-authorize" class="xref">I-D.ietf-ace-dtls-authorize</a>]</span> with 
                 the following exceptions.<a href="#section-2.2.3.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2.3.2-2">
                To use TLS 1.3 with pre-shared keys, the Client follows the PSK key extension 
                specified in <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span> using the key conveyed in the "cnf" parameter
                of the AS response. The same key is bound to the access token 
                in the "cnf" claim. The Client can upload the token as specified in 
                 <a href="#app-authzinfo" class="xref">Section 2.2.2</a> before initiating the handshake.
                 The Client MUST indicate during the handshake which previously uploaded access token 
                 it intends to use.  To do so, it MUST create a "COSE_Key" or "JWK" structure with the "kid"
                 that was conveyed in the "rs_cnf" claim in the token response from
                 the AS and the key type "symmetric". This structure is then included as the only element 
                 in the "cnf" structure and used as a PSK identity in TLS.
                 As an alternative to the access token upload, the client can provide the most recent access token, 
                 JWT or CWT, as a PSK identity.<a href="#section-2.2.3.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2.3.2-3">
                In contrast to <span><a href="#I-D.ietf-ace-dtls-authorize" class="xref">DTLS profile for ACE</a> [<a href="#I-D.ietf-ace-dtls-authorize" class="xref">I-D.ietf-ace-dtls-authorize</a>]</span>, 
                a client MAY omit support for the cipher suite TLS_PSK_WITH_AES_128_CCM_8, but
                for TLS 1.2, MUST support TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 as recommended in <span>[<a href="#RFC7525" class="xref">RFC7525</a>]</span>.<a href="#section-2.2.3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="auth-ACE">
<section id="section-2.2.4">
          <h4 id="name-client-authentication-over-m">
<a href="#section-2.2.4" class="section-number selfRef">2.2.4. </a><a href="#name-client-authentication-over-m" class="section-name selfRef">Client Authentication over MQTT</a>
          </h4>
<div id="token-CONNECT">
<section id="section-2.2.4.1">
            <h5 id="name-transporting-the-access-tok">
<a href="#section-2.2.4.1" class="section-number selfRef">2.2.4.1. </a><a href="#name-transporting-the-access-tok" class="section-name selfRef">Transporting the Access Token Inside the MQTT CONNECT</a>
            </h5>
<p id="section-2.2.4.1-1">
                    This section describes how the Client transports the token to the Broker
                    inside the CONNECT packet. If this method is used,
                    the Client TLS connection is expected to be anonymous, and the Broker is
                    authenticated during the TLS connection setup.
                    The approach described in this section is similar to an earlier proposal
                     by Fremantle et al <span>[<a href="#fremantle14" class="xref">fremantle14</a>]</span>.<a href="#section-2.2.4.1-1" class="pilcrow">¶</a></p>
<p id="section-2.2.4.1-2">
                    After sending the CONNECT, the client MUST wait to receive the CONNACK from
                    the Broker. The only packets it is allowed to send are DISCONNECT
                    or AUTH that is in response to the Broker AUTH.
                    Similarly, except for a DISCONNECT and AUTH response from the Client,
                    the Broker MUST NOT process any packets before sending a CONNACK.<a href="#section-2.2.4.1-2" class="pilcrow">¶</a></p>
<p id="section-2.2.4.1-3">
             <a href="#mqtt5_connect_message" class="xref">Figure 2</a> shows the structure of the
                    MQTT CONNECT packet used in MQTT v5.0.
                    A CONNECT packet is composed of a fixed header, a variable header and a payload.
                    The fixed header contains the Control Packet Type (CPT), Reserved, and Remaining Length fields.
                    Remaining Length is a Variable Byte Integer that represents the number of bytes 
                    remaining within the current Control Packet, including data in the Variable Header and the Payload.
                    The Variable Header contains the Protocol Name, Protocol Level,
                    Connect Flags, Keep Alive, and Properties fields.
                    The Connect Flags in the variable header specify the properties of the MQTT session.
                    It also indicates the presence or absence of some fields in the Payload.
                    The payload contains one or more encoded fields, namely a unique Client
                    Identifier for the Client, a Will Topic, Will Payload, User Name and Password.
                    All but the Client Identifier can be omitted depending on the flags in the Variable Header.
                    The Client Identifier identifies the Client to the Broker, and therefore, 
                    is unique for each Client. It must be noted that the Client Identifier is an unauthenticated identifier
                    used within the MQTT protocol and so is not bound to the access token.<a href="#section-2.2.4.1-3" class="pilcrow">¶</a></p>
<span id="name-mqtt-v5-connect-variable-he"></span><div id="mqtt5_connect_message">
<figure id="figure-2">
              <div class="alignLeft art-text artwork" id="section-2.2.4.1-4.1">
<pre>

       0             8             16
       +---------------------------+
       |Protocol name length = 4   |
       +---------------------------+
       |     'M'            'Q'    |
       +---------------------------+
       |     'T'            'T'    |
       +---------------------------+
       |Proto.level=5|Connect flags|
       +---------------------------+
       |        Keep alive         |
       +---------------------------+
       | CONNECT Properties Length |
       |      (Upto  4 bytes)      |
       +---------------------------+
       | ( ..Other properties..)   |
       +---------------------------+
       |  Authentication Method    |
       |      (0x15)  |   Len.     |
       |      Len     |   'a'      |
       |      'c'     |   'e'      |
       +---------------------------+
       |  Authentication Data      |
       |     (0x16)   |    Len     |
       |      Len     |   token    |
       |  or token + PoP data      |
       +---------------------------+
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-mqtt-v5-connect-variable-he" class="selfRef">MQTT v5 CONNECT Variable Header with Authentication Method property for ACE.</a>
              </figcaption></figure>
</div>
<p id="section-2.2.4.1-5">
                The CONNECT flags are Username, Password, Will retain, Will QoS, Will Flag,
                Clean Start, and Reserved.
                <a href="#mqttv5_connect_flags" class="xref">Figure 3</a> shows how the
                flags MUST be set to use AUTH packets for authentication and authorization,
                i.e., the username and password flags MUST be set to 0.
                An MQTT v5.0 RS MAY also support token transport using Username and Password to provide
                a security option for MQTT v3.1.1 clients, as
                described in  <a href="#MQTTv311" class="xref">Section 6</a>.<a href="#section-2.2.4.1-5" class="pilcrow">¶</a></p>
<span id="name-connect-flags-for-auth"></span><div id="mqttv5_connect_flags">
<figure id="figure-3">
              <div class="alignLeft art-text artwork" id="section-2.2.4.1-6.1">
<pre>
+-----------------------------------------------------------+
|User name|Pass.|Will retain|Will QoS|Will Flag|Clean| Rsvd.|
|   Flag  |Flag |           |        |         |Start|      |
+-----------------------------------------------------------+
| 0       | 0   |    X      |   X X  |   X     |  X  |  0   |
+-----------------------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-connect-flags-for-auth" class="selfRef">CONNECT flags for AUTH</a>
              </figcaption></figure>
</div>
<p id="section-2.2.4.1-7">
                The Will Flag indicates that a Will message needs to be sent if the network connection is
                not closed normally. The situations in which the Will message
                is published include disconnections due to I/O or network failures
                and the server closing the network connection due to a protocol error.
                The Client MAY set the Will Flag as desired (marked as 'X' in <a href="#mqttv5_connect_flags" class="xref">Figure 3</a>).
                If the Will Flag is set to 1,  the Broker MUST check that the token
                allows the publication of the Will message (i.e., the Will Topic filter is in the scope array). 
                The check is performed against the token scope
                described in <a href="#scope" class="xref">Section 2.3</a>. If the Will authorization fails, the connection 
                is refused as described in  <a href="#as_discovery" class="xref">Section 2.4.1</a>. 
                If the Broker accepts the connection request, the Broker
                stores the Will message and  publishes it when the network connection is closed according to Will QoS, and
             Will retain parameters and MQTT Will management rules.  To avoid publishing the Will Messages
                in the case of temporary network disconnections,
                the Client specifies a Will Delay Interval in the Will Properties.
                <a href="#disconnections" class="xref">Section 5</a> explains how the Broker deals with the retained messages in further detail.<a href="#section-2.2.4.1-7" class="pilcrow">¶</a></p>
<p id="section-2.2.4.1-8">
                In MQTT v5.0, the Client signals a clean session (i.e., that the session does not continue an existing session)
             by setting the Clean Start Flag to 1 in the CONNECT
                packet. In this profile, the Client SHOULD always
                start with a clean session. The Broker MAY also signal that it does not support 
                session continuation by setting Session Expiry Interval to 0 in the CONNACK.
                If the Broker starts a clean session, the Broker MUST set the Session Present flag to 0 in the CONNACK packet to signal
                this to the Client.<a href="#section-2.2.4.1-8" class="pilcrow">¶</a></p>
<p id="section-2.2.4.1-9">
                The Broker MAY support session continuation, e.g. if the Broker requires it for QoS reasons.
                In this case, if a CONNECT packet is received with Clean Start set to 0 and there is a Session associated 
                with the Client Identifier, the Broker MUST resume communications with the Client based on the state from the 
                existing Session. In its response, the Broker MUST set the Session Present flag to 1 
                in the CONNACK packet to signal session continuation to the Client.
                The session state stored by the Client and the Broker is described in <a href="#disconnections" class="xref">Section 5</a>.<a href="#section-2.2.4.1-9" class="pilcrow">¶</a></p>
<p id="section-2.2.4.1-10">
                When reconnecting to a Broker that supports session continuation,
                the Client MUST still provide a token, in addition to
                using the same Client Identifier, and
                setting the Clean Start to 0.
                The Broker MUST still perform proof-of-possession validation on the provided token.
                If the token matches the stored state,
                the Broker MAY skip introspecting a token-by-reference and use the stored introspection result.
                The Broker MUST also verify the Client is authorized to receive or send
                MQTT packets that are pending transmission. When a Client connects with a long Session Expiry Interval, the
                Broker may need to  maintain the Client's MQTT session state after it disconnects for an extended period. 
                Brokers SHOULD implement administrative policies to limit misuse.<a href="#section-2.2.4.1-10" class="pilcrow">¶</a></p>
<p id="section-2.2.4.1-11">
                Note that, according to the MQTT standard, the Broker uses the Client Identifier to identify the session state.
                In the case of a Client Identifier collision,
                a client may take over another client's session. Given that clients provide a token
                at each connection, clients will only send or receive messages to their authorized topics.
                Therefore, while this issue is not expected to affect security,
                it may affect QoS (i.e., PUBLISH or QoS messages saved for Client A may be delivered to a Client B).
                In addition, if this Client Identifier represents a Client already connected to the Broker,
                the Broker sends a DISCONNECT packet to the existing Client with Reason Code of '0x8E (Session taken over)',
                and closes the connection to the Client.<a href="#section-2.2.4.1-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="AUTH-method">
<section id="section-2.2.4.2">
            <h5 id="name-authentication-using-auth-p">
<a href="#section-2.2.4.2" class="section-number selfRef">2.2.4.2. </a><a href="#name-authentication-using-auth-p" class="section-name selfRef">Authentication Using AUTH Property</a>
            </h5>
<p id="section-2.2.4.2-1">
                To use AUTH,
                the Client MUST set the Authentication Method
                as a property of a CONNECT packet by using the property identifier 21 (0x15).
                This is followed by a UTF-8 Encoded String containing the name of the
                Authentication Method, which MUST be set to "ace". If the RS does not support this profile,
                it sends a CONNACK with a Reason Code of '0x8C (Bad authentication method)'.<a href="#section-2.2.4.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2.4.2-2">
                The Authentication Method is followed by the Authentication Data,
                which has a property identifier 22 (0x16) and is Binary Data.
                Based on the Authentication Data, RS MUST support both options below:<a href="#section-2.2.4.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.4.2-3.1">Proof-of-Possession using a challenge from the TLS session<a href="#section-2.2.4.2-3.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-2.2.4.2-3.2">Proof-of-Possession via Broker generated challenge/response<a href="#section-2.2.4.2-3.2" class="pilcrow">¶</a>
</li>
            </ul>
<div id="pop_nonce">
<section id="section-2.2.4.2.1">
              <h6 id="name-proof-of-possession-using-a">
<a href="#section-2.2.4.2.1" class="section-number selfRef">2.2.4.2.1. </a><a href="#name-proof-of-possession-using-a" class="section-name selfRef">Proof-of-Possession Using a Challenge from the TLS session</a>
              </h6>
<span id="name-authentication-data-for-pop"></span><div id="authdata_tlsexporter">
<figure id="figure-4">
                <div class="alignLeft art-text artwork" id="section-2.2.4.2.1-1.1">
<pre>
+-----------------------------------------------------------------+
|Authentication|Token Length|Token   |MAC or Signature            |
|Data Length   |            |        |(over TLS exporter content) |
+-----------------------------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-authentication-data-for-pop" class="selfRef">Authentication Data for PoP based on TLS exporter content</a>
                </figcaption></figure>
</div>
<p id="section-2.2.4.2.1-2">
                For this option, the Authentication Data inside the client's CONNECT MUST contain the two-byte integer token length,
                the token, and the keyed message digest (MAC) or the Client signature (as shown in 
                <a href="#authdata_tlsexporter" class="xref">Figure 4</a>).
                The Proof-of-Possession key in the token is used to calculate
                 the keyed message digest (MAC) or the Client signature
                based on the content obtained from the TLS exporter (<span>[<a href="#RFC5705" class="xref">RFC5705</a>]</span>
                for TLS 1.2, and Section 7.5 of <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>) for TLS 1.3.
                This content is exported from the TLS session using the exporter label 'EXPORTER-ACE-MQTT-Sign-Challenge',
                an empty context, and length of 32 bytes.
                The token is also validated as described in  <a href="#token_validation" class="xref">Section 2.2.5</a>,
                and the Broker responds with a CONNACK with the appropriate response code.
                The Client cannot reauthenticate using this method during the same TLS session (see <a href="#reauthentication" class="xref">Section 4</a>).<a href="#section-2.2.4.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pop_challenge">
<section id="section-2.2.4.2.2">
              <h6 id="name-proof-of-possession-via-bro">
<a href="#section-2.2.4.2.2" class="section-number selfRef">2.2.4.2.2. </a><a href="#name-proof-of-possession-via-bro" class="section-name selfRef">Proof-of-Possession via Broker-generated Challenge/Response</a>
              </h6>
<span id="name-authentication-data-to-init"></span><div id="authdata_challenge_client">
<figure id="figure-5">
                <div class="alignLeft art-text artwork" id="section-2.2.4.2.2-1.1">
<pre>
+------------------------------------+
|Authentication|Token Length|Token   |
|Data Length   |            |        |
+------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-authentication-data-to-init" class="selfRef">Authentication Data to Initiate PoP based on Challenge/Response</a>
                </figcaption></figure>
</div>
<span id="name-authentication-data-for-bro"></span><div id="authdata_challenge_broker_challenge">
<figure id="figure-6">
                <div class="alignLeft art-text artwork" id="section-2.2.4.2.2-2.1">
<pre>
+--------------------------+
|Authentication|RS Nonce   |
|Data Length   |(8 bytes)  |
+--------------------------+
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-authentication-data-for-bro" class="selfRef">Authentication Data for Broker Challenge</a>
                </figcaption></figure>
</div>
<p id="section-2.2.4.2.2-3">
             For this option, the Broker follows a Broker-generated challenge/response protocol.
                If the Authentication Data inside the Client's CONNECT contains only the two-byte integer token length and
                the token (as shown in <a href="#authdata_challenge_client" class="xref">Figure 5</a>),
                the RS MUST respond with an AUTH packet,
                with the Authenticate Reason Code set to "0x18 (Continue Authentication)".
                The Broker also uses this method if the Authentication Data does not 
                contain a token, but the Broker has a token stored for the connecting client.<a href="#section-2.2.4.2.2-3" class="pilcrow">¶</a></p>
<p id="section-2.2.4.2.2-4">
                The AUTH packet to continue authentication includes the Authentication Method, which MUST be set to "ace"
                and Authentication Data. The Authentication Data MUST NOT be empty and contains
                an 8-byte RS nonce as a challenge for the Client (<a href="#authdata_challenge_broker_challenge" class="xref">Figure 6</a>).<a href="#section-2.2.4.2.2-4" class="pilcrow">¶</a></p>
<span id="name-authentication-data-for-cli"></span><div id="authdata_challenge_client_response">
<figure id="figure-7">
                <div class="alignLeft art-text artwork" id="section-2.2.4.2.2-5.1">
<pre>
+---------------------------------------------------------+
|Authentication|Client Nonce |MAC or Signature            |
|Data Length   |(8 bytes)    |(over RS nonce+Client nonce)|
+---------------------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-authentication-data-for-cli" class="selfRef">Authentication Data for Client Challenge Response</a>
                </figcaption></figure>
</div>
<p id="section-2.2.4.2.2-6">
                The Client responds to this with an AUTH packet
                with a reason code "0x18 (Continue Authentication)".
                Similarly, the Client packet sets the Authentication Method to "ace".
                The Authentication Data in the Client's response is formatted as shown
                in <a href="#authdata_challenge_client_response" class="xref">Figure 7</a> and includes the
                the 8-byte Client nonce, and
                the signature or MAC computed over the RS nonce concatenated with the Client nonce
                using PoP key in the token.<a href="#section-2.2.4.2.2-6" class="pilcrow">¶</a></p>
<p id="section-2.2.4.2.2-7">
                Next, the token is validated as described in  <a href="#token_validation" class="xref">Section 2.2.5</a>.
                The success case is illustrated in <a href="#pop_challenge_response" class="xref">Figure 8</a>.
                The client MAY also re-authenticate using this challenge-response flow,
                as described in <a href="#reauthentication" class="xref">Section 4</a>.<a href="#section-2.2.4.2.2-7" class="pilcrow">¶</a></p>
<span id="name-pop-challenge-response-flow"></span><div id="pop_challenge_response">
<figure id="figure-8">
                <div class="alignLeft art-text artwork" id="section-2.2.4.2.2-8.1">
<pre>
                    Client      Broker
                     |             |
                     |&lt;===========&gt;| TLS connection setup
                     |             |
                     |             |
                     +------------&gt;| CONNECT with Authentication Data
                     |             | contains only token
                     |             |
                     &lt;-------------+ AUTH '0x18 (Cont. Authentication)'
                     |             | 8-byte RS nonce as challenge
                     |             |
                     |------------&gt;| AUTH '0x18 (Cont. Authentication)'
                     |             | 8-byte Client nonce + signature/MAC
                     |             |
                     |             |---+ Token validation
                     |             |   | (may involve introspection)
                     |             |&lt;--+
                     |             |
                     |&lt;------------+ CONNACK '0x00 (Success)'
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-pop-challenge-response-flow" class="selfRef">PoP Challenge/Response Flow - Success</a>
                </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="token_validation">
<section id="section-2.2.5">
          <h4 id="name-broker-token-validation">
<a href="#section-2.2.5" class="section-number selfRef">2.2.5. </a><a href="#name-broker-token-validation" class="section-name selfRef">Broker Token Validation</a>
          </h4>
<p id="section-2.2.5-1">
                    The Broker MUST verify the validity of the token either locally
                    (e.g. in the case of a self-contained token) or MAY send a request to the
                    introspection endpoint of the AS (as described for HTTP-based interactions in Section 5.9 of 
                    the <span><a href="#I-D.ietf-ace-oauth-authz" class="xref">ACE framework</a> [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>).
                    The Broker MUST verify the claims in the access token according to the rules set in
                    Section 5.10.1.1 of the <span><a href="#I-D.ietf-ace-oauth-authz" class="xref">ACE framework</a> [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.<a href="#section-2.2.5-1" class="pilcrow">¶</a></p>
<p id="section-2.2.5-2">
                    To authenticate the Client, the Broker validates the signature or the MAC, depending on how the PoP protocol is implemented.
                    For self-contained tokens, the Broker MUST process the security protection of the token first, as specified by the respective token format, 
                    i.e. a CWT token uses COSE, while a JWT token uses JOSE.  For a token-by-reference, the 
                    Broker uses the "cnf" structure returned as a result of token introspection as specified in <span>[<a href="#RFC7519" class="xref">RFC7519</a>]</span>. 
                    HS256 (HMAC-SHA-256) <span>[<a href="#RFC6234" class="xref">RFC6234</a>]</span> and Ed25519 <span>[<a href="#RFC8032" class="xref">RFC8032</a>]</span> are mandatory to implement
                    for the Broker. The Client MUST implement at least one of them depending on the choice of symmetric or asymmetric validation.
                    Validation of the signature or MAC MUST fail if the signature algorithm is set to "none",
                    when the key used for the signature algorithm cannot be determined, or
                    the computed and received signature/MAC do not match.<a href="#section-2.2.5-2" class="pilcrow">¶</a></p>
<p id="section-2.2.5-3">
                The  Broker MUST check if the access token is still valid, 
                if it is the intended destination (i.e., the audience)
                of the token, and if the token was issued by an authorized
                 authorization server.  If the Client is using TLS RPK mode
                 to authenticate to the Broker,  the AS constructs the access token 
                 so that the Broker can associate the access token with the 
                 Client's public key.  The "cnf" claim MUST contain either the client's RPK or, 
                 if the key is already known by the RS (e.g., from previous communication), 
                 a reference to it.<a href="#section-2.2.5-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="scope">
<section id="section-2.3">
        <h3 id="name-token-scope-and-authorizati">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-token-scope-and-authorizati" class="section-name selfRef">Token Scope and Authorization</a>
        </h3>
<p id="section-2.3-1">  
            The scope field contains the publish and subscribe permissions for the Client.
            Therefore, the token or its introspection result MUST be cached 
                to allow a Client's future PUBLISH and SUBSCRIBE packets.
                 During the CONNECT, if the Will Flag is set to 1, the Broker MUST also authorize
                the publication of the Will Topic and message using the token's scope field.
            The Broker uses the scope to match against the Topic Name in a PUBLISH packet
            (including Will Topic in the CONNECT) or a Topic Filter in a SUBSCRIBE packet.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">
            The scope in the token is a single value. For a JWT, the single scope 
            is base64url encoded string with any padding characters removed, which has an internal structure of a JSON array. 

            For a CWT, this information is represented in CBOR.  
            The internal structure follows the <span><a href="#I-D.ietf-ace-aif" class="xref">Authorization Information 
            Format (AIF) for ACE</a> [<a href="#I-D.ietf-ace-aif" class="xref">I-D.ietf-ace-aif</a>]</span>.
            Using the Concise Data Definition Language (CDDL) <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span>,
            the specific data model for MQTT is:<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<span id="name-aif-mqtt-data-model"></span><div id="MQTTaif">
<figure id="figure-9">
          <div class="alignLeft art-CDDL art-text artwork" id="section-2.3-3.1">
<pre>
 AIF-MQTT = AIF-Generic&lt;topic_filter, permissions&gt;
 AIF-Generic&lt;topic_filter, permissions&gt; = [* [topic_filter, permissions]]
 topic_filter = tstr
 permissions = [+permission]
 permission = "pub"/"sub"
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-aif-mqtt-data-model" class="selfRef">AIF-MQTT data model</a>
          </figcaption></figure>
</div>
<p id="section-2.3-4">
            Topic filters are implemented according to
            Section 4.7 of <span><a href="#MQTT-OASIS-Standard-v5" class="xref">MQTT v5.0
                     - the OASIS Standard</a> [<a href="#MQTT-OASIS-Standard-v5" class="xref">MQTT-OASIS-Standard-v5</a>]</span>.
            By default, Wildcard Subscriptions are supported, and so, 
            the topic filter may include special wildcard characters.
            The multi-level wildcard, '#', matches any number of levels within a topic, and the single-level wildcard, '+',
            matches one topic level.
            The Broker MAY signal in the CONNACK explicitly whether wildcard subscriptions are supported
            by returning a CONNACK property "Wildcard Subscription Available". 
            A value of 0 means that Wildcard Subscriptions are not supported. 
            A value of 1 means Wildcard Subscriptions are supported.<a href="#section-2.3-4" class="pilcrow">¶</a></p>
<p id="section-2.3-5"> Following this model, an example scope may contain:<a href="#section-2.3-5" class="pilcrow">¶</a></p>
<span id="name-example-scope"></span><div id="MQTTaifex">
<figure id="figure-10">
          <div class="alignLeft art-text artwork" id="section-2.3-6.1">
<pre>
 [["topic1",["pub","sub"]],["topic2/#",["pub"]],["+/topic3",["sub"]]]
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-example-scope" class="selfRef">Example scope</a>
          </figcaption></figure>
</div>
<p id="section-2.3-7">
            This access token gives publish ("pub") and subscribe ("sub") permissions to the "topic1",
            publish permission to all the subtopics of "topic2",
            and subscribe permission to all "topic3", skipping one level.<a href="#section-2.3-7" class="pilcrow">¶</a></p>
<p id="section-2.3-8">
            If the scope is empty, the Broker records
            no permissions for the client for any topic. In this case, the Client
            is not able to publish or subscribe to any protected topics.
            The non-empty scope is used to authorize the Will Topic, if provided, in the CONNECT packet, 
            during connection setup, and if the connection request 
            succeeds, the Topic Names or Topic Filters requested in the future PUBLISH and SUBSCRIBE packets. 
            For the authorization to succeed, the Broker MUST verify that the topic name or filter in question is either an 
            an exact match to or a subset of at least one 'topic_filter' in the scope.<a href="#section-2.3-8" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-2.4">
        <h3 id="name-broker-response-to-client-c">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-broker-response-to-client-c" class="section-name selfRef">Broker Response to Client Connection Request</a>
        </h3>
<p id="section-2.4-1">
                 Based on the validation result (obtained either via local inspection or using the introspection
                interface of the AS), the Broker MUST send a CONNACK packet to the Client.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<div id="as_discovery">
<section id="section-2.4.1">
          <h4 id="name-unauthorized-request-and-th">
<a href="#section-2.4.1" class="section-number selfRef">2.4.1. </a><a href="#name-unauthorized-request-and-th" class="section-name selfRef">Unauthorized Request and the Optional Authorization Server Discovery</a>
          </h4>
<p id="section-2.4.1-1">
                     If the Client does not provide a valid token or omits the Authentication Data field and the Broker
                        has no token stored for the Client or
                        the token or Authentication data are malformed, or if the Will flag is set, the authorization checks for 
                        the Will topic fails, authentication fails. 
                        The Broker responds with the CONNACK reason code "0x87 (Not Authorized)" or any other applicable
                        reason code.<a href="#section-2.4.1-1" class="pilcrow">¶</a></p>
<p id="section-2.4.1-2">
                        The Broker MAY also trigger AS discovery and include a User Property (identified as property type 38 (0x26)) 
                        in the CONNACK for the AS Request Creation Hints.
                        The User Property is a UTF-8 string pair, composed of a name and a value. The name
                        of the User Property MUST be set to "ace_as_hint". The value of the user property
                        is a UTF-8 encoded JSON object containing the mandatory "AS" parameter,
                         and the optional parameters "audience", "kid", "cnonce", and "scope" as defined
                         in Section 5.3
                        of the <span><a href="#I-D.ietf-ace-oauth-authz" class="xref">ACE framework</a> [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.<a href="#section-2.4.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="auth_success">
<section id="section-2.4.2">
          <h4 id="name-authorization-success">
<a href="#section-2.4.2" class="section-number selfRef">2.4.2. </a><a href="#name-authorization-success" class="section-name selfRef">Authorization Success</a>
          </h4>
<p id="section-2.4.2-1">
                    On success, the reason code of the CONNACK is "0x00 (Success)". 
                    If the Broker starts a new session, it MUST also set Session Present to 0
                    in the CONNACK packet to signal a clean session to the Client. Otherwise,
                    it MUST set Session Present to 1.<a href="#section-2.4.2-1" class="pilcrow">¶</a></p>
<p id="section-2.4.2-2">
                    Having accepted the connection, the Broker MUST be prepared to store the token
                    during the connection and after disconnection for future use. 
                    If the token is not self-contained and the Broker uses token
                    introspection, it MAY cache the validation result to authorize
                    the subsequent PUBLISH and SUBSCRIBE packets.
                    PUBLISH and SUBSCRIBE packets, which are sent after a connection
                    setup, do not contain access tokens. If the introspection result
                    is not cached, the Broker needs to introspect the saved token for
                    each request. The Broker SHOULD also use a cache timeout to introspect
                    tokens regularly. The timeout value is application-specific and SHOULD be chosen 
       to reduce the risk of using stale introspection responses.<a href="#section-2.4.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</section>
</div>
<div id="pubsub_authorisation">
<section id="section-3">
      <h2 id="name-authorizing-publish-and-sub">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-authorizing-publish-and-sub" class="section-name selfRef">Authorizing PUBLISH and SUBSCRIBE Packets</a>
      </h2>
<p id="section-3-1">
        Using the cached token or its introspection result, the Broker uses the scope field 
        to match against the Topic Name in a PUBLISH packet, or a Topic Filter in a SUBSCRIBE packet.<a href="#section-3-1" class="pilcrow">¶</a></p>
<section id="section-3.1">
        <h3 id="name-publish-packets-from-the-pu">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-publish-packets-from-the-pu" class="section-name selfRef">PUBLISH Packets from the Publisher Client to the Broker</a>
        </h3>
<p id="section-3.1-1">
                On receiving the PUBLISH packet, the Broker MUST use the type of
                packet (i.e., PUBLISH) and the Topic name in the packet header to match against the
                scope array items in the cached token or its introspection result.
                Following the example in <a href="#scope" class="xref">Section 2.3</a>., a client sending a PUBLISH for 'topic2/a' would be
                allowed, as the scope array includes the '["topic2/#",["pub"]]'.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">
                If the Client is allowed to publish to the topic,
                the Broker publishes the message to all valid subscribers of the topic.
        In the case of an authorization failure, the Broker MUST return an error if
                the Client has set the QoS level of the PUBLISH packet to greater than or equal to 1.
                Depending on the QoS level, the Broker responds with either a PUBACK or PUBREC packet with reason code
                '0x87 (Not authorized)'.
         On receiving an acknowledgment with '0x87 (Not authorized)',
                the Client MAY reauthenticate by providing a new token as described in <a href="#reauthentication" class="xref">Section 4</a>.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">
                For QoS level 0, the Broker sends a DISCONNECT with reason code "0x87 (Not authorized)"
                and closes the network connection.  Note that the server-side DISCONNECT is a new feature of MQTT v5.0 (in MQTT v3.1.1,
                the server needs to drop the connection).<a href="#section-3.1-3" class="pilcrow">¶</a></p>
</section>
<section id="section-3.2">
        <h3 id="name-publish-packets-from-the-br">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-publish-packets-from-the-br" class="section-name selfRef">PUBLISH Packets from the Broker to the Subscriber Clients</a>
        </h3>
<p id="section-3.2-1">
         To forward PUBLISH packets to the subscribing Clients, the Broker identifies all the
                subscribers that have valid matching topic subscriptions to the Topic name of the PUBLISH
                packet (i.e., the tokens are valid, and
                token scopes allow a subscription to this particular Topic name).
                The Broker forwards the PUBLISH packet to all the valid
                subscribers.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">
                The Broker MUST NOT forward messages to unauthorized subscribers.
                There is no way to inform the Clients with invalid tokens that an
                authorization error has occurred other than sending a DISCONNECT packet.
                Therefore, the Broker SHOULD send a DISCONNECT packet with the reason code '0x87 (Not authorized)'.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
</section>
<section id="section-3.3">
        <h3 id="name-authorizing-subscribe-packe">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-authorizing-subscribe-packe" class="section-name selfRef">Authorizing SUBSCRIBE Packets</a>
        </h3>
<p id="section-3.3-1">
            In MQTT, a SUBSCRIBE packet is sent from a Client to the Broker
             to create one or more subscriptions
            to one or more topics.
            The SUBSCRIBE packet may contain multiple Topic Filters.
            The Topic Filters may include wildcard characters.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">
            On receiving the SUBSCRIBE packet, the Broker MUST use the type of packet (i.e.
            SUBSCRIBE) and the Topic Filter in the packet header to match
            against the scope field of the stored token or introspection result.
            The Topic Filters MUST be an exact match to or be a subset of at least one of the 'topic_filter' fields
            in the scope array found in the Client's token. For example, 
            if a client sends a subscription request for topic "a/b/*", 
            and has a token token permits "a/*",  this is a valid subscription request, as "a/b/*" is
            a subset of "a/*". (The process is similar to a Broker matching the Topic Name
            in a PUBLISH packet against the Subscriptions known to the Server.)<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3">
            As a response to the SUBSCRIBE packet, the Broker issues a SUBACK.
             For each Topic Filter,
            the SUBACK packet includes a return code matching the QoS level
            for the corresponding Topic Filter. In the case of failure, the return code is 0x87,
            indicating that the Client is 'Not authorized'. A reason code is returned for each Topic Filter.
     Therefore, the Client may receive success codes for a subset of its Topic Filters while being
     unauthorized for the rest.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="reauthentication">
<section id="section-4">
      <h2 id="name-token-expiration-update-and">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-token-expiration-update-and" class="section-name selfRef">Token Expiration, Update and Reauthentication</a>
      </h2>
<p id="section-4-1">
            The Broker MUST check for token expiration whenever a CONNECT, PUBLISH or SUBSCRIBE is received
            or sent. The Broker SHOULD check for token expiration on receiving a PINGREQUEST.
            The Broker MAY also check for token expiration periodically, e.g. every hour. This may allow
     for early detection of a token expiry.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">
            The token expiration is checked by checking the 'exp' claim of a JWT or introspection response
             or via performing an
            introspection request with the AS as described in Section 5.9 of the <span><a href="#I-D.ietf-ace-oauth-authz" class="xref">ACE framework</a> [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.
            Token expirations may trigger the Broker to send PUBACK, SUBACK and DISCONNECT packets with return code
            set to "Not authorized". After sending a DISCONNECT, the network connection is closed, and
            no more messages can be sent.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">
     The Client MAY reauthenticate as a response to the
            PUBACK and SUBACK that signal loss of authorization.
            The Clients MAY also proactively update their tokens, i.e., before
            they receive a packet with a 'Not authorized' return code.
            To start reauthentication, the Client MUST send an AUTH packet with the reason code
            '0x19 (Re-authentication)'. The Client MUST
     set the Authentication Method as "ace" and transport the new token in the Authentication Data.
            To re-authenticate, the Client MUST NOT use Proof-of-Possession using a challenge from the TLS session 
            during the same TLS session to avoid re-using the same challenge value from the TLS-Exporter.  
            Note that this means that servers will either need to record in the session ticket or database entry whether
             the TLS-Exporter-derived challenge was used, or always deny use of the TLS-Exporter-derived challenge
              for resumed sessions.  In TLS 1.3, the resumed connection would have a new exporter value, 
              but the requirement is phrased this way for simplicity.
            For re-authentications in the same TLS-session,  the Client MUST use the challenge-response PoP as defined
            in <a href="#pop_challenge" class="xref">Section 2.2.4.2.2</a>. 
            The Broker accepts reauthentication requests if the Client has already submitted
            a token (may be expired), for which it performed proof-of-possession.
            Otherwise, the Broker MUST deny the request.
     If the reauthentication fails, the Broker
     MUST send a DISCONNECT with the reason code '0x87 (Not Authorized)'.<a href="#section-4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="disconnections">
<section id="section-5">
      <h2 id="name-handling-disconnections-and">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-handling-disconnections-and" class="section-name selfRef">Handling Disconnections and Retained Messages</a>
      </h2>
<p id="section-5-1">
            In the case of a Client DISCONNECT, if the Session Expiry Interval is set to 0,  the Broker
            doesn't maintain session state but MUST keep the retained messages.
            If the Broker maintains session state,  the state MAY include token and its
            introspection result (for reference tokens) in addition to the MQTT session state.
            The MQTT session state is identified by the Client Identifier and includes
            state on client subscriptions; messages with QoS levels 1 and 2, and which have
            not been completely acknowledged or are pending transmission to the Client;
             and if the Session is currently not connected,
            the time at which the Session will end and Session State will be discarded.
            The token/introspection state is not part of the MQTT session state, and proof-of-possession is required
            for each new connection, regardless of whether MQTT session continuation is used.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">
            The messages to be retained are indicated to the Broker by setting a RETAIN flag in a PUBLISH packet.
            This way, the publisher signals to the Broker to store the most
            recent message for the associated topic.  Hence, the new subscribers can receive
            the last sent message from the publisher for that particular topic without waiting
            for the next PUBLISH packet.
            The Broker MUST continue publishing
            the retained messages as long as the associated tokens are valid.
            In the MQTT standard, if QoS is 0 for the PUBLISH packet, the Broker may discard the
            retained message any time. For QoS&gt;1, the message expiry interval dictates how long the retained message is kept. 
            However, it is important that Broker avoids sending messages indefinitely for the Clients that never update their tokens (i.e.,
            the Client connects briefly with a valid token, sends a PUBLISH packet with RETAIN flag set to 1
            and QoS&gt;1, disconnects and never connects again). 
            Therefore, the Broker MUST use the minimum of token expiry and message expiry interval to discard
            a retained message.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">
            In case of disconnections due to network errors or server disconnection due to a protocol error
            (which includes authorization errors), the Will message is sent if the Client supplied
            a Will in the CONNECT packet.  The Client's token scope array MUST include the Will Topic.
            The Will message MUST be published to the Will Topic regardless of whether the corresponding
     token has expired (as it has been validated and accepted during CONNECT).<a href="#section-5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="MQTTv311">
<section id="section-6">
      <h2 id="name-reduced-protocol-interactio">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-reduced-protocol-interactio" class="section-name selfRef">Reduced Protocol Interactions for MQTT v3.1.1</a>
      </h2>
<p id="section-6-1">
        This section describes a reduced set of protocol interactions for the MQTT v3.1.1 Clients.
        An MQTT v5.0 Broker MAY implement these interactions for the MQTT v3.1.1 clients; 
        MQTT v5.0 clients are NOT RECOMMENDED
        to use the flows described in this section. 
        Brokers that do not support MQTT v3.1.1 clients return a CONNACK packet
        with Reason Code '0x84 (Unsupported Protocol Version)' in response to the connection requests.<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="token_311">
<section id="section-6.1">
        <h3 id="name-token-transport">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-token-transport" class="section-name selfRef">Token Transport</a>
        </h3>
<p id="section-6.1-1"> As in MQTT v5.0, the token MAY either be transported before, by publishing
             to the "authz-info" topic, or inside the CONNECT packet. If the Client provided
             the token via the "authz-info" topic and will not update the token in the CONNECT packet, 
             it MUST authenticate over TLS. The Broker SHOULD still be prepared to store the Client access
             token for future use (regardless of the method of transport).<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">In MQTT v3.1.1, after the Client published to the "authz-info" topic,
               the Broker cannot communicate
                the result of the token validation as PUBACK reason codes or server-side DISCONNECT
                packets are not supported.
                In any case, an invalid token would fail the subsequent TLS handshake,
                 which can prompt the Client to
                obtain a valid token.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">
                To transport the token to the Broker inside the CONNECT packet,
                the Client uses the username and password fields.
                <a href="#mqtt_connect_message" class="xref">Figure 11</a> shows the structure of the MQTT CONNECT packet.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<span id="name-mqtt-connect-variable-heade"></span><div id="mqtt_connect_message">
<figure id="figure-11">
          <div class="alignLeft art-text artwork" id="section-6.1-4.1">
<pre>
       0             8             16
       +---------------------------+
       |Protocol name length = 4   |
       +---------------------------+
       |     'M'            'Q'    |
       +---------------------------+
       |     'T'            'T'    |
       +---------------------------+
       |Proto.level=5|Connect flags|
       +---------------------------+
       |        Keep alive         |
       +---------------------------+
       |        Payload            |
       |  Client Identifier        |
       |  (UTF-8 encoded string)   |
       |  Username as access token |
       |   (UTF-8 endoded string)  |
       | Password for signature/MAC|
       |     (Binary Data)         |
       +---------------------------+
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-mqtt-connect-variable-heade" class="selfRef">MQTT CONNECT variable header using username and password for ACE.</a>
          </figcaption></figure>
</div>
<p id="section-6.1-5">
            <a href="#mqtt_connect_flags" class="xref">Figure 12</a> shows how the MQTT connect flags MUST be set to initiate
             a connection with the Broker.<a href="#section-6.1-5" class="pilcrow">¶</a></p>
<span id="name-mqtt-connect-flags-rsvdrese"></span><div id="mqtt_connect_flags">
<figure id="figure-12">
          <div class="alignLeft art-text artwork" id="section-6.1-6.1">
<pre>
+-----------------------------------------------------------+
|User name|Pass.|Will retain|Will QoS|Will Flag|Clean| Rsvd.|
| flag    |flag |           |        |         |     |      |
+-----------------------------------------------------------+
| 1       | 1   |    X      |   X X  |   X     |  X   |  0  |
+-----------------------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a>:
<a href="#name-mqtt-connect-flags-rsvdrese" class="selfRef">MQTT CONNECT flags. (Rsvd=Reserved)</a>
          </figcaption></figure>
</div>
<p id="section-6.1-7">
                    The Client SHOULD set the Clean flag to 1 to always start a new session. 
                    If the Clean flag is set to 0, the Broker MUST resume communications 
                    with the Client based on the state from the current Session (as identified by the Client Identifier). 
                    If there is no Session associated with the Client Identifier the Broker MUST create a new session.
                    The Broker MUST set the Session Present flag in the CONNACK packet accordingly, i.e. 0 to indicate a clean session to the 
                    Client and 1 to indicate session continuation.
                    The Broker MUST still perform proof-of-possession validation on the provided Client token. MQTT v3.1.1 does not use a 
                    Session Expiry Interval, and the Client expects that the Broker maintains the session 
                    state after it disconnects. However, stored Session state can be discarded as a result 
                    of administrator policies, and Brokers SHOULD implement the necessary policies to limit 
                    misuse.<a href="#section-6.1-7" class="pilcrow">¶</a></p>
<p id="section-6.1-8">
                    The Client MAY set the Will Flag as desired (marked as 'X' in
                     <a href="#mqtt_connect_flags" class="xref">Figure 12</a>). Username and Password flags MUST be
                      set to 1 to  ensure that the Payload of the CONNECT packet includes both Username 
                      and Password fields. The MQTT Username is a UTF-8 encoded string, and the MQTT Password is Binary Data.<a href="#section-6.1-8" class="pilcrow">¶</a></p>
<p id="section-6.1-9">
                   The CONNECT in MQTT v3.1.1 does not have a field to indicate the authentication
                    method. To signal that the Username field contains an ACE token,
                    this field MUST be prefixed with 'ace' keyword, 
                    i.e., the Username field is a concatenation of 'a', 'c', 'e' and the access token
                    represented as:<a href="#section-6.1-9" class="pilcrow">¶</a></p>
<span id="name-username-in-connect"></span><div id="v31username">
<figure id="figure-13">
          <div class="alignLeft art-text artwork" id="section-6.1-10.1">
<pre>
                     'U+0061'||'U+0063'||'U+0065'||UTF-8(access token)
</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a>:
<a href="#name-username-in-connect" class="selfRef">Username in CONNECT</a>
          </figcaption></figure>
</div>
<p id="section-6.1-11">
                    To this end, the access token MUST be base64url encoded,
                    omitting the '=' padding characters <span>[<a href="#RFC4648" class="xref">RFC4648</a>]</span>.<a href="#section-6.1-11" class="pilcrow">¶</a></p>
<p id="section-6.1-12">
                    The password field MUST be set to the keyed message digest (MAC)
                    or signature associated with the access token for proof-of-possession.
                    The Client MUST apply the PoP key on the challenge derived from the TLS
                    session as described in <a href="#pop_nonce" class="xref">Section 2.2.4.2.1</a>.<a href="#section-6.1-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="errors_311">
<section id="section-6.2">
        <h3 id="name-handling-authorization-erro">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-handling-authorization-erro" class="section-name selfRef">Handling Authorization Errors</a>
        </h3>
<p id="section-6.2-1">
                Error handling is more primitive in MQTT v3.1.1 due to not having appropriate error fields,
                error codes, and server-side DISCONNECTs. 
                Therefore, the broker will disconnect on almost any error and may not keep the
                session state, necessitating that clients make a greater
                effort to ensure that tokens remain valid and not attempt to publish
                to topics that they do not have permissions for.
                The following lists how the broker responds to specific errors.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-2.1">
                CONNECT without a token: The tokenless CONNECT attempt MUST fail. This is
                because the challenge-response based proof-of-possession is not possible for MQTT v3.1.1. 
                It is also not possible to support AS discovery since a CONNACK packet in MQTT v3.1.1
                  does not include a means to provide additional information to the Client.
     Therefore, AS discovery needs to take place out-of-band.<a href="#section-6.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.2-2.2">
                Client-RS PUBLISH authorization failure: In the case of a failure,
                  it is not possible to return an error in MQTT v3.1.1.
        Acknowledgment messages only indicate success. In the case of an authorization error,
                the Broker MUST ignore the PUBLISH packet and disconnect the Client.
          Also, as DISCONNECT packets are only sent
                from a Client to the Broker, the server disconnection needs to take place below the application layer.<a href="#section-6.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.2-2.3"> SUBSCRIBE authorization failure:  In the  SUBACK packet, the return code is 0x80 indicating
               'Failure' for the unauthorized topic(s). Note that, in both MQTT versions, a reason code is
                returned for each Topic Filter.<a href="#section-6.2-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.2-2.4">RS-Client PUBLISH authorization failure:  When RS is forwarding PUBLISH packets to the subscribed Clients,
       it may discover that some of the subscribers are no more authorized due to expired tokens.
               These token expirations MUST lead to disconnecting the Client rather than silently dropping messages.<a href="#section-6.2-2.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="IANA">
<section id="section-7">
      <h2 id="name-iana-considerations-2">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations-2" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-7-1"> Note to RFC Editor: Please replace all occurrences of "[this document]" 
        with the RFC number of this specification and delete this paragraph.<a href="#section-7-1" class="pilcrow">¶</a></p>
<section id="section-7.1">
        <h3 id="name-tls-exporter-label-registra">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-tls-exporter-label-registra" class="section-name selfRef">TLS Exporter Label Registration</a>
        </h3>
<p id="section-7.1-1">
            This document registers 'EXPORTER-ACE-MQTT-Sign-Challenge' (introduced in <a href="#pop_nonce" class="xref">Section 2.2.4.2.1</a>
           in this document) in the TLS Exporter Label Registry <span>[<a href="#RFC8447" class="xref">RFC8447</a>]</span>.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-2.1">Recommended: No<a href="#section-7.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.1-2.2">DTLS-OK: No<a href="#section-7.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.1-2.3">Reference: [This document]<a href="#section-7.1-2.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-7.2">
        <h3 id="name-media-type-registration">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-media-type-registration" class="section-name selfRef">Media Type Registration</a>
        </h3>
<p id="section-7.2-1">This document registers the 'application/ace+json' media type
            for messages of the protocols defined in this document carrying
            parameters encoded in JSON.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2-2.1">Type name: application<a href="#section-7.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.2">Subtype name:ace+json<a href="#section-7.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.3">Required parameters: none<a href="#section-7.2-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.4">Optional parameters: none<a href="#section-7.2-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.5">Encoding considerations: Encoding considerations are identical to
those specified for the 'application/json' media type.<a href="#section-7.2-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.6">Security considerations: Section 8 of [this document]<a href="#section-7.2-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.7">Interoperability considerations: none<a href="#section-7.2-2.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.8">Published specification: [this document]<a href="#section-7.2-2.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.9">Applications that use this media type: This media type is intended for
            authorization server-client and authorization server-resource server 
            communication as part of the ACE framework using JSON encoding as specified in [this document].<a href="#section-7.2-2.9" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.10">Fragment identifier considerations:none<a href="#section-7.2-2.10" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.11">
            <p id="section-7.2-2.11.1">Additional information:<a href="#section-7.2-2.11.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2-2.11.2.1">Deprecated alias names for this type:none<a href="#section-7.2-2.11.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-7.2-2.11.2.2">Magic number(s):none<a href="#section-7.2-2.11.2.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-7.2-2.11.2.3">File extension(s):none<a href="#section-7.2-2.11.2.3" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-7.2-2.11.2.4">Macintosh file type code(s):none<a href="#section-7.2-2.11.2.4" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-7.2-2.12">Person &amp; email address to contact for further information: Cigdem Sengul (csengul@acm.org)<a href="#section-7.2-2.12" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.13">Intended usage: COMMON<a href="#section-7.2-2.13" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.14">Restrictions on usage: none<a href="#section-7.2-2.14" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.15">Author: Cigdem Sengul (csengul@acm.org)<a href="#section-7.2-2.15" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.16">Change controller: IETF<a href="#section-7.2-2.16" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.17">Provisional registration? (standards tree only): no<a href="#section-7.2-2.17" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-7.3">
        <h3 id="name-ace-oauth-profile-registrat">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-ace-oauth-profile-registrat" class="section-name selfRef">ACE OAuth Profile Registration</a>
        </h3>
<p id="section-7.3-1">The following registrations are done for the ACE OAuth Profile Registry following the procedure specified in
         <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.3-2.1">Name: mqtt_tls<a href="#section-7.3-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.3-2.2">Description: Profile for delegating Client authentication and authorization using MQTT for the 
            Client and Broker (RS) interactions, and HTTP for the AS interactions. 
         TLS is used for confidentiality and integrity protection and server authentication. 
            Client authentication can be provided either via TLS or using in-band proof-of-possession at the MQTT
            application layer.<a href="#section-7.3-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.3-2.3">CBOR Value: To be assigned by IANA<a href="#section-7.3-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.3-2.4">Reference: [this document]<a href="#section-7.3-2.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</section>
</div>
<div id="Security">
<section id="section-8">
      <h2 id="name-security-considerations-2">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations-2" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1"> This document specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework
   <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. Therefore, the security considerations outlined
   in <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span> apply to this work.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2"> In addition, the security considerations outlined in <span><a href="#MQTT-OASIS-Standard-v5" class="xref">MQTT v5.0 - the OASIS Standard</a> [<a href="#MQTT-OASIS-Standard-v5" class="xref">MQTT-OASIS-Standard-v5</a>]</span>
   and <span><a href="#MQTT-OASIS-Standard" class="xref">MQTT v3.1.1 - the OASIS Standard</a> [<a href="#MQTT-OASIS-Standard" class="xref">MQTT-OASIS-Standard</a>]</span>
    apply.  Mainly, this document provides an authorization solution for MQTT,
    the responsibility of which is left to the specific implementation in the MQTT standards.
  In the following, we comment on a few relevant issues based on the current MQTT specifications.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">After the Broker validates an access token and accepts a connection from a client, it caches the token  
      to authorize a Client's publish and subscribe requests in an ongoing session. 
      Broker does not cache any invalid tokens.
      If a client's permissions get revoked, but the access token has not expired,
   the Broker may still grant publish/subscribe to revoked topics.
      If the Broker caches the token introspection responses, then the Broker SHOULD use a reasonable cache timeout
       to introspect tokens regularly. The timeout value is application-specific and SHOULD be chosen 
       to reduce the risk of using stale introspection responses.
   When permissions change dynamically, it is expected that AS also
       follows a reasonable expiration strategy for the access tokens.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4"> The Broker may monitor Client behaviour to detect potential security problems, especially those affecting availability.
   These include repeated token transfer attempts to the public "authz-info" topic, repeated connection attempts,
   abnormal terminations, and Clients that connect but do not send any data.
   If the Broker supports the public "authz-info" topic, described in <a href="#app-authzinfo" class="xref">Section 2.2.2</a>,
   then this may be vulnerable to a DDoS attack, where many Clients use the "authz-info" public topic
      to transport tokens that are not meant to be used, and which the Broker may need to store until the 
      tokens expire.<a href="#section-8-4" class="pilcrow">¶</a></p>
<p id="section-8-5">For MQTT v5.0, when a Client connects with a long Session Expiry Interval, the Broker may need to  maintain 
      the Client's MQTT session state after it disconnects for an extended period. For MQTT v3.1.1, 
      the session state may need to be stored indefinitely, as it does not have a Session Expiry Interval feature. 
      The Broker SHOULD implement administrative policies to limit misuse of the session continuation by the Client.<a href="#section-8-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Privacy">
<section id="section-9">
      <h2 id="name-privacy-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy Considerations</a>
      </h2>
<p id="section-9-1">The privacy considerations outlined in <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span> apply to this work.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">In MQTT, the RS is a central trusted party and may forward potentially sensitive information
         between Clients. The mechanisms defined in this document do not protect the contents of the PUBLISH packet from the Broker, and hence,
                the content of the PUBLISH packet is not signed or encrypted separately for the subscribers.
                This functionality may be implemented using the proposal outlined in <span><a href="#I-D.ietf-ace-pubsub-profile" class="xref">the ACE Pub-Sub Profile</a> [<a href="#I-D.ietf-ace-pubsub-profile" class="xref">I-D.ietf-ace-pubsub-profile</a>]</span>.
         However, this solution would still not provide privacy for other fields of the packet, such as Topic Name.<a href="#section-9-2" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-10">
      <h2 id="name-references-2">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references-2" class="section-name selfRef">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references-2">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references-2" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-ace-aif">[I-D.ietf-ace-aif]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"An Authorization Information Format (AIF) for ACE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-aif-05</span>, <time datetime="2022-02-14" class="refDate">14 February 2022</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-ace-aif-05.txt">https://www.ietf.org/archive/id/draft-ietf-ace-aif-05.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-dtls-authorize">[I-D.ietf-ace-dtls-authorize]</dt>
        <dd>
<span class="refAuthor">Gerdes, S.</span>, <span class="refAuthor">Bergmann, O.</span>, <span class="refAuthor">Bormann, C.</span>, <span class="refAuthor">Selander, G.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Datagram Transport Layer Security (DTLS) Profile for Authentication and Authorization for Constrained Environments (ACE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-dtls-authorize-18</span>, <time datetime="2021-06-04" class="refDate">4 June 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-ace-dtls-authorize-18.txt">https://www.ietf.org/archive/id/draft-ietf-ace-dtls-authorize-18.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-extend-dtls-authorize">[I-D.ietf-ace-extend-dtls-authorize]</dt>
        <dd>
<span class="refAuthor">Bergmann, O.</span>, <span class="refAuthor">Mattsson, J. P.</span>, and <span class="refAuthor">G. Selander</span>, <span class="refTitle">"Extension of the ACE CoAP-DTLS Profile to TLS"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-extend-dtls-authorize-01</span>, <time datetime="2022-02-04" class="refDate">4 February 2022</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-ace-extend-dtls-authorize-01.txt">https://www.ietf.org/archive/id/draft-ietf-ace-extend-dtls-authorize-01.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</dt>
        <dd>
<span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Authentication and Authorization for Constrained Environments (ACE) using the OAuth 2.0 Framework (ACE-OAuth)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-oauth-authz-46</span>, <time datetime="2021-11-08" class="refDate">8 November 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-ace-oauth-authz-46.txt">https://www.ietf.org/archive/id/draft-ietf-ace-oauth-authz-46.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-oauth-params">[I-D.ietf-ace-oauth-params]</dt>
        <dd>
<span class="refAuthor">Seitz, L.</span>, <span class="refTitle">"Additional OAuth Parameters for Authorization in Constrained Environments (ACE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-oauth-params-16</span>, <time datetime="2021-09-07" class="refDate">7 September 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-ace-oauth-params-16.txt">https://www.ietf.org/archive/id/draft-ietf-ace-oauth-params-16.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cose-x509">[I-D.ietf-cose-x509]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Header parameters for carrying and referencing X.509 certificates"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-x509-08</span>, <time datetime="2020-12-14" class="refDate">14 December 2020</time>, <span>&lt;<a href="https://www.ietf.org/internet-drafts/draft-ietf-cose-x509-08.txt">https://www.ietf.org/internet-drafts/draft-ietf-cose-x509-08.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="MQTT-OASIS-Standard">[MQTT-OASIS-Standard]</dt>
        <dd>
<span class="refAuthor">Banks, A., Ed.</span> and <span class="refAuthor">R. Gupta, Ed.</span>, <span class="refTitle">"OASIS Standard MQTT Version 3.1.1 Plus Errata 01"</span>, <time datetime="2015" class="refDate">2015</time>, <span>&lt;<a href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.html">http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="MQTT-OASIS-Standard-v5">[MQTT-OASIS-Standard-v5]</dt>
        <dd>
<span class="refAuthor">Banks, A., Ed.</span>, <span class="refAuthor">Briggs, E., Ed.</span>, <span class="refAuthor">Borgendale, K., Ed.</span>, and <span class="refAuthor">R. Gupta, Ed.</span>, <span class="refTitle">"OASIS Standard MQTT Version 5.0"</span>, <time datetime="2017" class="refDate">2017</time>, <span>&lt;<a href="http://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html">http://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4648">[RFC4648]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span>, <span class="refTitle">"The Base16, Base32, and Base64 Data Encodings"</span>, <span class="seriesInfo">RFC 4648</span>, <span class="seriesInfo">DOI 10.17487/RFC4648</span>, <time datetime="2006-10" class="refDate">October 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4648">https://www.rfc-editor.org/info/rfc4648</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5705">[RFC5705]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"Keying Material Exporters for Transport Layer Security (TLS)"</span>, <span class="seriesInfo">RFC 5705</span>, <span class="seriesInfo">DOI 10.17487/RFC5705</span>, <time datetime="2010-03" class="refDate">March 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5705">https://www.rfc-editor.org/info/rfc5705</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6066">[RFC6066]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span>, <span class="refTitle">"Transport Layer Security (TLS) Extensions: Extension Definitions"</span>, <span class="seriesInfo">RFC 6066</span>, <span class="seriesInfo">DOI 10.17487/RFC6066</span>, <time datetime="2011-01" class="refDate">January 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6066">https://www.rfc-editor.org/info/rfc6066</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6234">[RFC6234]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span> and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)"</span>, <span class="seriesInfo">RFC 6234</span>, <span class="seriesInfo">DOI 10.17487/RFC6234</span>, <time datetime="2011-05" class="refDate">May 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6234">https://www.rfc-editor.org/info/rfc6234</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6749">[RFC6749]</dt>
        <dd>
<span class="refAuthor">Hardt, D., Ed.</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework"</span>, <span class="seriesInfo">RFC 6749</span>, <span class="seriesInfo">DOI 10.17487/RFC6749</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6749">https://www.rfc-editor.org/info/rfc6749</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7230">[RFC7230]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span> and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing"</span>, <span class="seriesInfo">RFC 7230</span>, <span class="seriesInfo">DOI 10.17487/RFC7230</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7230">https://www.rfc-editor.org/info/rfc7230</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7250">[RFC7250]</dt>
        <dd>
<span class="refAuthor">Wouters, P., Ed.</span>, <span class="refAuthor">Tschofenig, H., Ed.</span>, <span class="refAuthor">Gilmore, J.</span>, <span class="refAuthor">Weiler, S.</span>, and <span class="refAuthor">T. Kivinen</span>, <span class="refTitle">"Using Raw Public Keys in Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)"</span>, <span class="seriesInfo">RFC 7250</span>, <span class="seriesInfo">DOI 10.17487/RFC7250</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7250">https://www.rfc-editor.org/info/rfc7250</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7251">[RFC7251]</dt>
        <dd>
<span class="refAuthor">McGrew, D.</span>, <span class="refAuthor">Bailey, D.</span>, <span class="refAuthor">Campagna, M.</span>, and <span class="refAuthor">R. Dugal</span>, <span class="refTitle">"AES-CCM Elliptic Curve Cryptography (ECC) Cipher Suites for TLS"</span>, <span class="seriesInfo">RFC 7251</span>, <span class="seriesInfo">DOI 10.17487/RFC7251</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7251">https://www.rfc-editor.org/info/rfc7251</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7301">[RFC7301]</dt>
        <dd>
<span class="refAuthor">Friedl, S.</span>, <span class="refAuthor">Popov, A.</span>, <span class="refAuthor">Langley, A.</span>, and <span class="refAuthor">E. Stephan</span>, <span class="refTitle">"Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension"</span>, <span class="seriesInfo">RFC 7301</span>, <span class="seriesInfo">DOI 10.17487/RFC7301</span>, <time datetime="2014-07" class="refDate">July 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7301">https://www.rfc-editor.org/info/rfc7301</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7516">[RFC7516]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span> and <span class="refAuthor">J. Hildebrand</span>, <span class="refTitle">"JSON Web Encryption (JWE)"</span>, <span class="seriesInfo">RFC 7516</span>, <span class="seriesInfo">DOI 10.17487/RFC7516</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7516">https://www.rfc-editor.org/info/rfc7516</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7517">[RFC7517]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refTitle">"JSON Web Key (JWK)"</span>, <span class="seriesInfo">RFC 7517</span>, <span class="seriesInfo">DOI 10.17487/RFC7517</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7517">https://www.rfc-editor.org/info/rfc7517</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7519">[RFC7519]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">N. Sakimura</span>, <span class="refTitle">"JSON Web Token (JWT)"</span>, <span class="seriesInfo">RFC 7519</span>, <span class="seriesInfo">DOI 10.17487/RFC7519</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7519">https://www.rfc-editor.org/info/rfc7519</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7627">[RFC7627]</dt>
        <dd>
<span class="refAuthor">Bhargavan, K., Ed.</span>, <span class="refAuthor">Delignat-Lavaud, A.</span>, <span class="refAuthor">Pironti, A.</span>, <span class="refAuthor">Langley, A.</span>, and <span class="refAuthor">M. Ray</span>, <span class="refTitle">"Transport Layer Security (TLS) Session Hash and Extended Master Secret Extension"</span>, <span class="seriesInfo">RFC 7627</span>, <span class="seriesInfo">DOI 10.17487/RFC7627</span>, <time datetime="2015-09" class="refDate">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7627">https://www.rfc-editor.org/info/rfc7627</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7800">[RFC7800]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Proof-of-Possession Key Semantics for JSON Web Tokens (JWTs)"</span>, <span class="seriesInfo">RFC 7800</span>, <span class="seriesInfo">DOI 10.17487/RFC7800</span>, <time datetime="2016-04" class="refDate">April 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7800">https://www.rfc-editor.org/info/rfc7800</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8032">[RFC8032]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span> and <span class="refAuthor">I. Liusvaara</span>, <span class="refTitle">"Edwards-Curve Digital Signature Algorithm (EdDSA)"</span>, <span class="seriesInfo">RFC 8032</span>, <span class="seriesInfo">DOI 10.17487/RFC8032</span>, <time datetime="2017-01" class="refDate">January 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8032">https://www.rfc-editor.org/info/rfc8032</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8152">[RFC8152]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE)"</span>, <span class="seriesInfo">RFC 8152</span>, <span class="seriesInfo">DOI 10.17487/RFC8152</span>, <time datetime="2017-07" class="refDate">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8152">https://www.rfc-editor.org/info/rfc8152</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8422">[RFC8422]</dt>
        <dd>
<span class="refAuthor">Nir, Y.</span>, <span class="refAuthor">Josefsson, S.</span>, and <span class="refAuthor">M. Pegourie-Gonnard</span>, <span class="refTitle">"Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) Versions 1.2 and Earlier"</span>, <span class="seriesInfo">RFC 8422</span>, <span class="seriesInfo">DOI 10.17487/RFC8422</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8422">https://www.rfc-editor.org/info/rfc8422</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8610">https://www.rfc-editor.org/info/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8705">[RFC8705]</dt>
        <dd>
<span class="refAuthor">Campbell, B.</span>, <span class="refAuthor">Bradley, J.</span>, <span class="refAuthor">Sakimura, N.</span>, and <span class="refAuthor">T. Lodderstedt</span>, <span class="refTitle">"OAuth 2.0 Mutual-TLS Client Authentication and Certificate-Bound Access Tokens"</span>, <span class="seriesInfo">RFC 8705</span>, <span class="seriesInfo">DOI 10.17487/RFC8705</span>, <time datetime="2020-02" class="refDate">February 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8705">https://www.rfc-editor.org/info/rfc8705</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8747">[RFC8747]</dt>
      <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Proof-of-Possession Key Semantics for CBOR Web Tokens (CWTs)"</span>, <span class="seriesInfo">RFC 8747</span>, <span class="seriesInfo">DOI 10.17487/RFC8747</span>, <time datetime="2020-03" class="refDate">March 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8747">https://www.rfc-editor.org/info/rfc8747</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references-2">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references-2" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="fremantle14">[fremantle14]</dt>
        <dd>
<span class="refAuthor">Fremantle, P.</span>, <span class="refAuthor">Aziz, B.</span>, <span class="refAuthor">Kopecky, J.</span>, and <span class="refAuthor">P. Scott</span>, <span class="refTitle">"Federated Identity and Access Management for the Internet of Things"</span>, <span class="seriesInfo">research International Workshop on Secure Internet of Things</span>, <time datetime="2014-09" class="refDate">September 2014</time>, <span>&lt;<a href="http://dx.doi.org/10.1109/SIoT.2014.8">http://dx.doi.org/10.1109/SIoT.2014.8</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-pubsub-profile">[I-D.ietf-ace-pubsub-profile]</dt>
        <dd>
<span class="refAuthor">Palombini, F.</span>, <span class="refTitle">"Pub-Sub Profile for Authentication and Authorization for Constrained Environments (ACE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-pubsub-profile-01</span>, <time datetime="2020-07-03" class="refDate">3 July 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-ace-pubsub-profile-01.txt">http://www.ietf.org/internet-drafts/draft-ietf-ace-pubsub-profile-01.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4949">[RFC4949]</dt>
        <dd>
<span class="refAuthor">Shirey, R.</span>, <span class="refTitle">"Internet Security Glossary, Version 2"</span>, <span class="seriesInfo">FYI 36</span>, <span class="seriesInfo">RFC 4949</span>, <span class="seriesInfo">DOI 10.17487/RFC4949</span>, <time datetime="2007-08" class="refDate">August 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4949">https://www.rfc-editor.org/info/rfc4949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Hartke, K.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7252">https://www.rfc-editor.org/info/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7525">[RFC7525]</dt>
        <dd>
<span class="refAuthor">Sheffer, Y.</span>, <span class="refAuthor">Holz, R.</span>, and <span class="refAuthor">P. Saint-Andre</span>, <span class="refTitle">"Recommendations for Secure Use of Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)"</span>, <span class="seriesInfo">BCP 195</span>, <span class="seriesInfo">RFC 7525</span>, <span class="seriesInfo">DOI 10.17487/RFC7525</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7525">https://www.rfc-editor.org/info/rfc7525</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7925">[RFC7925]</dt>
        <dd>
<span class="refAuthor">Tschofenig, H., Ed.</span> and <span class="refAuthor">T. Fossati</span>, <span class="refTitle">"Transport Layer Security (TLS) / Datagram Transport Layer Security (DTLS) Profiles for the Internet of Things"</span>, <span class="seriesInfo">RFC 7925</span>, <span class="seriesInfo">DOI 10.17487/RFC7925</span>, <time datetime="2016-07" class="refDate">July 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7925">https://www.rfc-editor.org/info/rfc7925</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8392">[RFC8392]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"CBOR Web Token (CWT)"</span>, <span class="seriesInfo">RFC 8392</span>, <span class="seriesInfo">DOI 10.17487/RFC8392</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8392">https://www.rfc-editor.org/info/rfc8392</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8447">[RFC8447]</dt>
        <dd>
<span class="refAuthor">Salowey, J.</span> and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"IANA Registry Updates for TLS and DTLS"</span>, <span class="seriesInfo">RFC 8447</span>, <span class="seriesInfo">DOI 10.17487/RFC8447</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8447">https://www.rfc-editor.org/info/rfc8447</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
      <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8949">https://www.rfc-editor.org/info/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="app-profile-requirements">
<section id="appendix-A">
      <h2 id="name-checklist-for-profile-requi">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-checklist-for-profile-requi" class="section-name selfRef">Checklist for profile requirements</a>
      </h2>
<ul class="normal">
<li class="normal" id="appendix-A-1.1">Optional AS discovery: AS discovery is supported with the MQTT v5.0 described in <a href="#connect_v5" class="xref">Section 2.2</a>.<a href="#appendix-A-1.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-1.2">The communication protocol between the Client and RS: MQTT<a href="#appendix-A-1.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-1.3">The security protocol between the Client and RS: TLS<a href="#appendix-A-1.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-1.4">Client and RS mutual authentication: Several options are possible and described in <a href="#auth_options" class="xref">Section 2.2.1</a>.<a href="#appendix-A-1.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-1.5"> Proof-of-possession protocols: Specified in <a href="#AUTH-method" class="xref">Section 2.2.4.2</a>; both symmetric and asymmetric keys supported.<a href="#appendix-A-1.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-1.6">Content format: For the HTTPS interactions with AS, "application/ace+json".<a href="#appendix-A-1.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-1.7">Unique profile identifier: mqtt_tls<a href="#appendix-A-1.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-1.8">Token introspection: RS uses HTTPS introspect interface of AS.<a href="#appendix-A-1.8" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-1.9">Token request: Client or its Client AS uses the HTTPS token endpoint of the AS.<a href="#appendix-A-1.9" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-1.10">authz-info endpoint: It MAY be supported using the method described in <a href="#app-authzinfo" class="xref">Section 2.2.2</a>, but is
                        not protected other than by the TLS channel between Client and RS.<a href="#appendix-A-1.10" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-1.11">Token transport: Via "authz-info" topic, or TLS with PSK, provided as a PSK identity, or in
                      MQTT CONNECT packet for both versions of MQTT.
                      The AUTH extensions can also be used for authentication and re-authentication for
             MQTT v5.0, as described in <a href="#connect_v5" class="xref">Section 2.2</a> and <a href="#reauthentication" class="xref">Section 4</a>.<a href="#appendix-A-1.11" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="document_updates">
<section id="appendix-B">
      <h2 id="name-document-updates">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-document-updates" class="section-name selfRef">Document Updates</a>
      </h2>
<p id="appendix-B-1">Version 11 to 14: Addressing AD review comments.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<p id="appendix-B-2"> Version 10 to 11: Clarified the TLS use between RS-AS and Client-AS.<a href="#appendix-B-2" class="pilcrow">¶</a></p>
<p id="appendix-B-3"> Version 09 to 10: Fixed version issues for references.<a href="#appendix-B-3" class="pilcrow">¶</a></p>
<p id="appendix-B-4"> Version 08 to 09: Fixed spacing issues and references.<a href="#appendix-B-4" class="pilcrow">¶</a></p>
<p id="appendix-B-5"> Version 07 to 08:<a href="#appendix-B-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-6.1">Fixed several nits, typos based on WG reviews.<a href="#appendix-B-6.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-6.2">Added missing references.<a href="#appendix-B-6.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-6.3">Added the definition for Property defined by MQTT, and Client Authorization Server.<a href="#appendix-B-6.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-6.4">Added artwork to show Authorization Data format for various PoP-related message exchange.<a href="#appendix-B-6.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-6.5">Removed all MQTT-related must/should/may.<a href="#appendix-B-6.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-6.6">Made AS discovery optional.<a href="#appendix-B-6.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-6.7">Clarified what the client and server must implement for client authentication; cleaned
            up TLS 1.3 related language.<a href="#appendix-B-6.7" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-7"> Version 06 to 07:<a href="#appendix-B-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-8.1">Corrected the title.<a href="#appendix-B-8.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-8.2">In Section 2.2.3, added the constraint on which packets the Client can send, and the server 
               can process after CONNECT before CONNACK.<a href="#appendix-B-8.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-8.3">In Section 2.2.3, clarified that session state is identified by Client Identifier, 
            and listed its content.<a href="#appendix-B-8.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-8.4">In Section 2.2.3, clarified the issue of Client Identifier collision, when the broker supports
            session continuation.<a href="#appendix-B-8.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-8.5">Corrected the buggy scope example in Section 3.1.<a href="#appendix-B-8.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-9"> Version 05 to 06:<a href="#appendix-B-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-10.1">Replace the originally proposed scope format with AIF model. Defined the AIF-MQTT,
               gave an example with a JSON array. Added a normative reference to the AIF draft.<a href="#appendix-B-10.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-10.2">Clarified client connection after submitting token via "authz-info" topic as 
            TLS:Known(RPK/PSK),MQTT:none.<a href="#appendix-B-10.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-10.3">Expanded acronyms on their first use including the ones in the title.<a href="#appendix-B-10.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-10.4">Added a definition for "Session".<a href="#appendix-B-10.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-10.5">Corrected "CONNACK" definition, which earlier said it's the first packet sent by the broker.<a href="#appendix-B-10.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-10.6">Added a statement that the the broker will disconnect on almost any error and may not keep session state.<a href="#appendix-B-10.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-10.7">Clarified that the broker does not cache invalid tokens.<a href="#appendix-B-10.7" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-11"> Version 04 to 05:<a href="#appendix-B-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-12.1">Reorganised Section 2 such that "Unauthorized Request: Authorization Server Discovery" 
             is presented under Section 2.<a href="#appendix-B-12.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-12.2">Fixed Figure 2 to remove the "empty" word.<a href="#appendix-B-12.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-12.3">Clarified that MQTT v5.0 Brokers may implement username/password option for 
              transporting the ACE token only for MQTT v.3.1.1 clients. This option is not recommended 
              for MQTT v.5.0 clients.<a href="#appendix-B-12.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-12.4">Changed Clean Session requirement both for MQTT v.5.0 and v.3.1.1. The Broker SHOULD NOT, instead of MUST NOT, continue sessions. 
               Clarified expected behaviour if session continuation is supported. Added to the Security 
               Considerations the potential misuse of session continuation.<a href="#appendix-B-12.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-12.5">Fixed the Authentication Data to include token length for the Challenge/Response PoP.<a href="#appendix-B-12.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-12.6">Added that Authorization Server Discovery is triggered if a token is invalid and not only missing.<a href="#appendix-B-12.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-12.7">Clarified that the Broker should not accept any other packets from Client after CONNECT and
            before sending CONNACK.<a href="#appendix-B-12.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-12.8"> Added that client reauthentication is accepted only for the challenge/response PoP.<a href="#appendix-B-12.8" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-12.9"> Added Ed25519 as mandatory to implement.<a href="#appendix-B-12.9" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-12.10">Fixed typos.<a href="#appendix-B-12.10" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-13">
        Version 03 to 04:<a href="#appendix-B-13" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-14.1">Linked the terms Broker and MQTT server more at the introduction of the document.<a href="#appendix-B-14.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-14.2">Clarified support for MQTTv3.1.1 and removed phrases that might be considered as MQTTv5 is backwards compatible with MQTTv3.1.1<a href="#appendix-B-14.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-14.3">Corrected the Informative and Normative references.<a href="#appendix-B-14.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-14.4">For AS discovery, clarified the CONNECT message omits the Authentication Data field.
            Specified the User Property MUST be set to "ace_as_hint" for AS Request Creation Hints.<a href="#appendix-B-14.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-14.5">Added that MQTT v5 brokers MAY also implement reduced interactions described for MQTTv3.1.1.<a href="#appendix-B-14.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-14.6">Added to Section 3.1, in case of an authorization failure and QoS level 0, 
            the RS sends a DISCONNECT with reason code '0x87 (Not authorized)'.<a href="#appendix-B-14.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-14.7">Added a pointer to section 4.7 of MQTTv5 spec for more information on topic names and filters.<a href="#appendix-B-14.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-14.8">Added HS256 and RSA256 are mandatory to implement depending on the choice
                    of symmetric or asymmetric validation.<a href="#appendix-B-14.8" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-14.9">Added MQTT to the TLS exporter label to make it application specific: 'EXPORTER-ACE-MQTT-Sign-Challenge'.<a href="#appendix-B-14.9" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-14.10">Added a format for Authentication Data so that length values prefix the token (or client nonce)
            when Authentication Data contains more than one piece of information.<a href="#appendix-B-14.10" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-14.11"> Clarified clients still connect over TLS (server-side) for the authz-info flow.<a href="#appendix-B-14.11" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-15">
        Version 02 to 03:<a href="#appendix-B-15" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-16.1">Added the option of Broker certificate thumbprint in the 'rs_cnf' sent to the Client.<a href="#appendix-B-16.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-16.2">Clarified the use of a random nonce from the TLS Exporter for PoP, added to the IANA requirements that
            the label should be registered.<a href="#appendix-B-16.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-16.3">Added a client nonce, when Challenge/Response Authentication is used between Client and Broker.<a href="#appendix-B-16.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-16.4">Clarified the use of the "authz-info" topic and the error response if token validation fails.<a href="#appendix-B-16.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-16.5">Added clarification on wildcard use in scopes for publish/subscribe permissions<a href="#appendix-B-16.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-16.6">Reorganised sections so that token authorization for publish/subscribe messages are better placed.<a href="#appendix-B-16.6" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-17">
        Version 01 to 02:<a href="#appendix-B-17" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-18.1"> Clarified protection of Application Message payload as out of scope, and cited draft-palombini-ace-coap-pubsub-profile
                for a potential solution<a href="#appendix-B-18.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-18.2"> Expanded Client connection authorization to capture different options for Client and Broker
                authentication over TLS and MQTT<a href="#appendix-B-18.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-18.3"> Removed Payload (and specifically Client Identifier) from proof-of-possession
                in favor of using tls-exporter for a TLS-session based challenge.<a href="#appendix-B-18.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-18.4"> Moved token transport via "authz-info" topic from the Appendix to the main text.<a href="#appendix-B-18.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-18.5"> Clarified Will scope.<a href="#appendix-B-18.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-18.6"> Added MQTT AUTH to terminology.<a href="#appendix-B-18.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-18.7"> Typo fixes, and simplification of figures.<a href="#appendix-B-18.7" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-B-19">
        Version 00 to 01:<a href="#appendix-B-19" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-20.1"> Present the MQTTv5 as the RECOMMENDED version, and MQTT v3.1.1 for backward compatibility.<a href="#appendix-B-20.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-20.2"> Clarified Will message.<a href="#appendix-B-20.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-20.3"> Improved consistency in the use of terminology and upper/lower case.<a href="#appendix-B-20.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-20.4"> Defined Broker and MQTTS.<a href="#appendix-B-20.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-20.5"> Clarified HTTPS use for C-AS and RS-AS communication. Removed reference to actors document, and clarified the use of client authorization server.<a href="#appendix-B-20.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-20.6"> Clarified the Connect message payload and Client Identifier.<a href="#appendix-B-20.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-20.7"> Presented different methods for passing the token and PoP.<a href="#appendix-B-20.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-20.8"> Added new figures to explain AUTH packets exchange, updated CONNECT message figure.<a href="#appendix-B-20.8" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="Acknowledgments">
<section id="appendix-C">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-C-1">
                The authors would like to thank Ludwig Seitz for his review and his input on the authorization information endpoint, 
                and Benjamin Kaduk for his review, insightful comments, and contributions to resolving issues.

                The authors would like to thank Paul Fremantle for the initial discussions on MQTT v5.0 support.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Cigdem Sengul</span></div>
<div dir="auto" class="left"><span class="org">Brunel University</span></div>
<div dir="auto" class="left"><span class="street-address">Dept. of Computer Science</span></div>
<div dir="auto" class="left"><span class="locality">Uxbridge</span></div>
<div dir="auto" class="left"><span class="postal-code">UB8 3PH</span></div>
<div dir="auto" class="left"><span class="country-name">United Kingdom</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:csengul@acm.org" class="email">csengul@acm.org</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Anthony Kirby</span></div>
<div dir="auto" class="left"><span class="org">Oxbotica</span></div>
<div dir="auto" class="left"><span class="street-address">1a Milford House, Mayfield Road, Summertown</span></div>
<div dir="auto" class="left"><span class="locality">Oxford</span></div>
<div dir="auto" class="left"><span class="postal-code">OX2 7EL</span></div>
<div dir="auto" class="left"><span class="country-name">United Kingdom</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:anthony@anthony.org" class="email">anthony@anthony.org</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
