<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IMAP4 Extension for Fuzzy Search</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IMAP4 Extension for Fuzzy Search">
<meta name="keywords" content="IMAP, email, SEARCH, fuzzy">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Message Organization Working Group</td><td class="header">T. Sirainen</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">January 23, 2010</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: July 27, 2010</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />IMAP4 Extension for Fuzzy Search<br />draft-ietf-morg-fuzzy-search-02</h1>

<h3>Abstract</h3>

<p>
		This document describes an IMAP protocol extension enabling server to
		perform searches with inexact matching and assigning relevancy
		scores for matched messages.
	  
</p>
<h3>Note</h3>

<p>
        A revised version of this draft document will be submitted to the RFC
        editor as a Proposed Standard for the Internet Community.
        Discussion and suggestions for improvement are requested, and should
        be sent to morg@ietf.org.
      
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on July 27, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>

<a name="anchor1"></a><br /><hr />
<a name="rfc.section.1"></a><h3>1.&nbsp;
Conventions used in this document</h3>

<p>In examples, "C:" indicates lines sent by a client that is connected
      to a server.  "S:" indicates lines sent by the server to the client.
</p>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
	  "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document
	  are to be interpreted as described in RFC 2119 <a class='info' href='#Kwds'>[Kwds]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor2"></a><br /><hr />
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction</h3>

<p>When humans perform searches in IMAP clients, they typically want to
		see the most relevant search results first. IMAP servers are able to
		do this in the most efficient way when they're free to internally
		decide how searches should match messages. This document describes a
		new SEARCH=FUZZY extension that provides such functionality.
</p>
<a name="anchor3"></a><br /><hr />
<a name="rfc.section.3"></a><h3>3.&nbsp;
The FUZZY Search Key</h3>

<p>FUZZY search key takes another search key as its argument. Server
		is allowed to perform all matching in an implementation-defined manner
		for this search key. Typically this would be used to search
		for strings, for example:
</p>
<p>
		C: A01 SEARCH FUZZY (SUBJECT "IMAP break")<br />

		S: * SEARCH 1 5 10<br />

		S: A01 OK Search completed.
		
</p>
<p>Besides matching messages with subject "IMAP break", the above
		search may also match messages with subjects "broken IMAP", "IMAP is
		broken", or anything else the server decides that might be a good
		match.
</p>
<a name="anchor4"></a><br /><hr />
<a name="rfc.section.4"></a><h3>4.&nbsp;
Relevancy Scores for Search Results</h3>

<p>Servers SHOULD assign a search relevancy score for each matched
		message when the FUZZY search key is given. Relevancy scores are
		given in range 1-100, where 100 is the highest relevancy. The relevancy
		scores SHOULD use the full 1-100 range, so that clients can show them
		to users in a meaningful way, such as a percentage value.
</p>
<p>As the name already tells, relevancy scores specify how relevant to
		the search the matched message is. It's not necessarily the same as
		how precisely the message matched. For example a message whose subject
		matches fuzzily the search string might get a higher relevancy score
		than a message whose body had the exact string in the middle of a
		sentence.
</p>
<p>If server advertises the ESEARCH capability as defined by
		<a class='info' href='#ESEARCH'>[ESEARCH]<span> (</span><span class='info'>Melnikov, A. and D. Cridland, &ldquo;IMAP4 Extension to SEARCH Command for Controlling             What Kind of Information Is Returned,&rdquo; November&nbsp;2006.</span><span>)</span></a>, the relevancy scores can be retrieved using
		the new RELEVANCY return option for SEARCH:
</p>
<p>
		C: A02 SEARCH RETURN (RELEVANCY ALL) FUZZY TEXT "Helo"<br />

		S: * ESEARCH (TAG "A02") ALL 1,5,10 RELEVANCY (4 99 42)<br />

		S: A02 OK Search completed.
		
</p>
<p>The RELEVANCY return option MUST NOT be used unless FUZZY search key
		is also given.
</p>
<a name="anchor5"></a><br /><hr />
<a name="rfc.section.5"></a><h3>5.&nbsp;
Fuzzy matching with non-string search keys</h3>

<p>Fuzzy matching is not limited to just string matching.  All search
		keys SHOULD be matched fuzzily, although what exactly that means for
		different search keys is left up to server implementations to decide
		-- including deciding that fuzzy matching is meaningless for a
		particular key, and falling back to exact matching.  Some suggestions
		are given below.
</p>
<p>Dates: A typical example could be when a user wants to find a
		message "from Dave about a week ago". A client could perform this
		search using SEARCH FUZZY (FROM "Dave" SINCE 21-Jan-2009 BEFORE
		24-Jan-2009). Server could return messages outside the specified
		date range, but the further away the message is, the lower the
		relevancy score.
</p>
<p>Sizes: These should be handled similar to dates. If a user wants
		to search for "about 1 MB attachments", the client could do this by
		sending SEARCH FUZZY (LARGER 900000 SMALLER 1100000). Again the further
		away the message size is from the specified range, the lower the
		relevancy score.
</p>
<p>Flags: Server could return messages that don't have the specified
		flags, but with a lower relevancy score.
</p>
<p>UIDs, sequences, modification sequences: These are examples of keys
		for which exact matching is probably what makes sense.  Alternatively,
		a server might choose, for instance, to expand a UID range by 5% on
		each side.
</p>
<a name="anchor6"></a><br /><hr />
<a name="rfc.section.6"></a><h3>6.&nbsp;
Extensions to SORT</h3>

<p>If server advertises the SORT capability as defined by
		<a class='info' href='#SORT'>[SORT]<span> (</span><span class='info'>Crispin, M. and K. Murchison, &ldquo;Internet Message Access Protocol - SORT and THREAD Extensions,&rdquo; June&nbsp;2008.</span><span>)</span></a>, the results can be sorted by the new RELEVANCY
		sort criteria:
</p>
<p>
		C: A03 SORT (RELEVANCY) UTF-8 FUZZY SUBJECT "Helo"<br />

		S: * SORT 5 10 1<br />

		S: A03 OK Sort completed.
		
</p>
<p>The message with the highest score is returned first. As with
		RELEVANCY return option, RELEVANCY sort criteria MUST NOT be used
		unless FUZZY search key is also given.
</p>
<p>If server advertises the ESORT capability as defined by
		<a class='info' href='#CONTEXT'>[CONTEXT]<span> (</span><span class='info'>Cridland, D. and C. King, &ldquo;Contexts for IMAP4,&rdquo; July&nbsp;2008.</span><span>)</span></a>, the relevancy scores can be retrieved using
		the new RELEVANCY return option for SORT:
</p>
<p>
		C: A04 SORT RETURN (RELEVANCY ALL) (RELEVANCY) FUZZY TEXT "Helo"<br />

		S: * ESEARCH (TAG "A04") ALL 5,10,1 RELEVANCY (99 42 4)<br />

		S: A04 OK Sort completed.
		
</p>
<a name="syntax"></a><br /><hr />
<a name="rfc.section.7"></a><h3>7.&nbsp;
Formal Syntax</h3>

<p>
		The following syntax specification uses the augmented Backus-Naur Form (BNF)
		as described in <a class='info' href='#ABNF'>[ABNF]<span> (</span><span class='info'>Crocker, D., Ed. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>. It includes definitions from
		<a class='info' href='#RFC3501'>[RFC3501]<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a>, <a class='info' href='#IMAP-ABNF'>[IMAP&#8209;ABNF]<span> (</span><span class='info'>Melnikov, A. and C. Daboo, &ldquo;Collected Extensions to IMAP4 ABNF,&rdquo; April&nbsp;2006.</span><span>)</span></a> and
		<a class='info' href='#SORT'>[SORT]<span> (</span><span class='info'>Crispin, M. and K. Murchison, &ldquo;Internet Message Access Protocol - SORT and THREAD Extensions,&rdquo; June&nbsp;2008.</span><span>)</span></a>.
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    capability         =/ "SEARCH=FUZZY"

    score              = 1*3DIGIT
       ;; (1 &lt;= n &lt;= 100)

    score-list         = "(" [score *(SP score)] ")"

    search-key         =/ "FUZZY" SP search-key

    search-return-data =/ "RELEVANCY" SP score-list
       ;; Conforms to &lt;search-return-data&gt;, from [IMAP-ABNF]

    search-return-opt  =/ "RELEVANCY"
       ;; Conforms to &lt;search-return-opt&gt;, from [IMAP-ABNF]

    sort-key           =/ "RELEVANCY"
</pre></div>
<a name="security"></a><br /><hr />
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>This document is believed not to have any security implications.
</p>
<a name="iana"></a><br /><hr />
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>
			IMAP4 capabilities are registered by publishing a standards track or
			IESG approved experimental RFC.  The registry is currently located
			at:
		
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   http://www.iana.org/assignments/imap4-capabilities

</pre></div>
<p>
			This document defines the X-DRAFT-I02-SEARCH=FUZZY <a class='info' href='#comment.anchor7'>[anchor7]<span> (</span><span class='info'>Note to RFC Editor: fix before publication</span><span>)</span></a><a name='anchor7'></a> IMAP capability.  IANA is requested to add it to the registry.
		
</p>
<a name="anchor8"></a><br /><hr />
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgements</h3>

<p>
		Alexey Melnikov, Zoltan Ordogh and Barry Leiba have helped with
		this document.
		
</p>
<a name="rfc.references1"></a><br /><hr />
<h3>11.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ABNF">[ABNF]</a></td>
<td class="author-text">Crocker, D., Ed. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; RFC&nbsp;5234, January&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="CONTEXT">[CONTEXT]</a></td>
<td class="author-text">Cridland, D. and C. King, &ldquo;<a href="http://tools.ietf.org/html/rfc5267">Contexts for IMAP4</a>,&rdquo; RFC&nbsp;5267, July&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="ESEARCH">[ESEARCH]</a></td>
<td class="author-text">Melnikov, A. and D. Cridland, &ldquo;<a href="http://tools.ietf.org/html/rfc4731">IMAP4 Extension to SEARCH Command for Controlling
            What Kind of Information Is Returned</a>,&rdquo; RFC&nbsp;4731, November&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="IMAP-ABNF">[IMAP-ABNF]</a></td>
<td class="author-text">Melnikov, A. and C. Daboo, &ldquo;<a href="http://tools.ietf.org/html/rfc4466">Collected Extensions to IMAP4 ABNF</a>,&rdquo; RFC&nbsp;4466, April&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="Kwds">[Kwds]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; RFC&nbsp;2119, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3501">[RFC3501]</a></td>
<td class="author-text">Crispin, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3501">INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1</a>,&rdquo; RFC&nbsp;3501, March&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3501.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SORT">[SORT]</a></td>
<td class="author-text">Crispin, M. and K. Murchison, &ldquo;<a href="http://tools.ietf.org/html/rfc5256">Internet Message Access Protocol - SORT and THREAD Extensions</a>,&rdquo; RFC&nbsp;5256, June&nbsp;2008.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Timo Sirainen</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:tss@iki.fi">tss@iki.fi</a></td></tr>
</table>
</body></html>
