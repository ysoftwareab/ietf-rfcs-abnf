



Network Working Group                                          W. Kumari
Internet-Draft                                                    Google
Intended status: Informational                            O. Gudmundsson
Expires: October 18, 2014                                  Shinkuro Inc.
                                                             P. Ebersman
                                                                Infoblox
                                                                S. Sheng
                                                                   ICANN
                                                          April 16, 2014


               Captive-Portal identification in DHCP / RA
                      draft-wkumari-dhc-capport-02

Abstract

   In many environments (such as hotels, coffee shops and other
   establishments that offer Internet service to customers), it is
   common to start new connections in a captive portal mode, i.e. highly
   restrict what the customer can do until the customer has accepted
   terms of service, provided payment information or authenticated.

   This document describes a DHCP option (and an RA extension) to inform
   clients that they are behind some sort of captive portal device, and
   that they will need to authenticate to get Internet Access.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on October 18, 2014.

Copyright Notice

   Copyright (c) 2014 IETF Trust and the persons identified as the
   document authors.  All rights reserved.




Kumari, et al.          Expires October 18, 2014                [Page 1]

Internet-Draft             DHCP Captive-Portal                April 2014


   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.1.  Requirements notation . . . . . . . . . . . . . . . . . .   3
   2.  Background  . . . . . . . . . . . . . . . . . . . . . . . . .   3
     2.1.  DNS Redirection . . . . . . . . . . . . . . . . . . . . .   3
     2.2.  HTTP Redirection  . . . . . . . . . . . . . . . . . . . .   4
     2.3.  IP Hijacking  . . . . . . . . . . . . . . . . . . . . . .   4
   3.  The Captive-Portal DHCP Option  . . . . . . . . . . . . . . .   4
   4.  The Captive-Portal RA Option  . . . . . . . . . . . . . . . .   5
   5.  Use of the Captive-Portal Option  . . . . . . . . . . . . . .   6
   6.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   8
   7.  Security Considerations . . . . . . . . . . . . . . . . . . .   8
   8.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   8
   9.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   9
     9.1.  Normative References  . . . . . . . . . . . . . . . . . .   9
     9.2.  Informative References  . . . . . . . . . . . . . . . . .   9
   Appendix A.  Changes / Author Notes.  . . . . . . . . . . . . . .   9
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   9

1.  Introduction

   In many environments (coffee shops and hotels), users need to connect
   to a captive portal device and agree to an acceptable use policy or
   provide billing information before they can access the Internet.

   In order to present the user with the captive portal web page, many
   devices perform DNS and / or HTTP and / or IP hijacks.  As well as
   being kludgy hacks, these techniques looks very similar to attacks
   that DNSSEC and TLS protect against.

   This document describes a DHCP option (Captive-Portal) that informs
   DHCP clients that they are behind a captive portal device, and how to
   contact it.

   This document neither condones nor condemns captive portals; instead
   it recognises that they are here to stay, and attempts to improve the
   user's experience.



Kumari, et al.          Expires October 18, 2014                [Page 2]

Internet-Draft             DHCP Captive-Portal                April 2014


1.1.  Requirements notation

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].

2.  Background

   Many Internet Service Providers (ISPs) that offer public Internet
   access require the user to first accept an Acceptable Use Policy
   (AUP) and / or provides billing information (such as their last name
   and / or room number in a hotel, credit card information, etc)
   through a web interface.

   In order to meet this requirement, some ISPs implement a captive
   portal (CP) - a system that intercepts user requests and redirects
   them to an interstitial login page.

   Captive portals intercept and redirects user requests in a number of
   ways, including:

   o  DNS Redirection

   o  IP Redirection

   o  HTTP Redirection

   o  Restricted scope addresses

   o  Traffic blocking (until the user is authenticated)

   In order to ensure that the user is unable to access the Internet,
   captive portals usually implement IP based filters, or place the user
   in to a restricted VLAN or restricted IP range until after they have
   been authorized.

2.1.  DNS Redirection

   The CP either intercepts all DNS traffic or advertises itself (for
   example using DHCP) as the recursive server for the network.  Until
   the user has authenticated to the captive portal, the CP responds to
   all DNS requests listing the address of its web portal.  Once the
   user has authenticated the CP returns the "correct" addresses.

   This technique has many shortcomings.  It fails if the client is
   performing DNSSEC validation, or if the client already has the DNS
   information cached.




Kumari, et al.          Expires October 18, 2014                [Page 3]

Internet-Draft             DHCP Captive-Portal                April 2014


2.2.  HTTP Redirection

   In this implementation, the CP acts like a transparent HTTP proxy;
   but when it sees an HTTP request from an unauthenticated client, it
   intercepts the request and responds with an HTTP status code 302 to
   redirect the client to the Captive Portal Login.

   The issues with this technique include:

   o  It fails if the user is only using HTTPS

   o  It exposes various private user information, such as HTTP Cookies,
      etc.

   o  It doesn't work if the client has a VPN and / or proxies their web
      traffic to an external web proxy.

2.3.  IP Hijacking

   In this scenario, the captive portal intercepts connections to any IP
   address.  It spoofs the destination IP address and "pretends" to be
   whatever the user tried to access.

   This technique has similar issues as the HTTP solution, but may also
   break other protocols, and may expose more of the users private
   information, etc.

3.  The Captive-Portal DHCP Option

   The Captive Portal DHCP Option (TBA1) informs the DHCP client that it
   is behind a captive portal and provides the URI to access the
   authentication page.  This is primarily intended to improve the user
   experiance; for the forseeable future captive portals will still need
   to implement the interception techniques to serve legacy clinets.

   This draft is not intended to provide guidance on how to implement a
   captive portal.  As such, it assumes that the captive portal on a
   dual-stack or IPv6-only network is already capable of intercepting
   IPv6 traffic.  However, in order to support IPv6 with the proposed
   DHCP option, there are some additional considerations.  In a dual-
   stack network, the network supports both IPv4 and IPv6 protocols
   simultaneously, but can have a mix of IPv4-only, IPv6-only, and dual-
   stack devices using the network, meaning that it may be necessary to
   have parallel notifications via DHCPv4 and DHCPv6.

   IPv4-only and dual-stack devices can technically both support
   receiving the option via DHCPv4, but dual-stack implementations would
   need to ensure that the correct action would be taken for both IPv4



Kumari, et al.          Expires October 18, 2014                [Page 4]

Internet-Draft             DHCP Captive-Portal                April 2014


   and IPv6 traffic despite only receiving an option via IPv4.  For
   devices/networks that only speak IPv6, and to avoid this dependency
   on the implementation, a DHCPv6 option is necessary.

   [ED NOTE:] This is complicated by the fact that not all devices
   support DHCPv6, and thus it may be necessary to investigate other
   methods to notify IPv6-only devices of a captive portal.  Since this
   option is only intended to help clients gracefully deal with networks
   that have a captive portal, it may be acceptable to note that if a
   client does not support DHCPv6, it simply won't be able to take
   advantage of this optimization, but will otherwise function normally.
   [/note]

   The format of the DHCP Captive-Portal DHCP option is identical for
   both DHCPv4 and DHCPv6 and is shown below.

     Code    Len          Data
     +------+------+------+------+------+--   --+-----+
     | code |  len |  URI                  ...        |
     +------+------+------+------+------+--   --+-----+

   o  Code: The Captive-Portal DHCP Option (TBA1 for DHCPv4, TBA2 for
      DHCPv6)

   o  Len: The length, in octets of the URI.

   o  URI: The URI of the authentication page that the user should
      connect to.

   The URI MUST be a URL with an IP-literal for the host portion (to
   remove the need to allow DNS from unauthenticated clients).  The
   DHCPv4 URI MUST contain an IPv4 address, and the DHCPv6 URI MUST
   contain an IPv6 address (to account for IPv4 only or IPv6 only
   capable devices - not everyting is dual stack!)

   [ED NOTE: Using an address literal is less than ideal, but better
   than the alternatives.  Recommending a DNS name means that the CP
   would need to allow DNS from unauthenticated clients (as we don't
   want to force users to use the CP's provided DNS) and some folk would
   use this to DNS Tunnel out.  This would make the CP admin block
   external recursives).]

4.  The Captive-Portal RA Option

   [ Ed: I'm far from an RA expert, but it was suggested that we shold
   advertize this via RA as well as DHCP.  I think there are only 8 bits
   for Type, is it worth burning an option code on this?  I have also
   specified that the option length should padded to multiples of 8 byte



Kumari, et al.          Expires October 18, 2014                [Page 5]

Internet-Draft             DHCP Captive-Portal                April 2014


   to better align with the examples I've seen (and I'm on a plane so
   cannot easily search for more!)  Is this required / preferred, or is
   smaller RAs better? ]

   This section describes the Captive-Portal Router Advertisement
   option.

    0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |     Type      |     Length    |              URI              .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               .
      .                                                               .
      .                                                               .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
               Figure 2: Captive-Portal RA Option Format

   Type  TBA3

   Length  8-bit unsigned integer.  The length of the option (including
      the Type and Length fields) in units of 8 bytes.

   URI  The URI of the authentication page that the user should connect
      to.  This should be padded with NULL (0x0) to make the total
      option length (including the Type and Length fields) a mutliple of
      8 bytes.

5.  Use of the Captive-Portal Option

   [ED NOTE: This section is, and probably will remain, fairly hand
   wavy.  This option provides notice to the OS / User applications that
   there is a CP, but I think that the UI / etc is best designed /
   handled by the Operating System vendors / Application developers. ]

   The purpose of the Captive-Portal Option is to inform the operating
   system and applications that they are behind a captive portal type
   device and will need to authenticate before getting network access
   (and how to reach the authentication page).

   The Captive-Portal Option is defined for IPv6 RAs and IPv6 DHCP and
   IPv4 DHCP.  The URIs in these SHOULD all be the same, but if they are
   not, the precedence is as follows:

   1.  IPv6 DHCP (most preferred)

   2.  IPv4 DHCP




Kumari, et al.          Expires October 18, 2014                [Page 6]

Internet-Draft             DHCP Captive-Portal                April 2014


   3.  IPv6 RA (least preferred)

   This preference was chosen because an IPv6 capable client machine
   will first get an IP address (and possibly the Captive-Portal option)
   via RA, and will then get additional information via DHCP v6.  The
   client is not fully configured until it has completed the DHCP step,
   and so this is "newer" information.  The DHCP v4 preference is in the
   middle, because it is likely that this will be delpoyed first on many
   captive portals.  Once IPv6 is deployed, we don't want legacy
   (forgotten!) configuration to override the "newer" configuration
   information.  [Ed: This ordering is somewhat arbritary, as is the
   justification, but there should be *some* standard and this seemed as
   good as any! ]

   The exact method that the interaction with the user occurs is device
   / operating system / application dependent.  The below is simply one
   option.

   When the device receives a DHCP response with the Captive-Portal
   Option it SHOULD:

   1.  Not initiate new IP connections until the CP has been satisfied.
       Existing connections should be quiesced.  This will happen more
       often than some expect -- you buy 1h of Internet at a cafe and
       stay there for 3h -- this will "interrupt" you a few times).

   2.  Present a dialog box to the user informing that they are behind a
       captive portal and ask if they wish to proceed.

   3.  If the user elects to proceed, the device should initiate a
       connection to the captive portal login page using a web browser
       configured with a separate cookie store.  Some captive portals
       send the user a cookie when they authenticate (so that the user
       can re-authenticate more easily in the future - the browser
       should keep these CP cookies separate from other cookies.

   4.  Once the user has authenticated (how does it know?  HTTP
       response?! Probe (ugh?)) normal IP connectivity should resume.

   5.  The device should (using an OS dependent method) expose to the
       user / user applications that they have connected though a
       captive portal (for example by creating a file in /proc/net/
       containing the interface and captive portal URI).  This should
       continue until the network changes, or a new DHCP message without
       the CP is received.






Kumari, et al.          Expires October 18, 2014                [Page 7]

Internet-Draft             DHCP Captive-Portal                April 2014


6.  IANA Considerations

   This document defines DHCPv4 Captive-Portal option which requires
   assignment of DHCPv4 option code TBA1 assigned from "Bootp and DHCP
   options" registry (http://www.iana.org/assignments/ bootp-dhcp-
   parameters/bootp-dhcp-parameters.xml), as specified in [RFC2939].

   The IANA is requested to also assign an option codes for the DHCPv6
   Captive-Portal (TBA2) option from the "DHCPv6 and DHCPv6 options"
   registry (http:// www.iana.org/assignments/dhcpv6-parameters/
   dhcpv6-parameters.xml).

   The IANA is also requested at assign an IPv6 RA Type code (TBA3) from
   the [TODO] registry.  Thanks IANA!

7.  Security Considerations

   An attacker with the ability to inject DHCP messages could include
   this option and so force users to contact him.  As an attacker with
   this capability could simply list himself as the default gateway (and
   so see all the victim's traffic), we do not think this gives them
   significantly more capabilities.  Fake DHCP servers / fake RAs are
   currently a security concern - this doesn't make them any better or
   worse.

   Devices and systems that automatically connect to open network could
   potentially be tracked using the techniques described in this
   document (forcing the user to continually authenticate, or exposing
   their browser fingerprint), but similar tracking could already be
   performed with the standard captive portal mechanisms, so this
   doesn't seem to give the attackers more capabilities.

   By simplifying the interaction with the captive portal systems, and
   doing away with the need for interception, we think that users will
   be less likely to disable useful security safeguards like DNSSEC
   validation, VPNs, etc.

8.  Acknowledgements

   The primary author has discussed this idea with a number of folk, and
   asked them to assist by becoming co-authors.  Unfortunately he has
   forgotten who many of them were; if you were one of them, I
   apologize.

   Thanks to Vint Cerf for the initial idea / asking me to write this.
   Thanks to Wes George for supplying the v6 text.





Kumari, et al.          Expires October 18, 2014                [Page 8]

Internet-Draft             DHCP Captive-Portal                April 2014


9.  References

9.1.  Normative References

   [IANA.AS_Numbers]
              IANA, "Autonomous System (AS) Numbers",
              <http://www.iana.org/assignments/as-numbers>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

9.2.  Informative References

   [I-D.ietf-sidr-iana-objects]
              Manderson, T., Vegoda, L., and S. Kent, "RPKI Objects
              issued by IANA", draft-ietf-sidr-iana-objects-03 (work in
              progress), May 2011.

Appendix A.  Changes / Author Notes.

   [RFC Editor: Please remove this section before publication ]

   From -01 to 02:

   o  Added the IPv6 RA stuff.

   From -00 to -01:

   o  Many nits and editorial changes.

   o  Whole bunch of extra text and review from Wes George on v6.

   From initial to -00.

   o  Nothing changed in the template!

Authors' Addresses

   Warren Kumari
   Google
   1600 Amphitheatre Parkway
   Mountain View, CA  94043
   US

   Email: warren@kumari.net






Kumari, et al.          Expires October 18, 2014                [Page 9]

Internet-Draft             DHCP Captive-Portal                April 2014


   Olafur Gudmundsson
   Shinkuro Inc.
   4922 Fairmont Av, Suite 250
   Bethesda, MD  20814
   USA

   Email: ogud@ogud.com


   Paul Ebersman
   Infoblox

   Email: ebersman-ietf@dragon.net


   Steve Sheng
   Internet Corporation for Assigned Names and Numbers
   12025 Waterfront Drive, Suite 300
   Los Angeles  90094
   United States of America

   Phone: +1.310.301.5800
   Email: steve.sheng@icann.org




























Kumari, et al.          Expires October 18, 2014               [Page 10]
