Network Working Group                                     Jeffrey Altman
Internet-Draft                                       Columbia University
draft-altman-telnet-enc-des3-cfb-00.txt                    December 1999

             Telnet Encryption: DES3 64 bit Cipher Feedback

Status of this Memo

   This document is an Internet-Draft and is in full conformance
   with all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as
   Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six
   months and may be updated, replaced, or obsoleted by other
   documents at any time.  It is inappropriate to use
   Internet-Drafts as reference material or to cite them other than
   as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

Abstract

   This document provides details of a Telnet ENCRYPT suboption
   implementing Triple DES encryption using 64-bit Cipher Feedback
   mode.

1.  Command Names and Codes

   Encryption Type

      DES3_CFB64       3

   Suboption Commands

      CFB64_IV         1
      CFB64_IV_OK      2
      CFB64_IV_BAD     3
      CFB64_CHALLENGE  4
      CFB64_RESPONSE   5

2.  Command Meanings

   IAC SB ENCRYPT IS DES3_CFB64 CFB64_IV <initial vector> IAC SE

      The sender of this command generates a random 8 byte initial vec-
      tor, and sends it to the other side of the connection using the
      CFB64_IV command.  The initial vector is sent in clear text.  Only
      the side of the connection that is WILL ENCRYPT may send the
      CFB64_IV command.

   IAC SB ENCRYPT REPLY DES3_CFB64 CFB64_IV_OK IAC SE
   IAC SB ENCRYPT REPLY DES3_CFB64 CFB64_IV_BAD IAC SE

      The sender of these commands either accepts or rejects the initial
      vector received in a CFB64_IV command.  Only the side of the con-
      nection that is DO ENCRYPT may send the CFB64_IV_OK and
      CFB64_IV_BAD commands.

3.  Implementation Rules

   Once a CFB64_IV_OK command has been received, the WILL ENCRYPT side
   of the connection should do keyid negotiation using the ENC_KEYID
   command.  Once the keyid negotiation has successfully identified a
   common keyid, then START and END commands may be sent by the side of
   the connection that is WILL ENCRYPT.  Data will be encrypted using
   the DES3 64 bit Cipher Feedback algorithm.

   If encryption (decryption) is turned off and back on again, and the
   same keyid is used when re-starting the encryption (decryption), the
   intervening clear text must not change the state of the encryption
   (decryption) machine.

   If a START command is sent (received) with a different keyid, the en-
   cryption (decryption) machine must be re-initialized immediately fol-
   lowing the end of the START command with the new key and the initial
   vector sent (received) in the last CFB64_IV command.

   If a new CFB64_IV command is sent (received), and encryption (decryp-
   tion) is enabled, the encryption (decryption) machine must be re-
   initialized immediately following the end of the CFB64_IV command
   with the new initial vector, and the keyid sent (received) in the
   last START command.

   If encryption (decryption) is not enabled when a CFB64_IV command is
   sent (received), the encryption (decryption) machine must be re-
   initialized after the next START command, with the keyid sent (re-
   ceived) in that START command, and the initial vector sent (received)
   in this CFB64_IV command.

4.  Algorithm

   DES3 64 bit Cipher Feedback

                 key1       key2       key3
                  |          |          |
                  v          v          v
              +-------+  +-------+  +-------+
           +->| DES-e |->| DES-d |->| DES-e |-- +
           |  +-------+  +-------+  +-------+   |
           |                                    v
   INPUT --(-------------------------------->(+)+---> DATA
           |                                    |
           +------------------------------------+


   Given:
   iV: Initial vector, 64 bits (8 bytes) long.
   Dn: the nth chunk of 64 bits (8 bytes) of data to encrypt (decrypt).
   On: the nth chunk of 64 bits (8 bytes) of encrypted (decrypted) output.

   V0 = DES-e(DES-d(DES-e(iV, key1),key2),key3)
   On = Dn ^ Vn
   V(n+1) = DES-e(DES-d(DES-e(On, key1),key2),key3)

5.  Security considerations

   Encryption using Cipher Feedback does not ensure data integrity; the
   active attacker has a limited ability to modify text, if he can
   predict the clear-text that was being transmitted.  The limitations
   faced by the attacker (that only 8 bytes can be modified at a time,
   and the following 8-byte block of data will be corrupted, thus making
   detection likely) are significant, but it is possible that an active
   attacker still might be able to exploit this weakness.

   The tradeoff here is that adding a message authentication code (MAC)
   will significantly increase the number of bytes needed to send a sin-
   gle character in the telnet protocol, which will impact performance
   on slow (i.e. dialup) links.

6.  Acknowledgments

   This document was originally written by Dave Borman of Cray Research
   with the assistance of the IETF Telnet Working Group.

Author's Address

   Jeffrey Altman, Editor
   Columbia University
   612 West 115th Street Room 716
   New York NY 10025 USA

   Phone: +1 (212) 854-1344

   EMail: jaltman@columbia.edu

                                                                [Page 3]
