<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>NTS4PTP - Key Management System for the Precision Time Protocol Based on the Network Time Security Protocol</title>
<meta content="Martin Langer" name="author">
<meta content="Rainer Bermbach" name="author">
<meta content="
       This document defines a key management service for automatic key management 
for the integrated security mechanism (prong A) of IEEE Std 1588[TM]-2019 (PTPv2.1) described there 
in Annex P. It implements a key management for the immediate security processing approach and 
offers a security solution for all relevant PTP modes. The key management service for PTP is 
based on and extends the NTS Key Establishment protocol defined in IETF RFC 8915 for securing NTP, 
but works completely independent from NTP. 
    " name="description">
<meta content="xml2rfc 3.9.1" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-langer-ntp-nts-for-ptp-02" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.9.1
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.1
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 57.4.0
    six 1.16.0
-->
<link href="/tmp/draft-langer-ntp-nts-for-ptp-02-5_jrii0p.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">NTS4PTP</td>
<td class="right">August 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Langer &amp; Bermbach</td>
<td class="center">Expires 21 February 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Time Protocol</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-langer-ntp-nts-for-ptp-02</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-08-20" class="published">20 August 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-02-21">21 February 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Langer</div>
<div class="org">Ostfalia University</div>
</div>
<div class="author">
      <div class="author-name">R. Bermbach</div>
<div class="org">Ostfalia University</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">NTS4PTP - Key Management System for the Precision Time Protocol Based on the Network Time Security Protocol</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document defines a key management service for automatic key management 
for the integrated security mechanism (prong A) of IEEE Std 1588[TM]-2019 (PTPv2.1) described there 
in Annex P. It implements a key management for the immediate security processing approach and 
offers a security solution for all relevant PTP modes. The key management service for PTP is 
based on and extends the NTS Key Establishment protocol defined in IETF RFC 8915 for securing NTP, 
but works completely independent from NTP.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 21 February 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-notational-conventions" class="xref">Notational Conventions</a></p>
</li>
          <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-key-management-using-networ" class="xref">Key Management Using Network Time Security</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-principle-key-distribution-" class="xref">Principle Key Distribution Mechanism</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.1.2.1">
                    <p id="section-toc.1-1.2.2.1.2.1.1" class="keepWithNext"><a href="#section-2.1.1" class="xref">2.1.1</a>.  <a href="#name-nts-message-exchange-for-gr" class="xref">NTS Message Exchange for Group-based Approach</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.1.2.2">
                    <p id="section-toc.1-1.2.2.1.2.2.1" class="keepWithNext"><a href="#section-2.1.2" class="xref">2.1.2</a>.  <a href="#name-nts-message-exchange-for-th" class="xref">NTS Message Exchange for the Ticket-based Approach</a></p>
</li>
                </ul>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-general-topics" class="xref">General Topics</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1"><a href="#section-2.2.1" class="xref">2.2.1</a>.  <a href="#name-key-update-process" class="xref">Key Update Process</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a href="#section-2.2.2" class="xref">2.2.2</a>.  <a href="#name-key-generation" class="xref">Key Generation</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.2.2.3">
                    <p id="section-toc.1-1.2.2.2.2.3.1"><a href="#section-2.2.3" class="xref">2.2.3</a>.  <a href="#name-time-information-of-the-ke-" class="xref">Time Information of the KE Server</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.2.2.4">
                    <p id="section-toc.1-1.2.2.2.2.4.1"><a href="#section-2.2.4" class="xref">2.2.4</a>.  <a href="#name-certificates" class="xref">Certificates</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.2.2.5">
                    <p id="section-toc.1-1.2.2.2.2.5.1"><a href="#section-2.2.5" class="xref">2.2.5</a>.  <a href="#name-upfront-configuration" class="xref">Upfront Configuration</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.2.2.5.2.1">
                        <p id="section-toc.1-1.2.2.2.2.5.2.1.1"><a href="#section-2.2.5.1" class="xref">2.2.5.1</a>.  <a href="#name-security-parameters" class="xref">Security Parameters</a></p>
</li>
                      <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.2.2.5.2.2">
                        <p id="section-toc.1-1.2.2.2.2.5.2.2.1"><a href="#section-2.2.5.2" class="xref">2.2.5.2</a>.  <a href="#name-key-lifetimes" class="xref">Key Lifetimes</a></p>
</li>
                      <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.2.2.5.2.3">
                        <p id="section-toc.1-1.2.2.2.2.5.2.3.1"><a href="#section-2.2.5.3" class="xref">2.2.5.3</a>.  <a href="#name-certificates-2" class="xref">Certificates</a></p>
</li>
                      <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.2.2.5.2.4">
                        <p id="section-toc.1-1.2.2.2.2.5.2.4.1"><a href="#section-2.2.5.4" class="xref">2.2.5.4</a>.  <a href="#name-authorization" class="xref">Authorization</a></p>
</li>
                      <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.2.2.5.2.5">
                        <p id="section-toc.1-1.2.2.2.2.5.2.5.1"><a href="#section-2.2.5.5" class="xref">2.2.5.5</a>.  <a href="#name-transparent-clocks" class="xref">Transparent Clocks</a></p>
</li>
                      <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.2.2.5.2.6">
                        <p id="section-toc.1-1.2.2.2.2.5.2.6.1"><a href="#section-2.2.5.6" class="xref">2.2.5.6</a>.  <a href="#name-start-up-considerations" class="xref">Start-up considerations</a></p>
</li>
                    </ul>
</li>
                </ul>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-overview-of-nts-messages-an" class="xref">Overview of NTS Messages and their Structure for Use with PTP</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.3.2.1">
                    <p id="section-toc.1-1.2.2.3.2.1.1"><a href="#section-2.3.1" class="xref">2.3.1</a>.  <a href="#name-ptp-key-request-message" class="xref">PTP Key Request Message</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.3.2.2">
                    <p id="section-toc.1-1.2.2.3.2.2.1"><a href="#section-2.3.2" class="xref">2.3.2</a>.  <a href="#name-ptp-key-grant-message" class="xref">PTP Key Grant Message</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.3.2.3">
                    <p id="section-toc.1-1.2.2.3.2.3.1"><a href="#section-2.3.3" class="xref">2.3.3</a>.  <a href="#name-ptp-refusal-message" class="xref">PTP Refusal Message</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.3.2.4">
                    <p id="section-toc.1-1.2.2.3.2.4.1"><a href="#section-2.3.4" class="xref">2.3.4</a>.  <a href="#name-ptp-registration-request-me" class="xref">PTP Registration Request Message</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.3.2.5">
                    <p id="section-toc.1-1.2.2.3.2.5.1"><a href="#section-2.3.5" class="xref">2.3.5</a>.  <a href="#name-ptp-registration-success-me" class="xref">PTP Registration Success Message</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.2.2.3.2.6">
                    <p id="section-toc.1-1.2.2.3.2.6.1"><a href="#section-2.3.6" class="xref">2.3.6</a>.  <a href="#name-ptp-registration-revoke-mes" class="xref">PTP Registration Revoke Message</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-nts-messages-for-ptp" class="xref">NTS Messages for PTP</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-nts-message-types" class="xref">NTS Message Types</a></p>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-nts-records" class="xref">NTS Records</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="xref">3.2.1</a>.  <a href="#name-aead-algorithm-negotiation" class="xref">AEAD Algorithm Negotiation</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a href="#section-3.2.2" class="xref">3.2.2</a>.  <a href="#name-association-mode" class="xref">Association Mode</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.3">
                    <p id="section-toc.1-1.3.2.2.2.3.1"><a href="#section-3.2.3" class="xref">3.2.3</a>.  <a href="#name-current-parameters-containe" class="xref">Current Parameters Container</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.4">
                    <p id="section-toc.1-1.3.2.2.2.4.1"><a href="#section-3.2.4" class="xref">3.2.4</a>.  <a href="#name-end-of-message" class="xref">End of Message</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.5">
                    <p id="section-toc.1-1.3.2.2.2.5.1"><a href="#section-3.2.5" class="xref">3.2.5</a>.  <a href="#name-error" class="xref">Error</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.6">
                    <p id="section-toc.1-1.3.2.2.2.6.1"><a href="#section-3.2.6" class="xref">3.2.6</a>.  <a href="#name-grace-period" class="xref">Grace Period</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.7">
                    <p id="section-toc.1-1.3.2.2.2.7.1"><a href="#section-3.2.7" class="xref">3.2.7</a>.  <a href="#name-lifetime" class="xref">Lifetime</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.8">
                    <p id="section-toc.1-1.3.2.2.2.8.1"><a href="#section-3.2.8" class="xref">3.2.8</a>.  <a href="#name-mac-algorithm-negotiation" class="xref">MAC Algorithm Negotiation</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.9">
                    <p id="section-toc.1-1.3.2.2.2.9.1"><a href="#section-3.2.9" class="xref">3.2.9</a>.  <a href="#name-next-parameters-container" class="xref">Next Parameters Container</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.10">
                    <p id="section-toc.1-1.3.2.2.2.10.1"><a href="#section-3.2.10" class="xref">3.2.10</a>. <a href="#name-nts-message-type" class="xref">NTS Message Type</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.11">
                    <p id="section-toc.1-1.3.2.2.2.11.1"><a href="#section-3.2.11" class="xref">3.2.11</a>. <a href="#name-nts-message-version" class="xref">NTS Message Version</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.12">
                    <p id="section-toc.1-1.3.2.2.2.12.1"><a href="#section-3.2.12" class="xref">3.2.12</a>. <a href="#name-nts-next-protocol-negotiati" class="xref">NTS Next Protocol Negotiation</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.13">
                    <p id="section-toc.1-1.3.2.2.2.13.1"><a href="#section-3.2.13" class="xref">3.2.13</a>. <a href="#name-requesting-ptp-identity" class="xref">Requesting PTP Identity</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.14">
                    <p id="section-toc.1-1.3.2.2.2.14.1"><a href="#section-3.2.14" class="xref">3.2.14</a>. <a href="#name-security-association" class="xref">Security Association</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.15">
                    <p id="section-toc.1-1.3.2.2.2.15.1"><a href="#section-3.2.15" class="xref">3.2.15</a>. <a href="#name-security-policies" class="xref">Security Policies</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.16">
                    <p id="section-toc.1-1.3.2.2.2.16.1"><a href="#section-3.2.16" class="xref">3.2.16</a>. <a href="#name-ticket" class="xref">Ticket</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.17">
                    <p id="section-toc.1-1.3.2.2.2.17.1"><a href="#section-3.2.17" class="xref">3.2.17</a>. <a href="#name-ticket-container" class="xref">Ticket Container</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.18">
                    <p id="section-toc.1-1.3.2.2.2.18.1"><a href="#section-3.2.18" class="xref">3.2.18</a>. <a href="#name-ticket-key" class="xref">Ticket Key</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.19">
                    <p id="section-toc.1-1.3.2.2.2.19.1"><a href="#section-3.2.19" class="xref">3.2.19</a>. <a href="#name-ticket-key-id" class="xref">Ticket Key ID</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2.2.20">
                    <p id="section-toc.1-1.3.2.2.2.20.1"><a href="#section-3.2.20" class="xref">3.2.20</a>. <a href="#name-time-until-update" class="xref">Time until Update</a></p>
</li>
                </ul>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-additional-mechanisms" class="xref">Additional Mechanisms</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="xref">3.3.1</a>.  <a href="#name-aead-operation" class="xref">AEAD Operation</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a href="#section-3.3.2" class="xref">3.3.2</a>.  <a href="#name-sa-sp-management" class="xref">SA/SP Management</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-new-ticket-tlv-for-ptp-mess" class="xref">New TICKET TLV for PTP Messages</a></p>
</li>
          <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-authentication-tlv-paramete" class="xref">AUTHENTICATION TLV Parameters</a></p>
</li>
          <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-acknowledgements" class="xref">Acknowledgements</a></p>
</li>
          <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-references" class="xref">References</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="notational-conventions">
<section id="section-1">
      <h2 id="name-notational-conventions">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-notational-conventions" class="section-name selfRef">Notational Conventions</a>
      </h2>
<p id="section-1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span>
when, and only when, they appear in all capitals, as shown here.<a href="#section-1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="introduction">
<section id="section-2">
      <h2 id="name-key-management-using-networ">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-key-management-using-networ" class="section-name selfRef">Key Management Using Network Time Security</a>
      </h2>
<p id="section-2-1">In its annex P the IEEE Std 1588-2019 (<span>[<a href="#IEEE1588-2019" class="xref">IEEE1588-2019</a>]</span>, Precision 
Time Protocol version 2.1, PTPv2.1) defines a comprehensive PTP security concept based 
on four prongs (A to D). Prong A incorporates an immediate security processing approach 
and specifies in section 16.14 an extension to secure PTP messages by means of an 
AUTHENTICATION TLV containing an Integrity Check Value (ICV). For PTP instances to use 
the securing mechanism a respective key needs to be securely distributed among them. 
Annex P gives requirements for such a key managment system and mentions potential 
candidates without further specification, but allows other solutions as long as they 
fullfil those requirements.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">
This document defines such a key management service for automatic key management for 
the immediate security processing in prong A. The solution <span>[<a href="#Langer_et_al._2020" class="xref">Langer_et_al._2020</a>]</span>
is based on and expands the NTS Key Establishment protocol defined in IETF RFC 8915 
<span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span> for securing NTP, but works completely independent from NTP.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">Many networks include both PTP and NTP at the same time. Furthermore, many time server 
appliances that are capable of acting as the Grandmaster of a PTP Network are also capable 
of acting as an NTP server. For these reasons it is likely to be easier both for the time 
server manufacturer and the network operator if PTP and NTP use a key management system 
based on the same technology. The Network Time Security (NTS) protocol was specified by 
the Internet Engineering Task Force (IETF) to protect the integrity of NTP messages 
<span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>. Its NTS Key Establishment sub-protocol is secured by the Transport 
Layer Security (TLS 1.3, IETF RFC 8446 <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>) mechanism. TLS is used 
to protect numerous popular network protocols, so it is present in many networks. For example, 
HTTPS, the predominant secure web protocol uses TLS for security. Since many PTP capable 
network appliances have management interfaces based on HTTPS, the manufacturers are already 
implementing TLS.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">Though the key management for PTP is based on the NTS Key Establishment (NTS-KE) protocol for NTP, 
it works completely independent of NTP. The key management system uses the procedures 
described in IETF RFC 8915 for the NTS-KE and expands it with new NTS messages for PTP. 
It may be applied in a Key Establishment server (KE server) that already manages NTP but 
can also be operated only handling KE for PTP. Even when the PTP network is isolated from 
the Internet, a Key Establishment server can be installed in that network providing the 
PTP instances with necessary key and security parameters.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">The KE server may often be implemented as a separate unit. It also may be collocated 
with a PTP instance, e.g. the Grandmaster. In the latter case communication between the 
KE server program and the PTP instance program needs to be implemented in a secure way 
if TLS communication (e.g. via local host) is not or cannot be used.<a href="#section-2-5" class="pilcrow">¶</a></p>
<p id="section-2-6">Using the expanded NTS Key Establishment protocol for the NTS key management for PTP, 
NTS4PTP provides two principle approaches specified in this document.<a href="#section-2-6" class="pilcrow">¶</a></p>
<p id="section-2-7">1. Group-based approach (multicast)<a href="#section-2-7" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2-8.1">Definition of one or more security groups in the PTP network,<a href="#section-2-8.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-8.2">very suitable for PTP multicast mode and mixed multicast/unicast mode,<a href="#section-2-8.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-8.3">suitable for unicast mode in small subgroups of very few participants 
   (Group-of-2, Go2) but poor scaling and more administration work,<a href="#section-2-8.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-9">2. Ticket-based approach (unicast)<a href="#section-2-9" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2-10.1">secured (end-to-end) PTP unicast communication between requester and grantor,<a href="#section-2-10.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-10.2">no group binding necessary,<a href="#section-2-10.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-10.3">very suitable for native PTP unicast mode, because of good scaling,<a href="#section-2-10.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-10.4">a bit more complex NTS message handling.<a href="#section-2-10.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-11">This document describes the structure and usage of these two approaches in their application 
as a key management system for the integrated security mechanism (prong A) of IEEE Std 1588-2019. 
<a href="#key-distribution" class="xref">Section 2.1</a> starts with a description of the principle key distribution 
mechanism, continues with details of the various group-based options (<a href="#exchange-group-based" class="xref">Section 2.1.1</a>) 
and the ticket-based unicast mode (<a href="#exchange-ticket-based" class="xref">Section 2.1.2</a>) before it ends with 
more general topics in <a href="#general-topics" class="xref">Section 2.2</a> for example the key update process and 
finally an overview of the newly defined NTS messages in <a href="#overview-nts-messages" class="xref">Section 2.3</a>. 
<a href="#nts-messages-4-ptp" class="xref">Section 3</a> gives all the details necessary to construct all records forming 
the particular NTS messages. <a href="#new-ticket-tlv" class="xref">Section 4</a> depicts details of a TICKET TLV needed 
to transport encrypted security information in PTP unicast requests. The following 
<a href="#auth-tlv-parameters" class="xref">Section 5</a> mentions specific 
parameters used in the PTP AUTHENTICATION TLV when working with the NTS4PTP key management system. 
<a href="#iana-considerations" class="xref">Section 6</a> and <a href="#security-considerations" class="xref">Section 7</a> discuss IANA 
respectively security considerations.<a href="#section-2-11" class="pilcrow">¶</a></p>
<div id="key-distribution">
<section id="section-2.1">
        <h3 id="name-principle-key-distribution-">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-principle-key-distribution-" class="section-name selfRef">Principle Key Distribution Mechanism</a>
        </h3>
<p id="section-2.1-1">A PTP instance requests a key from the server referred to as the Key Establishment server, 
or (NTS-) KE server. <a href="#fig-key-distribution-sequence" class="xref">Figure 1</a> describes the principle 
sequence which can be used for PTP multicast as well as PTP unicast operation.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<span id="name-nts-key-distribution-sequen"></span><div id="fig-key-distribution-sequence">
<figure id="figure-1">
          <div class="artwork art-text alignLeft" id="section-2.1-2.1">
<pre>
PTP Instance 1                    NTS-KE-Server

 |                                    |
 |&lt;======== Open TLS Channel ========&gt;|
 |                                    |
 |                                    |
 |                                    |
 |                                    |
 |========= PTP Key Request =========&gt;| )
 |                                    | ) NTS messages
 |                                    | ) for PTP
 |                                    | ) key exchange
 |&lt;======== PTP Key Grant ============| )
 |                                    |
 |                                    |
 |                                    |
 |                                    |
 |&lt;======== Close TLS Channel =======&gt;|
 |                                    |
 |                                    o
 |
 |
 |
 |                              PTP Instance 2/
 |                              PTP Network
 |
 |                                    |
 |                                    |
 |&lt;---- Secured PTP Communication ---&gt;|
 |           using shared key         |
 |                                    |
 |                                    |
 V                                    V

</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-nts-key-distribution-sequen" class="selfRef">NTS Key distribution sequence</a>
          </figcaption></figure>
</div>
<p id="section-2.1-3">The client connects to the KE server on the NTS TCP port (port number 4460). Then both parties 
perform a TLS handshake to establish a TLS 1.3 communication channel. No earlier TLS versions 
are allowed. The details of the TLS handshake are specified in IETF RFC 8446 <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">Implementations must conform to the rules stated in chapter 3 "TLS Profile for Network Time 
Security" of IETF RFC 8915 <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>:<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<ul class="ulEmpty compact">
<li class="ulEmpty compact" id="section-2.1-5.1">
            <p id="section-2.1-5.1.1"><em>"Network Time Security makes use of TLS for NTS key 
      establishment.</em><a href="#section-2.1-5.1.1" class="pilcrow">¶</a></p>
<p id="section-2.1-5.1.2"></p>
</li>
          <li class="ulEmpty compact" id="section-2.1-5.2">
            <p id="section-2.1-5.2.1"><em>Since the NTS protocol is new as of this publication, no 
      backward-compatibility concerns exist to justify using obsolete, insecure, or 
  otherwise broken TLS features or versions.</em><a href="#section-2.1-5.2.1" class="pilcrow">¶</a></p>
<p id="section-2.1-5.2.2"></p>
</li>
          <li class="ulEmpty compact" id="section-2.1-5.3">
            <p id="section-2.1-5.3.1"><em>Implementations MUST conform with RFC 7525 </em>
              <span>[<a href="#RFC7525" class="xref">RFC7525</a>]</span><em> or with a later revision of BCP 195.
              </em><a href="#section-2.1-5.3.1" class="pilcrow">¶</a></p>
<p id="section-2.1-5.3.2"></p>
</li>
          <li class="ulEmpty compact" id="section-2.1-5.4">
            <p id="section-2.1-5.4.1"><em>Implementations MUST NOT negotiate TLS versions earlier than 
      1.3 </em><span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span><em> and MAY refuse to negotiate 
  any TLS version that has been superseded by a later supported version.</em><a href="#section-2.1-5.4.1" class="pilcrow">¶</a></p>
<p id="section-2.1-5.4.2"></p>
</li>
          <li class="ulEmpty compact" id="section-2.1-5.5">
            <em>Use of the Application-Layer Protocol Negotiation Extension 
            </em><span>[<a href="#RFC7301" class="xref">RFC7301</a>]</span><em> is integral to NTS, and support 
  for it is REQUIRED for interoperability ... "</em><a href="#section-2.1-5.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.1-6">The TLS handshake accomplishes the following:<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.1-7.1">Negotiation of TLS version (only TLS 1.3 allowed), and<a href="#section-2.1-7.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-2.1-7.2">negotiation of the cipher suite for the TLS session, and<a href="#section-2.1-7.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-2.1-7.3">authentication of the TLS server (equivalent to the KE server) using a digital 
      X.509 certificate,<a href="#section-2.1-7.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-2.1-7.4">verification of the TLS client (PTP instance) using its digital X.509 certificate and<a href="#section-2.1-7.4" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-2.1-7.5">the encryption of the subsequent information exchange between the TLS communication 
      partners.<a href="#section-2.1-7.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.1-8">TLS therefore enables peer authentication by certificates and provides authenticity, message 
integrity and confidentiality of following data transmitted over the TLS channel.<a href="#section-2.1-8" class="pilcrow">¶</a></p>
<p id="section-2.1-9">TLS is a layer five protocol that runs on TCP over IP. Therefore, PTP implementations that 
support NTS-based key management need to support TCP and IP (at least on a separate management port).<a href="#section-2.1-9" class="pilcrow">¶</a></p>
<p id="section-2.1-10">Once the TLS session is established, the PTP instance will ask for a PTP key as well as the 
associated security parameters using the new NTS message PTP Key Request (see 
<a href="#key-request" class="xref">Section 2.3.1</a>). 
The NTS application of the KE server will respond with either a PTP Key 
Grant message (see <a href="#key-grant" class="xref">Section 2.3.2</a>), or a PTP Refusal message (see <a href="#refusal" class="xref">Section 2.3.3</a>). All messages 
are constructed from specific records as described in <a href="#nts-records" class="xref">Section 3.2</a>.<a href="#section-2.1-10" class="pilcrow">¶</a></p>
<p id="section-2.1-11">When the Key Request message was responded with a PTP Key Grant or a PTP Refusal the TLS 
session will be closed with a close notify TLS message from both parties, the PTP instance 
and the key server.<a href="#section-2.1-11" class="pilcrow">¶</a></p>
<p id="section-2.1-12">With the key and other information received, the PTP instance can take part in the secured 
PTP communication in the different modes of operation.<a href="#section-2.1-12" class="pilcrow">¶</a></p>
<p id="section-2.1-13">After the reception of the first set of security parameters the PTP instance can resume the 
TLS session by including a TLS session ID, allowing the PTP instance to skip the TLS version 
and algorithm negotiations. If resuming is used, a suitable lifetime for the TLS session key 
must be defined to not open the TLS connection for security threats.<a href="#section-2.1-13" class="pilcrow">¶</a></p>
<p id="section-2.1-14">As the TLS session provides authentication, but not authorization additional means have 
to be used for the latter (see <a href="#upfront-authorization" class="xref">Section 2.2.5.4</a>).<a href="#section-2.1-14" class="pilcrow">¶</a></p>
<p id="section-2.1-15">As mentioned above, the NTS key management for PTP supports two principle methods, the 
group-based approach and the ticket-based approach which are described in the following 
sections below.<a href="#section-2.1-15" class="pilcrow">¶</a></p>
<div id="exchange-group-based">
<section id="section-2.1.1">
          <h4 id="name-nts-message-exchange-for-gr">
<a href="#section-2.1.1" class="section-number selfRef">2.1.1. </a><a href="#name-nts-message-exchange-for-gr" class="section-name selfRef">NTS Message Exchange for Group-based Approach</a>
          </h4>
<p id="section-2.1.1-1">As described in <a href="#key-distribution" class="xref">Section 2.1</a>, a PTP instance wanting to join a secured 
PTP communication in the group-based modes contacts the KE server inside a secured TLS connection 
with a PTP Key Request message (see <a href="#key-request" class="xref">Section 2.3.1</a>) as shown in 
<a href="#fig-group-based" class="xref">Figure 2</a>. The KE server answers with 
a PTP Key Grant message (see <a href="#key-grant" class="xref">Section 2.3.2</a>) with all the necessary data to join the group 
communication or with a PTP Refusal message (see <a href="#refusal" class="xref">Section 2.3.3</a>) if the PTP instance is not 
allowed to join the group. This procedure is necessary for all parties which are or will 
be members of that PTP group including the Grandmaster and other special participants, e.g. 
Transparent Clocks. As mentioned above, this not only applies to multicast mode but also 
to mixed multicast/unicast mode (former hybrid mode) where the explicit unicast communication 
uses the multicast group key received from the KE server. The group number for both modes 
is primarily generated by a concatenation of the PTP domain number and the PTP profile (sdoId), 
as described in <a href="#association-mode" class="xref">Section 3.2.2</a>.<a href="#section-2.1.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1.1-2">Additionally, besides multicast and mixed multicast/unicast mode, a group of two (or few 
more) PTP instances can be configured, practically implementing a special group-based unicast 
communication mode, the group-of-2 (Go2) mode.<a href="#section-2.1.1-2" class="pilcrow">¶</a></p>
<span id="name-message-exchange-for-the-gr"></span><div id="fig-group-based">
<figure id="figure-2">
            <div class="artwork art-text alignLeft" id="section-2.1.1-3.1">
<pre>
Secured
PTP Network       PTP Instance          NTS-KE-Server

 |                      |                     |
 |                      |         TLS:        |
 |                  TLS |== PTP Key Request =&gt;| Response contains:
 |              secured |                     | GroupID, security
 |        communication |         TLS:        | parameters, group
 |                      |&lt;== PTP Key Grant ===| key, validity
 |                      |                     | period etc.
 |                      |                     |
 |    Secured PTP:      |                     |
 |--- Announce --------&gt;|  )                  |
 |                      |  )                  |
 |                      |  )                  |
 |    Secured PTP:      |  )                  |
 |-- Sync &amp; Follow_Up -&gt;|  )                  |
 |                      |  ) Secured          |
 |                      |  ) PTP messages     |
 |    Secured PTP:      |  ) using            |
 |&lt;-- Delay_Req --------|  ) group key        |
 |                      |  )                  |
 |                      |  )                  |
 |    Secured PTP:      |  )                  |
 |--- Delay_Resp ------&gt;|  )                  |
 |                      |  )                  |
 |                      |                     |
 V                      V                     V

Legend:        TLS:       Authenticated &amp; encrypted
          =============&gt;  TLS communication

           Secured PTP:   Group key-authenticated
          -------------&gt;  PTP communication

</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-message-exchange-for-the-gr" class="selfRef">Message exchange for the group-based approach</a>
            </figcaption></figure>
</div>
<p id="section-2.1.1-4">This mode requires additional administration in advance defining groups-of-2 and supplying 
them with an additional attribute in addition to the group number mentioned for the other 
group-based modes - the subGroup attribute in the Association Mode record (see <a href="#association-mode" class="xref">Section 3.2.2</a>) of 
the PTP Key Request message. So, addressing for Go2 is achieved by use of the group number 
derived from domain number, sdoId and the additional attribute subGroup. Communication in 
that mode is performed using multicast addresses. If the latter is undesirable, unicast 
addresses can be used but the particular IP or MAC addresses of the communication partners 
need to be configured upfront, too.<a href="#section-2.1.1-4" class="pilcrow">¶</a></p>
<p id="section-2.1.1-5">In spite of its specific name, Go2 allows more than two participants, for example additional 
Transparent Clocks. All participants in that subgroup need to be configured respectively. 
(To enable the KE server to supply the subgroup members with the particular security data 
the respective certificates may reflect permission to take part in the subgroup. Else another 
authorization method is to be used.)<a href="#section-2.1.1-5" class="pilcrow">¶</a></p>
<p id="section-2.1.1-6">Having predefined the Go2s the key management for this mode of operation follows the same 
procedure (see <a href="#fig-group-based" class="xref">Figure 2</a>) and uses the same NTS messages as the other group-based modes. 
Both participants, the Group-of-2 requester and the respective grantor need to have received 
their security parameters including key etc. before secure PTP communication can take place.<a href="#section-2.1.1-6" class="pilcrow">¶</a></p>
<p id="section-2.1.1-7">After the NTS key establishment messages for these group-based modes have been exchanged, 
the secured PTP communication can take place using the Security Association(s) communicated.<a href="#section-2.1.1-7" class="pilcrow">¶</a></p>
<p id="section-2.1.1-8">The key management for these modes works relatively simple and needs only the above mentioned 
three NTS messages: PTP Key Request, PTP Key Grant or PTP Refusal. The group number used for 
addressing is automatically derived from the configured attributes PTP domain number and sdoId. 
For Go2, the attribute subGroup is additionally required.<a href="#section-2.1.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="exchange-ticket-based">
<section id="section-2.1.2">
          <h4 id="name-nts-message-exchange-for-th">
<a href="#section-2.1.2" class="section-number selfRef">2.1.2. </a><a href="#name-nts-message-exchange-for-th" class="section-name selfRef">NTS Message Exchange for the Ticket-based Approach</a>
          </h4>
<p id="section-2.1.2-1">In (native) PTP unicast mode using unicast message negotiation (<span>[<a href="#IEEE1588-2019" class="xref">IEEE1588-2019</a>]</span>, 16.1) 
any potential instance (the grantor) which can be contacted by other PTP instances (the requesters) 
needs to register upfront with the KE server as depicted in <a href="#fig-ticket-based" class="xref">Figure 3</a>.<a href="#section-2.1.2-1" class="pilcrow">¶</a></p>
<span id="name-message-exchange-for-ticket"></span><div id="fig-ticket-based">
<figure id="figure-3">
            <div class="artwork art-text alignLeft" id="section-2.1.2-2.1">
<pre>
     PTP Requester         NTS-KE-Server            PTP Grantor

             |                    |                     |
             |                    |         TLS:        |Grantor
             |       KE generates |&lt;= PTP Registration =|registers
             |         ticket key |       Request       |upfront
             |                    |                     |
             |                    |        TLS:         |gets
             |           KE sends |== PTP Registration &gt;|ticket
             |         ticket key |       Success       |key to
             |                    |                     |decrypt
             :                    :                     :tickets
             :                    ;                     :
 PTP instance|     TLS:           |                     |
wants unicast|= PTP Key Request =&gt;| KE generates        |
communication|                    | and sends           |
             |                    | unicast key         |
             |     TLS:           | &amp; encrypted         |
             |&lt;= PTP Key Grant ===| ticket              |
             |                    |                     |
             |                    |                     |
             |                    |                     |decrypts
      Unicast|                    |                     |ticket,
      request|  Secured PTP:      |                     |extracts
     contains|- Announce Request ----------------------&gt;|containing
       ticket|                    |                     |unicast key
             |                    |                     |
             |  Secured PTP:      |                     |Grantor uses
             |&lt; Grant ----------------------------------|unicast key
             |                    |                     |
             |                    |                     |
             V                    V                     V


Legend:        TLS:       Authenticated &amp; encrypted
          =============&gt;  TLS communication

           Secured PTP:   Unicast key-authenticated
          -------------&gt;  PTP communication

</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-message-exchange-for-ticket" class="selfRef">Message exchange for ticket-based unicast mode</a>
            </figcaption></figure>
</div>
<p id="section-2.1.2-3">(Note: As any PTP instance 
may request unicast messages from any other instance the terms requester and grantor as used in 
the standard suit better than talking about slave resp. master. In unicast PTP, the grantor is 
typically a PTP Port in the MASTER state, and the requester is typically a PTP Port in the SLAVE 
state, however all PTP Ports are allowed to grant and request unicast PTP message contracts 
regardless of which state they are in. A PTP port in MASTER state may be requester, a port in 
SLAVE state may be a grantor.)<a href="#section-2.1.2-3" class="pilcrow">¶</a></p>
<p id="section-2.1.2-4"> This registration is performed via a PTP Registration Request message (see <a href="#registration-request" class="xref">Section 2.3.4</a>). The KE 
server answers with a PTP Registration Success message (see <a href="#registration-success" class="xref">Section 2.3.5</a>) or a PTP Refusal message 
(see <a href="#refusal" class="xref">Section 2.3.3</a>).<a href="#section-2.1.2-4" class="pilcrow">¶</a></p>
<p id="section-2.1.2-5">With the reception of the PTP Registration Success message the grantor holds a ticket key known 
only to the KE server and the registered grantor. With this ticket key it can decrypt  
cryptographic information contained in a so-called ticket which enables secure unicast 
communication.<a href="#section-2.1.2-5" class="pilcrow">¶</a></p>
<p id="section-2.1.2-6">As with the group-based approach, a PTP instance (the requester) wanting to start a secured 
PTP unicast communication with a specific grantor contacts the KE server sending a PTP Key 
Request message (see <a href="#key-request" class="xref">Section 2.3.1</a>) as shown in <a href="#fig-ticket-based" class="xref">Figure 3</a> 
using the TLS-secured NTS Key Establishment protocol. The KE server answers with a 
PTP Key Grant message (see <a href="#key-grant" class="xref">Section 2.3.2</a>) 
with all the necessary data to begin the unicast communication with the desired partner or 
with a PTP Refusal message (see <a href="#refusal" class="xref">Section 2.3.3</a>) if unicast communication with that instance 
is unavailable.<a href="#section-2.1.2-6" class="pilcrow">¶</a></p>
<p id="section-2.1.2-7">The PTP Key Grant message includes a unicast key to secure the PTP message exchange with 
the desired grantor. In addition, it contains the above mentioned encrypted ticket which the 
requester transmits in a special Ticket TLV (see <a href="#new-ticket-tlv" class="xref">Section 4</a>) with the secured PTP message to 
the grantor. The grantor receiving the PTP message decrypts the received ticket with its 
ticket key and extracts the containing security parameters, for example the unicast key used 
by the requester to secure the PTP message and the requester's identity. In that way the 
grantor can check the received message, identify the requester and can use the unicast key 
for further secure PTP communication with the requester until the unicast key expires.<a href="#section-2.1.2-7" class="pilcrow">¶</a></p>
<p id="section-2.1.2-8">After the NTS key establishment messages for the PTP unicast mode have been exchanged the 
secured PTP communication can take place using the Security Association(s) communicated.<a href="#section-2.1.2-8" class="pilcrow">¶</a></p>
<p id="section-2.1.2-9">If a grantor is no longer at disposal for unicast mode during the lifetime of registration 
and ticket key, it sends a TLS-secured PTP Registration Revoke message (see <a href="#registration-revoke" class="xref">Section 2.3.6</a>) 
to the KE server, so requesters no longer receive PTP Key Grant messages for this grantor.<a href="#section-2.1.2-9" class="pilcrow">¶</a></p>
<p id="section-2.1.2-10">This unicast mode is a bit more complex than the Group-of-2 approach and eventually uses 
all six new NTS messages. However, no subgroups have to be defined upfront. Addressing a grantor, 
the requesting instance simply may use the grantor's IP, MAC address or PortIdentity attribute.<a href="#section-2.1.2-10" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="general-topics">
<section id="section-2.2">
        <h3 id="name-general-topics">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-general-topics" class="section-name selfRef">General Topics</a>
        </h3>
<p id="section-2.2-1">This section describes more general topics like key update and key generation as well as discussion 
of the time information on the KE server, the use of certificates and topics concerning upfront 
configuration.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<div id="key-update">
<section id="section-2.2.1">
          <h4 id="name-key-update-process">
<a href="#section-2.2.1" class="section-number selfRef">2.2.1. </a><a href="#name-key-update-process" class="section-name selfRef">Key Update Process</a>
          </h4>
<p id="section-2.2.1-1">All keys are equipped with parameters for a specific lifetime. Thereafter new key material has 
to be used. The value in the Lifetime record given by the KE server in the respective NTS messages is 
specified in seconds which denote the remaining time until the key expires and are decremented down 
to zero. So hard adjustments of the clock used have to be avoided. Therefore the use of a monotonic 
clock is recommended. Requests during the currently running lifetime will receive respectively 
adapted count 
values.<a href="#section-2.2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.2.1-2">The receiving instances may concede a Grace Time in the range of, for example 5 - 10 seconds where 
an old key is still accepted to handle internal delays gracefully. The Grace Time may be defined in 
a PTP profile. Additionally, the KE server can optionally be configured to inform about a grace time 
value generally to be used.<a href="#section-2.2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.2.1-3">New security parameters will be available after the Time until Update (TuU). The Time until Update 
given by the KE server is specified in seconds which are decremented down to zero. After that point 
in time until the end of the Lifetime of an associated key the PTP instances should connect to the 
KE server again, to receive new security parameters. The actual point in time, when a PTP instance 
asks for new data, should be selected randomly in the update period - the time after TuU was 
decremented to zero and before the Lifetime is counted down completely - to avoid peak load on the 
KE server. <a href="#fig-update-group-based" class="xref">Figure 4</a> presents an example of the key update mechanism. 
A PTP instance sending a PTP 
Key Request to the KE server during the update period will receive the current security parameters 
(Current Parameters) as well as the security parameters of the following period (Next Parameters). 
As with the lifetime, requests during the currently running lifetime will receive respectively 
adapted count values for the current TuU.<a href="#section-2.2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.2.1-4">Lifetime and Time until Update allow a cyclic rotation of security parameters during the running 
operation. This approach guarantees continuous secured PTP communication without interruption by 
key rotation.<a href="#section-2.2.1-4" class="pilcrow">¶</a></p>
<span id="name-example-of-the-parameter-ro"></span><div id="fig-update-group-based">
<figure id="figure-4">
            <div class="artwork art-text alignLeft" id="section-2.2.1-5.1">
<pre>
|12,389s (at time of key request)    0s|14,400s                   0s|
+--------------------------------------+------------------...-------+
|     Lifetime (curent parameters)     |  Lifetime (next parameters)|
+-----------------------------+--------+------------------...-------+
|         Time until Update   |  900s  |
+-----------------------------+&lt;------&gt;|
|11,489s (time of key req.) 0s| update |
                                period
                              |________|
                                   |
                                   V
                   Request and receive new parameters
                        at a random point in time

Example:
--------
Lifetime (full):            14,400s = 4h
Time unitil Update (full):  13,500s -&gt; updated period: 900s = 15 min

</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-example-of-the-parameter-ro" class="selfRef">Example of the parameter rotation using Lifetime and                                                       Time until Update in group-based mode</a>
            </figcaption></figure>
</div>
<p id="section-2.2.1-6">The key rotation mechanism described also applies for the ticket-based approach. As there are 
two keys, the ticket key and the unicast key, some details need to be explained 
(see <a href="#fig-update-ticket-based" class="xref">Figure 5</a>). 
When the grantor registers with the KE server it receives the ticket key with the PTP Registration 
Success message together with the Lifetime and the respective Time until Update records. The 
lifetime parameters also apply to the ticket a requester would receive.<a href="#section-2.2.1-6" class="pilcrow">¶</a></p>
<p id="section-2.2.1-7">A requester wanting to communicate in unicast sends a PTP Key Request message with the particular 
parameters to the KE server. In the response it receives a specific unicast key with Lifetime and 
TuU as well as the encrypted ticket containing all the necessary security information for the grantor. 
The lifetime of the unicast key will end at the same point in time as the ticket key. Requests during 
the currently running lifetime of the ticket key will receive respectively adapted count values. The 
lifetime can be at most the remaining lifetime of the respective ticket key of the grantor.<a href="#section-2.2.1-7" class="pilcrow">¶</a></p>
<span id="name-example-of-the-parameter-rot"></span><div id="fig-update-ticket-based">
<figure id="figure-5">
            <div class="artwork art-text alignLeft" id="section-2.2.1-8.1">
<pre>


Update process grantor:
-----------------------

(at time of registration success)
  |
|14,400s                               0s |14,400s                0s|
+--------------------------------------------------------...--------+
|Lifetime (curr.ticket key)               |Lifetime (next ticket k.)|
+-------------------------+------+--------+--------------...--------+
|    Time until Update    | 300s |        :
+-------------------------+&lt;----&gt;|        :
|13,200s                0s|update|        :
  |                        period:        :
(at time of                      :        :
 registration success)           :        :
                                 :        :
                                 :        :
Update process requester:        :        :
-------------------------        :        :
                                 :        :
(at time of key grant)           :        :
      |                          :        :
    |12,389s                     :      0s|14,400s                0s|
    +-------------------------------------+-----------------...-----+
    |Lifetime (curent parameters)         | Lifetime (next params.) |
    +----------------------------+--------+-----------------...-----+
    |    Time until Update       |  900s  |
    +----------------------------+&lt;------&gt;|
    |11,489s                   0s| update |
      |                            period
(at time of key grant)           |________|
                                      |
                                      V
                      Request and receive new parameters
                           at a random point in time

Example:
--------
Lifetime (full):            14,400s = 4h
Time unitil Update (full):
              - requester   13,500s -&gt; updated period: 900s = 15 min
Time unitil Update (full):
              - grantor:    13,200s = ToU of requester - 300s

</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-example-of-the-parameter-rot" class="selfRef">Example of the parameter rotation using Lifetime and                                                       Time until Update in ticket-based mode</a>
            </figcaption></figure>
</div>
<p id="section-2.2.1-9">The TuU of the ticket key will end earlier than the TuU of associated unicast keys. The 
grantor should re-register in its update period beginning after the Time until Update of the 
ticket key was decremented to zero and ending when an associated unicast key TuU is counted 
down. As the grantor does not know how long its update period lasts it should re-register 
immediately after its TuU has ended. (A profile or a general configuration may fix the 
length of a grantors' update period. Then the grantor could re-register at a random point 
in time during its update period. Because masters register asynchronously, their 
re-registration will also be asynchronous. So typically, no peak load for the KE server 
will be generated.) Its update period is a mere timing buffer for cases 
where re-registration will not work instantly. The re-registration should be completed before 
any requester can start a PTP Key Request for ticket-based unicast mode. This guarantees 
the availability of a new ticket. When re-registering in its update period the grantor will 
receive together with the ticket key, etc., Lifetime and Time until Update of the current 
period as well as the parameters of the following period - similar to multicast keys. (A 
registration during the TuU period will supply only current data, not parameters of the 
following period. A late re-registration after the end of the current Lifetime will start 
a new period with respective full lifetime und update parameters.)<a href="#section-2.2.1-9" class="pilcrow">¶</a></p>
<p id="section-2.2.1-10">A requester needs to ask for a new unicast key and ticket at the KE server during the 
update period for uninterrupted unicast communication possibility or else at any later 
point in time. During the update period it will receive the Current Parameters as well 
as the Next Parameters. Embedded in the respective data, it will receive the ticket for 
the grantor including the encrypted ticket. Each ticket carries the same security 
information as the respective Current Parameters or Next Parameters data structure.<a href="#section-2.2.1-10" class="pilcrow">¶</a></p>
<p id="section-2.2.1-11">If a grantor does not have re-registered (in time or at all) when corresponding requesters try 
to get unicast keys, they will receive a PTP Refusal message.<a href="#section-2.2.1-11" class="pilcrow">¶</a></p>
<p id="section-2.2.1-12">If a grantor has revoked his registration with a PTP Registration Revoke message, requesters will 
receive a PTP Refusal message when trying to update for a new unicast key. No immediate key revoke 
mechanism exists. The grantor should not grant respective unicast requests until the revoked key 
expires.<a href="#section-2.2.1-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-generation">
<section id="section-2.2.2">
          <h4 id="name-key-generation">
<a href="#section-2.2.2" class="section-number selfRef">2.2.2. </a><a href="#name-key-generation" class="section-name selfRef">Key Generation</a>
          </h4>
<p id="section-2.2.2-1">In all cases keys obtained by a secure random number generator shall be used. The length of 
the keys depends on the MAC algorithm (see also last subsection in <a href="#sa-sp-management" class="xref">Section 3.3.2</a>) 
respectively the AEAD algorithm utilized.<a href="#section-2.2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="time-ke-server">
<section id="section-2.2.3">
          <h4 id="name-time-information-of-the-ke-">
<a href="#section-2.2.3" class="section-number selfRef">2.2.3. </a><a href="#name-time-information-of-the-ke-" class="section-name selfRef">Time Information of the KE Server</a>
          </h4>
<p id="section-2.2.3-1">As the KE server embeds time duration information in the respective messages, its local time 
should be accurate to within a few seconds compared to the controlled PTP network(s). To 
avoid any dependencies, it should synchronize to a secure external time source, for example an 
NTS-secured NTP server. The time information is also necessary to check the lifetime of certificates 
used.<a href="#section-2.2.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="certificates">
<section id="section-2.2.4">
          <h4 id="name-certificates">
<a href="#section-2.2.4" class="section-number selfRef">2.2.4. </a><a href="#name-certificates" class="section-name selfRef">Certificates</a>
          </h4>
<p id="section-2.2.4-1">The authentication of the TLS communication parties is based on certificates issued by a trusted 
Certificate Authority (CA) that are utilized during the TLS handshake. In classical TLS applications 
only servers are required to have them. For the key management system described here,  the PTP nodes 
also need certificates to allow only authorized and trusted devices to get the group key and join 
a secure PTP network. (As TLS only authenticates the communication partners, authorization has to 
be managed by external means, see the topic "Authorization" in <a href="#upfront-authorization" class="xref">Section 2.2.5.4</a>.) 
The verification of a certificate always requires a loose time synchronicity, 
because they have a validity period. This, however, reveals the well-known start-up problem, since 
secure time transfer itself requires valid certificates. (See the discussion and proposals on this 
topic in IETF RFC 8915 <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, chapter 8.5 "Initial Verification of Server certificates" which applies to 
client certificates in the PTP key management system, too.)<a href="#section-2.2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.2.4-2">Furthermore, some kind of Public Key Infrastructure (PKI) is necessary, which may be conceivable via 
the Online Certificate Status Protocol (OCSP) as well as offline via root CA certificates.<a href="#section-2.2.4-2" class="pilcrow">¶</a></p>
<p id="section-2.2.4-3">The TLS communication parties must be equipped with a private key and a certificate in advance. The 
certificate contains a digital signature of the CA as well as the public key of the sender. The key 
pair is required to establish an authenticated and encrypted channel for the initial TLS phase. 
Distribution and update of the certificates can be done manually or automatically. However, it is 
important that they are issued by a trusted CA instance, which can be either local (private CA) or 
external (public CA).<a href="#section-2.2.4-3" class="pilcrow">¶</a></p>
<p id="section-2.2.4-4">For the certificates the standard for X.509 <span>[<a href="#ITU-T_X.509" class="xref">ITU-T_X.509</a>]</span> certificates must be used. Additional data 
in the certificates like domain, sdoId and/or subgroup attributes may help in authorizing. In that 
case it should be noted that using the PTP device in another network then implies to have a new 
certificate, too. Working with certificates without authorization information would not have that 
disadvantage, but more configuring at the KE server would be necessary: which domain, sdoId and/or 
subgroup attributes belong to which certificate.<a href="#section-2.2.4-4" class="pilcrow">¶</a></p>
<p id="section-2.2.4-5">As TLS is used to secure the NTS Key Establishment protocol a comment on the security of TLS 
seems reasonable. A TLS 1.3 connection is considered secure today. However, note that a DoS (Denial 
of Service) attack on the key server can prevent new connections or parameter updates for secure 
PTP communication. A hijacked key management system is also critical, because it can completely 
disable the protection mechanism. A redundant implementation of the key server is therefore essential 
for a robust system. A further mitigation can be the limitation of the number of TLS requests of 
single PTP nodes to prevent flooding. But such measures are out of the scope of this document.<a href="#section-2.2.4-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upfront-configuration">
<section id="section-2.2.5">
          <h4 id="name-upfront-configuration">
<a href="#section-2.2.5" class="section-number selfRef">2.2.5. </a><a href="#name-upfront-configuration" class="section-name selfRef">Upfront Configuration</a>
          </h4>
<p id="section-2.2.5-1">All PTP instances as well as the NTS-KE server need to be configured by the network administrator. 
This applies to several fields of parameters.<a href="#section-2.2.5-1" class="pilcrow">¶</a></p>
<div id="upfront-security-parameters">
<section id="section-2.2.5.1">
            <h5 id="name-security-parameters">
<a href="#section-2.2.5.1" class="section-number selfRef">2.2.5.1. </a><a href="#name-security-parameters" class="section-name selfRef">Security Parameters</a>
            </h5>
<p id="section-2.2.5.1-1">The cryptographic algorithm and associated parameters (the so-called Security Association(s) - SA) 
used for PTP keys are configured by network operators at the KE server. This includes the Security 
Policies, i.e. which PTP messages are to be secured. PTP instances that do not support the configured 
algorithms cannot operate with the security. Since most PTP Networks are managed by a single organization, 
configuring the cryptographic algorithm (MAC) for ICV calculation is practical. This prevents the 
need for the KE server and PTP instances to implement an NTS algorithm negotiation protocol.<a href="#section-2.2.5.1-1" class="pilcrow">¶</a></p>
<p id="section-2.2.5.1-2">For the ticket-based approach the AEAD algorithms need to be specified which the PTP grantors and 
the KE server support and negotiate during the registration process. Optionally, the MAC algorithm may 
be negotiated during a unicast PTP Key Request to allow faster or stronger algorithms, but a standard 
protocol supported by every instance should be defined. Eventually, suitable algorithms may be defined 
in a respective profile.<a href="#section-2.2.5.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upfront-key-lifetimes">
<section id="section-2.2.5.2">
            <h5 id="name-key-lifetimes">
<a href="#section-2.2.5.2" class="section-number selfRef">2.2.5.2. </a><a href="#name-key-lifetimes" class="section-name selfRef">Key Lifetimes</a>
            </h5>
<p id="section-2.2.5.2-1">Supplementary to the above mentioned SAs the desired key rotation periods, i.e. the lifetimes of 
keys resp. all security parameters need to be configured at the NTS-KE server. This applies to the 
lifetime of a group key in the group-based approach as well as the lifetime of ticket key and unicast 
key in the ticket-based unicast approach (typically for every unicast pair in general or eventually 
specific for each requestor-grantor pair). In addition, the corresponding Time until Update parameters 
need to be defined which (together with the lifetime) specify the relevant update period. Any particular 
Lifetime and Time until Update are configured as time spans counted in seconds and start at the same 
point in time.<a href="#section-2.2.5.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upfront-certificates">
<section id="section-2.2.5.3">
            <h5 id="name-certificates-2">
<a href="#section-2.2.5.3" class="section-number selfRef">2.2.5.3. </a><a href="#name-certificates-2" class="section-name selfRef">Certificates</a>
            </h5>
<p id="section-2.2.5.3-1">The network administrator has to supply each PTP instance and the KE server with their X.509 
certificates. The TLS communication parties must be equipped with a private key and a certificate 
containing the public key in advance (see <a href="#certificates" class="xref">Section 2.2.4</a>).<a href="#section-2.2.5.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upfront-authorization">
<section id="section-2.2.5.4">
            <h5 id="name-authorization">
<a href="#section-2.2.5.4" class="section-number selfRef">2.2.5.4. </a><a href="#name-authorization" class="section-name selfRef">Authorization</a>
            </h5>
<p id="section-2.2.5.4-1">The certificates provide authentication of the communication partners. Normally, they do not 
contain authorization information. Authorization decides, which PTP instances are allowed to join 
a group (in any of the group-based modes) or may enter a unicast communication in the ticket-based 
approach and request the respective SA(s) and key.<a href="#section-2.2.5.4-1" class="pilcrow">¶</a></p>
<p id="section-2.2.5.4-2">As mentioned, members of a group (multicast mode, mixed multicast/unicast mode) are identified 
by their domain and their sdoId. PTP Domain and sdoId may be attributes in the certificates of 
the potential group members supplying additional authorization. If not contained in the 
certificates extra authorization means are necessary. (See also the discussion on advantages 
and disadvantages on certificates containing additional authorization data in <a href="#certificates" class="xref">Section 2.2.4</a>.)<a href="#section-2.2.5.4-2" class="pilcrow">¶</a></p>
<p id="section-2.2.5.4-3">If the special Group-of-2 mode is used, the optional subGroup parameter (i.e. the subgroup 
number) needs to be specified at all members of respective Go2s, upfront. To enable the KE 
server to supply the subgroup members with the particular security data their respective 
certificates may reflect permission to take part in the subgroup. Else another authorization 
method is to be used.<a href="#section-2.2.5.4-3" class="pilcrow">¶</a></p>
<p id="section-2.2.5.4-4">In native unicast mode, any authenticated grantor that is member of the group used for multicast 
may request a registration for unicast communication at the KE server. If it is intended for 
unicast, this must be configured locally. If no group authorization is available (e.g. pure 
unicast operation) another authentication scheme is necessary.<a href="#section-2.2.5.4-4" class="pilcrow">¶</a></p>
<p id="section-2.2.5.4-5">In the same way, any requester (if configured for it locally) may request security data for a 
unicast connection with a specific grantor. Only authentication at the KE server using its 
certificate and membership in the group used for multicast is needed. If a unicast communication 
is not desired by the grantor, it should not grant a specific unicast request. Again, if no 
group authorization is available (e.g. pure unicast operation) another authentication scheme 
is necessary.<a href="#section-2.2.5.4-5" class="pilcrow">¶</a></p>
<p id="section-2.2.5.4-6">Authorization can be executed at least in some manual configuration. Probably the application 
of a standard access control system like Diameter, RADIUS or similar would be more appropriate. 
Also role-based access control (RBAC), attribute-based access control (ABAC) or more flexible 
tools like Open Policy Agent (OPA) could help administering larger systems. But details of the 
authorization of PTP instances lies out of scope of this document.<a href="#section-2.2.5.4-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upfront-tcs">
<section id="section-2.2.5.5">
            <h5 id="name-transparent-clocks">
<a href="#section-2.2.5.5" class="section-number selfRef">2.2.5.5. </a><a href="#name-transparent-clocks" class="section-name selfRef">Transparent Clocks</a>
            </h5>
<p id="section-2.2.5.5-1">Transparent Clocks (TC) need to be supplied with respective certificates, too. For group-based 
modes they must be configured for the particular PTP domain and sdoId and eventually for the 
specific subgroup(s) when using Group-of-2. They need to request for the relevant group key(s) 
at the KE server to allow secure use of the correctionField in a PTP message and generation of 
a corrected ICV. If TCs are used in ticket-based unicast mode, they need to be authorized for 
the particular unicast path.<a href="#section-2.2.5.5-1" class="pilcrow">¶</a></p>
<p id="section-2.2.5.5-2">Authorization of TCs for the respective groups, subgroups and unicast connections is paramount. 
Otherwise the security can easily be broken with attackers pretending to be TCs in the path. 
Authorization of TCs is necessary too in unicast communication, even if the normal unicast 
partners need not be especially authorized.<a href="#section-2.2.5.5-2" class="pilcrow">¶</a></p>
<p id="section-2.2.5.5-3">Transparent clocks may notice that the communication runs secured. In the group-based 
approaches multicast mode and mixed multicast/unicast mode they construct the GroupID from domain 
and sdoId and request a group key from the KE server. Similarly, they can use the additional 
subgroup attribute in Go2 mode for a (group) key request. Afterwards they can check the ICV 
of incoming messages, fill in the correction field and generate a new ICV for outgoing messages. 
In ticket-based unicast mode a TC may notice a secured unicast request from a requester to the 
grantor and can request the unicast key from the KE server to make use of the correction field 
afterwards. As mentioned above upfront authentication and authorization of the particular TCs 
is paramount not to open the secured communication to attackers.<a href="#section-2.2.5.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upfront-start-up">
<section id="section-2.2.5.6">
            <h5 id="name-start-up-considerations">
<a href="#section-2.2.5.6" class="section-number selfRef">2.2.5.6. </a><a href="#name-start-up-considerations" class="section-name selfRef">Start-up considerations</a>
            </h5>
<p id="section-2.2.5.6-1">At start-up of a single PTP instance or the complete PTP network some issues have to be considered.<a href="#section-2.2.5.6-1" class="pilcrow">¶</a></p>
<p id="section-2.2.5.6-2">At least loose time synchronization is necessary to allow for authentication using the certificates. 
See the discussion and proposals on this topic in IETF RFC 8915 <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, chapter 8.5 "Initial Verification 
of Server certificates" which applies to client certificates in the PTP key management system, too.<a href="#section-2.2.5.6-2" class="pilcrow">¶</a></p>
<p id="section-2.2.5.6-3">Similarly to a key re-request during an update period, key requests should be started at a random 
point in time after start-up to avoid peak load on the NTS-KE server. Every grantor must register 
with the KE server before requesters can request a unicast key (and ticket).<a href="#section-2.2.5.6-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="overview-nts-messages">
<section id="section-2.3">
        <h3 id="name-overview-of-nts-messages-an">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-overview-of-nts-messages-an" class="section-name selfRef">Overview of NTS Messages and their Structure for Use with PTP</a>
        </h3>
<p id="section-2.3-1"><a href="#key-distribution" class="xref">Section 2.1</a> described the principle communication sequences for PTP Key Request, PTP Registration 
Request and corresponding response messages. All messages follow the "NTS Key Establishment Process" 
stated in the first part (until the description of Fig. 3 starts) of chapter 4 of IETF RFC 8915 <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>:<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<ul class="ulEmpty compact">
<li class="ulEmpty compact" id="section-2.3-2.1">
            <p id="section-2.3-2.1.1"><em>"The NTS key establishment protocol is conducted via TCP port 4460.
        The two endpoints carry out a TLS handshake in conformance with
        Section 3, with the client offering (via an ALPN extension </em><span>[<a href="#RFC7301" class="xref">RFC7301</a>]</span>)<em>, 
 and the server accepting,
        an application-layer protocol of "ntske/1". Immediately
        following a successful handshake, the client SHALL send a single request
        as Application Data encapsulated in the TLS-protected channel. Then, the
        server SHALL send a single response. After sending their respective
        request and response, the client and server SHALL send TLS
        "close_notify" alerts in accordance with Section 6.1 of RFC 8446 </em><span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>.<a href="#section-2.3-2.1.1" class="pilcrow">¶</a></p>
<p id="section-2.3-2.1.2"></p>
</li>
          <li class="ulEmpty compact" id="section-2.3-2.2">
            <p id="section-2.3-2.2.1"><em>The client's request and the server's response each SHALL consist of a
        sequence of records formatted according to</em>
              <a href="#fig-ntske-record" class="xref">Figure 6</a><em>. The request and a non-error response each
        SHALL include exactly one NTS Next Protocol Negotiation record. The
        sequence SHALL be terminated by a "End of Message" record. The
        requirement that all NTS-KE messages be terminated by an End of Message
        record makes them self-delimiting.</em><a href="#section-2.3-2.2.1" class="pilcrow">¶</a></p>
<p id="section-2.3-2.2.2"></p>
</li>
          <li class="ulEmpty compact" id="section-2.3-2.3">
            <p id="section-2.3-2.3.1"><em>Clients and servers MAY enforce length limits on requests and responses,
        however, servers MUST accept requests of at least 1024 octets and
        clients SHOULD accept responses of at least 65536 octets.</em><a href="#section-2.3-2.3.1" class="pilcrow">¶</a></p>
<p id="section-2.3-2.3.2"></p>
</li>
          <li class="ulEmpty compact" id="section-2.3-2.4">
            <p id="section-2.3-2.4.1"><em>The fields of an NTS-KE record are defined as follows:</em><a href="#section-2.3-2.4.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3-2.4.2.1">
                <p id="section-2.3-2.4.2.1.1"><em>C (Critical Bit): Determines the disposition of unrecognized Record
            Types. Implementations which receive a record with an unrecognized
            Record Type MUST ignore the record if the Critical Bit is 0 and MUST
            treat it as an error if the Critical Bit is 1 (see Section 4.1.3).</em><a href="#section-2.3-2.4.2.1.1" class="pilcrow">¶</a></p>
<p id="section-2.3-2.4.2.1.2"></p>
</li>
              <li class="compact" id="section-2.3-2.4.2.2">
                <p id="section-2.3-2.4.2.2.1"><em>Record Type Number: A 15-bit integer in network byte order. The
            semantics of record types 0-7 are specified in this memo.
            Additional type numbers SHALL be tracked through the IANA Network
            Time Security Key Establishment Record Types registry.</em><a href="#section-2.3-2.4.2.2.1" class="pilcrow">¶</a></p>
<p id="section-2.3-2.4.2.2.2"></p>
</li>
              <li class="compact" id="section-2.3-2.4.2.3">
                <p id="section-2.3-2.4.2.3.1"><em>Body Length: The length of the Record Body field, in octets, as a
            16-bit integer in network byte order. Record bodies MAY have any
            representable length and need not be aligned to a word boundary.</em><a href="#section-2.3-2.4.2.3.1" class="pilcrow">¶</a></p>
<p id="section-2.3-2.4.2.3.2"></p>
</li>
              <li class="compact" id="section-2.3-2.4.2.4">
                <p id="section-2.3-2.4.2.4.1"><em>Record Body: The syntax and semantics of this field SHALL be
            determined by the Record Type.</em><a href="#section-2.3-2.4.2.4.1" class="pilcrow">¶</a></p>
<p id="section-2.3-2.4.2.4.2"></p>
</li>
            </ul>
</li>
          <li class="ulEmpty compact" id="section-2.3-2.5">
            <em>For clarity regarding bit-endianness: the Critical Bit is the
        most-significant bit of the first octet. In the C programming language,
        given a network buffer
        `unsigned char b[]` containing an NTS-KE record, the critical bit is
        `b[0] &gt;&gt; 7` while the record type is
        `((b[0] &amp; 0x7f) &lt;&lt; 8) + b[1]`."</em><a href="#section-2.3-2.5" class="pilcrow">¶</a>
</li>
        </ul>
<span id="name-nts-ke-record-format"></span><div id="fig-ntske-record">
<figure id="figure-6">
          <div class="artwork art-text alignLeft" id="section-2.3-3.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|C|         Record Type         |          Body Length          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
:                                                               :
:                           Record Body                         :
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-nts-ke-record-format" class="selfRef">NTS-KE Record format</a>
          </figcaption></figure>
</div>
<p id="section-2.3-4">Thus, all NTS messages consist of a sequence of records, each containing a Critical Bit C, the Record Type, 
the Body Length and the Record Body, see <a href="#fig-ntske-record" class="xref">Figure 6</a>. More details on record structure as well as the specific 
records used here are given in <a href="#nts-messages-4-ptp" class="xref">Section 3</a> and respective subsections there. So-called container records (short: 
container) themselves comprise a set of records in the record body that serve a specific purpose, e.g. the 
Current Parameter container.<a href="#section-2.3-4" class="pilcrow">¶</a></p>
<p id="section-2.3-5">The records contained in a message may follow in arbitrary sequence (though nothing speaks against using the 
sequence given in the record descriptions), only the End of Message record has to be the last one in the 
sequence indicating the end of the current message. Container records do not include an End of Message record.<a href="#section-2.3-5" class="pilcrow">¶</a></p>
<p id="section-2.3-6">The NTS key management for PTP is based on six new NTS messages:<a href="#section-2.3-6" class="pilcrow">¶</a></p>
<p id="section-2.3-7"></p>
<ul class="compact">
<li class="compact" id="section-2.3-8.1">PTP Key Request message (see <a href="#key-request" class="xref">Section 2.3.1</a>)<a href="#section-2.3-8.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-2.3-8.2">PTP Key Grant message (see <a href="#key-grant" class="xref">Section 2.3.2</a>)<a href="#section-2.3-8.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-2.3-8.3">PTP Refusal message (see <a href="#refusal" class="xref">Section 2.3.3</a>)<a href="#section-2.3-8.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-2.3-8.4">PTP Registration Request message (see <a href="#registration-request" class="xref">Section 2.3.4</a>)<a href="#section-2.3-8.4" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-2.3-8.5">PTP Registration Grant message (see <a href="#registration-success" class="xref">Section 2.3.5</a>)<a href="#section-2.3-8.5" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-2.3-8.6">PTP Registration Revoke message (see <a href="#registration-revoke" class="xref">Section 2.3.6</a>)<a href="#section-2.3-8.6" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.3-9">The following sections describe the principle structure of those new NTS messages for the PTP key 
management. More details especially on the records the messages are built of and their types, sizes, 
requirements and restrictions are given in <a href="#nts-records" class="xref">Section 3.2</a>.<a href="#section-2.3-9" class="pilcrow">¶</a></p>
<div id="key-request">
<section id="section-2.3.1">
          <h4 id="name-ptp-key-request-message">
<a href="#section-2.3.1" class="section-number selfRef">2.3.1. </a><a href="#name-ptp-key-request-message" class="section-name selfRef">PTP Key Request Message</a>
          </h4>
<span id="name-structure-of-a-ptp-key-requ"></span><div id="fig-key-request">
<figure id="figure-7">
            <div class="artwork art-text alignLeft" id="section-2.3.1-1.1">
<pre>
PTP Key Request
+========================================+==========================+
| Record                                 | Exemplary body contents  |
+========================================+==========================+
| NTS Next Protocol Negotiation          | PTPv2.1                  |
+----------------------------------------+--------------------------+
| NTS Message Version                    | 1.0                      |
+----------------------------------------+--------------------------+
| NTS Message Type                       | PTP Key Grant            |
+----------------------------------------+--------------------------+
| Current Parameters                     | set of Records {...}     |
+----------------------------------------+--------------------------+
| MAC Algorithm Negotiation (optional)   | {CMAC || HMAC}           |
+----------------------------------------+--------------------------+
| Requesting PTP Identity (Unicast only) | data set {...}           |
+----------------------------------------+--------------------------+
| End of Message                         |                          |
+========================================+==========================+

</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-structure-of-a-ptp-key-requ" class="selfRef">Structure of a PTP Key Request message</a>
            </figcaption></figure>
</div>
<p id="section-2.3.1-2"><a href="#fig-key-request" class="xref">Figure 7</a> shows the record structure of a PTP Key Request message. In the right column typical 
values are shown as examples. Detailed information on types, sizes etc. is given in <a href="#nts-records" class="xref">Section 3.2</a>. 
The message starts with the NTS Next Protocol Negotiation record which in this application always 
holds PTPv2.1. Currently, the following NTS Message Version record always contains 1.0. The next 
record characterizes the message type, in this case PTP Key Request. The Association Mode record 
describes the mode how the PTP instance wants to communicate: In the group-based approach the 
desired group number (plus eventually the subgroup attribute) is given. For ticket-based unicast 
communication the Association Mode contains the identification of the desired grantor, for example 
IPv4 and its IP address.<a href="#section-2.3.1-2" class="pilcrow">¶</a></p>
<p id="section-2.3.1-3">If there is an option to choose from additional MAC algorithms, then an optional record follows 
presenting the supported algorithms from which the KE server may choose. In ticket-based unicast 
mode, the Requesting PTP Identity record gives the data of the identification of the applying 
requester, for example IPv4 and its IP address.  The messages always end with an End of Message 
record.<a href="#section-2.3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-grant">
<section id="section-2.3.2">
          <h4 id="name-ptp-key-grant-message">
<a href="#section-2.3.2" class="section-number selfRef">2.3.2. </a><a href="#name-ptp-key-grant-message" class="section-name selfRef">PTP Key Grant Message</a>
          </h4>
<p id="section-2.3.2-1"><a href="#fig-key-grant" class="xref">Figure 8</a> shows the record structure of a PTP Key Grant message. In the right column typical 
values are shown as examples. Detailed information on types, sizes etc. is given in <a href="#nts-records" class="xref">Section 3.2</a>. 
The message starts with the NTS Next Protocol Negotiation record which in this application always 
holds PTPv2.1. Currently, the following NTS Message Version record always contains 1.0. The next 
record characterizes the message type, in this case PTP Key Grant.<a href="#section-2.3.2-1" class="pilcrow">¶</a></p>
<span id="name-structure-of-a-ptp-key-gran"></span><div id="fig-key-grant">
<figure id="figure-8">
            <div class="artwork art-text alignLeft" id="section-2.3.2-2.1">
<pre>
PTP Key Grant
+=======================================+===========================+
| Record                                | Exemplary body contents   |
+=======================================+===========================+
| NTS Next Protocol Negotiation         | PTPv2.1                   |
+---------------------------------------+---------------------------+
| NTS Message Version                   | 1.0                       |
+---------------------------------------+---------------------------+
| NTS Message Type                      | PTP Key Grant             |
+---------------------------------------+---------------------------+
| Current Parameters                    | set of Records {...}      |
+---------------------------------------+---------------------------+
| Next Parameters                       | set of Records {...}      |
+---------------------------------------+---------------------------+
| End of Message                        |                           |
+=======================================+===========================+

</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-structure-of-a-ptp-key-gran" class="selfRef">Structure of a PTP Key Grant message</a>
            </figcaption></figure>
</div>
<p id="section-2.3.2-3">The following Current Parameters record is a container record containing in separate records 
all the security data needed to join and communicate in the secured PTP communication during the 
current validity period. <a href="#fig-current-container-grant" class="xref">Figure 9</a> gives an example of data 
contained in that record. For more 
details on the records contained in the Current Parameters container see <a href="#current-parameters-container" class="xref">Section 3.2.3</a>.<a href="#section-2.3.2-3" class="pilcrow">¶</a></p>
<span id="name-exemplary-contents-of-a-cur"></span><div id="fig-current-container-grant">
<figure id="figure-9">
            <div class="artwork art-text alignLeft" id="section-2.3.2-4.1">
<pre>
Current Parameters Container record (PTP Key Grant)
+==============================+===================================+
| Record                       | Exemplary body contents           |
+==============================+========+==========================+
| Security Policies            |{(PTPmsg1||SPP:1)||(PTPmsg2||SPP:)}|
+------------------------------+-----------------------------------+
| Security Association         | data set for SPP:1 {...}          |
+------------------------------+-----------------------------------+
| [Security Association]       | data set for SPP:2 {...}          |
+------------------------------+-----------------------------------+
| Lifetime                     | 1560s (=0h 26min)                 |
+------------------------------+-----------------------------------+
| Time until pdate             | 0s                                |
+------------------------------+-----------------------------------+
| Grace Period (optional)      | 10 seconds                        |
+------------------------------+-----------------------------------+
| Ticket Key ID (Unicast only) | 156                               |
+------------------------------+-----------------------------------+
| Ticket (Unicast only)        | data set {...}                    |
+==============================+===================================+

</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-exemplary-contents-of-a-cur" class="selfRef">Exemplary contents of a Current Parameters                                                         Container record of a PTP Key Grant message</a>
            </figcaption></figure>
</div>
<p id="section-2.3.2-5">If the request lies inside the update interval 
(i.e. TuU = 0, compare <a href="#fig-current-container-grant" class="xref">Figure 9</a>), a Next 
Parameters Container record is appended giving all the security data needed in the upcoming 
validity period. Its structure follows the same composition as the Current Parameters record 
(in the ticked-based approach also including the Ticket Key ID record and the Ticket record). 
The messages always end with an End of Message record.<a href="#section-2.3.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="refusal">
<section id="section-2.3.3">
          <h4 id="name-ptp-refusal-message">
<a href="#section-2.3.3" class="section-number selfRef">2.3.3. </a><a href="#name-ptp-refusal-message" class="section-name selfRef">PTP Refusal Message</a>
          </h4>
<p id="section-2.3.3-1">The message starts with the NTS Next Protocol Negotiation record which in this application 
always holds PTPv2.1. Currently, the following NTS Message Version record always contains 1.0. 
The next record characterizes the message type, in this case PTP Refusal, see <a href="#fig-refusal" class="xref">Figure 10</a>. The 
Error record contains information about the reason of refusal. The messages always end with an 
End of Message record.<a href="#section-2.3.3-1" class="pilcrow">¶</a></p>
<span id="name-structure-of-a-ptp-refusal-"></span><div id="fig-refusal">
<figure id="figure-10">
            <div class="artwork art-text alignLeft" id="section-2.3.3-2.1">
<pre>
PTP Refusal
+================================+=================================+
| Record                         | Exemplary body contents         |
+================================+=================================+
| NTS Next Protocol Negotiation  | PTPv2.1                         |
+--------------------------------+---------------------------------+
| NTS Message Version            | 1.0                             |
+--------------------------------+---------------------------------+
| NTS Message Type               | PTP Refusal                     |
+--------------------------------+---------------------------------+
| Error                          | Association Port not registered |
+--------------------------------+---------------------------------+
| End of Message                 |                                 |
+================================+=================================+

</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-structure-of-a-ptp-refusal-" class="selfRef">Structure of a PTP Refusal message</a>
            </figcaption></figure>
</div>
</section>
</div>
<div id="registration-request">
<section id="section-2.3.4">
          <h4 id="name-ptp-registration-request-me">
<a href="#section-2.3.4" class="section-number selfRef">2.3.4. </a><a href="#name-ptp-registration-request-me" class="section-name selfRef">PTP Registration Request Message</a>
          </h4>
<span id="name-structure-of-a-ptp-registra"></span><div id="fig-registration-request">
<figure id="figure-11">
            <div class="artwork art-text alignLeft" id="section-2.3.4-1.1">
<pre>
PTP Registration Request
+======================================+==========================+
| Record                               | Exemplary body contents  |
+======================================+==========================+
| NTS Next Protocol Negotiation        | PTPv2.1                  |
+--------------------------------------+--------------------------+
| NTS Message Version                  | 1.0                      |
+--------------------------------------+--------------------------+
| NTS Message Type                     | PTP Registration Request |
+--------------------------------------+--------------------------+
| Requesting PTP Identity              | data set {...}           |
+--------------------------------------+--------------------------+
| AEAD Algorithm Negotiation           | {AEAD_512 || AEAD_256}   |
+--------------------------------------+--------------------------+
| MAC Algorithm Negotiation (optional) | {CMAC || HMAC}           |
+--------------------------------------+--------------------------+
| End of Message                       |                          |
+======================================+==========================+

</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-structure-of-a-ptp-registra" class="selfRef">Structure of a PTP Registration Request message</a>
            </figcaption></figure>
</div>
<p id="section-2.3.4-2">The message starts with the NTS Next Protocol Negotiation record which in this application 
always holds PTPv2.1. Currently, the following NTS Message Version record always contains 1.0. 
The next record characterizes the message type, in this case PTP Registration Request, see 
<a href="#fig-registration-request" class="xref">Figure 11</a>.<a href="#section-2.3.4-2" class="pilcrow">¶</a></p>
<p id="section-2.3.4-3">The Requesting PTP Identity record gives the addresses of the grantor requesting registration 
whereas the following AEAD Algorithm Negotiation record indicates which algorithms for encryption 
of the ticket the requester supports.<a href="#section-2.3.4-3" class="pilcrow">¶</a></p>
<p id="section-2.3.4-4">If there is an option to choose from additional MAC algorithms, then an optional record 
follows presenting all the grantor's supported algorithms from which the KE server may choose. 
The messages always end with an End of Message record.<a href="#section-2.3.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="registration-success">
<section id="section-2.3.5">
          <h4 id="name-ptp-registration-success-me">
<a href="#section-2.3.5" class="section-number selfRef">2.3.5. </a><a href="#name-ptp-registration-success-me" class="section-name selfRef">PTP Registration Success Message</a>
          </h4>
<span id="name-structure-of-a-ptp-registrat"></span><div id="fig-registration-success">
<figure id="figure-12">
            <div class="artwork art-text alignLeft" id="section-2.3.5-1.1">
<pre>
PTP Registration Success
+====================================+============================+
| Record                             | Exemplary body contents    |
+====================================+============================+
| NTS Next Protocol Negotiation      | PTPv2.1                    |
+------------------------------------+----------------------------+
| NTS Message Version                | 1.0                        |
+------------------------------------+----------------------------+
| NTS Message Type                   | PTP Registration Success   |
+------------------------------------+----------------------------+
| Current Parameters                 | set of Records {...}       |
+------------------------------------+----------------------------+
| Next Parameters                    | set of Records {...}       |
+------------------------------------+----------------------------+
| End of Message                     |                            |
+====================================+============================+

</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a>:
<a href="#name-structure-of-a-ptp-registrat" class="selfRef">Structure of a PTP Registration Success message</a>
            </figcaption></figure>
</div>
<p id="section-2.3.5-2">The message starts with the NTS Next Protocol Negotiation record which in this application 
always holds PTPv2.1. Currently, the following NTS Message Version record always contains 1.0. 
The next record characterizes the message type, in this case PTP Registration Success, see 
<a href="#fig-registration-success" class="xref">Figure 12</a>.<a href="#section-2.3.5-2" class="pilcrow">¶</a></p>
<p id="section-2.3.5-3">The following Current Parameters record is a container record containing in separate records 
all the security data needed to join and communicate in the secured PTP communication during 
the current validity period. <a href="#fig-current-container-success" class="xref">Figure 13</a> gives an example 
of data contained in that container 
as a response to PTP Registration Request. For more details on the records contained in the 
Current Parameters container see <a href="#current-parameters-container" class="xref">Section 3.2.3</a>.<a href="#section-2.3.5-3" class="pilcrow">¶</a></p>
<span id="name-exemplary-contents-of-a-curr"></span><div id="fig-current-container-success">
<figure id="figure-13">
            <div class="artwork art-text alignLeft" id="section-2.3.5-4.1">
<pre>
Current Parameters Container record (PTP Registration Success)
+==================================+========+=====================+
| Record                           | Exemplary body contents      |
+==================================+==============================+
| AEAD Algorithm Negotiation       | AEAD_CMAC_512                |
+----------------------------------+------------------------------+
| Lifetime                         | 2,460s (=0h 41min)           |
+----------------------------------+------------------------------+
| Time until pdate                 | 0s                           |
+----------------------------------+------------------------------+
| Ticket Key                       | {binary data}                |
+----------------------------------+------------------------------+
| Ticket Key ID                    | 278                          |
+----------------------------------+------------------------------+
| Grace Period (optional)          | 10 seconds                   |
+==================================+========+=====================+

</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a>:
<a href="#name-exemplary-contents-of-a-curr" class="selfRef">Exemplary contents of a Current                                                           Parameters Container record of a                 PTP Registration Success message</a>
            </figcaption></figure>
</div>
<p id="section-2.3.5-5">If the registration request lies inside the update interval a Next Parameters Container 
record is appended giving all the security data needed in the upcoming validity period. Its 
structure follows the same composition as the Current Parameters record. The messages always 
end with an End of Message record.<a href="#section-2.3.5-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="registration-revoke">
<section id="section-2.3.6">
          <h4 id="name-ptp-registration-revoke-mes">
<a href="#section-2.3.6" class="section-number selfRef">2.3.6. </a><a href="#name-ptp-registration-revoke-mes" class="section-name selfRef">PTP Registration Revoke Message</a>
          </h4>
<span id="name-structure-of-a-ptp-registrati"></span><div id="fig-registration-revoke">
<figure id="figure-14">
            <div class="artwork art-text alignLeft" id="section-2.3.6-1.1">
<pre>
PTP Registration Revoke
+===================================+=============================+
| Record                            | Exemplary body contents     |
+===================================+=============================+
| NTS Next Protocol Negotiation     | PTPv2.1                     |
+-----------------------------------+-----------------------------+
| NTS Message Version               | 1.0                         |
+-----------------------------------+-----------------------------+
| NTS Message Type                  | PTP Registration Revoke     |
+-----------------------------------+-----------------------------+
| End of Message                    |                             |
+===================================+=============================+

</pre>
</div>
<figcaption><a href="#figure-14" class="selfRef">Figure 14</a>:
<a href="#name-structure-of-a-ptp-registrati" class="selfRef">Structure of a PTP Registration Revoke message</a>
            </figcaption></figure>
</div>
<p id="section-2.3.6-2">The message starts with the NTS Next Protocol Negotiation record which in this application 
always holds PTPv2.1. Currently, the following NTS Message Version record always contains 1.0. 
The next record characterizes the message type, in this case PTP Registration Revoke, see 
<a href="#fig-registration-revoke" class="xref">Figure 14</a>. The messages always end with an End of Message record.<a href="#section-2.3.6-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="nts-messages-4-ptp">
<section id="section-3">
      <h2 id="name-nts-messages-for-ptp">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-nts-messages-for-ptp" class="section-name selfRef">NTS Messages for PTP</a>
      </h2>
<p id="section-3-1">This chapter covers the structure of the NTS messages and the details of the respective 
payload. The individual parameters are transmitted by NTS records, which are described in 
more detail in <a href="#nts-records" class="xref">Section 3.2</a>. In addition to the NTS records defined for NTP in IETF RFC8915, 
further records are required, which are listed in <a href="#tbl_nts_ke_record_registry" class="xref">Table 1</a> below and begin with Record Type 1024 
(compare IETF RFC 8915 <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, 7.6.  Network Time Security Key Establishment Record Types Registry).<a href="#section-3-1" class="pilcrow">¶</a></p>
<span id="name-nts-key-establishment-recor"></span><div id="tbl_nts_ke_record_registry">
<table class="center" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-nts-key-establishment-recor" class="selfRef">NTS Key Establishment record types registry</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">NTS Record Types</th>
            <th class="text-left" rowspan="1" colspan="1">Description</th>
            <th class="text-left" rowspan="1" colspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">0</td>
            <td class="text-left" rowspan="1" colspan="1">End of Message</td>
            <td class="text-left" rowspan="1" colspan="1">
              <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, section 4.1.1, this document, <a href="#end-of-message" class="xref">Section 3.2.4</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1</td>
            <td class="text-left" rowspan="1" colspan="1">NTS Next Protocol Negotiation</td>
            <td class="text-left" rowspan="1" colspan="1">
              <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, section 4.1.2, this document, <a href="#nts-next-protocol-nego" class="xref">Section 3.2.12</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">2</td>
            <td class="text-left" rowspan="1" colspan="1">Error</td>
            <td class="text-left" rowspan="1" colspan="1">
              <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, section 4.1.3, this document, <a href="#error" class="xref">Section 3.2.5</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">3</td>
            <td class="text-left" rowspan="1" colspan="1">Warning</td>
            <td class="text-left" rowspan="1" colspan="1">
              <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, section 4.1.4</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">4</td>
            <td class="text-left" rowspan="1" colspan="1">AEAD Algorithm Negotiation</td>
            <td class="text-left" rowspan="1" colspan="1">
              <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, section 4.1.5, this document, <a href="#aead-negotiation" class="xref">Section 3.2.1</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">5</td>
            <td class="text-left" rowspan="1" colspan="1">New Cookie for NTPv4 (not needed for PTP)</td>
            <td class="text-left" rowspan="1" colspan="1">
              <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, section 4.1.6</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">6</td>
            <td class="text-left" rowspan="1" colspan="1">NTPv4 Server Negotiation (not needed for PTP)</td>
            <td class="text-left" rowspan="1" colspan="1">
              <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, section 4.1.7</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">7</td>
            <td class="text-left" rowspan="1" colspan="1">NTPv4 Port Negotiation (not needed for PTP)</td>
            <td class="text-left" rowspan="1" colspan="1">
              <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, section 4.1.8</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">8 - 1023</td>
            <td class="text-left" rowspan="1" colspan="1">Reserved for NTP</td>
            <td class="text-left" rowspan="1" colspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1"></td>
            <td class="text-left" rowspan="1" colspan="1"></td>
            <td class="text-left" rowspan="1" colspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1024</td>
            <td class="text-left" rowspan="1" colspan="1">Association Mode</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#association-mode" class="xref">Section 3.2.2</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1025</td>
            <td class="text-left" rowspan="1" colspan="1">Current Parameters Container</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#current-parameters-container" class="xref">Section 3.2.3</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1026</td>
            <td class="text-left" rowspan="1" colspan="1">Grace Period</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#grace-period" class="xref">Section 3.2.6</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1027</td>
            <td class="text-left" rowspan="1" colspan="1">Lifetime</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#lifetime" class="xref">Section 3.2.7</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1028</td>
            <td class="text-left" rowspan="1" colspan="1">MAC Algorithm Negotiation</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#mac-algo-negotiation" class="xref">Section 3.2.8</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1029</td>
            <td class="text-left" rowspan="1" colspan="1">Next Parameters Container</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#next-parameters-container" class="xref">Section 3.2.9</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1030</td>
            <td class="text-left" rowspan="1" colspan="1">NTS Message Type</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-message-type" class="xref">Section 3.2.10</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1031</td>
            <td class="text-left" rowspan="1" colspan="1">NTS Message Version</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-message-version" class="xref">Section 3.2.11</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1032</td>
            <td class="text-left" rowspan="1" colspan="1">Requesting PTP Identity</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#requesting-ptp-identity" class="xref">Section 3.2.13</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1033</td>
            <td class="text-left" rowspan="1" colspan="1">Security Association</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#security-association" class="xref">Section 3.2.14</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1034</td>
            <td class="text-left" rowspan="1" colspan="1">Security Policies</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#security-policies" class="xref">Section 3.2.15</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1035</td>
            <td class="text-left" rowspan="1" colspan="1">Ticket</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#ticket" class="xref">Section 3.2.16</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1036</td>
            <td class="text-left" rowspan="1" colspan="1">Ticket Container</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#ticket-container" class="xref">Section 3.2.17</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1037</td>
            <td class="text-left" rowspan="1" colspan="1">Ticket Key</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#ticket-key" class="xref">Section 3.2.18</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1038</td>
            <td class="text-left" rowspan="1" colspan="1">Ticket Key ID</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#ticket-key-id" class="xref">Section 3.2.19</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1039</td>
            <td class="text-left" rowspan="1" colspan="1">Time until Update</td>
            <td class="text-left" rowspan="1" colspan="1">This document, <a href="#time-until-update" class="xref">Section 3.2.20</a> </td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1"></td>
            <td class="text-left" rowspan="1" colspan="1"></td>
            <td class="text-left" rowspan="1" colspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1040 - 16383</td>
            <td class="text-left" rowspan="1" colspan="1">Unassigned</td>
            <td class="text-left" rowspan="1" colspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">16384 - 32767</td>
            <td class="text-left" rowspan="1" colspan="1">Reserved for Private or Experimental Use</td>
            <td class="text-left" rowspan="1" colspan="1">
              <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span> </td>
          </tr>
        </tbody>
      </table>
</div>
<div id="nts-message-types">
<section id="section-3.1">
        <h3 id="name-nts-message-types">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-nts-message-types" class="section-name selfRef">NTS Message Types</a>
        </h3>
<p id="section-3.1-1">This section repeats the composition of the specific NTS messages for the PTP key 
management in overview form. The specification of the respective records from which the 
messages are constructed follows in <a href="#nts-records" class="xref">Section 3.2</a>. The reference column in the tables 
refer to the specific subsections.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">The NTS messages must contain the records given for the particular message though not 
necessarily in the same sequence indicated. Only the End of Message record is mandatory 
the final record.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3" class="keepWithNext"><strong>PTP Key Request</strong><a href="#section-3.1-3" class="pilcrow">¶</a></p>
<span id="name-record-structure-of-the-ptp"></span><div id="tbl_ptp_key_request">
<table class="center" id="table-2">
          <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-record-structure-of-the-ptp" class="selfRef">Record structure of the PTP Key Request message</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">NTS Record Name</th>
              <th class="text-left" rowspan="1" colspan="1">Comm. Type*</th>
              <th class="text-center" rowspan="1" colspan="1">Use</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Next Protocol Negotiation</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-next-protocol-nego" class="xref">Section 3.2.12</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Message Version</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-message-version" class="xref">Section 3.2.11</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Message Type</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-message-type" class="xref">Section 3.2.10</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Association Mode</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#association-mode" class="xref">Section 3.2.2</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">MAC Algorithm Negotiation</td>
              <td class="text-left" rowspan="1" colspan="1">Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">opt.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#mac-algo-negotiation" class="xref">Section 3.2.8</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Requesting PTP Identity</td>
              <td class="text-left" rowspan="1" colspan="1">Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#requesting-ptp-identity" class="xref">Section 3.2.13</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">End of Message</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#end-of-message" class="xref">Section 3.2.4</a> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-3.1-5" class="keepWithPrevious">* The Communication Type column refers to the intended use of the particular record for the respective PTP communication mode.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6" class="keepWithNext"><strong>PTP Key Grant</strong><a href="#section-3.1-6" class="pilcrow">¶</a></p>
<span id="name-record-structure-of-the-ptp-"></span><div id="tbl_ptp_key_grant">
<table class="center" id="table-3">
          <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-record-structure-of-the-ptp-" class="selfRef">Record structure of the PTP Key Grant message</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">NTS Record Name</th>
              <th class="text-left" rowspan="1" colspan="1">Comm. Type</th>
              <th class="text-center" rowspan="1" colspan="1">Use</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Next Protocol Negotiation</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-next-protocol-nego" class="xref">Section 3.2.12</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Message Version</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-message-version" class="xref">Section 3.2.11</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Message Type</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-message-type" class="xref">Section 3.2.10</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Current Parameters Container</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#current-parameters-container" class="xref">Section 3.2.3</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Next Parameters Container</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">opt. (conditional)</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#next-parameters-container" class="xref">Section 3.2.9</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">End of Message</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#end-of-message" class="xref">Section 3.2.4</a> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-3.1-8">The structure of the respective container records (Current Parameters Container and Next 
   Parameters Container) used in the PTP Key Grant message is given below:<a href="#section-3.1-8" class="pilcrow">¶</a></p>
<span id="name-record-structure-of-the-con"></span><div id="tbl_container">
<table class="center" id="table-4">
          <caption>
<a href="#table-4" class="selfRef">Table 4</a>:
<a href="#name-record-structure-of-the-con" class="selfRef">Record structure of the container records</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">NTS Record Name</th>
              <th class="text-left" rowspan="1" colspan="1">Comm. Type</th>
              <th class="text-center" rowspan="1" colspan="1">Use</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Security Policies</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#security-policies" class="xref">Section 3.2.15</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Security Association (one or more)</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#security-association" class="xref">Section 3.2.14</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Lifetime</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#lifetime" class="xref">Section 3.2.7</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Time until Update</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#time-until-update" class="xref">Section 3.2.20</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Grace Period</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">opt.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#grace-period" class="xref">Section 3.2.6</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Ticket Key ID</td>
              <td class="text-left" rowspan="1" colspan="1">Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#ticket-key-id" class="xref">Section 3.2.19</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Ticket</td>
              <td class="text-left" rowspan="1" colspan="1">Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#ticket" class="xref">Section 3.2.16</a> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-3.1-10">The encrypted Ticket Container within the Ticket record also includes a set of records listed below:<a href="#section-3.1-10" class="pilcrow">¶</a></p>
<span id="name-record-structure-of-the-enc"></span><div id="tbl_encrypted_ticket_container">
<table class="center" id="table-5">
          <caption>
<a href="#table-5" class="selfRef">Table 5</a>:
<a href="#name-record-structure-of-the-enc" class="selfRef">Record structure of the enctypted Ticket container record</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">NTS Record Name</th>
              <th class="text-left" rowspan="1" colspan="1">Comm. Type</th>
              <th class="text-center" rowspan="1" colspan="1">Use</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Requesting PTP Identity</td>
              <td class="text-left" rowspan="1" colspan="1">Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#requesting-ptp-identity" class="xref">Section 3.2.13</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Security Policies</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#security-policies" class="xref">Section 3.2.15</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Security Association (one or more)</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#security-association" class="xref">Section 3.2.14</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Lifetime</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#lifetime" class="xref">Section 3.2.7</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Time until Update</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#time-until-update" class="xref">Section 3.2.20</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Grace Period</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">opt.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#grace-period" class="xref">Section 3.2.6</a> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-3.1-12" class="keepWithNext"><strong>PTP Refusal</strong><a href="#section-3.1-12" class="pilcrow">¶</a></p>
<span id="name-record-structure-of-the-ptp-r"></span><div id="tbl_ptp_refusal">
<table class="center" id="table-6">
          <caption>
<a href="#table-6" class="selfRef">Table 6</a>:
<a href="#name-record-structure-of-the-ptp-r" class="selfRef">Record structure of the PTP Refusal message</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">NTS Record Name</th>
              <th class="text-left" rowspan="1" colspan="1">Comm. Type</th>
              <th class="text-center" rowspan="1" colspan="1">Use</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Next Protocol Negotiation</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-next-protocol-nego" class="xref">Section 3.2.12</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Message Version</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-message-version" class="xref">Section 3.2.11</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Message Type</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-message-type" class="xref">Section 3.2.10</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Error</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#error" class="xref">Section 3.2.5</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">End of Message</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#end-of-message" class="xref">Section 3.2.4</a> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-3.1-14" class="keepWithNext"><strong>PTP Registration Request</strong><a href="#section-3.1-14" class="pilcrow">¶</a></p>
<span id="name-record-structure-of-the-ptp-re"></span><div id="tbl_ptp_registration_request">
<table class="center" id="table-7">
          <caption>
<a href="#table-7" class="selfRef">Table 7</a>:
<a href="#name-record-structure-of-the-ptp-re" class="selfRef">Record structure of the PTP Registration Request message</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">NTS Record Name</th>
              <th class="text-left" rowspan="1" colspan="1">Comm. Type</th>
              <th class="text-center" rowspan="1" colspan="1">Use</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Next Protocol Negotiation</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-next-protocol-nego" class="xref">Section 3.2.12</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Message Version</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-message-version" class="xref">Section 3.2.11</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Message Type</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-message-type" class="xref">Section 3.2.10</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Requesting PTP Identity</td>
              <td class="text-left" rowspan="1" colspan="1">Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#requesting-ptp-identity" class="xref">Section 3.2.13</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">AEAD Algorithm Negotiation</td>
              <td class="text-left" rowspan="1" colspan="1">Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#aead-negotiation" class="xref">Section 3.2.1</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">MAC Algorithm Negotiation</td>
              <td class="text-left" rowspan="1" colspan="1">Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">opt.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#mac-algo-negotiation" class="xref">Section 3.2.8</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">End of Message</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#end-of-message" class="xref">Section 3.2.4</a> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-3.1-16" class="keepWithNext"><strong>PTP Registration Success</strong><a href="#section-3.1-16" class="pilcrow">¶</a></p>
<span id="name-record-structure-of-the-ptp-reg"></span><div id="tbl_ptp_registration_success">
<table class="center" id="table-8">
          <caption>
<a href="#table-8" class="selfRef">Table 8</a>:
<a href="#name-record-structure-of-the-ptp-reg" class="selfRef">Record structure of the PTP Registration Success message</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">NTS Record Name</th>
              <th class="text-left" rowspan="1" colspan="1">Comm. Type</th>
              <th class="text-center" rowspan="1" colspan="1">Use</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Next Protocol Negotiation</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-next-protocol-nego" class="xref">Section 3.2.12</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Message Version</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-message-version" class="xref">Section 3.2.11</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Message Type</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-message-type" class="xref">Section 3.2.10</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Current Parameters Container</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#current-parameters-container" class="xref">Section 3.2.3</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Next Parameters Container</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand. (conditional)</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#next-parameters-container" class="xref">Section 3.2.9</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">End of Message</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#end-of-message" class="xref">Section 3.2.4</a> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-3.1-18">The structure of the respective container records (Current Parameters Container and Next Parameters 
   Container) used in the PTP Registration Success message is given below:<a href="#section-3.1-18" class="pilcrow">¶</a></p>
<span id="name-record-structure-of-the-cont"></span><div id="tbl_container_in_success">
<table class="center" id="table-9">
          <caption>
<a href="#table-9" class="selfRef">Table 9</a>:
<a href="#name-record-structure-of-the-cont" class="selfRef">Record structure of the container records in th PTP Regsitration Success message</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">NTS Record Name</th>
              <th class="text-left" rowspan="1" colspan="1">Comm. Type</th>
              <th class="text-center" rowspan="1" colspan="1">Use</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">AEAD Algorithm Negotiation</td>
              <td class="text-left" rowspan="1" colspan="1">Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#aead-negotiation" class="xref">Section 3.2.1</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Lifetime</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#lifetime" class="xref">Section 3.2.7</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Time until Update</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#time-until-update" class="xref">Section 3.2.20</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Grace Period</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">opt.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#grace-period" class="xref">Section 3.2.6</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Ticket Key ID</td>
              <td class="text-left" rowspan="1" colspan="1">Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#ticket-key-id" class="xref">Section 3.2.19</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Ticket</td>
              <td class="text-left" rowspan="1" colspan="1">Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#ticket" class="xref">Section 3.2.16</a> </td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-3.1-20" class="keepWithNext"><strong>PTP Registration Revoke</strong><a href="#section-3.1-20" class="pilcrow">¶</a></p>
<span id="name-record-structure-of-the-ptp-regi"></span><div id="tbl_ptp_registration_revoke">
<table class="center" id="table-10">
          <caption>
<a href="#table-10" class="selfRef">Table 10</a>:
<a href="#name-record-structure-of-the-ptp-regi" class="selfRef">Record structure of the PTP Registration Revoke message</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">NTS Record Name</th>
              <th class="text-left" rowspan="1" colspan="1">Comm. Type</th>
              <th class="text-center" rowspan="1" colspan="1">Use</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Next Protocol Negotiation</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-next-protocol-nego" class="xref">Section 3.2.12</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Message Version</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-message-version" class="xref">Section 3.2.11</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NTS Message Type</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#nts-message-type" class="xref">Section 3.2.10</a> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">End of Message</td>
              <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
              <td class="text-center" rowspan="1" colspan="1">mand.</td>
              <td class="text-left" rowspan="1" colspan="1">This document, <a href="#end-of-message" class="xref">Section 3.2.4</a> </td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</div>
<div id="nts-records">
<section id="section-3.2">
        <h3 id="name-nts-records">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-nts-records" class="section-name selfRef">NTS Records</a>
        </h3>
<p id="section-3.2-1">The following subsections describe the specific NTS records used to construct the NTS 
messages for the PTP key management system in detail. They appear in alphabetic sequence 
of their individual names. See <a href="#nts-message-types" class="xref">Section 3.1</a> for the application of the records in the 
respective messages.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">Note: For easier editing of the content, most of the descriptions in the following 
subsections are written as bullet points.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">Global rules:<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2-4.1">The NTS Next Protocol Negotiation record MUST offer (at least) 
      Protocol ID 1 for "PTPv2.1" (see <a href="#nts-next-protocol-nego" class="xref">Section 3.2.12</a>).<a href="#section-3.2-4.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-4.2">The NTS Message Version record MUST be v1.0.<a href="#section-3.2-4.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-4.3">Note: Records must be used only in the mentioned messages. Not elsewhere.<a href="#section-3.2-4.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-4.4">The notational conventions of <a href="#notational-conventions" class="xref">Section 1</a> MUST be followed.<a href="#section-3.2-4.4" class="pilcrow">¶</a>
</li>
        </ul>
<div id="aead-negotiation">
<section id="section-3.2.1">
          <h4 id="name-aead-algorithm-negotiation">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-aead-algorithm-negotiation" class="section-name selfRef">AEAD Algorithm Negotiation</a>
          </h4>
<p id="section-3.2.1-1">This record is required in unicast mode and enables the negotiation of the AEAD 
 algorithm needed to encrypt and decrypt the ticket. The negotiation takes place between 
 the PTP grantor and the NTS-KE server by using the NTS registration messages. The 
 structure and properties follow the record defined in IETF RFC 8915 <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, 4.1.5.<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
<p id="section-3.2.1-2">Content and conditions:<a href="#section-3.2.1-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.1-3.1">The record has a Record Type number of 4 and the Critical Bit MAY be set.<a href="#section-3.2.1-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-3.2">
              <p id="section-3.2.1-3.2.1">The record body contains a sequence of 16-bit unsigned integers in network byte order:<a href="#section-3.2.1-3.2.1" class="pilcrow">¶</a></p>
<p id="section-3.2.1-3.2.2"><strong>Supported AEAD Algorithms = {AEAD 1 || AEAD 2 || ...}</strong><a href="#section-3.2.1-3.2.2" class="pilcrow">¶</a></p>
</li>
          </ul>
<ul class="compact">
<li class="compact" id="section-3.2.1-4.1">Each integer represents a numeric identifier of an AEAD algorithm registered by the IANA.
    (https://www.iana.org/assignments/aead-parameters/aead-parameters.xhtml)<a href="#section-3.2.1-4.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-4.2">Duplicate identifiers SHOULD NOT be included.<a href="#section-3.2.1-4.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-4.3">Grantor and NTS-KE server MUST support at least the AEAD_AES_SIV_CMAC_256 algorithm.<a href="#section-3.2.1-4.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-4.4">A list of recommended AEAD algorithms is shown in the following table.<a href="#section-3.2.1-4.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-4.5">Other AEAD algorithms MAY also be used.<a href="#section-3.2.1-4.5" class="pilcrow">¶</a>
</li>
          </ul>
<span id="name-aead-algorithms"></span><div id="tbl_aead">
<table class="center" id="table-11">
            <caption>
<a href="#table-11" class="selfRef">Table 11</a>:
<a href="#name-aead-algorithms" class="selfRef">AEAD algorithms</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Numeric ID</th>
                <th class="text-left" rowspan="1" colspan="1">AEAD Algorithm</th>
                <th class="text-left" rowspan="1" colspan="1">Use</th>
                <th class="text-center" rowspan="1" colspan="1">Key Length (Octets)</th>
                <th class="text-left" rowspan="1" colspan="1">Reference</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">15</td>
                <td class="text-left" rowspan="1" colspan="1">AEAD_AES_SIV_CMAC_256</td>
                <td class="text-left" rowspan="1" colspan="1">Mand.</td>
                <td class="text-center" rowspan="1" colspan="1">16</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC5297" class="xref">RFC5297</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">16</td>
                <td class="text-left" rowspan="1" colspan="1">AEAD_AES_SIV_CMAC_385</td>
                <td class="text-left" rowspan="1" colspan="1">Opt.</td>
                <td class="text-center" rowspan="1" colspan="1">24</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC5297" class="xref">RFC5297</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">18</td>
                <td class="text-left" rowspan="1" colspan="1">AEAD_AES_SIV_CMAC_512</td>
                <td class="text-left" rowspan="1" colspan="1">Opt.</td>
                <td class="text-center" rowspan="1" colspan="1">32</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC5297" class="xref">RFC5297</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">32 - 32767</td>
                <td class="text-left" rowspan="1" colspan="1">Unassigned</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
                <td class="text-center" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">32768 - 65535</td>
                <td class="text-left" rowspan="1" colspan="1">Reserved for Private or Experimental Use</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
                <td class="text-center" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC5116" class="xref">RFC5116</a>]</span>
</td>
              </tr>
            </tbody>
          </table>
</div>
<ul class="compact">
<li class="compact" id="section-3.2.1-6.1">In a PTP Registration Request message, this record MUST be contained exactly once.<a href="#section-3.2.1-6.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-6.2">In this message at least the AEAD_AES_SIV_CMAC_256 algorithm MUST be included.<a href="#section-3.2.1-6.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-6.3">If multiple AEAD algorithms are supported, the grantor SHOULD put the algorithm identifiers in descending priority in the record body.<a href="#section-3.2.1-6.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-6.4">
              <p id="section-3.2.1-6.4.1">Strong algorithms with higher bit lengths SHOULD have higher priority.<a href="#section-3.2.1-6.4.1" class="pilcrow">¶</a></p>
<p id="section-3.2.1-6.4.2"></p>
</li>
            <li class="compact" id="section-3.2.1-6.5">In a PTP Registration Success message, this record MUST be contained exactly once in the Current Parameters 
    Container record and exactly once in the Next Parameters Container record.<a href="#section-3.2.1-6.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-6.6">The Next Parameters Container MUST be present only during the update period.<a href="#section-3.2.1-6.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-6.7">The KE server SHOULD choose the highest priority AEAD algorithm from the request message that grantor and KE server support.<a href="#section-3.2.1-6.7" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-6.8">The KE server MAY ignore the priority and choose a different algorithm that grantor and KE server support.<a href="#section-3.2.1-6.8" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-6.9">In a PTP Registration Success message, this record MUST contain exactly one AEAD algorithm.<a href="#section-3.2.1-6.9" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-6.10">The selected algorithm MAY differ in the Current Parameters Container and Next Parameters Container records.<a href="#section-3.2.1-6.10" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="association-mode">
<section id="section-3.2.2">
          <h4 id="name-association-mode">
<a href="#section-3.2.2" class="section-number selfRef">3.2.2. </a><a href="#name-association-mode" class="section-name selfRef">Association Mode</a>
          </h4>
<p id="section-3.2.2-1">This record enables the NTS-KE server to distinguish between a group based request 
 (multicast, mixed multicast/unicast, Group-of-2) or a unicast request. A multicast 
 request carries a group number, while a unicast request contains an identification 
 attribute of the grantor (e.g. IP address or PortIdentity).<a href="#section-3.2.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2.2-2">Content and conditions:<a href="#section-3.2.2-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.2-3.1">In a PTP Key Request message, this record MUST be contained exactly once.<a href="#section-3.2.2-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-3.2">The record has a Record Type number of 1024 and the Critical Bit MAY be set.<a href="#section-3.2.2-3.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-3.3">The record body SHALL consist of two data fields:<a href="#section-3.2.2-3.3" class="pilcrow">¶</a>
</li>
          </ul>
<span id="name-association"></span><div id="tbl_assoc">
<table class="center" id="table-12">
            <caption>
<a href="#table-12" class="selfRef">Table 12</a>:
<a href="#name-association" class="selfRef">Association</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Field</th>
                <th class="text-center" rowspan="1" colspan="1">Octets</th>
                <th class="text-center" rowspan="1" colspan="1">Offset</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Association Type</td>
                <td class="text-center" rowspan="1" colspan="1">2</td>
                <td class="text-center" rowspan="1" colspan="1">0</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Association Value</td>
                <td class="text-center" rowspan="1" colspan="1">A</td>
                <td class="text-center" rowspan="1" colspan="1">2</td>
              </tr>
            </tbody>
          </table>
</div>
<ul class="compact">
<li class="compact" id="section-3.2.2-5.1">The Association Type is a 16-bit unsigned integer.<a href="#section-3.2.2-5.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-5.2">The length of Association Value depends on the value of Association Type.<a href="#section-3.2.2-5.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-5.3">All data in the fields are stored in network byte order.<a href="#section-3.2.2-5.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-5.4">The type numbers of Association Type as well as the length and content of Association 
       Value are shown in the following table and more details are given below.<a href="#section-3.2.2-5.4" class="pilcrow">¶</a>
</li>
          </ul>
<span id="name-association-types"></span><div id="tbl_assoc_types">
<table class="center" id="table-13">
            <caption>
<a href="#table-13" class="selfRef">Table 13</a>:
<a href="#name-association-types" class="selfRef">Association Types</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Description</th>
                <th class="text-center" rowspan="1" colspan="1">Assoc. Type Number</th>
                <th class="text-left" rowspan="1" colspan="1">Association Mode</th>
                <th class="text-left" rowspan="1" colspan="1">Association Value Content</th>
                <th class="text-center" rowspan="1" colspan="1">Assoc. Value Octets</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Group</td>
                <td class="text-center" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast*</td>
                <td class="text-left" rowspan="1" colspan="1">Group Number</td>
                <td class="text-center" rowspan="1" colspan="1">5</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">IPv4</td>
                <td class="text-center" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Unicast</td>
                <td class="text-left" rowspan="1" colspan="1">IPv4 address of the target port</td>
                <td class="text-center" rowspan="1" colspan="1">4</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">IPv6</td>
                <td class="text-center" rowspan="1" colspan="1">2</td>
                <td class="text-left" rowspan="1" colspan="1">Unicast</td>
                <td class="text-left" rowspan="1" colspan="1">IPv6 address of the target port</td>
                <td class="text-center" rowspan="1" colspan="1">16</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">802.3</td>
                <td class="text-center" rowspan="1" colspan="1">3</td>
                <td class="text-left" rowspan="1" colspan="1">Unicast</td>
                <td class="text-left" rowspan="1" colspan="1">MAC address of the target port</td>
                <td class="text-center" rowspan="1" colspan="1">6</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">PortIdentity</td>
                <td class="text-center" rowspan="1" colspan="1">4</td>
                <td class="text-left" rowspan="1" colspan="1">Unicast</td>
                <td class="text-left" rowspan="1" colspan="1">PortIdentity of the target PTP entity</td>
                <td class="text-center" rowspan="1" colspan="1">10</td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-3.2.2-7" class="keepWithPrevious">Unicast*: predefined groups of two (Group-of-2, Go2, see Group entry below)<a href="#section-3.2.2-7" class="pilcrow">¶</a></p>
<p id="section-3.2.2-8">Group:<a href="#section-3.2.2-8" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.2-9.1">This association type allows a PTP instance to join a PTP multicast group.<a href="#section-3.2.2-9.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-9.2">A group is identified by the PTP domain, the PTP profile (sdoId) and a sub-group attribute (see table below).<a href="#section-3.2.2-9.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-9.3">The PTP domainNumber is an 8-bit unsigned integer in the closed range 0 to 255.<a href="#section-3.2.2-9.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-9.4">
              <p id="section-3.2.2-9.4.1">The sdoId of a PTP domain is a 12-bit unsigned integer in the closed range 0 to 4095:<a href="#section-3.2.2-9.4.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.2-9.4.2.1">The most significant 4 bits are named the majorSdoId.<a href="#section-3.2.2-9.4.2.1" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.2.2-9.4.2.2">The least significant 8 bits are named the minorSdoId.<a href="#section-3.2.2-9.4.2.2" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.2.2-9.4.2.3">Reference: IEEE Std 1588-2019, 7.1.1<a href="#section-3.2.2-9.4.2.3" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-3.2.2-9.4.3"><strong>sdoId = {majorSdoId || minorSdoId}</strong><a href="#section-3.2.2-9.4.3" class="pilcrow">¶</a></p>
</li>
          </ul>
<ul class="compact">
<li class="compact" id="section-3.2.2-10.1">The subGroup is 16-bit unsigned integer, which allows the division of a PTP multicast network into separate groups, each with individual security parameters.<a href="#section-3.2.2-10.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-10.2">This also allows manually configured unicast connections (Group-of-2), which can include transparent clocks as well.<a href="#section-3.2.2-10.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-10.3">The subGroup number is defined manually by the administrator.<a href="#section-3.2.2-10.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-10.4">Access to the groups is controlled by authorization procedures of the PTP devices (see <a href="#upfront-authorization" class="xref">Section 2.2.5.4</a>).<a href="#section-3.2.2-10.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-10.5">
              <p id="section-3.2.2-10.5.1">If no subgroups are required (=multicast mode), this attribute MUST contain the value zero.<a href="#section-3.2.2-10.5.1" class="pilcrow">¶</a></p>
<p id="section-3.2.2-10.5.2"></p>
</li>
            <li class="compact" id="section-3.2.2-10.6">
              <p id="section-3.2.2-10.6.1">The group number is eventually formed by concatenation of the following values:<a href="#section-3.2.2-10.6.1" class="pilcrow">¶</a></p>
<p id="section-3.2.2-10.6.2"><strong>group number = {domainNumber || 4 bit zero padding || sdoId || subGroup}</strong><a href="#section-3.2.2-10.6.2" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-3.2.2-11" class="keepWithNext">This is equvalent to:<a href="#section-3.2.2-11" class="pilcrow">¶</a></p>
<span id="name-group-association"></span><div id="tbl_group">
<table class="center" id="table-14">
            <caption>
<a href="#table-14" class="selfRef">Table 14</a>:
<a href="#name-group-association" class="selfRef">Group Association</a>
            </caption>
<thead>
              <tr>
                <th class="text-center" rowspan="1" colspan="1">Bits 7 - 4</th>
                <th class="text-center" rowspan="1" colspan="1">Bits 3 - 0</th>
                <th class="text-center" rowspan="1" colspan="1">Octets</th>
                <th class="text-center" rowspan="1" colspan="1">Offset</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-center" rowspan="1" colspan="1">domainNumber (high)</td>
                <td class="text-center" rowspan="1" colspan="1">domainNumber (low)</td>
                <td class="text-center" rowspan="1" colspan="1">1</td>
                <td class="text-center" rowspan="1" colspan="1">0</td>
              </tr>
              <tr>
                <td class="text-center" rowspan="1" colspan="1">zero padding</td>
                <td class="text-center" rowspan="1" colspan="1">majorSdoId</td>
                <td class="text-center" rowspan="1" colspan="1">1</td>
                <td class="text-center" rowspan="1" colspan="1">1</td>
              </tr>
              <tr>
                <td class="text-center" rowspan="1" colspan="1">minorSdoId (high)</td>
                <td class="text-center" rowspan="1" colspan="1">minorSdoId (low)</td>
                <td class="text-center" rowspan="1" colspan="1">1</td>
                <td class="text-center" rowspan="1" colspan="1">2</td>
              </tr>
              <tr>
                <td class="text-center" rowspan="1" colspan="1">subgroup (high)</td>
                <td class="text-center" rowspan="1" colspan="1">subGroup (low)</td>
                <td class="text-center" rowspan="1" colspan="1">2</td>
                <td class="text-center" rowspan="1" colspan="1">4</td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-3.2.2-13">IPv4:<a href="#section-3.2.2-13" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.2-14.1">This Association Type allows a requester to establish a PTP unicast connection to the desired grantor.<a href="#section-3.2.2-14.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-14.2">The Association Value contains the IPv4 address of the target PTP entity.<a href="#section-3.2.2-14.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-14.3">The total length is 4 octets.<a href="#section-3.2.2-14.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.2-15">IPv6:<a href="#section-3.2.2-15" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.2-16.1">This Association Type allows a requester to establish a PTP unicast connection to the desired grantor.<a href="#section-3.2.2-16.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-16.2">The Association Value contains the IPv6 address of the target PTP entity.<a href="#section-3.2.2-16.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-16.3">The total length is 16 octets.<a href="#section-3.2.2-16.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.2-17">802.3:<a href="#section-3.2.2-17" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.2-18.1">This Association Type allows a requester to establish a PTP unicast connection to the desired grantor.<a href="#section-3.2.2-18.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-18.2">The Association Value contains the MAC address of the Ethernet port of the target PTP entity.<a href="#section-3.2.2-18.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-18.3">The total length is 6 octets.<a href="#section-3.2.2-18.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-18.4">This method supports the 802.3 mode in PTP, where no UDP/IP stack is used.<a href="#section-3.2.2-18.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.2-19">PortIdentity:<a href="#section-3.2.2-19" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.2-20.1">This Association Type allows a requester to establish a PTP unicast connection to the desired grantor.<a href="#section-3.2.2-20.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-20.2">The Association Value contains the PortIdentity of the target PTP entity.<a href="#section-3.2.2-20.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-20.3">
              <p id="section-3.2.2-20.3.1">The total length is 10 octets.<a href="#section-3.2.2-20.3.1" class="pilcrow">¶</a></p>
<p id="section-3.2.2-20.3.2"></p>
</li>
            <li class="compact" id="section-3.2.2-20.4">
              <p id="section-3.2.2-20.4.1">The PortIdentity consists of the attributes clockIdentity and portNumber:<a href="#section-3.2.2-20.4.1" class="pilcrow">¶</a></p>
<p id="section-3.2.2-20.4.2"><strong>PortIdentity = {clockIdentity || portNumber}</strong><a href="#section-3.2.2-20.4.2" class="pilcrow">¶</a></p>
</li>
          </ul>
<ul class="compact">
<li class="compact" id="section-3.2.2-21.1">The clockIdentity is an 8 octet array and the portNumber is a 16-bit unsigned integer.<a href="#section-3.2.2-21.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.2-21.2">Source: IEEE Std 1588-2019, 5.3.5, 7.5<a href="#section-3.2.2-21.2" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="current-parameters-container">
<section id="section-3.2.3">
          <h4 id="name-current-parameters-containe">
<a href="#section-3.2.3" class="section-number selfRef">3.2.3. </a><a href="#name-current-parameters-containe" class="section-name selfRef">Current Parameters Container</a>
          </h4>
<p id="section-3.2.3-1">This record is a simple container that can carry an arbitrary number of NTS 
 records. It holds all security parameters relevant for the current validity period. 
 The content as well as further conditions are defined by the respective NTS messages. 
 The order of the included records is arbitrary and the parsing rules are so far 
 identical with the NTS message. One exception: An End of Message record SHOULD NOT 
 be present and MUST be ignored. When the parser reaches the end of the Record Body 
 quantified by the Body Length, all embedded records have been processed.<a href="#section-3.2.3-1" class="pilcrow">¶</a></p>
<p id="section-3.2.3-2">Content and conditions:<a href="#section-3.2.3-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.3-3.1">The record has a Record Type number of 1025 and the Critical Bit MAY be set.<a href="#section-3.2.3-3.1" class="pilcrow">¶</a>
</li>
          </ul>
<ul class="compact">
<li class="compact" id="section-3.2.3-4.1">In a PTP Key Grant message, this record MUST be contained exactly once.<a href="#section-3.2.3-4.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.3-4.2">The record body is defined as a set of records and MAY contain the following records:<a href="#section-3.2.3-4.2" class="pilcrow">¶</a>
</li>
          </ul>
<span id="name-current-parameters-container"></span><div id="tbl_curr_param_grant">
<table class="center" id="table-15">
            <caption>
<a href="#table-15" class="selfRef">Table 15</a>:
<a href="#name-current-parameters-container" class="selfRef">Current Parameters Container for PTP Key Grant message</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">NTS Record Name</th>
                <th class="text-left" rowspan="1" colspan="1">Comunication Type</th>
                <th class="text-left" rowspan="1" colspan="1">Use</th>
                <th class="text-left" rowspan="1" colspan="1">Reference</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Security Policies</td>
                <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
                <td class="text-left" rowspan="1" colspan="1">Mand.</td>
                <td class="text-left" rowspan="1" colspan="1">This document, <a href="#security-policies" class="xref">Section 3.2.15</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Security Associations (one or more)</td>
                <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
                <td class="text-left" rowspan="1" colspan="1">Mand.</td>
                <td class="text-left" rowspan="1" colspan="1">This document, <a href="#security-association" class="xref">Section 3.2.14</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Lifetime</td>
                <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
                <td class="text-left" rowspan="1" colspan="1">Mand.</td>
                <td class="text-left" rowspan="1" colspan="1">This document, <a href="#lifetime" class="xref">Section 3.2.7</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Time until Update</td>
                <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
                <td class="text-left" rowspan="1" colspan="1">Mand.</td>
                <td class="text-left" rowspan="1" colspan="1">This document, <a href="#time-until-update" class="xref">Section 3.2.20</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Grace Period</td>
                <td class="text-left" rowspan="1" colspan="1">Multicast / Unicast</td>
                <td class="text-left" rowspan="1" colspan="1">Opt.</td>
                <td class="text-left" rowspan="1" colspan="1">This document, <a href="#grace-period" class="xref">Section 3.2.6</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Ticket Key ID</td>
                <td class="text-left" rowspan="1" colspan="1">Unicast</td>
                <td class="text-left" rowspan="1" colspan="1">Mand.</td>
                <td class="text-left" rowspan="1" colspan="1">This document, <a href="#ticket-key-id" class="xref">Section 3.2.19</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Ticket</td>
                <td class="text-left" rowspan="1" colspan="1">Unicast</td>
                <td class="text-left" rowspan="1" colspan="1">Mand.</td>
                <td class="text-left" rowspan="1" colspan="1">This document, <a href="#ticket" class="xref">Section 3.2.16</a>
</td>
              </tr>
            </tbody>
          </table>
</div>
<ul class="compact">
<li class="compact" id="section-3.2.3-6.1">The records Security Policies, Lifetime and Time until Update MUST be contained exactly once.<a href="#section-3.2.3-6.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.3-6.2">The number of the Security Association records depends on the content of the Security Policies record (see <a href="#security-policies" class="xref">Section 3.2.15</a>).<a href="#section-3.2.3-6.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.3-6.3">At least one Security Association record MUST be included.<a href="#section-3.2.3-6.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.3-6.4">The Grace Period record is optional and MAY be absent.<a href="#section-3.2.3-6.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.3-6.5">If it is present, it MUST be included exactly once.<a href="#section-3.2.3-6.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.3-6.6">In order to establish a unicast connection with the PTP Key Grant message, the records Ticket Key ID and Ticket MUST be contained exactly once.<a href="#section-3.2.3-6.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.3-6.7">If the requester wants to join a multicast group, the records Ticket Key ID and Ticket MUST NOT be included.<a href="#section-3.2.3-6.7" class="pilcrow">¶</a>
</li>
          </ul>
<ul class="compact">
<li class="compact" id="section-3.2.3-7.1">In a PTP Registration Success message, the Current Parameters Container record MUST be contained exactly once.<a href="#section-3.2.3-7.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.3-7.2">The record body MAY contain the following records:<a href="#section-3.2.3-7.2" class="pilcrow">¶</a>
</li>
          </ul>
<span id="name-current-parameters-container-"></span><div id="tbl_curr_param_success">
<table class="center" id="table-16">
            <caption>
<a href="#table-16" class="selfRef">Table 16</a>:
<a href="#name-current-parameters-container-" class="selfRef">Current Parameters Container for PTP Registration Success Message</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">NTS Record Name</th>
                <th class="text-left" rowspan="1" colspan="1">Use</th>
                <th class="text-left" rowspan="1" colspan="1">Reference</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">AEAD Algorithm Negotiation</td>
                <td class="text-left" rowspan="1" colspan="1">Mand.</td>
                <td class="text-left" rowspan="1" colspan="1">This document, <a href="#aead-negotiation" class="xref">Section 3.2.1</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Lifetime</td>
                <td class="text-left" rowspan="1" colspan="1">Mand.</td>
                <td class="text-left" rowspan="1" colspan="1">This document, <a href="#lifetime" class="xref">Section 3.2.7</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Time until Update</td>
                <td class="text-left" rowspan="1" colspan="1">Mand.</td>
                <td class="text-left" rowspan="1" colspan="1">This document, <a href="#time-until-update" class="xref">Section 3.2.20</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Grace Period</td>
                <td class="text-left" rowspan="1" colspan="1">Opt.</td>
                <td class="text-left" rowspan="1" colspan="1">This document, <a href="#grace-period" class="xref">Section 3.2.6</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Ticket Key ID</td>
                <td class="text-left" rowspan="1" colspan="1">Mand.</td>
                <td class="text-left" rowspan="1" colspan="1">This document, <a href="#ticket-key-id" class="xref">Section 3.2.19</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Ticket</td>
                <td class="text-left" rowspan="1" colspan="1">Mand.</td>
                <td class="text-left" rowspan="1" colspan="1">This document, <a href="#ticket" class="xref">Section 3.2.16</a>
</td>
              </tr>
            </tbody>
          </table>
</div>
<ul class="compact">
<li class="compact" id="section-3.2.3-9.1">The records AEAD Algorithm Negotiation, Lifetime, Time until Update, Ticket Key ID and Ticket Key MUST be contained exactly once.<a href="#section-3.2.3-9.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.3-9.2">The Grace Period record is optional and MAY be absent.<a href="#section-3.2.3-9.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.3-9.3">If it is present, it MUST be included exactly once.<a href="#section-3.2.3-9.3" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="end-of-message">
<section id="section-3.2.4">
          <h4 id="name-end-of-message">
<a href="#section-3.2.4" class="section-number selfRef">3.2.4. </a><a href="#name-end-of-message" class="section-name selfRef">End of Message</a>
          </h4>
<p id="section-3.2.4-1">The End of Message record is defined in IETF RFC8915 <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, 4:<a href="#section-3.2.4-1" class="pilcrow">¶</a></p>
<ul class="ulEmpty compact">
<li class="ulEmpty compact" id="section-3.2.4-2.1">
              <em>"The record sequence in an NTS message SHALL be terminated by an "End of 
          Message" record. The requirement that all NTS-KE messages be terminated by an End 
          of Message record makes them self-delimiting."</em><a href="#section-3.2.4-2.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.4-3">Content and conditions:<a href="#section-3.2.4-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.4-4.1">The record has a Record Type number of 0 and a zero-length body.<a href="#section-3.2.4-4.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.4-4.2">The Critical Bit MUST be set.<a href="#section-3.2.4-4.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.4-4.3">This record MUST occur exactly once as the final record of every NTS request and response message.<a href="#section-3.2.4-4.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.4-4.4">This record SHOULD NOT be included in the container records and MUST be ignored if present.<a href="#section-3.2.4-4.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.4-4.5">See also: IETF RFC8915, 4.1.1<a href="#section-3.2.4-4.5" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="error">
<section id="section-3.2.5">
          <h4 id="name-error">
<a href="#section-3.2.5" class="section-number selfRef">3.2.5. </a><a href="#name-error" class="section-name selfRef">Error</a>
          </h4>
<p id="section-3.2.5-1">The Error record is defined in IETF RFC8915 <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, 4.1.3. In addition to the 
Error codes 0 to 2 specified there the following Error codes 3 to 4 are defined:<a href="#section-3.2.5-1" class="pilcrow">¶</a></p>
<span id="name-error-codes"></span><div id="tbl_error">
<table class="center" id="table-17">
            <caption>
<a href="#table-17" class="selfRef">Table 17</a>:
<a href="#name-error-codes" class="selfRef">Error Codes</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Error Code</th>
                <th class="text-left" rowspan="1" colspan="1">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">Unrecognized Critical Record</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Bad Request</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">2</td>
                <td class="text-left" rowspan="1" colspan="1">Internal Server Error</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">3</td>
                <td class="text-left" rowspan="1" colspan="1">Requester not Authorized</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">4</td>
                <td class="text-left" rowspan="1" colspan="1">Grantor not Registered</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">5 - 32767</td>
                <td class="text-left" rowspan="1" colspan="1">Unassigned</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">32768 - 65535</td>
                <td class="text-left" rowspan="1" colspan="1">Reserved for Private or Experimental Use</td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-3.2.5-3">Content and conditions:<a href="#section-3.2.5-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.5-4.1">The record has a Record Type number of 2 and body length of two octets consisting 
       of an unsigned 16-bit integer in network byte order, denoting an error code.<a href="#section-3.2.5-4.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.5-4.2">
              <p id="section-3.2.5-4.2.1">The Critical Bit MUST be set.<a href="#section-3.2.5-4.2.1" class="pilcrow">¶</a></p>
<p id="section-3.2.5-4.2.2"></p>
</li>
            <li class="compact" id="section-3.2.5-4.3">The Error code 3 "Requester not Authorized" is sent by the KE server if the requester 
       is not authorized to join the desired multicast group.<a href="#section-3.2.5-4.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.5-4.4">
              <p id="section-3.2.5-4.4.1">This Error code MUST NOT be included as a response to PTP Registration Request message.<a href="#section-3.2.5-4.4.1" class="pilcrow">¶</a></p>
<p id="section-3.2.5-4.4.2"></p>
</li>
            <li class="compact" id="section-3.2.5-4.5">The Error code 4 "Grantor not Registered" is sent by the KE server when the requester 
       wants to establish a unicast connection to a grantor that is not registered with the KE server.<a href="#section-3.2.5-4.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.5-4.6">This Error code MUST NOT be included as a response to a PTP Key Request message.<a href="#section-3.2.5-4.6" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="grace-period">
<section id="section-3.2.6">
          <h4 id="name-grace-period">
<a href="#section-3.2.6" class="section-number selfRef">3.2.6. </a><a href="#name-grace-period" class="section-name selfRef">Grace Period</a>
          </h4>
<p id="section-3.2.6-1">The Grace Period determines the time period in which expired security 
parameters may still be accepted. It allows the verification of PTP messages, 
which have been secured with the previous key at the rotation time of the 
security parameters.<a href="#section-3.2.6-1" class="pilcrow">¶</a></p>
<p id="section-3.2.6-2">Content and conditions:<a href="#section-3.2.6-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.6-3.1">The record has a Record Type number of 1026 and the Critical Bit SHOULD NOT be set.<a href="#section-3.2.6-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.6-3.2">The record body consists of a 16-bit unsigned integer in network byte order.<a href="#section-3.2.6-3.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.6-3.3">This value contains the transition time in seconds in which an expired key MAY still be accepted.<a href="#section-3.2.6-3.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.6-3.4">A time of zero seconds is valid.<a href="#section-3.2.6-3.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.6-3.5">
              <p id="section-3.2.6-3.5.1">If this optional record is absent, a default time of zero seconds is used unless a PTP 
       profile defines something else.<a href="#section-3.2.6-3.5.1" class="pilcrow">¶</a></p>
<p id="section-3.2.6-3.5.2"></p>
</li>
            <li class="compact" id="section-3.2.6-3.6">The Grace Period record MAY only appear as part of a PTP Key Grant or PTP Registration Success message.<a href="#section-3.2.6-3.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.6-3.7">In a PTP Key Grant message, the Grace Period MAY be in the Current Parameters Container 
       and Next Parameters Container records, as well as a part of the encrypted Ticket Container (if present).<a href="#section-3.2.6-3.7" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.6-3.8">
              <p id="section-3.2.6-3.8.1">The Grace Period record MUST NOT appear more than once in each container or ticket.<a href="#section-3.2.6-3.8.1" class="pilcrow">¶</a></p>
<p id="section-3.2.6-3.8.2"></p>
</li>
            <li class="compact" id="section-3.2.6-3.9">In a PTP Registration Success message, the Grace Period record MAY be present in the Current 
       Parameters Container record as well as in the Next Parameters Container record.<a href="#section-3.2.6-3.9" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.6-3.10">
              <p id="section-3.2.6-3.10.1">The Grace Period MUST NOT be included more than once in each of those container records.<a href="#section-3.2.6-3.10.1" class="pilcrow">¶</a></p>
<p id="section-3.2.6-3.10.2"></p>
</li>
            <li class="compact" id="section-3.2.6-3.11">The Next Parameters Container MUST be present only during the update period.<a href="#section-3.2.6-3.11" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="lifetime">
<section id="section-3.2.7">
          <h4 id="name-lifetime">
<a href="#section-3.2.7" class="section-number selfRef">3.2.7. </a><a href="#name-lifetime" class="section-name selfRef">Lifetime</a>
          </h4>
<p id="section-3.2.7-1">This record specifies the lifetime of a defined set of parameters. The 
value contained in this record is counted down by the receiver of the NTS 
message every second. When the value reaches zero, the parameters associated 
with this record are considered to have expired.<a href="#section-3.2.7-1" class="pilcrow">¶</a></p>
<p id="section-3.2.7-2">Content and conditions:<a href="#section-3.2.7-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.7-3.1">The record has a Record Type number of 1027 and the Critical Bit MAY be set.<a href="#section-3.2.7-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.7-3.2">
              <p id="section-3.2.7-3.2.1">The record body consists of a 32-bit unsigned integer in network byte order, denoting the 
       expiration time of specific parameters in seconds.<a href="#section-3.2.7-3.2.1" class="pilcrow">¶</a></p>
<p id="section-3.2.7-3.2.2"></p>
</li>
            <li class="compact" id="section-3.2.7-3.3">The maximum value is set by the NTS-KE administrator or the PTP profile.<a href="#section-3.2.7-3.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.7-3.4">
              <p id="section-3.2.7-3.4.1">In conjunction with a PTP unicast establishment, the Lifetime of the unicast key, the ticket 
       key and registration lifetime of a grantor with the KE server MUST be identical.<a href="#section-3.2.7-3.4.1" class="pilcrow">¶</a></p>
<p id="section-3.2.7-3.4.2"></p>
</li>
            <li class="compact" id="section-3.2.7-3.5">The Lifetime record MAY only appear as part of a PTP Key Grant or PTP Registration Success message.<a href="#section-3.2.7-3.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.7-3.6">In both messages, the Next Parameters Container MUST be present only during the update period.<a href="#section-3.2.7-3.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.7-3.7">In a PTP Key Grant message, the Lifetime record MUST be included exactly once in the Current 
       Parameters Container and Next Parameters Container records, as well as in the encrypted Ticket Container 
   (only present in a unicast PTP Key Grant message).<a href="#section-3.2.7-3.7" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.7-3.8">In a PTP Registration Success message, the Lifetime MUST be included exactly once in both records, 
       Current Parameters Container and Next Parameters Container.<a href="#section-3.2.7-3.8" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.7-4">Notes:<a href="#section-3.2.7-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.7-5.1">Requests during the currently running lifetime will receive respectively adapted count values.<a href="#section-3.2.7-5.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.7-5.2">The lifetime is a counter that is decremented and marks the expiration of defined parameters 
       when the value reaches zero.<a href="#section-3.2.7-5.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.7-5.3">The realization is implementation-dependent and can be done for example by a secondly decrementing.<a href="#section-3.2.7-5.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.7-5.4">It must be ensured that jumps (e.g. by adjustment of the local clock) are avoided.<a href="#section-3.2.7-5.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.7-5.5">The use of a monotonic clock is suitable for this.<a href="#section-3.2.7-5.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.7-5.6">Furthermore, it is to be considered which consequences the drifting of the local clock can cause.<a href="#section-3.2.7-5.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.7-5.7">With sufficiently small values of the lifetime (&lt;12 hours), this factor should be negligible.<a href="#section-3.2.7-5.7" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="mac-algo-negotiation">
<section id="section-3.2.8">
          <h4 id="name-mac-algorithm-negotiation">
<a href="#section-3.2.8" class="section-number selfRef">3.2.8. </a><a href="#name-mac-algorithm-negotiation" class="section-name selfRef">MAC Algorithm Negotiation</a>
          </h4>
<p id="section-3.2.8-1">This optional record allows free negotiation of the MAC algorithm needed 
to generate the ICV. Since multicast groups are restricted to a shared 
algorithm, this record is only used in unicast mode.<a href="#section-3.2.8-1" class="pilcrow">¶</a></p>
<p id="section-3.2.8-2">Content and conditions:<a href="#section-3.2.8-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.8-3.1">The record has a Record Type number of 1028 and the Critical Bit MAY be set.<a href="#section-3.2.8-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-3.2">
              <p id="section-3.2.8-3.2.1">The record body contains a sequence of 16-bit unsigned integers in network byte order.<a href="#section-3.2.8-3.2.1" class="pilcrow">¶</a></p>
<p id="section-3.2.8-3.2.2"><strong>Supported MAC Algorithms = {MAC 1 || MAC 2 || ...}</strong><a href="#section-3.2.8-3.2.2" class="pilcrow">¶</a></p>
<p id="section-3.2.8-3.2.3"></p>
</li>
            <li class="compact" id="section-3.2.8-3.3">Each integer represents a MAC Algorithm Type defined in the table below.<a href="#section-3.2.8-3.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-3.4">Duplicate identifiers SHOULD NOT be included.<a href="#section-3.2.8-3.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-3.5">Each PTP node MUST support at least the HMAC-SHA256-128 algorithm.<a href="#section-3.2.8-3.5" class="pilcrow">¶</a>
</li>
          </ul>
<span id="name-mac-algorithms"></span><div id="tbl_mac_algo">
<table class="center" id="table-18">
            <caption>
<a href="#table-18" class="selfRef">Table 18</a>:
<a href="#name-mac-algorithms" class="selfRef">MAC Algorithms</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">MAC Algorithm Types</th>
                <th class="text-left" rowspan="1" colspan="1">MAC Algorithm</th>
                <th class="text-center" rowspan="1" colspan="1">ICV Length (octets)</th>
                <th class="text-left" rowspan="1" colspan="1">Reference</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">HMAC-SHA256-128</td>
                <td class="text-center" rowspan="1" colspan="1">16</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#FIPS-PUB-198-1" class="xref">FIPS-PUB-198-1</a>]</span>, <span>[<a href="#IEEE1588-2019" class="xref">IEEE1588-2019</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">HMAC-SHA256</td>
                <td class="text-center" rowspan="1" colspan="1">32</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#FIPS-PUB-198-1" class="xref">FIPS-PUB-198-1</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">2</td>
                <td class="text-left" rowspan="1" colspan="1">AES-CMAC</td>
                <td class="text-center" rowspan="1" colspan="1">16</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC4493" class="xref">RFC4493</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">3</td>
                <td class="text-left" rowspan="1" colspan="1">AES-GMAC-128</td>
                <td class="text-center" rowspan="1" colspan="1">16</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC4543" class="xref">RFC4543</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">4</td>
                <td class="text-left" rowspan="1" colspan="1">AES-GMAC-192</td>
                <td class="text-center" rowspan="1" colspan="1">24</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC4543" class="xref">RFC4543</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">5</td>
                <td class="text-left" rowspan="1" colspan="1">AES-GMAC-256</td>
                <td class="text-center" rowspan="1" colspan="1">32</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC4543" class="xref">RFC4543</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">6 - 32767</td>
                <td class="text-left" rowspan="1" colspan="1">Unassigned </td>
                <td class="text-center" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">32768 - 65535</td>
                <td class="text-left" rowspan="1" colspan="1">Reserved for Private or Experimental Use</td>
                <td class="text-center" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-3.2.8-5">In PTP multicast mode:<a href="#section-3.2.8-5" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.8-6.1">This record is not necessary, since all PTP nodes in a multicast group MUST support the same MAC algorithm.<a href="#section-3.2.8-6.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-6.2">Therefore, this record SHOULD NOT be included in a PTP Key Request massage and the NTS-KE server MUST ignore this record.<a href="#section-3.2.8-6.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-6.3">Unless this is specified by a PTP profile, the HMAC-SHA256-128 algorithm SHALL be used by default.<a href="#section-3.2.8-6.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.8-7">In PTP unicast mode:<a href="#section-3.2.8-7" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.8-8.1">In a PTP Key Request message, this record MAY be contained if the requester wants a unicast connection to a specific grantor.<a href="#section-3.2.8-8.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-8.2">The requester MUST NOT send more than one record of this type.<a href="#section-3.2.8-8.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-8.3">If this record is present, at least the HMAC-SHA256-128 MAC algorithm MUST be included.<a href="#section-3.2.8-8.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-8.4">If multiple MAC algorithms are supported, the requester SHOULD put the desired algorithm identifiers in descending priority in the record body.<a href="#section-3.2.8-8.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-8.5">Strong algorithms with higher bit lengths SHOULD have higher priority.<a href="#section-3.2.8-8.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-8.6">
              <p id="section-3.2.8-8.6.1">The default MAC algorithm (HMAC-SHA256-128) MAY be omitted in the record.<a href="#section-3.2.8-8.6.1" class="pilcrow">¶</a></p>
<p id="section-3.2.8-8.6.2"></p>
</li>
            <li class="compact" id="section-3.2.8-8.7">In a PTP Registration Request message, this record MUST be present and the grantor MUST include all supported MAC algorithms in any order.<a href="#section-3.2.8-8.7" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-8.8">The KE server selects the algorithm after receiving a PTP Key Request message in unicast mode.<a href="#section-3.2.8-8.8" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-8.9">The KE server SHOULD choose the highest priority MAC algorithm from the request message that grantor and requester support.<a href="#section-3.2.8-8.9" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-8.10">The KE server MAY ignore the priority and choose a different algorithm that grantor and requester support.<a href="#section-3.2.8-8.10" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-8.11">If the MAC Algorithm Negotiation record is not within the PTP Key Request message, the KE server MUST choose the default algorithm HMAC-SHA256-128.<a href="#section-3.2.8-8.11" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.8-9">Initialization Vector (IV)<a href="#section-3.2.8-9" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.8-10.1">If GMAC is to be supported as a MAC algorithm, then an Initialization Vector (IV) must be constructed according to IETF RFC 4543, 3.1.<a href="#section-3.2.8-10.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-10.2">Therefore, the IV MUST be eight octets long and MUST NOT be repeated for a specific key.<a href="#section-3.2.8-10.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.8-10.3">This can be achieved, for example, by using a counter.<a href="#section-3.2.8-10.3" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="next-parameters-container">
<section id="section-3.2.9">
          <h4 id="name-next-parameters-container">
<a href="#section-3.2.9" class="section-number selfRef">3.2.9. </a><a href="#name-next-parameters-container" class="section-name selfRef">Next Parameters Container</a>
          </h4>
<p id="section-3.2.9-1">This record is a simple container that can carry an arbitrary number of 
NTS records. It holds all security parameters relevant for the upcoming 
validity period. The content as well as further conditions are defined by 
the respective NTS messages. The order of the included records is arbitrary 
and the parsing rules are so far identical with the NTS message. One 
exception: An End of Message record SHOULD NOT be present and MUST be 
ignored. When the parser reaches the end of the Record Body quantified 
by the Body Length, all embedded records have been processed.<a href="#section-3.2.9-1" class="pilcrow">¶</a></p>
<p id="section-3.2.9-2">Content and conditions:<a href="#section-3.2.9-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.9-3.1">The record has a Record Type number of 1029 and the Critical Bit MAY be set.<a href="#section-3.2.9-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.9-3.2">The record body is defined as a set of records.<a href="#section-3.2.9-3.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.9-3.3">
              <p id="section-3.2.9-3.3.1">The structure of the record body and all conditions MUST be identical to the rules 
       described in <a href="#current-parameters-container" class="xref">Section 3.2.3</a> of this document.<a href="#section-3.2.9-3.3.1" class="pilcrow">¶</a></p>
<p id="section-3.2.9-3.3.2"></p>
</li>
            <li class="compact" id="section-3.2.9-3.4">In both the PTP Key Grant and PTP Registration Success message, this record MUST 
       be contained exactly once during the update period.<a href="#section-3.2.9-3.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.9-3.5">Outside the update period, this record MUST NOT be included.<a href="#section-3.2.9-3.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.9-3.6">
              <p id="section-3.2.9-3.6.1">In multicast mode, this record MAY also be missing if the requester is to be 
       explicitly excluded from a multicast group after the security parameter rotation 
   process by the KE server.<a href="#section-3.2.9-3.6.1" class="pilcrow">¶</a></p>
<p id="section-3.2.9-3.6.2"></p>
</li>
            <li class="compact" id="section-3.2.9-3.7">The update period starts with the expiration of the Time until Update timer, which 
       is stored in the Current Parameter Container record.<a href="#section-3.2.9-3.7" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.9-3.8">In the PTP Key Grant and PTP Registration Success message, the expiration of the 
       Lifetime marks the end of the update period.<a href="#section-3.2.9-3.8" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.9-3.9">More details are described in <a href="#key-update" class="xref">Section 2.2.1</a>.<a href="#section-3.2.9-3.9" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="nts-message-type">
<section id="section-3.2.10">
          <h4 id="name-nts-message-type">
<a href="#section-3.2.10" class="section-number selfRef">3.2.10. </a><a href="#name-nts-message-type" class="section-name selfRef">NTS Message Type</a>
          </h4>
<p id="section-3.2.10-1">This record enables the distinction between different NTS message types for PTP.<a href="#section-3.2.10-1" class="pilcrow">¶</a></p>
<p id="section-3.2.10-2">Content and conditions:<a href="#section-3.2.10-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.10-3.1">The record has a Record Type number of 1030 and the Critical Bit MUST be set.<a href="#section-3.2.10-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.10-3.2">The record body is a 16-bit unsigned integer in network byte order, denoting the type of the current NTS message for PTP.<a href="#section-3.2.10-3.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.10-3.3">The message types are defined in the following table.<a href="#section-3.2.10-3.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.10-3.4">More details about the messages are described in <a href="#overview-nts-messages" class="xref">Section 2.3</a><a href="#section-3.2.10-3.4" class="pilcrow">¶</a>
</li>
          </ul>
<span id="name-nts-message-type-numbers"></span><div id="tbl_message_type">
<table class="center" id="table-19">
            <caption>
<a href="#table-19" class="selfRef">Table 19</a>:
<a href="#name-nts-message-type-numbers" class="selfRef">NTS message type numbers</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">NTS Message Type Number</th>
                <th class="text-left" rowspan="1" colspan="1">NTS Message Name</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">PTP Key Request</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">PTP Key Grant</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">2</td>
                <td class="text-left" rowspan="1" colspan="1">PTP Refusal</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">3</td>
                <td class="text-left" rowspan="1" colspan="1">PTP Registration Request</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">4</td>
                <td class="text-left" rowspan="1" colspan="1">PTP Registration Success</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">5</td>
                <td class="text-left" rowspan="1" colspan="1">PTP Registration Revoke</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">6 - 32767</td>
                <td class="text-left" rowspan="1" colspan="1">Unassigned</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">32768 - 65535</td>
                <td class="text-left" rowspan="1" colspan="1">Reserved for Private or Experimental Use</td>
              </tr>
            </tbody>
          </table>
</div>
</section>
</div>
<div id="nts-message-version">
<section id="section-3.2.11">
          <h4 id="name-nts-message-version">
<a href="#section-3.2.11" class="section-number selfRef">3.2.11. </a><a href="#name-nts-message-version" class="section-name selfRef">NTS Message Version</a>
          </h4>
<p id="section-3.2.11-1">This record enables the distinction between different NTS message versions for PTP. 
It provides the possibility to update or extend the NTS messages in future 
specifications.<a href="#section-3.2.11-1" class="pilcrow">¶</a></p>
<p id="section-3.2.11-2">Content and conditions:<a href="#section-3.2.11-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.11-3.1">The record has a Record Type number of 1031 and the Critical Bit MUST be set.<a href="#section-3.2.11-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.11-3.2">The record body consists of a tuple of two 8-bit unsigned integers in network byte order.<a href="#section-3.2.11-3.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.11-3.3">
              <p id="section-3.2.11-3.3.1">The first octet represents the major version and the second octet the minor version.<a href="#section-3.2.11-3.3.1" class="pilcrow">¶</a></p>
<p id="section-3.2.11-3.3.2"><strong>NTS Message Version = {major version || minor version}</strong><a href="#section-3.2.11-3.3.2" class="pilcrow">¶</a></p>
<p id="section-3.2.11-3.3.3"></p>
</li>
            <li class="compact" id="section-3.2.11-3.4">The representable version is therefore in the range 0.0 to 255.255 (e.g. v1.4 = 0104h).<a href="#section-3.2.11-3.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.11-3.5">All NTS messages for PTPv2.1 described in this document are in version number 1.0.<a href="#section-3.2.11-3.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.11-3.6">Thus the record body MUST match 0100h.<a href="#section-3.2.11-3.6" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="nts-next-protocol-nego">
<section id="section-3.2.12">
          <h4 id="name-nts-next-protocol-negotiati">
<a href="#section-3.2.12" class="section-number selfRef">3.2.12. </a><a href="#name-nts-next-protocol-negotiati" class="section-name selfRef">NTS Next Protocol Negotiation</a>
          </h4>
<p id="section-3.2.12-1">The Next Protocol Negotiation record is defined in IETF RFC8915 <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, 4.1.2:<a href="#section-3.2.12-1" class="pilcrow">¶</a></p>
<ul class="ulEmpty compact">
<li class="ulEmpty compact" id="section-3.2.12-2.1">
              <em>"The Protocol IDs listed in the client's NTS Next Protocol Negotiation record denote 
 those protocols that the client wishes to speak using the key material established 
 through this NTS-KE server session. Protocol IDs listed in the NTS-KE server's response 
 MUST comprise a subset of those listed in the request and denote those protocols that 
 the NTP server is willing and able to speak using the key material established through 
 this NTS-KE server session. The client MAY proceed with one or more of them. The request 
 MUST list at least one protocol, but the response MAY be empty."</em><a href="#section-3.2.12-2.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.12-3">Content and conditions:<a href="#section-3.2.12-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.12-4.1">The record has a Record Type number of 1 and the Critical Bit MUST be set.<a href="#section-3.2.12-4.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.12-4.2">
              <p id="section-3.2.12-4.2.1">The record body consists of a sequence of 16-bit unsigned integers in network byte order.<a href="#section-3.2.12-4.2.1" class="pilcrow">¶</a></p>
<p id="section-3.2.12-4.2.2"><strong>Record body = {Protocol ID 1 || Protocol ID 2 || ...}</strong><a href="#section-3.2.12-4.2.2" class="pilcrow">¶</a></p>
<p id="section-3.2.12-4.2.3"></p>
</li>
            <li class="compact" id="section-3.2.12-4.3">Each integer represents a Protocol ID from the IANA "Network Time Security Next Protocols" registry as shown in the table below.<a href="#section-3.2.12-4.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.12-4.4">For NTS requests messages for PTPv2.1, only the Protocol ID for PTPv2.1 SHOULD be included.<a href="#section-3.2.12-4.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.12-4.5">This prevents the mixing of records for different time protocols.<a href="#section-3.2.12-4.5" class="pilcrow">¶</a>
</li>
          </ul>
<span id="name-nts-next-protocol-ids"></span><div id="tbl_next_protocol_ids">
<table class="center" id="table-20">
            <caption>
<a href="#table-20" class="selfRef">Table 20</a>:
<a href="#name-nts-next-protocol-ids" class="selfRef">NTS next protocol IDs</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Protocol ID</th>
                <th class="text-left" rowspan="1" colspan="1">Protocol Name</th>
                <th class="text-left" rowspan="1" colspan="1">Reference</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">Network Time Protocol version 4 (NTPv4)</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC8915" class="xref">RFC8915</a>]</span>, 7.7</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Precision Time Protocol version 2.1 (PTPv2.1)</td>
                <td class="text-left" rowspan="1" colspan="1">This document</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">2 - 32767</td>
                <td class="text-left" rowspan="1" colspan="1">Unassigned</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">32768 - 65535</td>
                <td class="text-left" rowspan="1" colspan="1">Reserved for Private or Experimental Use</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-3.2.12-6">Possible NTP/PTP conflict:<a href="#section-3.2.12-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.12-7.1">The support of multiple protocols in this record may lead to the problem 
       that records in NTS messages can no longer be assigned to a specific time protocol.<a href="#section-3.2.12-7.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.12-7.2">For example, an NTS request could include records for both NTP and PTP.<a href="#section-3.2.12-7.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.12-7.3">However, NTS4NTP does not use NTS message types and the End of Message record is also 
    not defined for the case of multiple NTS requests in one TLS message.<a href="#section-3.2.12-7.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.12-7.4">
              <p id="section-3.2.12-7.4.1">This leads to the mixing of the records in the NTS messages.<a href="#section-3.2.12-7.4.1" class="pilcrow">¶</a></p>
<p id="section-3.2.12-7.4.2"></p>
</li>
            <li class="compact" id="section-3.2.12-7.5">A countermeasure is the use of only a single time protocol in the NTS Next Protocol 
    Negotiation record that explicitly assigns the NTS message to a specific time protocol.<a href="#section-3.2.12-7.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.12-7.6">When using NTS-secured NTP and NTS-secured PTP, two separate NTS requests i.e. two 
    separate TLS sessions MUST be made.<a href="#section-3.2.12-7.6" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="requesting-ptp-identity">
<section id="section-3.2.13">
          <h4 id="name-requesting-ptp-identity">
<a href="#section-3.2.13" class="section-number selfRef">3.2.13. </a><a href="#name-requesting-ptp-identity" class="section-name selfRef">Requesting PTP Identity</a>
          </h4>
<p id="section-3.2.13-1">This record allows the KE server to associate an NTS unicast request of a requester 
with a registered grantor based on their address or identifier (e.g.: IP address or 
PortIdentity). Furthermore, this record allows the grantor to verify the origin of a 
secured PTP message that is currently transmitting a ticket.<a href="#section-3.2.13-1" class="pilcrow">¶</a></p>
<p id="section-3.2.13-2">Content and conditions:<a href="#section-3.2.13-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.13-3.1">The record has a Record Type number of 1032 and the Critical Bit MAY be set.<a href="#section-3.2.13-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.13-3.2">The record body consists of a set of Association Types together with their respective Association Values.<a href="#section-3.2.13-3.2" class="pilcrow">¶</a>
</li>
          </ul>
<span id="name-requesting-ptp-identity-lis"></span><div id="tbl_identity_list">
<table class="center" id="table-21">
            <caption>
<a href="#table-21" class="selfRef">Table 21</a>:
<a href="#name-requesting-ptp-identity-lis" class="selfRef">Requesting PTP identity list</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Field</th>
                <th class="text-center" rowspan="1" colspan="1">Octets</th>
                <th class="text-center" rowspan="1" colspan="1">Offset</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Association Type 1</td>
                <td class="text-center" rowspan="1" colspan="1">2</td>
                <td class="text-center" rowspan="1" colspan="1">0</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Association Value 1</td>
                <td class="text-center" rowspan="1" colspan="1">A1</td>
                <td class="text-center" rowspan="1" colspan="1">2</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Association Type 2</td>
                <td class="text-center" rowspan="1" colspan="1">2</td>
                <td class="text-center" rowspan="1" colspan="1">A1+2</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Association Value 2</td>
                <td class="text-center" rowspan="1" colspan="1">A2</td>
                <td class="text-center" rowspan="1" colspan="1">A1+4</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Association Type n</td>
                <td class="text-center" rowspan="1" colspan="1">A2</td>
                <td class="text-center" rowspan="1" colspan="1">A1+A2+4</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Association Value n</td>
                <td class="text-center" rowspan="1" colspan="1">An</td>
                <td class="text-center" rowspan="1" colspan="1">A1+A2+6</td>
              </tr>
            </tbody>
          </table>
</div>
<ul class="compact">
<li class="compact" id="section-3.2.13-5.1">
              <p id="section-3.2.13-5.1.1">Structure and values are based on the contents defined in <a href="#association-mode" class="xref">Section 3.2.2</a> of this document.<a href="#section-3.2.13-5.1.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.13-5.1.2.1">Therefore, the Association Type is a 16-bit unsigned integer.<a href="#section-3.2.13-5.1.2.1" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.2.13-5.1.2.2">The length and content of Association Value depends on the value of Association Type.<a href="#section-3.2.13-5.1.2.2" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.2.13-5.1.2.3">
                  <p id="section-3.2.13-5.1.2.3.1">All bytes are stored in network byte order and the rules in <a href="#association-mode" class="xref">Section 3.2.2</a> MUST be followed.<a href="#section-3.2.13-5.1.2.3.1" class="pilcrow">¶</a></p>
<p id="section-3.2.13-5.1.2.3.2"></p>
</li>
              </ul>
</li>
            <li class="compact" id="section-3.2.13-5.2">A Requesting PTP Identity record MUST contain at least one association tuple (type + value).<a href="#section-3.2.13-5.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.13-5.3">This record can contain several association tuples in any order.<a href="#section-3.2.13-5.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.13-5.4">
              <p id="section-3.2.13-5.4.1">It MUST NOT contain more than one association tuple of the same type.<a href="#section-3.2.13-5.4.1" class="pilcrow">¶</a></p>
<p id="section-3.2.13-5.4.2"></p>
</li>
            <li class="compact" id="section-3.2.13-5.5">In a PTP Key Request message, this record MUST be contained exactly once in the unicast mode, 
       which depends on the content of the Association Mode record of this message.<a href="#section-3.2.13-5.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.13-5.6">In this case the Requesting PTP Identity record MUST contain exactly one association tuple.<a href="#section-3.2.13-5.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.13-5.7">This association tuple MUST contain one identification feature of the PTP requestor (IPv4, IPv6, 802.3 or PortIdentity).<a href="#section-3.2.13-5.7" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.13-5.8">
              <p id="section-3.2.13-5.8.1">The association tuple MUST NOT contain the Group association type 0.<a href="#section-3.2.13-5.8.1" class="pilcrow">¶</a></p>
<p id="section-3.2.13-5.8.2"></p>
</li>
            <li class="compact" id="section-3.2.13-5.9">In a PTP Key Grant message, this record MUST be contained exactly once in the encrypted Ticket Container.<a href="#section-3.2.13-5.9" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.13-5.10">This record MUST contain exactly one association tuple.<a href="#section-3.2.13-5.10" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.13-5.11">The record body MUST be identical to the Requesting PTP Identity record of the related PTP Key Request message.<a href="#section-3.2.13-5.11" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.13-5.12">
              <p id="section-3.2.13-5.12.1">Therefore, the association tuple MUST NOT contain the Group association type 0.<a href="#section-3.2.13-5.12.1" class="pilcrow">¶</a></p>
<p id="section-3.2.13-5.12.2"></p>
</li>
            <li class="compact" id="section-3.2.13-5.13">In a PTP Registration Request message, this record MUST be included exactly once.<a href="#section-3.2.13-5.13" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.13-5.14">The grantor SHOULD add the following association tuples as far as they are available: IPv4, IPv6, 802.3 and PortIdentity.<a href="#section-3.2.13-5.14" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.13-5.15">
              <p id="section-3.2.13-5.15.1">The grantor MUST NOT include the Group association type 0.<a href="#section-3.2.13-5.15.1" class="pilcrow">¶</a></p>
<p id="section-3.2.13-5.15.2"></p>
</li>
            <li class="compact" id="section-3.2.13-5.16">This allows a requester to be assigned to a grantor, regardless of whether the requester specifies IPv4, IPv6, 802.3 or 
       the PortIdentity of the grantor in its PTP Key Request message.<a href="#section-3.2.13-5.16" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="security-association">
<section id="section-3.2.14">
          <h4 id="name-security-association">
<a href="#section-3.2.14" class="section-number selfRef">3.2.14. </a><a href="#name-security-association" class="section-name selfRef">Security Association</a>
          </h4>
<p id="section-3.2.14-1">This record contains the information "how" specific PTP message types must be secured. 
It comprises all dynamic (negotiable) values necessary to construct the AUTHENTICATION 
TLV (IEEE Std 1588-2019, 16.14.3). Static values and flags, such as the secParamIndicator, 
are described in more detail in <a href="#auth-tlv-parameters" class="xref">Section 5</a>.<a href="#section-3.2.14-1" class="pilcrow">¶</a></p>
<p id="section-3.2.14-2">Content and conditions:<a href="#section-3.2.14-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.14-3.1">The record has a Record Type number of 1033 and the Critical Bit MAY be set.<a href="#section-3.2.14-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.14-3.2">The record body is a sequence of various parameters in network byte order and MUST be 
       formatted according to the following table:<a href="#section-3.2.14-3.2" class="pilcrow">¶</a>
</li>
          </ul>
<span id="name-security-association-record"></span><div id="tbl_security_assoc">
<table class="center" id="table-22">
            <caption>
<a href="#table-22" class="selfRef">Table 22</a>:
<a href="#name-security-association-record" class="selfRef">Security Association record</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Field</th>
                <th class="text-center" rowspan="1" colspan="1">Octets</th>
                <th class="text-center" rowspan="1" colspan="1">Offset</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Security Parameter Pointer</td>
                <td class="text-center" rowspan="1" colspan="1">1</td>
                <td class="text-center" rowspan="1" colspan="1">0</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Integrity Algorithm Type</td>
                <td class="text-center" rowspan="1" colspan="1">2</td>
                <td class="text-center" rowspan="1" colspan="1">1</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Key ID</td>
                <td class="text-center" rowspan="1" colspan="1">4</td>
                <td class="text-center" rowspan="1" colspan="1">3</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Key Length</td>
                <td class="text-center" rowspan="1" colspan="1">2</td>
                <td class="text-center" rowspan="1" colspan="1">7</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Key</td>
                <td class="text-center" rowspan="1" colspan="1">K</td>
                <td class="text-center" rowspan="1" colspan="1">9</td>
              </tr>
            </tbody>
          </table>
</div>
<ul class="compact">
<li class="compact" id="section-3.2.14-5.1">In a PTP Key Grant message, the Security Association record MUST be included at least once in the 
       Current Parameters Container record and the Next Parameters Container record.<a href="#section-3.2.14-5.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.14-5.2">In unicast mode, the Security Association record MUST be included at least once in the 
       encrypted Ticket Container as well.<a href="#section-3.2.14-5.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.14-5.3">The Next Parameters Container record MUST be present only during the update period.<a href="#section-3.2.14-5.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.14-5.4">The Ticket record MUST be present in unicast mode and MUST NOT be present in multicast mode.<a href="#section-3.2.14-5.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.14-5.5">The number of Security Association records in the respective container or Ticket Container 
       depends on the content of the associated Security Policies (see also <a href="#security-policies" class="xref">Section 3.2.15</a>).<a href="#section-3.2.14-5.5" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.14-6">Security Parameter Pointer<a href="#section-3.2.14-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.14-7.1">The Security Parameter Pointer (SPP) is an 8-bit unsigned integer in the closed range 0 to 255.<a href="#section-3.2.14-7.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.14-7.2">This value enables the mutual assignment of SA, SP and AUTHENTICATION TLVs.<a href="#section-3.2.14-7.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.14-7.3">The generation and management of the SPP is controlled by the KE server (see <a href="#sa-sp-management" class="xref">Section 3.3.2</a>).<a href="#section-3.2.14-7.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.14-8">Integrity Algorithm Type<a href="#section-3.2.14-8" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.14-9.1">This value is a 16-bit unsigned integer in network byte order.<a href="#section-3.2.14-9.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.14-9.2">The possible values are equivalent to the MAC Algorithm Types from the table in <a href="#mac-algo-negotiation" class="xref">Section 3.2.8</a>.<a href="#section-3.2.14-9.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.14-9.3">The value used depends on the negotiated or predefined MAC algorithm.<a href="#section-3.2.14-9.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.14-10">Key ID<a href="#section-3.2.14-10" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.14-11.1">The Key ID is a 32-bit unsigned integer in network byte order.<a href="#section-3.2.14-11.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.14-11.2">The field length is oriented towards the structure of the AUTHENTICATION TLV.<a href="#section-3.2.14-11.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.14-11.3">The generation and management of the Key ID is controlled by the KE server.<a href="#section-3.2.14-11.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.14-11.4">
              <p id="section-3.2.14-11.4.1">The NTS-KE server MUST ensure that every Key ID is unique.<a href="#section-3.2.14-11.4.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.14-11.4.2.1">The value can be either a random number or an enumeration.<a href="#section-3.2.14-11.4.2.1" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.2.14-11.4.2.2">Previous Key IDs SHOULD NOT be reused for a certain number of rotation periods or a defined period of 
              time (see <a href="#additional-mechanisms" class="xref">Section 3.3</a>).<a href="#section-3.2.14-11.4.2.2" class="pilcrow">¶</a>
</li>
              </ul>
</li>
          </ul>
<p id="section-3.2.14-12">Key Length<a href="#section-3.2.14-12" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.14-13.1">This value is a 16-bit unsigned integer in network byte order, denoting the length of the key.<a href="#section-3.2.14-13.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.14-14">Key<a href="#section-3.2.14-14" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.14-15.1">The value is a sequence of octets with a length of Key Length.<a href="#section-3.2.14-15.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.14-15.2">This symmetric key is needed together with the MAC algorithm to calculate the ICV.<a href="#section-3.2.14-15.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.14-15.3">It can be both a group key (multicast mode) or a unicast key (unicast mode).<a href="#section-3.2.14-15.3" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="security-policies">
<section id="section-3.2.15">
          <h4 id="name-security-policies">
<a href="#section-3.2.15" class="section-number selfRef">3.2.15. </a><a href="#name-security-policies" class="section-name selfRef">Security Policies</a>
          </h4>
<p id="section-3.2.15-1">This record contains the information "which" PTP message types must be secured.<a href="#section-3.2.15-1" class="pilcrow">¶</a></p>
<p id="section-3.2.15-2">Content and conditions:<a href="#section-3.2.15-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.15-3.1">The record has a Record Type number of 1034 and the Critical Bit MAY be set.<a href="#section-3.2.15-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.15-3.2">
              <p id="section-3.2.15-3.2.1">The record body contains a sequence of tuples in network byte order:<a href="#section-3.2.15-3.2.1" class="pilcrow">¶</a></p>
<p id="section-3.2.15-3.2.2"><strong>Record body = {Security Policies = {tuple 1 || tuple 2 || tuple 3 || tuple n}}</strong><a href="#section-3.2.15-3.2.2" class="pilcrow">¶</a></p>
<p id="section-3.2.15-3.2.3"></p>
</li>
            <li class="compact" id="section-3.2.15-3.3">Each tuple has a length of 2 octets and consists of a sequence of a PTP Message Type 
       and a Security Parameter Pointer.<a href="#section-3.2.15-3.3" class="pilcrow">¶</a>
</li>
          </ul>
<span id="name-security-policy-tuple"></span><div id="tbl_security_pol_tuple">
<table class="center" id="table-23">
            <caption>
<a href="#table-23" class="selfRef">Table 23</a>:
<a href="#name-security-policy-tuple" class="selfRef">Security Policy tuple</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Field</th>
                <th class="text-center" rowspan="1" colspan="1">Octets</th>
                <th class="text-center" rowspan="1" colspan="1">Offset</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">PTP Message Type</td>
                <td class="text-center" rowspan="1" colspan="1">1</td>
                <td class="text-center" rowspan="1" colspan="1">0</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Security Parameter pointers</td>
                <td class="text-center" rowspan="1" colspan="1">1</td>
                <td class="text-center" rowspan="1" colspan="1">1</td>
              </tr>
            </tbody>
          </table>
</div>
<ul class="compact">
<li class="compact" id="section-3.2.15-5.1">The PTP Message Type is an 8-bit unsigned integer.<a href="#section-3.2.15-5.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.15-5.2">The most significant 4 bits are zero-padded and the least significant 4 bits are the PTP message type:<a href="#section-3.2.15-5.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.15-6">Structure of PTP Message Type (see also <span>[<a href="#IEEE1588-2019" class="xref">IEEE1588-2019</a>]</span>, 13.3.2.3, table 36):<a href="#section-3.2.15-6" class="pilcrow">¶</a></p>
<span id="name-ptp-message-type"></span><div id="tbl_ptp_message_type">
<table class="center" id="table-24">
            <caption>
<a href="#table-24" class="selfRef">Table 24</a>:
<a href="#name-ptp-message-type" class="selfRef">PTP Message Type</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Bits 7 - 4</th>
                <th class="text-left" rowspan="1" colspan="1">Bits 3 - 0</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Zero Padding</td>
                <td class="text-left" rowspan="1" colspan="1">PTP Message type</td>
              </tr>
            </tbody>
          </table>
</div>
<ul class="compact">
<li class="compact" id="section-3.2.15-8.1">
              <p id="section-3.2.15-8.1.1">The Security Parameter Pointer (SPP) is an 8-bit unsigned integer in the closed range 0 to 255.<a href="#section-3.2.15-8.1.1" class="pilcrow">¶</a></p>
<p id="section-3.2.15-8.1.2"></p>
</li>
            <li class="compact" id="section-3.2.15-8.2">The record body MUST contain at least one tuple.<a href="#section-3.2.15-8.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.15-8.3">A tuple associates a PTP message type with an SPP.<a href="#section-3.2.15-8.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.15-8.4">Every PTP message type that is mentioned in the Security Policies record MUST be secured.<a href="#section-3.2.15-8.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.15-8.5">Thus, a PTP message type that is not included in this record MUST NOT contain an AUTHENTICATION TLV and will not be secured.<a href="#section-3.2.15-8.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.15-8.6">Multiple tuples with the same PTP message type MUST NOT be included.<a href="#section-3.2.15-8.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.15-8.7">
              <p id="section-3.2.15-8.7.1">Multiple tuples MAY use the same SPP to use a shared security association or an individual one.<a href="#section-3.2.15-8.7.1" class="pilcrow">¶</a></p>
<p id="section-3.2.15-8.7.2"></p>
</li>
            <li class="compact" id="section-3.2.15-8.8">For the number of contained and different SPPs in the Security Policies record, the same number of security associations MUST be created.<a href="#section-3.2.15-8.8" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.15-8.9">
              <p id="section-3.2.15-8.9.1">The number of security associations determines the number of Security Associations records 
       in the respective container record (e.g. Current Parameters Container).<a href="#section-3.2.15-8.9.1" class="pilcrow">¶</a></p>
<p id="section-3.2.15-8.9.2"></p>
</li>
            <li class="compact" id="section-3.2.15-8.10">In a PTP Key Grant message, this record MUST be included exactly once each in the Current 
       Parameters Container record, the Next Parameters Container record as well as the encrypted Ticket Container record.<a href="#section-3.2.15-8.10" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.15-8.11">The Next Parameters Container record MUST be present only during the update period.<a href="#section-3.2.15-8.11" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.15-8.12">The Ticket record MUST be present in unicast mode and MUST NOT be present in multicast mode.<a href="#section-3.2.15-8.12" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="ticket">
<section id="section-3.2.16">
          <h4 id="name-ticket">
<a href="#section-3.2.16" class="section-number selfRef">3.2.16. </a><a href="#name-ticket" class="section-name selfRef">Ticket</a>
          </h4>
<p id="section-3.2.16-1">This record contains the parameters of the selected AEAD algorithm, as well as an 
encrypted Ticket Container record. The encrypted record contains all the necessary 
security parameters that the grantor needs for a secured PTP unicast connection to 
the requester. The ticket container is encrypted by the NTS-KE server with the 
symmetric ticket key which is also known to the grantor. The requester is not able 
to decrypt the ticket container.<a href="#section-3.2.16-1" class="pilcrow">¶</a></p>
<p id="section-3.2.16-2">Content and conditions:<a href="#section-3.2.16-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.16-3.1">The record has a Record Type number of 1035 and the Critical Bit MAY be set.<a href="#section-3.2.16-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.16-3.2">The record body consists of several data fields and MUST be formatted as follows.<a href="#section-3.2.16-3.2" class="pilcrow">¶</a>
</li>
          </ul>
<span id="name-structure-of-a-ticket-recor"></span><div id="tbl_ticket">
<table class="center" id="table-25">
            <caption>
<a href="#table-25" class="selfRef">Table 25</a>:
<a href="#name-structure-of-a-ticket-recor" class="selfRef">Structure of a Ticket record</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Field</th>
                <th class="text-center" rowspan="1" colspan="1">Octets</th>
                <th class="text-center" rowspan="1" colspan="1">Offset</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Nonce Length</td>
                <td class="text-center" rowspan="1" colspan="1">2</td>
                <td class="text-center" rowspan="1" colspan="1">0</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Nonce</td>
                <td class="text-center" rowspan="1" colspan="1">N</td>
                <td class="text-center" rowspan="1" colspan="1">2</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Encrypted Ticket Container Length</td>
                <td class="text-center" rowspan="1" colspan="1">2</td>
                <td class="text-center" rowspan="1" colspan="1">N+2</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Encrypted Ticket Container</td>
                <td class="text-center" rowspan="1" colspan="1">C</td>
                <td class="text-center" rowspan="1" colspan="1">N+4</td>
              </tr>
            </tbody>
          </table>
</div>
<ul class="compact">
<li class="compact" id="section-3.2.16-5.1">In a PTP Key Grant message, this record MUST be included exactly once each in the 
       Current Parameters Container record and the Next Parameters Container record if the 
   requester wants a unicast communication to a specific grantor.<a href="#section-3.2.16-5.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.16-5.2">The Next Parameters Container record MUST be present only during the update period.<a href="#section-3.2.16-5.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.16-6">Nonce Length<a href="#section-3.2.16-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.16-7.1">This is a 16-bit unsigned integer in network byte order, denoting the length of 
       the Nonce field.<a href="#section-3.2.16-7.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.16-8">Nonce<a href="#section-3.2.16-8" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.16-9.1">This field contains the Nonce needed for the AEAD operation.<a href="#section-3.2.16-9.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.16-9.2">The length and conditions attached to the Nonce depend on the AEAD algorithm used.<a href="#section-3.2.16-9.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.16-9.3">More details and conditions are described in <a href="#aead-operation" class="xref">Section 3.3.1</a>.<a href="#section-3.2.16-9.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.16-10">Encrypted Ticket Container Length<a href="#section-3.2.16-10" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.16-11.1">This is a 16-bit unsigned integer in network byte order, denoting the length 
       of the Encrypted Ticket Container field.<a href="#section-3.2.16-11.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.16-12">Encrypted Ticket Container<a href="#section-3.2.16-12" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.16-13.1">This field contains the output of the AEAD operation ("Ciphertext") after the 
       encryption process of the respective Ticket Container record.<a href="#section-3.2.16-13.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.16-13.2">The plaintext of this field is described in <a href="#ticket-container" class="xref">Section 3.2.17</a>.<a href="#section-3.2.16-13.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.16-13.3">More details about the AEAD process and the required input data are described in 
       <a href="#aead-operation" class="xref">Section 3.3.1</a>.<a href="#section-3.2.16-13.3" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="ticket-container">
<section id="section-3.2.17">
          <h4 id="name-ticket-container">
<a href="#section-3.2.17" class="section-number selfRef">3.2.17. </a><a href="#name-ticket-container" class="section-name selfRef">Ticket Container</a>
          </h4>
<p id="section-3.2.17-1">This record is a simple container that can carry an arbitrary number of NTS 
records. It contains all relevant security parameters that a grantor needs for a 
secured unicast connection. The order of the included records is arbitrary and the 
parsing rules are so far identical with the NTS message. One exception: An End of 
Message record SHOULD NOT be present and MUST be ignored. When the parser reaches 
the end of the Record Body quantified by the Body Length, all embedded records have 
been processed. The Ticket Container record serves as input parameter for the AEAD 
operation (see <a href="#aead-negotiation" class="xref">Section 3.2.1</a>) and is transmitted encrypted within the Ticket record 
(see <a href="#ticket" class="xref">Section 3.2.16</a>).<a href="#section-3.2.17-1" class="pilcrow">¶</a></p>
<p id="section-3.2.17-2">Content and conditions:<a href="#section-3.2.17-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.17-3.1">The record has a Record Type number of 1036 and the Critical Bit MAY be set.<a href="#section-3.2.17-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.17-3.2">The record body is defined as a set of records and MAY contain the following records.<a href="#section-3.2.17-3.2" class="pilcrow">¶</a>
</li>
          </ul>
<span id="name-structure-of-a-ticket-conta"></span><div id="tbl_ticket_container">
<table class="center" id="table-26">
            <caption>
<a href="#table-26" class="selfRef">Table 26</a>:
<a href="#name-structure-of-a-ticket-conta" class="selfRef">Structure of a Ticket Container</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">NTS Record Name</th>
                <th class="text-center" rowspan="1" colspan="1">Use</th>
                <th class="text-center" rowspan="1" colspan="1">Reference</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Requesting PTP Identity</td>
                <td class="text-center" rowspan="1" colspan="1">mand.</td>
                <td class="text-center" rowspan="1" colspan="1">This document, <a href="#requesting-ptp-identity" class="xref">Section 3.2.13</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Security Policies</td>
                <td class="text-center" rowspan="1" colspan="1">mand.</td>
                <td class="text-center" rowspan="1" colspan="1">This document, <a href="#security-policies" class="xref">Section 3.2.15</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Security Association (one or more)</td>
                <td class="text-center" rowspan="1" colspan="1">mand.</td>
                <td class="text-center" rowspan="1" colspan="1">This document, <a href="#security-association" class="xref">Section 3.2.14</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Lifetime</td>
                <td class="text-center" rowspan="1" colspan="1">mand.</td>
                <td class="text-center" rowspan="1" colspan="1">This document, <a href="#lifetime" class="xref">Section 3.2.7</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Time until Update</td>
                <td class="text-center" rowspan="1" colspan="1">mand.</td>
                <td class="text-center" rowspan="1" colspan="1">This document, <a href="#time-until-update" class="xref">Section 3.2.20</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Grace Period</td>
                <td class="text-center" rowspan="1" colspan="1">opt. (conditional)</td>
                <td class="text-center" rowspan="1" colspan="1">This document, <a href="#grace-period" class="xref">Section 3.2.6</a>
</td>
              </tr>
            </tbody>
          </table>
</div>
<ul class="compact">
<li class="compact" id="section-3.2.17-5.1">The records Requesting PTP Identity, Security Policies, Lifetime and Time until Update 
       MUST be contained exactly once.<a href="#section-3.2.17-5.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.17-5.2">The number of the Security Association records depends on the content of the Security 
       Policies record (see <a href="#security-policies" class="xref">Section 3.2.15</a>).<a href="#section-3.2.17-5.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.17-5.3">All records within this Ticket Container (except Requesting PTP Identity) MUST be 
       identical to the records of the respective Current Parameter Container.<a href="#section-3.2.17-5.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.17-5.4">All records within this Ticket Container (except Requesting PTP Identity) MUST be 
       identical to the records of the respective Next Parameter Container.<a href="#section-3.2.17-5.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.17-5.5">The presence of the Grace Period record also depends on the respective Current/Next 
       Parameter container.<a href="#section-3.2.17-5.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.17-5.6">If a Grace Period record is present in the Current/Next Parameter container, it MUST 
       also be present in the respective Ticket Container.<a href="#section-3.2.17-5.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.17-5.7">If it is not present, it MUST NOT be included in the Ticket Container.<a href="#section-3.2.17-5.7" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="ticket-key">
<section id="section-3.2.18">
          <h4 id="name-ticket-key">
<a href="#section-3.2.18" class="section-number selfRef">3.2.18. </a><a href="#name-ticket-key" class="section-name selfRef">Ticket Key</a>
          </h4>
<p id="section-3.2.18-1">This record contains the ticket key, which together with an AEAD algorithm is 
used to encrypt and decrypt the ticket.<a href="#section-3.2.18-1" class="pilcrow">¶</a></p>
<p id="section-3.2.18-2">Content and conditions:<a href="#section-3.2.18-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.18-3.1">The record has a Record Type number of 1037 and the Critical Bit MAY be set.<a href="#section-3.2.18-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.18-3.2">The record body consists of a sequence of octets holding the symmetric key for the AEAD function.<a href="#section-3.2.18-3.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.18-3.3">
              <p id="section-3.2.18-3.3.1">The generation and length of the key MUST meet the requirement of the associated AEAD 
       algorithm.<a href="#section-3.2.18-3.3.1" class="pilcrow">¶</a></p>
<p id="section-3.2.18-3.3.2"></p>
</li>
            <li class="compact" id="section-3.2.18-3.4">In a PTP Registration Success message, this record MUST be included exactly once each in 
       the Current Parameters Container record and the Next Parameters Container record.<a href="#section-3.2.18-3.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.18-3.5">The Next Parameters Container record MUST be present only during the update period.<a href="#section-3.2.18-3.5" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="ticket-key-id">
<section id="section-3.2.19">
          <h4 id="name-ticket-key-id">
<a href="#section-3.2.19" class="section-number selfRef">3.2.19. </a><a href="#name-ticket-key-id" class="section-name selfRef">Ticket Key ID</a>
          </h4>
<p id="section-3.2.19-1">The Ticket Key ID record is a unique identifier that allows a grantor to identify 
the associated ticket key.<a href="#section-3.2.19-1" class="pilcrow">¶</a></p>
<p id="section-3.2.19-2">Content and conditions:<a href="#section-3.2.19-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.19-3.1">The record has a Record Type number of 1038 and the Critical Bit MAY be set.<a href="#section-3.2.19-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.19-3.2">The record body consists of a 32-bit unsigned integer in network byte order.<a href="#section-3.2.19-3.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.19-3.3">The generation and management of the ticket key ID is controlled by the NTS-KE server.<a href="#section-3.2.19-3.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.19-3.4">
              <p id="section-3.2.19-3.4.1">The NTS-KE server must ensure that every ticket key has a unique number.<a href="#section-3.2.19-3.4.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.19-3.4.2.1">The value is implementation dependent and MAY be either a random number, a hash value or an 
      enumeration.<a href="#section-3.2.19-3.4.2.1" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.2.19-3.4.2.2">Previous IDs SHOULD NOT be reused for a certain number of rotation periods or a defined 
      period of time.<a href="#section-3.2.19-3.4.2.2" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="compact" id="section-3.2.19-3.5">In a PTP Key Grant message, this record MUST be included exactly once each in the Current 
       Parameters Container record and the Next Parameters Container record if a unicast connection 
   is to be established.<a href="#section-3.2.19-3.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.19-3.6">If the requester wishes to join a multicast group, the Ticket Key ID record MUST NOT be 
       included in the container records.<a href="#section-3.2.19-3.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.19-3.7">In a PTP Registration Success message, this record MUST be included exactly once in the Current 
       Parameters Container record and once in the Next Parameters Container record.<a href="#section-3.2.19-3.7" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.19-3.8">The Next Parameters Container record MUST be present only during the update period.<a href="#section-3.2.19-3.8" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.19-3.9">The Ticket record MUST be present in unicast mode and MUST NOT be present in multicast mode.<a href="#section-3.2.19-3.9" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="time-until-update">
<section id="section-3.2.20">
          <h4 id="name-time-until-update">
<a href="#section-3.2.20" class="section-number selfRef">3.2.20. </a><a href="#name-time-until-update" class="section-name selfRef">Time until Update</a>
          </h4>
<p id="section-3.2.20-1">The Time until Update (TuU) record specifies the point in time at which new security 
parameters are available. The value contained in this record is counted down by the 
receiver of the NTS message every second. When the value reaches zero, the update 
period begins and NTS response messages typically contain the Next Parameter Container 
record for a certain period of time (see also <a href="#key-update" class="xref">Section 2.2.1</a>).<a href="#section-3.2.20-1" class="pilcrow">¶</a></p>
<p id="section-3.2.20-2">Content and conditions:<a href="#section-3.2.20-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.20-3.1">The record has a Record Type number of 1039 and the Critical Bit MAY be set.<a href="#section-3.2.20-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.20-3.2">
              <p id="section-3.2.20-3.2.1">The record body consists of a 32-bit unsigned integer in network byte order, 
       denoting the begin of the update period in seconds.<a href="#section-3.2.20-3.2.1" class="pilcrow">¶</a></p>
<p id="section-3.2.20-3.2.2"></p>
</li>
            <li class="compact" id="section-3.2.20-3.3">The value in the TuU MUST be less than the value in the associated Lifetime record 
       (in the same container or ticket).<a href="#section-3.2.20-3.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.20-3.4">If the value in the TuU is greater than zero in the Current Parameter Container, 
       the corresponding message MUST NOT contain a Next Parameters Container.<a href="#section-3.2.20-3.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.20-3.5">
              <p id="section-3.2.20-3.5.1">If the value in the TuU is zero in the Current Parameters Container, the corresponding 
       NTS message MAY contain the Next Parameters Container record.<a href="#section-3.2.20-3.5.1" class="pilcrow">¶</a></p>
<p id="section-3.2.20-3.5.2"></p>
</li>
            <li class="compact" id="section-3.2.20-3.6">The Time until Update record MAY only appear as part of a PTP Key Grant or PTP 
       Registration Success message.<a href="#section-3.2.20-3.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.20-3.7">In both messages, the Next Parameters Container MUST be present only during the update period.<a href="#section-3.2.20-3.7" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.20-3.8">In a PTP Key Grant message, the Time until Update record MUST be included exactly once each 
       in the Current Parameters Container and Next Parameters Container records, as well as in the 
   encrypted Ticket Container (only present in a unicast PTP Key Grant message).<a href="#section-3.2.20-3.8" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.20-3.9">In a PTP Registration Success message, the Time until Update MUST be included exactly once 
       each in the Current Parameters Container and Next Parameters Container records.<a href="#section-3.2.20-3.9" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.20-3.10">In both messages, the Next Parameters Container record MUST be present only during the update period.<a href="#section-3.2.20-3.10" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.20-4">Notes:<a href="#section-3.2.20-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2.20-5.1">Requests during the currently running lifetime will receive respectively adapted count values 
       for Time until Update.<a href="#section-3.2.20-5.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.20-5.2">During the update period the value for TuU in the Current Parameters Container will be zero.<a href="#section-3.2.20-5.2" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="additional-mechanisms">
<section id="section-3.3">
        <h3 id="name-additional-mechanisms">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-additional-mechanisms" class="section-name selfRef">Additional Mechanisms</a>
        </h3>
<p id="section-3.3-1">This section provides information about the use of the negotiated AEAD algorithm 
as well as the generation of the security policy pointers.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<div id="aead-operation">
<section id="section-3.3.1">
          <h4 id="name-aead-operation">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-aead-operation" class="section-name selfRef">AEAD Operation</a>
          </h4>
<p id="section-3.3.1-1">General information about AEAD:<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.3.1-2.1">The AEAD operation enables the integrity protection and the optional encryption 
       of the given data, depending on the input parameters.<a href="#section-3.3.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.1-2.2">While the structure of the AEAD output after the securing operation is determined 
       by the negotiated AEAD algorithm, it usually contains an authentication tag in 
   addition to the actual ciphertext.<a href="#section-3.3.1-2.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.1-2.3">The authentication tag provides the integrity protection, whereas the ciphertext 
       represents the encrypted data.<a href="#section-3.3.1-2.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.1-2.4">The AEAD algorithms supported in this document (see <a href="#aead-negotiation" class="xref">Section 3.2.1</a>) 
       always return an authentication tag with a fixed length of 16 octets.<a href="#section-3.3.1-2.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.1-2.5">The size of the following ciphertext is equal to the length of the plaintext.<a href="#section-3.3.1-2.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.1-2.6">
              <p id="section-3.3.1-2.6.1">The concatenation of authentication tag and ciphertext always form the unit 
       "Ciphertext":<a href="#section-3.3.1-2.6.1" class="pilcrow">¶</a></p>
<p id="section-3.3.1-2.6.2"><strong>Ciphertext = {authentication 
   tag || ciphertext}</strong><a href="#section-3.3.1-2.6.2" class="pilcrow">¶</a></p>
<p id="section-3.3.1-2.6.3"></p>
</li>
            <li class="compact" id="section-3.3.1-2.7">Hint: The term "Ciphertext" is distinguished between upper and lower case letters.<a href="#section-3.3.1-2.7" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.1-2.8">The following text always describes "Ciphertext".<a href="#section-3.3.1-2.8" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.1-2.9">
              <p id="section-3.3.1-2.9.1">Separation of the information concatenated in Ciphertext is not necessary at any time.<a href="#section-3.3.1-2.9.1" class="pilcrow">¶</a></p>
<p id="section-3.3.1-2.9.2"></p>
</li>
            <li class="compact" id="section-3.3.1-2.10">
              <p id="section-3.3.1-2.10.1">Six parameters are relevant for the execution of an AEAD operation:<a href="#section-3.3.1-2.10.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.3.1-2.10.2.1">AEAD (...):  is the AEAD algorithm itself<a href="#section-3.3.1-2.10.2.1" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-2.10.2.2">A:  Associated Data<a href="#section-3.3.1-2.10.2.2" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-2.10.2.3">N:  Nonce<a href="#section-3.3.1-2.10.2.3" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-2.10.2.4">K:  Key<a href="#section-3.3.1-2.10.2.4" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-2.10.2.5">P:  Plaintext<a href="#section-3.3.1-2.10.2.5" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-2.10.2.6">C:  Ciphertext<a href="#section-3.3.1-2.10.2.6" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="compact" id="section-3.3.1-2.11">The protection and encryption of the data is done as follows:  C = AEAD (A, N, K, P)<a href="#section-3.3.1-2.11" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.1-2.12">
              <p id="section-3.3.1-2.12.1">Therefore, the output of the AEAD function is the Ciphertext.<a href="#section-3.3.1-2.12.1" class="pilcrow">¶</a></p>
<p id="section-3.3.1-2.12.2"></p>
</li>
            <li class="compact" id="section-3.3.1-2.13">The verification and decryption of the data is done this way:  P = AEAD (A, N, K, C)<a href="#section-3.3.1-2.13" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.1-2.14">The output of the AEAD function is the Plaintext if the integrity verification is successful.<a href="#section-3.3.1-2.14" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.3.1-3">AEAD algorithm and input/output values for the Ticket record:<a href="#section-3.3.1-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.3.1-4.1">
              <p id="section-3.3.1-4.1.1">AEAD (...):<a href="#section-3.3.1-4.1.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.3.1-4.1.2.1">The AEAD algorithm that is negotiated between grantor and NTS-KE server during 
      the registration phase.<a href="#section-3.3.1-4.1.2.1" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-4.1.2.2">A list of the AEAD algorithms considered in this document can be found in 
      <a href="#aead-negotiation" class="xref">Section 3.2.1</a>.<a href="#section-3.3.1-4.1.2.2" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="compact" id="section-3.3.1-4.2">
              <p id="section-3.3.1-4.2.1">Associated Data:<a href="#section-3.3.1-4.2.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.3.1-4.2.2.1">The Associated Data is an optional AEAD parameter and can be of any length and 
      content, as long as the AEAD algorithm does not give any further restrictions.<a href="#section-3.3.1-4.2.2.1" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-4.2.2.2">In addition to the Plaintext, this associated data is also included in the 
      integrity protection.<a href="#section-3.3.1-4.2.2.2" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-4.2.2.3">When encrypting or decrypting the Ticket Container record, this parameter 
      MUST remain empty.<a href="#section-3.3.1-4.2.2.3" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="compact" id="section-3.3.1-4.3">
              <p id="section-3.3.1-4.3.1">Nonce:<a href="#section-3.3.1-4.3.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.3.1-4.3.2.1">Corresponds to the value from the Nonce field in the Ticket (<a href="#ticket" class="xref">Section 3.2.16</a>).<a href="#section-3.3.1-4.3.2.1" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-4.3.2.2">The requirements and conditions depend on the selected AEAD algorithm.<a href="#section-3.3.1-4.3.2.2" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-4.3.2.3">For the AEAD algorithms defined in <a href="#aead-negotiation" class="xref">Section 3.2.1</a> (with 
      numeric identifiers 15, 16, 17), a cryptographically secure random number MUST be used.<a href="#section-3.3.1-4.3.2.3" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-4.3.2.4">Due to the block length of the internal AES algorithm, the Nonce SHOULD have a length 
      of 16 octets.<a href="#section-3.3.1-4.3.2.4" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="compact" id="section-3.3.1-4.4">
              <p id="section-3.3.1-4.4.1">Key:<a href="#section-3.3.1-4.4.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.3.1-4.4.2.1">This is the symmetric key required by the AEAD algorithm.<a href="#section-3.3.1-4.4.2.1" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-4.4.2.2">The key length depends on the selected algorithm.<a href="#section-3.3.1-4.4.2.2" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-4.4.2.3">When encrypting or decrypting the Ticket Container record, the ticket key MUST be used.<a href="#section-3.3.1-4.4.2.3" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="compact" id="section-3.3.1-4.5">
              <p id="section-3.3.1-4.5.1">Plaintext:<a href="#section-3.3.1-4.5.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.3.1-4.5.2.1">This parameter contains the data to be encrypted and secured.<a href="#section-3.3.1-4.5.2.1" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-4.5.2.2">For AEAD encryption, this corresponds to the Ticket Container record with all records inside.<a href="#section-3.3.1-4.5.2.2" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-4.5.2.3">This is also the output of the AEAD operation after the decryption process.<a href="#section-3.3.1-4.5.2.3" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="compact" id="section-3.3.1-4.6">
              <p id="section-3.3.1-4.6.1">Ciphertext:<a href="#section-3.3.1-4.6.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.3.1-4.6.2.1">Corresponds to the value from the Encrypted Ticket Container field in the Ticket 
      (<a href="#ticket" class="xref">Section 3.2.16</a>).<a href="#section-3.3.1-4.6.2.1" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-4.6.2.2">The Ciphertext is the output of the AEAD operation after the encryption process.<a href="#section-3.3.1-4.6.2.2" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-3.3.1-4.6.2.3">This is also the input parameter for the AEAD decryption operation.<a href="#section-3.3.1-4.6.2.3" class="pilcrow">¶</a>
</li>
              </ul>
</li>
          </ul>
</section>
</div>
<div id="sa-sp-management">
<section id="section-3.3.2">
          <h4 id="name-sa-sp-management">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-sa-sp-management" class="section-name selfRef">SA/SP Management</a>
          </h4>
<p id="section-3.3.2-1">This section describes the requirements and recommendations attached to SA/SP management, 
as well as details about the generation of identifiers.<a href="#section-3.3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.3.2-2">Requirements for the Security Association Database management:<a href="#section-3.3.2-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.3.2-3.1">The structure and management of the Security Association Database (SAD) are 
       implementation-dependent both on the NTS-KE server and on the PTP devices.<a href="#section-3.3.2-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.2-3.2">An example of this, as well as other recommendations, are described in Annex B.<a href="#section-3.3.2-3.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.2-3.3">A PTP device MUST contain exactly one SAD and Security Policy Database (SPD).<a href="#section-3.3.2-3.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.2-3.4">For multicast and Group-of-2 connections, SPPs MUST NOT occur more than once 
       in the SAD of a PTP device.<a href="#section-3.3.2-3.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.2-3.5">For unicast connections, SPPs MAY occur more than once in the SAD of a PTP device.<a href="#section-3.3.2-3.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.2-3.6">The NTS-KE server MUST ensure that SPPs can be uniquely assigned to a multicast 
       group or unicast connection.<a href="#section-3.3.2-3.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.3.2-3.7">This concerns both the NTS-KE server and all PTP devices assigned to the NTS-KE server.<a href="#section-3.3.2-3.7" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.3.2-4">SPP generation:<a href="#section-3.3.2-4" class="pilcrow">¶</a></p>
<ul class="ulEmpty compact">
<li class="ulEmpty compact" id="section-3.3.2-5.1">The generation of the SPP always takes place on the NTS-KE server and enables 
       the identification of a corresponding SA. The value of the SPP can be either a 
   random number or an enumeration. An SPP used in any multicast group MUST NOT 
   occur in any other multicast group or unicast connection. If a multicast group 
   or unicast connection is removed by the NTS-KE server, the released SPPs MAY be 
   reused for new groups or unicast connections. Before reusing an SPP, the NTS-KE 
   server MUST ensure that the SPP is no longer in use in the PTP network (e.g. 
   within Next Parameter). In different PTP devices, an SPP used in a unicast 
   connection MAY also occur in another unicast connection, as long as they are 
   not used in multicast groups.<a href="#section-3.3.2-5.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.3.2-6">Key/Key ID generation:<a href="#section-3.3.2-6" class="pilcrow">¶</a></p>
<ul class="ulEmpty compact">
<li class="ulEmpty compact" id="section-3.3.2-7.1">The generation of the keys MUST be performed by using a Cryptographically 
       Secure Pseudorandom Number Generator (CSPRNG) on the NTS-KE server (see also 
   <a href="#key-generation" class="xref">Section 2.2.2</a>). The length of the keys depends on the MAC algorithm used. The 
   generation and management of the Key ID is also controlled by the KE server. 
   The NTS-KE server MUST ensure that every Key ID is unique at least within an 
   SA with multiple parameter sets. The value of the Key ID is 
   implementation dependent and MAY be either a random number, a hash value or 
   an enumeration. Key IDs of expired keys MAY be reused but SHOULD NOT be reused 
   for a certain number of rotation periods or a defined period of time. Before 
   reusing a Key ID, the NTS-KE server MUST be ensured that the Key ID is no 
   longer in use in the PTP network (e.g. within Next Parameter).<a href="#section-3.3.2-7.1" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="new-ticket-tlv">
<section id="section-4">
      <h2 id="name-new-ticket-tlv-for-ptp-mess">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-new-ticket-tlv-for-ptp-mess" class="section-name selfRef">New TICKET TLV for PTP Messages</a>
      </h2>
<p id="section-4-1">Once a PTP port is registered as a grantor for association in unicast mode another PTP 
port (requester) can associate with it by first requesting a key from the KE server with
 Association Type in the Association Mode record set to one of the values 1 to 4 (IPv4, 
 IPv6, 802.3 or PortIdentity), and Association Values to the related address of the 
 registered port. With the reception of the key grant the requester obtains the unicast 
 key and the Ticket record containing the encrypted ticket container (see <a href="#exchange-ticket-based" class="xref">Section 2.1.2</a> 
 and <a href="#ticket" class="xref">Section 3.2.16</a>). The ticket container (see <a href="#ticket-container" class="xref">Section 3.2.17</a>)
 includes the identification of the requester, the SAs along with the unicast key as well 
 as the Lifetime/Time until Update data.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">To provide the grantor with the security data, the requester sends a secured unicast 
request to the grantor, e.g. an Announce request (= Signaling message with a 
REQUEST_UNICAST_TRANSMISSION TLV with Announce as messageType in the TLV), which is 
secured with the unicast key.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">To accomplish that, the requester sends a newly defined TICKET TLV with the Ticket 
container embedded and the AUTHENTICATION TLV with the PTP unicast negotiation message. 
The TICKET TLV must be positioned before the AUTHENTICATION TLV to include the TICKET TLV 
in the securing by the ICV. The receiving grantor decrypts the Ticket container from the 
TICKET TLV getting access to the information therein. With the contained unicast key, the 
grantor checks the requester identity and the authenticity of the request message.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">Thereafter all secured unicast messages between grantor and requester will use the 
unicast key for generating the ICV in the AUTHENTICATION TLV for authentication of the 
message until the unicast key expires.<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">If the requester's identity does not match with the Requesting PTP Identity record 
in the Ticket Container and/or the ICV in the AUTHENTICATION TLV is not identical to 
the generated ICV by the grantor, then the unicast request message shall be denied.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">The TICKET TLV structure is given in <a href="#tbl_ticket_tlv" class="xref">Table 27</a> below.<a href="#section-4-6" class="pilcrow">¶</a></p>
<span id="name-structure-of-the-ticket-tlv"></span><div id="tbl_ticket_tlv">
<table class="center" id="table-27">
        <caption>
<a href="#table-27" class="selfRef">Table 27</a>:
<a href="#name-structure-of-the-ticket-tlv" class="selfRef">Structure of the TICKET TLV</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Field</th>
            <th class="text-center" rowspan="1" colspan="1">Octets</th>
            <th class="text-center" rowspan="1" colspan="1">Offset</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">tlvType</td>
            <td class="text-center" rowspan="1" colspan="1">2</td>
            <td class="text-center" rowspan="1" colspan="1">0</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">lengthField</td>
            <td class="text-center" rowspan="1" colspan="1">2</td>
            <td class="text-center" rowspan="1" colspan="1">2</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Ticket record</td>
            <td class="text-center" rowspan="1" colspan="1">T</td>
            <td class="text-center" rowspan="1" colspan="1">4</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-4-8">To comply with the TLV structure of IEEE Std 1588-2019 (<span>[<a href="#IEEE1588-2019" class="xref">IEEE1588-2019</a>]</span>, 14.1)
   the TICKET TLV is structured as presented in <a href="#tbl_ticket_tlv" class="xref">Table 27</a> with a newly defined tlvType, a 
   respective length field and the Ticket record (see <a href="#ticket" class="xref">Section 3.2.16</a>) containing 
   the encrypted Ticket container. Eventually the Ticket TLV may be defined externally to IEEE 1588 SA, 
   e.g., by the IETF.  Then the structure should follow IEEE Std 1588-2019 
   (<span>[<a href="#IEEE1588-2019" class="xref">IEEE1588-2019</a>]</span>, 14.3) to define a new standard organization extension 
   TLV as presented in <a href="#tbl_ticket_tlv_ext" class="xref">Table 28</a> below.<a href="#section-4-8" class="pilcrow">¶</a></p>
<span id="name-structure-of-an-organizatio"></span><div id="tbl_ticket_tlv_ext">
<table class="center" id="table-28">
        <caption>
<a href="#table-28" class="selfRef">Table 28</a>:
<a href="#name-structure-of-an-organizatio" class="selfRef">Structure of an organization extension TLV form for the TICKET TLV</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Field</th>
            <th class="text-center" rowspan="1" colspan="1">Octets</th>
            <th class="text-center" rowspan="1" colspan="1">Offset</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">tlvType</td>
            <td class="text-center" rowspan="1" colspan="1">2</td>
            <td class="text-center" rowspan="1" colspan="1">0</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">lengthField</td>
            <td class="text-center" rowspan="1" colspan="1">2</td>
            <td class="text-center" rowspan="1" colspan="1">2</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">organizationId</td>
            <td class="text-center" rowspan="1" colspan="1">3</td>
            <td class="text-center" rowspan="1" colspan="1">4</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">organizationSubType</td>
            <td class="text-center" rowspan="1" colspan="1">3</td>
            <td class="text-center" rowspan="1" colspan="1">7</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Ticket record</td>
            <td class="text-center" rowspan="1" colspan="1">T</td>
            <td class="text-center" rowspan="1" colspan="1">10</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-4-10">The TICKET TLV will be added to the PTP message preceding the AUTHENTICATION TLV as 
       shown in Figure 48 of IEEE Std 1588-2019 (<span>[<a href="#IEEE1588-2019" class="xref">IEEE1588-2019</a>]</span>, 16.14.1.1).<a href="#section-4-10" class="pilcrow">¶</a></p>
<p id="section-4-11">(In an alternative solution the TICKET TLV is sent embedded in the RES field of the 
       AUTHENTICATION TLV as shown in Figure 49 of IEEE Std 1588-2019 (<span>[<a href="#IEEE1588-2019" class="xref">IEEE1588-2019</a>]</span>, 
    16.14.3). In this case the RP flag in the secParamIndicator must be set. As at the moment 
    the use of the RES field is not permitted and the structure of the RES field is limited 
    to UInteger (see <span>[<a href="#IEEE1588-2019" class="xref">IEEE1588-2019</a>]</span>, 16.14.3.8 ) the new usage needs to be defined. 

   
Which solution is chosen is a political question, not a technical one and may 
be discussed in the IEEE 1588 SA.)<a href="#section-4-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="auth-tlv-parameters">
<section id="section-5">
      <h2 id="name-authentication-tlv-paramete">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-authentication-tlv-paramete" class="section-name selfRef">AUTHENTICATION TLV Parameters</a>
      </h2>
<p id="section-5-1">The AUTHENTICATION TLV is the heart of the integrated security mechanism (prong A) for PTP. 
It provides all necessary data for the processing of the security means. The structure is shown 
in <a href="#tbl_auth_tlv" class="xref">Table 29</a> below (compare to Figure 49 of <span>[<a href="#IEEE1588-2019" class="xref">IEEE1588-2019</a>]</span>).<a href="#section-5-1" class="pilcrow">¶</a></p>
<span id="name-structure-of-the-authentica"></span><div id="tbl_auth_tlv">
<table class="center" id="table-29">
        <caption>
<a href="#table-29" class="selfRef">Table 29</a>:
<a href="#name-structure-of-the-authentica" class="selfRef">Structure of the AUTHENTICATION TLV</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Field</th>
            <th class="text-center" rowspan="1" colspan="1">Use</th>
            <th class="text-left" rowspan="1" colspan="1">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">tlvType</td>
            <td class="text-center" rowspan="1" colspan="1">mand.</td>
            <td class="text-left" rowspan="1" colspan="1">TLV Type</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">lengthField</td>
            <td class="text-center" rowspan="1" colspan="1">mand.</td>
            <td class="text-left" rowspan="1" colspan="1">TLV Length Information</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">SPP</td>
            <td class="text-center" rowspan="1" colspan="1">mand.</td>
            <td class="text-left" rowspan="1" colspan="1">Security Parameter Pointer</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">secParamIndicator</td>
            <td class="text-center" rowspan="1" colspan="1">mand.</td>
            <td class="text-left" rowspan="1" colspan="1">Security Parameter Indicator</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">keyID</td>
            <td class="text-center" rowspan="1" colspan="1">mand.</td>
            <td class="text-left" rowspan="1" colspan="1">Key Identifier or Current Key Disclosure Interval, depending on verification scheme</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">disclosedKey</td>
            <td class="text-center" rowspan="1" colspan="1">opt.</td>
            <td class="text-left" rowspan="1" colspan="1">Disclosed key from previous interval</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">sequenceNo</td>
            <td class="text-center" rowspan="1" colspan="1">opt.</td>
            <td class="text-left" rowspan="1" colspan="1">Sequence number</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">RES</td>
            <td class="text-center" rowspan="1" colspan="1">opt.</td>
            <td class="text-left" rowspan="1" colspan="1">Reserved</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">ICV</td>
            <td class="text-center" rowspan="1" colspan="1">mand.</td>
            <td class="text-left" rowspan="1" colspan="1">ICV based on algorithm OID</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-5-3">The tlvType is AUTHENTICATION and lengthField gives the length of the TLV. When using the 
AUTHENTICATION TLV with NTS key management, the SPP and keyID will be provided by the KE server 
in the PTP Key Grant Message<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">The optional disclosedKey, sequenceNo, and RES (see discussion in chapter 3) fields are 
omitted. So all of the flags in the SecParamIndicator are FALSE.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">ICV field contains the integrity check value of the particular PTP message calculated 
using the integrity algorithm defined by the key management.<a href="#section-5-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">Considerations should be made ...<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">...<a href="#section-6-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">...<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2"></p>
<p id="section-7-3"></p>
<p id="section-7-4"></p>
</section>
</div>
<div id="acknowledgements">
<section id="section-8">
      <h2 id="name-acknowledgements">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-8-1">The authors would like to thank ...<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="FIPS-PUB-198-1">[FIPS-PUB-198-1]</dt>
        <dd>
<span class="refAuthor">National Institute of Standards and Technology (NIST)</span>, <span class="refTitle">"The Keyed-Hash Message Authentication Code (HMAC)"</span>, <span class="seriesInfo">NIST FIPS PUB 198-1</span>, <time datetime="2008" class="refDate">2008</time>. </dd>
<dd class="break"></dd>
<dt id="IEEE1588-2019">[IEEE1588-2019]</dt>
        <dd>
<span class="refAuthor">Institute of Electrical and Electronics Engineers - IEEE Standards Association</span>, <span class="refTitle">"IEEE Standard for a Precision Clock Synchronization Protocol for Networked Measurement and Control Systems"</span>, <span class="seriesInfo">IEEE Standard 1588-2019</span>, <time datetime="2019" class="refDate">2019</time>. </dd>
<dd class="break"></dd>
<dt id="ITU-T_X.509">[ITU-T_X.509]</dt>
        <dd>
<span class="refAuthor">International Telecommunication Union (ITU)</span>, <span class="refTitle">"Information technology - Open systems interconnection - The Directory: Public-key and attribute certificate frameworks"</span>, <span class="seriesInfo">ITU-T Recommendation X.509 (2008)</span>, <time datetime="2008-11" class="refDate">November 2008</time>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4493">[RFC4493]</dt>
        <dd>
<span class="refAuthor">Song, JH.</span>, <span class="refAuthor">Poovendran, R.</span>, <span class="refAuthor">Lee, J.</span>, and <span class="refAuthor">T. Iwata</span>, <span class="refTitle">"The AES-CMAC Algorithm"</span>, <span class="seriesInfo">RFC 4493</span>, <span class="seriesInfo">DOI 10.17487/RFC4493</span>, <time datetime="2006-06" class="refDate">June 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4493">https://www.rfc-editor.org/info/rfc4493</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4543">[RFC4543]</dt>
        <dd>
<span class="refAuthor">McGrew, D.</span> and <span class="refAuthor">J. Viega</span>, <span class="refTitle">"The Use of Galois Message Authentication Code (GMAC) in IPsec ESP and AH"</span>, <span class="seriesInfo">RFC 4543</span>, <span class="seriesInfo">DOI 10.17487/RFC4543</span>, <time datetime="2006-05" class="refDate">May 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4543">https://www.rfc-editor.org/info/rfc4543</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5116">[RFC5116]</dt>
        <dd>
<span class="refAuthor">McGrew, D.</span>, <span class="refTitle">"An Interface and Algorithms for Authenticated Encryption"</span>, <span class="seriesInfo">RFC 5116</span>, <span class="seriesInfo">DOI 10.17487/RFC5116</span>, <time datetime="2008-01" class="refDate">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5116">https://www.rfc-editor.org/info/rfc5116</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5297">[RFC5297]</dt>
        <dd>
<span class="refAuthor">Harkins, D.</span>, <span class="refTitle">"Synthetic Initialization Vector (SIV) Authenticated Encryption Using the Advanced Encryption Standard (AES)"</span>, <span class="seriesInfo">RFC 5297</span>, <span class="seriesInfo">DOI 10.17487/RFC5297</span>, <time datetime="2008-10" class="refDate">October 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5297">https://www.rfc-editor.org/info/rfc5297</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7301">[RFC7301]</dt>
        <dd>
<span class="refAuthor">Friedl, S.</span>, <span class="refAuthor">Popov, A.</span>, <span class="refAuthor">Langley, A.</span>, and <span class="refAuthor">E. Stephan</span>, <span class="refTitle">"Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension"</span>, <span class="seriesInfo">RFC 7301</span>, <span class="seriesInfo">DOI 10.17487/RFC7301</span>, <time datetime="2014-07" class="refDate">July 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7301">https://www.rfc-editor.org/info/rfc7301</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7525">[RFC7525]</dt>
        <dd>
<span class="refAuthor">Sheffer, Y.</span>, <span class="refAuthor">Holz, R.</span>, and <span class="refAuthor">P. Saint-Andre</span>, <span class="refTitle">"Recommendations for Secure Use of Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)"</span>, <span class="seriesInfo">BCP 195</span>, <span class="seriesInfo">RFC 7525</span>, <span class="seriesInfo">DOI 10.17487/RFC7525</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7525">https://www.rfc-editor.org/info/rfc7525</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8915">[RFC8915]</dt>
      <dd>
<span class="refAuthor">Franke, D.</span>, <span class="refAuthor">Sibold, D.</span>, <span class="refAuthor">Teichel, K.</span>, <span class="refAuthor">Dansarie, M.</span>, and <span class="refAuthor">R. Sundblad</span>, <span class="refTitle">"Network Time Security for the Network Time Protocol"</span>, <span class="seriesInfo">RFC 8915</span>, <span class="seriesInfo">DOI 10.17487/RFC8915</span>, <time datetime="2020-09" class="refDate">September 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8915">https://www.rfc-editor.org/info/rfc8915</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="Langer_et_al._2020">[Langer_et_al._2020]</dt>
      <dd>
<span class="refAuthor">Langer, M.</span>, <span class="refAuthor">Heine, K.</span>, <span class="refAuthor">Sibold, D.</span>, and <span class="refAuthor">R. Bermbach</span>, <span class="refTitle">"A Network Time Security Based Automatic Key Management for PTPv2.1"</span>, <span class="seriesInfo">2020 IEEE 45th Conference on Local Computer Networks (LCN), Sydney, Australia</span>, <span class="seriesInfo">DOI 10.1109/LCN48667.2020.9314809</span>, <time datetime="2020-11" class="refDate">November 2020</time>, <span>&lt;<a href="https://ieeexplore.ieee.org/document/9314809">https://ieeexplore.ieee.org/document/9314809</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Martin Langer</span></div>
<div dir="auto" class="left"><span class="org">Ostfalia University of Applied Sciences</span></div>
<div dir="auto" class="left"><span class="street-address">Salzdahlumer Straße 46/48</span></div>
<div dir="auto" class="left">
<span class="postal-code">38302</span> <span class="locality">Wolfenbüttel</span>
</div>
<div dir="auto" class="left"><span class="country-name">Germany</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mart.langer@ostfalia.de" class="email">mart.langer@ostfalia.de</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Rainer Bermbach</span></div>
<div dir="auto" class="left"><span class="org">Ostfalia University of Applied Sciences</span></div>
<div dir="auto" class="left"><span class="street-address">Salzdahlumer Straße 46/48</span></div>
<div dir="auto" class="left">
<span class="postal-code">38302</span> <span class="locality">Wolfenbüttel</span>
</div>
<div dir="auto" class="left"><span class="country-name">Germany</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:r.bermbach@ostfalia.de" class="email">r.bermbach@ostfalia.de</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
