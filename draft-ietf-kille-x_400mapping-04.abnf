element         = service "." definition *( "." definition )
service         = "IPMS" / "MTS" / "MTA"
definition      = identifier / context
identifier      = ALPHA *< ALPHA or DIGIT or "-" >
context         = "[" 1*DIGIT "]"

boolean = "TRUE" / "FALSE"


numericstring = *DIGIT


printablestring  = *( ps-char )
ps-restricted-char      = 1DIGIT /  1ALPHA / " " / "'" / "+"
                                / "," / "-" / "." / "/" / ":" / "=" / "?"
ps-delim         = "(" / ")"
ps-char          = ps-delim / ps-restricted-char

teletex-string   = *( ps-char / t61-encoded )
t61-encoded      = "{" 1* t61-encoded-char "}"
t61-encoded-char = 3DIGIT

teletex-and-or-ps = [ printablestring ] [ "*" teletex-string ]

key-string      = *key-char
key-char        = <a-z, A-Z, 0-9, and "-">


ps-encoded       = *( ps-restricted-char / ps-encoded-char )
ps-encoded-char  = "(a)"               ; (@)
                              / "(p)"               ; (%)
                              / "(b)"               ; (!)
                              / "(q)"               ; (")
                              / "(u)"               ; (_)
                              / "(l)"               ; "("
                              / "(r)"               ; ")"
                              / "(" 3DIGIT ")"

encoded-pn      = [ given "." ] *( initial "." ) surname

given           = 2*<ps-char not including ".">

initial         = ALPHA

surname         = printablestring

GivenName       = "Marshall"
Surname         = "Rose"

Initials        = "MT"
Surname         = "Rose"

GivenName       = "Marshall"
Initials        = "MT"
Surname         = "Rose"

std-or-address  = 1*( "/" attribute "=" value ) "/"
attribute       = standard-type
                             / "RFC-822"
                             / registered-dd-type
                             / dd-key "." std-printablestring
standard-type   = key-string

dd-key          = key-string

value           = std-printablestring

std-char        = <"{", "}", "*", and any ps-char
                                             except "/" and "=">
std-pair        = "$" ps-char

C="GB", ADMD="GOLD 400", PRMD="UK.AC"

C="GB", ADMD="GOLD 400", PRMD="UK.AC", O="Salford", OU="R-D"

domain-syntax   = alphanum [ *alphanumhyphen alphanum ]
alphanum        = <ALPHA or DIGIT>
alphanumhyphen  = <ALPHA or DIGIT or HYPHEN>


C               = "GB"
ADMD            = "GOLD 400"
PRMD            = "UK.AC"
O               = "UCL"
OU              = "CS"
C               = "TC"
ADMD            = "Wizz.mail"
PRMD            = "42"
colon-or-address = 1*(attribute "=" value ";" *(LWSP-char))
C          = "XX"
ADMD       = "YY"
O          = "ZZ"
C          = "XX"
ADMD       = "YY"
O          = "ZZ"
Surname    = "Smith"

C               = "XY"
ADMD            = "PTT"
PRMD            = "Griddle MHS Providers"
Organisation    = "Widget Corporation"
Surname         = "Soap"
C             = "UK"
ADMD          = "Gold 400"
PRMD          = "UK.AC"
C             = "FR"
ADMD          = "ATLAS"
PRMD          = "Inria"
redirect-comment  =
                      [ "Originally To:" ] mailbox "Redirected"
                      [ "Again" ] "on" date-time
                      "To:"  redirection-reason

redirection-reason =
                      "Recipient Assigned Alternate Recipient"
                      / "Originator Requested Alternate Recipient"
                      / "Recipient MD Assigned Alternate Recipient"

encoded-info    = 1#encoded-type

encoded-type    = built-in-eit / object-identifier

built-in-eit    = "Undefined"         ; undefined (0)
                             / "Telex"             ; tLX (1)
                             / "IA5-Text"          ; iA5Text (2)
                             / "G3-Fax"            ; g3Fax (3)
                             / "TIF0"              ; tIF0 (4)
                             / "Teletex"           ; tTX (5)
                             / "Videotex"          ; videotex (6)
                             / "Voice"             ; voice (7)
                             / "SFD"               ; sFD (8)
                             / "TIF1"              ; tIF1 (9)


global-id = std-or-address
ipms-field = "Obsoletes" ":" 1#msg-id
                        / "Expiry-Date" ":" date-time
                        / "Reply-By" ":" date-time
                        / "Importance" ":" importance
                        / "Sensitivity" ":" sensitivity
                        / "Autoforwarded" ":" boolean
                        / "Incomplete-Copy" ":"
                        / "Language" ":" language
                        / "Message-Type" ":" message-type
                        / "Discarded-X400-IPMS-Extensions" ":" 1#oid



importance      = "low" / "normal" / "high"


sensitivity     = "Personal" / "Private" /
                                    "Company-Confidential"

language        = 2*ALPHA [ language-description ]
language-description = printable-string



message-type    = "Delivery Report"
                             / "InterPersonal Notification"
                             / "Multiple Part"

ipn-body-format = ipn-description <CRLF>
                             [ ipn-extra-information <CRLF> ]
                             ipn-content-return

ipn-description = ipn-receipt / ipn-non-receipt

ipn-receipt = "Your message to:" preferred-recipient <CRLF>
                      "was received at" receipt-time <CRLF> <CRLF>
                      "This notification was generated"
                      acknowledgement-mode <CRLF>
                      "The following extra information was given:" <CRLF>
                      ipn-suppl <CRLF>

ipn-reason = ipn-discarded / ipn-auto-forwarded

ipn-discarded = "was discarded for the following reason:"
                             discard-reason <CRLF>

ipn-auto-forwarded = "was automatically forwarded." <CRLF>
                             [ "The following comment was made:"
                                     auto-comment ]


ipn-extra-information =
                      "The following information types were converted:"
                      encoded-info

ipn-content-return = "The Original Message is not available"
                             / "The Original Message follows:"
                               <CRLF> <CRLF> message


preferred-recipient = mailbox
receipt-time        = date-time
auto-comment        = printablestring
ipn-suppl           = printablestring
discard-reason     = "Expired" / "Obsoleted" /
                                     "User Subscription Terminated"

acknowledgement-mode = "Manually" / "Automatically"

mts-field = "X400-MTS-Identifier" ":" mts-msg-id
                       / "X400-Originator" ":" mailbox
                       / "X400-Recipients" ":" 1#mailbox
                       / "Original-Encoded-Information-Types" ":"
                                       encoded-info
                       / "X400-Content-Type" ":" mts-content-type
                       / "Content-Identifier" ":" printablestring
                       / "Priority" ":" priority
                       / "Originator-Return-Address" ":" 1#mailbox
                       / "DL-Expansion-History" ":" mailbox ";" date-time ";"
                       / "Conversion" ":" prohibition
                       / "Conversion-With-Loss" ":" prohibition
                       / "Requested-Delivery-Method" ":"
                                       1*( labelled-integer )
                       / "Delivery-Date" ":" date-time
                       / "Discarded-X400-MTS-Extensions" ":"
                                        1#( oid / labelled-integer )


prohibition     = "Prohibited" / "Allowed"

mts-msg-id       = "[" global-id ";" *text "]"

mts-content-type = "P2" /  labelled-integer
                             / object-identifer

priority        = "normal" / "non-urgent" / "urgent"


mta-field       = "X400-Received" ":" x400-trace
                             / "Deferred-Delivery" ":" date-time
                             / "Latest-Delivery-Time" ":" date-time
x400-trace       = "by" md-and-mta ";"
                              [ "deferred until" date-time ";" ]
                              [ "converted" "(" encoded-info ")" ";" ]
                              [ "attempted" md-or-mta ";"  ]
                                 action-list
                                 ";" arrival-time


md-and-mta       = [ "mta" mta "in" ]  global-id
mta              = word
arrival-time     = date-time

md-or-mta        = "MD" global-id
                              / "MTA" mta

Action-list      = 1#action
action           = "Redirected"
                              / "Expanded"
                              / "Relayed"
                              / "Rerouted"




subject-line  = "Delivery-Report" "(" status ")"
                             [ "for" destination ]

status        = "success" / "failure" / "success and failures"

destination   = mailbox / "MTA" word


dr-body-format = dr-summary <CRLF>
                             dr-recipients <CRLF>
                             dr-administrator-info-envelope <CRLF>
                             dr-content-return


dr-content-return = "The Original Message is not available"
                  / "The Original Message follows:"
                  / "The Orginal Message is not returned with positive reports"

dr-summary = "This report relates to your message:" <CRLF>
                             content-correlator <CRLF> <CRLF>
                          "of" date-time <CRLF> <CRLF>


dr-recipients = *(dr-recipient <CRLF> <CRLF>)

dr-recipient = dr-recip-success / dr-recip-failure

dr-recip-success =
                             "Your message was successfully delivered to:"
                              mailbox "at" date-time


dr-recip-failure = "Your message was not delivered to:"
                                     mailbox <CRLF>
                             "for the following reason:" *word


dr-administrator-info-envelope = 3*( "*" text <CRLF> )


dr-administrator-info =
              "**** The following information is directed towards"
              "the local administrator" <CRLF>
              "**** and is not intended for the end user" <CRLF> <CRLF>
              "DR generated by:" report-point <CRLF>
              "at" date-time <CRLF> <CRLF>
              "Converted to RFC 822 at" mta <CRLF>
              "at" date-time <CRLF> <CRLF>
              "Delivery Report Contents:" <CRLF> <CRLF>
              drc-field-list <CRLF>
              "***** End of administration information"
drc-field-list       = *(drc-field <CRLF>)

drc-field = "Subject-Submision-Identifier" ":"
                                             mts-msg-id
                       / "Content-Identifier" ":" printablestring
                       / "Content-Type" ":" mts-content-type
                       / "Original-Encoded-Information-Types" ":"
                                     encoded-info
                       / "Originator-and-DL-Expansion-History" ":"
                                     dl-history
                       / "Reporting-DL-Name" ":" mailbox
                       / "Content-Correlator" ":" content-correlator
                       / "Recipient-Info" ":" recipient-info
                       / "Subject-Intermediate-Trace-Information" ":"
                                               x400-trace


recipient-info  = mailbox "," std-or ";"
                             report-type
                             [ "converted eits" encoded-info ";" ]
                             [ "originally intended recipient"
                                     mailbox "," std-or ";" ]
                             [ "last trace" [ encoded-info ] date-time ";" ]
                             [ "supplementary info" <"> printablestring <"> ";" ]
                             [ "redirection history" 1#redirection ";"
                             [ "physical forwarding address"
                                                   printablestring ";" ]


report-type     = "SUCCESS" drc-success
                             / "FAILURE" drc-failure

drc-success     = "delivered at" date-time ";"
                             [ "type of MTS user" labelled-integer ";" ]

drc-failure     = "reason" labelled-integer ";"
                             [ "diagnostic" labelled-integer ";" ]


report-point = [ "mta" word "in" ] global-id
content-correlator = *word
dl-history = 1#( mailbox "(" date-time ")")
original-sender     = "Original-Sender" ":" mailbox
boolean = "TRUE" / "FALSE"


numericstring = *DIGIT


printablestring  = *( ps-char )
ps-restricted-char      = 1DIGIT /  1ALPHA / " " / "'" / "+"
                                / "," / "-" / "." / "/" / ":" / "=" / "?"
ps-delim         = "(" / ")"
ps-char          = ps-delim / ps-restricted-char


ps-encoded       = *( ps-restricted-char / ps-encoded-char )
ps-encoded-char  = "(a)"               ; (@)
                              / "(p)"               ; (%)
                              / "(b)"               ; (!)
                              / "(q)"               ; (")
                              / "(u)"               ; (_)
                              / "(l)"               ; "("
                              / "(r)"               ; ")"
                              / "(" 3DIGIT ")"


teletex-string   = *( ps-char / t61-encoded )
t61-encoded      = "{" 1* t61-encoded-char "}"
t61-encoded-char = 3DIGIT


teletex-and-or-ps = [ printablestring ] [ "*" teletex-string ]


key-string      = *key-char
key-char        = <a-z, A-Z, 0-9, and "-">
encoded-info    = 1#encoded-type

encoded-type    = built-in-eit / object-identifier

built-in-eit    = "Undefined"         ; undefined (0)
                             / "Telex"             ; tLX (1)
                             / "IA5-Text"          ; iA5Text (2)
                             / "G3-Fax"            ; g3Fax (3)
                             / "TIF0"              ; tIF0 (4)
                             / "Teletex"           ; tTX (5)
                             / "Videotex"          ; videotex (6)
                             / "Voice"             ; voice (7)
                             / "SFD"               ; sFD (8)
                             / "TIF1"              ; tIF1 (9)



encoded-pn      = [ given "." ] *( initial "." ) surname

given           = 2*<ps-char not including ".">

initial         = ALPHA

surname         = printablestring
std-or-address  = 1*( "/" attribute "=" value ) "/"
attribute       = standard-type
                             / "RFC-822"
                             / registered-dd-type
                             / dd-key "." std-printablestring
standard-type   = key-string

dd-key          = key-string

value           = std-printablestring

std-char        = <"{", "}", "*", and any ps-char
                                             except "/" and "=">
std-pair        = "$" ps-char


dmn-or-address  = dmn-part *( "." dmn-part )
dmn-part        = attribute "$" value
attribute       = standard-type
                             / "~" dmn-printablestring
value           = dmn-printablestring
                             / "@"
dmn-printablestring =
                             = *( dmn-char / dmn-pair )
dmn-char        = <"{", "}", "*", and any ps-char
                                                     except ".">
dmn-pair        = "\."


global-id = std-or-address



mta-field       = "X400-Received" ":" x400-trace
                             / "Deferred-Delivery" ":" date-time
                             / "Latest-Delivery-Time" ":" date-time
x400-trace       = "by" md-and-mta ";"
                              [ "deferred until" date-time ";" ]
                              [ "converted" "(" encoded-info ")" ";" ]
                              [ "attempted" md-or-mta ";"  ]
                                 action-list
                                 ";" arrival-time


md-and-mta       = [ "mta" mta "in" ]  global-id
mta              = word
arrival-time     = date-time

md-or-mta        = "MD" global-id
                              / "MTA" mta

Action-list      = 1#action
action           = "Redirected"
                              / "Expanded"
                              / "Relayed"
                              / "Rerouted"
dr-body-format = dr-summary <CRLF>
                             dr-recipients <CRLF>
                             dr-administrator-info-envelope <CRLF>
                             dr-content-return


dr-content-return = "The Original Message is not available"
                  / "The Original Message follows:"
                  / "The Orginal Message is not returned with positive reports"

dr-summary = "This report relates to your message:" <CRLF>
                             content-correlator <CRLF> <CRLF>
                          "of" date-time <CRLF> <CRLF>


dr-recipients = *(dr-recipient <CRLF> <CRLF>)

dr-recipient = dr-recip-success / dr-recip-failure

dr-recip-success =
                             "Your message was successfully delivered to:"
                              mailbox "at" date-time


dr-recip-failure = "Your message was not delivered to:"
                                     mailbox <CRLF>
                             "for the following reason:" *word


dr-administrator-info-envelope = 3*( "*" text <CRLF> )


dr-administrator-info =
              "**** The following information is directed towards"
              "the local administrator" <CRLF>
              "**** and is not intended for the end user" <CRLF> <CRLF>
              "DR generated by:" report-point <CRLF>
              "at" date-time <CRLF> <CRLF>
              "Converted to RFC 822 at" mta <CRLF>
              "at" date-time <CRLF> <CRLF>
              "Delivery Report Contents:" <CRLF> <CRLF>
              drc-field-list <CRLF>
              "***** End of administration information"
drc-field-list       = *(drc-field <CRLF>)

drc-field = "Subject-Submision-Identifier" ":"
                                             mts-msg-id
                       / "Content-Identifier" ":" printablestring
                       / "Content-Type" ":" mts-content-type
                       / "Original-Encoded-Information-Types" ":"
                                     encoded-info
                       / "Originator-and-DL-Expansion-History" ":"
                                     dl-history
                       / "Reporting-DL-Name" ":" mailbox
                       / "Content-Correlator" ":" content-correlator
                       / "Recipient-Info" ":" recipient-info
                       / "Subject-Intermediate-Trace-Information" ":"
                                               x400-trace


recipient-info  = mailbox "," std-or ";"
                             report-type
                             [ "converted eits" encoded-info ";" ]
                             [ "originally intended recipient"
                                     mailbox "," std-or ";" ]
                             [ "last trace" [ encoded-info ] date-time ";" ]
                             [ "supplementary info" <"> printablestring <"> ";" ]
                             [ "redirection history" 1#redirection ";"
                             [ "physical forwarding address"
                                                   printablestring ";" ]


report-type     = "SUCCESS" drc-success
                             / "FAILURE" drc-failure

drc-success     = "delivered at" date-time ";"
                             [ "type of MTS user" labelled-integer ";" ]

drc-failure     = "reason" labelled-integer ";"
                             [ "diagnostic" labelled-integer ";" ]


report-point = [ "mta" word "in" ] global-id
content-correlator = *word
dl-history = 1#( mailbox "(" date-time ")")
mts-field = "X400-MTS-Identifier" ":" mts-msg-id
                       / "X400-Originator" ":" mailbox
                       / "X400-Recipients" ":" 1#mailbox
                       / "Original-Encoded-Information-Types" ":"
                                       encoded-info
                       / "X400-Content-Type" ":" mts-content-type
                       / "Content-Identifier" ":" printablestring
                       / "Priority" ":" priority
                       / "Originator-Return-Address" ":" 1#mailbox
                       / "DL-Expansion-History" ":" mailbox ";" date-time ";"
                       / "Conversion" ":" prohibition
                       / "Conversion-With-Loss" ":" prohibition
                       / "Requested-Delivery-Method" ":"
                                       1*( labelled-integer )
                       / "Delivery-Date" ":" date-time
                       / "Discarded-X400-MTS-Extensions" ":"
                                        1#( oid / labelled-integer )


prohibition     = "Prohibited" / "Allowed"

mts-msg-id       = "[" global-id ";" *text "]"

mts-content-type = "P2" /  labelled-integer
                             / object-identifer

priority        = "normal" / "non-urgent" / "urgent"
ipn-body-format = ipn-description <CRLF>
                             [ ipn-extra-information <CRLF> ]
                             ipn-content-return

ipn-description = ipn-receipt / ipn-non-receipt

ipn-receipt = "Your message to:" preferred-recipient <CRLF>
                      "was received at" receipt-time <CRLF> <CRLF>
                      "This notification was generated"
                      acknowledgement-mode <CRLF>
                      "The following extra information was given:" <CRLF>
                      ipn-suppl <CRLF>

ipn-reason = ipn-discarded / ipn-auto-forwarded

ipn-discarded = "was discarded for the following reason:"
                             discard-reason <CRLF>

ipn-auto-forwarded = "was automatically forwarded." <CRLF>
                             [ "The following comment was made:"
                                     auto-comment ]


ipn-extra-information =
                      "The following information types were converted:"
                      encoded-info

ipn-content-return = "The Original Message is not available"
                             / "The Original Message follows:"
                               <CRLF> <CRLF> message


preferred-recipient = mailbox
receipt-time        = date-time
auto-comment        = printablestring
ipn-suppl           = printablestring
discard-reason     = "Expired" / "Obsoleted" /
                                     "User Subscription Terminated"

acknowledgement-mode = "Manually" / "Automatically"


ipms-field = "Obsoletes" ":" 1#msg-id
                        / "Expiry-Date" ":" date-time
                        / "Reply-By" ":" date-time
                        / "Importance" ":" importance
                        / "Sensitivity" ":" sensitivity
                        / "Autoforwarded" ":" boolean
                        / "Incomplete-Copy" ":"
                        / "Language" ":" language
                        / "Message-Type" ":" message-type
                        / "Discarded-X400-IPMS-Extensions" ":" 1#oid



importance      = "low" / "normal" / "high"


sensitivity     = "Personal" / "Private" /
                                    "Company-Confidential"

language        = 2*ALPHA [ language-description ]
language-description = printable-string



message-type    = "Delivery Report"
                             / "InterPersonal Notification"
                             / "Multiple Part"
redirect-comment  =
                      [ "Originally To:" ] mailbox "Redirected"
                      [ "Again" ] "on" date-time
                      "To:"  redirection-reason

redirection-reason =
                      "Recipient Assigned Alternate Recipient"
                      / "Originator Requested Alternate Recipient"
                      / "Recipient MD Assigned Alternate Recipient"


subject-line  = "Delivery-Report" "(" status ")"
                             [ "for" destination ]

status        = "success" / "failure" / "success and failures"

destination   = mailbox / "MTA" word


extended-heading =
                 "Prevent-NonDelivery-Report" ":"
                 / "Generate-Delivery-Report" ":"
                 / "Alternate-Recipient" ":" prohibition
                 / "Disclose-Recipients" ":"  prohibition
                 / "Content-Return" ":" prohibition
C=ch;ADMD=arcom;PRMD=switch;O=switch;OU=cosine-mhs;S=project-team
dmn-or-address  = dmn-part *( "." dmn-part )
dmn-part        = attribute "$" value
attribute       = standard-type
                             / "~" dmn-printablestring
value           = dmn-printablestring
                             / "@"
dmn-printablestring =
                             = *( dmn-char / dmn-pair )
dmn-char        = <"{", "}", "*", and any ps-char
                                                     except ".">
dmn-pair        = "\."

extended-heading =
                 "Prevent-NonDelivery-Report" ":"
                 / "Generate-Delivery-Report" ":"
                 / "Alternate-Recipient" ":" prohibition
                 / "Disclose-Recipients" ":"  prohibition
                 / "Content-Return" ":" prohibition



