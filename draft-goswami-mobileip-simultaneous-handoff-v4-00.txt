





INTERNET-DRAFT               						Subrata Goswami
Expires February 10, 2003                                   Independent Consultant
                                                            Sept 09, 2002


     		   Simultaneous Handoff in Mobile-IPv4 and 802.11
              <draft-goswami-mobileip-simultaneous-handoff-v4-00.txt>


Status of this Memo

This document is an Internet-Draft and is in full conformance with all
provisions of Section 10 of RFC2026.

Internet-Drafts are working documents of the Internet Engineering Task
Force (IETF), its areas, and its working groups.  Note that other groups
may also distribute working documents as Internet-Drafts.

Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any
time.  It is inappropriate to use Internet- Drafts as reference material
or to cite them other than as "work in progress."

The list of current Internet-Drafts can be accessed at
http://www.ietf.org/ietf/1id-abstracts.txt

The list of Internet-Draft Shadow Directories can be accessed at
http://www.ietf.org/shadow.html.

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this
document are to be interpreted as described in RFC 2119 [RFC 2119].


Abstract

This document describes a way to perform simultaneous Mobile-IPv4 handoff 
and 802.11 Access Point Association/Reassociation. This is an attempt
to seek comments and critique on this approach.

1.  Overview and Rationale

In the 802.11 wireless lan [WiFi] network an 802.11 client connects to an
802.11 Access Point (AP) at the link level. 802.11 provides a mechanism to 
achieve handoffs between AP's and the client. A 802.11 client first 
authenticates and then associates with one AP. When the 802.11 client 
decides that it is better to move to a second AP, it can do a pre-authentication 
and re-association  with the second AP. 

Similarly when a Mobile-IPv4 (MIP4) client move from subnet to subnet it
seeks a Foreign Agent (FA) situated in the subnet and registers with the FA. The 
IP packet sent in Registration Message has the Home IP address as the source, and 
the  destination address can be the FA's IP address or the "All Mobility Agents"
multicast address (224.0.0.11).  The FA then responds with Registration Reply 
message. The Registration Message also includes Authentication Extensions.

There is no obvious reason why the Mobile Node (MN) has to go through the 
authentication and association/registration twice. It would be beneficial
to subsume the authentication and registration of MIPv4 to be completed 
during the 802.11 Authentication and Association exchanges.

2. 802.11 Network Architecture.

A hypothetical IP over 802.11 network is shown in the following figure. The
mobile client MN can move from subnet X1 to X2 and from AP2 to AP3. 

			[FA1]
 			  |
	...	[AP1]-------[X1]--|
[MN]...       	  |		|	
		[AP2]----		|----[X]----->  [HA]
 					|	
		[AP3/FA3]---[X2]--|


[MN] - Mobile Node
[FA] - Foreign Agent
[HA] - Home Agent
[AP] - Access Point
[X]  - IP Router
...  - 802.11 link 
---  - 802.3  link

					Figure 1: 802.11 Network

3.  Message Sequence

The following figure  shows the what happens when MN  move from AP1 to AP2 to AP3.
During the AP1 to AP2 handoff, the MN is in same subnet, hence  MIPv4 registration
is not required. The MN has no good way to figure that it is still within the same 
subnet, hence it sends a MIPv4 Registration Message element in the 802.11 Association
Message. The FA responds with MIPv4 reply which can be generated without doing  a 
FA to HA message sequence. 


MN			AP1			AP2			AP3

 ------ Authentication Request------>
 
 <------Authentication Response-----
 
 -------Authentication Response----->

 <------Authentication Response-----

 -------Reassociation  Request ----->
	  (MIPv4 Registration included but not reqd.)

 <------Reassociation  Response-----
	  (MIPv4 Reply included)
 .
 .

 ------ Reassociation  Request-------------------------->
	  (MIPv4 Registration included)
 
 <------Reassociation  Response-------------------------
	  (MIPv4 Reply included)

					Figure 2. 802.11/MIPv4 Message Sequence

4. Additional Information Elements in 802.11 Management Frames

The 802.11 Association/Reassociation frames are shown in the following 
figure. The Association/Reassociation frames carry an 
optional MIPv4 information element. The MIPv4 Registration Request
message is contained in the 802.11 Association/Reassociation Request 
messages. The MIPv4 Registration Reply message is contained in the 
802.11 Association/Reassociation Response messages. 


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        Frame Control          |         Duration              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Destination Address                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |         Source Address        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Source Address                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Basic Service Set ID                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |         Sequence Control      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Capability Information       |     Listen Interval           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Current AP Address                   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Current AP Address           |     SSID (2-34 octets)        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Supported Rates (3-7 octets)         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                                                               .
   +                MIPv4-802.11 Registration Request              +
   .                                                               .
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           Frame Check Sequence                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

	        Figure 3. 802.11 (Re) Association Request Frame

In Figure 3., 802.11 Association Reassociation frames differ primarily
in the absence of the Current AP address field from the first. 

The MIPv4-802.11 element is an 802.11 Information Element (IE) with a unique 
Element ID (say 128) (see page 55 of [WiFi]). The 802.11 Information Element
consists of the following fields: Element ID, Length ID, and Information.
The length field  is 1 octet long and specifies the length of the Information
field in number of octets. Thus the MIPv4-802.11 can be at most 255 octets,
and as such it would be a waste to put the full IP and UDP header. Hence 
a psuedo-IP and psuedo-UDP header is used. The pseudo-IP header is composed
of Source and Destination IP addresses. The  destination address can be the 
FA's IP address or the "All Mobility Agents" multicast address (224.0.0.11).
The Source IP address is the Home Address of the MN. The pseudo-UDP header is 
composed of Source Port and Destination Port.  The rest of the MIPv4-802.11 
is the MIPv4 fields. Figure 4 below shows the MIPv4-802.11 Information Element.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                   |Element ID     | Length        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Source IP Address                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Destination IP Address                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       UDP Source Port                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       UDP Destination Port                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |S|B|D|M|G|V|rsv|          Lifetime             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Home Address                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           Home Agent                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Care-of Address                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                         Identification                        +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Extensions ...
   +-+-+-+-+-+-+-+-

	Figure 4. MIPv4-802.11 Registration Request Information Element


Similarly a MIPv4-802.11 Registration Reply IE is defined which has 
the same format as Request IE's. The Source IP Address is the unicast IP 
address of the FA. The Destination IP Address is copied from the IP
Source Address of the corresponding Registration Request IE. The UDP 
ports are also copied from the Registration Request IE, with the 
destination and source exchanged.
 


5.  Acknowledgments

All the RFC's, freely available  802.11 standards,  and Linux web-sites.

6.  References

[WiFi] IEEE, "Part 11: Wireless LAN Medium Access Control (MAC) and 
Physical Layer (PHY) Specifications", 1999.

[MIPv4] Bradner, S., "IP Mobility Support", RFC 2002, October 1996.



7.  Author's Address

     Dr. Subrata Goswami
     Independent Consultant
     Newark, CA 94560
     sgoswami@umich.edu


This document expires February 10, 2003.
