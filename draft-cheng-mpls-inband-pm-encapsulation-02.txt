



MPLS Working Group                                              W. Cheng
Internet-Draft                                              China Mobile
Intended status: Standards Track                                  X. Min
Expires: May 5, 2020                                                 ZTE
                                                                 T. Zhou
                                                                  Huawei
                                                                 X. Dong
                                                               FiberHome
                                                                Y. Peleg
                                                                Broadcom
                                                        November 2, 2019


 Encapsulation For MPLS Performance Measurement with Alternate Marking
                                 Method
              draft-cheng-mpls-inband-pm-encapsulation-02

Abstract

   This document defines the encapsulation for MPLS performance
   measurement with alternate marking method, which performs flow-based
   packet loss, delay, and jitter measurements on live traffic.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on May 5, 2020.

Copyright Notice

   Copyright (c) 2019 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of



Cheng, et al.              Expires May 5, 2020                  [Page 1]

Internet-Draft         Encap For MPLS PM with AMM          November 2019


   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.1.  Conventions Used in This Document . . . . . . . . . . . .   3
       1.1.1.  Terminology . . . . . . . . . . . . . . . . . . . . .   3
       1.1.2.  Requirements Language . . . . . . . . . . . . . . . .   3
   2.  Flow-based PM Encapsulation in MPLS . . . . . . . . . . . . .   3
     2.1.  Examples for Applying Flow-ID in a label stack  . . . . .   4
   3.  Procedures of Encapsulation, Look-up and Decapsulation  . . .   7
   4.  Procedures of Flow-ID allocation  . . . . . . . . . . . . . .   8
   5.  Security Considerations . . . . . . . . . . . . . . . . . . .   9
   6.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   9
   7.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   9
   8.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   9
     8.1.  Normative References  . . . . . . . . . . . . . . . . . .   9
     8.2.  Informative References  . . . . . . . . . . . . . . . . .  10
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  10

1.  Introduction

   [I-D.fioccola-spring-flow-label-alt-mark] describes how the alternate
   marking method can be used as the passive performance measurement
   method in an IPv6 domain, actually the alternate marking method can
   also be applied to an MPLS domain, and what's missed is the
   encapsulation for MPLS performance measurement with alternate marking
   method.

   [RFC8372] discusses the desired capabilities for MPLS flow
   identification, in order to perform a better in-band performance
   monitoring of user data packets.  Synonymous Flow Label (SFL), which
   is introduced in [I-D.ietf-mpls-sfl-framework], is identified as a
   method of accomplishing MPLS flow identification.  This document
   employs a method, other than SFL, to accomplish MPLS flow
   identification.  The method described in this document is simple and
   flexible, furthermore, it complies with the current MPLS forwarding
   paradigm.

   The method described in this document is complementary to the SFL
   method, the former targets at hop-by-hop performance measurement, and
   the latter targets at end-to-end performance measurement,
   furthermore, the former supports the application scenario where Flow-



Cheng, et al.              Expires May 5, 2020                  [Page 2]

Internet-Draft         Encap For MPLS PM with AMM          November 2019


   ID is applied to MPLS LSP and MPLS VPN synchronously, and the latter
   doesn't support this kind of application scenario.

   This document defines the encapsulation for MPLS performance
   measurement with alternate marking method, which performs flow-based
   packet loss, delay, and jitter measurements on live traffic.

1.1.  Conventions Used in This Document

1.1.1.  Terminology

   LSP: Label Switched Path

   MPLS: Multi-Protocol Label Switching

   NMS: Network Management System

   PM: Performance Measurement

   PW: PseudoWire

   SFL: Synonymous Flow Label

   TC: Traffic Class

   TTL: Time to Live

   VC: Virtual Channel

   VPN: Virtual Private Network

1.1.2.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

2.  Flow-based PM Encapsulation in MPLS

   Flow-based MPLS performance measurement encapsulation with alternate
   marking method has the following format:








Cheng, et al.              Expires May 5, 2020                  [Page 3]

Internet-Draft         Encap For MPLS PM with AMM          November 2019


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Flow-ID Indicator Label (TBA1)    |  TC |S|      TTL      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                 Flow-ID               |L|D|R|S|    Reserved   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                            Payload                            ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


               Figure 1: Flow-based PM Encapsulation in MPLS

   Where Flow-ID Indicator Label is defined in this document as value
   TBA1, and the other fields related to the Flow-based PM encapsulation
   are defined as follows:

   o  Flow-ID - an MPLS label value used as MPLS flow identification
      [RFC8372], it should be unique within the administrative domain.
      Flow-ID values can be allocated by an external NMS or a
      controller, based on measurement object instance such as LSP and
      PW.  There is a one-to-one mapping between Flow-ID and flow.  The
      specific method on how to allocate the Flow-ID values is described
      in Section 4.  Note that the Flow-ID Label can be placed either at
      the bottom of the MPLS label stack or not, and the Flow-ID
      Indicator Label MAY appear multiple times in a label stack, which
      means more than one Flow-ID can be present within an MPLS label
      stack.  Section 2.1 of this document provides several examples to
      illustrate how to apply Flow-ID in a label stack.

   o  L and D - L(oss) bit and D(elay) bit are used for coloring the
      packets (called double-marking methodology), which is required by
      the alternate marking method.

   o  R - R bit is reserved for future use and MUST be set to zero.

   o  Reserved - one octet long field reserved for future use and MUST
      be set to zero.

2.1.  Examples for Applying Flow-ID in a label stack

   Three examples on different layout of Flow-ID label (4 octets) are
   illustrated as follows:

   (1) Layout of Flow-ID label when applied to MPLS LSP.




Cheng, et al.              Expires May 5, 2020                  [Page 4]

Internet-Draft         Encap For MPLS PM with AMM          November 2019


                +----------------------+
                |                      |
                |          LSP         |
                |         Label        |
                +----------------------+
                |                      |
                |   Flow-ID Indicator  |
                |         Label        |
                +----------------------+
                |                      |
                |        Flow-ID       |
                |         Label        |
                +----------------------+
                |                      |
                |          VPN         |
                |         Label        |
                +----------------------+ <= Bottom of stack
                |                      |
                |        Payload       |
                |                      |
                +----------------------+


                  Figure 2: Applying Flow-ID to MPLS LSP

   (2) Layout of Flow-ID label when applied to MPLS VPN traffic.

























Cheng, et al.              Expires May 5, 2020                  [Page 5]

Internet-Draft         Encap For MPLS PM with AMM          November 2019


                +----------------------+
                |                      |
                |          LSP         |
                |         Label        |
                +----------------------+
                |                      |
                |          VPN         |
                |         Label        |
                +----------------------+
                |                      |
                |   Flow-ID Indicator  |
                |         Label        |
                +----------------------+
                |                      |
                |        Flow-ID       |
                |         Label        |
                +----------------------+ <= Bottom of stack
                |                      |
                |        Payload       |
                |                      |
                +----------------------+


                  Figure 3: Applying Flow-ID to MPLS VPN

   (3) Layout of Flow-ID label when applied to both MPLS LSP and MPLS
   VPN traffic.
























Cheng, et al.              Expires May 5, 2020                  [Page 6]

Internet-Draft         Encap For MPLS PM with AMM          November 2019


                +----------------------+
                |                      |
                |          LSP         |
                |         Label        |
                +----------------------+
                |                      |
                |   Flow-ID Indicator  |
                |         Label        |
                +----------------------+
                |                      |
                |        Flow-ID       |
                |         Label        |
                +----------------------+
                |                      |
                |          VPN         |
                |         Label        |
                +----------------------+
                |                      |
                |   Flow-ID Indicator  |
                |         Label        |
                +----------------------+
                |                      |
                |        Flow-ID       |
                |         Label        |
                +----------------------+ <= Bottom of stack
                |                      |
                |        Payload       |
                |                      |
                +----------------------+


         Figure 4: Applying Flow-ID to both MPLS LSP and MPLS VPN

   Note that here VPN label can be MPLS PW label, MPLS Ethernet VPN
   label or MPLS IP VPN label, and it's also called VC label as defined
   in [RFC4026].

   Also note that for this example the two Flow-ID values appearing in a
   label stack MUST be different, that is to say, Flow-ID applied to
   MPLS LSP and Flow-ID applied to MPLS VPN share the same value space.

3.  Procedures of Encapsulation, Look-up and Decapsulation

   The procedures for Flow-ID label encapsulation, look-up and
   decapsulation are summarized as follows:

   o  The ingress node inserts the Flow-ID Indicator Label, alongside
      with the Flow-ID label, into the MPLS label stack.  At the same



Cheng, et al.              Expires May 5, 2020                  [Page 7]

Internet-Draft         Encap For MPLS PM with AMM          November 2019


      time, the ingress node sets the L bit and D bit, as needed by
      alternate-marking technique, and sets the Flow-ID value, as
      defined in this document.

   o  The transit nodes look up the Flow-ID label with the help of the
      Flow-ID Indicator Label, and transmit the collected information to
      an external NMS or a controller, which includes the values of the
      block counters and the timestamps of the marked packets, along
      with the value of the Flow-ID, referring to the procedures of
      alternate marking method.

   o  The egress node pops the Flow-ID Indicator Label, alongside with
      the Flow-ID label, from the MPLS label stack.  This document
      doesn't introduce any new procedure regarding to the process of
      the decapsulated packet.

4.  Procedures of Flow-ID allocation

   There are two ways of allocating Flow-ID, one way is to allocate
   Flow-ID by manual trigger from the network operator, and the other
   way is to allocate Flow-ID by automatic trigger from the ingress
   node, details are as follows:

   o  In the case of manual trigger, the network operator would manually
      input the characteristics (e.g.  IP five tuples and IP DSCP) of
      the measured IP traffic flow, then the NMS or the controller would
      generate one or two Flow-IDs based on the input from the network
      operator, and provision the ingress node with the characteristics
      of the measured IP traffic flow and the corresponding allocated
      Flow-ID(s).

   o  In the case of automatic trigger, the ingress node would identify
      the IP traffic flow entering the measured path, export the
      characteristics of the identified IP traffic flow to the NMS or
      the controller by IPFIX [RFC7011], then the NMS or the controller
      would generate one or two Flow-IDs based on the export from the
      ingress node, and provision the ingress node with the
      characteristics of the identified IP traffic flow and the
      corresponding allocated Flow-ID(s).

   The policy pre-configured at the NMS or the controller decides
   whether one Flow-ID or two Flow-IDs would be generated.  If the
   performance measurement on VPN traffic is enabled, then one Flow-ID
   applied to MPLS VPN would be generated; if the performance
   measurement on LSP tunnel is enabled, then one Flow-ID applied to
   MPLS LSP would be generated; if both of them are enabled, then two
   Flow-IDs respectively applied to MPLS VPN and MPLS LSP would be
   generated.



Cheng, et al.              Expires May 5, 2020                  [Page 8]

Internet-Draft         Encap For MPLS PM with AMM          November 2019


   Whether using manual trigger or using automatic trigger, the NMS or
   the controller MUST guarantee every generated Flow-ID is unique
   within the administrative domain.

5.  Security Considerations

   This document does not introduce additional security requirements and
   mechanisms.

6.  IANA Considerations

   In the Special-Purpose MPLS Label Values registry defined in
   [SP-MPLS-Label], a new Special-Purpose MPLS Label Value for Flow-ID
   Indicator is requested from IANA as follows:

   +---------------------+-----------------+---------------+-----------+
   | Special-Purpose     | Description     | Semantics     | Reference |
   | MPLS Label Value    |                 | Definition    |           |
   +---------------------+-----------------+---------------+-----------+
   | TBA1                | Flow-ID         | Section 2     | This      |
   |                     | Indicator Label |               | Document  |
   +---------------------+-----------------+---------------+-----------+

    Table 1: New Special-Purpose MPLS Label Value for Flow-ID Indicator

7.  Acknowledgements

   The authors would like to acknowledge Greg Mirsky, Aihua Liu,
   Shuangping Zhan and Ming Ke for their careful review and very helpful
   comments.

8.  References

8.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

   [SP-MPLS-Label]
              "Special-Purpose MPLS Label Values", 2014,
              <https://www.iana.org/assignments/mpls-label-values/mpls-
              label-values.xml>.



Cheng, et al.              Expires May 5, 2020                  [Page 9]

Internet-Draft         Encap For MPLS PM with AMM          November 2019


8.2.  Informative References

   [I-D.fioccola-spring-flow-label-alt-mark]
              Fioccola, G., Velde, G., Cociglio, M., and P. Muley,
              "Using the IPv6 Flow Label for Performance Measurement
              with Alternate Marking Method in Segment Routing", draft-
              fioccola-spring-flow-label-alt-mark-01 (work in progress),
              October 2017.

   [I-D.ietf-mpls-sfl-framework]
              Bryant, S., Chen, M., Li, Z., Swallow, G., Sivabalan, S.,
              and G. Mirsky, "Synonymous Flow Label Framework", draft-
              ietf-mpls-sfl-framework-06 (work in progress), October
              2019.

   [RFC4026]  Andersson, L. and T. Madsen, "Provider Provisioned Virtual
              Private Network (VPN) Terminology", RFC 4026,
              DOI 10.17487/RFC4026, March 2005,
              <https://www.rfc-editor.org/info/rfc4026>.

   [RFC7011]  Claise, B., Ed., Trammell, B., Ed., and P. Aitken,
              "Specification of the IP Flow Information Export (IPFIX)
              Protocol for the Exchange of Flow Information", STD 77,
              RFC 7011, DOI 10.17487/RFC7011, September 2013,
              <https://www.rfc-editor.org/info/rfc7011>.

   [RFC8372]  Bryant, S., Pignataro, C., Chen, M., Li, Z., and G.
              Mirsky, "MPLS Flow Identification Considerations",
              RFC 8372, DOI 10.17487/RFC8372, May 2018,
              <https://www.rfc-editor.org/info/rfc8372>.

Authors' Addresses

   Weiqiang Cheng
   China Mobile
   Beijing
   China

   Email: chengweiqiang@chinamobile.com


   Xiao Min
   ZTE
   Nanjing
   China

   Email: xiao.min2@zte.com.cn




Cheng, et al.              Expires May 5, 2020                 [Page 10]

Internet-Draft         Encap For MPLS PM with AMM          November 2019


   Tianran Zhou
   Huawei
   Beijing
   China

   Email: zhoutianran@huawei.com


   Ximing Dong
   FiberHome
   Wuhan
   China

   Email: dxm@fiberhome.com


   Yoav Peleg
   Broadcom
   USA

   Email: yoav.peleg@broadcom.com






























Cheng, et al.              Expires May 5, 2020                 [Page 11]
