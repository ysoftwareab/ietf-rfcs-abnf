<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>DKIM Third-Party Authorization Label</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="DKIM Third-Party Authorization Label">
<meta name="keywords" content="DKIM-TPA-Label, Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">DKIM Working Group</td><td class="header">D. Otis</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Trend Micro</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">D. Black</td></tr>
<tr><td class="header">Expires: April 24, 2010</td><td class="header">October 21, 2009</td></tr>
</table></td></tr></table>
<h1><br />DKIM Third-Party Authorization Label<br />draft-otis-dkim-tpa-label-03</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 24, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>A third party authorization label (TPA-Label) is a DNS-based prefix for DKIM ADSP records
        that acts as a scheme for domains to authorize acceptable third-party signatures for
        messages containing their domain within the From header. This scheme allows Author Domains
        to autonomously authorize a range of third-party domains using scalable, individual DNS
        transactions. This authorization extends the scope of DKIM signing practice assertions as a
        means to supplant more difficult to administer schemes. Alternatives for facilitating
        third-party authorizations currently necessitate the coordination between two or more
        domains to synchronously set up selector/key DNS records, DNS zone delegations, and/or the
        regular exchange of public/private keys.
</p>
<p>Checking TPA-Label Resource Records for signing practices may occur when an Author Domain
        Signature is missing or is invalid and a Third Party Signature exists. When a third-party
        signature is found, TPA-Label Resource Record transactions offer an efficient means for
        Author Domains to authorize specific third-party signing domains and for recipients to
        determine whether an authorization exists. The TPA-Label Resource Record scheme reduces
        reliance upon email source reputation that is often based upon an IP address rather than the
          domain.<br />
<br />

</p>
<h3>Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
        "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in
          <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Language and Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.</a>&nbsp;
Terms Imported from other DKIM Specifications:<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.2.</a>&nbsp;
Terms Defined by this Specification:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.2.1.</a>&nbsp;
Third Party Domain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.2.2.</a>&nbsp;
Third Party Signature<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.2.3.</a>&nbsp;
Third Party Signer<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">2.2.4.</a>&nbsp;
TPA-Label Listed Domain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">2.2.5.</a>&nbsp;
Author's Domain Acceptable Third-Party Signature<br />
<a href="#anchor10">3.</a>&nbsp;
TPA-Label Resource Record Authorization Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#eval-3p-signing-domain">3.1.</a>&nbsp;
Evaluating the Third-party Signing Domain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tpa-auth">3.1.1.</a>&nbsp;
Third Party Authentication<br />
<a href="#anchor16">4.</a>&nbsp;
Abuse and DSN Reporting<br />
<a href="#anchor17">5.</a>&nbsp;
DNS Representation<br />
<a href="#anchor18">6.</a>&nbsp;
TPA-Label and Tag Syntax Definitions<br />
<a href="#anchor19">7.</a>&nbsp;
TPA-Label Generation<br />
<a href="#tpalabel-rr">8.</a>&nbsp;
TPA-Label TXT Resource Record Structure<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#scope-defn">8.1.</a>&nbsp;
TPA-Label Resource Record Scope Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#scopeF-defn">8.1.1.</a>&nbsp;
TPA-Label Listed Domain Authorization<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#scopeL-defn">8.1.2.</a>&nbsp;
List-ID Header Field<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">8.1.3.</a>&nbsp;
Ancillary Use of Domain Authorizations<br />
<a href="#tpa-defn">9.</a>&nbsp;
Authorized Signing Domain<br />
<a href="#tpa-qt">10.</a>&nbsp;
TPA-Label Resource Record Query Transactions<br />
<a href="#auth-meaning">11.</a>&nbsp;
TPA-Label Resource Record Compliance Assessment<br />
<a href="#IANA">12.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">12.1.</a>&nbsp;
Email Authentication Method Registry<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">12.2.</a>&nbsp;
Email Authentication Result Names Registry<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">12.3.</a>&nbsp;
Third Party Authorizations Labels Registry<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#scope-registry">12.4.</a>&nbsp;
Third Party Authorizations Scope Registry<br />
<a href="#Security">13.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">13.1.</a>&nbsp;
Benefits to Recipients<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">13.2.</a>&nbsp;
Risks to Recipients<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">13.3.</a>&nbsp;
Benefits to Author Domains<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">13.4.</a>&nbsp;
Risks to Author Domains<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">13.5.</a>&nbsp;
Benefits to Third Party Signers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor30">13.6.</a>&nbsp;
Risks caused by Third Party Signers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">13.7.</a>&nbsp;
SHA-1 Collisions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DNS">13.8.</a>&nbsp;
DNS Limits<br />
<a href="#Acknowledgements">14.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">15.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">15.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">15.2.</a>&nbsp;
Informative References<br />
<a href="#anchor34">Appendix&nbsp;A.</a>&nbsp;
DNS Example of TPA-Label Resource Record placement<br />
<a href="#anchor35">Appendix&nbsp;B.</a>&nbsp;
C code for label generation<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Normally a DKIM authorization effort will likely involve sharing a number of details
        between the domain owner, and one or more email and DNS providers. Since there are many ways
        in which such authorizations can be accomplished, it is unlikely there will be consistent or
        standardized formats developed to exchange necessary, and at times, sensitive information.
        In addition, when there is a security breach, the wrong party might be held accountable for
        content they may have never seen nor logged. The TPA-Label Resource Record scheme permits
        the DKIM signature header to clarify who signed the message and on whose behalf, while also
        permitting greater control of specific header field authorizations made by the Author
        Domain.
</p>
<p>This document describes how any Author Domain publishing DKIM ADSP records defined in <a class='info' href='#RFC5617'>[RFC5617]<span> (</span><span class='info'>Allman, E., Fenton, J., Delany, M., and J. Levine, &ldquo;DomainKeys Identified Mail (DKIM) Author Domain Signing Practices (ADSP),&rdquo; August&nbsp;2009.</span><span>)</span></a>, can also autonomously authorize DKIM signatures <a class='info' href='#RFC4871'>[RFC4871]<span> (</span><span class='info'>Allman, E., Callas, J., Delany, M., Libbey, M., Fenton, J., and M. Thomas, &ldquo;DomainKeys Identified Mail (DKIM) Signatures,&rdquo; May&nbsp;2007.</span><span>)</span></a> (updated by <a class='info' href='#RFC5672'>[RFC5672]<span> (</span><span class='info'>Crocker, D., &ldquo;RFC 4871 DomainKeys Identified Mail (DKIM) Signatures -- Update,&rdquo; August&nbsp;2009.</span><span>)</span></a>) by specific third-party domains. TPA-Label listed
        domains offer secondary signing practices for compliance options when no Author Domain
        Signature is present within the message. Recommended or suggested actions for DKIM receivers
        are not included, and are considered "out-of-scope" for this document. The receiver is
        considered best able to determine the impacts of email handling based on TPA-Label Resource
        Records. The intended purpose of TPA-Label Resource Records are to improve acceptance rates
        of genuine messages and to lessen administrative costs associated with email.
</p>
<p>TPA-Label Resource Records authorize third-party signing domains as a means to extend DKIM
        compliance options for signing practices defined by <a class='info' href='#RFC5617'>[RFC5617]<span> (</span><span class='info'>Allman, E., Fenton, J., Delany, M., and J. Levine, &ldquo;DomainKeys Identified Mail (DKIM) Author Domain Signing Practices (ADSP),&rdquo; August&nbsp;2009.</span><span>)</span></a>. TPA-Label
        listed domains are to be considered equivalent to the authorizing Author Domain when
        assessing compliance with DKIM signing practices. The TXT resource records associated with
        TPA-Label start with the 'dkim' tag as defined by <a class='info' href='#RFC5617'>[RFC5617]<span> (</span><span class='info'>Allman, E., Fenton, J., Delany, M., and J. Levine, &ldquo;DomainKeys Identified Mail (DKIM) Author Domain Signing Practices (ADSP),&rdquo; August&nbsp;2009.</span><span>)</span></a> for signing
        practices, and may contain tags specifically defined for TPA-Label Resource Records.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Language and Terminology</h3>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Terms Imported from other DKIM Specifications:</h3>

<p>
          </p>
<blockquote class="text">
<p>A "Valid Signature" is any signature on a message that correctly verifies using the
              procedure described in Section 6.1 of <a class='info' href='#RFC4871'>[RFC4871]<span> (</span><span class='info'>Allman, E., Callas, J., Delany, M., Libbey, M., Fenton, J., and M. Thomas, &ldquo;DomainKeys Identified Mail (DKIM) Signatures,&rdquo; May&nbsp;2007.</span><span>)</span></a>.<br />
<br />

</p>
<p>"Author Address" is defined in Section 2.3 of <a class='info' href='#RFC5617'>[RFC5617]<span> (</span><span class='info'>Allman, E., Fenton, J., Delany, M., and J. Levine, &ldquo;DomainKeys Identified Mail (DKIM) Author Domain Signing Practices (ADSP),&rdquo; August&nbsp;2009.</span><span>)</span></a>.<br />
<br />

</p>
<p>"Author Domain" is defined in section 2.4 of <a class='info' href='#RFC5617'>[RFC5617]<span> (</span><span class='info'>Allman, E., Fenton, J., Delany, M., and J. Levine, &ldquo;DomainKeys Identified Mail (DKIM) Author Domain Signing Practices (ADSP),&rdquo; August&nbsp;2009.</span><span>)</span></a>.<br />
<br />

</p>
<p>"Alleged Author" is defined in Section 2.5 of <a class='info' href='#RFC5617'>[RFC5617]<span> (</span><span class='info'>Allman, E., Fenton, J., Delany, M., and J. Levine, &ldquo;DomainKeys Identified Mail (DKIM) Author Domain Signing Practices (ADSP),&rdquo; August&nbsp;2009.</span><span>)</span></a>.<br />
<br />

</p>
<p>"Author Domain Signature" is defined in Section 2.7 of <a class='info' href='#RFC5617'>[RFC5617]<span> (</span><span class='info'>Allman, E., Fenton, J., Delany, M., and J. Levine, &ldquo;DomainKeys Identified Mail (DKIM) Author Domain Signing Practices (ADSP),&rdquo; August&nbsp;2009.</span><span>)</span></a>
            
</p>
</blockquote><p>
        
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Terms Defined by this Specification:</h3>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.1"></a><h3>2.2.1.&nbsp;
Third Party Domain</h3>

<p>A "Third Party Domain" is an originating domain within a message that is not at or
            below the Author Domain.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.2"></a><h3>2.2.2.&nbsp;
Third Party Signature</h3>

<p>A "Third Party Signature" is a Valid Signature that does not qualify as a Author Domain
            Signature.
</p>
<p>
            </p>
<blockquote class="text">
<p>Editor's Note: While this term is defined in Section 6 of <a class='info' href='#I-D.ietf-dkim-deployment'>[I&#8209;D.ietf&#8209;dkim&#8209;deployment]<span> (</span><span class='info'>Hansen, T., Siegel, E., Hallam-Baker, P., and D. Crocker, &ldquo;DomainKeys Identified Mail (DKIM) Development, Deployment and Operations,&rdquo; January&nbsp;2010.</span><span>)</span></a> and in Section 2 of <a class='info' href='#RFC5016'>[RFC5016]<span> (</span><span class='info'>Thomas, M., &ldquo;Requirements for a DomainKeys Identified Mail (DKIM) Signing Practices Protocol,&rdquo; October&nbsp;2007.</span><span>)</span></a>,
                this definition is in terms of the Author Domain Signature and avoids statements
                about any header field dependencies.
</p>
</blockquote><p>
          
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.3"></a><h3>2.2.3.&nbsp;
Third Party Signer</h3>

<p>A "Third Party Signer" is a signer that adds a valid DKIM signature that references a
            Third Party Domain with the 'd=' tag in the DKIM-Signature header field.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.4"></a><h3>2.2.4.&nbsp;
TPA-Label Listed Domain</h3>

<p>TPA-Label Listed Domain, TPA-LLD, is a domain TXT resource record that can be
            referenced with a TPA-Label within an Author Domain. When a "tpa" tag exists within the
            TXT resource record located at the TPA-Label, the referenced domain must be within a
            listed domain. When this tag does not exist, the referenced domain is presumed listed.
            The "scope" tag provides the TPA-LLD authorization, limited to the scoped message
            elements, to act on behalf of Author Domain publishing the TPA-Label Resource
            Record.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.5"></a><h3>2.2.5.&nbsp;
Author's Domain Acceptable Third-Party Signature</h3>

<p>An "Author's Domain Acceptable Third-Party Signature" is a Valid Signature in which the
            domain name of the DKIM signing entity, i.e., the 'd=' tag in the DKIM-Signature header
            field, is the domain name referenced in the TPA-Label Resource Record published by the
            Author Domain with a scope of 'F', or 'L' when the List-ID is within the TPA-LLD.
            Following <a class='info' href='#RFC5321'>[RFC5321]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a>, domain name comparisons as well as TPA-Labels are
            case insensitive.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
TPA-Label Resource Record Authorization Considerations</h3>

<p>When an Author Domain is not within the DKIM signing domain, the TPA-LLD scheme can safely
        extend ADSP signing practice compliance. The TPA-LLD scheme with an 'F' or 'L' scope permits
        a contained Third Party Signature to be treated as a Author Domain Signature. This avoids a
        need for Author Domains to always be within the public key reference for compliance with
        restrictive ADSP signing practices. The TPA-LLD scheme for offering valid signatures only
        requires that DNS publications be made by Author Domains, even when signing domains and the
        Author Domain differ. This approach also avoids any need to exchange DKIM key information as
        well.
</p>
<p>While offering only valid signatures will not ensure all possible spoofing is prevented,
        messages signed in this manner should not receive annotations that indicate the message
        contains authenticated identities either. The TPA-LLD scheme plays the role of only
        providing acceptable signatures which might be suitable for non-critical messages, where the
        goal would be to improve delivery acceptance, such as those from specific mailing-lists.
        Before TPA-LLD authorization is deployed, the Author Domain should be assured by the domains
        being authorized that appropriate measures are in place to authenticate those submitting
        messages.
</p>
<a name="eval-3p-signing-domain"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Evaluating the Third-party Signing Domain</h3>

<p>An Author Domain deploying a TPA-Label Resource Record for a Third Party Signer does so
          on a trust basis. Reasons for deploying TPA-Label Resource Records might be to allow
          selective deployment of more stringent ADSP records, such as "dkim=all". TPA-Label
          Resource Records can help reduce the receiver's reliance upon reputation services when
          evaluating any signing practice compliance exception. In addition, most reputation
          services use IP addresses, rather than domains, as their basis for evaluation. An IP
          address basis reduces the benefits that might be obtained by using DKIM signatures.
          TPA-Label Resource Record authorization by-name scheme can influence whether a message is
          accepted or rejected, and might even impact the reputation of the Author Domain
          itself.
</p>
<p>This act of trust can be abused by Bad Actors when an authorized Third Party Signer does
          not employ necessary authentication control to ensure messages are from an Author Address
          before applying their signature. A lack of authentication control may result in Bad Actors
          successfully spoofing an email as being from an Author Address by exploiting the
          authorization granted by a TPA-Label Resource Record.
</p>
<a name="tpa-auth"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
Third Party Authentication</h3>

<p>The Author Domain SHOULD ensure the Authorization Scope of the TPA-Label Resource
            Record is authenticated. There are a number of ways email can be authenticated, and
            different authentication mechanism validate different parts of the email. The following
            are examples of how authentication might work:
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.1"></a><h3>3.1.1.1.&nbsp;
Third Party Authentication - Web Email Provider with Subscriber Pingbacks</h3>

<p>The Author Domain "example.com" wants to deploy a TPA-Label Resource Record to permit
              their traveling agents the use of "webmail.example.net" services. This email provider
              has a closed user policy and adds DKIM signatures to messages on behalf of the
              "webmail.example.net" domain.
</p>
<p>The closed user policy of "webmail.example.net" permits subscribers to post messages
              with Author Domains that are not "webmail.example.net" in the From header fields only
              when control of the Author Addresses has been validated by a response to an encoded
              "pingback" email. The "webmail.example.net" service also establishes accounts to
              authenticate all users sending messages through their service. Therefore, the
              referenced TPA-Label Resource Record can include an 'F' scope value to authorize
              Author Domain messages to be signed by this Third-Party Signer.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.2"></a><h3>3.1.1.2.&nbsp;
Third Party Authentication - Closed Mailing List Example</h3>

<p>The Author Domain wants to deploy a TPA-Label Resource Record for a mailing list with
              a closed posting policy that redistributes email in a way that breaks Author Domain
              Signatures, but that adds a DKIM signature on behalf of their domain and includes an
              Authentication-Results header field for posted messages. The closed posting policy is
              enforced by requiring subscribers to validate their control of their Author Address by
              responding to encoded "pingback" email sent to this address.
</p>
<p>Because the list management always verifies control of the Author Address, is
              configured to include Authentication-Results headers, the referenced TPA-Label
              Resource Record can include an 'L' scope value to permit Author Domain messages
              containing an authorized List-ID domain to be signed by this Third-Party Signer.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.3"></a><h3>3.1.1.3.&nbsp;
Third Party Authentication - Open Mailing List Example</h3>

<p>The Author Domain wants to deploy a TPA-Label Resource Record for a mailing list with
              an open posting policy that redistributes email in a way that breaks Author Domain
              Signatures, but that adds a DKIM signature on behalf of their domain and includes an
              Authentication-Results header field for posted messages. The open posting policy will
              refuse messages lacking Author Domain Signatures for domains that have deployed an
              ADSP signing practice of "dkim=all" or "dkim=discardable".
</p>
<p>Because the list management always refuses the posting of an Author Address lacking a
              Author Domain Signature when the domain has deployed an ADSP record with an "dkim=all"
              or "dkim=discardable", and is configured to include Authentication-Results headers,
              the referenced TPA-Label Resource Record can include an 'L' scope value to permit
              Author Domain messages containing an authorized List-ID domain to be signed by this
              Third-Party Signer.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.4"></a><h3>3.1.1.4.&nbsp;
Third Party Authentication Example - Sender Header Field</h3>

<p>Author Domain "example.com" wishes to temporarily employ the service agency
              "temp.example.org" to handle overflow secretarial support. The agency
              "temp.example.org" sends email on behalf of the executive staff of "example.com" and
              adds the Sender header field of "secretary@example.org" in the email. Since
              "temp.example.org" only allows its own staff to email through its server that adds
              "temp.example.org" DKIM signatures, a TPA-LLD can include the "temp.example.org"
              domain with 'O' and 'F' scope to specifically authorize the use of the Sender header
              field to help ensure these messages are not detected as a phishing attempt.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.5"></a><h3>3.1.1.5.&nbsp;
Third Party Authentication Example - SMTP Host</h3>

<p>Author Domain "example.com" makes use of Virtual Private Servers to handle their
              enterprise services. This VPS service provides a shared outbound SMTP server with the
              host name given by the EHLO command as "vps.example.net". The Author Domain can
              authorize the domain "vps.example.net" with the scope of 'H' to improve acceptance of
              DKIM signed messages that are on behalf of "example.com" from this outbound
              server.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Abuse and DSN Reporting</h3>

<p>The ancillary scopes available within the TPA-LLD records allow the Author Domain to be
        associated with SMTP Clients publicly transmitting messages and/or the Mail return path when
        these domains differ. Appropriate DSN or abuse reporting is better assured as a result. The
        correspondence between SMTP Client hosts and Mail return path can be affirmed by the TPA-LLD
        scheme with a scope of 'H' or 'M' that might be used to better categorize feedback data or
        DSN destinations. In addition, a correspondence with SMTP Client hosts may help in
        determining which outbound SMTP Clients are to be monitored for consistent IP address use.
        Relationships established between email related domains and stable hosts by the TPA-LLD
        scheme may provide both improved message acceptance and reporting criteria.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
DNS Representation</h3>

<p>The receiver obtains domain authorizations with a DNS query for an IN class TXT TPA-Label
        resource record located below the ADSP record location specified in <a class='info' href='#RFC5617'>[RFC5617]<span> (</span><span class='info'>Allman, E., Fenton, J., Delany, M., and J. Levine, &ldquo;DomainKeys Identified Mail (DKIM) Author Domain Signing Practices (ADSP),&rdquo; August&nbsp;2009.</span><span>)</span></a>
        section 4.3. The TPA-Label is normally generated by processing the domain referenced within
        the DKIM signature's "d=" parameter. A TPA-Label Resource Record is then published below the
          <a class='info' href='#RFC5617'>[RFC5617]<span> (</span><span class='info'>Allman, E., Fenton, J., Delany, M., and J. Levine, &ldquo;DomainKeys Identified Mail (DKIM) Author Domain Signing Practices (ADSP),&rdquo; August&nbsp;2009.</span><span>)</span></a> conventional ADSP record, for example below
        "._adsp.domainkey.&lt;Author-Domain&gt;". The Author Domain provides authorization
        for other domains with the existence of a TPA-Label TXT resource record that when a "tpa"
        tag value exists, it includes the referenced domain. Authorization to act on behalf of the
        Author Domain is limited by the "scope" tag value to specific message elements.
</p>
<p>Character-strings contained within the TXT resource record are concatenated into forming a
        single string. A character-string is a single length octet followed by that number of
        characters treated as binary information. As an example, a TPA-Label Resource Record may be
        located at these domains:</p>
<blockquote class="text">
<p>
</p>
<p>&lt;tpa-label&gt;._adsp._domainkey.&lt;Author-Domain&gt;.
</p>
</blockquote><p>
        <br />
<br />

</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
TPA-Label and Tag Syntax Definitions</h3>

<p>
        </p>
<blockquote class="text">
<p>"base32" function is defined in <a class='info' href='#RFC4648'>[RFC4648]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; October&nbsp;2006.</span><span>)</span></a>.<br />
<br />

</p>
<p>"sha1" function is defined in <a class='info' href='#FIPS.180-2.2002'>[FIPS.180&#8209;2.2002]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;Secure Hash Standard,&rdquo; August&nbsp;2002.</span><span>)</span></a>.<br />
<br />

</p>
<p>"lcase" converts upper-case ALPHA characters to lower-case.<br />
<br />

</p>
<p>"signing-domain" is the "d=" tag value defined in Section 3.5 of <a class='info' href='#RFC4871'>[RFC4871]<span> (</span><span class='info'>Allman, E., Callas, J., Delany, M., Libbey, M., Fenton, J., and M. Thomas, &ldquo;DomainKeys Identified Mail (DKIM) Signatures,&rdquo; May&nbsp;2007.</span><span>)</span></a>.<br />
<br />

</p>
</blockquote><p> Augmented BNF for Syntax Specifications:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
          asterisk = %x2A ; "*"
          dash = %x2D ; "-"
          dot = %x2E ; "."
          underscore = %x5F ; "_"
          ANY = asterisk dot ; "*."
          dns-char = ALPHA / DIGIT / dash
          id-prefix = ALPHA / DIGIT
          label = id-prefix [*61dns-char id-prefix]
          sldn = label dot label
          base-char = (dns-char / underscore)
          domain = *(label dot) sldn
          tpa-label = underscore base32( sha-1( lcase(signing-domain)))
</pre></div>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
TPA-Label Generation</h3>

<p>The TPA-Label is created from the hash value returned by the "sha1" function of the
        signing-domain expressed in lower case ASCII. The hash is then converted to a base32
        character set, with the resulting label prefixed with an underscore. Any terminating period
        is not included with the signing-domain, as indicated by the ABNF definition. <br />
<br />
</p>
<blockquote class="text">
<p>Note: No newline character, 0x0A, is to be appended to the end of the domain name, as
            might occur with the command line generation of SHA1 values. Command line appended
            newlines can be avoided by using the 'echo -n" option, for example.
</p>
</blockquote>

<a name="tpalabel-rr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
TPA-Label TXT Resource Record Structure</h3>

<p>Every TPA-Label TXT resource record MUST start with an outbound signing-practices tag, so
        the first four characters of the record are lowercase "dkim", followed by optional
        whitespace and "=". In addition to the tags defined by <a class='info' href='#RFC5617'>[RFC5617]<span> (</span><span class='info'>Allman, E., Fenton, J., Delany, M., and J. Levine, &ldquo;DomainKeys Identified Mail (DKIM) Author Domain Signing Practices (ADSP),&rdquo; August&nbsp;2009.</span><span>)</span></a>, TPA-Label
        syntax descriptions for additional tags follow the tag-value syntax described in section
        4.2.1 of <a class='info' href='#RFC5617'>[RFC5617]<span> (</span><span class='info'>Allman, E., Fenton, J., Delany, M., and J. Levine, &ldquo;DomainKeys Identified Mail (DKIM) Author Domain Signing Practices (ADSP),&rdquo; August&nbsp;2009.</span><span>)</span></a> and section 3.2 of <a class='info' href='#RFC4871'>[RFC4871]<span> (</span><span class='info'>Allman, E., Callas, J., Delany, M., Libbey, M., Fenton, J., and M. Thomas, &ldquo;DomainKeys Identified Mail (DKIM) Signatures,&rdquo; May&nbsp;2007.</span><span>)</span></a>. Unrecognized
        tags and tags with illegal values MUST be ignored. In the ABNF below, the WSP token is
        inherited from <a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a>. The ALPHA and DIGIT tokens are imported from <a class='info' href='#RFC5234'>[RFC5234]<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>.
</p>
<p>The tags used in TPA-Label resource records are as follows:
</p><br /><hr class="insert" />
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="left">
<tr><th align="center">Tag</th><th align="left">Function</th></tr>
<tr>
<td align="center">scope=</td>
<td align="left">Authorization Scope List (as-list)</td>
</tr>
<tr>
<td align="center">tpa=</td>
<td align="left">Authorized Domains List (ad-list)</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;TPA-Label Extended Tags&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center" width="10%"><col align="left">
<tr><th align="center">Scope Values</th><th align="left">Field or Parameter</th></tr>
<tr>
<td align="center">F</td>
<td align="left">From (Author) Header</td>
</tr>
<tr>
<td align="center">L</td>
<td align="left">List-ID</td>
</tr>
<tr>
<td align="center">O</td>
<td align="left">Other than From (Author) Headers</td>
</tr>
<tr>
<td align="center">M</td>
<td align="left">MailFrom</td>
</tr>
<tr>
<td align="center">H</td>
<td align="left">SMTP Host</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;TPA-Label Scope Values&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="scope-defn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
TPA-Label Resource Record Scope Syntax</h3>

<p>scope= Authorization Scope List (Optional). This tag defines a list of scoping assertions
          for various email-address locations within the message. Only recognized scope values offer
          any form of DKIM authorization.
</p>
<p>
          </p>
<blockquote class="text">
<p>scope = "F" / "L" / "O" / "M" / "H"
</p>
<p>as-list = "scope" [WSP] "=" [WSP] scope 0*([WSP] ":" [WSP] scope)
</p>
</blockquote><p>
        
</p>
<a name="scopeF-defn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.1"></a><h3>8.1.1.&nbsp;
TPA-Label Listed Domain Authorization</h3>

<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.1.1"></a><h3>8.1.1.1.&nbsp;
From (Author) Header Field</h3>

<p>The "F" scope asserts that messages carrying the Author Domain within the From header
              field are authorized to be signed by the TPA-LLD. When the Third Party Signing Domain
              is within the TPA-LLD, then the signing practice, the value of the "dkim" tag, can
              supersede the signing practice generally asserted by the conventional ADSP
                record.<br />
<br />

</p>
<a name="scopeL-defn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.2"></a><h3>8.1.2.&nbsp;
List-ID Header Field</h3>

<p>The "L" scope asserts that a List-ID identifier of the List-ID header field <a class='info' href='#RFC2919'>[RFC2919]<span> (</span><span class='info'>Chandhok, R. and G. Wenger, &ldquo;List-Id: A Structured Field and Namespace for the Identification of Mailing Lists,&rdquo; March&nbsp;2001.</span><span>)</span></a> that is within the TPA-LLD are also authorized. When the LIST-ID is
            within the TPA-LLD, then the signing practice, the value of the "dkim" tag, can
            supersede the signing practice generally asserted by the conventional ADSP record. When
            'L' is used in absence of the 'F' scope, then an 'F' scope is assumed only when List-ID
            is authorized. Asserting a signing practice of "unknown" for an TPA-LLD might be used to
            aid acceptance of messages from mailing lists that have not yet adopted use of
              DKIM.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.3"></a><h3>8.1.3.&nbsp;
Ancillary Use of Domain Authorizations</h3>

<p>Ancillary Authorizations will not alter TPA-LLD results.
</p>
<a name="scopeO-defn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.3.1"></a><h3>8.1.3.1.&nbsp;
Other Originating Header Fields</h3>

<p>The "O" scope asserts that messages with Sender, Resent-From, or Resent-Sender header
              fields with email-address domains within the TPA-LLD are also authorized.<br />
<br />

</p>
<a name="scopeM-defn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.3.2"></a><h3>8.1.3.2.&nbsp;
MailFrom Parameter</h3>

<p>This "M" scope asserts that an email-address domain that is within a TPA-LLD used in
              the <a class='info' href='#RFC5321'>[RFC5321]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a> MAIL command is also authorized.<br />
<br />

</p>
<a name="scopeH-defn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.3.3"></a><h3>8.1.3.3.&nbsp;
SMTP Host domains</h3>

<p>The "H" scope asserts that host names given in <a class='info' href='#RFC5321'>[RFC5321]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a> EHLO or HELO
              commands within TPA-LLD are also authorized. This scope might be used to better ensure
              DKIM signatures within messages from these hosts are validated.<br />
<br />

</p>
<a name="tpa-defn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Authorized Signing Domain</h3>

<p>tpa= Authorized Signing Domain list. (optional) This tag when present, MUST repeat all or
        portions of the domain encoded within the TPA-Label Resource Record. This option ensures the
        proper handling of possible hash collisions. When a domain is prefixed with the "*." ANY
        label, then all subdomains of this domain are to be considered included within the list.
        When the 'tpa' tag is not present or has no value, it should be assumed to compare with the
        domain used to generate the TPA-Label.
</p>
<p>
        </p>
<blockquote class="text">
<p>ad = [ANY] domain
</p>
<p>ad-list = "tpa" [WSP] "=" [WSP] ad 0*([WSP] ":" [WSP] ad)
</p>
<p>
            <br />
<br />

          
</p>
</blockquote><p>
      
</p>
<a name="tpa-qt"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
TPA-Label Resource Record Query Transactions</h3>

<p>The discovery of TPA-Label resource records need not be subsequent to the discovery of the
        ADSP record specified by <a class='info' href='#RFC5617'>[RFC5617]<span> (</span><span class='info'>Allman, E., Fenton, J., Delany, M., and J. Levine, &ldquo;DomainKeys Identified Mail (DKIM) Author Domain Signing Practices (ADSP),&rdquo; August&nbsp;2009.</span><span>)</span></a>. However, when no ADSP record is
        discovered, the verifier MAY assume that no TPA-Label Resource Records have been published
        below this location. Otherwise, when there is a Third Party Signature without any Author
        Domain Signature, then the discovery of TPA-Label Resource Records should be attempted. The
        discovery of a TPA-Label Resource Record may be attempted for LIST-ID domains as well.
</p>
<a name="auth-meaning"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
TPA-Label Resource Record Compliance Assessment</h3>

<p>Signing practice compliance assessment of Third Party Signatures is a discretionary
        operation performed by the verifier. Where a verifier decides to assess compliance with
        signing practices asserted by the Author Domain for Third Party Signatures, all of the
        following conditions MUST be met for the result to be considered a pass.
</p>
<p>
        </p>
<ul class="text">
<li>The Third Party Signature MUST validate according to <a class='info' href='#RFC4871'>[RFC4871]<span> (</span><span class='info'>Allman, E., Callas, J., Delany, M., Libbey, M., Fenton, J., and M. Thomas, &ldquo;DomainKeys Identified Mail (DKIM) Signatures,&rdquo; May&nbsp;2007.</span><span>)</span></a>.
</li>
<li>The TPA-Label TXT Resource Record MUST exist in DNS.
</li>
<li>The TPA-Label TXT Resource Record Structure MUST be valid.
</li>
<li>Where a scope of "F" is specified, then the Author Domain MUST have an Author Domain
            Signature or an Author's Domain Acceptable Third-Party Signature.
</li>
<li>Where a scope of "L" is specified, then when a List-ID identifier in the List-ID header
            field is within the TPA-LLD, then the Author Domain MUST have an Author Domain Signature
            or an Author's Domain Acceptable Third-Party Signature.
</li>
</ul><p>
      
</p>
<p>When the TPA-Label TXT Resource Record can not be retrieved due to some error that is
        likely transient in nature, as specified in <a class='info' href='#RFC5617'>[RFC5617]<span> (</span><span class='info'>Allman, E., Fenton, J., Delany, M., and J. Levine, &ldquo;DomainKeys Identified Mail (DKIM) Author Domain Signing Practices (ADSP),&rdquo; August&nbsp;2009.</span><span>)</span></a> Section 4.3. such as
        "SERVFAIL" for example, the result of the TPA-Label Resource Record compliance assessment is
        "temperror".
</p>
<p>When the TPA-Label TXT Resource Record can not be retrieved with a DNS "NOERROR" with zero
        or more than one TXT records, the result of the TPA-Label Resource Record compliance
        assessment is "permerror".
</p>
<p>When the TPA-Label TXT Resource Record can not be retrieved with a DNS "NXDOMAIN",the
        result of the TPA-Label Resource Record compliance assessment is "nxdomain".
</p>
<p>When one or more valid Third-Party Signatures are present in the message, then:<br />
<br />
</p>
<ul class="text">
<li>When a TPA-Label Resource Record referenced from the Author Domain has a scope tag of
            "F", and the TPA-LLD represents the domain of the DKIM signing entity, then the message
            is considered signed with an Author Domain Acceptable Third-Party Signature.<br />
<br />

</li>
<li>When a TPA-Label Resource Record referenced from the Author Domain has a scope tag of
            "L", and the List-ID given by <a class='info' href='#RFC2919'>[RFC2919]<span> (</span><span class='info'>Chandhok, R. and G. Wenger, &ldquo;List-Id: A Structured Field and Namespace for the Identification of Mailing Lists,&rdquo; March&nbsp;2001.</span><span>)</span></a> in the List-ID header is within
            the TPA-LLD, and the TPA-LLD represents the domain of the DKIM signing entity, then the
            message is considered signed with an Author Domain Acceptable Third-Party
              Signature.<br />
<br />

</li>
<li>When a TPA-Label Resource Record referenced from the Author Domain returns a TXT
            resource record that has a scope tag of "O", and the email-address domain within the
            Sender, Resent-From, or Resent-Sender headers are within the TPA-LLD, use of these
            headers by this domain is authorized by the Author Domain.<br />
<br />

</li>
<li>When a TPA-Label Resource Record referenced from the Author Domain returns a TXT
            resource record that has a scope tag of "M", and the email-address domain within the
              <a class='info' href='#RFC5321'>[RFC5321]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a> MAIL command is within the TPA-LLD, use of this command by
            this domain is authorized by the Author Domain.<br />
<br />

</li>
<li>When a TPA-Label Resource Record referenced from the Author Domain returns a TXT
            resource record that has a scope tag of "H", and a host domain given by <a class='info' href='#RFC5321'>[RFC5321]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a> EHLO or HELO command is within the TPA-LLD, the SMTP client is
            authorized by the Author Domain.<br />
<br />

</li>
</ul><p>
      
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
IANA Considerations</h3>

<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
Email Authentication Method Registry</h3>

<p>To accommodate the method derived from TPA-Label Resource Record processing, The IANA
          Registry "Email Authentication Method" defined by Section 6.2 of <a class='info' href='#RFC5451'>[RFC5451]<span> (</span><span class='info'>Kucherawy, M., &ldquo;Message Header Field for Indicating Message Authentication Status,&rdquo; April&nbsp;2009.</span><span>)</span></a>
          needs the following elements to be added:
</p>
<p>Note to RFC EDITOR: This is currently located at:
          http://www.iana.org/assignments/email-auth/email-auth.xhtml#email-auth-methods 
</p><br /><hr class="insert" />
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="center" width="10%"><col align="center" width="10%"><col align="left"><col align="left">
<tr><th align="left">Method</th><th align="center">Defined</th><th align="center">ptype</th><th align="left">property</th><th align="left">value</th></tr>
<tr>
<td align="left">tpa-lld</td>
<td align="center">[THIS DOCUMENT]</td>
<td align="center">header</td>
<td align="left">d</td>
<td align="left">value of signature "d" tag. The dkim method results from <a class='info' href='#RFC5451'>[RFC5451]<span> (</span><span class='info'>Kucherawy, M., &ldquo;Message Header Field for Indicating Message Authentication Status,&rdquo; April&nbsp;2009.</span><span>)</span></a>
            should also be included in a Authenticated Results header field</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="center">&nbsp;</td>
<td align="center">&nbsp;</td>
<td align="left">scope</td>
<td align="left">value of <a class='info' href='#scope-registry'>scope<span> (</span><span class='info'>Third Party Authorizations Scope Registry</span><span>)</span></a> tag. (When 'scope' contains 'H',
            the <a class='info' href='#RFC5451'>iprev<span> (</span><span class='info'>Kucherawy, M., &ldquo;Message Header Field for Indicating Message Authentication Status,&rdquo; April&nbsp;2009.</span><span>)</span></a> [RFC5451] (Section 3) method results should also be
            included in the Authenticated-Results header field)</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="center">&nbsp;</td>
<td align="center">&nbsp;</td>
<td align="left">ca-scope</td>
<td align="left">The <a class='info' href='#scope-registry'>scopes<span> (</span><span class='info'>Third Party Authorizations Scope Registry</span><span>)</span></a> with a compliance assessment as
            pass</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="center">&nbsp;</td>
<td align="center">&nbsp;</td>
<td align="left">tpa</td>
<td align="left">Value of <a class='info' href='#tpa-defn'>tpa<span> (</span><span class='info'>Authorized Signing Domain</span><span>)</span></a> tag at time of compliance assessment</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;TPA-Label Resource Record validation Method&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
          
        
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
Email Authentication Result Names Registry</h3>

<p>To accommodate the results derived from TPA-Label Resource Record processing, The IANA
          Registry "Email Authentication Method" defined by Section 6.3 of <a class='info' href='#RFC5451'>[RFC5451]<span> (</span><span class='info'>Kucherawy, M., &ldquo;Message Header Field for Indicating Message Authentication Status,&rdquo; April&nbsp;2009.</span><span>)</span></a>
          needs the following elements added:
</p>
<p>Note to RFC EDITOR: This is currently located at:
          http://www.iana.org/assignments/email-auth/email-auth.xhtml#email-auth-result-names
</p><br /><hr class="insert" />
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left" width="20%"><col align="left"><col align="left">
<tr><th align="left">code</th><th align="left">method</th><th align="left">meaning</th></tr>
<tr>
<td align="left">none</td>
<td align="left">tpa-lld</td>
<td align="left">No TPA-Label was published</td>
</tr>
<tr>
<td align="left">pass</td>
<td align="left">tpa-lld</td>
<td align="left">section <a class='info' href='#auth-meaning'>Section&nbsp;11<span> (</span><span class='info'>TPA-Label Resource Record Compliance Assessment</span><span>)</span></a></td>
</tr>
<tr>
<td align="left">tempfail</td>
<td align="left">tpa-lld</td>
<td align="left">section <a class='info' href='#auth-meaning'>Section&nbsp;11<span> (</span><span class='info'>TPA-Label Resource Record Compliance Assessment</span><span>)</span></a></td>
</tr>
<tr>
<td align="left">permfail</td>
<td align="left">tpa-lld</td>
<td align="left">section <a class='info' href='#auth-meaning'>Section&nbsp;11<span> (</span><span class='info'>TPA-Label Resource Record Compliance Assessment</span><span>)</span></a></td>
</tr>
<tr>
<td align="left">unknown</td>
<td align="left">tpa-lld</td>
<td align="left">The TPA-Label Resource Record had a tag/value of "dkim=unknown" and the Third Party
            Signature failed its compliance assessment.</td>
</tr>
<tr>
<td align="left">discard</td>
<td align="left">tpa-lld</td>
<td align="left">The TPA-Label Resource Record had a tag/value of dkim=discard and the Third Party
            Signature failed its compliance assessment.</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">tpa-lld</td>
<td align="left">The TPA-Label Resource Record had a tag/value of dkim=all and the Third Party Signature
            failed to its compliance assessment.</td>
</tr>
<tr>
<td align="left">nxdomain</td>
<td align="left">tpa-lld</td>
<td align="left">When obtaining the TPA-Label Resource Record, DNS indicated this domain does not exist. </td>
</tr>
<tr>
<td align="left">Other value defined in the IANA ADSP Outbound Signing Practices Registry</td>
<td align="left">tpa-lld</td>
<td align="left">The TPA-Label Resource Record had a tag/value of dkim={other value} and the Third Party
            Signature failed to its compliance assessment.</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;TPA-Label Resource Record complaince assessment Results&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3"></a><h3>12.3.&nbsp;
Third Party Authorizations Labels Registry</h3>

<p>Names of tags that are valid in TPA-Label Resource Records with the exception of
          experimental tags <a class='info' href='#tpalabel-rr'>Section&nbsp;8<span> (</span><span class='info'>TPA-Label TXT Resource Record Structure</span><span>)</span></a> MUST be registered in this created IANA
          registry.
</p>
<p>New entries are assigned only for values that have been documented in a published RFC
          that has had IETF Review, per <a class='info' href='#RFC5226'>IANA CONSIDERATIONS<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a> [RFC5226].
</p>
<p>Each tag registered must correspond to a definition.
</p>
<p>The initial set of values for this registry is:
</p><br /><hr class="insert" />
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">tag</th><th align="left">defined</th><th align="left">definition</th></tr>
<tr>
<td align="left">dkim</td>
<td align="left">
            <a class='info' href='#tpalabel-rr'>Section&nbsp;8<span> (</span><span class='info'>TPA-Label TXT Resource Record Structure</span><span>)</span></a>
          </td>
<td align="left">As per IANA Registry ADSP Outbound Signing Practices</td>
</tr>
<tr>
<td align="left">scope</td>
<td align="left">
            <a class='info' href='#scope-defn'>Section&nbsp;8.1<span> (</span><span class='info'>TPA-Label Resource Record Scope Syntax</span><span>)</span></a>
          </td>
<td align="left">
            <a class='info' href='#scope-registry'>Section&nbsp;12.4<span> (</span><span class='info'>Third Party Authorizations Scope Registry</span><span>)</span></a>
          </td>
</tr>
<tr>
<td align="left">tpa</td>
<td align="left">
            <a class='info' href='#tpa-defn'>Section&nbsp;9<span> (</span><span class='info'>Authorized Signing Domain</span><span>)</span></a>
          </td>
<td align="left">List of authorized domains</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;TPA-Label Resource Record compliance assessment Results&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="scope-registry"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.4"></a><h3>12.4.&nbsp;
Third Party Authorizations Scope Registry</h3>

<p>Values that correspond to <a class='info' href='#scope-defn'>Section&nbsp;8.1<span> (</span><span class='info'>TPA-Label Resource Record Scope Syntax</span><span>)</span></a> MUST be registered in this created
          registry:
</p>
<p>New entries are assigned only for values that have been documented in a published RFC
          that has had IETF Review, per <a class='info' href='#RFC5226'>IANA CONSIDERATIONS<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a> [RFC5226].
</p>
<p>Each value registered must correspond to a definition.
</p>
<p>The initial set of values for this registry is:
</p><br /><hr class="insert" />
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">value</th><th align="left">defined</th></tr>
<tr>
<td align="left">F</td>
<td align="left">
            <a class='info' href='#scopeF-defn'>Section&nbsp;8.1.1<span> (</span><span class='info'>TPA-Label Listed Domain Authorization</span><span>)</span></a>
          </td>
</tr>
<tr>
<td align="left">L</td>
<td align="left">
            <a class='info' href='#scopeL-defn'>Section&nbsp;8.1.2<span> (</span><span class='info'>List-ID Header Field</span><span>)</span></a>
          </td>
</tr>
<tr>
<td align="left">O</td>
<td align="left">
            <a class='info' href='#scopeO-defn'>Section&nbsp;8.1.3.1<span> (</span><span class='info'>Other Originating Header Fields</span><span>)</span></a>
          </td>
</tr>
<tr>
<td align="left">M</td>
<td align="left">
            <a class='info' href='#scopeM-defn'>Section&nbsp;8.1.3.2<span> (</span><span class='info'>MailFrom Parameter</span><span>)</span></a>
          </td>
</tr>
<tr>
<td align="left">H</td>
<td align="left">
            <a class='info' href='#scopeH-defn'>Section&nbsp;8.1.3.3<span> (</span><span class='info'>SMTP Host domains</span><span>)</span></a>
          </td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;TPA-Label Resource Record compliance assessment Results&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Security Considerations</h3>

<p>This draft extends signing practices related to <a class='info' href='#RFC4871'>[RFC4871]<span> (</span><span class='info'>Allman, E., Callas, J., Delany, M., Libbey, M., Fenton, J., and M. Thomas, &ldquo;DomainKeys Identified Mail (DKIM) Signatures,&rdquo; May&nbsp;2007.</span><span>)</span></a> where most generic
        DKIM Signature related security matters are discussed there. Security considerations for the
        TPA-Label Resource Record scheme are mostly related to attempts on the part of malicious
        senders to represent themselves as other senders, often in an attempt to defraud either the
        recipient or the alleged originator. Additional security considerations regarding DKIM
        signing practices may be found in the DKIM threat analysis <a class='info' href='#RFC4686'>[RFC4686]<span> (</span><span class='info'>Fenton, J., &ldquo;Analysis of Threats Motivating DomainKeys Identified Mail (DKIM),&rdquo; September&nbsp;2006.</span><span>)</span></a>.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.1"></a><h3>13.1.&nbsp;
Benefits to Recipients</h3>

<p>The verifier, after finding an Author's Domain Acceptable Third-Party Signature in a
          message, has a significantly greater confidence in the Third-Party authorization than when
          the no TPA-Label Resource Record could be retrieved. This enhanced confidence may, at the
          recipients' discretion, cause a message to be delivered to recipient without further
          domain compliance assessment.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.2"></a><h3>13.2.&nbsp;
Risks to Recipients</h3>

<p>The decisions that a recipient makes with regard to message filtering based on TPA-Label
          Resource Records is likely to depend on the system integrity of the Third Party with
          respect to Authentication (see <a class='info' href='#tpa-auth'>Section&nbsp;3.1.1<span> (</span><span class='info'>Third Party Authentication</span><span>)</span></a>) and the provided scope labels.
          When the scope is not authenticated by the Third Party, there is a risk of accepting a
          potentially spoofed message.
</p>
<p>With this specification, third party signatures now have some verifiable value. When
          implementing the compliance assessment of third party signatures and TPA-Label Resource
          Records, implementers need to consider the possibility that a Bad Actor will send the
          recipient a message with a large number of valid DKIM Signatures. Verifying all of these
          may consume a large amount of processing resources and it may be worth checking the
          existence of a TPA-Label Resource Record first. <a class='info' href='#tpa-qt'>Section&nbsp;10<span> (</span><span class='info'>TPA-Label Resource Record Query Transactions</span><span>)</span></a> describes a quick
          check to see if TPA-Label Resource Records may exist. Additionally validating DKIM
          signatures and obtaining related resource records might be limited to known trustworthy
          domains.
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.3"></a><h3>13.3.&nbsp;
Benefits to Author Domains</h3>

<p>TPA-Label resource records can replace domain delegations, selector/key record mirroring,
          or key exchanges. Significant amounts of detail is associated with selector/key records.
          These details include user limitations, suitable services, key resource record's
          Time-To-Live, revocation and update procedures, and how the DKIM Signature header field's
          'i=' semantics are to be applied. In addition, to better secure services that might depend
          upon DKIM keys, rather than delegating DKIM keys, the TPA-LLD scheme allows Author Domains
          an ability to limit the scope of their authorizations, without being mistaken for having
          authenticated the entity submitting the message, or for running ancillary services that
          may make use of DKIM public keys.
</p>
<p>TPA-Label Resource Records convey which third-party domains are authoritative. However,
          third-party domains are unable to utilize DKIM signature's 'i=' semantics to directly
          assert which identifiers on whose behalf a signature was added. As such, no third-party
          domain should be authorized unless it is trusted to ensure the Alleged Author of an email
          undergoes some form authentication that offers acceptable protections for the Author
          Domain. Such authentication might be to ensure submitting entities have demonstrated
          receipt of "pingback" messages sent to the Author Address contained within the messages
          being signed, for example.
</p>
<p>Author Domains benefit by deploying TPA-Label Resource Records in that a recipient who
          assesses signing practice compliance using the TPA-LLD scheme is less likely to drop
          messages from their domain. In addition, the authorized third party domains are less
          likely to need reputations for the recipient to validate the signature and assess the
          message for compliance with signing practices.
</p>
<p>Scope labels provide a fine grained control that allows the Author Domain to limit
          message attributes even from the authorized third parties.
</p>
<p>Signing domains having good reputations referenced by a TPA-LLD might therefore provide a
          means to safely extend limited compliance assessment resources to otherwise unknown Author
          Domains or SMTP Clients.
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.4"></a><h3>13.4.&nbsp;
Risks to Author Domains</h3>

<p>As indicated in <a class='info' href='#eval-3p-signing-domain'>Section&nbsp;3.1<span> (</span><span class='info'>Evaluating the Third-party Signing Domain</span><span>)</span></a>, there is ultimately a trust of
          the third party domain to do the right thing and not generate or allow others to generate
          messages that appear to be from the Author Domain. The compliance assessment mechanisms
          deployed need to carefully match the scope of the TPA records.
</p>
<p>By authorizing some mailing lists with TPA-Label Resource Records there could be a loss
          of confidentiality in respect to mailing list domain participation by the Author Domain.
          This might then help Bad Actors deduce which subscription email the Author Domain might
          receive. Because of the hashing function in generating the TPA-label, anyone wishing to
          find out the authorized domains has to probe each TPA-label based on the exact signing
          domain.
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.5"></a><h3>13.5.&nbsp;
Benefits to Third Party Signers</h3>

<p>Third Party Signers benefit by having the autonomy to deploy and change DKIM signing
          without consultation with Author Domains. This is particularly useful for mailing lists.
        
</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.6"></a><h3>13.6.&nbsp;
Risks caused by Third Party Signers</h3>

<p>Third Party Signers as mentioned before need to authenticate in some way messages from
          Author Domains. This authentication provides a safety mechanism for the Author Domain and
          the recipient. The Third Party may not be aware of the value of the authentication and
          change this without understanding the negative impact this may have on the author and
          recipient domains. The Third Party also may stop DKIM signing messages also causing a
          detriment to both author and recipient.
</p>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.7"></a><h3>13.7.&nbsp;
SHA-1 Collisions</h3>

<p>The use of the SHA-1 hash algorithm does not represent a security concern. The hash
          simply ensures a deterministic domain-name size is achieved. Unexpected collisions can be
          detected and handled by using the extended TPA-Label Resource Record "tpa=" option. The
          use of TPA-Label Resource Records without the TPA-Label "tpa=" options does present an
          opportunity for an adversary to attempt to find a hash collision. Message spoofing outside
          the realm of DKIM protection is still likely to be easier to achieve than finding hash
          collisions.
</p>
<a name="DNS"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.8"></a><h3>13.8.&nbsp;
DNS Limits</h3>

<p>Use of the TPA-Label Resource Records, rather than simply listing the authorized domain,
          ensures the DNS record size is independent of the Third Party Domain. The typical domain
          name size has been steadily increasing. This increase has been caused by domain names that
          encode international character sets, and perhaps soon an increase will be spurred by an
          expanse of TLDs having larger labels.
</p>
<p>Using TPA-Label Resource Records in the DNS, as described by this scheme, leaves a
          residual size of 430 for the length of the author domain and the resource record content.
          DNS servers that add additional resource records, for nameservers as an example, will
          further limit this size. Author Domains exceeding this length will need to rely on the
          recipients using TCP for DNS retrieval or extended DNS lengths <a class='info' href='#RFC2671'>[RFC2671]<span> (</span><span class='info'>Vixie, P., &ldquo;Extension Mechanisms for DNS (EDNS0),&rdquo; August&nbsp;1999.</span><span>)</span></a>.
          Normally, DNS messages should not exceed 512 bytes as per Section 2.3.4 of <a class='info' href='#RFC1035'>[RFC1035]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a>.
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
Acknowledgements</h3>

<p>Frank Ellermann, and Wietse Venema.<br />
<br />
<br />
<br />
<br />
<br />

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15"></a><h3>15.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>15.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="FIPS.180-2.2002">[FIPS.180-2.2002]</a></td>
<td class="author-text">National Institute of Standards and Technology, &ldquo;<a href="http://csrc.nist.gov/publications/fips/fips180-2/fips180-2.pdf">Secure Hash Standard</a>,&rdquo; FIPS&nbsp;PUB 180-2, August&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2919">[RFC2919]</a></td>
<td class="author-text">Chandhok, R. and G. Wenger, &ldquo;<a href="http://tools.ietf.org/html/rfc2919">List-Id: A Structured Field and Namespace for the Identification of Mailing Lists</a>,&rdquo; RFC&nbsp;2919, March&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc2919.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4648">[RFC4648]</a></td>
<td class="author-text">Josefsson, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>,&rdquo; RFC&nbsp;4648, October&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4648.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4871">[RFC4871]</a></td>
<td class="author-text">Allman, E., Callas, J., Delany, M., Libbey, M., Fenton, J., and M. Thomas, &ldquo;<a href="http://tools.ietf.org/html/rfc4871">DomainKeys Identified Mail (DKIM) Signatures</a>,&rdquo; RFC&nbsp;4871, May&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4871.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5234">[RFC5234]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5234.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5321">[RFC5321]</a></td>
<td class="author-text">Klensin, J., &ldquo;<a href="http://tools.ietf.org/html/rfc5321">Simple Mail Transfer Protocol</a>,&rdquo; RFC&nbsp;5321, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5321.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5322">[RFC5322]</a></td>
<td class="author-text"><a href="mailto:presnick@qualcomm.com">Resnick, P., Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc5322">Internet Message Format</a>,&rdquo; RFC&nbsp;5322, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5322.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc5322.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc5322.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5451">[RFC5451]</a></td>
<td class="author-text">Kucherawy, M., &ldquo;<a href="http://tools.ietf.org/html/rfc5451">Message Header Field for Indicating Message Authentication Status</a>,&rdquo; RFC&nbsp;5451, April&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5451.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5617">[RFC5617]</a></td>
<td class="author-text">Allman, E., Fenton, J., Delany, M., and J. Levine, &ldquo;<a href="http://tools.ietf.org/html/rfc5617">DomainKeys Identified Mail (DKIM) Author Domain Signing Practices (ADSP)</a>,&rdquo; RFC&nbsp;5617, August&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5617.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>15.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-dkim-deployment">[I-D.ietf-dkim-deployment]</a></td>
<td class="author-text">Hansen, T., Siegel, E., Hallam-Baker, P., and D. Crocker, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-dkim-deployment-11.txt">DomainKeys Identified Mail (DKIM) Development, Deployment and Operations</a>,&rdquo; draft-ietf-dkim-deployment-11 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-dkim-deployment-11.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1035">[RFC1035]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1035, November&nbsp;1987 (<a href="http://www.rfc-editor.org/rfc/rfc1035.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2671">[RFC2671]</a></td>
<td class="author-text"><a href="mailto:vixie@isc.org">Vixie, P.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2671">Extension Mechanisms for DNS (EDNS0)</a>,&rdquo; RFC&nbsp;2671, August&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2671.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4686">[RFC4686]</a></td>
<td class="author-text">Fenton, J., &ldquo;<a href="http://tools.ietf.org/html/rfc4686">Analysis of Threats Motivating DomainKeys Identified Mail (DKIM)</a>,&rdquo; RFC&nbsp;4686, September&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4686.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5016">[RFC5016]</a></td>
<td class="author-text">Thomas, M., &ldquo;<a href="http://tools.ietf.org/html/rfc5016">Requirements for a DomainKeys Identified Mail (DKIM) Signing Practices Protocol</a>,&rdquo; RFC&nbsp;5016, October&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc5016.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5226">[RFC5226]</a></td>
<td class="author-text">Narten, T. and H. Alvestrand, &ldquo;<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>,&rdquo; BCP&nbsp;26, RFC&nbsp;5226, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5226.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5672">[RFC5672]</a></td>
<td class="author-text">Crocker, D., &ldquo;<a href="http://tools.ietf.org/html/rfc5672">RFC 4871 DomainKeys Identified Mail (DKIM) Signatures -- Update</a>,&rdquo; RFC&nbsp;5672, August&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5672.txt">TXT</a>).</td></tr>
</table>

<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
DNS Example of TPA-Label Resource Record placement</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 ####
 # Practices for Example.com email domain using example.com, isp.com,
 # and example.com.isp.com as signing domains.
 ####

 #### 5322.From authorization for 3P domains ####

 ## "isp.com" TPA-Label Resource Record ##
 _HTIE4SWL3L7G4TKAFAUA7UYJSS2BTEOV._adsp._domainkey.example.com. IN TXT
    "dkim=all; tpa=isp.com; scope=F;"

 #### 5322.From/Originator/MailFrom authorization for 3P domains ####

 ## "example.com.isp.com" TPA-Label Resource Record ##
 _6MEHLQLKWAL5HQREXWDN2TBXAJ6VZ44B._adsp._domainkey.example.com.  IN TXT
    "dkim=all; tpa=*.isp.com; scope=F:O:M;"
</pre></div>
<p>
        
      
</p>
<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
C code for label generation</h3>

<p>The following utility can be compiled as tpa-label.c using the following:
</p>
<p>gcc -lcrypto tpa-label.c -o tpa-label
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
/*
 * TPA-Label generation utility
 * Copyright (C) 2009 The IETF Trust &amp; and the persons identified as
 * the document authors.  All rights reserved.
 * Redistributions of source code must retain the above copyright
 * notice and the following disclaimer.
 *
 * This document is subject to the rights, licenses and restrictions
 * contained in BCP 78, and except as set forth therein, the authors
 * retain all their rights.
 * This document and the information contained herein are provided on an
 * "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
 * OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
 * THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
 * OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
 * THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
 * WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.
 */

#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;stddef.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;ctype.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;errno.h&gt;
#include &lt;openssl/sha.h&gt;

#define TPA_LABEL_VERSION   102
#define MAX_DOMAIN_NAME     256
#define MAX_FILE_NAME       1024

static char base32[] = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
static char sign_on[] =
{"%s v%d.%02d Copyright (C) (2009)  The IETF Trust &amp; Douglas Otis\n"};
char err_cmd[] =\
 "ERR: Command error with [%s]\n";
char use_txt[]=\
 "Usage: tpa-label [-i domain_input_file] [-o label_output_file][-v]\n";
char help_txt[]=\
"The options are as follows:\n"\
"-i  domain name input. Defaults to stdin. Removes trailing '.'\n"\
"-o  TPA-Label output.  Defaults to stdout.\n"\
"-v  Specifies Verbose Mode.\n\n";

static void usage(void);
/*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

static void
usage(void)
{
    (void) fprintf(stderr, "\n%s%s", use_txt, help_txt);
    exit(1);
}
/*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

int
main (int argc, char * argv[])
{
    int  ret_val, in_mode, out_mode, verbose, done, i, j, k;
    char ch;
    unsigned int len;
    unsigned long long b_5;
    char in_fn[MAX_FILE_NAME], out_fn[MAX_FILE_NAME];
    unsigned char in_buf[MAX_DOMAIN_NAME + 2];
    unsigned char sha_res[20], tpa_label[33];
    FILE *in_file, *out_file;

    ret_val = in_mode = out_mode = verbose = done = 0;
    len = 0;

    while ((ch = getopt(argc, argv, "i:o:v")) != -1)
    {
        switch (ch)
        {
            case 'i':
                in_mode = 1;          /* input from file */
                (void) strncpy(in_fn, optarg, sizeof(in_fn));
                in_fn[sizeof(in_fn) - 1] = '\0';
                break;
            case 'o':
                 out_mode = 1;         /* out to file */
                 (void) strncpy(out_fn, optarg, sizeof(out_fn));
                 out_fn[sizeof(out_fn) - 1] = '\0';
                 break;
            case 'v':
                 verbose = 1;
                 break;
            case '?':
            default:
                (void) usage();
                break;
        }
    };

    if (in_mode)
    {
        if ((in_file = fopen(in_fn, "r")) == NULL)
        {
            (void) fprintf(stderr,
                           "ERR: Error opening [%s] input file.\n",
                           in_fn);
            exit(2);
        }
    }
    else
    {
        in_file = stdin;
    }

    if (out_mode)
    {
        if ((out_file = fopen(out_fn, "w")) == NULL)
        {
            (void) fprintf(stderr,
                           "ERR: Error opening [%s] output file.\n",
                           out_fn);
            exit(3);
        }
    }
    else
    {
        out_file = stdout;
    }

    if (out_mode &amp;&amp; verbose)
    {
        (void) printf(sign_on, "tpa-label utility",
                      TPA_LABEL_VERSION / 100,
                      TPA_LABEL_VERSION % 100);
    }

    for (i = 0; i &lt; MAX_DOMAIN_NAME &amp;&amp; !done; i++)
    {
        if ((ch = fgetc(in_file)) == EOF)
        {
            ch = 0;
        }
        else  if (ch == '\n' || ch == '\r')
        {
            ch = 0;
        }

        in_buf[i] = tolower(ch);

        if (ch == 0)
        {
            len = i;         /* string length */
            done = 1;
        }
    }

    if (!done)
    {
        (void) fprintf(stderr, "ERR: Domain name too long.\n");
        exit (4);
    }

    if (len &amp;&amp; in_buf[len - 1] == '.')    /* remove any trailing "." */
    {
        len--;
        in_buf[len] = 0;     /* replace trailing "." with 0 */
    }

    in_buf[len] = 0;         /* terminate string */

    if (len &lt; 2)
    {
        (void)
        fprintf(stderr,
                "ERR: Domain name [%s] too short with %d length.\n",
                in_buf,
                len);
        exit (5);
    }

    SHA1(in_buf, len, sha_res);

    if (verbose)
    {
        printf("Normalized Domain = [%s] %d, SHA-1 = ", in_buf, len);

        for (i = 0; i &lt; 20; i++)
        {
            printf("%02x", sha_res[i]);
        }
        printf("\nTPA-Label: 5 bit intervals left to right.\n");
    }

    /* process sha-1 results 4 times by 40 bits (0 to 160) */

    for (i = 0, j = 0; i &lt; 4 ; i++)
    {
        b_5 =  (unsigned long long) sha_res[(i * 5)] &lt;&lt; 32;
        b_5 |= (unsigned long long) sha_res[(i * 5) + 1] &lt;&lt; 24;
        b_5 |= (unsigned long long) sha_res[(i * 5) + 2] &lt;&lt; 16;
        b_5 |= (unsigned long long) sha_res[(i * 5) + 3] &lt;&lt; 8;
        b_5 |= (unsigned long long) sha_res[(i * 5) + 4];

        if (verbose)
        {
            printf(" {%010llX}-&gt;", b_5);
        }

        for (k = 35; k &gt;= 0; k-= 5, j++)    /* convert 40 bits (5x8) */
        {
            tpa_label[j] = base32[(b_5 &gt;&gt; k) &amp; 0x1F];

            if (verbose)
            {
                 printf(" %02X:%c",
                        (unsigned int)(b_5 &gt;&gt; k) &amp; 0x1F,
                        tpa_label[j]);
            }
        }
        if (verbose)
        {
            printf ("\n");
        }
    }
    if (verbose)
    {
        printf("\n");
    }

    tpa_label[j] = 0;   /* terminate label string */
    fprintf(out_file, "_%s", tpa_label);
    printf("\n");

    /* close */
    if (out_mode)
    {
        if (fclose (out_file) != 0)
        {
            (void) fprintf(stderr,
                           "ERR: Unable to close %s output file.\n",
                           out_fn);
            ret_val = 6;
        }
    }
    if (in_mode)
    {
        if (fclose (in_file) != 0)
        {
            (void) fprintf(stderr,
                           "ERR: Unable to close %s input file.\n",
                           in_fn);
             ret_val = 7;
        }
    }
    return (ret_val);
}
</pre></div>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Douglas Otis</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Trend Micro</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">10101 N. De Anza Blvd</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cupertino, CA  95014</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1.408.257-1500</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:doug_otis@trendmicro.com">doug_otis@trendmicro.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Daniel Black</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Canberra ACT</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Australia</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:daniel.subs@internode.on.net">daniel.subs@internode.on.net</a></td></tr>
</table>
</body></html>
