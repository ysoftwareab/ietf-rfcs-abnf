<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>A packet-based method for passive performance monitoring</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Overview of the method">
<link href="#rfc.section.3" rel="Chapter" title="3 Detailed description of the method">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Packet Loss">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 One-way Delay">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Delay variation">
<link href="#rfc.section.4" rel="Chapter" title="4 Implementation strategies">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Flow-based performance monitoring">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Link-based performance monitoring">
<link href="#rfc.section.5" rel="Chapter" title="5 Implementation hints">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Traffic coloring">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Packet counting">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Data collection">
<link href="#rfc.section.6" rel="Chapter" title="6 Deployment considerations">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Flow Identification">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Flow Coloring">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Monitoring Nodes">
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 Management System">
<link href="#rfc.section.6.5" rel="Chapter" title="6.5 Scalability">
<link href="#rfc.section.6.6" rel="Chapter" title="6.6 Interoperability">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document describes a method to accomplish performance monitoring measurements on real traffic, applicable to any packet-based stream, including L2, L3, MPLS traffic, unicast and multicast. The method can be easily implemented using tools and features already available on existing routing platforms without any protocol extension and, for this reason, it does not raise any interoperability issue. However, the method could be further improved by means of some extension to existing protocols, but this aspect is left for further study and it is out of the scope of the document." />
  <meta name="description" content="This document describes a method to accomplish performance monitoring measurements on real traffic, applicable to any packet-based stream, including L2, L3, MPLS traffic, unicast and multicast. The method can be easily implemented using tools and features already available on existing routing platforms without any protocol extension and, for this reason, it does not raise any interoperability issue. However, the method could be further improved by means of some extension to existing protocols, but this aspect is left for further study and it is out of the scope of the document." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Opsawg</td>
<td class="right">M. Cociglio</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">A. Capello</td>
</tr>
<tr>
<td class="left">Intended status: Experimental Protocol</td>
<td class="right">A. Tempia Bonda</td>
</tr>
<tr>
<td class="left">Expires: September 08, 2011</td>
<td class="right">L. Castaldelli</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Telecom Italia</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">March 07, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">A packet-based method for passive performance monitoring<br />
  <span class="filename">draft-tempia-opsawg-p3m-00.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes a method to accomplish performance monitoring measurements on real traffic, applicable to any packet-based stream, including L2, L3, MPLS traffic, unicast and multicast. The method can be easily implemented using tools and features already available on existing routing platforms without any protocol extension and, for this reason, it does not raise any interoperability issue. However, the method could be further improved by means of some extension to existing protocols, but this aspect is left for further study and it is out of the scope of the document.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 08, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Overview of the method</a>
</li>
<li>3.   <a href="#rfc.section.3">Detailed description of the method</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Packet Loss</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">One-way Delay</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Delay variation</a>
</li>
<li>4.   <a href="#rfc.section.4">Implementation strategies</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Flow-based performance monitoring</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Link-based performance monitoring</a>
</li>
<li>5.   <a href="#rfc.section.5">Implementation hints</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Traffic coloring</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Packet counting</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Data collection</a>
</li>
<li>6.   <a href="#rfc.section.6">Deployment considerations</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Flow Identification</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Flow Coloring</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">Monitoring Nodes</a>
</li>
<li>6.4.   <a href="#rfc.section.6.4">Management System</a>
</li>
<li>6.5.   <a href="#rfc.section.6.5">Scalability</a>
</li>
<li>6.6.   <a href="#rfc.section.6.6">Interoperability</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Acknowledgements</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">The increasing deployment in service provider networks of highly sensitive applications demands for mechanisms able to monitor and measure network performances in terms of packet loss, one-way delay, two-way delay and delay variation.</p>
<p id="rfc.section.1.p.2">The main driver for a network operator to measure performance metrics is Service Level Agreements (SLA) verification: when a SLA is agreed between service provider and customer, it is very important for the operator to know the quality of end-user experience and whether the performance of the production network meets SLA requirements. On the other hand, performance monitoring provides useful information on the network itself, facilitating the troubleshooting and the localization of network problems.</p>
<p id="rfc.section.1.p.3">This document describes a mechanism to enable simple and efficient performamce monitoring on real traffic. The method can be applied to any kind of packet-based traffic, L2, L3, MPLS, unicast and multicast and doesn't require any protocol extension or interaction with existing protocols, releasing the mechanism from any interoperability issue. In addition, one important advantage of the mechanism is the ability to perform passive measurements: compared to active measurements performed with artificial traffic and probes, retrieving performance statistics from the real traffic has many benefits. Measurements relying on real traffic are more precise because sampled probing packets can yield biased results. Moreover, active measurements can produce inaccurate results if artificial traffic doesn't follow the same path followed by user traffic. Finally, even if probes follow the same path as the real flow, it is not guaranteed that they are treated like user traffic from a QoS point of view.</p>
<p id="rfc.section.1.p.4">There is a lot of work related to OAM and <a href="#I-D.ietf-opsawg-oam-overview">[I-D.ietf-opsawg-oam-overview]</a> provides a good overview of existing OAM mechanisms defined in IETF, ITU-T and IEEE. In IETF in particular there is a lot of work on fault detection and connectivity verification, while a minor effort is dedicated to performance monitoring. IPPM WG has defined standard metrics to measure network performance, however the metrics developed in the WG refer to an active measurement context where the devices used to measure the metrics produce their own traffic. <a href="#I-D.ietf-mpls-loss-delay">[I-D.ietf-mpls-loss-delay]</a> specifies protocol mechanisms to enable the measurement of packet loss, one-way and two-way delay and delay variation in MPLS networks.</p>
<p id="rfc.section.1.p.5">This document provides a general mechanism to enable accurate performance monitoring of any kind of traffic in a service provider network.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#brief" id="brief">Overview of the method</a>
</h1>
<p id="rfc.section.2.p.1">The method addresses primarily packet loss measurement, but it can be easily extended to one-way delay and delay variation measurements as well.</p>
<p id="rfc.section.2.p.2">In order to perform packet loss measurements on a real flow it is possible to follow several approaches. The most intuitive one consists in numbering the packets so that each router receiving that flow is able to immediately detect a missing packet. Such approach, though very simple in theory, is not as simple to achieve: it requires to insert a sequence number in each packet and to have an equipment able to extract the number and check it in real time. A similar task can be difficult to implement on real traffic: if UDP is used as the transport protocol, the sequence number is not available, on the other hand, if a higher layer sequence number (e.g. in the RTP header) is used, extracting the information from the RTP header on every packet and process it in real-time can overload the equipment.</p>
<p id="rfc.section.2.p.3">An alternative approach is to count the number of packets sent on one end of the measurement and the packets received on the other end of the measurement and to compare those two values. This operation is much simpler to implement than numbering each packet, but requires a kind of synchronization between the routers performing the measurement: in order to compare two counters it is required that they refer exactly to the same set of packets. Since a flow is continuous and cannot be stopped when a counter has to be read, it can be difficult to determine exactly at which point of time to read the counter. A possible solution to overcome this problem is to virtually split the flow in blocks inserting periodic delimitations so that each counter refers exactly to a single block of packets. The delimitation can be done f.i. inserting periodically in the flow a packet generated to this purpose.</p>
<p id="rfc.section.2.p.4">Compared to numbering, the second approach is easier to implement, however, delimiting the flow using specific packets can have some limits. First of all it requires to generate additional packets within the flow and requires the equipment to be able to process those packets.  In addition the method is vulnerable to delimiting packets losses: if a delimiting packet is loss, blocks are affected thus producing wrong measurements.</p>
<p id="rfc.section.2.p.5">The method proposed in this document follows the second approach described, but doesn't use additional packets to virtually split the flow in blocks. Instead, it "colors" the flow so that packets belonging to different consecutive blocks have a different color and all the packets belonging to the same block have the same color. Using this simple principle it is possible to efficiently measure packet loss on real traffic streams without the need to number packets or generate additional artificial packets.</p>
<p id="rfc.section.2.p.6">Considering the principles just mentioned, the method allows a network operator to perform performance monitoring on real traffic with the following advantages:</p>

<ul>
<li>easy implementation: it can be implemented using features already available on major routing platforms;</li>
<li>low computational effort;</li>
<li>highly precise packet loss measurement (single packet loss granularity);</li>
<li>applicability to any kind of traffic (L2, L3, MPLS, unicast, multicast);</li>
<li>no interoperability issues.</li>
</ul>

<p>Figure 1 represents a very simple network and shows how the method can be used to measure packet loss on different network segments: enabling the measurement on several interfaces along the path, it is possible to perform link monitoring, node monitoring or end-to-end monitoring. More generally the method is flexible enough to measure packet loss on any segment of the network.</p>
<div id="#rfc.figure.1"></div>
<div id="#Measurements"></div>
<pre>
                         Traffic flow
     ========================================================&gt;    
       +------+       +------+       +------+       +------+
   ---&lt;&gt;  R1  &lt;&gt;-----&lt;&gt;  R2  &lt;&gt;-----&lt;&gt;  R3  &lt;&gt;-----&lt;&gt;  R4  &lt;&gt;---
       +------+       +------+       +------+       +------+
       .              .      .              .       .      .
       .              .      .              .       .      .
       .              &lt;------&gt;              &lt;-------&gt;      .
       .          Node Packet Loss      Link Packet Loss   .
       .                                                   .
       &lt;---------------------------------------------------&gt;
                        End-to-End Packet loss
</pre>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#detailed" id="detailed">Detailed description of the method</a>
</h1>
<p id="rfc.section.3.p.1">This section describes in detail how the method can be used to measure packet loss on real traffic in a packet-switched network.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Packet Loss</h1>
<p id="rfc.section.3.1.p.1">The basic idea is to virtually split the traffic in blocks that could be easily and unambiguously identified: counting the number of packets of each block and comparing the values obtained in different measurement points along the path, it is possible to measure packet loss occurred in any single block between any two points.</p>
<p id="rfc.section.3.1.p.2">The following figure shows how blocks are created generating periodic delimitation points in the flow.</p>
<div id="#rfc.figure.2"></div>
<div id="#delimitation"></div>
<pre>
         |           |           |           |           |
         |           |    Traffic flow       |           |
 ========|===========|===========|===========|===========|==========&gt;
    ...  |  Block 5  |  Block 4  |  Block 3  |  Block 2  |  Block 1  
         |           |           |           |           |

</pre>
<p id="rfc.section.3.1.p.3">A simple way to create delimitation points is to "color" the traffic with two different colors and change the color periodically.  Whenever the color changes the current block terminates and the following one begins. Hence all the packets belonging to the same block have the same color and packets of different consecutive blocks have a different color. The number of packets in each block depends on the criterion used to create the blocks: if the color switches every fixed number of packets, each block contains the same number of packets, but if the color switches according to a timer, the number of packets may be different in each block and dependent on the bit rate.</p>
<p id="rfc.section.3.1.p.4">The following figure shows how a flow looks like when it is split in traffic blocks coloring packets.</p>
<div id="#rfc.figure.3"></div>
<div id="#coloring"></div>
<pre>A: packet with A coloring
B: packet with B coloring

         |           |           |           |           |
         |           |    Traffic flow       |           |
 -------------------------------------------------------------------&gt;
  BBBBBBB AAAAAAAAAAA BBBBBBBBBBB AAAAAAAAAAA BBBBBBBBBBB AAAAAAA
 -------------------------------------------------------------------&gt;
    ...  |  Block 5  |  Block 4  |  Block 3  |  Block 2  |  Block 1  
         |           |           |           |           |

</pre>
<p><a href="#FIG_simple_network">Figure 4</a> shows how the method can be used to measure link packet loss between two adjacent nodes.</p>
<p id="rfc.section.3.1.p.6">Referring to the figure, let's assume we want to monitor the packet loss on the link between R1 and R2. According to the method here described, traffic is colored alternatively with two different colors, A and B, and whenever the color changes, a demarcation point is created, generating a sort of square-wave signal where original traffic flow is virtually split in a sequence of blocks.</p>
<div id="#rfc.figure.4"></div>
<div id="#FIG_simple_network"></div>
<pre>
Color A    ----------+           +-----------+           +----------
                     |           |           |           |          
Color B              +-----------+           +-----------+          
            Block n        ...      Block 3     Block 2     Block 1
          &lt;---------&gt; &lt;---------&gt; &lt;---------&gt; &lt;---------&gt; &lt;---------&gt;

                              Traffic flow           
         ===========================================================&gt;
Color ... AAAAAAAAAAA BBBBBBBBBBB AAAAAAAAAAA BBBBBBBBBBB AAAAAAA...
         ===========================================================&gt;

               +---------+                        +---------+
       -------&lt;&gt;    R1   &lt;&gt;----------------------&lt;&gt;   R2    &lt;&gt;------
               +---------+                        +---------+

</pre>
<p></p>
<p id="rfc.section.3.1.p.8">Traffic coloring can be executed by R1 itself or by an upward router. R1 needs two counters, C(A)R1 and C(B)R1, in its egress interface in order to count the number of packets sent out the interface and colored respectively with color A and B. As long as traffic is colored A, only counter C(A)R1 is incremented while C(B)R1 is still, viceversa during a B block only C(B)R1 is incremented while C(A)R1 is still. C(A)R1 and C(B)R1 can be used as reference values to determine the packet loss from R1 to any other measurement point down the path. Router R2, similarly, will need on its ingress interface two counters, C(A)R2 and C(B)R2, to count the number of packets received on the interface and colored with color A and B respectively. When an A block terminates it is possible to compare C(A)R1 and C(A)R2 determining any packet loss within the block, similarly when the successive B block terminates it is possible to compare C(B)R1 with C(B)R2 determining any packet loss in that block, and so on for every successive block.</p>
<p id="rfc.section.3.1.p.9">Similarly, using other 2 counters on R2 egress interface it is possible to count the number of packets sent out R2 interface and use them as reference values to determine the packet loss from R2 to any measurement point down R2.</p>
<p id="rfc.section.3.1.p.10">The method doesn't require any synchronization in the network, as the traffic flow implicitly carries the synchronization in the alternation of colors. In addition, splitting the flow in blocks, the method is able not only to detect any packet loss, but also to provide information about when the packet loss has occurred and in which point of the network.</p>
<p id="rfc.section.3.1.p.11">The following table shows how router counters can be used to calculate the packet loss between R1 and R2. The first column lists the sequence of traffic blocks while the other columns contain the counters of A-colored packets and B-colored packets for R1 and R2. In this example, we assume that counter values are reset whenever a block ends and the relative counter is read: with this assumption the table shows only relative counter values, that is the exact number of packets of each color within each block. If counter values were not reset, the table would contain cumulative counters, but the relative values could be equally determined by difference from the counter of the previous block of the same color.</p>
<div id="#rfc.table.1"></div>
<div id="#table1"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>Evaluation of counters for packet loss measurements</caption>
<thead><tr>
<th class="left">Block</th>
<th class="left">C(A)R1</th>
<th class="left">C(B)R1</th>
<th class="left">C(A)R2</th>
<th class="left">C(B)R2</th>
<th class="left">Loss</th>
</tr></thead>
<tbody>
<tr>
<td class="left">1</td>
<td class="left">375</td>
<td class="left">0</td>
<td class="left">375</td>
<td class="left">0</td>
<td class="left">0</td>
</tr>
<tr>
<td class="left">2</td>
<td class="left">0</td>
<td class="left">388</td>
<td class="left">0</td>
<td class="left">388</td>
<td class="left">0</td>
</tr>
<tr>
<td class="left">3</td>
<td class="left">382</td>
<td class="left">0</td>
<td class="left">381</td>
<td class="left">0</td>
<td class="left">1</td>
</tr>
<tr>
<td class="left">4</td>
<td class="left">0</td>
<td class="left">377</td>
<td class="left">0</td>
<td class="left">374</td>
<td class="left">3</td>
</tr>
<tr>
<td class="left">...</td>
<td class="left">...</td>
<td class="left">...</td>
<td class="left">...</td>
<td class="left">...</td>
<td class="left">...</td>
</tr>
<tr>
<td class="left">n</td>
<td class="left">0</td>
<td class="left">387</td>
<td class="left">0</td>
<td class="left">387</td>
<td class="left">0</td>
</tr>
<tr>
<td class="left">n+1</td>
<td class="left">379</td>
<td class="left">0</td>
<td class="left">377</td>
<td class="left">0</td>
<td class="left">2</td>
</tr>
</tbody>
</table>
<p id="rfc.section.3.1.p.12">As table shows, counters increase according to traffic coloring: during an A block (blocks 1, 3 and n+1) all the packets are A-colored therefore C(A) counter indicates the number of packets of that block, while C(B) counter is zero. Viceversa, during a B block (blocks 2, 4 and n) all the packets are B-colored therefore C(A) counter is zero, while C(B) counter indicates the number of packets of that block.</p>
<p id="rfc.section.3.1.p.13">When a block terminates (because the coloring has switched to the other color) the relative counters stop incrementing and it is possible to read them and compare the values measured on router R1 and R2 thus determining any packet loss within that block.</p>
<p id="rfc.section.3.1.p.14">For example, looking at the table above, during the first block (A-colored) C(A)R1 and C(A)R2 have the same value (375) which corresponds to the exact number of packets of the first block. Also during the second block (B-colored) R1 and R2 counters have the same value (388) which corresponds to the number of packets of the second block. During blocks 3 and 4 on the other hand R1 and R2 counters are different meaning that some packet has been lost: precisely, 1 packet (382-381) belonging to block 3 and 3 packets (377-374) belonging to block 4 were lost.</p>
<p id="rfc.section.3.1.p.15">The method here described for R1 and R2 can be extended to any router and applied to more complex networks, as far as the measurement is enabled on the path followed by the traffic flow being analyzed, thus providing a precise measurement of packet loss between any couple of network equipment.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> One-way Delay</h1>
<p id="rfc.section.3.2.p.1">This version of the draft addresses only packet loss measurement, one-way delay will be discussed in future versions of the document.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> Delay variation</h1>
<p id="rfc.section.3.3.p.1">This version of the draft addresses only packet loss measurement, delay variation will be discussed in future versions of the document.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Implementation strategies</h1>
<p id="rfc.section.4.p.1">The methodology described in the previous sections can be applied to different scenarios adopting different strategies. Specifically, it can be used in two basic ways: </p>

<ul>
<li>flow-based: performance measurement is applied to specific flows for service monitoring purpose and can be end-to-end;</li>
<li>link-based: performance measurement is applied to a particular link (physical or logical) and monitors all the flows of the link.</li>
</ul>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Flow-based performance monitoring</h1>
<p id="rfc.section.4.1.p.1">The flow-based strategy is used when only a limited number of traffic flows needs to be monitored. This could be the case, for example, of IPTV channels or other specific applications traffic with high QoS requirements.</p>
<p id="rfc.section.4.1.p.2">According to this strategy, only a subset of the flows is colored.  Counters for packet loss measurements can be instantiated for each single flow, or for the set as a whole, depending on the desired granularity.</p>
<p id="rfc.section.4.1.p.3">A relevant problem with this approach is the necessity to know in advance the path followed by flows that are subject to measurement.  Path rerouting and traffic load-balancing increase the issue complexity, especially for unicast traffic. The problem is easier to solve for multicast traffic where load balancing is seldom used, especially for IPTV traffic where static joins are frequently used to force traffic forwarding and replication.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Link-based performance monitoring</h1>
<p id="rfc.section.4.2.p.1">The link-based strategy is similar to performance monitoring tools usually used in transport networks, where the goal is to monitor the network behavior as a whole, without distinguishing among different services.</p>
<p id="rfc.section.4.2.p.2">Measurements are performed on all the traffic on a link. The link could be a physical link or a logical link (for instance an Ethernet VLAN or a MPLS PW). Counters can be instantiated for the traffic as a whole or for each traffic class (in case it is desired to monitor each class separately), but in the second case a couple of counters is needed for each class.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#implementation" id="implementation">Implementation hints</a>
</h1>
<p id="rfc.section.5.p.1">This section describes, as an example, a practical implementation of the method and shows how the monitoring could be easily activated in a real network, without the need to activate any specific protocol, using instead basic features already available on major routing platforms.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Traffic coloring</h1>
<p id="rfc.section.5.1.p.1">Traffic coloring can be implemented setting a specific bit on the packet header and changing the value of that bit periodically. For example it is possible to use the two less significant bits of the DSCP field (bit 0 and bit 1). One of them (bit 0) is used to identify flows subject to traffic monitoring (and therefore it is always set to 1 on these flows), the other one (bit 1) changes periodically and is used to create traffic blocks assuming alternately values 0 and 1. The choice of coloring traffic using the DSCP field implies that differentiated packet scheduling must not be based on that field but, for instance, only on IP Precedence bits.</p>
<p id="rfc.section.5.1.p.2">In practice, coloring traffic using the DSCP field can be performed configuring on the router interface an access list that intercepts the flow(s) to be monitored (or all the traffic in the link-based approach) and a policy that sets the DSCP field accordingly. Since traffic coloring must change over time, it is necessary to modify the policy periodically: an automatic script can easily perform this task.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Packet counting</h1>
<p id="rfc.section.5.2.p.1">The operation of counting packets can be implemented very easily.  If traffic is colored using the DSCP field, an access list that matches specific DSCP values can be used to count packets of the flow being monitored. The access list can also be configured to match different flow properties (such as source or destination address) besides the DSCP value, hence monitoring just a subset of the colored traffic. An important feature of this approach, in fact, is that coloring and counting are two decoupled operations: it is possible to color all the traffic, but monitor just one or few flows.</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> Data collection</h1>
<p id="rfc.section.5.3.p.1">In order to properly elaborate packet counters it is necessary to correlate values coming from different nodes. If we cannot use any specific protocol to exchange this information among routers, it is possible to use an external system. Its task is to collect data (counter values) from the network and make correlations to determine packet loss. This operation can be done for instance transferring data to the external system via FTP or TFTP.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Deployment considerations</h1>
<p id="rfc.section.6.p.1">This section describes some aspects that should be taken into account when the method is deployed in a real network.</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> Flow Identification</h1>
<p id="rfc.section.6.1.p.1">In the previous section it was outlined that flow-based measurements require the identification of the flow to be monitored and the discovery of the path followed by the selected flow. It is possible to monitor a single flow or multiple flows grouped together, but in this case measurement is consistent only if all the flows in the group follow the same path. Moreover, a network operator must be aware that, if a measurement is performed on many flows, it is not possible to determine exactly which flow was affected by packets loss.</p>
<p id="rfc.section.6.1.p.2">Once the flow(s) to be monitored have been identified, it is important to enable the monitoring system in the proper nodes. In order to have just an end-to-end monitoring it is sufficient to enable the monitoring system on the first and last hop routers of the path: the mechanism is completely transparent to intermediate nodes and independent from the path followed by traffic flows. On the contrary, to monitor the flow along its whole path and on every segment (every node and link) it is necessary to enable the monitoring system on every node from the source to the destination. In case the exact path followed by the flow is not known a priori (i.e. the flow has multiple paths to reach the destination) it is necessary to enable the monitoring system on every path: counters on interfaces traversed by the flow will report packet count, counters on other interfaces will be null.</p>
<p id="rfc.section.6.1.p.3">In case the link-based strategy is used, flow identification is not necessary because all the traffic has to be colored and measured.</p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> Flow Coloring</h1>
<p id="rfc.section.6.2.p.1">In both strategies, flow-based and link-based, the fundamental operation is to "color" the flow in order to create packet blocks.  This means choosing where to activate the coloring and how to "color" packets.</p>
<p id="rfc.section.6.2.p.2">In case of flow-based measurements, it is desirable, in general, to have a single coloring node because it is simpler to manage and doesn't rise any risk of conflict (consider the case where two nodes color the same flow). To this purpose it is necessary to color the flow as close as possible to the source. In addition, coloring a flow close to the source allows an end-to-end measure if a measurement point is enabled on the last-hop router as well. The only requirement is that coloring must change periodically and every node along the path must be able to identify unambiguously colored packets.</p>
<p id="rfc.section.6.2.p.3">For link-based measurements, all traffic needs to be colored when transmitted on the link. If traffic had already been colored, then it has to be re-colored because the coloring must be consistent on the link. This means that each hop along the path must (re-)color the traffic but coloring is not required to be consistent along different links.</p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> Monitoring Nodes</h1>
<p id="rfc.section.6.3.p.1">In the previous section it was explained that, in case of flow-based measurement, the operation of coloring packets to be monitored can be accomplished by a single node. All the intermediate nodes are not required to perform any particular operation except counting colored packets they receive and forward: this operation can be enabled on every router along the path or only on a subset, depending on which network segment is being monitored (a single link, a particular metro area, the backbone, the whole path).</p>
<p id="rfc.section.6.3.p.2">Since coloring changes periodically between two values, two counters (one for each value) are needed for a single flow being monitored: one counter for packets colored A and one counter for packets colored B.</p>
<p id="rfc.section.6.3.p.3">In case of link-based measurements the behavior is similar except that coloring and counting operations are performed on a link by link basis at each endpoint of the link itself.</p>
<p id="rfc.section.6.3.p.4">Another important aspect to take into consideration is when to read counters: in order to count the exact number of packets of a block routers must perform this operation when a block has terminated. The task can be performed in two ways. The most general approach suggests to read counters periodically, many times during a block, and to compare successive readings: when the counter stops incrementing means that the relative block has finished and its counter can be elaborated. Alternatively, if coloring is performed based on a timer and the duration of the blocks is fixed and known, it is possible to synchronize counter collection with that timer (f.i. if each block is 5 minutes long it is possible to read counters every 5 minute in the middle of the block to overcome eventual time shifts from the router that colors traffic).</p>
<h1 id="rfc.section.6.4">
<a href="#rfc.section.6.4">6.4.</a> Management System</h1>
<p id="rfc.section.6.4.p.1">Nodes enabled to perform performance monitoring collect the value of counters for colored packets, but they are not able to use this information to measure packet loss, because they only have local information and lack a global view of the network. For this reason an external Network Management System (NMS) is required to collect and elaborate data and to perform packet loss calculation. The NMS compares values of counters from different nodes and is then able to determine if some packets were lost (even a single packet) and also where packets were lost.</p>
<p id="rfc.section.6.4.p.2">Information collected by the routers (counter values) needs to be transferred to the NMS periodically. This can be accomplished f.i. via FTP or TFTP and can be done in Push Mode or Polling Mode. In the first case, each router sends periodically the information it collects to the NMS, in the latter case it is the NMS that periodically polls routers to collect information.</p>
<p id="rfc.section.6.4.p.3">If link-based measurement is used, it is also possible to use a protocol to exchange values of counters between the two endpoints in order to let them perform the packet loss calculation for each traffic direction. A similar approach would be complicate if applied to a flow-based measurement.</p>
<h1 id="rfc.section.6.5">
<a href="#rfc.section.6.5">6.5.</a> Scalability</h1>
<p id="rfc.section.6.5.p.1">This section describes what is needed on a node in order to enable the performance measurement system to the purpose of understanding its scalability.</p>
<p id="rfc.section.6.5.p.2">The coloring can be easily performed on a single flow as well as on the entire traffic. Regarding the counting, what is needed are two counters for every flow (or group of flows) being monitored and for every interface where the monitoring system is activated. For example, in order to monitor separately 3 flows on a router with 4 interfaces involved, 24 counters are needed (2 counters for each of the 3 flows on each of the 4 interfaces).</p>
<h1 id="rfc.section.6.6">
<a href="#rfc.section.6.6">6.6.</a> Interoperability</h1>
<p id="rfc.section.6.6.p.1">The method described in this document doesn't raise any interoperability issue, since it doesn't require any new protocol or any kind of interaction among nodes. Traffic coloring can be performed by a single node, while counting of packets is performed locally by each router and the correlation between counters can be done by an external NMS which collects and correlates the data coming from the network.</p>
<p id="rfc.section.6.6.p.2">The only requirement is that every node should be able to identify colored flows, but, as explained in <a href="#implementation">Section 5</a>, this can be accomplished using simple functionalities that doesn't have any interoperability issue and are already available on major routing platforms.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#seccons" id="seccons">Security Considerations</a>
</h1>
<p id="rfc.section.7.p.1">This document specifies a method to perform measurements in the context of a Service Provider's network and has not been developed to conduct Internet measurements, so it does not directly affect Internet security nor applications which run on the Internet. However, implementation of this method must be mindful of security and privacy concerns.</p>
<p id="rfc.section.7.p.2">There are two types of security concerns: potential harm caused by the measurements and potential harm to the measurements. For what concerns the first point, the measurements described in this document are passive, so there are no packets injected into the network causing potential harm to the network itself and to data traffic. Nevertheless, the method implies modifications on the fly to the IP header of data packets: this must be performed in a way that doesn't alter the quality of service experienced by packets subject to measurements and that preserve stability and performance of routers doing the measurements.  The measurements themselves could be harmed by routers altering the coloring of the packets, or by an attacker injecting artificial traffic.  Authentication techniques, such as digital signatures, may be used where appropriate to guard against injected traffic attacks.</p>
<p id="rfc.section.7.p.3">The privacy concerns of network measurement are limited because the method only relies on information contained in the IP header without any release of user data.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> IANA Considerations</h1>
<p id="rfc.section.8.p.1">There are no IANA actions required.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#ack" id="ack">Acknowledgements</a>
</h1>
<p id="rfc.section.9.p.1">The authors would like to thank Domenico Laforgia, Daniele Accetta and Mario Bianchetti for their contribution to the definition and the implementation of the method.</p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-opsawg-oam-overview">[I-D.ietf-opsawg-oam-overview]</b></td>
<td class="top">
<a>Mizrahi, T</a>, <a>Sprecher, N</a>, <a>Bellagamba, E</a> and <a>Y Weingarten</a>, "<a href="http://tools.ietf.org/html/draft-ietf-opsawg-oam-overview-05">An Overview of Operations, Administration, and Maintenance (OAM) Mechanisms</a>", Internet-Draft draft-ietf-opsawg-oam-overview-05, May 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-mpls-loss-delay">[I-D.ietf-mpls-loss-delay]</b></td>
<td class="top">
<a>Frost, D</a> and <a>S Bryant</a>, "<a href="http://tools.ietf.org/html/draft-ietf-mpls-loss-delay-04">Packet Loss and Delay Measurement for MPLS Networks</a>", Internet-Draft draft-ietf-mpls-loss-delay-04, July 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mauro Cociglio</span> 
	  <span class="n hidden">
		<span class="family-name">Cociglio</span>
	  </span>
	</span>
	<span class="org vcardline">Telecom Italia</span>
	<span class="adr">
	  <span>Via Reiss Romoli, 274</span>

	  <span class="vcardline">
		<span class="locality">Torino</span>,  
		<span class="region"></span>
		<span class="code">10148</span>
	  </span>
	  <span class="country-name vcardline">Italy</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mauro.cociglio@telecomitalia.it">mauro.cociglio@telecomitalia.it</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Alessandro Capello</span> 
	  <span class="n hidden">
		<span class="family-name">Capello</span>
	  </span>
	</span>
	<span class="org vcardline">Telecom Italia</span>
	<span class="adr">
	  <span>Via Reiss Romoli, 274</span>

	  <span class="vcardline">
		<span class="locality">Torino</span>,  
		<span class="region"></span>
		<span class="code">10148</span>
	  </span>
	  <span class="country-name vcardline">Italy</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:alessandro.capello@telecomitalia.it">alessandro.capello@telecomitalia.it</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Alberto Tempia Bonda</span> 
	  <span class="n hidden">
		<span class="family-name">Tempia Bonda</span>
	  </span>
	</span>
	<span class="org vcardline">Telecom Italia</span>
	<span class="adr">
	  <span>Via Reiss Romoli, 274</span>

	  <span class="vcardline">
		<span class="locality">Torino</span>,  
		<span class="region"></span>
		<span class="code">10148</span>
	  </span>
	  <span class="country-name vcardline">Italy</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:alberto.tempiabonda@telecomitalia.it">alberto.tempiabonda@telecomitalia.it</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Luca Castaldelli</span> 
	  <span class="n hidden">
		<span class="family-name">Castaldelli</span>
	  </span>
	</span>
	<span class="org vcardline">Telecom Italia</span>
	<span class="adr">
	  <span>Via Reiss Romoli, 274</span>

	  <span class="vcardline">
		<span class="locality">Torino</span>,  
		<span class="region"></span>
		<span class="code">10148</span>
	  </span>
	  <span class="country-name vcardline">Italy</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:luca.castaldelli@telecomitalia.it">luca.castaldelli@telecomitalia.it</a></span>

  </address>
</div>

</body>
</html>