<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Connection setup negociation for
      the Message Session Relay Protocol</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Connection setup negociation for
      the Message Session Relay Protocol">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">R. Denis-Courmont</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Nokia</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">September 25, 2007</td></tr>
<tr><td class="header">Expires: March 28, 2008</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Connection setup negociation for
      the Message Session Relay Protocol<br />draft-denis-simple-msrp-comedia-00.txt</h1>

<h3>Status of This Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on March 28, 2008.</p>

<h3>Abstract</h3>

<p> This document extends the MSRP connection model to negotiate the
        direction of the TCP connection setup.
        This provides a partial yet simple solution for scenarios
        whereby either, but not both, party to an MSRP session is located
        behind a NAT or firewall,
        and cannot serve as the passive endpoint for TCP connection setup.
      
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#defs">2.</a>&nbsp;
Definitions<br />
<a href="#applty">3.</a>&nbsp;
Applicability statement<br />
<a href="#model">4.</a>&nbsp;
MSRP COMEDIA Connection Model<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">4.1.</a>&nbsp;
Offerer processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">4.1.1.</a>&nbsp;
Sending the offer<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">4.1.2.</a>&nbsp;
Receiving the answer<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">4.1.3.</a>&nbsp;
Setting up the connection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.2.</a>&nbsp;
Answerer processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.2.1.</a>&nbsp;
Receiving the offer<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.2.2.</a>&nbsp;
Sending the answer<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.2.3.</a>&nbsp;
Setting up the connection<br />
<a href="#relays">5.</a>&nbsp;
Interactions with MSRP relays<br />
<a href="#tls">6.</a>&nbsp;
Interactions with TLS<br />
<a href="#security">7.</a>&nbsp;
Security Considerations<br />
<a href="#iana">8.</a>&nbsp;
IANA Considerations<br />
<a href="#ack">9.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> MSRP<a class='info' href='#I-D.ietf-simple-message-sessions'>[I&#8209;D.ietf&#8209;simple&#8209;message&#8209;sessions]<span> (</span><span class='info'>Campbell, B., &ldquo;The Message Session Relay Protocol,&rdquo; February&nbsp;2007.</span><span>)</span></a>
        allows transmission of byte streams (such as computer files)
        between two nodes using a SIP infrastructure.
        Because reliability and congestion control are required, MSRP uses
        TCP as its underlying transport protocol.
        Furthermore, MSRP specifies that the party initiating the session
        shall act as the active endpoint
        in establishing the connection-oriented transport session.
        The answering party shall wait for an incoming connection request,
        then check the MSRP path header in the first MSRP request,
        to bind the connection with the SIP dialog.
      
</p>
<p> This poses a significant challenge if the answering party is
        located behind a NAT and/or a stateful firewall.
        To address these issues,
        MSRP defines relay nodes
        (in <a class='info' href='#I-D.ietf-simple-msrp-relays'>[I&#8209;D.ietf&#8209;simple&#8209;msrp&#8209;relays]<span> (</span><span class='info'>Jennings, C., &ldquo;Relay Extensions for the Message Sessions Relay Protocol (MSRP),&rdquo; December&nbsp;2006.</span><span>)</span></a>),
        which MSRP clients can use as application-layer proxies.
      
</p>
<p> However, deploying these relays bears a significant extra cost,
        especially as MSRP relays are limitated to a single application-layer
        protocol
        (contrary to TURN<a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>
        or SOCKS<a class='info' href='#RFC1928'>[RFC1928]<span> (</span><span class='info'>Leech, M., Ganis, M., Lee, Y., Kuris, R., Koblas, D., and L. Jones, &ldquo;SOCKS Protocol Version 5,&rdquo; March&nbsp;1996.</span><span>)</span></a>).
        This also constitute a chicken-and-egg problem
        to MSRP deployment.
      
</p>
<p> In addition, MSRP relaying affects the reliability
        of the data transmission,
        due to the lack of end-to-end congestion control
        and reliable end-to-end partial delivery acknowledgement mechanism
        (partial acknowledgment are optional for receiver to send).
      
</p>
<p> This memo proposes an alternative connection model for MSRP
        that avoids the use of any middlebox when the party initiating
        the TCP connection is not behind a NAT or a firewall.
        That also brings reliability and congestion control to MSRP
        through to the use of an end-to-end TCP session.
      
</p>
<a name="defs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Definitions</h3>

<p> The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in
        this document are to be interpreted as described in
        <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
      
</p>
<a name="applty"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Applicability statement</h3>

<p> Under some usage scenarios, the offerer of an
        MSRP<a class='info' href='#I-D.ietf-simple-message-sessions'>[I&#8209;D.ietf&#8209;simple&#8209;message&#8209;sessions]<span> (</span><span class='info'>Campbell, B., &ldquo;The Message Session Relay Protocol,&rdquo; February&nbsp;2007.</span><span>)</span></a>
        session description is more likely to be able to receive incoming
        transport-layer connection requests than the answerer.
        Some examples scenarios might be:
        </p>
<ul class="text">
<li>a MSRP chat server inviting an user to a chat session
            <a class='info' href='#I-D.ietf-simple-chat'>[I&#8209;D.ietf&#8209;simple&#8209;chat]<span> (</span><span class='info'>Niemi, A., Garcia, M., and G. Sandbakken, &ldquo;Multi-party Chat Using the Message Session Relay Protocol (MSRP),&rdquo; April&nbsp;2010.</span><span>)</span></a>,
          
</li>
<li>a file being pushed to the receiver
            <a class='info' href='#I-D.ietf-mmusic-file-transfer-mech'>[I&#8209;D.ietf&#8209;mmusic&#8209;file&#8209;transfer&#8209;mech]<span> (</span><span class='info'>Garcia, M., Isomaki, M., Camarillo, G., Loreto, S., and P. Kyzivat, &ldquo;A Session Description Protocol (SDP) Offer/Answer Mechanism to Enable File  Transfer,&rdquo; February&nbsp;2009.</span><span>)</span></a>
            from a file server,
          
</li>
<li>a SOCKS<a class='info' href='#RFC1928'>[RFC1928]<span> (</span><span class='info'>Leech, M., Ganis, M., Lee, Y., Kuris, R., Koblas, D., and L. Jones, &ldquo;SOCKS Protocol Version 5,&rdquo; March&nbsp;1996.</span><span>)</span></a> proxy, or
            a TURN relay<a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>
            available to the offerer but not the answerer,
          
</li>
<li>adequate hole punching provision on the offerer side
            (e.g. with UPnP IGD profile, or manual configuration).
          
</li>
</ul><p>
      
</p>
<p> In these cases, it would be possible for the answerer to use an
        MSRP relay<a class='info' href='#I-D.ietf-simple-msrp-relays'>[I&#8209;D.ietf&#8209;simple&#8209;msrp&#8209;relays]<span> (</span><span class='info'>Jennings, C., &ldquo;Relay Extensions for the Message Sessions Relay Protocol (MSRP),&rdquo; December&nbsp;2006.</span><span>)</span></a>,
        if it cannot receive incoming connection requests,
        such as if it is located behind a NAT.
      
</p>
<p> However, if the offerer can act as the passive side
        in the establishment of the media connection,
        the connection setup can be negotiated using
        COMEDIA<a class='info' href='#RFC4145'>[RFC4145]<span> (</span><span class='info'>Yon, D. and G. Camarillo, &ldquo;TCP-Based Media Transport in the Session Description Protocol (SDP),&rdquo; September&nbsp;2005.</span><span>)</span></a>.
        This has the following advantages:
        </p>
<ul class="text">
<li> no need to deploy and provision a MSRP relay,
          
</li>
<li> reliability and congestion control are transparently ensured,
            as the transport connection is end-to-end,
          
</li>
</ul><p>
      
</p>
<a name="model"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
MSRP COMEDIA Connection Model</h3>

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Offerer processing</h3>

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1"></a><h3>4.1.1.&nbsp;
Sending the offer</h3>

<p> If the offerer of an MSRP session knows that it is prepared
            to handle transport-layer connection requests,
            it MUST include the "setup" SDP attribute, as defined in
            <a class='info' href='#RFC4145'>[RFC4145]<span> (</span><span class='info'>Yon, D. and G. Camarillo, &ldquo;TCP-Based Media Transport in the Session Description Protocol (SDP),&rdquo; September&nbsp;2005.</span><span>)</span></a>.
            It MAY also include the "connection" SDP attribute
            (to specify whether a transport connection may be re-used),
            as defined in the same document<a class='info' href='#RFC4145'>[RFC4145]<span> (</span><span class='info'>Yon, D. and G. Camarillo, &ldquo;TCP-Based Media Transport in the Session Description Protocol (SDP),&rdquo; September&nbsp;2005.</span><span>)</span></a>.
          
</p>
<p> In that case, the setup attribute
            MUST be set to either "passive" or "actpass".
            However, for the sake of compatibility with MSRP client which do
            not implement this specification, it is RECOMMENDED:
            </p>
<ul class="text">
<li> that "actpass" be used, rather than "passive",
              
</li>
<li> that the offerer be ready to establish an active connection,
                as per the basic MSRP connection model.
              
</li>
</ul><p>
          
</p>
<p> If the offerer is not willing or capable
            of handling incoming connection requests,
            it MAY set the setup attribute to "active".
            If not specified, this is assumed to be the default.
            For backward compatiblity with MSRP endpoints
            that do not support the extension specified in this memo,
            it SHOULD include its actual transport-layer source port number
            in the offer m= line,
            rather than specify the port number 9 (discard).
          
</p>
<p> The "holdconn" setup type is not defined, and MUST NOT be used.
            It is left for future specification.
          
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2"></a><h3>4.1.2.&nbsp;
Receiving the answer</h3>

<p> When the offerer receives a succesful answer,
            it looks for the setup attribute in the SDP for each media:
            </p>
<ul class="text">
<li> If the setup attribute is absent from the answer,
                and if the offerer had included a setup attribute with the
                value "passive",
                the answerer does not support this specification,
                and the media establishment MUST be considered as failed.
              
</li>
<li> Otherwise, if the setup attribute is absent from the answer,
                even though the answerer might not support this specification,
                the COMEDIA connection model can be used
                (because it is then compatible with the baseline MSRP
                 connection model).
               
</li>
<li> Otherwise, the answerer supports the COMEDIA connection
                model described in this specification.
              
</li>
</ul><p>
          
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.3"></a><h3>4.1.3.&nbsp;
Setting up the connection</h3>

<p> If it has been determined that the connection can be
            established according to the model described in this memo,
            the offerer MUST establish the media connection
            according to <a class='info' href='#RFC4145'>[RFC4145]<span> (</span><span class='info'>Yon, D. and G. Camarillo, &ldquo;TCP-Based Media Transport in the Session Description Protocol (SDP),&rdquo; September&nbsp;2005.</span><span>)</span></a>,
            with the following exception:
          
</p>
<p> If the offerer is the passive connection endpoint,
            the source address of the active connection endpoint would
            normally be found in the relevant c= SDP line,
            as well as in MSRP path line.
            However, if a NAT device is present on the path,
            these addresses might not match
            the IP address and port numbers of the actual TCP packets.
            To compensate for this inconsistency, the offerer MUST ignore
            the address found in the c= and a=path: SDP lines.
          
</p>
<p> Instead, it MUST check the From-Path and To-Path fields from
            the first received MSRP request received through the TCP session.
            To protect against a potential denial of service, it might need
            to process multiple incoming TCP sessions, until one of them has
            been authenticated.
          
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Answerer processing</h3>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Receiving the offer</h3>

<p> When a MSRP client receives a MSRP session offer,
            and determines that it will accept the offer,
            it looks for the setup attribute.
            </p>
<ul class="text">
<li> If it is absent, or its value is active, the client
                MUST follow the normal MSRP connection model.
              
</li>
<li> If the value is "passive",
                the answerer MUST initiate the TCP connection to the offerer,
                as specified in <a class='info' href='#RFC4145'>[RFC4145]<span> (</span><span class='info'>Yon, D. and G. Camarillo, &ldquo;TCP-Based Media Transport in the Session Description Protocol (SDP),&rdquo; September&nbsp;2005.</span><span>)</span></a>.
                It will still need to process other SDP parameters
                (such as "a=accept-bytes") as specified in
                <a class='info' href='#I-D.ietf-simple-message-sessions'>[I&#8209;D.ietf&#8209;simple&#8209;message&#8209;sessions]<span> (</span><span class='info'>Campbell, B., &ldquo;The Message Session Relay Protocol,&rdquo; February&nbsp;2007.</span><span>)</span></a>.
                In particular, it needs to cross-match the MSRP a=path
                SDP attribute with the From-Path headers used in the
                received MSRP messages.
              
</li>
<li> If the value is "actpass",
                it MUST choose either of two above connection models,
                and send format its answer accordingly as specified above.
                In particular,
                if it is known that connection requests cannot be processed
                by the answerer,
                it SHOULD act as the active endpoint.
                Similarly, if it is known that connection requests can
                be processed efficiently
                (i.e. not using any relaying protocol),
                it SHOULD act as the passive endpoint.
              
</li>
</ul><p>
          
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Sending the answer</h3>

<p> If the answerer is to initiate the TCP connection
            (as per the rules set above), it MUST include a
            COMEDIA setup attribute with a value of "active"
            in the answer SDP which it sends back to the offerer.
            It MUST also format the c= and m= line as specified in
            <a class='info' href='#RFC4145'>[RFC4145]<span> (</span><span class='info'>Yon, D. and G. Camarillo, &ldquo;TCP-Based Media Transport in the Session Description Protocol (SDP),&rdquo; September&nbsp;2005.</span><span>)</span></a>.
          
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.3"></a><h3>4.2.3.&nbsp;
Setting up the connection</h3>

<p> Once the TCP session is established,
            and if the answerer was the active connection endpoint,
            it MUST send an MSRP request.
            In particular, if it has no pending data to send,
            it MUST send an empty MSRP SEND request.
            That is necessary for the other endpoint to authenticate
            this TCP session.
          
</p>
<p> Some extension to this specification MAY specify other
            methods to authenticate the peer, (see also
            <a class='info' href='#I-D.niemi-simple-msrp-ice'>[I&#8209;D.niemi&#8209;simple&#8209;msrp&#8209;ice]<span> (</span><span class='info'>Niemi, A., &ldquo;Message Session Relay Protocol Adaptation for Interactive Connectivity  Establishment (ICE),&rdquo; February&nbsp;2007.</span><span>)</span></a>).
          
</p>
<a name="relays"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Interactions with MSRP relays</h3>

<p> It is not possible to use the MSRP COMEDIA connection model
        as defined in this memo,
        and one or more MSRP
        relays<a class='info' href='#I-D.ietf-simple-msrp-relays'>[I&#8209;D.ietf&#8209;simple&#8209;msrp&#8209;relays]<span> (</span><span class='info'>Jennings, C., &ldquo;Relay Extensions for the Message Sessions Relay Protocol (MSRP),&rdquo; December&nbsp;2006.</span><span>)</span></a>
        for a given MSRP session.
      
</p>
<p> Whenever the offerer uses a MSRP relay, then it MUST NOT advertise
        support of the MSRP COMEDIA connection model. Instead, it MUST follow
        the baseline MSRP connection model.
      
</p>
<p> Whenever the answerer detects a MSRP media with a COMEDIA "a=setup"
        SDP parameter within an offer,
        while it wants to use a MSRP relay,
        it MUST discard the "a=setup" attribute in the offer.
        Note that the discarded "a=setup" SDP attribute might still apply to
        any other media in the same offer,
        if there are more than one m= lines in the SDP offer.
      
</p>
<a name="tls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Interactions with TLS</h3>

<p> If an MSRP connection that is negotiated using the mechanism
        described in section <a class='info' href='#model'>Section&nbsp;4<span> (</span><span class='info'>MSRP COMEDIA Connection Model</span><span>)</span></a>, uses the Transport
        Layer Security protocol, the Client and Server TLS roles MUST
        negotiate the relevant parameter as specified per
        COMEDIA-TLS<a class='info' href='#RFC4572'>[RFC4572]<span> (</span><span class='info'>Lennox, J., &ldquo;Connection-Oriented Media Transport over the Transport Layer Security (TLS) Protocol in the Session Description Protocol (SDP),&rdquo; July&nbsp;2006.</span><span>)</span></a>.
      
</p>
<p> In addition, the MSRP "a=path" attribute MUST specify "msrps"
        as the URI scheme, consistent with
        <a class='info' href='#I-D.ietf-simple-message-sessions'>[I&#8209;D.ietf&#8209;simple&#8209;message&#8209;sessions]<span> (</span><span class='info'>Campbell, B., &ldquo;The Message Session Relay Protocol,&rdquo; February&nbsp;2007.</span><span>)</span></a>.
        If TLS is not used, the URI scheme would be "msrp".
      
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>TBD.
      
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>This document raises no new IANA considerations.
      
</p>
<a name="ack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Acknowledgments</h3>

<p>The authors would like to thank
        Christian Schmidt,
        Bernhard B&ouml;hmer,
        Miguel Garcia,
        Thomas Theimer,
        Ivo Sedlacek and
        Markku Vimpari
        for their comments on this document.
      
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-simple-message-sessions">[I-D.ietf-simple-message-sessions]</a></td>
<td class="author-text">Campbell, B., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-message-sessions-19.txt">The Message Session Relay Protocol</a>,&rdquo; draft-ietf-simple-message-sessions-19 (work in progress), February&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-message-sessions-19.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-simple-msrp-relays">[I-D.ietf-simple-msrp-relays]</a></td>
<td class="author-text">Jennings, C., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-msrp-relays-10.txt">Relay Extensions for the Message Sessions Relay Protocol (MSRP)</a>,&rdquo; draft-ietf-simple-msrp-relays-10 (work in progress), December&nbsp;2006 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-msrp-relays-10.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4145">[RFC4145]</a></td>
<td class="author-text">Yon, D. and G. Camarillo, &ldquo;<a href="http://tools.ietf.org/html/rfc4145">TCP-Based Media Transport in the Session Description Protocol (SDP)</a>,&rdquo; RFC&nbsp;4145, September&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4145.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4572">[RFC4572]</a></td>
<td class="author-text">Lennox, J., &ldquo;<a href="http://tools.ietf.org/html/rfc4572">Connection-Oriented Media Transport over the Transport Layer Security (TLS) Protocol in the Session Description Protocol (SDP)</a>,&rdquo; RFC&nbsp;4572, July&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4572.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-turn">[I-D.ietf-behave-turn]</a></td>
<td class="author-text">Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-turn-16.txt">Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN)</a>,&rdquo; draft-ietf-behave-turn-16 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-turn-16.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mmusic-file-transfer-mech">[I-D.ietf-mmusic-file-transfer-mech]</a></td>
<td class="author-text">Garcia, M., Isomaki, M., Camarillo, G., Loreto, S., and P. Kyzivat, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-file-transfer-mech-11.txt">A Session Description Protocol (SDP) Offer/Answer Mechanism to Enable File  Transfer</a>,&rdquo; draft-ietf-mmusic-file-transfer-mech-11 (work in progress), February&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-file-transfer-mech-11.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-simple-chat">[I-D.ietf-simple-chat]</a></td>
<td class="author-text">Niemi, A., Garcia, M., and G. Sandbakken, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-chat-06.txt">Multi-party Chat Using the Message Session Relay Protocol (MSRP)</a>,&rdquo; draft-ietf-simple-chat-06 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-chat-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.niemi-simple-msrp-ice">[I-D.niemi-simple-msrp-ice]</a></td>
<td class="author-text">Niemi, A., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-niemi-simple-msrp-ice-00.txt">Message Session Relay Protocol Adaptation for Interactive Connectivity  Establishment (ICE)</a>,&rdquo; draft-niemi-simple-msrp-ice-00 (work in progress), February&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-niemi-simple-msrp-ice-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1928">[RFC1928]</a></td>
<td class="author-text"><a href="mailto:mleech@bnr.ca">Leech, M.</a>, Ganis, M., Lee, Y., Kuris, R., Koblas, D., and L. Jones, &ldquo;<a href="http://tools.ietf.org/html/rfc1928">SOCKS Protocol Version 5</a>,&rdquo; RFC&nbsp;1928, March&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc1928.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">R&eacute;mi Denis-Courmont</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia Technology Platforms</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.O. Box 407</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia Group  FIN-00045</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+358 50 487 6315</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:remi.denis-courmont@nokia.com">remi.denis-courmont@nokia.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2007).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
