<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Certificate Management Messages over CMS</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Certificate Management Messages over CMS">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">J. Schaad</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Soaring Hawk Consulting</td></tr>
<tr><td class="header">Expires: September 11, 2008</td><td class="header">M. Myers</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">TraceRoute Security, Inc.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 10, 2008</td></tr>
</table></td></tr></table>
<h1><br />Certificate Management Messages over CMS<br />draft-ietf-pkix-2797-bis-07.txt</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 11, 2008.</p>

<h3>Abstract</h3>

<p>This document defines the base syntax for CMC, a Certificate Management protocol using the Cryptographic Message Syntax (CMS).  This protocol addresses two immediate needs within the Internet Public Key Infrastructure (PKI) community:
</p>
<ol class="text">
<li>The need for an interface to public key certification products and services based on CMS and PKCS #10 (Public Key Cryptography Standard), and
</li>
<li>The need for a PKI enrollment protocol for encryption only keys due to algorithm or hardware design.
</li>
</ol>
<p>CMC also requires the use of the transport document and the requirements usage document along with this document for a full definition.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Protocol Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.</a>&nbsp;
Requirements Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">1.3.</a>&nbsp;
Changes since RFC 2797<br />
<a href="#anchor5">2.</a>&nbsp;
Protocol Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.1.</a>&nbsp;
Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.2.</a>&nbsp;
Protocol Request/Responses<br />
<a href="#s_PKIRequests">3.</a>&nbsp;
PKI Requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_SimpleRequest">3.1.</a>&nbsp;
Simple PKI Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_FullRequest">3.2.</a>&nbsp;
Full PKI Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_cct_PKIData">3.2.1.</a>&nbsp;
PKIData content type<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_TaggedAttribute">3.2.1.1.</a>&nbsp;
Control Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_RequestFormats">3.2.1.2.</a>&nbsp;
Certification Request Formats<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_ReqPKCS10">3.2.1.2.1.</a>&nbsp;
PKCS #10 Certification Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_ReqCRMF">3.2.1.2.2.</a>&nbsp;
CRMF Certification Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_ReqOther">3.2.1.2.3.</a>&nbsp;
Other Certification Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_ContentInfo">3.2.1.3.</a>&nbsp;
Content Info Objects<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.2.1.3.1.</a>&nbsp;
Authenticated Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.2.1.3.2.</a>&nbsp;
Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.2.1.3.3.</a>&nbsp;
Enveloped Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">3.2.1.3.4.</a>&nbsp;
Signed Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_OtherMsg">3.2.1.4.</a>&nbsp;
Other Message Bodies<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_BodyPartID">3.2.2.</a>&nbsp;
Body Part Identification<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">3.2.3.</a>&nbsp;
CMC Unsigned Data Attribute<br />
<a href="#s_PKIResponse">4.</a>&nbsp;
PKI Responses<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_SimpleResponse">4.1.</a>&nbsp;
Simple PKI Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_FullResponse">4.2.</a>&nbsp;
Full PKI Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">4.2.1.</a>&nbsp;
PKIResponse Content Type<br />
<a href="#s_PKI_Encrypt">5.</a>&nbsp;
Application of Encryption to a PKI Request/Response<br />
<a href="#s_Controls">6.</a>&nbsp;
Controls<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">6.1.</a>&nbsp;
CMC Status Info Controls<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_statusInfoV2">6.1.1.</a>&nbsp;
Extended CMC Status Info Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_statusInfo">6.1.2.</a>&nbsp;
CMC Status Info Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_CMC_Status">6.1.3.</a>&nbsp;
CMCStatus values<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_CMC_FailInfo">6.1.4.</a>&nbsp;
 CMCFailInfo<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_IdProof">6.2.</a>&nbsp;
Identification and Identity Proof Controls<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_identityProofV2">6.2.1.</a>&nbsp;
Identity Proof Version 2 Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_identityProof">6.2.2.</a>&nbsp;
Identity Proof Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_identification">6.2.3.</a>&nbsp;
Identification Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#s_hardwareToken">6.2.4.</a>&nbsp;
Hardware Shared-Secret Token Generation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">6.3.</a>&nbsp;
Linking Identity and POP Information<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">6.3.1.</a>&nbsp;
Cryptographic Linkage<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_popLinkWitness2">6.3.1.1.</a>&nbsp;
POP Link Witness Version 2 Controls<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_popLinkWitness">6.3.1.2.</a>&nbsp;
POP Link Witness Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_popLinkRandom">6.3.1.3.</a>&nbsp;
POP Link Random Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_LinkSecret">6.3.2.</a>&nbsp;
Shared-secret/subject DN linking<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">6.3.3.</a>&nbsp;
Renewal and Re-Key Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_dataReturn">6.4.</a>&nbsp;
Data Return Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">6.5.</a>&nbsp;
RA Certificate Modification Controls<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_modCertTemplate">6.5.1.</a>&nbsp;
Modify Certificate Request Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_addExtensions">6.5.2.</a>&nbsp;
Add Extensions Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_transactionId">6.6.</a>&nbsp;
Transaction Identifier, Sender and Recipient Nonce Controls<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_encryptedPOP">6.7.</a>&nbsp;
Encrypted and Decrypted POP Controls<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_lraPOPWitness">6.8.</a>&nbsp;
RA POP Witness Control <br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_getCert">6.9.</a>&nbsp;
Get Certificate Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_getCRL">6.10.</a>&nbsp;
Get CRL Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_revokeRequest">6.11.</a>&nbsp;
Revocation Request Control <br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_regInfo">6.12.</a>&nbsp;
Registration and Response Information Controls<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_queryPending">6.13.</a>&nbsp;
Query Pending Control <br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_confirmCertAcceptance">6.14.</a>&nbsp;
Confirm Certificate Acceptance Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_trustAnchors">6.15.</a>&nbsp;
Publish Trust Anchors Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_authData">6.16.</a>&nbsp;
Authenticated Data Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_batchRequests">6.17.</a>&nbsp;
Batch Request and Response Controls<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_publishCert">6.18.</a>&nbsp;
Publication Information Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c_controlProcessed">6.19.</a>&nbsp;
Control Processed Control<br />
<a href="#s_RA_Processing">7.</a>&nbsp;
Registration Authorities<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">7.1.</a>&nbsp;
Encryption Removal<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">7.2.</a>&nbsp;
Signature Layer Removal<br />
<a href="#anchor21">8.</a>&nbsp;
Security Considerations<br />
<a href="#anchor22">9.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor23">10.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">11.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">11.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">11.2.</a>&nbsp;
Informational References<br />
<a href="#anchor26">Appendix&nbsp;A.</a>&nbsp;
ASN.1 Module<br />
<a href="#anchor27">Appendix&nbsp;B.</a>&nbsp;
Enrollment Message Flows<br />
<a href="#anchor28">Appendix&nbsp;B.1.</a>&nbsp;
Request of a Signing Certificate<br />
<a href="#anchor29">Appendix&nbsp;B.2.</a>&nbsp;
Single Certification Request, But Modified by RA<br />
<a href="#anchor30">Appendix&nbsp;B.3.</a>&nbsp;
Direct POP for an RSA certificate<br />
<a href="#anchor31">Appendix&nbsp;C.</a>&nbsp;
Production of Diffie-Hellman Public Key Certification Requests<br />
<a href="#anchor32">Appendix&nbsp;C.1.</a>&nbsp;
 No-Signature Signature Mechanism<br />
<a href="#anchor33">Appendix&nbsp;D.</a>&nbsp;
Change History<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>This document defines the base syntax for CMC, a Certificate Management protocol using the Cryptographic Message Syntax (CMS).  This protocol addresses two immediate needs within the Internet PKI community:
</p>
<ol class="text">
<li>	The need for an interface to public key certification products and services based on CMS and PKCS #10, and
</li>
<li>The need for a PKI enrollment protocol for encryption only keys due to algorithm or hardware design.
</li>
</ol>
<p>A small number of additional services are defined to supplement the core certification request service.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Protocol Requirements</h3>

<blockquote class="text">
<p>The protocol must be based as much as possible on the existing CMS, PKCS #10 <a class='info' href='#PKCS10'>[PKCS10]<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #10: Certification Request Syntax v1.5,&rdquo; October&nbsp;1997.</span><span>)</span></a> and CRMF (Certificate Request Message Format) <a class='info' href='#CRMF'>[CRMF]<span> (</span><span class='info'>Schaad, J., &ldquo;Internet X.509 Certification Request Message Format,&rdquo; January&nbsp;2005.</span><span>)</span></a> specifications.
</p>
<p>The protocol must support the current industry practice of a PKCS #10 certification request followed by a PKCS#7 "certs-only" response as a subset of the protocol.
</p>
<p>The protocol must easily support the multi-key enrollment protocols required by S/MIME and other groups.
</p>
<p>The protocol must supply a way of doing all enrollment operations in a single-round trip.  When this is not possible the number of round trips is to be minimized.
</p>
<p>The protocol must be designed such that all key generation can occur on the client.
</p>
<p>Support must exist for the mandatory algorithms used by S/MIME.  Support should exist for all other algorithms cited by the S/MIME core documents.
</p>
<p>The protocol must contain Proof-of-Possession (POP) methods. Optional provisions for multiple-round trip POP will be made if necessary.
</p>
<p>The protocol must support deferred and pending responses to enrollment requests for cases where external procedures are required to issue a certificate.
</p>
<p>The protocol must support arbitrary chains of Registration Authorities (RAs) as intermediaries between certification requesters and Certification Authorities (CAs).
</p>
</blockquote>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Requirements Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Changes since RFC 2797</h3>

<p>We have done a major overhaul on the layout of the document.  This included two different steps.  Firstly we removed some sections from the document and moved them to two other documents.  Information on how to transport our messages are now found in <a class='info' href='#CMC-TRANS'>[CMC&#8209;TRANS]<span> (</span><span class='info'>Schaad, J. and M. Myers, &ldquo;CMC Transport,&rdquo; December&nbsp;2004.</span><span>)</span></a>.  Information on which controls and sections of this document must be implemented along with which algorithms are required can now be found in <a class='info' href='#CMC-MUST'>[CMC&#8209;MUST]<span> (</span><span class='info'>Schaad, J. and M. Myers, &ldquo;CMC Compliance,&rdquo; December&nbsp;2004.</span><span>)</span></a>.
</p>
<p>A number of new controls have been added in this version:
</p>
<blockquote class="text">
<p>Extended CMC Status Info <a class='info' href='#c_statusInfoV2'>Section&nbsp;6.1.1<span> (</span><span class='info'>Extended CMC Status Info Control</span><span>)</span></a>
</p>
<p>Publish Trust Anchors <a class='info' href='#c_trustAnchors'>Section&nbsp;6.15<span> (</span><span class='info'>Publish Trust Anchors Control</span><span>)</span></a>
</p>
<p>Authenticate Data <a class='info' href='#c_authData'>Section&nbsp;6.16<span> (</span><span class='info'>Authenticated Data Control</span><span>)</span></a>
</p>
<p>Batch Request and Response Processing <a class='info' href='#c_batchRequests'>Section&nbsp;6.17<span> (</span><span class='info'>Batch Request and Response Controls</span><span>)</span></a>
</p>
<p>Publication Information <a class='info' href='#c_publishCert'>Section&nbsp;6.18<span> (</span><span class='info'>Publication Information Control</span><span>)</span></a>
</p>
<p>Modify Certificate Request <a class='info' href='#c_modCertTemplate'>Section&nbsp;6.5.1<span> (</span><span class='info'>Modify Certificate Request Control</span><span>)</span></a>
</p>
<p>Control Processed <a class='info' href='#c_controlProcessed'>Section&nbsp;6.19<span> (</span><span class='info'>Control Processed Control</span><span>)</span></a>
</p>
<p>Identity Proof <a class='info' href='#c_identityProof'>Section&nbsp;6.2.2<span> (</span><span class='info'>Identity Proof Control</span><span>)</span></a>
</p>
<p>Identity POP Link Witness V2 <a class='info' href='#c_popLinkWitness2'>Section&nbsp;6.3.1.1<span> (</span><span class='info'>POP Link Witness Version 2 Controls</span><span>)</span></a>
</p>
</blockquote>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Protocol Overview</h3>

<p>A PKI enrollment transaction in this specification is generally composed of a single round trip of messages.  In the simplest case a PKI enrollment request, henceforth referred to as a PKI Request, is sent from the client to the server and a PKI enrollment response, henceforth referred to as a PKI Response, is then returned from the server to the client. In more complicated cases, such as delayed certificate issuance, more than one round trip is required.
</p>
<p>This specification defines two PKI Request types and two PKI Response types.
</p>
<p>PKI Requests are formed using  either the PKCS #10 or CRMF structure.  The two PKI Requests are:
</p>
<blockquote class="text"><dl>
<dt>Simple PKI Request:</dt>
<dd> the bare PKCS #10 (in the event that no other services are needed), and
</dd>
<dt>Full PKI Request:</dt>
<dd> one or more PKCS #10, CRMF or Other Request Messages structures wrapped in a CMS encapsulation as part of a PKIData.
</dd>
</dl></blockquote>
<p>PKI Responses are based on SignedData <a class='info' href='#CMS'>[CMS]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; July&nbsp;2004.</span><span>)</span></a>.  The two PKI Responses are
</p>
<blockquote class="text"><dl>
<dt>Simple PKI Response:</dt>
<dd>a "certs-only" SignedData (in the event no other services are needed), or
</dd>
<dt>Full PKI Response</dt>
<dd>a PKIResponse content-type wrapped in a SignedData.
</dd>
</dl></blockquote>
<p>No special services are provided for either renewal (i.e., a new certificate with the same key) or re-key (i.e., a new certificate with a new key) of client certificates.  Instead renewal and re-key requests look the same as any certification request, except that the identity proof is supplied by existing certificates from a trusted CA. (This is usually the same CA, but could be a different CA in the same organization where naming is shared.)
</p>
<p>No special services are provided to distinguish between a re-key request and a new certification request (generally for a new purpose).  A control to unpublish a certificate would normally be included in a re-key request, and be omitted in a new certification request.  CAs or other publishing agents are also expected to have policies for removing certificates from publication either based on new certificates being added or the expiration or revocation of a certificate.
</p>
<p>A provision exists for RAs to participate in the protocol by taking PKI Requests, wrapping them in a second layer of PKI Request with additional requirements or statements from the RA and then passing this new expanded PKI Request on to the CA.
</p>
<p>This specification makes no assumptions about the underlying transport mechanism.  The use of CMS does not imply an email-based transport.  Several different possible transport methods are defined in <a class='info' href='#CMC-TRANS'>[CMC&#8209;TRANS]<span> (</span><span class='info'>Schaad, J. and M. Myers, &ldquo;CMC Transport,&rdquo; December&nbsp;2004.</span><span>)</span></a>.
</p>
<p>Optional services available through this specification are transaction management, replay detection (through nonces), deferred certificate issuance, certificate revocation requests and certificate/certificate revocation list (CRL) retrieval.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Terminology</h3>

<p>There are several different terms, abbreviations and acronyms used in this document.  These are defined here for convenience and consistency of usage in no particular order:
</p>
<blockquote class="text"><dl>
<dt>End-Entity</dt>
<dd> (EE) refers to the entity that owns a key pair and for whom a certificate is issued.
</dd>
<dt>Registration Authority (RA)</dt>
<dd> or Local RA (LRA) refers to an entity that acts as an intermediary between the EE and the CA.  Multiple RAs can exist between the End-Entity and the Certification Authority.  RAs may perform additional services such as key generation or key archival.  This document uses the term RA for both RA and LRA.
</dd>
<dt>Certification Authority</dt>
<dd> (CA) refers to the entity that issues certificates.
</dd>
<dt>Client</dt>
<dd> refers to an entity that creates a PKI Request.  In this document both RAs and EEs can be clients.
</dd>
<dt>Server</dt>
<dd> refers to the entities that process PKI Requests and create PKI Responses.  In this document both CAs and RAs can be servers.
</dd>
<dt>PKCS #10</dt>
<dd> refers to the Public Key Cryptography Standard #10 <a class='info' href='#PKCS10'>[PKCS10]<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #10: Certification Request Syntax v1.5,&rdquo; October&nbsp;1997.</span><span>)</span></a>, which defines a certification request syntax.
</dd>
<dt>CRMF</dt>
<dd> refers to the Certificate Request Message Format RFC <a class='info' href='#CRMF'>[CRMF]<span> (</span><span class='info'>Schaad, J., &ldquo;Internet X.509 Certification Request Message Format,&rdquo; January&nbsp;2005.</span><span>)</span></a>. CMC uses this certification request syntax defined in this document as part of the protocol.
</dd>
<dt>CMS</dt>
<dd> refers to the Cryptographic Message Syntax RFC <a class='info' href='#CMS'>[CMS]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; July&nbsp;2004.</span><span>)</span></a>.  This document provides for basic cryptographic services including encryption and signing with and without key management.
</dd>
<dt>PKI Request/Response</dt>
<dd> refers to the requests/responses described in this document.  PKI Requests include certification requests, revocation requests, etc.  PKI Responses include certs-only messages, failure messages, etc.
</dd>
<dt>Proof-Of-Identity</dt>
<dd> refers to the client proving they are who they say that they are to the server.
</dd>
<dt>Enrollment or certification request</dt>
<dd> refers to the process of a client requesting a certificate.  A certification request is a subset of the PKI Requests.
</dd>
<dt>Proof-Of-Possession (POP)</dt>
<dd> refers to a value that can be used to prove that the private key corresponding to a public key is in the possession and can be used by an end-entity.  This document uses the following different types of POP:
</dd>
<blockquote class="text"><dl>
<dt>Signature</dt>
<dd> provides the required POP by a signature operation over some data.
</dd>
<dt>Direct</dt>
<dd> provides the required POP operation by an encrypted challange/response mechinism.
</dd>
<dt>Indirect</dt>
<dd> provides the required POP opepration by returning the issued certificate in an encrypted state.
</dd>
<dt>Publish</dt>
<dd> provides the required POP operation by providing the private key the the certificate issuer.
</dd>
<dt>Attested</dt>
<dd> provides the required POP operation by allowing a trusted entity to assert that the POP has been proven by one of the above methods.
</dd>
</dl></blockquote>
<dt>Object IDentifier (OID)</dt>
<dd> is a primitive type in Abstract Syntax Notation One (ASN.1).
</dd>
</dl></blockquote>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Protocol Request/Responses</h3>

<p>Figure 1 shows the Simple PKI Requests and Responses. The contents of Simple PKI Request and Response are detailed in <a class='info' href='#s_SimpleRequest'>Section&nbsp;3.1<span> (</span><span class='info'>Simple PKI Request</span><span>)</span></a> and <a class='info' href='#s_SimpleResponse'>Section&nbsp;4.1<span> (</span><span class='info'>Simple PKI Response</span><span>)</span></a>.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Simple PKI Request                      Simple PKI Response
-------------------------               --------------------------

 +----------+                            +------------------+
 | PKCS #10 |                            | CMS ContentInfo  |
 +----------+--------------+             +------------------+------+
 | Certification Request   |             | CMS Signed Data,        |
 |                         |             |   no SignerInfo         |
 | Subject Name            |             |
 | Subject Public Key Info |             | SignedData contains one |
 |   (K_PUB)               |             | or more certificates in |
 | Attributes              |             | the certificates field  |
 |                         |             | Relevant CA certs and   |
 +-----------+-------------+             | CRLs can be included    |
             | signed with |             | as well.                |
             | matching    |             |                         |
             | K_PRIV      |             | encapsulatedContentInfo |
             +-------------+             | is absent.              |
                                         +--------------+----------+
                                                        | unsigned |
                                                        +----------+

             Figure 1: Simple PKI Requests and Responses
</pre></div>
<p>Figure 2 shows the Full PKI Requests and Responses. The contents of the Full PKI Request and Responses are detailed in <a class='info' href='#s_FullRequest'>Section&nbsp;3.2<span> (</span><span class='info'>Full PKI Request</span><span>)</span></a> and <a class='info' href='#s_FullResponse'>Section&nbsp;4.2<span> (</span><span class='info'>Full PKI Response</span><span>)</span></a>.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 Full PKI Request                        Full PKI Response
 -----------------------                 ------------------------
 +----------------+                      +----------------+
 | CMS ContentInfo|                      | CMS ContentInfo|
 | CMS SignedData |                      | CMS SignedData |
 |   or Auth Data |                      |   or Auth Data |
 |     object     |                      |     object     |
 +----------------+--------+             +----------------+--------+
 |                         |             |                         |
 | PKIData                 |             | PKIResponseBody         |
 |                         |             |                         |
 | Sequence of:            |             | Sequence of:            |
 | &lt;enrollment control&gt;*   |             | &lt;enrollment control&gt;*   |
 | &lt;certification request&gt;*|             | &lt;CMS object&gt;*           |
 | &lt;CMS object&gt;*           |             | &lt;other message&gt;*        |
 | &lt;other message&gt;*        |             |                         |
 |                         |             | where * == zero or more |
 | where * == zero or more |             |                         |
 |                         |             | All certificates issued |
 | Certification requests  |             | as part of the response |
 | are CRMF, PKCS #10, or  |             | are included in the     |
 | Other.                  |             | "certificates" field    |
 |                         |             | of the SignedData.      |
 +-------+-----------------+             | Relevant CA certs and   |
         | signed (keypair |             | CRLs can be included as |
         | used may be pre-|             | well.                   |
         | existing or     |             |                         |
         | identified in   |             +---------+---------------+
         | the request)    |                       | signed by the |
         +-----------------+                       | CA or an LRA  |
                                                   +---------------+


            Figure 2: Full PKI Requests and Responses
</pre></div>
<a name="s_PKIRequests"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
PKI Requests</h3>

<p>Two types of PKI Requests exist.  This section gives the details for both types.
</p>
<a name="s_SimpleRequest"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Simple PKI Request</h3>

<p>A Simple PKI Request uses the PKCS #10 syntax CertificationRequest <a class='info' href='#PKCS10'>[PKCS10]<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #10: Certification Request Syntax v1.5,&rdquo; October&nbsp;1997.</span><span>)</span></a>.
</p>
<p>When a server processes a Simple PKI Request, the PKI Response returned is:
</p>
<blockquote class="text"><dl>
<dt>Simple PKI Response</dt>
<dd> on success.
</dd>
<dt>Full PKI Response</dt>
<dd> on failure.  The server MAY choose not to return a PKI Response in this case.
</dd>
</dl></blockquote>
<p>The Simple PKI Request MUST NOT be used if a proof-of-identity needs to be included.
</p>
<p>The Simple PKI Request cannot be used if the private key is not capable of producing some type of signature (i.e. DH keys can use the signature algorithms in <a class='info' href='#DH-POP'>[DH&#8209;POP]<span> (</span><span class='info'>Prafullchandra, H. and J. Schaad, &ldquo;Diffie-Hellman Proof-of-Possession Algorithms,&rdquo; June&nbsp;2000.</span><span>)</span></a> for production of the signature).
</p>
<p>The Simple PKI Request cannot be used for any of the advanced services specified in this document.
</p>
<p>The client MAY incorporate one or more X.509v3 extensions in any certification request based on PKCS #10 as an ExtensionReq attribute. The ExtensionReq attribute is defined as:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  ExtensionReq ::= SEQUENCE SIZE (1..MAX) OF Extension
</pre></div>
<p>where Extension is imported from <a class='info' href='#PKIXCERT'>[PKIXCERT]<span> (</span><span class='info'>Housley, R., Ford, W., Polk, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a> and ExtensionReq is identified by:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  id-ExtensionReq OBJECT IDENTIFIER ::= {iso(1) member-body(2) us(840)
       rsadsi(113549) pkcs(1) pkcs-9(9) 14}
</pre></div>
<p>Servers MUST be able to process all extensions defined, but not prohibited, in <a class='info' href='#PKIXCERT'>[PKIXCERT]<span> (</span><span class='info'>Housley, R., Ford, W., Polk, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>. 
          Servers are not required to be able to process other X.509v3 extensions transmitted using this protocol, nor are they required to be able to process private extensions. 
          Servers are not required to put all client-requested extensions into a certificate. 
          Servers are permitted to modify client-requested extensions. 
          Servers MUST NOT alter an extension so as to invalidate the original intent of a client-requested extension. 
          (For example, changing key usage from keyAgreement to digitalSignature.) 
          If a certification request is denied due to the inability to handle a requested extension and a PKI Response is returned, the server MUST return a PKI Response with a CMCFailInfo value with the value unsupportedExt.
</p>
<a name="s_FullRequest"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Full PKI Request</h3>

<p>The Full PKI Request provides the most functionality and flexibility.
</p>
<p>The Full PKI Request is encapsulated in either a SignedData or an AuthenticatedData with an encapsulated content type of id-cct-PKIData  (<a class='info' href='#s_cct_PKIData'>Section&nbsp;3.2.1<span> (</span><span class='info'>PKIData content type</span><span>)</span></a>).
</p>
<p>When a server process a Full PKI Request, a PKI Response MUST be returned. The PKI Response returned is:
</p>
<blockquote class="text"><dl>
<dt>Simple PKI Response</dt>
<dd> if the enrollment was successful and only certificates are returned.  (A CMCStatusInfoV2 control with success is implied.)
</dd>
<dt>Full PKI Response</dt>
<dd> if the enrollment was successful and information is returned in addition to certificates, if the enrollment is pending, or if the enrollment failed.
</dd>
</dl></blockquote>
<p>If SignedData is used, the signature can be generated using either the private key material of an embedded signature certification request (i.e., included in the TaggedRequest tcr or crm fields), or a previously certified signature key.
          If the private key of a signature certification request is used, then:
</p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>The certification request containing the corresponding public key MUST include a Subject Key Identifier extension.
</dd>
<dt>b.</dt>
<dd>The subjectKeyIdentifier form of the signerIdentifier in SignerInfo MUST be used.
</dd>
<dt>c.</dt>
<dd>The value of the subjectKeyIdentifier form of SignerInfo MUST be the Subject Key Identifier specified in the corresponding certification request. (The subjectKeyIdentifier form of SignerInfo is used here because no certificates have yet been issued for the signing key.) If the request key is used for signing, there MUST be only one SignerInfo in the SignedData.
</dd>
</dl></blockquote>
<p>If AuthenticatedData is used, then:
</p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>The Password Recipient Info option of RecipientInfo MUST be used.
</dd>
<dt>b.</dt>
<dd>A randomly generated key is used to compute the MAC value on the encapsulated content.
</dd>
<dt>c.</dt>
<dd>The input for the key derivation algorithm is a concatenation of the identifier (encoded as UTF8) and the shared-secret.
</dd>
</dl></blockquote>
<p>When creating a PKI Request to renew or rekey a certificate:
</p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>	The Identification and Identity Proof controls are absent.  The same information is provided by the use of an existing certificate from a CA when signing the PKI Request.  In this case the CA that issued the original certificate and the CA the request is made to will usually be the same, but could have a common operator.
</dd>
<dt>b.</dt>
<dd>	CAs and RAs can impose additional restrictions on the signing certificate used.  They may require that the most recently issued signing certificate for a client be used.
</dd>
<dt>c.</dt>
<dd>	Some CAs may prevent renewal operations (i.e., reuse of the same keys).  In this case the CA MUST return a PKI Response with noKeyReuse as the CMCFailInfo failure code.
</dd>
</dl></blockquote>
<a name="s_cct_PKIData"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
PKIData content type</h3>

<p>The PKIData content type is used for the Full PKI Request. A PKIData content type is identified by:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  id-cct-PKIData ::= {id-pkix id-cct(12) 2 }
</pre></div>
<p>The ASN.1 structure corresponding to the PKIData content type is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  PKIData ::= SEQUENCE {
      controlSequence    SEQUENCE SIZE(0..MAX) OF TaggedAttribute,
      reqSequence        SEQUENCE SIZE(0..MAX) OF TaggedRequest,
      cmsSequence        SEQUENCE SIZE(0..MAX) OF TaggedContentInfo,
      otherMsgSequence   SEQUENCE SIZE(0..MAX) OF OtherMsg
  }
</pre></div>
<p>The fields in PKIData have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>controlSequence</dt>
<dd> is a sequence of controls.  The controls defined in this document are found in <a class='info' href='#s_Controls'>Section&nbsp;6<span> (</span><span class='info'>Controls</span><span>)</span></a>.  Controls can be defined by other parties.  Details on the TaggedAttribute structure can be found in <a class='info' href='#s_TaggedAttribute'>Section&nbsp;3.2.1.1<span> (</span><span class='info'>Control Syntax</span><span>)</span></a>.
</dd>
<dt>reqSequence</dt>
<dd> is a sequence of certification requests.  The certification requests can be a CertificationRequest (PKCS #10), a CertReqMsg (CRMF) or an externally defined PKI request.  Full details are found in <a class='info' href='#s_RequestFormats'>Section&nbsp;3.2.1.2<span> (</span><span class='info'>Certification Request Formats</span><span>)</span></a>.  If an externally defined certification request is present, but the server does not understand the certification request (or will not process it), a CMCStatus of noSupport MUST be returned for the certification request item and no other certification requests are processed.
</dd>
<dt>cmsSequence</dt>
<dd> is a sequence of <a class='info' href='#CMS'>[CMS]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; July&nbsp;2004.</span><span>)</span></a> message objects.   See <a class='info' href='#s_ContentInfo'>Section&nbsp;3.2.1.3<span> (</span><span class='info'>Content Info Objects</span><span>)</span></a> for more details.
</dd>
<dt>otherMsgSequence</dt>
<dd> is a sequence of arbitrary data objects.  Data objects placed here are referred to by one or more controls.  This allows for controls to use large amounts of data without the data being embedded in the control.  See <a class='info' href='#s_OtherMsg'>Section&nbsp;3.2.1.4<span> (</span><span class='info'>Other Message Bodies</span><span>)</span></a> for more details.
</dd>
</dl></blockquote>
<p>All certification requests encoded into a single PKIData SHOULD be for the same identity.  RAs that batch process (see <a class='info' href='#c_batchRequests'>Section&nbsp;6.17<span> (</span><span class='info'>Batch Request and Response Controls</span><span>)</span></a>) are expected to place the PKI Requests received into the cmsSequence of a PKIData.
</p>
<p>Processing of the PKIData by a recipient is as follows:
</p>
<ol class="text">
<li>All controls should be examined and processed in an appropriate manner.  The appropriate processing is to complete processing at this time, to ignore the control or to place the control on a to-do list for later processing.  Controls can be processed in any order;  the order in the sequence is not significant.
</li>
<li> Items in the reqSequence are not referenced by a control.  These items, which are certification requests,  also need to be processed.  As with controls, the appropriate processing can be either immediate processing or addition to a to-do list for later processing.
</li>
<li>Finally the to-do list is processed.  In many cases the to-do list will be ordered by grouping specific tasks together.
</li>
</ol>
<p>No processing is required for cmsSequence or otherMsgSequence members of PKIData if they are present and are not referenced by a control.  In this case, the cmsSequence and otherMsgSequence members are ignored.
</p>
<a name="s_TaggedAttribute"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.1"></a><h3>3.2.1.1.&nbsp;
Control Syntax</h3>

<p>The actions to be performed for a PKI Request/Response are based on the included controls.  Each control consists of an object identifier and a value based on the object identifier.
</p>
<p>The syntax of a control is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  TaggedAttribute ::= SEQUENCE {
      bodyPartID         BodyPartID,
      attrType           OBJECT IDENTIFIER,
      attrValues         SET OF AttributeValue
  }

  AttributeValue ::= ANY
</pre></div>
<p>The fields in TaggedAttribute have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>bodyPartID</dt>
<dd> is a unique integer that identifies this control.
</dd>
<dt>attrType</dt>
<dd> is the OID that identifies the control.
</dd>
<dt>attrValues</dt>
<dd> is the data values used in processing the control.  The structure of the data is dependent on the specific control.
</dd>
</dl></blockquote>
<p>
            The final server MUST fail the processing of an entire PKIData  if any included control is not recognized, that control is not already marked as processed by a Control Processed control (see <a class='info' href='#c_controlProcessed'>Section&nbsp;6.19<span> (</span><span class='info'>Control Processed Control</span><span>)</span></a>) and no other error is generated. 
            The PKI Response MUST include a CMCFailInfo value with the value badRequest and the bodyList MUST contain the bodyPartID of the invalid or unrecognized control(s). 
            A server is the final server if and only if it is not passing the PKI Request on to another server.  A server is not considered to be the final server if the server would have passed the PKI Request on, but instead it returned a processing error.
</p>
<p>The controls defined by this document are found in <a class='info' href='#s_Controls'>Section&nbsp;6<span> (</span><span class='info'>Controls</span><span>)</span></a>.
</p>
<a name="s_RequestFormats"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.2"></a><h3>3.2.1.2.&nbsp;
Certification Request Formats</h3>

<p>Certification Requests are based on PKCS #10, CRMF or Other Request formats. <a class='info' href='#s_ReqPKCS10'>Section&nbsp;3.2.1.2.1<span> (</span><span class='info'>PKCS #10 Certification Syntax</span><span>)</span></a> specifies the requirements for clients and servers dealing with PKCS #10.  <a class='info' href='#s_ReqCRMF'>Section&nbsp;3.2.1.2.2<span> (</span><span class='info'>CRMF Certification Syntax</span><span>)</span></a> specifies the requirements for clients and servers dealing with CRMF.  <a class='info' href='#s_ReqOther'>Section&nbsp;3.2.1.2.3<span> (</span><span class='info'>Other Certification Request</span><span>)</span></a> specifies the requirements for clients and servers dealing with Other Request.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  TaggedRequest ::= CHOICE {
     tcr               [0] TaggedCertificationRequest,
     crm               [1] CertReqMsg,
     orm               [2] SEQUENCE {
        bodyPartID            BodyPartID,
        requestMessageType    OBJECT IDENTIFIER,
        requestMessageValue   ANY DEFINED BY requestMessageType
     }
  }
</pre></div>
<p>The fields in TaggedRequest have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>tcr</dt>
<dd> is a certification request that uses the PKCS #10 syntax.  Details on PKCS #10 are found in <a class='info' href='#s_ReqPKCS10'>Section&nbsp;3.2.1.2.1<span> (</span><span class='info'>PKCS #10 Certification Syntax</span><span>)</span></a>.
</dd>
<dt>crm</dt>
<dd> is a certification request that uses the CRMF syntax.  Details on CRMF are found in <a class='info' href='#s_ReqCRMF'>Section&nbsp;3.2.1.2.2<span> (</span><span class='info'>CRMF Certification Syntax</span><span>)</span></a>.
</dd>
<dt>orm</dt>
<dd> is an externally defined certification request.  One example is an attribute certification request.  The fields of this structure are:
</dd>
<blockquote class="text"><dl>
<dt>bodyPartID</dt>
<dd> is the identifier number for this certification request.  Details on body part identifiers are found in <a class='info' href='#s_BodyPartID'>Section&nbsp;3.2.2<span> (</span><span class='info'>Body Part Identification</span><span>)</span></a>.
</dd>
<dt>requestMessageType</dt>
<dd> identifies the other request type.  These values are defined outside of this document.
</dd>
<dt>requestMessageValue</dt>
<dd> is the data associated with the other request type.
</dd>
</dl></blockquote>
</dl></blockquote>
<a name="s_ReqPKCS10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.2.1"></a><h3>3.2.1.2.1.&nbsp;
PKCS #10 Certification Syntax</h3>

<p>A certification request based on PKCS #10 uses the following ASN.1 structure:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 TaggedCertificationRequest ::= SEQUENCE {
     bodyPartID            BodyPartID,
     certificationRequest  CertificationRequest
 }
</pre></div>
<p>The fields in TaggedCertificationRequest have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>bodyPartID</dt>
<dd> is the identifier number for this certification request.  Details on body part identifiers are found in <a class='info' href='#s_BodyPartID'>Section&nbsp;3.2.2<span> (</span><span class='info'>Body Part Identification</span><span>)</span></a>.
</dd>
<dt>certificationRequest</dt>
<dd> contains the PKCS #10 based certification request.  Its fields are described in <a class='info' href='#PKCS10'>[PKCS10]<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #10: Certification Request Syntax v1.5,&rdquo; October&nbsp;1997.</span><span>)</span></a>.
</dd>
</dl></blockquote>
<p>When producing a certification request based on PKCS #10, clients MUST produce the certification request with a subject name and public key.  
                Some PKI products are operated using a central repository of information to assign subject names upon receipt of a certification request. 
                To accommodate this mode of operation, the subject field in a CertificationRequest MAY be NULL, but MUST be present. 
                CAs that receive a CertificationRequest with a NULL subject field MAY reject such certification requests. 
                If rejected and a PKI Response is returned, the CA MUST return a PKI Response with the CMCFailInfo value with the value badRequest.
</p>
<a name="s_ReqCRMF"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.2.2"></a><h3>3.2.1.2.2.&nbsp;
CRMF Certification Syntax</h3>

<p>A CRMF message uses the following ASN.1 structure (defined in [CRMF] and included here for convenience):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  CertReqMsg ::= SEQUENCE {
    certReq   CertRequest,
    popo      ProofOfPossession  OPTIONAL,
    -- content depends upon key type
    regInfo   SEQUENCE SIZE(1..MAX) OF AttributeTypeAndValue OPTIONAL }

  CertRequest ::= SEQUENCE {
    certReqId     INTEGER,        -- ID for matching request and reply
    certTemplate  CertTemplate, --Selected fields of cert to be issued
    controls      Controls OPTIONAL } -- Attributes affecting issuance

  CertTemplate ::= SEQUENCE {
    version      [0] Version               OPTIONAL,
    serialNumber [1] INTEGER               OPTIONAL,
    signingAlg   [2] AlgorithmIdentifier   OPTIONAL,
    issuer       [3] Name                  OPTIONAL,
    validity     [4] OptionalValidity      OPTIONAL,
    subject      [5] Name                  OPTIONAL,
    publicKey    [6] SubjectPublicKeyInfo  OPTIONAL,
    issuerUID    [7] UniqueIdentifier      OPTIONAL,
    subjectUID   [8] UniqueIdentifier      OPTIONAL,
    extensions   [9] Extensions            OPTIONAL }
</pre></div>
<p>The fields in CertReqMsg are explained in [CRMF].
</p>
<p>This document imposes the following additional restrictions on the construction and processing of CRMF certification requests:
</p>
<blockquote class="text">
<p>When a Full PKI Request includes a CRMF certification request, both the subject and publicKey fields in the CertTemplate MUST be defined.  The subject field can be encoded as NULL, but MUST be present.
</p>
<p>When both CRMF and CMC controls exist with equivalent functionality, the CMC control SHOULD be used.  The CMC control MUST override the CRMF control.
</p>
<p>The regInfo field MUST NOT be used on a CRMF certification request.  Equivalent functionality is provided in the CMC regInfo control (<a class='info' href='#c_regInfo'>Section&nbsp;6.12<span> (</span><span class='info'>Registration and Response Information Controls</span><span>)</span></a>).
</p>
<p>The indirect method of proving POP is not supported in this protocol.  One of the other methods (including the direct method described in this document) MUST be used.  The value of encrCert in SubsequentMessage MUST NOT be used.
</p>
<p>Since the subject and publicKeyValues are always present, the POPOSigningKeyInput MUST NOT be used when computing the value for POPSigningKey.
</p>
</blockquote>
<p>A server is not required to use all of the values suggested by the client in the CRMF certification request.  Servers MUST be able to process all extensions defined, but not prohibited in <a class='info' href='#PKIXCERT'>[PKIXCERT]<span> (</span><span class='info'>Housley, R., Ford, W., Polk, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>.  Servers are not required to be able to process other X.509v3 extensions transmitted using this protocol, nor are they required to be able to process private extensions. Servers are permitted to modify client-requested extensions.  Servers MUST NOT alter an extension so as to invalidate the original intent of a client-requested extension. (For example change key usage from keyAgreement to digitalSignature.)  If a certification request is denied due to the inability to handle a requested extension, the server MUST respond with a Full PKI Response with a CMCFailInfo value with the value of unsupportedExt.
</p>
<a name="s_ReqOther"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.2.3"></a><h3>3.2.1.2.3.&nbsp;
Other Certification Request</h3>

<p>This document allows for other certification request formats to be defined and used as well.  An example of an other certification request format is one for Attribute Certificates.  These other certification request formats are defined by specifying an OID for identification and the structure to contain the data to be passed.
</p>
<a name="s_ContentInfo"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.3"></a><h3>3.2.1.3.&nbsp;
Content Info Objects</h3>

<p>The cmsSequence field of the PKIData and PKIResponse messages contains zero or more tagged content info objects.  The syntax for this structure is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  TaggedContentInfo ::= SEQUENCE {
      bodyPartID              BodyPartID,
      contentInfo             ContentInfo
  }
</pre></div>
<p>The fields in TaggedContentInfo have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>bodyPartID</dt>
<dd> is a unique integer that identifies this content info object.
</dd>
<dt>contentInfo</dt>
<dd> is a ContentInfo object (defined in <a class='info' href='#CMS'>[CMS]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; July&nbsp;2004.</span><span>)</span></a>).
</dd>
</dl></blockquote>
<p>The four content types used in cmsSequence are AuthenticatedData, Data, EnvelopedData and SignedData.  All of these content types are defined in <a class='info' href='#CMS'>[CMS]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; July&nbsp;2004.</span><span>)</span></a>.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.3.1"></a><h3>3.2.1.3.1.&nbsp;
Authenticated Data</h3>

<p>The AuthenticatedData content type provides a method of doing pre-shared secret based validation of data being sent between two parties.  Unlike SignedData it does not specify which party actually generated the information.
</p>
<p>AuthenticatedData provides origination authentication in those circumstances where a shared-secret exists, but a PKI based trust has not yet been established.  No PKI based trust may have been established because a trust anchor has not been installed on the client or no certificate exists for a signing key.
</p>
<p>AuthenticatedData content type is used by this document for:
</p>
<blockquote class="text">
<p>The id-cmc-authData control (<a class='info' href='#c_authData'>Section&nbsp;6.16<span> (</span><span class='info'>Authenticated Data Control</span><span>)</span></a>), and
</p>
<p>As the top-level wrapper in environments where an encryption only key is being certified.
</p>
</blockquote>
<p>This content type can include both PKIData and PKIResponse as the encapsulated content types.  These embedded content types can contain additional controls that need to be processed.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.3.2"></a><h3>3.2.1.3.2.&nbsp;
Data</h3>

<p>The Data content type allows for general transport of unstructured data.
</p>
<p>The Data content type is used by this document for:
</p>
<blockquote class="text">
<p>Holding the encrypted random value y for POP proof in the encrypted POP control (see <a class='info' href='#c_encryptedPOP'>Section&nbsp;6.7<span> (</span><span class='info'>Encrypted and Decrypted POP Controls</span><span>)</span></a>).
</p>
</blockquote>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.3.3"></a><h3>3.2.1.3.3.&nbsp;
Enveloped Data</h3>

<p>The EnvelopedData content type provides for shrouding of data.
</p>
<p>The EnvelopedData content type is the primary confidentiality method for sensitive information in this protocol.  EnvelopedData can provide encryption of an entire PKI Request (see <a class='info' href='#s_PKI_Encrypt'>Section&nbsp;5<span> (</span><span class='info'>Application of Encryption to a PKI Request/Response</span><span>)</span></a>).  EnvelopedData can also be used to wrap private key material for key archival.  If the decryption on an EnvelopedData fails, the Full PKI Response with a CMCFailInfo value with a value of badMessageCheck and a bodyPartId of 0.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.3.4"></a><h3>3.2.1.3.4.&nbsp;
Signed Data</h3>

<p>The SignedData content type provides for authentication and integrity.
</p>
<p>The SignedData content type is used by this document for:
</p>
<blockquote class="text">
<p>The outer wrapper for a PKI Request.
</p>
<p>The outer wrapper for a PKI Response.
</p>
</blockquote>
<p>As part of processing a PKI Request/Response, the signature(s) MUST be verified.  If the signature does not verify and the PKI Request/Response contains anything other than a CMC Status Info control, a Full PKI Response containing a CMC Status Info control MUST be returned using a CMCFailInfo with a value of badMessageCheck and a bodyPartId of 0.
</p>
<p>For the PKI Response, SignedData allows the server to sign the returning data, if any exists, and to carry the certificates and CRLs corresponding to the PKI Request.  If no data is being returned beyond the certificates and CRLs, the EncapsulatedInfo and SignerInfo fields are not populated.
</p>
<a name="s_OtherMsg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.4"></a><h3>3.2.1.4.&nbsp;
Other Message Bodies</h3>

<p>The otherMsgSequence field of the PKI Request/Response allows for arbitrary data objects to be carried as part of a PKI Request/Response.  This is intended to contain a data object that is not already wrapped in a cmsSequence field <a class='info' href='#s_ContentInfo'>Section&nbsp;3.2.1.3<span> (</span><span class='info'>Content Info Objects</span><span>)</span></a>. The data object is ignored unless a control references the data object by bodyPartID.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  OtherMsg ::= SEQUENCE {
      bodyPartID        BodyPartID,
      otherMsgType      OBJECT IDENTIFIER,
      otherMsgValue     ANY DEFINED BY otherMsgType }
</pre></div>
<p>The fields in OtherMsg have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>bodyPartID</dt>
<dd> is the unique id identifying this data object.
</dd>
<dt>otherMsgType</dt>
<dd> is the OID that defines the type of message body
</dd>
<dt>otherMsgValue</dt>
<dd> is the data.
</dd>
</dl></blockquote>
<a name="s_BodyPartID"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2"></a><h3>3.2.2.&nbsp;
Body Part Identification</h3>

<p>Each element of a PKIData or PKIResponse has an associated body part identifier.  The body part identifier is a 4-octet integer using the ASN.1 of:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   bodyIdMax INTEGER ::= 4294967295

   BodyPartID ::= INTEGER(0..bodyIdMax)
</pre></div>
<p>Body part identifiers are  encoded in the certReqIds field for CertReqMsg objects (in a TaggedRequest) or in the bodyPartID field of the other objects.  The body part identifier MUST be unique within a single PKIData or PKIResponse.  Body part identifiers can be duplicated in different layers (for example a PKIData embedded within another).
</p>
<p>The bodyPartId value of 0 is reserved for use as the reference to the current PKIData object.
</p>
<p>Some controls, such as the Add Extensions control (<a class='info' href='#c_addExtensions'>Section&nbsp;6.5.2<span> (</span><span class='info'>Add Extensions Control</span><span>)</span></a>) use the body part identifier in the pkiDataReference field to refer to a PKI Request in the current PKIData.

					Some controls, such as the Extended CMC Status Info control (<a class='info' href='#c_statusInfoV2'>Section&nbsp;6.1.1<span> (</span><span class='info'>Extended CMC Status Info Control</span><span>)</span></a>), will also use body part identifiers to refer to elements in the previous PKI Request/Response.  This allows an error to be explicit about the control or PKI Request to which the error applies.
</p>
<p>A BodyPartList contains a list of body parts in a PKI Request/Response (i.e. the Batch Request control in <a class='info' href='#c_batchRequests'>Section&nbsp;6.17<span> (</span><span class='info'>Batch Request and Response Controls</span><span>)</span></a>).  The ASN.1 type BodyPartList is defined as:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   BodyPartList ::= SEQUENCE SIZE (1..MAX) OF BodyPartID
</pre></div>
<p>A BodyPartPath contains a path of body part identifiers moving through nesting (i.e. the Modify Certificate Request control in <a class='info' href='#c_modCertTemplate'>Section&nbsp;6.5.1<span> (</span><span class='info'>Modify Certificate Request Control</span><span>)</span></a>).  The ASN.1 type BodyPartPath is defined as:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   BodyPartPath ::= SEQUENCE SIZE (1..MAX) OF BodyPartID
</pre></div>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.3"></a><h3>3.2.3.&nbsp;
CMC Unsigned Data Attribute</h3>

<p>There is sometimes a need to include data in a PKI Request designed to be removed by an RA during processing.  An example of this is the inclusion of an encrypted private key, where a key archive agent removes the encrypted private key before sending it on to the CA.  One side effect of this desire is that every RA which encapsulates this information needs to move the data so that it is not covered by that RA's signature.  (A client PKI Request, encapsulated by an RA cannot have a signed control removed by the key archive agent without breaking the RA's signature.)  The CMC Unsigned Data attribute addresses this problem.
</p>
<p>The CMC Unsigned Data attribute contains information that is not directly signed by a client.  When an RA encounters this attribute in the unsigned or unauthenticated attribute field of a request it is aggregating, the CMC Unsigned Data attribute is removed from the request prior to placing it in a cmsSequence and placed in the unsigned or unauthenticated attributes of the RA's signed or authenticated data wrapper.
</p>
<p> The CMC Unsigned Data attribute is identified by:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
id-aa-cmc-unsignedData OBJECT IDENTIFIER ::= {id-aa 34}
</pre></div>
<p>The CMC Unsigned Data attribute has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   CMCUnsignedData ::= SEQUENCE {
       bodyPartPath        BodyPartPath,
       identifier          OBJECT IDENTIFIER,
       content             ANY DEFINED BY identifier
   }
</pre></div>
<p>The fields in CMCUnsignedData have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>bodyPartPath</dt>
<dd>is the path pointing to the control associated with this data.  When an RA moves the control in an unsigned or unauthenticated attribute up one level as part of wrapping the data in a new SignedData or AuthenticatedData, the body part identifier of the embedded item in the PKIData is pre-pended to the bodyPartPath sequence.
</dd>
<dt>identifier</dt>
<dd>is the OID that defines the associated data.
</dd>
<dt>content</dt>
<dd> is the data.
</dd>
</dl></blockquote>
<p>There MUST be at most one CMC Unsigned Data attribute in the UnsignedAttribute sequence of a SignerInfo or in the UnauthenticatedAttribute sequence of an AuthenticatedData.  UnsignedAttribute consists of a set of values, the attribute can have any number of values greater than zero in that set. If the CMC Unsigned Data attribute is in one SignerInfo or AuthenticatedData, it MUST appear with the same values(s) in all SignerInfo and AuthenticatedData items.
</p>
<a name="s_PKIResponse"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
PKI Responses</h3>

<p>Two types of PKI Responses exist.  This section gives the details on both types.
</p>
<a name="s_SimpleResponse"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Simple PKI Response</h3>

<p>
          Clients MUST be able to process the Simple PKI Response.  
          The Simple PKI Response consists of a SignedData with no EncapsulatedContentInfo and no SignerInfo.  
          The certificates requested in the PKI Response are returned in the certificate field of the SignedData.
</p>
<p>
          Clients MUST NOT assume the certificates are in any order. 
          Servers SHOULD include all intermediate certificates needed to form complete certification paths to one or more trust anchors, not just the newly issued certificate(s). 
          The server MAY additionally return CRLs in the CRL bag. 
          Servers MAY include the self-signed certificates. 
          Clients MUST NOT implicitly trust included self-signed certificate(s) merely due to its presence in the certificate bag.
          In the event clients receive a new self-signed certificate from the server, clients SHOULD provide a mechanism to enable the user to use the certificate as a trust anchor.
          (The Publish Trust Anchors control <a class='info' href='#c_trustAnchors'>Section&nbsp;6.15<span> (</span><span class='info'>Publish Trust Anchors Control</span><span>)</span></a> should be used in the event that the server intends the client to accept one or more certificates as trust anchors.  This requires the use of the Full PKI Response message.)
        
</p>
<a name="s_FullResponse"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Full PKI Response</h3>

<p>Clients MUST be able to process a Full  PKI Response.
</p>
<p>The Full PKI Response consists of a SignedData encapsulating a PKIResponse content type.  The certificates issued in a PKI Response are returned in the certificates field of the immediately encapsulating SignedData.
</p>
<p>
Clients MUST NOT assume the certificates are in any order.
 Servers SHOULD include all intermediate certificates needed to form complete chains one or more trust anchors, not just the newly issued certificate(s). 
The server MAY additionally return CRLs in the CRL bag. 
 Servers MAY include self-signed certificates. 
Clients MUST NOT implicitly trust included self-signed certificate(s) merely due to its presence in the certificate bag. 
In the event clients receive a new self-signed certificate from the server, clients MAY provide a mechanism to enable the user to explicitly use the certificate as a trust anchor.
 (The Publish Trust Anchors control <a class='info' href='#c_trustAnchors'>Section&nbsp;6.15<span> (</span><span class='info'>Publish Trust Anchors Control</span><span>)</span></a> exists for the purpose of allowing for distribution of trust anchor certificates. 
 If a trusted anchor publishes a new trusted anchor, this is one case where automated trust of the new trust anchor could be allowed.)
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
PKIResponse Content Type</h3>

<p>The PKIResponse content type is used for the Full PKI Response.  The PKIResponse content type is identified by:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  id-cct-PKIResponse ::= {id-pkix id-cct(12) 3  }
</pre></div>
<p>The ASN.1 structure corresponding to the PKIResponse content type is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   PKIResponse ::= SEQUENCE {
       controlSequence   SEQUENCE SIZE(0..MAX) OF TaggedAttribute,
       cmsSequence       SEQUENCE SIZE(0..MAX) OF TaggedContentInfo,
       otherMsgSequence  SEQUENCE SIZE(0..MAX) OF OtherMsg
   }

   ReponseBody ::= PKIResponse
</pre></div>
<p>Note:  In <a class='info' href='#RFC2797'>[RFC2797]<span> (</span><span class='info'>Myers, M., Liu, X., Schaad, J., and J. Weinstein, &ldquo;Certificate Management Messages over CMS,&rdquo; April&nbsp;2000.</span><span>)</span></a>, this ASN.1 type was named ResponseBody.  It has been renamed to PKIResponse for clarity and the old name kept as a synonym.
</p>
<p>The fields in PKIResponse have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>controlSequence</dt>
<dd> is a sequence of controls.  The controls defined in this document are found in <a class='info' href='#s_Controls'>Section&nbsp;6<span> (</span><span class='info'>Controls</span><span>)</span></a>. Controls can be defined by other parties. Details on the TaggedAttribute structure are found in <a class='info' href='#s_TaggedAttribute'>Section&nbsp;3.2.1.1<span> (</span><span class='info'>Control Syntax</span><span>)</span></a>.
</dd>
<dt>cmsSequence</dt>
<dd> is a sequence of <a class='info' href='#CMS'>[CMS]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; July&nbsp;2004.</span><span>)</span></a> message objects.  See <a class='info' href='#s_ContentInfo'>Section&nbsp;3.2.1.3<span> (</span><span class='info'>Content Info Objects</span><span>)</span></a> for more details.
</dd>
<dt>otherMsgSequence</dt>
<dd> is a sequence of arbitrary data objects.   Data objects placed here are referred to by one or more controls.  This allows for controls to use large amounts of data without the data being embedded in the control.  See <a class='info' href='#s_OtherMsg'>Section&nbsp;3.2.1.4<span> (</span><span class='info'>Other Message Bodies</span><span>)</span></a> for more details.
</dd>
</dl></blockquote>
<p>Processing of PKIResponse by a recipient is as follows:
</p>
<ol class="text">
<li>	All controls should be examined and processed in an appropriate manner.  The appropriate processing is to complete processing at this time, to ignore the control or to place the control on a to-do list for later processing.
</li>
<li>	Additional processing of non-element items includes the saving of certificates and CRLs present in wrapping layers.  This type of processing is based on the consumer of the element and should not be relied on by generators.
</li>
</ol>
<p>No processing is required for cmsSequence or otherMsgSequence members of the PKIResponse, if items are present and are not referenced by a control.  In this case, the cmsSequence and otherMsgSequence members are to be ignored.
</p>
<a name="s_PKI_Encrypt"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Application of Encryption to a PKI Request/Response</h3>

<p>
There are occasions when a PKI Request or Response must be encrypted in order to prevent disclosure of information in the PKI Request/Response from being accessible to unauthorized entities.
This section describes the means to encrypt Full PKI Requests and Responses (Simple PKI Requests cannot be encrypted).
Data portions of PKI Requests and Responses that are placed in the cmsSequence field can be encrypted separately.

</p>
<p>Confidentiality is provided by wrapping the PKI Request/Response (a SignedData) in an EnvelopedData.  The nested content type in the EnvelopedData is id-SignedData.  Note that this is different from S/MIME where there is a MIME layer placed between the encrypted and signed data.  It is recommended that if an EnvelopedData layer is applied to a PKI Request/Response, a second signature layer be placed outside of the EnvelopedData layer.  The following figure shows how this nesting would be done:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  Normal              Option 1                  Option 2
  ------              --------                  --------
  SignedData          EnvelopedData             SignedData
   PKIData             SignedData                EnvelopedData
                        PKIData                   SignedData
                                                   PKIData
</pre></div>
<p>Note: PKIResponse can be substituted for PKIData in the above figure.
</p>
<p>
Options 1 and 2 prevent leakage of sensitive data by encrypting the Full PKI Request/Response.
An RA that receives a PKI Request that it cannot decrypt MAY reject the PKI Request unless it can process the PKI Request without knowledge of the contents (i.e., all it does is amalgamate multiple PKI Requests and forwards them to a server).  After the RA removes the envelope and completes processing, it may then apply a new EnvelopedData layer to protect PKI Requests for transmission to the next processing agent.
<a class='info' href='#s_RA_Processing'>Section&nbsp;7<span> (</span><span class='info'>Registration Authorities</span><span>)</span></a> contains more information about RA processing.
</p>
<p>Full PKI Requests/Responses can be encrypted or transmitted in the clear.  Servers MUST provide support for all three options.
</p>
<p>
Alternatively, an authenticated, secure channel could exist between the parties that require confidentiality. 
Clients and servers MAY use such channels instead of the technique described above to provide secure, private communication of Simple and Full PKI Requests/Responses.
</p>
<a name="s_Controls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Controls</h3>

<p>Controls are carried as part of both Full PKI Requests and Responses. Each control is encoded as a unique OID followed by the data for the control (see syntax in <a class='info' href='#s_TaggedAttribute'>Section&nbsp;3.2.1.1<span> (</span><span class='info'>Control Syntax</span><span>)</span></a>.  The encoding of the data is based on the control.  Processing systems would first detect the OID (TaggedAttribute attrType) and process the corresponding control value (TaggedAttribute attrValues) prior to processing the message body.
</p>
<p>The OIDs are all defined under the following arc:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-pkix OBJECT IDENTIFIER  ::= { iso(1) identified-organization(3)
        dod(6) internet(1) security(5) mechanisms(5) pkix(7) }

   id-cmc OBJECT IDENTIFIER ::= { id-pkix 7 }
</pre></div><br /><hr class="insert" />
<a name="control_table"></a>

<p style='text-align: center'>The following table lists the names, OID and syntactic structure for each of the controls described in this document.
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left"><col align="left">
<tr><th align="left">Control Identifier</th><th align="left">OID</th><th align="left">Syntax</th><th align="left">Section</th></tr>
<tr>
<td align="left">   id-cmc-statusInfo              </td>
<td align="left"> id-cmc 1   </td>
<td align="left">    CMCStatusInfo	</td>
<td align="left">
					<a class='info' href='#c_statusInfo'>Section&nbsp;6.1.2<span> (</span><span class='info'>CMC Status Info Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-identification          </td>
<td align="left"> id-cmc 2   </td>
<td align="left">    UTF8String       </td>
<td align="left">
					<a class='info' href='#c_identification'>Section&nbsp;6.2.3<span> (</span><span class='info'>Identification Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-identityProof           </td>
<td align="left"> id-cmc 3   </td>
<td align="left">    OCTET STRING     </td>
<td align="left">
					<a class='info' href='#c_identityProof'>Section&nbsp;6.2.2<span> (</span><span class='info'>Identity Proof Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-dataReturn              </td>
<td align="left"> id-cmc 4   </td>
<td align="left">    OCTET STRING     </td>
<td align="left">
					<a class='info' href='#c_dataReturn'>Section&nbsp;6.4<span> (</span><span class='info'>Data Return Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-transactionId           </td>
<td align="left"> id-cmc 5   </td>
<td align="left">    INTEGER          </td>
<td align="left">
					<a class='info' href='#c_transactionId'>Section&nbsp;6.6<span> (</span><span class='info'>Transaction Identifier, Sender and Recipient Nonce Controls</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-senderNonce             </td>
<td align="left"> id-cmc 6   </td>
<td align="left">    OCTET STRING     </td>
<td align="left">
					<a class='info' href='#c_transactionId'>Section&nbsp;6.6<span> (</span><span class='info'>Transaction Identifier, Sender and Recipient Nonce Controls</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-recipientNonce          </td>
<td align="left"> id-cmc 7   </td>
<td align="left">    OCTET STRING     </td>
<td align="left">
					<a class='info' href='#c_transactionId'>Section&nbsp;6.6<span> (</span><span class='info'>Transaction Identifier, Sender and Recipient Nonce Controls</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-addExtensions           </td>
<td align="left"> id-cmc 8   </td>
<td align="left">    AddExtensions    </td>
<td align="left">
					<a class='info' href='#c_addExtensions'>Section&nbsp;6.5.2<span> (</span><span class='info'>Add Extensions Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-encryptedPOP            </td>
<td align="left"> id-cmc 9   </td>
<td align="left">    EncryptedPOP     </td>
<td align="left">
					<a class='info' href='#c_encryptedPOP'>Section&nbsp;6.7<span> (</span><span class='info'>Encrypted and Decrypted POP Controls</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-decryptedPOP            </td>
<td align="left"> id-cmc 10  </td>
<td align="left">    DecryptedPOP     </td>
<td align="left">
					<a class='info' href='#c_encryptedPOP'>Section&nbsp;6.7<span> (</span><span class='info'>Encrypted and Decrypted POP Controls</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-lraPOPWitness           </td>
<td align="left"> id-cmc 11  </td>
<td align="left">    LraPOPWitness    </td>
<td align="left">
					<a class='info' href='#c_lraPOPWitness'>Section&nbsp;6.8<span> (</span><span class='info'>RA POP Witness Control </span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-getCert                 </td>
<td align="left"> id-cmc 15  </td>
<td align="left">    GetCert  		</td>
<td align="left">
					<a class='info' href='#c_getCert'>Section&nbsp;6.9<span> (</span><span class='info'>Get Certificate Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-getCRL                  </td>
<td align="left"> id-cmc 16  </td>
<td align="left">    GetCRL           </td>
<td align="left">
					<a class='info' href='#c_getCRL'>Section&nbsp;6.10<span> (</span><span class='info'>Get CRL Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-revokeRequest           </td>
<td align="left"> id-cmc 17  </td>
<td align="left">    RevokeRequest    </td>
<td align="left">
					<a class='info' href='#c_revokeRequest'>Section&nbsp;6.11<span> (</span><span class='info'>Revocation Request Control </span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-regInfo                 </td>
<td align="left"> id-cmc 18  </td>
<td align="left">    OCTET STRING		</td>
<td align="left">
					<a class='info' href='#c_regInfo'>Section&nbsp;6.12<span> (</span><span class='info'>Registration and Response Information Controls</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-responseInfo            </td>
<td align="left"> id-cmc 19   </td>
<td align="left">   OCTET STRING		</td>
<td align="left">
					<a class='info' href='#c_regInfo'>Section&nbsp;6.12<span> (</span><span class='info'>Registration and Response Information Controls</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-queryPending            </td>
<td align="left"> id-cmc 21   </td>
<td align="left">   OCTET STRING     </td>
<td align="left">
					<a class='info' href='#c_queryPending'>Section&nbsp;6.13<span> (</span><span class='info'>Query Pending Control </span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-popLinkRandom           </td>
<td align="left"> id-cmc 22  </td>
<td align="left">    OCTET STRING     </td>
<td align="left">
					<a class='info' href='#c_popLinkRandom'>Section&nbsp;6.3.1.3<span> (</span><span class='info'>POP Link Random Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-popLinkWitness          </td>
<td align="left"> id-cmc 23  </td>
<td align="left">    OCTET STRING     </td>
<td align="left">
					<a class='info' href='#c_popLinkWitness'>Section&nbsp;6.3.1.2<span> (</span><span class='info'>POP Link Witness Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">id-cmc-popLinkWitnessV2</td>
<td align="left"> id-cmc 33  </td>
<td align="left">OCTET STRING</td>
<td align="left"><a class='info' href='#c_popLinkWitness2'>Section&nbsp;6.3.1.1<span> (</span><span class='info'>POP Link Witness Version 2 Controls</span><span>)</span></a></td>
</tr>
<tr>
<td align="left">   id-cmc-confirmCertAcceptance   </td>
<td align="left"> id-cmc 24  </td>
<td align="left">    CMCCertId        </td>
<td align="left">
					<a class='info' href='#c_confirmCertAcceptance'>Section&nbsp;6.14<span> (</span><span class='info'>Confirm Certificate Acceptance Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-statusInfoV2            </td>
<td align="left"> id-cmc 25   </td>
<td align="left">   CMCStatusInfoV2  </td>
<td align="left">
					<a class='info' href='#c_statusInfoV2'>Section&nbsp;6.1.1<span> (</span><span class='info'>Extended CMC Status Info Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-trustedAnchors          </td>
<td align="left"> id-cmc 26   </td>
<td align="left">   PublishTrustAnchors </td>
<td align="left">
					<a class='info' href='#c_trustAnchors'>Section&nbsp;6.15<span> (</span><span class='info'>Publish Trust Anchors Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-authData                </td>
<td align="left"> id-cmc 27   </td>
<td align="left">   AuthPublish  	</td>
<td align="left">
					<a class='info' href='#c_authData'>Section&nbsp;6.16<span> (</span><span class='info'>Authenticated Data Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-batchRequests           </td>
<td align="left"> id-cmc 28  </td>
<td align="left">    BodyPartList     </td>
<td align="left">
					<a class='info' href='#c_batchRequests'>Section&nbsp;6.17<span> (</span><span class='info'>Batch Request and Response Controls</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-batchResponses          </td>
<td align="left"> id-cmc 29  </td>
<td align="left">    BodyPartList     </td>
<td align="left">
					<a class='info' href='#c_batchRequests'>Section&nbsp;6.17<span> (</span><span class='info'>Batch Request and Response Controls</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-publishCert             </td>
<td align="left"> id-cmc 30   </td>
<td align="left">   CMCPublicationInfo </td>
<td align="left">
					<a class='info' href='#c_publishCert'>Section&nbsp;6.18<span> (</span><span class='info'>Publication Information Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-modCertTemplate         </td>
<td align="left"> id-cmc 31  </td>
<td align="left">    ModCertTemplate	</td>
<td align="left">
					<a class='info' href='#c_modCertTemplate'>Section&nbsp;6.5.1<span> (</span><span class='info'>Modify Certificate Request Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-controlProcessed        </td>
<td align="left"> id-cmc 32  </td>
<td align="left">    ControlsProcessed </td>
<td align="left">
					<a class='info' href='#c_controlProcessed'>Section&nbsp;6.19<span> (</span><span class='info'>Control Processed Control</span><span>)</span></a>
				</td>
</tr>
<tr>
<td align="left">   id-cmc-identityProofV2</td>
<td align="left"> id-cmc 34   </td>
<td align="left">    IdentityProofV2     </td>
<td align="left">
					<a class='info' href='#c_identityProofV2'>Section&nbsp;6.2.1<span> (</span><span class='info'>Identity Proof Version 2 Control</span><span>)</span></a>
				</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 1: CMC Control Attributes&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
CMC Status Info Controls</h3>

<p>The CMC Status Info controls return information about the status of a client/server request/response.  Two controls are described in this section.  The Extended CMC Status Info control is the preferred control; the CMC Status Info control is included for backwards compatibility with RFC 2797.
</p>
<p>Servers MAY emit multiple CMC status info controls referring to a single body part.  Clients MUST be able to deal with multiple CMC status info controls in a PKI Response.  Servers MUST use the Extended CMC Status Info control, but MAY additionally use the CMC Status Info control.  Clients MUST be able to process the Extended CMC Status Info control.
</p>
<a name="c_statusInfoV2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.1"></a><h3>6.1.1.&nbsp;
Extended CMC Status Info Control</h3>

<p>The Extended CMC Status Info control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-statusInfoV2 ::= { id-cmc 25 }
</pre></div>
<p>The Extended CMC Status Info control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   CMCStatusInfoV2 ::= SEQUENCE {
      cMCStatus             CMCStatus,
      bodyList              SEQUENCE SIZE (1..MAX) OF BodyPartReference,
      statusString          UTF8String OPTIONAL,
      otherInfo             OtherStatusInfo OPTIONAL
   }

   OtherStatusInfo ::= CHOICE {
      failInfo              CMCFailInfo,
      pendInfo              PendInfo,
      extendedFailInfo      ExtendedFailInfo
   }

   PendInfo ::= SEQUENCE {
      pendToken           OCTET STRING,
      pendTime            GeneralizedTime
   }

   ExtendedFailInfo ::= SEQUENCE {
      failInfoOID            OBJECT IDENTIFIER,
      failInfoValue          ANY DEFINED BY failInfoOID
   }

   BodyPartReference ::= CHOICE {
      bodyPartID           BodyPartID,
      bodyPartPath         BodyPartPath
   }

</pre></div>
<p>The fields in CMCStatusInfoV2 have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>cMCStatus</dt>
<dd> contains the returned status value.  Details are in <a class='info' href='#s_CMC_Status'>Section&nbsp;6.1.3<span> (</span><span class='info'>CMCStatus values</span><span>)</span></a>.
</dd>
<dt>bodyList</dt>
<dd> identifies the controls or other elements to which the status value applies.  
 If an error is returned for a Simple PKI Request, this field is the bodyPartID choice of BodyPartReference with the single integer of value 1.

</dd>
<dt>statusString</dt>
<dd> contains additional description information.  This string is human readable.
</dd>
<dt>otherInfo</dt>
<dd> contains additional information that expands on the CMC status code returned in the cMCStatus field. 
</dd>
</dl></blockquote>
<p>The fields in  OtherStatusInfo have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>failInfo</dt>
<dd> is described in <a class='info' href='#s_CMC_FailInfo'>Section&nbsp;6.1.4<span> (</span><span class='info'> CMCFailInfo</span><span>)</span></a>. It provides an error code that details what failure occurred.  This choice is present only if cMCStatus contains the value failed.
</dd>
<dt>pendInfo</dt>
<dd> contains information about when and how the client should request for the result of this request.  It is present when the cMCStatus is either pending or partial.  pendInfo uses the structure PendInfo, which has the fields:
</dd>
<blockquote class="text"><dl>
<dt>pendToken</dt>
<dd> is the token used in the Query Pending control <a class='info' href='#c_queryPending'>Section&nbsp;6.13<span> (</span><span class='info'>Query Pending Control </span><span>)</span></a>.
</dd>
<dt>pendTime</dt>
<dd> contains the suggested time the server wants to be queried about the status of the certification request.
</dd>
</dl></blockquote>
<dt>extendedFailInfo</dt>
<dd> includes application dependent detail error information.
This choice is present only if cMCStatus contains the value failed.  
Caution should be used when defining new values as they may not be correctly recognized by all clients and servers.  
The CMCFailInfo value of internalCAError may be assumed if the extended error is not recognized.  This field uses the type ExtendedFailInfo.  ExtendedFailInfo has the fields:

</dd>
<blockquote class="text"><dl>
<dt>failInfoOID</dt>
<dd>contains an OID that is associated with a set of extended error values.
</dd>
<dt>failInfoValue</dt>
<dd>contains an extended error code from the defined set of extended error codes.
</dd>
</dl></blockquote>
</dl></blockquote>
<p>If the cMCStatus field is success, the Extended CMC Status Info control MAY be omitted unless it is the only item in the response.
</p>
<a name="c_statusInfo"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.2"></a><h3>6.1.2.&nbsp;
CMC Status Info Control</h3>

<p>The CMC Status Info control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-statusInfo ::= { id-cmc 1 }
</pre></div>
<p>The CMC Status Info control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      CMCStatusInfo ::= SEQUENCE {
           cMCStatus           CMCStatus,
           bodyList            BodyPartList,
           statusString        UTF8String OPTIONAL,
           otherInfo           CHOICE {
             failInfo            CMCFailInfo,
             pendInfo            PendInfo } OPTIONAL
      }
</pre></div>
<p> The fields in CMCStatusInfo have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>cMCStatus</dt>
<dd> contains the returned status value.  Details are in <a class='info' href='#s_CMC_Status'>Section&nbsp;6.1.3<span> (</span><span class='info'>CMCStatus values</span><span>)</span></a>.
</dd>
<dt>bodyList</dt>
<dd> contains the list of controls or other element to which the status value applies.  If an error is being returned for a Simple PKI Request, this field contains a single integer of value 1.
</dd>
<dt>statusString</dt>
<dd> contains additional description information.  This string is human readable.
</dd>
<dt>otherInfo</dt>
<dd> provides additional information that expands on the CMC status code returned in the cMCStatus field.
</dd>
<blockquote class="text"><dl>
<dt>failInfo</dt>
<dd> is described in <a class='info' href='#s_CMC_FailInfo'>Section&nbsp;6.1.4<span> (</span><span class='info'> CMCFailInfo</span><span>)</span></a>. It provides an error code that details what failure occurred.  This choice is present only if cMCStatus is failed.
</dd>
<dt>pendInfo</dt>
<dd> uses the PendInfo ASN.1 structure in <a class='info' href='#c_statusInfoV2'>Section&nbsp;6.1.1<span> (</span><span class='info'>Extended CMC Status Info Control</span><span>)</span></a>.  It contains information about when and how the client should request for results on this request.  The pendInfo field MUST be populated for a cMCStatus value of pending or partial.  Further details can be found in <a class='info' href='#c_statusInfoV2'>Section&nbsp;6.1.1<span> (</span><span class='info'>Extended CMC Status Info Control</span><span>)</span></a> (Extended CMC Status Info Control) and <a class='info' href='#c_queryPending'>Section&nbsp;6.13<span> (</span><span class='info'>Query Pending Control </span><span>)</span></a> (Query Pending Control).
</dd>
</dl></blockquote>
</dl></blockquote>
<p>If the cMCStatus field is success, the CMC Status Info control MAY be omitted unless it is the only item in the response.  If no status exists for a Simple or Full PKI Request, then the value of success is assumed.
</p>
<a name="s_CMC_Status"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.3"></a><h3>6.1.3.&nbsp;
CMCStatus values</h3>

<p>CMCStatus is a field in the Extended CMC Status Info and CMC Status Info controls.  This field contains a code representing the success or failure of a specific operation.  CMCStatus has the ASN.1 structure:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   CMCStatus ::= INTEGER {
        success                (0),
        -- reserved            (1),
        failed                 (2),
        pending                (3),
        noSupport              (4),
        confirmRequired        (5),
        popRequired            (6),
        partial                (7)
   }
</pre></div>
<p>The values of CMCStatus have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>success</dt>
<dd> indicates the request was granted or the action was completed.
</dd>
<dt>failed</dt>
<dd> indicates the request was not granted or the action was not completed.  More information is included elsewhere in the response.
</dd>
<dt>pending</dt>
<dd>indicates the PKI Request has yet to be processed.  The requestor is responsible to poll back on this Full PKI request.  pending may only be returned for certification request operations.
</dd>
<dt>noSupport</dt>
<dd>indicates the requested operation is not supported.
</dd>
<dt>confirmRequired</dt>
<dd>indicates a Confirm Certificate Acceptance control <a class='info' href='#c_confirmCertAcceptance'>Section&nbsp;6.14<span> (</span><span class='info'>Confirm Certificate Acceptance Control</span><span>)</span></a> must be returned before the certificate can be used.
</dd>
<dt>popRequired</dt>
<dd>indicates an direct POP operation is required <a class='info' href='#c_popLinkRandom'>Section&nbsp;6.3.1.3<span> (</span><span class='info'>POP Link Random Control</span><span>)</span></a>.
</dd>
<dt>partial</dt>
<dd>indicates a partial PKI Response is returned.  The requestor is responsible to poll back for the unfulfilled portions of the Full PKI Request.
</dd>
</dl></blockquote>
<a name="s_CMC_FailInfo"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.4"></a><h3>6.1.4.&nbsp;
 CMCFailInfo</h3>

<p>CMCFailInfo is a field in the Extended CMC Status Info and CMC Status Info controls.  CMCFailInfo conveys more detailed information relevant to the interpretation of a failure condition. The CMCFailInfo has the following ASN.1 structure:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   CMCFailInfo ::= INTEGER {
        badAlg            (0),
        badMessageCheck   (1),
        badRequest        (2),
        badTime           (3),
        badCertId         (4),
        unsuportedExt     (5),
        mustArchiveKeys   (6),
        badIdentity       (7),
        popRequired       (8),
        popFailed         (9),
        noKeyReuse        (10),
        internalCAError   (11),
        tryLater          (12),
        authDataFail      (13)
   }
</pre></div>
<p>The values of CMCFailInfo have the following meanings:
</p>
<blockquote class="text"><dl>
<dt>badAlg</dt>
<dd>indicates unrecognized or unsupported algorithm.
</dd>
<dt>badMessageCheck</dt>
<dd>indicates integrity check failed.
</dd>
<dt>badRequest</dt>
<dd>indicates transaction not permitted or supported.
</dd>
<dt>badTime</dt>
<dd>indicates message time field was not sufficiently close to the system time.
</dd>
<dt>badCertId</dt>
<dd>indicates no certificate could be identified matching the provided criteria.
</dd>
<dt>unsuportedExt</dt>
<dd>indicates a requested X.509 extension is not supported by the recipient CA.
</dd>
<dt>mustArchiveKeys</dt>
<dd>indicates private key material must be supplied.
</dd>
<dt>badIdentity</dt>
<dd>indicates identification control failed to verify.
</dd>
<dt>popRequired</dt>
<dd>indicates server requires a POP proof before issuing certificate.
</dd>
<dt>popFailed</dt>
<dd>indicates POP processing failed.
</dd>
<dt>noKeyReuse</dt>
<dd>indicates server policy does not allow key reuse.
</dd>
<dt>internalCAError</dt>
<dd>indicates that the CA had an unknown internal failure.
</dd>
<dt>tryLater</dt>
<dd>indicates that the server is not accepting requests at this time and the client should try at a later time.
</dd>
<dt>authDataFail</dt>
<dd>indicates failure occurred during processing of authenticated data
</dd>
</dl></blockquote>
<p>If additional failure reasons are  needed, they SHOULD use the ExtendedFailureInfo item in the Extended CMC Status Info control.  However for closed environments they can be defined using this type.  Such codes MUST be in the range from 1000 to 1999.
</p>
<a name="s_IdProof"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Identification and Identity Proof Controls</h3>

<p>Some CAs and RAs require that a proof-of-identity be included in a certification request.  Many different ways of doing this exist with different degrees of security and reliability.  Most are familiar with a bank's request to provide your mother's maiden name as a form of identity proof.  The reasoning behind requiring a proof-of-identity can be found in Appendix C of <a class='info' href='#CRMF'>[CRMF]<span> (</span><span class='info'>Schaad, J., &ldquo;Internet X.509 Certification Request Message Format,&rdquo; January&nbsp;2005.</span><span>)</span></a>.
</p>
<p>CMC provides a method to prove the client's identity based on a client/server shared-secret.  If clients support the Full PKI Request, clients MUST implement this method of identity proof (<a class='info' href='#c_identityProof'>Section&nbsp;6.2.2<span> (</span><span class='info'>Identity Proof Control</span><span>)</span></a>).  Servers MUST provide this method, but MAY additionally support bilateral methods of similar strength.
</p>
<p>This document also provides an Identification control (<a class='info' href='#c_identification'>Section&nbsp;6.2.3<span> (</span><span class='info'>Identification Control</span><span>)</span></a>).  This control is a simple method to allow a client to state who they are to the server.  Generally, a shared secret AND an identifier of that shared-secret is passed from the server to the client.  The identifier is placed in the Identification control and the shared-secret is used to compute the Identity Proof control.
</p>
<a name="c_identityProofV2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.1"></a><h3>6.2.1.&nbsp;
Identity Proof Version 2 Control</h3>

<p>The Identity Proof Version 2 control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-identityProofV2 ::= { id-cmc 34 }
</pre></div>
<p>The Identity Proof Version 2 control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   IdentifyProofV2 ::= SEQUENCE {
       hashAlgID        AlgorithmIdentifier,
       macAlgID         AlgorithmIdentifier,
       witness          OCTET STRING
   }
</pre></div>
<p>The fields of IdentityProofV2 have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>hashAlgID</dt>
<dd> is the identifier and parameters for the hash algorithm used to convert the shared-secret into a key for the MAC algorithm.
</dd>
<dt>macAlgID</dt>
<dd>is the identifier and the parameters for the message authentication code algorithm used to compute the value of the witness field.
</dd>
<dt>witness</dt>
<dd>is the identity proof.
</dd>
</dl></blockquote>
<p>The required method starts with an out-of-band transfer of a token (the shared-secret).  The shared-secret should be generated in a random manner.  The distribution of this token is beyond the scope of this document.  The client then uses this token for an identity proof as follows:
</p>
<ol class="text">
<li>The PKIData reqSequence field (encoded exactly as it appears in the Full PKI Request including the sequence type and length) is the value to be validated.
</li>
<li>A hash of the shared-secret as a UTF8 string is computed using hashAlgID.
</li>
<li>A MAC is then computed using the value produced in Step 1 as the message and the value from Step 2 as the key.
</li>
<li>The result from Step 3 is then encoded as the witness value in the Identity Proof Version 2 control.
</li>
</ol>
<p>When the server verifies the Identity Proof Version 2 control, it computes the MAC value in the same way and compares it to the witness value contained in the PKI Request.
</p>
<p>If a server fails the verification of an Identity Proof Version 2 control, the CMCFailInfo value MUST be present in the Full PKI Response and MUST have a value of badIdentity.
</p>
<p>Reuse of the shared-secret on certification request retries allows the client and server to maintain the same view of acceptable identity proof values.  However, reuse of the shared-secret can potentially open the door for some types of attacks.
</p>
<p>Implementations MUST be able to support tokens  at least 16 characters long.  Guidance on the amount of entropy actually obtained from a given length token based on character sets can be found in Appendix A of <a class='info' href='#PASSWORD'>[PASSWORD]<span> (</span><span class='info'>Burr, W., Dodson, D., and W. Polk, &ldquo;Electronic Authentication Guideline,&rdquo; April&nbsp;2006.</span><span>)</span></a>.
</p>
<a name="c_identityProof"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.2"></a><h3>6.2.2.&nbsp;
Identity Proof Control</h3>

<p>The Identity Proof control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-identityProof ::= { id-cmc 3 }
</pre></div>
<p>The Identity Proof control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   IdentifyProof ::= OCTET STRING
</pre></div>
<p>This control is processed in the same way as the Identity Proof Version 2 control.  In this case the hash algorithm is fixed to SHA-1 and the MAC algorithm is fixed to HMAC-SHA1.
</p>
<a name="c_identification"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.3"></a><h3>6.2.3.&nbsp;
Identification Control</h3>

<p>Optionally, servers MAY require the inclusion of the unprotected Identification control with an Identification Proof control.  The Identification control is intended to contain a text string which assists the server in locating the shared-secret needed to validate the contents of the Identity Proof control.  If the Identification control is included in the Full PKI Request, the derivation of the key in step 2 (from <a class='info' href='#c_identityProofV2'>Section&nbsp;6.2.1<span> (</span><span class='info'>Identity Proof Version 2 Control</span><span>)</span></a> is altered so that the hash of the concatenation of the shared-secret and the UTF8 identity value (without the type and length bytes) are hashed rather than just the shared-secret.
</p>
<p>The Identification control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-identification ::= { id-cmc 2 }
</pre></div>
<p>The Identification control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   Identification ::= UTF8String
</pre></div>
<a name="s_hardwareToken"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.4"></a><h3>6.2.4.&nbsp;
Hardware Shared-Secret Token Generation</h3>

<p>The shared-secret between the EE and the server is sometimes computed using a hardware device that generates a series of tokens.  The EE can therefore prove their identity by transferring this token in plain text along with a name string.  The above protocol can be used with a hardware shared-secret token generation device by the following modifications:
</p>
<ol class="text">
<li>	The Identification control MUST be included and MUST contain the hardware-generated token.
</li>
<li>	The shared-secret value used above is the same hardware-generated    token.
</li>
<li>	All certification requests MUST have a subject name and the subject name MUST contain the fields required to identify the holder of the hardware token device.
</li>
<li> The entire certification request MUST be shrouded in some fashion to prevent eavesdropping.  Although the token is time critical, an active eavesdropper cannot be permitted to extract the token and submit a different certification request with the same token value.
</li>
</ol>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Linking Identity and POP Information</h3>

<p>In a Full PKI Request, identity information about the client is carried in the signature of the SignedData containing all of the certification requests. Proof-of-possession information for key pairs, however, is carried separately for each PKCS #10 or CRMF certification request.  (For keys capable of generating a digital signature, the POP is provided by the signature on the PKCS #10 or CRMF request. For encryption-only keys the controls described in <a class='info' href='#c_encryptedPOP'>Section&nbsp;6.7<span> (</span><span class='info'>Encrypted and Decrypted POP Controls</span><span>)</span></a> are used.)  In order to prevent substitution-style attacks, the protocol must guarantee that the same entity generated both the POP and proof-of-identity information.
</p>
<p>This section describes two mechanisms for linking identity and POP information: witness values cryptographically derived from the shared-secret (<a class='info' href='#c_popLinkRandom'>Section&nbsp;6.3.1.3<span> (</span><span class='info'>POP Link Random Control</span><span>)</span></a>) and shared-secret/subject DN matching (<a class='info' href='#c_LinkSecret'>Section&nbsp;6.3.2<span> (</span><span class='info'>Shared-secret/subject DN linking</span><span>)</span></a>).  Clients and servers MUST support the witness value technique.  Clients and servers MAY support shared-secret/subject DN matching or other bilateral techniques of similar strength.  The idea behind both mechanisms is to force the client to sign some data into each certification request that can be directly associated with the shared-secret; this will defeat attempts to include certification requests from different entities in a single Full PKI Request.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.1"></a><h3>6.3.1.&nbsp;
Cryptographic Linkage</h3>

<p>The first technique that links identity and POP information forces the client to include a piece of information cryptographically-derived from the shared-secret as a signed extension within each certification request (PKCS #10 or CRMF).
</p>
<a name="c_popLinkWitness2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.1.1"></a><h3>6.3.1.1.&nbsp;
POP Link Witness Version 2 Controls</h3>

<p>The  POP Link Witness Version 2 control is identified by the OIDs:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-popLinkWitnessV2 ::= { id-cmc 33 }
</pre></div>
<p>The POP Link Witness Version 2 control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   PopLinkWitnessV2 ::= SEQUENCE {
       keyGenAlgorithm   AlgorithmIdentifier,
       macAlgorithm      AlgorithmIdentifier,
       witness           OCTET STRING
   }
</pre></div>
<p>The fields of PopLinkWitnessV2 have the meaning:
</p>
<blockquote class="text"><dl>
<dt>keyGenAlgorithm</dt>
<dd>contains the algorithm used to generate the key for the MAC algorithm.  This will generally be a hash algorithm, but could be a more complex algorithm.
</dd>
<dt>macAlgorithm</dt>
<dd>contains the algorithm used to create the witness value.
</dd>
<dt>witness</dt>
<dd>contains the computed witness value.
</dd>
</dl></blockquote>
<p>This technique is useful if null subject DNs are used (because, for example, the server can generate the subject DN for the certificate based only on the shared-secret).  Processing begins when the client receives the shared-secret out-of-band from the server.  The client then computes the following values:
</p>
<ol class="text">
<li>	The client generates a random byte-string, R, which SHOULD be at least 512 bits in length.
</li>
<li>	The key is computed from the shared-secret using the algorithm in keyGenAlgorithm.
</li>
<li>	A MAC is then computed over the random value produced in Step 1, using the key computed in Step 2.
</li>
<li>	The random value produced in Step 1 is encoded as the value of a POP Link Random control.  This control MUST be included in the Full PKI Request.
</li>
<li>	The MAC value produced in Step 3 is placed in either the POP Link Witness control or the witness field of the POP Link Witness V2 control.
</li>
<ul class="text">
<li>For CRMF, the POP Link Witness/POP Link Witness V2 control is included in the controls field of the CertRequest structure.
</li>
<li>For PKCS #10, the POP Link Witness/POP Link Witness V2 control is included in the attributes field of the CertificationRequestInfo structure.
</li>
</ul>
</ol>
<p>Upon receipt, servers MUST verify that each certification request contains a copy of the POP Link Witness/POP Link Witness V2 control and that its value was derived using the above method from the shared-secret and the random string included in the POP Link Random control.
</p>
<p>The Identification control (see <a class='info' href='#c_identification'>Section&nbsp;6.2.3<span> (</span><span class='info'>Identification Control</span><span>)</span></a>) or the subject DN of a certification request can be used to help identify which shared-secret was used.
</p>
<a name="c_popLinkWitness"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.1.2"></a><h3>6.3.1.2.&nbsp;
POP Link Witness Control</h3>

<p>The POP Link Witness control is identified by the OIDs:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-popLinkWitness ::= { id-cmc 23 }
</pre></div>
<p>The POP Link Witness control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   PopLinkWitness ::= OCTET STRING
</pre></div>
<p>For this control, SHA-1 is used as the key generation algorithm.  HMAC-SHA1 is used as the mac algorithm.
</p>
<a name="c_popLinkRandom"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.1.3"></a><h3>6.3.1.3.&nbsp;
POP Link Random Control</h3>

<p>The POP Link Random control is identified by the OID:
</p>
<p>The POP Link Random is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-popLinkRandom  ::= { id-cmc 22 }
</pre></div>
<p>The POP Link Random control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   PopLinkRandom ::= OCTET STRING
</pre></div>
<a name="c_LinkSecret"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.2"></a><h3>6.3.2.&nbsp;
Shared-secret/subject DN linking</h3>

<p>The second technique to link identity and POP information is to link a particular subject distinguished name (subject DN) to the shared-secrets that are distributed out-of-band and to require that clients using the shared-secret to prove identity include that exact subject DN in every certification request.  It is expected that many client-server connections that use shared-secret based proof-of-identity will use this mechanism. (It is common not to omit the subject DN information from the certification request.)
</p>
<p>When the shared-secret is generated and transferred out-of-band to initiate the registration process (<a class='info' href='#s_IdProof'>Section&nbsp;6.2<span> (</span><span class='info'>Identification and Identity Proof Controls</span><span>)</span></a>), a particular subject DN is also associated with the shared-secret and communicated to the client.  (The subject DN generated MUST be unique per entity in accordance with the CA policy; a null subject DN cannot be used.  A common practice could be to place the identification value as part of the subject DN.)  When the client generates the Full PKI Request, it MUST use these two pieces of information as follows:
</p>
<ol class="text">
<li>	The client MUST include the specific subject DN that it received    along with the shared-secret as the subject name in every certification request (PKCS #10 and/or CRMF) in the Full PKI Request. The subject names in the certification requests MUST NOT be null.
</li>
<li>	The client MUST include an Identity Proof control (<a class='info' href='#c_identityProof'>Section&nbsp;6.2.2<span> (</span><span class='info'>Identity Proof Control</span><span>)</span></a>) or Identity Proof Version 2 (<a class='info' href='#c_identityProofV2'>Section&nbsp;6.2.1<span> (</span><span class='info'>Identity Proof Version 2 Control</span><span>)</span></a>), derived from the shared-secret, in the Full PKI Request.
</li>
</ol>
<p>The server receiving this message MUST (a) validate the Identity Proof control  and then, (b) check that the subject DN included in each certification request matches that associated with the shared-secret.  If either of these checks fails the certification request MUST be rejected.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.3"></a><h3>6.3.3.&nbsp;
Renewal and Re-Key Messages</h3>

<p>When doing a renewal or re-key certification request, linking identity and POP information is simple.  The client copies the subject DN for a current signing certificate into the subject name field of each certification request that is made.  The POP for each certification request will now cover that information.  The outmost signature layer is created using the current signing certificate, which allows the original identity to be associated with the certification request.  Since the name in the current signing certificate and the names in the certification requests match, the necessary linking has been achieved.
</p>
<a name="c_dataReturn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
Data Return Control</h3>

<p>The Data Return control  allows clients to send arbitrary data (usually some type of internal state information) to the server and to have the data returned as part of the Full PKI Response.  Data placed in a Data Return control is considered to be opaque to the server.  The same control is used for both Full PKI Requests and Responses.  If the Data Return control appears in a Full PKI Request, the server MUST return it as part of the PKI Response.
</p>
<p>In the event that the information in the Data Return control needs to be confidential, it is expected that the client would apply some type of encryption to the contained data, but the details of this are outside the scope of this specification.
</p>
<p>The Data Return control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-dataReturn  ::= { id-cmc 4 }
</pre></div>
<p>The Data Return control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   DataReturn ::= OCTET STRING
</pre></div>
<p>A client could use this control to place an identifier marking the exact source of the private key material. This might be the identifier of a hardware device containing the private key.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.5"></a><h3>6.5.&nbsp;
RA Certificate Modification Controls</h3>

<p>These controls exist for RAs to be able to modify the contents of a certification request.  Modifications might be necessary for various reasons.  These include: addition of certificate extensions or modification of subject and/or subject alternative names.
</p>
<p>Two controls exist for this purpose.  The first control, Modify Certificate Request (<a class='info' href='#c_modCertTemplate'>Section&nbsp;6.5.1<span> (</span><span class='info'>Modify Certificate Request Control</span><span>)</span></a>), allows the RA to replace or remove of any field in the certificate.  The second control, Add Extensions (<a class='info' href='#c_addExtensions'>Section&nbsp;6.5.2<span> (</span><span class='info'>Add Extensions Control</span><span>)</span></a>), only allows for the addition of extensions.
</p>
<a name="c_modCertTemplate"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.5.1"></a><h3>6.5.1.&nbsp;
Modify Certificate Request Control</h3>

<p>The Modify Certificate Request control is used by RAs to change fields in a requested certificate.
</p>
<p>The Modify Certificate Request control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-modCertTemplate  ::= { id-cmc 31 }
</pre></div>
<p>The Modify Certificate Request has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  ModCertTemplate ::= SEQUENCE {
      pkiDataReference             BodyPartPath,
      certReferences               BodyPartList,
      replace                      BOOLEAN DEFAULT TRUE,
      certTemplate                 CertTemplate
  }
</pre></div>
<p>The fields in ModCertTemplate have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>pkiDataReference</dt>
<dd> is the path to the PKI Request containing certification request(s) to be modified.
</dd>
<dt>certReferences</dt>
<dd> refers to one or more certification requests in the PKI Request referenced by pkiDataReference to be modified.  Each BodyPartID of the certReferences sequence MUST be equal to either the bodyPartID of a TaggedCertificationRequest (PKCS #10) or the certReqId of the CertRequest within a CertReqMsg (CRMF).   By definition, the certificate extensions included in the certTemplate field are applied to every certification request referenced in the certReferences sequence.  If a request corresponding to bodyPartID cannot be found, the CMCFailInfo with a value of badRequest is returned that references this control.
</dd>
<dt>replace</dt>
<dd> specifies if the target certification request is to be modified by replacing or deleting fields.
If the value is TRUE, the data in this control replaces the data in the target certification request.
If the value is FALSE, the data in the target certification request is deleted.
The action is slightly different for the extensions field of certTemplate, each extension is treated individually rather than as a single unit.

</dd>
<dt>certTemplate</dt>
<dd> is a certificate template object <a class='info' href='#CRMF'>[CRMF]<span> (</span><span class='info'>Schaad, J., &ldquo;Internet X.509 Certification Request Message Format,&rdquo; January&nbsp;2005.</span><span>)</span></a>.  
If a field is present and replace is TRUE, it replaces that field in the certification request.  If the field is present and replace is FALSE, the field in the certification request is removed.  If the field is absent, no action is performed.
Each extension is treated as a single field.
</dd>
</dl></blockquote>
<p>Servers MUST be able to process all extensions defined, but not prohibited, in <a class='info' href='#PKIXCERT'>[PKIXCERT]<span> (</span><span class='info'>Housley, R., Ford, W., Polk, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>. Servers are not required to be able to process every X.509v3 extension transmitted using this protocol, nor are they required to be able to process other, private extensions.  Servers are not required to put all RA-requested extensions into a certificate. Servers are permitted to modify RA-requested extensions.  Servers MUST NOT alter an extension so as to reverse the meaning of a client-requested extension. If a certification request is denied due to the inability to handle a requested extension and a Full PKI Response is returned, the server MUST return a CMCFailInfo value with the value of unsupportedExt.
</p>
<p>If a certification request is the target of multiple Modify Certificate Request controls, the behavior is:
</p>
<ul class="text">
<li>If control A exists in a layer that contains the layer of control B, control A MUST override control B.  In other words, controls should be applied from the innermost layer to the outermost layer.
</li>
<li>If control A and control B are in the same PKIData (i.e. the same wrapping layer), the order of application is non-determinate.
</li>
</ul>
<p>The same order of application is used if a certification request is the target of both a Modify Certificate Request control and an Add Extensions control.
</p>
<a name="c_addExtensions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.5.2"></a><h3>6.5.2.&nbsp;
Add Extensions Control</h3>

<p>The Add Extensions control has been deprecated in favor of the Modify Certificate Request control.  It was replaced so that fields in the certification request other than extensions could be modified.
</p>
<p>The Add Extensions control  is used by RAs to specify additional extensions that are to be included in certificates.
</p>
<p>The Add Extensions control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-addExtensions  ::= { id-cmc 8 }
</pre></div>
<p>The Add Extensions control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  AddExtensions ::= SEQUENCE {
      pkiDataReference             BodyPartID,
      certReferences               SEQUENCE OF BodyPartID,
      extensions                   SEQUENCE OF Extension
  }
</pre></div>
<p>The fields in AddExtensions have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>pkiDataReference</dt>
<dd> contains the body part identity of the embedded certification request.
</dd>
<dt>certReferences</dt>
<dd> is a list of references to one or more of the certification requests contained within a PKIData.  Each body part identifier of the certReferences sequence MUST be equal to either the bodyPartID of a TaggedCertificationRequest (PKCS #10) or the certReqId of the CertRequest within a CertReqMsg (CRMF).   By definition, the listed extensions are to be applied to every certification request referenced in the certReferences sequence.  If a certification request corresponding to bodyPartID cannot be found, the CMCFailInfo with a value of badRequest is returned referencing this control.
</dd>
<dt>extensions</dt>
<dd> is a sequence of extensions to be applied to the referenced certification requests.
</dd>
</dl></blockquote>
<p>Servers MUST be able to process all extensions defined, but not prohibited, in <a class='info' href='#PKIXCERT'>[PKIXCERT]<span> (</span><span class='info'>Housley, R., Ford, W., Polk, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>. Servers are not required to be able to process every X.509v3 extension transmitted using this protocol, nor are they required to be able to process other, private extensions.  Servers are not required to put all RA-requested extensions into a certificate. Servers are permitted to modify RA-requested extensions.  Servers MUST NOT alter an extension so as to reverse the meaning of a client-requested extension If a certification request is denied due to the inability to handle a requested extension and a response is returned, the server MUST return a CMCFailInfo with the value of unsupportedExt.
</p>
<p>If multiple Add Extensions controls exist in a Full PKI Request, the exact behavior is left up to the CA policy. However it is recommended that the following policy be used.  These rules would be applied to individual extensions within an Add Extensions control  (as opposed to an "all or nothing" approach).
</p>
<ol class="text">
<li>	If the conflict is within a single PKIData, the certification request would be rejected with a CMCFailInfo value of badRequest.
</li>
<li>	If the conflict is between different PKIData, the outermost version of the extension would be used (allowing an RA to override the requested extension).
</li>
</ol>
<a name="c_transactionId"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.6"></a><h3>6.6.&nbsp;
Transaction Identifier, Sender and Recipient Nonce Controls</h3>

<p>Transactions are identified and tracked with a transaction identifier.  If used, clients generate transaction identifiers and retain their value until the server responds with a Full PKI Response that completes the transaction.  Servers correspondingly include received transaction identifiers in the Full PKI Response.
</p>
<p>The Transaction Identifier control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-transactionId  ::= { id-cmc 5 }
</pre></div>
<p>The Transaction Identifier control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   TransactionId ::= INTEGER
</pre></div>
<p>The Transaction Identifier control identifies a given transaction.  It is used by client and server to manage the state of an operation. Clients MAY include a Transaction Identifier control in request. If the original request contains a Transaction Identifier control, all subsequent requests and responses  MUST include the same Transaction Identifier control.
</p>
<p>Replay protection is supported through the use of the Sender and Recipient Nonce controls. If nonces are used, in the first message of a transaction, a Recipient Nonce control is not transmitted; a Sender Nonce control is included by the transaction originator and retained for later reference.  The recipient of a Sender Nonce control reflects this value back to the originator as a Recipient Nonce control and includes its own Sender Nonce control.  Upon receipt by the transaction originator of this response, the transaction originator compares the value of Recipient Nonce control to its retained value.  If the values match, the message can be accepted for further security processing.  The received value for a Sender Nonce control is also retained for inclusion in the next message associated with the same transaction.
</p>
<p>The Sender Nonce and Recipient controls are identified by the OIDs:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-senderNonce     ::= { id-cmc 6 }
   id-cmc-recipientNonce  ::= { id-cmc 7 }
</pre></div>
<p>The Sender Nonce control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   SenderNonce ::= OCTET STRING
</pre></div>
<p>The Recipient Nonce control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   RecepientNonce ::= OCTET STRING
</pre></div>
<p>Clients MAY include a Sender Nonce control in the initial PKI Request.  If a message includes a Sender Nonce control, the response MUST include the transmitted value of the previously received Sender Nonce control as a Recipient Nonce control and include a new value as its Sender Nonce control.
</p>
<a name="c_encryptedPOP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.7"></a><h3>6.7.&nbsp;
Encrypted and Decrypted POP Controls</h3>

<p>Servers MAY require that this POP method be used only if another POP method is unavailable. Servers SHOULD reject all certification requests contained within a PKIData if any required POP is missing for any element within the PKIData.
</p>
<p>Many servers require proof that the entity that generated the certification request actually possesses the corresponding private component of the key pair.  For keys that can be used as signature keys, signing the certification request with the private key serves as a POP on that key pair.  With keys that can only be used for encryption operations, POP MUST be performed by forcing the client to decrypt a value.  See Section 5 of <a class='info' href='#CRMF'>[CRMF]<span> (</span><span class='info'>Schaad, J., &ldquo;Internet X.509 Certification Request Message Format,&rdquo; January&nbsp;2005.</span><span>)</span></a> for a detailed discussion of POP.
</p>
<p>By necessity, POP for encryption-only keys cannot be done in one round-trip, since there are four distinct steps:
</p>
<ol class="text">
<li>	Client tells the server about the public component of a new encryption key pair.
</li>
<li>	Server sends the client a POP challenge, encrypted with the presented public encryption key.
</li>
<li>	Client decrypts the POP challenge using the private key that corresponds to the presented public key and sends the plaintext back to the server.
</li>
<li>	Server validates the decrypted POP challenge and continues processing the certification request.
</li>
</ol>
<p>CMC defines two different controls.  The first deals with the encrypted challenge sent from the server to the user in step 2.  The second deals with the decrypted challenge sent from the client to the server in step 3.
</p>
<p>The Encrypted POP control is used to send the encrypted challenge from the server to the client as part of the PKIResponse.  (Note that it is assumed that the message sent in Step 1 above is a Full PKI Request and that the response in step 2 is a Full PKI Response including a CMCFailInfo specifying that a POP is explicitly required, and providing the POP challenge in the encryptedPOP control.)
</p>
<p>The Encrypted POP  control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-encryptedPOP     ::= { id-cmc 9 }
</pre></div>
<p>The Encrypted POP control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   EncryptedPOP ::= SEQUENCE {
        request        TaggedRequest,
        cms            ContentInfo,
        thePOPAlgID    AlgorithmIdentifier,
        witnessAlgID   AlgorithmIdentifier,
        witness        OCTET STRING
   }
</pre></div>
<p>The Decrypted POP  control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-decryptedPOP     ::= { id-cmc 10 }
</pre></div>
<p>The Decrypted POP control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   DecryptedPOP ::= SEQUENCE {
        bodyPartID     BodyPartID,
        thePOPAlgID    AlgorithmIdentifier,
        thePOP         OCTET STRING
   }
</pre></div>
<p>The encrypted POP algorithm works as follows:
</p>
<ol class="text">
<li>	The server randomly generates the POP Proof Value  and associates it with the request.
</li>
<li>	The server returns the Encrypted POP control with the following fields set:
</li>
<blockquote class="text"><dl>
<dt>request</dt>
<dd> is the original certification request  (it is included here so the client need not keep a copy of the request),
</dd>
<dt>cms</dt>
<dd> is an EnvelopedData, the encapsulated content type being id-data and the content being the POP Proof Value, this value needs to be long enough that one cannot reverse the value from the witness hash.
If the certification request contains a Subject Key Identifier (SKI) extension, then the recipient identifier SHOULD be the SKI.  
If the issuerAndSerialNumber form is used, the IssuerName MUST be encoded as NULL and the SerialNumber as the bodyPartID of the certification request,
</dd>
<dt>thePOPAlgID</dt>
<dd> identifies the algorithm to be used in computing the return POP value,
</dd>
<dt>witnessAlgID</dt>
<dd> identifies the hash algorithm used on POP Proof Value to create the field witness,
</dd>
<dt>witness</dt>
<dd> is the hashed value of POP Proof Value.
</dd>
</dl></blockquote>
<li>	The client decrypts the cms field to obtain the POP Proof Value.  
The client computes H(POP Proof Value) using the witnessAlgID and compares to the value of witness.  
If the values do not compare or the decryption is not successful, the client MUST abort the enrollment process. The client aborts the process by sending a request containing a CMC Status Info control  with CMCFailInfo value of popFailed.
</li>
<li>	The client creates the Decrypted POP control as part of a new PKIData.  The fields in the DecryptedPOP are:
</li>
<blockquote class="text"><dl>
<dt>bodyPartID</dt>
<dd> refers to the certification request in the new PKI Request,
</dd>
<dt>thePOPAlgID</dt>
<dd> is copied from the encryptedPOP,
</dd>
<dt>thePOP</dt>
<dd> contains the possession proof.  
This value is computed by thePOPAlgID using the POP Proof Value and the request.
</dd>
</dl></blockquote>
<li>	The server then re-computes the value of thePOP from its cached value and the request and compares to the value of thePOP. If the values do not match, the server MUST NOT issue the certificate.  The server MAY re-issue a new challenge or MAY fail the request altogether.
</li>
</ol>
<p>When defining the algorithms for thePOPAlgID and witnessAlgID care must be taken to ensure that the result of witnessAlgID is not a useful value to shortcut the computation with thePOPAlgID.  The POP Proof Value is used as the secret value in the HMAC algorithm and the request is used as the data.  If the POP Proof Value is greater than 64 bytes, only the first 64 bytes of the POP Proof Value is used as the secret.
</p>
<p>One potential problem with the algorithm above is the amount of state that a CA needs to keep in order to verify the returned POP value. The following describes one of many possible ways of addressing the problem by reducing the amount of state kept on the CA to a single (or small set) of values.
</p>
<ol class="text">
<li>	Server generates random seed x, constant across all requests. (The value of x would normally be altered on a regular basis and kept for a short time afterwards.)
</li>
<li>	For certification request R, server computes y = F(x,R).  F can be, for example, HMAC-SHA1(x,R).  All that's important for statelessness is that y be consistently computable with only known state constant x and function F, other inputs coming from the certification request structure.  y should not be predictable based on knowledge of R, thus the use of a One-Way-Function like HMAC-SHA1.
</li>
</ol>
<a name="c_lraPOPWitness"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.8"></a><h3>6.8.&nbsp;
RA POP Witness Control </h3>

<p>In a certification request scenario that involves an RA, the CA may allow (or require) that the RA perform the POP protocol with the entity that generated the certification request.  In this case, the RA needs a way to inform the CA it has done the POP.  The RA POP Witness control addresses this issue.
</p>
<p>The RA POP Witness control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-lraPOPWitness     ::= { id-cmc 11 }
</pre></div>
<p>The RA POP Witness control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   LraPopWitness ::= SEQUENCE {
       pkiDataBodyid   BodyPartID,
       bodyIds         SEQUENCE of BodyPartID
   }
</pre></div>
<p>The fields in LraPOPWitness have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>pkiDataBodyid</dt>
<dd> contains the body part identifier of the nested TaggedContentInfo containing the client's Full PKI Request. pkiDataBodyid is set to 0 if the request is in the current PKIData.
</dd>
<dt>bodyIds</dt>
<dd> is a list of certification requests for which the RA has performed an out-of-band authentication.  The method of authentication could be archival of private key material, challenge-response or other means.
</dd>
</dl></blockquote>
<p>If a certification server does not allow an RA to do the POP verification, it returns a CMCFailInfo with the value of popFailed.  The CA MUST NOT start a challenge-response to re-verify the POP itself.
</p>
<a name="c_getCert"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.9"></a><h3>6.9.&nbsp;
Get Certificate Control</h3>

<p>Everything described in this section is optional to implement.
</p>
<p>The Get Certificate control  is used to retrieve a previously issued certificate from a certificate repository.  A CA, an RA or an independent service may provide this repository.  The clients expected to use this facility are those where a fully deployed directory is either infeasible or undesirable.
</p>
<p>The Get Certificate control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-getCert     ::= { id-cmc 15 }
</pre></div>
<p>The Get Certificate control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   GetCert ::= SEQUENCE {
       issuerName    GeneralName,
       serialNumber  INTEGER }
</pre></div>
<p>The fields in GetCert have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>issuerName</dt>
<dd>is the name of the certificate issuer.
</dd>
<dt>serialNumber</dt>
<dd>identifies the certificate to be retrieved.
</dd>
</dl></blockquote>
<p>The server that responds to this request places the requested certificate in the certificates field of a SignedData.  If the Get Certificate control is the only control in a Full PKI Request, the response should be a Simple PKI Response.
</p>
<a name="c_getCRL"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.10"></a><h3>6.10.&nbsp;
Get CRL Control</h3>

<p>Everything described in this section is optional to implement.
</p>
<p>The Get CRL control  is used to retrieve CRLs from a repository of CRLs.  A CA, an RA or an independent service may provide this repository.  The clients expected to use this facility are those where a fully deployed directory is either infeasible or undesirable.
</p>
<p>The Get CRL control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-getCRL     ::= { id-cmc 16 }
</pre></div>
<p>The Get CRL control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   GetCRL ::= SEQUENCE {
       issuerName    Name,
       cRLName       GeneralName OPTIONAL,
       time          GeneralizedTime OPTIONAL,
       reasons       ReasonFlags OPTIONAL }
</pre></div>
<p>The fields in a GetCRL have the following meanings:
</p>
<blockquote class="text"><dl>
<dt>issuerName</dt>
<dd> is the name of the CRL issuer.
</dd>
<dt>cRLName</dt>
<dd> may be the value of CRLDistributionPoints in the subject certificate or equivalent value in the event the certificate does not contain such a value.
</dd>
<dt>time</dt>
<dd> is used by the client to specify from among potentially several issues of CRL that one whose thisUpdate value is less than but nearest to the specified time.  In the absence of a time component, the CA always returns with the most recent CRL.
</dd>
<dt>reasons</dt>
<dd> is used to specify from among CRLs partitioned by revocation reason.  Implementers should bear in mind that while a specific revocation request has a single CRLReason code - and consequently entries in the CRL would have a single CRLReason code value - a single CRL can aggregate information for one or more reasonFlags.
</dd>
</dl></blockquote>
<p>A server responding to this request places the requested CRL in the crls field of a SignedData.  If the Get CRL control is the only control in a Full PKI Request, the response should be a Simple PKI Response.
</p>
<a name="c_revokeRequest"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.11"></a><h3>6.11.&nbsp;
Revocation Request Control </h3>

<p>The Revocation Request control  is used to request that a certificate be revoked.
</p>
<p>The Revocation Request control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-revokeRequest ::= { id-cmc 17 }
</pre></div>
<p>The Revocation Request control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   RevokeRequest ::= SEQUENCE {
       issuerName      Name,
       serialNumber    INTEGER,
       reason          CRLReason,
       invalidityDate  GeneralizedTime OPTIONAL,
       sharedSecret    OCTET STRING OPTIONAL,
       comment         UTF8string OPTIONAL }
</pre></div>
<p>The fields of RevokeRequest have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>issuerName</dt>
<dd> is the issuerName of the certificate to be revoked.
</dd>
<dt>serialNumber</dt>
<dd> is the serial number of the certificate to be revoked.
</dd>
<dt>reason</dt>
<dd> is the suggested CRLReason code for why the certificate is being revoked.  The CA can use this value at its discretion in building the CRL.
</dd>
<dt>invalidityDate</dt>
<dd> is the suggested value for the Invalidity Date CRL Extension.  The CA can use this value at its discretion in building the CRL.
</dd>
<dt>sharedSecret</dt>
<dd> is a secret value registered by the EE when the certificate was obtained to allow for revocation of a certificate in the event of key loss.
</dd>
<dt>comment</dt>
<dd> is a human readable comment.
</dd>
</dl></blockquote>
<p>
For a revocation request to be reliable in the event of a dispute, a strong proof-of-origin is required.
However, in the instance when an EE has lost use of its signature private key, it is impossible for the EE to produce a digital signature (prior to the certification of a new signature key pair). 
The Revoke Request control allows the EE to send the CA a shared-secret that may be used as an alternative authenticator in the instance of loss of use of the EE's signature private key. 
The acceptability of this practice is a matter of local security policy.
</p>
<p>It is possible to sign the revocation for the lost certificate with a different certificate in some circumstances.  A client can sign a revocation for an encryption key with a signing certificate if the name information matches.  Similarly an administrator or RA can be assigned the ability to revoke the certificate of a third party.  Acceptance of the revocation by the server depends on local policy in these cases.
</p>
<p>
Clients MUST provide the capability to produce a digitally signed Revocation Request control.
Clients SHOULD be capable of producing an unsigned Revocation Request control containing the EE shared-secret.
(The unsigned message consisting of a SignedData with no signatures.)  
If a client provides shared-secret based self-revocation, the client MUST be capable of producing a Revocation Request control containing the shared-secret. 
Servers MUST be capable of accepting both forms of revocation requests.
</p>
<p>The structure of an unsigned, shared-secret based revocation request is a matter of local implementation.  The shared-secret does not need to be encrypted when sent in a Revocation Request control.  The shared-secret has a one-time use (i.e., it is used to request revocation of the certificate), and public knowledge of the shared-secret after the certificate has been revoked is not a problem.  Clients need to inform users that the same shared-secret SHOULD NOT be used for multiple certificates.
</p>
<p>A Full PKI Response MUST be returned for a revocation request.
</p>
<a name="c_regInfo"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.12"></a><h3>6.12.&nbsp;
Registration and Response Information Controls</h3>

<p>The Registration Information control allows for clients to pass additional information as part a Full PKI Request.
</p>
<p>The Registration Information control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-regInfo     ::= { id-cmc 18 }
</pre></div>
<p>The Registration Information control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   RegInfo ::= OCTET STRING
</pre></div>
<p>The content of this data is based on bilateral agreement between the client and server.
</p>
<p>The Response Information control allows a server to return additional information as part of a Full PKI Response.
</p>
<p>The Response Information control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-responseInfo     ::= { id-cmc 19 }
</pre></div>
<p>The Response Information control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   ResponseInfo ::= OCTET STRING
</pre></div>
<p>The content of this data is based on bilateral agreement between the client and the server.
</p>
<a name="c_queryPending"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.13"></a><h3>6.13.&nbsp;
Query Pending Control </h3>

<p>In some environments, process requirements for manual intervention or other identity checks can delay the return of the certificate. The Query Pending control allows clients to query a server about the state of a pending certification request.  The server returns a pendToken as part of the Extended CMC Status Info and the CMC Status Info controls (in the otherInfo field).  The client copies the pendToken into the Query Pending control to identify the correct certification request to the server.  The server  returns a suggested time for the client to query for the state of a pending certification request.
</p>
<p>The Query Pending control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-queryPending     ::= { id-cmc 21 }
</pre></div>
<p>The Query Pending control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   QueryPending ::= OCTET STRING
</pre></div>
<p>If a server returns a pending or partial CMCStatusInfo (the transaction is still pending), the otherInfo MAY be omitted.  If the otherInfo is not omitted, the value of 'pendInfo' MUST be the same as the original pendInfo value.
</p>
<a name="c_confirmCertAcceptance"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.14"></a><h3>6.14.&nbsp;
Confirm Certificate Acceptance Control</h3>

<p>Some CAs require that clients give a positive confirmation that the certificates issued to the EE are acceptable.  The Confirm Certificate Acceptance control  is used for that purpose.  If the CMC Status Info on a PKI Response is confirmRequired, then the client MUST return a Confirm Certificate Acceptance control contained in a Full PKI Request.
</p>
<p>Clients SHOULD wait for the PKI Response from the server that the confirmation has been received before using the certificate for any purpose.
</p>
<p>The Confirm Certificate Acceptance control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-confirmCertAcceptance     ::= { id-cmc 24 }
</pre></div>
<p>The Confirm Control Acceptance control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   CMCCertId ::= IssuerAndSerialNumber
</pre></div>
<p>CMCCertId contains the issuer and serial number of the    certificate being accepted.
</p>
<p>Servers MUST return a Full PKI Response for a Confirm Certificate Acceptance control.
</p>
<p>Note that if the CA includes this control, there will be two full round trips of messages.
</p>
<ol class="text">
<li>	The client sends the certification request to the CA. 
</li>
<li>	The CA returns a Full PKI Response with the certificate and this control.
</li>
<li>	The client sends a Full PKI Request to the CA with an Extended CMC Status Info control accepting and a Confirm Certificate Acceptance control or an Extended CMC Status Info control rejecting the certificate.
</li>
<li>	The CA sends a Full PKI Response  to the client with an Extended CMC Status Info of success.
</li>
</ol>
<a name="c_trustAnchors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.15"></a><h3>6.15.&nbsp;
Publish Trust Anchors Control</h3>

<p>The Publish Trust Anchors control allows for the distribution of set trust anchors from a central authority to an EE.  The same control is also used to update the set of trust anchors.  Trust anchors are distributed in the form of certificates.  These are expected, but not required, to be self-signed certificates.  Information is extracted from these certificates to set the inputs to the certificates validation algorithm in section 6.1.1 of <a class='info' href='#PKIXCERT'>[PKIXCERT]<span> (</span><span class='info'>Housley, R., Ford, W., Polk, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>.
</p>
<p>The Publish Trust Anchors control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-trustedAnchors     ::= { id-cmc 26 }
</pre></div>
<p>The Publish Trust Anchors control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    PublishTrustAnchors ::= SEQUENCE {
        seqNumber      INTEGER,
        hashAlgorithm  AlgorithmIdentifier,
        anchorHashes   SEQUENCE OF OCTET STRING
    }
</pre></div>
<p>The fields in PublishTrustAnchors have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>seqNumber</dt>
<dd> is an integer indicating the location within a sequence of updates.
</dd>
<dt>hashAlgorithm</dt>
<dd> is the identifier and parameters for the hash algorithm that is used in computing the values of the anchorHashes field.  All implementations MUST implement SHA-1 for this field.
</dd>
<dt>anchorHashes</dt>
<dd> are the hashes for the certificates that are to be treated as trust anchors by the client.  The actual certificates are transported in the certificate bag of the containing SignedData structure.
</dd>
</dl></blockquote>
<p>While it is recommended that the sender place the certificates that are to be trusted in the PKI Response, it is not required as the certificates should be obtainable using normal discovery techniques.
</p>
<p>Prior to accepting the trust anchors changes, a client MUST  at least do the following: validate the signature on the PKI Response to a current trusted anchor, check with policy to ensure that the signer is permitted to use the control, validate that the authenticated publish time in the signature is near to the current time and validate the sequence number is greater than the previously used one.
</p>
<p>In the event that multiple agents publish a set of trust anchors, it is up to local policy to determine how the different trust anchors should be combined.  Clients SHOULD be able to handle the update of multiple trust anchors independently.
</p>
<p>NOTE:  Clients that handle this control must use extreme care in validating that the operation is permissible.  Incorrect handling of this control allows for an attacker to change the set of trust anchors on the client.
</p>
<a name="c_authData"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.16"></a><h3>6.16.&nbsp;
Authenticated Data Control</h3>

<p>The Authenticated Data control allows a server to provide data back to the client in an authenticated manner.  This control uses the Authenticated Data structure to allow for validation of the data.  This control is used where the client has a shared-secret and a secret identifier with the server, but where a trust anchor has not yet been downloaded onto the client so that a signing certificate for the server cannot be validated.  The specific case that this control was created for use with the Publish Trust Anchors control <a class='info' href='#c_trustAnchors'>Section&nbsp;6.15<span> (</span><span class='info'>Publish Trust Anchors Control</span><span>)</span></a>, but may be used in other cases as well.
</p>
<p>The Authenticated Data control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-authData     ::= { id-cmc 27 }
</pre></div>
<p>The Authenticated Data control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   AuthPublish ::= BodyPartID
</pre></div>
<p>AuthPublish is a body part identifier that refers to a member of the cmsSequence element for the current PKI Response or PKI Data.  The cmsSequence element is AuthenticatedData.  The encapsulated content is an id-cct-PKIData, there will then be  controls in the controlSequence that would need to be processed (one example being the Publish Trust Anchors control <a class='info' href='#c_trustAnchors'>Section&nbsp;6.15<span> (</span><span class='info'>Publish Trust Anchors Control</span><span>)</span></a>).
</p>
<p>If the authentication operation fails, the CMCFailInfo authDataFail is returned.
</p>
<a name="c_batchRequests"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.17"></a><h3>6.17.&nbsp;
Batch Request and Response Controls</h3>

<p>These controls allow for an RA to collect multiple requests together into a single Full PKI Request and forward it to a CA.  The server would then process the requests and return the results in a Full PKI Response.
</p>
<p>The Batch Request control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    id-cmc-batchRequests  ::= {id-cmc 28}
</pre></div>
<p>The Batch Response control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    id-cmc-batchResponses ::= {id-cmc 29}
</pre></div>
<p>Both the Batch Request and Batch Response controls have the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   BodyPartList ::= SEQUENCE of BodyPartID
</pre></div>
<p>The data associated with these controls is a set of body part identifiers.  The collection of requests/responses are individually placed in the cmsSequence of the PKIData/PKIResponse.  The body part identifiers of these elements are then placed in the body part list.
</p>
<p>When a server processes a Batch Request control, it MAY return the responses in one or more PKI Responses.  A CMCStatus value of partial is returned on all but the last PKI Response.  The CMCStatus would be success if the Batch Requests control was processed, the responses are created with their own CMCStatus code.  Errors on individual requests are not propagated up to the top level.
</p>
<p>
When a PKI Response with a CMCStatus value of partial is returned, the Query Pending control (<a class='info' href='#c_queryPending'>Section&nbsp;6.13<span> (</span><span class='info'>Query Pending Control </span><span>)</span></a>) is used to retrieve additional results.  The returned status includes a suggested time after which the client should ask for the additional results.
</p>
<a name="c_publishCert"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.18"></a><h3>6.18.&nbsp;
Publication Information Control</h3>

<p>The Publication Information control allows for modifying publication of already issued certificates, both for publishing and removal from publication.  A common usage for this control is to remove an existing certificate from publication during a re-key operation.  This control should always be processed after the issuance of new certificates and revocation requests.  This control should not be processed if a certificate failed to be issued.
</p>
<p>The Publication Information control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-publishCert     ::= { id-cmc 30 }
</pre></div>
<p>The Publication Information control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  CMCPublicationInfo ::= SEQUENCE {
        hashAlg     AlgorithmIdentifier,
        certHashes 	SEQUENCE of OCTET STRING,
        pubInfo		PKIPublicationInfo

  PKIPublicationInfo ::= SEQUENCE {
        action     INTEGER {
                     dontPublish (0),
                     pleasePublish (1) },
        pubInfos  SEQUENCE SIZE (1..MAX) OF SinglePubInfo OPTIONAL }

          -- pubInfos MUST NOT be present if action is "dontPublish"
          -- (if action is "pleasePublish" and pubInfos is omitted,
          -- "dontCare" is assumed)

   SinglePubInfo ::= SEQUENCE {
         pubMethod    INTEGER {
             dontCare    (0),
             x500        (1),
             web         (2),
             ldap        (3) },
         pubLocation  GeneralName OPTIONAL }
	  }
</pre></div>
<p>The fields in CMCPublicationInfo have the following meaning:
</p>
<blockquote class="text"><dl>
<dt>hashAlg</dt>
<dd> is the algorithm identifier of the hash algorithm used to compute the values in certHashes.
</dd>
<dt>certHashes</dt>
<dd> are the hashes of the certificates for which publication is to change.
</dd>
<dt>pubInfo</dt>
<dd> is the information where and how the certificates should be published.  The fields in pubInfo (taken from <a class='info' href='#CRMF'>[CRMF]<span> (</span><span class='info'>Schaad, J., &ldquo;Internet X.509 Certification Request Message Format,&rdquo; January&nbsp;2005.</span><span>)</span></a>) have the following meanings:
</dd>
<blockquote class="text"><dl>
<dt>action</dt>
<dd> indicates the action the service should take.  It has two values:
</dd>
<blockquote class="text"><dl>
<dt>dontPublish</dt>
<dd> indicates that the PKI should not publish the certificate (this may indicate that the requester intends to publish the certificate him/herself).  dontPublish has the added connotation of removing from publication the certificate if it is already published.
</dd>
<dt>pleasePublish</dt>
<dd> indicates that the PKI MAY publish the certificate using whatever means it chooses unless pubInfos is present.  Omission of the the CMC Publication Info control results in the same behavior.
</dd>
</dl></blockquote>
<dt>pubInfos</dt>
<dd>pubInfos indicates how (e.g., X500, Web, IP Address) the PKI SHOULD publish the certificate.
</dd>
</dl></blockquote>
</dl></blockquote>
<p>A single certificate SHOULD NOT appear in more than one Publication Information control.  The behavior is undefined in the event that it does.
</p>
<a name="c_controlProcessed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.19"></a><h3>6.19.&nbsp;
Control Processed Control</h3>

<p>The Control Processed control allows an RA to indicate to subsequent control processors that a specific control has already been processed.  This permits an RA in the middle of a processing stream to process a control defined either in a local context or in a subsequent document.
</p>
<p>The Control Processed control is identified by the OID:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-cmc-controlProcessed     ::= { id-cmc 32 }
</pre></div>
<p>The Control Processed control has the ASN.1 definition:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    ControlList ::= SEQUENCE {
        bodyList	SEQUENCE SIZE (1..MAX) OF BodyPartReference
    }
</pre></div>
<blockquote class="text"><dl>
<dt>bodyList</dt>
<dd> is a series of body part identifiers that form a path to each of the controls that were processed by the RA.  This control is only needed for those controls which are not part of this standard and thus would cause an error condition of a server attempting to deal with a control which is not defined in this document.  No error status is needed since an error causes the RA to return the request to the client with the error rather than passing the request on to the next server in the processing list.

</dd>
</dl></blockquote>
<a name="s_RA_Processing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Registration Authorities</h3>

<p>This specification permits the use of RAs.  An RA sits between the EE and the CA.  From the EE's perspective, the RA appears to be the CA and from the server the RA appears to be a client.  RAs receive the PKI Requests, perform local processing and then forward them onto CAs. Some of the types of local processing that an RA can perform include:
</p>
<ul class="text">
<li> Batching multiple PKI Requests together, 
</li>
<li> Performing challenge/response POP proofs,
</li>
<li> Adding private or standardized certificate extensions to all certification requests,
</li>
<li> Archiving private key material,
</li>
<li> Routing requests to different CAs.
</li>
</ul>
<p>When an RA receives a PKI Request it has three options: it may forward the PKI Request without modification, it may add a new wrapping layer to the PKI Request, or it may remove one or more existing layers and add a new wrapping layer.
</p>
<p>When an RA adds a new wrapping layer to a PKI Request it creates a new PKIData.  The new layer contains any controls required (for example if the RA does the POP proof for an encryption key or the Add Extension control  to modify a PKI Request) and the client PKI Request.  The client PKI Request is placed in the cmsSequence if it is a Full PKI Request and in the reqSequence if it is a Simple PKI Request. If an RA is batching multiple client PKI Requests together, then each client PKI Request is placed into the appropriate location in the RA's PKIData object along with all relevant controls.
</p>
<p>If multiple RAs are in the path between the EE and the CA, this will lead to multiple wrapping layers on the request.
</p>
<p>In processing a PKI Request, an RA MUST NOT alter any certification requests (PKCS #10 or CRMF) as any alteration would invalidate the signature on the certification request and thus the POP for the private key.
</p>
<p>An example of how this would look is illustrated by the following figure:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   SignedData (by RA)
     PKIData
       controlSequence
            RA added control statements
       reqSequence
            Zero or more Simple PKI Requests from clients
       cmsSequence
            Zero or more Full PKI Requests from clients
               SignedData (signed by client)
                   PKIData
</pre></div>
<p>Under some circumstances an RA is required to remove wrapping layers.  The following sections look at the processing required if encryption layers and signing layers need to be removed.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Encryption Removal</h3>

<p>There are two cases that require an RA to remove or change encryption in a PKI Request.  In the first case the encryption was applied for the purposes of protecting the entire PKI Request from unauthorized entities.  If the CA does not have a Recipient Info entry in the encryption layer, the RA MUST remove the encryption layer.  The RA MAY add a new encryption layer with or without adding a new signing layer.
</p>
<p>The second change of encryption that may be required is to change the encryption inside of a signing layer.  In this case the RA MUST remove all signing layers containing the encryption.  All control statements MUST be merged according to local policy rules as each signing layer is removed and the resulting merged controls MUST be placed in a new signing layer provided by the RA.  If the signing layer provided by the EE needs to also be removed, the RA can also remove this layer.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Signature Layer Removal</h3>

<p>Only two instances exist where an RA should remove a signature layer on a Full PKI Request.  If an encryption layer needs to be modified within the request, or if a CA will not accept secondary delegation (i.e., multiple RA signatures).  In all other situations, RAs SHOULD NOT remove a signing layer from a PKI Request.
</p>
<p>If an RA removes a signing layer from a PKI Request, all control statements MUST be merged according to local policy rules.  The resulting merged control statements MUST be placed in a new signing layer provided by the RA.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>Mechanisms for thwarting replay attacks may be required in particular implementations of this protocol depending on the operational environment. In cases where the CA maintains significant state information, replay attacks may be detectable without the inclusion of the optional nonce mechanisms. Implementers of this protocol need to carefully consider environmental conditions before choosing whether or not to implement the senderNonce and recipientNonce controls described in <a class='info' href='#c_transactionId'>Section&nbsp;6.6<span> (</span><span class='info'>Transaction Identifier, Sender and Recipient Nonce Controls</span><span>)</span></a>.  Developers of state-constrained PKI clients are strongly encouraged to incorporate the use of these controls.
</p>
<p>Extreme care needs to be taken when archiving a signing key.  The holder of the archived key may have the ability to use the key to generate forged signatures.  There are however reasons why a signing key should be archived.  An archived CA signing key can be recovered in the event of failure to continue to produced CRLs following a disaster.
</p>
<p>Due care must be taken prior to archiving keys.  Once a key is given to an archiving entity, the archiving entity could use the keys in a way not conducive to the archiving entity.  Users should be made especially aware that proper verification is made of the certificate used to encrypt the private key material.
</p>
<p>Clients and servers need to do some checks on cryptographic parameters prior to issuing certificates to make sure that weak parameters are not used. A description of the small subgroup attack is provided in <a class='info' href='#X942'>[X942]<span> (</span><span class='info'>Rescorla, E., &ldquo;Diffie-Hellman Key Agreement Method,&rdquo; June&nbsp;1999.</span><span>)</span></a>.  Methods of avoiding the small subgroup attack can be found in <a class='info' href='#SMALL-GROUP'>[SMALL&#8209;GROUP]<span> (</span><span class='info'>Zuccherato, R., &ldquo;Methods for Avoiding the &quot;Small-Subgroup&quot; Attacks on the Diffie-Hellman Key Agreement Method for S/MIME,&rdquo; March&nbsp;2000.</span><span>)</span></a>. CMC implementations ought to be aware of this attack when doing parameter validations.
</p>
<p>When using a shared-secret for authentication purposes, the shared-secret should be generated using good random number techniques <a class='info' href='#RANDOM'>[RANDOM]<span> (</span><span class='info'>Eastlake, 3rd, D., Schiller, J., and S. Crocker, &ldquo;&quot;Randomness Requirements for Security,&rdquo; June&nbsp;2005.</span><span>)</span></a>.  User selection of the secret allows for dictionary attacks to be mounted.
</p>
<p>Extreme care must be used when processing the Publish Trust Anchors control.  Incorrect processing can lead to the practice of slamming where an attacker changes the set of trusted anchors in order to weaken security.
</p>
<p>One method of controlling the use of the Publish Trust Anchors control is as follows.  The client needs to associate with each trust anchor accepted by the client the source of the trust anchor.  Additionally the client should associate with each trust anchor the types of messages that the trust anchor is valid for.  (I.e., is the trust anchor used for validating S/MIME messages, TLS or CMC enrollment messages.)
</p>
<p>When a new message is received with a Publish Trust Anchor control, the client would accept the set of new trust anchors for specific applications only if the signature validates, the signer of the message has the required policy approval for updating the trust anchors and local policy also would allow updating the trust anchors.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>This document defines a number of control objects.  These are identified by Object Identifiers (OIDs).  The objects are defined from an arc delegated by IANA to the PKIX Working Group.  No further action by IANA is necessary for this document or any anticipated updates.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgments</h3>

<p>The authors and the PKIX Working Group are grateful for the participation of Xiaoui Lui and Jeff Weinstein in helping to author the original versions of this document.  
</p>
<p>The authors would like to thank Brian LaMacchia for his work in developing and writing up many of the concepts presented in this document.  The authors would also like to thank Alex Deacon and Barb Fox for their contributions.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="CMS">[CMS]</a></td>
<td class="author-text">Housley, R., &ldquo;<a href="http://tools.ietf.org/html/rfc3852">Cryptographic Message Syntax (CMS)</a>,&rdquo; RFC&nbsp;3852, July&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="CRMF">[CRMF]</a></td>
<td class="author-text">Schaad, J., &ldquo;<a href="http://tools.ietf.org/html/rfc4211">Internet X.509 Certification Request Message Format</a>,&rdquo; RFC&nbsp;4211, January&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="DH-POP">[DH-POP]</a></td>
<td class="author-text">Prafullchandra, H. and J. Schaad, &ldquo;<a href="http://tools.ietf.org/html/rfc2875">Diffie-Hellman Proof-of-Possession Algorithms</a>,&rdquo; RFC&nbsp;2875, June&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="HMAC">[HMAC]</a></td>
<td class="author-text">Krawczyk, H., Bellare, M., and R. Canetti, &ldquo;<a href="http://tools.ietf.org/html/rfc2104">Diffie-Hellman Proof-of-Possession Algorithms</a>,&rdquo; RFC&nbsp;2104, February&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="PKCS10">[PKCS10]</a></td>
<td class="author-text">Kaliski, B., &ldquo;<a href="http://tools.ietf.org/html/rfc2314">PKCS #10: Certification Request Syntax v1.5</a>,&rdquo; RFC&nbsp;2314, October&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="PKIXCERT">[PKIXCERT]</a></td>
<td class="author-text">Housley, R., Ford, W., Polk, W., and D. Solo, &ldquo;<a href="http://tools.ietf.org/html/rfc3280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>,&rdquo; RFC&nbsp;3280, April&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; RFC&nbsp;2119, BCP&nbsp;14, March&nbsp;1997.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.2.&nbsp;Informational References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="CMC-TRANS">[CMC-TRANS]</a></td>
<td class="author-text">Schaad, J. and M. Myers, &ldquo;CMC Transport,&rdquo; draft-ietf-pkix-cmc-trans-00.txt&nbsp;, December&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="CMC-MUST">[CMC-MUST]</a></td>
<td class="author-text">Schaad, J. and M. Myers, &ldquo;CMC Compliance,&rdquo; draft-ietf-pkix-cmc-must-00.txt&nbsp;, December&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="DH">[DH]</a></td>
<td class="author-text">Kaliski, B., &ldquo;PKCS 3: Diffie-Hellman Key Agreement v1.4,&rdquo; Lost&nbsp;1900.</td></tr>
<tr><td class="author-text" valign="top"><a name="IPsec">[IPsec]</a></td>
<td class="author-text">Kent, S. and K. Seo, &ldquo;<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>,&rdquo; RFC&nbsp;4301, December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="PASSWORD">[PASSWORD]</a></td>
<td class="author-text">Burr, W., Dodson, D., and W. Polk, &ldquo;Electronic Authentication Guideline,&rdquo; NIST&nbsp;SP 800-63, April&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="PKCS1">[PKCS1]</a></td>
<td class="author-text">Kaliski, B., &ldquo;PKCS #1: RSA Encryption, Version 1.5,&rdquo; PKCS&nbsp;#1, March&nbsp;1998.</td></tr>
<tr><td class="author-text" valign="top"><a name="PKCS7">[PKCS7]</a></td>
<td class="author-text">Kaliski, B., &ldquo;<a href="http://tools.ietf.org/html/rfc2315">PKCS #7: Cryptographic Message Syntax v1.5</a>,&rdquo; RFC&nbsp;2315, October&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="PKCS8">[PKCS8]</a></td>
<td class="author-text">Laboratories, RSA., &ldquo;PKCS#8: Private-Key Information Syntax Standard, Version 1.2,&rdquo; November&nbsp;1993.</td></tr>
<tr><td class="author-text" valign="top"><a name="RANDOM">[RANDOM]</a></td>
<td class="author-text">Eastlake, 3rd, D., Schiller, J., and S. Crocker, &ldquo;<a href="http://tools.ietf.org/html/rfc4086">"Randomness Requirements for Security</a>,&rdquo; BCP&nbsp;106, RFC&nbsp;4086, June&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="SMALL-GROUP">[SMALL-GROUP]</a></td>
<td class="author-text">Zuccherato, R., &ldquo;<a href="http://tools.ietf.org/html/rfc2785">Methods for Avoiding the "Small-Subgroup" Attacks on the Diffie-Hellman Key Agreement Method for S/MIME</a>,&rdquo; RFC&nbsp;2785, March&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="SMIMEV2">[SMIMEV2]</a></td>
<td class="author-text">Dusse, S., Hoffman, P., Ramsdell, B., Lundblade, L., and L. Repka, &ldquo;<a href="http://tools.ietf.org/html/rfc2311">S/MIME Version 2 Message Specification</a>,&rdquo; RFC&nbsp;2311, March&nbsp;1998.</td></tr>
<tr><td class="author-text" valign="top"><a name="SMIMEV3">[SMIMEV3]</a></td>
<td class="author-text">Ramsdell, B., &ldquo;<a href="http://tools.ietf.org/html/rfc3851">S/MIME Version 3 Message Specification</a>,&rdquo; RFC&nbsp;3851, July&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="TLS">[TLS]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc4346">The Transport Layer Security (TLS) Protocol Version 1.1</a>,&rdquo; RFC&nbsp;4346, April&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="X942">[X942]</a></td>
<td class="author-text">Rescorla, E., &ldquo;<a href="http://tools.ietf.org/html/rfc2631">Diffie-Hellman Key Agreement Method</a>,&rdquo; RFC&nbsp;2631, June&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2797">[RFC2797]</a></td>
<td class="author-text">Myers, M., Liu, X., Schaad, J., and J. Weinstein, &ldquo;<a href="http://tools.ietf.org/html/rfc2797">Certificate Management Messages over CMS</a>,&rdquo; RFC&nbsp;2797, April&nbsp;2000.</td></tr>
</table>

<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
ASN.1 Module</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
EnrollmentMessageSyntax
{ iso(1) identified-organization(3) dod(4) internet(1)
security(5) mechansims(5) pkix(7) id-mod(0) id-mod-cmc2002(23) }

DEFINITIONS IMPLICIT TAGS ::=
BEGIN

-- EXPORTS All --
-- The types and values defined in this module are exported for use
-- in the other ASN.1 modules.  Other applications may use them for
-- their own purposes.

IMPORTS

  -- PKIX Part 1 - Implicit    From [PKIXCERT]
     GeneralName, CRLReason, ReasonFlags
     FROM PKIX1Implicit88 {iso(1) identified-organization(3) dod(6)
             internet(1) security(5) mechanisms(5) pkix(7) id-mod(0)
             id-pkix1-implicit(19)}

  -- PKIX Part 1 - Explicit    From [PKIXCERT]
     AlgorithmIdentifier, Extension, Name, CertificateSerialNumber
     FROM PKIX1Explicit88 {iso(1) identified-organization(3) dod(6)
             internet(1) security(5) mechanisms(5) pkix(7) id-mod(0)
             id-pkix1-explicit(18)}

  -- Cryptographic Message Syntax   FROM [CMS]
     ContentInfo, Attribute, IssuerAndSerialNumber
       FROM CryptographicMessageSyntax2004 { iso(1) member-body(2)
            us(840) rsadsi(113549) pkcs(1) pkcs-9(9) smime(16)
            modules(0) cms-2004(24)}


-- CRMF                         FROM [CRMF]
   CertReqMsg, PKIPublicationInfo, CertTemplate
   FROM PKIXCRMF-2005 {iso(1) identified-organization(3) dod(6)
          internet(1) security(5) mechanisms(5) pkix(7) id-mod(0)
          id-mod-crmf2005(36)};

  -- Global Types
     UTF8String ::= [UNIVERSAL 12] IMPLICIT OCTET STRING
       -- The content of this type conforms to RFC 2279.


 id-pkix OBJECT IDENTIFIER  ::= { iso(1) identified-organization(3)
     dod(6) internet(1) security(5) mechanisms(5) pkix(7) }

id-cmc OBJECT IDENTIFIER ::= {id-pkix 7}   -- CMC controls
id-cct OBJECT IDENTIFIER ::= {id-pkix 12}  -- CMC content types

-- The following controls have the type OCTET STRING

id-cmc-identityProof OBJECT IDENTIFIER ::= {id-cmc 3}
id-cmc-dataReturn OBJECT IDENTIFIER ::= {id-cmc 4}
id-cmc-regInfo OBJECT IDENTIFIER ::= {id-cmc 18}
id-cmc-responseInfo OBJECT IDENTIFIER ::= {id-cmc 19}
id-cmc-queryPending OBJECT IDENTIFIER ::= {id-cmc 21}
id-cmc-popLinkRandom OBJECT IDENTIFIER ::= {id-cmc 22}
id-cmc-popLinkWitness OBJECT IDENTIFIER ::= {id-cmc 23}

-- The following controls have the type UTF8String

id-cmc-identification OBJECT IDENTIFIER ::= {id-cmc 2}

-- The following controls have the type INTEGER

id-cmc-transactionId OBJECT IDENTIFIER ::= {id-cmc 5}

-- The following controls have the type OCTET STRING

id-cmc-senderNonce OBJECT IDENTIFIER ::= {id-cmc 6}
id-cmc-recipientNonce OBJECT IDENTIFIER ::= {id-cmc 7}


 -- This is the content type used for a request message in the protocol

id-cct-PKIData OBJECT IDENTIFIER ::= { id-cct 2 }


PKIData ::= SEQUENCE {
    controlSequence    SEQUENCE SIZE(0..MAX) OF TaggedAttribute,
    reqSequence        SEQUENCE SIZE(0..MAX) OF TaggedRequest,
    cmsSequence        SEQUENCE SIZE(0..MAX) OF TaggedContentInfo,
    otherMsgSequence   SEQUENCE SIZE(0..MAX) OF OtherMsg
}

 bodyIdMax INTEGER ::= 4294967295

 BodyPartID ::= INTEGER(0..bodyIdMax)

TaggedAttribute ::= SEQUENCE {
    bodyPartID         BodyPartID,
    attrType           OBJECT IDENTIFIER,
    attrValues         SET OF AttributeValue
}

 AttributeValue ::= ANY

 TaggedRequest ::= CHOICE {
     tcr               [0] TaggedCertificationRequest,
     crm               [1] CertReqMsg,
     orm               [2] SEQUENCE {
         bodyPartID            BodyPartID,
         requestMessageType    OBJECT IDENTIFIER,
         requestMessageValue   ANY DEFINED BY requestMessageType
     }
 }

 TaggedCertificationRequest ::= SEQUENCE {
     bodyPartID            BodyPartID,
     certificationRequest  CertificationRequest
 }

 CertificationRequest ::= SEQUENCE {
   certificationRequestInfo  SEQUENCE {
     version                   INTEGER,
     subject                   Name,
     subjectPublicKeyInfo      SEQUENCE {
       algorithm                 AlgorithmIdentifier,
       subjectPublicKey          BIT STRING },
     attributes                [0] IMPLICIT SET OF Attribute },
   signatureAlgorithm        AlgorithmIdentifier,
   signature                 BIT STRING
 }

TaggedContentInfo ::= SEQUENCE {
    bodyPartID              BodyPartID,
    contentInfo             ContentInfo
}

OtherMsg ::= SEQUENCE {
    bodyPartID        BodyPartID,
    otherMsgType      OBJECT IDENTIFIER,
    otherMsgValue     ANY DEFINED BY otherMsgType }

--  This defines the response message in the protocol
id-cct-PKIResponse OBJECT IDENTIFIER ::= { id-cct 3 }

ResponseBody ::= PKIResponse

PKIResponse ::= SEQUENCE {
    controlSequence   SEQUENCE SIZE(0..MAX) OF TaggedAttribute,
    cmsSequence       SEQUENCE SIZE(0..MAX) OF TaggedContentInfo,
    otherMsgSequence  SEQUENCE SIZE(0..MAX) OF OtherMsg
}

-- Used to return status state in a response

id-cmc-statusInfo OBJECT IDENTIFIER ::= {id-cmc 1}

CMCStatusInfo ::= SEQUENCE {
    cMCStatus       CMCStatus,
    bodyList        SEQUENCE SIZE (1..MAX) OF BodyPartID,
    statusString    UTF8String OPTIONAL,
    otherInfo        CHOICE {
      failInfo         CMCFailInfo,
      pendInfo         PendInfo } OPTIONAL
}

PendInfo ::= SEQUENCE {
    pendToken        OCTET STRING,
    pendTime         GeneralizedTime
}

CMCStatus ::= INTEGER {
    success         (0),
    failed          (2),
    pending         (3),
    noSupport       (4),
    confirmRequired (5),
    popRequired     (6),
    partial                (7)
}

CMCFailInfo ::= INTEGER {
    badAlg          (0),
    badMessageCheck (1),
    badRequest      (2),
    badTime         (3),
    badCertId       (4),
    unsuportedExt   (5),
    mustArchiveKeys (6),
    badIdentity     (7),
    popRequired     (8),
    popFailed       (9),
    noKeyReuse      (10),
    internalCAError (11),
    tryLater        (12),
    authDataFail    (13)
}

-- Used for RAs to add extensions to certification requests
id-cmc-addExtensions OBJECT IDENTIFIER ::= {id-cmc 8}

AddExtensions ::= SEQUENCE {
    pkiDataReference    BodyPartID,
    certReferences      SEQUENCE OF BodyPartID,
    extensions          SEQUENCE OF Extension
}


id-cmc-encryptedPOP OBJECT IDENTIFIER ::= {id-cmc 9}
id-cmc-decryptedPOP OBJECT IDENTIFIER ::= {id-cmc 10}

EncryptedPOP ::= SEQUENCE {
    request       TaggedRequest,
    cms             ContentInfo,
    thePOPAlgID     AlgorithmIdentifier,
    witnessAlgID    AlgorithmIdentifier,
    witness         OCTET STRING
}

DecryptedPOP ::= SEQUENCE {
    bodyPartID      BodyPartID,
    thePOPAlgID     AlgorithmIdentifier,
    thePOP          OCTET STRING
}

 id-cmc-lraPOPWitness OBJECT IDENTIFIER ::= {id-cmc 11}

 LraPopWitness ::= SEQUENCE {
     pkiDataBodyid   BodyPartID,
     bodyIds         SEQUENCE OF BodyPartID
 }


--
id-cmc-getCert OBJECT IDENTIFIER ::= {id-cmc 15}

GetCert ::= SEQUENCE {
    issuerName      GeneralName,
    serialNumber    INTEGER }


id-cmc-getCRL OBJECT IDENTIFIER ::= {id-cmc 16}

GetCRL ::= SEQUENCE {
    issuerName    Name,
    cRLName       GeneralName OPTIONAL,
    time          GeneralizedTime OPTIONAL,
    reasons       ReasonFlags OPTIONAL }

id-cmc-revokeRequest OBJECT IDENTIFIER ::= {id-cmc 17}

RevokeRequest ::= SEQUENCE {
    issuerName            Name,
    serialNumber          INTEGER,
    reason                CRLReason,
    invalidityDate         GeneralizedTime OPTIONAL,
    passphrase            OCTET STRING OPTIONAL,
    comment               UTF8String OPTIONAL }

id-cmc-confirmCertAcceptance OBJECT IDENTIFIER ::= {id-cmc 24}

CMCCertId ::= IssuerAndSerialNumber

-- The following is used to request V3 extensions be added to a certificate

id-ExtensionReq OBJECT IDENTIFIER ::= {iso(1) member-body(2) us(840)
     rsadsi(113549) pkcs(1) pkcs-9(9) 14}

ExtensionReq ::= SEQUENCE SIZE (1..MAX) OF Extension

-- The following exists to allow Diffie-Hellman Certification Requests Messages to
-- be well-formed

id-alg-noSignature OBJECT IDENTIFIER ::= {id-pkix id-alg(6) 2}

NoSignatureValue ::= OCTET STRING

--  Unauthenticated attribute to carry removable data.
--    This will be used in the key archive draft among others.

id-aa OBJECT IDENTIFIER ::= { iso(1) member-body(2) us(840)
      rsadsi(113549) pkcs(1) pkcs-9(9) smime(16) id-aa(2)}
id-aa-cmc-unsignedData OBJECT IDENTIFIER ::= {id-aa 34}

CMCUnsignedData ::= SEQUENCE {
    bodyPartPath        BodyPartPath,
    identifier          OBJECT IDENTIFIER,
    content             ANY DEFINED BY identifier
}

--  Replaces CMC Status Info
--

id-cmc-statusInfoV2 OBJECT IDENTIFIER ::= {id-cmc 25}

CMCStatusInfoV2 ::= SEQUENCE {
   cMCStatus             CMCStatus,
   bodyList              SEQUENCE SIZE (1..MAX) OF
                                  BodyPartReference,
   statusString          UTF8String OPTIONAL,
   otherInfo             CHOICE {
     failInfo               CMCFailInfo,
     pendInfo               PendInfo,
     extendedFailInfo       SEQUENCE {
        failInfoOID            OBJECT IDENTIFIER,
        failInfoValue          AttributeValue
     }
   } OPTIONAL
}

BodyPartReference ::= CHOICE {
   bodyPartID           BodyPartID,
   bodyPartPath         BodyPartPath
}

BodyPartPath ::= SEQUENCE SIZE (1..MAX) OF BodyPartID

--  Allow for distribution of trust anchors
--

id-cmc-trustedAnchors OBJECT IDENTIFIER ::= {id-cmc 26}

PublishTrustAnchors ::= SEQUENCE {
    seqNumber      INTEGER,
    hashAlgorithm  AlgorithmIdentifier,
    anchorHashes     SEQUENCE OF OCTET STRING
}

id-cmc-authData OBJECT IDENTIFIER ::= {id-cmc 27}

AuthPublish ::= BodyPartID

--   These two items use BodyPartList
id-cmc-batchRequests OBJECT IDENTIFIER ::= {id-cmc 28}
id-cmc-batchResponses OBJECT IDENTIFIER ::= {id-cmc 29}

BodyPartList ::= SEQUENCE SIZE (1..MAX) OF BodyPartID


--
id-cmc-publishCert OBJECT IDENTIFIER ::= {id-cmc 30}

CMCPublicationInfo ::= SEQUENCE {
    hashAlg                      AlgorithmIdentifier,
    certHashes                   SEQUENCE OF OCTET STRING,
    pubInfo	                     PKIPublicationInfo
}

id-cmc-modCertTemplate OBJECT IDENTIFIER ::= {id-cmc 31}

ModCertTemplate ::= SEQUENCE {
    pkiDataReference             BodyPartPath,
    certReferences               BodyPartList,
    replace                      BOOLEAN DEFAULT TRUE,
    certTemplate                 CertTemplate
}

-- Inform follow on servers that one or more controls have already been processed

id-cmc-controlProcessed OBJECT IDENTIFIER ::= {id-cmc 32}

ControlsProcessed ::= SEQUENCE {
    bodyList              SEQUENCE SIZE(1..MAX) OF BodyPartReference
}

--  Identity Proof control w/ algorithm agility

id-cmc-identityProofV2 OBJECT IDENTIFIER ::= { id-cmc 34 }

IdentifyProofV2 ::= SEQUENCE {
    proofAlgID       AlgorithmIdentifier,
    macAlgId         AlgorithmIdentifier,
    witness          OCTET STRING
}

id-cmc-popLinkWitnessV2 OBJECT IDENTIFIER ::= { id-cmc 33 }
PopLinkWitnessV2 ::= SEQUENCE {
    keyGenAlgorithm   AlgorithmIdentifier,
    macAlgorithm      AlgorithmIdentifier,
    witness           OCTET STRING
}

END
</pre></div>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Enrollment Message Flows</h3>

<p>This section is informational.  The purpose of this section is to present, in an abstracted version, the messages that would flow between the client and server for several different common cases.
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1"></a><h3>Appendix B.1.&nbsp;
Request of a Signing Certificate</h3>

<p>This section looks at the messages that would flow in the event that an enrollment is occurring for a signing only key.  If the certificate was designed for both signing and encryption, the only difference would be the key usage extension in the certification request.
</p>
<p>Message from client to server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
ContentInfo.contentType = id-signedData
ContentInfo.content
  SignedData.encapContentInfo
    eContentType = id-ct-PKIData
    eContent
      controlSequence
        {102, id-cmc-identityProof, computed value}
        {103, id-cmc-senderNonce, 10001}
      reqSequence
        certRequest
          certReqId = 201
          certTemplate
            subject = My Proposed DN
            publicKey = My Public Key
            extensions
              {id-ce-subjectPublicKeyIdentifier, 1000}
              {id-ce-keyUsage, digitalSignature}
  SignedData.SignerInfos
    SignerInfo
      sid.subjectKeyIdentifier = 1000
</pre></div>
<p>Response from server to client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
ContentInfo.contentType = id-signedData
ContentInfo.content
  SignedData.encapContentInfo
    eContentType = id-ct-PKIResponse
    eContent
      controlSequence
        {102, id-cmc-statusInfoV2, {success, 201}}
        {103, id-cmc-senderNonce, 10005}
        {104, id-cmc-recipientNonce, 10001}
  certificates
    Newly issued certificate
    Other certificates
  SignedData.SignerInfos
    Signed by CA
</pre></div>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.2"></a><h3>Appendix B.2.&nbsp;
Single Certification Request, But Modified by RA</h3>

<p>This section looks at the messages that would flow in the event that an enrollment has one RA in the middle of the data flow.  That RA will modify the certification request before passing it on to the CA.
</p>
<p>Message from client to RA:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
ContentInfo.contentType = id-signedData
ContentInfo.content
  SignedData.encapContentInfo
    eContentType = id-ct-PKIData
    eContent
      controlSequence
        {102, id-cmc-identityProof, computed value}
        {103, id-cmc-senderNonce, 10001}
      reqSequence
        certRequest
          certReqId = 201
          certTemplate
            subject = My Proposed DN
            publicKey = My Public Key
            extensions
              {id-ce-subjectPublicKeyIdentifier, 1000}
              {id-ce-keyUsage, digitalSignature}
  SignedData.SignerInfos
    SignerInfo
      sid.subjectKeyIdentifier = 1000
</pre></div>
<p>Message from RA to CA:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
ContentInfo.contentType = id-signedData
ContentInfo.content
  SignedData.encapContentInfo
    eContentType = id-ct-PKIData
    eContent
      controlSequence
        { 102, id-cmc-batchRequests, { 1, 2} }
        { 103, id-cmc-addExtensions,
          { {1, 201, {id-ce-certificatePolicies, anyPolicy}}
            {1, 201, {id-ce-subjectAltName, {extension data}}
            {2, XXX, {id-ce-subjectAltName, {extension data}}}
      cmsSequence
        { 1, &lt;Message from client to RA #1&gt; }
        { 2, &lt;Message from client to RA #2&gt; }
  SignedData.SignerInfos
    SignerInfo
      sid = RA key.
</pre></div>
<p>Response from the CA to the RA:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
ContentInfo.contentType = id-signedData
ContentInfo.content
  SignedData.encapContentInfo
    eContentType = id-ct-PKIResponse
    eContent
      controlSequence
        {102, id-cmc-BatchResponse, {999, 998}}

        {102, id-cmc-statusInfoV2, {failed, 2, badIdentity}}
      cmsSequence
        { bodyPartID = 999
          contentInfo
            ContentInfo.contentType = id-signedData
            ContentInfo.content
              SignedData.encapContentInfo
                eContentType = id-ct-PKIResponse
                eContent
                  controlSequence
                   {102, id-cmc-statusInfoV2, {success, 201}}
              certificates
                Newly issued certificate
                Other certificates
              SignedData.SignerInfos
                Signed by CA
        }
        { bodyPartID = 998,
          contentInfo
            ContentInfo.contentType = id-signedData
            ContentInfo.content
              SignedData.encapContentInfo
                eContentType = id-ct-PKIResponse
                eContent
                  controlSequence
                    {102, id-cmc-statusInfoV2, {failure, badAlg}}
              certificates
                Newly issued certificate
                Other certificates
              SignedData.SignerInfos
                Signed by CA
        }
      SignedData.SignerInfos
        Signed by CA
</pre></div>
<p>Response from RA to client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
ContentInfo.contentType = id-signedData
ContentInfo.content
  SignedData.encapContentInfo
    eContentType = id-ct-PKIResponse
    eContent
      controlSequence
        {102, id-cmc-statusInfoV2, {success, 201}}
  certificates
    Newly issued certificate
    Other certificates
  SignedData.SignerInfos
    Signed by CA
</pre></div>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.3"></a><h3>Appendix B.3.&nbsp;
Direct POP for an RSA certificate</h3>

<p>This section looks at the messages that would flow in the event that an enrollment is done for an encryption only certificate using an direct POP method.  For simplicity it is assumed that the certification requestor already has a signing only certificate
</p>
<p>The fact that a second round trip is required is implicit rather than explicit.  The server determines this based on fact that no other POP exists for the certification request.
</p>
<p>Message #1 from client to server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
ContentInfo.contentType = id-signedData
ContentInfo.content
  SignedData.encapContentInfo
    eContentType = id-ct-PKIData
    eContent
      controlSequence
        {102, id-cmc-transactionId, 10132985123483401}
        {103, id-cmc-senderNonce, 10001}
        {104, id-cmc-dataReturn, &lt;packet of binary data identifying
                                  where the key in question is.&gt;}
      reqSequence
        certRequest
          certReqId = 201
          certTemplate
            subject = &lt;My DN from my signing cert&gt;
            publicKey = My Public Key
            extensions
              {id-ce-keyUsage, keyEncipherment}
          popo
            keyEncipherment
              subsequentMessage
  SignedData.SignerInfos
    SignerInfo
      Signed by requestor's signing cert
</pre></div>
<p>Response #1 from server to client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
ContentInfo.contentType = id-signedData
ContentInfo.content
  SignedData.encapContentInfo
    eContentType = id-ct-PKIResponse
    eContent
      controlSequence
        {101, id-cmc-statusInfoV2, {failed, 201, popRequired}}
        {102, id-cmc-transactionId, 10132985123483401}
        {103, id-cmc-senderNonce, 10005}
        {104, id-cmc-recipientNonce, 10001}
        {105, id-cmc-encryptedPOP, {
           request {
             certRequest
               certReqId = 201
                certTemplate
                  subject = &lt;My DN from my signing cert&gt;
                  publicKey = My Public Key
                  extensions
                    {id-ce-keyUsage, keyEncipherment}
                popo
                  keyEncipherment
                  subsequentMessage
           }
           cms
             contentType = id-envelopedData
             content
               recipipentInfos.riid.issuerSerialNumber = &lt;NULL, 201&gt;
               encryptedContentInfo
                 eContentType = id-data
                 eContent = &lt;Encrypted value of 'y'&gt;
           thePOPAlgID = HMAC-SHA1
           witnessAlgID = SHA-1
           witness &lt;hashed value of 'y'&gt;}}
        {106, id-cmc-dataReturn, &lt;packet of binary data identifying
                                  where the key in question is.&gt;}
  certificates
    Other certificates (optional)
  SignedData.SignerInfos
    Signed by CA
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
ContentInfo.contentType = id-signedData
ContentInfo.content
  SignedData.encapContentInfo
    eContentType = id-ct-PKIData
    eContent
      controlSequence
        {102, id-cmc-transactionId, 10132985123483401}
        {103, id-cmc-senderNonce, 100101}
        {104, id-cmc-dataReturn, &lt;packet of binary data identifying
                                  where the key in question is.&gt;}
        {105, id-cmc-recipientNonce, 10005}
        {107, id-cmc-decryptedPOP, {
          bodyPartID 201,
          thePOPAlgID HMAC-SHA1,
          thePOP &lt;HMAC computed value goes here&gt;}}
      reqSequence
        certRequest
          certReqId = 201
          certTemplate
            subject = &lt;My DN from my signing cert&gt;
            publicKey = My Public Key
            extensions
              {id-ce-keyUsage, keyEncipherment}
          popo
            keyEncipherment
              subsequentMessage
  SignedData.SignerInfos
    SignerInfo
      Signed by requestor's signing cert
</pre></div>
<p>Response from server to client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
ContentInfo.contentType = id-signedData
ContentInfo.content
  SignedData.encapContentInfo
    eContentType = id-ct-PKIResponse
    eContent
      controlSequence
        {101, id-cmc-transactionId, 10132985123483401}
        {102, id-cmc-statusInfoV2, {success, 201}}
        {103, id-cmc-senderNonce, 10019}
        {104, id-cmc-recipientNonce, 100101}
        {104, id-cmc-dataReturn, &lt;packet of binary data identifying
                                  where the key in question is.&gt;}
  certificates
    Newly issued certificate
    Other certificates
  SignedData.SignerInfos
    Signed by CA
</pre></div>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
Production of Diffie-Hellman Public Key Certification Requests</h3>

<p>Part of a certification request is a signature over the request; Diffie-Hellman is a key agreement algorithm and cannot be used to directly produce the required signature object.  <a class='info' href='#DH-POP'>[DH&#8209;POP]<span> (</span><span class='info'>Prafullchandra, H. and J. Schaad, &ldquo;Diffie-Hellman Proof-of-Possession Algorithms,&rdquo; June&nbsp;2000.</span><span>)</span></a> provides two ways to produce the necessary signature value.  This document also defines a signature algorithm that does not provide a POP value, but can be used to produce the necessary signature value.
</p>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.1"></a><h3>Appendix C.1.&nbsp;
 No-Signature Signature Mechanism</h3>

<p>Key management (encryption/decryption) private keys cannot always be used to produce some type of signature value as they can be in a decrypt only device.  Certification requests require that the signature field be populated.  This section provides a signature algorithm specifically for that purposes.  The following object identifier and signature value are used to identify this signature type:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   id-alg-noSignature OBJECT IDENTIFIER ::= {id-pkix id-alg(6) 2}

   NoSignatureValue ::= OCTET STRING
</pre></div>
<p>The parameters for id-alg-noSignature MUST be present and MUST be encoded as NULL.  NoSignatureValue contains the hash of the certification request.  It is important to realize that there is no security associated with this signature type.  If this signature type is on a certification request and the Certification Authority policy requires proof-of-possession of the private key, the POP mechanism defined in <a class='info' href='#c_encryptedPOP'>Section&nbsp;6.7<span> (</span><span class='info'>Encrypted and Decrypted POP Controls</span><span>)</span></a> MUST be used.
</p>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D"></a><h3>Appendix D.&nbsp;
Change History</h3>

<p>RFC Editor - please remove this appendix prior to publishing.
</p>
<p>RFC 27XX to -00
</p>
<ol class="text">
<li>  Addition of Extended CMC Status Info
</li>
</ol>
<p>From -00 to -01
</p>
<ol class="text">
<li>  Removal of Transport section to a new document.
</li>
<li>  Removal of Compliance section to a new document.
</li>
</ol>
<p>From -01 to -02
</p>
<ol class="text">
<li>	Add processing rules for PKIData and PKIResponse processing.
</li>
<li>	Add unsigned attribute for holding data (to be used by key archival).
</li>
<li>	Add trust root identification control.
</li>
<li>	Add Server to Client identity proof method.
</li>
<li>	Add controls to identify batch processing, needed by rules added in item 1.
</li>
</ol>
<p>From -02 to -03
</p>
<ol class="text">
<li>	Add unpublish control
</li>
<li>	Added use of AuthenticatedData structure from CMS
</li>
<li>	Insert Appendix B - Enrollment Message Flows
</li>
<li>	Add Modify Certification Request control
</li>
</ol>
<p>From -03 to -04
</p>
<ol class="text">
<li>Change author list.
</li>
<li>Add IANA Considerations section
</li>
<li>Correct module names in ASN.1
</li>
<li>Add id-cmc-controlProcessed control with associated changes.
</li>
</ol>
<p>From -04 to -05
</p>
<ol class="text">
<li>Change Trust Root to  Trust Anchor.
</li>
</ol>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jim Schaad</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Soaring Hawk Consulting</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">PO Box 675</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gold Bar, WA  98251</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">(425) 785-1031</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jimsch@nwlink.com">jimsch@nwlink.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Michael Myers</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">TraceRoute Security, Inc.</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mmyers@fastq.inc">mmyers@fastq.inc</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
