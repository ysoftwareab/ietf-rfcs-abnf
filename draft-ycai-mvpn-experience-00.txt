
Network Working Group                                          Yiqun Cai
Internet Draft                                              Mike McBride
Expiration Date: April 2006                                   Chris Hall









                                                             October 2005


                      Experience With Multicast VPN


                    draft-ycai-mvpn-experience-00.txt

Status of this Memo

    By submitting this Internet-Draft, each author represents that any
    applicable patent or other IPR claims of which he or she is aware
    have been or will be disclosed, and any of which he or she becomes
    aware will be disclosed, in accordance with Section 6 of BCP 79.

    This document is an Internet-Draft and is in full conformance with
    all provisions of RFC 3978/3979 .

    Internet-Drafts are working documents of the Internet Engineering
    Task Force (IETF), its areas, and its working groups.  Note that
    other groups may also distribute working documents as Internet-
    Drafts.

    Internet-Drafts are draft documents valid for a maximum of six months
    and may be updated, replaced, or obsoleted by other documents at any
    time.  It is inappropriate to use Internet-Drafts as reference
    material or to cite them other than as "work in progress."

    The list of current Internet-Drafts can be accessed at
    http://www.ietf.org/ietf/1id-abstracts.txt.

    The list of Internet-Draft Shadow Directories can be accessed at
    http://www.ietf.org/shadow.html.






Cai, McBride, et al.                                            [Page 1]

Internet Draft     draft-ycai-mvpn-experience-00.txt        October 2005


Abstract

    Multicast VPN based on early standards has been in operation in
    production networks for several years now.  This document describes
    some of the experience gained from implementation and deployment and
    as such is informational only.



Table of Contents

     1          Introduction  .......................................   2
     2          Implementation  .....................................   3
     2.1        RPF  ................................................   3
     2.2        MTU  ................................................   3
     2.3        Load Balancing  .....................................   4
     2.4        MTRACE  .............................................   4
     3          Operational Experience  .............................   4
     3.1        PIM Modes For MI-PMSI  ..............................   4
     3.2        PIM Modes For S-PMSI  ...............................   5
     3.3        Timer Alignment  ....................................   5
     3.4        MDT SAFI  ...........................................   6
     3.5        Addressing  .........................................   6
     3.6        Filtering  ..........................................   6
     3.7        Scalability  ........................................   6
     3.8        MPLS and IP  ........................................   7
     3.9        QOS  ................................................   7
     4          Security Considerations  ............................   7
     5          Iana Considerations  ................................   7
     6          Acknowledgments  ....................................   7
     7          Normative References  ...............................   7
     8          Informative References  .............................   8
     9          Authors' Addresses  .................................   8
    10          Full Copyright Statement  ...........................   8
    11          Intellectual Property  ..............................   9




1. Introduction

    Multicast support for L3 VPN based on RFC2547 [2547bis] was first
    presented in San Diego IETF, 2000.  It had not been included in the
    charter of L3VPN (formerly PPVPN) working group until San Diego IETF
    in 2004 and stayed on as an individual submission.  During the time,
    the drafts, known as "rosen-draft" [ROSEN-8], continued to evolve.
    Several vendors provided implementation based on the drafts and
    service providers started deploying the solution in production



Cai, McBride, et al.                                            [Page 2]

Internet Draft     draft-ycai-mvpn-experience-00.txt        October 2005


    networks.  Limited interoperability testing has also been done.

    Since the working group officially accepted the challenge to define a
    solution or solutions to support multicast, several proposals have
    been suggested.  They are now captured in [MVPN] which forms a base
    for future standards work.

    The unique history of multicast support in L3VPN, that is, the
    implementation and deployment started way before IETF adopted the
    work, has caused certain confusion. This is only natural with any
    pre-standard work.

    In this document, we describe some of the lessons learned from
    implementing and deploying MVPN.  We hope it will benefit
    implementors as well network operators looking to deploy MVPN
    services.


2. Implementation

    As of writing,  there are two known implementations: IOS from Cisco
    and JunOS from Juniper Networks. Contact these vendors for
    implementation details beyond what is provided in this draft. In the
    following sections, we describe some of issues we faced during
    implementation and early interop testing stage.


2.1. RPF

    [MVPN], as well as early "rosen-drafts", specifies that the source
    address of any PIM packets a PE router generates over MI-PMSI (or MDT
    tunnel) be the same as the BGP nexthop for updates originated by the
    PE router for all multicast traffic sources existing in the site.
    However, it was discovered that one implementation didn't do so,
    which caused interoperability problems.  The symptom of the problem
    is that a PE router couldn't resolve the RPF neighbour towards the
    source connected to a remote PE router.


2.2. MTU

    When GRE encapsulation is used in the core, 24 bytes are added to the
    IP packets generated in the VPNs.  Due to the lack of a path MTU
    discovery mechanism for multicast, a PE router may have to fragment
    the incoming packets.

    The best practice is to fragment the packets before performing any
    GRE encapsulation.  This spares the egress PE routers from



Cai, McBride, et al.                                            [Page 3]

Internet Draft     draft-ycai-mvpn-experience-00.txt        October 2005


    reassembling the fragments, and leaves that for the end-systems.
    This doesn't work if the "DF" bit is set in the original packet since
    the packet will be dropped.


2.3. Load Balancing

    Some vendors implement a special feature called "EIBGP load
    balancing".  What it does is install multiple routes from both EBGP
    and IBGP in the VRF unicast routing table.  When this is enabled on
    all PE routers, multicast RPF may be affected if it also supports
    load balancing.

    The best practice is to make sure multicast RPF procedure selects
    EBGP paths only when both are present.


2.4. MTRACE

    MTRACE is a tool that allows a network operator to obtain multicast
    routing information from routers, and to explore a path to the source
    of the traffic or the RP.

    Since there is no security mechanism embedded in the protocol, some
    service providers expressed concern when the mtrace packet has to
    traverse the PE routers in order to obtain the full information.

    At this moment, vendors have their own mechanism to remove, or hide,
    certain fields in the MTRACE packets in order to satisfy the needs of
    their customers.  It is becoming obvious that we need to define a
    better mechanism for the protocol for use in MVPN.



3. Operational Experience

3.1. PIM Modes For MI-PMSI

    In [ROSEN-8], "MI-PMSI" is also known as default MDTs, which is used
    to build an overlay network connecting all PE routers attaching to
    the same MVPN.

    Service providers have implemented PIM-SM and PIM-SSM instantiated
    MI-PMSI in production networks.  When PIM-SSM is used,  BGP based
    auto-discovery based on [ROSEN-8] has also been deployed. The
    majority of current default mdt deployments are using PIM-SM using
    static Anycast RP with MSDP assignment. But a dynamic RP discovery
    protocol, such as BSR, could also be used.



Cai, McBride, et al.                                            [Page 4]

Internet Draft     draft-ycai-mvpn-experience-00.txt        October 2005


    The decision to deploy either PIM-SM or PIM-SSM is based on the
    following concerns,

      + the number of multicast routing states

      + the overhead of managing the RP if PIM-SM is used

      + the difference of forwarding delay between shared tree and source
        trees




3.2. PIM Modes For S-PMSI

    In [ROSEN-8], "S-PMSI" is also known as data MDT.

    Data MDTs have also been deployed by service providers.  Both PIM-SM
    and PIM-SSM are used.  As of writing, the switching from MI-PMSI to
    S-PMSI is based on traffic rate, which is what implementations
    support today. The majority of data mdt deployments today are using
    SSM since the source address is included in the PIM Hello packet sent
    from the source PE, ie, there is no overlay signalling necessary.



3.3. Timer Alignment

    When PIM-SM is used for both MI-PMSI and S-PMSI,  some interesting
    observations were made.

    For example, when BSR is used in the service provider network to
    discover RPs, it takes more than 3 minutes to detect the failure of
    an RP if default timer is used.  During the window, PIM Hellos
    originated by C-PIM instances will be dropped, which cause PIM
    adjacencies to be torn down.  But since the default PIM Hello timer
    is 30 seconds, C-PIM instance on a PE router detects an outage much
    faster than the P-PIM instance on the same PE router.

    This is also a factor to be considered when choosing the protocol to
    discover RP.










Cai, McBride, et al.                                            [Page 5]

Internet Draft     draft-ycai-mvpn-experience-00.txt        October 2005


3.4. MDT SAFI

    Prior to [MDT SAFI], the PE BGP VPNv4 prefix update was sent using an
    extended community using RD type 2. With the introduction of [MDT
    SAFI], the update is sent with RD type 0. For backward compatibility,
    BGP allows sending RD type 2 updates to peers unable to understand
    the new MDT SAFI. It is our experience, and recommendation, that
    customers run routers with all MDT address family or routers with all
    pre MDT SAFI to prevent any BGP update conflicts.



3.5. Addressing

    It has become general practice to use 239/8 private address space
    when assigning address space to mvpn's. This helps to prevent leaking
    vpn traffic outside the mvpn core and helps keep customer data
    private. When SSM is used, 239.232/16 addressing is the common
    practice according to RFC 2365, Administratively Scoped IP Multicast.
    Operators typically deploy an addressing tool to manage their
    addresses.


3.6. Filtering

    It may be necessary to modify existing filters to permit GRE and UDP
    port 3232 to allow default and data MDT group traffic to pass.


3.7. Scalability

    MVPN defines use of PIM across the default MDT. PIM Hellos and
    join/prune messages will continue to increase with increase in PE's
    participating in that default MDT. There have been no scaling issues
    in the current deployments of MVPN. At some level of scaling of the
    default MDT, PIM Hello's and J/P messages may become a scaling issue.
    The scaling poiint at which these messages become a real operational
    problem is not clear.  Empirical field data shows they do not affect
    the broad range of MVPN deployments today. [ROSEN 8] is scalable as
    specified across a wide range of deployments. Some analysis is needed
    to clarify at what operational level PIM messages do become a
    problem. The L3VPN WG is trying to gather this information. The PIM
    WG may consider methods for allowing optional tuning of PIM to
    decrease PIM messages when this becomes of operational value.

    Increasing the Hello timer and increasing the periodic join/prune may
    help in MVPN scaling. Doing so, however, may affect join and leave
    latency in times when control messages are lost.



Cai, McBride, et al.                                            [Page 6]

Internet Draft     draft-ycai-mvpn-experience-00.txt        October 2005


3.8. MPLS and IP

    Though the majority of MVPN deployments are over an MPLS core, there
    have been deployments in both MPLS and IP cores. We have seen L3TPv3
    tunneling used successfully for transporting MVPN GRE across an IP
    core within a vrf.



3.9. QOS

    Deployments of MVPN, that have deployed QOS, are using the same QOS
    mechanisms for the MVPN GRE header that they are for their other data
    traffic.




4. Security Considerations

    This document has no known security implications.



5. Iana Considerations

    This document creates no new requirements on IANA namespaces.



6. Acknowledgments

    We'd like to thank Dino Farinacci for his feedback on this draft.



7. Normative References

    [2547bis] "BGP/MPLS VPNs", Rosen, Rekhter, et. al., September 2003,
    draft-ietf-l3vpn-rfc2547bis-01.txt

    [MVPN] "Multicast in MPLS/BGP IP VPNs", Rosen, Aggarwal, May 2005,
    draft-ietf-l3vpn-2547bis-mcast-00.txt








Cai, McBride, et al.                                            [Page 7]

Internet Draft     draft-ycai-mvpn-experience-00.txt        October 2005


8. Informative References

    [ROSEN-8] E. Rosen, Y. Cai, I. Wijnands, "Multicast in MPLS/BGP IP
    VPNs", draft-rosen-vpn-mcast-08.txt

    [MVPN-PIM] R. Aggarwal, A. Lohiya, T. Pusateri, Y. Rekhter, "Base
    Specification for Multicast in MPLS/BGP VPNs", draft-raggarwa-l3vpn-
    2547-mvpn-00.txt

    [RAGGARWA-MCAST] R. Aggarwal, et. al., "Multicast in BGP/MPLS VPNs
    and VPLS", draft-raggarwa-l3vpn-mvpn-vpls-mcast--01.txt".

    [RP-MVPN] S. Yasukawa, et. al., "BGP/MPLS IP Multicast VPNs", draft-
    yasukawa-l3vpn-p2mp-mcast-00.txt

    [MDT SAFI] G. Nalawade, et. al., "MDT SAFI", draft-nalawade-idr-mdt-
    safi-02.txt




9. Authors' Addresses

    Yiqun Cai
    ycai@cisco.com

    Mike McBride
    mmcbride@cisco.com

    Chris Hall
    chall@sprint.net



10. Full Copyright Statement

    Copyright (C) The Internet Society (2005).

    This document is subject to the rights, licenses and restrictions
    contained in BCP 78, and except as set forth therein, the authors
    retain all their rights.

    This document and the information contained herein are provided on an
    "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
    OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
    ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
    INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
    INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED



Cai, McBride, et al.                                            [Page 8]

Internet Draft     draft-ycai-mvpn-experience-00.txt        October 2005


    WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.



11. Intellectual Property

    By submitting this Internet-Draft, each author represents that any
    applicable patent or other IPR claims of which he or she is aware
    have been or will be disclosed, and any of which he or she becomes
    aware will be disclosed, in accordance with Section 6 of BCP 79.

    The IETF takes no position regarding the validity or scope of any
    Intellectual Property Rights or other rights that might be claimed to
    pertain to the implementation or use of the technology described in
    this document or the extent to which any license under such rights
    might or might not be available; nor does it represent that it has
    made any independent effort to identify any such rights.  Information
    on the procedures with respect to rights in RFC documents can be
    found in BCP 78 and BCP 79.

    Copies of IPR disclosures made to the IETF Secretariat and any
    assurances of licenses to be made available, or the result of an
    attempt made to obtain a general license or permission for the use of
    such proprietary rights by implementers or users of this
    specification can be obtained from the IETF on-line IPR repository at
    http://www.ietf.org/ipr.

    The IETF invites any interested party to bring to its attention any
    copyrights, patents or patent applications, or other proprietary
    rights that may cover technology that may be required to implement
    this standard.  Please address the information to the IETF at ietf-
    ipr@ietf.org.



















Cai, McBride, et al.                                            [Page 9]

Internet Draft     draft-ycai-mvpn-experience-00.txt        October 2005

