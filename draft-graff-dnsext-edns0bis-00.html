<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Extension Mechanisms for DNS (EDNS0)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Extension Mechanisms for DNS (EDNS0)">
<meta name="keywords" content="RFC, Request for Comments, I-D, Internet-Draft, edns0, dns">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">DNSEXT Working Group</td><td class="header">P. Vixie</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">M. Graff</td></tr>
<tr><td class="header">Obsoletes: <a href='http://tools.ietf.org/html/rfc2671'>2671</a> (if&nbsp;approved)</td><td class="header">Internet Systems Consortium</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">July 13, 2009</td></tr>
<tr><td class="header">Expires: January 14, 2010</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Extension Mechanisms for DNS (EDNS0)<br />draft-graff-dnsext-edns0bis-00</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on January 14, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>The Domain Name System's wire protocol includes a number of fixed fields whose
			range has been or soon will be exhausted and does not allow clients to
			advertise their capabilities to servers.  This document describes backward
			compatible mechanisms for allowing the protocol to grow.
</p>
<p>This document is a starting point to update the EDNS0 RFC after
				10 years of operational experience.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Requirements Language<br />
<a href="#anchor3">3.</a>&nbsp;
Affected Protocol Elements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
Message Header<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
Label Types<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.3.</a>&nbsp;
UDP Message Size<br />
<a href="#anchor7">4.</a>&nbsp;
Extended Label Types<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.1.</a>&nbsp;
Extended Label Type<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.2.</a>&nbsp;
Reserved Label Type<br />
<a href="#anchor10">5.</a>&nbsp;
OPT pseudo-RR<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.1.</a>&nbsp;
OPT Record Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.2.</a>&nbsp;
OPT Record Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">5.2.1.</a>&nbsp;
Fixed Content<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">5.2.2.</a>&nbsp;
Variable Content<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">5.3.</a>&nbsp;
Sender's Payload Size<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">5.3.1.</a>&nbsp;
Reassembly Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">5.3.2.</a>&nbsp;
Path MTU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">5.3.3.</a>&nbsp;
No Caching<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">5.3.4.</a>&nbsp;
Oversize Requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">5.3.5.</a>&nbsp;
Be Reasonable<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">5.4.</a>&nbsp;
Extended RCODE<br />
<a href="#anchor22">6.</a>&nbsp;
Transport Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">6.1.</a>&nbsp;
Meaning of OPT Presense<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">6.2.</a>&nbsp;
Meaning of OPT Absence<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">6.3.</a>&nbsp;
Refusing Message with OPT Records<br />
<a href="#anchor26">7.</a>&nbsp;
Security Considerations<br />
<a href="#anchor27">8.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor28">9.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>DNS <a class='info' href='#RFC1035'>[RFC1035]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a> specifies a Message Format and within such messages
there are standard formats for encoding options, errors, and name compression.
The maximum allowable size of a DNS Message is fixed.  Many of DNS's protocol
limits are too small for uses which are or which are desired to become common.
There is no way for implementations to advertise their capabilities.

</p>
<p>
Existing clients will not know how to interpret the protocol extensions
detailed here.  In practice, these clients will be upgraded when they have
need of a new feature, and only new features will make use of the extensions.
We must however take account of client behaviour in the face of extra fields,
and design a fallback scheme for interoperability with these clients.

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
	  "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
	  document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Affected Protocol Elements</h3>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Message Header</h3>

<p>The DNS Message Header's (see <a class='info' href='#RFC1035'>RFC 1035, section 4.1.1<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a> [RFC1035])
	 second full 16-bit word
is divided into a 4-bit OPCODE, a 4-bit RCODE, and a number of 1-bit flags.
The original reserved Z bits have been allocated to various purposes, and
most of the RCODE values are now in use.  More flags and more possible RCODEs
are needed.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Label Types</h3>

<p>The first two bits of a wire format domain label are used to denote the
type of the label.  <a class='info' href='#RFC1035'>RFC 1035, 4.1.4<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a> [RFC1035] allocates
 two of the four possible types
and reserves the other two.  Proposals for use of the remaining types far
outnumber those available.  More label types are needed.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
UDP Message Size</h3>

<p>DNS Messages are limited to 512 octets in size when sent over UDP.  While
the minimum maximum reassembly buffer size still allows a limit of 512 octets
of UDP payload, most of the hosts now connected to the Internet are able to
reassemble larger datagrams.  Some mechanism must be created to allow
requestors to advertise larger buffer sizes to responders.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Extended Label Types</h3>

<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Extended Label Type</h3>

<p>The "0 1" label type will now indicate an extended label type, whose
value is encoded in the lower six bits of the first octet of a label.  All
subsequently developed label types should be encoded using an extended label
type.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Reserved Label Type</h3>

<p>The "1 1 1 1 1 1" extended label type will be reserved for future
expansion of the extended label type code space.

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
OPT pseudo-RR</h3>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
OPT Record Behavior</h3>

<p>One OPT pseudo-RR can be added to the additional data section of either
a request or a response.  An OPT is called a pseudo-RR because it pertains to
a particular transport level message and not to any actual DNS data.  OPT RRs
shall never be cached, forwarded, or stored in or loaded from master files.
The quantity of OPT pseudo-RRs per message shall be either zero or one, but
not greater.

</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
OPT Record Format</h3>

<p>An OPT RR has a fixed part and a variable set of options expressed as
{attribute, value} pairs.  The fixed part holds some DNS meta data and also
a small collection of new protocol elements which we expect to be so popular
that it would be a waste of wire space to encode them as {attribute, value}
pairs.

</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
Fixed Content</h3>

<p>The fixed part of an OPT RR is structured as follows:
</p><br /><hr class="insert" />
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">Field Name</th><th align="left">Field Type</th><th align="left">Description</th></tr>
<tr>
<td align="left">NAME</td>
<td align="left">domain name</td>
<td align="left">empty (root domain)</td>
</tr>
<tr>
<td align="left">TYPE</td>
<td align="left">u_int16_t</td>
<td align="left">OPT</td>
</tr>
<tr>
<td align="left">CLASS</td>
<td align="left">u_int16_t</td>
<td align="left">sender's UDP payload size</td>
</tr>
<tr>
<td align="left">TTL</td>
<td align="left">u_int32_t</td>
<td align="left">extended RCODE and flags</td>
</tr>
<tr>
<td align="left">RDLEN</td>
<td align="left">u_int16_t</td>
<td align="left">describes RDATA</td>
</tr>
<tr>
<td align="left">RDATA</td>
<td align="left">octet stream</td>
<td align="left">{attribute,value} pairs</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;OPT RR Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
Variable Content</h3>

<p>
	The variable part of an OPT RR is encoded in its RDATA and is structured
as zero or more of the following:

</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>

              +0 (MSB)                            +1 (LSB)
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
0: |                          OPTION-CODE                          |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
2: |                         OPTION-LENGTH                         |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
4: |                                                               |
   /                          OPTION-DATA                          /
   /                                                               /
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
</pre></div>
<p>
				</p>
<blockquote class="text"><dl>
<dt>OPTION-CODE</dt>
<dd>Assigned by IANA.
</dd>
<dt>OPTION-LENGTH</dt>
<dd>Size (in octets) of OPTION-DATA.
</dd>
<dt>OPTION-DATA</dt>
<dd>Varies per OPTION-CODE.
</dd>
</dl></blockquote><p>
			
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Sender's Payload Size</h3>

<p>The sender's UDP payload size (which OPT stores in the RR CLASS
field) is the number of octets of the largest UDP payload that can be
reassembled and delivered in the sender's network stack.  Note that path
MTU, with or without fragmentation, may be smaller than this.

</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.1"></a><h3>5.3.1.&nbsp;
Reassembly Considerations</h3>

<p>4.5.1 Note that a 512-octet UDP payload requires a 576-octet IP reassembly
buffer.  Choosing 1280 on an Ethernet connected requestor would be reasonable.
The consequence of choosing too large a value may be an ICMP message from an
intermediate gateway, or even a silent drop of the response message.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.2"></a><h3>5.3.2.&nbsp;
Path MTU</h3>

<p>
		Both requestors and responders are advised to take account of the
path's discovered MTU (if already known) when considering message sizes.

</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.3"></a><h3>5.3.3.&nbsp;
No Caching</h3>

<p>
4.5.3. The requestor's maximum payload size can change over time, and
should therefore not be cached for use beyond the transaction in which it
is advertised.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.4"></a><h3>5.3.4.&nbsp;
Oversize Requests</h3>

<p>
	4.5.4. The responder's maximum payload size can change over time, but can
be reasonably expected to remain constant between two sequential transactions;
for example, a meaningless QUERY to discover a responder's maximum UDP payload
size, followed immediately by an UPDATE which takes advantage of this size.
(This is considered preferrable to the outright use of TCP for oversized
requests, if there is any reason to suspect that the responder implements
EDNS, and if a request will not fit in the default 512 payload size limit.)

</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.5"></a><h3>5.3.5.&nbsp;
Be Reasonable</h3>

<p>
4.5.5. Due to transaction overhead, it is unwise to advertise an architectural
limit as a maximum UDP payload size.  Just because your stack can reassemble
64KB datagrams, don't assume that you want to spend more than about 4KB of
state memory per ongoing transaction.

</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Extended RCODE</h3>

<p>
4.6. The extended RCODE and flags (which OPT stores in the RR TTL field)
are structured as follows:
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
              +0 (MSB)                            +1 (LSB)
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
0: |         EXTENDED-RCODE        |            VERSION            |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
2: |                               Z                               |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
</pre></div>
<p>
				</p>
<blockquote class="text"><dl>
<dt>EXTENDED-RCODE</dt>
<dd>
	Forms upper 8 bits of extended 12-bit RCODE.  Note that EXTENDED-RCODE value
"0" indicates that an unextended RCODE is in use (values "0" through "15").

</dd>
<dt>VERSION</dt>
<dd>
Indicates the implementation level of whoever sets it.  Full conformance with
this specification is indicated by version ``0.''  Requestors are encouraged
to set this to the lowest implemented level capable of expressing a
transaction, to minimize the responder and network load of discovering the
greatest common implementation level between requestor and responder.  A
requestor's version numbering strategy should ideally be a run time
configuration option.

<br />


If a responder does not implement the VERSION level of the request, then it
answers with RCODE=BADVERS.  All responses will be limited in format to the
VERSION level of the request, but the VERSION of each response will be the
highest implementation level of the responder.  In this way a requestor will
learn the implementation level of a responder as a side effect of every
response, including error responses, including RCODE=BADVERS.

</dd>
<dt>Z</dt>
<dd>
Set to zero by senders and ignored by receivers, unless modified in a
subsequent specification.

</dd>
</dl></blockquote><p>
			
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Transport Considerations</h3>

<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Meaning of OPT Presense</h3>

<p>
The presence of an OPT pseudo-RR in a request should be taken as an
indication that the requestor fully implements the given version of EDNS,
and can correctly understand any response that conforms to that
feature's specification.

</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Meaning of OPT Absence</h3>

<p>
Lack of use of these features in a request must be taken as an indication
that the requestor does not implement any part of this specification and that
the responder may make no use of any protocol extension described here in its
response.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Refusing Message with OPT Records</h3>

<p>
Responders who do not understand these protocol extensions are expected
to send a response with RCODE NOTIMPL, FORMERR, or SERVFAIL.  Therefore use of
extensions should be ``probed'' such that a responder who isn't known to
support them be allowed a retry with no extensions if it responds with such an
RCODE.  If a responder's capability level is cached by a requestor, a new
probe should be sent periodically to test for changes to responder capability.

</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>
Requestor-side specification of the maximum buffer size may open a new DNS
denial of service attack if responders can be made to send messages which are
too large for intermediate gateways to forward, thus leading to potential ICMP
storms between gateways and responders.

</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>The IANA has assigned RR type code 41 for OPT.
</p>
<p>It is the recommendation of this document and its working group that IANA
create a registry for EDNS Extended Label Types, for EDNS Option Codes, and
for EDNS Version Numbers.
</p>
<p>This document assigns label type 0b01xxxxxx as "EDNS Extended Label Type."
We request that IANA record this assignment.
</p>
<p>This document assigns extended label type 0bxx111111 as "Reserved for future
extended label types."  We request that IANA record this assignment.
</p>
<p>This document assigns option code 65535 to "Reserved for future expansion."
</p>
<p>This document expands the RCODE space from 4 bits to 12 bits.  This will
allow IANA to assign more than the 16 distinct RCODE values allowed in
<a class='info' href='#RFC1035'>RFC 1035<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a> [RFC1035].
</p>
<p>This document assigns EDNS Extended RCODE "16" to "BADVERS".
</p>
<p>IESG approval should be required to create new entries in the EDNS Extended
Label Type or EDNS Version Number registries, while any published RFC
(including Informational, Experimental, or BCP) should be grounds for
allocation of an EDNS Option Code.
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Acknowledgements</h3>

<p>Paul Mockapetris, Mark Andrews, Robert Elz, Don Lewis, Bob Halley, Donald
Eastlake, Rob Austein, Matt Crawford, Randy Bush, and Thomas Narten were each
instrumental in creating and refining this specification.

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC1035">[RFC1035]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1035, November&nbsp;1987 (<a href="http://www.rfc-editor.org/rfc/rfc1035.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Paul Vixie</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Internet Systems Consortium</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">950 Charter Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Redwood City, California  94063</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 650.423.1301</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:vixie@isc.org">vixie@isc.org</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Michael Graff</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Internet Systems Consortium</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">950 Charter Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Redwood City, California  94063</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 650.423.1304</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mgraff@isc.org">mgraff@isc.org</a></td></tr>
</table>
</body></html>
