



Network Working Group                                              J. Wu
Internet-Draft                                                    C. Liu
Intended status: Standards Track                     Tsinghua University
Expires: August 18, 2014                               February 14, 2014


        Communication between Softwire CEs with shared addresses
               draft-liu-softwire-ce-comm-shared-addr-00

Abstract

   In some Softwire mechanisms, multiple Customer Edge (CE) devices can
   share the same IPv4 address by using different port sets.  This
   document describes a problem of the IPv4 communication between
   Softwire CEs with the same IPv4 address.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on August 18, 2014.

Copyright Notice

   Copyright (c) 2014 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.




Wu & Liu                 Expires August 18, 2014                [Page 1]

Internet-Draft   Communication between CEs with port set   February 2014


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Requirements Language . . . . . . . . . . . . . . . . . . . .   2
   3.  Problem Statement . . . . . . . . . . . . . . . . . . . . . .   2
   4.  CE Behavior . . . . . . . . . . . . . . . . . . . . . . . . .   4
   5.  Security Considerations . . . . . . . . . . . . . . . . . . .   4
   6.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   4
   7.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   4
     7.1.  Normative References  . . . . . . . . . . . . . . . . . .   4
     7.2.  Informative References  . . . . . . . . . . . . . . . . .   4
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   4

1.  Introduction

   IPv4 devices use IPv4 addresses to recognize their local addresses.
   In many implementations (e.g. Linux), when an IPv4 device is
   forwarding or directly sending a packet, if the IPv4 destination
   address of the packet is one of the local addresses of the device,
   the device will never send the packet out.  The device is usually
   pre-configured with local routing records to route all packets
   destined to local addresses into local loopback interface.

   Softwire mechanisms, such as MAP-E [I-D.ietf-softwire-map] and
   Lightweight 4over6 [I-D.ietf-softwire-lw4over6], make use of address
   + port set based IPv4 address sharing.  Multiple Softwire CE devices
   (e.g. MAP CE and lwB4) are configured with the same IPv4 address,
   each with a different port set.

   When a CE attempts to send IPv4 packets to another CE and both CEs
   are configured with the same IPv4 address but different port sets,
   the IPv4 packets may be consumed by the first CE.  This problem
   causes the CEs with the same IPv4 address failed to send IPv4 packets
   to each other.  This document describes this problem and requires
   port set enabled devices to use IPv4 address + port set to recognize
   their local addresses.

2.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].

3.  Problem Statement

   When an IPv4 device sends a packet, if the destination address of the
   packet is one of the local IPv4 addresses of the device, the packet
   is consumed by the device itself and will not be sent out of the



Wu & Liu                 Expires August 18, 2014                [Page 2]

Internet-Draft   Communication between CEs with port set   February 2014


   device.  When the device is upgraded to support port set, it is
   configured with port-restricted IPv4 address(es).  The same IPv4
   address may be allocated to multiple devices.  If the device still
   use IPv4 address to recognize its local address, it is unable for the
   device to send IPv4 packets to any other devices that are configured
   with the same IPv4 address and a different port set.

   Figure 1 shows an example scenario of the problem.  In Figure 1(a),
   two hosts work as Softwire CEs.  They are provisioned with the same
   IPv4 address 198.51.100.1, each with a different port set.  When
   host1 sends a packet to host2 with the destination address
   198.51.100.1 and destination port 3000, its forwarding engine
   recognizes that 198.51.100.1 is its local address, so the packet is
   forwarded into its loopback interface.  In Figure 1(b), two CPEs work
   as Softwire CEs and each connects to an IPv4 host.  When host3 sends
   a packet to host4 with the destination address 198.51.100.2 and
   destination port 3001, the packet is forwarded to CPE1.  After
   received the packet, CPE1 recognizes that the destination address
   198.51.100.2 is its local address, so the packet is consumed by CPE1
   and never forwarded to CPE2/host4.


    dst=198.51.100.1,port 3000
      +----+.........X.............
      |    |                      .
      |    v                      v
    +--------+                 +--------+
    |Softwire|    Softwire     |Softwire|
    | host1  +--+...........+--+ host2  |
    +--------+                 +--------+
    198.51.100.1               198.51.100.1
    port 1024-2047             port 2048-4095

    (a) Host as CE

    dst=198.51.100.2,port 3001
        +--------------+..............X............
        |              |                          .
        |              v                          v
    +-------+     +---------+                 +---------+     +-------+
    | IPv4  |     |Softwire |    Softwire     |Softwire |     | IPv4  |
    | host3 +-----+  CPE1   +--+...........+--+  CPE2   +-----+ host4 |
    +-------+     +---------+                 +---------+     +-------+
                  198.51.100.2                198.51.100.2
                  port 1024-2047              port 2048-4095
    (b) CPE as CE

                    Figure 1: An Example of the Problem



Wu & Liu                 Expires August 18, 2014                [Page 3]

Internet-Draft   Communication between CEs with port set   February 2014


4.  CE Behavior

   A Softwire CE, that supports port set based IPv4 address sharing,
   MUST use IPv4 address + port set to recognize its local address.
   When forwarding an IPv4 packet, if the destination address of the
   packet is the CE's IPv4 address but the destination port of the
   packet does not belong to the port set of the CE, the CE MUST NOT
   send the packet into its local loopback interface.  The packet should
   be sent to CE's tunnel virtual interface or WAN interface, as per the
   forwarding policy of the corresponding Softwire mechanism.

5.  Security Considerations

   TBD

6.  IANA Considerations

   This document does not include an IANA request.

7.  References

7.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

7.2.  Informative References

   [I-D.ietf-softwire-lw4over6]
              Cui, Y., Qiong, Q., Boucadair, M., Tsou, T., Lee, Y., and
              I. Farrer, "Lightweight 4over6: An Extension to the DS-
              Lite Architecture", draft-ietf-softwire-lw4over6-06 (work
              in progress), February 2014.

   [I-D.ietf-softwire-map]
              Troan, O., Dec, W., Li, X., Bao, C., Matsushima, S.,
              Murakami, T., and T. Taylor, "Mapping of Address and Port
              with Encapsulation (MAP)", draft-ietf-softwire-map-10
              (work in progress), January 2014.

Authors' Addresses










Wu & Liu                 Expires August 18, 2014                [Page 4]

Internet-Draft   Communication between CEs with port set   February 2014


   Jianping Wu
   Tsinghua University
   Department of Computer Science, Tsinghua University
   Beijing  100084
   P.R.China

   Phone: +86-10-6278-5983
   Email: jianping@cernet.edu.cn


   Cong Liu
   Tsinghua University
   Department of Computer Science, Tsinghua University
   Beijing  100084
   P.R.China

   Phone: +86-10-6278-5822
   Email: gnocuil@gmail.com

































Wu & Liu                 Expires August 18, 2014                [Page 5]
