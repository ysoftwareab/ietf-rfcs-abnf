<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>CoAP Utilization for Building Control </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Terminology">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Motivation">
<link href="#rfc.section.2" rel="Chapter" title="2 URI structure">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Scheme part">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Authority part">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Path part">
<link href="#rfc.section.3" rel="Chapter" title="3 Group Naming and Addressing">
<link href="#rfc.section.4" rel="Chapter" title="4 Discovery">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 DNS-Based Service Discovery">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Service vs Host Names">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Browsing for Services">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Resource vs Service Discovery">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 CoRE Link Extensions for DNS-SD">
<link href="#rfc.section.4.5.1" rel="Chapter" title='4.5.1 Service Name "sn" attribute'>
<link href="#rfc.section.4.5.2" rel="Chapter" title='4.5.2 Service Type "st" attribute'>
<link href="#rfc.section.4.5.3" rel="Chapter" title='4.5.3 Service Subtype "ss" attribute'>
<link href="#rfc.section.5" rel="Chapter" title="5 Data Representations in CoAP">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Network architectures">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Gateways to legacy networks">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Commissioning CoAP devices">
<link href="#rfc.section.5.3.1" rel="Chapter" title="5.3.1 DNS-SD server present">
<link href="#rfc.section.5.3.2" rel="Chapter" title="5.3.2 DNS-SD server not present">
<link href="#rfc.section.6" rel="Chapter" title="6 Conclusions">
<link href="#rfc.section.7" rel="Chapter" title="7 Security considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgements">
<link href="#rfc.section.10" rel="Chapter" title="10 Changelog">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This draft describes an example use of the RESTful CoAP protocol for building automation and control (BAC) applications such as HVAC and lighting.  A few basic design assumptions are stated first, then URI structure is utilized to define group as well as unicast scope for RESTful operations.  RFC 3986 defines the URI components as (1) a scheme, (2) an authority, used here to locate the building, area, or node under control, (3) a path, used here to locate the resource under control, and (4) a query part (fragments are not supported in CoAP.)  Next, it is shown that DNS can be used to locate URIs on the scale necessary in large commercial BAC deployments.  Finally, a method is proposed for mapping URIs onto legacy BAC resources, e.g., to facilitate application-layer gateways.  " />
  <meta name="description" content="This draft describes an example use of the RESTful CoAP protocol for building automation and control (BAC) applications such as HVAC and lighting.  A few basic design assumptions are stated first, then URI structure is utilized to define group as well as unicast scope for RESTful operations.  RFC 3986 defines the URI components as (1) a scheme, (2) an authority, used here to locate the building, area, or node under control, (3) a path, used here to locate the resource under control, and (4) a query part (fragments are not supported in CoAP.)  Next, it is shown that DNS can be used to locate URIs on the scale necessary in large commercial BAC deployments.  Finally, a method is proposed for mapping URIs onto legacy BAC resources, e.g., to facilitate application-layer gateways.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">CoRE</td>
<td class="right">P.D.V. van der Stok</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Philips Research</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">K.E. Lynn</td>
</tr>
<tr>
<td class="left">Expires: September 15, 2011</td>
<td class="right">Consultant</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">March 14, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">CoAP Utilization for Building Control <br />
  <span class="filename">draft-vanderstok-core-bc-03</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This draft describes an example use of the RESTful CoAP protocol for building automation and control (BAC) applications such as HVAC and lighting.  A few basic design assumptions are stated first, then URI structure is utilized to define group as well as unicast scope for RESTful operations.  RFC 3986 defines the URI components as (1) a scheme, (2) an authority, used here to locate the building, area, or node under control, (3) a path, used here to locate the resource under control, and (4) a query part (fragments are not supported in CoAP.)  Next, it is shown that DNS can be used to locate URIs on the scale necessary in large commercial BAC deployments.  Finally, a method is proposed for mapping URIs onto legacy BAC resources, e.g., to facilitate application-layer gateways.  </p>
<p>This proposal supports the view that (1) building control is likely to move in steps toward all-IP control networks based on the legacy efforts provided by DALI, LON, BACnet, ZigBee, and other standards, and (2) service discovery is complimentary to resource discovery and facilitates control network scaling.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 15, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Terminology</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Motivation</a>
</li>
<li>2.   <a href="#rfc.section.2">URI structure</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Scheme part</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Authority part</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">Path part</a>
</li>
<li>3.   <a href="#rfc.section.3">Group Naming and Addressing</a>
</li>
<li>4.   <a href="#rfc.section.4">Discovery</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">DNS-Based Service Discovery</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Service vs Host Names</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Browsing for Services</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Resource vs Service Discovery</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">CoRE Link Extensions for DNS-SD</a>
</li>
<li>4.5.1.   <a href="#rfc.section.4.5.1">Service Name "sn" attribute</a>
</li>
<li>4.5.2.   <a href="#rfc.section.4.5.2">Service Type "st" attribute</a>
</li>
<li>4.5.3.   <a href="#rfc.section.4.5.3">Service Subtype "ss" attribute</a>
</li>
<li>5.   <a href="#rfc.section.5">Data Representations in CoAP</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Network architectures</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Gateways to legacy networks</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Commissioning CoAP devices</a>
</li>
<li>5.3.1.   <a href="#rfc.section.5.3.1">DNS-SD server present</a>
</li>
<li>5.3.2.   <a href="#rfc.section.5.3.2">DNS-SD server not present</a>
</li>
<li>6.   <a href="#rfc.section.6">Conclusions</a>
</li>
<li>7.   <a href="#rfc.section.7">Security considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Acknowledgements</a>
</li>
<li>10.   <a href="#rfc.section.10">Changelog</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#sect-1" id="sect-1">Introduction</a>
</h1>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#sect-1.1" id="sect-1.1">Terminology</a>
</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in "Key words for use in RFCs to Indicate Requirement Levels" <a href="#RFC2119">[RFC2119]</a>.  </p>
<p id="rfc.section.1.1.p.2">In addition, the following conventions are used in this document.  </p>
<p id="rfc.section.1.1.p.3">The term "service" often means different things to different communities and even different things to the same community.  In building control protocol standards, service is often used to refer to a function in the RPC sense.  In this context, we generally substitute the term "function".  In the IETF community, service may often refer to an abstract capability such as "datagram delivery".  In this submission we use the term service, in the sense defined by "DNS-based Service Discovery" <a href="#I-D.cheshire-dnsext-dns-sd">[I-D.cheshire-dnsext-dns-sd]</a>, as equivalent to a CoAP end-point (or server).  </p>
<p id="rfc.section.1.1.p.4">A CoAP end-point is identified by the authority part of a URI. We refer to this end-point (which is resolved to an {IP address, port} tuple) as a "node".  By "device" we generally mean the physical object handled by the installer. While a device may host more than one service, for simplicity we assume here that a given device may only host a single CoAP node.  </p>
<p id="rfc.section.1.1.p.5">In examples below involving URIs, the authority is preceded by double slashes "//" and path is preceded by a single slash "/".  The examples may make use of full or partial host names and the difference should be clear from the context.  </p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> <a href="#sect-1.2" id="sect-1.2">Motivation</a>
</h1>
<p id="rfc.section.1.2.p.1">The CoAP protocol <a href="#I-D.ietf-core-coap">[I-D.ietf-core-coap]</a> aims at providing a user application protocol architecture that is targeted to a network of nodes with a low resource provision such as memory, CPU capacity, and energy.  In general, IT application manufacturers strive to provide the highest possible functionality and quality for a given price.  In contrast, the building controls market is highly price sensitive and manufacturers tend to compete by delivering a given functionality and quality for the lowest price. In the first market a decreasing memory price leads to more software functionality, while in the second market it leads to a lower Bill of Material (BOM).  </p>
<p id="rfc.section.1.2.p.2">The vast majority of nodes in a typical building control application are resource constrained, making the standardization of a lightweight application protocol like CoAP a necessary requirement for IP to penetrate the device market.  This approach is further indicated by the low energy consumption requirement of battery-less nodes.  Low resource budget implies low throughput and small packet size as for <a href="#IEEE.802.15.4">[IEEE.802.15.4]</a>.  Reduction of the packet size is obtained by using the header reduction of 6LoWPAN <a href="#RFC4944">[RFC4944]</a> and encouraging small payloads.  </p>
<p id="rfc.section.1.2.p.3">Several legacy building control standards (e.g. <a href="#BACnet">[BACnet]</a>, <a href="#DALI">[DALI]</a>, <a href="#KNX">[KNX]</a>, <a href="#LON">[LON]</a>, <a href="#ZigBee">[ZigBee]</a>, etc.) have been developed based on years of accumulated knowledge and industry cooperation.  These standards generally specify a data model, functional interfaces, packet formats, and sometimes the physical medium for data objects and function invocation.  Many of these industry standards also specify lower-level functionality such as proprietary transport protocols, necessitating expensive stateful gateways for these standards to interoperate.  Many more recent building control network include IP-based standards for transport (at least to interconnect islands of functionality) and other functions such as naming and discovery.  CoAP will be successful in the building control market to the extent that it can represent a given standard's data objects and provide functions, e.g. resource discovery, that these standards depend on.  </p>

<dl>
<dt>- </dt>
<dd style="margin-left: 8">Generate small payloads.</dd>
<dt>- </dt>
<dd style="margin-left: 8">Compatible with legacy standards (e.g. LON, BACnet, DALI, ZigBee Device Objects).</dd>
<dt>- </dt>
<dd style="margin-left: 8">Service/resource discovery in agreement with legacy standards and naming conventions.  </dd>
</dl>

<p> This submission aims at an approach in which the payload contains messages with a syntax defined by legacy control standards. Accordingly, the syntax of the service/resource discovery messages is related to the chosen legacy control standard. The intention is a progressive approach to all-IP in building control. In a first stage standard IETF based protocols (e.g.CoAP, DNS-SD) are used for transport of control messages and discovery messages expressed in a legacy syntax.  This approach enables the reuse of controllers based on the semantics of the chosen control standard. In a later stage a complete redesign of the controllers can be envisaged guided by the accumulated experience with all-IP control.  </p>
<p id="rfc.section.1.2.p.4">Two concepts, hierarchy and group, are of prime importance in building control, particularly in lighting and HVAC.  Many control messages or events are multicast from one device to a group of devices (e.g. from a light switch to all lights in an area).  The scope of a multicast command or discovery message determines the group of nodes that is targeted.  A group scope may be defined as link-local, or as a tree maintained by IP-multicast or an overlay that corresponds to the logical structure of a building or campus, and is independent of the underlying network structure.  Techniques for group communication are discussed in <a href="#I-D.rahman-core-groupcomm">[I-D.rahman-core-groupcomm]</a>.  </p>
<p id="rfc.section.1.2.p.5">As described in "Commercial Building Applications Requirements" <a href="#I-D.martocci-6lowapp-building-applications">[I-D.martocci-6lowapp-building-applications]</a> it is typical practice to aggregate building control at the room, area, and supervisory levels.  Furthermore, networks for different subsystems (lights, HVAC, etc.) or based on different legacy standards have historically been isolated from each other in so-called "silos".  RESTful web services <a href="#Fielding">[Fielding]</a> represent one possible way to expose functionality and normalize data representations between silos in order to facilitate higher order applications such as campus-wide energy management.  </p>
<p id="rfc.section.1.2.p.6">Consequently, additional protocol oriented assumptions are: </p>

<dl>
<dt>- </dt>
<dd style="margin-left: 8">Nodes may be addressed by one or more groups.</dd>
<dt>- </dt>
<dd style="margin-left: 8">Resources addressed by a group must be uniformly named across all targeted nodes.</dd>
</dl>

<p> For clarity, this I-D limits itself to two types of applications: (1) M2M control applications running within a building area without any human intervention after commissioning of a given network segment and (2) maintenance oriented applications where data are collected from node in several building areas by nodes inside or outside the building, and humans may intervene to change control settings.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#sect-2" id="sect-2">URI structure</a>
</h1>
<p id="rfc.section.2.p.1">This I-D considers three elements of the URI: scheme, authority, and path, as defined in "Uniform Resource Identifier (URI): Generic Syntax" <a href="#RFC3986">[RFC3986]</a>.  The authority is defined within the context of standard DNS host naming, while the path is valid in relation to a fully qualified domain name (FQDN) plus optional port (and protocol is implicit, based on scheme). An example based on <a href="#RFC3986">[RFC3986]</a> is: foo://host.example.com:8042/over/there?name=ferret#nose, where "foo" is the scheme, "host.example.com:8042" is the authority, "/over/there" is the path, "name=ferret" is the query, and "nose" is the fragment. Fragments are not supported in CoAP.  </p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#sect-2.1" id="sect-2.1">Scheme part</a>
</h1>
<p id="rfc.section.2.1.p.1">The coap URI scheme syntax is specified in section 6.1 of <a href="#I-D.ietf-core-coap">[I-D.ietf-core-coap]</a> and is compatible with the "http" scheme specification <a href="#RFC2616">[RFC2616]</a>.  The host part of the authority may be represented either as a literal IP address or as a fully qualified domain name.  While scheme is irrelevant from the perspective of the service, it is used in service discovery to identify the protocol used to access the service.  </p>
<p id="rfc.section.2.1.p.2">TBD: we have yet to fully explore the utility of a separate scheme (e.g., "coapm") to support group communication models as described in <a href="#I-D.rahman-core-groupcomm">[I-D.rahman-core-groupcomm]</a>.  </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#sect-2.2" id="sect-2.2">Authority part</a>
</h1>
<p id="rfc.section.2.2.p.1">The authority part is either a literal IP address or a DNS name comprised of a local part, specifying an individual node or group of nodes, and a global part specifying a (sub)domain that may reflect the logical hierarchical structure of the building control network.  The result is said to be a fully qualified domain name (FQDN) which is globally unique down to the group or node level.  An optional port number may be included in the authority following a single colon ":" if the service port is other than the default CoAP value.  </p>
<p id="rfc.section.2.2.p.2">The CoAP spec <a href="#I-D.ietf-core-coap">[I-D.ietf-core-coap]</a> states "When a CoAP server is hosted by a 6LoWPAN node, it SHOULD also support a port in the 61616-61631 compressed UDP port space defined in [RFC4944]." As shown below, DNS-SD <a href="#I-D.cheshire-dnsext-dns-sd">[I-D.cheshire-dnsext-dns-sd]</a> is a viable technique for discovering dynamic host and port assignments for a given service.  However, the use of dynamic ports in URIs is likely to lead to brittle (non-durable) identifiers as it is conventional to treat different ports as representing different authorities and there is no assurance that a coap server will consistently acquire the same dynamic port.  </p>
<p id="rfc.section.2.2.p.3">A building can be unambiguously addressed by it GPS coordinates or more functionally by its zip or postal code.  For example the Dutch Internet provider, KPN, assigns to each subscriber a host name based on its postcode. Analogously, an example authority for a building may be given by: //bldg.zipcode-localnr.Country/ or more concretely an imaginary address in the Netherlands as: //bldg.5533BA-125a.nl/.  The "bldg" prefix can specify the target node within the building. Arriving at the node identified by //bldg.5533BA-125a.nl, the receiving service can parse the path portion of the URI and perform the requested method on the specified resource.  </p>
<p id="rfc.section.2.2.p.4">Buildings have a logical internal structure dependent on their size and function. This ranges from a single hall without any structure to a complex building with wings, floors, offices and possibly a structure within individual rooms. The naming of the building control equipment and the actual control strategy are intimately linked to the building structure. It is therefore natural to name the equipment based on their location within the building. Consequently, the local part of the URI identifying a piece of equipment is expressed in the building structure.  An example is: //light-27.floor-1.west-wing...  </p>
<p id="rfc.section.2.2.p.5">This proposal assumes a minimal level of cooperation between the IT and building management infrastructure, namely the ability of the former to delegate DNS subdomains to the latter.  This allows the building controls installer to implement an appropriate naming scheme with the required granularity.  For institutional real estate such as a college or corporate campus, the authority might be based on the organization's domain, e.g. //node-or-group.floor.wing.bldg.campus.example.com/.  In cases where subdomain delegation is not an option, structure can still be represented in a "flat" namespace, subject to the 63 octet limit for a DNS label: //group1-floor2-west-bldg3-campus.example.com.  </p>
<p id="rfc.section.2.2.p.6">Most communication is device to device (M2M) within the building. Often a device needs to communicate to all devices of a given type within a given area of the building.  For example a thermostat may access all radiator actuators in a zone.  A light switch located at room 25b006 of floor one, expressed as: //switch0.25b006.floor1.5533BA-125a.nl/, might specify a command to light1 within the same room with //light1.25b006.floor1.5533BA-125a.nl/.  This approach seems to lead to rather verbose URI strings in the packet, contrary to the small packet assumption. However, the design of CoAP is such that the authority portion of the URI need not be transmitted in requests sent to servers. The question arises as to whether the syntax of the authority part needs to be standardized for building control. Given the examples later in the text, this appears more to be the concern of the building owner or the installer than a standardization concern.  </p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> <a href="#sect-2.3" id="sect-2.3">Path part</a>
</h1>
<p id="rfc.section.2.3.p.1">Every network addressable resource is completely identified by a URI scheme://authority/path. The path part of the URI specifies the resource within a given node.   The representation of object types and their associated attributes are typically subjects for standardization.  There is no widely accepted standard for uniformly naming building control device structure in a URI. A vigorous effort is undertaken by the oBIX working group of OASIS <a href="#oBIX">[oBIX]</a>, but its current impact is limited.  </p>
<p id="rfc.section.2.3.p.2">When a GET method with an URI like "//t-sensor1.25b006.floor1.example.com/temperature" is sent, it represents an a priori understanding that the node with name t-sensor1 exists, is of a given standard type (e.g. ZigBee temperature sensor), and that this standard type has the readable attribute: temperature. When commands are sent to a group of nodes it MUST be the case that the targeted resource has the same path on all targeted nodes.  Therefore, it is necessary to establish at least a local uniform path naming convention to achieve this.  One approach is to include the name of the standard, e.g. BACnet, as the first element in the path and then employ the standard's chosen data scheme (in the case of BACnet, /bacnet/device/object/property).  </p>
<p id="rfc.section.2.3.p.3">A better long-term solution is to build on the concepts presented in <a href="#I-D.ietf-core-link-format">[I-D.ietf-core-link-format]</a> and identify resources of a given object model in terms of a registered "/.well-known" prefix.  The organization responsible for defining a given industry standard XXX (e.g. BACnet, ZigBee, etc.) can register the /.well-known/XXX prefix and specify the allowable pathnames that may occur under this prefix. This allows the XXX standard development organization to assume responsibility for defining the name space and resources associated with the prefix.  The registered /.well-known/XXX URI effectively defines a standard object model, or schema.  Manufacturers may optionally define proprietary resources that can be discovered dynamically using methods described below.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#sect-3" id="sect-3">Group Naming and Addressing</a>
</h1>
<p id="rfc.section.3.p.1">Given a network configuration and associated prefixes, the network operator needs to define an appropriate set of groups which can be mapped to the building areas. Knowledge about the hierarchical structure of the building areas may assist in defining a network architecture which encourages an efficient group communication implementation.  IP-multicasting over the group is a possible approach for building control, although proxy-based methods may prove to be more appropriate in some deployments <a href="#I-D.rahman-core-groupcomm">[I-D.rahman-core-groupcomm]</a>.  </p>
<div id="#rfc.table.1"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">URI authority </th>
<th class="left">Targeted group </th>
</tr></thead>
<tbody>
<tr>
<td class="left">//all.bldg6... </td>
<td class="left">"all nodes in building 6"</td>
</tr>
<tr>
<td class="left">//all.west.bldg6... </td>
<td class="left">"all nodes in west wing, building 6" </td>
</tr>
<tr>
<td class="left">//all.floor1.west.bldg6... </td>
<td class="left">"all nodes on floor 1, west wing, ..." </td>
</tr>
<tr>
<td class="left">//all.bu036.floor1.west.bldg6... </td>
<td class="left">"all nodes in office bu036, ..." </td>
</tr>
</tbody>
</table>
<p id="rfc.section.3.p.2">Example groups become: <a href="#RFC3596">[RFC3596]</a> in each zone.  Highly granular multicast scopes are only practical using IPv6. The multicast address allocation strategy is beyond the scope of this I-D, but various alternatives have been proposed <a href="#RFC3306">[RFC3306]</a><a href="#RFC3307">[RFC3307]</a><a href="#RFC3956">[RFC3956]</a>.  Some techniques in this proposal, e.g. service discovery as described below, can be accomplished with a single coap-specific multicast address as long as the desired scope is building-wide.  </p>
<p id="rfc.section.3.p.3">To illustrate the concept of multiple group names within a building, consider the definition, as done with <a href="#DALI">[DALI]</a>, of scenes within the context of a floor or a single office. For example, the setting of all blue lights in office bu036 of floor 1 can be realized by multicasting a message to the group "//blue-lights.bu036.floor1". Each group is associated with an IP address.  Consequently, when the application specifies the sending of an "on" message to all blue lights in the office, the message is multicast to the associated IP address. The Uri-Host option <a href="#I-D.ietf-core-coap">[I-D.ietf-core-coap]</a> need not be sent as part of the message. However to identify the resource that is addressed, a short version of the resource path can be inserted as an option as explained in <a href="#I-D.ietf-core-link-format">[I-D.ietf-core-link-format]</a>.  </p>
<p id="rfc.section.3.p.4">The binding of a group FQDN to multicast address (i.e., creation of the AAAA record in the DNS zone server) happens during the commissioning process.  Resolution of the group name to a multicast address happens at restart of a source or receiver node.  A multicast address and associated group name in this context are assumed to be long-lived. It can happen that during operation the membership of the group changes (less or more lights) but its address is not altered and neither its name. In the limit, the group can degrade to a single controller that represents a non-networked subsystem replacing the original networked group of nodes.  Group membership may be managed by a protocol such as Multicast Listener Discovery <a href="#RFC5790">[RFC5790]</a>.  </p>
<p id="rfc.section.3.p.5">A group defines a set of nodes. All resources on a given node are referenced by the multicast address(es) to which the node belongs.  A given node might belong to a number of groups.  For example the node belonging to the "blue-lights" group in a given corridor might also belong to the groups: "whole building", "given wing", "given floor", "given corridor", and "lights in given corridor". Assuming that belonging to a group has as only consequence for the group member that it should accept packets for an additional IP address, the granularity of the domain names may have an impact on the complexity of the DNS server but not necessarily on the low-resource destinations or sources. Assuming that resolution of addresses only happens at node start-up, the complexity of the DNS server need not affect the responsiveness of the nodes.  </p>
<p id="rfc.section.3.p.6">In summary, the authority portion of the URI is used to identify a node (group) and the resulting DNS name is bound to a unicast (multicast) address.  Naming is building or organization dependent, must be flexible, and does not require standardization efforts but SHOULD conform to some uniform convention.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#sect-4" id="sect-4">Discovery</a>
</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#sect-4.1" id="sect-4.1">DNS-Based Service Discovery</a>
</h1>
<p id="rfc.section.4.1.p.1">DNS-Based Service Discovery (DNS-SD) defines a conventional way to configure DNS PTR, SRV, and TXT records to facilitate discovery of services such as CoAP nodes within a subdomain, re-using the existing DNS infrastructure.  This section gives a cursory overview of DNS-SD; see <a href="#I-D.cheshire-dnsext-dns-sd">[I-D.cheshire-dnsext-dns-sd]</a>  for a complete description.  </p>
<p id="rfc.section.4.1.p.2">A DNS-SD service instance name is of the form &lt;Instance&gt;.&lt;ServiceType&gt;.&lt;Location&gt;, where the service type for CoAP nodes is "_coap._udp".  The identifier "_udp" provides a transport protocol hint as required by the SRV record definition <a href="#RFC2782">[RFC2782]</a> and "_coap" identifies the application protocol.  A PTR record with the label "_coap._udp" is defined for each CoAP end-point in the zone, and this record's value is set to the service instance name (which in turn identifies to SRV and TXT records for the CoAP end-point).  </p>
<p id="rfc.section.4.1.p.3">DNS-SD also supports one level of subtype, which can be used to locate coap services based on object model (schema), for example: _bacnet._sub._coap._udp, _dali._sub._coap._udp, or _zigbee._sub._coap._udp.  The maximum length of the type and subtype fields is 14 octets, which could allow for "schema-function" descriptors such as _dali-light, _dali-switch, etc.  </p>
<p id="rfc.section.4.1.p.4">The Location part of the service name is identical to the global (DNS subdomain) part of the authority in URIs that identify the resources on this node or group and may identify a building zone as in the examples above.  </p>
<p id="rfc.section.4.1.p.5">The Instance part of the service name may be changed during the commissioning process.  It must be unique within the subdomain.  The complete service name uniquely identifies an SRV and a TXT record in the DNS zone.  The granularity of a service name MAY be at the group or node level, or it could represent a particular resource within a coap node.  The SRV record contains the host (AAAA record) name and port of the service.  In the case where a service name identifies a particular functional entry point, the path part of the URI may be placed in the TXT record.  </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#sect-4.2" id="sect-4.2">Service vs Host Names</a>
</h1>
<p id="rfc.section.4.2.p.1">In general, the authority "www.example.com" does not refer to a canonical host name (the label of a AAAA record).  Logically, it refers to the "world wide web service" for the example.com domain.  Literally, the "www" is probably the label of a CNAME record that names a AAAA record that may in turn specify more than one address (in the case of round-robin load leveling between identical origin server instances).  </p>
<p id="rfc.section.4.2.p.2">The SRV record functions something like the CNAME in this case, except that it is capable of resolving to an IP address plus a listening socket (though, as we said, the use of dynamic sockets is not recommended in URIs).  An optional TXT record may be configured wih same name as the SRV record and be used to store context- dependent key=value pairs.  For example, a multi-function device might define a service name for each "base URI" that locates the start of an object resource (e.g. abs-path=/.well-known/zigbee/sensor/).  Thus, the URI coap://host.example.com/temp might resolve through DNS-SD lookups to coap://[fdfd::1234]/.well-known/zigbee/sensor/temp.  </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#sect-4.3" id="sect-4.3">Browsing for Services</a>
</h1>
<p id="rfc.section.4.3.p.1">CoAP nodes in a given subdomain may be enumerated by sending a DNS query for PTR records named _coap._udp to the authoritative server for that zone.  A list of names for SRV records matching that ServiceType.Location is returned.  Each SRV record contains the port and host name of a CoAP node.  The IP address of the node is obtained by resolving the host name.  DNS-SD also specifies an optional TXT record, having the same name as the SRV record, which can contain "key=value" attributes.  Apart from defining the standard resources identified by schema=XXX, the XXX organization may also define the standard "key=value" pairs present in the TXT record, e.g. type=switch.  By convention, the first pair is txtver=&lt;number&gt; so that different versions of the XXX schema may interoperate.  </p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#sect-4.4" id="sect-4.4">Resource vs Service Discovery</a>
</h1>
<p id="rfc.section.4.4.p.1">While service discovery is concerned with finding the IP address, port, protocol, and possibly path of a named service, resource discovery is a fine-grained enumeration of resource URIs within a web service.  <a href="#I-D.ietf-core-link-format">[I-D.ietf-core-link-format]</a> specifies a resource discovery pattern, such that sending a confirmable GET message for the /.well-known/core resource returns a set of links that identify all resources present on the node that are exposed as functions.  </p>
<p id="rfc.section.4.4.p.2">Assuming the ability to multicast the GET over the local link, coap resource discovery can be used to enumerate attributes and populate the DNS-SD database in a semi-automated fashion.  CoAP resource descriptions can be imported into DNS-SD for exposure to service discovery by using /.well-known/core attributes as the basis for a unique "Instance" name, defaulting to "_coap._udp" for the ServiceType, and using some means to establish in which subdomain the service should be registered (TBD).  The DNS TXT record can be populated by importing the other resource description attributes as they share the same key=value format specified in Section 6 of <a href="#I-D.cheshire-dnsext-dns-sd">[I-D.cheshire-dnsext-dns-sd]</a>.  </p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> <a href="#sec-4.5" id="sec-4.5">CoRE Link Extensions for DNS-SD</a>
</h1>
<div id="#rfc.figure.1"></div>
<pre>
              
   link-extension    = ( "sn" "=" quoted-string )
   link-extension    = ( "st" "=" quoted-string )
   link-extension    = ( "ss" "=" quoted-string )
            
          </pre>
<p id="rfc.section.4.5.p.1">The following CoRE specific target attributes are proposed as extensions to <a href="#I-D.ietf-core-link-format">[I-D.ietf-core-link-format]</a> to support DNS-SD.  The values are intended to be imported directly into a DNS- SD zone file are are subject to format and length constraints as specified in <a href="#I-D.cheshire-dnsext-dns-sd">[I-D.cheshire-dnsext-dns-sd]</a>.  </p>
<h1 id="rfc.section.4.5.1">
<a href="#rfc.section.4.5.1">4.5.1.</a> <a href="#sec-4.5.1" id="sec-4.5.1">Service Name "sn" attribute</a>
</h1>
<p id="rfc.section.4.5.1.p.1">The service name "sn" attribute is the &lt;Instance&gt; portion of a DNS-SD service instance name.  It is stored directly in the DNS as a single DNS label of canonical precomposed UTF-8 <a href="#RFC3629">[RFC3629]</a> "Net-Unicode" (Unicode Normalization Form C) <a href="#RFC5198">[RFC5198]</a> text.  However, to the extent that the "sn" attribute may be chosen to match the DNS host name of a proxy or gateway, it SHOULD use the syntax defined in Section 3.5 of <a href="#RFC1034">[RFC1034]</a> and Section 2.1 of <a href="#RFC1123">[RFC1123]</a>.  </p>
<p id="rfc.section.4.5.1.p.2">The &lt;Instance&gt; portion of the name of a service being offered on the network SHOULD be configurable by the user setting up the service, so that he or she may give it an informative name. However, the device or service SHOULD NOT require the user to configure a name before it can be used. A sensible choice of default name can allow the device or service to be accessed in many cases without any manual configuration at all. The default name should be short and descriptive, and MAY include the device's MAC address, serial number, or any similar hexadecimal string in an attempt to make the name globally unique.  </p>
<p id="rfc.section.4.5.1.p.3">DNS labels are currently limited to 63 octets in length and the entire service instance name may not exceed 255 octets.  </p>
<h1 id="rfc.section.4.5.2">
<a href="#rfc.section.4.5.2">4.5.2.</a> <a href="#sec-4.5.2" id="sec-4.5.2">Service Type "st" attribute</a>
</h1>
<p id="rfc.section.4.5.2.p.1">The service type "st" attribute is composed into the &lt;ServiceType&gt; portion of a DNS-SD instance name as follows.  It is limited to 14 octets of Net-Unicode text.  If ommitted, it defaults to "coap".  An underscore '_' is prepended to the value of the "st" attribute, which is then concatenated with a period '.', and finally the "_udp" identifier.  The resulting string is used to form labels for DNS-SD records and as such is stored directly in the DNS.  </p>
<h1 id="rfc.section.4.5.3">
<a href="#rfc.section.4.5.3">4.5.3.</a> <a href="#sec-4.5.3" id="sec-4.5.3">Service Subtype "ss" attribute</a>
</h1>
<p id="rfc.section.4.5.3.p.1">The service subtype "st" attribute, if present, follows the format and composition rules defined in the previous section.  It is then concatenated with a period '.' and the &lt;ServiceType&gt; string defined above to form additonal labels for DNS-SD records as defined in Section 4.1.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#sect-5" id="sect-5">Data Representations in CoAP</a>
</h1>
<p id="rfc.section.5.p.1">Before CoAP devices can come to market, manufacturers must agree that the type and attributes of the device can be interpreted according to some generally recognized syntax.  At this moment no such generally recognized syntax exists for CoAP devices. We do not expect an IETF working group to standardize such a syntax, and we are convinced that syntax standardization is the responsibility of industry standards organizations. Given the long history of building control, many groups have defined a data representation for building control devices for example BACnet, ZigBee oBIX, LON, KNX, and many others. It is our believe that new representations will be defined and must coexist with the named legacy ones.  </p>
<p id="rfc.section.5.p.2">The CoAP protocol should transport any data representation, and certainly the legacy ones. As pointed out earlier, this has consequences for the naming of resources. In some cases a CoAP device can handle more than one legacy representation. Given that a CoAP device can handle representation of standard XXX, this I-D proposes that such a CoAP device can communicate with legacy devices via a CoAP/legacy gateway (router).  </p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#sect-5.1" id="sect-5.1">Network architectures</a>
</h1>
<p id="rfc.section.5.1.p.1">Figure 1 represents the network architecture which is expected for the purpose of this I-D.  The coap gateway connects one link with two legacy nodes -containing legacy data representation "yyy"- with the wireless coap network composed of three coap hosts. Two coap hosts contain the coap stack with a zzz representation and one host contains the coap stack with a zzz and an yyy representation. The yyy hosts can freely communicate according to the yyy link protocol over the yyy link. The zzz coap hosts, including the zzz;yyy host can freely exchange zzz data representations according to the coap protocol over the wireless IP/6LoWPAN network. The zzz;yyy host can send yyy data representations to the coap gateway which passes them on to the specified yyy legacy host. The yyy legacy node returns data to the requesting zzz;yyy coap host via the same gateway.  </p>
<div id="#rfc.figure.2"></div>
<pre>
  +------+                 +------+     +------+
  | yyy  |                 | zzz  |     | zzz  |
  | link |                 | coap |     | coap |
  +------+                 +------+     +------+
    |         +---------+
    |---------| coap    |--&gt;
    |         | gateway |
  +------+    +---------+        +-----------+
  | yyy  |                       | zzz ; yyy |
  | link |                       |   coap    |
  +------+                       +-----------+
        </pre>
<p id="rfc.section.5.1.p.2">There are at least four ways that the CoAP hosts can address the legacy nodes behind the gateway.  </p>
<p id="rfc.section.5.1.p.3">The major advantage of all four approaches is that the gateway only handles the URI or IP address and port number to select the destination legacy node independent of the type of legacy device and the contents of the legacy payload of the message.  In Figure 1 the gateway connects to a single link. For example, this would be the case for DALI standard.  Other legacy standards, like BACnet, LON, allow networks composed of multiple links.  </p>
<p id="rfc.section.5.1.p.4">An example of an invocation of a zzz device from a controller that can producee zzz commands is given. Assume the resource path /.well-known/zzz identifies the parser of the ZZZ syntax. A 12 octet message completely describes the zzz command.  The host is completely identified by the authority in the URI. The zzz parser on the host is identified by the port number.  </p>
<div id="#rfc.figure.3"></div>
<pre>
          
    Client                                             CoAP/ZZZ
      |                                                  node 
      |  REQUEST                                           |
      |-------- CON [0x5577] PUT /.well-known/ZZZ --------&gt;|
      |             binary 12 octet string                 |
      |                                                    |
      |  RESPONSE                                          |
      |&lt;---------- ACK [0x5577] 2.00 OK  ----------------- |
      |                                                    |
          
        </pre>
<p></p>
<p id="rfc.section.5.1.p.6">An example of an invocation of a DALI legacy node behind a gateway is given.  Assume the resource path /.well-known/DALI where the port number identifies the DALI node.  The application sets a value of 200 in the DALI node in the attribute 256 defined by the DALI spec.  </p>
<div id="#rfc.figure.4"></div>
<pre>
          
    Client                                             DALI/CoAP
      |                                                 gateway 
      |  REQUEST                                           |
      |------- CON [0x5577] PUT /.well-known/DALI --------&gt;|
      | binary 16 bit payload dt*256 + 200                 |
      |                                                    |
      |  RESPONSE                                          |
      |&lt;---------- ACK [0x5577] 2.00 OK  ----------------- |
      |                                                    |
          
        </pre>
<p></p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#sect-5.2" id="sect-5.2">Gateways to legacy networks</a>
</h1>
<p id="rfc.section.5.2.p.1">Two types of gateways are considered; (1) coap gateway to a single legacy link, called yyy/coap gateway, and (2) coap gateway to legacy network, called xxx/coap gateway.  The source encapsulates the data with the corresponding representation inside a CoAP message and sends these messages to the gateway.  In the gateway the XXX/YYY data is removed from the CoAP message and transported to the desired node.  Returning an answer to the invoking host needs to be done in two different ways dependent on the addressing type of the XXX/YYY standard.  The IP-node-identifier (INI) can be (1) the IP-address, (2) the IP-address, port number, (3) the URI, or (4) the path .  </p>
<p id="rfc.section.5.2.p.2">It is assumed that the gateway conforms to the core standard at the internet interfaces. Consequently, all resources are visible at /.well-known/core by invoking a GET. These entries can be entered into DNS-SD with a commissioning tools as proposed in section 5.3; according to the rules specified in section 4.  Filling in the address mapping tables is done in a similar way as done for other application level gateways (ALG).  </p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> <a href="#sect-5.3" id="sect-5.3">Commissioning CoAP devices</a>
</h1>
<p id="rfc.section.5.3.p.1">Commissioning means mapping a physical device identified by its location to an URI. Given that mapping of URI to IP address is done elsewhere (e.g. DNS), the mapping of location to IP address is done during commissioning with a commissioning tool.  The commissiong is done for a set of coap nodes interconnected by a wireless network.  The netwok can contain zero or more 6LR routers and zero or more 6LBR. The IP infrastructure (DNS, DHCP servers) is connected to the coap network via the 6LBR. Two cases are considerd for commissioning: (1) no 6LBR and no DNS server connected, and (2) a 6LBR connects to a DNS server.  </p>
<p id="rfc.section.5.3.p.2">When an architect has designed the building and described all light points, ventilators, heating- and cooling units, and sensors, it is necessary to provide identifiers for all these devices.  The triple Instance.ServiceType.Location, as proposed in DNS-SD, is used to describe the commssioning process.  The identifiers of the devices often reflect their action domain which is linked to their physical location. The authority can be equated to the Location identifier.  The Location uniquely identifies the device.  The Instance is the unique identifier given to the device in the factory but which has no relation to its later function. The ServiceType together with the Location fully determine the semantics of the data returned by the device.  Commissioning is the process of mapping the Location to Instance for all installed hosts. The mapping is stored in a discovery repository such that applications can communicate with the required devices.  </p>
<p id="rfc.section.5.3.p.3">Design decision: A commissioning tool with access to the network is used for the commissioning phase.  </p>
<p id="rfc.section.5.3.p.4">For example, dependent on used technology and production process, the following situation (state) exists in a host after physical installation of the devices: </p>
<p id="rfc.section.5.3.p.5">Consider the commissioning process (1) with a central DNS-SD server and (2) without a central server using mDNS.  </p>
<h1 id="rfc.section.5.3.1">
<a href="#rfc.section.5.3.1">5.3.1.</a> <a href="#sect-5.3.1" id="sect-5.3.1">DNS-SD server present</a>
</h1>
<p id="rfc.section.5.3.1.p.1">The names with the corresponding authority prefixes can be grouped by the tool and appropriate group names can be assigned. The names stored in the tool are inserted into the DNS-SD server, respecting all DNS rules with respect to domain naming, and authority structure. Assuming that the authority syntax corresponds with the structure of the building, the installer can select on a screen the subset of names belonging to the building part he wants to commission.  The installer reads with a bar code reader, attached to the tool, the identifier of the device to commission. The installer selects, on the screen of the tool, the physical location of the chosen device. The tool knows the authority of the selected device.  The tool informs the DNS-SD server that the read barcode belongs to the selected authority. This is done for all devices within a given part of the building. Once this manual commissioning part is done the nodes conclude the commissioning process: </p>
<p id="rfc.section.5.3.1.p.2">After the commissioning process, all resources of each node have an URI and IP address which are stored in the central DNS-SD server.  When nodes are restarted, the DHCP server allocates IP addresses to the node and updates the DNS server </p>
<h1 id="rfc.section.5.3.2">
<a href="#rfc.section.5.3.2">5.3.2.</a> <a href="#sect-5.3.2" id="sect-5.3.2">DNS-SD server not present</a>
</h1>
<p id="rfc.section.5.3.2.p.1">It is assumed that the building network is composed of independent network segments (possibly a single link) such that each node on a given segment can communicate directly with any other node on this segment. The segments are not connected to a 6LBR and have no access to DNS or other servers.  The installer knows these segments and has a list of devices for a given segment.  In the tool the installer selects the names which belong to the given building segment.  The selected names are converted to link-local authorities and stored in the tool.  All nodes are assumed to have selected a link-local IP address. Assume that every device has a unique barcode within the building and that the corresponding node knows the bar code number.  The installer reads with a bar code reader, attached to the tool, the identifier of the device to commission. The installer selects, on the screen of the tool, the physical location of the chosen device. The tool knows the authority of the selected device.  The tool broadcasts the bar code number and authority to all connected nodes.  The node with the given barcode number, extends the authority with the path name of the resources.  For each resource, the node multicasts the link-local IP-address and the link-local URI to the mDNS servers in the connected nodes. This concludes the commissioning of a network segment.  All resources of each node have a link-local URI and a link-local IP address which are stored in the mDNS servers.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#conclusions" id="conclusions">Conclusions</a>
</h1>
<p id="rfc.section.6.p.1">This I-D explains how naming in building control is based on a hierarchical structure of the building areas. It is shown that DNS subdomain delegation and naming can be used to express this hierarchy in the authority portion of the URI, down to the group or node level.  The hierarchical naming scheme need not be standardized, but rather can be designed to suit the application.  However, it is recommended that the scheme be employed consistently throughout the delegated subdomain(s).  </p>
<p id="rfc.section.6.p.2">The authority portion of the URI is resolved by the client, using conventional DNS, into the unicast or multicast IP address of the targeted node(s).  Taking advantage of the CoAP design <a href="#I-D.ietf-core-coap">[I-D.ietf-core-coap]</a>, the Uri-Host option need not be transmitted in requests to origin servers and thus there is no performance penalty for using descriptive naming schemes.  The coap design allows sending a short url to distinguish between resources on a given node, resulting in very compact identifiers.  </p>
<p id="rfc.section.6.p.3">DNS-SD <a href="#I-D.cheshire-dnsext-dns-sd">[I-D.cheshire-dnsext-dns-sd]</a> can be used to scale up service discovery beyond the local link.  DNS-SD can be used to enumerate instances of a given service type within a given sub-domain.  This affords additional flexibility, such as the ability to discover dynamic port assignments for coap node, locate coap nodes by subtype, or bind service names for particular coap URIs.  </p>
<p id="rfc.section.6.p.4">A targeted resource is specified by the path portion of the URI.  Again, this I-D does not mandate a universal naming standard for resources but uses examples to show how resources could be named for various legacy standards. An obvious requirement for resources that are accessed by multicast is that they MUST all share the same path.  It is shown that it is possible to transport legacy commands (e.g. expressed in BACnet, LON, DALI, ZigBee, etc.) inside a CoAP message body. This necessitates the definition of an additional IANA mime code, and the mapping of legacy specific discovery semantics to CoAP resource discovery messages or DNS-SD lookups.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#sec" id="sec">Security considerations</a>
</h1>
<p id="rfc.section.7.p.1">TBD: The detailed CoAP security analysis needs to encompass scenarios for building control applications.  </p>
<p id="rfc.section.7.p.2">Based on the programming model presented in this I-D, security scenarios for building control need to be stated. Appropriate methods to counteract the proposed threats may be based on the work done elsewhere, for example in the ZigBee over IP context.  </p>
<p id="rfc.section.7.p.3">Multicast messages are, by their nature, transmitted via UDP.  Any privacy applied to such messages must be block oriented and based on group keys shared by all targeted nodes.  The CoRE security analysis must be broadened to include multicast scenarios.  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#iana" id="iana">IANA considerations</a>
</h1>
<p id="rfc.section.8.p.1">This I-D proposes that associations which standardize device representations (like BACnet, ZigBee, DALI,...) contact IANA to reserve the prefix /.well-known/XXX for the standard XXX.  </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#ack" id="ack">Acknowledgements</a>
</h1>
<p id="rfc.section.9.p.1">This I-D has benefited from conversations with and comments from Andrew Tokmakoff, Emmanuel Frimout, Jamie Mc Cormack, Oscar Garcia, Dee Denteneer, Joop Talstra, Zach Shelby, Jerald Martocci, Anders Brandt, Matthieu Vial, Jerome Hamel, George Yianni, and Nicolas Riou.  </p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#change" id="change">Changelog</a>
</h1>
<p id="rfc.section.10.p.1">From bc-01 to bc-02 </p>
<p id="rfc.section.10.p.2">- Removed all references to multicast and multicast scope, given draft of rahman group communication.  </p>
<p id="rfc.section.10.p.3">- Adapted examples to coap-2 and core-link drafts.  </p>
<p id="rfc.section.10.p.4">- transport short URL for destination recognition.  </p>
<p id="rfc.section.10.p.5">- Elaborated legacy discovery under DNS-SD.  </p>
<p></p>
<p id="rfc.section.10.p.7">From bc-02 to bc-03 </p>
<p id="rfc.section.10.p.8">- Elaboration on gateways, commissioning and legacy networks.  - Recommendation to extend DNS-SD naming with sn, st, and ss attributes.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC1034">[RFC1034]</b></td>
<td class="top">
<a title="Information Sciences Institute (ISI)">Mockapetris, P.</a>, "<a href="http://tools.ietf.org/html/rfc1034">Domain names - concepts and facilities</a>", STD 13, RFC 1034, November 1987.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1123">[RFC1123]</b></td>
<td class="top">
<a href="mailto:Braden@ISI.EDU" title="University of Southern California (USC), Information Sciences Institute">Braden, R.</a>, "<a href="http://tools.ietf.org/html/rfc1123">Requirements for Internet Hosts - Application and Support</a>", STD 3, RFC 1123, October 1989.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2616">[RFC2616]</b></td>
<td class="top">
<a href="mailto:fielding@ics.uci.edu" title="Department of Information and Computer Science">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="World Wide Web Consortium">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="World Wide Web Consortium">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a> and <a href="mailto:timbl@w3.org" title="World Wide Web Consortium">T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2782">[RFC2782]</b></td>
<td class="top">
<a href="mailto:arnt@troll.no" title="Troll Tech">Gulbrandsen, A.</a>, <a title="Internet Software Consortium">Vixie, P.</a> and <a href="mailto:levone@microsoft.com" title="Microsoft Corporation">L. Esibov</a>, "<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>", RFC 2782, February 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3306">[RFC3306]</b></td>
<td class="top">
<a>Haberman, B.</a> and <a>D. Thaler</a>, "<a href="http://tools.ietf.org/html/rfc3306">Unicast-Prefix-based IPv6 Multicast Addresses</a>", RFC 3306, August 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3307">[RFC3307]</b></td>
<td class="top">
<a>Haberman, B.</a>, "<a href="http://tools.ietf.org/html/rfc3307">Allocation Guidelines for IPv6 Multicast Addresses</a>", RFC 3307, August 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3596">[RFC3596]</b></td>
<td class="top">
<a>Thomson, S.</a>, <a>Huitema, C.</a>, <a>Ksinant, V.</a> and <a>M. Souissi</a>, "<a href="http://tools.ietf.org/html/rfc3596">DNS Extensions to Support IP Version 6</a>", RFC 3596, October 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3629">[RFC3629]</b></td>
<td class="top">
<a>Yergeau, F.</a>, "<a href="http://tools.ietf.org/html/rfc3629">UTF-8, a transformation format of ISO 10646</a>", STD 63, RFC 3629, November 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3956">[RFC3956]</b></td>
<td class="top">
<a>Savola, P.</a> and <a>B. Haberman</a>, "<a href="http://tools.ietf.org/html/rfc3956">Embedding the Rendezvous Point (RP) Address in an IPv6 Multicast Address</a>", RFC 3956, November 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3986">[RFC3986]</b></td>
<td class="top">
<a href="mailto:timbl@w3.org" title="World Wide Web Consortium">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com" title="Day Software">Fielding, R.</a> and <a href="mailto:LMM@acm.org" title="Adobe Systems Incorporated">L. Masinter</a>, "<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>", STD 66, RFC 3986, January 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4944">[RFC4944]</b></td>
<td class="top">
<a>Montenegro, G.</a>, <a>Kushalnagar, N.</a>, <a>Hui, J.</a> and <a>D. Culler</a>, "<a href="http://tools.ietf.org/html/rfc4944">Transmission of IPv6 Packets over IEEE 802.15.4 Networks</a>", RFC 4944, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5198">[RFC5198]</b></td>
<td class="top">
<a>Klensin, J.</a> and <a>M. Padlipsky</a>, "<a href="http://tools.ietf.org/html/rfc5198">Unicode Format for Network Interchange</a>", RFC 5198, March 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5785">[RFC5785]</b></td>
<td class="top">
<a>Nottingham, M.</a> and <a>E. Hammer-Lahav</a>, "<a href="http://tools.ietf.org/html/rfc5785">Defining Well-Known Uniform Resource Identifiers (URIs)</a>", RFC 5785, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5790">[RFC5790]</b></td>
<td class="top">
<a>Liu, H.</a>, <a>Cao, W.</a> and <a>H. Asaeda</a>, "<a href="http://tools.ietf.org/html/rfc5790">Lightweight Internet Group Management Protocol Version 3 (IGMPv3) and Multicast Listener Discovery Version 2 (MLDv2) Protocols</a>", RFC 5790, February 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.cheshire-dnsext-dns-sd">[I-D.cheshire-dnsext-dns-sd]</b></td>
<td class="top">
<a>Cheshire, S</a> and <a>M Krochmal</a>, "<a href="http://tools.ietf.org/html/draft-cheshire-dnsext-dns-sd-10">DNS-Based Service Discovery</a>", Internet-Draft draft-cheshire-dnsext-dns-sd-10, February 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.cheshire-dnsext-multicastdns">[I-D.cheshire-dnsext-multicastdns]</b></td>
<td class="top">
<a>Cheshire, S</a> and <a>M Krochmal</a>, "<a href="http://tools.ietf.org/html/draft-cheshire-dnsext-multicastdns-14">Multicast DNS</a>", Internet-Draft draft-cheshire-dnsext-multicastdns-14, February 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-core-coap">[I-D.ietf-core-coap]</b></td>
<td class="top">
<a>Shelby, Z</a>, <a>Hartke, K</a>, <a>Bormann, C</a> and <a>B Frank</a>, "<a href="http://tools.ietf.org/html/draft-ietf-core-coap-08">Constrained Application Protocol (CoAP)</a>", Internet-Draft draft-ietf-core-coap-08, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-core-link-format">[I-D.ietf-core-link-format]</b></td>
<td class="top">
<a>Shelby, Z</a>, "<a href="http://tools.ietf.org/html/draft-ietf-core-link-format-09">CoRE Link Format</a>", Internet-Draft draft-ietf-core-link-format-09, November 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.martocci-6lowapp-building-applications">[I-D.martocci-6lowapp-building-applications]</b></td>
<td class="top">
<a>Martocci, J</a>, <a>Schoofs, A</a> and <a>P Stok</a>, "<a href="http://tools.ietf.org/html/draft-martocci-6lowapp-building-applications-01">Commercial Building Applications Requirements</a>", Internet-Draft draft-martocci-6lowapp-building-applications-01, July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.rahman-core-groupcomm">[I-D.rahman-core-groupcomm]</b></td>
<td class="top">
<a>Rahman, A</a> and <a>E Dijk</a>, "<a href="http://tools.ietf.org/html/draft-rahman-core-groupcomm-07">Group Communication for CoAP</a>", Internet-Draft draft-rahman-core-groupcomm-07, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="BACnet">[BACnet]</b></td>
<td class="top">
<a>Bender, J.</a> and <a>M. Newman</a>, "<a>BACnet/IP</a>", Web http://www.bacnet.org/Tutorial/BACnetIP/index.html, .</td>
</tr>
<tr>
<td class="reference"><b id="ZigBee">[ZigBee]</b></td>
<td class="top">
<a>Tolle, G.</a>, "<a href="http://tools.ietf.org/html/draft-tolle-cap-00">A UDP/IP Adaptation of the ZigBee Application Protocol</a>", Internet-Draft draft-tolle-cap-00, October 2008.</td>
</tr>
<tr>
<td class="reference"><b id="LON">[LON]</b></td>
<td class="top">
<a>LONTalk protocol specification, version 3</a>", 1994.</td>, "</tr>
<tr>
<td class="reference"><b id="DALI">[DALI]</b></td>
<td class="top">
<a>DALI Manual</a>", Web http://www.dali-ag.org/c/manual_gb.pdf, 2001.</td>, "</tr>
<tr>
<td class="reference"><b id="KNX">[KNX]</b></td>
<td class="top">
<a>Kastner, W.</a>, <a>Neugschwandtner, G.</a> and <a>M. Koegler</a>, "<a>AN OPEN APPROACH TO EIB/KNX SOFTWARE DEVELOPMENT</a>", Web http://www.auto.tuwien.ac.at/~gneugsch/fet05-openapproach-preprint.pdf, 2005.</td>
</tr>
<tr>
<td class="reference"><b id="IEEE.802.15.4">[IEEE.802.15.4]</b></td>
<td class="top">
<a>Information technology - Telecommunications and information exchange between systems - Local and metropolitan area networks - Specific requirements - Part 15.4: Wireless Medium Access Control (MAC) and Physical Layer (PHY) Specifications for Low Rate Wireless Personal Area Networks (LR-WPANs) </a>", IEEE Std 802.15.4-2006, June 2006.</td>, "</tr>
<tr>
<td class="reference"><b id="oBIX">[oBIX]</b></td>
<td class="top">
<a>oBIX working group</a>", Web http://www.obix.org, 2003.</td>, "</tr>
<tr>
<td class="reference"><b id="Fielding">[Fielding]</b></td>
<td class="top">
<a>Fielding, R.</a>, "<a>Architectural Styles and the Design of Network-based Software Architectures, Second Edition</a>", Doctoral dissertation , University of California, Irvine , Web http://www.ics.uci.edu/~fielding/pubs/dissertation/top.html, 2000.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Peter van der Stok</span> 
	  <span class="n hidden">
		<span class="family-name">van der Stok</span>
	  </span>
	</span>
	<span class="org vcardline">Philips Research</span>
	<span class="adr">
	  <span>High Tech Campus</span>

	  <span class="vcardline">
		<span class="locality">Eindhoven</span>,  
		<span class="region"></span>
		<span class="code">5656 AA</span>
	  </span>
	  <span class="country-name vcardline">The Netherlands</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:peter.van.der.stok@philips.com">peter.van.der.stok@philips.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Kerry Lynn</span> 
	  <span class="n hidden">
		<span class="family-name">Lynn</span>
	  </span>
	</span>
	<span class="org vcardline">Consultant </span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">Phone: +1 978 460 4253 </span>

<span class="vcardline">EMail: <a href="mailto:kerlyn@ieee.org%20">kerlyn@ieee.org </a></span>

  </address>
</div>

</body>
</html>