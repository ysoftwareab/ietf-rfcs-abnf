<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>EAP Extensions for EAP Early Authentication Protocol (EEP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="EAP Extensions for EAP Early Authentication Protocol (EEP)">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">H. Wang, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Y. Shi, Ed.</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Hangzhou H3C Tech. Co., Ltd.</td></tr>
<tr><td class="header">Expires: April 21, 2011</td><td class="header">T. Tsou</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Huawei Technologies</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 18, 2010</td></tr>
</table></td></tr></table>
<h1><br />EAP Extensions for EAP Early Authentication Protocol (EEP)<br />draft-hao-hokey-eep-00</h1>

<h3>Abstract</h3>

<p>
                                The Extensible Authentication Protocol (EAP)
                                is a generic framework supporting multiple types of authentication methods.
                                <br />
<br />

                                Based on the EAP Early Authentication Model defined by RFC5836,
                                this document specifies the extensions of EAP to support both intra-AAA-realm
                                and inter-AAA-realm handover.
                        
</p>
<h3>Status of This Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on April 21, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.</a>&nbsp;
Standards Language<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.2.</a>&nbsp;
Acronyms<br />
<a href="#intra-interFlow">3.</a>&nbsp;
Message Flow of EAP Early Authentication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intraFlow">3.1.</a>&nbsp;
Intra-AAA-Realm Handover<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#interFlow">3.2.</a>&nbsp;
Inter-AAA-Realm Handovers<br />
<a href="#problem">4.</a>&nbsp;
Problem Statement<br />
<a href="#solution">5.</a>&nbsp;
Solution<br />
<a href="#anchor5">6.</a>&nbsp;
Assumptions<br />
<a href="#anchor6">7.</a>&nbsp;
Protocol Message Flow<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">7.1.</a>&nbsp;
Intra-AAA-Realm Handovers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">7.2.</a>&nbsp;
Inter-AAA-Realm Handovers(Full trust relationship)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">7.3.</a>&nbsp;
Inter-AAA-Realm Handovers(Semi trust relationship)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">7.4.</a>&nbsp;
Release authentication session<br />
<a href="#anchor11">8.</a>&nbsp;
EEP Key Hierarchy<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">8.1.</a>&nbsp;
Key Derivation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">8.1.1.</a>&nbsp;
pRK Derivation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">8.1.2.</a>&nbsp;
pIK Derivation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">8.1.3.</a>&nbsp;
pMSK Derivation<br />
<a href="#anchor16">9.</a>&nbsp;
Packet and TLV Extension<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">9.1.</a>&nbsp;
EAP Initiate/Re-auth-Start Packet Extension<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">9.2.</a>&nbsp;
EAP Initiate/Pre-Early-auth<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">9.3.</a>&nbsp;
EAP Finish/Pre-Early-auth<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">9.4.</a>&nbsp;
EAP Initiate/Post-Early-auth<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">9.5.</a>&nbsp;
EAP Finish/Post-Early-auth<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#EIRaPE">9.6.</a>&nbsp;
EAP Initiate/Early-auth Action<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">9.7.</a>&nbsp;
EAP Finish/Early-auth Action<br />
<a href="#anchor23">10.</a>&nbsp;
Lower Layer Considerations<br />
<a href="#AAA">11.</a>&nbsp;
AAA Transport Considerations<br />
<a href="#anchor24">12.</a>&nbsp;
Security Considerations<br />
<a href="#anchor25">13.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor26">14.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">15.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">15.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">15.2.</a>&nbsp;
Informative References<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
                                The Extensible Authentication Protocol (EAP) <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a>
                                is a generic framework supporting multiple types of authentication methods.  
                                In systems where EAP is used for authentication, the handover process often requires 
                                authentication and authorization for acquisition or modification of resources assigned 
                                to the mobile device. In most cases, these authentications and authorizations
                                require interaction with a central authority in a realm. In some cases, 
                                the central authority may be distant from the mobile device.                                 
                                The delay introduced due to such an authentication and authorization                         
                                procedure adds to the handover latency and consequently affects ongoing application sessions.  
                                <br />
<br />

                                In the problem statement <a class='info' href='#RFC5836'>[RFC5836]<span> (</span><span class='info'>Ohba, Y., Wu, Q., and G. Zorn, &ldquo;Extensible Authentication Protocol (EAP) Early Authentication Problem Statement,&rdquo; April&nbsp;2010.</span><span>)</span></a>, it suggests that optimized solutions for
                                secure inter-authenticator handovers can be seen either as security context transfer (e.g., using the EAP
                                Extensions for EAP Re-authentication Protocol (ERP)) [RFC5296], or as EAP Early Authentication.
                                <br />
<br />

                                This document specifies EAP Extensions for Early Authentication Model.
                                The protocol that uses these extensions itself is referred to as the EAP Early Authentication
                                Protocol (EEP). A peer does EAP method-independent Early Authentication
                                before it attaches to a CAP. The protocol and the key hierarchy
                                required for EAP Early Authentication are described in this document.
                                <br />
<br />

                                Note that to support EEP, lower-layer specifications may need to be
                                revised to allow carrying EAP messages that have a code value more
                                than 4 and to accommodate the peer-initiated nature of EEP.
                                Specifically, the IEEE802.1x specification must be revised and RFC
                                4306 must be updated to carry EEP messages.
                        
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Standards Language</h3>

<p>
                                        The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
                                        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
                                        document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119]
                                
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Acronyms</h3>

<p>
                                        The following acronyms are used in this document;
                                        see the references for more details.
                                        </p>
<blockquote class="text"><dl>
<dt>AAA</dt>
<dd>
                                                        Authentication, Authorization and Accounting <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>
                                                
</dd>
<dt>CAP</dt>
<dd>
                                                        Candidate Attachment Point <a class='info' href='#RFC5836'>[RFC5836]<span> (</span><span class='info'>Ohba, Y., Wu, Q., and G. Zorn, &ldquo;Extensible Authentication Protocol (EAP) Early Authentication Problem Statement,&rdquo; April&nbsp;2010.</span><span>)</span></a>
                                                
</dd>
<dt>MH</dt>
<dd>
                                                        Mobile Host
                                                
</dd>
<dt>SAP</dt>
<dd>
                                                        Serving Attachment Point <a class='info' href='#RFC5836'>[RFC5836]<span> (</span><span class='info'>Ohba, Y., Wu, Q., and G. Zorn, &ldquo;Extensible Authentication Protocol (EAP) Early Authentication Problem Statement,&rdquo; April&nbsp;2010.</span><span>)</span></a>
                                                
</dd>
</dl></blockquote><p>
                                
</p>
<a name="intra-interFlow"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Message Flow of EAP Early Authentication</h3>

<p>
                                Based on the functional elements of EAP Early Authentication <a class='info' href='#RFC5836'>[RFC5836]<span> (</span><span class='info'>Ohba, Y., Wu, Q., and G. Zorn, &ldquo;Extensible Authentication Protocol (EAP) Early Authentication Problem Statement,&rdquo; April&nbsp;2010.</span><span>)</span></a>,
                                the following sections introduce the general message flow of Inter-AAA-Realm
                                and Intra-AAA-Realm handovers. The figures below are to give an overview of EAP Early Authentication.
                        
</p>
<p>
                                It is assumed that the MH has previously completed full EAP
                                authentication with Home AAA.
                        
</p>
<a name="intraFlow"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Intra-AAA-Realm Handover</h3>

<p>
                                        In intra-AAA-realm handover scenario, SAP and CAP belong to a same AAA realm.
                                        <br />
<br />

<br /><hr class="insert" />
<a name="intraFigure"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
+------+    +-----+   +-------+    +--------+
|  MH  |    | SAP |   |  CAP  |    |Home AAA|
+--+---+    +--+--+   +---+---+    +----+---+
   |           |          |             |
   |       Early  Authentication        |
   |&lt;---------&gt;|&lt;---------|------------&gt;|
   |           |          |             |
   |           |          |             |
   |    Attach to the CAP |             |
   |-----------|---------&gt;|------------&gt;|
   |           |          |             |
   |           |          |    pMSK     |
   |           |          |&lt;------------|
   |           |          |             |
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Intra-AAA-Realm Handover&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

                                        Before MH (peer) performs handover from SAP to CAP, it does early authentication with Home AAA.
                                        <br />
<br />

                                        Since SAP and CAP belong to the same Home AAA, the complete EAP method exchange is not 
                                        required in early authentication.
                                        The MH informs Home AAA of the NAS-id of CAPs and each CAP's sequence number.
                                        Home AAA will derive the pMSK from EMSK and sequence number.
                                        Sequence number must be unique for each CAP to derive a unique pMSK.
                                        <br />
<br />

                                        After handover, MH attaches to the CAP. MH request to change from early authenticated state 
                                        to fully authorized and authenticated state. Its Home AAA is not changed.
                                        And then Home AAA distribute the pMSK to CAP. 
                                
</p>
<a name="interFlow"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Inter-AAA-Realm Handovers</h3>

<p>
                                  In inter-AAA-realm scenario, as the first step, 
                                  Home AAA and CAP-AAA need to establish a trust relationship.
                                
</p>
<p>
                                  There are two cases for this step. 
                                
</p>
<p>
                                  In first case, Home AAA and CAP-AAA belong to a same operator.
                                  In this case, a full trust relationship may be established. That means 
                                  security context transfer between AAA servers is permitted. 
                                
</p>
<p>     
<br /><hr class="insert" />
<a name="interFigure1"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
+------+    +-----+    +-------+   +--------+  +-----+  +-------+
|  MH  |    | SAP |    |SAP-AAA|   |Home AAA|  | CAP |  |CAP-AAA|
+--+---+    +--+--+    +---+---+   +----+---+  +--+--+  +---+---+
   |           |           |            |         |         |
   |           |           |Establish Trust Relationship Between AAAs
   |           |           |            |&lt;--------|--------&gt;|
   |           |           |            |         |         |
   |         Early  Authentication     Early  Authentication|
   |&lt;---------&gt;|&lt;---------&gt;|&lt;----------&gt;|&lt;--------|--------&gt;|
   |           |           |            |         |         |
   |           |           |            |  DSRK, EMSK Name  |
   |           |           |            |&lt;--------|--------&gt;|
   |           |           |            |         |         |
   |           |   Attach to the CAP    |         |         |
   |-----------|-----------|------------|--------&gt;|--------&gt;|
   |           |           |            |         |         |
   |           |           |            |         |   pMSK  |
   |           |           |            |         |&lt;--------|
   |           |           |            |         |         |
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Inter-AAA-Realm Handovers(Full trust relationship)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

                                          <br />
<br />

                                          Before MH (peer) performs handover from SAP to CAP, it does early authentication with CAP-AAA,
                                          and messages will be forwarded by SAP, SAP-AAA and Home AAA to CAP-AAA.
                                          <br />
<br />

                                          Since Home AAA and CAP-AAA belong to the same operator,
                                          the complete EAP method exchange is not required in early authentication. 
                                          The CAP-AAA will get DSRK and EMSK Name from Home AAA and derive pMSK from DSRK directly.
                                          <br />
<br />

                                          After handover, MH attaches to the CAP. Its Home AAA is not changed and
                                          CAP-AAA becomes the new local AAA server(SAP-AAA).
                                  
</p>
<p>
                                          In second case, Home AAA and CAP-AAA belong to different operators.
                                          In this case, a semi trust relationship may be established.
                                          That means two AAA servers can recognize each other based on domain name and communicate each other.
                                          But the security context transfer is not permitted. 
                                  
</p>
<p>
<br /><hr class="insert" />
<a name="interFigure2"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
+------+    +-----+    +-------+   +--------+  +-----+  +-------+
|  MH  |    | SAP |    |SAP-AAA|   |Home AAA|  | CAP |  |CAP-AAA|
+--+---+    +--+--+    +---+---+   +----+---+  +--+--+  +---+---+
   |           |           |            |         |         |
   |           |           |Establish Trust Relationship Between AAAs
   |           |           |            |&lt;--------|--------&gt;|
   |           |           |            |         |         |
   |         Early  Authentication      Early Authentication|
   |&lt;---------&gt;|&lt;---------&gt;|&lt;----------&gt;|&lt;--------|--------&gt;|
   |           |           |            |         |         |
   |           |        EAP Method Exchange       |         |
   |&lt;----------|-----------|------------|---------|--------&gt;|
   |           |           |            |         |         |
   |           |        Attach to the CAP         |         |
   |-----------|-----------|------------|--------&gt;|--------&gt;|
   |           |           |            |         |         |
   |           |           |            |         |   pMSK  |
   |           |           |            |         |&lt;--------|
   |           |           |            |         |         |
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Inter-AAA-Realm Handovers(Semi trust relationship)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
 
                                        Since Home AAA and CAP-AAA belong to the different operators,
                                        usually, a complete EAP method exchange will be done in early authentication.
                                        MSK and EMSK will be derived in full EAP authentication.
                                        CAP-AAA will use the MSK as the pMSK.
                                        <br />
<br />

                                        After handover, MH attaches to the CAP,
                                        its Home AAA is changed and CAP-AAA acts as a new Home AAA.
                                
</p>
<a name="problem"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Problem Statement</h3>

<p>
                                According to the general message flow of Intra-AAA-Realm and Inter-AAA-Realm handovers,
                                the following problems need to be resolved for Early Authentication Model.
                                </p>
<blockquote class="text"><dl>
<dt>1) How to establish a trust relationship between Home AAA and CAP-AAA?</dt>
<dd>
                                <br />
 
                                It is an important issue but the solution is out of the scope of this document.
                                
</dd>
<dt>2) How does MH knows whether a complete EAP method exchange is required?</dt>
<dd>
                                <br />

                                A method is required for MH to negotiate this issue with CAP-AAA when it request to start
                                the early authentication.
                                
</dd>
<dt>3) How does MH get CAP's status and capability information in advance?</dt>
<dd>
                                <br />
 
                                CAPs are discovered through EAP Lower layer. But early authentication is done through EAP layer.
                                MH needs to know whether the discovered CAPs can be early authenticated through Home AAA or not.
                                If MH can't get such knowledge before the early authentication, it is evident that the handover 
                                experience will be inefficient.
                                
</dd>
<dt>4) How to forward the EEP message between MH and CAP-AAA?</dt>
<dd>
                                <br />
 
                                Unlike normal EAP authentication, The SAP-AAA and Home AAA should forward 
                                EAP early authentication packets to CAP-AAA instead of processing them locally.
                                So the SAP-AAA and Home AAA should know the domain name of CAP-AAA and when the early authentication
                                is started.
                                
</dd>
<dt>5) How to handle the frequent MH handover?</dt>
<dd>
                                <br />
 
                                AAA server needs to maintain early authentication sessions, while frequent MH handover may lead to 
                                redundant obsolete early authentication sessions on AAA servers.
                                A mechanism is required to settle this situation.
                                
</dd>
<dt>6) How to ensure the information consistent between MH and CAP-AAA?</dt>
<dd>
                                <br />
 
                                It is a high possibility of information inconsistency between MH and CAP-AAA. 
                                For example, after handover, MH starts to use pMSK for EAP lower layer key derivation. 
                                But the early authentication session on CAP-AAA has just been expired without notifying MH.
                                
</dd>
</dl></blockquote><p>
                            
</p>
<a name="solution"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Solution</h3>

<p>
                    Similiar to ERP protocol, a trigger message is required by SAP to infom MH of its capability
                    to support early authentication. To avoid redundant trigger message, 
                    EAP Initiate/Re-auth-Start <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>
                    is reused and one E flag is added to indicate whether EEP is supported.
                  
</p>
<p>
                    EAP Codes 5(EAP Initiate) and 6(EAP Finish) defined in the protocol of 
                    ERP <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> is reused.
                        
</p>
<p>
                          New EAP Initiate/Pre-early-auth and EAP Finish/Pre-early-auth messages are defined to 
                          start the early authentication and negotiate whether full EAP authentication is required.
                        
</p>
<p>
                          New EAP Initiate/Post-early-auth and EAP Finish/Post-early-auth messages are defined to
                          confirm the early authentication information and change the state from early authenticated to
                          fully authorized and authenticated.
                        
</p>
<p>
                          Early auth action message is defined for below functionality.
                        
</p>
<p>
                          - Probe whether the early authentication is supported for sepecified CAP.
                        
</p>
<p>
                          - Release the early authentication session to avoid redudant resource assumption.
                        
</p>
<p>
                          - Request to change from fully authenticated state to early authenticated state.
                        
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Assumptions</h3>

<p>
                                For the solution, it is assumed that:
                        
</p>
<p>
                                - The trust relationship has been established between Home AAA server and CAP-AAA server.
                        
</p>
<p>
                                - EEP server has co-located with the AAA server.
                        
</p>
<p>
                                - The authenticator act as a pass-through entity for early authentication
                                protocol in a manner similar to that of an EAP authenticator described in RFC3748.
                        
</p>
<p>
                                - The entity which support EEP can also support ERP <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>. So MH can
                                use ERP message to obtain the local domain name.
                        
</p>
<p>
                          - MH has fully authenticated with Home AAA before handover.
                        
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Protocol Message Flow</h3>

<p>
                                  Based on the  <a class='info' href='#intra-interFlow'>Section&nbsp;3<span> (</span><span class='info'>Message Flow of EAP Early Authentication</span><span>)</span></a> and <a class='info' href='#solution'>Section&nbsp;5<span> (</span><span class='info'>Solution</span><span>)</span></a>,
                          the below figures show the protocol message flow of EEP protocol.
                          
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Intra-AAA-Realm Handovers</h3>

<p>
<br /><hr class="insert" />
<a name="eepIntra"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
+---+            +-----+              +-----+         +---------+
|MH |            | SAP |              | CAP |         |Home AAA |
+-+-+            +--+--+              +--+--+         +----+----+
  |                 |                    |                 |
1.| EAP Initiate/   |                    |                 |
  | Pre-Early-auth  |    AAA(EAP Initiate/Pre-Early-auth)  |
  |----------------&gt;|--------------------|----------------&gt;|
  |                 |                    |                 |
  |                 |                    |                 |
2.|   EAP Finish/   |                    |                 |
  | Pre-Early-auth  |    AAA(EAP Finish/Pre-Early-auth)    |
  |&lt;----------------|&lt;-------------------|-----------------|
  |                 |                    |                 |
3.|                 |                    | AAA(EAP Init/   |
  |  EAP Initiate/Post-Early-auth        | Post-Early-auth)|
  |-----------------|-------------------&gt;|----------------&gt;|
  |                 |                    |                 |
  |                 |                    |          |--------------|
  |                 |                    |          |CA Authorized |
  |                 |                    |          |      &amp;       |
  |                 |                    |          |Authenticated;|
  |                 |                    |          |    Keying    |
  |                 |                    |          |   material   |
  |                 |                    |          |    derived   |
  |                 |                    |          |--------------|
  |                 |                    |                 |
  |                 |                    |    AAA(pMSK)    |
  |                 |                    |&lt;----------------|
  |                 |                    |                 |
4.|                 |                    | AAA(EAP Finish/ |
  |  EAP Finish/Post-Early-auth          | Post-Early-auth)|
  |&lt;----------------|--------------------|&lt;----------------|
  |                 |                    |                 |

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Intra-AAA-Realm Handovers&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

                  </p>
<blockquote class="text"><dl>
<dt>1) MH request to start the early authentication</dt>
<dd>
                                                   <br />
 
                                                   MH starts the early authentication using EAP Initiate/Pre-Early-auth message. In Pre-Early-auth
                                                   message, the NAS-id of CAP and sequence number is included.
                                                   EAP Initiate/Pre-Early-auth is protected by pIK for middle man attack.
                                                  
</dd>
<dt>2) Home AAA respond with early authentication result</dt>
<dd>
                     <br />
 
                     When Home AAA receive the request from MH, it verify the availability of CAP's NAS-id.
                     And check whether EEP is supported by this CAP. 
                     Home AAA respond with early authentication result using EAP Finish/Pre-Early-auth message.
                     pMSK will be derived from EMSK and sequence number and will be kept in early authentication session.
                                                  
</dd>
<dt>3) MH request to change its state</dt>
<dd>
                     <br />
 
                     After handover, MH request to change its state from early authenticated state to fully authorized
                     and authenticated state.
                     In EAP Initiate/Post-Early-auth message, the NAS-id of CAP and EMSK name is included.
                                                  
</dd>
<dt>4) Home AAA confirm the state change</dt>
<dd>
                     <br />
 
                     Home AAA confirm the NAS-id and key name, and then respond with state changing result 
                     using EAP Finish/Post-Early-auth message.
                     Home AAA distribute the pMSK to the CAP.
                                                  
</dd>
</dl></blockquote><p>
                                        
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Inter-AAA-Realm Handovers(Full trust relationship)</h3>

<p>
                       It is assumed that SAP-AAA act as the Home AAA server.
<br /><hr class="insert" />
<a name="eepInter1"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
+---+            +-----+           +-------+  +-----+     +-------+
|MH |            | SAP |           |SAP-AAA|  | CAP |     |CAP-AAA|
+-+-+            +--+--+           +---+---+  +--+--+     +---+---+
  |                 |                  |         |            |
1.| EAP Initiate/   | AAA(EAP Initiate/|  AAA(EAP Initiate/   |
  | Pre-Early-auth  | Pre-Early-auth)  |  Pre-Early-auth)     |
  |----------------&gt;|-----------------&gt;|---------------------&gt;|
  |                 |                  |         |            |
2.|                 |                  |  AAA(DSRK Request)   |
  |                 |                  |&lt;---------------------|
  |                 |                  |         |            |
  |                 |                  |AAA(DSRK, EMSK Name)  |
  |                 |                  |---------------------&gt;|
  |                 |                  |         |            |
3.|   EAP Finish/   |   AAA(EAP Finish/|  AAA(EAP Finish/     |
  | Pre-Early-auth  |   Pre-Early-auth)|  Pre-Early-auth)     |
  |&lt;----------------|&lt;-----------------|&lt;---------------------|
  |                 |                  |         |            |
4.|                 |                  |      AAA(EAP Init/   |
  |   EAP Initiate/Post-Early-auth     |     Post-Early-auth) |
  |-----------------|------------------|--------&gt;|-----------&gt;|
  |                 |                  |         |            |
  |                 |                  |         | |--------------|
  |                 |                  |         | |CA Authorized |
  |                 |                  |         | |      &amp;       |
  |                 |                  |         | |Authenticated;|
  |                 |                  |         | |    Keying    |
  |                 |                  |         | |   material   |
  |                 |                  |         | |    derived   |
  |                 |                  |         | |--------------|
  |                 |                  |         |            |
  |                 |                  |         | AAA(pMSK)  |
  |                 |                  |         |&lt;-----------|
  |                 |                  |         |            |
5.|                 |                  |       AAA(EAP Finish/|
  |   EAP Finish/Post-Early-auth       |      Post-Early-auth)|
  |&lt;----------------|------------------|---------|&lt;-----------|
  |                 |                  |         |            |

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: Intra-AAA-Realm Handovers(Full trust relationship)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

                  </p>
<blockquote class="text"><dl>
<dt>1) MH request to start the early authentication</dt>
<dd>
                                                   <br />
 
                                                   MH starts the early authentication using EAP Initiate/Pre-Early-auth message. In Pre-Early-auth
                                                   message, the NAS-id-NAI of CAP and sequence number is included.
                                                   Based on the realm part of NAS-id-NAI, the SAP-AAA will forward the Pre-Early-auth message to the 
                                                   corresponding CAP-AAA. 
                                                   if the CAP-AAA can not be found or trust relationship has not been established, 
                                                   SAP-AAA will directly reject the early authentication request.
                                                  
</dd>
<dt>2) CAP-AAA request DSRK and EMSK Name from SAP-AAA</dt>
<dd>
                     <br />
 
                     After receiving the ealy authentication request, CAP-AAA find that the full trust relationship has
                     been established between SAP-AAA and CAP-AAA.
                     So CAP-AAA request DSRK and EMSK name from SAP-AAA(Home AAA).
                                                  
</dd>
<dt>3) CAP-AAA respond with early authentication result</dt>
<dd>
                     <br />
 
                     Home AAA respond with early authentication result using EAP Finish/Pre-Early-auth message.
                     pMSK will be derived from DSRK and sequence number and will be kept in early authentication entry.
                                                  
</dd>
<dt>4) MH request to change its state</dt>
<dd>
                     <br />
 
                     After handover, MH request to change its state from early authenticated state to fully authorized
                     and authenticated state.
                                                  
</dd>
<dt>5) Home AAA confirm the state change</dt>
<dd>
                     <br />
 
                     Home AAA respond with state changing result using EAP Finish/Post-Early-auth message.
                     Home AAA distribute the pMSK to the CAP.
                                                  
</dd>
</dl></blockquote><p>
          
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Inter-AAA-Realm Handovers(Semi trust relationship)</h3>

<p>
            It is assumed that SAP-AAA act as the Home AAA server.
<br /><hr class="insert" />
<a name="eepInter2"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>

+---+             +-----+              +-------+ +-----+    +-------+
|MH |             | SAP |              |SAP-AAA| | CAP |    |CAP-AAA|
+-+-+             +--+--+              +---+---+ +--+--+    +---+---+
  |                  |                     |        |           |
1.|   EAP Initiate/  |   AAA(EAP Initiate/ |  AAA(EAP Initiate/ |
  |  Pre-Early-auth  |    Pre-Early-auth)  |   Pre-Early-auth)  |
  |-----------------&gt;|--------------------&gt;|-------------------&gt;|
  |                  |                     |        |           |
2.|   EAP Finish/    |   AAA(EAP Finish/   |   AAA(EAP Finish/  |
  |  Pre-Early-auth  |   Pre-Early-auth)   |   Pre-Early-auth)  |
  |&lt;-----------------|&lt;--------------------|&lt;-------------------|
  |                  |                     |        |           |
3.|EAP Authentication|            AAA(EAP Authentication)       |
  |&lt;----------------&gt;|&lt;-------------------&gt;|&lt;------------------&gt;|
  |                  |                     |        |           |
4.|                  |                     |    AAA(EAP Init/   |
  |   EAP Initiate/Post-Early-auth         |    Post-Early-auth)|
  |------------------|---------------------|-------&gt;|----------&gt;|
  |                  |                     |        |           |
  |                  |                     |        | |-------------|
  |                  |                     |        | |CA Authorized|
  |                  |                     |        | |      &amp;      |
  |                  |                     |        | |Authenticated|
  |                  |                     |        | |    Keying   |
  |                  |                     |        | |   material  |
  |                  |                     |        | |    derived  |
  |                  |                     |        | |-------------|
  |                  |                     |        |           |
  |                  |                     |        | AAA(pMSK) |
  |                  |                     |        |&lt;----------|
  |                  |                     |        |           |
5.|                  |                     |     AAA(EAP Finish/|
  |   EAP Finish/Post-Early-auth           |    Post-Early-auth)|
  |&lt;-----------------|---------------------|--------|&lt;----------|
  |                  |                     |        |           |

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: Inter-AAA-Realm Handovers(Semi trust relationship)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

                    </p>
<blockquote class="text"><dl>
<dt>1) MH request to start the early authentication</dt>
<dd>
                                                           <br />
 
                                                           MH starts the early authentication using EAP Initiate/Pre-Early-auth message. In Pre-Early-auth
                                                     message, the NAS-id-NAI of CAP and sequence number is included.
                                                     Based on the realm part of NAS-id-NAI, the SAP-AAA will forward the Pre-Early-auth message to the 
                                                     corresponding CAP-AAA. 
                                                     if the CAP-AAA can not be found or trust relationship has not been established, 
                                                     SAP-AAA will directly reject the early authentication request.
                                                          
</dd>
<dt>2) CAP-AAA respond with early authentication result</dt>
<dd>
                             <br />
 
                             After receiving the ealy authentication request, CAP-AAA find that the semi trust relationship has
                       been established between SAP-AAA and CAP-AAA.
                             Home AAA respond with early authentication result using EAP Finish/Pre-Early-auth message.
                             And in the message, Home AAA inform MH that full EAP authentication is required.
                                                          
</dd>
<dt>3) MH do full EAP authentication with CAP-AAA</dt>
<dd>
                             <br />
 
                             MH do eap authentication with CAP-AAA with full authentication method exchange.
                             SAP-AAA will forward the EAP authentication message to CAP-AAA and reponse message to MH.
                                                          
</dd>
<dt>4) MH request to change its state</dt>
<dd>
                             <br />
 
                             After handover, MH request to change its state from early authenticated state to fully authorized
                       and authenticated state.
                                                          
</dd>
<dt>5) Home AAA confirm the state change</dt>
<dd>
                             <br />
 
                             Home AAA respond with state changing result using EAP Finish/Post-Early-auth message.
                       Home AAA distribute the pMSK to the CAP.
                                                          
</dd>
</dl></blockquote><p>
                                                
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
Release authentication session</h3>

<p>
<br /><hr class="insert" />
<a name="eepRoam"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>

+---+             +-----+              +-------+ +-----+    +-------+
|MH |             | SAP |              |SAP-AAA| | CAP2|    |CAP-AAA|
+-+-+             +--+--+              +---+---+ +--+--+    +---+---+
  |                  |                     |        |           |
1.|   EAP Initiate/  |  AAA(EAP Initiate/  |  AAA(EAP Initiate/ |
  |Early-auth Action/| Early-auth Action/  | Early-auth Action/ |
  |    De-Pre-auth   |    De-Pre-auth      |     De-Pre-auth    |
  |-----------------&gt;|--------------------&gt;|-------------------&gt;|
  |                  |                     |        |           |
2.|   EAP Initiate/  |  AAA(EAP Initiate/  |        |           |
  |Early-auth Action/| Early-auth Action/  |        |           |
  |   De-Post-auth   |    De-Post-auth     |        |           |
  |-----------------&gt;|--------------------&gt;|        |           |
  |                  |                     |        |           |
3.|                  |                     |    AAA(EAP Init/   |
  |   EAP Initiate/Post-Early-auth         |    Post-Early-auth)|
  |------------------|---------------------|-------&gt;|----------&gt;|
  |                  |                     |        |           |
  |                  |                     |        | |-------------|
  |                  |                     |        | |CA Authorized|
  |                  |                     |        | |      &amp;      |
  |                  |                     |        | |Authenticated|
  |                  |                     |        | |    Keying   |
  |                  |                     |        | |   material  |
  |                  |                     |        | |    derived  |
  |                  |                     |        | |-------------|
  |                  |                     |        |           |
  |                  |                     |        | AAA(pMSK) |
  |                  |                     |        |&lt;----------|
  |                  |                     |        |           |
4.|                  |                     |     AAA(EAP Finish/|
  |   EAP Finish/Post-Early-auth           |    Post-Early-auth)|
  |&lt;-----------------|---------------------|--------|&lt;----------|
  |                  |                     |        |           |

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

                    </p>
<blockquote class="text"><dl>
<dt>1) MH release the early authentication session with CAP1</dt>
<dd>
                                                           <br />
 
                                                           MH sends EAP Initiate/Early-auth Action/De-Pre-auth to inform CAP-AAA release early authentication
                                                           session for CAP1.
                                                          
</dd>
<dt>2) MH release the full authentication session with SAP</dt>
<dd>
                             <br />
 
                             MH sends EAP Initiate/Early-auth Action/De-Post-auth to inform SAP-AAA to change its state from
                             full authorized and authenticated state to early authenticated state.
                                                          
</dd>
<dt>3) MH request to change its state</dt>
<dd>
                             <br />
 
                             After handover, MH request to change its state from early authenticated state to fully authorized
                       and authenticated state.
                                                          
</dd>
<dt>4) Home AAA confirm the state change</dt>
<dd>
                             <br />
 
                             Home AAA respond with state changing result using EAP Finish/Post-Early-auth message.
                       Home AAA distribute the pMSK to the CAP2.
                                                          
</dd>
</dl></blockquote><p>
                                                
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
EEP Key Hierarchy</h3>

<p>
                              EEP uses key hierarchy similar to that of ERP <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>.
                                                The EMSK is used to derive the EEP pre-established Root Key (pRK).
                                                Similarly, the EEP pre-established Integrity Key (pIK) and 
                                                the pre-established Master Session Key (pMSK) is derived from the pRK.
                                                The pMSK is established for the CAP(s) when the peer early authenticates to the network.
                                                The pIK is established for the peer to do post early authentication after handover.
                                                The hierarchy relationship is illustrated in <a class='info' href='#KH1'>Figure&nbsp;8</a>, below.

<br /><hr class="insert" />
<a name="KH1"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
 (inter-AAA-realm) (intra-AAA-realm)
        DSRK            EMSK
         |               |
 +-------+-------+-------+-------+
 |               |               |
pRK             rRK             ...
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


                                                The EMSK and DSRK both can be used to derive the pRK. In general, the
                                                pRK is derived from the EMSK in case of the peer moving in the Home AAA
                                                realm and derived from the DRSK in case of the peer moving in the
                                                visited AAA realm.
                                                The DSRK is delivered from the EAP server to the EEP
                                                server as specified in  <a class='info' href='#I-D.ietf-dime-local-keytran'>[I&#8209;D.ietf&#8209;dime&#8209;local&#8209;keytran]<span> (</span><span class='info'>Zorn, G., Wu, W., and V. Cakulev, &ldquo;Diameter Attribute-Value Pairs for Cryptographic Key Transport,&rdquo; October&nbsp;2010.</span><span>)</span></a>.
                                                if the peer has previously authenticated by means of EEP, the DSRK SHOULD be
                                                directly re-used.

<br /><hr class="insert" />
<a name="KH2"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
            pRK
             |
 +-----------+-----------+
 |           |           |
pIK         pMSK        ...
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;9&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


                                                The pRK is used to derive the pIK and pMSK for the CAP(s). Different
                                                sequence numbers for each CAP MUST be used to derive the unique
                                                pMSK(s).
                
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Key Derivation</h3>

<p>
                                As specified in <a class='info' href='#I-D.ietf-hokey-erp-aak'>[I&#8209;D.ietf&#8209;hokey&#8209;erp&#8209;aak]<span> (</span><span class='info'>Cao, Z., Deng, H., Wang, Y., Wu, W., and G. Zorn, &ldquo;EAP Re-authentication Protocol Extensions for Authenticated Anticipatory Keying (ERP/AAK),&rdquo; May&nbsp;2010.</span><span>)</span></a>, the key derivation method is given below.
                        
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.1"></a><h3>8.1.1.&nbsp;
pRK Derivation</h3>

<p>
                                        pRK = KDF (K, S), where K = EMSK or DSRK and S = pRK Label | "\0" | length
                                
</p>
<p>
                                        The pRK Label is an IANA-assigned 8-bit ASCII string:
                                
</p>
<p>
                                        EAP Early authentication Root Key@ietf.org
                                
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.2"></a><h3>8.1.2.&nbsp;
pIK Derivation</h3>

<p>
                                        pIK = KDF (K, S), where K = pRK and S = pIK Label | "\0" | cryptosuite | length
                                
</p>
<p>
                                        The pIK Label is the 8-bit ASCII string:
                                
</p>
<p>
                                        Early authentication Integrity Key@ietf.org
                                
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.3"></a><h3>8.1.3.&nbsp;
pMSK Derivation</h3>

<p>
                                        pMSK = KDF (K, S), where K = pRK and S = pMSK label | "\0" | SEQ | length
                                
</p>
<p>
                                        The pMSK label is the 8-bit ASCII string:
                                
</p>
<p>
                                        Early authentication Master Session Key@ietf.org
                                
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Packet and TLV Extension</h3>

<p>
                                EEP reuse EAP Codes 5(EAP Initiate) and 6(EAP Finish) defined in the protocol of ERP <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>.
                                The packet format for these messages follows the EAP packet format defined in RFC 3748.
                        
</p><br /><hr class="insert" />
<a name="eepFormat"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Code     |   Identifier  |             Length            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Type     |   Type-Data ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;10: EAP Packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Code
</p>
<p>5  Initiate 
</p>
<p>6  Finish
</p>
<p>
              Identifier
      
</p>
<p>
              Refer to <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> Section 5.3
      
</p>
<p>Type
</p>
<p>This field indicates that this is an EEP exchange. 
      Three new Type values are defined for the purpose of early
      authentication. 
</p>
<p>3  Pre-Early-auth 
</p>
<p>4  Post-Early-auth 
</p>
<p>5  Early-auth Action 
</p>
<p>Type-Data
</p>
<p>The Type-Data field varies with the Type of early authentication packet.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
EAP Initiate/Re-auth-Start Packet Extension</h3>

<p>
                              One E flag bit is added in EAP Initiate/Re-auth-Start message.
                      
</p><br /><hr class="insert" />
<a name="eFlag"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |E| Reserved    |     1 or more TVs or TLVs     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;11: EAP Initiate/Re-auth-Start Packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
                              Code = 5(EAP Initiate)
                      
</p>
<p>
                              Identifier
                      
</p>
<p>
                              Refer to <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> Section 5.3
                      
</p>
<p>
                              Type = 1(Re-auth-Start)
                      
</p>
<p>
                              Flags
                      
</p>
<p>
                              'E' - The E flag is used to indicate whether EEP is supported or not.
                              If E Bit is set to 1, it indicate that EEP is supported by the authenticator 
                              and the MH can start the early authentication.
                              If E Bit is set to 0, MH can not start early authentication using EEP.
                      
</p>
<p>
                              Reserved: MUST be set to 0.
                      
</p>
<p>
                              TVs or TLVs: refer to ERP <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>.
                      
</p>
<p>
                              To avoid redundant trigger message at the beginning, 
                              No new early authentication start message is defined.
                      
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
EAP Initiate/Pre-Early-auth</h3>
<br /><hr class="insert" />
<a name="eepInitPre"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code    |   Identifier  |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type    |R|S|A|C|Reserved|           SEQ                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    1 or more TVs or TLVs                    ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Cryptosuite |            Authentication Tag                 ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;12: EAP Initiate/Pre-Early-auth Packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Code = 5(EAP Initiate)
</p>
<p>
                                     Identifier
                                  
</p>
<p>
                                     Refer to <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> Section 5.3
                                  
</p>
<p>Type = 3(Pre-Early-auth)
</p>
<p>
                                Flags
                        
</p>
<p>
                                'R' - The value of result flag MUST be zero and ignored on reception.
                        
</p>
<p> 
                                'S' - The value of secure flag indicate whether cryptosuite and authentication tag is appended.
                  
</p>
<p>
                                      0 Cryptosuite and Authentication Tag are not appended.
                                    
</p>
<p>
                                      1 Cryptosuite and Authentication Tag are appended at the end of message.
                              
</p>
<p>
                                      When the EAP Initiate/Early-auth action message is transferred 
                                      between SAP-AAA and Home-AAA, S Bit = 0.
                        
</p>
<p>
                                'A' - Authentication flag:
                  
</p>
<p>
                                      0 MH do not request to do full EAP authentication.
                                    
</p>
<p>
                                      1 MH request to do full EAP authentication.
                        
</p>
<p>
                                'C' - Continue flag:
                        
</p>
<p>
                                      0 This is a normal Pre-Early-auth message.
                                     
</p>
<p>
                                      1 This message is used to extend the lifetime of Pre-Early-auth session.
                        
</p>
<p>
                                SEQ
                        
</p>
<p>
                                A 16-bit sequence number is used for replay protection.
                        
</p>
<p>     
                                TVs and TLVs
                        
</p>
<p>
                                      NAS-Identifier: This is a TLV payload, type is 4. 
                                      Exactly one NAS-Identifier or NAS-Identifier-NAI TLV SHOULD be included 
                                      in the EAP Initiate/Pre-Early-auth message. 
                              
</p>
<p>
                                      NAS-Identifier-NAI: This is a TLV payload, type is TBD. 
                                      Exactly one NAS-Identifier or NAS-Identifier-NAI TLV SHOULD be included in 
                                      the EAP Initiate/Pre-Early-auth message.  
                              
</p>
<p>
                                      List of cryptosuites: This is a TLV payload, type is 5. 
                                      Exactly one List of cryptosuites TLV SHOULD be included in 
                                      the EAP Initiate/Pre-Early-auth message.
                              
</p>
<p>
                                      KeyName-NAI: This is a TLV payload. Type = 1. 
                                      When the S Bit is set to 1, exactly one KeyName-NAI attribute SHOULD be present 
                                      in an EAP Initiate/Pre-Early-auth packet.
                              
</p>
<p>
                                      Sequence Number: It is carried in a TV payload.  
                                      The Type is TBD  (which is lower than 128). When the C flag is set to 1, 
                                      exactly one sequence number SHOULD be present in an EAP Initiate/Pre-Early-auth packet.
                              
</p>
<p>
                                      Cryptosuite: This field indicates the integrity algorithm and the
                                      PRF used for EEP. Key lengths and output lengths are either
                                      indicated or obvious from the cryptosuite name.
                              
</p>
<p>We specify some cryptosuites below:
</p>
<p>*  0 RESERVED
</p>
<p>*  1 HMAC-SHA256-64
</p>
<p>*  2 HMAC-SHA256-128
</p>
<p>*  3 HMAC-SHA256-256
</p>
<p>
              HMAC-SHA256-128 is mandatory to implement and should be enabled in
              the default configuration.
            
</p>
<p>
                                      Authentication Tag: This field contains the integrity checksum 
                                      over the EEP packet, excluding the authentication tag field 
                                      itself.  The length of the field is indicated by the Cryptosuite.
                              
</p>
<p>
                                      Authentication Tag is calculated using pIK derived from EMSK
                                      or DS-pIK derived from DSRK.
                              
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3"></a><h3>9.3.&nbsp;
EAP Finish/Pre-Early-auth</h3>
<br /><hr class="insert" />
<a name="eepFinishPre"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Code     |   Identifier  |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Type     |R|S|A|C|Reserved|           SEQ                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                   1 or more TVs or TLVs                     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Cryptosuite |            Authentication Tag                 ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;13: EAP Finish/Pre-Early-auth Packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Code = 6(EAP Finish)
</p>
<p>
                                   Identifier
                                
</p>
<p>
                                   Refer to <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> Section 5.3
                                
</p>
<p>Type = 3(Pre-Early-auth)
</p>
<p>
                         Flags
                
</p>
<p>
                         'R' - Result flag, value 0 Indicate success, 1 Indicate failure.
                
</p>
<p> 
                         'S' - The value of secure flag indicate whether cryptosuite and authentication tag is appended.
                
</p>
<p>
                                     0 Cryptosuite and Authentication Tag are not appended.
                                  
</p>
<p>
                                     1 Cryptosuite and Authentication Tag are appended at the end of message.
                            
</p>
<p>
                         'A' - Authentication flag, value:
                
</p>
<p>
                                     0 Full EAP authentication is not required.
                                  
</p>
<p>
                                     1 Full EAP authentication is required.
                            
</p>
<p>
                                     If MH set A flag to 1 in EAP Initiate/Pre-Early-auth message, the 
                                     AAA server either rejects the early authentication or set A flag
                                     to 1 in EAP Finish/Pre-Early-auth message.
                
</p>
<p>
                         'C' - Continue flag:
                
</p>
<p>
                                     0 This is a normal Pre-Early-auth message.
                                  
</p>
<p>
                                     1 This message is used to extend the lifetime of Pre-Early-auth session.
                
</p>
<p>
                        SEQ
                
</p>
<p>
                        A 16-bit sequence number is used for replay protection.
                
</p>
<p>     
                        TVs and TLVs
                
</p>
<p>
                                    pMSK Lifetime: This is a TV payload.  
                                    The value field is a 32-bit field and contains the lifetime of pMSK generated in 
                                    early authentication.
</p><br /><hr class="insert" />
<a name="pmskLife"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>

0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Type     |                pMSK Lifetime                  ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;14: pMSK Lifetime&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Type = TBD
</p>
<p>
                                    The life time is calculated after the pMSK has been generated. 
                                    That is to say, if full authentication is require, the life 
                                    time is started after EAP authentication. If the pMSK life time expired, the MH should do 
                                    Pre-Early-auth again and Post-Early-auth will be rejected.
                            
</p>
<p>
                                    pRK Lifetime: This is a TV payload.  
                                    The value field is a 32-bit field and contains the lifetime of pRK generated in 
                                    early authentication.
                            
</p><br /><hr class="insert" />
<a name="FinishPacket22"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Type     |                 pRK Lifetime                  ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;15: pRK Lifetime&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Type = TBD
</p>
<p>
                                    Result Code: When R flag is set to 1, this TV payload MAY be included in EAP Finish/Pre-Early-auth message.
                            
</p>
<p>
                                List of cryptosuites: This is a TLV payload, type is 5. Exactly one List of cryptosuites TLV 
                                SHOULD be included in the EAP Finish/Pre-Early-auth message. It will help MH to select proper 
                                crypto suite to do key verification in Post-Early-auth phase.
                            
</p>
<p>
                                    KeyName-NAI: This is a TLV payload. Type = 1. 
                                    When the S flag is set to 1, exactly one KeyName-NAI attribute SHOULD be present in an 
                                EAP Finish/Pre-Early-auth packet.
                            
</p>
<p>
                        Cryptosuite: This field indicates the integrity algorithm and the
                                    PRF used for EEP.  Key lengths and output lengths are either
                                    indicated or are obvious from the Cryptosuite name.
                            
</p>
<p>
                                    Authentication Tag: This field contains the integrity checksum 
                                    over the EEP packet, excluding the authentication tag field 
                                    itself.  The length of the field is indicated by the Cryptosuite.
                            
</p>
<p>
                                    Authentication Tag is calculated using pIK derived from EMSK
                                    or DS-pIK derived from DSRK.
                            
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.4"></a><h3>9.4.&nbsp;
EAP Initiate/Post-Early-auth</h3>
<br /><hr class="insert" />
<a name="eepInitPost"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Code      |   Identifier  |             Length            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Type      |R|S|A|Reserved |             SEQ               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    1 or more TVs or TLVs                    ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Cryptosuite |             Authentication Tag                ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;16: EAP Initiate/Post-Early-auth Packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Code = 5(EAP Initiate)
</p>
<p>
                                   Identifier
                          
</p>
<p>
                                   Refer to <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> Section 5.3
                                
</p>
<p>Type = 4(Post-Early-auth)
</p>
<p>
                        Flags
                
</p>
<p>
                        'R' - Result flag, Value MUST be zero and ignored on reception.
                
</p>
<p>
                        'S' - Secure flag, value MUST be 1 and Cryptosuite and Authentication Tag must be appended at the end 
                              of message.
                
</p>
<p>
                        'A' - Authentication flag, value MUST Be 0 and full EAP authentication is not required.
                      
</p>
<p>
                        SEQ
                
</p>
<p>
                        A 16-bit sequence number is used for replay protection.
                
</p>
<p>     
                        TVs and TLVs
                
</p>
<p>
                        NAS-Identifier: This is a TLV payload, type is 4. 
                        Exactly one NAS-Identifier or NAS-Identifier-NAI TLV SHOULD be included in 
                        the EAP Initiate/Post-Early-auth message. 
                      
</p>
<p>
                              NAS-Identifier-NAI: This is a TLV payload, type is TBD. 
                              Exactly one NAS-Identifier or NAS-Identifier-NAI TLV SHOULD be included in 
                              the EAP Initiate/Post-Early-auth message. 
                      
</p>
<p>
                              KeyName-NAI: This is a TLV payload. Type = 1. 
                              Exactly one KeyName-NAI attribute MUST be present in an EAP Finish/Post-Early-auth packet.
                      
</p>
<p>
                        Cryptosuite: This field indicates the integrity algorithm and the
                              PRF used for EEP. Key lengths and output lengths are either
                              indicated or are obvious from the Cryptosuite name.
                      
</p>
<p>
                              Authentication Tag: This field contains the integrity checksum 
                              over the EEP packet, excluding the authentication tag field 
                              itself.  The length of the field is indicated by the Cryptosuite.
                      
</p>
<p>
                              Authentication Tag is calculated using pIK derived from EMSK
                              or DS-pIK derived from DSRK.
                      
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.5"></a><h3>9.5.&nbsp;
EAP Finish/Post-Early-auth</h3>
<br /><hr class="insert" />
<a name="eepFinishPost"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Code      |   Identifier  |             Length            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Type      |R|S|A|Reserved |             SEQ               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    1 or more TVs or TLVs                    ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Cryptosuite |             Authentication Tag                ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;17: EAP Finish/Post-Early-auth Packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Code = 6(EAP Finish)
</p>
<p>
                                   Identifier
                          
</p>
<p>
                       Refer to <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> Section 5.3
                                
</p>
<p>Type =       4(Post-Early-auth)
</p>
<p>
                        Flags
                
</p>
<p>
                  'R' - Result flag, value 0 Indicate success, 1 Indicate failure.
          
</p>
<p> 
                  'S' - The value of secure flag indicate whether cryptosuite and authentication tag is appended.
          
</p>
<p>
                              0 Cryptosuite and Authentication Tag are not appended.
                            
</p>
<p>
                              1 Cryptosuite and Authentication Tag are appended at the end of message.
                      
</p>
<p>
                  'A' - Authentication flag, value:
          
</p>
<p>
                              0 Full EAP authentication is not required.
                            
</p>
<p>
                              1 Full EAP authentication is required.
                      
</p>
<p>
                              If MH set A flag to 1 in EAP Initiate/Pre-Early-auth message, the 
                              AAA server either rejects the early authentication or set A flag
                              to 1 in EAP Finish/Pre-Early-auth message.
          
</p>
<p>
                        SEQ
                
</p>
<p>
                        A 16-bit sequence number is used for replay protection.
                
</p>
<p>     
                        TVs and TLVs
                
</p>
<p>
                        Result Code: When R flag is set to 1, this TV payload MAY be included in 
                        EAP Finish/Post-Early-auth message. 
                      
</p>
<p>
                              List of cryptosuites: This is a TLV payload, type is 5. If the Result Code is 2 
                              (crypto cipher suite is not supported). 
                              This TLV should be included in the EAP Finish/Post-Early-auth message. 
                      
</p>
<p>
                              KeyName-NAI: This is a TLV payload. Type = 1. If the Result Code is 3 (key is not found), 
                              the TLV should not be included in the EAP Finish/Post-Early-auth message and S Bit should be set to 0.
                              When the S flag is set to 1, exactly one KeyName-NAI attribute SHOULD be present in an 
                              EAP Finish/Post-Early-auth packet.
                      
</p>
<p>
                        Cryptosuite: This field indicates the integrity algorithm and the
                              PRF used for EEP.  Key lengths and output lengths are either
                              indicated or are obvious from the Cryptosuite name.
                      
</p>
<p>
                              Authentication Tag: This field contains the integrity checksum 
                              over the EEP packet, excluding the authentication tag field 
                              itself.  The length of the field is indicated by the Cryptosuite.
                      
</p>
<p>
                              Authentication Tag is calculated using pIK derived from EMSK
                              or DS-pIK derived from DSRK.
                      
</p>
<a name="EIRaPE"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.6"></a><h3>9.6.&nbsp;
EAP Initiate/Early-auth Action</h3>

<p>
                      The functionality of message EAP Initiate/Early-auth Action message is based on its sub type.
                                  The detailed information refers to the description of sub type field. 
                        
</p><br /><hr class="insert" />
<a name="resultBit"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code    |   Identifier  |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type    |R|S| Reserved  |            SEQ                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   SubType   |              1 or more TVs or TLVs            ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Cryptosuite |              Authentication Tag               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;18: EAP Initiate/Early-auth Action Packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
                                       Code = 5(EAP Initiate).
                                    
</p>
<p>
                                     Identifier
                                  
</p>
<p>
                                     Refer to <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> Section 5.3
                                  
</p>
<p>
                                     Type = 5(Early-auth Action).
                                  
</p>
<p>
                                Flags
                        
</p>
<p>
                                'R' - The value of result flag MUST be zero and ignored on reception.
                        
</p>
<p> 
                                'S' - The value of secure flag indicate whether cryptosuite and authentication tag is appended.
                  
</p>
<p>
                                      0 Cryptosuite and Authentication Tag are not appended.
                                    
</p>
<p>
                                      1 Cryptosuite and Authentication Tag are appended at the end of message.
                              
</p>
<p>
                                      When the EAP Initiate/Early-auth action message is transferred 
                                      between SAP-AAA and Home-AAA, S Bit = 0.
                        
</p>
<p>
                                SEQ
                        
</p>
<p>
                                A 16-bit sequence number is used for replay protection.
                        
</p>
<p>
                                Sub Type
                        
</p>
<p>
                                      1 Early authentication Probe message. The message is sent by MH to SAP to probe 
                                      whether the early authentication for specified CAP is supported.
                                    
</p>
<p>
                                      2 De-Pre-Early-auth message. The message is sent by MH to SAP to release the early authentication
                                      with specified CAP.
                                    
</p>
<p>
                                      To avoid obsolete early authentication session, MH may release its established early authentication
                                      session before it disconnecting from the network.
                                    
</p>
<p>
                                      3 De-Post-Early-auth message. The message is sent by MH to SAP to change the current fully authenticated
                                      state to early authenticated state.
                                    
</p>
<p>
                                      This message is used to adapt to the situation where MH keep moving between 2 AAA realms.
                        
</p>
<p>
                                TVs and TLVs
                        
</p>
<p>
                                      NAS-Identifier: As defined in <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>, it is carried in a TLV payload.  
                                      It is used to indicate the identifier of a CAP. One or more NAS-identifier MAY be included
                                      in EAP Initiate/Early-auth Action message sent by MH. The Local Domain is considered as 
                                      the AAA realm for this CAP.
                              
</p><br /><hr class="insert" />
<a name="nasId"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Type     |     Length    |       NAS-Identifier          ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;19: NAS-Identifier&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Type = 4 
</p>
<p>Length >= 1 
</p>
<p>NAS-Identifier-NAI:  
</p>
<p>
                                       The NAI is variable in length, not exceeding 253 octets.  
                                       The NAS-identifier is in the username part of the NAI.  
                                       The realm part of the NAI is the visited domain name. 
                                       One or more NAS-identifier-NAI MAY be included in EAP Initiate/Early-auth Action message sent by MH.
             
</p><br /><hr class="insert" />
<a name="nasId-nai"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Type     |     Length    |      NAS-Identifier-NAI       ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;20: NAS-Identifier-NAI&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Type = TBD
</p>
<p>Length >= 1
</p>
<p>KeyName-NAI: This is a TLV payload.  
                                       The NAI is variable in length, not exceeding 253 octets.  
                                       The EMSK name is in the username part of the NAI and is encoded in hexadecimal values.  
                                       The EMSK name is 64 bits in length and so the username portion takes up 128 octets. 
                                       The realm part of the NAI is the visited domain name. When the S Bit is set to 1, 
                                       exactly one KeyName-NAI attribute SHOULD be present in an EAP Initiate/Early-auth Action packet.
                              
</p><br /><hr class="insert" />
<a name="keyName"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Type     |     Length    |         KeyName-NAI           ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;21: KeyName-NAI&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Type = 1
</p>
<p>Length >= 1
</p>
<p>     
                                      The authenticator uses the realm in the KeyName-NAI field to 
                                      send the message to the appropriate EEP server.
                              
</p>
<p>
                          Cryptosuite: This field indicates the integrity algorithm and the
                                      PRF used for EEP.  Key lengths and output lengths are either
                                      indicated or are obvious from the Cryptosuite name.
                              
</p>
<p>
                                      Authentication Tag: This field contains the integrity checksum 
                                      over the EEP packet, excluding the authentication tag field 
                                      itself.  The length of the field is indicated by the Cryptosuite.
                              
</p>
<p>
                                      Authentication Tag is calculated using pIK derived from EMSK
                                      or DS-pIK derived from DSRK.
                              
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.7"></a><h3>9.7.&nbsp;
EAP Finish/Early-auth Action</h3>

<p>
                                      EAP Finish/Early-auth Action is sent by SAP-AAA through SAP to inform MH the action results.
                                      For De-Pre-Early-auth and De-Post-Early-auth, reply message is not required. 
                                      So corresponding sub type is not defined. 
                                    
</p><br /><hr class="insert" />
<a name="eepEarly"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code    |   Identifier  |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type    |R|S| Reserved  |            SEQ                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Sub Type   |          1 or more TVs or TLVs                ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Cryptosuite |            Authentication Tag                 ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;22: EAP Finish/Early-auth Action Packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Code = 5(EAP Initiate)
</p>
<p>
                                     Identifier
                                  
</p>
<p>
                                     Refer to <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> Section 5.3
                                  
</p>
<p>Type = 5(Early-auth Action)
</p>
<p>
                                Flags
                        
</p>
<p>
                                'R' - Result flag, value 0 Indicate success, 1 Indicate failure.
                        
</p>
<p> 
                                'S' - The value of secure flag indicate whether cryptosuite and authentication tag is appended.
                  
</p>
<p>
                                      0 Cryptosuite and Authentication Tag are not appended.
                                    
</p>
<p>
                                      1 Cryptosuite and Authentication Tag are appended at the end of message.
                              
</p>
<p>
                                SEQ
                        
</p>
<p>
                                A 16-bit sequence number is used for replay protection.
                        
</p>
<p>
                                Sub Type
                        
</p>
<p>
                                1 Early authentication Probe message.
                        
</p>
<p>     
                                TVs and TLVs
                        
</p>
<p>
                                      Result Code: When R Bit is set to 1, this TV payload MAY be 
                                      included in EAP Finish/Early-auth Action message.
</p><br /><hr class="insert" />
<a name="resultCode"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>

0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Type     |                 Result code                   ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;23: Result Code&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Type = TBD
</p>
<p>Result code
</p>
<p>0        Success
</p>
<p>1        Unspecified failure
</p>
<p>2        Cryptosuite is not supported
</p>
<p>3        Key is not found
</p>
<p>4  Fail to verify the authentication tag
</p>
<p>5~9      Reserved
</p>
<p>10       Early authentication is not supported
</p>
<p>11~20    Reserved
</p>
<p>21       Early authentication session is not found for this CAP
</p>
<p>
                                       Probe Result: This is TLV payload.  
                                       If the Result Code is 0 (success), The number of Probe Results in EAP Finish/Early-
                                       auth action message should be identical to the number of NAS-ids and NAS-id-NAIs in 
                                       EAP Initiate/Early-auth Action message.
                                    
</p><br /><hr class="insert" />
<a name="statusCode"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Type     |     Length    |      NAS-Id or NAS-Id-NAI     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Status Code |
+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;24: Probe Result&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Type = TBD
</p>
<p>Length >= 2
</p>
<p>Status Code:
</p>
<p>0  EEP is supported for this CAP
</p>
<p>1  EEP is not supported for this CAP
</p>
<p>
                     List of cryptosuites: This is a TLV payload. If the Result Code is 2, crypto cipher suite is not supported.
                     This TLV MAY be included in the EAP Finish/Early-auth Action message.
                  
</p>
<p>
                                       The value field contains a list of crypto suites, each of size 1 octet. The SAP-AAA include this attribute in the EAP 
                                       Finish/Early-auth Action message to signal to the MH about its cryptographic algorithm capabilities. 
                                       The Cryptosuite values are as specified:
                              
</p><br /><hr class="insert" />
<a name="cryptSuite"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
0                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type    |     Length    | crypto suite1 | crypto suite2 ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;25: List of cryptosuites&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Type = 5
</p>
<p>Length >= 1
</p>
<p>Crypto suite
</p>
<p>0  RESERVED
</p>
<p>1  HMAC-SHA256-64
</p>
<p>2  HMAC-SHA256-128 (Mandatory to implement and should be enabled in the default configuration)
</p>
<p>3  HMAC-SHA256-256 
</p>
<p>
                                      KeyName-NAI: This is a TLV payload.  Type = 1.  
                                      If the S flag is set to 1, exactly one KeyName-NAI TLV should be included in EAP Finish/Early-auth Action message.
                                      If R flag is set to 1 and the Result Code is 3 (key is not found), 
                                      the TLV should not be included in the EAP Finish/Early-auth Action message and S flag should be set to 0.
                              
</p>
<p>
                                Cryptosuite: This field indicates the integrity algorithm and the
                                      PRF used for EEP. Key lengths and output lengths are either
                                      indicated or are obvious from the Cryptosuite name.
                              
</p>
<p>
                                      Authentication Tag: This field contains the integrity checksum 
                                      over the EEP packet, excluding the authentication tag field 
                                      itself.  The length of the field is indicated by the Cryptosuite.
                              
</p>
<p>
                                      Authentication Tag is calculated using pIK derived from EMSK
                                      or DS-pIK derived from DSRK.
                              
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Lower Layer Considerations</h3>

<p>
                                Similar to ERP, some lower layer specifications may need to be revised
                                to support EEP; refer to section 6 of <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>
                                for additional guidance.
                        
</p>
<a name="AAA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
AAA Transport Considerations</h3>

<p>
                                AAA transport of EEP messages is the same as AAA transport of the ERP
                                message <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>. In addition, the document requires 
                                AAA transport of the EEP keying materials delivered by the EEP server to the CAP.
                                Hence, a new Diameter EEP application message should be specified to transport 
                                the keying materials.
                        
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Security Considerations</h3>

<p>
                                TBD.
                        
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
IANA Considerations</h3>

<p>
                        New TLV types:
                        </p>
<blockquote class="text">
<p>
                                NAS-Identifier
                        
</p>
<p>
                                Sequence number
                        
</p>
<p>
                                NAS-Identifier-NAI
                        
</p>
<p>
                                pMSK lifetime
                        
</p>
<p>
                                pRK lifetime
                        
</p>
<p>
                                Result code
                        
</p>
<p>
                                Probe result
                        
</p>
</blockquote><p>
        
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
Acknowledgements</h3>

<p>
                                Thanks to Qin Wu for guiding some technique solution and helpful comments on this document.
                        
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15"></a><h3>15.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>15.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5296">[RFC5296]</a></td>
<td class="author-text">Narayanan, V. and L. Dondeti, &ldquo;<a href="http://tools.ietf.org/html/rfc5296">EAP Extensions for EAP Re-authentication Protocol (ERP)</a>,&rdquo; RFC&nbsp;5296, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5296.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>15.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-dime-local-keytran">[I-D.ietf-dime-local-keytran]</a></td>
<td class="author-text">Zorn, G., Wu, W., and V. Cakulev, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-local-keytran-08.txt">Diameter Attribute-Value Pairs for Cryptographic Key Transport</a>,&rdquo; draft-ietf-dime-local-keytran-08 (work in progress), October&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-local-keytran-08.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-hokey-erp-aak">[I-D.ietf-hokey-erp-aak]</a></td>
<td class="author-text">Cao, Z., Deng, H., Wang, Y., Wu, W., and G. Zorn, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-hokey-erp-aak-02.txt">EAP Re-authentication Protocol Extensions for Authenticated Anticipatory Keying (ERP/AAK)</a>,&rdquo; draft-ietf-hokey-erp-aak-02 (work in progress), May&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-hokey-erp-aak-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3588">[RFC3588]</a></td>
<td class="author-text">Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>,&rdquo; RFC&nbsp;3588, September&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3588.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3748">[RFC3748]</a></td>
<td class="author-text">Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;<a href="http://tools.ietf.org/html/rfc3748">Extensible Authentication Protocol (EAP)</a>,&rdquo; RFC&nbsp;3748, June&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3748.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5836">[RFC5836]</a></td>
<td class="author-text">Ohba, Y., Wu, Q., and G. Zorn, &ldquo;<a href="http://tools.ietf.org/html/rfc5836">Extensible Authentication Protocol (EAP) Early Authentication Problem Statement</a>,&rdquo; RFC&nbsp;5836, April&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5836.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hao Wang (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hangzhou H3C Tech. Co., Ltd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">H3C, Digital Technology Plaza, Shangdi 9 Street, Haidian District</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China(100085)</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86 010 82774462</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:hwang@h3c.com">hwang@h3c.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Yang Shi (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hangzhou H3C Tech. Co., Ltd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">H3C, Digital Technology Plaza, Shangdi 9 Street, Haidian District</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China(100085)</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86 010 82775276</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:young@h3c.com">young@h3c.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tina Tsou</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">BHuawei Technologies,</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bantian, Longgang District</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Shenzhen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China(518129)</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:tena@huawei.com">tena@huawei.com</a></td></tr>
</table>
</body></html>
