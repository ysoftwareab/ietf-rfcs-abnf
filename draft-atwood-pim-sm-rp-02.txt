

PIM Working Group                                      J. William Atwood 
Internet-Draft                                          Ritesh Mukherjee 
Expires: December 27, 2002                Department of Computer Science 
                                                    Concordia University 
                                                           June 27, 2002 
 
 
 
                     RP Relocation in PIM-SM Multicast 
                       draft-atwood-pim-sm-rp-02.txt 
 
 
 
Status of this Memo 
 
 
   This document is an Internet-Draft and is in full conformance with 
   all provisions in Section 10 of RFC2026. 
    
   Internet-Drafts are working documents of the Internet Engineering 
   Task Force (IETF), its areas, and its working groups.  Note that      
   other groups may also distribute working documents as Internet-
   Drafts. 
    
   Internet-Drafts are draft documents valid for a maximum of six 
   months and may be updated, replaced, or obsoleted by other documents 
   at any time.  It is inappropriate to use Internet-Drafts as 
   reference material or to cite them other than as "work in progress." 
    
   The list of current Internet-Drafts can be accessed at 
        http://www.ietf.org/ietf/1id-abstracts.txt 
   The list of Internet-Draft Shadow Directories can be accessed at 
        http://www.ietf.org/shadow.html. 
    
   This Internet-Draft will expire on December 27, 2002. 
    
    
    
Abstract 
    
    
   The Protocol Independent Multicast-Sparse Mode (PIM-SM) protocol 
   uses a core-based tree to forward multicast datagrams to members of 
   a multicast group. Currently there is no method for relocating the 
   core or Rendezvous Point (RP) for a group. Administratively chosen 
   RP's lead to low performance as the sources and receivers in the 
   multicast group join and leave the group. 
    
    
   This draft presents a mechanism for dynamically relocating the RP to 
   a position that minimizes the tree cost and improves performance. 
    
    
    
 
Atwood/Mukherjee                                              [Page 1] 

                       RP relocation in PIM-SM              June 2002 

1. Introduction 
    
    
   The current method of choosing the RP for a multicast group is by 
   administratively selecting a position in the network depending upon 
   the expected source and receiver locations. However, with the 
   variety of today's high bandwidth applications being used, it is 
   impossible for an administrator to "guess" where the sources and 
   receivers are most likely to be [1].  
    
    
   To improve network performance, reduce tree costs and reduce delay, 
   it is necessary for the RP to be dependent on the sources and 
   receivers in the multicast group at any point in time. With sources 
   and receivers joining and leaving groups an RP has to be dynamically 
   relocated to maintain network efficiency and reduce delays. This 
   draft is an alternate proposal to the one made by Lin, et. al. [2]. 
    
    
    
2. Motivation and Objectives 
    
    
   Sparse mode PIM (PIM-SM) [3,4] uses a center specific tree 
   construction. The distribution center of PIM-SM is called a 
   Rendezvous Point (RP). PIM tree construction revolves around the 
   selection of the RP. All senders for the group must register with 
   the RP. Receivers requesting to join the group set up the path from 
   themselves to the RP. Thus the location of the RP decides the 
   efficiency of the multicast tree. From the user's point of view, 
   efficiency would mean minimizing end-to-end delay. The network would 
   prefer to minimize the tree cost and be able to reduce congestion. 
   The shared tree routed at the RP does not optimize the delivery path 
   through the network. If the RP is located far from the participants, 
   a longer packet delay is experienced and excessive resources are 
   consumed. If an RP is selected for a set of participants that later 
   changes drastically, the RP location will severely affect the 
   quality of the tree for new participants.  
    
    
   In each domain there is an elected BSR (Bootstrap Router) [5], which 
   collects candidate RP information and broadcasts it hop-by-hop to 
   all the routers. Routers that can act as RP's periodically unicast 
   Candidate-RP-advertisement messages (C-RP-Advs) which contain group 
   prefixes for which the candidacy is advertised to the BSR. The BSR 
   then includes a set of these Candidate-RPs (the RP-Set), along with 
   the corresponding group prefixes, in Bootstrap messages it 
   periodically originates. 
    
    
   PIM-SM has the ability to switch to source-specific trees for high 
   data rate sources. This increases the number of states to be stored 
   in the router from O(G) to O(S x G) where S is the number of sources 
   and G is the number of multicast groups. With a large number of 
 
Atwood/Mukherjee      Expires December 27, 2002              [Page 2] 

                       RP relocation in PIM-SM              June 2002 

   groups and sources this space requirement can become a limiting 
   factor. Thus dynamic relocation of the RP represents a more 
   attractive solution. For this the following two steps are necessary: 
    
    
   1. Determining if a better location exists for the RP for the     
      multicast group. 
    
    
   2. Relocating the RP to the new location without losing any data. 
    
    
   The entire path from the sender(s) to the receivers has two 
   components: an (inverse) tree from the sources to the RP, and the 
   shared distribution tree from the RP to the receivers. The optimal 
   location for the RP would be influenced by the entire set of 
   participants (senders and receivers). However, in the case of PIM-
   SM, the set of senders is known to the RP, but the set of receivers 
   is not. Also, given the way PIM-SM operates, it is likely that 
   locating the RP near the "center" of the set of senders will be more 
   useful than being concerned with the entire tree. We will call the 
   set of paths constructed from the senders to the RP the "gathering 
   tree". 
    
    
   Finding a better location for the RP resolves into two related 
   problems: deciding which potential sites to consider as candidates, 
   and evaluating the cost of the gathering tree centered on that site. 
    
    
   Ideally, we would want the RP to be located in the vicinity of the 
   senders to the multicast group. But there is not enough information 
   to proceed with such a calculation. Another method [2] would be to 
   use the RP-set broadcast by the BSR in the bootstrap message. But 
   this RP-set is too small and unlikely to contain the address of the 
   best RP for the multicast group. An algorithm that considers all the 
   potential routers would be best suited for calculating the best RP. 
    
 
 
3. New RP Calculation 
    
    
   Assume RPold is the current RP of G; we propose an RP relocation 
   mechanism that relocates the RP to RPnew. It should clearly be noted 
   that this relocation is done only when there is a significant 
   improvement in tree cost. The relocation comes into effect after a 
   certain time period and when there are changes in the group 
   membership.  
    
    
   To determine the position of RPnew, RPold uses the topology 
   information available to it from the Interior Gateway Protocol (such 
   as OSPF (Open Short Path First), which has the required information 
 
Atwood/Mukherjee      Expires December 27, 2002              [Page 3] 

                       RP relocation in PIM-SM              June 2002 

   in the Link State Database). We begin by describing two functions 
   that will help in deciding if the RP should be moved to a new 
   location or not. [These functions have been taken from [6] with 
   slight modifications. The paper [6] contains other algorithms for 
   calculating the best RP and they may be used instead of the one 
   mentioned here.] 
    
     1. The function cost_calculate(root) uses the estimation function 
     [6] to calculate the cost of a tree at a given root: 
    
    
          Let S be the set of sources for the multicast group, u a 
          source in S, root the supplied root to the algorithm and 
          d(a,b) the distance from a to b. Given the fact that there 
          are no shared links (because the data flow from each sender 
          is independent of the data flow from all other senders), and 
          under the assumption that all sources send with approximately 
          the same rates, the tree cost is the sum of the member 
          distances. Thus, 
    
    
                         Est. Cost = sum d(root,u)           
    
    
   2. The function why_move() follows the following algorithm: 
    
      1. Initialize a variable i equal to 0 and an array RPmove[] of  
         size 5 equal to NULL. Assign to RPmove[0] the value RPold.  
               
      2. Call cost_calculate with RPmove[0] as the root. Store the cost  
         in a variable currcost and the visited node in a list  
         dontrepeat[].  
        
      3. Call cost_calculate with all of the neighboring unvisited  
         nodes of RPmove[0] as the root. Store the lowest cost in a  
         variable lowestcost, the lowest cost node in a variable RPlow  
         and add the visited nodes to the list dontrepeat[].  
               
      4. If lowestcost is lower than currcost then assign lowestcost to  
         currcost else goto step 6.  
               
      5. Shift all the values of the array RPmove[] to the next  
         location (i.e., assign RPmove[1] := RPmove[0] and so on till  
         RPmove[4] := RPmove[3]). Assign RPmove[0] with the value RPlow  
         and goto step 3.  
               
      6. If RPmove[0] is different from RPold and the estimated cost of  
         the tree with RP at RPold is greater than lowercost by more  
         than the threshold, then return RPmove[] else make all values  
         of RPmove equal to NULL and return RPmove[].   
    
    
   The value of the variable threshold used in the algorithm is a 
   predefined value set by the network administrator. Thus calling the 
 
Atwood/Mukherjee      Expires December 27, 2002              [Page 4] 

                       RP relocation in PIM-SM              June 2002 

   function why_move() returns RPmove[]. If RPmove[0] is NULL then the 
   RP should not be relocated. If RPmove[0] is not equal to NULL then 
   the RP should be relocated. This leaves us with the problem of 
   dynamically switching from RPold to RPnew[0]. 
    
    
    
4. RP Relocation 
    
    
   Figure 1 shows the outline of the relocation algorithm. When the 
   relocation timer has expired and there is a change in the group 
   membership the present tree cost is calculated. The tree cost with 
   the RP at the best position is calculated.  
    
    
   ---------------------------------------------------- 
   RELOCATE(G) 
   set_of_sources S 
   begin 
      while(1) do 
         reloc_var = -1 
         if (tr expired and S changed) 
            RPnew[] = why_move() 
            While (reloc_var != 0) do 
               if (RPnew[0] != NULL) 
                  reloc_var = 1 
                  gen_move_join(RPold, RPnew[0], G) 
                  gen_move_RP(RPold, RPnew[0], G) 
               else 
                  reloc_var = 0 
               endif 
            endwhile 
         endif 
      endwhile 
   end 
    
   tr - relocation timer 
   ---------------------------------------------------- 
   Figure 1: Relocation 
    
    
   If RPnew[0] is not NULL then the RP has to be relocated. For this a 
   MOVE_JOIN message is sent to RPnew[0] and Move_RP message is sent to 
   the BSR. The variable reloc_var keeps track of the number of 
   bootstrap messages received with the RP-set for the multicast group 
   unchanged after the relocation has started. 
    
    
   RPnew[0] can ignore all the messages if it is not an RP-capable 
   router or is configured not to act as RP for any group. If RPnew[0] 
   is RP-capable then it does the following: 
    
    
 
Atwood/Mukherjee      Expires December 27, 2002              [Page 5] 

                       RP relocation in PIM-SM              June 2002 

   On receiving the MOVE_JOIN message RPnew[0] assumes the role of RP 
   for group G. When it receives an encapsulated message from RPold it 
   sends the message out on the multicast tree. When it receives a 
   message from a source it sends the message out on the multicast tree 
   and encapsulates and sends this to RPold. On receiving the Move_RP 
   message if the BSR does not find RPnew[0] in the local pool of 
   candidate RPs it assumes that RPnew[0] is not RP-capable and ignores 
   the message otherwise it does the following: 
    
     1. To exclude the current members of the RP-set from being the RP 
        for the group, the BSR can do one of the following: 
         
          i)   It changes the priority of RPnew[0] for that group to 
               the minimum value of priority in that group (i.e. 
               maximum priority) and increases the priorities of all 
               other candidates for that group by 1; or 
           
           
          ii)  It can only include the address of RPnew[0] in the RP-
               set being broadcast in the bootstrap message and leave 
               out all the remaining candidates. 
    
    
     2. The BSR then sends out its bootstrap message. 
    
    
   The routers on receiving this bootstrap message join the group at 
   RPnew[0]. While this transition is taking place RPold continues to 
   act as the RP for the group. The MOVE_JOIN message sent to RPnew[0] 
   ensures that RPold receives packets from RPnew[0] during the 
   transition. When RPold receives a message from a source it continues 
   to send to the group and also encapsulates and sends the packet to 
   RPnew[0]. On receiving a bootstrap message RPold checks the 
   reloc_var. If the reloc_var for the group is greater than 0 and the 
   RP-set for the group is unchanged, then it increases the value of 
   reloc_var by 1.  
    
    
   Once all the members have pruned off from RPold, the tree to RPold 
   is torn down. RPold then sends a MOVE_OVER message to RPnew[0] and 
   resets the reloc_var to zero. The state is then killed and the tree 
   is now set up at RPnew[0]. On receiving the MOVE_OVER message 
   RPnew[0] stops sending encapsulated messages to RPold. This method 
   of RP relocation ensures no loss of messages during the transition. 
    
    
   If RPold gets three bootstrap messages from the BSR with the same 
   RP-set then the value of reloc_var will be four. If the value of 
   reloc_var reaches four then RPold assumes that RPnew[0] is not RP-
   capable. It then checks the value of RPnew[1]. If RPnew[1] is NULL 
   then it assumes that none of the other nodes can serve as RP for the 
   multicast group so it sets the reloc_var to zero and continues to 
   serve as RP for the multicast group. RPold will also stop sending 
   encapsulated packets to RPnew[0]. If RPnew[1] is not NULL it shifts 
 
Atwood/Mukherjee      Expires December 27, 2002              [Page 6] 

                       RP relocation in PIM-SM              June 2002 

   the value of the array to the previous locations (i.e., RPnew[0] := 
   RPnew[1] and so on until RPnew[3] := RPnew[4] and finally RPnew[4] 
   is assigned NULL). It then tries to relocate to the new value of 
   RPnew[0], that is, the next best position where the RP of the 
   multicast group should be located.  
    
    
    
5. Control Messages 
 
 
5.1 MOVE_JOIN 
    
    
   This message is used to tell RPnew that it should act as the new RP 
   for the multicast group G and should send any messages during the 
   transition period to RPold. The IP address is set to the address of 
   RPold and the destination address is set to RPnew. The IP TTL of the 
   packet is the system's normal unicast TTL. 
    
    
    
    0                   1                   2                   3 
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |PIM Ver| Type  |   Reserved    |           Checksum            | 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |                 Encoded-Multicast-Group-Address               | 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
    
    
    
   PIM Ver 
         PIM Version number is 2. 
    
    
   Type 
         9 = Move_Join 
    
    
   Reserved 
         Set to zero on transmission. Ignored upon receipt. 
    
    
   Checksum 
         The checksum is a standard IP checksum.  
    
    
   Encoded-Multicast-Group-Address 
         The encoded multicast group address for the group G whose RP 
   has to be relocated. 
    
    
    
 
Atwood/Mukherjee      Expires December 27, 2002              [Page 7] 

                       RP relocation in PIM-SM              June 2002 

    
5.2 MOVE_RP 
    
    
   This message is used to tell the Bootstrap router that the RP for 
   the group should be shifted from RPold to RPnew. The IP address is 
   set to the address of the RPold and the destination address is set 
   to the address of the BSR. The IP TTL of the packet is the system's 
   normal unicast TTL. 
    
    
    
    0                   1                   2                   3 
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |PIM Ver| Type  |   Reserved    |           Checksum            | 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |                 Encoded-Multicast-Group-Address               | 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |                 Encoded-RPnew-Address                         | 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
    
    
    
   PIM Ver 
         PIM Version number is 2. 
    
    
   Type 
         10 = Move_RP 
    
    
   Reserved 
         Set to zero on transmission. Ignored upon receipt. 
    
    
   Checksum 
         The checksum is a standard IP checksum. 
    
    
   Encoded-Multicast-Group-Address 
         The encoded multicast group address for the group G whose RP 
   has to be relocated. 
    
    
   Encoded-RPnew-Address 
         The encoded address of the router to which the RP should be 
   relocated. 
    
    
    



 
Atwood/Mukherjee      Expires December 27, 2002              [Page 8] 

                       RP relocation in PIM-SM              June 2002 

5.3 MOVE_OVER  
 
 
   This message is used to tell RPnew that all the members of group G 
   have left the multicast tree at RPold so there is no need to send 
   any more messages to RPold. The IP address is set to the address of 
   RPold and the destination address is set to RPnew. The IP TTL of the 
   packet is the system's normal unicast TTL. 
    
    
    
    0                   1                   2                   3 
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |PIM Ver| Type  |   Reserved    |           Checksum            | 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |                 Encoded-Multicast-Group-Address               | 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
    
    
    
   PIM Ver 
         PIM Version number is 2. 
    
    
   Type 
         11 = Move_Over 
    
    
   Reserved 
         Set to zero on transmission. Ignored upon receipt. 
    
    
   Checksum 
         The checksum is a standard IP checksum.  
    
    
   Encoded-Multicast-Group-Address 
         The encoded multicast group address for the group G whose RP 
   has to be relocated. 
   
 
 
6. Summary 
    
    
   This draft proposes a dynamic mechanism for relocating RP in the 
   PIM-SM multicast routing protocol. The original RP may not be the 
   ideal RP for the group and this method of relocating to an 
   appropriate position will help reduce delay and improve network 
   performance. 
    
    
    
 
Atwood/Mukherjee      Expires December 27, 2002              [Page 9] 

                       RP relocation in PIM-SM              June 2002 

7. Security Considerations 
    
    
   All the control messages may use IPsec to address security concerns. 
    
    
    
8. References 
    
    
   [1]    Robert Voigt, Robert Barton, Shridhar Shukla, "A Tool for 
   configuring Multicast Data Distribution over Global Networks", April 
   1995 
    
    
    
   [2]    Ying-Dar Lin, Nai-Bin Hsu, Ren-Hung Hwang, "RP relocation 
   extension to PIM-SM multicast routing", Internet Draft, Work in 
   progress, draft-ydlin-pim-sm-rp-01.txt 
    
    
    
   [3]    D. Estrin, D. Farinacci, A. Helmy, D. Thaler, S. Deering, M. 
   Handley, V. Jacobson, C. Liu, P. Sharma, L. Wei, "PIM-SM Protocol 
   Specification", RFC 2362, June 1998 
    
    
    
   [4]    Bill Fenner, Mark Handley, Hugh Holbrook, Isidor Kouvelas, 
   "PIM-SM, Protocol Specification", Internet Draft, Work in progress, 
   draft-ietf-pim-sm-v2-new-05.ps 
    
    
    
   [5]    Bill Fenner, Mark Handley, David Thaler, "BSR mechanism for 
   PIM-SM", Internet Draft, Work in progress, draft-ietf-pim-sm-bsr-
   02.ps 
    
    
    
   [6]    David G. Thaler, Chinya V. Ravichankar, "Distributed Center 
   Location Algorithms", IEEE Journal of Selected Areas in 
   Communications, April 1997 
    
    
 
Authors' Addresses 
    
    
   J. William Atwood 
   Department of Computer Science 
   1455 de Maisonneuve Blvd. West 
   Montreal, Quebec, H3G 1M8 
   Canada 
 
Atwood/Mukherjee      Expires December 27, 2002             [Page 10] 

                       RP relocation in PIM-SM              June 2002 

    
   Phone: +1 514 848 3046 
   Email: bill@cs.concordia.ca 
   URL:   http://www.cs.concordia.ca/~faculty/bill/ 
    
    
    
   Ritesh Mukherjee 
   Department of Computer Science 
   1455 de Maisonneuve Blvd. West 
   Montreal, Quebec, H3G 1M8 
   Canada 
    
    
   Phone: +1 514 989 4530 
   Email: mukherj@cs.concordia.ca 
   URL:   http://www.cs.concordia.ca/~grad/mukherj 





































 
Atwood/Mukherjee      Expires December 27, 2002             [Page 11] 


