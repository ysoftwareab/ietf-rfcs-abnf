<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>End-system support for BGP-signaled IP/VPNs.  </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 End-system functionality">
<link href="#rfc.section.3" rel="Chapter" title="3 Operational Model">
<link href="#rfc.section.4" rel="Chapter" title="4 XMPP client interface">
<link href="#rfc.section.5" rel="Chapter" title="5 VPN NLRI">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="Network Service Providers often use " />
  <meta name="description" content="Network Service Providers often use " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">P. Marques</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">L. Fang</td>
</tr>
<tr>
<td class="left">Expires: April 08, 2012</td>
<td class="right">Cisco Systems</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">P. Pan</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Infinera Corp</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 06, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">End-system support for BGP-signaled IP/VPNs.  <br />
  <span class="filename">draft-marques-l3vpn-end-system-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Network Service Providers often use <a href="#RFC4364">BGP/MPLS IP VPNs</a> <cite title="NONE">[RFC4364]</cite> as the control plane for overlay networks. That solution has proven to scale to large number of VPNs and attachment points and is one familiar to network equipment software.</p>
<p>There is a significant interest in the industry in building overlay networks in which end-systems are themselves the direct participant, along with network equipment such as service appliances.</p>
<p>This document proposes an extension of the BGP IP VPN model to serve as the signaling protocol for host-based overlay networks along with an XMPP interface that provides a bridge between the software concepts familiar to end-points and those familiar to network equipment.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 08, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">End-system functionality</a>
</li>
<li>3.   <a href="#rfc.section.3">Operational Model</a>
</li>
<li>4.   <a href="#rfc.section.4">XMPP client interface</a>
</li>
<li>5.   <a href="#rfc.section.5">VPN NLRI</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">Data center applications require private networks connecting multiple "Virtual Machines" belonging to the same administrative "user" and between them and network elements and appliances.</p>
<p id="rfc.section.1.p.2">In this context, it is a common goal, for the data-center forwarding infrastructure to be isolated from the knowledge of the private network. The set of routers and switches that interconnects physical machines in the data-center is assumed to provide an IP service (with or without the use of IEEE 802.1 technologies).</p>
<p id="rfc.section.1.p.3">The Virtual Private Networks (VPNs) associated with each individual administrative domain can be built without the knowledge of the data-center connectivity layer as an overlay network.  This proposal leverages the technology used in the Service Provide managed VPN space and extends it to address the problem of interconnecting virtual interfaces on end-systems.  In both applications there is the need to be able to manage at scale a very large number of VPNs and attachement points. And in both cases there is the need to support the interchange of traffic between different VPNs.</p>
<p id="rfc.section.1.p.4">This document defines how BGP-signaled IP/VPNs can be used to interconnect end-systems and network elements. It assumes that the forwarding layer uses IP over GRE as defined by <a href="#RFC4023">[RFC4023]</a>. Other transport layers such as native MPLS or 802.1ah can also be used with the same signaling approach.</p>
<p id="rfc.section.1.p.5">When this document uses the term 'Infrastructure IP' addresses, it refers to the addresses used in the outer header of GRE packets.  In the case of a transport other than IP over GRE, this would be the Subnetwork Point of Attachement (SNPA) address corresponding to the multi-access network providing connectivity to the end-systems.</p>
<p id="rfc.section.1.p.6">BGP is not an interface that application software is familiar with. In order to bridge the gap between concepts familiar to network devices and those familiar to end-system developers, this document defines an XMPP client interface to be used by end-systems.  It defines the procedures to interchange data between XMPP and BGP IP VPN sessions along with the corresponding data schemas.  Networking devices may opt to receive the signaling information directly via BGP.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> End-system functionality</h1>
<p id="rfc.section.2.p.1">For the purposes of this document we assume that each end-system executes an 'Host Operating System' with the ability to: </p>

<ul class="empty">
<li>Create virtual interfaces (typically ethernet interfaces).</li>
<li>Associate a given virtual interface with a specific "Virtual and Routing Forwarding (VRF)" table.</li>
<li>Store entries in the VRF table that map an VRF-specific IP prefix into a next-hop which contains a destination IP address and a 20-bit label.</li>
<li>Encapsulate outgoing packets according <a href="#RFC4023">[RFC4023]</a> using the result of the VRF lookup.</li>
<li>Associate incoming packets with a VRF according to the 20-bit label contained immediately after the GRE header.</li>
<li>Expose a programmatic interface to create, update and delete VRF table entries.</li>
</ul>
<p id="rfc.section.2.p.2">The 'Host Operating System' may choose to associate the virtual interfaces with specify 'Virtual Machines' or use other policies to manage the application access to these interfaces.</p>
<p id="rfc.section.2.p.3">Hosts should support the ability to associate multiple virtual interfaces with the same VRF. The 20-bit label which is associated with a VRF is of local significance only and SHOULD be allocated by the end-system.</p>
<p id="rfc.section.2.p.4">The procedure that determines that a VRF should configured on a particular end-system as well as which IP addresses to be associated with each interface are outside the scope of this document. We assume that statically assigned IP addresses are used.</p>
<p id="rfc.section.2.p.5">The VRFs support IP unicast traffic only. Multicast support is subject for further study and will be detailed in a separate document. Both IPv4 and IPv6 are supported and the term 'IP' can refer to either version of the Internet Protocol.</p>
<p id="rfc.section.2.p.6">The VRF table is populated by the signaling mechanisms described bellow and may contain both host length (i.e. /32 and /128 for IPv4 and v6 respectively) or subnet prefixes. As an example a VPN with access to the external networks would probably contain a default route plus a set of host length entries for all the VMs in the same VPN.</p>
<p id="rfc.section.2.p.7">In the terminology used in the <a href="#RFC4364">BGP-signaled IP/VPN standard</a> <cite title="NONE">[RFC4364]</cite>, a end-system acts as a 'Provider Edge' (PE) device in terms of its forwarding capabilities, with the virtual interfaces that it exposes (for instance to virtual machines) as the 'Customer Edge' (CE) interfaces.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Operational Model</h1>
<p id="rfc.section.3.p.1">In the simplest case, a VPN is a collection of systems that are allowed to exchange traffic with each other and where all the VRFs in the VPN contain all the routing entries for the VPN. Only members of the VPN are allowed to exchange traffic with each other. We can refer to these as symmetrical VPNs since all VRFs contain the same routing information.</p>
<p id="rfc.section.3.p.2">When end-systems join a given VPN they advertise their membership by advertising the VPN-specific IP address associated with a particular virtual interface as well as its binding to the infrastructure IP address associated with the host.</p>
<p id="rfc.section.3.p.3">Infrastructure addresses are routable in the underlying transport network (e.g. the data-center network). While VPN addresses are routable on the VPN network only.</p>
<p id="rfc.section.3.p.4">End-systems subscribe to the contents of the VPN routing tables for which they have members associated with. This information is then used to populate the host's routing tables. It may contain both host routes (i.e. IPv4 32-bit prefixes or IPv6 128-bit prefixes) or routes to gateways that interconnect other networks.</p>
<p id="rfc.section.3.p.5">The signaling network delivers the membership advertisements generated by the end-systems to other members of the same VPN, subjet to policy controls.</p>
<p id="rfc.section.3.p.6">When a particular VM "moves" from one physical end-system to another, its respective VPN address will be advertised by the new system and that notification propagated to all attachment points of that VPN.</p>
<p id="rfc.section.3.p.7">This document assumes two types of applications that perform network signaling functions: BGP Route Reflectors (RRs) and BGP/XMPP signaling gateways.  Both functions may be collocated in the same physical device.</p>
<p id="rfc.section.3.p.8">The BGP Route Reflectors accept connection from gateways or native BGP devices. These BGP peering sessions SHALL be support the address families: VPN-IPv4 (1, 128), VPN-IPv6 (2, 128) and <a href="#RFC4684">RT-Constraint (1, 132)</a> <cite title="NONE">[RFC4684]</cite>.</p>
<p id="rfc.section.3.p.9">The XMPP signaling gateways maintain persistent connection to a subset of the end-systems of the domain and provide a 'pubsub' API to the contents of each specific VPN routing table.  These systems are not in the forwarding plane and do not need to be collocated with a network device.</p>
<p id="rfc.section.3.p.10">Network devices MAY have direct BGP sessions to the BGP Route Reflectors.  For instance, a router or security appliance that supports BGP/MPLS IP VPNs over GRE may use its existing functionality to inter-operate directly with a collection of Virtual Machines.</p>
<p id="rfc.section.3.p.11">The BGP/XMPP gateways implement the VRF policy functionality that is associated with PE routers in the pure BGP IP/VPN case. In these signaling gateways, the 'publish-subscribe' messages from the end-systems are associated with a VRF-specific signaling table. Each of these routing tables contains import and export policies which provide fine grain control over the table contents.</p>
<p id="rfc.section.3.p.12">An export policy associates VPN routing information with one or more 6 byte values known as 'Route Targets'. These 'Route Targets' are associated with the routes as they are advertised out to other BGP speakers.</p>
<p id="rfc.section.3.p.13">Import policies, on the other hand, select via 'Route Targets', from all the available routing information which routes should be imported into a VPN-specific routing table.</p>
<p id="rfc.section.3.p.14">A symmetrical VPN uses the same configuration for both import and export. By controlling these policies it is possible to selectively allow direct traffic exchanges between members of different VPNs, assuming their respective IP addresses are non-overlapping.</p>
<div id="#rfc.figure.1"></div>
<div id="#forwarding"></div>
<pre>
               +--------+                 +--------+
VM1 -- veth0 --| host 1 |=== [network] ===| host 2 |-- veth0 -- VM2
               +--------+                 +--------+

 IP pkt  ===&gt; GRE encap  ===&gt; [IP net] ===&gt; GRE decap ===&gt; IP pkt
           [192.168.2.1, 20]               map 20 to veth0
</pre>
<div id="#rfc.table.1"></div>
<div id="#vrf1"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">VPN IP address</th>
<th class="left">Host address</th>
<th class="left">label</th>
</tr></thead>
<tbody>
<tr>
<td class="left">10.1.1.1/32</td>
<td class="left">localhost</td>
<td class="left">10</td>
</tr>
<tr>
<td class="left">10.1.1.2/32</td>
<td class="left">192.168.2.1</td>
<td class="left">20</td>
</tr>
</tbody>
</table>
<p>VRF table on host1</p>
<p id="rfc.section.3.p.15">The figure and table above contain an example in which IP packets are transmitted from one VPN interface (with address 10.1.1.1) to another VPN interface (with address 10.1.1.2). As previously mentioned, the virtual ethernet interfaces function as a CE interace in a traditional BGP-signaled IP VPN. While the end-system provide the forwarding functionality equivalent to a PE device.</p>
<div id="#rfc.figure.2"></div>
<div id="#signaling"></div>
<pre>
+--------+       +-----------+       +--------+
| host 1 | &lt;===&gt; | signaling | &lt;===&gt; | BGP RR |
+--------+       | gateway   |       +--------+
                 +-----------+
</pre>
<div id="#rfc.table.2"></div>
<div id="#vrf1_on_gw"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">VPN IP address</th>
<th class="left">SNPA</th>
<th class="left">label</th>
<th class="left">Known via</th>
</tr></thead>
<tbody>
<tr>
<td class="left">10.1.1.1/32</td>
<td class="left">192.168.1.1</td>
<td class="left">10</td>
<td class="left">XMPP</td>
</tr>
<tr>
<td class="left">10.1.1.2/32</td>
<td class="left">192.168.2.1</td>
<td class="left">20</td>
<td class="left">BGP</td>
</tr>
</tbody>
</table>
<p>VPN Routing table on signaling gateway</p>
<p id="rfc.section.3.p.16">The signaling network corresponding to the same example is depicted above.  The signaling gateway is an out-of-band system which speaks both XMPP to the host as well as BGP to the BGP RRs. The table above represents the routing table on the gateway that corresponds to the VPN of the example.  Host 2 would be connected to another signaling gateway which would be in turn connected to the BGP RR mesh.  </p>
<p id="rfc.section.3.p.17">The gateway is configured via an external mechanism with the parameters that correspond to the VPNs in use by its clients along with its respective vrf import and export policies.</p>
<p id="rfc.section.3.p.18">XMPP publish request are translated into routing entries on this table, which are then advertised via BGP, using standard BGP-signaled IP VPN mechanism.BGP learned routes are also imported into this routing table. Any changes to its content are advertised to local XMPP clients.</p>
<p id="rfc.section.3.p.19">In comparison with traditional IP VPNs, the signaling gateway is performing the PE functionality, which XMPP is used as a PE-CE routing protocol.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> XMPP client interface</h1>
<p id="rfc.section.4.p.1">The communication between end-systems and the signaling gateway uses the XMPP protocol with the <a href="#pubsub">PubSub Collection Nodes</a> <cite title="NONE">[pubsub]</cite> extension in order to exchange VPN route information.</p>
<p id="rfc.section.4.p.2">End-systems establish persistent XMPP sessions. These sessions MUST use the XMPP <a href="#xmpp-ping">Ping</a> <cite title="NONE">[xmpp-ping]</cite> extension in order to detect end-system failures.</p>
<p id="rfc.section.4.p.3">An End-system MAY connect to multiple VPN-signaling gateways for reliability. In this case it SHOULD publish its information to each of the gateways. It MAY choose to subscribe to VPN routing information once only from one of the available gateways.</p>
<p id="rfc.section.4.p.4">The information advertised by a end-system SHOULD be deleted after a configurable timeout, when the session closes. This timeout should default to 60 seconds.</p>
<div id="#rfc.figure.3"></div>
<pre>
		+---------+	      	+--------+
		| gateway | -----------	| BGP RR |
		+---------+ 	       	+--------+
                //	    \          /
              XMPP           \	      /
              //     	      \	     /
+------------+		       \    /
| end-system |		       	\  /
+------------+		      	 \/
              \\	      	 /\
              XMPP	      	/  \
                \\     	       /    \
		+---------+   /	     \  +--------+
		| gateway | -----------	| BGP RR |
		+---------+	      	+--------+
</pre>
<p id="rfc.section.4.p.5">The figure above represents a typical configuration in which a end-system is homed to multiple gateways, which are in turn connected to multiple BGP route reflectors. In a deployment there would be a number of gateways corresponding to the number of end-systems divided by the gateway capacity in terms of number of XMPP sessions.  While the BGP RR scale in terms of the number of gateways attached to it.</p>
<p id="rfc.section.4.p.6">The XMPP "jid" used by the end-system shall be a 6-byte value that uniquely identifies the host in the domain. This specification recommends the use of the 802 MAC address of one of the physical ethernet interfaces of the end-system, when present.</p>
<p id="rfc.section.4.p.7">Each VPN shall be identified by a 64 ASCII character string.</p>
<p id="rfc.section.4.p.8">The guest system software on an end-system SHALL establish an XMPP session with its configured signaling gateways before creating virtual interfaces.</p>
<p id="rfc.section.4.p.9">When a virtual interface is created, for instance as result of a Virtual Machine being instantiated on a end-system, the host operating-system software shall generate an XMPP Publish message to the VPN-signaling gateway.</p>
<div id="#rfc.figure.4"></div>
<p>Publish request from end-system to gateway:</p>
<pre>
&lt;iq type='set'
    from='01020304abcd@domain.org'	&lt;!-- system-id@domain.org --&gt;
    to='network-control.domain.org'
    id='request1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='01020304abcd:vpn-ip-address/32'&gt;
      &lt;item&gt;
        &lt;entry xmlns='http://ietf.org/protocol/bgpvpn'&gt;
          &lt;nlri af='1'&gt;'vpn-ip-address&gt;/32'&lt;/nlri&gt;
	  &lt;snpa af='1'&gt;'infrastructure-ip-address'&lt;/snpa&gt;
          &lt;version id='1'&gt;		&lt;!-- non-decreasing VM version # --&gt;
	  &lt;label&gt;1&lt;/label&gt;		&lt;!-- 24 bit number --&gt;
        &lt;/entry&gt;
       &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='set'
    from='01020304abcd@domain.org'
    to='network-control.domain.org'
    id='request2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;collection node='vpn-customer-name'&gt;
      &lt;associate node='01020304abcd:vpn-ip-address/32'/&gt;
    &lt;/collection&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre>
<p id="rfc.section.4.p.10">In the request above the node 'vpn-customer-name' is assumed to be a collection which is implicitly created by the VPN-signaling gateway.</p>
<p id="rfc.section.4.p.11">The VPN-signaling gateway will convert the information received in a the 'publish' request into the corresponding BGP route information such that:.</p>
<p></p>

<ul class="empty">
<li>It associates the specific request with a local VRF with the name specified in the collection 'node' attribute.</li>
<li>It Creates a route with with a 'Route Distinguisher' (RD) containing the end-system's 'system-id' and the specified 'label' and NLRI prefix.</li>
<li>It associates this route with the specified SNPA address.</li>
<li>It associates the route with an extended community TDB containing the version number.</li>
</ul>

<p> </p>
<div id="#rfc.figure.5"></div>
<p>Subscription request from end-system to gateway:</p>
<pre>
&lt;iq type='set'
    from='01020304abcd@domain.org'
    to='network-control.domain.org'
    id='sub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscribe node='vpn-customer-name'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre>
<div id="#rfc.figure.6"></div>
<p>Update notification from gateway to end-system:</p>
<pre>
&lt;message to='system-id@domain.org from='network-control.domain.org&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='vpn-customer-name'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
        &lt;entry xmlns='http://ietf.org/protocol/bgpvpn'&gt;
          &lt;nlri af='1'&gt;'vpn-ip-address&gt;/32'&lt;/nlri&gt;
	  &lt;snpa af='1'&gt;'infrastructure-ip-address'&lt;/snpa&gt;
          &lt;version id='1'&gt;		&lt;!-- non-decreasing VM version # --&gt;
	  &lt;label&gt;1&lt;/label&gt;		&lt;!-- 24 bit number --&gt;
        &lt;/entry&gt;
       &lt;/item&gt;
      &lt;item &gt;
        ...
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre>
<p id="rfc.section.4.p.13">Notifications should be generated whenever a VPN route is added, modified or deleted.</p>
<p id="rfc.section.4.p.14">Note that the Update from the signaling gateway to the end-point does not contain the system-id of the destination end-point. When multiple possible routes exist for a given VPN IP address, for instance because the VM may be in the process of moving location, it is the responsibility of the gateway to select the best path to advertise to the end-system.</p>
<p id="rfc.section.4.p.15">In situations where an automated system is controlling the instantiation of VMs it may be possible to have that system assign a non-decreasing version number for each instantiation of that particular VM. In that case, this number, carried in the 'version' field may be used to help gateways select the most recent instantiation of a VM during the interval of time where multiple routes are present.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> VPN NLRI</h1>
<p id="rfc.section.5.p.1">When a VPN-signaling gateway receives a request to create or modify a VPN route is SHALL generate a BGP VPN route advertisement with the corresponding information using the BGP address family corresponding to the address family specified by the end-system.</p>
<p id="rfc.section.5.p.2">It is assumed that the VPN-signaling gateways contain information regarding the mapping between 'vpn-customer-names' and BGP Route Targets used to import and export information from the associated VRFs. This mapping is known via an out-of-band mechanism not specified in this document.</p>
<p id="rfc.section.5.p.3">Whenever a VRF in the gateway contains local routing information, the gateway shall advertise the corresponding RT-Constraint route target routes in BGP, which perform a parallel function to the subscription requests in XMPP.</p>
<p id="rfc.section.5.p.4">The 32bit route version number defined in the XML schema is advertised into BGP as a Extended community with type TBD.</p>
<p id="rfc.section.5.p.5">Signaling gateways SHOULD use automatically assign a BGP route distinguisher per VPN routing table.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Security Considerations</h1>
<p id="rfc.section.6.p.1">The signaling protocol defines the access control policies for each virtual interface and any VM associated with it. It is important to secure the end-system access to signaling gateways and the BGP infrastructure itself.</p>
<p id="rfc.section.6.p.2">The XMPP session between end-systems and the XMPP gateways MUST use mutual authentication. One possible strategy is to distribute pre-signed certificates to end-systems which are presented as proof of authorization to the signaling gateway.</p>
<p id="rfc.section.6.p.3">BGP sessions MUST be authenticated using a shared secret. This document recommends that BGP speaking systems filter traffic on port 179 such that only IP addresses which are known to participate in the BGP signaling protocol are allowed.</p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC4023">[RFC4023]</b></td>
<td class="top">
<a>Worster, T.</a>, <a>Rekhter, Y.</a> and <a>E. Rosen</a>, "<a href="http://tools.ietf.org/html/rfc4023">Encapsulating MPLS in IP or Generic Routing Encapsulation (GRE)</a>", RFC 4023, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4364">[RFC4364]</b></td>
<td class="top">
<a>Rosen, E.</a> and <a>Y. Rekhter</a>, "<a href="http://tools.ietf.org/html/rfc4364">BGP/MPLS IP Virtual Private Networks (VPNs)</a>", RFC 4364, February 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4684">[RFC4684]</b></td>
<td class="top">
<a>Marques, P.</a>, <a>Bonica, R.</a>, <a>Fang, L.</a>, <a>Martini, L.</a>, <a>Raszuk, R.</a>, <a>Patel, K.</a> and <a>J. Guichard</a>, "<a href="http://tools.ietf.org/html/rfc4684">Constrained Route Distribution for Border Gateway Protocol/MultiProtocol Label Switching (BGP/MPLS) Internet Protocol (IP) Virtual Private Networks (VPNs)</a>", RFC 4684, November 2006.</td>
</tr>
<tr>
<td class="reference"><b id="xmpp-ping">[xmpp-ping]</b></td>
<td class="top">
<a>XMPP Ping</a>", XEP 0199, June 2009.</td>, "</tr>
<tr>
<td class="reference"><b id="pubsub">[pubsub]</b></td>
<td class="top">
<a>PubSub Collection Nodes</a>", XEP 0248, September 2010.</td>, "</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Pedro Marques</span> 
	  <span class="n hidden">
		<span class="family-name">Marques</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:pedro.r.marques@gmail.com">pedro.r.marques@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Luyuan Fang</span> 
	  <span class="n hidden">
		<span class="family-name">Fang</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems</span>
	<span class="adr">
	  <span>111 Wood Avenue South</span>

	  <span class="vcardline">
		<span class="locality">Iselin</span>,  
		<span class="region">NJ</span> 
		<span class="code">08830</span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:lufang@cisco.com">lufang@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ping Pan</span> 
	  <span class="n hidden">
		<span class="family-name">Pan</span>
	  </span>
	</span>
	<span class="org vcardline">Infinera Corp</span>
	<span class="adr">
	  <span>140 Caspian Ct.</span>

	  <span class="vcardline">
		<span class="locality">Sunnyvale</span>,  
		<span class="region">CA</span> 
		<span class="code">94089</span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ppan@infinera.com">ppan@infinera.com</a></span>

  </address>
</div>

</body>
</html>