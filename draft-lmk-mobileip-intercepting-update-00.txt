Internet Engineering Task Force                     C-Y Lee
INTERNET DRAFT                                      G. Morrow
July 2000                                           F. Kadri


                     Intercepting Location Updates

         <draft-lmk-mobileip-intercepting-update-00.txt>

Status of this memo

     This document is an Internet-Draft and is in full conformance
     with all provisions of Section 10 of RFC2026.

     Internet-Drafts are working documents of the Internet Engineering
     Task Force (IETF), its areas, and its working groups.  Note that
     other groups may also distribute working documents as
     Internet-Drafts.

     Internet-Drafts are draft documents valid for a maximum of six
     months and may be updated, replaced, or obsoleted by other
     documents at any time.  It is inappropriate to use Internet-
     Drafts as reference material or to cite them other than as
     "work in progress."

    
     The list of current Internet-Drafts can be accessed at
     http://www.ietf.org/ietf/1id-abstracts.txt

     The list of Internet-Draft Shadow Directories can be accessed at
     http://www.ietf.org/shadow.html.

























Expires January 2001                                            [Page 1]





Internet Draft       Intercepting Location Updates            July 2000


Abstract

   The base Mobile IP allows a host to transparently send datagrams to
   mobile nodes as it would to any other nodes. Datagrams addressed to
   the mobile are always routed via the Home Agent in the home network.
   However, as the mobile node moves away from its home network, it may
   no longer be topologically close to its home agent. Route
   optimization [MIP-OPTIM] has been proposed to allow a host to send
   packets to the mobile as a mobile node (MN) moves, without having to
   route the packets via the home agent each time.  The mobile provides
   its current address to a host (or correspondent node, CN) that it is
   communicating with as it moves. The host updates the cache of the
   mobile location with this new address and tunnels datagrams
   (addressed to the mobile) to the current address of the mobile.
   However not all correspondent nodes are capable of tunneling IP
   datagrams as required by the route optimization mechanisms described
   in [MIP-OPTIM]. More importantly, disclosing the current location (or
   COA) of the mobile node to correspondent nodes is not always
   desirable, nor is the overhead of encapsulating datagram to the MN
   ideal.

   This proposal provides an optional means for a host, using an
   existing IP host stack to communicate transparently with a mobile
   node, when a route optimization scheme such as [MIP-OPTIM] is
   utilized.  At the same time, this proposal does not reveal the
   current location of the MN to correspondent nodes. In conjunction, it
   is not necessary to encapsulate datagram sent from the CN to the MN
   in a foreign network. To prevent datagram sourced by the MN from
   being filtered at firewalls data sent from the MN to the CN does not
   have to be routed via the home agent all the time, nor is it
   necessary to encapsulate the data tunneled from the MN to a CN. In
   addition, this proposal provides a means to regionalize location
   update [REGIONAL-REG] transparent to mobile nodes.  Mobile nodes do
   not have to be aware or capable of regionalizing or localizing
   location update messages.  Furthermore, location update messages can
   be localized within a network or a routing area or domain, by
   leveraging existing routing hierarchies in the network.  This
   obviates the need to construct a hierarchy of foreign agents and the
   consequent need to ensure the hierarchy is reasonably optimal for
   routing and loop free.











Expires January 2001                                            [Page 2]





Internet Draft       Intercepting Location Updates            July 2000


1.0 Introduction

   A mobile node (MN) is identified by its home IP address, and when it
   moves to a new location, it has to notify its home agent. This
   enables the home agent to route IP datagrams to the mobile node
    at its new location. The mobile node notifies its home agent of its
   new care of address by sending a Registration Request message. This
   registration mechanism is defined in the base Mobile IP protocol
   [MIP].

   To allow hosts (referred to as correspondent nodes, CNs) to send IP
   datagrams to the mobile node 's care of address directly without
   having to go to the home agent first, correspondent nodes need to be
   notified as well when the mobile node moves.  In MIP-OPTIM, a mobile
   node may notify the correspondent nodes its care of address via the
   home agent.

   As described in MIP-OPTIM, a mobile node may send a Binding Warning
   message to is home agent to request that the home agent inform (by
   sending Binding Update messages) the correspondent nodes its new
   care-of address (COA). A mobile may append this message (Binding
   Warning Extension) in the Registration Request message to the home
   agent.  On reception of the Binding Warning Extension message, the
   home agent should send Binding Update messages to the correspondent
   nodes listed in the Binding Warning message, to notify the
   correspondent nodes the mobile node's new care-of address.

   The location hiding route optimization described in this document
   requires a minor modification to the Binding Update message defined
   in MIP-OPTIM, the addition of Router Alert Option [ROUTER-ALERT] in
   the message. The Router Alert Option allows an IP packet to be
   inspected by routers for further processing if necessary. [Note:
   Ideally an Edge Router Alert, which is only inspected by edge devices
   would be more suitable for this purpose] Here, the Binding Update
   message is forwarded as any other IP datagrams by intermediate
   routers towards the correspondent node. When the Binding Update
   message reaches the router serving the subnet where the correspondent
   node resides, the router will perform the necessary operations to
   allow datagrams addressed to the mobile node, from this subnet to be
   redirected to the care-of address of the  mobile node. This router is
   referred to as the correspondent agent.  The mechanisms required to
   redirect datagrams to the mobile node is described in the section
   below, Correspondent Agent (CA) Operations.

   The benefits of this proposal are :

   * backward compatibility with RFC2002 and [MIP-OPTIM].




Expires January 2001                                            [Page 3]





Internet Draft       Intercepting Location Updates            July 2000


   * not necessary to encapsulate or decapsulate data, reducing header
   overhead

   * allows optimized route to the mobile without requiring changes to
   correspondent nodes on the Internet.

   * hides the care-of address of the mobile node from the correspondent
   node. Otherwise, knowledge of the care-of address can be used to
   infer the where-abouts of the mobile user.

   * allows the mobile node to send data to the correspondent node
   without necessarily going through the home agent [REVERSE-TUNNEL],
   i.e it allows route optimization in the reverse direction from the
   mobile node to the correspondent node.

   * the hierarchy of foreign agents are transparent to mobile nodes.

   A mobile does not have to know whether it is using a hierarchical
   foreign agent or a RFC2002 foreign agent.

   * leverages routing hierarchy e.g routing area, routing domain to
   localize location update messages





























Expires January 2001                                            [Page 4]





Internet Draft       Intercepting Location Updates            July 2000


2.0 Motivation

   The motivations for this proposal are:

   i) to allow existing hosts not capable of tunneling IP datagrams, to
   communicate with a mobile node using a more optimal path to the MN
   than via the HA (in the case where the MN has moved away from its
   home network).

   ii) to allow the traffic from a CN to use the more optimal path to
   the MN without having to reveal the current location of the MN or the
   COA of the MN, to the CN.

   iii) to obviate the need for encapulation of data (in both forward
   and reverse directions)

   iv) to allow a MN to use the more optimal path to the CN when data
   destined to a CN is tunneled first from the MN to HA to prevent data
   sourced by the MN from being filtered by firewalls.

   v) constraining location update message within a region or domain in
   a way that is transparent to mobile nodes

3.0 Overview

   This proposal allows an IP host using an existing TCP/IP stack to
   communicate with a mobile IP host, without requiring datagrams to go
   through a router (the Home Agent) in the home network when the mobile
   node is not in its home network.  A host (correspondent node, CN)
   sends data to a mobile node (MN) transparently using its home address
   and need not be aware of the MN's address in a foreign network. The
   CN does not need to be able to encapsulate or decapsulate IP
   datagrams.  The router serving the CN binds the MN home address to
   the care-of-address (COA) of the MN when it receives a location
   update message from the MN or Foreign Agent (FA).

   [ Note: This router is referred to as the Correspondent Agent (CA).
   The location update message is referred to as the binding update to
   be consistent with Mobile IP terminology. If requested by a MN, a
   Foreign Agent provides routing services to a MN, and sends and
   receives binding messages on behalf of the MN.  The COA of a MN can
   be a Foreign Agent or a temporary address the MN acquires when it
   visits a Foreign Network. ]








Expires January 2001                                            [Page 5]





Internet Draft       Intercepting Location Updates            July 2000


                  +-------------+
                  |correspondent|
                  |node         |
                  +-------------+
                           #
                           # packet sent to
                           # mobile node home address
                           #
                  +=============+
                  |correspondent|
                  |agent        |
                  +=============+
                   #       *
   At t0, packet #         * At t1 packet redirected to
   sent to     #           * care-of address of mobile node
   home addr #             *
           #               *
      +=====+              *
      |Home |              *
      |Agent|              *
      +=====+              *
         #                 *
         #                 *
      +------+          +------+           mobile node
      |mobile| - - - -> |mobile| - - - ->  moving away
      |node  |          |node  |           from home
      +------+          +------+           network

        t0                 t1    -------> time axis
      mobile node
      at home network
      at t0


   A MN or Foreign Agent notifies the CN that the MN has moved by
   triggering a binding update towards the CN. This update message is
   sent with the Router Alert Option, allowing the router (CA) serving
   the CN to intercept it and binds the mobile node's care-of address
   with the mobile node's home address. The details of this scheme is
   described in Correspondent Agent Operations.

4.0 Correspondent Agent Operations

   As described in the Introduction section, as a mobile node moves to a
   new location, it sends a Registration Request to its home agent,
   informing the home agent of its new care-of address. The home agent
   in turn sends a Binding Update message (setting the IP destination
   address of the message to the correspondent node address and



Expires January 2001                                            [Page 6]





Internet Draft       Intercepting Location Updates            July 2000


   including the Router Alert option in the IP packet) to notify the
   correspondent node of the mobile node new care-of-address. This
   Binding Update is intercepted by the last hop router (referred to as
   correspondent agent) to the correspondent node.

   To provide transparent optimal routing for the the correspondent
   node, and the benefits listed in the Introduction Section, the access
   router(s) serving the correspondent nodes MUST support the
   Correspondent Agent functions described here. Otherwise, the Binding
   Update message will reach the correspondent node.

   If the access routers in the network where the correspondent node
   resides supports the location hiding route optimization proposed
   here, the correspondent agent caches the mobility bindings as
   described in MIP-OPTIM, and tunnels data for the mobile node to the
   care-of address. If there are no correspondent agents in the access
   network, the location hiding route optimization has the same effect
   as MIP-OPTIM, i.e.  if the correspondent node supports MIP-OPTIM, it
   tunnels data for the mobile node to the care-of address.  If the
   correspondent node does not support MIP-OPTIM, packets addressed to
   the mobile node are routed via the home agent (i.e no route
   optimization), as in MIP.  In other words, this scheme is backward
   compatible with both MIP and MIP-OPTIM.




























Expires January 2001                                            [Page 7]





Internet Draft       Intercepting Location Updates            July 2000


                  +-------------+
                  |correspondent|
                  |node         |
                  +-------------+
                          #
                          # data addressed to
                          # mobile node home address
                          #
       Binding   +=============+
     Update (BU) |correspondent|
         ------->|agent        |
         |       +=============+
         |          #         *
         |        #           *
         |      #             *
         |    #               *
         |  #                 *
      +=====+  Registration   *
      |Home |  Request        *
      |Agent|<----------+     *
      +=====+           |     *
           #            |     *
           #            |     *
           # home       |     *
           # address    |     * COA
      +------+          |    +------+
      |mobile|          |   |mobile|
      |node  |          |-- |node  |
      +------+               +------+

      mobile node             mobile node
      at home network         at foreign network

   When a correspondent agent receives a Binding Update message, it
   caches the mobile node's home address and its care-of address, if the
   correspondent agent is the next hop to the care-of address, off this
   subnet. It should send an ICMP redirect message to the correspondent
   node, to redirect packets addressed to the mobile node to the
   correspondent agent. The redirect message should cause the
   correspondent node IP stack to add or update a route towards the
   mobile IP home address with the next hop set to the correspondent
   agent . This ensures that the correspondent node IP stack forwards
   datagrams addressed to the mobile node, to the correspondent agent
   instead of another gateway or router. Note that existing hosts can
   process the ICMP redirect message as required above.  According to
   RFC1122 on host requirements when receiving an ICMP redirect message,
   "A host receiving a Redirect message MUST update its routing
   information accordingly."



Expires January 2001                                            [Page 8]





Internet Draft       Intercepting Location Updates            July 2000


   If the correspondent agent is not the next hop to the care-of address
   it sends the Binding Update message to, the next hop router to the
   care-of address. The next hop router, which is referred to as the
   redirector, caches the mobile node's home address and its care-of
   address and acknowledges the binding update message. The collective
   functions of the binding update interceptor and data redirector shown
   in the figure below will be referred to as the correspondent agent.
   Note that here, the interceptor and redirector are not co-located,
   whereas in the scenario described in the preceding paragraph, the
   interceptor is also the the next hop to the care-of address i.e the
   interceptor and redirector are co-located.

   When the interceptor receives the acknowledgement message for the
   binding update from the redirector, it should send an ICMP redirect
   message to the correspondent node to redirect the packets addressed
   to the mobile node and the redirection router. The correspondent node
   processes the ICMP redirect message as described in the preceeding
   scenario where the interceptor and redirector are co-located.  If the
   correspondent node, interceptor and redirector are on the same LAN,
   the Binding Update to the redirector may be encrypted to prevent the
   correspondent node from obtaining the care-of address of the mobile
   node in the clear by snooping on binding update messages on the LAN.

                    +-------------+
                    |correspondent|
                    |node         |
                    +-------------+
                               #
                                 #  data addressed to
                                   #  mobile node home address
                                     #
                +=====================#============+
                |                      #           |
                | +===========+  BU   +==========+ |  Correspondent
                | |interceptor|------>|redirector| |  Agent
                | +===========+       +==========+ |
                |    ^                       *     |
                +====|=======================*=====+
                     |                       *
           Binding   |                       *
          Update(BU) |                       *
                  +=====+                    * COA
                  |Home |                   +------+
                  |Agent|<------------------|mobile|
                  +=====+     Registration  |node  |
                              Request       +------+
                                            at foreign
                                            network



Expires January 2001                                            [Page 9]





Internet Draft       Intercepting Location Updates            July 2000


5.0 Binding Messages

   In [MIP-OPTIM], it is not necessary to acknowledge Binding Update
   messages. This may result in the home agent needlessly retransmitting
   the binding update message to correspondent nodes that do not support
   these messages.

   Quoted from [MIP-OPTIM], "When a mobile node's home agent intercepts
   a datagram from the home network and tunnels it to the mobile node,
   the home agent may deduce that the original source of the datagram
   has no binding cache entry for the destination mobile node.  The home
   agent SHOULD then send a Binding Update message to the original
   source node, informing it of the mobile node's current mobility
   binding.  No acknowledgment for such a Binding Update message is
   needed, since additional future datagrams from this source node
   intercepted by the home agent for the mobile node will cause
   transmission of another Binding Update.  For a Binding Update to be
   authenticated by the original source node, the source node and the
   home agent must have established a mobility security association."

   We propose that the home agent be provisioned with 2 parameters
   "binding_update_retry count", "binding_update_abandon_count".

   "binding_update_retry count" is the count of packets received from
   the CN and addressed to the MN since the sending of the last binding
   update message to a correspondent node. It should be configured to be
   on the order of < 10 packets.

   "binding_update_abandon_count" is the count of binding updates sent
   from  the HA to a CN. The number determines when the HA should give
   up sending binding updates to CN at the "binding_update_retry_count"
   interval.  This parameter should be on the order of < 3.

   By using these parameters, the home agent can determine if it should
   send further Binding Update messages to a correspondent node.

   The same scheme should be used by Foreign agents and MNs(co-located
   FA) on the binding warning.


6.0 Constraining location update information to a domain or routing area

   When a mobile node or foreign agent sends a location update message
   (i.e Registration Request with Binding Warning Extension or Binding
   Warning) to the home agent, it should add the Router Alert Option to
   the location update message.  It is then possible for an
   "intermediate" router to intercept the location update message (i.e
   Binding Warning Extension message sent with the Registration Request



Expires January 2001                                           [Page 10]





Internet Draft       Intercepting Location Updates            July 2000


   message or Binding Warning) from the mobile node/foreign agent to the
   home agent and create a tunnel to the mobile node or foreign agent.

   The "intermediate" router should forward the update message towards
   the CN after changing the ip source address of the message to its own
   address. This allows the correspondent agent or node (if no agent) to
   setup a tunnel to the intermediate router instead. The advantage of
   allowing tunnels to be setup to intermediate routers is to reduce
   location update latency. If a MN moves within a domain, the binding
   update message does not have to travel all the way to the
   correspondent agent/node, i.e a tunnel does not have to be
   reconstructed from CA/CN to MN/FA when an MN moves. Using such a
   hierarchy of "foreign agents" in the networks such that update
   messages do not have to be relayed all the way to the Home Agent are
   advocated in HAWAII/CellularIP/REGIONAL-REG.

   This proposal facilitates the use of such "hierarchical foreign
   agents" by leveraging border routers or firewalls at the edges of a
   network domain to function as these "hierarchical foreign agents".
   Border routers or firewalls where the Registration Request message
   traverses on its way to the home agent can be configured to act as
   "gateway foreign agents".  Mobile nodes or foreign agents send
   location update (Registration Request) messages to the home agent as
   in the base Mobile IP specification, instead of having to send
   special "regional" registration messages to a "gateway foreign
   agent".

   The advantages of the scheme proposed here facilitate contraining
   location update messages to a region or domain include:

   * intra-domain mobility improvement is performed using the base
   Mobile IP messages.  No new registration messages (such as regional
   tunnel messages in REGIONAL-REG) are required. The Registration
   Request messages defined in RFC2002 can be used with the addition of
   Router Alert Option.

   * no assumptions are made about foreign nodes or mobile nodes being
   informed of a "gateway foreign agent" or foreign nodes or mobile
   nodes being configured with a default route to a "domain root
   router".

   * the "gateway care-of address" does not have to "flood a beacon
   periodically in the access network to allow base stations to create
   routes back to the gateway". To quote from Cellular IP, "All packets
   transmitted by mobile hosts regardless of their destination address
   are routed to the gateway using these routes."

   * no host-based forwarding (which has scalability issues) in internal



Expires January 2001                                           [Page 11]





Internet Draft       Intercepting Location Updates            July 2000


   routers of a foreign domain required, i.e no states are stored in
   internal routers.  In HAWAII, and quoted from the HAWAII draft "Each
   router in the path between the mobile host and the "domain root
   router" adds a forwarding entry for the mobile host".

   * foreign agents do not have to be configured with the domain
   "gateway foreign agent" and need not advertise the "gateway foreign
   agent". When the location update message traverses the border
   router/firewall of a domain on its way to the home agent, the
   "gateway foreign agent" function can be activated.

   * If the home agent is in the same network domain as the foreign
   agent or mobile node, the location update message goes directly to
   the home agent without having to be sent to a "gateway foreign agent"
   first.




































Expires January 2001                                           [Page 12]





Internet Draft       Intercepting Location Updates            July 2000


6.1 Location Update Message intercepted by border routers


6.1.1 Mobile node and correspondent node in different domains


                                 +-------------+
                                 |correspondent|
                                 |node         |
                                 +-------------+
                                         H
                                         H
                                         H
                     Binding   +=============+
                   Update (BU) |correspondent|
                       +------>|agent        |dddddddddddddddddd
                       |       +=============+                 d
          home         |                 a                     d
          address(H)   |                 a                     d
          +======+   +=====+             a                     d
          |mobile|   |home |             a         RR          d
          |node  |   |agent|             a    <----to home---+ d
          +======+   +=====+             a         agent     | d
                       ^                 a                   | d
               RR=COAa | aaaaaaaaaaaaaaaaa                   | d
                       | a                                   | d
                       | a COAa                              | d COAd
                     +======+  Registration                +======+
                     |Border|  Request (RR)                |Border|
                     |Router|<---------+                   |Router|
                     +======+cccccccc  |                   +======+
                       ^ b          c  |                     ^ e
               RR=COAb | b          c  | RR=COAc           RR| e
                       | b          c  |                     | e
                       | b  COAb    c  |     COAc            | e  COAe
                     +------+       c  |   +------+        +------+
                     |mobile|       c  +---|mobile|        |mobile|
                     |node  |       ccccccc|node  |        |node  |
                     +------+              +------+        +------+
                              --------->
                     mobile node moves to another          mobile node moves
                     location in the same foreign          to another
                     network domain                        foreign domain


              i) Mobile node and correspondent node in different domains
             ii) Mobile node moves to different domain




Expires January 2001                                           [Page 13]





Internet Draft       Intercepting Location Updates            July 2000


   A provider may configure these "intermediate" routers e.g border
   routers or firewalls, to process the update message and setup
   tunnels. Intermediate routers may setup tunnels towards the mobile
   node if configured to do so. In most operation networks, only border
   routers or firewalls and the serving router (correspondent agent) of
   the correspondent node may need to setup these tunnels.  The update
   message will be terminated at a router which already has a tunnel for
   this mobile node. The "intermediate" router which intercepts the
   update message sets up a tunnel to the care-of address of the mobile
   node (or the foreign agent)

   When the mobile node moves within a foreign network domain e.g moving
   from one cell to another, the update message may be intercepted at a
   border router within the foreign network. The update message does not
   have to be relayed to the home agent because the care-of address
   (COAa), from the home agent perspective has not changed.  When the
   mobile node moves from one mobile network into another mobile
   network, the update message will reach another border router. This BR
   sends an update message towards the home agent to inform the home
   agent that the tunnel endpoint has changed. The BR setup a tunnel to
   the COA of the mobile node or FA. The home agent sends a binding
   update message towards the correspondent node. The correspondent
   agent or node may set up a tunnel to the BR.




























Expires January 2001                                           [Page 14]





Internet Draft       Intercepting Location Updates            July 2000


6.1.2 Mobile node and correspondent node in the same domain

   If a mobile node is not in its home domain, and a node in the foreign
   domain initiates communication with the mobile node, data addressed
   to the mobile node home address from this foreign domain will be
   redirected to the local co-located care-of address (COAb in this
   case), as shown below. The location update (Registration Request)
   message may be intercepted by a border router (BR#1) for this foreign
   domain, and BR#1 redirects data to the mobile node by sending a
   Binding Update message towards the correspondent node.  BR#1 is
   acting as a "proxy" home agent - the correspondent agent/node should
   be able to trust, or authenticate BR#1 if necessary. For instance,
   all border routers serving a domain can be provided with a "private
   key" and can be authenticated by any nodes within the domain using
   the "public key". If the mobile node moves to another location within
   this foreign network, BR#1 intercepts the Registration Request from
   the mobile node or foreign agent and sends a Binding Update message
   with the new COA (which may be a private address) towards the
   correspondent node.

          home
          address(H)
          +======+   +=====+
          |mobile|   |home |
          |node  |   |agent|
          +======+   +=====+
                       ^
                RR=COAa|
                       |
                       |   COAa
                     +======+
                     |Border|HHHHHHHHHHHHHHHHHHHHHHHHH
                     |Router|    BU=COAb             H
                     |#1    |----------------------+ H
                     |      |                      | H
                     +======+                      | H
                       ^ b                         | H
                RR=COAb| b                 BU=COAb | H
                       | b                         | H
                       | b  COAb                   V H
                    +------+             +-------------+        +-------------+
                    |mobile|             |correspondent|        |correspondent|
                    |node  |bbbbbbbbbbbbb|agent        |HHHHHHHH|node         |
                    +------+             +-------------+        +-------------+

                     mobile node and correspondent node in
                     the same foreign domain
                     (Note: BU - Binding Update)



Expires January 2001                                           [Page 15]





Internet Draft       Intercepting Location Updates            July 2000


   A more efficient way of notifying the correspondent node in the same
   domain is by sending the location update message (eg Binding Update)
   directly towards the correspondent node, but this approach places
   more burden on the mobile node.  Nevertheless, it is possible to have
   BR#1 send the list of correspondent nodes that it has redirected
   within the domain in the Registration Reply message to the mobile
   node. This allows the mobile node to send Binding Update messages
   directly (if necessary, to further reduce handoff latency) to the
   correspondent nodes, subsequently when it moves to another location
   within the domain.  Otherwise data from within this domain, addressed
   to the mobile node is routed via BR#1.








































Expires January 2001                                           [Page 16]





Internet Draft       Intercepting Location Updates            July 2000


6.1.2.1 Mobile node and correspondent node in the mobile node's home
domain

   Even when the location update message has to be sent via BR#1, the
   handoff latency is still less than if the local correspondent nodes
   have to be notified via a home agent which is not in the same domain.
   If the home agent is in the same domain, the location update (
   Registration Request) message is forwarded to the home agent without
   having to go through a border router, as shown below.  In both cases
   (figure above and below), subsequent data (after being notified of
   new location) addressed to the mobile node from within this domain is
   routed directly to the mobile node (not via BR#1 or home agent).


             +======+
             |home  |<HHHHHHHHHHHHHHHHHHHHHHHH
             |agent |    BU=COAb             H
             |      |----------------------+ H
             +======+                      | H
               ^ b                         | H
        RR=COAb| b                 BU=COAb | H
               | b                         | H
               | V  COAb                   V H
             +------+              +-------------+        +-------------+
             |mobile|              |correspondent|        |correspondent|
             |node  |<bbbbbbbbbbbbb|agent        |<HHHHHHH|node         |
             +------+              +-------------+        +-------------+

             mobile node and correspondent node in the
             mobile node's home domain

   In Cellular IP/HAWAII, route entries are being created at every hop
   between the mobile node and the "gateway care-of address" or "root
   domain router". Hence Cellular IP/HAWAII require states in the
   internal routers leading towards the mobile nodes, and the number of
   states in the internal routers of the mobile network grows as the
   number of mobile nodes increases.  In this proposal, mobility
   bindings are only created at the edges of the mobile network, i.e at
   "border router or gateway" and the foreign agent/mobile node.
   Therefore, apart from having no host route states in the internal
   routers, the time required to propagate the "path towards the mobile
   node's new location" is also reduced, since there is no need to
   create a route entry at every hop (where the route does not already
   exist).

   The handoff support described here is optional. The route
   optimization scheme proposed here (using a correspondent agent) is
   independent of the type of intra-domain mobility or



Expires January 2001                                           [Page 17]





Internet Draft       Intercepting Location Updates            July 2000


   micromobility/fast handoff support used in a foreign network. A
   foreign network may use a different micromobility technology as long
   as the border router or "root domain router" or gateway care-of
   address is able to add Router Alert Option to the location update
   messages (Registration Request or Binding Update).

7.0 Data Transmission from correspondent node to mobile node

   As shown in preceding figures, a correspondent node may send data to
   a mobile node transparently, setting its IP destination address to
   the mobile node home address, H.

   The initial data will reach the home agent. If the mobile node is not
   in its home network, this triggers a Binding Update message from the
   home agent to notify the correspondent node of the mobile node's
   current location. As decribed in preceding sections, the Binding
   Update message is intercepted by the correspondent agent, which
   caches the mobile node's home address and care-of address (i.e the
   mobility binding).

   When a correspondent agent receives subsequent data addressed to the
   mobile node, it tunnels the data to the mobile node's care-of address
   by :

   a) encapsulating the data in another header e.g IP-IP, GRE. The ip
   source address of the outer header is set to the correspondent agent
   and the ip destination address is set to the care-of address.  Data
   is decapsulated at the care-of address, i.e at the foreign agent
   (which forwards the data to the mobile node) or mobile node.

   OR

   b) changing the ip destination address from the mobile node's home
   address to the care-of address at the correspondent agent; and
   restoring the ip destination address to the mobile node's home
   address at the foreign agent. This does not require data to be
   encapsulated and is referred to as "zero byte overhead tunneling".

   "Zero byte overhead tunneling" is most appropriately and naturally
   used at firewalls, e.g the correspondent agent could be a firewall to
   the correspondent node's provider network; and the foreign agent
   could be a firewall to the foreign network.  When a correspondent
   agent receives a Binding Update, it sets up a "filter" that is
   defined to match the mobile node home address and translates the ip
   destination address to the care-of address.  When the correspondent
   agent receives data addressed to the mobile node, existing firewall
   functions will match and translate the data according the specified
   "filter".  Similarly when a foreign agent receives a Registration



Expires January 2001                                           [Page 18]





Internet Draft       Intercepting Location Updates            July 2000


   Request message, it configures a filter such that the firewall can
   match and restore a packet (addressed to the mobile node's care-of
   address) back to the mobile node's home address.  It should be noted
   that unlike Network Address Translation (NAT), the IP addresses are
   preserved end to end. Hence, functions which depend on the
   preservation of IP addresses end to end can be used in conjunction
   with "zero byte overhead tunneling".

   In (a), a care-of address may be used by several mobile nodes in the
   network served by the foreign agent. The foreign agent decapsulate
   the packet and sends the data to the mobile node's home address
   specified in the inner header IP destination address. This reduces
   the number of care-of addresses that must be provided by a foreign
   network.  In (b), since the mobile node's home address is not
   provided in the IP header, the care-of address used must be uniquely
   mapped to the mobile node in the foreign network, i.e a co-located
   care-of address (CCOA) must be used. Otherwise the foreign agent is
   not able to restore the COA back to the mobile node's home address. [
   Note: Alternatively, a scheme which can map the mobile node's home
   address to a COA and a unique port may be used.  In this case, the
   location update messages and mobility bindings have to be modified to
   accommodate the port number in addition to the COA. Again, the
   original IP address and port number are restored at the edge of the
   network.]

   Another variation of tunneling data is to encapsulate data to the
   "border router" and use "zero byte overhead tunneling" to the mobile
   node. This may be useful where firewalls functions is not available
   at the correspondent node's network. Further, if the CCOA used are
   private addresses within the foreign domain, this variation allows
   data to be encapsulated to the public COA at the "border router" and
   "zero byte overhead tunneled" to the private CCOA of the mobile node.
   This approach is suitable when a foreign network uses private
   addresses but is subject to the same NAT constraints as other
   applications in the foreign network.  (Note this involves the
   translation of public mobile node addresses to private care-of
   addresses).

8.0 Data Transmission from mobile node to correpondent node

   Data can be routed from a mobile node to a correspondent node using
   normal routing. However, "ingress filtering" [RFC2267] e.g at the
   firewall to the foreign network may prevent a mobile node from using
   its home address as the source IP address of data it sent to a
   correspondent node.  In the case where the correspondent node is in
   the mobile node's home domain and the mobile node is in a foreign
   network, firewalls at the mobile home network may prevent packets
   from the mobile node (where the ip source address is set to the



Expires January 2001                                           [Page 19]





Internet Draft       Intercepting Location Updates            July 2000


   mobile node's home address) from entering its home network.

   RFC2344 described "reverse tunneling" as a way of overcoming these
   problems. However data must be tunneled from the mobile node back to
   the Home Agent before the packet can be routed "normally" to the
   correspondent node.  This proposal provides an opportunity for the
   reverse tunnel route to be optimized, by allowing data to be tunneled
   to either the correspondent agent or correspondent node (if the
   correspondent node is capable of decapsulating data).  Again, data
   can be tunneled using IP encapsulation or "zero byte overhead
   tunneling" described in the section on "Data Transmission from
   correspondent node to mobile node".

   However, this time, the source address of the tunnel is set to the
   COA - i.e when data is encapsulated, the source address of the outer
   IP header is set to the COA; when "zero byte overhead tunneling" is
   used, the IP source address is set the co-located COA (CCOA).  This
   allows data from the mobile node to enter its home network.  Note
   that the tunnel endpoint is the correspondent agent's address; i.e
   the destination address of the outer IP header is set to the
   correspondent agent's address if the packet is encapsulated.  In the
   case of "zero byte overhead tunneling", the destination address is
   the CN's address, however the CA restores the source IP address at
   the CN's network.  The correspondent agent either decapsulates the
   packet if the packet is encapsulated or rewrite the source address
   (i.e. swapping CCOA with MNs Home IP), if the packet is tunneled
   using "zero byte overhead tunneling".


8.1 Correspondent node initiates data transmission to mobile

   If the correspondent node initiates data transmission to the mobile
   node in the foreign network, the Binding Update/Ack exchange process
   between the home agent and correspondent agent/node enables the home
   agent to learn about the correspondent agent/node address (from the
   IP source address of the Binding Acknowledge message). Note that the
   home agent must set the 'A', Acknowledge bit in the Binding Update
   message to receive an acknowledgment.  The home agent should send a
   Binding Warning Acknowledge message towards the mobile node/foreign
   agent, to indicate the tunnel endpoint of the correspondent node.
   This Binding Warning Ack message is a new addition to the Binding
   messages in [ROUTE-OPTIM].

8.2 Correspondent node initiates data transmission to mobile

   If the mobile node in the foreign network initiates transmission to a
   correspondent node, the mobile node/foreign agent is not able to
   deduce the tunnel endpoint of the correspondent node a priori as



Expires January 2001                                           [Page 20]





Internet Draft       Intercepting Location Updates            July 2000


   described above. In this case it may use the [REVERSE-TUNNEL]
   mechanism via the home agent initially. The mobile node should send a
   Binding Warning message to the home agent to trigger a Binding Update
   to the correspondent node/agent.  When the home agent receives the
   Binding Warning or a "reverse tunneled" datagram from the mobile, it
   sends a Binding Update towards the correspondent node, allowing the
   home agent to learn the tunnel endpoint address of the correspondent
   node (via the Binding Ack mesage) in the process. The home agent
   relays the tunnel endpoint address to the mobile node subsequently.
   Thereafter, the mobile node can send data to the tunnel endpoint of
   the correspondent node instead of tunneling data (destined to the
   correspondent node) to the home agent.

   Subsequent to the case above, the home agent sends a Binding Warning
   Ack message containing the tunnel endpoint (which may be the
   correspondent node or agent) to the COA, if the mobile node indicates
   that it wants to tunnel to the correspondent node in its Registration
   Request or Binding Warning message (either the reserved bits are
   used, or an extension message can be defined for this purpose).  Data
   addressed to the correspondent node may then be sent to the
   correspondent node or its tunnel endpoint.

8.3 Tunneling from mobile to correspondent node

   The Binding Ack message from the tunnel end-point to the HA will list
   the various tunneling options (zero byte overhead tunneling or
   encapsulation eg IPinIP, etc.) that can be handled or preferred. The
   home agent in turn conveys this information to the MN/FA via the
   Binding Warning Ack message. Once the Binding Warning Ack message is
   received, the MN/FA determines the tunneling choice and subsequent
   data towards the CN are sent using this tunneling scheme.

   If the chosen tunneling option for data sent from MN to CN is
   encapsulation, the IP addresses are set as follows:

   Outer IP header

   - IP source = COA/CCOA of the MN

   - IP destination = CN tunnel endpoint

   Inner IP header

   - IP source = home address of MN

   - IP destination = address of CN

   When data is sent from MN to CN using "zero byte overhead tunneling",



Expires January 2001                                           [Page 21]





Internet Draft       Intercepting Location Updates            July 2000


   the IP addresses are set as follows:

   IP header

   - IP source = CCOA of the MN

   - IP destination = address of CN

   Here, the CA restores the source IP (from CCOA to MNs home address)
   at the correspondent node's network.

8.4 To tunnel or not to tunnel ?

   A mobile node can determine if it needs to tunnel datagram to a
   correspondent node from information provided by the foreign agent
   (via for e.g Agent Advertisements) and the home agent.  The mobile is
   required to tunnel datagram to the correspondent node if the foreign
   or home network filters a datagram with source address that does not
   belong to the network where the datagram is emanating from.  In
   constrast, whether a datagram sourced from the foreign domain can
   traverse a correspondent domain (not in the home domain or foreign
   domain) is an issue between these two domain and is independent of
   Mobile IP.

9.0 Security

   As described in MIP-OPTIM, "All operation of Route Optimization that
   changes the routing of IP datagrams to the mobile node is
   authenticated using the same type of mechanisms defined in the base
   Mobile IP protocol." The same applies here. Hence, since the Binding
   Update must be authenticated by the CA, the CA (or CA network
   provider) and the HA (or HA network provider) must establish mobility
   security association.  If there are more than one correspondent nodes
   on a subnet communicating with a mobile node, only one mobility
   security association need to be established between the correspondent
   agent and the home agent.

   If the Binding Update is intercepted and modified at intermediate
   routers (for intra-doman mobility) then the intermediate
   routers/proxy home agent and the foreign agent/mobile node must
   establish mobility security association as in REGIONAL-REG.  Usually
   the intermediate routers or "border routers" are in the same domain
   as the foreign agent and this facilitates the establishment of
   mobility security association. The mobile node and foreign agent must
   have security association as decribed in RFC2002.

   [Note: For insecure LAN environment such as cable LAN, there should
   be security association between correspondent node and correspondent



Expires January 2001                                           [Page 22]





Internet Draft       Intercepting Location Updates            July 2000


   agent. The correspondent node should authenticate the correspondent
   agent before updating its routing information when an ICMP redirect
   message is received from the correspondent agent.  However, the
   problem to be solved here is a more generic one between hosts and
   routers, when a host receive an ICMP redirect message on an untrusted
   LAN, it should only update its routing table if it trusts the router
   originating the ICMP redirect message.  This is not currently
   specified in the Host Requirement for IPv4 RFC but should be
   addressed in future ].

   If the interceptor and redirector routers are not co-located, these
   routers can use the same type of scheme used to verify the
   authenticity of messages from routers (e.g MD5).

10.0 MPLS Considerations

   If MPLS is used in correspondent nodes' network, the functions of
   correspondent agents can be located in the LERs (Label Edge Routers).
   LSPs can be setup the same way as "tunnels" are setup between
   correspondent agents and foreign agents or intermediate routers at
   the edge of the MPLS domain. Since an LSP can be setup between a
   correspondent agent and a foreign agent (the LERs), this allows for
   traffic aggregation between the LERs. In addition it allows
   constrained based routing of traffic and "QOS" path between the
   agents. These LSPs setup can be triggered by the Binding Update
   messages, by data transmitted, configured a priori or by other means.

11.0 IPv6 Considerations

   The same concepts can be applied to IPv6. The encryption mechanisms
   of IPv6 coupled with the present draft for mobility may need to be
   altered in order to ensure complete security. A separate contribution
   for IPv6 will soon follow.

12.0 Trusted Correspondent Nodes

   Certain nodes that are supplied by the service provider or perhaps
   some consortia of service providers will not need to be shielded by a
   correspondent agent as they are owned or associated with the same
   entity which is entrusted as the correspondent agent. Examples of
   these devices include: daemons associated with routers, session
   servers, PSTN gateway devices and conferencing/multicast related
   hosts and routers. This can be achieved via administrative
   configuration of specific interfaces on specific routers to which
   these trusted nodes have connectivity.

13.0 Mobile Correspondent Nodes




Expires January 2001                                           [Page 23]





Internet Draft       Intercepting Location Updates            July 2000


   The CA is combined with the FA when the correspondent nodes are
   mobile.

14.0 Incremental Deployment

   The technique assumes that access routers of correspondent nodes are
   altered to include the CA function within a service provider's
   network or consortia of service provider's network.  In practice,
   since traffic to and from a mobile has to go through firewalls, it is
   possible to deploy the CA function at firewalls as an incremental
   deployment strategy.

15.0 Acknowledgments

   The authors would like to thank Krish Pillai, Bill Gage, Emad
   Qaddoura, Mohamed M.Khalil, Haseeb Akhtar and Richard Patchet for
   their helpful comments.



References

   The following references are available at www.ietf.org

   [MIP]                   rfc2002.txt

   [MIP-OPTIM]             draft-ietf-route-optimization-09.txt

   [ROUTER-ALERT]          rfc2113.txt

   [REVERSE-TUNNEL]        rfc2344.txt

   [REGIONAL-REG]          draft-ietf-mobileip-reg-tunnel-02.txt

   [HAWAII]                draft-ietf-mobileip-hawaii-00.txt

   [CELLULAR-IP]           draft-ietf-mobileip-cellularip-00.txt



Authors' Information

   Cheng-Yin Lee, leecy@nortelnetworks.com

   Glenn Morrow, gmorrow@nortelnetworks.com

   Fayaz Kadri, fayaz@nortelnetworks.com




Expires January 2001                                           [Page 24]


