
IETF Mobile IP Working Group				Shiao-Li Tsao
   						  	  Jen-Chi Liu
INTERNET-DRAFT					      	    CCL, ITRI
 						       Wolfgang Boehm
 						 	      Siemens
   						 	 24 Nov. 2000
   
   
   Mobility Support for IPv4 and IPv6 Interconnected Networks 
   		based on Dual-Stack Model
   	<draft-tsao-mobileip-dualstack-model-01.txt>

Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups. Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six
   months and may be updated, replaced, or obsoleted by other documents
   at any time. It is inappropriate to use Internet- Drafts as
   reference material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at:
        http://www.ietf.org/ietf/1id-abstracts.txt

   The list of Internet-Draft Shadow Directories can be accessed at:
        http://www.ietf.org/shadow.html.

   This document is an individual submission for the mobile-ip Working 
   Group of the Internet Engineering Task Force (IETF).  Comments 
   should be submitted to the MOBILE-IP@STANDARDS.NORTELNETWORKS.COM 
   mailing list.

Abstract 
   
   To support IP mobility, mobile IPv4 was designed for IPv4 network 
   and the mobility extension for IPv6 has been also drafted. However, 
   mobile IPv4 and mobile IPv6 are not compatible to each other so 
   that a mobile IPv4 node can not function properly while it changes 
   its point of attachment to IPv6-only networks and vice versa. The 
   document specifies mechanisms to solve mobility problems in IPv4 
   and IPv6 interconnected networks. The presented solutions are based 
   on IPv4/IPv6 dual stack model and further implement a new address 
   mapper on mobile nodes. The address mapper on a mobile node 
   associates the home address in one protocol, e.g. IPv4, with a 
   care-of-address in the other protocol, e.g. IPv6. It receives IP 
   packets in different IP versions and dispatches them to the correct 
   upper layers or vice versa. Then, the transparent services to upper 
   layers regardless of the attached networks are provided. The new 
   mechanisms facilitate the mobility in IPv4 and IPv6 interconnected 
   networks. 


1. Introduction
   
   Mobile IP aims to solve addressing and packet routing problems 
   while a mobile node changes its point of attachment to a new 
   network but still wants to communicate with other nodes by its 
   original address [1][2]. For a mobile node moves to a new network, 
   the packets to the original address can not be routed to the new 
   network since the network has a different network prefix as its 
   home network. To solve this problem, mobile IP is proposed. Mobile 
   IPv4 was designed for Internet Protocol version 4 (IPv4) as well as 
   mobile IPv6 has been also drafted for IPv6. Mobile IPv6 shares many 
   ideas in mobile IPv4, and inherits some new features in IPv6. 
   However, mobile IPv6 is not backward compatible to mobile IPv4 and 
   the mobility issues in IPv4/IPv6 interconnected networks are 
   ignored in the present RFCs and Internet drafts. In this Internet-
   Draft, problems are descriped. Solutions implemented on mobile 
   nodes are also presented.
   
2. Problem Description and Assumption
 
   Suppose that a mobile node implements IPv4/IPv6 dual stack. It may 
   have an IPv4 address, an IPv6 address, or both of them. Each mobile 
   node uses a global unique address to communicate with others and
   it is allowed to change its point of attachment to other links. 
   
   Consider a scenario that an IPv4 mobile node (MN) with IPv4/IPv6 
   dual stack talks to an IPv4 correspondent node (CN). The IPv4 MN may
   moves to an IPv6 network. If the IPv6 network does not support 
   IPv4/IPv6 routers or does not implement mobile IPv4 mechanisms, all 
   mobile IPv4 mechanisms will fail. While a mobile IPv4 node changes 
   its point of attachment to a new network, it expects to receive 
   agent advertisement messages in the visited network. However, the 
   IPv6 network does not broadcast such messages so that the mobile 
   IPv4 node can not detect the movement and fails in registration. The
   situation is similar for an IPv4 mobile node with IPv4/IPv6 dual stack 
   talking to IPv6 nodes and moving from its IPv4 home network to an 
   IPv6-only network. 
   
   Consider a different type of scenario that an IPv6 mobile node (MN) 
   with IPv4/IPv6 dual stack talks to an IPv6 correspondent node (CN). 
   An IPv6 mobile node changes its point of attachment to an IPv4-only 
   network, and it expects to receive router advertisement messages. 
   Unfortunately, the IPv4-only network does not support IPv6 router 
   advertisement so that the registration procedure is also failed. The
   case is similar to that an IPv6 MN with IPv4/IPv6 dual stack talking 
   to an IPv4 CN moving from an IPv6 network to IPv4-only networks.
   
   In this Internet-Draft, mechanisms are proposed to solve this type 
   of problem, i.e. an IPv4 mobile node with dual stack moving to an 
   IPv6-only network or an IPv6 mobile node moving to an IPv4-only 
   network. The basic assumption is that mobile nodes are IPv4/IPv6 
   dual stack enabled, and they use IPv6 or IPv4 address to communicate 
   with others. A new address mapper is introduced in mobile nodes. 
   The address mapper initiates registration, binding, and etc. 
   procedures while it detects the movement to new networks in different 
   IP version. It obtains a care-of-address in the visited network, and 
   associates the home address of one IP version with the care-of-address 
   of the other IP version. Then, the address mapper can dispatch IPv4/IPv6 
   packets and mobile IPv4/mobile IPv6 messages to correct layers, and 
   provides transparent services to upper layers regardless of the 
   attached networks. Therefore, the mobility can be provided in IPv4 
   and IPv6 interconnected networks. 
      
3. Terminology 
   
   IPv4-only network 
   An network implements only IPv4 and mobile IPv4. It can understand 
   and process IPv4 packets and mobile IPv4 messages but can not 
   understand IPv6 and mobile IPv6. 
   
   IPv6-only network 
   An IPv6 network implements only IPv6 and mobile IPv6. It can 
   understand IPv6 packets and mobile IPv6 messages. However, it can 
   not understand IPv4 and mobile IPv4. 
   
   IPv4 mobile node
   A node has IPv4/IPv6 dual stack and registers a global unique 
   IPv4 address as its address. The node can change its point of 
   attachment from one link to another, while still being reachable 
   via its IPv4 address. 
   
   IPv6 mobile node
   A node has IPv4/IPv6 dual stack and registers an IPv6 address as its
   global unique address. The node can change its point of attachment 
   from one link to another, while still being reachable via its IPv6 
   address. 
   
   IPv4/IPv6 protocol translator
   A node, that can convert IPv4 packets to IPv6 packets and vice 
   versa, facilities communications between IPv4 nodes and IPv6
   nodes.
   
   IPv4/IPv6 DNS 
   A domain name server that has IPv4 to IPv6 and IPv4 to IPv6 
   address mapping can provide address look up services to nodes. 
   
4. Dual stack model
   
   The document specifies mechanisms on mobile nodes. Besides 
   IPv4 and IPv6 protocols with mobile IPv4 and mobile IPv6 
   extensions, the stack implements a new address mapper. The  
   protocol stack on mobile nodes is depicted in Figure 1. The two 
   network protocols, i.e. IPv4 and IPv6, process IPv4 and IPv6 
   packets from/to the correspondent nodes respectively. Mobile IPv4 
   and mobile IPv6 are the extensions that process mobile IPv4/mobile 
   IPv6 messages. 
   
   The address mapper locates between mobile IP layers and IP layers. 
   It can gets mobile IP messages and forward mobile IP messages
   to different IP protocols. So the address mapper can detect 
   the movement between IPv4 and IPv6 networks, and it also can 
   deliver mobile IPv4 messages by using IPv6 head. In this draft,
   the address mapper initiates the registion, binding, and etc. 
   procedures while the node detects the movement to networks with 
   a different IP version. The address mapper makes an assocattion 
   of home address of one IP version and the care-of-address of the 
   other IP version. Then, it can dispatch IPv4/IPv6 packets to correct 
   layers, and provide a transparent service to upper layer protocols. 

   +----------------------------+-------------------------------+
   |				|				|
   |	IPv4 Applications	|	IPv6 Applications	|
   |				|				|
   +----------------------------+-------------------------------+
   |			Socket v4/v6 Interfaces			|
   +------------------------------------------------------------+
   |								|
   |			TCP	/	UDP			|
   |								|
   +------------------+---------+---------+---------------------+
   |   Mobile IPv4    |		|         |     Mobile IPv6     |
   +------------------+         |         +---------------------+
   |                   	  Address Mapper                   	|
   +----------------------------+-------------------------------+
   |				|				|
   |		IPv4		|		IPv6		|
   |				|				|
   +----------------------------+-------------------------------+
   |								|
   |			Physical and Link Layers		|
   |								|
   +------------------------------------------------------------+
   
   Figure 1. Dual stack architecture on mobile nodes.
   
5. Scenarios

5.1 Movement from IPv4 network to IPv6-only network

   The first scenario is that a mobile node registered an IPv4 address 
   as its home address moves to an IPv6-only network. It is important to
   note that we assume mobile nodes are IPv4/IPv6 dual stack. The 
   mobile node can receive and transmit packets in its 
   home IPv4 network. While it moves to an IPv6-only network, it can 
   receive router advertisement from IPv6 routers via its own IPv6 
   protocol stack. The address mapper receives the IPv6 packets and 
   detects that it moves to an IPv6-only network. The IPv6 stack 
   generates an IPv6 link-local care-of-address by using subnet prefix 
   of the visited network. 
 
   Once the mobile node obtains an IPv6 care-of-address, it resolves 
   an IPv4 address by the IPv6 address and also obtains the IPv6 
   address of its IPv4 home agent. The IPv6 care-of-address and its 
   mapped IPv4 address must be co-located addresses allocated by 
   the visited network using any mechanism. The mapping between 
   IPv6 and IPv4 addresses can be obtained by issuing DNS queries. 
   
   The allocation of the care-of-address in the visited network can be 
   static assignment or dynamic allocation. The generation of the IPv6 
   address and the mapping of IPv4 and IPv6 addresses are out of scope 
   of this document. The related information can be found in 
   [3][4][5][6][7]. 
   
   The address mapper in the mobile node constructs a mobile IPv4 
   registration message and transmits it to its home agent through an 
   IPv6-only network. The mobile IP messages are generated by mobile 
   IPv4 protocol stack on the mobile node but these messages are carried
   by using IPv6. In other words, these messages are through IPv6 protocol
   stack on the mobile node (mobile IPv4 messages with IPv6 header). 
   We assume that the protocol translation is done by the IPv4/IPv6 
   protocol translator or other similar mechanisms provided by the 
   network. Home agent receives the registration message and can 
   update its care-of-address. Therefore, packets to the mobile node 
   can be transmitted to the node with the new IPv4 care-of-address 
   directly. It is important to know that all IPv4 packets to the 
   IPv4 care-of-address will be translated into IPv6 packets with the 
   IPv6 care-of-address by the IPv4/IPv6 protocol translator. Then, 
   the IPv6 packets are delivered to the IPv4 mobile node via its IPv6 
   stack. 
      
   We consider the packet flows in the protocol stack on a 
   mobile node. The packets received in the home network are through 
   the IPv4 stack. Once it moves to IPv6-only network, it received packets 
   via the IPv6 stack. The address mapper receives the packets, 
   detects the movement to an IPv6-only network, and generates registration 
   packets to its home agent. The address mapper also makes an 
   association of the original IPv4 address and the new IPv6 care-of- 
   address. After registering in the home agent, packets from 
   correspondent nodes to the care-of-address will be delivered to the 
   IPv4/IPv6 protocol translator, translated into IPv6 packets and 
   forwarded to the mobile node. Here, the IPv4/IPv6 protocol translator 
   only translates the IPv4 and IPv6 headers. We assume that the IPv4/IPv6 
   translator has the information about the address mapping.
   
   Packets to the new address will be forward to upper layers by the 
   address mapper. The procedures for an IPv4 node which migrates from 
   an IPv4 network to an IPv6-only network are summarized as :
   
o  In IPv4 network, IPv4 packets are received and processed by IPv4 
   protocol stack on a mobile node. 
   
o  The mobile node, which moves to an IPv6 network, receives the 
   router advertisement from IPv6 router via the IPv6 protocol stack. 
   
o  The mobile node obtains an IPv6 care-of-address by certain mechanisms 
   in the visited network. It resolves the IPv4 address by the IPv6 
   address, and obtains the IPv6 address of its home agent. The 
   mechanisms to obtain an IPv6 care-of-address and the mapping between 
   IPv6 and IPv4 addresses are out of scope of the document. 
   
o  The address mapper generates mobile IPv4 messages to register its new 
   IPv4 care-of-address to its home agent. The mobile IPv4 messages are 
   through IPv6 stack in mobile node, i.e. they are carried by the 
   IPv6-only network. (Mobile IPv4 messages with IPv6 headers)
   These IPv6 packets are translated into IPv4 packets 
   and forwarded to correspondent nodes by the IPv4/IPv6 network 
   translator. The address mapper then makes an association of the 
   original IPv4 home address and the new IPv6 care-of-address. 

o  Packets to the mobile node are first routed to its home network. Home 
   agent tunnels the packets to the IPv4 care-of-address. The IPv4 packets
   are translated to IPv6 packets by IPv4/IPv6 translator. Then, IPv6
   packets are delivered to the mobile node. 
   
o  The mobile node receives packets via its IPv6 stack in the visited 
   IPv6-only network. The packets are forwarded and dispatched by the 
   address mapper to upper layers. 
   
5.2 Movement from IPv6 network to IPv4-only network
   
   Another scenario is that a mobile node registered an IPv6 address 
   moves to an IPv4-only network. Suppose a mobile node registers an IPv6 
   address and moves to an IPv4-only network, the mobile node receives 
   foreign agent advertisement messages from the IPv4 protocol stack. 
   The address mapper detects the movement to an IPv4 network. The 
   address mapper obtains a co-located IPv4 care-of-address by certain 
   mechanisms. 

   Once it has an IPv4 care-of-address, it resolves the IPv6 address 
   by the IPv4 address and also obtains the IPv4 address of its home 
   agent located in an IPv6 network. The IPv4 care-of-address can be 
   obtained by DHCP or some other dynamic address allocation schemes 
   [4][5]. The address mapping can be obtained by IPv4/IPv6 DNS [4]. 
   Above two issues are out of the scope of this document. 
   
   After the address mapper resolves the addresses, it generates 
   mobile IPv6 registration messages and sends these messages to 
   its home agent via its IPv4 stack. Besides that, it also generates 
   mobile IPv6 binding messages to correspondent nodes and home agents. 
   It is important to know that the mobile IPv6 messages are 
   carried by IPv4 network. (Mobile IPv6 messages with IPv4 headers)
   These IPv4 packets will be transmitted through IPv4 networks, 
   translated by IPv4/IPv6 protocol translator and then routed to the 
   IPv6 home agents and correspondent nodes. Here, the IPv4/IPv6 protocol 
   translator only translates the IPv4 and IPv6 header. We assume that 
   the IPv4/IPv6 translator has the information about the address mapping.
   Therefore, packets to/from the mobile nodes can be routed by the new 
   IPv4 care-of-address through the IPv4 network. 
   
   The IPv4 care-of-address is associated with the home IPv6 address 
   in the protocol stack on the mobile node. Packets of home IPv6 
   address and IPv4 care-of-address are dispatched to the upper layer 
   by the address mapper. The procedures to move from IPv6 to IPv4-only 
   networks are summarized as :
   
o  In IPv6 network, IPv6 packets are received and processed by IPv6 
   protocol stack on a mobile node. 
   
o  The mobile node, which moves to an IPv4-only network, receives the 
   agent advertisement from mobile IPv4 foreign agent via the IPv4 
   protocol stack. 
   
o  The mobile node obtains an IPv4 care-of-address by certain mechanisms. 
   It resolves the IPv6 address by the IPv4 address, and obtain the IPv4 
   address of the mobile IPv6 home agent. The mechanisms to obtain an IPv4
   address and the translation between IPv4 and IPv6 addresses are out
   of scope of the document. 
   
o  The address mapper generates mobile IPv6 messages, registers the 
   care-of-address in IPv6 to its home agent and updates binding 
   information to home agents and correspondent nodes. (Mobile IPv6 
   messages with IPv4 headers) The address mapper then makes an 
   association of the original IPv6 address and the IPv4 care-of-
   address address. 

o  Packets to the mobile node may go to its home network, and then
   are tunnelled to the IPv4 care-of-address. The IPv6 packets are translated
   to IPv4 address by the IPV4/IPv6 translator and then delivered to the
   mobile node. Packets to the mobile node may go to the IPv4 care-of-address 
   directly if the binding is updated on the correspondent node. The IPv6 
   packets still have to be translated to IPv4 packets and then delivered 
   to the mobile node.  
   
o  The mobile node receives IPv4 packets from the visited network. The 
   packets are forwarded and dispatched to the upper layers by the 
   address mapper. 

6. References
   
   [1] Charles E. Perkins, "IP Mobility Support", IETF RFC 2002, Oct. 
   1996.
   
   [2] David B. Johnson and Charles E. Perkins, "Mobility Support in 
   IPv6", draft-ietf-mobileip-ipv6-11.txt, March 2000, (work in 
   progress).
   
   [3] K. Yamamoto and M. Sumikawa, "Overview of Transition Techniques 
   for IPv6-only to Talk to IPv4-only communication", draft-ietf-
   ngtrans- translator-03.txt, March 2000, (work in progress).
   
   [4] G. Tsirtsis and P. Srisuresh, "Network Address Translation - 
   Protocol Translation (NAT-PT)", IETF RFC 2766, Feb. 2000.
   
   [5] E. Nordmark, "Stateless IP/ICMP Translation Algorithm (SIIT)", 
   IETF RFC 2765, Feb. 2000.
   
   [6] S. Thomson and T. Narten, "IPv6 Stateless Address 
   Autoconfiguration", IETF RFC 2462, Dec. 1998.

   [7] T. Narten, E. Nordmark, and W. Simpson, "Neighbor Discovery for 
   IP Version 6 (IPv6)", IETF RFC 2461, Dec. 1998.
   
   [8] S. Tsao, J. Liu, and W. Boehm, "Mobile IP Application Level 
   Gateway", draft-tsao-mobileip-alg-00.txt, Internet Draft, Nov. 2000.
   
   Authors' Addresses
   
   Shiao-Li Tsao 
   CCL, ITRI
   K400 CCL/ITRI Bldg. 51, 195-11 Sec. 4, Chung Hsing Rd., Chutung, 
   Hsinchu, Taiwan, 310, R.O.C. 
   Tel: +886-3-5914651 
   Fax: +886-3-5820310 
   E-mail: sltsao@itri.org.tw

   Jen-Chi Liu
   CCL, ITRI
   K400 CCL/ITRI Bldg. 51, 195-11 Sec. 4, Chung Hsing Rd., Chutung, 
   Hsinchu, Taiwan, 310, R.O.C.
   Tel: +886-3-5914663
   Fax: +886-3-5820310
   E-mail: jcliu@itri.org.tw
   
   Wolfgang Boehm
   Siemens Mobile Internet
   Postal Address:    Siemens AG, ICM CA MS MI E
                      Hofmannstr. 51
                      81379 Munich / Germany
   Phone:    +49 89 722 31462
   Fax:        +49 89 722 37661
   e-mail:    wolfgang-j.boehm@icn.siemens.de

Appendix. Correspondent Node and Other Considerations

   Correspondent nodes can be IPv4 or IPv6. However, if the IP versions 
   are different between mobile nodes and correspondent nodes, certain 
   IPv4/IPv6 transition mechanisms are necessary to be implemented in
   the IPv4/IPv6 interconnected networks. Moreover, if the IP versions 
   of correspondent nodes and mobile nodes are different, moble IP 
   application level gateway [8] is also necessary in the situation.
   The mobile IP application level gateway is to translate mobile
   IPv4 and mobile IPv6 binding messages.  
    
