<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Integration of Robust Header Compression (RoHC) over IPsec Security Associations</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Integration of Robust Header Compression (RoHC) over IPsec Security Associations">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">E. Ertekin</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">R. Jasani</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">C. Christou</td></tr>
<tr><td class="header">Expires: February 17, 2009</td><td class="header">J. Pezeshki</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Booz Allen Hamilton</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">C. Bormann</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Universitaet Bremen TZI</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">August 16, 2008</td></tr>
</table></td></tr></table>
<h1><br />Integration of Robust Header Compression (RoHC) over IPsec Security Associations<br />draft-ietf-rohc-hcoipsec-08</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on February 17, 2009.</p>

<h3>Abstract</h3>

<p>
   IP Security (IPsec) provides various security services for IP
   traffic.  However, the benefits of IPsec come at the cost of
   increased overhead.  This document outlines a framework for
   integrating Robust Header Compression (RoHC) over IPsec (RoHCoIPsec).
   By compressing the inner headers of IP packets, RoHCoIPsec proposes
   to reduce the amount of overhead associated with the transmission of
   traffic over IPsec Security Associations (SAs).
			
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Audience<br />
<a href="#anchor3">3.</a>&nbsp;
Terminology<br />
<a href="#anchor4">4.</a>&nbsp;
Problem Statement: IPsec Packet Overhead<br />
<a href="#anchor5">5.</a>&nbsp;
Overview of the RoHCoIPsec Framework<br />
<a href="#anchor6">5.1.</a>&nbsp;
RoHCoIPsec Assumptions<br />
<a href="#anchor7">5.2.</a>&nbsp;
Summary of the RoHCoIPsec Framework<br />
<a href="#anchor8">6.</a>&nbsp;
Details of the RoHCoIPsec Framework<br />
<a href="#anchor9">6.1.</a>&nbsp;
RoHC and IPsec Integration<br />
<a href="#anchor10">6.1.1.</a>&nbsp;
Header Compression Protocol Considerations<br />
<a href="#anchor11">6.1.2.</a>&nbsp;
Initialization and Negotiation of the RoHC Channel<br />
<a href="#anchor12">6.1.3.</a>&nbsp;
Encapsulation and Identification of Header Compressed Packets<br />
<a href="#anchor13">6.2.</a>&nbsp;
RoHCoIPsec Framework Summary<br />
<a href="#anchor14">7.</a>&nbsp;
Security Considerations<br />
<a href="#anchor15">8.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor16">9.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">10.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
   This document outlines a framework for integrating RoHC [ROHC] over
   IPsec [IPSEC] (RoHCoIPsec).  The goal of RoHCoIPsec is to reduce the
   protocol overhead associated with packets traversing between IPsec SA
   endpoints.  This can be achieved by compressing the transport layer
   header (e.g., UDP, TCP, etc.) and inner IP header of packets at the
   ingress of the IPsec tunnel, and decompressing these headers at the
   egress.
			
</p>
<p>
   For RoHCoIPsec, this document assumes that RoHC will be used to
   compress the inner headers of IP packets traversing an IPsec tunnel.
   However, since current specifications for RoHC detail its operation
   on a hop-by-hop basis, it may require extensions to enable its
   operation over IPsec SAs.  This document outlines a framework for
   extending the usage of RoHC to operate at IPsec SA endpoints.
			
</p>
<p>
   RoHCoIPsec targets the application of RoHC to tunnel mode SAs.
   Transport mode SAs only encrypt/authenticate the payload of an IP
   packet, leaving the IP header untouched.  Intermediate routers
   subsequently use this IP header to route the packet to a decryption
   device.  Therefore, if RoHC is to operate over IPsec transport-mode
   SAs, (de)compression functionality can only be applied to the
   transport layer headers, and not to the IP header.  Because current
   RoHC specifications do not include support for the compression of
   transport layer headers alone, the RoHCoIPsec framework outlined by
   this document describes the application of RoHC to tunnel mode SAs.
			
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Audience</h3>

<p>
   The authors target members of both the RoHC and IPsec communities who
   may consider extending the RoHC and IPsec protocols to meet the
   requirements put forth in this document.  In addition, this document
   is directed towards vendors developing IPsec devices that will be
   deployed in bandwidth-constrained IP networks.
			
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Terminology</h3>

<p>Terminology specific to RoHCoIPsec is introduced in this section.
</p>
<p>RoHC Process
</p>
<p>
        </p>
<blockquote class="text">
<p>Generic reference to a RoHC instance (as defined in [ROHC-TERM]), or any supporting RoHC components.
</p>
</blockquote><p>
        
<p>Compressed Traffic
</p>
        
<p>
          </p>
<blockquote class="text">
<p>Traffic that is processed by the RoHC compressor instance.  Packet headers are compressed using a specific header compression protocol. 
</p>
</blockquote><p>
        
</p>
        
<p>Uncompressed Traffic
</p>
        
<p>
          </p>
<blockquote class="text">
<p>Traffic that is not processed by the RoHC compressor instance. Instead, this type of traffic bypasses the RoHC process.
</p>
</blockquote><p>
        
</p>
      

<p>IPsec Process
</p>
<p>
        </p>
<blockquote class="text">
<p>Generic reference to the Internet Protocol Security (IPsec) process.
</p>
</blockquote><p>
      
</p>
<p>Next Header
</p>
<p>
        </p>
<blockquote class="text">
<p>Refers to the Protocol (IPv4) or Next Header (IPv6, Extension) field.
</p>
</blockquote><p>
      
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Problem Statement: IPsec Packet Overhead</h3>

<p>
   IPsec mechanisms provide various security services for IP networks.
   However, the benefits of IPsec come at the cost of increased per-
   packet overhead.  For example, traffic flow confidentiality
   (generally leveraged at security gateways) requires the tunneling of
   IP packets between IPsec implementations.  Although these IPsec
   tunnels will effectively mask the source-destination patterns that an
   intruder can ascertain, tunneling comes at the cost of increased per-
   packet overhead.  Specifically, an ESP tunnel mode SA applied to an
   IPv6 flow results in at least 50 bytes of additional overhead per
   packet.  This additional overhead may be undesirable for many
   bandwidth-constrained wireless and/or satellite communications
   networks, as these types of infrastructure are not overprovisioned.
   RoHC applied on a per-hop basis over bandwidth-constrained links will
   also suffer from reduced performance when encryption is used on the
   tunneled header, since encrypted headers can not be compressed.
   Consequently, the additional overhead incurred by an IPsec tunnel may
   result in the inefficient utilization of bandwidth.
			
</p>
<p>
   Packet overhead is particularly significant for traffic profiles
   characterized by small packet payloads (e.g. various voice codecs).
   If these small packets are afforded the security
   services of an IPsec tunnel mode SA, the amount of per-packet
   overhead is increased.  Thus, a mechanism is needed to reduce the
   overhead associated with such flows.
			
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Overview of the RoHCoIPsec Framework</h3>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
RoHCoIPsec Assumptions</h3>

<p>
   The goal of RoHCoIPsec is to provide efficient transport of IP
   packets between IPsec devices, without compromising the security
   services offered by IPsec.  The RoHCoIPsec framework has
   been developed based on the following assumptions:
			
</p>
<ul class="text">
<li>
RoHC will be leveraged to reduce the amount of overhead associated with packets traversing an IPsec SA
				
</li>
</ul>
<ul class="text">
<li>
RoHC will be instantiated at the IPsec SA endpoints, and will be applied on a per-SA basis
				
</li>
</ul>
<ul class="text">
<li>
Once the decompression operation completes, decompressed packet headers will be identical to the original packet headers before compression
				
</li>
</ul>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Summary of the RoHCoIPsec Framework</h3>

<p>
   RoHC reduces packet overhead in a network by exploiting intra- and
   inter-packet redundancies of network and transport-layer header
   fields of a flow.
			
</p>
<p>Current RoHC protocol specifications compress packet headers on a hop-by-hop basis.  However, IPsec SAs are instantiated between two IPsec endpoints.  Therefore, various extensions to both RoHC and IPsec need to be defined to ensure the successful operation of the RoHC protocol at IPsec SA endpoints.	
</p>
<p>The migration of RoHC over IPsec SAs is straightforward, since SA endpoints provide source/destination pairs where (de)compression operations can take place.  Compression of the inner IP and upper layer protocol headers in such a manner offers a reduction of per-packet protocol overhead between the two SA endpoints.  Since RoHC will now operate between IPsec endpoints (over multiple intermediate nodes which are transparent to an IPsec SA), it is imperative to ensure that its performance will not be severely impacted due to increased packet reordering and/or packet loss between the compressor and decompressor.
</p>
<p>
   In addition, RoHC can no longer rely on the underlying link layer for
   RoHC parameter configuration and packet identification.  The
   RoHCoIPsec framework proposes that RoHC channel parameter
   configuration is accomplished by an SA management protocol (e.g.,
   IKEv2 [IKEV2]), while identification of compressed header packets is
   achieved through the Next Header field of the security protocol
   (e.g., AH [AH], ESP [ESP]) header.
			
</p>
<p>Using the RoHCoIPsec framework proposed below, outbound and inbound IP traffic processing at an IPsec device needs to be modified. For an outbound packet, a RoHCoIPsec implementation will compress appropriate packet headers, and subsequently encrypt and/or integrity-protect the packet.  For tunnel mode SAs, compression may be applied to the transport layer protocol and the inner IP header.  For inbound packets, an IPsec device must first decrypt and/or integrity-check the packet.  Then decompression of the inner packet headers is performed.  After decompression, the packet is checked against the access controls imposed on all inbound traffic associated with the SA (as specified in [IPSEC]).

			
</p>
<p>
          </p>
<blockquote class="text">
<p>Note: Compression of inner headers is independent from compression of the security protocol (e.g., ESP) and outer IP headers.  RoHC is capable of compressing the security protocol and the outer IP header on a hop-by-hop basis.  The applicability of RoHCoIPsec and hop-by-hop RoHC on an IPv4 ESP-processed packet [ESP] is shown below in Figure 1.
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

            -----------------------------------------------------------
      IPv4  | new IP hdr  |     | orig IP hdr   |   |    | ESP   | ESP|
            |(any options)| ESP | (any options) |TCP|Data|Trailer| ICV|
            -----------------------------------------------------------
            |&lt;-------(1)-------&gt;|&lt;------(2)--------&gt;|

            (1) Compressed by RoHC ESP/IP profile
            (2) Compressed by RoHCoIPsec TCP/IP profile
</pre></div><p>

</p>
<p>
<p>Figure 1. Applicability of RoHC and RoHCoIPsec on an IPv4 ESP-processed packet.
</p>

</blockquote><p>
        
</p>
<p>
   If IPsec NULL encryption is applied to packets, RoHC may still be
   applied to the inner headers at the IPsec SA endpoints.  Inbound and
   outbound packets are still processed as was previously described.
			
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Details of the RoHCoIPsec Framework</h3>

<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
RoHC and IPsec Integration</h3>

<p>
   Figure 2 illustrates the components required to integrate RoHC with
   the IPsec process, i.e., RoHCoIPsec.
			
</p>
<p>
          </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
               +-------------------------------+
               | RoHC Module                   |
               |                               |
               |                               |
     +-----+   |     +-----+     +---------+   |
     |     |   |     |     |     |  RoHC   |   |
   --|  A  |---------|  B  |-----| Process |------&gt; Path 1
     |     |   |     |     |     |         |   |   (RoHC-enabled SA)
     +-----+   |     +-----+     +---------+   |
        |      |        |                      |
        |      |        |-------------------------&gt; Path 2
        |      |                               |   (RoHC-enabled SA)
        |      +-------------------------------+
        |
        |
        |
        |
        +-----------------------------------------&gt; Path 3
                                                   (ROHC-disabled SA)
</pre></div><p>

<p style='text-align: center'>     Figure 2. Integration of RoHC with IPsec.
</p>
        

<p>The process illustrated in Figure 2 augments the IPsec processing
   model for outbound IP traffic (protected-to-unprotected).  Initial
   IPsec processing is consistent with [IPSEC] (Steps 1-2, Section 5.1).
</p>
<p>Block A: The RoHC data item (part of the SA state information) retrieved from
   the "relevant SAD entry" ([IPSEC], Section 5.1, Step3a) determines if
   the traffic traversing the SA is handed to the RoHC module.  Packets selected to a RoHC-disabled SA must
   follow normal IPsec processing and must not be sent to the RoHC
   module (Figure 1, Path 3).  Conversely, packets selected to a RoHC-enabled 
   SA must be sent to the RoHC module.
</p>
<p>Block B: This step determines if the packet can be compressed.  If it is determined
   that the packet will be compressed, an Integrity Algorithm is used to
   compute an Integrity Check Value (ICV) for the uncompressed packet
   ([IPSEC-ROHC], Section 3.2 [IKE-ROHC], Section 2.1).  The
   Next Header field of the security protocol header (e.g., ESP, AH) is
   populated with a "RoHC" identifier, the packet headers are
   compressed, and the computed ICV is appended to the packet (Figure 1, Path 1).  
   However, if it is
   determined that the packet will not be compressed (e.g., due to one
   the reasons described in Section 6.1.3), the Next Header field is
   populated with the appropriate value indicating the next level
   protocol (Figure 1, Path 2).
</p>
<p>After the RoHC process completes, IPsec
   processing resumes, as described in Section 5.1, Step3a, of [IPSEC].
</p>
<p>The process illustrated in Figure 2 also augments the IPsec
   processing model for inbound IP traffic (unprotected-to-protected).
   For inbound packets, IPsec processing is performed ([IPSEC], Section
   5.2, Steps 1-3) followed by AH or ESP processing ([IPSEC], Section
   5.2, Step 4).
</p>
<p>Block A: After AH or ESP processing, the RoHC data item
   retrieved from the SAD entry will indicate if traffic traversing the
   SA is processed by the RoHC module ([IPSEC], Section 5.2, Step 3a).
   Packets traversing an RoHC-disabled SA must follow normal IPsec
   processing and must not be sent to the RoHC module.  Conversely,
   packets traversing an RoHC-enabled SA must be sent to the RoHC
   module.
</p>
<p>Block B: The decision at Block B is determined by the value of the
   Next Header field of the security protocol header.  If the
   Next Header field does not indicate a RoHC header, the decompressor
   must not attempt decompression (Figure 1, Path 2).  If the Next Header 
   field indicates a RoHC header, decompression is applied.  After decompression, the RoHCoIPsec
   Integrity Algorithm is used to compute an ICV value for the decompressed 
   packet.  This ICV is compared to the ICV that was calculated at the 
   compressor:  if the ICVs match, the packet is forwarded by the RoHC 
   module (Figure 1, Path 1); otherwise, the packet is dropped.  Once the RoHC
   module completes processing, IPsec processing resumes, as described
   in Section 5.2, Step 4 of [IPSEC].
</p>
<p>Note that to further reduce the size of an IPsec-protected packet,
   RoHCoIPsec and IPcomp [IPCOMP] can be implemented in a nested
   fashion.  This process is detailed in [IPSEC-ROHC], Section 3.2.
			
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.1"></a><h3>6.1.1.&nbsp;
Header Compression Protocol Considerations</h3>

<p>RoHCv2 [ROHCV2] profiles include various mechanisms that provide 
   increased robustness over reordering channels.  These mechanisms must 
   be adopted for RoHC to operate efficiently over IPsec SAs.
</p>
<p> A RoHC decompressor
   implemented within IPsec architecture may leverage additional
   mechanisms to improve performance over reordering channels (either
   due to random events, or to an attacker intentionally reordering
   packets).  Specifically, IPsec's sequence number may be used by the
   decompressor to identify a packet as "sequentially late".  This
   knowledge will increase the likelihood of successful decompression of
   a reordered packet.
</p>
<p>Additionally, RoHCoIPsec implementations should minimize the amount
   of feedback sent from the decompressor to the compressor.  If a ROHC
   feedback channel is not used sparingly, the overall gains from
   RoHCoIPsec can be significantly reduced.  More specifically, any
   feedback sent from the decompressor to the compressor must be
   processed by IPsec, and tunneled back to the compressor (as
   designated by the SA associated with FEEDBACK_FOR).  As such, several implementation considerations are offered:
			</p>
<ul class="text">
<li>Eliminate feedback traffic altogether by operating only in RoHC Unidirectional mode (U-mode)
</li>
</ul>
<ul class="text">
<li><p>Piggyback RoHC feedback messages on traffic that normally traverses the SA designated by FEEDBACK_FOR.
</li>
</ul>
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.2"></a><h3>6.1.2.&nbsp;
Initialization and Negotiation of the RoHC Channel</h3>

<p>
   RoHC can use the underlying link layer (e.g., PPP) to automatically RoHC
   channel parameters.  In the case of RoHCoIPsec, channel parameters
   can be achieved manually (i.e., administratively
   configured for manual SAs), or by IKEv2.  The extensions required for IKEv2 to support RoHC
   parameter negotiation are detailed in [IKE-ROHC].
				
</p>
<p>
   If the RoHC protocol requires bi-directional communications, two SAs
   must be instantiated between the IPsec implementations.  One of the
   two SAs is used for carrying RoHC-traffic from the compressor to the
   decompressor, while the other is used to communicate RoHC-feedback
   from the decompressor to the compressor.  Note that the requirement
   for two SAs aligns with the operation of IKE, which creates SAs in
   pairs by default.  However, IPsec implementations will dictate how decompressor
   feedback received on one SA is associated with a compressor on the
   other SA.
				
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.3"></a><h3>6.1.3.&nbsp;
Encapsulation and Identification of Header Compressed Packets</h3>

<p>
   As indicated in Section 6.1, new state information (i.e., a new RoHC
   data item) is defined for each SA.  The RoHC data item is used by the
   IPsec process to determine whether it sends all traffic traversing a
   given SA to the RoHC module (RoHC-enabled) or bypasses the RoHC
   module and sends the traffic through regular IPsec processing (RoHC-
   disabled).
				
</p>
<p>
   The Next Header field of the IPsec security protocol (e.g., AH or
   ESP) header is used to demultiplex header-compressed traffic from
   uncompressed traffic traversing an RoHC-enabled SA.  This
   functionality is needed in situations where packets traversing a
   RoHC-enabled SA do not contain compressed headers.  Such situations
   may occur when, for example, a compressor supports strictly n
   compressed flows and can not compress the n+1 flow that arrives.
   Another example is when traffic (e.g., TCP/IP) is selected (by IPsec)
   to a RoHC-enabled SA, but cannot be compressed by the RoHC process
   (e.g., because the compressor does not support TCP/IP compression).
   Similarly, the decompressor must be
   able to identify packets with uncompressed headers and not attempt to
   decompress them.  The Next Header field is used to demultiplex these
   header-compressed versus uncompressed packets, as a RoHC protocol
   identifier will indicate the packet contains compressed headers.  To
   accomplish this, an official IANA allocation from the Protocol ID
   registry [PROTOCOL] is required.
				
</p>
<p>
   The RoHC Data Item, IANA Protocol ID allocation, and other IPsec
   extensions to support RoHCoIPsec, are specified in [IPSEC-ROHC].
				
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
RoHCoIPsec Framework Summary</h3>

<p>To summarize, the following items are needed to achieve RoHCoIPsec:
</p>
<ul class="text">
<li>IKEv2 Extensions to Support RoHCoIPsec
</li>
<li>IPsec Extensions to Support RoHCoIPsec
</li>
</ul>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>
   A malfunctioning RoHC compressor (i.e., the compressor located at the
   ingress of the IPsec tunnel) has the ability to send packets to the
   decompressor (i.e., the decompressor located at the egress of the
   IPsec tunnel) that do not match the original packets emitted from the
   end-hosts.  Such a scenario will result in a decreased efficiency
   between compressor and decompressor.  Furthermore, this may result in
   Denial of Service, as the decompression of a significant number of
   invalid packets may drain the resources of an IPsec device.
		
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>None.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Acknowledgments</h3>

<p>
   The authors would like to thank Mr. Sean O'Keeffe, Mr. James Kohler,
   and Ms. Linda Noone of the Department of Defense, and well as Mr.
   Rich Espy of OPnet for their contributions and support in the
   development of this document.
</p>
<p>In addition, the authors would like to
   thank the following for their numerous reviews and comments to this
   document:
		
</p>
<p>
        </p>
<ul class="text">
<li>Dr. Stephen Kent 
</li>
<li>Dr. Carsten Bormann
</li>
<li>Mr. Pasi Eronen
</li>
<li>Dr. Joseph Touch
</li>
<li>Mr. Tero Kivinen
</li>
<li>Mr. Lars-Erik Jonsson
</li>
<li>Mr. Jan Vilhuber
</li>
<li>Mr. Dan Wing
</li>
<li>Mr. Kristopher Sandlund
</li>
<li>Mr. Ghyslain Pelletier
</li>
</ul><p>
      
</p>
<p>
   Finally, the authors would also like to thank Mr. Tom Conkle, Ms.
   Renee Esposito, Mr. Etzel Brower, and Ms. Michele Casey of Booz Allen
   Hamilton for their assistance in completing this work.
		
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ROHC">[ROHC]</a></td>
<td class="author-text">Bormann, C., Burmeister, C., Degermark, M., Fukushima, H., Hannu, H., Jonsson, L., Hakenberg, R., Koren, T., Le, K., Liu, Z., Martensson, A., Miyazaki, A., Svanbro, K., Wiebke, T., Yoshimura, T., and H. Zheng, &ldquo;<a href="http://tools.ietf.org/html/rfc3095">RObust Header Compression (ROHC): Framework and four profiles: RTP, UDP, ESP, and uncompressed</a>,&rdquo; RFC&nbsp;3095, July&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="IPSEC">[IPSEC]</a></td>
<td class="author-text">Kent, S. and K. Seo, &ldquo;<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>,&rdquo; RFC&nbsp;4301, December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="ROHC-TERM">[ROHC-TERM]</a></td>
<td class="author-text">Jonsson, L-E., &ldquo;<a href="http://tools.ietf.org/html/rfc4301">Robust Header Compression (ROHC): Terminology and Channel Mapping Examples</a>,&rdquo; RFC&nbsp;4301, April&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="IKEV2">[IKEV2]</a></td>
<td class="author-text">Kaufman, C., &ldquo;<a href="http://tools.ietf.org/html/rfc4306">Internet Key Exchange (IKEv2) Protocol</a>,&rdquo; RFC&nbsp;4306, December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="ESP">[ESP]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4303">IP Encapsulating Security Payload (ESP)</a>,&rdquo; RFC&nbsp;4303, December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="AH">[AH]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4302">IP Authentication Header</a>,&rdquo; RFC&nbsp;4302, December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="IPCOMP">[IPCOMP]</a></td>
<td class="author-text">Shacham, A., Monsour, R., Pereira, and Thomas, &ldquo;<a href="http://tools.ietf.org/html/rfc3173">IP Payload Compression Protocol (IPComp)</a>,&rdquo; RFC&nbsp;3173, September&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="ROHCV2">[ROHCV2]</a></td>
<td class="author-text">Pelletier, G. and K. Sandlund, &ldquo;<a href="http://tools.ietf.org/html/rfc5225">RObust Header Compression Version 2 (ROHCv2): Profiles for RTP, UDP, IP, ESP and UDP Lite</a>,&rdquo; RFC&nbsp;5225, April&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="IKE-ROHC">[IKE-ROHC]</a></td>
<td class="author-text">Pezeshki, et al., &ldquo;IKEv2 Extensions to Support RoHCoIPsec,&rdquo; work in progress&nbsp;, August&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="PROTOCOL">[PROTOCOL]</a></td>
<td class="author-text">IANA, &ldquo;Assigned Internet Protocol Numbers, IANA registry at: http://www.iana.org/assignments/protocol-numbers.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="IPSEC-ROHC">[IPSEC-ROHC]</a></td>
<td class="author-text">Ertekin, et al., &ldquo;IPsec Extensions to Support RoHCoIPsec,&rdquo; work in progress&nbsp;, August&nbsp;2008.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Emre Ertekin</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Booz Allen Hamilton</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">13200 Woodland Park Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Herndon, VA  20171</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ertekin_emre@bah.com">ertekin_emre@bah.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rohan Jasani</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Booz Allen Hamilton</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">13200 Woodland Park Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Herndon, VA  20171</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jasani_rohan@bah.com">jasani_rohan@bah.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chris Christou</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Booz Allen Hamilton</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">13200 Woodland Park Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Herndon, VA  20171</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:christou_chris@bah.com">christou_chris@bah.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jonah Pezeshki</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Booz Allen Hamilton</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">13200 Woodland Park Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Herndon, VA  20171</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:pezeshki_jonah@bah.com">pezeshki_jonah@bah.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Carsten Bormann</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Universitaet Bremen TZI</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Postfach 330440</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bremen  D-28334</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:cabo@tzi.org">cabo@tzi.org</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
