<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Addressing bit compression for stateless IPv6
    prefix translation</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Addressing bit compression for stateless IPv6
    prefix translation">
<meta name="keywords" content="Draft, NAT66, NAT66-AC">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Behavior Engineering for Hindrance</td><td class="header">J. Tremblay</td></tr>
<tr><td class="header">Avoidance</td><td class="header">Videotron</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">S. Beuker</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Shaw Communications</td></tr>
<tr><td class="header">Expires: May 29, 2011</td><td class="header">November 25, 2010</td></tr>
</table></td></tr></table>
<h1><br />Addressing bit compression for stateless IPv6
    prefix translation<br />draft-tremblay-pt66ac-00</h1>

<h3>Abstract</h3>

<p>This document describes a method to extend IPv6 prefix translation
      <a class='info' href='#NAT66'>[NAT66]<span> (</span><span class='info'>Wasserman, M. and F. Baker, &ldquo;IPv6-to-IPv6 Network Address Translation (NAT66),&rdquo; November&nbsp;2008.</span><span>)</span></a> to statelessly translate between IPv6
      prefixes of differing lengths. This technique, called PT66 addressing
      bit compression (PT66-AC), provides a way to map a shorter prefix (such
      as the fixed [6to4] prefix) to a longer global unicast prefix, while
      avoiding stateful translation. The difference between the prefix lengths
      is compensated for by removing an unused string of subnetting bits, as
      specified, from the addresses within the shorter prefix.
</p>
<h3>Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in RFC 2119.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on May 29, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
IPv6 Translator Model<br />
<a href="#anchor3">3.</a>&nbsp;
IPv6 Prefix Translation with Addressing Compression<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
Configuration Elements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
Egress Translation Behavior for Compressed Bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.3.</a>&nbsp;
Ingress Translation Behavior for Compressed Bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.4.</a>&nbsp;
Translator Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.4.1.</a>&nbsp;
Egress Traffic Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.4.2.</a>&nbsp;
Ingress Traffic Operation<br />
<a href="#anchor10">4.</a>&nbsp;
Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">4.1.</a>&nbsp;
6to4 Subnet Compression<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">4.2.</a>&nbsp;
6to4 IPv4 and Subnet Compression<br />
<a href="#IANA">5.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">6.</a>&nbsp;
Security Considerations<br />
<a href="#Acknowledgements">7.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">8.</a>&nbsp;
Informative References<br />
<a href="#anchor14">Appendix&nbsp;A.</a>&nbsp;
An Appendix<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Since IPv6 has become a standard, multiple transition mechanisms have
      been proposed to stimulate the rate of IPv6 adoption. Some of these
      mechanisms use specific addressing space and fixed lengths for different
      types of prefixes. There is sometimes a need to translate a
      protocol-specific addressing space into global unicast space to improve
      the routing behavior. Of course, this improvement to routing comes at
      the cost of lowered interoperability for some applications.
</p>
<p>One issue with translating these prefixes is the challenge of
      obtaining a globally unique prefix of appropriate size. However, there
      are often a number of bits rarely used within the transition protocol
      specific prefixes. Using an address translator with addressing bit
      compression allows a deployment to drop these unused bits and make more
      efficient usage of the public addressing space.
</p>
<p>For example, the IPv6 transition protocol [6to4] statelessly maps 32
      bit IPv4 addresses into the 2002::/16 prefix, to create a /48 IPv6
      prefix for every IPv4 address. Normally, return traffic destined to this
      prefix will be routed to the nearest 6to4 relay router. An ISP may wish
      to gain control over return routing of the 6to4 traffic by mapping their
      6to4 address space into a globally unique IPv6 prefix.
</p>
<p>Implementing this without addressing bit compression would require an
      IPv6 /32 for every /16 of IPv4 global space assigned to an ISP.
      Acquiring the required IPv6 space from a Regional Internet Registry is
      therefore unrealistic in most cases. Using addressing bit compression,
      an ISP can make better use of the globally unique IPv6 space by reducing
      the size of the 6to4 subnet available to each user.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
IPv6 Translator Model</h3>

<p>The current stateless IPv6 prefix translation model is described in
      <a class='info' href='#NAT66'>[NAT66]<span> (</span><span class='info'>Wasserman, M. and F. Baker, &ldquo;IPv6-to-IPv6 Network Address Translation (NAT66),&rdquo; November&nbsp;2008.</span><span>)</span></a>. In that model, IPv6 traffic is translated
      between an internal network and an external network.
</p>
<p>An IPv6 translator model described in <a class='info' href='#NAT66'>[NAT66]<span> (</span><span class='info'>Wasserman, M. and F. Baker, &ldquo;IPv6-to-IPv6 Network Address Translation (NAT66),&rdquo; November&nbsp;2008.</span><span>)</span></a>:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        External Network:  Prefix = 2001:0DB8:0001:/48
            --------------------------------------
                              |
                              |
                         +---------+
                         |  PT66   |
                         |  Device |
                         +---------+
                              |
                              |
            --------------------------------------
        Internal Network:  Prefix = FD01:0203:0405:/48

</pre></div>
<p>
</p>
<p>This translation model may be represented in a generic fashion by
      replacing the address characters with letters denoting the function of
      those address bits. The representation below describes a single
      translation mapping in a device that may implement several.
</p>
<p></p>
<blockquote class="text">
<p>L &ndash; Internal (or &ldquo;Local&rdquo;) network IPv6
          prefix
</p>
<p>E &ndash; External network IPv6 prefix
</p>
<p>N &ndash; Subnet bits
</p>
<p>I &ndash; Interface Identifier (IID) bits
</p>
</blockquote>

<p>A generic IPv6 translator model
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
External Network Prefix = EEEE:EEEE:EEEE:NNNN:IIII:IIII:IIII:IIII
            --------------------------------------
                              |
                              |
                         +---------+
                         |  PT66   |
                         |  Device |
                         +---------+
                              |
                              |
            --------------------------------------
Internal Network Prefix = LLLL:LLLL:LLLL:NNNN:IIII:IIII:IIII:IIII

</pre></div>
<p>In this figure, L represents the Internal or Local prefix
        to be translated to the External prefix bits E. The number of L bits
        is equal to the number of E bits. Subnet bits N and Interface-ID bits
        I are not changed by the translator.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
IPv6 Prefix Translation with Addressing Compression</h3>

<p>It is implicit that any basic <a class='info' href='#NAT66'>[NAT66]<span> (</span><span class='info'>Wasserman, M. and F. Baker, &ldquo;IPv6-to-IPv6 Network Address Translation (NAT66),&rdquo; November&nbsp;2008.</span><span>)</span></a> mapping
      must be between prefixes of the same size, as each prefix of is
      overwritten by the other as traffic passes through. The section below
      gives a description of how to map internal and external networks of
      different lengths. In this example, the internal prefix used is a larger
      /28, while the external prefix used is a smaller /40.
</p>
<p></p>
<blockquote class="text">
<p>L - Local or Internal network IPv6 prefix
</p>
<p>E &ndash; External network IPv6 prefix
</p>
<p>S - Shifted subnet bits
</p>
<p>N - Unmodified subnet bits
</p>
<p>C - Compressed (removed) bits
</p>
<p>I &ndash; Interface Identifier (IID) bits
</p>
</blockquote>

<p>Generic Prefix Translator Model with Addressing
        Compression
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
External Network Prefix = EEEE:EEEE:EESS:SSSN:IIII:IIII:IIII:IIII
            --------------------------------------
                              |
                              |
                         +----------+
                         |  PT66-AC |
                         |  Device  |
                         +----------+
                              |
                              |
            --------------------------------------
Internal Network Prefix = LLLL:LLLS:SSSS:CCCN:IIII:IIII:IIII:IIII

</pre></div>
<p>
</p>
<p>In this translation model, the N bits (4 bits represented) from the
      internal subnet are left untouched. The C bits (12 bits represented) are
      the compressed bits, not present in the external network prefix. The S
      bits (20 bits represented) are bitwise shifted to the right by the
      length of the C bits when translating from the internal network to the
      external network. This compression of the subnet allows for the
      adaptation from the larger prefix to the smaller prefix to be made. The
      L bits (28 bits represented) are replaced by the E bits (40 bits
      represented) when translating from the internal network to the external
      network.
</p>
<p>In this document, traffic received on the internal network interface
      and forwarded by the external traffic interface is called egress
      traffic. Inversely, any traffic received on the external network
      interface and forwarded to the internal network interface is called
      ingress traffic.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Configuration Elements</h3>

<p>The IPv6 prefix translation with addressing compression model
        (PT66-AC) makes use of the following variables:
</p>
<p></p>
<blockquote class="text">
<p>L Length of the internal network prefix
</p>
<p>E Length of the external network prefix
</p>
<p>S Number of shifted bits
</p>
<p>C Number of compressed bits
</p>
<p>N Number of unchanged subnet bits
</p>
</blockquote>

<p>In order to avoid confusion and increase readability, both the full
        name and variable notation of the above parameters are used throughout
        this document.
</p>
<p>In this translation model, the sum of the length of the internal
        network prefix (L), of the number of shifted bits (S), of the number
        of compressed bits (C) and of the number of unchanged bits (N) always
        equals 64 (L + S + C + N = 64). As well, the sum of the length of the
        external network (E), of the number of shifted bits (S) and of the
        number of unchanged bits (N) always equals 64 (E + S + N = 64).
</p>
<p>Hence the number of compressed bits (C) is always equal to the
        length of the external prefix minus the length of the local prefix (C
        = E &ndash; L). Only the length of each prefix need be defined, and
        the length of the compressed bits (C) can be derived from those
        values. Similarly, in order to know the number of shifted bits (S) and
        unchanged bits (N), one of these two must be defined in the
        configuration of the translation mapping. Therefore, the elements that
        must be defined in a translation mapping with compression are the
        internal network prefix and its length (L), the external network
        prefix and its length (E) and either the number of shifted bits (S) or
        unchanged bits (N).
</p>
<p>With these configuration elements defined for each translation
        mapping, an IPv6 translator can statelessly translate ingress and
        egress traffic between prefixes of differing length.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Egress Translation Behavior for Compressed Bits</h3>

<p>The value of the bits compressed is hereto referred to as the
        &lsquo;compressed bit pattern&rsquo;. By default, any egress traffic
        MUST be dropped if the compressed bit pattern is not equal to zero.
        Optionally, a compressed bit pattern different from all zeros may be
        defined by configuration and used to filter incoming traffic. The
        compressed bit pattern length MUST be equal to the difference between
        the length of the external prefix and the length of the internal
        prefix (C must equal E &ndash; L).
</p>
<p>The translation device SHOULD issue an ICMP type 1 (Destination
        Unreachable) message with code 5 (Source address failed ingress/egress
        policy) to the source address when dropping traffic for the first time
        for each source address/destination address pair.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Ingress Translation Behavior for Compressed Bits</h3>

<p>For traffic entering the external network interface of the
        translator, the compressed bits MUST be restored with zeros by
        default, unless a different compressed bit pattern has been configured
        for the mapping. In such a case, the user-defined compressed bit
        pattern MUST be used to restore the compressed bits.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Translator Operation</h3>

<p>For traffic entering the external network interface of the
        translator, the compressed bits MUST be restored with zeros by
        default, unless a different compressed bit pattern has been configured
        for the mapping. In such a case, the user-defined compressed bit
        pattern MUST be used to restore the compressed bits.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.1"></a><h3>3.4.1.&nbsp;
Egress Traffic Operation</h3>

<p>For each egress packet, the prefix translator MUST use the
          appropriate translation mapping with the longest matching internal
          prefix. The S bits of the IPv6 source address are shifted bitwise to
          the right by the number of compressed bits (C). The leftmost bits of
          the source address (L) are replaced by the bits of the external
          network prefix (E). Unchanged bits (N) of the source address MUST
          NOT be modified.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.2"></a><h3>3.4.2.&nbsp;
Ingress Traffic Operation</h3>

<p>For each ingress packet, the prefix translator MUST use the
          appropriate translation mapping. Selection of the appropriate
          mapping is outside of the scope of this document. The behavior of
          the translator when no mapping is matched is also out of scope for
          this document. Asynchronous mappings between internal and external
          prefixes, where an ingress source address translated does not in
          turn translate back to the same destination address on egress
          traffic, SHOULD be prevented.
</p>
<p>Once a suitable mapping is found, the leftmost bits of the
          destination address are replaced by the corresponding bits from the
          local network prefix (L). Starting at the bit position equal to the
          length of the external prefix (E), the Shifted bits are bitwise
          shifted to the left by the number of compressed bits (C). The C bits
          are restored with zeros, or the compressed bit pattern if set in the
          mapping configuration. Unchanged bits (N) of the destination address
          MUST NOT be modified.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Examples</h3>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
6to4 Subnet Compression</h3>

<p>When an IPv6 prefix translator is used with a 6to4 prefix as the
        internal network, it is possible to compress seldom-used subnet bits
        in order to reduce the size of the external global unicast prefix. As
        specified in [6to4], a 6to4 router will define a /48 for each IPv4
        global unicast address. This provides 16 bits of subnet addressing
        available to the user. The 6to4 protocol being often implemented by
        residential gateways, only one LAN subnet (/64) is utilized in most
        implementations. It is therefore possible to reduce the number of
        available /64 subnets available from 65536 (16 bits) to 16 (4 bits) or
        even a single one (0 subnet bits). The following example compresses
        the 16 subnet bits to 4 bits, leaving room for 16 /64 subnets.
</p>
<p>The prefix translation model for 6to4 is similar to the generic
        model, with the internal network bits (L) being defined as 2002::/16.
        The 32 bits of the 6to4 router IPv4 address are the shifted bits
        (S).
</p>
<p>This example uses 192.0.2.1 as the 6to4 router IPv4 address and
        2001:DB0::/28 as the provider global unicast prefix. A single subnet
        number 0001 is used. A single host exchanges traffic from Interface ID
        ::A.
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>External Network Prefix = EEEE:EEES:SSSS:SSSN:IIII:IIII:IIII:IIII
                          2001:0DBC:0000:2011:0000:0000:0000:000A
            --------------------------------------
                              |
                              |
                         +----------+
                         |  PT66-AC |
                         |  Device  |
                         +----------+
                              |
                              |
            --------------------------------------
Internal 6to4 Prefix = LLLL:SSSS:SSSS:CCCN:IIII:IIII:IIII:IIII
                       2002:C000:0201:0001:0000:0000:0000:000A

</pre></div>
<p>
</p>
<p>In this example, the ISP configures the PT66-AC with the following
        mapping: 2002::/16, 2001:DB0::/28, C=12 (or N=4)
</p>
<p>During operation, egress traffic from address
          2002:C000:0201:1::A is translated as follow:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
2002:C000:0201:0001::A  Egress packets source address
2002:C00C:0000:2011::A  Shift S bits (32 bits) to the right
                        by C bits (12 bits)
2001:0DBC:0000:2011::A  Replace L bits by E bits. This is the new
                        egress source address.</pre></div>
<p>
</p>
<p>The inverse operations takes place for ingress traffic
          with destinations within 2001:db0::/28:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
2001:0DBC:0000:2011::A  Incoming destination address
2002:0DBC:0000:2011::A  Leftmost bits are replaced by the L bits
                        (16 bits)
2002:C000:0201:2011::A  The 32 S bits are shifted to the left
                        by C bits (12 bits)
2002:C000:0201:0001::A  The C bits are restored. This is the new
                        destination address on the local network</pre></div>
<p>
</p>
<p>This example demonstrated how to compress the 12 first bits of the
        6to4 subnet bits in order for an ISP to use a longer global unicast
        prefix for the external network.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
6to4 IPv4 and Subnet Compression</h3>

<p>As an improvement over the previous example, the ISP also has the
        opportunity to compress the IPv4 prefix part of the IPv4 address in
        the 6to4 prefix. That information is redundant, because it can be
        recovered from the mapping when translating ingress traffic. Omitting
        this allows the ISP to use an even smaller prefix on the external
        interface.
</p>
<p>This example is similar the previous one, with the addition that
        the IPv4 prefix 192.0.2.0/24 will also be compressed. The external
        prefix used by the ISP is now 2001:db8:FFFF:F000::/52. The 6to4 subnet
        remains compressed from 16 to 4 bits.
</p>
<p>A translation mapping is configured as follow: 2002:C000:0200::/40,
        2001:0DB8:FFFF:F000::/52, C=12 (or N=4)
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>External Network Prefix = EEEE:EEEE:EEEE:ESSN:IIII:IIII:IIII:IIII
                          2001:0DB8:FFFF:F011:0000:0000:0000:000A
            --------------------------------------
                              |
                              |
                         +----------+
                         |  PT66-AC |
                         |  Device  |
                         +----------+
                              |
                              |
            --------------------------------------
Internal 6to4 Prefix = LLLL:LLLL:LLSS:CCCN:IIII:IIII:IIII:IIII
                       2002:C000:0201:0001:0000:0000:0000:000A


</pre></div>
<p>
</p>
<p>Egress operation:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
2002:C000:0201:0001::A  Egress packets source address
2002:C000:0201:0011::A  Shift S bits (8 bits) to the
                        right by C bits (12 bits)
2001:0DB8:FFFF:F011::A  Replace L bits by E bits. This
                        is the new egress source address.
</pre></div>
<p>
</p>
<p>Ingress operation for destinations within
          2001:db8:FFFF:F000::/52:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
2001:0DB8:FFFF:F011::A  Incoming destination address
2002:C000:02FF:F011::A  Leftmost bits are replaced
                        by the L bits (40 bits)
2002:C000:0201:F011::A  The S bits (8 bits) are shifted to
                        the left by C bits (12 bits)
2002:C000:0201:0001::A  The C bits are restored. This is the
                        new destination address on local network</pre></div>
<p>
</p>
<p>This example demonstrates that both the IPv4 addressing and the
        subnet parts of a 6to4 prefix can be compressed. It is therefore
        possible to translate a provider&rsquo;s own 6to4 addressing subset
        (from its own global IPv4 unicast space) to a set of global IPv6
        unicast prefixes that are small enough not to require an extremely
        large IPv6 global unicast assignment.
</p>
<p>The resulting IPv6 unicast prefixes are also completely decoupled
        from IPv4 and avoid the need for injection of IPv4 routing information
        in the IPv6 routing table in order to achieve better routing.
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>This document makes no request of IANA.
</p>
<p>Note to RFC Editor: this section may be removed on publication as an
      RFC.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>All of the security considerations of [NAT66] are still applicable
      when address bit compression is applied. The stateless address mapping
      of NAT66 allows for direct inbound connections to internal nodes,
      something not present in NAT44.
</p>
<p>In addition, an implementation of NAT66 with addressing bit
      compression must be aware of the potential for a DOS attack against the
      device by an internal node intentionally sending packets that do not
      match the compressed bit pattern. This would force the generation of
      ICMP unreachable messages to the source address, which could be spoofed,
      and could potentially impact the operation of both the NAT66 device and
      the legitimate user of the spoofed source address. For this reason, it
      is recommended that the rate of ICMP unreachable messages generated is
      limited.
</p>
<p>Another possibility of resource exhaustion is to receive packets on
      an interface that doesn&rsquo;t have any mapping for the source or
      destination. For example, traffic with an internal destination coming on
      the outside interface. Such traffic SHOULD be silently dropped.
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Acknowledgements</h3>

<p>Thanks to the following people (in alphabetical order) for their
      participation and review:
</p>
<p></p>
<blockquote class="text">
<p>Victor Kuarsingh, Rogers Communications
</p>
<p>Yiu Lee, Comcast
</p>
</blockquote>

<p>
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="NAT66">[NAT66]</a></td>
<td class="author-text">Wasserman, M. and F. Baker, &ldquo;IPv6-to-IPv6 Network Address Translation (NAT66),&rdquo; November&nbsp;2008.</td></tr>
</table>

<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
An Appendix</h3>

<p>
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jean-Francois Tremblay</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Videotron</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">150 Beaubien Ouest</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Montreal, Quebec  H2V 1C4</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Canada</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jf@jftremblay.com">jf@jftremblay.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Scott Beuker</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Shaw Communications</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">200 - 3636 23rd St NE</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Calgary, Alberta  T2E 8Z5</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Canada</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Scott.Beuker@sjrb.ca">Scott.Beuker@sjrb.ca</a></td></tr>
</table>
</body></html>
