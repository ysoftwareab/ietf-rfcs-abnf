<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Cisco Systems' Simple Certificate Enrollment
    Protocol</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Cisco Systems' Simple Certificate Enrollment
    Protocol">
<meta name="keywords" content="pki">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Engineering Task Force</td><td class="header">M. Pritikin, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">A. Nourse</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">J. Vilhuber</td></tr>
<tr><td class="header">Expires: March 26, 2011</td><td class="header">Cisco Systems, Inc</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">September 22, 2010</td></tr>
</table></td></tr></table>
<h1><br />Cisco Systems' Simple Certificate Enrollment
    Protocol<br />draft-nourse-scep-21</h1>

<h3>Abstract</h3>

<p>This document specifies the Simple Certificate Enrollment Protocol, a
      PKI communication protocol which leverages existing technology by using
      PKCS#7 and PKCS#10 over HTTP. SCEP is the evolution of the enrollment
      protocol developed by VeriSign, Inc. for Cisco Systems, Inc. It now
      enjoys wide support in both client and CA implementations.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on March 26, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Requirements Language<br />
<a href="#scepops">2.</a>&nbsp;
SCEP Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#scep_entities">2.1.</a>&nbsp;
SCEP Entities<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#requester">2.1.1.</a>&nbsp;
Requester<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#certauth">2.1.2.</a>&nbsp;
Certification Authority<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#reg_auth">2.1.3.</a>&nbsp;
Registration Authority<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#req_auth">2.2.</a>&nbsp;
Requester authentication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#enrollment_authz">2.3.</a>&nbsp;
Enrollment authorization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cara_dist">2.4.</a>&nbsp;
CA/RA Certificate Distribution<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#certenroll">2.5.</a>&nbsp;
Certificate Enrollment<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.5.1.</a>&nbsp;
Client State Transitions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cert_access">2.6.</a>&nbsp;
Certificate Access<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#crl_access">2.7.</a>&nbsp;
CRL Access<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#certrevoke">2.8.</a>&nbsp;
Certificate Revocation<br />
<a href="#pkcs7_transport">3.</a>&nbsp;
SCEP Secure Message Objects<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#signeddata">3.1.</a>&nbsp;
SCEP pkiMessage<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#signedAttributes">3.1.1.</a>&nbsp;
Signed Transaction Attributes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#transactID">3.1.1.1.</a>&nbsp;
transactionID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#messType">3.1.1.2.</a>&nbsp;
messageType<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pkiStatus">3.1.1.3.</a>&nbsp;
pkiStatus<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#failInfo">3.1.1.4.</a>&nbsp;
failInfo<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#nonces">3.1.1.5.</a>&nbsp;
senderNonce and recipientNonce<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#signingTime">3.1.1.6.</a>&nbsp;
signingTime Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#envelope">3.1.2.</a>&nbsp;
SCEP pkcsPKIEnvelope<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.2.</a>&nbsp;
SCEP pkiMessage types<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pkcsreq">3.2.1.</a>&nbsp;
PKCSReq<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#certrep">3.2.2.</a>&nbsp;
CertRep<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.2.1.</a>&nbsp;
CertRep SUCCESS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.2.2.2.</a>&nbsp;
CertRep FAILURE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.2.2.3.</a>&nbsp;
CertRep PENDING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcertinitial">3.2.3.</a>&nbsp;
GetCertInitial<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#issuerandsubject">3.2.3.1.</a>&nbsp;
IssuerAndSubject<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcert">3.2.4.</a>&nbsp;
GetCert<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcrl">3.2.5.</a>&nbsp;
GetCRL<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#degeneratep7">3.3.</a>&nbsp;
Degenerate certificates-only PKCS#7 Signed-data<br />
<a href="#scepmessages">4.</a>&nbsp;
SCEP Transactions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcacert">4.1.</a>&nbsp;
Get CA Certificate<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcacertresp">4.1.1.</a>&nbsp;
Get CA Certificate Response Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcarespca">4.1.1.1.</a>&nbsp;
CA Certificate Response Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcarespcara">4.1.1.2.</a>&nbsp;
CA/RA Certificate Response Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.2.</a>&nbsp;
Certificate Enrollment<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#certEnrollResp">4.2.1.</a>&nbsp;
Certificate Enrollment Response Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcertinitialtrans">4.3.</a>&nbsp;
Poll for Requester Initial Certificate<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcertinitresp">4.3.1.</a>&nbsp;
Polling Response Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcerttrans">4.4.</a>&nbsp;
Certificate Access<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcertresp">4.4.1.</a>&nbsp;
Certificate Access Response Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcrltrans">4.5.</a>&nbsp;
CRL Access<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcrlresp">4.5.1.</a>&nbsp;
CRL Access Response Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.6.</a>&nbsp;
Get Next Certification Authority Certificate<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getnextcacertresp">4.6.1.</a>&nbsp;
Get Next CA Response Message Format<br />
<a href="#scep_transport">5.</a>&nbsp;
SCEP Transport<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sceptransport_get">5.1.</a>&nbsp;
HTTP &quot;GET&quot; Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">5.1.1.</a>&nbsp;
Response Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#transportdetails">5.2.</a>&nbsp;
SCEP HTTP Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcacerttrans">5.2.1.</a>&nbsp;
GetCACert<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.2.1.1.</a>&nbsp;
GetCACert Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pkcsreqhttp">5.2.2.</a>&nbsp;
PKCSReq<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.2.2.1.</a>&nbsp;
PKCSReq Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">5.2.3.</a>&nbsp;
GetCertInitial<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">5.2.3.1.</a>&nbsp;
GetCertInitial Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">5.2.4.</a>&nbsp;
GetCert<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">5.2.4.1.</a>&nbsp;
GetCert Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">5.2.5.</a>&nbsp;
GetCRL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">5.2.5.1.</a>&nbsp;
GetCRL Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getnextcacerttrans">5.2.6.</a>&nbsp;
GetNextCACert<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">5.2.6.1.</a>&nbsp;
GetNextCACert Response<br />
<a href="#anchor20">6.</a>&nbsp;
Contributors/Acknowledgements<br />
<a href="#anchor21">7.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor22">8.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">8.1.</a>&nbsp;
General Security<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">8.2.</a>&nbsp;
Use of the CA keypair<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">8.3.</a>&nbsp;
ChallengePassword<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#transidsecurity">8.4.</a>&nbsp;
transactionID<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">8.5.</a>&nbsp;
Nonces and Replay<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">8.6.</a>&nbsp;
Key Usage Issues<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">8.7.</a>&nbsp;
GetCACaps Issues<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#unnecessarycrypto">8.8.</a>&nbsp;
Unnecessary cryptography<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">8.9.</a>&nbsp;
GetNextCACert<br />
<a href="#rfc.references1">9.</a>&nbsp;
Normative References<br />
<a href="#oiddef">Appendix&nbsp;A.</a>&nbsp;
Private OID Definitions<br />
<a href="#statetrans">Appendix&nbsp;B.</a>&nbsp;
SCEP State Transitions<br />
<a href="#cacaps">Appendix&nbsp;C.</a>&nbsp;
CA Capabilities<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">C.1.</a>&nbsp;
GetCACaps HTTP Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cacapsresp">C.2.</a>&nbsp;
CA Capabilities Response Format<br />
<a href="#cert_renew">Appendix&nbsp;D.</a>&nbsp;
Client Certificate Renewal<br />
<a href="#ca_keyrollover">Appendix&nbsp;E.</a>&nbsp;
CA Key Rollover<br />
<a href="#postop">Appendix&nbsp;F.</a>&nbsp;
PKIOperation via HTTP POST Message<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Public key technology is widely available and increasingly widely
      deployed. X.509 certificates serve as the basis for several
      standards-based security protocols in the IETF, such as <a class='info' href='#RFC2409'>IKE<span> (</span><span class='info'>Harkins, D. and D. Carrel, &ldquo;The Internet Key Exchange (IKE),&rdquo; November&nbsp;1998.</span><span>)</span></a> [RFC2409] and <a class='info' href='#RFC4306'>IKEv2<span> (</span><span class='info'>Kaufman, C., &ldquo;Internet Key Exchange (IKEv2) Protocol,&rdquo; December&nbsp;2005.</span><span>)</span></a> [RFC4306], and
      <a class='info' href='#RFC4346'>TLS<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.1,&rdquo; April&nbsp;2006.</span><span>)</span></a> [RFC4346]. When an X.509 certificate is issued
      by other than the certificate subject (a self-issued certificate), there
      typically is a need for a certificate management protocol. Such a
      protocol enables a PKI client to request a certificate, certificate
      renewal, or certificate revocation from a certification authority. Often
      there also is a need for protocols to request a certificate or
      certificate status information, although these functions are often
      provided by distinct protocols.
</p>
<p>This specification defines a protocol, SCEP, for certificate
      management and certificate and CRL queries in a closed environment.
      While widely deployed, this protocol omits some certificate management
      features, e.g., in-band certificate revocation transactions, that can
      significantly enhance the security achieved in a PKI. The IETF protocol
      suite currently includes two certificate management protocols with more
      comprehensive functionality: <a class='info' href='#RFC4210'>CMP<span> (</span><span class='info'>Adams, C., Farrell, S., Kause, T., and T. Mononen, &ldquo;Internet X.509 Public Key Infrastructure Certificate Management Protocol (CMP),&rdquo; September&nbsp;2005.</span><span>)</span></a> [RFC4210] and <a class='info' href='#RFC5272'>Certificate Management over CMS<span> (</span><span class='info'>Schaad, J. and M. Myers, &ldquo;Certificate Management over CMS (CMC),&rdquo; June&nbsp;2008.</span><span>)</span></a> [RFC5272]. Where
      interoperability with the installed base of SCEP implementations is
      required, implementers are encouraged to support a comprehensive
      standards track certificate management protocol in addition to the
      protocol defined in this specification. This implementation strategy
      balances near term requirements for interoperability with longer term
      security goals.
</p>
<p>As a reflection of the history of SCEP implementations some of the
      operations described in this document are indicated as 'SHOULD' or 'MAY'
      where a stricter protocol specification might have indicated a
      'MUST'.
</p>
<p>The protocol supports the following general operations:
</p>
<p></p>
<ul class="text">
<li>CA and RA public key distribution
</li>
<li>Certificate enrollment
</li>
<li>Certificate query
</li>
<li>CRL query
</li>
</ul><p>SCEP makes extensive use of <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] and <a class='info' href='#RFC2986'>PKCS#10<span> (</span><span class='info'>Nystrom, M. and B. Kaliski, &ldquo;PKCS #10: Certification Request Syntax Specification Version 1.7,&rdquo; November&nbsp;2000.</span><span>)</span></a> [RFC2986].
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="scepops"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
SCEP Overview</h3>

<p>In this section, we give a high level overview of the functionality
      of SCEP.
</p>
<a name="scep_entities"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
SCEP Entities</h3>

<p>The entity types defined in SCEP are </p>
<ul class="text">
<li>the <a class='info' href='#requester'>Requester<span> (</span><span class='info'>Requester</span><span>)</span></a> (e.g., IPSEC
            clients)
</li>
<li>the Server, which may be either a <a class='info' href='#certauth'>Certification Authority (CA)<span> (</span><span class='info'>Certification Authority</span><span>)</span></a> or a <a class='info' href='#reg_auth'>Registration Authority (RA)<span> (</span><span class='info'>Registration Authority</span><span>)</span></a>
</li>
</ul>

<a name="requester"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.1"></a><h3>2.1.1.&nbsp;
Requester</h3>

<p>The requester is sometimes called a "client" in this document. It
          is the client of the SCEP exchange.
</p>
<p>The requester MAY submit SCEP messages for itself or it MAY
          submit SCEP messages on behalf of peers as described in <a class='info' href='#reg_auth'>Registration Authority<span> (</span><span class='info'>Registration Authority</span><span>)</span></a>. This section
          focuses on the requester that is obtaining certificates for its own
          use.
</p>
<p>Before a requester can start a PKI transaction, it MUST have at
          least one RSA key pair use for signing the <a class='info' href='#signeddata'>SCEP pkiMessage<span> (</span><span class='info'>SCEP pkiMessage</span><span>)</span></a>.
</p>
<p>The requester MUST use RSA keys for all symmetric key operations.
          (The message types, being based on <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315], fully support algorithm
          agility).
</p>
<p>A requester MUST have the following information locally
          configured:
</p>
<p></p>
<ol class="text">
<li>The Certification Authority IP address or fully qualified
              domain name
</li>
<li>The Certification Authority HTTP CGI script path
</li>
<li>The identifying information that is used for authentication
              of the Certification Authority in <a class='info' href='#getcacertresp'>Section&nbsp;4.1.1<span> (</span><span class='info'>Get CA Certificate Response Message Format</span><span>)</span></a>. This information MAY be obtained
              from the user, or presented to the end user for manual
              authorization during the protocol exchange (e.g. the user
              indicates acceptance of a fingerprint via a user-interface
              element).
</li>
</ol>

<p>The requester MUST have MESSAGE information configured if the
          Certification Authority requires it (see <a class='info' href='#sceptransport_get'>Section&nbsp;5.1<span> (</span><span class='info'>HTTP &quot;GET&quot; Message Format</span><span>)</span></a>).
</p>
<p>The requester MAY maintain multiple independent configurations
          appropriate for multiple Certification Authorities. Doing so does
          not effect the protocol operation and is not in scope of this
          document.
</p>
<p>Certificate requests for certificates whose purpose is a specific
          solution are encouraged to conform to the solution's profile, e.g.
          <a class='info' href='#RFC4945'>[RFC4945]<span> (</span><span class='info'>Korver, B., &ldquo;The Internet IP Security PKI Profile of IKEv1/ISAKMP, IKEv2, and PKIX,&rdquo; August&nbsp;2007.</span><span>)</span></a> section 5 for IKE/IPsec
          certificates.
</p>
<a name="certauth"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.2"></a><h3>2.1.2.&nbsp;
Certification Authority</h3>

<p>An SCEP Certification Authority (CA) is the entity that signs
          client certificates. The CAs name appears in the issuer field of
          resulting certificates.
</p>
<p>Before any PKI operations can occur, the SCEP CA server obtains a
          'CA' certificate that matches the profile in <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>. This MAY be a CA certificate that was
          issued by a higher level CA.
</p>
<p>The SCEP server CA certificate MUST be provided out-of-band to
          the SCEP requester. The CA certificate fingerprint MAY be used to
          authenticate a CA Certificate distributed by the <a class='info' href='#getcacertresp'>GetCACert response<span> (</span><span class='info'>Get CA Certificate Response Message Format</span><span>)</span></a>. The fingerprint is
          created by calculating a SHA-1, SHA-256, SHA-512, or MD5 hash on the
          whole CA certificate.
</p>
<p>The certification authority MUST either include a
          cRLDistributionPoint extension in every certificate it issues or
          answer CRL queries itself, in which case it SHOULD be online at all
          times. The certification authority SHOULD either answer certificate
          queries or make certificates available via LDAP.
</p>
<p>A certification authority may enforce any arbitrary policies,
          including name uniqueness policies, and apply them to certification
          requests. The certification authority MAY reject any request. If the
          client has already been issued a certificate for this keypair the
          server MAY return the previously created certificate. The requester
          MUST NOT assume any of the fields in the certification request,
          except for the public key, will be the same in the certificate
          issued.
</p>
<p>If a client times out from polling for a pending request it can
          resynchronize by reissuing the original request with the original
          subject name, key, and transaction ID. The CA SHOULD return the
          status of the original transaction, including the certificate if it
          was granted. The CA SHOULD NOT create a new transaction unless the
          original certificate has been revoked, or the transaction arrives
          more than halfway through the validity period of the original
          certificate.
</p>
<a name="reg_auth"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.3"></a><h3>2.1.3.&nbsp;
Registration Authority</h3>

<p>An SCEP Registration Authority (RA) is an SCEP server that
          performs validation and authorization checks of the SCEP requester
          but forwards the certification requests to the CA. The RAs name does
          not appear in the issuer field of resulting certificates.
</p>
<p>The RA MUST return the RA certificate, in addition to the CA
          certificate, in the GetCACert Response (see <a class='info' href='#cararesp'>Section&nbsp;5.2.1.1.2<span> (</span><span class='info'>CA and RA Certificates Response</span><span>)</span></a>). The existence of an RA certificate in
          this response indicates to the client that an RA is in use. In order
          to securely communicate with an RA using <a class='info' href='#pkcs7_transport'>SCEP Secure Message Objects<span> (</span><span class='info'>SCEP Secure Message Objects</span><span>)</span></a> the
          client MUST use the RA's keys instead of the CA's keys to sign the
          messages.
</p>
<p>In order to service certification requests the RA must pass the
          requests to the CA server for signing. The RA MAY use SCEP to
          communicate with the CA, in which case the RA acts as both an SCEP
          server (between the client and the RA) and an SCEP requester
          (between the RA and the CA). The RA MAY respond to client
          certificate requests with a PENDING response while communicating
          with the CA; for example if the CA must manually authorize a
          certification request and thus returns PENDING to the RA the RA may
          respond with PENDING to the client while polling the CA.
</p>
<p>Communication between the RA and the CA MAY be over other
          protocols such as <a class='info' href='#RFC5272'>Certificate Management over
          CMS<span> (</span><span class='info'>Schaad, J. and M. Myers, &ldquo;Certificate Management over CMS (CMC),&rdquo; June&nbsp;2008.</span><span>)</span></a> [RFC5272].
</p>
<a name="req_auth"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Requester authentication</h3>

<p>As with every protocol that uses public-key cryptography, the
        association between the public keys used in the protocol and the
        identities with which they are associated must be authenticated in a
        cryptographically secure manner. This requirement is needed to prevent
        a "man-in-the-middle" attack, in which an adversary can manipulate the
        data as it travels between the protocol participants and subvert the
        security of the protocol.
</p>
<p>The communication between the requester and the certification
        authority are secured using <a class='info' href='#pkcs7_transport'>SCEP Secure
        Message Objects<span> (</span><span class='info'>SCEP Secure Message Objects</span><span>)</span></a> which specifies how <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] is used to encrypt and sign the data.
        In order to perform the signing operation the client uses an
        appropriate local certificate:
</p>
<p></p>
<ol class="text">
<li>If the requesting system already has a certificate issued by
            the SCEP server, and the server supports RENEWAL (see <a class='info' href='#cacaps'>Appendix&nbsp;C<span> (</span><span class='info'>CA Capabilities</span><span>)</span></a>), that certificate SHOULD be used.
</li>
<li>If the requesting system has no certificate issued by the new
            CA, but has credentials from an alternate CA the certificate
            issued by the alternate CA MAY be used. Policy settings on the new
            CA will determine if the request can be accepted or not. This is
            useful when enrolling with a new administrative domain; by using a
            certificate from the old domain as credentials.
</li>
<li>If the requester does not have an appropriate existing
            certificate, then a locally generated self-signed certificate MUST
            be used instead. The self-signed certificate MUST use the same
            subject name as in the PKCS#10 request.
</li>
</ol><p>During the certificate enrollment, the requester MUST use the
        selected certificate to sign the <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315]
        (see <a class='info' href='#pkcs7_transport'>Section&nbsp;3<span> (</span><span class='info'>SCEP Secure Message Objects</span><span>)</span></a>). The server CertResp uses
        this signing certificate when encrypting the response (see <a class='info' href='#certrep'>Section&nbsp;3.2.2<span> (</span><span class='info'>CertRep</span><span>)</span></a>).
</p>
<p>When the certification authority creates the <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] envelope on the issued certificate, it
        SHOULD use the public key, issuer name, and serial number conveyed in
        the above included certificate. This will inform the end entity of
        which private key should be used to open the envelope. Note that when
        a client enrolls for separate encryption and signature certificates,
        it MAY use the signature certificate to sign both requests, and then
        expect its signature key to be used to encrypt both responses. In any
        case, the RecipientInfo on the envelope MUST reflect the key used to
        encrypt the request.
</p>
<a name="enrollment_authz"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Enrollment authorization</h3>

<p>There are two mechanisms for automated enrollment
        authorization.
</p>
<p>Since the client uses an existing certificate to sign SCEP messages
        the server MAY use this certificate to authenticate the client and
        determine the appropriate authorization. In addition to the policy
        requirements implied by optional support of RENEWAL, see <a class='info' href='#cert_renew'>Appendix&nbsp;D<span> (</span><span class='info'>Client Certificate Renewal</span><span>)</span></a>, the SCEP server SHOULD implement
        appropriate logic to support client authentication and automated
        enrollment using existing client credentials that were issued by an
        alternate PKI hierarchy.
</p>
<p>Additionally <a class='info' href='#RFC2986'>PKCS#10<span> (</span><span class='info'>Nystrom, M. and B. Kaliski, &ldquo;PKCS #10: Certification Request Syntax Specification Version 1.7,&rdquo; November&nbsp;2000.</span><span>)</span></a> [RFC2986] specifies the
        use of a <a class='info' href='#RFC2985'>PKCS#9<span> (</span><span class='info'>Nystrom, M. and B. Kaliski, &ldquo;PKCS #9: Selected Object Classes and Attribute Types Version 2.0,&rdquo; November&nbsp;2000.</span><span>)</span></a> [RFC2985] challengePassword
        attribute to be sent as part of the enrollment request. SCEP
        optionally uses this challengePassword to allow for unauthenticated
        authorization of enrollment requests. The <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] envelope protects the privacy of the
        challenge password.
</p>
<p>When utilizing the challengePassword, the server distributes a
        shared secret to the requester which will uniquely associate the
        enrollment request with the requester. The distribution of the secret
        must be private: only the end entity should know this secret. If a
        challengePassword is provided by the CA operator the client SHOULD use
        this in the certification request. The actual binding mechanism
        between the requester and the secret is subject to the server policy
        and implementation. . The requester MAY use any of the requester
        authentication mechanisms to provide additional authentication
        material, although the server MAY ignore everything but the
        challengePassword.
</p>
<p>In the manual mode the requester's messages wait, or are placed in
        the PENDING state, until the CA operator authorizes or rejects them.
        Manual authorization is used when the client has only a self-signed
        certificate and/or a challengePassword is not available..
</p>
<p>The requester generates a SHA-1, SHA-256, SHA-512, or MD5
        'fingerprint' of the <a class='info' href='#RFC2986'>PKCS#10<span> (</span><span class='info'>Nystrom, M. and B. Kaliski, &ldquo;PKCS #10: Certification Request Syntax Specification Version 1.7,&rdquo; November&nbsp;2000.</span><span>)</span></a> [RFC2986] (before
        <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] enveloping and signing). This
        fingerprint is sent to the CA operator using an out-of-band method.
        The CA operator MUST compared this fingerprint to a locally generated
        fingerprint based on the message received during the SCEP
        exchange.
</p>
<p>SCEP clients and CAs (or RAs, if appropriate) MUST support display
        of this fingerprint to the operator to enable this authorization
        method. The out-of-band distribution and comparison of fingerprints is
        not covered by this document.
</p>
<a name="cara_dist"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
CA/RA Certificate Distribution</h3>

<p>If the CA and/or RA certificates have not previously been acquired
        by the requester in some other means, the requester MUST retrieve the
        CA/RA certificates before any <a class='info' href='#pkcs7_transport'>PKI
        operation<span> (</span><span class='info'>SCEP Secure Message Objects</span><span>)</span></a> can be started.
</p>
<p>Since no public key has yet been exchanged between the requester
        and the CA/RA, the messages cannot be secured using <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315], and the data is instead transferred in
        the clear.
</p>
<p>If an RA is in use, a certificates-only <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] SignedData with a certificate chain
        consisting of both RA and CA certificates is returned. Otherwise the
        CA certificate itself is returned. The <a class='info' href='#scep_transport'>transport protocol<span> (</span><span class='info'>SCEP Transport</span><span>)</span></a> MUST indicate which
        one is returned.
</p>
<p>After the requester gets the CA certificate, it MUST authenticate
        the CA certificate by comparing the CA certificate fingerprint (see
        <a class='info' href='#certauth'>Section&nbsp;2.1.2<span> (</span><span class='info'>Certification Authority</span><span>)</span></a>) with the locally configured,
        out-of-band distributed, identifying information.
</p>
<p>Since the optional RA certificates are signed by the CA there is no
        need to authenticate them against the out-of-band data. Clients MUST
        verify the RA certificate signature before use during protocol
        exchanges. Clients MUST verify the authorization of the RA
        certificates. The authorization mechanism is specified by the CA
        administrator and is out of scope for this document.
</p>
<p>Because a long time can pass between queries from a requester to a
        CA/RA and because RA certificates can change at any time, it is
        recommended that a requester not store RA certificates. Instead, the
        requester SHOULD retrieve the CA/RA certificates before each
        operation.
</p>
<a name="certenroll"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Certificate Enrollment</h3>

<p>A requester starts an <a class='info' href='#pkcsreq'>enrollment<span> (</span><span class='info'>PKCSReq</span><span>)</span></a>
        transaction by creating a certificate request using <a class='info' href='#RFC2986'>PKCS#10<span> (</span><span class='info'>Nystrom, M. and B. Kaliski, &ldquo;PKCS #10: Certification Request Syntax Specification Version 1.7,&rdquo; November&nbsp;2000.</span><span>)</span></a> [RFC2986] and sends it to the CA/RA enveloped
        using the <a class='info' href='#pkcs7_transport'>PKCS#7<span> (</span><span class='info'>SCEP Secure Message Objects</span><span>)</span></a>.
</p>
<p>It is up to local CA policy (and CA implementation) as to whether a
        certificate is granted automatically, or whether it is manually
        granted by the administrator. The challengePassword MAY be used to
        automatically authenticate the request.
</p>
<p>If the CA/RA returns a <a class='info' href='#certrep'>CertRep<span> (</span><span class='info'>CertRep</span><span>)</span></a>
        message with status set to PENDING, the requester enters into polling
        mode by periodically sending a <a class='info' href='#getcertinitial'>GetCertInitial<span> (</span><span class='info'>GetCertInitial</span><span>)</span></a> PKI message to the
        CA/RA, until the CA/RA operator completes the manual authentication
        (approving or denying the request).
</p>
<p>In general, the requester will send a single <a class='info' href='#pkcsreq'>PKCSReq<span> (</span><span class='info'>PKCSReq</span><span>)</span></a> message, followed by 0 or more <a class='info' href='#getcertinitial'>GetCertInitial<span> (</span><span class='info'>GetCertInitial</span><span>)</span></a> messages, if polling
        mode is entered.
</p>
<p>In general, the CA/RA will send 0 or more <a class='info' href='#certrep'>CertRep<span> (</span><span class='info'>CertRep</span><span>)</span></a> messages with status set to PENDING,
        followed by a single <a class='info' href='#certrep'>CertRep<span> (</span><span class='info'>CertRep</span><span>)</span></a> with status
        set to either SUCCESS or FAILURE.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5.1"></a><h3>2.5.1.&nbsp;
Client State Transitions</h3>

<p>The requester state transitions during enrollment operation are
          indicated in <a class='info' href='#statetransdiag'>Figure&nbsp;1<span> (</span><span class='info'>State Transition Diagram</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="statetransdiag"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>                      GetCertInitial
                        +----&lt;---+
                        |        | CertRep(PENDING),
                        |        | GetCertInitial send-timeout,
                        |        | new-poll timer
                        |        |
[CERT-NONEXISTANT] -----+---&gt; [CERT-REQ-PENDING]      [CERT-ISSUED]
      ^             PKCSReq      |          |               ^
      |                          |          |               |
      |                          |          +---------------+
      |                          |           CertRep(SUCCESS)
      +--------------------------+
      CertRep(FAILURE),
      PKCSReq send-timeout,
      max-time/max-polls exceeded</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: State Transition Diagram&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Certificate enrollment starts at the state CERT-NONEXISTANT.
</p>
<p>Sending a PKCSReq message changes the state to CERT-REQ-PENDING.
          If there is no response, or sending is not possible, the state
          reverts back to CERT-NONEXISTANT.
</p>
<p>Receiving a CertRep message with pkiStatus set to SUCCESS changes
          the state to CERT-ISSUED.
</p>
<p>Receiving a CertRep message with pkiStatus set to FAILURE changes
          the state to CERT-NONEXISTANT.
</p>
<p>If the server sends back a CertRep message with pkiStatus set to
          PENDING, the requester will keep polling by sending a GetCertInitial
          message to the server, until either a CertRep message with status
          set to SUCCESS or FAILURE is received, or the maximum number of
          polls has been exceeded.
</p>
<p>If the maximum number of polls has been exceeded or a CertRep
          message with pkiStatus set to FAILURE is received while in the
          CERT-REQ-PENDING state, the end entity will transition to the
          CERT-NONEXISTANT state, and the SCEP client can eventually initiate
          another enrollment request. It is important to note that, as long as
          the requester does not change its subject name or keys, the same
          transaction ID will be used in the "new" transaction. This is
          important because based on this transaction ID, the certification
          authority can recognize this as an existing transaction instead of a
          new one.
</p><br /><hr class="insert" />
<a name="successauto"></a>

<p>A successful transaction in automatic mode:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>         REQUESTER                           CA SERVER

     PKCSReq: PKI cert. enrollment msg
     --------------------------------&gt; CertRep: pkiStatus = SUCCESS
                                       certificate attached
                                      &lt;------------------------------
     Receive issued certificate.</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Automatic mode transaction&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="successmanual"></a>

<p>A successful transaction in manual mode:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>         REQUESTER                           CA SERVER
     PKCSReq: PKI cert. enrollment msg
     --------------------------------&gt; CertRep: pkiStatus = PENDING
                                       &lt;------------------------------
     GetCertInitial: polling msg
     --------------------------------&gt; CertRep: pkiStatus = PENDING
                                       &lt;------------------------------
     ................ &lt;manual identity authentication&gt;...............

     GetCertInitial: polling msg
     --------------------------------&gt; CertRep: pkiStatus = SUCCESS
                                       certificate attached
                                       &lt;------------------------------
     Receive issued certificate.</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Manual mode transaction&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="cert_access"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6"></a><h3>2.6.&nbsp;
Certificate Access</h3>

<p>There are two methods to query certificates. The first method is to
        use LDAP as a query protocol. Using LDAP to query assumes the client
        understands the LDAP scheme supported by the CA. The SCEP client
        assumes that the subject DN in the certificate is used as the URL to
        query the certificate. The standard attributes (userCertificate and
        caCertificate) are used as filter.
</p>
<p>For the environment where LDAP is not available, a certificate
        query message is defined to retrieve the certificates from the CA.
</p>
<p>To query a certificate from the certification authority, a
        requester sends a request consisting of the certificate's issuer name
        and serial number. This assumes that the requester has saved the
        issuer name and the serial number of the issued certificate from the
        previous enrollment transaction. The transaction to query a
        certificate consists of one <a class='info' href='#getcert'>GetCert<span> (</span><span class='info'>GetCert</span><span>)</span></a>
        message and one <a class='info' href='#certrep'>CertRep<span> (</span><span class='info'>CertRep</span><span>)</span></a> message, as
        shown in <a class='info' href='#getcertdiag'>Figure&nbsp;4<span> (</span><span class='info'>GetCert Transaction</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="getcertdiag"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>        REQUESTER                           CA SERVER
     GetCert: PKI certificate query msg
     -------------------------------&gt; CertRep:  pkiStatus = SUCCESS
                                      certificate attached
                                      &lt;-----------------------------
     Receive the certificate.</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: GetCert Transaction&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="crl_access"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.7"></a><h3>2.7.&nbsp;
CRL Access</h3>

<p>SCEP clients request a CRL via one of two methods:
</p>
<p></p>
<ol class="text">
<li>If the CA supports <a class='info' href='#RFC5280'>CRL Distribution
            Points<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> [RFC5280] (section 4.2.1.13), then the CRL MUST be retrieved
            via the mechanism specified in the CDP.
</li>
<li>If the CA does not support CDP's, a CRL query is composed by
            creating a GetCRL message consisting of the issuer name and serial
            number from a certificate within the scope of the CRL to be
            retrieved (e.g. from a certificate to be validated).
</li>
</ol>

<p>The server SHOULD NOT support the GetCRL method because:</p>
<ul class="text">
<li>it does not scale well due to the unnecessary cryptography
            (see, <a class='info' href='#unnecessarycrypto'>Section&nbsp;8.8<span> (</span><span class='info'>Unnecessary cryptography</span><span>)</span></a>)
</li>
<li>it requires the CA to be a high-availability service
</li>
<li>only limited information to determine the CRL scope is provided
            (see <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> Section 5).
</li>
</ul>

<p>The message is sent to the SCEP server in the same way as the other
        SCEP requests: The transaction to retrieve a CRL consists of one
        GetCRL PKI message and one CertRep PKI message, which contains only
        the CRL (no certificates), as shown in <a class='info' href='#getcrldiag'>Figure&nbsp;5<span> (</span><span class='info'>GetCRL Transaction</span><span>)</span></a>.
</p>
<p>On receipt of this message, the SCEP server MAY use the
        IssuerAndSerial information to return an appropriate CRL.
</p><br /><hr class="insert" />
<a name="getcrldiag"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
         REQUESTER                           CA SERVER
     GetCRL: PKI CRL query msg
  ----------------------------------&gt;
                                    CertRep:  CRL attached
                                 &lt;--------------------------------</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: GetCRL Transaction&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="certrevoke"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.8"></a><h3>2.8.&nbsp;
Certificate Revocation</h3>

<p>SCEP does not specify a method to request certificate
        revocation.
</p>
<p>In order to revoke a certificate, the requester must contact the CA
        server operator using a non-SCEP defined mechanism. Although the <a class='info' href='#RFC2986'>PKCS#10<span> (</span><span class='info'>Nystrom, M. and B. Kaliski, &ldquo;PKCS #10: Certification Request Syntax Specification Version 1.7,&rdquo; November&nbsp;2000.</span><span>)</span></a> [RFC2986] challengePassword is used by SCEP for
        enrollment authorization (see <a class='info' href='#enrollment_authz'>Enrollment authorization<span> (</span><span class='info'>Enrollment authorization</span><span>)</span></a>) this does
        not inhibit the CA server from maintaining a record of the
        challengePassword to use during subsequent revocation operations as
        implied by <a class='info' href='#RFC2985'>[RFC2985]<span> (</span><span class='info'>Nystrom, M. and B. Kaliski, &ldquo;PKCS #9: Selected Object Classes and Attribute Types Version 2.0,&rdquo; November&nbsp;2000.</span><span>)</span></a>.
</p>
<a name="pkcs7_transport"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
SCEP Secure Message Objects</h3>

<p><a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] is a general enveloping
      mechanism that enables both signed and encrypted transmission of
      arbitrary data.
</p>
<p>All messages MUST be valid <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315]
      structures, unless otherwise noted.
</p>
<p>SCEP messages that require confidentiality use two layers of PKCS#7,
      as shown in <a class='info' href='#pkcspic'>Figure&nbsp;6<span> (</span><span class='info'>PKCS#7 Layering</span><span>)</span></a>. By applying both enveloping
      and signing transformations, the SCEP message is protected both for the
      integrity of its end-to-end transaction information and the
      confidentiality of its information portion. The advantage of this
      technique over the conventional transaction message format is that the
      signed transaction type information and the status of the transaction
      can be determined prior to invoking security handling procedures
      specific to the information portion being processed.
</p>
<p>Some messages do not require enveloping, in which case the
      EnvelopedData in <a class='info' href='#pkcspic'>Figure&nbsp;6<span> (</span><span class='info'>PKCS#7 Layering</span><span>)</span></a> is omitted.
</p><br /><hr class="insert" />
<a name="pkcspic"></a>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre> ContentType = SignedData (called pkiMessage)
   SignerInfo
      Signature
      authenticatedAttributes
         transactionID
         messageType
         pkiStatus
         failInfo
         senderNonce
         recipientNonce
         etc
   ContentInfo type = EnvelopedData (called pkcsPKIEnvelope; optional)
      RecipientInfo
      ContentInfo type = Data
         messageData</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: PKCS#7 Layering&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Description:</p>
<ul class="text">
<li>The outer PKCS#7 is a <a class='info' href='#signeddata'>pkiMessage<span> (</span><span class='info'>SCEP pkiMessage</span><span>)</span></a>.
</li>
<li>The SignedData ContentInfo, if present (e.g. FAILURE and PENDING
          CertRep messages will lack any signed content), MUST be a <a class='info' href='#envelope'>pkcsPKIEnvelope<span> (</span><span class='info'>SCEP pkcsPKIEnvelope</span><span>)</span></a>.
</li>
</ul><p>When a particular SCEP message carries data, this data is
      carried in the messageData.
</p>
<p>Note: The remainder of this document will refer only to
      'messageData', but it is understood to always be encapsulated in the
      <a class='info' href='#envelope'>pkcsPKIEnvelope<span> (</span><span class='info'>SCEP pkcsPKIEnvelope</span><span>)</span></a>. The format of the data
      in the messageData is defined by the messageType attribute (see <a class='info' href='#signedAttributes'>Section&nbsp;3.1.1<span> (</span><span class='info'>Signed Transaction Attributes</span><span>)</span></a>) of the SignedData. If there is no
      messageData to be transmitted, the entire pkcsPKIEnvelope MUST be
      omitted.
</p>
<a name="signeddata"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
SCEP pkiMessage</h3>

<p>The basic building block of all secured SCEP messages is the SCEP
        pkiMessage. It consists of an PKCS#7 signed-data content type, as
        defined in <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] Section 9. The
        following restrictions apply:
</p>
<p></p>
<ul class="text">
<li>version MUST be 1
</li>
<li>the contentType in contentInfo MUST be data ({pkcs-7 1}) as
            defined in <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] Section 8.
</li>
<li>The signed content, if present (e.g. FAILURE and PENDING
            CertRep messages will lack any signed content), MUST be a <a class='info' href='#envelope'>pkcsPKIEnvelope<span> (</span><span class='info'>SCEP pkcsPKIEnvelope</span><span>)</span></a>, and must match the
            messageType attribute.
</li>
<li>The SignerInfo MUST contain a set of authenticatedAttributes
            (see <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] Section 9.2 as well as
            <a class='info' href='#signedAttributes'>Section&nbsp;3.1.1<span> (</span><span class='info'>Signed Transaction Attributes</span><span>)</span></a> in this document). All
            messages MUST contain
<ul class="text">
<li>an SCEP transactionID attribute
</li>
<li>an SCEP messageType attribute
</li>
<li>an SCEP senderNonce attribute
</li>
<li>any attributes required by <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] section 9.2
</li>
</ul>If the message is a response, it MUST also include 
<ul class="text">
<li>an SCEP pkiStatus attribute
</li>
<li>an SCEP recipientNonce attribute
</li>
</ul>
</li>
</ul>

<a name="signedAttributes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
Signed Transaction Attributes</h3>

<p>The following transaction attributes are encoded as authenticated
          attributes, and are carried, as specified in <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] Section 9.2, in the SignerInfo for
          this signedData.
</p>
<p>Please refer to <a class='info' href='#oiddef'>Appendix&nbsp;A<span> (</span><span class='info'>Private OID Definitions</span><span>)</span></a> for the OID
          definitions.
</p><br /><hr class="insert" />
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">Attribute</th><th align="left">Encoding</th><th align="left">Comment</th></tr>
<tr>
<td align="left">transactionID</td>
<td align="left">PrintableString</td>
<td align="left">Hash value as a string</td>
</tr>
<tr>
<td align="left">messageType</td>
<td align="left">PrintableString</td>
<td align="left">Decimal value as a string</td>
</tr>
<tr>
<td align="left">pkiStatus</td>
<td align="left">PrintableString</td>
<td align="left">Decimal value as a string</td>
</tr>
<tr>
<td align="left">failInfo</td>
<td align="left">PrintableString</td>
<td align="left">Decimal value as a string</td>
</tr>
<tr>
<td align="left">senderNonce</td>
<td align="left">OCTET STRING</td>
<td align="left">&nbsp;</td>
</tr>
<tr>
<td align="left">recipientNonce</td>
<td align="left">OCTET STRING</td>
<td align="left">&nbsp;</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Transaction Attributes&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The attributes are detailed in the following sections.
</p>
<a name="transactID"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.1"></a><h3>3.1.1.1.&nbsp;
transactionID</h3>

<p>A PKI operation is a transaction consisting of the messages
            exchanged between a requester and the server. The transaction
            identifier is a string generated by the client when starting a
            transaction. The client MUST generate a unique string as the
            transaction identifier, which MUST be used for all PKI messages
            exchanged for a given enrollment, encoded as a
            PrintableString.
</p>
<p>The transaction identifier SHOULD be generated as a SHA-1,
            SHA-256, SHA-512 or MD5 hash on the public key value for which the
            enrollment request is made. This allows the SCEP client to
            automatically generate the same transaction id for any given
            keypair. The SCEP protocol requires that transaction identifiers
            be unique, so that subsequent polling queries can be matched with
            previous transactions. Thus, if separate signing and encryption
            certificates are requested by the client the keys must be
            different.
</p>
<p>When using the certificate query and CRL query messages defined
            in this protocol, the transaction identifier is still required so
            that the requester can match the response message with the
            outstanding request message. When using LDAP to query the
            certificate and the CRL, the behavior is specified by the LDAP
            protocol. For a non-enrollment message (for example GetCert and
            GetCRL), the transactionID SHOULD be a number unique to the
            client.
</p>
<a name="messType"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.2"></a><h3>3.1.1.2.&nbsp;
messageType</h3>

<p>The messageType attribute specifies the type of operation
            performed by the transaction. This attribute MUST be included in
            all PKI messages. Currently, the following message types are
            defined:
</p>
<p></p>
<ul class="text">
<li>PKCSReq (19) -- <a class='info' href='#RFC2986'>PKCS#10<span> (</span><span class='info'>Nystrom, M. and B. Kaliski, &ldquo;PKCS #10: Certification Request Syntax Specification Version 1.7,&rdquo; November&nbsp;2000.</span><span>)</span></a> [RFC2986]
                certificate request
</li>
<li>CertRep (3) -- Response to certificate or CRL request
</li>
<li>GetCertInitial (20) -- Certificate polling in manual
                enrollment
</li>
<li>GetCert (21) -- Retrieve a certificate
</li>
<li>GetCRL (22) -- Retrieve a CRL
</li>
</ul>

<a name="pkiStatus"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.3"></a><h3>3.1.1.3.&nbsp;
pkiStatus</h3>

<p>All response messages MUST include transaction status
            information, which is defined as pkiStatus attribute:
</p>
<p></p>
<ul class="text">
<li>SUCCESS (0) -- request granted
</li>
<li>FAILURE (2) -- request rejected. When pkiStatus is FAILURE,
                the failInfo attribute, as defined in <a class='info' href='#failInfo'>Section&nbsp;3.1.1.4<span> (</span><span class='info'>failInfo</span><span>)</span></a>, MUST also be present.
</li>
<li>PENDING (3) -- request pending for manual approval
</li>
</ul>

<a name="failInfo"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.4"></a><h3>3.1.1.4.&nbsp;
failInfo</h3>

<p>The failInfo attribute MUST contain one of the following
            failure reasons:
</p>
<p></p>
<ul class="text">
<li>badAlg (0) -- Unrecognized or unsupported algorithm
                identifier
</li>
<li>badMessageCheck (1) -- integrity check failed
</li>
<li>badRequest (2) -- transaction not permitted or
                supported
</li>
<li>badTime (3) -- The signingTime attribute from the PKCS#7
                authenticatedAttributes was not sufficiently close to the
                system time (see <a class='info' href='#signingTime'>Section&nbsp;3.1.1.6<span> (</span><span class='info'>signingTime Attribute</span><span>)</span></a>).
</li>
<li>badCertId (4) -- No certificate could be identified
                matching the provided criteria
</li>
</ul>

<a name="nonces"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.5"></a><h3>3.1.1.5.&nbsp;
senderNonce and recipientNonce</h3>

<p>The attributes of senderNonce and recipientNonce are 16 byte
            random numbers generated for each transaction to prevent replay
            attacks.
</p>
<p>When a requester sends a PKI message to the server, a
            senderNonce MUST be included in the message.
</p>
<p>The recipient SHOULD copy the senderNonce into the
            recipientNonce of the reply as a proof of liveliness.
</p>
<p>The requester SHOULD verify that the recipientNonce of the
            reply matches the senderNonce it sent in the request.
</p>
<a name="signingTime"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.6"></a><h3>3.1.1.6.&nbsp;
signingTime Attribute</h3>

<p>The signingTime Attribute is defined in <a class='info' href='#RFC2985'>[RFC2985]<span> (</span><span class='info'>Nystrom, M. and B. Kaliski, &ldquo;PKCS #9: Selected Object Classes and Attribute Types Version 2.0,&rdquo; November&nbsp;2000.</span><span>)</span></a> Section 5.3.3, and is carried as defined
            in a <a class='info' href='#RFC2315'>[RFC2315]<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> authenticated attribute
            (Section 9.2). This attribute is optional.
</p>
<a name="envelope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2"></a><h3>3.1.2.&nbsp;
SCEP pkcsPKIEnvelope</h3>

<p>The information portion of a SCEP message is carried inside an
          enveloped-data content type, as defined in <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] Section 10, with the following
          restrictions:
</p>
<p></p>
<ul class="text">
<li>version MUST be 0
</li>
<li>contentType in encryptedContentInfo MUST be data ({pkcs-7 1})
              as defined in <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] Section
              8.
</li>
<li>encryptedContent MUST be the SCEP message being transported
              (see <a class='info' href='#scepmessages'>Section&nbsp;4<span> (</span><span class='info'>SCEP Transactions</span><span>)</span></a>), and must match the
              messageType authenticated Attribute in the pkiMessage.
</li>
</ul><p>The <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] content-encryption
          key (see Section 10, step 2) is encrypted using the public key of
          the recipient of the message, i.e. the RA or the CA public key (if
          sent from the requester), or the requester public key (if sent as a
          reply to the requester).
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
SCEP pkiMessage types</h3>

<p>All of the messages in this section are <a class='info' href='#signeddata'>pkiMessages<span> (</span><span class='info'>SCEP pkiMessage</span><span>)</span></a>, where the type of the message
        MUST be specified in the 'messageType' authenticated Attribute. Each
        section defines a valid message type, the corresponding messageData
        formats, and mandatory authenticated attributes for that type.
</p>
<a name="pkcsreq"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
PKCSReq</h3>

<p>The messageData for this type consists of a DER-encoded <a class='info' href='#RFC2986'>PKCS#10 Certification Request<span> (</span><span class='info'>Nystrom, M. and B. Kaliski, &ldquo;PKCS #10: Certification Request Syntax Specification Version 1.7,&rdquo; November&nbsp;2000.</span><span>)</span></a> [RFC2986]. The
          certification request MAY contain any fields defined in <a class='info' href='#RFC2986'>PKCS#10<span> (</span><span class='info'>Nystrom, M. and B. Kaliski, &ldquo;PKCS #10: Certification Request Syntax Specification Version 1.7,&rdquo; November&nbsp;2000.</span><span>)</span></a> [RFC2986], and MUST contain at least the
          following items:</p>
<ul class="text">
<li>the subject Distinguished Name
</li>
<li>the subject public key
</li>
<li>a challengePassword attribute. The Challenge Password may be
              used to (out-of-band) authenticate the enrollment request
              itself, or in an out-of-band revocation request for the issued
              certificate.
</li>
</ul><p>In addition to the authenticatedAttributes required for a
          valid <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315], this pkiMessage MUST
          include the following attributes:</p>
<ul class="text">
<li>a <a class='info' href='#transactID'>transactionID<span> (</span><span class='info'>transactionID</span><span>)</span></a>
              attribute
</li>
<li>a <a class='info' href='#messType'>messageType<span> (</span><span class='info'>messageType</span><span>)</span></a> attribute set to
              PKCSReq
</li>
<li>a <a class='info' href='#nonces'>senderNonce<span> (</span><span class='info'>senderNonce and recipientNonce</span><span>)</span></a> attribute
</li>
</ul><p>The pkcsPKIEnvelope for this message type is protected
          using the public key of the recipient as detailed in <a class='info' href='#envelope'>Section&nbsp;3.1.2<span> (</span><span class='info'>SCEP pkcsPKIEnvelope</span><span>)</span></a>. For example the CA or RA public key.
</p>
<a name="certrep"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2"></a><h3>3.2.2.&nbsp;
CertRep</h3>

<p>The messageData for this type consists of a DER-encoded <a class='info' href='#degeneratep7'>degenerate certificates-only
          Signed-data<span> (</span><span class='info'>Degenerate certificates-only PKCS#7 Signed-data</span><span>)</span></a>. The exact contents required for certain CertRep
          replies depends on the type of request this message is a reply to
          and is detailed in <a class='info' href='#certreptypes'>Table&nbsp;1<span> (</span><span class='info'>CertRep Types</span><span>)</span></a> and in <a class='info' href='#scepmessages'>Section&nbsp;4<span> (</span><span class='info'>SCEP Transactions</span><span>)</span></a>.
</p>
<p>In addition to the authenticatedAttributes required for a valid
          <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315], this pkiMessage MUST include
          the following attributes:</p>
<ul class="text">
<li>the <a class='info' href='#transactID'>transactionID<span> (</span><span class='info'>transactionID</span><span>)</span></a> attribute
              copied from the request we are responding to
</li>
<li>a <a class='info' href='#messType'>messageType<span> (</span><span class='info'>messageType</span><span>)</span></a> attribute set to
              CertRep
</li>
<li>a <a class='info' href='#nonces'>senderNonce<span> (</span><span class='info'>senderNonce and recipientNonce</span><span>)</span></a> attribute
</li>
<li>a <a class='info' href='#nonces'>recipientNonce attribute<span> (</span><span class='info'>senderNonce and recipientNonce</span><span>)</span></a>
              copied from the senderNonce from the request we are responding
              to.
</li>
<li>a <a class='info' href='#pkiStatus'>pkiStatus<span> (</span><span class='info'>pkiStatus</span><span>)</span></a> set to the status
              of the reply.
</li>
</ul>

<p>The pkcsPKIEnvelope for this message type is protected using the
          public key of the recipient as detailed in <a class='info' href='#envelope'>Section&nbsp;3.1.2<span> (</span><span class='info'>SCEP pkcsPKIEnvelope</span><span>)</span></a>. For example if a self-signed certificate
          was used to send the original request then this self-signed
          certificate's public key is used to encrypt the content-encryption
          key of the SUCCESS response's pkcsPKIEnvelope.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2.1"></a><h3>3.2.2.1.&nbsp;
CertRep SUCCESS</h3>

<p>When the pkiStatus attribute is set to SUCCESS, the messageData
            for this message consists of a DER-encoded <a class='info' href='#degeneratep7'>degenerate certificates-only
            Signed-data<span> (</span><span class='info'>Degenerate certificates-only PKCS#7 Signed-data</span><span>)</span></a>. The contents of this degenerate
            certificates-only Signed-Data depends on what the original request
            was, as outlined in <a class='info' href='#certreptypes'>Table&nbsp;1<span> (</span><span class='info'>CertRep Types</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="certreptypes"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Request-type</th><th align="left">Reply-contents</th></tr>
<tr>
<td align="left">PKCSReq</td>
<td align="left">the reply MUST contain at least the issued certificate in the
              certificates field of the Signed-Data. The reply MAY contain
              additional certificates, but the issued certificate MUST be the
              first in the list. The reply MUST NOT contain any CRL's. All
              returned certificates MUST conform to <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>.</td>
</tr>
<tr>
<td align="left">GetCertInitial</td>
<td align="left">same as PKCSReq</td>
</tr>
<tr>
<td align="left">GetCert</td>
<td align="left">the reply MUST contain at least the requested certificate in
              the certificates field of the Signed-Data. The reply MAY contain
              additional certificates, but the requested certificate MUST be
              the first in the list. The reply MUST NOT contain any CRL's. All
              returned certificates MUST conform to <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>.</td>
</tr>
<tr>
<td align="left">GetCRL</td>
<td align="left">the reply MUST contain the CRL in the crls field of the
              Signed-Data. The reply MUST NOT contain any certificates. The
              CRL MUST be a valid CRL according to <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>.</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 1: CertRep Types&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2.2"></a><h3>3.2.2.2.&nbsp;
CertRep FAILURE</h3>

<p>When the pkiStatus attribute is set to FAILURE, the reply MUST
            also contain a <a class='info' href='#failInfo'>failInfo<span> (</span><span class='info'>failInfo</span><span>)</span></a> attribute
            set to the appropriate error condition describing the failure. The
            <a class='info' href='#envelope'>pkcsPKIEnvelope<span> (</span><span class='info'>SCEP pkcsPKIEnvelope</span><span>)</span></a> MUST be
            omitted.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2.3"></a><h3>3.2.2.3.&nbsp;
CertRep PENDING</h3>

<p>When the pkiStatus attribute is set to PENDING, the <a class='info' href='#envelope'>pkcsPKIEnvelope<span> (</span><span class='info'>SCEP pkcsPKIEnvelope</span><span>)</span></a> MUST be omitted.
</p>
<a name="getcertinitial"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.3"></a><h3>3.2.3.&nbsp;
GetCertInitial</h3>

<p>The messageData for this type consists of a DER-encoded <a class='info' href='#issuerandsubject'>IssuerAndSubject<span> (</span><span class='info'>IssuerAndSubject</span><span>)</span></a>. The issuer is set
          to the issuerName from the certification authority from which we are
          issued certificates. The Subject is set to the SubjectName we used
          when requesting the certificate.
</p>
<p>In addition to the authenticatedAttributes required for a valid
          <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315], this pkiMessage MUST include
          the following attributes:</p>
<ul class="text">
<li>the same <a class='info' href='#transactID'>transactionID<span> (</span><span class='info'>transactionID</span><span>)</span></a>
              attribute from original PKCSReq message
</li>
<li>a <a class='info' href='#messType'>messageType<span> (</span><span class='info'>messageType</span><span>)</span></a> attribute set to
              GetCertInitial
</li>
<li>a <a class='info' href='#nonces'>senderNonce<span> (</span><span class='info'>senderNonce and recipientNonce</span><span>)</span></a> attribute
</li>
</ul>

<a name="issuerandsubject"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.3.1"></a><h3>3.2.3.1.&nbsp;
IssuerAndSubject</h3>

<p>Similar to the IssuerAndSerial defined in <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] Section 6.7, we need to define an
            <a class='info' href='#issuerandsubjectpic'>IssuerAndSubject ASN.1
            type<span> (</span><span class='info'>IssuerAndSubject ASN.1</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="issuerandsubjectpic"></a>

<p>The ASN.1 definition of the issuerAndSubject type is
              as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>issuerAndSubject ::= SEQUENCE {
    issuer Name,
    subject Name
}</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: IssuerAndSubject ASN.1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="getcert"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.4"></a><h3>3.2.4.&nbsp;
GetCert</h3>

<p>The messageData for this type consists of a DER-encoded
          IssuerAndSerial as defined in <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315]
          Section 6.7 containing the "distinguished name of the certificate
          issuer and an issuer-specific certificate serial number" which
          uniquely identifies the certificate being requested.
</p>
<p>In addition to the authenticatedAttributes required for a valid
          <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315], this pkiMessage MUST include
          the following attributes:</p>
<ul class="text">
<li>a <a class='info' href='#transactID'>transactionID<span> (</span><span class='info'>transactionID</span><span>)</span></a>
              attribute
</li>
<li>a <a class='info' href='#messType'>messageType<span> (</span><span class='info'>messageType</span><span>)</span></a> attribute set to
              GetCert
</li>
<li>a <a class='info' href='#nonces'>senderNonce<span> (</span><span class='info'>senderNonce and recipientNonce</span><span>)</span></a> attribute
</li>
</ul><p>A self-signed certificate MAY be used in the signed
          envelope. This enables the requester to request their own
          certificate if they were unable to store it previously.
</p>
<a name="getcrl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.5"></a><h3>3.2.5.&nbsp;
GetCRL</h3>

<p>The messageData for this type consists of a DER-encoded
          IssuerAndSerial as defined in <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315]
          Section 6.7 the issuer name and serial number from the certificate
          to be validated.
</p>
<p>In addition to the authenticatedAttributes required for a valid
          <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315], this pkiMessage MUST include
          the following attributes:</p>
<ul class="text">
<li>a <a class='info' href='#transactID'>transactionID<span> (</span><span class='info'>transactionID</span><span>)</span></a>
              attribute
</li>
<li>a <a class='info' href='#messType'>messageType<span> (</span><span class='info'>messageType</span><span>)</span></a> attribute set to
              GetCRL
</li>
<li>a <a class='info' href='#nonces'>senderNonce<span> (</span><span class='info'>senderNonce and recipientNonce</span><span>)</span></a> attribute
</li>
</ul>

<a name="degeneratep7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Degenerate certificates-only PKCS#7 Signed-data</h3>

<p><a class='info' href='#RFC2315'>[RFC2315]<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> section 9 includes a degenerate case
        of the PKCS#7 Signed-data content type, in which there are no signers.
        The use of such a degenerate case is to disseminate certificates and
        certificate-revocation lists. For SCEP the content field of the
        ContentInfo value of a degenerate certificates-only Signed-Data MUST
        be omitted.
</p>
<p>When carrying certificates, the certificates are included in the
        'certificates' field of the Signed-Data. When carrying a CRL, the CRL
        will be included in the 'crls' field of the Signed-Data.
</p>
<a name="scepmessages"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
SCEP Transactions</h3>

<p>This section describes the SCEP Transactions, without explaining the
      transport. The transport of each message is discussed in <a class='info' href='#scep_transport'>Section&nbsp;5<span> (</span><span class='info'>SCEP Transport</span><span>)</span></a>. Some of the transaction-requests have
      no data to send, i.e. the only data is the message-type itself (e.g. a
      GetCACert message has no additional data). The use of such messages will
      become clearer in <a class='info' href='#scep_transport'>Section&nbsp;5<span> (</span><span class='info'>SCEP Transport</span><span>)</span></a>.
</p>
<p>In this section, each SCEP transaction is specified in terms of the
      complete messages exchanged during the transaction.
</p>
<p>The order of the transactions in this section is mirrored in <a class='info' href='#transportdetails'>Section&nbsp;5.2<span> (</span><span class='info'>SCEP HTTP Messages</span><span>)</span></a> for better organization and
      readability.
</p>
<a name="getcacert"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Get CA Certificate</h3>

<p>To get the CA certificate(s), the requester sends a GetCACert
        message to the server. There is no request data associated with this
        message (see <a class='info' href='#getcacerttrans'>Section&nbsp;5.2.1<span> (</span><span class='info'>GetCACert</span><span>)</span></a>).
</p>
<a name="getcacertresp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1"></a><h3>4.1.1.&nbsp;
Get CA Certificate Response Message Format</h3>

<p>The response depends on whether the responding server has RA
          certificates or only a single CA certificate. The server MUST
          indicate which response it is sending via the transport protocol
          used (see <a class='info' href='#getcacerttrans'>Section&nbsp;5.2.1<span> (</span><span class='info'>GetCACert</span><span>)</span></a>).
</p>
<p>All returned certificates MUST conform to <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</p>
<p>Once the CA certificate is received by the requester (regardless
          of the presence of RA certificates), a fingerprint is generated
          using the SHA1, SHA256, SHA512 or MD5 hash algorithm on the whole CA
          certificate. If the requester does not have a certificate path to a
          trusted CA certificate, this fingerprint may be used to verify the
          certificate, by some positive out-of-band means, such as a phone
          call or pre-provisioning.
</p>
<a name="getcarespca"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1.1"></a><h3>4.1.1.1.&nbsp;
CA Certificate Response Message Format</h3>

<p>If the server is a certification authority and does not have
            any RA Certificates, the response consists of a single DER-encoded
            X.509 CA certificate.
</p>
<a name="getcarespcara"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1.2"></a><h3>4.1.1.2.&nbsp;
CA/RA Certificate Response Message Format</h3>

<p>If the server has RA Certificates, the response consists of a
            DER-encoded <a class='info' href='#degeneratep7'>degenerate
            certificates-only Signed-data<span> (</span><span class='info'>Degenerate certificates-only PKCS#7 Signed-data</span><span>)</span></a> containing the CA certificate
            and RA certificates.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Certificate Enrollment</h3>

<p>A <a class='info' href='#pkcsreq'>PKCSReq<span> (</span><span class='info'>PKCSReq</span><span>)</span></a> message is used to perform
        a certificate enrollment transaction.
</p>
<p>The reply MUST be a <a class='info' href='#certrep'>CertRep<span> (</span><span class='info'>CertRep</span><span>)</span></a> message
        sent back from the server, indicating SUCCESS, FAILURE, or
        PENDING.
</p>
<p>Precondition: Both the requester and the certification authority
        have completed their initialization process. The requester has already
        been configured with the CA/RA certificate.
</p>
<p>Postcondition: Either the certificate is received by the requester,
        or the end entity is notified to do the manual authentication, or the
        request is rejected.
</p>
<a name="certEnrollResp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Certificate Enrollment Response Message</h3>

<p>If the request is granted, a <a class='info' href='#certrep'>CertRep<span> (</span><span class='info'>CertRep</span><span>)</span></a> message with pkiStatus set to
          SUCCESS is returned. The reply MUST also contain the certificate
          (and MAY contain any other certificates needed by the requester).
          The issued certificate MUST be the first in the list.
</p>
<p>If the request is rejected, a <a class='info' href='#certrep'>CertRep<span> (</span><span class='info'>CertRep</span><span>)</span></a> message with pkiStatus set to
          FAILURE is returned. The reply MUST also contain a failInfo
          attribute.
</p>
<p>If the the CA is configured to manually authenticate the
          requester, a <a class='info' href='#certrep'>CertRep<span> (</span><span class='info'>CertRep</span><span>)</span></a> message with
          pkiStatus set to 'PENDING' MAY be returned.
</p>
<a name="getcertinitialtrans"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Poll for Requester Initial Certificate</h3>

<p>Triggered by a <a class='info' href='#certrep'>CertRep<span> (</span><span class='info'>CertRep</span><span>)</span></a> with pkiStatus
        set to PENDING, a requester will enter the polling state by
        periodically sending <a class='info' href='#getcertinitial'>GetCertInitial<span> (</span><span class='info'>GetCertInitial</span><span>)</span></a> to the server, until
        either the request is granted and the certificate is sent back, or the
        request is rejected, or the configured time limit for polling (or
        maximum number of polls) is exceeded.
</p>
<p>Since GetCertInitial is part of the enrollment, the messages
        exchanged during the polling period MUST carry the same transactionID
        attribute as the previous PKCSReq. A server receiving a GetCertInitial
        for which it does not have a matching PKCSReq MUST ignore this
        request.
</p>
<p>Since at this time the certificate has not been issued, the
        requester can only use its own subject name (which was contained in
        the original PKCS#10 sent via PKCSReq) to identify the polled
        certificate request. Since there can be multiple outstanding requests
        from one requester (for example, if different keys and different
        key-usages were used to request multiple certificates), the
        transaction ID must also be included, to disambiguate between multiple
        requests.
</p>
<p>PreCondition: The requester has received a CertRep with pkiStatus
        set to PENDING.
</p>
<p>PostCondition: The requester has either received a valid response,
        which could be either a valid certificate (pkiStatus = SUCCESS), or a
        FAILURE message, or the polling period times out.
</p>
<a name="getcertinitresp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1"></a><h3>4.3.1.&nbsp;
Polling Response Message Format</h3>

<p>The response messages for GetCertInitial are the same as in <a class='info' href='#certEnrollResp'>Section&nbsp;4.2.1<span> (</span><span class='info'>Certificate Enrollment Response Message</span><span>)</span></a>.
</p>
<a name="getcerttrans"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Certificate Access</h3>

<p>The certificate query message is an option when the LDAP server is
        not available to provide the certificate query. A requester should be
        able to query an issued certificate from the certification authority,
        as long as the issuer name and the issuer assigned certificate serial
        number is known to the requesting end entity. This transaction is not
        intended to provide the service as a certificate directory service. A
        more complicated query mechanism would have to be defined in order to
        allow a requester to query a certificate using various different
        fields.
</p>
<p>This transaction consists of one <a class='info' href='#getcert'>GetCert<span> (</span><span class='info'>GetCert</span><span>)</span></a> message sent to the server by a
        requester, and one <a class='info' href='#certrep'>CertRep<span> (</span><span class='info'>CertRep</span><span>)</span></a> message sent
        back from the server.
</p>
<p>PreCondition: The queried certificate have been issued by the
        certification authority and the issuer assigned serial number is
        known.
</p>
<p>PostCondition: Either the certificate is sent back or the request
        is rejected.
</p>
<a name="getcertresp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.1"></a><h3>4.4.1.&nbsp;
Certificate Access Response Message Format</h3>

<p>In this case, the CertRep from the server is same as in <a class='info' href='#certEnrollResp'>Section&nbsp;4.2.1<span> (</span><span class='info'>Certificate Enrollment Response Message</span><span>)</span></a>, except that the server will only
          either grant the request (SUCCESS) or reject the request
          (FAILURE).
</p>
<a name="getcrltrans"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
CRL Access</h3>

<p>Clients MAY request a CRL from the SCEP server as described in
        <a class='info' href='#crl_access'>Section&nbsp;2.7<span> (</span><span class='info'>CRL Access</span><span>)</span></a>.
</p>
<p>PreCondition: The certification authority certificate has been
        downloaded to the end entity.
</p>
<p>PostCondition: CRL sent back to the requester.
</p>
<a name="getcrlresp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5.1"></a><h3>4.5.1.&nbsp;
CRL Access Response Message Format</h3>

<p>The CRL is sent back to the requester in a <a class='info' href='#certrep'>CertRep<span> (</span><span class='info'>CertRep</span><span>)</span></a> message. The information portion of
          this message is a <a class='info' href='#degeneratep7'>degenerate
          certificates-only Signed-data<span> (</span><span class='info'>Degenerate certificates-only PKCS#7 Signed-data</span><span>)</span></a> which contains only the most
          recent CRL in the crls field of the Signed-Data.
</p>
<p>The server MAY return any appropriate CRL.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
Get Next Certification Authority Certificate</h3>

<p>When a CA certificate is about to expire, clients need to retrieve
        the CA's next CA certificate (i.e. the Rollover Certificate). This is
        done via the GetNextCACert message. There is no request data
        associated with this message (see <a class='info' href='#getnextcacerttrans'>Section&nbsp;5.2.6<span> (</span><span class='info'>GetNextCACert</span><span>)</span></a>).
</p>
<a name="getnextcacertresp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6.1"></a><h3>4.6.1.&nbsp;
Get Next CA Response Message Format</h3>

<p>The response consists of a SignedData <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315], signed by the current CA (or RA)
          signing key.
</p>
<p>Clients MUST validate the signature on the the SignedData <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] before accepting any of its
          contents.
</p>
<p>The content of the SignedData <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] is a <a class='info' href='#degeneratep7'>degenerate certificates-only
          Signed-data<span> (</span><span class='info'>Degenerate certificates-only PKCS#7 Signed-data</span><span>)</span></a> message containing the new CA certificate and any
          new RA certificates, as defined in <a class='info' href='#cararesp'>Section&nbsp;5.2.1.1.2<span> (</span><span class='info'>CA and RA Certificates Response</span><span>)</span></a>,
          to be used when the current CA certificate expires.
</p>
<p>If the CA (or RA) does not have the Rollover certificate(s) it
          MUST reject the request. It SHOULD also remove the GetNextCACert
          setting from the capabilities until it does have rollover
          certificates.
</p>
<p>If there are any RA certificates in this response, clients MUST
          check that these RA certificates are signed by the CA, and MUST
          check authorization of these RA certificates (see <a class='info' href='#reg_auth'>Section&nbsp;2.1.3<span> (</span><span class='info'>Registration Authority</span><span>)</span></a>).
</p>
<a name="scep_transport"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
SCEP Transport</h3>

<p>HTTP is used as the transport protocol for SCEP Message Objects.
</p>
<a name="sceptransport_get"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
HTTP &quot;GET&quot; Message Format</h3>

<p>SCEP uses the HTTP "GET" messages to request information from the
        CA. The following is the syntax definition of a HTTP GET message sent
        from a requester to a certification authority server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>"GET" CGI-PATH CGI-PROG "?operation=" OPERATION "&amp;message=" MESSAGE</pre></div>
<p>where:
</p>
<p></p>
<ul class="text">
<li>CGI-PATH defines the actual CGI path to invoke the CGI program
            that parses the request.
</li>
<li>CGI-PROG is set to be the string "pkiclient.exe". This is
            intended to be the program that the CA will use to handle the SCEP
            transactions, though the CA may ignore CGI-PROG and use only the
            CGI-PATH.
</li>
<li>OPERATION depends on the SCEP transaction and is defined in the
            following sections.
</li>
<li>MESSAGE depends on the SCEP transaction and is defined in the
            following sections.
</li>
</ul><p>If the CA supports it, requests may also be done via an HTTP
        POST. This is described in <a class='info' href='#postop'>Appendix&nbsp;F<span> (</span><span class='info'>PKIOperation via HTTP POST Message</span><span>)</span></a>.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1"></a><h3>5.1.1.&nbsp;
Response Message Format</h3>

<p>For each GET operation, the CA/RA server MUST return a
          Content-Type and appropriate response data, if any.
</p>
<a name="transportdetails"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
SCEP HTTP Messages</h3>

<p>
</p>
<a name="getcacerttrans"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
GetCACert</h3>

<p>OPERATION MUST be set to "GetCACert".
</p>
<p>MESSAGE MAY be omitted, or it MAY be a string that represents the
          certification authority issuer identifier, if such has been set by
          the CA Administrator.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1.1"></a><h3>5.2.1.1.&nbsp;
GetCACert Response</h3>

<p>The response for GetCACert is different between the case where
            the CA directly communicates with the requester during the
            enrollment, and the case where a RA exists and the requester
            communicates with the RA during the enrollment.
</p>
<a name="caresp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1.1.1"></a><h3>5.2.1.1.1.&nbsp;
CA Certificate Only Response</h3>

<p>The response will have a Content-Type of
              "application/x-x509-ca-cert".
</p>
<p>The body of this response consists of a DER-encoded X.509 CA
              certificate, as defined in <a class='info' href='#getcarespca'>Section&nbsp;4.1.1.1<span> (</span><span class='info'>CA Certificate Response Message Format</span><span>)</span></a>.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>"Content-Type:application/x-x509-ca-cert\n\n"&lt;DER-encoded X.509&gt;</pre></div>
<a name="cararesp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1.1.2"></a><h3>5.2.1.1.2.&nbsp;
CA and RA Certificates Response</h3>

<p>The response will have a Content-Type of
              "application/x-x509-ca-ra-cert".
</p>
<p>The body of this response consists of a DER-encoded <a class='info' href='#degeneratep7'>degenerate certificates-only
              Signed-data<span> (</span><span class='info'>Degenerate certificates-only PKCS#7 Signed-data</span><span>)</span></a> containing both CA and RA certificates, as
              defined in <a class='info' href='#getcarespcara'>Section&nbsp;4.1.1.2<span> (</span><span class='info'>CA/RA Certificate Response Message Format</span><span>)</span></a>.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>"Content-Type:application/x-x509-ca-ra-cert\n\n"&lt;DER-encoded PKCS7&gt;</pre></div>
<a name="pkcsreqhttp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
PKCSReq</h3>

<p>OPERATION MUST be set to "PKIOperation".
</p>
<p>MESSAGE consists of a base64-encoded DER-encoded PKCSReq SCEP
          message.
</p>
<p>An example PKIOperation request might look as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>GET /cgi-bin/pkiclient.exe?operation=PKIOperation&amp;message=MIAGCSqGSIb3D
QEHA6CAMIACAQAxgDCBzAIBADB2MGIxETAPBgNVBAcTCE ......AAAAAA== HTTP/1.0</pre></div>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2.1"></a><h3>5.2.2.1.&nbsp;
PKCSReq Response</h3>

<p>The response will have a Content-Type of
            "application/x-pki-message".
</p>
<p>The body of this response consists of a DER-encoded CertRep
            SCEP message defined in <a class='info' href='#certEnrollResp'>Section&nbsp;4.2.1<span> (</span><span class='info'>Certificate Enrollment Response Message</span><span>)</span></a>. The
            following is an example of the response:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>"Content-Type:application/x-pki-message\n\n"&lt;DER-encoded CertRep msg&gt;</pre></div>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.3"></a><h3>5.2.3.&nbsp;
GetCertInitial</h3>

<p>OPERATION MUST be set to "PKIOperation".
</p>
<p>MESSAGE consists of a base64-encoded DER-encoded GetCertInitial
          SCEP message.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.3.1"></a><h3>5.2.3.1.&nbsp;
GetCertInitial Response</h3>

<p>The body of this response consists of a DER-encoded CertRep
            SCEP message defined in <a class='info' href='#getcertinitresp'>Section&nbsp;4.3.1<span> (</span><span class='info'>Polling Response Message Format</span><span>)</span></a>.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.4"></a><h3>5.2.4.&nbsp;
GetCert</h3>

<p>OPERATION MUST be set to "PKIOperation".
</p>
<p>MESSAGE consists of a base64-encoded DER-encoded GetCert SCEP
          message.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.4.1"></a><h3>5.2.4.1.&nbsp;
GetCert Response</h3>

<p>The body of this response consists of a DER-encoded CertRep
            SCEP message defined in <a class='info' href='#getcertresp'>Section&nbsp;4.4.1<span> (</span><span class='info'>Certificate Access Response Message Format</span><span>)</span></a>.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.5"></a><h3>5.2.5.&nbsp;
GetCRL</h3>

<p>OPERATION MUST be set to "PKIOperation".
</p>
<p>MESSAGE consists of a base64-encoded DER-encoded GetCRL SCEP
          message.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.5.1"></a><h3>5.2.5.1.&nbsp;
GetCRL Response</h3>

<p>The body of this response consists of a DER-encoded CertRep
            SCEP message defined in <a class='info' href='#getcrlresp'>Section&nbsp;4.5.1<span> (</span><span class='info'>CRL Access Response Message Format</span><span>)</span></a>.
</p>
<a name="getnextcacerttrans"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.6"></a><h3>5.2.6.&nbsp;
GetNextCACert</h3>

<p>OPERATION MUST be set to "GetNextCACert".
</p>
<p>MESSAGE MAY be ommitted, or it MAY be a string that represents
          the certification authority issuer identifier, if such has been set
          by the CA Administrator.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.6.1"></a><h3>5.2.6.1.&nbsp;
GetNextCACert Response</h3>

<p>The response will have a Content-Type of
            "application/x-x509-next-ca-cert".
</p>
<p>The body of this response consists of a SignedData <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315], as defined in <a class='info' href='#getnextcacertresp'>Section&nbsp;4.6.1<span> (</span><span class='info'>Get Next CA Response Message Format</span><span>)</span></a>. (This is similar to the
            GetCert response but does not include any of the attributes
            defined in <a class='info' href='#signedAttributes'>Section&nbsp;3.1.1<span> (</span><span class='info'>Signed Transaction Attributes</span><span>)</span></a>.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>"Content-Type:application/x-x509-next-ca-cert\n\n"
&lt;BER-encoded SignedData&lt;DER-encoded degenerate PKCS7&gt;&gt;</pre></div>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Contributors/Acknowledgements</h3>

<p>The editor would like to thank all the previous authors and
      contributors: Cheryl Madson, Xiaoyi Liu, David McGrew, David Cooper, etc
      for their work on the draft over the years.
</p>
<p>The authors would like to thank Peter William of ValiCert, Inc.
      (formerly of VeriSign, Inc.) and Alex Deacon of VeriSign, Inc. and
      Christopher Welles of IRE, Inc. for their contributions to early
      versions of this protocol and this document.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>This memo includes no request to IANA.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>The security goals of SCEP are that no adversary can:
</p>
<p></p>
<ul class="text">
<li>subvert the public key/identity binding from that intended,
</li>
<li>discover the identity information in the enrollment requests and
          issued certificates,
</li>
<li>cause the revocation of certificates with any non-negligible
          probability.
</li>
</ul><p>Here an adversary is any entity other than the requester and
      the CA (and optionally the RA) participating in the protocol that is
      computationally limited, but that can manipulate data during
      transmission (that is, a man-in-the-middle). The precise meaning of
      'computationally limited' depends on the implementer's choice of
      cryptographic hash functions and ciphers. The required algorithms are
      RSA, DES and MD5. Depending on the CA capabilities (see <a class='info' href='#cacaps'>Appendix&nbsp;C<span> (</span><span class='info'>CA Capabilities</span><span>)</span></a>), Triple-DES MAY be used instead of DES, and
      SHA-1, SHA-256, or SHA-512 MAY be used instead of MD5.
</p>
<p>The first and second goals are met through the use of <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] and <a class='info' href='#RFC2986'>PKCS#10<span> (</span><span class='info'>Nystrom, M. and B. Kaliski, &ldquo;PKCS #10: Certification Request Syntax Specification Version 1.7,&rdquo; November&nbsp;2000.</span><span>)</span></a> [RFC2986]
      encryption and digital signatures using authenticated public keys. The
      CA's public key is authenticated via the checking of the CA fingerprint,
      as specified in <a class='info' href='#certauth'>Section&nbsp;2.1.2<span> (</span><span class='info'>Certification Authority</span><span>)</span></a>, and the SCEP client's
      public key is authenticated through the manual authentication or
      pre-shared secret authentication, as specified in <a class='info' href='#req_auth'>Section&nbsp;2.2<span> (</span><span class='info'>Requester authentication</span><span>)</span></a>. The third goal is met through the use of a
      challenge password for revocation, which is chosen by the SCEP client
      and communicated to the CA protected by the <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] encryptedData, as specified in <a class='info' href='#certrevoke'>Section&nbsp;2.8<span> (</span><span class='info'>Certificate Revocation</span><span>)</span></a>.
</p>
<p>The motivation of the first security goal is straightforward. The
      motivation for the second security goal is to protect the identity
      information in the enrollment requests and certificates. For example,
      two IPSEC hosts behind a firewall may need to exchange certificates, and
      may need to enroll certificates with a CA that is outside of a
      firewall.
</p>
<p>Most networks with firewalls seek to prevent IP addresses and DNS
      information from the trusted network leaving that network. The second
      goal enables the hosts in this example to enroll with a CA outside the
      firewall without revealing this information. The motivation for the
      third security goal is to protect the SCEP clients from denial of
      service attacks.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
General Security</h3>

<p>Common key-management considerations such as keeping private keys
        truly private and using adequate lengths for symmetric and asymmetric
        keys must be followed in order to maintain the security of this
        protocol.
</p>
<p>This is especially true for CA keys, which, when compromised,
        compromise the security of all relying parties.
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Use of the CA keypair</h3>

<p>A CA key pair is generally meant for (and is usually flagged as)
        "certificate signing" (exclusively), rather than 'data signing' or
        'data encryption'. The SCEP protocol, however, uses the CA key pair to
        encrypt and sign <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] transport
        messages, regardless of the key usage of the CA certificate. This is
        generally considered undesirable, as it widens the possibility of an
        implementation weakness, and provides</p>
<ul class="text">
<li>another place that the private key must be used (and hence is
            slightly more vulnerable to exposure),
</li>
<li>another place where a side channel attack (say, timing or power
            analysis) might be used,
</li>
<li>another place that the attacker might somehow insert his own
            text, and get it signed by the private key.
</li>
</ul>

<p>While the CA key pair can be generated with the 'data encryption'
        and 'data signing' flags set, this is operationally not encouraged. It
        would make using the key as a <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315]
        transport key 'legal', but the discussion from the previous paragraph
        still applies.
</p>
<p>A solution is to use RA keys to secure the SCEP transport (i.e.
        message signing and encrypting), which allows the CA keys to be used
        only for their intended purpose of "certificate signing".
</p>
<p>An RA can be implemented in two ways: physically separate or
        implicit. In the implicit case, the CA simply creates an extra key
        pair. A physically separate RA allows the CA to be inside the secure
        network, not accessible to hackers at all.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
ChallengePassword</h3>

<p>The challengePassword sent in the PKCS#10 enrollment request is
        signed and encrypted by way of being encapsulated in a pkiMessage.
        When saved by the CA, care should be taken to protect this
        password.
</p>
<p>If the challengePassword is used to automatically authenticate an
        enrollment request, it is recommended that some form of one-time
        password be used to minimize damage in the event the data is
        compromised.
</p>
<a name="transidsecurity"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
transactionID</h3>

<p>A well-written CA/RA SHOULD NOT rely on the transactionID to be
        correct or as specified in this document. Requesters with buggy
        software might add additional undetected duplicate requests to the
        CA's queue (or worse). A well-written CA/RA should never assume the
        data from a requester is well-formed.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5"></a><h3>8.5.&nbsp;
Nonces and Replay</h3>

<p>In order to detect replay attacks, both sides need to maintain
        state information sufficient to detect a repeated, duplicate
        senderNonce.
</p>
<p>Since existing implementations do not copy the senderNonce from a
        CertRep into subsequent GetCertinitial requests, the server will never
        see its own nonce reflected back to it. The transactionID links
        together the GetCertInitial and PKCSReq, in any case.
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6"></a><h3>8.6.&nbsp;
Key Usage Issues</h3>

<p>Key pairs may be intended for particular purposes, such as
        encryption only or signing only. The usage of any associated
        certificate can be restricted by adding key usage and extended key
        usage attributes to the <a class='info' href='#RFC2986'>PKCS#10<span> (</span><span class='info'>Nystrom, M. and B. Kaliski, &ldquo;PKCS #10: Certification Request Syntax Specification Version 1.7,&rdquo; November&nbsp;2000.</span><span>)</span></a> [RFC2986]. If key
        usage is not present, the public key is assumed to be a general
        purpose key that may be used for all purposes.
</p>
<p>When building a pkiMessage, clients MUST have a certificate to sign
        the <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] signed-data (because <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315] requires it). Clients MUST either use
        an existing certificate, or create a self-signed certificate (see
        <a class='info' href='#enrollment_authz'>Section&nbsp;2.3<span> (</span><span class='info'>Enrollment authorization</span><span>)</span></a>). If this certificate has a
        key usage extension in it, then this key usage MUST be ignored by both
        the SCEP client and SCEP server for the duration of the transaction
        (the key will be used for signing during the creation of the PKCSReq
        message, and for encryption during the creation of the CertRep
        message).
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.7"></a><h3>8.7.&nbsp;
GetCACaps Issues</h3>

<p>The GetCACaps response is not signed. This allows an attacker to
        use downgrade attacks (as well as "upgrade attacks") on the
        cryptographic capabilities of the CA.
</p>
<a name="unnecessarycrypto"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.8"></a><h3>8.8.&nbsp;
Unnecessary cryptography</h3>

<p>Some of the SCEP exchanges use signing and encryption operations
        that are not necessary. In particular the GetCert and GetCRL exchanges
        are encrypted and signed in both directions. The information requested
        is public and thus signing the requests is of questionable value but
        also CRLs and Certificates, i.e. the respective responses, are already
        signed by the CA and can be verified by the recipient without
        requiring additional signing and encryption.
</p>
<p>This may affect performance and scalability of the CA which could
        be used as an attack vector on the CA (though not an anonymous one).
        The use of CDPs is recommended for CRL access, as well as other ways
        of retrieving certificates (LDAP, direct HTTP access, etc.).
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.9"></a><h3>8.9.&nbsp;
GetNextCACert</h3>

<p>Servers implementing early versions of the SCEP draft might return
        an unsigned GetNextCACert response by erroneously mirroring the
        (unsigned) functionality of GetCACert. Client receiving such responses
        MUST ignored them.
</p>
<p>GetNextCACert depends on a 'flag moment' at which every client in
        the PKI infrastructure switches from the current CA certificate (and
        client certificate) to the new CA certificate and client certificates.
        Proper monitoring of the network infrastructure can ensure that this
        will proceed as expected but any errors in processing or
        implementation can result in a failure of the PKI infrastructure.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2315">[RFC2315]</a></td>
<td class="author-text"><a href="mailto:burt@rsa.com">Kaliski, B.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2315">PKCS #7: Cryptographic Message Syntax Version 1.5</a>,&rdquo; RFC&nbsp;2315, March&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2315.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2315.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2315.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2409">[RFC2409]</a></td>
<td class="author-text"><a href="mailto:dharkins@cisco.com">Harkins, D.</a> and <a href="mailto:carrel@ipsec.org">D. Carrel</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2409">The Internet Key Exchange (IKE)</a>,&rdquo; RFC&nbsp;2409, November&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2409.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2409.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2409.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2985">[RFC2985]</a></td>
<td class="author-text">Nystrom, M. and B. Kaliski, &ldquo;<a href="http://tools.ietf.org/html/rfc2985">PKCS #9: Selected Object Classes and Attribute Types Version 2.0</a>,&rdquo; RFC&nbsp;2985, November&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2985.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2986">[RFC2986]</a></td>
<td class="author-text">Nystrom, M. and B. Kaliski, &ldquo;<a href="http://tools.ietf.org/html/rfc2986">PKCS #10: Certification Request Syntax Specification Version 1.7</a>,&rdquo; RFC&nbsp;2986, November&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2986.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4210">[RFC4210]</a></td>
<td class="author-text">Adams, C., Farrell, S., Kause, T., and T. Mononen, &ldquo;<a href="http://tools.ietf.org/html/rfc4210">Internet X.509 Public Key Infrastructure Certificate Management Protocol (CMP)</a>,&rdquo; RFC&nbsp;4210, September&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4210.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4306">[RFC4306]</a></td>
<td class="author-text">Kaufman, C., &ldquo;<a href="http://tools.ietf.org/html/rfc4306">Internet Key Exchange (IKEv2) Protocol</a>,&rdquo; RFC&nbsp;4306, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4306.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4346">[RFC4346]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc4346">The Transport Layer Security (TLS) Protocol Version 1.1</a>,&rdquo; RFC&nbsp;4346, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4346.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4945">[RFC4945]</a></td>
<td class="author-text">Korver, B., &ldquo;<a href="http://tools.ietf.org/html/rfc4945">The Internet IP Security PKI Profile of IKEv1/ISAKMP, IKEv2, and PKIX</a>,&rdquo; RFC&nbsp;4945, August&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4945.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5272">[RFC5272]</a></td>
<td class="author-text">Schaad, J. and M. Myers, &ldquo;<a href="http://tools.ietf.org/html/rfc5272">Certificate Management over CMS (CMC)</a>,&rdquo; RFC&nbsp;5272, June&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5272.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5280">[RFC5280]</a></td>
<td class="author-text">Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;<a href="http://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>,&rdquo; RFC&nbsp;5280, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5280.txt">TXT</a>).</td></tr>
</table>

<a name="oiddef"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Private OID Definitions</h3>

<p>The OIDs used in SCEP are VeriSign self-maintained OIDs.
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Name</th><th align="left">ASN.1 Definition</th></tr>
<tr>
<td align="left">id-VeriSign</td>
<td align="left">OBJECT_IDENTIFIER ::= {2 16 US(840) 1 VeriSign(113733)}</td>
</tr>
<tr>
<td align="left">id-pki</td>
<td align="left">OBJECT_IDENTIFIER ::= {id-VeriSign pki(1)}</td>
</tr>
<tr>
<td align="left">id-attributes</td>
<td align="left">OBJECT_IDENTIFIER ::= {id-pki attributes(9)}</td>
</tr>
<tr>
<td align="left">id-messageType</td>
<td align="left">OBJECT_IDENTIFIER ::= {id-attributes messageType(2)}</td>
</tr>
<tr>
<td align="left">id-pkiStatus</td>
<td align="left">OBJECT_IDENTIFIER ::= {id-attributes pkiStatus(3)}</td>
</tr>
<tr>
<td align="left">id-failInfo</td>
<td align="left">OBJECT_IDENTIFIER ::= {id-attributes failInfo(4)}</td>
</tr>
<tr>
<td align="left">id-senderNonce</td>
<td align="left">OBJECT_IDENTIFIER ::= {id-attributes senderNonce(5)}</td>
</tr>
<tr>
<td align="left">id-recipientNonce</td>
<td align="left">OBJECT_IDENTIFIER ::= {id-attributes recipientNonce(6)}</td>
</tr>
<tr>
<td align="left">id-transId</td>
<td align="left">OBJECT_IDENTIFIER ::= {id-attributes transId(7)}</td>
</tr>
<tr>
<td align="left">id-extensionReq</td>
<td align="left">OBJECT_IDENTIFIER ::= {id-attributes extensionReq(8)}</td>
</tr>
</table>
<br clear="all" />

<p>
</p>
<a name="statetrans"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
SCEP State Transitions</h3>

<p>SCEP state transitions are indexed by the transactionID attribute.
      The design goal is to ensure the synchronization between the CA and the
      requester under various error situations.
</p>
<p>Each enrollment transaction is uniquely associated with a transaction
      identifier (carried in the transactionID signed attribute (see <a class='info' href='#transactID'>Section&nbsp;3.1.1.1<span> (</span><span class='info'>transactionID</span><span>)</span></a>). Because the enrollment transaction could
      be interrupted by various errors, including network connection errors or
      client reboot, the SCEP client generates a transaction identifier by
      calculating a hash on the public key value for which the enrollment is
      requested. This retains the same transaction identifier throughout the
      enrollment transaction, even if the client has rebooted or timed out,
      and issues a new enrollment request for the same key pair. It also
      provides the way for a CA to uniquely identify a transaction in its
      database. At the requester side, it generates a transaction identifier
      which is included in PKCSReq. If the CA returns a response of PENDING,
      the requester will poll by periodically sending out GetCertInitial with
      the same transaction identifier until either a response other than
      PENDING is obtained, or the configured maximum time has elapsed.
</p>
<p>If the client times out or the client reboots, the client
      administrator will start another enrollment transaction with the same
      key pair. The second enrollment will have the same transaction
      identifier. At the server side, instead of accepting the PKCSReq as a
      new enrollment request, it should respond as if another GetCertInitial
      message had been sent with that transaction ID. The second PKCSReq
      should be taken as a resynchronization message to allow the enrollment
      to resume as the same transaction.
</p>
<p>It is important to keep the transaction ID unique since SCEP requires
      the same policy and same identity be applied to the same subject name
      and key pair binding. In the current implementation, an SCEP client can
      only assume one identity. At any time, only one key pair, with a given
      key usage, can be associated with the same identity.
</p>
<p>The following gives several examples of client to CA
      transactions.
</p>
<p>Client actions are indicated in the left column, CA actions are
      indicated in the right column. A blank action signifies that no message
      was received.
</p>
<p>The first transaction, for example, would read like this:
</p>
<p>"Client Sends PKCSReq message with transaction ID 1 to the CA. The CA
      signs the certificate and constructs a CertRep Message containing the
      signed certificate with a transaction ID 1. The client receives the
      message and installs the certificate locally."
</p>
<p>Successful Enrollment Case: no manual
        authentication
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>PKCSReq (1)             ----------&gt; CA Signs Cert
Client Installs Cert    &lt;---------- CertRep (1) SIGNED CERT</pre></div>
<p>Successful Enrollment Case: manual authentication
        required
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>PKCSReq (10)            ----------&gt; Cert Request goes into Queue
Client Polls            &lt;---------- CertRep (10) PENDING
GetCertInitial (10)     ----------&gt; Still pending
Client Polls            &lt;---------- CertRep (10) PENDING
GetCertInitial (10)     ----------&gt; Still pending
Client Polls            &lt;---------- CertRep (10) PENDING
GetCertInitial (10)     ----------&gt; Still pending
Client Polls            &lt;---------- CertRep (10) PENDING
GetCertInitial (10)     ----------&gt; Cert has been signed
                        &lt;---------- CertRep (10) SIGNED CERT
Client Installs Cert</pre></div>
<p>Resync Case 1 - CA Receives PKCSReq, sends PENDING,
        eventually grants the certificate and returns SUCCESS, with the
        certificate. The SUCCESS gets lost:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>PKCSReq (3)           ----------&gt; Cert Request goes into queue
                      &lt;---------- CertRep (3) PENDING
GetCertInitial (3)    ----------&gt; Still pending
                      &lt;---------- CertRep (3) PENDING
GetCertInitial (3)    -----------&gt; Cert has been signed
                        X-------- CertRep(3) SIGNED CERT
(Time Out)
PKCSReq (3)           ----------&gt; Cert already granted
                      &lt;---------- CertRep (3) SIGNED CERT
Client Installs Cert</pre></div>
<p>Resync Case 2 - CA Receives PKCSReq, sends PENDING, PENDING
        reply gets lost:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>PKCSReq (3)           ----------&gt; Cert Request goes into queue
                        X-------- CertRep (3) PENDING
(Time Out)
PKCSReq (3)           ----------&gt;
                      &lt;---------- CertRep (3) PENDING
etc...</pre></div>
<p>Case when the Certificate is lost, the CA arbitrarily
        refuses to sign a replacement (enforcing name-uniqueness) until the
        original certificate has been revoked (there is no change of name
        information):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>PKCSReq (4)           ----------&gt; CA Signs Cert
                      &lt;---------- CertRep (4) SIGNED CERT
Client Installs Cert
(Client looses Cert)
PKCSReq (5)           ----------&gt; There is already a valid cert with
                                  this DN.
                      &lt;---------- CertRep (5) BAD REQUEST
                                  Admin Revokes
PKCSReq (5)           ----------&gt; CA Signs Cert
                      &lt;---------- CertRep (5) SIGNED CERT
Client Installs Cert</pre></div>
<a name="cacaps"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
CA Capabilities</h3>

<p>
</p>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.1"></a><h3>C.1.&nbsp;
GetCACaps HTTP Message Format</h3>

<p>"GET" CGI-PATH CGI-PROG "?operation=GetCACaps" "&amp;message="
        CA-IDENT
</p>
<p>This message requests capabilities from CA. The response is a list
        of text capabilities, as defined in <a class='info' href='#cacapsresp'>Appendix&nbsp;C.2<span> (</span><span class='info'>CA Capabilities Response Format</span><span>)</span></a>.
        CA servers SHOULD support the GetCACaps message.
</p>
<a name="cacapsresp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.2"></a><h3>C.2.&nbsp;
CA Capabilities Response Format</h3>

<p>The response for a GetCACaps message is a list of CA capabilities,
        in plain text, separated by &lt;LF&gt; characters, as follows
        (quotation marks are NOT sent):
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Keyword</th><th align="left">Description</th></tr>
<tr>
<td align="left">"GetNextCACert"</td>
<td align="left">CA Supports the GetNextCACert message.</td>
</tr>
<tr>
<td align="left">"POSTPKIOperation"</td>
<td align="left">PKIOPeration messages may be sent via HTTP POST.</td>
</tr>
<tr>
<td align="left">"Renewal"</td>
<td align="left">Clients may use current certificate and key to authenticate an
          enrollment request for a new certificate.</td>
</tr>
<tr>
<td align="left">"SHA-512"</td>
<td align="left">CA Supports the SHA-512 hashing algorithm.</td>
</tr>
<tr>
<td align="left">"SHA-256"</td>
<td align="left">CA Supports the SHA-256 hashing algorithm.</td>
</tr>
<tr>
<td align="left">"SHA-1"</td>
<td align="left">CA Supports the SHA-1 hashing algorithm.</td>
</tr>
<tr>
<td align="left">"DES3"</td>
<td align="left">CA Supports the triple-DES encryption algorithm.</td>
</tr>
</table>
<br clear="all" />

<p>The client SHOULD use SHA-1, SHA-256, or SHA-512 in preference to
        MD5 hashing if it is supported by the CA.
</p>
<p>The server MUST use the texual case specified here, but clients
        SHOULD ignore the textual case when processing this message. A client
        MUST be able to accept and ignore any unknown keywords that might be
        sent back by a CA.
</p>
<p>If none of the above capabilities are supported by the CA, a server
        SHOULD return an empty message. A server MAY simply return an HTTP
        Error. A client that receives an empty message or an HTTP error SHOULD
        interpret the response as if none of the requested capabilities are
        supported by the CA.
</p>
<p>The Content-type of the reply SHOULD be "text/plain". Clients
        SHOULD ignore the Content-type, as older server implementations of
        SCEP may send various Content-types.
</p>
<p>Example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>GET /cgi-bin/pkiclient.exe?operation=GetCACaps&amp;message=myca</pre></div>
<p>might return:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>GetNextCACert&lt;LF&gt;POSTPKIOperation</pre></div>
<p>This means that the CA supports the GetNextCACert message and
        allows PKIOperation messages (PKCSreq, GetCert, GetCertInitial, ...)
        to be sent using HTTP POST.
</p>
<a name="cert_renew"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D"></a><h3>Appendix D.&nbsp;
Client Certificate Renewal</h3>

<p>An enrollment request that occurs more than halfway through the
      validity period of an existing certificate for the same subject name and
      key usage MAY be interpreted as a re-enrollment or renewal request and
      be accepted. A new certificate with new validity dates may be issued,
      even though the old one is still valid, if the CA policy permits. The
      server MAY automatically revoke the old client certificate. Clients MUST
      use GetCACaps (see <a class='info' href='#cacaps'>Appendix&nbsp;C<span> (</span><span class='info'>CA Capabilities</span><span>)</span></a>) to determine if the CA
      supports renewal. Clients MUST support servers that do not implement
      renewal, or that reject renewal requests.
</p>
<p>To renew a client certificate, the client uses the PKCSreq message
      and signs it with the existing client certificate. The client SHOULD use
      a new keypair when requesting a new certificate. The client MAY request
      a new certicate using the old keypair.
</p>
<a name="ca_keyrollover"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.E"></a><h3>Appendix E.&nbsp;
CA Key Rollover</h3>

<p>When the CA certificate expires all certificates that have been
      signed by it are no longer valid. CA key rollover provides a mechanism
      by which the server MAY distribute a new CA certificate which is valid
      in the future; when the current certificate has expired. Clients MUST
      use GetCACaps (see <a class='info' href='#cacaps'>Appendix&nbsp;C<span> (</span><span class='info'>CA Capabilities</span><span>)</span></a>) to determine if the CA
      supports GetNextCACert.
</p>
<p>To obtain the new CA certificate prior to the expiration of the
      current one, the client uses the GetNextCACert message.
</p>
<p>To obtain a new client certificate signed by the new CA certificate,
      use the new CA or RA certificate in the PKCSreq message envelope.
</p>
<p>Clients MUST store the not-yet-valid CA certificate, and any
      not-yet-valid client certificates obitained, until such time that they
      are valid. At which point clients switch over to using the newly valid
      certificates.
</p>
<p>Example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GetNextCACert           ----------&gt;
                        &lt;---------- New CA certificate

PKCSReq*                ----------&gt; CA Signs certificate with NEW key
Client Stores Cert      &lt;---------- CertRep - Certificate issued
for installation when               from NEW CA certificate and key pair
existing cert expires.

*enveloped for new CA or RA cert and key pair.  The CA will use the
envelope to determine which key and certificate to use to issue the
client certificate.</pre></div>
<a name="postop"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.F"></a><h3>Appendix F.&nbsp;
PKIOperation via HTTP POST Message</h3>

<p>If the remote CA supports it, any of the <a class='info' href='#RFC2315'>PKCS#7<span> (</span><span class='info'>Kaliski, B., &ldquo;PKCS #7: Cryptographic Message Syntax Version 1.5,&rdquo; March&nbsp;1998.</span><span>)</span></a> [RFC2315]-encoded SCEP messages may be sent via
      HTTP POST instead of HTTP GET. This is allowed for any SCEP message
      except GetCACert, GetNextCACert, or GetCACaps. In this form of the
      message, Base 64 encoding is not used.
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>POST /cgi-bin/pkiclient.exe?operation=PKIOperation HTTP/1.0
Content-Length: &lt;length of data&gt;

&lt;binary PKCS#7 data&gt;</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;General POST Syntax&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The client can verify that the CA supports SCEP messages via POST by
      looking for the "POSTPKIOperation" capability (See <a class='info' href='#cacaps'>Appendix&nbsp;C<span> (</span><span class='info'>CA Capabilities</span><span>)</span></a>).
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Max Pritikin (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems, Inc</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:pritikin@cisco.com">pritikin@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Andrew Nourse</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems, Inc</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:nourse@cisco.com">nourse@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jan Vilhuber</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems, Inc</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:vilhuber@cisco.com">vilhuber@cisco.com</a></td></tr>
</table>
</body></html>
