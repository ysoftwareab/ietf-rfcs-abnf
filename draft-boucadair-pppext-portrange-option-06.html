<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Huawei Port Range Configuration Options for PPP IPCP</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Use Cases">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Terminology">
<link href="#rfc.section.2" rel="Chapter" title="2 Port Range Options">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Description of Port Range Value and Port Range Mask">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Description of Cryptographically Random Port Range option">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Illustration Examples">
<link href="#rfc.section.2.3.1" rel="Chapter" title="2.3.1 Overview">
<link href="#rfc.section.2.3.2" rel="Chapter" title="2.3.2 Successful Flow: Port Range Options supported by both the Client and the Server">
<link href="#rfc.section.2.3.3" rel="Chapter" title="2.3.3 Port Range Option Not Supported by the Server">
<link href="#rfc.section.2.3.4" rel="Chapter" title="2.3.4 Port Range Option not Supported by the Client">
<link href="#rfc.section.3" rel="Chapter" title="3 IANA Considerations">
<link href="#rfc.section.4" rel="Chapter" title="4 Security Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 Contributors">
<link href="#rfc.section.6" rel="Chapter" title="6 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.references.1" rel="Chapter" title="7.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="7.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document defines two Huawei IPCP (IP Configuration Protocol) Options used to convey a set of ports. These options can be used in the context of port range-based solutions or NAT-based ones for port delegation and forwarding purposes." />
  <meta name="description" content="This document defines two Huawei IPCP (IP Configuration Protocol) Options used to convey a set of ports. These options can be used in the context of port range-based solutions or NAT-based ones for port delegation and forwarding purposes." />
  <meta name="keywords" content="Internet-Draft, Port Range, IPv4 Address Exhaustion, IPv4, IPv6" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">M. Boucadair</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">P. Levis</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">France Telecom</td>
</tr>
<tr>
<td class="left">Expires: December 30, 2011</td>
<td class="right">G. Bajko</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">T. Savolainen</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Nokia</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">T. Tsou</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Huawei Technologies (USA)</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">June 28, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Huawei Port Range Configuration Options for PPP IPCP<br />
  <span class="filename">draft-boucadair-pppext-portrange-option-06</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document defines two Huawei IPCP (IP Configuration Protocol) Options used to convey a set of ports. These options can be used in the context of port range-based solutions or NAT-based ones for port delegation and forwarding purposes.</p>
<h1><a>Requirements Language</a></h1>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted to IETF in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 30, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Use Cases</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Terminology</a>
</li>
<li>2.   <a href="#rfc.section.2">Port Range Options</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Description of Port Range Value and Port Range Mask</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Description of Cryptographically Random Port Range option</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">Illustration Examples</a>
</li>
<li>2.3.1.   <a href="#rfc.section.2.3.1">Overview</a>
</li>
<li>2.3.2.   <a href="#rfc.section.2.3.2">Successful Flow: Port Range Options supported by both the Client and the Server</a>
</li>
<li>2.3.3.   <a href="#rfc.section.2.3.3">Port Range Option Not Supported by the Server</a>
</li>
<li>2.3.4.   <a href="#rfc.section.2.3.4">Port Range Option not Supported by the Client</a>
</li>
<li>3.   <a href="#rfc.section.3">IANA Considerations</a>
</li>
<li>4.   <a href="#rfc.section.4">Security Considerations</a>
</li>
<li>5.   <a href="#rfc.section.5">Contributors</a>
</li>
<li>6.   <a href="#rfc.section.6">Acknowledgements</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<li>7.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>7.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">Within the context of IPv4 address depletion, several solutions have been investigated to share IPv4 addresses. Two flavors can be distinguished: NAT-based solutions (a.k.a., Carrier Grade NAT (CGN, <a href="#I-D.ietf-behave-lsn-requirements">[I-D.ietf-behave-lsn-requirements]</a>)) or port range based ones (e.g., <a href="#I-D.ymbk-aplusp">[I-D.ymbk-aplusp]</a>). Port range-based solutions do not require an additional NAT level in the service provider's domain. Several means may be used to convey Port Range information.</p>
<p id="rfc.section.1.p.2">This document defines the notion of Port Mask which is generic and flexible. Several allocation schemes may be implemented when using a Port Mask. It proposes a basic mechanism that allows the allocation of a unique port range to a requesting client. This document defines Huawei IPCP options to be used to carry Port Range information.</p>
<p id="rfc.section.1.p.3">IPv4 address exhaustion is only provided as an example of the usage of the PPP IPCP Options defined in this document. In particular, Port Range Options may be used independently of the presence of IP-Address IPCP Option.</p>
<p id="rfc.section.1.p.4">This document adheres to the consideration defined in <a href="#RFC2153">[RFC2153]</a>.</p>
<p id="rfc.section.1.p.5">This document is not a product of pppext working group.</p>
<p id="rfc.section.1.p.6">Note that IPR disclosures apply to this document (see https://datatracker.ietf.org/ipr/).</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Use Cases</h1>
<p id="rfc.section.1.1.p.1">Port Range Options can be used in port range-based solutions (e.g., <a href="#I-D.ymbk-aplusp">[I-D.ymbk-aplusp]</a>) or in a CGN-based solution to bypass the NAT (i.e., for transparent NAT traversal and avoid involving several NAT levels in the path) or to delegate one or a set of ports to the requesting client (e.g., avoid ALG (Application Level Gateway) or for port forwarding).</p>
<p id="rfc.section.1.1.p.2">For improved security an option for delegating cryptographically random port range is defined.</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> Terminology</h1>
<p id="rfc.section.1.2.p.1">To differentiate between a Port Range containing a contiguous span of port numbers and a Port Range with non contiguous and possibly random port numbers, the following denominations are used:</p>
<p></p>

<ul>
<li>Contiguous Port Range: a set of port values which form a contiguous sequence.</li>
<li>Non Contiguous Port Range: a set of port values which does not form a contiguous sequence.</li>
<li>Random Port Range: a cryptographically random set of port values.</li>
</ul>

<p>Unless explicitly mentioned, Port Mask refers to the couple (Port Range Value, Port Range Mask).</p>
<p id="rfc.section.1.2.p.3">In addition, this document makes use of the following terms:</p>
<p><a href="#RFC1661">[RFC1661]</a>.</p>

<ul>
<li>Delegated port or port range: a port or a range of ports belonging to an IP address managed by an upstream device (such as NAT), which are delegated to a client for use as source address and port when sending packets.</li>
<li>Forwarded port or port range: a port or a range of ports belonging to an IP address managed by an upstream device such as (NAT), which is/are statically mapped to the internal IP address of the client and same port number of the client.</li>
</ul>

<p>This memo uses the same terminology as per </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#values" id="values">Port Range Options</a>
</h1>
<p id="rfc.section.2.p.1">This section defines the IPCP Option for Port Range delegation. The format of vendor-specific options is defined in <a href="#RFC2153">[RFC2153]</a>. Below are provided the values to be conveyed when the Port Range Option is used:</p>

<ul>
<li>Organizationally Unique Identifier (OUI): This field is set to 781DBA (hex).</li>
<li>Kind: This field is set to F0 (hex).</li>
<li>Value: The content of this field is specified in <a href="#value_1">Section 2.1</a> and <a href="#value_2">Section 2.2</a>.</li>
</ul>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#value_1" id="value_1">Description of Port Range Value and Port Range Mask</a>
</h1>
<p id="rfc.section.2.1.p.1">The Port Range Value and Port Range Mask are used to specify one range of ports (contiguous or not contiguous) pertaining to a given IP address. Concretely, Port Range Mask and Port Range Value are used to notify a remote peer about the Port Mask to be applied when selecting a port value as a source port. The Port Range Value is used to infer a set of allowed port values. A Port Range Mask defines a set of ports that all have in common a subset of pre-positioned bits. This set of ports is also called Port Range. Two port numbers are said to belong to the same Port Range if and only if, they have the same Port Range Mask.</p>
<p id="rfc.section.2.1.p.2">A Port Mask is composed of a Port Range Value and a Port Range Mask:</p>
<p></p>

<ul>
<li>The Port Range Value indicates the value of the significant bits of the Port Mask. The Port Range Value is coded as follows: <ul>
<li>The significant bits may take a value of 0 or 1.</li>
<li>All the other bits (a.k.a., non significant ones) are set to 0.</li>
</ul>
</li>
<li>The Port Range Mask indicates, by the bit(s) set to 1, the position of the significant bits of the Port Range Value.</li>
</ul>
<p id="rfc.section.2.1.p.4">This IPCP Configuration Option provides a way to negotiate the Port Range to be used on the local end of the link. It allows the sender of the Configure-Request message to state which Port Range associated with a given IP address is desired, or to request the peer to provide the configuration. The peer can provide this information by NAKing the option, and returning a valid Port Range (i.e., (Port Range Value, Port Range Mask)).</p>
<p id="rfc.section.2.1.p.5">When a peer issues a request enclosing IPCP Port Range Option, and if the server does not support this option, the Port Range Option is rejected by the server.</p>
<p id="rfc.section.2.1.p.6">The Port Range IPCP option adheres to the format defined in Section 1.1 of <a href="#RFC2153">[RFC2153]</a>. The "value" field of the option defined in <a href="#RFC2153">[RFC2153]</a> when conveying Port Range IPCP Option is provided in <a href="#Figure_1">Figure 1</a>.</p>
<div id="#rfc.figure.1"></div>
<div id="#Figure_1"></div>
<p></p>

<p></p>
<pre>    0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |M|          Reserved           |      Port Range Value         |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |      Port Range Mask          |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre>
<p></p>
<p></p>

<ul>
<li>M: mode bit. It indicates the mode the port range is allocated for. A value of zero indicates the port ranges are delegated, while a value of 1 indicates the port ranges are port forwarded.</li>
<li>Port Range Value (PRV): PRV indicates the value of the significant bits of the Port Mask. By default, no PRV is assigned.</li>
<li>Port Range Mask (PRM): Port Range Mask indicates the position of the bits which are used to build the Port Range Value. By default, no PRM value is assigned. The 1 values in the Port Range Mask indicate by their position the significant bits of the Port Range Value.</li>
</ul>
<p><a href="#Figure_3">Figure 2</a> provides an example of the resulting Port Range:</p>
<p id="rfc.section.2.1.p.10">- Port Range Mask is set to 0001010000000000 (5120) and</p>
<div id="#rfc.figure.2"></div>
<div id="#Figure_3"></div>
<p id="rfc.section.2.1.p.11">- Port Range Value is set to 0000010000000000 (1024).</p>

<p></p>
<pre>
0                   1                                  
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 0 0 1 0 1 0 0 0 0 0 0 0 0 0 0| Port Range Mask
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |   | 
       |   | (two significant bits)
       v   v
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0| Port Range Value
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|x x x 0 x 1 x x x x x x x x x x| Usable ports (x may be set to 0 or 1)
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre>
<p></p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#value_2" id="value_2">Description of Cryptographically Random Port Range option</a>
</h1>
<p id="rfc.section.2.2.p.1">A cryptographically random Port Range Option may be used as a mitigation tool against blind attacks described in <a href="#RFC6056">[RFC6056]</a>.</p>
<p id="rfc.section.2.2.p.2">The benefits of the approach and the method to calculate the delegated ports set are described in <a href="#I-D.bajko-pripaddrassign">[I-D.bajko-pripaddrassign]</a>.</p>
<div id="#rfc.figure.3"></div>
<div id="#Figure_8"></div>
<p></p>

<p>The cryptographically Random Port Range IPCP Option adheres to the format defined in Section 1.1 of <a href="#RFC2153">[RFC2153]</a>. The "value" field of the option defined in <a href="#RFC2153">[RFC2153]</a> when conveying cryptographically Random Port Range IPCP Option is illustrated in <a href="#Figure_8">Figure 3</a></p>
<pre>
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |M|          Reserved           |          function             |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |        starting point         |   number of delegated ports   |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                             key K               ...
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  ...                                                           ...
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  ...                                                           ...
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  ...                                                             |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre>
<p></p>
<p></p>

<ul>
<li>M: mode bit. It indicates the mode the port range is allocated for. A value of zero indicates the port ranges are delegated, while a value of 1 indicates the port ranges are port forwarded.</li>
<li>Function: A 16 bit field whose value is associated with predefined encryption functions. This specification associates value 1 with the predefined function described in Section 5 of <a href="#I-D.bajko-pripaddrassign">[I-D.bajko-pripaddrassign]</a>.</li>
<li>Starting Point: A 16 bit value used as an input to the specified function</li>
<li>Number of delegated ports: A 16 bit value specifying the number of ports delegated to the client for use as source port values.</li>
<li>Key K: A 128 bit key used as input to the predefined function for delegated port calculation.</li>
</ul>
<p id="rfc.section.2.2.p.5">When the option is included in the IPCP Configure-Request 'key field' and 'starting point' field SHALL be set to all zeros. The requester MAY indicate in the 'function' field which encryption function requester prefers, and in the 'number of delegated ports' field the number of ports the requester would like to obtain. If requester has no preference it SHALL set also the 'function' field and/or 'number of delegated ports' field to zero.</p>
<p id="rfc.section.2.2.p.6">The usage of the option in IPCP message negotiation (Request/Reject/Nak/Ack) follows the logic described for Port Mask and Port Range options at section 2.3.</p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> Illustration Examples</h1>
<p></p>
<h1 id="rfc.section.2.3.1">
<a href="#rfc.section.2.3.1">2.3.1.</a> Overview</h1>
<p id="rfc.section.2.3.1.p.1">These flows provide examples of the usage of IPCP to convey the Port Range Option. As illustrated in <a href="#Figure_4">Figure 4</a>, IPCP messages are exchanged between a Host and a BRAS (Broadband Access Server).</p>
<p></p>

<ol>
<li>The first example illustrates a successful IPCP exchange;</li>
<li>The second example shows the IPCP exchange that occurs when Port Range Option is not supported by the server;</li>
<li>The third example shows the IPCP exchange that occurs when Port Range Option is not supported by the client;</li>
<li>The fourth example shows the IPCP exchange that occurs when Port Range Option is not supported by the client and a non null IP (i.e., an address different from 0.0.0.0) address is enclosed in the first configuration request issued by the peer.</li>
</ol>
<h1 id="rfc.section.2.3.2">
<a href="#rfc.section.2.3.2">2.3.2.</a> Successful Flow: Port Range Options supported by both the Client and the Server</h1>
<p id="rfc.section.2.3.2.p.1">The following message exchange (i.e., <a href="#Figure_4">Figure 4</a>) provides an example of successful IPCP configuration operation when the Port Range IPCP Option is used.</p>
<div id="#rfc.figure.4"></div>
<div id="#Figure_4"></div>
<p></p>

<p></p>
<pre>
  +-----+                                          +-----+
  | Host|                                          | BRAS|
  +-----+                                          +-----+
     |                                                |
     |              (1) IPCP Configure-Request        |
     |                IP ADDRESS=0.0.0.0              |
     |                PORT RANGE VALUE=0              |
     |                PORT RANGE MASK=0               |
     |===============================================&gt;|
     |                                                |
     |              (2) IPCP Configure-Nak            |
     |                IP ADDRESS=a.b.c.d              |
     |                PORT RANGE VALUE=80             |
     |                PORT RANGE MASK=496             |
     |&lt;===============================================|
     |                                                |
     |              (3) IPCP Configure-Request        |
     |                IP ADDRESS=a.b.c.d              |
     |                PORT RANGE VALUE=80             |
     |                PORT RANGE MASK=496             |
     |===============================================&gt;|
     |                                                |
     |              (4) IPCP Configure-Ack            |
     |                IP ADDRESS=a.b.c.d              |
     |                PORT RANGE VALUE=80             |
     |                PORT RANGE MASK=496             |
     |&lt;===============================================|
     |                                                |

</pre>
<p></p>
<p id="rfc.section.2.3.2.p.3">The main steps of this flow are listed below:</p>

<ul class="empty">
<li>(1) The Host sends a first Configure-Request which includes the set of options it desires to negotiate. All these Configuration Options are negotiated simultaneously. In this example, Configure-Request carries information about IP-address, Port Range Value and Port Range Mask. In this example, IP-address Option is set to 0.0.0.0, Port Range Value is set to 0 and Port Range Mask is set to 0.</li>
<li>(2) BRAS sends back a Configure-Nak and sets the enclosed options to its preferred values. In this example: IP-Address Option is set to a.b.c.d, Port Range Value is set to 80 and Port Range Mask is set to 496.</li>
<li>(3) The Host re-sends a Configure-Request requesting IP-address Option to be set to a.b.c.d, Port Range Value to be set to 80 and Port Range Mask to be set to 496.</li>
<li>(4) BRAS sends a Configure-Ack message</li>
</ul>

<p>As a result of this exchange, Host is configured to use as local IP address a.b.c.d and the following 128 contiguous Port Ranges resulting of the Port Mask (Port Range Value == 0, Port Range Mask == 496):</p>
<p></p>

<ul class="empty">
<li>- from 80 to 95</li>
<li>- from 592 to 607</li>
<li>- ...</li>
<li>- from 65104 to 65119</li>
</ul>
<h1 id="rfc.section.2.3.3">
<a href="#rfc.section.2.3.3">2.3.3.</a> Port Range Option Not Supported by the Server</h1>
<p id="rfc.section.2.3.3.p.1">This example (<a href="#Figure_5">Figure 5</a>) depicts an exchange of messages when the BRAS does not support IPCP Port Range Option.</p>
<div id="#rfc.figure.5"></div>
<div id="#Figure_5"></div>
<p></p>

<p></p>
<pre>
  +-----+                                          +-----+
  | Host|                                          | BRAS|
  +-----+                                          +-----+
     |                                                |
     |              (1) IPCP Configure-Request        |
     |                IP ADDRESS=0.0.0.0              |
     |                PORT RANGE VALUE=0              |
     |                PORT RANGE MASK=0               |
     |===============================================&gt;|
     |                                                |
     |              (2) IPCP Configure-Reject         |
     |                PORT RANGE VALUE=0              |
     |                PORT RANGE MASK=0               |
     |&lt;===============================================|
     |                                                |
     |              (3) IPCP Configure-Request        |
     |                IP ADDRESS=0.0.0.0              |
     |===============================================&gt;| 
     |                                                |
     |              (4) IPCP Configure-Nak            |
     |                IP ADDRESS=a.b.c.d              |
     |&lt;===============================================|
     |                                                |
     |              (5) IPCP Configure-Request        |
     |                IP ADDRESS=a.b.c.d              |
     |===============================================&gt;|
     |                                                |
     |              (6) IPCP Configure-Ack            |
     |                IP ADDRESS=a.b.c.d              |
     |&lt;===============================================|
     |                                                |

</pre>
<p></p>
<p id="rfc.section.2.3.3.p.3">The main steps of this flow are listed hereafter:</p>

<ul class="empty">
<li>(1) The Host sends a first Configure-Request which includes the set of options it desires to negotiate. All these Configuration Options are negotiated simultaneously. In this example, Configure-Request carries the codes of IP-address, Port Range Value and Port Range Mask options. In this example, IP-address Option is set to 0.0.0.0, Port Range Value is set to 0 and Port Range Mask is set to 0.</li>
<li>(2) BRAS sends back a Configure-Reject to decline Port Range option.</li>
<li>(3) The Host sends a Configure-Request which includes only the codes of IP-Address option. In this example, IP-Address Option is set to 0.0.0.0.</li>
<li>(4) BRAS sends back a Configure-Nak and sets the enclosed option to its preferred value. In this example: IP-Address Option is set to a.b.c.d.</li>
<li>(5) The Host re-sends a Configure-Request requesting IP-Address Option to be set to a.b.c.d.</li>
<li>(6) BRAS sends a Configure-Ack message.</li>
</ul>

<p>As a result of this exchange, Host is configured to use as local IP address a.b.c.d. This IP address is not a shared IP address.</p>
<h1 id="rfc.section.2.3.4">
<a href="#rfc.section.2.3.4">2.3.4.</a> Port Range Option not Supported by the Client</h1>
<p id="rfc.section.2.3.4.p.1">This example (<a href="#Figure_6">Figure 6</a>) depicts exchanges when only shared IP addresses are assigned to end-user's devices.  The server is configured to assign only shared IP addresses. If Port Range Options are not enclosed in the configuration request, the request is rejected and the requesting peer will be unable to access the service as depicted in <a href="#Figure_6">Figure 6</a>.</p>
<div id="#rfc.figure.6"></div>
<div id="#Figure_6"></div>
<p></p>

<p></p>
<pre>
  +-----+                                          +-----+
  | Host|                                          | BRAS|
  +-----+                                          +-----+
     |                                                |
     |              (1) IPCP Configure-Request        |
     |                IP ADDRESS=0.0.0.0              |
     |===============================================&gt;|
     |                                                |
     |              (2) IPCP Protocol-Reject          |
     |&lt;===============================================|
     |                                                |

</pre>
<p></p>
<ul class="empty">
<li>(1) The Host sends a Configure-Request requesting IP-Address Option to be set to 0.0.0.0 and without enclosing the Port Range Option.</li>
<li>(2) BRAS sends a Protocol-Reject message.</li>
</ul>

<p>As a result of this exchange, Host is not able to access the service.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.3.p.1">No action is required from IANA since this document adheres to <a href="#RFC2153">[RFC2153]</a>.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.4.p.1">This document does not introduce any security issue in addition to those related to PPP. Service providers should use authentication mechanisms such as CHAP <a href="#RFC1994">[RFC1994]</a> or PPP link encryption <a href="#RFC1968">[RFC1968]</a>.</p>
<p id="rfc.section.4.p.2">Use of small and non-random port range may increase host exposure to attacks described <a href="#RFC6056">[RFC6056]</a>. This risk can be reduced by using larger port range or by using Random Port Range Option.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Contributors</h1>
<p id="rfc.section.5.p.1">Jean-Luc Grimault and Alain Villefranque contributed to this document.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.6.p.1">The authors would like to thank C. Jacquenet, J. Carlson, B.  Carpenter and M. Townsley for their review.</p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">7.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1661">[RFC1661]</b></td>
<td class="top">
<a href="mailto:Bill.Simpson@um.cc.umich.edu" title="Daydreamer, Computer Systems Consulting Services">Simpson, W.</a>, "<a href="http://tools.ietf.org/html/rfc1661">The Point-to-Point Protocol (PPP)</a>", STD 51, RFC 1661, July 1994.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1968">[RFC1968]</b></td>
<td class="top">
<a href="mailto:gerry@spider.co.uk" title="Spider Systems">Meyer, G.</a> and <a href="mailto:karl@ascend.com" title="Ascend Communications">K. Fox</a>, "<a href="http://tools.ietf.org/html/rfc1968">The PPP Encryption Control Protocol (ECP)</a>", RFC 1968, June 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1994">[RFC1994]</b></td>
<td class="top">
<a href="mailto:wsimpson@GreenDragon.com" title="DayDreamer Computer Systems Consulting Services">Simpson, W.</a>, "<a href="http://tools.ietf.org/html/rfc1994">PPP Challenge Handshake Authentication Protocol (CHAP)</a>", RFC 1994, August 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2153">[RFC2153]</b></td>
<td class="top">
<a href="mailto:wsimpson@GreenDragon.com" title="DayDreamer, Computer Systems Consulting Services">Simpson, W.</a> and <a href="mailto:karl@Ascend.com" title="Ascend Communications">K. Fox</a>, "<a href="http://tools.ietf.org/html/rfc2153">PPP Vendor Extensions</a>", RFC 2153, May 1997.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">7.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.bajko-pripaddrassign">[I-D.bajko-pripaddrassign]</b></td>
<td class="top">
<a>Bajko, G</a>, <a>Savolainen, T</a>, <a>Boucadair, M</a> and <a>P Levis</a>, "<a href="http://tools.ietf.org/html/draft-bajko-pripaddrassign-03">Port Restricted IP Address Assignment</a>", Internet-Draft draft-bajko-pripaddrassign-03, September 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-behave-lsn-requirements">[I-D.ietf-behave-lsn-requirements]</b></td>
<td class="top">
<a>Perreault, S</a>, <a>Yamagata, I</a>, <a>Miyakawa, S</a>, <a>Nakagawa, A</a> and <a>H Ashida</a>, "<a href="http://tools.ietf.org/html/draft-ietf-behave-lsn-requirements-04">Common requirements for Carrier Grade NAT (CGN)</a>", Internet-Draft draft-ietf-behave-lsn-requirements-04, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ymbk-aplusp">[I-D.ymbk-aplusp]</b></td>
<td class="top">
<a>Bush, R</a>, "<a href="http://tools.ietf.org/html/draft-ymbk-aplusp-10">The A+P Approach to the IPv4 Address Shortage</a>", Internet-Draft draft-ymbk-aplusp-10, May 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6056">[RFC6056]</b></td>
<td class="top">
<a>Larsen, M.</a> and <a>F. Gont</a>, "<a href="http://tools.ietf.org/html/rfc6056">Recommendations for Transport-Protocol Port Randomization</a>", BCP 156, RFC 6056, January 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mohamed Boucadair</span> 
	  <span class="n hidden">
		<span class="family-name">Boucadair</span>
	  </span>
	</span>
	<span class="org vcardline">France Telecom</span>
	<span class="adr">
	  <span>3, Av Fran&#231;ois Ch&#226;teau</span>

	  <span class="vcardline">
		<span class="locality">Rennes</span>,  
		<span class="region"></span>
		<span class="code">35000</span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mohamed.boucadair@orange-ftgroup.com">mohamed.boucadair@orange-ftgroup.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Pierre Levis</span> 
	  <span class="n hidden">
		<span class="family-name">Levis</span>
	  </span>
	</span>
	<span class="org vcardline">France Telecom</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Caen</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:pierre.levis@orange-ftgroup.com">pierre.levis@orange-ftgroup.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Gabor Bajko</span> 
	  <span class="n hidden">
		<span class="family-name">Bajko</span>
	  </span>
	</span>
	<span class="org vcardline">Nokia</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:gabor(dot)bajko(at)nokia(dot)com">gabor(dot)bajko(at)nokia(dot)com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Teemu Savolainen</span> 
	  <span class="n hidden">
		<span class="family-name">Savolainen</span>
	  </span>
	</span>
	<span class="org vcardline">Nokia</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:teemu.savolainen@nokia.com">teemu.savolainen@nokia.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Tina Tsou</span> 
	  <span class="n hidden">
		<span class="family-name">Tsou</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei Technologies (USA)</span>
	<span class="adr">
	  <span>2330 Central Expressway</span>

	  <span class="vcardline">
		<span class="locality">Santa Clara</span>,  
		<span class="region">CA</span> 
		<span class="code">95050</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 408 330 4424</span>

<span class="vcardline">EMail: <a href="mailto:tena@huawei.com">tena@huawei.com</a></span>

  </address>
</div>

</body>
</html>