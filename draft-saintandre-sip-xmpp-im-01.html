<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Instant Messaging</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Instant Messaging">
<meta name="keywords" content="XMPP, Jabber, SIP, SIMPLE, IM, Instant Messaging">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">P. Saint-Andre</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Cisco</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">A. Houri</td></tr>
<tr><td class="header">Expires: September 10, 2009</td><td class="header">IBM</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">J. Hildebrand</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Cisco</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 09, 2009</td></tr>
</table></td></tr></table>
<h1><br />Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Instant Messaging<br />draft-saintandre-sip-xmpp-im-01</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 10, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This document defines a bi-directional protocol mapping for the exchange of single instant messages between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP).
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#im">2.</a>&nbsp;
Instant Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#im-over">2.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#im-xmpp">2.2.</a>&nbsp;
XMPP to SIP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#im-sip">2.3.</a>&nbsp;
SIP to XMPP<br />
<a href="#content">3.</a>&nbsp;
Content Types<br />
<a href="#sec">4.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">5.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">5.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">5.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>In order to help ensure interworking between instant messaging systems that conform to the requirements of <a class='info' href='#IMP-REQS'>RFC 2779<span> (</span><span class='info'>Day, M., Aggarwal, S., and J. Vincent, &ldquo;Instant Messaging / Presence Protocol Requirements,&rdquo; February&nbsp;2000.</span><span>)</span></a> [IMP&#8209;REQS], it is important to clearly define protocol mappings between such systems.  Within the IETF, work has proceeded on two instant messaging technologies:
</p>
<p></p>
<ul class="text">
<li>Various extensions to the Session Initiation Protocol (<a class='info' href='#SIP'>[SIP]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>) for instant messaging, as developed within the SIP for Instant Messaging and Presence Leveraging Extensions (SIMPLE) Working Group; the relevant specification for instant messaging is <a class='info' href='#SIP-IM'>[SIP&#8209;IM]<span> (</span><span class='info'>Campbell, B., Rosenberg, J., Schulzrinne, H., Huitema, C., and D. Gurle, &ldquo;Session Initiation Protocol (SIP) Extension for Instant Messaging,&rdquo; December&nbsp;2002.</span><span>)</span></a>
</li>
<li>The Extensible Messaging and Presence Protocol (XMPP), which consists of a formalization of the core XML streaming protocols developed originally by the Jabber open-source community; the relevant specifications are <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a> for the XML streaming layer and <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a> for basic presence and instant messaging extensions
</li>
</ul>

<p>One approach to helping ensure interworking between these protocols is to map each protocol to the abstract semantics described in <a class='info' href='#CPIM'>[CPIM]<span> (</span><span class='info'>Peterson, J., &ldquo;Common Profile for Instant Messaging (CPIM),&rdquo; August&nbsp;2004.</span><span>)</span></a>; that is the approach taken by <a class='info' href='#SIMPLE-CPIM'>[SIMPLE&#8209;CPIM]<span> (</span><span class='info'>Rosenberg, J. and B. Campbell, &ldquo;CPIM Mapping of SIMPLE Presence and Instant Messaging,&rdquo; June&nbsp;2002.</span><span>)</span></a> and <a class='info' href='#XMPP-CPIM'>[XMPP&#8209;CPIM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Mapping the Extensible Messaging and Presence Protocol (XMPP) to Common Presence and Instant Messaging (CPIM),&rdquo; October&nbsp;2004.</span><span>)</span></a>.  The approach taken in this document is to directly map semantics from one protocol to another (i.e., from SIP/SIMPLE to XMPP and vice-versa).
</p>
<p>The architectural assumptions underlying such direct mappings are provided in <a class='info' href='#SIP-XMPP'>[SIP&#8209;XMPP]<span> (</span><span class='info'>Saint-Andre, P., Houri, A., and J. Hildebrand, &ldquo;Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; March&nbsp;2009.</span><span>)</span></a>, including mapping of addresses and error condisions.  The mappings specified in this document cover basic instant messaging functionality, i.e., the exchange of a single instant message between a SIP user and an XMPP user in either direction.  Mapping of more advanced functionality is out of scope for this document, but other documents in this "series" cover such topics.
</p>
<p>Note: The capitalized key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#TERMS'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [TERMS].
</p>
<a name="im"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Instant Messages</h3>

<a name="im-over"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Overview</h3>

<p>Both XMPP and IM-aware SIP systems enable entities (often but not necessarily human users) to send "instant messages" to other entities.  The term "instant message" usually refers to messages sent between two entities for delivery in close to real time (rather than messages that are stored and forwarded to the intended recipient upon request).  Generally there are three kinds of instant message:
</p>
<p>
          </p>
<ul class="text">
<li>Single messages, which are sent from the sender to the recipient outside the context of any one-to-one chat session or multi-user text conference.
</li>
<li>Chat messages, which are sent from the sender to the recipient in the context of a "messaging session" between the two entities.
</li>
<li>Groupchat messages, which are sent from a sender to multiple recipients in the context of a text conference.
</li>
</ul><p>
        
</p>
<p>This document covers single messages only, since they form the "lowest common denominator" for instant messaging on the Internet.  It is likely that future documents will address one-to-one chat sessions and multi-user chat.
</p>
<p>Instant messaging using XMPP message stanzas of type "normal" is specified in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>.  Instant messaging using SIP requests of type MESSAGE (often called "page-mode" messaging) is specified in <a class='info' href='#SIP-IM'>[SIP&#8209;IM]<span> (</span><span class='info'>Campbell, B., Rosenberg, J., Schulzrinne, H., Huitema, C., and D. Gurle, &ldquo;Session Initiation Protocol (SIP) Extension for Instant Messaging,&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<p>As described in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>, a single instant message is an XML &lt;message/&gt; stanza of type "normal" sent over an XML stream (since "normal" is the default for the 'type' attribute of the &lt;message/&gt; stanza, the attribute is often omitted).  In this document we will assume that such a message is sent from an XMPP client to an XMPP server over an XML stream negotiated between the client and the server, and that the client is controlled by a human user (this is a simplifying assumption introduced for explanatory purposes only; the XMPP sender could be a bot-controlled client, a component such as a workflow application, a server, etc.).  Continuing the tradition of Shakespeare examples in XMPP documentation, we will say that the XMPP user has an XMPP address of &lt;juliet@example.com&gt;.
</p>
<p>As described in <a class='info' href='#SIP-IM'>[SIP&#8209;IM]<span> (</span><span class='info'>Campbell, B., Rosenberg, J., Schulzrinne, H., Huitema, C., and D. Gurle, &ldquo;Session Initiation Protocol (SIP) Extension for Instant Messaging,&rdquo; December&nbsp;2002.</span><span>)</span></a>, a single instant message is a SIP MESSAGE request sent from a SIP user agent to an intended recipient who is most generally referenced by an Instant Message URI of the form &lt;im:user@domain&gt; but who may be referenced by a SIP or SIPS URI of the form &lt;sip:user@domain&gt; or &lt;sips:user@domain&gt;  Here again we introduce the simplifying assumption that the user agent is controlled by a human user, whom we shall dub &lt;romeo@example.net&gt;.
</p>
<a name="im-xmpp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
XMPP to SIP</h3>

<p>When Juliet wants to send an instant message to Romeo, she interacts with her XMPP client, which generates an XMPP &lt;message/&gt; stanza.  The syntax of the &lt;message/&gt; stanza, including required and optional elements and attributes, is defined in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>.  The following is an example of such a stanza:
</p>
<p>Example: XMPP user sends message:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  &lt;message from='juliet@example.com/balcony'
|           to='romeo@example.net'&gt;
|    &lt;body&gt;Art thou not Romeo, and a Montague?&lt;/body&gt;
|  &lt;/message&gt;
</pre></div>
<p>Upon receiving such a stanza, the XMPP server to which Juliet has connected either delivers it to a local recipient (if the hostname in the 'to' attribute matches one of the hostnames serviced by the XMPP server) or attempts to route it to the foreign domain that services the hostname in the 'to' attribute.  Naturally, in this document we assume that the hostname in the 'to' attribute is an IM-aware SIP service hosted by a separate server.  As specified in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>, the XMPP server needs to determine the identity of the foreign domain, which it does by performing one or more <a class='info' href='#SRV'>[SRV]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> lookups.  For message stanzas, the order of lookups recommended by <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a> is to first try the "_xmpp-server" service as specified in <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a> and to then try the "_im" service as specified in <a class='info' href='#IMP-SRV'>[IMP&#8209;SRV]<span> (</span><span class='info'>Peterson, J., &ldquo;Address Resolution for Instant Messaging and Presence,&rdquo; August&nbsp;2004.</span><span>)</span></a>.  Here we assume that the first lookup will fail but that the second lookup will succeed and return a resolution "_im._simple.example.net.", since we have already assumed that the example.net hostname is running a SIP instant messaging service.  (Note: The XMPP server may have previously determined that the foreign domain is a SIMPLE server, in which case it would not need to perform the SRV lookups; the caching of such information is a matter of implementation and local service policy, and is therefore out of scope for this document.)
</p>
<p>Once the XMPP server has determined that the foreign domain is serviced by a SIMPLE server, it must determine how to proceed.  We here assume that the XMPP server contains or has available to it an XMPP-SIMPLE gateway.  The XMPP server would then deliver the message stanza to the XMPP-SIMPLE gateway.
</p>
<p>The XMPP-SIMPLE gateway is then responsible for translating the XMPP message stanza into a SIP MESSAGE request from the XMPP user to the SIP user:
</p>
<p>Example: XMPP user sends message (SIP transformation):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  MESSAGE sip:romeo@example.net SIP/2.0
|  Via: SIP/2.0/TCP x2s.example.com;branch=z9hG4bK776sgdkse
|  Max-Forwards: 70
|  From: sip:juliet@example.com;tag=49583
|  To: sip:romeo@example.net
|  Call-ID: Hr0zny9l3@example.com
|  CSeq: 1 MESSAGE
|  Content-Type: text/plain
|  Content-Length: 35
|
|  Art thou not Romeo, and a Montague?
</pre></div>
<p>The mapping of XMPP syntax elements to SIP syntax elements SHOULD be as shown in the following table.  (Mappings for elements not mentioned are undefined.)
</p>
<p>Table 4: Message syntax mapping from XMPP to SIP
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   +-----------------------------+--------------------------+
   |  XMPP Element or Attribute  |  SIP Header or Contents  |
   +-----------------------------+--------------------------+
   |  &lt;body/&gt;                    |  body of MESSAGE         |
   |  &lt;subject/&gt;                 |  Subject                 |
   |  &lt;thread/&gt;                  |  Call-ID                 |
   |  from                       |  From                    |
   |  id                         |  (no mapping)            |
   |  to                         |  To                      |
   |  type                       |  (no mapping)            |
   |  xml:lang                   |  Content-Language        |
   +-----------------------------+--------------------------+
</pre></div>
<a name="im-sip"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
SIP to XMPP</h3>

<p>When Romeo wants to send an instant message to Juliet, he interacts with his SIP user agent, which generates a SIP MESSAGE request.  The syntax of the MESSAGE request is defined in <a class='info' href='#SIP-IM'>[SIP&#8209;IM]<span> (</span><span class='info'>Campbell, B., Rosenberg, J., Schulzrinne, H., Huitema, C., and D. Gurle, &ldquo;Session Initiation Protocol (SIP) Extension for Instant Messaging,&rdquo; December&nbsp;2002.</span><span>)</span></a>.  The following is an example of such a request:
</p>
<p>Example: SIP user sends message:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  MESSAGE sip:juliet@example.com SIP/2.0
|  Via: SIP/2.0/TCP s2x.example.net;branch=z9hG4bKeskdgs677
|  Max-Forwards: 70
|  From: sip:romeo@example.net;tag=38594
|  To: sip:juliet@example.com
|  Call-ID: M4spr4vdu@example.net
|  CSeq: 1 MESSAGE
|  Content-Type: text/plain
|  Content-Length: 44
|
|  Neither, fair saint, if either thee dislike.
</pre></div>
<p>Section 5 of <a class='info' href='#SIP-IM'>[SIP&#8209;IM]<span> (</span><span class='info'>Campbell, B., Rosenberg, J., Schulzrinne, H., Huitema, C., and D. Gurle, &ldquo;Session Initiation Protocol (SIP) Extension for Instant Messaging,&rdquo; December&nbsp;2002.</span><span>)</span></a> stipulates that a SIP User Agent presented with an im: URI should resolve it to a sip: or sips: URI.  Therefore we assume that the To header of a request received by a SIMPLE-XMPP gateway will contain a sip: or sips: URI.  The gateway SHOULD resolve that address to an im: URI for SIP MESSAGE requests, then follow the rules in <a class='info' href='#IMP-SRV'>[IMP&#8209;SRV]<span> (</span><span class='info'>Peterson, J., &ldquo;Address Resolution for Instant Messaging and Presence,&rdquo; August&nbsp;2004.</span><span>)</span></a> regarding the "_im" SRV service for the target domain contained in the To header.  If SRV address resolution fails for the "_im" service, the gateway MAY attempt a lookup for the "_xmpp-server" service as specified in <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a> or MAY return an error to the sender (the SIP "502 Bad Gateway" error seems most appropriate; see <a class='info' href='#SIP-XMPP'>[SIP&#8209;XMPP]<span> (</span><span class='info'>Saint-Andre, P., Houri, A., and J. Hildebrand, &ldquo;Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; March&nbsp;2009.</span><span>)</span></a> for details).  If SRV address resolution succeeds, the gateway is responsible for translating the request into an XMPP message stanza from the SIP user to the XMPP user and returning a SIP "200 OK" message to the sender:
</p>
<p>Example: SIP user sends message (XMPP transformation):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  &lt;message from='romeo@example.net'
|           to='juliet@example.com'&gt;
|    &lt;body&gt;Neither, fair saint, if either thee dislike.&lt;/body&gt;
|  &lt;/message&gt;
</pre></div>
<p>The mapping of SIP syntax elements to XMPP syntax elements SHOULD be as shown in the following table.  (Mappings for elements not mentioned in the foregoing table are undefined.)
</p>
<p>Table 5: Message syntax mapping from SIP to XMPP
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   +--------------------------+-----------------------------+
   |  SIP Header or Contents  |  XMPP Element or Attribute  |
   +--------------------------+-----------------------------+
   |  Call-ID                 |  &lt;thread/&gt;                  |
   |  Content-Language        |  xml:lang                   |
   |  CSeq                    |  (no mapping)               |
   |  From                    |  from                       |
   |  Subject                 |  &lt;subject/&gt;                 |
   |  To                      |  to                         |
   |  body of MESSAGE         |  &lt;body/&gt;                    |
   +--------------------------+-----------------------------+
</pre></div>
<p>Note: When transforming SIP page-mode messages, a SIMPLE-XMPP gateway SHOULD specify no XMPP 'type' attribute or a 'type' attribute whose value is "normal" (alternatively, the value of the 'type' attribute MAY be "chat", although it SHOULD NOT be "headline" and MUST NOT be "groupchat").
</p>
<p>Note: See the <a class='info' href='#content'>Content Types<span> (</span><span class='info'>Content Types</span><span>)</span></a> of this document regarding handling of SIP message bodies that contain content types other than plain text.
</p>
<a name="content"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Content Types</h3>

<p>SIP requests of type MESSAGE may contain essentially any content type.  The recommended procedures for SIMPLE-to-XMPP gateways to use in handling these content types are as follows.
</p>
<p>A SIMPLE-to-XMPP gateway MUST process SIP messages that contain message bodies of type "text/plain" and MUST encapsulate such message bodies as the XML character data of the XMPP &lt;body/&gt; element.
</p>
<p>A SIMPLE-to-XMPP gateway SHOULD process SIP messages that contain message bodies of type "text/html"; if so, a gateway MUST transform the "text/html" content into XHTML content that conforms to the XHTML 1.0 Integration Set specified in <a class='info' href='#XEP-0071'>[XEP&#8209;0071]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;XHTML-IM,&rdquo; January&nbsp;2006.</span><span>)</span></a>.
</p>
<p>A SIMPLE-to-XMPP gateway MAY process SIP messages that contain message bodies of types other than "text/plain" and "text/html" but handling of such content types is a matter of implementation.
</p>
<a name="sec"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security Considerations</h3>

<p>Detailed security considerations for instant messaging protocols are given in <a class='info' href='#IMP-REQS'>[IMP&#8209;REQS]<span> (</span><span class='info'>Day, M., Aggarwal, S., and J. Vincent, &ldquo;Instant Messaging / Presence Protocol Requirements,&rdquo; February&nbsp;2000.</span><span>)</span></a>, for SIP-based instant messaging in <a class='info' href='#SIP-IM'>[SIP&#8209;IM]<span> (</span><span class='info'>Campbell, B., Rosenberg, J., Schulzrinne, H., Huitema, C., and D. Gurle, &ldquo;Session Initiation Protocol (SIP) Extension for Instant Messaging,&rdquo; December&nbsp;2002.</span><span>)</span></a> (see also <a class='info' href='#SIP'>[SIP]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>), and for XMPP-based instant messaging in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a> (see also <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a>).
</p>
<p>This document specifies methods for exchanging instant messages information through a gateway that translates between SIP and XMPP.  Such a gateway MUST be compliant with the minimum security requirements of the instant messaging protocols for which it translates (i.e., SIP and XMPP).  The addition of gateways to the security model of instant messaging specified in <a class='info' href='#IMP-REQS'>[IMP&#8209;REQS]<span> (</span><span class='info'>Day, M., Aggarwal, S., and J. Vincent, &ldquo;Instant Messaging / Presence Protocol Requirements,&rdquo; February&nbsp;2000.</span><span>)</span></a> introduces some new risks.  In particular, end-to-end security properties (especially confidentiality and integrity) between instant messaging user agents that interface through a SIMPLE-XMPP gateway can be provided only if common formats are supported.  Specification of those common formats is out of scope for this document, although it is recommended to use <a class='info' href='#MSGFMT'>[MSGFMT]<span> (</span><span class='info'>Klyne, G. and D. Atkins, &ldquo;Common Presence and Instant Messaging (CPIM): Message Format,&rdquo; August&nbsp;2004.</span><span>)</span></a> for instant messages.
</p>
<p><a class='info' href='#IMP-REQS'>[IMP&#8209;REQS]<span> (</span><span class='info'>Day, M., Aggarwal, S., and J. Vincent, &ldquo;Instant Messaging / Presence Protocol Requirements,&rdquo; February&nbsp;2000.</span><span>)</span></a> requires that conformant technologies shall include methods for blocking communications from unwanted addresses.  Such blocking is the responsibility of conformant technology (e.g., XMPP or SIP) and is out of scope for this memo.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>5.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="IMP-SRV">[IMP-SRV]</a></td>
<td class="author-text">Peterson, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3861">Address Resolution for Instant Messaging and Presence</a>,&rdquo; RFC&nbsp;3861, August&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3861.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SIP">[SIP]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SIP-IM">[SIP-IM]</a></td>
<td class="author-text">Campbell, B., Rosenberg, J., Schulzrinne, H., Huitema, C., and D. Gurle, &ldquo;<a href="http://tools.ietf.org/html/rfc3428">Session Initiation Protocol (SIP) Extension for Instant Messaging</a>,&rdquo; RFC&nbsp;3428, December&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3428.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SIP-XMPP">[SIP-XMPP]</a></td>
<td class="author-text">Saint-Andre, P., Houri, A., and J. Hildebrand, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-saintandre-sip-xmpp-core-01.txt">Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Core</a>,&rdquo; draft-saintandre-sip-xmpp-core-01 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-saintandre-sip-xmpp-core-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SRV">[SRV]</a></td>
<td class="author-text"><a href="mailto:arnt@troll.no">Gulbrandsen, A.</a>, Vixie, P., and <a href="mailto:levone@microsoft.com">L. Esibov</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>,&rdquo; RFC&nbsp;2782, February&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2782.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="TERMS">[TERMS]</a></td>
<td class="author-text"><a href="mailto:-">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP">[XMPP]</a></td>
<td class="author-text">Saint-Andre, P., &ldquo;<a href="http://tools.ietf.org/html/rfc3920">Extensible Messaging and Presence Protocol (XMPP): Core</a>,&rdquo; RFC&nbsp;3920, October&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3920.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP-IM">[XMPP-IM]</a></td>
<td class="author-text">Saint-Andre, P., &ldquo;<a href="http://tools.ietf.org/html/rfc3921">Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence</a>,&rdquo; RFC&nbsp;3921, October&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3921.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>5.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="CPIM">[CPIM]</a></td>
<td class="author-text">Peterson, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3860">Common Profile for Instant Messaging (CPIM)</a>,&rdquo; RFC&nbsp;3860, August&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3860.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IMP-REQS">[IMP-REQS]</a></td>
<td class="author-text"><a href="mailto:mday@alum.mit.edu">Day, M.</a>, <a href="mailto:sonuag@microsoft.com">Aggarwal, S.</a>, and <a href="mailto:jesse@intonet.com">J. Vincent</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2779">Instant Messaging / Presence Protocol Requirements</a>,&rdquo; RFC&nbsp;2779, February&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2779.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="MSGFMT">[MSGFMT]</a></td>
<td class="author-text">Klyne, G. and D. Atkins, &ldquo;<a href="http://tools.ietf.org/html/rfc3862">Common Presence and Instant Messaging (CPIM): Message Format</a>,&rdquo; RFC&nbsp;3862, August&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3862.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SIMPLE-CPIM">[SIMPLE-CPIM]</a></td>
<td class="author-text">Rosenberg, J. and B. Campbell, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-cpim-mapping-01.txt">CPIM Mapping of SIMPLE Presence and Instant Messaging</a>,&rdquo; draft-ietf-simple-cpim-mapping-01 (work in progress), June&nbsp;2002 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-cpim-mapping-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0071">[XEP-0071]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0071.html">XHTML-IM</a>,&rdquo; XSF XEP&nbsp;0071, January&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP-CPIM">[XMPP-CPIM]</a></td>
<td class="author-text">Saint-Andre, P., &ldquo;<a href="http://tools.ietf.org/html/rfc3922">Mapping the Extensible Messaging and Presence Protocol (XMPP) to Common Presence and Instant Messaging (CPIM)</a>,&rdquo; RFC&nbsp;3922, October&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3922.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Peter Saint-Andre</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:psaintan@cisco.com">psaintan@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Avshalom Houri</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">IBM</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Building 18/D, Kiryat Weizmann Science Park</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rehovot  76123</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Israel</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:avshalom@il.ibm.com">avshalom@il.ibm.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Joe Hildebrand</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jhildebr@cisco.com">jhildebr@cisco.com</a></td></tr>
</table>
</body></html>
