<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Using the NETCONF Configuration Protocol over Secure Shell (SSH)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Using the NETCONF Configuration Protocol over Secure Shell (SSH)">
<meta name="keywords" content="I-D, Internet-Draft, XML, Extensible Markup Language, configuration, xmlconf, netconf">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">M. Wasserman</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Painless Security, LLC</td></tr>
<tr><td class="header">Obsoletes: <a href='http://tools.ietf.org/html/rfc4742'>4742</a> (if&nbsp;approved)</td><td class="header">T. Goddard</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">ICEsoft Technologies, Inc.</td></tr>
<tr><td class="header">Expires: June 23, 2011</td><td class="header">December 20, 2010</td></tr>
</table></td></tr></table>
<h1><br />Using the NETCONF Configuration Protocol over Secure Shell (SSH)<br />draft-ietf-netconf-rfc4742bis-05.txt</h1>

<h3>Abstract</h3>

<p>
This document describes a method for invoking and running the NETCONF
protocol within a Secure Shell (SSH) session as an SSH subsystem.

</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on June 23, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Requirements Terminology<br />
<a href="#anchor3">3.</a>&nbsp;
Starting NETCONF over SSH<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
Capabilities Exchange<br />
<a href="#anchor5">4.</a>&nbsp;
Using NETCONF over SSH<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.1.</a>&nbsp;
Framing protocol<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.2.</a>&nbsp;
Chunked Framing Mechanism<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.3.</a>&nbsp;
End-of-message Framing Mechanism<br />
<a href="#anchor9">5.</a>&nbsp;
Exiting the NETCONF Subsystem<br />
<a href="#anchor10">6.</a>&nbsp;
Security Considerations<br />
<a href="#anchor11">7.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor12">8.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor13">9.</a>&nbsp;
Change Log<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">9.1.</a>&nbsp;
Changes from RFC4742bis-04 to RFC4742-bis-05<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">9.2.</a>&nbsp;
Changes from RFC4742bis-03 to RFC4742-bis-04<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">9.3.</a>&nbsp;
Changes from RFC4742bis-02 to RFC4742-bis-03<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">9.4.</a>&nbsp;
Changes from RFC4742bis-01 to RFC4742-bis-02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">9.5.</a>&nbsp;
Changes from RFC4742bis-00 to RFC4742-bis-01<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">9.6.</a>&nbsp;
Changes from RFC4742 to RFC4742bis-00<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
The NETCONF protocol <a class='info' href='#I-D.ietf-netconf-4741bis'>[I&#8209;D.ietf&#8209;netconf&#8209;4741bis]<span> (</span><span class='info'>Enns, R., Bjorklund, M., Schoenwaelder, J., and A. Bierman, &ldquo;Network Configuration Protocol (NETCONF),&rdquo; October&nbsp;2010.</span><span>)</span></a> is an
XML-based protocol used to manage the configuration of networking
equipment.  NETCONF is defined to be session-layer and transport
independent, allowing mappings to be defined for multiple
session-layer or transport protocols.  This document defines how
NETCONF can be used within a Secure Shell (SSH) session, using the SSH
connection protocol <a class='info' href='#RFC4254'>[RFC4254]<span> (</span><span class='info'>Ylonen, T. and C. Lonvick, &ldquo;The Secure Shell (SSH) Connection Protocol,&rdquo; January&nbsp;2006.</span><span>)</span></a> over the SSH transport
protocol <a class='info' href='#RFC4253'>[RFC4253]<span> (</span><span class='info'>Ylonen, T. and C. Lonvick, &ldquo;The Secure Shell (SSH) Transport Layer Protocol,&rdquo; January&nbsp;2006.</span><span>)</span></a>.  This mapping will allow NETCONF to be
executed from a secure shell session by a user or application.

</p>
<p>
Although this document gives specific examples of how NETCONF messages
are sent over an SSH connection, use of this transport is not
restricted to the messages shown in the examples below.  This
transport can be used for any NETCONF message.

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Requirements Terminology</h3>

<p>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in RFC 2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Starting NETCONF over SSH</h3>

<p>
To run NETCONF over SSH, the SSH client will first establish an SSH
transport connection using the SSH transport protocol, and the
SSH client and SSH server will exchange keys for message integrity and
encryption.  The SSH client will then invoke the "ssh-userauth" service 
to authenticate the user, as described in the SSH authentication 
protocol <a class='info' href='#RFC4252'>[RFC4252]<span> (</span><span class='info'>Ylonen, T. and C. Lonvick, &ldquo;The Secure Shell (SSH) Authentication Protocol,&rdquo; January&nbsp;2006.</span><span>)</span></a>. Once the user 
has been successfully authenticated, the SSH client will invoke the 
"ssh-connection" service, also known as the SSH connection
protocol.

</p>
<p>
How the NETCONF Server extracts the SSH user name from the SSH layer
is implementation-dependent.

</p>
<p>
After the ssh-connection service is established, the SSH client will open
a channel of type "session", which will result in an SSH session.

</p>
<p>
Once the SSH session has been established, the NETCONF client will
invoke NETCONF as an SSH subsystem called "netconf".  Subsystem
support is a feature of SSH version 2 (SSHv2) and is not included in
SSHv1.  Running NETCONF as an SSH subsystem avoids the need for the
script to recognize shell prompts or skip over extraneous information,
such as a system message that is sent at shell start-up.

</p>
<p>
In order to allow NETCONF traffic to be easily identified and filtered
by firewalls and other network devices, NETCONF servers MUST default
to providing access to the "netconf" SSH subsystem only when the SSH
session is established using the IANA-assigned TCP port 830.
Servers SHOULD be configurable to allow access to the netconf SSH
subsystem over other ports.

</p>
<p>
A user (or application) could use the following command line to invoke
NETCONF as an SSH subsystem on the IANA-assigned port:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

[user@client]$ ssh -s server.example.org -p 830 netconf
</pre></div>
<p>
Note that the -s option causes the command ("netconf") to be invoked
as an SSH subsystem.

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Capabilities Exchange</h3>

<p>
The NETCONF server MUST indicate its capabilities by sending an XML
document containing a &lt;hello&gt; element as soon as the NETCONF session
is established.  The NETCONF client can parse this message to
determine which NETCONF capabilities are supported by the NETCONF
server.

</p>
<p>
The NETCONF client must also send an XML document containing a
&lt;hello&gt; element to indicate the NETCONF client's capabilities to the
NETCONF server.  The document containing the &lt;hello&gt; element
MUST be the first XML document that the NETCONF client sends after the NETCONF
session is established.  

</p>
<p>
The following example shows a capability exchange.  Data sent by the
NETCONF client are marked with &quot;C:&quot; and data sent by the NETCONF
server are marked with &quot;S:&quot;.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

S: &lt;?xml version="1.0" encoding="UTF-8"?&gt;
S: &lt;hello xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"&gt;
S:   &lt;capabilities&gt;
S:     &lt;capability&gt;
S:       urn:ietf:params:xml:ns:netconf:base:1.1
S:     &lt;/capability&gt;
S:     &lt;capability&gt;
S:       urn:ietf:params:ns:netconf:capability:startup:1.0
S:     &lt;/capability&gt;
S:   &lt;/capabilities&gt;
S:   &lt;session-id&gt;4&lt;session-id&gt;
S: &lt;/hello&gt;
S: ]]&gt;]]&gt;

C: &lt;?xml version="1.0" encoding="UTF-8"?&gt;
C: &lt;hello xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"&gt;
C:   &lt;capabilities&gt;
C:     &lt;capability&gt;
C:       urn:ietf:params:xml:ns:netconf:base:1.1
C:     &lt;/capability&gt;
C:   &lt;/capabilities&gt;
C: &lt;/hello&gt;
C: ]]&gt;]]&gt;
</pre></div>
<p>
Although the example shows the NETCONF server sending a &lt;hello&gt;
message followed by the NETCONF client's &lt;hello&gt; message, both
sides will send the message as soon as the NETCONF subsystem is
initialized, perhaps simultaneously.

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Using NETCONF over SSH</h3>

<p>
A NETCONF over SSH session consists of a NETCONF client and NETCONF server 
exchanging complete XML documents.  Once the session has been
established and capabilities have been exchanged, the
NETCONF client will send complete XML documents containing
&lt;rpc&gt; elements to the server, and the NETCONF server will respond with complete XML
documents containing &lt;rpc-reply&gt; elements.

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Framing protocol</h3>

<p>
The previous version of this document defined the character sequence
&quot;]]&lt;]]&gt;&quot; as a message separator, under the assumption that it could not be found in well-formed XML documents.  However, this
assumption is not correct.  It can legally appear in XML attributes, comments, and processing instructions.  In order to solve this problem, 
and at the same time be compatible with existing implementations, this
document defines the following framing protocol.

</p>
<p>
The &lt;hello&gt; message MUST be followed by the character sequence
]]>]]>.  Upon reception of the &lt;hello&gt; message, the 
receiving peer's SSH Transport layer conceptually passes the &lt;hello&gt;
message to the Messages layer.  If the :base:1.1 capability is
advertised by both peers, the chunked transfer mechanism (see Section
4.1.1) is used for the remainder of the NETCONF session.  Otherwise, 
the old end-of-message based mechanism (see Section 4.1.2) is used.

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Chunked Framing Mechanism</h3>

<p>
This mechanism encodes all NETCONF messages with a chunked
framing.  Specifically, the message follows the ABNF 
<a class='info' href='#RFC5234'>[RFC5234]<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a> rule Chunked-Message:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

     Chunked-Message = 1*chunk
                       end-of-chunks

     chunk           = LF HASH chunk-size LF
                       chunk-data
     chunk-size      = 1*DIGIT1 0*DIGIT
     chunk-data      = 1*OCTET

     end-of-chunks   = LF HASH HASH LF

     DIGIT1          = %x31-39
     DIGIT           = %x30-39
     HASH            = %x23
     LF              = %x0A
     OCTET           = %x00-FF

</pre></div>
<p>
The chunk-size field is a string of decimal digits indicating the
number of octets in chunk-data.  Leading zeros are prohibited, and
the maximum allowed chunk-size value is 4294967295.

</p>
<p>
As an example, the message:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

    &lt;rpc message-id="102"
         xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"&gt;
      &lt;close-session/&gt;
    &lt;/rpc&gt;

</pre></div>
<p>
could be encoded as:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

    #4
    &lt;rpc
    #18
     message-id="102"

    #79
         xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"&gt;
      &lt;close-session/&gt;
    &lt;/rpc&gt;
    ##

</pre></div>
<p>
 Conceptually, the SSH Transport layer encodes messages sent by the
 Messages layer, and decodes messages received on the SSH channel
 before passing them to the Messages layer.

</p>
<p>
Note that there is no newline character after the 'rpc' end tag, so there
 is no blank line generated before the '##' line.

</p>
<p>
 If an error occurs during the decoding process, the peer MUST
 terminate the NETCONF session by closing the corresponding SSH
 channel.

</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
End-of-message Framing Mechanism</h3>

<p>
This mechanism exists for backwards compatibility with
implementations of previous versions of this document.  It is only
used when the remote peer does not advertise the :base:1.1
capability.

</p>
<p>
When this mechanism is used, the special character sequence
]]>]]>, MUST be sent by both the NETCONF client and 
the NETCONF server after each message (XML document) in the NETCONF exchange. Conceptually, the SSH Transport layer passes any data found in
between the ]]>]]> characters to the Messages layer.

</p>
<p>
To continue the example given above, a NETCONF over SSH session to
retrieve a set of configuration information might look like this:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

C:
C: #271
C: &lt;?xml version="1.0" encoding="UTF-8"?&gt;
C: &lt;rpc message-id="105"
C:      xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"&gt;
C:   &lt;get-config&gt;
C:     &lt;source&gt;&lt;running/&gt;&lt;/source&gt;
C:     &lt;config xmlns="http://example.com/schema/1.2/config"&gt;
C:      &lt;users/&gt;
C:     &lt;/config&gt;
C:   &lt;/get-config&gt;
C: &lt;/rpc&gt;
C:
C: ##


S:
S: #404
S: &lt;?xml version="1.0" encoding="UTF-8"?&gt;
S: &lt;rpc-reply message-id="105"
S:            xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"&gt;
S:   &lt;config xmlns="http://example.com/schema/1.2/config"&gt;
S:     &lt;users&gt;
S:       &lt;user&gt;&lt;name&gt;root&lt;/name&gt;&lt;type&gt;superuser&lt;/type&gt;&lt;/user&gt;
S:       &lt;user&gt;&lt;name&gt;fred&lt;/name&gt;&lt;type&gt;admin&lt;/type&gt;&lt;/user&gt;
S:       &lt;user&gt;&lt;name&gt;barney&lt;/name&gt;&lt;type&gt;admin&lt;/type&gt;&lt;/user&gt;
S:     &lt;/users&gt;
S:   &lt;/config&gt;
S: &lt;/rpc-reply&gt;
S:
S: ##

</pre></div>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Exiting the NETCONF Subsystem</h3>

<p>
Exiting NETCONF is accomplished using the &lt;close-session&gt; operation.
A NETCONF server will process NETCONF messages from the NETCONF client
in the order in which they are received.  When the NETCONF server
processes a &lt;close-session&gt; operation, the NETCONF server SHALL
respond and close the SSH session channel.  The NETCONF server MUST
NOT process any NETCONF messages received after the &lt;close-session&gt;
operation.

</p>
<p>
To continue the example used in previous sections, an existing
NETCONF subsystem session could be closed as follows:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

C:
C: #141
C: &lt;?xml version="1.0" encoding="UTF-8"?&gt;
C: &lt;rpc message-id="106"
C:      xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"&gt;
C:   &lt;close-session/&gt;
C: &lt;/rpc&gt;
C: ##


S:
S: #140
S: &lt;?xml version="1.0" encoding="UTF-8"?&gt;
S: &lt;rpc-reply id="106"
S:            xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"&gt;
S:   &lt;ok/&gt;
S: &lt;/rpc-reply&gt;
S: ##

</pre></div>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>
NETCONF is used to access configuration and state information and to
modify configuration information, so the ability to access this
protocol should be limited to users and systems that are authorized to
view the NETCONF server's configuration and state or to modify the
NETCONF server's configuration.

</p>
<p>
The identity of the SSH server MUST be verified and authenticated by the
SSH client according to local policy before password-based authentication
data or any configuration or state data is sent to or received from
the SSH server.  The identity of the SSH client MUST also be verified and
authenticated by the SSH server according to local policy to ensure that
the incoming SSH client request is legitimate before any configuration or
state data is sent to or received from the SSH client.  Neither side
should establish a NETCONF over SSH connection with an unknown,
unexpected or incorrect identity on the opposite side.

</p>
<p>
Configuration or state data may include sensitive information, such as
usernames or security keys.  So, NETCONF should only be used over
communications channels that provide strong encryption for data
privacy. This document defines a NETCONF over SSH mapping which
provides for support of strong encryption and authentication.

</p>
<p>
This document requires that SSH servers default to allowing access to
the "netconf" SSH subsystem only when using a specific TCP port
assigned by IANA for this purpose.  This will allow NETCONF over SSH
traffic to be easily identified and filtered by firewalls and other
network nodes.  However, it will also allow NETCONF over SSH traffic
to be more easily identified by attackers.

</p>
<p>
This document also recommends that SSH servers be configurable to allow
access to the "netconf" SSH subsystem over other ports.  Use of that
configuration option without corresponding changes to firewall or
network device configuration may unintentionally result in the ability
for nodes outside of the firewall or other administrative boundary
to gain access to "netconf" SSH subsystem.

</p>
<p>
RFC 4742 assumes that the EOM sequence, ]]>]]>, cannot appear in
any well-formed XML document, which turned out to be mistaken.  The
EOM sequence can cause operational problems and open space for
attacks if sent deliberately in RPC messages.  It is however
believed that the associated threat is not very high.  This
document still uses the EOM sequence for the initial &lt;hello&gt;
message to avoid incompatibility with existing implementations.
When both peers implement this specification, a proper framing
protocol is used for the rest of the NETCONF session, to avoid
injection attacks.

</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>
Based on the previous version of this document, RFC 4742, IANA
assigned port 830 as the default port for NETCONF over SSH sessions.

</p>
<p>
IANA has also assigned "netconf" as an SSH Subsystem Name, as defined 
in <a class='info' href='#RFC4250'>[RFC4250]<span> (</span><span class='info'>Lehtinen, S. and C. Lonvick, &ldquo;The Secure Shell (SSH) Protocol Assigned Numbers,&rdquo; January&nbsp;2006.</span><span>)</span></a>, as follows:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

           Subsystem Name                  Reference
           --------------                  ---------
           netconf                         RFC 4742

</pre></div>
<p>
IANA is requested to update these allocations to reference this document
when it is published as an RFC.

</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgements</h3>

<p>
This document was written using the xml2rfc tool described in RFC 2629
<a class='info' href='#RFC2629'>[RFC2629]<span> (</span><span class='info'>Rose, M., &ldquo;Writing I-Ds and RFCs using XML,&rdquo; June&nbsp;1999.</span><span>)</span></a>.

</p>
<p>
Extensive input was received from the other members of the NETCONF
design team, including: Andy Bierman, Weijing Chen, Rob Enns, Wes
Hardaker, David Harrington, Eliot Lear, Simon Leinen, Phil Shafer,
Juergen Schoenwaelder and Steve Waldbusser.  The following people have
also reviewed this document and provided valuable input: Olafur
Gudmundsson, Sam Hartman, Scott Hollenbeck, Bill Sommerfeld, Bert
Wijnen, Balazs Lengyel and Martin Bjorklund.

</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Change Log</h3>

<p>
[RFC Editor:  Please remove this section before publication as an RFC.]

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
Changes from RFC4742bis-04 to RFC4742-bis-05</h3>

<p>
	    </p>
<ul class="text">
<li>Added option for chunked encoding.
</li>
<li>Added 1.1 capability to enable chunked encoding. 
</li>
</ul><p>
          
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
Changes from RFC4742bis-03 to RFC4742-bis-04</h3>

<p>
	     </p>
<ul class="text">
<li>Shortened text about EOM sequence.
</li>
<li>Added text to Security Considerations about EOM issues.
</li>
</ul><p>
           
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3"></a><h3>9.3.&nbsp;
Changes from RFC4742bis-02 to RFC4742-bis-03</h3>

<p>
	    </p>
<ul class="text">
<li>Added intended status and "obsoletes" to headers.
</li>
<li>Very minor editorial changes.
</li>
</ul><p>
          
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.4"></a><h3>9.4.&nbsp;
Changes from RFC4742bis-01 to RFC4742-bis-02</h3>

<p>
	    </p>
<ul class="text">
<li>Removed unneeded wording about client/server, made 
                 unnecessary by previous changes.
</li>
<li>Stated that how a server extracts the SSH user name is
                 implementation-dependent.
</li>
<li>Further fixes to  operation/message/data wording.
</li>
</ul><p>
          
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.5"></a><h3>9.5.&nbsp;
Changes from RFC4742bis-00 to RFC4742-bis-01</h3>

<p>
	  </p>
<ul class="text">
<li>Changed use of client/server, manager/agent to SSH client/server
	      and NETCONF client/server. 
</li>
<li>Consistently used term operation, instead of command or 
	      message.
</li>
<li>Clarified some sections based on review feedback.
</li>
<li>Fixed several typos.
</li>
</ul><p>
          
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.6"></a><h3>9.6.&nbsp;
Changes from RFC4742 to RFC4742bis-00</h3>

<p>
	  </p>
<ul class="text">
<li>Integrated previously-approved errata from 
	      http://rfc-editor.org/errata_search.php?rfc=4742
</li>
<li>Removed text requiring implementations to skip to an
	      XML start directive at the beginning of a session.
</li>
<li>Made it clear the ]]>]]> is illegal in XML documents
              only outside of comments.
</li>
</ul><p>
          
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-netconf-4741bis">[I-D.ietf-netconf-4741bis]</a></td>
<td class="author-text">Enns, R., Bjorklund, M., Schoenwaelder, J., and A. Bierman, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-netconf-4741bis-06.txt">Network Configuration Protocol (NETCONF)</a>,&rdquo; draft-ietf-netconf-4741bis-06 (work in progress), October&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-netconf-4741bis-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4250">[RFC4250]</a></td>
<td class="author-text">Lehtinen, S. and C. Lonvick, &ldquo;<a href="http://tools.ietf.org/html/rfc4250">The Secure Shell (SSH) Protocol Assigned Numbers</a>,&rdquo; RFC&nbsp;4250, January&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4250.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4252">[RFC4252]</a></td>
<td class="author-text">Ylonen, T. and C. Lonvick, &ldquo;<a href="http://tools.ietf.org/html/rfc4252">The Secure Shell (SSH) Authentication Protocol</a>,&rdquo; RFC&nbsp;4252, January&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4252.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4253">[RFC4253]</a></td>
<td class="author-text">Ylonen, T. and C. Lonvick, &ldquo;<a href="http://tools.ietf.org/html/rfc4253">The Secure Shell (SSH) Transport Layer Protocol</a>,&rdquo; RFC&nbsp;4253, January&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4253.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4254">[RFC4254]</a></td>
<td class="author-text">Ylonen, T. and C. Lonvick, &ldquo;<a href="http://tools.ietf.org/html/rfc4254">The Secure Shell (SSH) Connection Protocol</a>,&rdquo; RFC&nbsp;4254, January&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4254.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5234">[RFC5234]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5234.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2629">[RFC2629]</a></td>
<td class="author-text"><a href="mailto:mrose@not.invisible.net">Rose, M.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2629">Writing I-Ds and RFCs using XML</a>,&rdquo; RFC&nbsp;2629, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2629.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2629.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2629.xml">XML</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Margaret Wasserman</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Painless Security, LLC</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">356 Abbott Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">North Andover, MA  01845</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 781 405-7464</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mrw@painless-security.com">mrw@painless-security.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.painless-security.com">http://www.painless-security.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ted Goddard</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">ICEsoft Technologies, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Suite 300, 1717 10th St. NW</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Calgary, AB  T2M 4S2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Canada</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 403 663-3322</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ted.goddard@icesoft.com">ted.goddard@icesoft.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.icesoft.com">http://www.icesoft.com</a></td></tr>
</table>
</body></html>
