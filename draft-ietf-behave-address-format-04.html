<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IPv6 Addressing of IPv4/IPv6 Translators</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IPv6 Addressing of IPv4/IPv6 Translators">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">C. Huitema</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Microsoft Corporation</td></tr>
<tr><td class="header">Obsoletes: <a href='http://tools.ietf.org/html/rfc2765'>2765</a> (if&nbsp;approved)</td><td class="header">C. Bao</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">CERNET Center/Tsinghua University</td></tr>
<tr><td class="header">Expires: July 19, 2010</td><td class="header">M. Bagnulo</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">UC3M</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">M. Boucadair</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">France Telecom</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">X. Li</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">CERNET Center/Tsinghua University</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">January 15, 2010</td></tr>
</table></td></tr></table>
<h1><br />IPv6 Addressing of IPv4/IPv6 Translators<br />draft-ietf-behave-address-format-04.txt</h1>

<h3>Abstract</h3>

<p> 
This document discusses the algorithmic translation of an IPv6 address to a corresponding 
IPv4 address, and vice versa, using only statically configured information. It defines a
well-known prefix for use in algorithmic translations, while allowing
organizations to also use network-specific prefixes when appropriate. 
Algorithmic translation is used in IPv4/IPv6 translators, as well
as other types of proxies and gateways (e.g., for DNS) used in IPv4/IPv6 scenarios.
        
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on July 19, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Applicability Scope<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.</a>&nbsp;
Conventions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">1.3.</a>&nbsp;
Terminology<br />
<a href="#addressFormat">2.</a>&nbsp;
IPv4-Embedded IPv6 Address Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#algorithm">2.1.</a>&nbsp;
Address Translation Algorithms<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#textRep">2.2.</a>&nbsp;
Text Representation<br />
<a href="#choices">3.</a>&nbsp;
Deployment Guidelines and Choices<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#wpfUsage">3.1.</a>&nbsp;
Restrictions on the use of the Well-Known Prefix<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#routing">3.2.</a>&nbsp;
Impact on Inter-Domain Routing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stateless">3.3.</a>&nbsp;
Choice of Prefix for Stateless Translation Deployments<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stateful">3.4.</a>&nbsp;
Choice of Prefix for Stateful Translation Deployments<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#suffixDiscuss">3.5.</a>&nbsp;
Choice of Suffix<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#wpfDiscuss">3.6.</a>&nbsp;
Choice of the Well-Known Prefix<br />
<a href="#security">4.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.1.</a>&nbsp;
Protection Against Spoofing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.2.</a>&nbsp;
Secure Configuration<br />
<a href="#iana">5.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor7">6.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor8">7.</a>&nbsp;
Contributors<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> 
This document is part of a series of IPv4/IPv6 translation
documents.  A framework for IPv4/IPv6 translation is discussed in
<a class='info' href='#I-D.ietf-behave-v6v4-framework'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;framework]<span> (</span><span class='info'>Baker, F., Li, X., Bao, C., and K. Yin, &ldquo;Framework for IPv4/IPv6 Translation,&rdquo; October&nbsp;2009.</span><span>)</span></a>, including
a taxonomy of scenarios that will be used in this document.
Other documents specify the behavior of various types
of translators and gateways, including mechanisms for translating
between IP headers and other types of messages that include
IP addresses.  This document specifies how an individual
IPv6 address is translated to a corresponding IPv4 address,
and vice versa, in cases where an algorithmic mapping is
used.  While specific types of devices are used herein as examples,
it is the responsibility of the specification of such devices
to reference this document for algorithmic mapping of the addresses
themselves.

</p>
<p>
This document reserves a "Well-Known Prefix" for 
use in an algorithmic mapping. The value of this IPv6 prefix 
is:

</p>
<blockquote class="text">
<p>
</p>
<p>
64:FF9B::/96

</p>
</blockquote>
<p>
<a class='info' href='#addressFormat'>Section&nbsp;2<span> (</span><span class='info'>IPv4-Embedded IPv6 Address Format</span><span>)</span></a> describes the format of "IPv4-Embedded IPv6 addresses", 
i.e., IPv6 addresses in which 32 bits contain an IPv4 address. This format is common to both 
"IPv4-Converted" and "IPv4-Translatable" IPv6 addresses. This section also defines the algorithms
for translating addresses, and the text representation of IPv4-Embedded IPv6 addresses.

</p>
<p>
<a class='info' href='#choices'>Section&nbsp;3<span> (</span><span class='info'>Deployment Guidelines and Choices</span><span>)</span></a> discusses the choice of prefixes, the conditions of use of the Well-Known Prefix
and Network-Specific Prefixes,  
and the use of IPv4-Embedded IPv6 addresses with stateless and stateful translation.

</p>
<p>
<a class='info' href='#security'>Section&nbsp;4<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> discusses security concerns.

</p>
<p>
In some scenarios, a dual-stack host will unnecessarily
send its traffic through an IPv6/IPv4 translator.  This can
be caused by host's default address selection algorithm
<a class='info' href='#RFC3484'>[RFC3484]<span> (</span><span class='info'>Draves, R., &ldquo;Default Address Selection for Internet Protocol version 6 (IPv6),&rdquo; February&nbsp;2003.</span><span>)</span></a>, referrals, or other reasons.  Optimizing these
scenarios for dual-stack hosts is for future study.

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Applicability Scope</h3>

<p>
This document is part of a series defining address translation services. We understand that 
the address format could also be used by other interconnection methods between IPv6 and IPv4,
e.g., methods based on encapsulation. If encapsulation methods are developed by the IETF,
we expect that their descriptions will document their specific use of IPv4-Embedded
IPv6 addresses.

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Conventions</h3>

<p>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in RFC 2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Terminology</h3>

<p>
This document makes use of the following terms:

</p>
<blockquote class="text"><dl>
<dt></dt>
<dd>
</dd>
<dt>IPv4/IPv6 translator:</dt>
<dd> an entity that 
translates IPv4 packets to IPv6 packets, and vice versa.  It
may do "stateless" translation, meaning that there is no per-flow
state required, or "stateful" translation where per-flow state
is created when the first packet in a flow is received.

</dd>
<dt>Address translator:</dt>
<dd> any entity that has
to derive an IPv4 address from an IPv6 address or vice versa.
This applies not only to devices that do IPv4/IPv6 packet 
translation, but also to other entities that manipulate addresses, 
such as name resolution proxies (e.g. 
DNS64 <a class='info' href='#I-D.ietf-behave-dns64'>[I&#8209;D.ietf&#8209;behave&#8209;dns64]<span> (</span><span class='info'>Bagnulo, M., Sullivan, A., Matthews, P., and I. Beijnum, &ldquo;DNS64: DNS extensions for Network Address Translation from IPv6 Clients to IPv4 Servers,&rdquo; December&nbsp;2009.</span><span>)</span></a>) and possibly 
other types of Application Layer Gateways (ALGs).

</dd>
<dt>Well-Known Prefix:</dt>
<dd> the IPv6 prefix defined in this 
document for use in an algorithmic mapping.

</dd>
<dt>Network-Specific Prefix:</dt>
<dd> an IPv6 prefix assigned by an
organization for use in algorithmic mapping. Options for the Network Specific Prefix
are discussed in <a class='info' href='#stateless'>Section&nbsp;3.3<span> (</span><span class='info'>Choice of Prefix for Stateless Translation Deployments</span><span>)</span></a> and <a class='info' href='#stateful'>Section&nbsp;3.4<span> (</span><span class='info'>Choice of Prefix for Stateful Translation Deployments</span><span>)</span></a>.

</dd>
<dt>IPv4-Embedded IPv6 addresses:</dt>
<dd> IPv6 addresses in which 32 bits contain an
IPv4 address. Their format is described in <a class='info' href='#addressFormat'>Section&nbsp;2<span> (</span><span class='info'>IPv4-Embedded IPv6 Address Format</span><span>)</span></a>.

</dd>
<dt>IPv4-Converted IPv6 addresses:</dt>
<dd> IPv6 addresses used to
represent IPv4 nodes in an IPv6 network. They are a variant of IPv4-Embedded IPv6 addresses, 
and follow the format described in <a class='info' href='#addressFormat'>Section&nbsp;2<span> (</span><span class='info'>IPv4-Embedded IPv6 Address Format</span><span>)</span></a>.

</dd>
<dt>IPv4-Translatable IPv6 addresses:</dt>
<dd> IPv6 addresses assigned to IPv6 
nodes for use with stateless
translation. They are a variant of IPv4-Embedded IPv6 addresses, and follow the format 
described in <a class='info' href='#addressFormat'>Section&nbsp;2<span> (</span><span class='info'>IPv4-Embedded IPv6 Address Format</span><span>)</span></a>.

</dd>
</dl></blockquote>
<a name="addressFormat"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
IPv4-Embedded IPv6 Address Format</h3>

<p>
IPv4-Converted IPv6 addresses and IPv4-Translatable IPv6 addresses follow the
same format, described here as the IPv4-Embedded IPv6 address Format.
IPv4-Embedded IPv6 addresses are composed of a variable length prefix, the 
embedded IPv4 address, and a variable length suffix, as presented in the 
following diagram, in which PL designates the prefix length:
</p><br /><hr class="insert" />
<a name="addressFigure"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   +--+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |PL| 0-------------32--40--48--56--64--72--80--88--96--104-112-120-|
   +--+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |32|     prefix    |v4(32)         | u | suffix                    |
   +--+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |40|     prefix        |v4(24)     | u |(8)| suffix                |
   +--+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |48|     prefix            |v4(16) | u | (16)  | suffix            |
   +--+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |56|     prefix                |(8)| u |  v4(24)   | suffix        |
   +--+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |64|     prefix                    | u |   v4(32)      | suffix    |
   +--+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |96|     prefix                                    |    v4(32)     |
   +--+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In these addresses, the prefix shall be either the "Well-Known Prefix", 
or a "Network-Specific Prefix" unique to the organization deploying the 
address translators. (The Well-Known prefic is 96 bits long, and can only 
be used in the last form of the table.)

</p>
<p>
Various deployments justify different prefix lengths with Network-Specific 
prefixes. The tradeoff between 
different prefix lengths are discussed in <a class='info' href='#stateless'>Section&nbsp;3.3<span> (</span><span class='info'>Choice of Prefix for Stateless Translation Deployments</span><span>)</span></a> and 
<a class='info' href='#stateful'>Section&nbsp;3.4<span> (</span><span class='info'>Choice of Prefix for Stateful Translation Deployments</span><span>)</span></a>. 

</p>
<p>
Bits 64 to 71 of the address are reserved for compatibility with the host identifier 
format defined in the IPv6 addressing architecture <a class='info' href='#RFC4291'>[RFC4291]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;IP Version 6 Addressing Architecture,&rdquo; February&nbsp;2006.</span><span>)</span></a>. 
These bits MUST be set to zero. When using a /96 Network-Specific Prefix, 
the administrators MUST ensure that the bits 64 to 71 are set to zero. 
A simple way to achieve that is to construct the /96 Network-Specific Prefix by 
picking a /64 prefix, and then adding four octets set to zero.

</p>
<p>
The IPv4 address is encoded following the prefix, most significant bits first. 
Depending of the prefix length, the 4 octets of the address may be separated by the 
reserved octet "u", whose 8 bits MUST be set to zero. In particular:
</p>
<ul class="text">
<li>When the prefix is 32 bits long, the IPv4 address is encoded in positions 32 to 63.
</li>
<li>When the prefix is 40 bits long, 24 bits of the IPv4 address are encoded 
in positions 40 to 63, with the remaining 8 bits in position 72 to 79.
</li>
<li>When the prefix is 48 bits long, 16 bits of the IPv4 address are encoded in positions 
48 to 63, with the remaining 16 bits in position 72 to 87.
</li>
<li>When the prefix is 56 bits long, 8 bits of the IPv4 address are encoded in positions 
56 to 63, with the remaining 24 bits in position 72 to 95.
</li>
<li>When the prefix is 64 bits long, the IPv4 address is encoded in positions 72 to 103.
</li>
<li>When the prefix is 96 bits long, the IPv4 address is encoded in positions 96 to 127.
</li>
</ul>
<p>
There are no remaining bits, and thus no suffix, if the prefix is 96 bits long. 
In the other cases, the remaining bits of the address constitute the suffix. 
These bits are reserved for future extensions, and SHOULD be set to zero.

</p>
<a name="algorithm"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Address Translation Algorithms</h3>

<p>
IPv4-Embedded IPv6 addresses are composed according to the following algorithm:

</p>
<ul class="text">
<li>
Concatenate the prefix, the 32 bits of the IPv4 address and the null suffix 
if needed to obtain a 128 bit address.

</li>
<li>
If the prefix length is less than 96 bits, remove the last octet and insert the null octet "u" 
at the appropriate position, as documented in <a class='info' href='#addressFigure'>Figure&nbsp;1</a>.

</li>
</ul>
<p>
The IPv4 addresses are extracted from the IPv4-Embedded IPv6 addresses 
according to the following algorithm:

</p>
<ul class="text">
<li>
If the prefix is 96 bit long, extract the last 32 bits of the IPv6 address;

</li>
<li>
for the other prefix lengths, extract the "u" octet to obtain a 120 bit sequence, 
then extract the 32 bits following the prefix.

</li>
</ul>
<a name="textRep"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Text Representation</h3>

<p>
IPv4-Embedded IPv6 addresses will be represented in text in conformity with 
section 2.2 of <a class='info' href='#RFC4291'>[RFC4291]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;IP Version 6 Addressing Architecture,&rdquo; February&nbsp;2006.</span><span>)</span></a>. IPv4-Embedded IPv6 addresses constructed 
using the Well-Known 
Prefix or a /96 Network-Specific Prefix may be represented using the alternative form presented in  
section 2.2 of <a class='info' href='#RFC4291'>[RFC4291]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;IP Version 6 Addressing Architecture,&rdquo; February&nbsp;2006.</span><span>)</span></a>, with the embedded IPv4 address represented in
dotted decimal notation. Examples of such representations are presented in
<a class='info' href='#textTable'>Table&nbsp;1<span> (</span><span class='info'>Text representation of IPv4-Embedded IPv6 addresses using Network-Specific Prefixes </span><span>)</span></a> and <a class='info' href='#textTableWkp'>Table&nbsp;2<span> (</span><span class='info'>Text representation of IPv4-Embedded IPv6 addresses using the Well-Known Prefix</span><span>)</span></a>.

</p><br /><hr class="insert" />
<a name="textTable"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="center"><col align="left">
<tr><th align="left">Network-Specific Prefix</th><th align="center">IPv4 address</th><th align="left">IPv4-Embedded IPv6 address</th></tr>
<tr>
<td align="left">2001:DB8::/32</td>
<td align="center">192.0.2.33</td>
<td align="left">2001:DB8:C000:221::</td>
</tr>
<tr>
<td align="left">2001:DB8:100::/40</td>
<td align="center">192.0.2.33</td>
<td align="left">2001:DB8:1C0:2:21::</td>
</tr>
<tr>
<td align="left">2001:DB8:122::/48</td>
<td align="center">192.0.2.33</td>
<td align="left">2001:DB8:122:C000:2:2100::</td>
</tr>
<tr>
<td align="left">2001:DB8:122:300::/56</td>
<td align="center">192.0.2.33</td>
<td align="left">2001:DB8:122:3C0:0:221::</td>
</tr>
<tr>
<td align="left">2001:DB8:122:344::/64</td>
<td align="center">192.0.2.33</td>
<td align="left">2001:DB8:122:344:C0:2:2100::</td>
</tr>
<tr>
<td align="left">2001:DB8:122:344::/96</td>
<td align="center">192.0.2.33</td>
<td align="left">2001:DB8:122:344::192.0.2.33</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 1: Text representation of IPv4-Embedded IPv6 addresses using Network-Specific Prefixes &nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="textTableWkp"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="center"><col align="left">
<tr><th align="left">Well Known Prefix</th><th align="center">IPv4 address</th><th align="left">IPv4-Embedded IPv6 address</th></tr>
<tr>
<td align="left">64:FF9B::/96</td>
<td align="center">192.0.2.33</td>
<td align="left">64:FF9B::192.0.2.33</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 2: Text representation of IPv4-Embedded IPv6 addresses using the Well-Known Prefix&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
The Network-Specific Prefix examples in 
<a class='info' href='#textTable'>Table&nbsp;1<span> (</span><span class='info'>Text representation of IPv4-Embedded IPv6 addresses using Network-Specific Prefixes </span><span>)</span></a> are derived from the 
IPv6 prefix reserved for documentation in <a class='info' href='#RFC3849'>[RFC3849]<span> (</span><span class='info'>Huston, G., Lord, A., and P. Smith, &ldquo;IPv6 Address Prefix Reserved for Documentation,&rdquo; July&nbsp;2004.</span><span>)</span></a>. 
The IPv4 address 192.0.2.33 is part of the subnet 192.0.2.0/24 reserved for documentation in <a class='info' href='#RFC3330'>[RFC3330]<span> (</span><span class='info'>IANA, &ldquo;Special-Use IPv4 Addresses,&rdquo; September&nbsp;2002.</span><span>)</span></a>. 

</p>
<a name="choices"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Deployment Guidelines and Choices</h3>

<a name="wpfUsage"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Restrictions on the use of the Well-Known Prefix</h3>

<p>
The Well-Known Prefix MAY be used by organizations deploying translation services,
as explained in <a class='info' href='#stateful'>Section&nbsp;3.4<span> (</span><span class='info'>Choice of Prefix for Stateful Translation Deployments</span><span>)</span></a>.

</p>
<p>
The Well-Known Prefix SHOULD NOT be used to construct IPv4-Translatable addresses.
The nodes served by IPv4-Translatable IPv6 
addresses should be able to receive global IPv6 traffic 
bound to their IPv4-Translatable IPv6 address 
without incurring intermediate protocol translation. 
This is only possible if the specific prefix used to build the 
IPv4-Translatable IPv6 addresses 
is advertized in inter-domain routing, but the advertisement of  
more specific prefixes derived from the Well-Known Prefix
is not supported, as explained in <a class='info' href='#routing'>Section&nbsp;3.2<span> (</span><span class='info'>Impact on Inter-Domain Routing</span><span>)</span></a>.
Network-Specific Prefixes SHOULD be used in these scenarios, as explained in
<a class='info' href='#stateless'>Section&nbsp;3.3<span> (</span><span class='info'>Choice of Prefix for Stateless Translation Deployments</span><span>)</span></a>.

</p>
<p>
The Well-Known Prefix MUST NOT be used to represent non global IPv4 addresses, such as 
those defined in <a class='info' href='#RFC1918'>[RFC1918]<span> (</span><span class='info'>Rekhter, Y., Moskowitz, R., Karrenberg, D., Groot, G., and E. Lear, &ldquo;Address Allocation for Private Internets,&rdquo; February&nbsp;1996.</span><span>)</span></a>.
</p>
<a name="routing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Impact on Inter-Domain Routing</h3>

<p>
The Well-Known Prefix MAY appear in inter-domain routing tables, if service 
providers decide to provide IPv6-IPv4 interconnection services to peers. 
Advertisement of the Well-Known Prefix SHOULD be controlled either by upstream 
and/or downstream service providers owing to inter-domain routing policies, e.g., 
through configuration of BGP <a class='info' href='#RFC4271'>[RFC4271]<span> (</span><span class='info'>Rekhter, Y., Li, T., and S. Hares, &ldquo;A Border Gateway Protocol 4 (BGP-4),&rdquo; January&nbsp;2006.</span><span>)</span></a>. Organizations that advertize the 
Well-Known Prefix in 
inter-domain routing MUST be able to provide IPv4/IPv6 translation service.  

</p>
<p>
When the IPv4/IPv6 translation relies on the Well-Known Prefix, 
embedded IPv6 prefixes longer than the Well-Known Prefix MUST NOT be advertised 
in BGP (especially e-BGP) <a class='info' href='#RFC4271'>[RFC4271]<span> (</span><span class='info'>Rekhter, Y., Li, T., and S. Hares, &ldquo;A Border Gateway Protocol 4 (BGP-4),&rdquo; January&nbsp;2006.</span><span>)</span></a> because this leads to importing 
the IPv4 routing table 
into the IPv6 one and therefore induces scalability issues to the global IPv6 
routing table. Administrators of BGP nodes SHOULD configure filters that
discard advertisements of embedded 
IPv6 prefixes longer than the Well-Known Prefix.

</p>
<p>
When the IPv4/IPv6 translation service relies on Network-Specific
Prefixes, the IPv4-Translatable IPv6 prefixes used in stateless translation MUST 
be advertised with proper aggregation to the IPv6 Internet. 
Similarly, if translators are configured with multiple
Network-Specific Prefixes,these prefixes MUST be advertised to the
IPv6 Internet with proper aggregation.

</p>
<a name="stateless"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Choice of Prefix for Stateless Translation Deployments</h3>

<p>
Organizations may deploy translation services using stateless translation. In these 
deployments, internal IPv6 nodes are addressed using IPv4-Translatable IPv6 addresses, 
which enable them to be accessed by IPv4 nodes. The addresses of these external 
nodes are then represented in IPv4-Converted IPv6 addresses.

</p>
<p>
Organizations deploying stateless IPv4/IPv6 translation SHOULD 
assign a Network-Specific Prefix to their IPv4/IPv6 translation service. 
IPv4-Translatable and IPv4-Converted IPv6 addresses
MUST be constructed as specified in <a class='info' href='#addressFormat'>Section&nbsp;2<span> (</span><span class='info'>IPv4-Embedded IPv6 Address Format</span><span>)</span></a>.
IPv4-Translatable IPv6 addresses MUST use the selected Network-Specific Prefix. 
Both types of addresses SHOULD use the same prefix.

</p>
<p>
Using the same prefix ensures that IPv6 nodes internal to the organization
will use the most efficient paths to reach the nodes served by 
IPv4-Translatable IPv6 addresses. Specifically, if a node 
learns the IPv4 address of a target internal node without knowing that this target
is in fact located behind the same translator that the node also uses, translation 
rules will ensure that the
IPv6 address constructed with the Network-Specific prefix is the same as 
the IPv4-Translatable IPv6 address assigned to the target. Standard routing preference
will then ensure that the IPv6 packets are delivered directly, without 
requiring "hair-pinning" at the translator.

</p>
<p>
The intra-domain routing protocol must be able to deliver packets to the nodes served by 
IPv4-Translatable IPv6 addresses. This may require routing on some or all of the embedded 
IPv4 address bits. Security considerations detailed in <a class='info' href='#security'>Section&nbsp;4<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> require 
that routers check the validity of the IPv4-Translatable IPv6 source addresses, using 
some form of reverse path check.

</p>
<p>
The management of stateless address translation 
can be illustrated with a small example. We will consider an IPv6 network
with the prefix 2001:DB8:122::/48. The network administrator has selected the Network-Specific 
prefix 2001:DB8:122:344::/64 for managing stateless IPv4/IPv6 translation. The network
is visible in IPv4 as the subnet 192.0.2.0/24. In this network, the host A is assigned the
IPv4-Translatable IPv6 address 2001:DB8:122:344:C0:2:2100::, which corresponds to the 
IPv4 address 192.0.2.33. Host A's address is configured either manually or through DHCPv6.

</p>
<p>
In this example, host A is not directly connected to the translator, but instead to 
a link managed by a router R. The router R is configured to forward to A the packets 
bound to 2001:DB8:122:344:C0:2:2100::. To receive these packets, R will advertise 
reachability of the prefix 2001:DB8:122:344:C0:2:2100::/104 in the intra-domain 
routing protocol -- or perhaps a shorter prefix if many hosts on link have 
IPv4-Translatable IPv6 addresses derived from the same IPv4 subnet. If a packet bound to 
192.0.2.33 reaches the translator, the destination 
address will be translated to 2001:DB8:122:344:C0:2:2100::, and the packet will be routed
towards R and then to A.

</p>
<p>
Let's suppose now that a host B of the same domain learns the IPv4 address of A, maybe
through an application-specific referral. If B has translation-aware software, 
B can compose a destination address by combining
the Network-Specific Prefix 2001:DB8:122:344::/64 and the IPv4 address 192.0.2.33,
resulting in the address 2001:DB8:122:344:C0:2:2100::. The packet sent by B will
be forwarded towards R, and then to A, avoiding protocol translation.

</p>
<p>
Forwarding, and reverse path checks, should be performed on the combination of the prefix 
and the IPv4 address. In theory, routers should be able to route on prefixes of any length. 
However, routing on prefixes larger than 64 bits may be slower on some routers. 
But routing efficiency is not the only consideration 
in the choice of a prefix length. Organizations also need to consider the availability of 
prefixes, and the potential impact of all-zeroes identifiers.

</p>
<p>
If a /32 prefix is used, all the routing bits are contained in the top 64 bits of the IPv6 
address, leading to excellent routing properties. These prefixes may however be hard to obtain, 
and allocation of a /32 to a small set of 
IPv4-Translatable IPv6 addresses may be seen as wasteful. 
In addition, the /32 prefix and a zero suffix leads to an all-zeroes 
interface identifier, an issue that we discuss in <a class='info' href='#suffixDiscuss'>Section&nbsp;3.5<span> (</span><span class='info'>Choice of Suffix</span><span>)</span></a>.

</p>
<p>
Intermediate prefix lengths such as 
/40, /48 or /56 appear as compromises. Only some of 
the IPv4 bits are part of the /64 prefixes. Reverse path checks, in particular, 
may have a limited efficiency. 
Reverse path checks limited to the most significant bits of the IPv4 address will 
reduce the possibility 
of spoofing external IPv4 address, but would allow IPv6 nodes to spoof 
internal IPv4-Translatable addresses.

</p>
<p>
We propose here a compromise, based on using no more than 1/256th of an 
organization's allocation of IPv6 addresses for the IPv4/IPv6 translation service. 
For example, if the organization is an Internet Service Provider
with an allocated IPv6 prefix /32 or 
shorter, the ISP could dedicate a /40 prefix to the translation service. 
An end site with a /48 allocation could dedicate a /56 prefix to the translation 
service, or possibly a /96 prefix if all IPv4-Translatable IPv6 addresses
are located on the same link. 

</p>
<p>
The recommended prefix length is also a function of the deployment scenario.
The stateless translation can be used for Scenario 1, Scenario 2, Scenario 5,
and Scenario 6 defined in <a class='info' href='#I-D.ietf-behave-v6v4-framework'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;framework]<span> (</span><span class='info'>Baker, F., Li, X., Bao, C., and K. Yin, &ldquo;Framework for IPv4/IPv6 Translation,&rdquo; October&nbsp;2009.</span><span>)</span></a>. 
For different scenarios, the prefix length recommendations are:
</p>
<ul class="text">
<li>  
For scenario 1 (an IPv6 network to the IPv4 Internet) and scenario 2 
(the IPv4 Internet to an IPv6 network), we recommend using a /40 prefix 
for an ISP holding a /32 allocation, and a /56 prefix for
a site holding a /48 allocation.

</li>
<li>
For scenario 5 (an IPv6 network to an IPv4 network) and scenario 6 
(an IPv4 network to an IPv6 network), we recommend using a /64 or a /96 prefix.

</li>
</ul>
<a name="stateful"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Choice of Prefix for Stateful Translation Deployments</h3>

<p>
Organizations may deploy translation services based on stateful 
translation technology. An organization may decide to use either a 
Network-Specific Prefix or the Well-Known Prefix 
for its stateful IPv4/IPv6 translation service.

</p>
<p>
When these services are used, IPv6 nodes are addressed through standard IPv6 
addresses, while IPv4 nodes are represented by IPv4-Converted IPv6 addresses, as 
specified in <a class='info' href='#addressFormat'>Section&nbsp;2<span> (</span><span class='info'>IPv4-Embedded IPv6 Address Format</span><span>)</span></a>.

</p>
<p>
The stateful nature of the translation creates a potential stability issue 
when the organization 
deploys multiple translators. If several translators use the same prefix, 
there is a risk that 
packets belonging to the same connection may be routed to different 
translators as the internal 
routing state changes. This issue can be avoided either by assigning 
different prefixes to 
different translators, or by ensuring that all translators using same 
prefix coordinate their state.

</p>
<p>
Stateful translation can be used in scenarios defined in 
<a class='info' href='#I-D.ietf-behave-v6v4-framework'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;framework]<span> (</span><span class='info'>Baker, F., Li, X., Bao, C., and K. Yin, &ldquo;Framework for IPv4/IPv6 Translation,&rdquo; October&nbsp;2009.</span><span>)</span></a>. The Well Known Prefix SHOULD be used
in these scenarios, with two exceptions:

</p>
<ul class="text">
<li>
In all scenarios, the translation MAY use a Network-Specific Prefix, if deemed 
appropriate for management reasons. 

</li>
<li>
The Well-Known Prefix MUST NOT be used for scenario 3 (the IPv6 Internet to an 
IPv4 network), as this would lead to using the Well-Known Prefix with non-global 
IPv4 addresses. That means a Network-Specific Prefix MUST be used in that scenario,
for example a /96 prefix compatible with the Well-Known prefix format.

</li>
</ul>
<a name="suffixDiscuss"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Choice of Suffix</h3>

<p>
The address format described in <a class='info' href='#addressFormat'>Section&nbsp;2<span> (</span><span class='info'>IPv4-Embedded IPv6 Address Format</span><span>)</span></a> recommends a zero suffix. 
Before making this recommendation,
we considered different options: checksum neutrality; the encoding of a port range; 
and a value different than 0.

</p>
<p>
In the case of stateless translation, there would be no need for the translator
to recompute a one's complement checksum if both the IPv4-Translatable and the 
IPv4-Converted IPv6 addresses were constructed in a "checksum-neutral" manner, that is if the 
IPv6 addresses would have the same one's complement checksum as the embedded IPv4
address. In the case of stateful translation, checksum neutrality does not eliminate checksum 
computation during translation, as only one of the two addresses would be checksum neutral.
We considered reserving 16 bits in the suffix to guarantee checksum neutrality,
but declined because it would not help with stateful translation, and because checksum neutrality 
can also be achieved by an appropriate choice of the Network-Specific Prefix, 
as was done for example with the Well-Known Prefix.

</p>
<p>
There have been proposals to complement stateless translation with a port-range feature. 
Instead of mapping an IPv4 address to exactly one IPv6 prefix, the options would allow 
several IPv6 nodes to share an IPv4 address, with each node managing a different range 
of ports. If a port 
range extension is needed, it could be defined later, using bits currently reserved as null 
in the suffix.

</p>
<p>
When a /32 prefix is used, an all-zero suffix results in an
all-zero interface identifier. 
We understand the conflict with Section 2.6.1 of RFC4291, which specifies 
that all zeroes are used for the subnet-router anycast address. However, 
in our specification, there would be only one node with an IPv4-Translatable 
IPv6 address in 
the /64 subnet, and the anycast semantic would not create confusion. We 
thus decided to keep the null suffix for now. 
This issue does not exist for prefixes larger than 32 bits, such as the /40, 
/56, /64 and /96 prefixes that we recommend in <a class='info' href='#stateless'>Section&nbsp;3.3<span> (</span><span class='info'>Choice of Prefix for Stateless Translation Deployments</span><span>)</span></a>.

</p>
<a name="wpfDiscuss"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6"></a><h3>3.6.&nbsp;
Choice of the Well-Known Prefix</h3>

<p>
Before making our recommendation of the Well-Known Prefix, we were 
faced with three choices: 

</p>
<ul class="text">
<li>
reuse the IPv4-mapped prefix, ::FFFF:0:0/96, as specified in RFC 2765 Section 2.1; 

</li>
<li>
request IANA to allocate a /32 prefix,

</li>
<li>
or request allocation of a new /96 prefix. 

</li>
</ul>
<p>
We weighted the pros and cons of these choices before settling on the recommended 
/96 Well-Known Prefix.

</p>
<p>
The main advantage of the existing IPv4-mapped prefix is that it is already defined.
Reusing that prefix would require minimal standardization efforts. However, being 
already defined is not just an advantage, as there may be side effects of current 
implementations. When presented with the IPv4-mapped prefix, current versions of
Windows and MacOS generate IPv4 packets, but will not send IPv6 packets. If 
we used the IPv4-mapped prefix, these nodes would not be able to support translation
without modification. This will defeat the main purpose of the translation techniques.
We thus eliminated the first choice, and decided to not reuse 
the IPv4-mapped prefix, ::FFFF:0:0/96.

</p>
<p>
A /32 prefix would have allowed the embedded 
IPv4 address to fit within the top 64 bits of the IPv6 address. This would have
facilitated routing and load balancing when an organization deploys several 
translators. However, such destination-address based load balancing may not 
be desirable. It is not compatible with STUN in the deployments involving 
multiple stateful translators, each one having a different pool of IPv4 addresses. 
STUN compatibility would only be achieved if the translators managed the same pool 
of IPv4 addresses and were able to coordinate their translation state, in which
case there is no big advantage to using a /32 prefix rather than a /96 prefix.

</p>
<p> 
According to Section 2.2 of <a class='info' href='#RFC4291'>[RFC4291]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;IP Version 6 Addressing Architecture,&rdquo; February&nbsp;2006.</span><span>)</span></a>, in the legal 
textual representations of IPv6 addresses, dotted 
decimal can only appear at the end. The /96 prefix is compatible with that
requirement. It enables the dotted 
decimal notation without requiring an update to <a class='info' href='#RFC4291'>[RFC4291]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;IP Version 6 Addressing Architecture,&rdquo; February&nbsp;2006.</span><span>)</span></a>. This 
representation makes the address format easier to use, and log files easier to read.

</p>
<p> 
The prefix that we recommend has the particularity of being "checksum neutral". 
The sum of the hexadecimal numbers "0064" and "FF9B" is "FFFF", i.e. a value equal
to zero in one's complement arithmetic. An IPv4-Embedded IPv6 address constructed with this
prefix will have the same one's complement checksum as the embedded IPv4 address. 

</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security Considerations</h3>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Protection Against Spoofing</h3>

<p>
By and large, IPv4/IPv6 translators can be modeled as special routers, are subject to the same risks, 
and can implement the same mitigations. There is however a particular risk that directly derives 
from the practice of embedding IPv4 addresses in IPv6: address spoofing.

</p>
<p>
An attacker could use an IPv4-Embedded IPv6 address as the source address of malicious packets. 
After translation, the packets will appear as IPv4 packets from the specified source, and 
the attacker may be hard to track. If left without mitigation, the attack would allow 
malicious IPv6 nodes to spoof arbitrary IPv4 addresses.

</p>
<p>
The mitigation is to implement reverse path checks, and to verify throughout the network 
that packets are coming from an authorized location. 

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Secure Configuration</h3>

<p> The prefixes and formats need to be the configured consistently among 
        multiple devices
        in the same network (e.g., nodes that need to prefer native
        over translated addresses, DNS gateways, and IPv4/IPv6 translators).
        As such, the means by which they are learned/configured MUST be
        secure.  Specifying a default prefix and/or format in implementations
        provides one way to configure them securely.  Any alternative means
        of configuration is responsible for specifying how to do so securely.
    
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>
The Well Known Prefix falls into the range ::/8 
reserved by the IETF. The prefix definition does not require an IANA action.

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Acknowledgements</h3>

<p> Many people in the Behave WG have contributed to the discussion
        that led to this document, including Andrew Sullivan,
        Andrew Yourtchenko, Brian Carpenter, Dan Wing, Ed
        Jankiewicz, Fred Baker, Hiroshi Miyata, Iljitsch van Beijnum, John
        Schnizlein, Keith Moore, Kevin Yin, Magnus Westerlund, 
        Margaret Wasserman, Masahito Endo, Phil Roberts,
        Philip Matthews, Remi Denis-Courmont, Remi Despres and William Waites.
    
</p>
<p>
   Marcelo Bagnulo is partly funded by
   Trilogy, a research project supported by the European Commission
   under its Seventh Framework Program.

</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Contributors</h3>

<p> The following individuals co-authored drafts from which text has been
        incorporated, and are listed in alphabetical order.
    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    Congxiao Bao
    CERNET Center/Tsinghua University
    Room 225, Main Building, Tsinghua University
    Beijing,   100084
    China
    Phone: +86 62785983
    Email: congxiao@cernet.edu.cn

    Dave Thaler
    Microsoft Corporation
    One Microsoft Way
    Redmond, WA  98052
    USA
    Phone: +1 425 703 8835
    Email: dthaler@microsoft.com

    Fred Baker
    Cisco Systems
    Santa Barbara, California  93117
    USA
    Phone: +1-408-526-4257
    Fax:   +1-413-473-2403
    Email: fred@cisco.com

    Hiroshi Miyata
    Yokogawa Electric Corporation
    2-9-32 Nakacho
    Musashino-shi, Tokyo  180-8750
    JAPAN
    Email: h.miyata@jp.yokogawa.com

    Marcelo Bagnulo
    Universidad Carlos III de Madrid
    Av. Universidad 30
    Leganes, Madrid  28911
    ESPANA
    Email: marcelo@it.uc3m.es

    Xing Li
    CERNET Center/Tsinghua University
    Room 225, Main Building, Tsinghua University
    Beijing,   100084
    China
    Phone: +86 62785983
    Email: xing@cernet.edu.cn

</pre></div>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4291">[RFC4291]</a></td>
<td class="author-text">Hinden, R. and S. Deering, &ldquo;<a href="http://tools.ietf.org/html/rfc4291">IP Version 6 Addressing Architecture</a>,&rdquo; RFC&nbsp;4291, February&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4291.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-dns64">[I-D.ietf-behave-dns64]</a></td>
<td class="author-text">Bagnulo, M., Sullivan, A., Matthews, P., and I. Beijnum, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-dns64-04.txt">DNS64: DNS extensions for Network Address Translation from IPv6 Clients to IPv4 Servers</a>,&rdquo; draft-ietf-behave-dns64-04 (work in progress), December&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-dns64-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-v6v4-framework">[I-D.ietf-behave-v6v4-framework]</a></td>
<td class="author-text">Baker, F., Li, X., Bao, C., and K. Yin, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-framework-03.txt">Framework for IPv4/IPv6 Translation</a>,&rdquo; draft-ietf-behave-v6v4-framework-03 (work in progress), October&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-framework-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1918">[RFC1918]</a></td>
<td class="author-text"><a href="mailto:yakov@cisco.com">Rekhter, Y.</a>, <a href="mailto:rgm3@is.chrysler.com">Moskowitz, R.</a>, <a href="mailto:Daniel.Karrenberg@ripe.net">Karrenberg, D.</a>, <a href="mailto:GeertJan.deGroot@ripe.net">Groot, G.</a>, and <a href="mailto:lear@sgi.com">E. Lear</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1918">Address Allocation for Private Internets</a>,&rdquo; BCP&nbsp;5, RFC&nbsp;1918, February&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc1918.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3330">[RFC3330]</a></td>
<td class="author-text">IANA, &ldquo;<a href="http://tools.ietf.org/html/rfc3330">Special-Use IPv4 Addresses</a>,&rdquo; RFC&nbsp;3330, September&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3330.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3484">[RFC3484]</a></td>
<td class="author-text">Draves, R., &ldquo;<a href="http://tools.ietf.org/html/rfc3484">Default Address Selection for Internet Protocol version 6 (IPv6)</a>,&rdquo; RFC&nbsp;3484, February&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3484.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3849">[RFC3849]</a></td>
<td class="author-text">Huston, G., Lord, A., and P. Smith, &ldquo;<a href="http://tools.ietf.org/html/rfc3849">IPv6 Address Prefix Reserved for Documentation</a>,&rdquo; RFC&nbsp;3849, July&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3849.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4271">[RFC4271]</a></td>
<td class="author-text">Rekhter, Y., Li, T., and S. Hares, &ldquo;<a href="http://tools.ietf.org/html/rfc4271">A Border Gateway Protocol 4 (BGP-4)</a>,&rdquo; RFC&nbsp;4271, January&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4271.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Christian Huitema</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Microsoft Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">One Microsoft Way</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Redmond, WA  98052-6399</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">U.S.A.</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:huitema@microsoft.com">huitema@microsoft.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Congxiao Bao</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">CERNET Center/Tsinghua University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Room 225, Main Building, Tsinghua University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing,   100084</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86 10-62785983</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:congxiao@cernet.edu.cn">congxiao@cernet.edu.cn</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Marcelo Bagnulo</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UC3M</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Av. Universidad 30</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Leganes, Madrid  28911</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Spain</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+34-91-6249500</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:marcelo@it.uc3m.es">marcelo@it.uc3m.es</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.it.uc3m.es/marcelo">http://www.it.uc3m.es/marcelo</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mohamed Boucadair</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France Telecom</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">3, Av Francois Chateaux</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rennes  350000</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mohamed.boucadair@orange-ftgroup.com">mohamed.boucadair@orange-ftgroup.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Xing Li</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">CERNET Center/Tsinghua University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Room 225, Main Building, Tsinghua University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing,   100084</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86 10-62785983</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:xing@cernet.edu.cn">xing@cernet.edu.cn</a></td></tr>
</table>
</body></html>
