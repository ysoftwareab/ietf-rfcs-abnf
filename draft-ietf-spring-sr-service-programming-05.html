<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Service Programming with Segment Routing</title>
<meta content="Francois Clad" name="author">
<meta content="Xiaohu Xu" name="author">
<meta content="Clarence Filsfils" name="author">
<meta content="Daniel Bernier" name="author">
<meta content="Cheng Li" name="author">
<meta content="Bruno Decraene" name="author">
<meta content="Shaowen Ma" name="author">
<meta content="Chaitanya Yadlapalli" name="author">
<meta content="Wim Henderickx" name="author">
<meta content="Stefano Salsano" name="author">
<meta content="
       This document defines data plane functionality required to implement service segments and achieve service programming in SR-enabled MPLS and IPv6 networks, as described in the Segment Routing architecture. 
    " name="description">
<meta content="xml2rfc 3.9.1" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-spring-sr-service-programming-05" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.9.1
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.2
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 58.0.2
    six 1.16.0
-->
<link href="/tmp/draft-ietf-spring-sr-service-programming-05-0zfeoyu7.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Service Programming with Segment Routing</td>
<td class="right">September 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Clad, et al.</td>
<td class="center">Expires 14 March 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">SPRING</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-spring-sr-service-programming-05</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-09-10" class="published">10 September 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-03-14">14 March 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">F. Clad, <span class="editor">Ed.</span>
</div>
<div class="org">Cisco Systems, Inc.</div>
</div>
<div class="author">
      <div class="author-name">X. Xu, <span class="editor">Ed.</span>
</div>
<div class="org">Alibaba</div>
</div>
<div class="author">
      <div class="author-name">C. Filsfils</div>
<div class="org">Cisco Systems, Inc.</div>
</div>
<div class="author">
      <div class="author-name">D. Bernier</div>
<div class="org">Bell Canada</div>
</div>
<div class="author">
      <div class="author-name">C. Li</div>
<div class="org">Huawei</div>
</div>
<div class="author">
      <div class="author-name">B. Decraene</div>
<div class="org">Orange</div>
</div>
<div class="author">
      <div class="author-name">S. Ma</div>
<div class="org">Mellanox</div>
</div>
<div class="author">
      <div class="author-name">C. Yadlapalli</div>
<div class="org">AT&amp;T</div>
</div>
<div class="author">
      <div class="author-name">W. Henderickx</div>
<div class="org">Nokia</div>
</div>
<div class="author">
      <div class="author-name">S. Salsano</div>
<div class="org">Universita di Roma "Tor Vergata"</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Service Programming with Segment Routing</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document defines data plane functionality required to implement service segments and achieve service programming in SR-enabled MPLS and IPv6 networks, as described in the Segment Routing architecture.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 14 March 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="ulEmpty toc ulBare compact">
<li class="ulEmpty toc ulBare compact" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="xref">3</a>.  <a href="#name-classification-and-steering" class="xref">Classification and Steering</a></p>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-service-segments" class="xref">Service Segments</a></p>
<ul class="ulEmpty toc compact ulBare">
<li class="ulEmpty toc compact ulBare" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-sr-aware-services" class="xref">SR-Aware Services</a></p>
</li>
              <li class="ulEmpty toc compact ulBare" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-sr-unaware-services" class="xref">SR-Unaware Services</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-sr-service-policies" class="xref">SR Service Policies</a></p>
<ul class="ulEmpty toc compact ulBare">
<li class="ulEmpty toc compact ulBare" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-sr-mpls-data-plane" class="xref">SR-MPLS Data Plane</a></p>
</li>
              <li class="ulEmpty toc compact ulBare" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-srv6-data-plane" class="xref">SRv6 Data Plane</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-sr-proxy-behaviors" class="xref">SR Proxy Behaviors</a></p>
<ul class="ulEmpty toc compact ulBare">
<li class="ulEmpty toc compact ulBare" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-static-sr-proxy" class="xref">Static SR Proxy</a></p>
<ul class="ulEmpty toc compact ulBare">
<li class="ulEmpty toc compact ulBare" id="section-toc.1-1.6.2.1.2.1">
                    <p id="section-toc.1-1.6.2.1.2.1.1"><a href="#section-6.1.1" class="xref">6.1.1</a>.  <a href="#name-sr-mpls-pseudocode" class="xref">SR-MPLS Pseudocode</a></p>
</li>
                  <li class="ulEmpty toc compact ulBare" id="section-toc.1-1.6.2.1.2.2">
                    <p id="section-toc.1-1.6.2.1.2.2.1"><a href="#section-6.1.2" class="xref">6.1.2</a>.  <a href="#name-srv6-pseudocode" class="xref">SRv6 Pseudocode</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty toc compact ulBare" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-dynamic-sr-proxy" class="xref">Dynamic SR Proxy</a></p>
<ul class="ulEmpty toc compact ulBare">
<li class="ulEmpty toc compact ulBare" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="xref">6.2.1</a>.  <a href="#name-sr-mpls-pseudocode-2" class="xref">SR-MPLS Pseudocode</a></p>
</li>
                  <li class="ulEmpty toc compact ulBare" id="section-toc.1-1.6.2.2.2.2">
                    <p id="section-toc.1-1.6.2.2.2.2.1"><a href="#section-6.2.2" class="xref">6.2.2</a>.  <a href="#name-srv6-pseudocode-2" class="xref">SRv6 Pseudocode</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty toc compact ulBare" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-shared-memory-sr-proxy" class="xref">Shared Memory SR Proxy</a></p>
</li>
              <li class="ulEmpty toc compact ulBare" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-masquerading-sr-proxy" class="xref">Masquerading SR Proxy</a></p>
<ul class="ulEmpty toc compact ulBare">
<li class="ulEmpty toc compact ulBare" id="section-toc.1-1.6.2.4.2.1">
                    <p id="section-toc.1-1.6.2.4.2.1.1"><a href="#section-6.4.1" class="xref">6.4.1</a>.  <a href="#name-srv6-masquerading-proxy-pse" class="xref">SRv6 Masquerading Proxy Pseudocode</a></p>
</li>
                  <li class="ulEmpty toc compact ulBare" id="section-toc.1-1.6.2.4.2.2">
                    <p id="section-toc.1-1.6.2.4.2.2.1"><a href="#section-6.4.2" class="xref">6.4.2</a>.  <a href="#name-destination-nat-flavor" class="xref">Destination NAT Flavor</a></p>
</li>
                  <li class="ulEmpty toc compact ulBare" id="section-toc.1-1.6.2.4.2.3">
                    <p id="section-toc.1-1.6.2.4.2.3.1"><a href="#section-6.4.3" class="xref">6.4.3</a>.  <a href="#name-caching-flavor" class="xref">Caching Flavor</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-metadata" class="xref">Metadata</a></p>
<ul class="ulEmpty toc compact ulBare">
<li class="ulEmpty toc compact ulBare" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-mpls-data-plane" class="xref">MPLS Data Plane</a></p>
</li>
              <li class="ulEmpty toc compact ulBare" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-ipv6-data-plane" class="xref">IPv6 Data Plane</a></p>
<ul class="ulEmpty toc compact ulBare">
<li class="ulEmpty toc compact ulBare" id="section-toc.1-1.7.2.2.2.1">
                    <p id="section-toc.1-1.7.2.2.2.1.1"><a href="#section-7.2.1" class="xref">7.2.1</a>.  <a href="#name-srh-tlv-objects" class="xref">SRH TLV Objects</a></p>
</li>
                  <li class="ulEmpty toc compact ulBare" id="section-toc.1-1.7.2.2.2.2">
                    <p id="section-toc.1-1.7.2.2.2.2.1"><a href="#section-7.2.2" class="xref">7.2.2</a>.  <a href="#name-srh-tag" class="xref">SRH Tag</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-implementation-status" class="xref">Implementation Status</a></p>
<ul class="ulEmpty toc compact ulBare">
<li class="ulEmpty toc compact ulBare" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-sr-aware-services-2" class="xref">SR-Aware Services</a></p>
</li>
              <li class="ulEmpty toc compact ulBare" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-proxy-behaviors" class="xref">Proxy Behaviors</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-related-works" class="xref">Related Works</a></p>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
<ul class="ulEmpty toc compact ulBare">
<li class="ulEmpty toc compact ulBare" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-srv6-endpoint-behaviors" class="xref">SRv6 Endpoint Behaviors</a></p>
</li>
              <li class="ulEmpty toc compact ulBare" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-segment-routing-header-tlvs" class="xref">Segment Routing Header TLVs</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-acknowledgements" class="xref">Acknowledgements</a></p>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="xref">13</a>. <a href="#name-contributors" class="xref">Contributors</a></p>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="xref">14</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="ulEmpty toc compact ulBare">
<li class="ulEmpty toc compact ulBare" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#section-14.1" class="xref">14.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="ulEmpty toc compact ulBare" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#section-14.2" class="xref">14.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Segment Routing (SR) <span>[<a href="#RFC8402" class="xref">RFC8402</a>]</span> is an architecture based on the source routing paradigm that seeks the right balance between distributed intelligence and centralized programmability.  SR can be used with an MPLS or an IPv6 data plane to steer packets through an ordered list of instructions, called segments.  These segments may encode simple routing instructions for forwarding packets along a specific network path, but also steer them through Virtual Network Functions (VNFs) or physical service appliances available in the network.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">In an SR network, each of these services, running either on a physical appliance or in a virtual environment, are associated with a segment identifier (SID). These service SIDs are then leveraged as part of a SID-list to steer packets through the corresponding services.  Service SIDs may be combined together in a SID-list to achieve service programming, but also with other types of segments as defined in <span>[<a href="#RFC8402" class="xref">RFC8402</a>]</span>.  SR thus provides a fully integrated solution for overlay, underlay and service programming. Furthermore, the IPv6 instantiation of SR (SRv6) <span>[<a href="#RFC8986" class="xref">RFC8986</a>]</span> supports metadata transportation in the Segment Routing Header <span>[<a href="#RFC8754" class="xref">RFC8754</a>]</span>, either natively in the tag field or with extensions such as TLVs.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This document describes how a service can be associated with a SID, including legacy services with no SR capabilities, and how these service SIDs are integrated within an SR policy. The definition of an SR Policy and the traffic steering mechanisms are covered in <span>[<a href="#I-D.ietf-spring-segment-routing-policy" class="xref">I-D.ietf-spring-segment-routing-policy</a>]</span> and hence outside the scope of this document.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">The definition of control plane components, such as service segment discovery, is outside the scope of this data plane document.  For reference, the option of using BGP extensions to support SR service programming is proposed in <span>[<a href="#I-D.dawra-idr-bgp-sr-service-chaining" class="xref">I-D.dawra-idr-bgp-sr-service-chaining</a>]</span>.<a href="#section-1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-2">
      <h2 id="name-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-2-1">This document leverages the terminology proposed in <span>[<a href="#RFC8402" class="xref">RFC8402</a>]</span>, <span>[<a href="#RFC8660" class="xref">RFC8660</a>]</span>, <span>[<a href="#RFC8754" class="xref">RFC8754</a>]</span>, <span>[<a href="#RFC8986" class="xref">RFC8986</a>]</span> and <span>[<a href="#I-D.ietf-spring-segment-routing-policy" class="xref">I-D.ietf-spring-segment-routing-policy</a>]</span>.  It also introduces the following new terms.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Service segment: A segment associated with a service. The service may either run on a physical appliance or in a virtual environment such as a virtual machine or container.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">SR-aware service: A service that is fully capable of processing SR traffic. An SR-aware service can be directly associated with a service segment.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">SR-unaware service: A service that is unable to process SR traffic or may behave incorrectly due to presence of SR information in the packet headers. An SR-unaware service can be associated with a service segment through an SR proxy function.<a href="#section-2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="classification-and-steering">
<section id="section-3">
      <h2 id="name-classification-and-steering">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-classification-and-steering" class="section-name selfRef">Classification and Steering</a>
      </h2>
<p id="section-3-1">Classification and steering mechanisms are defined in section 8 of <span>[<a href="#I-D.ietf-spring-segment-routing-policy" class="xref">I-D.ietf-spring-segment-routing-policy</a>]</span> and are independent from the purpose of the SR policy.  From the perspective of a headend node classifying and steering traffic into an SR policy, there is no difference whether this policy contains IGP, BGP, peering, VPN or service segments, or any combination of these.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">As documented in the above reference, traffic is classified when entering an SR domain.  The SR policy headend may, depending on its capabilities, classify the packets on a per-destination basis, via simple FIB entries, or apply more complex policy routing rules requiring to look deeper into the packet.  These rules are expected to support basic policy routing such as 5-tuple matching.  In addition, the IPv6 SRH tag field defined in <span>[<a href="#RFC8754" class="xref">RFC8754</a>]</span> can be used to identify and classify packets sharing the same set of properties.  Classified traffic is then steered into the appropriate SR policy and forwarded as per the SID-list(s) of the active candidate path.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">SR traffic can be re-classified by an SR endpoint along the original SR policy (e.g., DPI service) or a transit node intercepting the traffic.  This node is the head-end of a new SR policy that is imposed onto the packet, either as a stack of MPLS labels or as an IPv6 SRH.<a href="#section-3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="service-segments">
<section id="section-4">
      <h2 id="name-service-segments">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-service-segments" class="section-name selfRef">Service Segments</a>
      </h2>
<p id="section-4-1">In the context of this document, the term service refers to a physical appliance running on dedicated hardware, a virtualized service inside an isolated environment such as a Virtual Machine (VM), container or namespace, or any process running on a compute element.  A service may also comprise multiple sub-components running in different processes or containers.  Unless otherwise stated, this document does not make any assumption on the type or execution environment of a service.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">The execution of a service can be integrated as part of an SR policy by assigning a segment identifier, or SID, to the service and including this service SID in the SR policy SID-list.  Such a service SID may be of local or global significance. In the former case, other segments, such as prefix or adjacency segments, can be used to steer the traffic up to the node where the service segment is instantiated. In the latter case, the service is directly reachable from anywhere in the routing domain.  This is realized with SR-MPLS by assigning a SID from the global label block (<span>[<a href="#RFC8660" class="xref">RFC8660</a>]</span>), or with SRv6 by advertising the SID locator in the routing protocol (<span>[<a href="#RFC8986" class="xref">RFC8986</a>]</span>).  It is up to the network operator to define the scope and reachability of each service SID.  This decision can be based on various considerations such as infrastructure dynamicity, available control plane or orchestration system capabilities.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">This document categorizes services in two types, depending on whether they are able to behave properly in the presence of SR information or not. These are respectively named SR-aware and SR-unaware services.<a href="#section-4-3" class="pilcrow">¶</a></p>
<div id="sr-aware-services">
<section id="section-4.1">
        <h3 id="name-sr-aware-services">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-sr-aware-services" class="section-name selfRef">SR-Aware Services</a>
        </h3>
<p id="section-4.1-1">An SR-aware service can process the SR information in the packets it receives. This means being able to identify the active segment as a local instruction and move forward in the segment list, but also that the service's own behavior is not hindered due to the presence of SR information.  For example, an SR-aware firewall filtering SRv6 traffic based on its final destination must retrieve that information from the last entry in the SRH rather than the Destination Address field of the IPv6 header.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">An SR-aware service is associated with a locally instantiated service segment, which is used to steer traffic through it.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">If the service is configured to intercept all the packets passing through the appliance, the underlying routing system only has to implement a default SR endpoint behavior (e.g., SR-MPLS node segment or SRv6 End behavior), and the corresponding SID will be used to steer traffic through the service.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">If the service requires the packets to be directed to a specific virtual interface, networking queue or process, a dedicated SR behavior may be required to steer the packets to the appropriate location.  The definition of such service-specific functions is out of the scope of this document.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">SR-aware services also enable advanced network programming functionalities such as conditional branching and jumping to arbitrary SIDs in the segment list. In addition, SRv6 provides several ways of passing and exchanging information between services (e.g., SID arguments, tag field and TLVs). An example scenario involving these features is described in <span>[<a href="#IFIP18" class="xref">IFIP18</a>]</span>, which discusses the implementation of an SR-aware Intrusion Detection System.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1-6">Examples of SR-aware services are provided in section <a href="#sec-implem-aware" class="xref">Section 8.1</a>.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sr-unaware-services">
<section id="section-4.2">
        <h3 id="name-sr-unaware-services">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-sr-unaware-services" class="section-name selfRef">SR-Unaware Services</a>
        </h3>
<p id="section-4.2-1">Any service that does not meet the above criteria for SR-awareness is considered as SR-unaware.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">An SR-unaware service is not able to process the SR information in the traffic that it receives.  It may either drop the traffic or take erroneous decisions due to the unrecognized routing information.  In order to include such services in an SR policy, it is thus required to remove the SR information as well as any other encapsulation header before the service receives the packet, or to alter it in such a way that the service can correctly process the packet.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">In this document, we define the concept of an SR proxy as an entity, separate from the service, that performs these modifications and handle the SR processing on behalf of a service.  The SR proxy can run as a separate process on the service appliance, on a virtual switch or router on the compute node or on a different host.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">An SR-unaware service is associated with a service segment instantiated on the SR proxy, which is used to steer traffic through the service. <a href="#sec-proxies" class="xref">Section 6</a> describes several SR proxy behaviors to handle the encapsulation headers and SR information under various circumstances.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sr-service-policies">
<section id="section-5">
      <h2 id="name-sr-service-policies">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-sr-service-policies" class="section-name selfRef">SR Service Policies</a>
      </h2>
<p id="section-5-1">An SR service policy is an SR policy, as defined in <span>[<a href="#I-D.ietf-spring-segment-routing-policy" class="xref">I-D.ietf-spring-segment-routing-policy</a>]</span>, that includes at least one service. This service is represented in the SID-list by its associated service SID. In case the policy should include several services, the service traversal order is indicated by the relative position of each service SID in the SID-list. Using the mechanisms described in <span>[<a href="#I-D.ietf-spring-segment-routing-policy" class="xref">I-D.ietf-spring-segment-routing-policy</a>]</span>, it is possible to load balance the traffic over several services, or instances of the same service, by associating with the SR service policy a weighted set of SID-lists, each containing a possible sequence of service SIDs to be traversed. Similarly, several candidate paths can be specified for the SR service policy, each with its own set of SID-lists, for resiliency purposes.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Furthermore, binding SIDs (BSIDs) <span>[<a href="#RFC8402" class="xref">RFC8402</a>]</span> can be leveraged in the context of service policies to reduce the number of SIDs imposed by the headend, provide opacity between domains and improve scalability. For example, a network operator may want a policy in its core domain to include services that are running in one of its datacenters. One option is to define an SR policy at ingress edge of the core domain that explicitly includes all the SIDs needed to steer the traffic through the core and in the DC, but that may result in a long SID-list and requires to update the ingress edge configuration every time the DC part of the policy is modified. Alternatively, a separate policy can be defined at the ingress edge of the datacenter with only the SIDs that needs to be executed there and its BSID included in the core domain policy. That BSID remains stable when the DC policy is modified and can even be shared among several core domain policies that would require the same type of processing in the DC.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">This section describes how services can be integrated within an SR-MPLS or SRv6 service policy.<a href="#section-5-3" class="pilcrow">¶</a></p>
<span id="name-sr-service-policy"></span><div id="fig-policy">
<figure id="figure-1">
        <div class="artwork art-text alignLeft" id="section-5-4.1">
<pre>
     +------------------------------------------+
     |               SR network                 |
     |                                          |
+----+----+          +---------+           +----+-----+
|    H    +----------+    S    +-----------+    E     |
|(headend)|          |(service)|           |(endpoint)|
+----+----+          +---------+           +----+-----+
     |  =====================================&gt;  |
     |     P1(H,E,C)                            |
     +------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-sr-service-policy" class="selfRef">SR service policy</a>
        </figcaption></figure>
</div>
<p id="section-5-5"><a href="#fig-policy" class="xref">Figure 1</a> illustrates a basic SR service policy instantiated on a headend node H towards an endpoint E and traversing a service S. The SR policy may also include additional requirements, such as traffic engineering or VPN. On the head-end H, the SR policy P1 is created with a color C and endpoint E and associated with an SR path that can either be explicitly configured, dynamically computed on H or provisioned by a network controller.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">In its most basic form, the SR policy P1 would be resolved into the SID-list &lt; SID(S), SID(E) &gt;. This is assuming that SID(S) and SID(E) are directly reachable from H and S, respectively, and that the forwarding path meets the policy requirement. However, depending on the dataplane and the segments available in the network, additional SIDs may be required to enforce the SR policy.<a href="#section-5-6" class="pilcrow">¶</a></p>
<p id="section-5-7">This model applies regardless of the SR-awareness of the service. If it is SR-unaware, then S simply represents the proxy that takes care of transmitting the packet to the actual service.<a href="#section-5-7" class="pilcrow">¶</a></p>
<p id="section-5-8">Traffic can then be steered into this policy using any of the mechanisms described in <span>[<a href="#I-D.ietf-spring-segment-routing-policy" class="xref">I-D.ietf-spring-segment-routing-policy</a>]</span>.<a href="#section-5-8" class="pilcrow">¶</a></p>
<p id="section-5-9">The following subsections describe the specificities of each SR dataplane.<a href="#section-5-9" class="pilcrow">¶</a></p>
<div id="sec-policy-mpls">
<section id="section-5.1">
        <h3 id="name-sr-mpls-data-plane">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-sr-mpls-data-plane" class="section-name selfRef">SR-MPLS Data Plane</a>
        </h3>
<span id="name-packet-walk-in-an-sr-mpls-n"></span><div id="fig-policy-mpls">
<figure id="figure-2">
          <div class="artwork art-text alignLeft" id="section-5.1-1.1">
<pre>
     +-----------------------------------------------+
     |                SR-MPLS network                |
     |                                               |
+----+----+   ------&gt;   +---------+   ------&gt;   +----+-----+
|    H    +-------------+    S    +-------------+    E     |
|(headend)|             |(service)|             |(endpoint)|
+----+----+             +---------+             +----+-----+
     |    (1)         (2)         (3)         (4)    |
     |+---------+ +---------+ +---------+ +---------+|
     ||   ...   | |  L(S)   | |   ...   | |  L(E)   ||
     |+---------+ +---------+ +---------+ +---------+|
     ||  L(S)   | |   ...   | |  L(E)   | |Inner pkt||
     |+---------+ +---------+ +---------+ +---------+|
     ||   ...   | |  L(E)   | |Inner pkt|            |
     |+---------+ +---------+ +---------+            |
     ||  L(E)   | |Inner pkt|                        |
     |+---------+ +---------+                        |
     ||Inner pkt|                                    |
     |+---------+                                    |
     +-----------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-packet-walk-in-an-sr-mpls-n" class="selfRef">Packet walk in an SR-MPLS network</a>
          </figcaption></figure>
</div>
<p id="section-5.1-2">In an SR-MPLS network, the SR policy SID-list is encoded as a stack of MPLS labels <span>[<a href="#RFC8660" class="xref">RFC8660</a>]</span> and pushed on top of the packet.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">In the example shown on <a href="#fig-policy-mpls" class="xref">Figure 2</a>, the SR policy should steer the traffic from the head-end H to the endpoint E via a service S. This translates into an MPLS label stack that includes at least a label L(S) associated to service S and a label L(E) associated to the endpoint E. The label stack may also include additional intermediate SIDs if these are required for traffic engineering (e.g., to encode a low latency path between H and S and / or between S and E) or simply for reachability purposes. Indeed, the service SID L(S) may be taken from the global or local SID block of node S and, in the latter case, one or more SIDs might be needed before L(S) in order for the packet to reach node S (e.g., a prefix-SID of S), where L(S) can be interpreted. The same applies for the SID L(E) at the SR policy endpoint.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1-4">Special consideration must be taken into account when using Local SIDs for service identification due to increased label stack depth and the associated impacts.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5">When the packet arrives at S, this node determines the MPLS payload type and the appropriate behavior for processing the packet based on the semantic locally associated to the top label L(S). If S is an SR-aware service, the SID L(S) may provide additional context or indication on how to process the packet (e.g., a firewall SID may indicate which rule set should be applied onto the packet). If S is a proxy in front of an SR-unaware service, L(S) indicates how and to which service attached to this proxy the packet should be transmitted. At some point in the process, L(S) is also popped from the label stack in order to expose the next SID, which may be L(E) or another intermediate SID.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-policy-srv6">
<section id="section-5.2">
        <h3 id="name-srv6-data-plane">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-srv6-data-plane" class="section-name selfRef">SRv6 Data Plane</a>
        </h3>
<span id="name-packet-walk-in-an-srv6-netw"></span><div id="fig-policy-srv6">
<figure id="figure-3">
          <div class="artwork art-text alignLeft" id="section-5.2-1.1">
<pre>
     +-----------------------------------------------+
     |                 SRv6 network                  |
     |                                               |
+----+----+   ------&gt;   +---------+   ------&gt;   +----+-----+
|    H    +-------------+    S    +-------------+    E     |
|(headend)|             |(service)|             |(endpoint)|
+----+----+             +---------+             +----+-----+
     |    (1)         (2)         (3)         (4)    |
     |+---------+ +---------+ +---------+ +---------+|
     ||IP6(H,..)| |IP6(H, S)| |IP6(H,..)| |IP6(H, E)||
     |+---------+ +---------+ +---------+ +---------+|
     ||SRH(E,..,| |SRH(E,..,| |SRH(E,..,| |SRH(E,..,||
     ||    S,..;| |    S,..;| |    S,..;| |    S,..;||
     ||    SL=i)| |    SL=j)| |    SL=k)| |    SL=0)||
     |+---------+ +---------+ +---------+ +---------+|
     ||Inner pkt| |Inner pkt| |Inner pkt| |Inner pkt||
     |+---------+ +---------+ +---------+ +---------+|
     +-----------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-packet-walk-in-an-srv6-netw" class="selfRef">Packet walk in an SRv6 network</a>
          </figcaption></figure>
</div>
<p id="section-5.2-2">In an SRv6 network, the SR Policy is encoded into the packet as an IPv6 header possibly followed by a Segment Routing Header (SRH) <span>[<a href="#RFC8754" class="xref">RFC8754</a>]</span>.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">In the example shown on <a href="#fig-policy-srv6" class="xref">Figure 3</a>, the SR policy should steer the traffic from the head-end H to the endpoint E via a service S. This translates into Segment-List that includes at least a segment SID(S) to the service, or service proxy, S and a segment SID(E) to the endpoint E. The Segment-List may also include additional intermediate SIDs if these are required for traffic engineering (e.g., the encode a low latency path between H and S and / or between S and E) or simply for reachability purposes. Indeed, the service SID locator may or may not be advertised in the routing protocol and, in the latter case, one or more SIDs might be needed before SID(S) in order to bring the packet up to node S, where SID(S) can be interpreted. The same applies for the segment SID(E) at the SR policy endpoint.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<p id="section-5.2-4">When the packet arrives at S, this node determines how to process the packet based on the semantic locally associated to the active segment SID(S). If S is an SR-aware service, then SID(S) may provide additional context or indication on how to process the packet (e.g., a firewall SID may indicate which rule set should be applied onto the packet). If S is a proxy in front of an SR-unaware service, SID(S) indicates how and to which service attached to this proxy the packet should be transmitted. At some point in the process, the SRv6 End function is also applied in order to make the next SID, which may be SID(E) or another intermediate SID, active.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<p id="section-5.2-5">The "Inner pkt" on <a href="#fig-policy-srv6" class="xref">Figure 3</a> represents the SRv6 payload, which may be an encapsulated IP packet, an Ethernet frame or a transport-layer payload, for example.<a href="#section-5.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-proxies">
<section id="section-6">
      <h2 id="name-sr-proxy-behaviors">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-sr-proxy-behaviors" class="section-name selfRef">SR Proxy Behaviors</a>
      </h2>
<p id="section-6-1">This section describes several SR proxy behaviors designed to enable SR service programming through SR-unaware services.  A system implementing one of these behaviors may handle the SR processing on behalf of an SR-unaware service and allows the service to properly process the traffic that is steered through it.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">A service may be located at any hop in an SR policy, including the last segment.  However, the SR proxy behaviors defined in this section are dedicated to supporting SR-unaware services at intermediate hops in the segment list.  In case an SR-unaware service is at the last segment, it is sufficient to ensure that the SR information is ignored (IPv6 routing extension header with Segments Left equal to 0) or removed before the packet reaches the service (MPLS PHP, SRv6 decapsulation behavior or PSP flavor).<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">As illustrated on <a href="#fig-proxy" class="xref">Figure 4</a>, the generic behavior of an SR proxy has two parts.  The first part is in charge of passing traffic from the network to the service.  It intercepts the SR traffic destined for the service via a locally instantiated service segment, modifies it in such a way that it appears as non-SR traffic to the service, then sends it out on a given interface, IFACE-OUT, connected to the service.  The second part receives the traffic coming back from the service on IFACE-IN, restores the SR information and forwards it according to the next segment in the list.  IFACE-OUT and IFACE-IN are respectively the proxy interface used for sending traffic to the service and the proxy interface that receives the traffic coming back from the service.  These can be physical interfaces or sub-interfaces (VLANs) and, unless otherwise stated, IFACE-OUT and IFACE-IN can represent the same interface.<a href="#section-6-3" class="pilcrow">¶</a></p>
<span id="name-generic-sr-proxy"></span><div id="fig-proxy">
<figure id="figure-4">
        <div class="artwork art-text alignLeft" id="section-6-4.1">
<pre>
           +----------------------------+
           |                            |
           |           Service          |
           |                            |
           +----------------------------+
                    ^  Non SR   |
                    |  traffic  |
                    |           v
              +-----------+----------+
           +--| IFACE OUT | IFACE IN |--+
SR traffic |  +-----------+----------+  | SR traffic
----------&gt;|          SR proxy          |----------&gt;
           |                            |
           +----------------------------+
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-generic-sr-proxy" class="selfRef">Generic SR proxy</a>
        </figcaption></figure>
</div>
<p id="section-6-5">In the next subsections, the following SR proxy mechanisms are defined:<a href="#section-6-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-6.1">Static proxy<a href="#section-6-6.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-6-6.2">Dynamic proxy<a href="#section-6-6.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-6-6.3">Shared-memory proxy<a href="#section-6-6.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-6-6.4">Masquerading proxy<a href="#section-6-6.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-6-7">Each mechanism has its own characteristics and constraints, which are summarized in the below table.  It is up to the operator to select the best one based on the proxy node capabilities, the service behavior and the traffic type.  It is also possible to use different proxy mechanisms within the same service policy.<a href="#section-6-7" class="pilcrow">¶</a></p>
<span id="name-sr-proxy-summary"></span><div id="fig-proxy-sum">
<figure id="figure-5">
        <div class="artwork art-text alignLeft" id="section-6-8.1">
<pre>
                                        +-----+-----+-----+-----+
                                        |     |     |     |  M  |
                                        |     |     |  S  |  a  |
                                        |     |     |  h  |  s  |
                                        |     |     |  a  |  q  |
                                        |     |     |  r  |  u  |
                                        |     |  D  |  e  |  e  |
                                        |  S  |  y  |  d  |  r  |
                                        |  t  |  n  |     |  a  |
                                        |  a  |  a  |  m  |  d  |
                                        |  t  |  m  |  e  |  i  |
                                        |  i  |  i  |  m  |  n  |
                                        |  c  |  c  |  .  |  g  |
+---------------------------------------+-----+-----+-----+-----+
|                |       SR-MPLS        |  Y  |  Y  |  Y  |  -  |
|                |                      |     |     |     |     |
|   SR flavors   |     Inline SRv6      |  P  |  P  |  P  |  Y  |
|                |                      |     |     |     |     |
|                |  SRv6 encapsulation  |  Y  |  Y  |  Y  |  -  |
+----------------+----------------------+-----+-----+-----+-----+
|     Chain agnostic configuration      |  N  |  N  |  Y  |  Y  |
+---------------------------------------+-----+-----+-----+-----+
|     Transparent to chain changes      |  N  |  Y  |  Y  |  Y  |
+----------------+----------------------+-----+-----+-----+-----+
|                |   DA modification    |  Y  |  Y  |  Y  | NAT |
|                |                      |     |     |     |     |
|                | Payload modification |  Y  |  Y  |  Y  |  Y  |
|                |                      |     |     |     |     |
|Service support |  Packet generation   |  Y  |  Y  |cache|cache|
|                |                      |     |     |     |     |
|                |   Packet deletion    |  Y  |  Y  |  Y  |  Y  |
|                |                      |     |     |     |     |
|                |  Packet re-ordering  |  Y  |  Y  |  Y  |  Y  |
|                |                      |     |     |     |     |
|                |  Transport endpoint  |  Y  |  Y  |cache|cache|
+----------------+----------------------+-----+-----+-----+-----+
|                |       Ethernet       |  Y  |  Y  |  Y  |  -  |
|   Supported    |                      |     |     |     |     |
|    traffic     |         IPv4         |  Y  |  Y  |  Y  |  -  |
|                |                      |     |     |     |     |
|                |         IPv6         |  Y  |  Y  |  Y  |  Y  |
+----------------+----------------------+-----+-----+-----+-----+
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-sr-proxy-summary" class="selfRef">SR proxy summary</a>
        </figcaption></figure>
</div>
<p id="section-6-9">Note: The use of a shared memory proxy requires both the service (VNF) and the proxy to be running on the same node.<a href="#section-6-9" class="pilcrow">¶</a></p>
<div id="sec-proxies-static">
<section id="section-6.1">
        <h3 id="name-static-sr-proxy">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-static-sr-proxy" class="section-name selfRef">Static SR Proxy</a>
        </h3>
<p id="section-6.1-1">The static proxy is an SR endpoint behavior for processing SR-MPLS or SRv6 encapsulated traffic on behalf of an SR-unaware service.  This proxy thus receives SR traffic that is formed of an MPLS label stack or an IPv6 header on top of an inner packet, which can be Ethernet, IPv4 or IPv6.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">A static SR proxy segment is associated with the following mandatory parameters<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-3.1">INNER-TYPE: Inner packet type<a href="#section-6.1-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-3.2">NH-ADDR: Next hop Ethernet address (only for inner type IPv4 and IPv6)<a href="#section-6.1-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-3.3">IFACE-OUT: Local interface for sending traffic towards the service<a href="#section-6.1-3.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-3.4">IFACE-IN: Local interface receiving the traffic coming back from the service<a href="#section-6.1-3.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-3.5">
            <p id="section-6.1-3.5.1">CACHE: SR information to be attached on the traffic coming back from the service, including at least<a href="#section-6.1-3.5.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-3.5.2.1">CACHE.SA: IPv6 source address (SRv6 only)<a href="#section-6.1-3.5.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-6.1-3.5.2.2">CACHE.LIST: Segment list expressed as MPLS labels or IPv6 address<a href="#section-6.1-3.5.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
<p id="section-6.1-4">A static SR proxy segment is thus defined for a specific service, inner packet type and cached SR information.  It is also bound to a pair of directed interfaces on the proxy.  These may be both directions of a single interface, or opposite directions of two different interfaces. The latter is recommended in case the service is to be used as part of a bi-directional SR service policy.  If the proxy and the service both support 802.1Q, IFACE-OUT and IFACE-IN can also represent sub-interfaces.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1-5">The first part of this behavior is triggered when the proxy node receives a packet whose active segment matches a segment associated with the static proxy behavior.  It removes the SR information from the packet then sends it on a specific interface towards the associated service.  This SR information corresponds to the full label stack for SR-MPLS or to the encapsulation IPv6 header with any attached extension header in the case of SRv6.<a href="#section-6.1-5" class="pilcrow">¶</a></p>
<p id="section-6.1-6">The second part is an inbound policy attached to the proxy interface receiving the traffic returning from the service, IFACE-IN.  This policy attaches to the incoming traffic the cached SR information associated with the SR proxy segment.  If the proxy segment uses the SR-MPLS data plane, CACHE contains a stack of labels to be pushed on top of the packets.  With the SRv6 data plane, CACHE is defined as a source address, an active segment and an optional SRH (tag, segments left, segment list and metadata).  The proxy encapsulates the packets with an IPv6 header that has the source address, the active segment as destination address and the SRH as a routing extension header.  After the SR information has been attached, the packets are forwarded according to the active segment, which is represented by the top MPLS label or the IPv6 Destination Address. An MPLS TTL or IPv6 Hop Limit value may also be configured in CACHE. If it is not, the proxy should set these values according to the node's default setting for MPLS or IPv6 encapsulation.<a href="#section-6.1-6" class="pilcrow">¶</a></p>
<p id="section-6.1-7">In this scenario, there are no restrictions on the operations that can be performed by the service on the stream of packets.  It may operate at all protocol layers, terminate transport layer connections, generate new packets and initiate transport layer connections.  This behavior may also be used to integrate an IPv4-only service into an SRv6 policy.  However, a static SR proxy segment can be used in only one service policy at a time.  As opposed to most other segment types, a static SR proxy segment is bound to a unique list of segments, which represents a directed SR service policy.  This is due to the cached SR information being defined in the segment configuration.  This limitation only prevents multiple segment lists from using the same static SR proxy segment at the same time, but a single segment list can be shared by any number of traffic flows.  Besides, since the returning traffic from the service is re-classified based on the incoming interface, an interface can be used as receiving interface (IFACE-IN) only for a single SR proxy segment at a time.  In the case of a bi-directional SR service policy, a different SR proxy segment and receiving interface are required for the return direction.<a href="#section-6.1-7" class="pilcrow">¶</a></p>
<p id="section-6.1-8">The static proxy behavior may also be used for sending traffic through "bump in the wire" services that are transparent to the IP and Ethernet layers. This type of processing is assumed when the inner traffic type is Ethernet, since the original destination address of the Ethernet frame is preserved when the packet is steered into the SR Policy and likely associated with a node downstream of the policy tail-end. In case the inner type is IP (IPv4 or IPv6), the NH-ADDR parameter may be set to a dummy or broadcast Ethernet address, or simply to the address of the proxy receiving interface (IFACE-IN).<a href="#section-6.1-8" class="pilcrow">¶</a></p>
<div id="sec-proxies-static-mpls">
<section id="section-6.1.1">
          <h4 id="name-sr-mpls-pseudocode">
<a href="#section-6.1.1" class="section-number selfRef">6.1.1. </a><a href="#name-sr-mpls-pseudocode" class="section-name selfRef">SR-MPLS Pseudocode</a>
          </h4>
<div id="static-proxy-for-inner-type-ethernet">
<section id="section-6.1.1.1">
            <h5 id="name-static-proxy-for-inner-type">
<a href="#section-6.1.1.1" class="section-number selfRef">6.1.1.1. </a><a href="#name-static-proxy-for-inner-type" class="section-name selfRef">Static Proxy for Inner Type Ethernet</a>
            </h5>
<p id="section-6.1.1.1-1">When processing an MPLS packet whose top label matches a locally instantiated
MPLS static proxy SID for Ethernet traffic, the following pseudocode is
executed.<a href="#section-6.1.1.1-1" class="pilcrow">¶</a></p>
<span id="name-sid-processing-for-mpls-sta"></span><div id="code-static-mpls-eth-sid">
<figure id="figure-6">
              <div class="artwork art-text alignLeft" id="section-6.1.1.1-2.1">
<pre>
S01. POP all labels in the MPLS label stack.
S02. Submit the frame to the Ethernet module for transmission via
     interface IFACE-OUT.
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-sid-processing-for-mpls-sta" class="selfRef">SID processing for MPLS static proxy (Ethernet)</a>
              </figcaption></figure>
</div>
<p id="section-6.1.1.1-3">When processing an Ethernet frame received on the interface IFACE-IN and with a
destination MAC address that is neither a broadcast address nor matches the
address of IFACE-IN, the following pseudocode is executed.<a href="#section-6.1.1.1-3" class="pilcrow">¶</a></p>
<span id="name-inbound-policy-for-mpls-sta"></span><div id="code-static-mpls-eth-inbound">
<figure id="figure-7">
              <div class="artwork art-text alignLeft" id="section-6.1.1.1-4.1">
<pre>
S01. Retrieve the CACHE entry associated with IFACE-IN.
S02. If the CACHE entry is not empty {
S03.   Remove the preamble or Frame Check Sequence (FCS).
S04.   PUSH all labels from the retrieved CACHE entry.
S05.   Submit the packet to the MPLS module for transmission as per
       the top label in the MPLS label stack.
S06. }
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-inbound-policy-for-mpls-sta" class="selfRef">Inbound policy for MPLS static proxy (Ethernet)</a>
              </figcaption></figure>
</div>
</section>
</div>
<div id="static-proxy-for-inner-type-ipv4">
<section id="section-6.1.1.2">
            <h5 id="name-static-proxy-for-inner-type-">
<a href="#section-6.1.1.2" class="section-number selfRef">6.1.1.2. </a><a href="#name-static-proxy-for-inner-type-" class="section-name selfRef">Static Proxy for Inner Type IPv4</a>
            </h5>
<p id="section-6.1.1.2-1">When processing an MPLS packet whose top label matches a locally instantiated
MPLS static proxy SID for IPv4 traffic, the following pseudocode is
executed.<a href="#section-6.1.1.2-1" class="pilcrow">¶</a></p>
<span id="name-sid-processing-for-mpls-stat"></span><div id="code-static-mpls-ipv4-sid">
<figure id="figure-8">
              <div class="artwork art-text alignLeft" id="section-6.1.1.2-2.1">
<pre>
S01. POP all labels in the MPLS label stack.
S02. Submit the packet to the IPv4 module for transmission on
     interface IFACE-OUT via NH-ADDR.
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-sid-processing-for-mpls-stat" class="selfRef">SID processing for MPLS static proxy (IPv4)</a>
              </figcaption></figure>
</div>
<p id="section-6.1.1.2-3">When processing an IPv4 packet received on the interface IFACE-IN and with a
destination address that does not match any address of IFACE-IN, the following
pseudocode is executed.<a href="#section-6.1.1.2-3" class="pilcrow">¶</a></p>
<span id="name-inbound-policy-for-mpls-stat"></span><div id="code-static-mpls-ipv4-inbound">
<figure id="figure-9">
              <div class="artwork art-text alignLeft" id="section-6.1.1.2-4.1">
<pre>
S01. Retrieve the CACHE entry associated with IFACE-IN.
S02. If the CACHE entry is not empty {
S03.   Decrement the TTL and adjust the checksum accordingly.
S04.   PUSH all labels from the retrieved CACHE entry.
S05.   Submit the packet to the MPLS module for transmission as per
       the top label in the MPLS label stack.
S06. }
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-inbound-policy-for-mpls-stat" class="selfRef">Inbound policy for MPLS static proxy (IPv4)</a>
              </figcaption></figure>
</div>
</section>
</div>
<div id="static-proxy-for-inner-type-ipv6">
<section id="section-6.1.1.3">
            <h5 id="name-static-proxy-for-inner-type-i">
<a href="#section-6.1.1.3" class="section-number selfRef">6.1.1.3. </a><a href="#name-static-proxy-for-inner-type-i" class="section-name selfRef">Static Proxy for Inner Type IPv6</a>
            </h5>
<p id="section-6.1.1.3-1">When processing an MPLS packet whose top label matches a locally instantiated
MPLS static proxy SID for IPv6 traffic, the following pseudocode is
executed.<a href="#section-6.1.1.3-1" class="pilcrow">¶</a></p>
<span id="name-sid-processing-for-mpls-stati"></span><div id="code-static-mpls-ipv6-sid">
<figure id="figure-10">
              <div class="artwork art-text alignLeft" id="section-6.1.1.3-2.1">
<pre>
S01. POP all labels in the MPLS label stack.
S02. Submit the packet to the IPv6 module for transmission on
     interface IFACE-OUT via NH-ADDR.
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-sid-processing-for-mpls-stati" class="selfRef">SID processing for MPLS static proxy (IPv6)</a>
              </figcaption></figure>
</div>
<p id="section-6.1.1.3-3">When processing an IPv6 packet received on the interface IFACE-IN and with a
destination address that does not match any address of IFACE-IN, the following
pseudocode is executed.<a href="#section-6.1.1.3-3" class="pilcrow">¶</a></p>
<span id="name-inbound-policy-for-mpls-stati"></span><div id="code-static-mpls-ipv6-inbound">
<figure id="figure-11">
              <div class="artwork art-text alignLeft" id="section-6.1.1.3-4.1">
<pre>
S01. Retrieve the CACHE entry associated with IFACE-IN.
S02. If the CACHE entry is not empty {
S03.   Decrement the Hop Limit.
S04.   PUSH all labels from the retrieved CACHE entry.
S05.   Submit the packet to the MPLS module for transmission as per
       the top label in the MPLS label stack.
S06. }
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-inbound-policy-for-mpls-stati" class="selfRef">Inbound policy for MPLS static proxy (IPv6)</a>
              </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="sec-proxies-static-srv6">
<section id="section-6.1.2">
          <h4 id="name-srv6-pseudocode">
<a href="#section-6.1.2" class="section-number selfRef">6.1.2. </a><a href="#name-srv6-pseudocode" class="section-name selfRef">SRv6 Pseudocode</a>
          </h4>
<div id="static-proxy-for-inner-type-ethernet-1">
<section id="section-6.1.2.1">
            <h5 id="name-static-proxy-for-inner-type-e">
<a href="#section-6.1.2.1" class="section-number selfRef">6.1.2.1. </a><a href="#name-static-proxy-for-inner-type-e" class="section-name selfRef">Static Proxy for Inner Type Ethernet</a>
            </h5>
<p id="section-6.1.2.1-1">When processing an IPv6 packet matching a FIB entry locally instantiated as an
SRv6 static proxy SID for Ethernet traffic, the following pseudocode is
executed.<a href="#section-6.1.2.1-1" class="pilcrow">¶</a></p>
<span id="name-sid-processing-for-srv6-sta"></span><div id="code-static-srv6-eth-sid">
<figure id="figure-12">
              <div class="artwork art-text alignLeft" id="section-6.1.2.1-2.1">
<pre>
S01. When an SRH is processed {
S02.   If (Segments Left == 0) {
S03.     Proceed to process the next header in the packet.
S04.   }
S05.   If (IPv6 Hop Limit &lt;= 1) {
S06.     Send an ICMP Time Exceeded message to the Source Address,
         Code 0 (hop limit exceeded in transit),
         Interrupt packet processing and discard the packet.
S07.   }
S08.   max_last_entry = (Hdr Ext Len / 2) - 1
S09.   If ((Last Entry &gt; max_last_entry) or
           (Segments Left &gt; (Last Entry + 1))) {
S10.     Send an ICMP Parameter Problem message to the Source Address,
         Code 0 (Erroneous header field encountered),
         Pointer set to the Segments Left field,
         Interrupt packet processing and discard the packet.
S11.   }
S12.   Decrement Hop Limit by 1.
S13.   Decrement Segments Left by 1.
S14.   Copy Segment List[Segments Left] from the SRH to the
       Destination Address of the IPv6 header.
S15.   If (Upper-layer header type != 143 (Ethernet)) {
S16.     Resubmit the packet to the IPv6 module for transmission to
         the new destination.
S17.   }
S18.   Perform IPv6 decapsulation.
S19.   Submit the frame to the Ethernet module for transmission via
       interface IFACE-OUT.
S20. }
</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a>:
<a href="#name-sid-processing-for-srv6-sta" class="selfRef">SID processing for SRv6 static proxy (Ethernet)</a>
              </figcaption></figure>
</div>
<p id="section-6.1.2.1-3">S15: 143 (Ethernet) refers to the value assigned by IANA for "Ethernet" in the
"Internet Protocol Numbers" registry.<a href="#section-6.1.2.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1.2.1-4">When processing the Upper-layer header of a packet matching a FIB entry locally
instantiated as an SRv6 static proxy SID for Ethernet traffic, the following
pseudocode is executed.<a href="#section-6.1.2.1-4" class="pilcrow">¶</a></p>
<span id="name-upper-layer-header-processi"></span><div id="code-static-srv6-eth-ulh">
<figure id="figure-13">
              <div class="artwork art-text alignLeft" id="section-6.1.2.1-5.1">
<pre>
S01. If (Upper-layer header type != 143 (Ethernet)) {
S02.   Process as per [RFC8986] Section 4.1.1
S03. }
S04. Perform IPv6 decapsulation.
S05. Submit the frame to the Ethernet module for transmission via
     interface IFACE-OUT.
</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a>:
<a href="#name-upper-layer-header-processi" class="selfRef">Upper-layer header processing for SRv6 static proxy (Ethernet)</a>
              </figcaption></figure>
</div>
<p id="section-6.1.2.1-6">When processing an Ethernet frame received on the interface IFACE-IN and with a
destination MAC address that is neither a broadcast address nor matches the
address of IFACE-IN, the following pseudocode is executed.<a href="#section-6.1.2.1-6" class="pilcrow">¶</a></p>
<span id="name-inbound-policy-for-srv6-sta"></span><div id="code-static-srv6-eth-inbound">
<figure id="figure-14">
              <div class="artwork art-text alignLeft" id="section-6.1.2.1-7.1">
<pre>
S01. Retrieve the CACHE entry associated with IFACE-IN.
S02. If the CACHE entry is not empty {
S03.   Remove the preamble or Frame Check Sequence (FCS).
S04.   Perform IPv6 encapsulation with an SRH
         Source Address of the IPv6 header is set to CACHE.SA,
         Destination Address of the IPv6 header is set to
         CACHE.LIST[0],
         Next Header of the SRH is set to 143 (Ethernet),
         Segment List of the SRH is set to CACHE.LIST.
S05.   Submit the packet to the IPv6 module for transmission to the
       next destination.
S06. }
</pre>
</div>
<figcaption><a href="#figure-14" class="selfRef">Figure 14</a>:
<a href="#name-inbound-policy-for-srv6-sta" class="selfRef">Inbound policy for SRv6 static proxy (Ethernet)</a>
              </figcaption></figure>
</div>
<p id="section-6.1.2.1-8">S04: CACHE.LIST[0] represents the first entry in CACHE.LIST. Unless a local
configuration indicates otherwise, the SIDs in CACHE.LIST should be encoded
in the Segment List field in reversed order, the Segment Left and Last Entry
values should be set of the length of CACHE.LIST minus 1. If CACHE.LIST contains
a single entry, the SRH can be omitted and the Next Header field of the IPv6
header set to 143 (Ethernet).<a href="#section-6.1.2.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="static-proxy-for-inner-type-ipv4-1">
<section id="section-6.1.2.2">
            <h5 id="name-static-proxy-for-inner-type-ip">
<a href="#section-6.1.2.2" class="section-number selfRef">6.1.2.2. </a><a href="#name-static-proxy-for-inner-type-ip" class="section-name selfRef">Static Proxy for Inner Type IPv4</a>
            </h5>
<p id="section-6.1.2.2-1">When processing an IPv6 packet matching a FIB entry locally instantiated as an
SRv6 static proxy SID for IPv4 traffic, the following pseudocode is executed.<a href="#section-6.1.2.2-1" class="pilcrow">¶</a></p>
<span id="name-sid-processing-for-srv6-stat"></span><div id="code-static-srv6-ipv4-sid">
<figure id="figure-15">
              <div class="artwork art-text alignLeft" id="section-6.1.2.2-2.1">
<pre>
S01. When an SRH is processed {
S02.   If (Segments Left == 0) {
S03.     Proceed to process the next header in the packet.
S04.   }
S05.   If (IPv6 Hop Limit &lt;= 1) {
S06.     Send an ICMP Time Exceeded message to the Source Address,
         Code 0 (hop limit exceeded in transit),
         Interrupt packet processing and discard the packet.
S07.   }
S08.   max_last_entry = (Hdr Ext Len / 2) - 1
S09.   If ((Last Entry &gt; max_last_entry) or
           (Segments Left &gt; (Last Entry + 1))) {
S10.     Send an ICMP Parameter Problem message to the Source Address,
         Code 0 (Erroneous header field encountered),
         Pointer set to the Segments Left field,
         Interrupt packet processing and discard the packet.
S11.   }
S12.   Decrement Hop Limit by 1.
S13.   Decrement Segments Left by 1.
S14.   Copy Segment List[Segments Left] from the SRH to the
       Destination Address of the IPv6 header.
S15.   If (Upper-layer header type != 4 (IPv4)) {
S16.     Resubmit the packet to the IPv6 module for transmission to
         the new destination.
S17.   }
S18.   Perform IPv6 decapsulation.
S19.   Submit the packet to the IPv4 module for transmission on
       interface IFACE-OUT via NH-ADDR.
S20. }
</pre>
</div>
<figcaption><a href="#figure-15" class="selfRef">Figure 15</a>:
<a href="#name-sid-processing-for-srv6-stat" class="selfRef">SID processing for SRv6 static proxy (IPv4)</a>
              </figcaption></figure>
</div>
<p id="section-6.1.2.2-3">When processing the Upper-layer header of a packet matching a FIB entry locally
instantiated as an SRv6 static proxy SID for IPv4 traffic, the following
pseudocode is executed.<a href="#section-6.1.2.2-3" class="pilcrow">¶</a></p>
<span id="name-upper-layer-header-processin"></span><div id="code-static-srv6-ipv4-ulh">
<figure id="figure-16">
              <div class="artwork art-text alignLeft" id="section-6.1.2.2-4.1">
<pre>
S01. If (Upper-layer header type != 4 (IPv4)) {
S02.   Process as per [RFC8986] Section 4.1.1
S03. }
S04. Perform IPv6 decapsulation.
S05. Submit the packet to the IPv4 module for transmission on
     interface IFACE-OUT via NH-ADDR.
</pre>
</div>
<figcaption><a href="#figure-16" class="selfRef">Figure 16</a>:
<a href="#name-upper-layer-header-processin" class="selfRef">Upper-layer header processing for SRv6 static proxy (IPv4)</a>
              </figcaption></figure>
</div>
<p id="section-6.1.2.2-5">When processing an IPv4 packet received on the interface IFACE-IN and with a
destination address that does not match any address of IFACE-IN, the following
pseudocode is executed.<a href="#section-6.1.2.2-5" class="pilcrow">¶</a></p>
<span id="name-inbound-policy-for-srv6-stat"></span><div id="code-static-srv6-ipv4-inbound">
<figure id="figure-17">
              <div class="artwork art-text alignLeft" id="section-6.1.2.2-6.1">
<pre>
S01. Retrieve the CACHE entry associated with IFACE-IN.
S02. If the CACHE entry is not empty {
S03.   Decrement the TTL and adjust the checksum accordingly.
S04.   Perform IPv6 encapsulation with an SRH
         Source Address of the IPv6 header is set to CACHE.SA,
         Destination Address of the IPv6 header is set to
         CACHE.LIST[0],
         Next Header of the SRH is set to 4 (IPv4),
         Segment List of the SRH is set to CACHE.LIST.
S05.   Submit the packet to the IPv6 module for transmission to the
       next destination.
S06. }
</pre>
</div>
<figcaption><a href="#figure-17" class="selfRef">Figure 17</a>:
<a href="#name-inbound-policy-for-srv6-stat" class="selfRef">Inbound policy for SRv6 static proxy (IPv4)</a>
              </figcaption></figure>
</div>
<p id="section-6.1.2.2-7">S04: CACHE.LIST[0] represents the first entry in CACHE.LIST. Unless a local
configuration indicates otherwise, the SIDs in CACHE.LIST should be encoded
in the Segment List field in reversed order, the Segment Left and Last Entry
values should be set of the length of CACHE.LIST minus 1. If CACHE.LIST contains
a single entry, the SRH can be omitted and the Next Header field of the IPv6
header set to 4 (IPv4).<a href="#section-6.1.2.2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="static-proxy-for-inner-type-ipv6-1">
<section id="section-6.1.2.3">
            <h5 id="name-static-proxy-for-inner-type-ipv">
<a href="#section-6.1.2.3" class="section-number selfRef">6.1.2.3. </a><a href="#name-static-proxy-for-inner-type-ipv" class="section-name selfRef">Static Proxy for Inner Type IPv6</a>
            </h5>
<p id="section-6.1.2.3-1">When processing an IPv6 packet matching a FIB entry locally instantiated as an
SRv6 static proxy SID for IPv6 traffic, the following pseudocode is executed.<a href="#section-6.1.2.3-1" class="pilcrow">¶</a></p>
<span id="name-sid-processing-for-srv6-stati"></span><div id="code-static-srv6-ipv6-sid">
<figure id="figure-18">
              <div class="artwork art-text alignLeft" id="section-6.1.2.3-2.1">
<pre>
S01. When an SRH is processed {
S02.   If (Segments Left == 0) {
S03.     Proceed to process the next header in the packet.
S04.   }
S05.   If (IPv6 Hop Limit &lt;= 1) {
S06.     Send an ICMP Time Exceeded message to the Source Address,
         Code 0 (hop limit exceeded in transit),
         Interrupt packet processing and discard the packet.
S07.   }
S08.   max_last_entry = (Hdr Ext Len / 2) - 1
S09.   If ((Last Entry &gt; max_last_entry) or
           (Segments Left &gt; (Last Entry + 1))) {
S10.     Send an ICMP Parameter Problem message to the Source Address,
         Code 0 (Erroneous header field encountered),
         Pointer set to the Segments Left field,
         Interrupt packet processing and discard the packet.
S11.   }
S12.   Decrement Hop Limit by 1.
S13.   Decrement Segments Left by 1.
S14.   Copy Segment List[Segments Left] from the SRH to the
       Destination Address of the IPv6 header.
S15.   If (Upper-layer header type != 41 (IPv6)) {
S16.     Resubmit the packet to the IPv6 module for transmission to
         the new destination.
S17.   }
S18.   Perform IPv6 decapsulation.
S19.   Submit the packet to the IPv6 module for transmission on
       interface IFACE-OUT via NH-ADDR.
S20. }
</pre>
</div>
<figcaption><a href="#figure-18" class="selfRef">Figure 18</a>:
<a href="#name-sid-processing-for-srv6-stati" class="selfRef">SID processing for SRv6 static proxy (IPv6)</a>
              </figcaption></figure>
</div>
<p id="section-6.1.2.3-3">When processing the Upper-layer header of a packet matching a FIB entry locally
instantiated as an SRv6 static proxy SID for IPv6 traffic, the following
pseudocode is executed.<a href="#section-6.1.2.3-3" class="pilcrow">¶</a></p>
<span id="name-upper-layer-header-processing"></span><div id="code-static-srv6-ipv6-ulh">
<figure id="figure-19">
              <div class="artwork art-text alignLeft" id="section-6.1.2.3-4.1">
<pre>
S01. If (Upper-layer header type != 41 (IPv6)) {
S02.   Process as per [RFC8986] Section 4.1.1
S03. }
S04. Perform IPv6 decapsulation.
S05. Submit the packet to the IPv6 module for transmission on
     interface IFACE-OUT via NH-ADDR.
</pre>
</div>
<figcaption><a href="#figure-19" class="selfRef">Figure 19</a>:
<a href="#name-upper-layer-header-processing" class="selfRef">Upper-layer header processing for SRv6 static proxy (IPv6)</a>
              </figcaption></figure>
</div>
<p id="section-6.1.2.3-5">When processing an IPv6 packet received on the interface IFACE-IN and with a
destination address that does not match any address of IFACE-IN, the following
pseudocode is executed.<a href="#section-6.1.2.3-5" class="pilcrow">¶</a></p>
<span id="name-inbound-policy-for-srv6-stati"></span><div id="code-static-srv6-ipv6-inbound">
<figure id="figure-20">
              <div class="artwork art-text alignLeft" id="section-6.1.2.3-6.1">
<pre>
S01. Retrieve the CACHE entry associated with IFACE-IN.
S02. If the CACHE entry is not empty {
S03.   Decrement the Hop Limit.
S04.   Perform IPv6 encapsulation with an SRH
         Source Address of the IPv6 header is set to CACHE.SA,
         Destination Address of the IPv6 header is set to
         CACHE.LIST[0],
         Next Header of the SRH is set to 41 (IPv6),
         Segment List of the SRH is set to CACHE.LIST.
S05.   Submit the packet to the IPv6 module for transmission to the
       next destination.
S06. }
</pre>
</div>
<figcaption><a href="#figure-20" class="selfRef">Figure 20</a>:
<a href="#name-inbound-policy-for-srv6-stati" class="selfRef">Inbound policy for SRv6 static proxy (IPv6)</a>
              </figcaption></figure>
</div>
<p id="section-6.1.2.3-7">S04: CACHE.LIST[0] represents the first entry in CACHE.LIST. Unless a local
configuration indicates otherwise, the SIDs in CACHE.LIST should be encoded
in the Segment List field in reversed order, the Segment Left and Last Entry
values should be set of the length of CACHE.LIST minus 1. If CACHE.LIST contains
a single entry, the SRH can be omitted and the Next Header field of the (outer)
IPv6 header set to 41 (IPv6).<a href="#section-6.1.2.3-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-proxies-dynamic">
<section id="section-6.2">
        <h3 id="name-dynamic-sr-proxy">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-dynamic-sr-proxy" class="section-name selfRef">Dynamic SR Proxy</a>
        </h3>
<p id="section-6.2-1">The dynamic proxy is an improvement over the static proxy that dynamically learns the SR information before removing it from the incoming traffic.  The same information can then be re-attached to the traffic returning from the service.  As opposed to the static SR proxy, no CACHE information needs to be configured.  Instead, the dynamic SR proxy relies on a local caching mechanism on the node instantiating this segment.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">Upon receiving a packet whose active segment matches a dynamic SR proxy function, the proxy node pops the top MPLS label or applies the SRv6 End behavior, then compares the updated SR information with the cache entry for the current segment.  If the cache is empty or different, it is updated with the new SR information.  The SR information is then removed and the inner packet is sent towards the service.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2-3">The cache entry is not mapped to any particular packet, but instead to an SR service policy identified by the receiving interface (IFACE-IN). Any non-link-local IP packet or non-local Ethernet frame received on that interface will be re-encapsulated with the cached headers as described in <a href="#sec-proxies-static" class="xref">Section 6.1</a>.  The service may thus drop, modify or generate new packets without affecting the proxy.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<div id="sr-mpls-pseudocode">
<section id="section-6.2.1">
          <h4 id="name-sr-mpls-pseudocode-2">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-sr-mpls-pseudocode-2" class="section-name selfRef">SR-MPLS Pseudocode</a>
          </h4>
<p id="section-6.2.1-1">The dynamic proxy SR-MPLS pseudocode is obtained by inserting the following instructions at the beginning of the static SR-MPLS pseudocode (<a href="#sec-proxies-static-mpls" class="xref">Section 6.1.1</a>).<a href="#section-6.2.1-1" class="pilcrow">¶</a></p>
<span id="name-sid-processing-for-mpls-dyn"></span><div id="code-dynamic-mpls-sid">
<figure id="figure-21">
            <div class="artwork art-text alignLeft" id="section-6.2.1-2.1">
<pre>
S01. If the top label S bit is different from 0 {
S02.   Discard the packet.
S03. }
S04. POP the top label.
S05. Copy the MPLS label stack in a CACHE entry associated with the
     interface IFACE-IN.
</pre>
</div>
<figcaption><a href="#figure-21" class="selfRef">Figure 21</a>:
<a href="#name-sid-processing-for-mpls-dyn" class="selfRef">SID processing for MPLS dynamic proxy</a>
            </figcaption></figure>
</div>
<p id="section-6.2.1-3">S01: As mentioned at the beginning of <a href="#sec-proxies" class="xref">Section 6</a>, an SR proxy is not needed to include an SR-unaware service at the end of an SR policy.<a href="#section-6.2.1-3" class="pilcrow">¶</a></p>
<p id="section-6.2.1-4">S05: An implementation may optimize the caching procedure by copying information
into the cache only if it is different from the current content of the cache
entry. Furthermore, a TTL margin can be configured for the top label stack entry
to prevent constant cache updates when multiple equal-cost paths with different
hop counts are used towards the SR proxy node.  In that case, a TTL difference
smaller than the configured margin should not trigger a cache update (provided
that the labels are the same).<a href="#section-6.2.1-4" class="pilcrow">¶</a></p>
<p id="section-6.2.1-5">When processing an Ethernet frame, an IPv4 packet or an IPv6 packet received on
the interface IFACE-IN and with a destination address that does not match any
address of IFACE-IN, the pseudocode reported in
<a href="#code-static-mpls-eth-inbound" class="xref">Figure 7</a>, <a href="#code-static-mpls-ipv4-inbound" class="xref">Figure 9</a> or
<a href="#code-static-mpls-ipv6-inbound" class="xref">Figure 11</a>, respectively, is executed.<a href="#section-6.2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="srv6-pseudocode">
<section id="section-6.2.2">
          <h4 id="name-srv6-pseudocode-2">
<a href="#section-6.2.2" class="section-number selfRef">6.2.2. </a><a href="#name-srv6-pseudocode-2" class="section-name selfRef">SRv6 Pseudocode</a>
          </h4>
<p id="section-6.2.2-1">When processing an IPv6 packet matching a FIB entry locally instantiated as an
SRv6 dynamic proxy SID, the same pseudocode as described in
<a href="#code-static-srv6-eth-sid" class="xref">Figure 12</a>, <a href="#code-static-srv6-ipv4-sid" class="xref">Figure 15</a> and
<a href="#code-static-srv6-ipv6-sid" class="xref">Figure 18</a>, respectively for Ethernet, IPv4 and IPv6 traffic,
is executed with the following addition between lines S17 and S18.<a href="#section-6.2.2-1" class="pilcrow">¶</a></p>
<span id="name-sid-processing-for-srv6-dyn"></span><div id="code-dynamic-srv6-sid">
<figure id="figure-22">
            <div class="artwork art-text alignLeft" id="section-6.2.2-2.1">
<pre>
(... S17.     })
S17.1.   Copy the IPv6 encapsulation in a CACHE entry associated with
         the interface IFACE-IN.
(S18.     Perform IPv6 decapsulation...)
</pre>
</div>
<figcaption><a href="#figure-22" class="selfRef">Figure 22</a>:
<a href="#name-sid-processing-for-srv6-dyn" class="selfRef">SID processing for SRv6 dynamic proxy</a>
            </figcaption></figure>
</div>
<p id="section-6.2.2-3">An implementation may optimize the caching procedure by copying information into
the cache only if it is different from the current content of the cache entry.
A Hop Limit margin can be configured to prevent constant cache updates when
multiple equal-cost paths with different hop counts are used towards the SR
proxy node.  In that case, a Hop Limit difference smaller than the configured
margin should not trigger a cache update. Similarly, the Flow Label value can be
ignored when comparing the current packet IPv6 header with the cache entry. In
this case, the Flow Label should be re-computed by the proxy node when it
restores the IPv6 encapsulation from the cache entry.<a href="#section-6.2.2-3" class="pilcrow">¶</a></p>
<p id="section-6.2.2-4">When processing the Upper-layer header of a packet matching a FIB entry locally
instantiated as an SRv6 dynamic proxy SID, process the packet as per
<span>[<a href="#RFC8986" class="xref">RFC8986</a>]</span> Section 4.1.1.<a href="#section-6.2.2-4" class="pilcrow">¶</a></p>
<p id="section-6.2.2-5">When processing an Ethernet frame, an IPv4 packet or an IPv6 packet received on
the interface IFACE-IN and with a destination address that does not match any
address of IFACE-IN, the same pseudocode as in <a href="#code-static-srv6-eth-inbound" class="xref">Figure 14</a>,
<a href="#code-static-srv6-ipv4-inbound" class="xref">Figure 17</a> or <a href="#code-static-srv6-ipv6-inbound" class="xref">Figure 20</a>,
respectively, is executed.<a href="#section-6.2.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="shared-memory-sr-proxy">
<section id="section-6.3">
        <h3 id="name-shared-memory-sr-proxy">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-shared-memory-sr-proxy" class="section-name selfRef">Shared Memory SR Proxy</a>
        </h3>
<p id="section-6.3-1">The shared memory proxy is an SR endpoint behavior for processing SR-MPLS or SRv6 encapsulated traffic on behalf of an SR-unaware service. This proxy behavior leverages a shared-memory interface with a virtualized service (VNF) in order to hide the SR information from an SR-unaware service while keeping it attached to the packet.  We assume in this case that the proxy and the VNF are running on the same compute node.  A typical scenario is an SR-capable vrouter running on a container host and forwarding traffic to VNFs isolated within their respective container.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="masquerading-sr-proxy">
<section id="section-6.4">
        <h3 id="name-masquerading-sr-proxy">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-masquerading-sr-proxy" class="section-name selfRef">Masquerading SR Proxy</a>
        </h3>
<p id="section-6.4-1">The masquerading proxy is an SR endpoint behavior for processing SRv6 traffic on behalf of an SR-unaware service.  This proxy thus receives SR traffic that is formed of an IPv6 header and an SRH on top of an inner payload.  The masquerading behavior is independent from the inner payload type.  Hence, the inner payload can be of any type but it is usually expected to be a transport layer packet, such as TCP or UDP.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<p id="section-6.4-2">A masquerading SR proxy segment is associated with the following mandatory parameters:<a href="#section-6.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.4-3.1">NH-ADDR: Next hop Ethernet address<a href="#section-6.4-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.4-3.2">IFACE-OUT: Local interface for sending traffic towards the service<a href="#section-6.4-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.4-3.3">IFACE-IN: Local interface receiving the traffic coming back from the service<a href="#section-6.4-3.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.4-4">A masquerading SR proxy segment is thus defined for a specific service and bound to a pair of directed interfaces or sub-interfaces on the proxy.  As opposed to the static and dynamic SR proxies, a masquerading segment can be present at the same time in any number of SR service policies and the same interfaces can be bound to multiple masquerading proxy segments.  The only restriction is that a masquerading proxy segment cannot be the last segment in an SR service policy.<a href="#section-6.4-4" class="pilcrow">¶</a></p>
<p id="section-6.4-5">The first part of the masquerading behavior is triggered when the proxy node receives an IPv6 packet whose Destination Address matches a masquerading proxy SID.  The proxy inspects the IPv6 extension headers and substitutes the Destination Address with the last SID in the SRH attached to the IPv6 header, which represents the final destination of the IPv6 packet.  The packet is then sent out towards the service.<a href="#section-6.4-5" class="pilcrow">¶</a></p>
<p id="section-6.4-6">The service receives an IPv6 packet whose source and destination addresses are respectively the original source and final destination.  It does not attempt to inspect the SRH, as RFC8200 specifies that routing extension headers are not examined or processed by transit nodes. Instead, the service simply forwards the packet based on its current Destination Address.  In this scenario, we assume that the service can only inspect, drop or perform limited changes to the packets.  For example, Intrusion Detection Systems, Deep Packet Inspectors and non-NAT Firewalls are among the services that can be supported by a masquerading SR proxy.  Flavors of the masquerading behavior are defined in <a href="#sec-proxies-am-nat" class="xref">Section 6.4.2</a> and <a href="#sec-proxies-am-cache" class="xref">Section 6.4.3</a> to support a wider range of services.<a href="#section-6.4-6" class="pilcrow">¶</a></p>
<p id="section-6.4-7">The second part of the masquerading behavior, also called de-masquerading, is an inbound policy attached to the proxy interface receiving the traffic returning from the service, IFACE-IN.  This policy inspects the incoming traffic and triggers a regular SRv6 endpoint processing (End) on any IPv6 packet that contains an SRH.  This processing occurs before any lookup on the packet Destination Address is performed and it is sufficient to restore the right active SID as the Destination Address of the IPv6 packet.<a href="#section-6.4-7" class="pilcrow">¶</a></p>
<div id="srv6-masquerading-proxy-pseudocode">
<section id="section-6.4.1">
          <h4 id="name-srv6-masquerading-proxy-pse">
<a href="#section-6.4.1" class="section-number selfRef">6.4.1. </a><a href="#name-srv6-masquerading-proxy-pse" class="section-name selfRef">SRv6 Masquerading Proxy Pseudocode</a>
          </h4>
<p id="section-6.4.1-1">Masquerading: When processing an IPv6 packet matching a FIB entry locally
instantiated as an SRv6 masquerading proxy SID, the following pseudocode is
executed.<a href="#section-6.4.1-1" class="pilcrow">¶</a></p>
<span id="name-sid-processing-for-srv6-mas"></span><div id="code-masquerading-sid">
<figure id="figure-23">
            <div class="artwork art-text alignLeft" id="section-6.4.1-2.1">
<pre>
S01. When an SRH is processed {
S02.   If (Segments Left == 0) {
S03.     Proceed to process the next header in the packet.
S04.   }
S05.   If (IPv6 Hop Limit &lt;= 1) {
S06.     Send an ICMP Time Exceeded message to the Source Address,
         Code 0 (hop limit exceeded in transit),
         Interrupt packet processing and discard the packet.
S07.   }
S08.   max_last_entry = (Hdr Ext Len / 2) - 1
S09.   If ((Last Entry &gt; max_last_entry) or
           (Segments Left &gt; (Last Entry + 1))) {
S10.     Send an ICMP Parameter Problem message to the Source Address,
         Code 0 (Erroneous header field encountered),
         Pointer set to the Segments Left field,
         Interrupt packet processing and discard the packet.
S11.   }
S12.   Decrement Hop Limit by 1.
S13.   Decrement Segments Left by 1.
S14.   Copy Segment List[0] from the SRH to the Destination Address
       of the IPv6 header.
S15.   Submit the packet to the IPv6 module for transmission on
       interface IFACE-OUT via NH-ADDR.
S16. }
</pre>
</div>
<figcaption><a href="#figure-23" class="selfRef">Figure 23</a>:
<a href="#name-sid-processing-for-srv6-mas" class="selfRef">SID processing for SRv6 masquerading proxy</a>
            </figcaption></figure>
</div>
<p id="section-6.4.1-3">When processing the Upper-layer header of a packet matching a FIB entry locally
instantiated as an SRv6 masquerading proxy SID, process the packet as per
<span>[<a href="#RFC8986" class="xref">RFC8986</a>]</span> Section 4.1.1.<a href="#section-6.4.1-3" class="pilcrow">¶</a></p>
<p id="section-6.4.1-4">De-masquerading: When processing an IPv6 packet received on the interface
IFACE-IN and with a destination address that does not match any address of
IFACE-IN, the following pseudocode is executed.<a href="#section-6.4.1-4" class="pilcrow">¶</a></p>
<span id="name-inbound-policy-for-srv6-mas"></span><div id="code-masquerading-inbound">
<figure id="figure-24">
            <div class="artwork art-text alignLeft" id="section-6.4.1-5.1">
<pre>
S01. When an SRH is processed {
S02.   If (IPv6 Hop Limit &lt;= 1) {
S03.     Send an ICMP Time Exceeded message to the Source Address,
         Code 0 (hop limit exceeded in transit),
         Interrupt packet processing and discard the packet.
S04.   }
S05.   If (Segments Left != 0) {
S06.     max_last_entry = (Hdr Ext Len / 2) - 1
S07.     If ((Last Entry &gt; max_last_entry) or
             (Segments Left &gt; Last Entry)) {
S08.       Send an ICMP Parameter Problem message to the Source Address,
           Code 0 (Erroneous header field encountered),
           Pointer set to the Segments Left field,
           Interrupt packet processing and discard the packet.
S09.     }
S10.     Copy Segment List[Segments Left] from the SRH to the
         Destination Address of the IPv6 header.
S11.   }
S12.   Decrement Hop Limit by 1.
S13.   Submit the packet to the IPv6 module for transmission to the
       next destination.
S14. }
</pre>
</div>
<figcaption><a href="#figure-24" class="selfRef">Figure 24</a>:
<a href="#name-inbound-policy-for-srv6-mas" class="selfRef">Inbound policy for SRv6 masquerading proxy</a>
            </figcaption></figure>
</div>
</section>
</div>
<div id="sec-proxies-am-nat">
<section id="section-6.4.2">
          <h4 id="name-destination-nat-flavor">
<a href="#section-6.4.2" class="section-number selfRef">6.4.2. </a><a href="#name-destination-nat-flavor" class="section-name selfRef">Destination NAT Flavor</a>
          </h4>
<p id="section-6.4.2-1">Services modifying the destination address in the packets they process, such as
NATs, can be supported by reporting the updated Destination Address back into
the Segment List field of the SRH.<a href="#section-6.4.2-1" class="pilcrow">¶</a></p>
<p id="section-6.4.2-2">The Destination NAT flavor of the SRv6 masquerading proxy is enabled by adding
the following instruction between lines S09 and S10 of the de-masquerading
pseudocode in <a href="#code-masquerading-inbound" class="xref">Figure 24</a>.<a href="#section-6.4.2-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.4.2-3">
<pre>
(... S09.     })
S09.1.   Copy the Destination Address of the IPv6 header to the
         Segment List[0] entry of the SRH.
(S10.     Copy Segment List[Segments Left] from the SRH to the
          Destination Address of the IPv6 header...)
</pre><a href="#section-6.4.2-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sec-proxies-am-cache">
<section id="section-6.4.3">
          <h4 id="name-caching-flavor">
<a href="#section-6.4.3" class="section-number selfRef">6.4.3. </a><a href="#name-caching-flavor" class="section-name selfRef">Caching Flavor</a>
          </h4>
<p id="section-6.4.3-1">Services generating packets or acting as endpoints for transport connections can be supported by adding a dynamic caching mechanism similar to the one described in <a href="#sec-proxies-dynamic" class="xref">Section 6.2</a>.<a href="#section-6.4.3-1" class="pilcrow">¶</a></p>
<p id="section-6.4.3-2">The caching flavor of the SRv6 masquerading proxy is enabled by:<a href="#section-6.4.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.4.3-3.1">Adding the following instruction between lines S14 and S15 of the masquerading
pseudocode in <a href="#code-masquerading-sid" class="xref">Figure 23</a>.<a href="#section-6.4.3-3.1" class="pilcrow">¶</a>
</li>
          </ul>
<div class="artwork art-text alignLeft" id="section-6.4.3-4">
<pre>
(... S14.   Copy Segment List[0] from the SRH to the Destination
            Address of the IPv6 header.
S14.1. Copy the IPv6 encapsulation in a CACHE entry associated with
       the interface IFACE-IN.
(S15.   Submit the packet to the IPv6 module for transmission on
        interface IFACE-OUT via NH-ADDR.)
</pre><a href="#section-6.4.3-4" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-6.4.3-5.1">Updating the de-masquerading pseudocode such that, in addition to the SRH
processing in <a href="#code-masquerading-inbound" class="xref">Figure 24</a>, the following pseudocode is
executed when processing an IPv6 packet (received on the interface IFACE-IN and
with a destination address that does not match any address of IFACE-IN) that
does not contain an SRH.<a href="#section-6.4.3-5.1" class="pilcrow">¶</a>
</li>
          </ul>
<div class="artwork art-text alignLeft" id="section-6.4.3-6">
<pre>
S01. Retrieve the CACHE entry associated with IFACE-IN.
S02. If the CACHE entry is not empty {
S03.   If (IPv6 Hop Limit &lt;= 1) {
S04.     Send an ICMP Time Exceeded message to the Source Address,
         Code 0 (hop limit exceeded in transit),
         Interrupt packet processing and discard the packet.
S05.   }
S06.   Decrement Hop Limit by 1.
S07.   Update the IPv6 encapsulation according to the retrieved CACHE
       entry.
S08.   Submit the packet to the IPv6 module for transmission to the
       next destination.
S09. }
</pre><a href="#section-6.4.3-6" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="metadata">
<section id="section-7">
      <h2 id="name-metadata">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-metadata" class="section-name selfRef">Metadata</a>
      </h2>
<div id="mpls-data-plane">
<section id="section-7.1">
        <h3 id="name-mpls-data-plane">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-mpls-data-plane" class="section-name selfRef">MPLS Data Plane</a>
        </h3>
<p id="section-7.1-1">Metadata can be carried for SR-MPLS traffic in a Segment Routing Header inserted between the last MPLS label and the MPLS payload. When used solely as a metadata container, the SRH does not carry any segment but only the mandatory header fields, including the tag and flags, and any TLVs that is required for transporting the metadata.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">Since the MPLS encapsulation has no explicit protocol identifier field to indicate the protocol type of the MPLS payload, how to indicate the presence of metadata in an MPLS packet is a potential issue to be addressed.  One possible solution is to add the indication about the presence of metadata in the semantic of the SIDs. Note that only the SIDs whose behavior involves looking at the metadata or the MPLS payload would need to include such semantic (e.g., service segments). Other segments, such as topological segments, are not affected by the presence of metadata.  Another, more generic, solution is to introduce a protocol identifier field within the MPLS packet as described in <span>[<a href="#I-D.xu-mpls-payload-protocol-identifier" class="xref">I-D.xu-mpls-payload-protocol-identifier</a>]</span>.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ipv6-data-plane">
<section id="section-7.2">
        <h3 id="name-ipv6-data-plane">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-ipv6-data-plane" class="section-name selfRef">IPv6 Data Plane</a>
        </h3>
<div id="srh-tlv-objects">
<section id="section-7.2.1">
          <h4 id="name-srh-tlv-objects">
<a href="#section-7.2.1" class="section-number selfRef">7.2.1. </a><a href="#name-srh-tlv-objects" class="section-name selfRef">SRH TLV Objects</a>
          </h4>
<p id="section-7.2.1-1">The IPv6 SRH TLV objects are designed to carry all sorts of metadata. TLV objects can be imposed by the ingress edge router that steers the traffic into the SR service policy.<a href="#section-7.2.1-1" class="pilcrow">¶</a></p>
<p id="section-7.2.1-2">An SR-aware service may impose, modify or remove any TLV object attached to the first SRH, either by directly modifying the packet headers or via a control channel between the service and its forwarding plane.<a href="#section-7.2.1-2" class="pilcrow">¶</a></p>
<p id="section-7.2.1-3">An SR-aware service that re-classifies the traffic and steers it into a new SR service policy (e.g.  DPI) may attach any TLV object to the new SRH.<a href="#section-7.2.1-3" class="pilcrow">¶</a></p>
<p id="section-7.2.1-4">Metadata imposition and handling will be further discussed in a future version of this document.<a href="#section-7.2.1-4" class="pilcrow">¶</a></p>
<div id="opaque-metadata-tlv">
<section id="section-7.2.1.1">
            <h5 id="name-opaque-metadata-tlv">
<a href="#section-7.2.1.1" class="section-number selfRef">7.2.1.1. </a><a href="#name-opaque-metadata-tlv" class="section-name selfRef">Opaque Metadata TLV</a>
            </h5>
<p id="section-7.2.1.1-1">This document defines an SRv6 TLV called Opaque Metadata TLV. This is a fixed-length container to carry any type of Service Metadata. No assumption is made by this document on the structure or the content of the carried metadata. The Opaque Metadata TLV has the following format:<a href="#section-7.2.1.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-7.2.1.1-2">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      Type     |     Length    |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
|                                                               |
|                       Service Metadata                        |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-7.2.1.1-2" class="pilcrow">¶</a>
</div>
<p id="section-7.2.1.1-3">where:<a href="#section-7.2.1.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.1.1-4.1">Type: to be assigned by IANA.<a href="#section-7.2.1.1-4.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-7.2.1.1-4.2">Length: 14.<a href="#section-7.2.1.1-4.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-7.2.1.1-4.3">Service Metadata: 14 octets of opaque data.<a href="#section-7.2.1.1-4.3" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="nsh-carrier-tlv">
<section id="section-7.2.1.2">
            <h5 id="name-nsh-carrier-tlv">
<a href="#section-7.2.1.2" class="section-number selfRef">7.2.1.2. </a><a href="#name-nsh-carrier-tlv" class="section-name selfRef">NSH Carrier TLV</a>
            </h5>
<p id="section-7.2.1.2-1">This document defines an SRv6 TLV called NSH Carrier TLV. It is a container to carry Service Metadata in the form of Variable-Length Metadata as defined in <span>[<a href="#RFC8300" class="xref">RFC8300</a>]</span> for NSH MD Type 2. The NSH Carrier TLV has the following format:<a href="#section-7.2.1.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-7.2.1.2-2">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      Type     |     Length    |     Flags     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
//            Service Metadata                                 //
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-7.2.1.2-2" class="pilcrow">¶</a>
</div>
<p id="section-7.2.1.2-3">where:<a href="#section-7.2.1.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.1.2-4.1">Type: to be assigned by IANA.<a href="#section-7.2.1.2-4.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-7.2.1.2-4.2">Length: the total length of the TLV.<a href="#section-7.2.1.2-4.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-7.2.1.2-4.3">Flags: 8 bits.  No flags are defined in this document.  SHOULD be set to 0 on transmission and MUST be ignored on receipt.<a href="#section-7.2.1.2-4.3" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-7.2.1.2-4.4">Service Metadata: a list of Service Metadata TLV as defined in <span>[<a href="#RFC8300" class="xref">RFC8300</a>]</span> for NSH MD Type 2.<a href="#section-7.2.1.2-4.4" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
</section>
</div>
<div id="srh-tag">
<section id="section-7.2.2">
          <h4 id="name-srh-tag">
<a href="#section-7.2.2" class="section-number selfRef">7.2.2. </a><a href="#name-srh-tag" class="section-name selfRef">SRH Tag</a>
          </h4>
<p id="section-7.2.2-1">The SRH tag identifies a packet as part of a group or class of packets <span>[<a href="#RFC8754" class="xref">RFC8754</a>]</span>.<a href="#section-7.2.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2.2-2">In the context of service programming, this field can be used to encode basic metadata in the SRH. An example use-case is to leverage the SRH tag to encode a policy ID. This policy ID can then be used by an SR-aware function to identify a particular processing policy to be applied on that packet.<a href="#section-7.2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="implementation-status">
<section id="section-8">
      <h2 id="name-implementation-status">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-implementation-status" class="section-name selfRef">Implementation Status</a>
      </h2>
<p id="section-8-1">This section is to be removed prior to publishing as an RFC.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="sec-implem-aware">
<section id="section-8.1">
        <h3 id="name-sr-aware-services-2">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-sr-aware-services-2" class="section-name selfRef">SR-Aware Services</a>
        </h3>
<p id="section-8.1-1">Specific SRv6 support has been implemented for the below open-source services:<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1-2.1">Iptables (1.6.2 and later) <span>[<a href="#IPTABLES" class="xref">IPTABLES</a>]</span><a href="#section-8.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.1-2.2">Nftables (0.8.4 and later) <span>[<a href="#NFTABLES" class="xref">NFTABLES</a>]</span><a href="#section-8.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.1-2.3">Snort <span>[<a href="#SNORT" class="xref">SNORT</a>]</span><a href="#section-8.1-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-8.1-3">In addition, any service relying on the Linux kernel, version 4.10 and later, or FD.io VPP for packet forwarding can be considered as SR-aware.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="proxy-behaviors">
<section id="section-8.2">
        <h3 id="name-proxy-behaviors">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-proxy-behaviors" class="section-name selfRef">Proxy Behaviors</a>
        </h3>
<p id="section-8.2-1">The static SR proxy is available for SR-MPLS and SRv6 on various Cisco hardware and software platforms.  Furthermore, the following proxies are available on open-source software.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<span id="name-open-source-implementation-"></span><div id="tab-implem">
<figure id="figure-25">
          <div class="artwork art-text alignLeft" id="section-8.2-2.1">
<pre>
                                        +-------------+-------------+
                                        |     VPP     |    Linux    |
+---+-----------------------------------+-------------+-------------+
| M |           Static proxy            |  Available  | In progress |
| P |                                   |             |             |
| L |           Dynamic proxy           | In progress | In progress |
| S |                                   |             |             |
|   |        Shared memory proxy        | In progress | In progress |
+---+-----------------------------------+-------------+-------------+
|   |           Static proxy            |  Available  | In progress |
| S |                                   |             |             |
| R |           Dynamic proxy           |  Available  |  Available  |
| v |                                   |             |             |
| 6 |        Shared memory proxy        | In progress | In progress |
|   |                                   |             |             |
|   |        Masquerading proxy         |  Available  |  Available  |
+---+-----------------------------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-25" class="selfRef">Figure 25</a>:
<a href="#name-open-source-implementation-" class="selfRef">Open-source implementation status table</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="related-works">
<section id="section-9">
      <h2 id="name-related-works">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-related-works" class="section-name selfRef">Related Works</a>
      </h2>
<p id="section-9-1">The Segment Routing solution addresses a wide problem that covers both topological and service policies.  The topological and service instructions can be either deployed in isolation or in combination.  SR has thus a wider applicability than the architecture defined in <span>[<a href="#RFC7665" class="xref">RFC7665</a>]</span>.  Furthermore, the inherent property of SR is a stateless network fabric.  In SR, there is no state within the fabric to recognize a flow and associate it with a policy.  State is only present at the ingress edge of the SR domain, where the policy is encoded into the packets.  This is completely different from other proposals such as <span>[<a href="#RFC8300" class="xref">RFC8300</a>]</span> and the MPLS label swapping mechanism described in <span>[<a href="#RFC8595" class="xref">RFC8595</a>]</span>, which rely on state configured at every hop of the service chain.<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="srv6-endpoint-behaviors">
<section id="section-10.1">
        <h3 id="name-srv6-endpoint-behaviors">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-srv6-endpoint-behaviors" class="section-name selfRef">SRv6 Endpoint Behaviors</a>
        </h3>
<p id="section-10.1-1">This I-D requests the IANA to allocate, within the "SRv6 Endpoint Behaviors" sub-registry belonging to the top-level "Segment-routing with IPv6 dataplane (SRv6) Parameters" registry, the following allocations:<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-10.1-2">
<pre>
Value      Description                               Reference
--------------------------------------------------------------
TBA1-1     End.AN - SR-aware function (native)       [This.ID]
TBA1-2     End.AS - Static proxy                     [This.ID]
TBA1-3     End.AD - Dynamic proxy                    [This.ID]
TBA1-4     End.AM - Masquerading proxy               [This.ID]
TBA1-5     End.AM - Masquerading proxy with NAT      [This.ID]
TBA1-6     End.AM - Masquerading proxy with Caching  [This.ID]
TBA1-7     End.AM - Masquerading proxy with NAT &amp;    [This.ID]
                    Caching
</pre><a href="#section-10.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="segment-routing-header-tlvs">
<section id="section-10.2">
        <h3 id="name-segment-routing-header-tlvs">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-segment-routing-header-tlvs" class="section-name selfRef">Segment Routing Header TLVs</a>
        </h3>
<p id="section-10.2-1">This I-D requests the IANA to allocate, within the "Segment Routing Header TLVs" registry, the following allocations:<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-10.2-2">
<pre>
Value      Description               Reference
----------------------------------------------
TBA2-1     Opaque Metadata TLV       [This.ID]
TBA2-2     NSH Carrier TLV           [This.ID]
</pre><a href="#section-10.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-11">
      <h2 id="name-security-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-11-1">The security requirements and mechanisms described in <span>[<a href="#RFC8402" class="xref">RFC8402</a>]</span>, <span>[<a href="#RFC8754" class="xref">RFC8754</a>]</span> and <span>[<a href="#RFC8986" class="xref">RFC8986</a>]</span> also apply to this document.<a href="#section-11-1" class="pilcrow">¶</a></p>
<p id="section-11-2">This document does not introduce any new security vulnerabilities.<a href="#section-11-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="acknowledgements">
<section id="section-12">
      <h2 id="name-acknowledgements">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-12-1">The authors would like to thank Thierry Couture, Ketan Talaulikar, Loa Andersson, Andrew G.  Malis, Adrian Farrel, Alexander Vainshtein and Joel M.  Halpern for their valuable comments and suggestions on the document.<a href="#section-12-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="contributors">
<section id="section-13">
      <h2 id="name-contributors">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<p id="section-13-1">The following people have contributed to this document:<a href="#section-13-1" class="pilcrow">¶</a></p>
<p id="section-13-2">Pablo Camarillo
Cisco Systems, Inc.
Spain<a href="#section-13-2" class="pilcrow">¶</a></p>
<p id="section-13-3">Email: pcamaril@cisco.com<a href="#section-13-3" class="pilcrow">¶</a></p>
<p id="section-13-4">Bart Peirens
Proximus
Belgium<a href="#section-13-4" class="pilcrow">¶</a></p>
<p id="section-13-5">Email: bart.peirens@proximus.com<a href="#section-13-5" class="pilcrow">¶</a></p>
<p id="section-13-6">Dirk Steinberg
Lapishills Consulting Limited
Cyprus<a href="#section-13-6" class="pilcrow">¶</a></p>
<p id="section-13-7">Email: dirk@lapishills.com<a href="#section-13-7" class="pilcrow">¶</a></p>
<p id="section-13-8">Ahmed AbdelSalam
Cisco Systems, Inc.
Italy<a href="#section-13-8" class="pilcrow">¶</a></p>
<p id="section-13-9">Email: ahabdels@cisco.com<a href="#section-13-9" class="pilcrow">¶</a></p>
<p id="section-13-10">Gaurav Dawra
LinkedIn
United States of America<a href="#section-13-10" class="pilcrow">¶</a></p>
<p id="section-13-11">Email: gdawra@linkedin.com<a href="#section-13-11" class="pilcrow">¶</a></p>
<p id="section-13-12">Stewart Bryant
Futurewei Technologies Inc<a href="#section-13-12" class="pilcrow">¶</a></p>
<p id="section-13-13">Email: stewart.bryant@gmail.com<a href="#section-13-13" class="pilcrow">¶</a></p>
<p id="section-13-14">Hamid Assarpour
Broadcom<a href="#section-13-14" class="pilcrow">¶</a></p>
<p id="section-13-15">Email: hamid.assarpour@broadcom.com<a href="#section-13-15" class="pilcrow">¶</a></p>
<p id="section-13-16">Himanshu Shah
Ciena<a href="#section-13-16" class="pilcrow">¶</a></p>
<p id="section-13-17">Email: hshah@ciena.com<a href="#section-13-17" class="pilcrow">¶</a></p>
<p id="section-13-18">Luis M. Contreras
Telefonica I+D
Spain<a href="#section-13-18" class="pilcrow">¶</a></p>
<p id="section-13-19">Email: luismiguel.contrerasmurillo@telefonica.com<a href="#section-13-19" class="pilcrow">¶</a></p>
<p id="section-13-20">Jeff Tantsura
Individual<a href="#section-13-20" class="pilcrow">¶</a></p>
<p id="section-13-21">Email: jefftant@gmail.com<a href="#section-13-21" class="pilcrow">¶</a></p>
<p id="section-13-22">Martin Vigoureux
Nokia<a href="#section-13-22" class="pilcrow">¶</a></p>
<p id="section-13-23">Email: martin.vigoureux@nokia.com<a href="#section-13-23" class="pilcrow">¶</a></p>
<p id="section-13-24">Jisu Bhattacharya
Cisco Systems, Inc.
United States of America<a href="#section-13-24" class="pilcrow">¶</a></p>
<p id="section-13-25">Email: jisu@cisco.com<a href="#section-13-25" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-14">
      <h2 id="name-references">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-14.1">
        <h3 id="name-normative-references">
<a href="#section-14.1" class="section-number selfRef">14.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-spring-segment-routing-policy">[I-D.ietf-spring-segment-routing-policy]</dt>
        <dd>
<span class="refAuthor">Filsfils, C.</span>, <span class="refAuthor">Talaulikar, K.</span>, <span class="refAuthor">Voyer, D.</span>, <span class="refAuthor">Bogdanov, A.</span>, and <span class="refAuthor">P. Mattes</span>, <span class="refTitle">"Segment Routing Policy Architecture"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-spring-segment-routing-policy-13</span>, <time datetime="2021-05-28" class="refDate">28 May 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-spring-segment-routing-policy-13.txt">https://www.ietf.org/archive/id/draft-ietf-spring-segment-routing-policy-13.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8402">[RFC8402]</dt>
        <dd>
<span class="refAuthor">Filsfils, C., Ed.</span>, <span class="refAuthor">Previdi, S., Ed.</span>, <span class="refAuthor">Ginsberg, L.</span>, <span class="refAuthor">Decraene, B.</span>, <span class="refAuthor">Litkowski, S.</span>, and <span class="refAuthor">R. Shakir</span>, <span class="refTitle">"Segment Routing Architecture"</span>, <span class="seriesInfo">RFC 8402</span>, <span class="seriesInfo">DOI 10.17487/RFC8402</span>, <time datetime="2018-07" class="refDate">July 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8402">https://www.rfc-editor.org/info/rfc8402</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8660">[RFC8660]</dt>
        <dd>
<span class="refAuthor">Bashandy, A., Ed.</span>, <span class="refAuthor">Filsfils, C., Ed.</span>, <span class="refAuthor">Previdi, S.</span>, <span class="refAuthor">Decraene, B.</span>, <span class="refAuthor">Litkowski, S.</span>, and <span class="refAuthor">R. Shakir</span>, <span class="refTitle">"Segment Routing with the MPLS Data Plane"</span>, <span class="seriesInfo">RFC 8660</span>, <span class="seriesInfo">DOI 10.17487/RFC8660</span>, <time datetime="2019-12" class="refDate">December 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8660">https://www.rfc-editor.org/info/rfc8660</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8754">[RFC8754]</dt>
        <dd>
<span class="refAuthor">Filsfils, C., Ed.</span>, <span class="refAuthor">Dukes, D., Ed.</span>, <span class="refAuthor">Previdi, S.</span>, <span class="refAuthor">Leddy, J.</span>, <span class="refAuthor">Matsushima, S.</span>, and <span class="refAuthor">D. Voyer</span>, <span class="refTitle">"IPv6 Segment Routing Header (SRH)"</span>, <span class="seriesInfo">RFC 8754</span>, <span class="seriesInfo">DOI 10.17487/RFC8754</span>, <time datetime="2020-03" class="refDate">March 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8754">https://www.rfc-editor.org/info/rfc8754</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8986">[RFC8986]</dt>
      <dd>
<span class="refAuthor">Filsfils, C., Ed.</span>, <span class="refAuthor">Camarillo, P., Ed.</span>, <span class="refAuthor">Leddy, J.</span>, <span class="refAuthor">Voyer, D.</span>, <span class="refAuthor">Matsushima, S.</span>, and <span class="refAuthor">Z. Li</span>, <span class="refTitle">"Segment Routing over IPv6 (SRv6) Network Programming"</span>, <span class="seriesInfo">RFC 8986</span>, <span class="seriesInfo">DOI 10.17487/RFC8986</span>, <time datetime="2021-02" class="refDate">February 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8986">https://www.rfc-editor.org/info/rfc8986</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-14.2">
        <h3 id="name-informative-references">
<a href="#section-14.2" class="section-number selfRef">14.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.dawra-idr-bgp-sr-service-chaining">[I-D.dawra-idr-bgp-sr-service-chaining]</dt>
        <dd>
<span class="refAuthor">Dawra, G.</span>, <span class="refAuthor">Filsfils, C.</span>, <span class="refAuthor">Bernier, D.</span>, <span class="refAuthor">Uttaro, J.</span>, <span class="refAuthor">Decraene, B.</span>, <span class="refAuthor">Elmalky, H.</span>, <span class="refAuthor">Xu, X.</span>, <span class="refAuthor">Clad, F.</span>, and <span class="refAuthor">K. Talaulikar</span>, <span class="refTitle">"BGP Control Plane Extensions for Segment Routing based Service Chaining"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-dawra-idr-bgp-sr-service-chaining-02</span>, <time datetime="2018-01-04" class="refDate">4 January 2018</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-dawra-idr-bgp-sr-service-chaining-02.txt">https://www.ietf.org/archive/id/draft-dawra-idr-bgp-sr-service-chaining-02.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.xu-mpls-payload-protocol-identifier">[I-D.xu-mpls-payload-protocol-identifier]</dt>
        <dd>
<span class="refAuthor">Xu, X.</span>, <span class="refAuthor">Assarpour, H.</span>, <span class="refAuthor">Ma, S.</span>, and <span class="refAuthor">F. Clad</span>, <span class="refTitle">"MPLS Payload Protocol Identifier"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-xu-mpls-payload-protocol-identifier-09</span>, <time datetime="2021-09-02" class="refDate">2 September 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-xu-mpls-payload-protocol-identifier-09.txt">https://www.ietf.org/archive/id/draft-xu-mpls-payload-protocol-identifier-09.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IFIP18">[IFIP18]</dt>
        <dd>
<span class="refAuthor">Abdelsalam, A.</span>, <span class="refAuthor">Salsano, S.</span>, <span class="refAuthor">Clad, F.</span>, <span class="refAuthor">Camarillo, P.</span>, and <span class="refAuthor">C. Filsfils</span>, <span class="refTitle">"SEgment Routing Aware Firewall For Service Function Chaining scenarios"</span>, <span class="seriesInfo">IFIP Networking conference </span>, <time datetime="2018-05" class="refDate">May 2018</time>. </dd>
<dd class="break"></dd>
<dt id="IPTABLES">[IPTABLES]</dt>
        <dd>
<span class="refTitle">"iptables-1.6.2 changes"</span>, <time datetime="2018-02" class="refDate">February 2018</time>, <span>&lt;<a href="https://netfilter.org/projects/iptables/files/changes-iptables-1.6.2.txt">https://netfilter.org/projects/iptables/files/changes-iptables-1.6.2.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NFTABLES">[NFTABLES]</dt>
        <dd>
<span class="refTitle">"nftables-0.8.4 changes"</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://netfilter.org/projects/nftables/files/changes-nftables-0.8.4.txt">https://netfilter.org/projects/nftables/files/changes-nftables-0.8.4.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7665">[RFC7665]</dt>
        <dd>
<span class="refAuthor">Halpern, J., Ed.</span> and <span class="refAuthor">C. Pignataro, Ed.</span>, <span class="refTitle">"Service Function Chaining (SFC) Architecture"</span>, <span class="seriesInfo">RFC 7665</span>, <span class="seriesInfo">DOI 10.17487/RFC7665</span>, <time datetime="2015-10" class="refDate">October 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7665">https://www.rfc-editor.org/info/rfc7665</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8300">[RFC8300]</dt>
        <dd>
<span class="refAuthor">Quinn, P., Ed.</span>, <span class="refAuthor">Elzur, U., Ed.</span>, and <span class="refAuthor">C. Pignataro, Ed.</span>, <span class="refTitle">"Network Service Header (NSH)"</span>, <span class="seriesInfo">RFC 8300</span>, <span class="seriesInfo">DOI 10.17487/RFC8300</span>, <time datetime="2018-01" class="refDate">January 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8300">https://www.rfc-editor.org/info/rfc8300</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8595">[RFC8595]</dt>
        <dd>
<span class="refAuthor">Farrel, A.</span>, <span class="refAuthor">Bryant, S.</span>, and <span class="refAuthor">J. Drake</span>, <span class="refTitle">"An MPLS-Based Forwarding Plane for Service Function Chaining"</span>, <span class="seriesInfo">RFC 8595</span>, <span class="seriesInfo">DOI 10.17487/RFC8595</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8595">https://www.rfc-editor.org/info/rfc8595</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SNORT">[SNORT]</dt>
      <dd>
<span class="refTitle">"SR-Snort"</span>, <time datetime="2018-03" class="refDate">March 2018</time>, <span>&lt;<a href="https://github.com/SRouting/SR-Snort">https://github.com/SRouting/SR-Snort</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Francois Clad (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems, Inc.</span></div>
<div dir="auto" class="left"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:fclad@cisco.com" class="email">fclad@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Xiaohu Xu (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Alibaba</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:xiaohu.xxh@alibaba-inc.com" class="email">xiaohu.xxh@alibaba-inc.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Clarence Filsfils</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems, Inc.</span></div>
<div dir="auto" class="left"><span class="country-name">Belgium</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:cf@cisco.com" class="email">cf@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Daniel Bernier</span></div>
<div dir="auto" class="left"><span class="org">Bell Canada</span></div>
<div dir="auto" class="left"><span class="country-name">Canada</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:daniel.bernier@bell.ca" class="email">daniel.bernier@bell.ca</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Cheng Li</span></div>
<div dir="auto" class="left"><span class="org">Huawei</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:chengli13@huawei.com" class="email">chengli13@huawei.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Bruno Decraene</span></div>
<div dir="auto" class="left"><span class="org">Orange</span></div>
<div dir="auto" class="left"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:bruno.decraene@orange.com" class="email">bruno.decraene@orange.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Shaowen Ma</span></div>
<div dir="auto" class="left"><span class="org">Mellanox</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mashaowen@gmail.com" class="email">mashaowen@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Chaitanya Yadlapalli</span></div>
<div dir="auto" class="left"><span class="org">AT&amp;T</span></div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:cy098d@att.com" class="email">cy098d@att.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Wim Henderickx</span></div>
<div dir="auto" class="left"><span class="org">Nokia</span></div>
<div dir="auto" class="left"><span class="country-name">Belgium</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:wim.henderickx@nokia.com" class="email">wim.henderickx@nokia.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Stefano Salsano</span></div>
<div dir="auto" class="left"><span class="org">Universita di Roma "Tor Vergata"</span></div>
<div dir="auto" class="left"><span class="country-name">Italy</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:stefano.salsano@uniroma2.it" class="email">stefano.salsano@uniroma2.it</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
