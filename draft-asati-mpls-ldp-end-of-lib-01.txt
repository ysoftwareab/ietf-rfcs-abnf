

Network Working Group                                        Rajiv Asati
Internet Draft                                       Cisco Systems, Inc.
Expiration Date: May 2008
                                                       Pradosh Mohapatra
                                                     Cisco Systems, Inc.

                                                              Bob Thomas
                                                     Cisco Systems, Inc.

                                                              Emily Chen
                                           Huawei Technologies Co., Ltd.

                                                           November 2007


                             LDP End-of-LIB


                 draft-asati-mpls-ldp-end-of-lib-01.txt

Status of this Memo

   By submitting this Internet-Draft, each author represents that any
   applicable patent or other IPR claims of which he or she is aware
   have been or will be disclosed, and any of which he or she becomes
   aware will be disclosed, in accordance with Section 6 of BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.









Asati, et al.                                                   [Page 1]

Internet Draft   draft-asati-mpls-ldp-end-of-lib-01.txt    November 2007


Copyright Notice

   Copyright (C) The IETF TRUST (2007).


Abstract

   There are situations following LDP session establishment where it
   would be useful for an LDP speaker to know when its peer has
   advertised all of its labels.  These include session establishment
   when LDP-IGP sync is in use and session re-establishment following
   loss of an LDP session when LDP graceful restart is in use.  The LDP
   specification provides no mechanism for an LDP speaker to notify a
   peer when it has completed its initial label advertisements to that
   peer.  This document specifies means for an LDP speaker to signal
   completion of its initial label advertisements following session
   establishment.



Table of Contents

    1     Introduction  .......................................   3
    2     Specification Language  .............................   3
    3     Unrecognized Notification Capability  ...............   3
    4     Signaling Completion of Label Advertisement  ........   4
    5     Usage Guidelines  ...................................   5
    5.1   IGP-Sync  ...........................................   5
    5.2   LDP Graceful Restart  ...............................   6
    5.3   Wildcard Label Request  .............................   6
    5.4   Missing Expected End-of-LIB Notifications  ..........   7
    6     IANA Considerations  ................................   7
    7     Security Considerations  ............................   7
    8     References  .........................................   7
    9     Author Information  .................................   8
   10     Intellectual Property Statement  ....................   9
   11     Full Copyright Statement  ...........................   9














Asati, et al.                                                   [Page 2]

Internet Draft   draft-asati-mpls-ldp-end-of-lib-01.txt    November 2007


1. Introduction

   There are situations following LDP session establishment where it
   would be useful for an LDP speaker to know when its peer has
   advertised all of its labels.  For example, when an LDP speaker is
   using LDP-IGP synchronization procedures [LDPSynch] it would be
   useful for the speaker to know when its peer has completed
   advertisement of its IP label bindings..  Similarly, after an LDP
   session is re-established when LDP Graceful Restart [RFC3478] is in
   effect it would be helpful for each peer to signal the other after it
   has advertised all its label bindings

   The LDP specification [RFC5036] provides no mechanism for an LDP
   speaker to notify a peer when it has completed its initial label
   advertisements to that peer.

   This document specifies use of a Notification message with the "End-
   of-LIB" Status Code for an LDP speaker to signal completion of its
   label advertisements following session establishment.

   RFC5036 implicitly assumes that new Status Codes will be defined over
   the course of time.  However, it does not explicitly define the
   behavior of an LDP speaker which does not understand the Status Code
   in a Notification message.  To avoid backward compatibility issues
   this document specifies use of the LDP capability mechanism [LDPCap]
   at session establishment time for informing a peer that an LDP
   speaker is capable of handling Notification messages that carry
   unrecognized Status Codes.


2. Specification Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].


3. Unrecognized Notification Capability

   An LDP speaker MAY include a Capability Parameter [LDPCap] in an
   Initialization message to inform a peer that it ignores Notification
   Messages that carry a Status TLV with a non-fatal Status Code unknown
   to it.

   The Capability Parameter for the Unrecognized Notification capability
   is a TLV with the following format:





Asati, et al.                                                   [Page 3]

Internet Draft   draft-asati-mpls-ldp-end-of-lib-01.txt    November 2007


       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |U|F| Unrecog Notif (IANA)      |            Length             |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |S| Reserved    |
      +-+-+-+-+-+-+-+-+

   where:

     U and F bits: As specified by RFC5036.

     Unrecog Notif: TLV code point to be assigned by IANA.

     S-bit: Must be 1 (indicates that capability is being advertised).

   Upon receiving a Notification with an unrecognized Status Code an LDP
   speaker MAY generate a console or system log message for trouble
   shooting purposes.


4. Signaling Completion of Label Advertisement

   An LDP speaker MAY signal completion of its label advertisements to a
   peer by means of a Notification message if its peer had advertised
   the Unrecognized Notification capability during session
   establishment.

   Such a Notification message MUST carry:

     - A Status TLV with TLV E- and F-bits set to zero that carries an
       "End-of-LIB" Status Code.  End-of-LIB is a new Status Code.

     - A FEC TLV with the Typed Wildcard FEC Element [TypedWC] that
       identifies the FEC type for which initial label advertisements
       have been completed.  In terms of Section 3.5.1 of RFC5036 this
       TLV is an "Optional Parameter" of the Notification message.

   An LDP speaker MUST NOT send a Notification which carries a Status
   TLV with the End-of-LIB Status Code unless its peer had advertised
   the Unrecognized Notification capability during session
   establishment.









Asati, et al.                                                   [Page 4]

Internet Draft   draft-asati-mpls-ldp-end-of-lib-01.txt    November 2007


5. Usage Guidelines

   The FEC's known to an LDP speaker and the labels the speaker has
   bound to those FEC's may change over the course of time.  This makes
   determining when an LDP speaker has advertised "all" of its label
   bindings for a given FEC type an issue.  Ultimately, this
   determination is a judgement call the LDP speaker makes.  The
   following guidelines may be useful.

   An LDP speaker is assumed to "know" a set of FEC's.  Depending on a
   variety of criteria, such as:

     - The label distribution control mode in use (Independent or
       Ordered);

     - The set of FEC's to which the speaker has bound local labels;

     - Configuration settings which may constrain which label bindings
       the speaker may advertise to peers;

   the speaker can determine the set of bindings for a given FEC type
   that it is permitted to advertise to a given peer.

   IGP-Sync, LDP Graceful Restart, and the response to a Wildcard Label
   Request [TypedWC] are situations that would benefit from End-of-LIB
   Notification.  In these situations after an LDP speaker completes its
   label binding advertisements to a peer it should send the peer an
   End-of-LIB Notification.  The following considers each of these
   situations in turn.


5.1. IGP-Sync

   LDP-IGP Sync is a mechanism directly connected LDP speakers may use
   to delay using the link connecting them for IP traffic until the
   labels required to support IP over MPLS traffic on the link have been
   learned.

   Without an End-of-LIB Notification the speaker must rely on some
   heuristic to determine when it has received all of its peer's label
   bindings.  The heuristic chosen could cause LDP to signal the IGP too
   soon in which case the likelihood that traffic will be dropped
   increases, or too late in which case traffic is kept on sub-optimal
   paths longer than necessary.

   Following session establishment with a directly connected peer that
   has advertised the Unrecognized Notification capability an LDP
   speaker using LDP-IGP Sync may send the peer an End-of-LIB



Asati, et al.                                                   [Page 5]

Internet Draft   draft-asati-mpls-ldp-end-of-lib-01.txt    November 2007


   Notification after it completes advertisement of its IP label
   bindings to the peer.  The LDP speaker may use an End-of-LIB
   Notification from a directly connected peer to determine when the
   peer has completed its label advertisements for IP prefixes.  After
   the speaker has exchanged End-of-LIB Notifications with the peer the
   speaker should consider LDP to be fully operational for the link to
   the peer and should signal the IGP to start advertising the link with
   normal cost.


5.2. LDP Graceful Restart

   LDP Graceful Restart helps reduce the loss of MPLS traffic caused by
   the restart of a router's LDP component.  It defines procedures that
   allow routers capable of preserving MPLS forwarding state across the
   restart to continue forwarding MPLS traffic for a pre-agreed upon
   period using forwarding state installed prior to the restart.

   During that period the restarting router and its peers consider the
   preserved forwarding state to be usable but stale until it is
   refreshed by receipt of new label advertisements following re-
   establishment of new LDP sessions.  When the period elapses any
   remaining stale forwarding state is removed by the router.

   Receipt of the End-of-LIB Notification from a peer in an LDP Graceful
   Restart scenario enables an LDP speaker to stop using stale
   forwarding information learned from that peer and to recover the
   resources it requires without having to wait until the timeout
   occurs.


5.3. Wildcard Label Request

   When an LDP speaker receives a Label Request message for a Typed
   Wildcard FEC from a peer it determines the set of bindings it is
   permitted to advertise the peer for the FEC type specified by the
   request.  Assuming the peer had advertised the Unrecognized
   Notification capability at session initialization time, the speaker
   should send the peer an End-of-LIB Notification for the FEC type when
   it completes advertisement of the permitted bindings.

   As in the previous applications, receipt of the Notification
   eliminates uncertainty as to when the peer has completed its
   advertisements.







Asati, et al.                                                   [Page 6]

Internet Draft   draft-asati-mpls-ldp-end-of-lib-01.txt    November 2007


5.4. Missing Expected End-of-LIB Notifications

   There is no guarantee that an LDP speaker will receive End-of-LIB
   Notifications from a peer in a situation where it may be used.

   Therefore, in situations where the End-of-LIB Notification may be
   used an implementation SHOULD NOT depend on the receipt of the
   notification.

   To deal with the possibility of missing notifications an LDP speaker
   may time out receipt of an expected End-of-LIB Notification, and if
   the timeout occurs may behave as if it had received the notification.


6. IANA Considerations

   This draft introduces a new LDP Status Code and a new LDP Capability
   both of which require IANA assignment.


7. Security Considerations

   No security considerations beyond those that apply to the base LDP
   specification and described in [RFC5036] apply to signaling the End-
   of-LIB condition as described in this document.


8. References

   Normative References

     [RFC2119] Bradner, S., "Key words for use in RFCs to Indicate
     Requirement Levels", BCP 14, RFC2119, March 1997.

     [RFC5036] Andersson, L., Ed., Minei, I., Ed., and Thomas, B., Ed.,
     "LDP Specification", RFC 5036, October 2007.

     [LDPCap] Thomas, B., Aggarwal, S., Aggarwal, R., Le Roux, J.L.,
     "LDP Capabilities", draft-ietf-mpls-ldp-capabilities-00, Work in
     Progress, May 2007.

     [TypedWC] Thomas, B., Minei, I., "LDP Typed Wildcard FEC", draft-
     ietf-mpls-ldp-typed-wildcard-01, Work in Progress, May 2007.








Asati, et al.                                                   [Page 7]

Internet Draft   draft-asati-mpls-ldp-end-of-lib-01.txt    November 2007


   Informative References

     [LDPSynch] Jork, M., Atlas, A., Fang, L., "LDP IGP
     Synchronization", draft-ietf-mpls-igp-sync-00,, Work in Progress,
     September 2007.

     [RFC3478]  Leelanivas, M., Rekhter, Y., Aggarwal, R., "Graceful
     Restart Mechanism for Label Distribution Protocol", February 2003.


9. Author Information

   Rajiv Asati
   Cisco Systems, Inc.
   Mail Stop RTP6P/2/1
   7025-6 Kit Creek Road PO Box 14987
   Research Triangle Park , NORTH CAROLINA 27709-4987
   Email: rajiva@cisco.com

   Pradosh Mohapatra
   Cisco Systems, Inc.
   Mail Stop SJC15/3/3
   3750 Cisco Way
   San Jose , CALIFORNIA 95134
   Email: pmohapat@cisco.com

   Bob Thomas
   Cisco Systems, Inc.
   1414 Massachusetts Ave.
   Boxborough MA 01719
   Email: rhthomas@cisco.com

   Emily Chen
   Huawei Technologies Co., Ltd.
   NO.5 Streat, Shangdi Information
   Haidian
   Beijing
   China
   Email: chenying220@huawei.com












Asati, et al.                                                   [Page 8]

Internet Draft   draft-asati-mpls-ldp-end-of-lib-01.txt    November 2007


10. Intellectual Property Statement

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at ietf-
   ipr@ietf.org.


11. Full Copyright Statement

   Copyright (C) The IETF Trust (2007).

   This document is subject to the rights, licenses and restrictions
   contained in BCP 78, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
   AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
   THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
   IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
   PURPOSE.










Asati, et al.                                                   [Page 9]

