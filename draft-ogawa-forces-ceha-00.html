<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>ForCES Intra-NE High Availability</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="ForCES Intra-NE High Availability">
<meta name="keywords" content="RFC, Request for Comments, I-D, Internet-Draft, ForCES, HA, ">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">K. Ogawa</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">NTT Corporation</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">W. Wang</td></tr>
<tr><td class="header">Expires: November 22, 2010</td><td class="header">Zhejiang Gongshang University</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">E. Haleplidis</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">University of Patras</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">May 21, 2010</td></tr>
</table></td></tr></table>
<h1><br />ForCES Intra-NE High Availability<br />draft-ogawa-forces-ceha-00</h1>

<h3>Abstract</h3>

<p>
This document discusses CE High Availability within a ForCES
NE.
    
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on November 22, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Definitions<br />
<a href="#anchor2">2.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#scope">2.1.</a>&nbsp;
Document Scope<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#quant">2.2.</a>&nbsp;
Quantifying Problem Scope<br />
<a href="#curr">3.</a>&nbsp;
CE HA Framework<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#HAnow">3.1.</a>&nbsp;
Current CE High Availability Support<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#FEPOHA">3.1.1.</a>&nbsp;
Cold Standby Interaction with ForCES Protocol<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">3.1.2.</a>&nbsp;
Responsibilities for HA<br />
<a href="#hsb">4.</a>&nbsp;
CE HA Hot Standby<br />
<a href="#CEsync">5.</a>&nbsp;
CE Fr Interface Communication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#CEsyncscp">5.1.</a>&nbsp;
Basic Scope for Fr Interface<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#CEsyncop">5.1.1.</a>&nbsp;
Fr Interface Operational Approach<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#CEsyncpr">5.1.2.</a>&nbsp;
Fr Interface Liveliness Protocol<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#CEsyncdt">5.1.3.</a>&nbsp;
Fr Interface Data Synchronization<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#CEsyncel">5.1.4.</a>&nbsp;
Fr Interface Election<br />
<a href="#contrib">6.</a>&nbsp;
Contributors<br />
<a href="#IANA">7.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">8.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Definitions</h3>

<p>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in
this document are to be interpreted as described in RFC 2119.


</p>
<p>
		          
The following definitions are taken from <a class='info' href='#RFC3654'>[RFC3654]<span> (</span><span class='info'>Khosravi, H. and T. Anderson, &ldquo;Requirements for Separation of IP Control and Forwarding,&rdquo; November&nbsp;2003.</span><span>)</span></a>and
<a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a>:

<p>
Logical Functional Block (LFB)  -- 
A template that represents a fine-grained, logically separate
aspects of FE processing.

<p>
ForCES Protocol -- 
The protocol used at the Fp reference point in the ForCES 
Framework in <a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a>.  

</p>




<p>
ForCES Protocol Layer (ForCES PL) -- 
A layer in the ForCES architecture that embodies the ForCES protocol
and the state transfer mechanisms as defined in
<a class='info' href='#RFC5810'>[RFC5810]<span> (</span><span class='info'>Doria, A., Hadi Salim, J., Haas, R., Khosravi, H., Wang, W., Dong, L., Gopal, R., and J. Halpern, &ldquo;Forwarding and Control Element Separation (ForCES) Protocol Specification,&rdquo; March&nbsp;2010.</span><span>)</span></a>.


</p>
							         

<p>
ForCES Protocol Transport Mapping Layer (ForCES TML) -- A layer in 
ForCES protocol architecture that specifically addresses the 
protocol message transportation issues, such as how the protocol 
messages are mapped to different transport media (like SCTP, IP, 
TCP, UDP, ATM, Ethernet, etc), and how to achieve and implement 
reliability, security, etc.

</p>



<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction</h3>
<br /><hr class="insert" />
<a name="ne_arch"></a>

<p>
<a class='info' href='#ne_arch'>Figure&nbsp;1<span> (</span><span class='info'>ForCES Architecture</span><span>)</span></a> illustrates a ForCES
NE controlled by a set of redundant CEs with CE1 being active
and CE2 and CEn-1 being a backup.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                        -----------------------------------------
                        | ForCES Network Element                |
                        |                        +-----------+  |
                        |                        |  CEn-1    |  |
                        |                        |  (Backup) |  |
  --------------   Fc   | +------------+      +------------+ |  |
  | CE Manager |--------+-|     CE1    |------|    CE2     |-+  |
  --------------        | |  (Active)  |  Fr  |  (Backup)  |    |
        |               | +-------+--+-+      +---+---+----+    |
        | Fl            |         |  |    Fp      /   |         |
        |               |         |  +---------+ /    |         |
        |               |       Fp|            |/     |Fp       |
        |               |         |            |      |         |
        |               |         |      Fp   /+--+   |         |
        |               |         |  +-------+    |   |         |
        |               |         |  |            |   |         |
  --------------    Ff  | --------+--+--      ----+---+----+    |
  | FE Manager |--------+-|     FE1    |  Fi  |     FE2    |    |
  --------------        | |            |------|            |    |
                        | --------------      --------------    |
                        |   |  |  |  |          |  |  |  |      |
                        ----+--+--+--+----------+--+--+--+-------
                            |  |  |  |          |  |  |  |
                            |  |  |  |          |  |  |  |
                              Fi/f                   Fi/f

       Fp: CE-FE interface
       Fi: FE-FE interface
       Fr: CE-CE interface
       Fc: Interface between the CE Manager and a CE
       Ff: Interface between the FE Manager and an FE
       Fl: Interface between the CE Manager and the FE Manager
       Fi/f: FE external interface
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: ForCES Architecture&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
The ForCES architecture allows FEs to be aware of multiple CEs
but enforces that only one CE be the master controller. This is known
in the industry as 1+N redundancy [refxxxx]. The master CE controls the 
FEs via the ForCES protocol operating in the Fp interface. If the master CE
becomes faulty, a backup CE takes over and NE operation continues.
By definition, the current documented setup is known as cold-standby
[refxxxx].
The CE set is static and is passed to the FE by the FE Manager (FEM)
via the Ff interface and to each CE by the CE Manager (CEM) in the Fc interface
during the pre-association phase.


</p>
<p>
From an FE perspective, the knobs of control for a CE set are defined 
by the FEPO LFB in <a class='info' href='#RFC5810'>[RFC5810]<span> (</span><span class='info'>Doria, A., Hadi Salim, J., Haas, R., Khosravi, H., Wang, W., Dong, L., Gopal, R., and J. Halpern, &ldquo;Forwarding and Control Element Separation (ForCES) Protocol Specification,&rdquo; March&nbsp;2010.</span><span>)</span></a>, Appendix B. 
<a class='info' href='#HAnow'>Section&nbsp;3.1<span> (</span><span class='info'>Current CE High Availability Support</span><span>)</span></a> details these knobs further.

</p>
<p>

</p>
<a name="scope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Document Scope</h3>

<p>
By current definition, the Fr interface is out of scope for the
ForCES architecture.  However, it is expected that organizations 
implementing a set of CEs may need to have the CEs communicate
to each other via the Fr interface in order to achieve the 
synchronization necessary for controlling the FEs.

</p>
<p>
The problem scope addressed by this document
falls into 3 areas:
</p>
<ol class="text">
<li>
To describe with more clarity (than <a class='info' href='#RFC5810'>[RFC5810]<span> (</span><span class='info'>Doria, A., Hadi Salim, J., Haas, R., Khosravi, H., Wang, W., Dong, L., Gopal, R., and J. Halpern, &ldquo;Forwarding and Control Element Separation (ForCES) Protocol Specification,&rdquo; March&nbsp;2010.</span><span>)</span></a>) how
current cold-standby approach operates within the NE cluster. 

</li>
<li>
To describe how to evolve the cold-standby setup to a hot-standby
redundancy setup so as to improve the failover time and NE availability.

</li>
<li>
To describe a minimalist approach for Fr plane 
communication which interacting CEs MAY use for both cold and hot
standby.

</li>
</ol><p>


</p>
<a name="quant"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Quantifying Problem Scope</h3>

<p>
The NE recovery and availability is dependent on several time-sensitive
metrics:
</p>
<ol class="text">
<li>
       How fast the CE plane failure is detected.
       
</li>
<li>
	How fast a backup CE becomes operational.
       
</li>
<li>
	 How fast the FEs associate with the new master CE.
       
</li>
<li>
	 How fast the FEs recover their state and become operational.
       
</li>
</ol><p>

</p>
<p>
The design goals of the current <a class='info' href='#RFC5810'>[RFC5810]<span> (</span><span class='info'>Doria, A., Hadi Salim, J., Haas, R., Khosravi, H., Wang, W., Dong, L., Gopal, R., and J. Halpern, &ldquo;Forwarding and Control Element Separation (ForCES) Protocol Specification,&rdquo; March&nbsp;2010.</span><span>)</span></a> choices
to meet the above goals are driven by desire for simplicity.

</p>
<p>
To quantify the above criteria with the current prescribed 
ForCES CE setup: 
</p>
<ol class="text">
<li>
How fast the CE side detects a CE failure is left undefined. To
illustrate an extreme scenario, we could have a human operator
acting as the monitoring entity to detect faulty CEs. How fast such
detection happens could be in the range of seconds to days. A more
active monitor on the Fr interface could improve this detection. 
In <a class='info' href='#CEsync'>Section&nbsp;5<span> (</span><span class='info'>CE Fr Interface Communication</span><span>)</span></a> we define a behavior on Fr 
interface to detect CE failures in order to improve things.

</li>
<li>
How fast the backup CE becomes operational is also currently out of scope.
In the current setup, a backup CE need not be operational at all
(for example, to save power) and therefore it is feasible for a 
monitoring entity to boot up a backup CE after it detects the 
failure of the master CE. In this document <a class='info' href='#hsb'>Section&nbsp;4<span> (</span><span class='info'>CE HA Hot Standby</span><span>)</span></a>
we suggest that at least one backup CE be online so as to improve this
metric.

</li>
<li>
How fast an FE associates with new master CE is also currently undefined.
The cost of an FE connecting and associating adds to the recovery overhead. 
As mentioned above we suggest having at least one backup CE online.
In <a class='info' href='#hsb'>Section&nbsp;4<span> (</span><span class='info'>CE HA Hot Standby</span><span>)</span></a> we propose to zero out the connection and 
association cost on failover by having each FE associate with all 
online backup CEs after associating to the active CE.
Note that if an FE pre-associates with backup CEs, then the system will be 
technically operating in hot-standby mode.

</li>
<li>
And last: How fast an FE recovers its state depends on how much NE state
exists. By ForCES current definition, the new master CE assumes zero state
on the FE and starts from scratch to update the FE. 
So the larger the state, the longer the recovery.
In <a class='info' href='#CEsync'>Section&nbsp;5<span> (</span><span class='info'>CE Fr Interface Communication</span><span>)</span></a> we propose to improve this metric 
by having the master CE and backup CEs synchronizing in the Fr plane.

</li>
</ol><p>

</p>
<a name="curr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
CE HA Framework</h3>

<p>
To achieve CE High Availability, FEs and CEs MUST inter-operate per 
<a class='info' href='#RFC5810'>[RFC5810]<span> (</span><span class='info'>Doria, A., Hadi Salim, J., Haas, R., Khosravi, H., Wang, W., Dong, L., Gopal, R., and J. Halpern, &ldquo;Forwarding and Control Element Separation (ForCES) Protocol Specification,&rdquo; March&nbsp;2010.</span><span>)</span></a> definition
which is repeated for contextual reasons in <a class='info' href='#HAnow'>Section&nbsp;3.1<span> (</span><span class='info'>Current CE High Availability Support</span><span>)</span></a>. 
It should be noted that in this default setup, which MUST be 
implemented by CEs and FEs needing HA, the Fr plane is out of 
scope (and if available is proprietary to an implementation).

</p>
<a name="HAnow"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Current CE High Availability Support</h3>

<p>
     As mentioned earlier, there can be multiple redundant CEs controlling FEs
     in a ForCES NE (although in practice there may be only one backup CE).
     At any one time only one master CE can control the FEs. In addition, the
     FE connects and associates to only the master CE. The FE and the CE PL
     are aware of the primary and secondary CEs. This information (primary,
     secondary CEs) is configured on the FE and the CE PLs during
     pre-association by the FEM and the CEM respectively.
     
</p>
<p>
	      <a class='info' href='#seq_HA_Report_Primary'>Figure&nbsp;2<span> (</span><span class='info'>CE Failover for Cold Standby</span><span>)</span></a> below 
	      illustrates the Forces message sequences that the FE
	      uses to recover the connection in current defined
             cold-standby scheme.
      
</p><br /><hr class="insert" />
<a name="seq_HA_Report_Primary"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>


      FE                   CE Primary        CE Secondary
      |                       |                    |
      |  Asso Estb,Caps exchg |                    |
    1 |&lt;---------------------&gt;|                    |
      |                       |                    |
      |       state update    |                    |
    2 |&lt;---------------------&gt;|                    |
      |                       |                    |
      |                       |                    |
      |                   FAILURE                  |
      |                                            |
      |         Asso Estb,Caps exchange            |
    3 |&lt;------------------------------------------&gt;|
      |                                            |
      |              Event Report (pri CE down)    |
    4 |-------------------------------------------&gt;|
      |                                            |
      |         state update from scratch          |
    5 |&lt;------------------------------------------&gt;|

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: CE Failover for Cold Standby&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="FEPOHA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
Cold Standby Interaction with ForCES Protocol</h3>

<p>
            High Availability parameterization in an FE is 
	    driven by configuring the FE Protocol Object (FEPO) LFB. 
	    
</p>
<p>
            The FEPO CEID component identifies the current master CE and the
            component table BackupCEs identifies the backup CEs.
            The
	    FEPO FE Heartbeat Interval, CE Heartbeat Dead Interval,
	    and CE Heartbeat policy help in detecting connectivity
	    problems between an FE and CE. The CE Failover policy defines
	    how the FE should react on a detected failure.
            
</p>
<p>
	    <a class='info' href='#FESM'>Figure&nbsp;3<span> (</span><span class='info'>FE State Machine considering HA</span><span>)</span></a> illustrates the defined state
	    machine that facilitates connection
	    recovery.
            
</p>
<p>
The FE connects to the CE  specified on FEPO CEID component.
If it fails to connect to the defined CE, it moves it
to the bottom of table BackupCEs and sets its CEID
component to be the first CE retrieved from table BackupCEs.
The FE then attempts to associate with the CE designated as the new
primary CE. The FE continues through this procedure until it 
successfully connects to one of the CEs.
            
</p><br /><hr class="insert" />
<a name="FESM"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

    (CE issues Teardown ||    +-----------------+
       Lost association) &amp;&amp;   | Pre-Association |
      CE failover policy = 0  | (Association    |
          +------------------&gt;|   in            |&lt;----+
          |                   | progress)       |     |
          |   CE Issues       +--------+--------+     |
          |   Association              |              | CFTI
          |   Setup Response = Success |              | timer
          |     +----------------------+              | expires
          |     |                                     |
          |     V                                     |
        +-+-----------+                          +----+--------+
        |             |                          |  Not        |
        |             |  (CE issues Teardown ||  |  Associated |
        |             |    Lost association) &amp;&amp;  |             |
        | Associated  |  CE Failover Policy = 1  | (May        |
        |             |                          | Continue    |
        |             +-------------------------&gt;|  Forwarding)|
        |             |                          |             |
        +-------------+                          +-----+-------+
             ^                                         |
             |                                         |
             |            CE Issues                    |
             |            Association                  |
             |            Setup Response = Success     |
             +-----------------------------------------+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: FE State Machine considering HA&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
      When communication fails between the FE and CE (which can be caused
      by either the CE or link failure but not FE related), either 
      the TML on the
      FE will trigger the FE PL regarding this failure or it will be detected
      using the HB messages between FEs and CEs. The communication failure,
      regardless of how it is detected, MUST be considered as a loss of
      association between the CE and corresponding FE.
      
</p>
<p>If the FE's FEPO CE Failover Policy is configured to mode 0 
      (the default), it will immediately transition to the pre-association
      phase. This means that if association is again established, 
      all FE state will need to be re-established.
      
</p>
<p>
      If the FE's FEPO CE Failover Policy is configured to mode 1, 
      it indicates that the FE is capable of HA restart recovery.
      In such a case, the FE transitions to the not associated state and
      the CEFTI timer is started. The FE MAY continue to forward
      packets during this state. It MAY also recycle through any configured
      backup CEs in a round-robin fashion. It first adds its
      primary CE to the bottom of table BackupCEs and sets its CEID 
      component to be the first secondary retrieved from table BackupCEs. 
      The FE then attempts to associate with the CE designated as the new 
      primary CE. 
      If it fails to re-associate with any CE and the
      CEFTI expires, the FE then transitions to the pre-association state.
      
</p>
<p>
      If the FE, while in the not associated state, manages to reconnect
      to a new primary CE before CEFTI expires it transitions to the
      Associated state. Once re-associated, the FE tries to recover any
      state that may have been lost during the not associated state.  
      How the FE achieves to re-synchronize its state is out of scope for
      the current ForCES architecture.
      
</p>
<p>
      An explicit message (a Config message setting Primary CE component in
      ForCES Protocol object) from the primary CE, can also be used to change
      the Primary CE for an FE during normal protocol operation.
      
</p>
<p>
      Also note that the FEs in a ForCES NE could also use a multicast
      CE ID, i.e., they could be associated with a group of CEs (this 
      assumes the use of a CE-CE synchronization protocol, which is 
      out of scope for this specification). In this case, the loss of 
      association would mean that
      communication with the entire multicast group of CEs has been lost. The
      mechanisms described above will apply for this case as well during the
      loss of association. If, however, the secondary CE was also using the
      multicast CE ID that was lost, then the FE will need to form a new
      association using a different CE ID. If the capability exists, the FE MAY
      first attempt to form a new association with original primary CE using a
      different non multicast CE ID.
      
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2"></a><h3>3.1.2.&nbsp;
Responsibilities for HA</h3>

<p>XXX: we may remove this section (not much value to overall
	   discussion)
        
</p>
<p>TML Level:
</p>
<ol class="text">
<li>The TML controls logical connection availability and
          failover.
</li>
<li>The TML also controls peer HA management.
</li>
</ol>
<p>At this level, control of all lower layers, for example transport
        level (such as IP addresses, MAC addresses etc) and associated links
        going down are the role of the TML.
</p>
<p>PL Level: <br />
 All other functionality, including
        configuring the HA behavior during setup, the CE IDs used to
        identify primary and secondary CEs, protocol messages used to report CE
        failure (Event Report), Heartbeat messages used to detect association
        failure, messages to change the primary CE (Config), and other HA
        related operations described before, are the PL responsibility.
</p>
<p>To put the two together, if a path to a primary CE is down, the TML
        would take care of failing over to a backup path, if one is available.
        If the CE is totally unreachable then the PL would be informed and it
        would take the appropriate actions described before.
</p>
<a name="hsb"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
CE HA Hot Standby</h3>

<p>
In this section we make some small extensions to the existing
scheme to enable it to achieve hot standby HA. With these
suggested changes we achieve some of the goals defined in
<a class='info' href='#quant'>Section&nbsp;2.2<span> (</span><span class='info'>Quantifying Problem Scope</span><span>)</span></a>, namely:
</p>
<ul class="text">
<li>
        How fast a backup CE becomes operational.
       
</li>
<li>
         How fast the FEs associate with the new master CE.
       
</li>
</ul><p>


</p>
<p>
As described in <a class='info' href='#HAnow'>Section&nbsp;3.1<span> (</span><span class='info'>Current CE High Availability Support</span><span>)</span></a>, the FEM configures the 
FE to make it aware of all the CEs in the NE. The FEM also 
configures the FE to make it aware of which CE is the master
and which are backup(s). The FE's FEPO LFB
CEID component identifies the current master CE and table 
BackupCEs identifies the backup CEs.
The FE only connects to the master CE and then proceeds to associate
with it. The master thereafter controls the FE and receives events
from it. This continues until there is communication failure between
the FE and CE at which point the FE attempts to connect to a CE
from the BackupCEs table until it succeeds to connect and associate
with one listed CE.

</p>
<p>
It is recommended that at least one backup CE should be online. Doing
so will improve how fast the backup CE will take to be operational
(as opposed to bringing up a backup CE when we detect a master CE fault).
If we assume that a CE implementation does state synchronization 
between CEs (proprietary or as discussed in <a class='info' href='#CEsync'>Section&nbsp;5<span> (</span><span class='info'>CE Fr Interface Communication</span><span>)</span></a>), then
we can zero out
the cost of making the backup CE operational and ready to serve FEs; in
such a case an associating FE could immediately become operational.

</p>
<p>
If we assume the presence of at least one backup CE online, we can
improve how fast the FEs associate with a new master CE by making
two changes:

</p>
<p>
The first change that needs to be made is to have the FE, soon
after successfully connecting and associating with the master CE,
to proceed and connect as well as associate with the rest of the CEs 
listed in the BackupCEs table. 

</p>
<p>
By virtue of having multiple CE connections, the FE switchover
to a new master CE will be relatively much faster. The overall effect
is improving the NE recovery time in case of communication
failure or faults of the master CE.

</p>
<p>
The second change is to have the FE respond to messages issued by any 
CE (including a backup CE) it is associated with. This keeps the FE
simple and as dumb as it is in the current definition.

</p>
<p>
Again for the sake of simplicity, asynchronous events and packet 
redirects continue to be sent only to the master CE. XXXX:
We need to rethink perhaps and discuss possibility of events being
sent to ALLCEIDs CEID (which the TML can translate to mean 
send-to-all-online-CES).

</p>
<p>
XXXX: We need to have an extra state for each CE (master, connected, 
associated, stats etc) on the FEPO - so probably another change 
to current FEPO components.

</p>
<p>
XXXX: What about FEs each assuming a different master CE - is that
a problem? It doesnt seem to be because what matters is how the CEs
agree between themselves who the master is. The FE responds to all
CEs.

</p>
<p>
XXXX: What other kind of traffic needs to be running between FE and backup
CEs? Heartbeats?

</p>
<a name="CEsync"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
CE Fr Interface Communication</h3>

<p>
In this section, we define activities in the Fr interface in 
order to achieve the other two goals defined <a class='info' href='#quant'>Section&nbsp;2.2<span> (</span><span class='info'>Quantifying Problem Scope</span><span>)</span></a>
</p>
<ul class="text">
<li>
       How fast the CE plane failure is detected.
       
</li>
<li>
         How fast the FEs recover their state and become operational.
       
</li>
</ul><p>

</p>
<a name="CEsyncscp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Basic Scope for Fr Interface</h3>

<p>
In the Fr plane we expect to see liveliness detection and configuration.

</p>
<p>
In the case of a fault of a master CE being detected by liveliness, we 
expect there is going to be an election to choose a new master CE.

</p>
<p>
It is also expected that the master CE will be updating the backup CEs
via configuration on any necessary NE state changes.

</p>
<p>
Our goal is to keep the Fr interface simple. For this reason, our
scope is not very ambitious and tries as much as possible to maintain
current ForCES architecture:
</p>
<ul class="text">
<li>
   We keep the number of active CEs at 1 and backup CEs at an arbitrary
   number, N. This is also known as 1+N setup which is also the currently
   defined ForCES architectural setup. So no changes there.
  
</li>
<li>
   Define that the protocol for the Fr interface for both liveliness
   and synchronization be the current ForCES protocol. If there are
   any changes to be made they should be very minimal.
  
</li>
<li>
   Define the use of the ForCES model as the way to describe what data
   and events are synchronized in the Fr interface. The LFB model is
   sufficient to describe components that the ForCES protocol could act on.
   We keep the state synchronization between CEs limited only to what
   the CE-FE (Fp) plane exchange and not anything else.
  
</li>
<li>
   Keep the CE set static and known at FEM/CEM configuration time and
   build a very simple CE master election process.
  
</li>
</ul><p>

</p>
<p>
In this section, we start by assuming the ForCES architecture (protocol
and model) and then extend it when necessary.

</p>
<a name="CEsyncop"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1"></a><h3>5.1.1.&nbsp;
Fr Interface Operational Approach</h3>

<p>
Each CE on bootup knows the NE CE set as configured by the CEM. This
static approach greatly simplifies discovery. It is expected in most
operational setups, there will be one active and one backup CE.

</p>
<p>
Each backup CE does a ForCES association to the listed master CE.

</p>
<p>
The master CE updates backup CEs with configuration necessary to mantain
ForCES related NE state.

</p>
<a name="CEsyncpr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.2"></a><h3>5.1.2.&nbsp;
Fr Interface Liveliness Protocol</h3>

<p>
The ForCES protocol already has built-in heartbeats for liveliness detection.
If we define a CEPO LFB, in the same spirit as the FEPO LFB,
it should be sufficient to have ForCES act as the liveliness protocol in 
the Fr plane.  

</p>
<p>
XXX: We need to be very clear on what
is needed and reused from ForCES protocol.
XXX: What details does the CEPO carry? Example that seems to make sense:
What CE type (eg master/slave), Status (connected etc), Connectivity 
parameters, Dead intervals etc

</p>
<a name="CEsyncdt"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.3"></a><h3>5.1.3.&nbsp;
Fr Interface Data Synchronization</h3>

<p>
Most existing NE implementations in the industry run some
hot standby proprietary scheme. They synchronize many things using such a
scheme. Example they keep protocol state of things like OSPF, BGP, IKE etc.
We dont want to do that. 

</p>
<p>
We focus on a scope that specifies only the need
to migrate state and maybe configuration that is maintained by the CE on 
behalf of CE-FE plane. Not anything else. To be specific:
A master CE synchronizes to backup CEs
any state updates that happen on the CE-FE plane that it controls.

</p>
<p>
One challenge that will require an extension to the ForCES protocol is
on how to communicate (from the master CE to a backup CE) the details
about an LFB component state change that happened in a specific FE.

</p>
<p>
We propose to introduce a new protocol TLV at the same hierarchy level as LFB 
selector. Operationally, this TLV will define that a set of state changes
that happened apply to a specific FE. For this reason it will encompass the 
FEID on which the update happened on. We call it the applies-to TLV.

</p>
<p>
Lets say an update has happened (or depending on update scheme needs to 
happen) on FE z, LFB-a/instance-b/path-c from the controlling CE x, then
the synchronization method to backup CE y will be in the form of a config
message from master CE x to backup CE y that will have a message 
source CEID of x and destination CEID of y.
The  applies-to TLV will contain FEID z. The rest of the
message will be exactly as if the CE x had sent a config message to FE z
and will contain  the path LFB-a/instance-b/path-c

</p>
<p>
XXX: Refer to IETF 77 presentation slide 11 for choices on how to do CECE
synchronization in conjunction with FEs. The consensus seems to lean on
the second scheme..

</p>
<a name="CEsyncel"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.4"></a><h3>5.1.4.&nbsp;
Fr Interface Election</h3>

<p>
Upon failure detection of the master CE, a very simple election occurs.
The CE with the lowest CEID wins. Operationally, all CEs associate to the 
next lowest CEID. This is easy to execute since the static CE list never 
changes.

</p>
<p>
XXX: Optimize - the master CE could keep tabs on which backup CEs are
alive and update the associated CEs CEPO table with status info
so this way if the next lowest CE is not alive, theres no point in
connecting to it when the master fails...

</p>
<a name="contrib"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Contributors</h3>

<p>
Jamal Hadi Salim has contributed to discussions that created
this document.

</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>
	TBA

</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>
	TBA

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC5810">[RFC5810]</a></td>
<td class="author-text">Doria, A., Hadi Salim, J., Haas, R., Khosravi, H., Wang, W., Dong, L., Gopal, R., and J. Halpern, &ldquo;<a href="http://tools.ietf.org/html/rfc5810">Forwarding and Control Element Separation (ForCES) Protocol Specification</a>,&rdquo; RFC&nbsp;5810, March&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5810.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3654">[RFC3654]</a></td>
<td class="author-text">Khosravi, H. and T. Anderson, &ldquo;<a href="http://tools.ietf.org/html/rfc3654">Requirements for Separation of IP Control and Forwarding</a>,&rdquo; RFC&nbsp;3654, November&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3654.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3746">[RFC3746]</a></td>
<td class="author-text">Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;<a href="http://tools.ietf.org/html/rfc3746">Forwarding and Control Element Separation (ForCES) Framework</a>,&rdquo; RFC&nbsp;3746, April&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3746.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5812">[RFC5812]</a></td>
<td class="author-text">Halpern, J. and J. Hadi Salim, &ldquo;<a href="http://tools.ietf.org/html/rfc5812">Forwarding and Control Element Separation (ForCES) Forwarding Element Model</a>,&rdquo; RFC&nbsp;5812, March&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5812.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kentaro Ogawa</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NTT Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">3-9-11 Midori-cho</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Musashino-shi, Tokyo  180-8585</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ogawa.kentaro@lab.ntt.co.jp">ogawa.kentaro@lab.ntt.co.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Weiming Wang</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Zhejiang Gongshang University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">18, Xuezheng Str., Xiasha University Town</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hangzhou  310018</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.R.China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:wmwang@mail.zjgsu.edu.cn">wmwang@mail.zjgsu.edu.cn</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Evangelos Haleplidis</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">University of Patras</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Patras</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Greece</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ehalep@ece.upatras.gr">ehalep@ece.upatras.gr</a></td></tr>
</table>
</body></html>
