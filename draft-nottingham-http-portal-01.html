<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>The Network Authentication Required HTTP Status Code</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="The Network Authentication Required HTTP Status Code">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">M. Nottingham</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">August 18, 2010</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: February 19, 2011</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />The Network Authentication Required HTTP Status Code<br />draft-nottingham-http-portal-01</h1>

<h3>Abstract</h3>

<p>"Captive portals" are a commonly-deployed means of obtaining
         access credentials and/or payment for a network. This memo introduces
         a new HTTP status code as a means of addressing issues found in these
         deployments.
</p>
<p>This memo should be discussed on the ietf-http-wg@w3.org mailing
         list, although it is not a work item of the HTTPbis WG.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on February 19, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#status-code">2.</a>&nbsp;
428 Network Authentication Required<br />
<a href="#anchor2">3.</a>&nbsp;
Security Considerations<br />
<a href="#anchor3">4.</a>&nbsp;
IANA Considerations<br />
<a href="#use">Appendix&nbsp;A.</a>&nbsp;
Using the 428 Status Code<br />
<a href="#issues">Appendix&nbsp;B.</a>&nbsp;
Issues Raised by Captive Portals<br />
<a href="#anchor4">Appendix&nbsp;C.</a>&nbsp;
Non-HTTP Applications and Techniques<br />
<a href="#anchor5">Appendix&nbsp;D.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>It has become common for networks to require authentication,
         payment and/or acceptance of terms of service before granting access.
         Typically, this occurs when accessing "public" networks such as those
         in hotels, trains, conference centres and similar networks.
</p>
<p>While there are several potential means of providing credentials
         to a network, these are not yet universally supported, and in some
         instances the network administrator requires that information (e.g.,
         terms of service, login information) be displayed to end users.
</p>
<p>In such cases, it has become widespread practice to use a "captive
         portal" that diverts HTTP requests to the administrator's web page.
         Once the user has satisfied requirements (e.g., for payment,
         acceptance of terms), the diversion is ended and "normal" access to
         the network is allowed.
</p>
<p>Typically, this diversion is accomplished by one of several
         possible techniques; 
            </p>
<ul class="text">
<li>IP interception - all requests on port 80 are intercepted
               and send to the portal.
</li>
<li>HTTP redirects - all requests on port 80 are intercepted and
               an HTTP redirect to the portal's URL is returned.
</li>
<li>DNS interception - all DNS lookups return the portal's IP
               address.
</li>
</ul><p> 
         
</p>
<p>In each case, the intent is that users connecting to the network
         will open a Web browser and see the portal.
</p>
<p>However, because port 80 is used for non-browser traffic, a number
         of issues (see <a class='info' href='#issues'>Appendix&nbsp;B<span> (</span><span class='info'>Issues Raised by Captive Portals</span><span>)</span></a>) have been encountered.
</p>
<p>This memo introduces a new HTTP status code, 428 Network
         Authentication Required, as a solution to some of these issues. <a class='info' href='#use'>Appendix&nbsp;A<span> (</span><span class='info'>Using the 428 Status Code</span><span>)</span></a> outlines how it might be used in typical
         deployments.
</p>
<a name="status-code"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
428 Network Authentication Required</h3>

<p>This status code indicates that the client should authenticate to
         gain network access before resubmitting the request.
</p>
<p>The associated representation SHOULD indicate how to do this;
         e.g., with an HTML form for submitting credentials.
</p>
<p>Responses with the 428 status code MUST NOT be stored by a
         cache.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Security Considerations</h3>

<p>In common use, a response carrying the 428 status code will not
         come from the origin server indicated in the request's URL. This
         presents many security issues; e.g., an attacking intermediary may be
         inserting cookies into the original domain's name space, may be
         observing cookies or HTTP authentication credentials sent from the
         user agent, and so on.
</p>
<p>However, these risks are not unique to the 428 status code; in
         other words, a captive portal that is not using this status code
         introduces the same issues.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
IANA Considerations</h3>

<p>The HTTP Status Codes Registry should be updated with the
         following entry:
</p>
<p></p>
<ul class="text">
<li>Code: 428
</li>
<li>Description: Network Authentication Required
</li>
<li>Specification: [ this document ]
</li>
</ul>

<a name="use"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Using the 428 Status Code</h3>

<p>This appendix demonstrates a typical use of the 428 status code;
         it is not normative.
</p>
<p>A network operator wishing to require some authentication,
         acceptance of terms or other user interaction before granting access
         usually does so by identify clients who have not done so ("unknown
         clients") using their MAC addresses.
</p>
<p>Unknown clients then have all traffic blocked, except for that on
         TCP port 80, which is sent to a HTTP server (the "login server")
         dedicated to "logging in" unknown clients, and of course traffic to
         the login server itself.
</p>
<p>For example, a user agent might connect to a network and make the
         following HTTP request on TCP port 80:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET /index.htm HTTP/1.1
Host: www.example.com
User-Agent: ExampleAgent
</pre></div>
<p>Upon receiving such a request, the login server would generate a
         428 response:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 428 Network Authentication Required
Refresh: 0; url=https://login.example.net/
Content-Type: text/html

&lt;html&gt;
   &lt;head&gt;
   &lt;/head&gt;
   &lt;body&gt;
      &lt;h1&gt;You are being redirected to log into the network...&lt;/h1&gt;
   &lt;/body&gt;
&lt;/html&gt;
</pre></div>
<p>Here, the 428 status code assures that non-browser clients will
         not interpret the response as being from the origin server, and the
         Refresh header redirects the user agent to the login server (an HTML
         META element can be used for this as well).
</p>
<p>Note that the 428 response can itself contain the login
         interface, but it may not be desirable to do so, because browsers
         would show the login interface as being associated with the
         originally requested URL, which may cause confusion.
</p>
<a name="issues"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Issues Raised by Captive Portals</h3>

<p>Since clients cannot differentiate between a portal's response and
         that of the HTTP server that they intended to communicate with, a
         number of issues arise.
</p>
<p>One example is the "favicon.ico" <a href='http://en.wikipedia.org/wiki/Favicon'>http://en.wikipedia.org/wiki/Favicon</a> commonly used by
         browsers to identify the site being accessed. If the favicon for a
         given site is fetched from a captive portal instead of the intended
         site (e.g., because the user is unauthenticated), it will often
         "stick" in the browser's cache (most implementations cache favicons
         aggressively) beyond the portal session, so that it seems as if the
         portal's favicon has "taken over" the legitimate site.
</p>
<p>Another browser-based issue comes about when P3P <a href='http://www.w3.org/TR/P3P/'>http://www.w3.org/TR/P3P/</a> is supported. Depending on how
         it is implemented, it's possible a browser might interpret a portal's
         response for the p3p.xml file as the server's, resulting in the
         privacy policy (or lack thereof) advertised by the portal being
         interpreted as applying to the intended site. Other Web-based
         protocols such as WebFinger <a href='http://code.google.com/p/webfinger/wiki/WebFingerProtocol'>http://code.google.com/p/webfinger/wiki/WebFingerProtocol</a>,
         CORS <a href='http://www.w3.org/TR/cors/'>http://www.w3.org/TR/cors/</a> and OAuth <a href='http://tools.ietf.org/html/draft-ietf-oauth-v2'>http://tools.ietf.org/html/draft-ietf-oauth-v2</a> may also be
         vulnerable to such issues.
</p>
<p>Although HTTP is most widely used with Web browsers, a growing
         number of non-browsing applications use it as a substrate protocol.
         For example, WebDAV <a href='http://tools.ietf.org/html/rfc4918'>http://tools.ietf.org/html/rfc4918</a> and CalDAV <a href='http://www.ietf.org/rfc/rfc4791.txt'>http://www.ietf.org/rfc/rfc4791.txt</a> both use HTTP as the
         basis (for network filesystem access and calendaring, respectively).
         Using these applications from behind a captive portal can result in
         spurious errors being presented to the user, and might result in
         content corruption, in extreme cases.
</p>
<p>Similarly, other non-browser applications using HTTP can be
         affected as well; e.g., widgets <a href='http://www.w3.org/TR/widgets/'>http://www.w3.org/TR/widgets/</a>, software updates, and other
         specialised software such as Twitter clients and the iTunes Music
         Store.
</p>
<p>It should be noted that it's sometimes believed that using HTTP
         redirection to direct traffic to the portal addresses these issues.
         However, since many of these uses "follow" redirects, this is not a
         good solution.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
Non-HTTP Applications and Techniques</h3>

<p>This memo does not address non-HTTP applications, such as IMAP,
         POP, or even TLS-encapsulated HTTP. Since captive portals almost
         always target Web browsers (has anyone ever seen one that inserts an
         e-mail into your inbox asking you to authenticate?), this is
         appropriate.
</p>
<p>Instead, it is anticipated that well-behaved portals will block
         all non-HTTP ports (especially port 443) until the user has
         successfully authenticated.
</p>
<p>Overall, there may also be an interesting discussion to be had
         about improving network access methods to the point where a user
         interface can be presented for the same purposes, without resorting
         to intercepting HTTP traffic. However, since such a mechanism would
         by necessity require modifying the network stack and operating system
         of the client, this memo takes a more modest approach.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D"></a><h3>Appendix D.&nbsp;
Acknowledgements</h3>

<p>The author takes all responsibility for errors and omissions.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mark Nottingham</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mnot@mnot.net">mnot@mnot.net</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.mnot.net/">http://www.mnot.net/</a></td></tr>
</table>
</body></html>
