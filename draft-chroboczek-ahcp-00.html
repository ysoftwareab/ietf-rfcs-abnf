<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>The Ad Hoc Configuration Protocol</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="The Ad Hoc Configuration Protocol">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">J. Chroboczek</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">University of Paris 7</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">August 9, 2010</td></tr>
<tr><td class="header">Expires: February 10, 2011</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />The Ad Hoc Configuration Protocol<br />draft-chroboczek-ahcp-00</h1>

<h3>Abstract</h3>

<p>The Ad Hoc Configuration Protocol is a protocol for automatically
configuring nodes in a multihop mesh network.  It is designed to replace
DHCPv4, DHCPv6 and IPv6 Router Advertisements in networks where these
protocols are difficult or impossible to deploy.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on February 10, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Specification of Requirements<br />
<a href="#anchor3">2.</a>&nbsp;
Protocol Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#forwarding-layer">2.1.</a>&nbsp;
The Forwarding Layer<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.2.</a>&nbsp;
The Configuration Layer<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">2.3.</a>&nbsp;
Configuration data<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">2.4.</a>&nbsp;
Extensibility<br />
<a href="#anchor24">3.</a>&nbsp;
Protocol encoding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">3.1.</a>&nbsp;
Message format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">3.2.</a>&nbsp;
Message format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">3.3.</a>&nbsp;
Option format<br />
<a href="#anchor43">4.</a>&nbsp;
Security Considerations<br />
<a href="#anchor44">5.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">6.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">6.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">6.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>In order to participate in global routing, an IPv4 or IPv6 node needs to
be configured with a globally unique IP address.  Additionally, in order to
be useful, a node usually needs a small set of higher-layer configuration
data, such as the address of a DNS forwarder <a class='info' href='#DNS'>[DNS]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification.,&rdquo; November&nbsp;1987.</span><span>)</span></a>.
</p>
<p>In classical networks, such configuration is usually performed with no
operator intervention using one or more among DHCP <a class='info' href='#DHCP'>[DHCP]<span> (</span><span class='info'>Droms, R., &ldquo;Dynamic Host Configuration Protocol,&rdquo; March&nbsp;1997.</span><span>)</span></a>,
DHCPv6 <a class='info' href='#DHCPv6'>[DHCPv6]<span> (</span><span class='info'>Droms, R., Ed., Bound, J., Volz, B., Lemon, T., Perkins, C., and M. Carney, &ldquo;Dynamic Host Configuration Protocol for IPv6 (DHCPv6),&rdquo; July&nbsp;2003.</span><span>)</span></a> or IPv6 Router Advertisements <a class='info' href='#NDP'>[NDP]<span> (</span><span class='info'>Narten, T., Nordmark, E., Simpson, W., and H. Soliman, &ldquo;Neighbor Discovery in IPv6,&rdquo; September&nbsp;2007.</span><span>)</span></a>.  All of these protocols are based on link-local broadcast
or multicast communication, and hence require that a server be present on
every link on which there is a node requiring configuration.
</p>
<p>Mesh networks use a different network model from classical networks,
where the notion of link is not quite clear.  In such networks, it is
impractical to deploy servers within every link-local broadcast domain.
</p>
<p>AHCP is a centralised configuration protocol that allows configuration
of nodes across multiple hops.  In order to configure a network using AHCP,
a small number of AHCP servers are deployed, and placed at arbitrary
locations.  All AHCP nodes implement a very primitive multicast routing
protocol, which is used to carry AHCP configuration information beyond the
direct neighbours of the AHCP servers.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Specification of Requirements</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Protocol Operation</h3>

<p>Every AHCP node is assigned a globally unique 8-octet identifier known
as its Node Id.  We suggest that Node Ids should be assigned in modified
EUI-64 format <a class='info' href='#ADDRARCH'>[ADDRARCH]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;IP Version 6 Addressing Architecture,&rdquo; February&nbsp;2006.</span><span>)</span></a>.
</p>
<p>Every AHCP message is sent with a header carrying a source Node Id,
a destination Node Id, as well as a hop count that limits the message's
distribution.  Additionally, the header contains an original hop count,
which is the hop count the message was originated with.
</p>
<p>Two Node Ids are special, and MUST NOT be assigned to a node.  The
Broadcast Node Id consists of 64 bits of ones, and is used as the
destination field of mesages destined to all nodes within a given hop
count; it MUST NOT appear as the source Id of an AHCP message.  The
Undefined Node Id consists of 64 bits of zeroes; it is used internally by
the sample implementation of AHCP, and MUST NOT appear as either the source
or destination Id of an AHCP message.
</p>
<p>AHCP is a layered protocol: routing and forwarding of messages is handled
by a lower, Forwarding Layer, while origination and reception of messages
is handled by an upper, Configuration Layer.
</p>
<a name="forwarding-layer"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
The Forwarding Layer</h3>

<p>The forwarding layer is in charge of sending, forwarding and receiving
messages.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.1"></a><h3>2.1.1.&nbsp;
Sending messages</h3>

<p>When the configuration layer desires to originate a message, it passes
the message a destination Node Id, a hop count and an optional IPv4 or IPv6
unicast destination address to the Forwarding layer.  The Forwarding layer
prepends a message header to the message with the following data:
</p>
<ul class="text">
<li>the Source Id field is set to the sender's Node Id;
</li>
<li>the Destination Id field provided by the Configuration layer;
</li>
<li>the Nonce is set to an arbitrary random value
</li>
<li>both the Original Hopcount and Hopcount fields are set to the value
provided by the Configuration layer.
</li>
</ul><p>

</p>
<p>If a unicast destination address was provided, the resulting datagram is
sent to that address, using normal unicast routing.  If no such address was
provided, the datagram is flooded over all of the sending node's interfaces
configured for AHCP operation to the well-known link-local AHCP multicast
address.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.2"></a><h3>2.1.2.&nbsp;
Receiving and forwarding messages</h3>

<p>Every node maintains a table of recently received messages, indexed by
triples of the form
</p>
<blockquote class="text">
<p>(Source Id, Destination Id, Nonce)
</p>
</blockquote><p>

</p>
<p>Upon receiving a message, an AHCP node first validates the message.  It
makes the following checks:
</p>
<ul class="text">
<li>if the message's Hop Count is 0, then the message is silently
discarded;
</li>
<li>if the message's Source Id is the receiving node's Id, then the message
is silently discarded;
</li>
<li>if the message's Destination Id is the undefined Id, then the message is
discarded;
</li>
<li>if the message's Source Id is either the undefined Id or the Broadcast
Id, then the message is discarded;
</li>
<li>if the message is present in the table of recently received messages,
then it is silently discarded.
</li>
</ul><p>

</p>
<p>When a message has passed the above checks, it is inserted in the table
of recently received messages.
</p>
<p>The forwarding layer then considers the message for forwarding.  If the
message's Hop Count is 2 or more, then, after a small random delay <a class='info' href='#JITTER'>[JITTER]<span> (</span><span class='info'>Floyd, S. and V. Jacobson, &ldquo;The synchronization of periodic routing messages,&rdquo; April&nbsp;1994.</span><span>)</span></a>, the hop count is decremented and the message is
forwarded to the well-known AHCP multicast address over all of the node's
interfaces on which forwarding has been configured.
</p>
<p>Finally, if the message's Destination Id is either the wildcard Id or the
Id of the receiving node, then the message is passed to the Configuration
Layer for further processing.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
The Configuration Layer</h3>

<p>The upper layer of AHCP, known as the configuration layer, is
implemented in terms of the primitives provided by the forwarding layer,
namely originating and receiving messages.
</p>
<p>Unlike the forwarding layer, which is a pure peer-to-peer layer, the
configuration layer follows a client/server architecture.  At the
forwarding layer, AHCP messages are divided into requests and replies.
Nodes are divided into three categories:
</p>
<blockquote class="text">
<p>forwarder nodes, that never originate any messages;
</p>
<p>client nodes, that originate requests and receive replies; and
</p>
<p>server nodes, that receive requests and originate replies.
</p>
</blockquote><p>

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.1"></a><h3>2.2.1.&nbsp;
Forwarder operation</h3>

<p>A forwarder is an AHCP node whose configuration layer that does nothing.
In other words, while a forwarder forwards messages normally, it never
originates messages and ignores any messages destined to it.
</p>
<p>AHCP forwarders are useful to maintain a connected network in situations
where some nodes are configured manually or by other means than AHCP.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.2"></a><h3>2.2.2.&nbsp;
Client Operation</h3>

<p>A client is an AHCP node which is configured by AHCP.  A client's
configuration layer originates AHCP requests, and receives AHCP replies.
</p>
<p>AHCP clients are structured as finite state automata with four states
(described in detail below).  In the Initial state, an ACHP client has no
valid configuration data; in all other states, it has valid configuration
data which it can use for configuring the other components of the
networking stack.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.2.1"></a><h3>2.2.2.1.&nbsp;
The Initial state</h3>

<p>In the Initial state, the client has no configuration information.  It
periodically (every few seconds) sends a Discover message with destination
Id equal to the broadcast Id.  The hop count of this message is initially
1, and is incremented every three messages.
</p>
<p>Upon receiving an Offer message, the client examines the configuration
data that it contains to determine whether it is acceptable.  If it is, it
switches to the Requesting state.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.2.2"></a><h3>2.2.2.2.&nbsp;
The Requesting state</h3>

<p>In the Requesting state, a client has tentative configuration
information obtained from an Offer message.  It periodically (every few
seconds) sends a Request message with destination Id equal to the source Id
of the recently received Offer message, and hop count equal to the hop
count it used in the Request message that it last sent.
</p>
<p>(It might be tempting to use the difference between the initial and the
remaining hop count of the Offer message; however, this might cause the
protocol to fail in the presence of asymmetric links.)
</p>
<p>When the client receives an acceptable Ack message from the server, it
configures itself with the data contained in the message and switches to
the Bound state.
</p>
<p>If the client receives a Nack message from its selected server, or times
out without receiving an Ack message, it switches back to the Initial
state.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.2.3"></a><h3>2.2.2.3.&nbsp;
The Bound state</h3>

<p>In the Bound state, the client has configured itself with data obtained
from an Ack message.  This data is valid until the lease expiration time,
defined in <a class='info' href='#expiration-time'>Section&nbsp;2.2.2.5<span> (</span><span class='info'>Lease expiration time</span><span>)</span></a> below.
</p>
<p>A few minutes before reaching the lease expiration time, the client
switches to the Renewing state.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.2.4"></a><h3>2.2.2.4.&nbsp;
The Renewing state</h3>

<p>The Renewing state is similar to the Configured state, in that the node
is currently configured; however, without a new message from the server,
this data will expire soon.
</p>
<p>In this state, the client behaves just like it does in the Requesting
state: it periodically sends a Request message with destination Id equal to
the source Id of the Offer message, and hop count equal to the hop count it
used in the Request message that it last sent.
</p>
<p>When the client receives an acceptable Ack message from the server, it
compares it with its stored configuration.  If the stored configuration and
the received data only differ in the lease expiration time, it extends its
lease validity time with no further action.  Otherwise, it deconfigures
itself and then configures itself with the new data.  It then switches to
the Bound state.
</p>
<p>If the client receives a Nack message from its selected server, or the 
lease validity time is reached, it unconfigures itself and switches to the
Initial state.
</p>
<a name="expiration-time"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.2.5"></a><h3>2.2.2.5.&nbsp;
Lease expiration time</h3>

<p>Every Ack message carries a relative time, written "expires", after
which the configuration is no longer valid; this value is determined by the
server, and already contains sufficient slack to cover any propagation
time, processing time and clock skew.  If the server has a real-time clock,
the message also carries the absolute UTC time, written "originating_time",
at which the Ack message was originated.
</p>
<p>The lease expiration time is the time, w.r.t. the client's local clock,
at which the client node MUST discard any configuration data it has.
Assuming that the Ack message was received by the client node at time
"reception_time" (according to its local clock), then the lease expiration
time is defined as follows.  If the node has a real-time clock, and the
server included an originating time, then the lease expiration time is
defined as:
</p>
<blockquote class="text">
<p>MIN(reception_time + expires, originating_time + expires)
</p>
</blockquote><p>
Otherwise, it is simply defined as
</p>
<blockquote class="text">
<p>reception_time + expires
</p>
</blockquote><p>

</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.2.6"></a><h3>2.2.2.6.&nbsp;
Optimisations</h3>

<p>When the client is in the Renewing state, and therefore is configured
with one or more unicast addresses, unicast routing has a good chance of
being operational; hence, a useful optimisation is to send Request messages
to a unicast address.  If the Ack message that was used for configuring
contained a My-IPv6-address or My-IPv4-address option, and hence an IP
address of the server is known, the client SHOULD send the Request message
in a unicast packet addressed to one of the server's IP addresses a small
number of times before switching to normal multicast operation.
</p>
<p>Another useful optimisation is to increase the hop count of requests at
the very end of the Renewing state.  The algorithm described above assumes
that the distance between the client and its selected server has not
increased during the lease's lifetime; if it has, the client will loose its
lease, deconfigure, switch back to the Initial state and reconfigure.
Increasing the hop count of Request messages just before the lease
expires can avoid this extra configuration cycle.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.3"></a><h3>2.2.3.&nbsp;
Server Operation</h3>

<p>An AHCP server has persistent storage where it keeps a databsse of
leases given out to clients.  Additionally, it has a local clock that
remains stable across reboots (but see <a class='info' href='#no-stable-clock'>Section&nbsp;2.2.3.3<span> (</span><span class='info'>Operation without a stable clock</span><span>)</span></a>).
Note that the clock is not assumed to be synchronised with UTC, although
more reliable operation is possible when it is.
</p>
<p>Upon receiving a request, the server sends a reply.  The exact behaviour
depends on the kind of the request message.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.3.1"></a><h3>2.2.3.1.&nbsp;
Replying to a Discover message</h3>

<p>Upon receiving a Discover message, the server checks whether it is
likely that it could reply positively to an identical Request message; this
may involve checking the lease database, but MUST NOT involve committing
the lease to permanent storage.
</p>
<p>If this is the case, the server replies with an Offer message
containing, to the extent possible, the same data that it would send in an
ACK reply to an identical Request message.  Otherwise, the server simply
drops the received message, letting the client fall back to a different
server.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.3.2"></a><h3>2.2.3.2.&nbsp;
Replying to a Request message</h3>

<p>Upon receiving a Request message, the server takes any actions necessary
to reserve any resources offeredto the client; this will probably involve
committing a lease into stable storage.  If reserving the resources is
possible, it replies with an ACK message listing any resources granted to
the client.
</p>
<p>If it is not possible to satisfy the client's request, the server SHOULD
reply with a NACK message.  This message MAY be empty, but SHOULD contain
any data that allows the client to identify the request that is being
denied; for example, any IP address formerly assigned to this client SHOULD
be included.
</p>
<a name="no-stable-clock"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.3.3"></a><h3>2.2.3.3.&nbsp;
Operation without a stable clock</h3>

<p>An AHCP server SHOULD monitor its real-time clock, and refuse to give
out leases unless it believes that its clock is reasonably stable; this
might involve checking for NTP synchronisation, or simply making a number
of consistency checks.
</p>
<p>In isolated mesh networks, however, it may be difficult or impossible to
guarantee that servers' clocks are stable.  For this reason, AHCP supports
a mode of operation with no stable clocks.
</p>
<p>In this mode of operation, the lease database maintains not only the
leases' expiration time, but also the leases' initial duration.  If the
server's clock remains stable, leases are allowed to expire normally;
whenever a clock instability is detected (e.g. because the system is
rebooted, has gone into a sleep mode, or the real-time clock has been
stepped), all lease expiration times are reset to their initial
duration.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Configuration data</h3>

<p>AHCP messages carry a body, which is structured as a list of options.
Every option is a TLV specifying a piece of configuration data.
Additionally, an option can be marked as "mandatory" by preceding it by
a specific option called "Mandatory".
</p>
<p>With the exception of the Origin Time, My IPv6 Address and My IPv4
Address options, the precise semantics of options depends on the kind of
message they are sent in.  These options SHOULD be included in all messages
if possible.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.1"></a><h3>2.3.1.&nbsp;
Options in Discover and Request messages</h3>

<p>Mandatory options contained in a Discover or Request message mandate
constraints that a server SHOULD obey when constructing a reply.  If
a server is unable to satisfy a mandatory option in its reply, it SHOULD
silently ignore the request if it is a Discover message, and SHOULD reply
with a Nack if the request is a Request message.
</p>
<p>Non-mandatory options contained in a Discover or Request message specify
suggestions to the server; the server SHOULD, if possible, obey the
suggestions; however, if this is impossible, the server MUST NOT refrain
from replying positively to a request just because a suggestion could not
be satisfied.
</p>
<p>Options in Discover and Request messages can have one of three forms:
</p>
<blockquote class="text">
<p>an option in a request may be empty (i.e. its Length field may be 0), in
which case it requests or suggests that the same option be included in the
server's reply;
</p>
<p>as a special case, an option in a request may have a value (i.e. its
Length field may have the expected value for this kind of option), in which
case it requests or suggests that the same option be included in the
server's reply and have this exact value;
</p>
<p>in the particular case of requests containing a prefix, the Length field
may have a value of 1, in which case the option contains the suggested or
requested prefix length.
</p>
</blockquote>

<p>Note that it is permissible for an option to appear twice in a single
Discover or Request message, once as a mandatory and once as
a non-mandatory option.  For example, it is usual for a client to send
a Request containing both a mandatory empty IPv4-address option, and
a non-mandatory non-empty IPv4-address option.  In this case, the client is
requesting an IPv4 address, and suggesting what its value should preferably
be.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.2"></a><h3>2.3.2.&nbsp;
Options in positive replies</h3>

<p>An option in an Offer or Ack message specifies a given value or set of
values for a given configuration parameter.  Positive replies MUST NOT
contain duplicate options, and MUST NOT contain empty options.
</p>
<p>A mandatory option in such a message specifies that the client MUST use
this option for configuration if it uses any of the options included in the
message.  In other words, a client MUST NOT use a message for configuration
unless it is going to use all the data contained in all of the mandatory
options in the message.
</p>
<p>For example, a network that does not allow access to DNS servers outside
it will send mandatory DNS Server options to force all clients to use its
DNS servers.  (Note that this is not a security mechanism, just a way to
indicate to clients how to configure so as to not run afoul of a network's
policies.)
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.3"></a><h3>2.3.3.&nbsp;
Options in Nack replies</h3>

<p>Bodies of Nack replies contain options that could not be satisfied by
the server.  Empty options are allowed, in which case they indicate an
option that could not be included by the server.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Extensibility</h3>

<p>The AHCP protocol is extensible: new message types and new options may
be added in the future.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.1"></a><h3>2.4.1.&nbsp;
New message types</h3>

<p>The forwarding layer is agnostic to message types: nothing in the
specification in <a class='info' href='#forwarding-layer'>Section&nbsp;2.1<span> (</span><span class='info'>The Forwarding Layer</span><span>)</span></a> requires checking the
message type.  Hence, the forwarding layer treats unknown message types in
the same way as it treats the message types defined in this document.
</p>
<p>The configuration layer MUST silently ignore any message with an unknown
message type.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.2"></a><h3>2.4.2.&nbsp;
New option types</h3>

<p>Upon receiving a message containing a mandatory option with an unknown
option type, the receiving node MUST ignore the whole message, except if it
is a Request message, in which case the receiving node SHOULD send a Nack
message in reply.
</p>
<p>Non-mandatory options with an unknown option type MUST be silently
ignored; their presence MUST NOT prevent the rest of the message from being
processed normally.
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Protocol encoding</h3>

<p>An AHCP message is sent as the body of a UDP datagram, either sent to
the well-known link-local AHCP multicast address, in which case the
network-layer hop count MUST be set to 1, or to an arbitrary unicast
address.  In either case, the datagram is sent to the well-known AHCP
port.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Message format</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Magic = 43  |  Version = 1  |   Hopcount    |Orig. Hopcount |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             Nonce                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                          Source Id                            +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                        Destination Id                         +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Body...
   +-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>Fields:
</p>
<blockquote class="text"><dl>
<dt>Magic</dt>
<dd>The arbitrary but carefully chosen value 43; messages
with a first octet different from 43 MUST be silently ignored.
</dd>
<dt>Version</dt>
<dd>This document specifies version 1 of the AHCP
protocol.  Messages with a second octet different from 1 MUST be silently
ignored.
</dd>
<dt>Hopcount</dt>
<dd>The remaining hop count of this message.  Messages
with a hop count of 0 MUST be silently ignored.  Messages with a hop count
of 1 MUST NOT be forwarded.
</dd>
<dt>Original Hopcount</dt>
<dd>The original hop count of this message.
This field MUST NOT be modified by forwarders.
</dd>
<dt>Nonce</dt>
<dd>An arbitrary 32-bit value chosen so that the triple
(Source id, Destination id, Nonce) is globally unique.
</dd>
<dt>Source Id</dt>
<dd>The id of the node sending this message.
</dd>
<dt>Destination Id</dt>
<dd>The id of the destination node, or the
broadcast id if this message is destined to all nodes.
</dd>
<dt>Body</dt>
<dd>The body of the message.
</dd>
</dl></blockquote>

<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Message format</h3>

<p>The body of an AHCP message consists of a single AHCP message.  Any data
following the message MUST be forwarded without modification, and silently
ignored on reception.
</p>
<p>All messages have the following format:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Type     |       MBZ     |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Options...
   +-+-+-+-+-+-+-+-+-+-
</pre></div>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Type</dt>
<dd>This field specifies the kind of message.
</dd>
<dt>MBZ</dt>
<dd>This field is sent as 0, and MUST be ignored on
reception.
</dd>
<dt>Length</dt>
<dd>The length of the body, exclusive of the Type,
Reserved and Length fields.  If the body is longer than the expected length
of a given type of message, any extra data MUST be silently ignored.
</dd>
<dt>Options</dt>
<dd>A list of options either requested or offered by this
message.
</dd>
</dl></blockquote>

<p>The following messages have been defined:
</p>
<blockquote class="text"><dl>
<dt>0</dt>
<dd>Discover: this message is used by a client to locate
servers willing to provide it with configuration data.
</dd>
<dt>1</dt>
<dd>Offer: this message is used by a server to reply to
a Discover message.
</dd>
<dt>2</dt>
<dd>Request: this message is used by a client to request
configuration data from a particular server.
</dd>
<dt>3</dt>
<dd>Ack: this message is used by a server to reply positively
to a Request message.
</dd>
<dt>4</dt>
<dd>Nack: this message is used by a server to reply negatively
to a Request message.
</dd>
<dt>5</dt>
<dd>Release: this message is optionally used by a client to
release any configuration data that has been granted to it.
</dd>
</dl></blockquote><p>

</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Option format</h3>

<p>Messages carry a body that consists of a sequence of options.  Except
for Pad and Mandatory, all options have the following format:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option no. |     Length      |     Value...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
</pre></div>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Option no</dt>
<dd>This field specifies the kind of option.
</dd>
<dt>Length</dt>
<dd>The length of the value, exclusive of the Option no,
and Length fields.
</dd>
<dt>Value</dt>
<dd>This is the value of this option.
</dd>
</dl></blockquote>

<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1"></a><h3>3.3.1.&nbsp;
Format of specific options</h3>

<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1.1"></a><h3>3.3.1.1.&nbsp;
Pad</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0
   0 1 2 3 4 5 6 7
   +-+-+-+-+-+-+-+
   |  Option no. |
   +-+-+-+-+-+-+-+
</pre></div>
<p>The Pad option is ignored on reception.
</p>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Option no</dt>
<dd>Set to 0 to indicate a Pad option.
</dd>
</dl></blockquote>

<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1.2"></a><h3>3.3.1.2.&nbsp;
Mandatory</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0
   0 1 2 3 4 5 6 7
   +-+-+-+-+-+-+-+
   |  Option no. |
   +-+-+-+-+-+-+-+
</pre></div>
<p>The mandatory option specifies that the option immediately following it
is mandatory.
</p>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Option no</dt>
<dd>Set to 1 to indicate a Mandatory option.
</dd>
</dl></blockquote>

<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1.3"></a><h3>3.3.1.3.&nbsp;
Origin Time</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option no. |     Length      |       Absolute time           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>The Origin Time option specifies the time, encoded as a number of
seconds since 00:00:00, 1 January 1970 UTC, at which this message was
originated.  This option SHOULD be included in all messages if the
originating node has a real-time clock that is trusted to be synchronised
with UTC within a few seconds, and MUST NOT be sent if the sending node
does not have such a clock.  Note that this option is unusual in that it
has the same meaning whatever kind of message it is sent in.
</p>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Option no</dt>
<dd>Set to 2 to indicate an Origin Time option.
</dd>
</dl></blockquote>

<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1.4"></a><h3>3.3.1.4.&nbsp;
Expires</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option no. |     Length      |            Interval           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>The Expires option specifies the time interval, encoded as a number of
seconds, after which the configuration data contained in this message will
stop being valid.  Any extra margin intended to cover propagation time and
clock skew MUST be included in this time interval.  An Expires option MUST
be included in every Ack message.
</p>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Option no</dt>
<dd>Set to 3 to indicate an Expires option.
</dd>
</dl></blockquote>

<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1.5"></a><h3>3.3.1.5.&nbsp;
My-IPv6-address</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option no. |     Length      |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
   |                                                               |
   +                                                               +
   |                            Address 1                          |
   +                                                               +
   |                                                               |
   +                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
   |                                                               |
   +                                                               +
   |                            Address 2                          |
   +                                                               +
   |                                                               |
   +                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |              ...              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
</pre></div>
<p>The My-IPv6-Address option specifies one or more global unicast IPv6
addresses of the originating node.  This option SHOULD be sent if the
sending node has a global IPv6 unicast address over which it can be
reached, and MUST NOT be sent if the sending node has no IPv6 address, or
if it is unable to receive AHCP packets sent over IPv6 unicast.  Note that
this option is unusual in that it has the same meaning whatever kind of
message it is sent in.
</p>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Option no</dt>
<dd>Set to 4 to indicate a My-IPv6-Address option.
</dd>
<dt>Address 1...</dt>
<dd>Specifies a unicast IPv6 address that can be
used for reaching the originating node.
</dd>
</dl></blockquote>

<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1.6"></a><h3>3.3.1.6.&nbsp;
My-IPv4-address</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option no. |     Length      |            Address 1          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |              ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>The My-IPv4-Address option specifies one or more unicast IPv4 addresses
of the originating node.  This option SHOULD be sent if the sending node
has an IPv4 unicast address over which it can be reached, and MUST NOT be
sent if the sending node has no IPv4 address, or if it is unable to receive
AHCP packets sent over IPv4 unicast.  Note that this option is unusual in
that it has the same meaning whatever kind of message it is sent in.
</p>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Option no</dt>
<dd>Set to 5 to indicate a My-IPv4-Address option.
</dd>
<dt>Address 1...</dt>
<dd>Specifies a unicast IPv4 address that can be
used for reaching the originating node.
</dd>
</dl></blockquote>

<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1.7"></a><h3>3.3.1.7.&nbsp;
IPv6 Prefix</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option no. |     Length      |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
   |                                                               |
   +                                                               +
   |                             Prefix 1                          |
   +                                                               +
   |                                                               |
   +                                               +-+-+-+-+-+-+-+-+
   |                                               |               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               +
   |        ...                                                    |
   +
</pre></div>
<p>The IPv6 Prefix option specifies one or more IPv6 prefixes suitable for
stateless autoconfiguration.
</p>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Option no</dt>
<dd>Set to 6 to indicate an IPv6 prefix option.
</dd>
<dt>Prefix 1...</dt>
<dd>Specifies a prefix, encoded as a 16-octet prefix
followed by a 1-octet prefix length, that the receiving node may use for
stateless autoconfiguration.  The prefix length SHOULD be shorter than
64.
</dd>
</dl></blockquote>

<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1.8"></a><h3>3.3.1.8.&nbsp;
IPv4 Prefix</h3>

<p>The Option number 7 is reserved for the IPv4 Prefix option.  This option
MUST NOT be sent, and MUST be silently ignored on reception, unless it is
marked with the Mandatory option, in which case the whole message MUST be
silently ignored.
</p>
<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1.9"></a><h3>3.3.1.9.&nbsp;
IPv6 Address</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option no. |     Length      |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
   |                                                               |
   +                                                               +
   |                            Address 1                          |
   +                                                               +
   |                                                               |
   +                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
   |                                                               |
   +                                                               +
   |                            Address 2                          |
   +                                                               +
   |                                                               |
   +                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |            ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>The IPv6 Address option specifies one or more IPv6 addresses that are
assigned to the requesting node.
</p>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Option no</dt>
<dd>Set to 8 to indicate an IPv6 Address option.
</dd>
<dt>Address 1...</dt>
<dd>Specifies a unicast IPv6 address that is
assigned to the requesting node.
</dd>
</dl></blockquote>

<a name="anchor38"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1.10"></a><h3>3.3.1.10.&nbsp;
IPv4 Address</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option no. |     Length      |            Address 1          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |              ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>The IPv4 Address option specifies one or more IPv4 addresses that are
assigned to the requesting node.
</p>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Option no</dt>
<dd>Set to 9 to indicate an IPv4 Address option.
</dd>
<dt>Address 1...</dt>
<dd>Specifies a unicast IPv4 address that is
assigned to the requesting node.
</dd>
</dl></blockquote>

<a name="anchor39"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1.11"></a><h3>3.3.1.11.&nbsp;
IPv6 Prefix Delegation</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option no. |     Length      |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
   |                                                               |
   +                                                               +
   |                             Prefix 1                          |
   +                                                               +
   |                                                               |
   +                                               +-+-+-+-+-+-+-+-+
   |                                               |               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               +
   |        ...                                                    |
   +
</pre></div>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Option no</dt>
<dd>Set to 10 to indicate an IPv6 Prefix Delegation
option.
</dd>
<dt>Prefix 1...</dt>
<dd>Specifies an IPv6 prefix that is delegated to the
requesting node.
</dd>
</dl></blockquote>

<a name="anchor40"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1.12"></a><h3>3.3.1.12.&nbsp;
IPv4 Prefix Delegation</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option no. |     Length      |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               +-+-+-+-+-+-+-+-+
   |                          Prefix 1             |               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               +
   |        ...
   +
</pre></div>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Option no</dt>
<dd>Set to 11 to indicate an IPv4 Prefix Delegation
option.
</dd>
<dt>Prefix 1...</dt>
<dd>Specifies an IPv4 prefix that is delegated to the
requesting node.
</dd>
</dl></blockquote>

<a name="anchor41"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1.13"></a><h3>3.3.1.13.&nbsp;
Name Server</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option no. |     Length      |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
   |                                                               |
   +                                                               +
   |                            Address 1                          |
   +                                                               +
   |                                                               |
   +                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
   |                                                               |
   +                                                               +
   |                            Address 2                          |
   +                                                               +
   |                                                               |
   +                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |            ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>The Nameserver option specifies one or more addresses of DNS servers to
be used by the requesting node.
</p>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Option no</dt>
<dd>Set to 12 to indicate a Nameserver option.
</dd>
<dt>Address 1...</dt>
<dd>A list of addresses of suitable name servers.
IPv6-mapped IPv4 addresses are allowed.
</dd>
</dl></blockquote>

<a name="anchor42"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1.14"></a><h3>3.3.1.14.&nbsp;
NTP Server</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Option no. |     Length      |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
   |                                                               |
   +                                                               +
   |                            Address 1                          |
   +                                                               +
   |                                                               |
   +                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
   |                                                               |
   +                                                               +
   |                            Address 2                          |
   +                                                               +
   |                                                               |
   +                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |            ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>The NTP Server option specifies one or more addresses of SNTP servers to
be used by the requesting node.
</p>
<p>Fields :
</p>
<blockquote class="text"><dl>
<dt>Option no</dt>
<dd>Set to 13 to indicate an NTP Server option.
</dd>
<dt>Address 1...</dt>
<dd>A list of addresses of suitable SNTP servers.
IPv6-mapped IPv4 addresses are allowed.
</dd>
</dl></blockquote>

<a name="anchor43"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security Considerations</h3>

<p>As defined in this document, AHCP is a completely insecure protocol.
Any node can pose as an AHCP server, and any node can perform
a denial-of-service attack on a server by requesting large numbers of
leases.  While a number of mitigations are possible, a proper solution to
this issue requires cryptographically authenticating each AHCP message; the
provision of ignoring any data that follows the message is designed to
allow appending a cryptographic key.
</p>
<p>Unlike DHCP, which is purely a link-local protocol, AHCP allows for
packets to be sent to global unicast addresses.  An AHCP network's border
routers should be configured to drop AHCP packets coming from the global
Internet, and AHCP node should be configured to ignore AHCP packets with
a global source address that does not belong to the network configured by
AHCP.
</p>
<p>The information that an AHCP node announces to its neighbours is often
sufficient to determine a mobile node's physical location with reasonable
precision.  The privacy issues that this causes can be mitigated somewhat
by using randomly chosen Node Ids and changing them periodically.
</p>
<a name="anchor44"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>The sample implementation of AHCP uses the multicast group
ff02::cca6:c0f9:e182:5359 and the UDP port 5359.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ADDRARCH">[ADDRARCH]</a></td>
<td class="author-text">Hinden, R. and S. Deering, &ldquo;<a href="http://tools.ietf.org/html/rfc4291">IP Version 6 Addressing Architecture</a>,&rdquo; RFC&nbsp;4291, February&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; RFC&nbsp;2119, March&nbsp;1997.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="DHCP">[DHCP]</a></td>
<td class="author-text">Droms, R., &ldquo;<a href="http://tools.ietf.org/html/rfc2131">Dynamic Host Configuration Protocol</a>,&rdquo; RFC&nbsp;2131, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="DHCPv6">[DHCPv6]</a></td>
<td class="author-text">Droms, R., Ed., Bound, J., Volz, B., Lemon, T., Perkins, C., and M. Carney, &ldquo;<a href="http://tools.ietf.org/html/rfc3315">Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>,&rdquo; RFC&nbsp;3315, July&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="DNS">[DNS]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification.</a>,&rdquo; RFC&nbsp;1035, November&nbsp;1987.</td></tr>
<tr><td class="author-text" valign="top"><a name="JITTER">[JITTER]</a></td>
<td class="author-text">Floyd, S. and V. Jacobson, &ldquo;The synchronization of periodic routing messages,&rdquo; IEEE/ACM Trans. Netw.&nbsp;2, 2, 122-136, April&nbsp;1994.</td></tr>
<tr><td class="author-text" valign="top"><a name="NDP">[NDP]</a></td>
<td class="author-text">Narten, T., Nordmark, E., Simpson, W., and H. Soliman, &ldquo;<a href="http://tools.ietf.org/html/rfc4861">Neighbor Discovery in IPv6</a>,&rdquo; RFC&nbsp;4861, September&nbsp;2007.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Juliusz Chroboczek</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">University of Paris 7</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">175 Rue du Chevaleret</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">75013 Paris,   </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jch@pps.jussieu.fr">jch@pps.jussieu.fr</a></td></tr>
</table>
</body></html>
