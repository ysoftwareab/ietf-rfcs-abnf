<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>SAML Enhanced Client SASL and GSS-API Mechanisms </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Applicability for Non-HTTP Use Cases">
<link href="#rfc.section.4" rel="Chapter" title="4 SAML SASL Mechanism Specification">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Advertisement">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Initiation">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Server Response">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 User Authentication with Identity Provider">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Client Response">
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 Outcome">
<link href="#rfc.section.4.7" rel="Chapter" title="4.7 Additional Notes">
<link href="#rfc.section.5" rel="Chapter" title="5 SAML EC GSS-API Mechanism Specification">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 GSS-API Principal Name Types for SAML EC">
<link href="#rfc.section.6" rel="Chapter" title="6 Example">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Risks Left Unaddressed">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 User Privacy">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Collusion between RPs">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Normative References for GSS-API Implementers">
<link href="#rfc.references.3" rel="Chapter" title="9.3 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Acknowledgments">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B Changes">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="Security Assertion Markup Language (SAML) 2.0 is a generalized framework for the exchange of security-related information between asserting and relying parties.  Simple Authentication and Security Layer (SASL) and the Generic Security Service Application Program Interface (GSS-API) are application frameworks to facilitate an extensible authentication model. This document specifies a SASL and GSS-API mechanism for SAML 2.0 that leverages the capabilities of a SAML-aware "enhanced client" to address significant barriers to federated authentication in a manner that encourages reuse of existing SAML bindings and profiles designed for non-browser scenarios.  " />
  <meta name="description" content="Security Assertion Markup Language (SAML) 2.0 is a generalized framework for the exchange of security-related information between asserting and relying parties.  Simple Authentication and Security Layer (SASL) and the Generic Security Service Application Program Interface (GSS-API) are application frameworks to facilitate an extensible authentication model. This document specifies a SASL and GSS-API mechanism for SAML 2.0 that leverages the capabilities of a SAML-aware "enhanced client" to address significant barriers to federated authentication in a manner that encourages reuse of existing SAML bindings and profiles designed for non-browser scenarios.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">S. Cantor</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Internet2</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">S. Josefsson</td>
</tr>
<tr>
<td class="left">Expires: March 02, 2012</td>
<td class="right">SJD AB</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">August 30, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">SAML Enhanced Client SASL and GSS-API Mechanisms <br />
  <span class="filename">draft-ietf-kitten-sasl-saml-ec-00.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Security Assertion Markup Language (SAML) 2.0 is a generalized framework for the exchange of security-related information between asserting and relying parties.  Simple Authentication and Security Layer (SASL) and the Generic Security Service Application Program Interface (GSS-API) are application frameworks to facilitate an extensible authentication model. This document specifies a SASL and GSS-API mechanism for SAML 2.0 that leverages the capabilities of a SAML-aware "enhanced client" to address significant barriers to federated authentication in a manner that encourages reuse of existing SAML bindings and profiles designed for non-browser scenarios.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on March 02, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Applicability for Non-HTTP Use Cases</a>
</li>
<li>4.   <a href="#rfc.section.4">SAML SASL Mechanism Specification</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Advertisement</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Initiation</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Server Response</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">User Authentication with Identity Provider</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Client Response</a>
</li>
<li>4.6.   <a href="#rfc.section.4.6">Outcome</a>
</li>
<li>4.7.   <a href="#rfc.section.4.7">Additional Notes</a>
</li>
<li>5.   <a href="#rfc.section.5">SAML EC GSS-API Mechanism Specification</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">GSS-API Principal Name Types for SAML EC</a>
</li>
<li>6.   <a href="#rfc.section.6">Example</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">Risks Left Unaddressed</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">User Privacy</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">Collusion between RPs</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Normative References for GSS-API Implementers</a>
</li>
<li>9.3.   <a href="#rfc.references.3">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Acknowledgments</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">Changes</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p><a href="#OASIS.saml-core-2.0-os">Security Assertion Markup Language (SAML) 2.0</a> <cite title="NONE">[OASIS.saml-core-2.0-os]</cite> is a modular specification that provides various means for a user to be identified to a relying party (RP) through the exchange of (typically signed) assertions issued by an identity provider (IdP). It includes a number of protocols, protocol <a href="#OASIS.saml-bindings-2.0-os">bindings</a> <cite title="NONE">[OASIS.saml-bindings-2.0-os]</cite>, and <a href="#OASIS.saml-profiles-2.0-os">interoperability profiles</a> <cite title="NONE">[OASIS.saml-profiles-2.0-os]</cite> designed for different use cases. Additional profiles and extensions are also routinely developed and published.  </p>
<p><a href="#RFC4422">Simple Authentication and Security Layer (SASL)</a> <cite title="NONE">[RFC4422]</cite> is a generalized mechanism for identifying and authenticating a user and for optionally negotiating a security layer for subsequent protocol interactions. SASL is used by application protocols like IMAP, POP and <a href="#RFC3920">XMPP</a> <cite title="NONE">[RFC3920]</cite>.  The effect is to make authentication modular, so that newer authentication mechanisms can be added as needed.  </p>
<p id="rfc.section.1.p.3">The <a href="#RFC2743">Generic Security Service Application Program Interface (GSS-API)</a> <cite title="NONE">[RFC2743]</cite> provides a framework for applications to support multiple authentication mechanisms through a unified programming interface.  This document defines a pure SASL mechanism for SAML, but it conforms to the bridge between SASL and the GSS-API called <a href="#RFC5801">GS2</a> <cite title="NONE">[RFC5801]</cite>.  This means that this document defines both a SASL mechanism and a GSS-API mechanism.  The GSS-API interface is optional for SASL implementers, and the GSS-API considerations can be avoided in environments that uses SASL directly without GSS-API.  </p>
<p id="rfc.section.1.p.4">The mechanisms specified in this document allow a SASL- or GSS-API-enabled server to act as a SAML relying party, or service provider (SP), by advertising this mechanism as an option for SASL or GSS-API clients that support the use of SAML to communicate identity and attribute information. Clients supporting this mechanism are termed "enhanced clients" in SAML terminology because they understand the federated authentication model and have specific knowledge of the IdP(s) associated with the user. This knowledge, and the ability to act on it, addresses a significant problem with browser-based SAML profiles known as the "discovery", or "where are you from?" (WAYF) problem. Obviating the need for the RP to interact with the client to determine the right IdP (and its network location) is both a user interface and security improvement.  </p>
<p id="rfc.section.1.p.5">The SAML mechanism described in this document is an adaptation of an existing SAML profile, the <a href="#SAMLECP20">Enhanced Client or Proxy (ECP) Profile (V2.0)</a> <cite title="NONE">[SAMLECP20]</cite>, and therefore does not establish a separate authentication, integrity and confidentiality mechanism.  It is anticipated that existing security layers, such as Transport Layer Security (TLS), will continued to be used.</p>
<p><a href="#overview">Figure 1</a> describes the interworking between SAML and SASL: this document requires enhancements to the RP and to the client (as the two SASL communication endpoints) but no changes to the SAML IdP are assumed apart from its support for the applicable SAML profile. To accomplish this, a SAML protocol exchange between the RP and the IdP, brokered by the client, is tunneled within SASL. There is no assumed communication between the RP and the IdP, but such communication may occur in conjunction with additional SAML-related profiles not in scope for this document.</p>
<div id="#rfc.figure.1"></div>
<div id="#overview"></div>
<pre> 


                                    +-----------+
                                    |  SAML     |
                                    |  Relying  |
                                    |  Party    |
                                    |           |
                                    +-----------+
                                          ^
                                       +--|--+
                                       | S|  |
                                     S | A|  |
                                     A | M|  |
                                     S | L|  |
                                     L |  |  |
                                       |  |  |
                                       +--|--+
      +------------+                      v
      |            |                 +----------+
      |  SAML      |     SAML SOAP   |          |
      |  Identity  |&lt;---------------&gt;|  Client  |
      |  Provider  |      Binding    |          |
      +------------+                 +----------+

</pre>
<p></p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.2.p.2">The reader is also assumed to be familiar with the terms used in the SAML 2.0 specification, and an understanding of the <a href="#SAMLECP20">Enhanced Client or Proxy (ECP) Profile (V2.0)</a> <cite title="NONE">[SAMLECP20]</cite> is necessary, as part of this mechanism explicitly reuses and references it.</p>
<p id="rfc.section.2.p.3">This document can be implemented without knowledge of GSS-API since the normative aspects of the GS2 protocol syntax have been duplicated in this document. The document may also be implemented to provide a GSS-API mechanism, and then knowledge of GSS-API is essential. To faciliate these two variants, the references has been split into two parts, one part that provides normative references for all readers, and one part that adds additional normative references required for implementers that wish to implement the GSS-API portion.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Applicability for Non-HTTP Use Cases</h1>
<p id="rfc.section.3.p.1">While SAML is designed to support a variety of application scenarios, the profiles for authentication defined in the original standard are designed around <a href="#RFC2616">HTTP</a> <cite title="NONE">[RFC2616]</cite> applications.  They are not, however, limited to browsers, because it was recognized that browsers suffer from a variety of functional and security deficiencies that would be useful to avoid where possible. Specifically, the notion of an "Enhanced Client" (or a proxy acting as one on behalf of a browser, thus the term "ECP") was specified for a software component that acts somewhat like a browser from an application perspective, but includes limited, but sufficient, awareness of SAML to play a more conscious role in the authentication exchange between the RP and the IdP. What follows is an outline of the <a href="#SAMLECP20">Enhanced Client or Proxy (ECP) Profile (V2.0)</a> <cite title="NONE">[SAMLECP20]</cite>, as applied to the web/HTTP service use case:</p>
<p></p>

<ol>
<li>The Enhanced Client requests a resource of a Relying Party (RP) (via an HTTP request).  In doing so, it advertises its "enhanced" capability using HTTP headers.</li>
<li>The RP, desiring SAML authentication and noting the client's capabilities, responds not with an HTTP redirect or form, but with a <a href="#W3C.soap11">SOAP</a> <cite title="NONE">[W3C.soap11]</cite> envelope containing a SAML &lt;AuthnRequest&gt; along with some supporting headers. This request identifies the RP (and may be signed), and may provide hints to the client as to what IdPs the RP finds acceptable, but the choice of IdP is generally left to the client.</li>
<li>The client is then responsible for delivering the body of the SOAP message to the IdP it is instructed to use (often via configuration ahead of time).  The user authenticates to the IdP ahead of, during, or after the delivery of this message, and perhaps explicitly authorizes the response to the RP.</li>
<li>Whether authentication succeeds or fails, the IdP responds with its own SOAP envelope, generally containing a SAML &lt;Response&gt; message for delivery to the RP. In a successful case, the message will include a SAML &lt;Assertion&gt; containing authentication, and possibly attribute, information about the user.  Either the response or assertion alone is signed, and the assertion may be encrypted to a key negotiated with or known to belong to the RP.</li>
<li>The client then delivers the SOAP envelope containing the &lt;Response&gt; to the RP at a location the IdP directs (which acts as an additional, though limited, defense against MITM attacks). This completes the SAML exchange.</li>
<li>The RP now has sufficient identity information to approve the original HTTP request or not, and acts accordingly. Everything between the original request and this response can be thought of as an "interruption" of the original HTTP exchange.</li>
</ol>

<p> </p>
<p id="rfc.section.3.p.3">When considering this flow in the context of an arbitrary application protocol and SASL, the RP and the client both must change their code to implement this SASL mechanism, but the IdP can remain untouched. The existing RP/client exchange that is tunneled through HTTP maps well to the tunneling of that same exchange in SASL. In the parlance of <a href="#RFC4422">SASL</a> <cite title="NONE">[RFC4422]</cite>, this mechanism is "client-first" for consistency with GS2. The steps are shown below:</p>
<p></p>

<ol>
<li>The server MAY advertise the SAML20EC and/or SAML20EC-PLUS mechanisms.</li>
<li>The client initiates a SASL authentication with SAML20EC or SAML20EC-PLUS.</li>
<li>The server sends the client a challenge consisting of a SOAP envelope containing its SAML &lt;AuthnRequest&gt;.</li>
<li>The SASL client unpacks the SOAP message and communicates with its chosen IdP to relay the SAML &lt;AuthnRequest&gt; to it. This communication, and the authentication with the IdP, proceeds separately from the SASL process.</li>
<li>Upon completion of the exchange with the IdP, the client responds to the SASL server with a SOAP envelope containing the SAML &lt;Response&gt; it obtained, or a SOAP fault, as warranted.</li>
<li>The SASL Server indicates success or failure.</li>
</ol>

<p> </p>
<p id="rfc.section.3.p.5">Note: The details of the SAML processing, which are consistent with the <a href="#SAMLECP20">Enhanced Client or Proxy (ECP) Profile (V2.0)</a> <cite title="NONE">[SAMLECP20]</cite>, are such that the client MUST interact with the IdP in order to complete any SASL exchange with the RP. The assertions issued by the IdP for the purposes of the profile, and by extension this SASL mechanism, are short lived, and therefore cannot be cached by the client for later use.</p>
<p id="rfc.section.3.p.6">Encompassed in step four is the client-driven selection of the IdP, authentication to it, and the acquisition of a response to provide to the SASL server. These processes are all external to SASL.</p>
<p id="rfc.section.3.p.7">With all of this in mind, the typical flow appears as follows:</p>
<div id="#rfc.figure.2"></div>
<div id="#flow"></div>
<pre> 


      SASL Serv.       Client          IdP
         |&gt;-----(1)-----&gt;|              | Advertisement
         |               |              |
         |&lt;-----(2)-----&lt;|              | Initiation
         |               |              |
         |&gt;-----(3)-----&gt;|              | SASL Server Response
         |               |              |
         |               |&lt;- - -(4)- - &gt;| SOAP AuthnRequest + user authn
         |               |              |
         |&lt;-----(5)-----&lt;|              | SASL Client Response
         |               |              |
         |&gt;-----(6)-----&gt;|              | Server sends Outcome
         |               |              |

       ----- = SASL
       - - - = SOAP over HTTPS (external to SASL)
 
</pre>
<p></p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> SAML SASL Mechanism Specification</h1>
<p id="rfc.section.4.p.1">Based on the previous figures, the following operations are defined by the SAML SASL mechanism:</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#advertisement" id="advertisement">Advertisement</a>
</h1>
<p id="rfc.section.4.1.p.1">To advertise that a server supports this mechanism, during application session initiation, it displays the name "SAML20EC" and/or "SAML20EC-PLUS" in the list of supported SASL mechanisms (depending on its support for channel binding).</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#initiation" id="initiation">Initiation</a>
</h1>
<p id="rfc.section.4.2.p.1">A client initiates "SAML20EC" or "SAML20EC-PLUS" authentication. If supported by the application protocol, the client MAY include an initial response, otherwise it waits until the server has issued an empty challenge (because the mechanism is client-first).</p>
<p id="rfc.section.4.2.p.2">The format of the initial client response is as follows:</p>
<div id="#rfc.figure.3"></div>
<pre>
	  holder-of-key = "urn:oasis:names:tc:SAML:2.0:cm:holder-of-key"

    initial-response = gs2-cb-flag "," [gs2-authzid] "," [holder-of-key]
	      </pre>
<p id="rfc.section.4.2.p.3">The gs2-cb-flag MUST be set as defined in <a href="#RFC5801">[RFC5801]</a> to indicate whether the client supports channel binding. This takes the place of the PAOS HTTP header extension used in <a href="#SAMLECP20">[SAMLECP20]</a> to indicate channel binding support.</p>
<p id="rfc.section.4.2.p.4">The optional "gs2-authzid" field holds the authorization identity, as requested by the client.</p>
<p id="rfc.section.4.2.p.5">The optional "holder-of-key" field is a constant that signals the client's support for stronger security by means of a locally held key. This takes the place of the PAOS HTTP header extension used in <a href="#SAMLECP20">[SAMLECP20]</a> to indicate "holder of key" support.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#serverresponse" id="serverresponse">Server Response</a>
</h1>
<p id="rfc.section.4.3.p.1">The SASL server responds with a SOAP envelope constructed in accordance with section 2.3.2 of <a href="#SAMLECP20">[SAMLECP20]</a>. This includes adhering to the SOAP header requirements of the <a href="#OASIS.saml-bindings-2.0-os">SAML PAOS Binding</a> <cite title="NONE">[OASIS.saml-bindings-2.0-os]</cite>, for compatibility with the existing profile. Various SOAP headers are also consumed by the client in exactly the same manner prescribed by that section.</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#userauthn" id="userauthn">User Authentication with Identity Provider</a>
</h1>
<p id="rfc.section.4.4.p.1">Upon receipt of the <a href="#serverresponse">Server Response</a> <cite title="NONE">[serverresponse]</cite>, the steps described in sections 2.3.3 through 2.3.6 of <a href="#SAMLECP20">[SAMLECP20]</a> are performed between the client and the chosen IdP. The means by which the client determines the IdP to use, and where it is located, are out of scope of this mechanism.</p>
<p id="rfc.section.4.4.p.2">The exact means of authentication to the IdP are also out of scope, but clients supporting this mechanism MUST support HTTP Basic Authentication as defined in <a href="#RFC2617">[RFC2617]</a> and TLS client authentication as defined in <a href="#RFC5246">[RFC5246]</a>.</p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> <a href="#clientresponse" id="clientresponse">Client Response</a>
</h1>
<p id="rfc.section.4.5.p.1">Assuming a response is obtained from the IdP, the client responds to the SASL server with a SOAP envelope constructed in accordance with section 2.3.7 of <a href="#SAMLECP20">[SAMLECP20]</a>. This includes adhering to the SOAP header requirements of the <a href="#OASIS.saml-bindings-2.0-os">SAML PAOS Binding</a> <cite title="NONE">[OASIS.saml-bindings-2.0-os]</cite>, for compatibility with the existing profile. If the client is unable to obtain a response from the IdP, it responds to the SASL server with a SOAP envelope containing a SOAP fault.</p>
<h1 id="rfc.section.4.6">
<a href="#rfc.section.4.6">4.6.</a> <a href="#outcome" id="outcome">Outcome</a>
</h1>
<p id="rfc.section.4.6.p.1">The SAML protocol exchange having completed, the SASL server will transmit the outcome to the client depending on local validation of the client responses.</p>
<h1 id="rfc.section.4.7">
<a href="#rfc.section.4.7">4.7.</a> <a href="#notes" id="notes">Additional Notes</a>
</h1>
<p id="rfc.section.4.7.p.1">Because this mechanism is an adaptation of an HTTP-based profile, there are a few requirements outlined in <a href="#SAMLECP20">[SAMLECP20]</a> that make reference to a response URL that is normally used to regulate where the client returns information to the RP. There are also security-related checks built into the profile that involve this location.</p>
<p id="rfc.section.4.7.p.2">For compatibility with existing IdP and profile behavior, and to provide for secure identification of the RP to the client, the SASL server MUST populate the responseConsumerURL and AssertionConsumerServiceURL attributes with its service name, expressed as an absolute URI. The parties then perform the steps described in <a href="#SAMLECP20">[SAMLECP20]</a> as usual.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> SAML EC GSS-API Mechanism Specification</h1>
<p id="rfc.section.5.p.1">This section and its sub-sections and all normative references of it not referenced elsewhere in this document are INFORMATIONAL for SASL implementors, but they are NORMATIVE for GSS-API implementors.</p>
<p id="rfc.section.5.p.2">The SAML SASL Enhanced Clients mechanism is also a GSS-API mechanism. The messages are the same, but a) the GS2 header on the client's first message is excluded when SAML EC is used as a GSS-API mechanism, and b) the RFC2743 section 3.1 initial context token header is prefixed to the client's first authentication message (context token).</p>
<p id="rfc.section.5.p.3">The GSS-API mechanism OID for SAML EC is 1.3.6.1.4.1.11591.4.6.</p>
<p id="rfc.section.5.p.4">SAML EC security contexts always have the mutual_state flag (GSS_C_MUTUAL_FLAG) set to TRUE.  SAML EC does not support credential delegation, therefore SAML EC security contexts alway have the deleg_state flag (GSS_C_DELEG_FLAG) set to FALSE.</p>
<p id="rfc.section.5.p.5">The mutual authentication property of this mechanism relies on successfully comparing the TLS server identity with the negotiated target name.  Since the TLS channel is managed by the application outside of the GSS-API mechanism, the mechanism itself is unable to confirm the name while the application is able to perform this comparison for the mechanism.  For this reason, applications MUST match the TLS server identity with the target name, as discussed in <a href="#RFC6125">[RFC6125]</a>.</p>
<p id="rfc.section.5.p.6">The SAML EC mechanism does not support per-message tokens or GSS_Pseudo_random.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> GSS-API Principal Name Types for SAML EC</h1>
<p id="rfc.section.5.1.p.1">SAML EC supports standard generic name syntaxes for acceptors such as GSS_C_NT_HOSTBASED_SERVICE (see [RFC2743], Section 4.1). These service names MUST be associated with the SAML "entityID" claimed by the RP, such as through the use of <a href="#OASIS.saml-metadata-2.0-os">SAML metadata</a> <cite title="NONE">[OASIS.saml-metadata-2.0-os]</cite>.</p>
<p id="rfc.section.5.1.p.2">SAML EC supports only a single name type for initiators: GSS_C_NT_USER_NAME. GSS_C_NT_USER_NAME is the default name type for SAML EC.</p>
<p id="rfc.section.5.1.p.3">The query, display, and exported name syntaxes for SAML EC principal names are all the same.  There are no SAML EC-specific name syntaxes -- applications should use generic GSS-API name types such as GSS_C_NT_USER_NAME and GSS_C_NT_HOSTBASED_SERVICE (see [RFC2743], Section 4). The exported name token does, of course, conform to [RFC2743], Section 3.2, but the "NAME" part of the token should be treated as a potential input string to the SAML EC name normalization rules.</p>
<p id="rfc.section.5.1.p.4">GSS-API name attributes may be defined in the future to hold the normalized SAML EC Identifier.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Example</h1>
<p id="rfc.section.6.p.1">Suppose the user has an identity at the SAML IdP saml.example.org and a Jabber Identifier (jid) "somenode@example.com", and wishes to authenticate his XMPP connection to xmpp.example.com (and example.com and example.org have established a SAML-capable trust relationship).  The authentication on the wire would then look something like the following:</p>
<p id="rfc.section.6.p.2">Step 1: Client initiates stream to server:</p>
<div id="#rfc.figure.4"></div>
<pre>

&lt;stream:stream xmlns='jabber:client'
xmlns:stream='http://etherx.jabber.org/streams'
to='example.com' version='1.0'&gt;

</pre>
<p id="rfc.section.6.p.3">Step 2: Server responds with a stream tag sent to client:</p>
<div id="#rfc.figure.5"></div>
<pre>

&lt;stream:stream
xmlns='jabber:client' xmlns:stream='http://etherx.jabber.org/streams'
id='some_id' from='example.com' version='1.0'&gt;

</pre>
<p id="rfc.section.6.p.4">Step 3: Server informs client of available authentication mechanisms:</p>
<div id="#rfc.figure.6"></div>
<pre>

&lt;stream:features&gt; 
 &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
  &lt;mechanism&gt;DIGEST-MD5&lt;/mechanism&gt; 
  &lt;mechanism&gt;PLAIN&lt;/mechanism&gt;
  &lt;mechanism&gt;SAML20EC&lt;/mechanism&gt; 
 &lt;/mechanisms&gt; 
&lt;/stream:features&gt;

</pre>
<p id="rfc.section.6.p.5">Step 4: Client selects an authentication mechanism and sends the initial client response (it is base64 encoded as specified by the XMPP SASL protocol profile):</p>
<div id="#rfc.figure.7"></div>
<pre>

&lt;auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='SAML20EC'&gt;
biws
&lt;/auth&gt;

</pre>
<p id="rfc.section.6.p.6">The initial response is "n,," which signals that channel binding is not used, there is no authorization identity, and the client does not support key-based confirmation.</p>
<p id="rfc.section.6.p.7">Step 5: Server sends a challenge to client in the form of a SOAP envelope containing its SAML &lt;AuthnRequest&gt;:</p>
<div id="#rfc.figure.8"></div>
<pre>

&lt;challenge xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
PFM6RW52ZWxvcGUNCiAgICB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoy
LjA6YXNzZXJ0aW9uIg0KICAgIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FN
TDoyLjA6cHJvdG9jb2wiDQogICAgeG1sbnM6Uz0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5v
cmcvc29hcC9lbnZlbG9wZS8iPg0KICA8UzpIZWFkZXI+DQogICAgPHBhb3M6UmVxdWVzdCB4
bWxuczpwYW9zPSJ1cm46bGliZXJ0eTpwYW9zOjIwMDMtMDgiDQogICAgICBtZXNzYWdlSUQ9
ImMzYTRmOGI5YzJkIiBTOm11c3RVbmRlcnN0YW5kPSIxIg0KICAgICAgUzphY3Rvcj0iaHR0
cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9hY3Rvci9uZXh0Ig0KICAgICAgcmVzcG9u
c2VDb25zdW1lclVSTD0iaHR0cHM6Ly94bXBwLmV4YW1wbGUuY29tIg0KICAgICAgc2Vydmlj
ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb2ZpbGVzOlNTTzplY3AiLz4NCiAg
ICA8ZWNwOlJlcXVlc3QNCiAgICAgIHhtbG5zOmVjcD0idXJuOm9hc2lzOm5hbWVzOnRjOlNB
TUw6Mi4wOnByb2ZpbGVzOlNTTzplY3AiDQogICAgICBTOmFjdG9yPSJodHRwOi8vc2NoZW1h
cy54bWxzb2FwLm9yZy9zb2FwL2FjdG9yL25leHQiDQogICAgICBTOm11c3RVbmRlcnN0YW5k
PSIxIiBQcm92aWRlck5hbWU9IkphYmJlciBhdCBleGFtcGxlLmNvbSI+DQogICAgICA8c2Ft
bDpJc3N1ZXI+aHR0cHM6Ly94bXBwLmV4YW1wbGUuY29tPC9zYW1sOklzc3Vlcj4NCiAgICA8
L2VjcDpSZXF1ZXN0Pg0KICA8L1M6SGVhZGVyPg0KICA8UzpCb2R5Pg0KICAgIDxzYW1scDpB
dXRoblJlcXVlc3QNCiAgICAgIElEPSJjM2E0ZjhiOWMyZCIgVmVyc2lvbj0iMi4wIiBJc3N1
ZUluc3RhbnQ9IjIwMDctMTItMTBUMTE6Mzk6MzRaIg0KICAgICAgUHJvdG9jb2xCaW5kaW5n
PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YmluZGluZ3M6UEFPUyINCiAgICAgIEFz
c2VydGlvbkNvbnN1bWVyU2VydmljZVVSTD0iaHR0cHM6Ly94bXBwLmV4YW1wbGUuY29tIj4N
CiAgICAgIDxzYW1sOklzc3VlciB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FN
TDoyLjA6YXNzZXJ0aW9uIj4NCiAgICAgICBodHRwczovL3htcHAuZXhhbXBsZS5jb20NCiAg
ICAgIDwvc2FtbDpJc3N1ZXI+DQogICAgICA8c2FtbHA6TmFtZUlEUG9saWN5IEFsbG93Q3Jl
YXRlPSJ0cnVlIg0KICAgICAgICBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIu
MDpuYW1laWQtZm9ybWF0OnBlcnNpc3RlbnQiLz4NCiAgICAgIDxzYW1scDpSZXF1ZXN0ZWRB
dXRobkNvbnRleHQgQ29tcGFyaXNvbj0iZXhhY3QiPg0KICAgICAgIDxzYW1sOkF1dGhuQ29u
dGV4dENsYXNzUmVmPg0KICAgICAgIHVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphYzpj
bGFzc2VzOlBhc3N3b3JkUHJvdGVjdGVkVHJhbnNwb3J0DQogICAgICAgPC9zYW1sOkF1dGhu
Q29udGV4dENsYXNzUmVmPg0KICAgICAgPC9zYW1scDpSZXF1ZXN0ZWRBdXRobkNvbnRleHQ+
IA0KICAgIDwvc2FtbHA6QXV0aG5SZXF1ZXN0Pg0KICA8L1M6Qm9keT4NCjwvUzpFbnZlbG9w
ZT4NCg==
&lt;/challenge&gt;

</pre>
<p id="rfc.section.6.p.8">The <a href="#RFC4648">Base64</a> <cite title="NONE">[RFC4648]</cite> decoded envelope:</p>
<div id="#rfc.figure.9"></div>
<pre>

&lt;S:Envelope
    xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion"
    xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"
    xmlns:S="http://schemas.xmlsoap.org/soap/envelope/"&gt;
  &lt;S:Header&gt;
    &lt;paos:Request xmlns:paos="urn:liberty:paos:2003-08"
      messageID="c3a4f8b9c2d" S:mustUnderstand="1"
      S:actor="http://schemas.xmlsoap.org/soap/actor/next"
      responseConsumerURL="xmpp:xmpp.example.com"
      service="urn:oasis:names:tc:SAML:2.0:profiles:SSO:ecp"/&gt;
    &lt;ecp:Request
      xmlns:ecp="urn:oasis:names:tc:SAML:2.0:profiles:SSO:ecp"
      S:actor="http://schemas.xmlsoap.org/soap/actor/next"
      S:mustUnderstand="1" ProviderName="Jabber at example.com"&gt;
      &lt;saml:Issuer&gt;https://xmpp.example.com&lt;/saml:Issuer&gt;
    &lt;/ecp:Request&gt;
  &lt;/S:Header&gt;
  &lt;S:Body&gt;
    &lt;samlp:AuthnRequest
      ID="c3a4f8b9c2d" Version="2.0" IssueInstant="2007-12-10T11:39:34Z"
      ProtocolBinding="urn:oasis:names:tc:SAML:2.0:bindings:PAOS"
      AssertionConsumerServiceURL="xmpp:xmpp.example.com"&gt;
      &lt;saml:Issuer xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion"&gt;
       https://xmpp.example.com
      &lt;/saml:Issuer&gt;
      &lt;samlp:NameIDPolicy AllowCreate="true"
        Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"/&gt;
      &lt;samlp:RequestedAuthnContext Comparison="exact"&gt;
       &lt;saml:AuthnContextClassRef&gt;
       urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport
       &lt;/saml:AuthnContextClassRef&gt;
      &lt;/samlp:RequestedAuthnContext&gt; 
    &lt;/samlp:AuthnRequest&gt;
  &lt;/S:Body&gt;
&lt;/S:Envelope&gt;

</pre>
<p id="rfc.section.6.p.9">Step 5 (alt): Server returns error to client:</p>
<div id="#rfc.figure.10"></div>
<pre>

&lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt; 
 &lt;incorrect-encoding/&gt;
&lt;/failure&gt; 
&lt;/stream:stream&gt;

</pre>
<p id="rfc.section.6.p.10">Step 6: Client relays the request to IdP in a SOAP message transmitted over HTTP (over TLS). HTTP portion not shown, use of Basic Authentication is assumed. The body of the SOAP envelope is exactly the same as received in the previous step.</p>
<div id="#rfc.figure.11"></div>
<pre>

&lt;S:Envelope
    xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion"
    xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"
    xmlns:S="http://schemas.xmlsoap.org/soap/envelope/"&gt;
    &lt;S:Body&gt;
        &lt;samlp:AuthnRequest&gt;
        &lt;!-- same as above --&gt;
        &lt;/samlp:AuthnRequest&gt;
    &lt;/S:Body&gt;
&lt;/S:Envelope&gt;

</pre>
<p id="rfc.section.6.p.11">Step 7: IdP responds to client with a SOAP response containing a SAML &lt;Response&gt; containing a short-lived SSO assertion (shown as an encrypted variant in the example).</p>
<div id="#rfc.figure.12"></div>
<pre>

&lt;S:Envelope
    xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion"
    xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"
    xmlns:S="http://schemas.xmlsoap.org/soap/envelope/"&gt;
  &lt;S:Header&gt;
    &lt;ecp:Response S:mustUnderstand="1"
      S:actor="http://schemas.xmlsoap.org/soap/actor/next"
      AssertionConsumerServiceURL="xmpp:xmpp.example.com"/&gt;
  &lt;/S:Header&gt;
  &lt;S:Body&gt;
    &lt;samlp:Response ID="d43h94r389309r" Version="2.0"
        IssueInstant="2007-12-10T11:42:34Z" InResponseTo="c3a4f8b9c2d"
        Destination="xmpp:xmpp.example.com"&gt;
      &lt;saml:Issuer&gt;https://saml.example.org&lt;/saml:Issuer&gt;
      &lt;samlp:Status&gt;
        &lt;samlp:StatusCode
            Value="urn:oasis:names:tc:SAML:2.0:status:Success"/&gt;
      &lt;/samlp:Status&gt;
      &lt;saml:EncryptedAssertion&gt;
        &lt;!-- contents elided --&gt;
      &lt;/saml:EncryptedAssertion&gt;
    &lt;/samlp:Response&gt;
  &lt;/S:Body&gt;
&lt;/S:Envelope&gt;

</pre>
<p id="rfc.section.6.p.12">Step 8: Client sends SOAP envelope containing the SAML &lt;Response&gt; as a response to the SASL server's challenge:</p>
<div id="#rfc.figure.13"></div>
<pre>

&lt;response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
PFM6RW52ZWxvcGUNCiAgICB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoy
LjA6YXNzZXJ0aW9uIg0KICAgIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FN
TDoyLjA6cHJvdG9jb2wiDQogICAgeG1sbnM6Uz0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5v
cmcvc29hcC9lbnZlbG9wZS8iPg0KICA8UzpIZWFkZXI+DQogICAgPHBhb3M6UmVzcG9uc2Ug
eG1sbnM6cGFvcz0idXJuOmxpYmVydHk6cGFvczoyMDAzLTA4Ig0KICAgICAgUzphY3Rvcj0i
aHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9hY3Rvci9uZXh0Ig0KICAgICAgUzpt
dXN0VW5kZXJzdGFuZD0iMSIgcmVmVG9NZXNzYWdlSUQ9IjZjM2E0ZjhiOWMyZCIvPg0KICA8
L1M6SGVhZGVyPg0KICA8UzpCb2R5Pg0KICAgIDxzYW1scDpSZXNwb25zZSBJRD0iZDQzaDk0
cjM4OTMwOXIiIFZlcnNpb249IjIuMCINCiAgICAgICAgSXNzdWVJbnN0YW50PSIyMDA3LTEy
LTEwVDExOjQyOjM0WiIgSW5SZXNwb25zZVRvPSJjM2E0ZjhiOWMyZCINCiAgICAgICAgRGVz
dGluYXRpb249Imh0dHBzOi8veG1wcC5leGFtcGxlLmNvbSI+DQogICAgICA8c2FtbDpJc3N1
ZXI+aHR0cHM6Ly9zYW1sLmV4YW1wbGUub3JnPC9zYW1sOklzc3Vlcj4NCiAgICAgIDxzYW1s
cDpTdGF0dXM+DQogICAgICAgIDxzYW1scDpTdGF0dXNDb2RlDQogICAgICAgICAgICBWYWx1
ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnN0YXR1czpTdWNjZXNzIi8+DQogICAg
ICA8L3NhbWxwOlN0YXR1cz4NCiAgICAgIDxzYW1sOkVuY3J5cHRlZEFzc2VydGlvbj4NCiAg
ICAgICAgPCEtLSBjb250ZW50cyBlbGlkZWQgLS0+DQogICAgICA8L3NhbWw6RW5jcnlwdGVk
QXNzZXJ0aW9uPg0KICAgIDwvc2FtbHA6UmVzcG9uc2U+DQogIDwvUzpCb2R5Pg0KPC9TOkVu
dmVsb3BlPg0K
&lt;/response&gt;

</pre>
<p id="rfc.section.6.p.13">The <a href="#RFC4648">Base64</a> <cite title="NONE">[RFC4648]</cite> decoded envelope:</p>
<div id="#rfc.figure.14"></div>
<pre>

&lt;S:Envelope
    xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion"
    xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"
    xmlns:S="http://schemas.xmlsoap.org/soap/envelope/"&gt;
  &lt;S:Header&gt;
    &lt;paos:Response xmlns:paos="urn:liberty:paos:2003-08"
      S:actor="http://schemas.xmlsoap.org/soap/actor/next"
      S:mustUnderstand="1" refToMessageID="6c3a4f8b9c2d"/&gt;
  &lt;/S:Header&gt;
  &lt;S:Body&gt;
    &lt;samlp:Response ID="d43h94r389309r" Version="2.0"
        IssueInstant="2007-12-10T11:42:34Z" InResponseTo="c3a4f8b9c2d"
        Destination="xmpp:xmpp.example.com"&gt;
      &lt;saml:Issuer&gt;https://saml.example.org&lt;/saml:Issuer&gt;
      &lt;samlp:Status&gt;
        &lt;samlp:StatusCode
            Value="urn:oasis:names:tc:SAML:2.0:status:Success"/&gt;
      &lt;/samlp:Status&gt;
      &lt;saml:EncryptedAssertion&gt;
        &lt;!-- contents elided --&gt;
      &lt;/saml:EncryptedAssertion&gt;
    &lt;/samlp:Response&gt;
  &lt;/S:Body&gt;
&lt;/S:Envelope&gt;

</pre>
<p id="rfc.section.6.p.14">Step 9: Server informs client of successful authentication:</p>
<div id="#rfc.figure.15"></div>
<pre>

&lt;success xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/&gt;

</pre>
<p id="rfc.section.6.p.15">Step 9 (alt): Server informs client of failed authentication:</p>
<div id="#rfc.figure.16"></div>
<pre>

&lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt; 
 &lt;temporary-auth-failure/&gt;
&lt;/failure&gt; 
&lt;/stream:stream&gt;

</pre>
<p id="rfc.section.6.p.16">Step 10: Client initiates a new stream to server:</p>
<div id="#rfc.figure.17"></div>
<pre>

&lt;stream:stream xmlns='jabber:client'
xmlns:stream='http://etherx.jabber.org/streams'
to='example.com' version='1.0'&gt;

</pre>
<p id="rfc.section.6.p.17">Step 11: Server responds by sending a stream header to client along with any additional features (or an empty features element):</p>
<div id="#rfc.figure.18"></div>
<pre>

&lt;stream:stream xmlns='jabber:client'
xmlns:stream='http://etherx.jabber.org/streams'
id='c2s_345' from='example.com' version='1.0'&gt; 
&lt;stream:features&gt; 
 &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'/&gt; 
 &lt;session xmlns='urn:ietf:params:xml:ns:xmpp-session'/&gt; 
&lt;/stream:features&gt;

</pre>
<p id="rfc.section.6.p.18">Step 12: Client binds a resource:</p>
<div id="#rfc.figure.19"></div>
<pre>

   &lt;iq type='set' id='bind_1'&gt;
     &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;resource&gt;someresource&lt;/resource&gt;
     &lt;/bind&gt;
   &lt;/iq&gt;
 
</pre>
<p id="rfc.section.6.p.19">Step 13: Server informs client of successful resource binding:</p>
<div id="#rfc.figure.20"></div>
<pre>

   &lt;iq type='result' id='bind_1'&gt;
     &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;jid&gt;somenode@example.com/someresource&lt;/jid&gt;
     &lt;/bind&gt;
   &lt;/iq&gt;

</pre>
<p id="rfc.section.6.p.20">Please note: line breaks were added to the base64 for clarity.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Security Considerations</h1>
<p id="rfc.section.7.p.1">This section will address only security considerations associated with the use of SAML with SASL applications. For considerations relating to SAML in general, the reader is referred to the SAML specification and to other literature. Similarly, for general SASL Security Considerations, the reader is referred to that specification.  </p>
<p id="rfc.section.7.p.2">Version 2.0 of the <a href="#SAMLECP20">Enhanced Client or Proxy Profile</a> <cite title="NONE">[SAMLECP20]</cite> adds optional support for channel binding and use of "Holder of Key" subject confirmation. The former is strongly recommended for use with this mechanism to detect "Man in the Middle" attacks between the client and the RP without relying on flawed commercial TLS infrastructure. The latter may be impractical in many cases, but is a valuable way of strengthening client authentication, protecting against phishing, and improving the overall mechanism.  </p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> Risks Left Unaddressed</h1>
<p id="rfc.section.7.1.p.1">The adaptation of a web-based profile that is largely designed around security-oblivious clients and a bearer model for security token validation results in a number of basic security exposures that should be weighed against the compatibility and client simplification benefits of this mechanism.  </p>
<p id="rfc.section.7.1.p.2">When channel binding is not used, protection against "Man in the Middle" attacks is left to lower layer protocols such as TLS, and the development of user interfaces able to implement that has not been effectively demonstrated. Failure to detect a MITM can result in phishing of the user's credentials if the attacker is between the client and IdP, or the theft and misuse of a short-lived credential (the SAML assertion) if the attacker is able to impersonate a RP.  SAML allows for source address checking as a minor mitigation to the latter threat, but this is often impractical. IdPs can mitigate to some extent the exposure of personal information to RP attackers by encrypting assertions with authenticated keys.  </p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> User Privacy</h1>
<p id="rfc.section.7.2.p.1">The IdP is aware of each RP that a user logs into. There is nothing in the protocol to hide this information from the IdP. It is not a requirement to track the activity, but there is nothing technically that prohibits the collection of this information. SASL servers should be aware that SAML IdPs will track - to some extent - user access to their services.  </p>
<p id="rfc.section.7.2.p.2">It is also out of scope of the mechanism to determine under what conditions an IdP will release particular information to a relying party, and it is generally unclear in what fashion user consent could be established in real time for the release of particular information. The SOAP exchange with the IdP does not preclude such interaction, but neither does it define that interoperably.  </p>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> Collusion between RPs</h1>
<p id="rfc.section.7.3.p.1">Depending on the information supplied by the IdP, it may be possible for RPs to correlate data that they have collected. By using the same identifier to log into every RP, collusion between RPs is possible.  SAML supports the notion of pairwise, or targeted/directed, identity.  This allows the IdP to manage opaque, pairwise identifiers for each user that are specific to each RP. However, correlation is often possible based on other attributes supplied, and is generally a topic that is beyond the scope of this mechanism. It is sufficient to say that this mechanism does not introduce new correlation opportunities over and above the use of SAML in web-based use cases.  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> IANA Considerations</h1>
<p id="rfc.section.8.p.1">The IANA is requested to register the following SASL profile:</p>
<p></p>
<p id="rfc.section.8.p.3">SASL mechanism profiles: SAML20EC and SAML20EC-PLUS</p>
<p id="rfc.section.8.p.4">Security Considerations: See this document</p>
<p id="rfc.section.8.p.5">Published Specification: See this document</p>
<p id="rfc.section.8.p.6">For further information: Contact the authors of this document.</p>
<p id="rfc.section.8.p.7">Owner/Change controller: the IETF</p>
<p id="rfc.section.8.p.8">Note: None</p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2617">[RFC2617]</b></td>
<td class="top">
<a href="mailto:john@math.nwu.edu" title="Northwestern University, Department of Mathematics">Franks, J.</a>, <a href="mailto:pbaker@verisign.com" title="Verisign Inc.">Hallam-Baker, P.M.</a>, <a href="mailto:jeff@AbiSource.com" title="AbiSource, Inc.">Hostetler, J.L.</a>, <a href="mailto:lawrence@agranat.com" title="Agranat Systems, Inc.">Lawrence, S.D.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.J.</a>, <a title="Netscape Communications Corporation">Luotonen, A.</a> and <a href="mailto:stewart@OpenMarket.com" title="Open Market, Inc.">L. Stewart</a>, "<a href="http://tools.ietf.org/html/rfc2617">HTTP Authentication: Basic and Digest Access Authentication</a>", RFC 2617, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4422">[RFC4422]</b></td>
<td class="top">
<a>Melnikov, A.</a> and <a>K. Zeilenga</a>, "<a href="http://tools.ietf.org/html/rfc4422">Simple Authentication and Security Layer (SASL)</a>", RFC 4422, June 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4648">[RFC4648]</b></td>
<td class="top">
<a>Josefsson, S.</a>, "<a href="http://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>", RFC 4648, October 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6125">[RFC6125]</b></td>
<td class="top">
<a>Saint-Andre, P.</a> and <a>J. Hodges</a>, "<a href="http://tools.ietf.org/html/rfc6125">Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)</a>", RFC 6125, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="OASIS.saml-core-2.0-os">[OASIS.saml-core-2.0-os]</b></td>
<td class="top">
<a href="mailto:cantor.2@osu.edu" title="Internet2">Cantor, S.</a>, <a href="mailto:John.Kemp@nokia.com" title="Nokia">Kemp, J.</a>, <a href="mailto:rphilpott@rsasecurity.com" title="RSA Security">Philpott, R.</a> and <a href="mailto:eve.maler@sun.com" title="Sun Microsystems">E. Maler</a>, "<a>Assertions and Protocol for the OASIS Security Assertion Markup Language (SAML) V2.0</a>", OASIS Standard saml-core-2.0-os, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="OASIS.saml-bindings-2.0-os">[OASIS.saml-bindings-2.0-os]</b></td>
<td class="top">
<a href="mailto:cantor.2@osu.edu" title="Internet2">Cantor, S.</a>, <a href="mailto:Frederick.Hirsch@nokia.com" title="Nokia">Hirsch, F.</a>, <a href="mailto:John.Kemp@nokia.com" title="Nokia">Kemp, J.</a>, <a href="mailto:rphilpott@rsasecurity.com" title="RSA Security">Philpott, R.</a> and <a href="mailto:eve.maler@sun.com" title="Sun Microsystems">E. Maler</a>, "<a>Bindings for the OASIS Security Assertion Markup Language (SAML) V2.0</a>", OASIS Standard saml-bindings-2.0-os, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="OASIS.saml-profiles-2.0-os">[OASIS.saml-profiles-2.0-os]</b></td>
<td class="top">
<a title="Altos Origin">Hughes, J.</a>, <a href="mailto:cantor.2@osu.edu" title="Internet2">Cantor, S.</a>, <a href="mailto:Jeff.Hodges@neustar.biz" title="NeuStar">Hodges, J.</a>, <a href="mailto:Frederick.Hirsch@nokia.com" title="Nokia">Hirsch, F.</a>, <a href="mailto:pmishra@principalidentity.com" title="Principal Identity">Mishra, P.</a>, <a href="mailto:rphilpott@rsasecurity.com" title="RSA Security">Philpott, R.</a> and <a href="mailto:eve.maler@sun.com" title="Sun Microsystems">E. Maler</a>, "<a>Profiles for the OASIS Security Assertion Markup Language (SAML) V2.0</a>", OASIS Standard OASIS.saml-profiles-2.0-os, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="W3C.soap11">[W3C.soap11]</b></td>
<td class="top">
<a href="mailto:dbox@develop.com" title="Developmentor">Box, D.</a>, <a href="mailto:davide@us.ibm.com" title="IBM">Ehnebuske, D.</a>, <a href="mailto:gopalk@microsoft.com" title="Microsoft">Kakivaya, G.</a>, <a href="mailto:andrewl@microsoft.com" title="Microsoft">Layman, A.</a>, <a href="mailto:Noah_Mendelsohn@lotus.com" title="Lotus Development Corp.">Mendelsohn, N.</a>, <a href="mailto:frystyk@microsoft.com" title="Microsoft">Nielsen, H.</a>, <a href="mailto:satisht@microsoft.com" title="Microsoft">Thatte, S.</a> and <a href="mailto:dave@userland.com" title="UserLand Software">D. Winer</a>, "<a>Simple Object Access Protocol (SOAP) 1.1</a>", W3C Note soap11, May 2000.</td>
</tr>
<tr>
<td class="reference"><b id="SAMLECP20">[SAMLECP20]</b></td>
<td class="top">
<a title="Internet2">Cantor, S.</a>, "<a>SAML V2.0 Enhanced Client or Proxy Profile Version 2.0</a>", OASIS Working Draft OASIS.sstc-saml-ecp-v2.0-wd04, August 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Normative References for GSS-API Implementers</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2743">[RFC2743]</b></td>
<td class="top">
<a href="mailto:jlinn@rsasecurity.com" title="RSA Laboratories">Linn, J.</a>, "<a href="http://tools.ietf.org/html/rfc2743">Generic Security Service Application Program Interface Version 2, Update 1</a>", RFC 2743, January 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5801">[RFC5801]</b></td>
<td class="top">
<a>Josefsson, S.</a> and <a>N. Williams</a>, "<a href="http://tools.ietf.org/html/rfc5801">Using Generic Security Service Application Program Interface (GSS-API) Mechanisms in Simple Authentication and Security Layer (SASL): The GS2 Mechanism Family</a>", RFC 5801, July 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.3">
<a href="#rfc.references.3">9.3.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2616">[RFC2616]</b></td>
<td class="top">
<a href="mailto:fielding@ics.uci.edu" title="Department of Information and Computer Science">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="World Wide Web Consortium">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="World Wide Web Consortium">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a> and <a href="mailto:timbl@w3.org" title="World Wide Web Consortium">T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3920">[RFC3920]</b></td>
<td class="top">
<a href="mailto:stpeter@jabber.org" title="Jabber Software Foundation">Saint-Andre, P.</a>, "<a href="http://tools.ietf.org/html/rfc3920">Extensible Messaging and Presence Protocol (XMPP): Core</a>", RFC 3920, October 2004.</td>
</tr>
<tr>
<td class="reference"><b id="OASIS.saml-metadata-2.0-os">[OASIS.saml-metadata-2.0-os]</b></td>
<td class="top">
<a href="mailto:cantor.2@osu.edu" title="Internet2">Cantor, S.</a>, <a href="mailto:jmoreh@sigaba.com" title="Sigaba">Moreh, J.</a>, <a href="mailto:rphilpott@rsasecurity.com" title="RSA Security">Philpott, R.</a> and <a href="mailto:eve.maler@sun.com" title="Sun Microsystems">E. Maler</a>, "<a>Metadata for the Security Assertion Markup Language (SAML) V2.0</a>", OASIS Standard saml-metadata-2.0-os, March 2005.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> Acknowledgments</h1>
<p id="rfc.section.Appendix A.p.1">The authors would like to thank Klaas Wierenga, Sam Hartman, and Nico Williams for their contributions.  </p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> Changes</h1>
<p id="rfc.section.Appendix B.p.1">This section to be removed prior to publication.</p>
<p></p>

<ul><li>draft-ietf-kitten-sasl-saml-ec-00, Initial Revision, first WG-adopted draft. Removed support for unsolicited SAML responses.</li></ul>

<p> </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Scott Cantor</span> 
	  <span class="n hidden">
		<span class="family-name">Cantor</span>
	  </span>
	</span>
	<span class="org vcardline">Internet2</span>
	<span class="adr">
	  <span>2740 Airport Drive</span>

	  <span class="vcardline">
		<span class="locality">Columbus</span>,  
		<span class="region">Ohio</span> 
		<span class="code">43219</span>
	  </span>
	  <span class="country-name vcardline">United States</span>
	</span>
	<span class="vcardline">Phone: +1 614 247 6147</span>

<span class="vcardline">EMail: <a href="mailto:cantor.2@osu.edu">cantor.2@osu.edu</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Simon Josefsson</span> 
	  <span class="n hidden">
		<span class="family-name">Josefsson</span>
	  </span>
	</span>
	<span class="org vcardline">SJD AB</span>
	<span class="adr">
	  <span>Hagagatan 24</span>

	  <span class="vcardline">
		<span class="locality">Stockholm</span>,  
		<span class="region"></span>
		<span class="code">113 47</span>
	  </span>
	  <span class="country-name vcardline">SE</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:simon@josefsson.org">simon@josefsson.org</a></span>

<span class="vcardline">URI: <a href="http://josefsson.org/">http://josefsson.org/</a></span>

  </address>
</div>

</body>
</html>