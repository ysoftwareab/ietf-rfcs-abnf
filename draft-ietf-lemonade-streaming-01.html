<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Streaming Multimedia
    Messaging Attachments</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Streaming Multimedia
    Messaging Attachments">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Lemonade</td><td class="header">N. Cook</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Noware</td></tr>
<tr><td class="header">Updates: <a href='http://tools.ietf.org/html/rfcRFC 4240'>RFC 4240</a>, <a href='http://tools.ietf.org/html/rfcRFC 4722'>RFC 4722</a></td><td class="header">March 08, 2007</td></tr>
<tr><td class="header">(if&nbsp;approved)</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: September 9, 2007</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Streaming Multimedia
    Messaging Attachments<br />draft-ietf-lemonade-streaming-01</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 9, 2007.</p>

<h3>Abstract</h3>

<p>This document describes a method for streaming multimedia attachments
      received by a resource constrained and/or mobile device from an IMAP
      server. It allows such clients, which often have limits in storage space
      and bandwidth, to play video and audio e-mail content.
</p>
<p>The document describes a profile for making use of the IMAP URLAUTH
      extension (RFC 4467), the Network Announcement SIP Media Service (RFC
      4240), and the Media Server Control Markup Language (RFC 4722). The
      document also defines a new IMAP METADATA entry.
</p>
<h3>Conventions Used in this Document</h3>

<p>The key words "MUST", "MUST NOT", "SHOULD", "SHOULD NOT", and "MAY"
      in this document are to be interpreted as defined in <a class='info' href='#KEYWORDS'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement           Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [KEYWORDS].
</p>
<p>In examples, "C:" and "S:" indicate lines sent by the client and
      server respectively. If a single "C:" or "S:" label applies to multiple
      lines, then the line breaks between those lines are for editorial
      clarity only and are not part of the actual protocol exchange.
</p>
<a name="intro"></a><br /><hr />
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Email clients on resource and/or network constrained devices, such a
      mobile phones, may have difficulties in retrieving and/or storing large
      attachments received in a message. For example, on a poor network link,
      the latency required to download the entire attachment may not be
      acceptable to the user. Conversely, even on a high-speed network, the
      device may not have enough storage space to secure the attachment once
      retrieved.
</p>
<p>For certain media, such as audio and video, there is a solution: the
      media can be streamed to the device, using protocols such as <a class='info' href='#SIP'>SIP<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [SIP] and particularly the media server profile as
      specified in <a class='info' href='#NETANN'>RFC 4240<span> (</span><span class='info'>Burger, E., &ldquo;Basic Network Media Services with SIP,&rdquo; December&nbsp;2005.</span><span>)</span></a> [NETANN] or <a class='info' href='#MSCML'>MSCML<span> (</span><span class='info'>Van Dyke, J., Burger, E., and A. Spitzer, &ldquo;Media Server Control Markup Language,&rdquo; Dec&nbsp;2006.</span><span>)</span></a> [MSCML]. Streaming the media to the device
      addresses both the latency issue, since the client can start playing the
      media immediately, and the storage issue, since the client does not need
      to store the media locally. A tradeoff is that the media cannot be
      viewed/played when the device is offline.
</p>
<p>Examples of the types of media that would benefit from the ability to
      stream such media to the device include: </p>
<blockquote class="text"><dl>
<dt></dt>
<dd>+ Voice or Video mail messages received as an attachment
</dd>
<dt></dt>
<dd>+ Audio clips such as ring tones received as an attachment
</dd>
<dt></dt>
<dd>+ Video clips such as movie trailers received as an
          attachment
</dd>
</dl></blockquote>

<p>The client may wish to present the user with the ability to use
      simple "VCR"-style controls such as pause, fast-forward and rewind. In
      consideration of this, the document presents two alternatives for
      streaming media - a simple mechanism which makes use of the announcement
      service of RFC 4240, and a more complex mechanism which allows VCR
      controls, based on <a class='info' href='#MSCML'>MSCML (RFC 4722)<span> (</span><span class='info'>Van Dyke, J., Burger, E., and A. Spitzer, &ldquo;Media Server Control Markup Language,&rdquo; Dec&nbsp;2006.</span><span>)</span></a> [MSCML]. The
      choice of which mechanism to use is up to the client. The choice may be
      based on limitations of the client or the configured media server. This
      document presents suggestions for determining which of these services
      are available.
</p>
<a name="mechanism"></a><br /><hr />
<a name="rfc.section.2"></a><h3>2.&nbsp;
Mechanism</h3>

<a name="overview"></a><br /><hr />
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Overview of Mechanism</h3>

<p>The proposed mechanism for streaming media to messaging clients is
        a profile for making use of several existing mechanisms, namely: </p>
<ol class="text">
<li>IMAP URLAUTH Extension <a class='info' href='#URLAUTH'>(RFC 4467)<span> (</span><span class='info'>Crispin, M., &ldquo;Internet Message Access Protocol (IMAP) - URLAUTH           Extension,&rdquo; May&nbsp;2006.</span><span>)</span></a> [URLAUTH]
            - Providing the ability to generate an <a class='info' href='#IMAPURL'>IMAP
            URL<span> (</span><span class='info'>Newman, C., &ldquo;IMAP URL Scheme,&rdquo; September&nbsp;1997.</span><span>)</span></a> [IMAPURL] that allows anonymous access from external systems to
            specific message parts; for example, an audio clip.
</li>
<li>Media Server Announcement Service <a class='info' href='#NETANN'>(RFC
            4240)<span> (</span><span class='info'>Burger, E., &ldquo;Basic Network Media Services with SIP,&rdquo; December&nbsp;2005.</span><span>)</span></a> [NETANN] - Providing the ability for a media server to stream
            media using a reference provided by the media server client in a
            URL.
</li>
<li>Media Server Interactive Voice Response (IVR) Service <a class='info' href='#MSCML'>(RFC 4722)<span> (</span><span class='info'>Van Dyke, J., Burger, E., and A. Spitzer, &ldquo;Media Server Control Markup Language,&rdquo; Dec&nbsp;2006.</span><span>)</span></a> [MSCML] - Providing the ability to stream
            media as above, but with VCR-style controls.
</li>
</ol>

<p>However, it should be noted that this document proposes an
        extension to the <a class='info' href='#SIPPARAM'>SIP Parameter
        Registry<span> (</span><span class='info'>Camarillo, G., &ldquo;The Internet Assigned Number Authority (IANA) Uniform           Resource Identifier (URI) Parameter Registry for the Session           Initiation Protocol (SIP),&rdquo; December&nbsp;2004.</span><span>)</span></a> [SIPPARAM], in order to accommodate the passing of a content
        transfer encoding parameter.
</p>
<p>This document also proposes a new attribute for the IMAP <a class='info' href='#METADATA'>METADATA Extension<span> (</span><span class='info'>Daboo, C., &ldquo;IMAP METADATA Extension,&rdquo; Oct&nbsp;2006.</span><span>)</span></a> [METADATA], which is used to provide
        information about zero or more suitable media servers for use with the
        <a class='info' href='#IMAP'>IMAP<span> (</span><span class='info'>Crispin, M., &ldquo;Internet Message Access Protocol - Version 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a> [IMAP] server.
</p><br /><hr class="insert" />
<a name="overview_mechanism"></a>

<p>The approach is shown in the following figure:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

+--------------+
|              |
| Email Client |^
|              | \
+--------------+  \
    |           \  \
    |            \  \ (5)
    | (1),        \  \
    | (2)          \  \
    |           (3),\  \
    |           (6)  \  \
    |                 \  \
    v                  v  v
+--------------+       +----------------+
|              |  (4)  |                |
| IMAP Server  |&lt;------|  Media Server  |
|              |       |                |
+--------------+       +----------------+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The proposed mechanism has the following steps: </p>
<ol class="text">
<li>Client determines from headers of a particular message that a
            particular message part (attachment) should be streamed to the
            user. Note that no assumptions are made about how/when/if the
            client contacts the user of the client about this decision. User
            input MAY be required in order to initiate the proposed
            mechanism.
</li>
<li>Client constructs an IMAP URL referencing the message part, and
            uses the <a class='info' href='#URLAUTH'>GENURLAUTH<span> (</span><span class='info'>Crispin, M., &ldquo;Internet Message Access Protocol (IMAP) - URLAUTH           Extension,&rdquo; May&nbsp;2006.</span><span>)</span></a> [URLAUTH] command to
            generate a URLAUTH authorized IMAP URL. Client may optionally use
            the IMAP server to discover a suitable media server for streaming
            the media.
</li>
<li>Client connects to a SIP Media Server using the Announcement
            Service as specified in <a class='info' href='#NETANN'>RFC 4240<span> (</span><span class='info'>Burger, E., &ldquo;Basic Network Media Services with SIP,&rdquo; December&nbsp;2005.</span><span>)</span></a> [NETANN], or
            the IVR Service as specified in <a class='info' href='#MSCML'>RFC
            4722<span> (</span><span class='info'>Van Dyke, J., Burger, E., and A. Spitzer, &ldquo;Media Server Control Markup Language,&rdquo; Dec&nbsp;2006.</span><span>)</span></a> [MSCML], and passes the URLAUTH authorized URL to the media
            server.
</li>
<li>Media Server connects to the IMAP Server specified in the
            referenced URL, and uses the IMAP <a class='info' href='#URLAUTH'>URLFETCH<span> (</span><span class='info'>Crispin, M., &ldquo;Internet Message Access Protocol (IMAP) - URLAUTH           Extension,&rdquo; May&nbsp;2006.</span><span>)</span></a> [URLAUTH] command to retrieve the message
            part.
</li>
<li>Media server streams the retrieved message part to the client
            using <a class='info' href='#RTP'>RTP<span> (</span><span class='info'>Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson, &ldquo;RTP: A Transport Protocol for Real-Time Applications,&rdquo; July&nbsp;2003.</span><span>)</span></a> [RTP].
</li>
<li>The media server or the client terminates the SIP session.
</li>
</ol>

<p>It should be noted that the proposed mechanism makes several
        assumptions about the mobile device, as well as the network services,
        namely: </p>
<blockquote class="text"><dl>
<dt></dt>
<dd>+ Mobile device is provisioned with, or obtains from the IMAP
            server, the address or addresses of a media server which supports
            either <a class='info' href='#NETANN'>RFC 4240<span> (</span><span class='info'>Burger, E., &ldquo;Basic Network Media Services with SIP,&rdquo; December&nbsp;2005.</span><span>)</span></a> [NETANN] or <a class='info' href='#MSCML'>RFC 4722<span> (</span><span class='info'>Van Dyke, J., Burger, E., and A. Spitzer, &ldquo;Media Server Control Markup Language,&rdquo; Dec&nbsp;2006.</span><span>)</span></a> [MSCML].
</dd>
<dt></dt>
<dd>+ Media Server(s) used by the mobile device support the <a class='info' href='#IMAPURL'>IMAP URL<span> (</span><span class='info'>Newman, C., &ldquo;IMAP URL Scheme,&rdquo; September&nbsp;1997.</span><span>)</span></a> [IMAPURL] scheme for the announcement
            and/or IVR services
</dd>
<dt></dt>
<dd>+ IMAP Server used by the mobile device supports generating
            anonymous IMAP URLs using the URLAUTH mechanism
</dd>
</dl></blockquote>

<p>This document assumes an Internet deployment where there are no
        network restrictions between the different components. Specifically,
        it does not address issues that can occur when network policies
        restrict the communication between different components, especially
        between the media server and the IMAP server.
</p>
<a name="genurlauth"></a><br /><hr />
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Client use of GENURLAUTH Command</h3>

<p>The decision to make use of streaming services for a message part
        will usually be predicated on the content type of the message part.
        Using the capabilities of the IMAP FETCH command, clients determine
        the <a class='info' href='#MIME'>MIME<span> (</span><span class='info'>Freed, N., Borenstein, N., Moore, K., Klensin, J., and J. Postel, &ldquo;Multipurpose Internet Mail Extensions (MIME),&rdquo; November&nbsp;1996.</span><span>)</span></a> [MIME] Content-Type of particular message
        parts and based on local policies or heuristics, decide that streaming
        for that message part will be attempted.
</p>
<p>Once the client has determined that a particular message part
        requires streaming, the client generates an IMAP URL that refers to
        the message part according to the method described in <a class='info' href='#IMAPURL'>RFC 2192<span> (</span><span class='info'>Newman, C., &ldquo;IMAP URL Scheme,&rdquo; September&nbsp;1997.</span><span>)</span></a> [IMAPURL]. The client then begins the process
        of generating an URLAUTH URL, by appending ";EXPIRE=&lt;datetime&gt;"
        and ";URLAUTH=&lt;access&gt;" to the initial URL.
</p>
<p>The ";EXPIRE=&lt;datetime&gt;" parameter is optional, however it
        SHOULD be used, since the use of anonymous URLAUTH authorized URLs is
        a security risk, and doing so ensures that at some point in the
        future, permission to access that URL will cease.
</p>
<p>The &lt;access&gt; portion of the URLAUTH parameter SHOULD be
        'authuser' if the media server discovery mechanism defined in <a class='info' href='#discovery'>Section&nbsp;2.3<span> (</span><span class='info'>Media Server Discovery using the METADATA Extension</span><span>)</span></a> specifies that the media server is an
        authorised user of the IMAP server. Without specific prior knowledge
        of such a configuration (either through the discovery mechanism or by
        an out of band mechanism), the client MUST use the 'anonymous' access
        identifier.
</p>
<p>The client uses the URL generated as a parameter to the GENAUTHURL
        command, using the INTERNAL authorization mechanism. The URL returned
        by a successful response to this command will then be passed to the
        media server. If no successful response to the GENURLAUTH command is
        received, then no further action will be possible with respect to
        streaming media to the client.
</p>
<p>Examples:
</p>
<p>C: a122 UID FETCH 24356 BODY[1.2.MIME] <br />
 S:
        * 26 FETCH (BODY[1.2.MIME] {127} <br />
 S:
        Content-Transfer-Encoding: base64 <br />
 S:
        Content-Type: video/mpeg; <br />
 S: UID 24356 FLAGS
        (\Seen)) <br />
 S: a122 OK FETCH completed. <br />
 C: a123 GENURLAUTH
        "imap://joe@example.com/INBOX/;uid=24356/;\ <br />

        section=1.2;expire=2006-12-19T16:39:57-08:00;\ <br />

        urlauth=anonymous" INTERNAL <br />
 S: * GENURLAUTH
        "imap://joe@example.com/INBOX/;uid=24356/;\ <br />

        section=1.2;expire=2006-12-19T16:39:\57-08:00;\ <br />

        urlauth=anonymous:\ <br />

        internal:238234982398239898a9898998798b987s87920" <br />
 S: a123 OK GENURLAUTH completed <br />
<br />

</p>
<p>C: a122 UID FETCH 24359 BODY[1.2.MIME] <br />
 S:
        * 26 FETCH (BODY[1.3.MIME] {127} <br />
 S:
        Content-Transfer-Encoding: base64 <br />
 S:
        Content-Type: audio/G729; <br />
 S: UID 24359 FLAGS
        (\Seen)) <br />
 S: a122 OK FETCH completed. <br />
 C: a123 GENURLAUTH
        "imap://joe@example.com/INBOX/;uid=24359/;\ <br />

        section=1.3;expire=2006-12-19T16:39:57-08:00;\ <br />

        urlauth=anonymous" INTERNAL <br />
 S: * GENURLAUTH
        "imap://joe@example.com/INBOX/;uid=24359/;\ <br />

        section=1.3;expire=2006-12-20T18:31:\45-08:00;\ <br />

        urlauth=authuser:\ <br />

        internal:098230923409284092384092840293480239482" <br />
 S: a123 OK GENURLAUTH completed
</p>
<a name="discovery"></a><br /><hr />
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Media Server Discovery using the METADATA Extension</h3>

<p>There are two possibilities for clients with regard to determining
        the hostname and port number information of a suitable media server:
        </p>
<ol class="text">
<li>No discovery of media servers is required: clients are
            configured with suitable media server information in an
            out-of-band manner.
</li>
<li>Discovery of media servers is required: clients use the
            discovery mechanism described in this section to determine a
            suitable media server to use for streaming multimedia message
            parts.
</li>
</ol>

<p>There are several scenarios where media server discovery would be a
        requirement for streaming to be successful: </p>
<ul class="text">
<li>Client is not configured with the address of any media
            servers.
</li>
<li>Client is configured with the address of one or more media
            servers, but the IMAP server is configured to only accept URLFETCH
            requests from specific media servers (for security or site policy
            reasons), and thus streaming would fail due to the media server
            not being able to retrieve the media from the IMAP server.
</li>
</ul>

<p>There is also a scenario where media server location would improve
        the security of the streaming mechanism, by avoiding the use of
        anonymous or "pawn- ticket" URLs. For example, the client could
        discover a tuple of a media server address and an IMAP username, which
        allowed the client to generate a URL which was secure in that it could
        *only* be accessed by a specific (presumably trusted) media
        server.
</p>
<p>This document proposes using the IMAP <a class='info' href='#METADATA'>METADATA<span> (</span><span class='info'>Daboo, C., &ldquo;IMAP METADATA Extension,&rdquo; Oct&nbsp;2006.</span><span>)</span></a> [METADATA] extension, via the use of an entry
        that provides the contact information for suitable media servers for
        use with the IMAP server. Media Server discovery is optional: clients
        are free to use pre-configured information about media servers, or to
        fall back to pre-configured information if they encounter IMAP servers
        that do not support either the METADATA extension or the proposed
        entry, or that do not provide a value for the entry.
</p>
<p>The following gives the proposed IANA submission for the METADATA
        server entry to be used for media server discovery. <br />
<br />
 To: iana@iana.org <br />
<br />
 Subject:
        IMAP METADATA Registration <br />
<br />
 Please register
        the following IMAP METADATA item: <br />
<br />
 [X] Entry
        [] Attribute <br />
<br />
 [ ] Mailbox [X] Server <br />
<br />
 Name: /mediaServers <br />
<br />

        Description: Defined in Streaming Multimedia Messaging Attachments
        <br />
<br />
 Content-type: text/plain;charset=utf-8
        <br />
<br />
 Contact person: Neil Cook <br />
<br />
 email: neil.cook@noware.co.uk
</p>
<p>The "value" attribute of the /mediaServers entry is formatted
        according to the formalSyntax specified in <a class='info' href='#formalsyntax'>Section&nbsp;5<span> (</span><span class='info'>Formal Syntax</span><span>)</span></a>. This consists of a tuple of host, port
        and optional "authuser", where the host, port and authuser are
        separated using a colon ":", and tuples are separated using a ";".
</p>
<p>For example: <br />
<br />

        "ms.example.net:5060:authuser;ms1.example.net:5060;ms2.example.net:5061"
        <br />
<br />

        "10.20.30.40:5060;10.20.30.41:5060;10.20.30.42:5060:authuser"
</p>
<p>Clients SHOULD parse the value of mediaServers, (using either the
        value.priv or value.shared: whichever is available and/or
        appropriate), and contact a media server using one of the supplied
        values. No particular preference order is implied by the ordering, and
        it is left to the client implementor to decide the algorithm to use
        when selecting the media server(s) to contact, and the selection of
        alternates under failure conditions.
</p>
<a name="clientdecision"></a><br /><hr />
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Client Determination of Media Server Capabilities</h3>

<p>Once an authorized IMAP URL has been generated, it is up to the
        client to pass that URL to a suitable media server that is capable of
        retrieving the URL via IMAP, and streaming the content to the client
        using the <a class='info' href='#RTP'>RTP<span> (</span><span class='info'>Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson, &ldquo;RTP: A Transport Protocol for Real-Time Applications,&rdquo; July&nbsp;2003.</span><span>)</span></a> [RTP] protocol.
</p>
<p>If the client supports the MSCML IVR service, then it MUST attempt
        to contact the media server using the MSCML protocol by sending a SIP
        INVITE which has the service indicator "ivr". Due to issues described
        in <a class='info' href='#security'>Section&nbsp;3<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>, the client SHOULD use a suitable
        end-to-end encryption method, such as <a class='info' href='#SMIME'>S/MIME<span> (</span><span class='info'>, B., &ldquo;S/MIME Version 3 Message Specification&quot;,&rdquo; June&nbsp;1999.</span><span>)</span></a> [SMIME].
</p>
<p>Assuming the media server responds to the INVITE without error, the
        client can carry on using the MSCML IVR service as specified in <a class='info' href='#mscmlinvite'>Section&nbsp;2.7<span> (</span><span class='info'>Client Use of the Media Server MSCML IVR Service</span><span>)</span></a>. If the media server responds with an
        error indicating that the "ivr" service is not supported, then if the
        client supports it, the client SHOULD attempt to contact the media
        server using the Announcement Service, as described in <a class='info' href='#netanninvite'>Section&nbsp;2.5<span> (</span><span class='info'>Client Use of the Media Server Announcement Service</span><span>)</span></a>.
</p>
<p>The following example shows an example SIP INVITE using the "ivr"
        service indicator: <br />
<br />
 C: <br />
 INVITE
        sip:ivr@ms2.example.net SIP/2.0 <br />
 &lt; SIP Headers omitted
        for reasons of brevity &gt;
</p>
<a name="netanninvite"></a><br /><hr />
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Client Use of the Media Server Announcement Service</h3>

<p>Assuming the client or media server does not support use of the
        MSCML protocol, the media server announcement service is used, as
        described in <a class='info' href='#NETANN'>RFC 4240<span> (</span><span class='info'>Burger, E., &ldquo;Basic Network Media Services with SIP,&rdquo; December&nbsp;2005.</span><span>)</span></a> [NETANN]. This service
        allows the client to send a SIP INVITE to a special username ('annc')
        at the media server (the "announcement" user), supplying the URL
        obtained as per <a class='info' href='#genurlauth'>Section&nbsp;2.2<span> (</span><span class='info'>Client use of GENURLAUTH Command</span><span>)</span></a>.
</p>
<p>The SIP INVITE is constructed as shown in the examples below; note
        that as per RFC 4240, the play parameter is mandatory, and specifies
        the authorized IMAP URL to be played.
</p>
<p>The content-type parameter is optional in RFC 4240, however it MUST
        be supplied here, using the Content-Type header returned by the IMAP
        server for the message part. The reason for supplying the content-type
        parameter is that when the media server issues a URLFETCH command to
        retrieve the message part, the message part will be returned without
        any content type information. Since the media server is not likely to
        have authorized access to other sections in that message, for example
        the MIME section, then it may fail to stream the content if the
        content type is not supplied as a parameter to the SIP INVITE URI.
</p>
<p>Similarly, the message may well be encoded with a content transfer
        encoding such as base 64. However, RFC 4240 does not include a method
        for communicating content transfer encoding to the media server as
        part of the announcement service, nor does the URLFETCH command
        include a mechanism for retrieving message parts without encoding
        (c.f. the <a class='info' href='#BINARY'>BINARY<span> (</span><span class='info'>Nereberg, L., &ldquo;IMAP4 Binary Content Extension,&rdquo; Apr&nbsp;2003.</span><span>)</span></a> [BINARY] extension to IMAP).
        Therefore, an extension parameter is required, namely a
        'content-transfer-encoding' parameter, using the value of the
        Content-Transfer-Encoding MIME header returned by the IMAP server for
        the message part. The content-transfer-encoding parameter MUST be
        supplied if a Content-Transfer-Encoding header for the message part
        existed in the original message.
</p>
<p>Examples of valid SIP INVITE URIs sent to the media server
        announcement service:
</p>
<p>sip:annc@ms2.example.net; \ <br />

        play=imap://joe@example.com/INBOX/;uid=24356/;section=1.2;\ <br />

        expire=2006-12-19T16:39:\57-08:00;urlauth=anonymous:\ <br />

        internal:238234982398239898a9898998798b987s87920; \ <br />

        content-type=video/mpeg; \ <br />
 content-transfer-encoding=base64
        <br />
<br />
<br />
 sip:annc@ms1.example.net; \ <br />

        play=imap://fred@example.com/INBOX/;uid=24359/;section=1.3;\
        <br />
 expire=2006-12-20T18:31:\45-08:00;urlauth=authuser:\
        <br />
 internal:098230923409284092384092840293480239482; \
        <br />
 content-type=audio/G729; \<br />

        content-transfer-encoding=base64
</p>
<p>If the receives a 200 OK response, the media server has
        successfully retrieved the content from the IMAP server and the
        negotiated RTP stream will shortly begin after the ACK.
</p>
<p>An unsuccessful response code of 404 received from the media server
        indicates that the content could not be found or could not be
        retrieved for some reason. For example, the media server may not
        support the use of IMAP URLs. At this point, there are several options
        to the client, such as using alternate media servers, or giving up in
        attempting to stream the required message part.
</p>
<a name="transcoding"></a><br /><hr />
<a name="rfc.section.2.6"></a><h3>2.6.&nbsp;
Media Negotiation and Transcoding</h3>

<p>This document uses standards and protocols from two traditionally
        separate application areas: Mobile Email (primarily IMAP) and Internet
        Telephony/Streaming (e.g. SIP/RTP). Since the document primarily
        addresses enhancing the capabilities of mobile email, it is felt
        worthwhile to give some examples of simple SIP/SDP exchanges, and
        discussing capabilities such as media negotiation (using SDP) and
        media transcoding.
</p>
<p>In the below example, the client contacts the media server using
        the SIP INVITE command to contact the Announcement service (see <a class='info' href='#netanninvite'>Section&nbsp;2.5<span> (</span><span class='info'>Client Use of the Media Server Announcement Service</span><span>)</span></a>), advertising support for a range of
        audio and video codecs (using <a class='info' href='#SDP'>SDP<span> (</span><span class='info'>Handley, M. and V. Jacobson, &ldquo;SDP: Session Description Protocol,&rdquo; April&nbsp;1998.</span><span>)</span></a> [SDP]), and in
        response the media server advertises only a set of audio codecs. This
        process is identical for the IVR service, except that the IVR service
        does not use the SIP Request-URI to indicate the content to be played;
        instead this is carried in a subsequent SIP INFO request.
</p>
<p>The client and server now know from the SDP advertised by both
        client and server that communication must be using the subset of audio
        codecs supported by both client and server (in the example SDP, it is
        clear that the server does not support any video codecs). The media
        server may perform transcoding (i.e. converting between codecs) on the
        media received from the IMAP server in order to satisfy the codecs
        supported by the client: for example the media server may downgrade
        the video retrieved from the IMAP server to the audio component
        only.
</p>
<p>For clients using the Announcement service, the media server MUST
        return an error to the INVITE if it cannot find a common codec between
        the client, server and media, and it cannot transcode to a suitable
        codec. Similarly, for clients using the MSCML IVR service, the media
        server MUST return a suitable error response to the
        &lt;playcollect&gt; request.
</p>
<p>Example SIP INVITE and SDP Media Negotiation
</p>
<p>C: INVITE sip:annc@ms2.example.net; \ <br />

        play=imap://joe@example.com/INBOX/;uid=24356/;section=1.2;\ <br />

        expire=2006-12-19T16:39:\57-08:00;urlauth=anonymous:\ <br />

        internal:238234982398239898a9898998798b987s87920; \<br />

        content-type=video/mpeg; \<br />
 content-transfer-encoding=base64
        SIP/2.0<br />
 From: UserA &lt;sip:UAA@example.com&gt;<br />

        To: NetAnn &lt;sip:annc@ms2.example.com&gt;<br />
 Call-ID:
        8204589102@example.com<br />
 CSeq: 1 INVITE <br />
 Contact:
        &lt;sip:UserA@10.20.30.40&gt; <br />
 Content-Type: application/sdp
        <br />
 Content-Length: 481 <br />
 <br />
 v=0 <br />

        o=UserA 2890844526 2890844526 IN IP4 10.20.30.40 <br />
 s=Session
        SDP <br />
 c=IN IP4 10.20.30.40 <br />
 t=3034423619 0
        <br />
 m=audio 9224 RTP/AVP 0 8 3 98 101 <br />
 a=alt:1 1 :
        01BB7F04 6CBC7A28 10.20.30.40 9224 <br />
 a=fmtp:101
        0-15<br />
 a=rtpmap:98 ilbc/8000<br />
 a=rtpmap:101
        telephone-event/8000<br />
 a=sendrecv<br />
 m=video 9226
        RTP/AVP 105 34 120<br />
 a=alt:1 1 : 01BCADB3 95DFFD80 10.20.30.40
        9226<br />
 a=fmtp:105 profile=3;level=20<br />
 a=fmtp:34 CIF=2
        QCIF=2 MAXBR=5120<br />
 a=rtpmap:105 h263-2000/90000<br />

        a=rtpmap:120 h263/90000<br />
 a=sendrecv<br />
 <br />
<br />
 S:<br />
 SIP/2.0 200 OK<br />
 From: UserA
        &lt;sip:UAA@example.com&gt;<br />
 To: NetAnn
        &lt;sip:annc@ms2.example.com&gt;<br />
 Call-ID:
        8204589102@example.com<br />
 CSeq: 1 INVITE<br />
 Contact:
        &lt;sip:netann@10.20.30.41&gt;<br />
 Content-Type:
        application/sdp<br />
 Content-Length: 317<br />
 <br />

        v=0<br />
 o=NetAnn 2890844527 2890844527 IN IP4
        10.20.30.41<br />
 s=Session SDP<br />
 c=IN IP4
        10.20.30.41<br />
 t=3034423619 0<br />
 m=audio 17684 RTP/AVP 0
        8 3 18 98 101<br />
 a=rtpmap:0 PCMU/8000<br />
 a=rtpmap:8
        PCMA/8000<br />
 a=rtpmap:3 GSM/8000<br />
 a=rtpmap:18
        G729/8000<br />
 a=fmtp:18 annexb=no<br />
 a=rtpmap:98
        iLBC/8000<br />
 a=rtpmap:101 telephone-event/8000<br />

        a=fmtp:101 0-16<br />
 <br />
<br />
 C:<br />
 ACK
        sip:netann@10.20.30.41 SIP/2.0<br />
 From: UserA
        &lt;sip:UAA@example.com&gt;<br />
 To: NetAnn
        &lt;sip:annc@ms2.example.com&gt;<br />
 Call-ID:
        8204589102@example.com<br />
 CSeq: 1 ACK<br />
 Content-Length:
        0<br />

</p>
<a name="mscmlinvite"></a><br /><hr />
<a name="rfc.section.2.7"></a><h3>2.7.&nbsp;
Client Use of the Media Server MSCML IVR Service</h3>

<p>Once the client has determined that the media server supports the
        IVR service, it is up to the client to generate a suitable MSCML
        request to initiate streaming of the required media.
</p>
<p>When using the IVR service, the initial SIP invite is used only to
        establish that the media server supports the MSCML IVR service, and to
        negotiate suitable media codecs. Once the initial SIP INVITE and
        response to that INVITE have been completed successfully, the client
        must generate a SIP INFO request with MSCML in the body of the request
        to initiate streaming.
</p>
<p>The &lt;playcollect&gt; request is used, as this allows the use of
        DTMF digits to control playback of the media, such as fast-forward or
        rewind.
</p>
<p>Since the playcollect request is used purely for its VCR
        capabilities, there is no need for the media server to perform DTMF
        collection, therefore the playcollect attributes "firstdigittimer",
        "interdigittimer" and "extradigittimer" SHOULD all be set to "0ms",
        which will have the effect of causing digit collection to cease
        immediately the media has finished playing.
</p>
<p>The "ffkey" and "rwkey" attributes of &lt;playcollect&gt; are used
        to control fast forward and rewind behaviour, with the "skipinterval"
        attribute being used to control the 'speed' of these actions.
</p>
<p>The &lt;prompt&gt; tag is used to specify the media to be played,
        and SHOULD have a single &lt;audio&gt; tag that gives the URL of the
        media, as per the <a class='info' href='#genurlauth'>Section&nbsp;2.2<span> (</span><span class='info'>Client use of GENURLAUTH Command</span><span>)</span></a>. The
        audio-specific name of the tag is historical, as the tag can be used
        for video as well as audio content. The "stoponerror" attribute SHOULD
        be set to "yes", as then meaningful error messages will be returned by
        the media server in the event of problems such as retrieving the media
        from the IMAP server.
</p>
<p>The &lt;audio&gt; tag in RFC 4722 has no attributes that specify
        the content-type or content-transfer-encoding of the media to be
        played. Therefore this document proposes two new attributes for this
        purpose, namely a "contenttype" attribute, and a
        "contenttransferencoding" attribute. The syntax of these attributes is
        identical to the syntax of their counterparts in <a class='info' href='#MIME'>MIME<span> (</span><span class='info'>Freed, N., Borenstein, N., Moore, K., Klensin, J., and J. Postel, &ldquo;Multipurpose Internet Mail Extensions (MIME),&rdquo; November&nbsp;1996.</span><span>)</span></a> [MIME].
</p>
<p>An example SIP INFO request using the &lt;playcollect&gt; request
        is shown at the end of this section.
</p>
<p>It should be noted that under normal (i.e. non-error) conditions,
        the response to the &lt;playcollect&gt; request is a SIP "200 OK"
        response. The media server then streams the media, and only when the
        media has finished playing (naturally or due to a user request), does
        the media server send a &lt;playcollect&gt; response, which includes
        details of the media played, such as length, and any digits
        collected.
</p>
<p>The client may suspend playback of the media at any time by either
        sending the DTMF escape key (specified as an attribute to the
        &lt;playcollect&gt; request) or by sending a &lt;stop&gt; request to
        the media server in a SIP INFO message. Upon receipt of the request,
        the media server will acknowledge it, and then cease streaming of the
        media, followed by a SIP INFO message containing the
        &lt;playcollect&gt; response.
</p>
<p>If the media server cannot play the media for any reason, for
        example if it cannot retrieve the media from the IMAP server,
        streaming will not take place, and the &lt;playcollect&gt; response
        will be sent, usually with meaningful values in the &lt;error_info&gt;
        element.
</p>
<p>The following gives an example dialog between a client and media
        server, including a rewind request, and termination of the playback by
        use of the escape key. Some elements of the SIP dialog such as full
        SIP headers and SDP are omitted for reasons of brevity. (The protocol
        diagram in <a class='info' href='#mscml_protocol'>Section&nbsp;2.9.2<span> (</span><span class='info'>IVR Service Protocol Diagram</span><span>)</span></a> shows the high-level
        message flow between all the components, including the IMAP
        server.)
</p>
<p>C: <br />
 INVITE sip:ivr@ms.example.com SIP/2.0<br />
 From:
        UserA &lt;sip:UAA@example.com&gt;<br />
 To: IVR
        &lt;sip:ivr@ms.example.com&gt;<br />
 Call-ID:
        3298420296@example.com<br />
 CSeq: 1 INVITE <br />
 Contact:
        &lt;sip:UserA@10.20.30.40&gt; <br />
 Content-Type: application/sdp
        <br />
 Content-Length: XXX <br />
 <br />
 &lt;SDP
        Here&gt;<br />
<br />
 S: <br />
 SIP/2.0 200
        OK<br />
 From: UserA &lt;sip:UAA@example.com&gt;<br />
 To: IVR
        &lt;sip:ivr@ms.example.com&gt;<br />
 Call-ID:
        3298420296@example.com<br />
 CSeq: 1 INVITE<br />
 Contact:
        &lt;sip:ivr@10.20.30.41&gt;<br />
 Content-Type:
        application/sdp<br />
 Content-Length: XXX<br />
 <br />

        &lt;SDP Here&gt;<br />
<br />
 C:<br />
 ACK
        sip:ivr@ms.example.com SIP/2.0<br />
 From: UserA
        &lt;sip:UAA@example.com&gt;<br />
 To: IVR
        &lt;sip:ivr@ms2.example.com&gt;<br />
 Call-ID:
        3298420296@example.com<br />
 CSeq: 1 ACK<br />
 Content-Length:
        0<br />
<br />
 C: <br />
 INFO sip:ivr@10.20.30.41
        SIP/2.0<br />
 From: UserA &lt;sip:UAA@example.com&gt;<br />

        To: IVR &lt;sip:ivr@ms.example.com&gt;<br />
 Call-ID:
        3298420296@example.com<br />
 CSeq: 2 INFO<br />
 Content-Type:
        application/mediaservercontrol+xml<br />
 Content-Length: 423
        <br />
 <br />
 &lt;?xml version="1.0"?&gt;<br />

        &lt;MediaServerControl version="1.0"&gt;<br />

        &lt;request&gt;<br />
 &lt;playcollect id="332985001"<br />
 firstdigittimer="0ms" interdigittimer="0ms"
        extradigittimer="0ms"<br />
 skipinterval="6s"
        ffkey="6" rwkey="4" escape="*"&gt;<br />
 &lt;prompt
        stoponerror="yes" <br />
 locale="en_US" offset="0" gain="0"
        rate="0"<br />
 delay="0" duration="infinite"
        repeat="0"&gt;<br />
 &lt;audio
        url="imap://joe@example.com/INBOX/;uid=24356/;section=1.2;\ <br />

        expire=2006-12-19T16:39:\57-08:00;urlauth=anonymous:\ <br />

        internal:238234982398239898a9898998798b987s87920;" <br />

        contenttype="video/mpeg" <br />

        contenttransferencoding="base64"&gt;<br />

        &lt;/prompt&gt;<br />
 &lt;/playcollect&gt;<br />

        &lt;/request&gt;<br />
 &lt;/MediaServerControl&gt;<br />
<br />
 S: <br />
 SIP/2.0 200 OK<br />
 From: UserA
        &lt;sip:UAA@example.com&gt;<br />
 To: IVR
        &lt;sip:ivr@ms.example.com&gt;<br />
 Call-ID:
        3298420296@example.com<br />
 CSeq: 2 INFO<br />
 Contact:
        &lt;sip:ivr@10.20.30.41&gt;<br />
 Content-Length: 0<br />
<br />
 &lt;Media Server retrieves media from IMAP Server
        and streams to client&gt; <br />
<br />
 C: <br />

        &lt;Client streams 6 key&gt;<br />
<br />
 S: <br />

        &lt;Media Server fast forwards media by 6 seconds&gt; <br />
<br />
 C: <br />
 &lt;Client streams * key&gt;<br />
<br />
 S: <br />
 &lt;Media Server stops streaming&gt;
        <br />
<br />
 S: <br />
 INFO sip:UAA@10.20.30.40
        SIP/2.0<br />
 From: IVR &lt;sip:ivr@ms.example.com&gt;<br />

        To: UserA &lt;sip:UAA@example.com&gt;<br />
 Call-ID:
        3298420296@example.com<br />
 CSeq: 5 INFO<br />
 Contact:
        &lt;sip:ivr@10.20.30.41&gt;<br />
 Content-Type:
        application/mediaservercontrol+xml<br />
 Content-Length:
        XXX<br />
 <br />
 &lt;?xml version="1.0"?&gt;<br />

        &lt;MediaServerControl version="1.0"&gt;<br />
 &lt;response
        id="332985001" request="playcollect"<br />
 code="200"
        reason="escapekey" playduration="34s"<br />
 playoffset="34s"
        digits="" /&gt; <br />
 &lt;/MediaServerControl&gt;<br />
<br />
 C: <br />
 SIP/2.0 200 OK <br />
 From: IVR
        &lt;sip:ivr@ms.example.com&gt;<br />
 To: UserA
        &lt;sip:UAA@example.com&gt;<br />
 Call-ID:
        3298420296@example.com<br />
 CSeq: 5 INFO<br />

        Content-Length: 0<br />
<br />
 C: <br />
 BYE
        sip:ivr@10.20.30.41 SIP/2.0 <br />
 From: UserA
        &lt;sip:UAA@example.com&gt;<br />
 To: IVR
        &lt;sip:ivr@ms.example.com&gt;<br />
 Call-ID:
        3298420296@example.com<br />
 CSeq: 6 BYE<br />
 Content-Length:
        0<br />
<br />
 S: <br />
 SIP/2.0 200 OK<br />

        From: UserA &lt;sip:UAA@example.com&gt;<br />
 To: IVR
        &lt;sip:ivr@ms.example.com&gt;<br />
 Call-ID:
        3298420296@example.com<br />
 CSeq: 6 BYE<br />
 Contact:
        &lt;sip:ivr@10.20.30.41&gt;<br />
 Content-Length: 0
</p>
<a name="urlfetch"></a><br /><hr />
<a name="rfc.section.2.8"></a><h3>2.8.&nbsp;
Media Server Use of IMAP Server</h3>

<p>This section describes how the media server converts the IMAP URL
        received via the announcement or IVR service into suitable IMAP
        commands for retrieving the content.
</p>
<p>The media server first connects to the IMAP server specified in the
        URL. Once connected, the media server SHOULD use <a class='info' href='#TLS'>TLS<span> (</span><span class='info'>Dierks, T. and C. Allen, &ldquo;The TLS Protocol,&rdquo; January&nbsp;1999.</span><span>)</span></a> [TLS] to encrypt the communication path, unless the
        client and server policy both allow for insecure communications.
</p>
<p>If the media server is configured as an authorized user of the IMAP
        server, it SHOULD authenticate to the IMAP server using the
        credentials for that user. This document does not go into the details
        of IMAP authentication, but the authentication SHOULD NOT use the
        LOGIN command over a non-encrypted communication path, unless the
        client's and server's policy both allow for insecure
        communications.
</p>
<p>If the media server is not configured as an authorized user of the
        IMAP server, it MUST authenticate to the IMAP server using the LOGIN
        command, with the username of "anonymous". However, in this case, if
        the URL supplied in the 'play' parameter of the SIP INVITE specifies
        an authorization of 'authuser', then the media server SHOULD NOT
        attempt to contact the IMAP server, but SHOULD instead immediately
        return a response code of 404 to the client with a reason phrase of
        'Not authorized to access resource' reason.
</p>
<p>Once authenticated, the media server issues the URLFETCH command,
        using the URL supplied in the 'play' parameter of the SIP INVITE. A
        successful URLFETCH command will return the message part, which must
        be decoded by the media server, according to the
        content-transfer-encoding header provided by the client (if any). If
        the URLFETCH was unsuccessful, then the media server MUST return a
        response code of 404 to the client with an appropriate reason
        code.
</p>
<p>Assuming the content is retrieved and decoded successfully, the
        media server returns a 200 OK response code to the client. After an
        ACK is received, an RTP stream is delivered to the client using the
        parameters negotiated in the SDP.
</p>
<p>If appropriate, the media server MAY choose to implement connection
        caching, in which case connection and disconnection from the IMAP
        server are handled according to whatever algorithm the media server
        chooses. For example, the media server may know, a priori, that it
        will always access the same IMAP server using the same login
        credentials with an access pattern that would benefit from connection
        caching, without unduly impacting server resources.
</p>
<p>Examples:
</p>
<p>C: a001 LOGIN anonymous null <br />
 S: a001 OK LOGIN completed.
        <br />
 C: a002 URLFETCH
        "imap://joe@example.com/INBOX/;uid=24356/;section=1.2; \ <br />

        expire=2006-12-19T16:39:\57-08:00;urlauth=anonymous:\ <br />

        internal:238234982398239898a9898998798b987s87920" <br />
 S: *
        URLFETCH "imap://joe@example.com/INBOX/;uid=24356/; \ <br />

        section=1.2;expire=2006-12-19T16:39:\57-08:00;urlauth=anonymous: \
        <br />
 internal:238234982398239898a9898998798b987s87920" {36}
        <br />
 S: U2kgdmlzIHBhY2VtLCBwYXJhIGJlbGx1bS4K <br />
 S: a002
        OK URLFETCH completed. <br />
 C: a003 LOGOUT <br />
 S: a003 OK
        LOGOUT completed.
</p>
<a name="anchor1"></a><br /><hr />
<a name="rfc.section.2.9"></a><h3>2.9.&nbsp;
Protocol Diagrams</h3>

<p>This section gives examples of using the mechanism described in the
        document to stream media from a media server to a client, fetching the
        content from an IMAP server. In all of the examples, the IMAP, SIP and
        RTP protocols use the line styles "-", "=", and "+", respectively. For
        simplicity, SIP session termination (BYE etc.) is not shown.
</p>
<a name="netann_protocol"></a><br /><hr />
<a name="rfc.section.2.9.1"></a><h3>2.9.1.&nbsp;
Announcement Service Protocol Diagram</h3>

<p>The following diagram shows a simplified view of the
            protocol interactions between the email client, the IMAP server
            and the media server when the client uses the Announcement
            Service.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Client                     IMAP Server                   Media Server
  |   FETCH BODY[MIME]          |                              |
  |----------------------------&gt;|                              |
  |   GENURLAUTH                |                              |
  |----------------------------&gt;|                              |
  |                             |                              |
  |                          SIP INVITE                        |
  |===========================================================&gt;|
  |                             |                              |
  |                             |          URLFETCH            |
  |                             |&lt;-----------------------------|
  |                             |                              |
  |                          200 OK                            |
  |&lt;===========================================================|
  |                          ACK                               |
  |===========================================================&gt;|
  |                             |                              |
  |                    Stream Message Part (RTP)               |
  |&lt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++|
  |                             |                              |

</pre></div>
<a name="mscml_protocol"></a><br /><hr />
<a name="rfc.section.2.9.2"></a><h3>2.9.2.&nbsp;
IVR Service Protocol Diagram</h3>

<p>The following diagram shows a simplified view of the
            protocol interactions between the email client, the IMAP server
            and the media server when the client uses the MSCML IVR
            Service.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Client                     IMAP Server                   Media Server
  |   FETCH BODY[MIME]          |                              |
  |----------------------------&gt;|                              |
  |   GENURLAUTH                |                              |
  |----------------------------&gt;|                              |
  |                             |                              |
  |                          SIP INVITE                        |
  |===========================================================&gt;|
  |                             |                              |
  |                          200 OK                            |
  |&lt;===========================================================|
  |                          ACK                               |
  |===========================================================&gt;|
  |                             |                              |
  |                          SIP INFO (playcollect)            |
  |===========================================================&gt;|
  |                             |
  |                          200 OK                            |
  |&lt;===========================================================|
  |                             |                              |
  |                             |          URLFETCH            |
  |                             |&lt;-----------------------------|
  |                             |                              |
  |                    Stream Message Part (RTP)               |
  |&lt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++|
  |                             |                              |
  |                          SIP INFO (e.g., DTMF ff)          |
  |===========================================================&gt;|
  |                          200 OK                            |
  |&lt;===========================================================|
  |                             |                              |
  |                (Streaming Ends or is terminated)           |
  |                             |                              |
  |                          SIP INFO (playcollect response)   |
  |&lt;===========================================================|

</pre></div>
<a name="security"></a><br /><hr />
<a name="rfc.section.3"></a><h3>3.&nbsp;
Security Considerations</h3>

<p>This document proposes the use of URLAUTH "pawn tickets" to grant
      access to message parts. The goal is for the media server to stream
      these parts. INote that f one uses an anonymous pawn ticket, that grants
      access to any client of the IMAP server without requiring any
      authentication credentials. Even if one grants an authorized pawn
      ticket, any client will have access granted that happens to be an
      authorized user of the IMAP server.
</p>
<p>Clearly, any third parties that gain access to the pawn tickets can
      potentially access private data. To minimise this, implementors should
      consider the following: </p>
<ul class="text">
<li>IMAP clients SHOULD use encryption such as <a class='info' href='#TLS'>TLS<span> (</span><span class='info'>Dierks, T. and C. Allen, &ldquo;The TLS Protocol,&rdquo; January&nbsp;1999.</span><span>)</span></a> [TLS] to secure the communication path to the IMAP
          server
</li>
<li>The media server SHOULD use encryption such as TLS secure the
          communication path to the IMAP server
</li>
</ul>

<p>Note that the communication path between the client and the media
      server uses SIP. The announcement service (RFC 4240) passes the pawn
      ticket in the Request-URI. Thus, if the SIP communication channel is not
      secured with TLS or sips, untrusted third-parties may be able to
      intercept the pawn ticket.
</p>
<p>Using sips in this situation protects the pawn ticket from untrusted
      third-parties. However, it still allows proxies access to the pawn
      ticket. Thus, to fully protect the pawn ticket, the IVR service (RFC
      4722) is RECOMMENDED, using an end-to-end encryption of the MSCML
      payload, such as with S/MIME.
</p>
<a name="drm"></a><br /><hr />
<a name="rfc.section.4"></a><h3>4.&nbsp;
Digital Rights Management (DRM) Issues</h3>

<p>This document does not specify any Digital Rights Management (DRM)
      mechanisms for controlling access to and copying of the media to be
      streamed. This is intentional. A reference to a piece of media content
      is created using the URLAUTH command; it is expected that creation of a
      reference which is explicitly allowed by the URLAUTH command also
      implicitly gives the creator the right to pass that reference on to any
      third party it desires. It would be up to the implementation of URLAUTH
      to enforce any such DRM checks, and such a mechanism is outside the
      scope of this document, as it would affect any use of the URLAUTH
      command, such as the <a class='info' href='#BURL'>BURL<span> (</span><span class='info'>Newman, C., &ldquo;Message Submission BURL Extension,&rdquo; May&nbsp;2006.</span><span>)</span></a> [BURL] command for message
      submission.
</p>
<p>The document authors believe that encapsulating DRM issues within the
      URLAUTH command gives DRM semantics that are at least equal to those in
      existing IETF messaging standards. If DRM is a requirement for Internet
      messaging, then a suitable DRM mechanism should be created. How such a
      mechanism would work is outside the scope of this document.
</p>
<a name="formalsyntax"></a><br /><hr />
<a name="rfc.section.5"></a><h3>5.&nbsp;
Formal Syntax</h3>

<p>The following syntax specification for the mediaServer METADATA entry
      value uses the Augmented Backus-Naur Form (ABNF) notation as specified
      in <a class='info' href='#ABNF'>RFC 2234<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; Nov&nbsp;1997.</span><span>)</span></a> [ABNF].
</p>
<p>Except as noted otherwise, all alphabetic characters are case-
      insensitive. The use of upper or lower case characters to define token
      strings is for editorial clarity only. Implementations MUST accept these
      strings in a case-insensitive fashion.
</p>
<p>media-servers = ms-tuple *(";" ms-tuple) <br />
<br />

      host = astring <br />
<br />
 port = nstring <br />
<br />
 ms-tuple = host ":" port (":" "authuser") <br />
<br />

</p>
<a name="contrib"></a><br /><hr />
<a name="rfc.section.6"></a><h3>6.&nbsp;
Contributors</h3>

<p>Eric Burger, BEA Systems, Inc., eburger@standardstrack.com
</p>
<p>Eric Burger provided the initial inspiration for this document, along
      with advice and support on aspects of the media server IVR and
      Announcement services, along with help with IANA registration and the
      IETF process.
</p>
<a name="rfc.references1"></a><br /><hr />
<h3>7.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="NETANN">[NETANN]</a></td>
<td class="author-text">Burger, E., &ldquo;<a href="http://tools.ietf.org/html/rfc4240">Basic Network Media Services with SIP</a>,&rdquo; RFC&nbsp;4240, December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="URLAUTH">[URLAUTH]</a></td>
<td class="author-text">Crispin, M., &ldquo;<a href="http://tools.ietf.org/html/rfc4467">Internet Message Access Protocol (IMAP) - URLAUTH
          Extension</a>,&rdquo; RFC&nbsp;4467, May&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="IMAP">[IMAP]</a></td>
<td class="author-text">Crispin, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3501">Internet Message Access Protocol - Version 4rev1</a>,&rdquo; RFC&nbsp;3501, March&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="IMAPURL">[IMAPURL]</a></td>
<td class="author-text">Newman, C., &ldquo;<a href="http://tools.ietf.org/html/rfc2192">IMAP URL Scheme</a>,&rdquo; RFC&nbsp;2192, September&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="SIP">[SIP]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="SMIME">[SMIME]</a></td>
<td class="author-text">, B., &ldquo;<a href="http://tools.ietf.org/html/rfc2633">S/MIME Version 3 Message Specification"</a>,&rdquo; RFC&nbsp;2633, June&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="RTP">[RTP]</a></td>
<td class="author-text">Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson, &ldquo;<a href="http://tools.ietf.org/html/rfc3550">RTP: A Transport Protocol for Real-Time Applications</a>,&rdquo; RFC&nbsp;3550, July&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="KEYWORDS">[KEYWORDS]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement
          Levels</a>,&rdquo; RFC&nbsp;2119, BCP&nbsp;14, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="SIPPARAM">[SIPPARAM]</a></td>
<td class="author-text">Camarillo, G., &ldquo;<a href="http://tools.ietf.org/html/rfc3969">The Internet Assigned Number Authority (IANA) Uniform
          Resource Identifier (URI) Parameter Registry for the Session
          Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;3969, BCP&nbsp;99, December&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="MIME">[MIME]</a></td>
<td class="author-text">Freed, N., Borenstein, N., Moore, K., Klensin, J., and J. Postel, &ldquo;<a href="http://tools.ietf.org/html/rfc2045">Multipurpose Internet Mail Extensions (MIME)</a>,&rdquo; RFC&nbsp;2045, RFC&nbsp;2046, RFC&nbsp;2047, RFC&nbsp;2048, RFC&nbsp;2049, November&nbsp;1996.</td></tr>
<tr><td class="author-text" valign="top"><a name="TLS">[TLS]</a></td>
<td class="author-text">Dierks, T. and C. Allen, &ldquo;<a href="http://tools.ietf.org/html/rfc2246">The TLS Protocol</a>,&rdquo; RFC&nbsp;2246, January&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="SDP">[SDP]</a></td>
<td class="author-text">Handley, M. and V. Jacobson, &ldquo;<a href="http://tools.ietf.org/html/rfc2327">SDP: Session Description Protocol</a>,&rdquo; RFC&nbsp;2327, April&nbsp;1998.</td></tr>
<tr><td class="author-text" valign="top"><a name="BURL">[BURL]</a></td>
<td class="author-text">Newman, C., &ldquo;<a href="http://tools.ietf.org/html/rfc4468">Message Submission BURL Extension</a>,&rdquo; RFC&nbsp;4468, May&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="MSCML">[MSCML]</a></td>
<td class="author-text">Van Dyke, J., Burger, E., and A. Spitzer, &ldquo;<a href="http://tools.ietf.org/html/rfc4722">Media Server Control Markup Language</a>,&rdquo; RFC&nbsp;4722, Dec&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="METADATA">[METADATA]</a></td>
<td class="author-text">Daboo, C., &ldquo;IMAP METADATA Extension,&rdquo; draft-daboo-imap-annotatemore-10 (Work in progress)&nbsp;, Oct&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="ABNF">[ABNF]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc2234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; RFC&nbsp;2234, Nov&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="BINARY">[BINARY]</a></td>
<td class="author-text">Nereberg, L., &ldquo;<a href="http://tools.ietf.org/html/rfc3516">IMAP4 Binary Content Extension</a>,&rdquo; RFC&nbsp;3516, Apr&nbsp;2003.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Neil L Cook</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Noware</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:neil.cook@noware.co.uk">neil.cook@noware.co.uk</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2007).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
