<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Specification of the IPFIX File Format</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Specification of the IPFIX File Format">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">IPFIX Working Group</td><td class="header">B. Trammell</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">E. Boschi</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Hitachi Europe</td></tr>
<tr><td class="header">Expires: January 11, 2010</td><td class="header">L. Mark</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Fraunhofer IFAM</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">T. Zseby</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Fraunhofer FOKUS</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">A. Wagner</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">ETH Zurich</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">July 10, 2009</td></tr>
</table></td></tr></table>
<h1><br />Specification of the IPFIX File Format<br />draft-ietf-ipfix-file-04.txt</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on January 11, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This document describes a file format for the storage of flow data
      based upon the IPFIX Protocol. It proposes a set of requirements for
      flat-file, binary flow data file formats, then specifies the IPFIX File
      format to meet these requirements based upon IPFIX Messages. This IPFIX
      File format is designed to facilitate interoperability and reusability
      among a wide variety of flow storage, processing, and analysis
      tools.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro-sec">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-docs">1.1.</a>&nbsp;
IPFIX Documents Overview<br />
<a href="#terminology-section">2.</a>&nbsp;
Terminology<br />
<a href="#design-section">3.</a>&nbsp;
Design Overview<br />
<a href="#motivation-section">4.</a>&nbsp;
Motivation<br />
<a href="#requirements-section">5.</a>&nbsp;
Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">5.1.</a>&nbsp;
Record Format Flexibility<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">5.2.</a>&nbsp;
Self Description<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">5.3.</a>&nbsp;
Data Compression<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">5.4.</a>&nbsp;
Indexing and Searching<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">5.5.</a>&nbsp;
Error Recovery<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">5.6.</a>&nbsp;
Authentication, Confidentiality, and Integrity<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">5.7.</a>&nbsp;
Anonymization and Obfuscation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">5.8.</a>&nbsp;
Session Auditability and Replayability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">5.9.</a>&nbsp;
Performance Characteristics<br />
<a href="#applicability-section">6.</a>&nbsp;
Applicability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#applicability-collection">6.1.</a>&nbsp;
Storage of IPFIX-collected Flow Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">6.2.</a>&nbsp;
Storage of NetFlow V9-collected Flow Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">6.3.</a>&nbsp;
Testing IPFIX Collecting Processes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">6.4.</a>&nbsp;
IPFIX Device Diagnostics<br />
<a href="#detail-section">7.</a>&nbsp;
Detailed File Format Specification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">7.1.</a>&nbsp;
File Reader Specification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#writer-spec-section">7.2.</a>&nbsp;
File Writer Specification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#writer-case-section">7.3.</a>&nbsp;
Specific File Writer Use Cases<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">7.3.1.</a>&nbsp;
Collocating a File Writer with a Collecting Process<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">7.3.2.</a>&nbsp;
Collocating a File Writer with a Metering Process<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#writer-archival-section">7.3.3.</a>&nbsp;
Using IPFIX Files for Archival Storage<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">7.3.4.</a>&nbsp;
Using IPFIX Files as Documents<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">7.3.5.</a>&nbsp;
Using IPFIX Files for Testing<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">7.3.6.</a>&nbsp;
Writing IPFIX Files for Device Diagnostics<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">7.3.7.</a>&nbsp;
IPFIX File Manipulation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">7.4.</a>&nbsp;
Media type of IPFIX Files<br />
<a href="#templates-section">8.</a>&nbsp;
File Format Metadata Specification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ot-section">8.1.</a>&nbsp;
Recommended Options Templates for IPFIX Files<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ot-checksum">8.1.1.</a>&nbsp;
Message Checksum Options Template<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ot-time-window">8.1.2.</a>&nbsp;
File Time Window Options Template<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ot-session-detail">8.1.3.</a>&nbsp;
Export Session Details Options Template<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ot-message-detail">8.1.4.</a>&nbsp;
Message Details Options Template<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-section">8.2.</a>&nbsp;
Recommended Information Elements for IPFIX Files<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-collectionTimeMilliseconds">8.2.1.</a>&nbsp;
collectionTimeMilliseconds<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-exportSctpStreamId">8.2.2.</a>&nbsp;
exportSctpStreamId<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-maxExportSeconds">8.2.3.</a>&nbsp;
maxExportSeconds<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-maxFlowEndMicroseconds">8.2.4.</a>&nbsp;
maxFlowEndMicroseconds<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-maxFlowEndMilliseconds">8.2.5.</a>&nbsp;
maxFlowEndMilliseconds<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-maxFlowEndNanoseconds">8.2.6.</a>&nbsp;
maxFlowEndNanoseconds<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-maxFlowEndSeconds">8.2.7.</a>&nbsp;
maxFlowEndSeconds<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-messageMD5Checksum">8.2.8.</a>&nbsp;
messageMD5Checksum<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-messageScope">8.2.9.</a>&nbsp;
messageScope<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-minExportSeconds">8.2.10.</a>&nbsp;
minExportSeconds<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-minFlowStartMicroseconds">8.2.11.</a>&nbsp;
minFlowStartMicroseconds<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-minFlowStartMilliseconds">8.2.12.</a>&nbsp;
minFlowStartMilliseconds<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-minFlowStartNanoseconds">8.2.13.</a>&nbsp;
minFlowStartNanoseconds<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-minFlowStartSeconds">8.2.14.</a>&nbsp;
minFlowStartSeconds<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-opaqueOctets">8.2.15.</a>&nbsp;
opaqueOctets<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-sessionScope">8.2.16.</a>&nbsp;
sessionScope<br />
<a href="#encryption-section">9.</a>&nbsp;
Encryption of IPFIX Files<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#encryption-cms">9.1.</a>&nbsp;
Encapsulation within the Cryptographic Message Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#encryption-errors">9.2.</a>&nbsp;
Encryption Error Resilience<br />
<a href="#compression-section">10.</a>&nbsp;
Compression of IPFIX Files<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">10.1.</a>&nbsp;
Supported Compression Formats<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#compression-magic">10.2.</a>&nbsp;
Compression Recognition at the File Reader<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#compression-errors">10.3.</a>&nbsp;
Compression Error Resilience<br />
<a href="#integration-section">11.</a>&nbsp;
Recommended File Integration Strategies<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#encapsulation-int">11.1.</a>&nbsp;
Encapsulation of Non-IPFIX Data in IPFIX Files<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#encapsulation-ext">11.2.</a>&nbsp;
Encapsulation of IPFIX Files within Other File Formats<br />
<a href="#security-section">12.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">12.1.</a>&nbsp;
Relationship between IPFIX File and Transport Encryption<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-trust-chain">12.2.</a>&nbsp;
End-to-End Assertions for IPFIX Files<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-stength">12.3.</a>&nbsp;
Recommendations for Strength of Cryptography for IPFIX Files<br />
<a href="#iana-section">13.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor23">14.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">15.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">15.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">15.2.</a>&nbsp;
Informative References<br />
<a href="#examples-section">Appendix&nbsp;A.</a>&nbsp;
Example IPFIX File<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">A.1.</a>&nbsp;
Example Options Templates<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">A.2.</a>&nbsp;
Example Supplemental Options Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">A.3.</a>&nbsp;
Example Message Checksum<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">A.4.</a>&nbsp;
File Example Data Set<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor30">A.5.</a>&nbsp;
Complete File Example<br />
<a href="#v9-applicability">Appendix&nbsp;B.</a>&nbsp;
Applicability of IPFIX Files to NetFlow V9 flow storage<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#v9-comparison">B.1.</a>&nbsp;
Comparing NetFlow V9 to IPFIX<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">B.1.1.</a>&nbsp;
Message Header Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">B.1.2.</a>&nbsp;
Set Header Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor33">B.1.3.</a>&nbsp;
Template Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor34">B.1.4.</a>&nbsp;
Information Model<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor35">B.1.5.</a>&nbsp;
Template Management<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor36">B.1.6.</a>&nbsp;
Transport<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#v9-transform">B.2.</a>&nbsp;
A Method for Transforming NetFlow V9 messages to IPFIX<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#v9-example">B.3.</a>&nbsp;
NetFlow V9 Transformation Example<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro-sec"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>This document specifies a file format based upon IPFIX, designed to
      facilitate interoperability and reusability among a wide variety of flow
      storage, processing, and analysis tools. It begins with an overview of
      the IPFIX File format, and a quick summary of how IPFIX Files work in
      <a class='info' href='#design-section'>Section&nbsp;3<span> (</span><span class='info'>Design Overview</span><span>)</span></a>. The detailed specification of the IPFIX
      File format appears in <a class='info' href='#detail-section'>Section&nbsp;7<span> (</span><span class='info'>Detailed File Format Specification</span><span>)</span></a>; this section
      includes general specifications for IPFIX File Readers and IPFIX File
      Writers and specific recommendations for common situations in which they
      are used. The format makes use of the IPFIX Options mechanism for
      additional file metadata, in order to avoid requiring any protocol
      extensions, and to minimize the effort required to adapt IPFIX
      implementations to use the file format; a detailed definition of the
      Options Templates used for storage metadata appears in <a class='info' href='#templates-section'>Section&nbsp;8<span> (</span><span class='info'>File Format Metadata Specification</span><span>)</span></a>. <a class='info' href='#examples-section'>Appendix&nbsp;A<span> (</span><span class='info'>Example IPFIX File</span><span>)</span></a> contains
      a detailed example IPFIX File.
</p>
<p>An advantage of file-based storage is that files can be readily
      encapsulated within each other and other data storage and transmission
      formats. The IPFIX File Format leverages this to provide encryption,
      described in <a class='info' href='#encryption-section'>Section&nbsp;9<span> (</span><span class='info'>Encryption of IPFIX Files</span><span>)</span></a> and compression,
      described in <a class='info' href='#compression-section'>Section&nbsp;10<span> (</span><span class='info'>Compression of IPFIX Files</span><span>)</span></a>. <a class='info' href='#integration-section'>Section&nbsp;11<span> (</span><span class='info'>Recommended File Integration Strategies</span><span>)</span></a> provides specific recommendations for
      integration of IPFIX File data with other formats. 
</p>
<p>The IPFIX File format was designed to be applicable to a wide variety
      of flow storage situations; the motivation behind its creation is
      described in <a class='info' href='#motivation-section'>Section&nbsp;4<span> (</span><span class='info'>Motivation</span><span>)</span></a>. The document outlines
      of the set of requirements the format is designed to meet in <a class='info' href='#requirements-section'>Section&nbsp;5<span> (</span><span class='info'>Requirements</span><span>)</span></a>, and explores the applicability of such
      a format to various specific application areas in <a class='info' href='#applicability-section'>Section&nbsp;6<span> (</span><span class='info'>Applicability</span><span>)</span></a>. These sections are intended to give
      background on the development of IPFIX Files.
</p>
<a name="intro-docs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
IPFIX Documents Overview</h3>

<p><a class='info' href='#RFC5101'>"Specification of the IPFIX Protocol for the
        Exchange of IP Traffic Flow Information"<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a> [RFC5101] and its associated
        documents define the IPFIX Protocol, which provides network engineers
        and administrators with access to IP traffic flow information.
</p>
<p><a class='info' href='#RFC5470'>"Architecture for IP Flow
        Information Export"<span> (</span><span class='info'>Sadasivan, G., Brownlee, N., Claise, B., and J. Quittek, &ldquo;Architecture for IP Flow Information Export,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5470] defines the architecture for the export of
        measured IP flow information out of an IPFIX Exporting Process to an
        IPFIX Collecting Process, and the basic terminology used to describe
        the elements of this architecture, per the requirements defined in
        <a class='info' href='#RFC3917'>"Requirements for IP Flow Information
        Export"<span> (</span><span class='info'>Quittek, J., Zseby, T., Claise, B., and S. Zander, &ldquo;Requirements for IP Flow Information Export (IPFIX),&rdquo; October&nbsp;2004.</span><span>)</span></a> [RFC3917]. <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a> then covers the details of
        the method for transporting IPFIX Data Records and Templates via a
        congestion-aware transport protocol from an IPFIX Exporting Process to
        an IPFIX Collecting Process.
</p>
<p><a class='info' href='#RFC5102'>"Information Model for IP Flow Information
        Export"<span> (</span><span class='info'>Quittek, J., Bryant, S., Claise, B., Aitken, P., and J. Meyer, &ldquo;Information Model for IP Flow Information Export,&rdquo; January&nbsp;2008.</span><span>)</span></a> [RFC5102] describes the Information Elements used by IPFIX,
        including details on Information Element naming, numbering, and data
        type encoding.
</p>
<p><a class='info' href='#RFC5472'>"IPFIX
        Applicability"<span> (</span><span class='info'>Zseby, T., Boschi, E., Brownlee, N., and B. Claise, &ldquo;IP Flow Information Export (IPFIX) Applicability,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5472] describes the various applications of the IPFIX
        protocol and their use of information exported via IPFIX, and relates
        the IPFIX architecture to other measurement architectures and
        frameworks.
</p>
<p>In addition, <a class='info' href='#I-D.ietf-ipfix-exporting-type'>"Exporting Type Information for
        IPFIX Information Elements"<span> (</span><span class='info'>Boschi, E., Trammell, B., Mark, L., and T. Zseby, &ldquo;Exporting Type Information for IPFIX Information Elements,&rdquo; June&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;ipfix&#8209;exporting&#8209;type] specifies a method for encoding
        Information Model properties within an IPFIX Message stream.
</p>
<p>This document references <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a> and the
        architecture document for terminology, defines IPFIX File Writer and
        IPFIX File Reader in terms of the IPFIX Exporting Processes and IPFIX
        Collecting Process definitions from <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>, and
        extends the IPFIX Information Model defined in <a class='info' href='#RFC5102'>[RFC5102]<span> (</span><span class='info'>Quittek, J., Bryant, S., Claise, B., Aitken, P., and J. Meyer, &ldquo;Information Model for IP Flow Information Export,&rdquo; January&nbsp;2008.</span><span>)</span></a> to provide new Information Elements for IPFIX File
        metadata. It uses the method described in <a class='info' href='#I-D.ietf-ipfix-exporting-type'>"Exporting Type Information for
        IPFIX Information Elements"<span> (</span><span class='info'>Boschi, E., Trammell, B., Mark, L., and T. Zseby, &ldquo;Exporting Type Information for IPFIX Information Elements,&rdquo; June&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;ipfix&#8209;exporting&#8209;type] document to support the
        self-description of IPFIX Files containing enterprise-specific
        Information Elements.
</p>
<a name="terminology-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>This section defines terminology related to the IPFIX File Format. In
      addition, terms used in this document that are defined in the
      Terminology section of <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a> are to be interpreted as
      defined there.
</p>
<blockquote class="text"><dl>
<dt>IPFIX File: </dt>
<dd>An IPFIX File is a serialized stream of
        IPFIX Messages; this stream may be stored on a filesystem or
        transported using any technique customarily used for files. Any IPFIX
        Message stream that would be considered valid when transported one or
        more of the specified IPFIX transports (SCTP, TCP, or UDP) as defined
        in <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a> is considered an IPFIX File. However, this
        document extends that definition with recommendations on the
        construction of IPFIX Files that meet the requirements identified in
        <a class='info' href='#requirements-section'>Section&nbsp;5<span> (</span><span class='info'>Requirements</span><span>)</span></a>.
</dd>
<dt>IPFIX File Reader: </dt>
<dd>An IPFIX File Reader is a process
        which reads IPFIX Files from a filesystem. An IPFIX File Reader
        operates as an IPFIX Collecting Process as specified in <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>, except as modified by this document.
</dd>
<dt>IPFIX File Writer: </dt>
<dd>An IPFIX File Writer is a process
        which writes IPFIX Files to a filesystem. An IPFIX File Writer
        operates as an IPFIX Exporting Process as specified in <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>, except as modified by this document.
</dd>
</dl></blockquote>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="design-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Design Overview</h3>

<p>An IPFIX File is simply a data stream containing one or more IPFIX
      Messages serialized to some filesystem. Though any set of valid IPFIX
      Messages can be serialized into an IPFIX File, the specification
      includes guidelines designed to ease storage and retrieval of flow data
      using the IPFIX File format.
</p>
<p>IPFIX Files contain only IPFIX Messages; any file metadata such as
      checksums or export session details are stored using Options within the
      IPFIX Message. This design is completely compatible with the IPFIX
      protocol on the wire. A schematic of a typical IPFIX File is shown
      below:
</p><br /><hr class="insert" />
<a name="design-structure"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
          +=======================================+
          | IPFIX File                            |
          | +===================================+ |
          | | IPFIX Message                     | |
          | | +-------------------------------+ | |
          | | | IPFIX Message Header          | | |
          | | +-------------------------------+ | |
          | | +-------------------------------+ | |
          | | | Options Template Set          | | |
          | | |   Options Template Record     | | |
          | | |           . . .               | | |
          | | +-------------------------------+ | |
          | | +-------------------------------+ | |
          | | | Template Set                  | | |
          | | |   Template Record             | | |
          | | |            . . .              | | |
          | | +-------------------------------+ | |
          | +===================================+ |
          | | IPFIX Message                     | |
          | | +-------------------------------+ | |
          | | | IPFIX Message Header          | | |
          | | +-------------------------------+ | |
          | | +-------------------------------+ | |
          | | | Data Set                      | | |
          | | |   Data Record                 | | |
          | | |            . . .              | | |
          | | +-------------------------------+ | |
          | | +-------------------------------+ | |
          | | | Data Set                      | | |
          | | |   Data Record                 | | |
          | | |            . . .              | | |
          | | +-------------------------------+ | |
          | |              . . .                | |
          | +===================================+ |
          |                . . .                  |
          +=======================================+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Typical File Structure&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="motivation-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Motivation</h3>

<p>There is a wide variety of applications for the file-based storage
      of IP flow data, across a continuum of time scales. Tools used in the
      analysis of flow data and creation of analysis products often use files
      as a convenient unit of work, with an ephemeral lifetime. A set of flows
      relevant to a security investigation may be stored in a file for the
      duration of that investigation, and further exchanged among incident
      handlers via email or within an external incident handling workflow
      application. Sets of flow data relevant to Internet measurement research
      may be published as files, much as libpcap packet trace files are, to
      provide common datasets for the repeatability of research efforts;
      these files would have lifetimes measured in months or years.
      Operational flow measurement systems also have a need for long-term,
      archival storage of flow data, either as a primary flow data repository,
      or as a backing tier for online storage in a relational database
      management system (RDBMS).
</p>
<p>The variety of applications of flow data, and the variety of
      presently deployed storage approaches, indicates the need
      for a standard approach to flow storage with applicability across the
      continuum of time scales over which flow data is stored. A storage
      format based around flat files would best address the variety of storage
      requirements. While much work has been done on structured storage via
      RDBMS, relational database systems are not a good basis for format
      standardization owing to the fact that their internal data structures
      are generally private to a single implementation and subject to change
      for internal reasons. Also, there are a wide variety of operations
      available on flat files, and external tools and standards can be
      leveraged to meet file-based flow storage requirements. Further, flow
      data is often not very semantically complicated, and is managed in very
      high volume; therefore, an RDBMS-based flow storage system would not
      benefit much from the advantages of relational database technology.
</p>
<p>The simplest way to create a new file format is simply to serialize
      some internal data model to disk, with either textual or binary
      representation of data elements, and some framing strategy for
      delimiting fields and records. "Ad-hoc" file formats such as this have
      several important disadvantages. They impose the semantics of the data
      model from which they are derived on the file format, and as such, they
      are difficult to extend, describe, and standardize.
</p>
<p>Indeed, one de facto standard for the storage of flow data is one of
      these ad-hoc formats. A common method of storing data collected via
      Cisco NetFlow is to serialize a stream of raw NetFlow datagrams into
      files. These NetFlow PDU files consist of a collection of
      header-prefixed blocks (corresponding to the datagrams as received on
      the wire) containing fixed-length binary flow records. NetFlow V5, V7,
      and V8 data may be mixed within a given file, as the header on each
      datagram defines the NetFlow version of the records following. While
      this NetFlow PDU file format has all the disadvantages of an ad-hoc
      format, and is not extensible to data models other than that defined by
      Cisco NetFlow, it is at least reasonably well-understood due to its
      ubiquity.
</p>
<p>Over the past decade XML markup has emerged as a new "universal"
      representation format for structured data. It is intended to be
      human-readable; indeed, that is one reason for its rapid adoption.
      However XML has limited usefulness for representing network flow data.
      Network flow data has a simple, repetitive, non-hierarchical structure
      that does not benefit much from XML. An XML representation of flow data
      would be an essentially flat list of the attributes and their values for
      each flow record.
</p>
<p>The XML approach to data encoding is very heavyweight when compared
      to binary flow encoding. XML's use of start- and end-tags, and
      plain-text encoding of the actual values, leads to significant
      inefficiency in encoding size. Typical network traffic datasets can
      contain millions or billions of flows per hour of traffic represented.
      Any increase in storage size per record can have dramatic impact on flow
      data storage and transfer sizes. While data compression algorithms can
      partially remove the redundancy introduced by XML encoding, they
      introduce additional overhead of their own.
</p>
<p>A further problem is that XML processing tools require a full XML
      parser. XML parsers are fully general and therefore complex,
      resource-intensive and relatively slow, introducing significant
      processing time overhead for large network-flow datasets. In contrast,
      parsers for typical binary flow data encodings are simply structured,
      since they only need to parse a very small header and then have complete
      knowledge of all following fields for the particular flow. These can
      then be read in a very efficient linear fashion.
</p>
<p>This leads us to propose the IPFIX Message format as the basis for a
      new flow data file format. The IPFIX working group, in defining the
      IPFIX Protocol, has already defined an information model and data
      formatting rules for representation of flow data. Especially at shorter
      time scales, when a file is a unit of data interchange, the filesystem
      may be viewed as simply another IPFIX Message transport between
      processes. This format is especially well suited to representing flow
      data, as it was designed specifically for flow data export; it is easily
      extensible unlike ad-hoc serialization, and compact unlike XML. In
      addition, IPFIX is an IETF standard for the export and collection of
      flow data; using a common format for storage and analysis at the
      collection side allows implementors to use substantially the same
      information model and data formatting implementation for transport as
      well as storage.
</p>
<a name="requirements-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Requirements</h3>

<p>In this section, we outline a proposed set of <a class='info' href='#SAINT2007'>requirements<span> (</span><span class='info'>Trammell, B., Boschi, E., Mark, L., and T. Zseby, &ldquo;Requirements for a standardized flow storage solution,&rdquo; January&nbsp;2007.</span><span>)</span></a> [SAINT2007] for any persistent storage format
      for flow data. First and foremost, a flow data file format should
      support storage across the continuum of time scales important to flow
      storage applications. Each of the requirements enumerated in the
      sections below is broadly applicable to flow storage applications,
      though each may be more important at certain time scales. For each, we
      first identify the requirement, then explain how the IPFIX Message
      format addresses it, or briefly outline the changes that must be made in
      order for an IPFIX-based file format to meet the requirement.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Record Format Flexibility</h3>

<p>Due to the wide variety of flow attributes collected by different
        network flow attribute measurement systems, the ideal flow storage
        format will not impose a single data model or a specific record type
        on the flows it stores. The file format must be flexible and
        extensible; that is, it must support the definition of multiple record
        types within the file itself, and must be able to support new field
        types for data within the records in a graceful way.
</p>
<p>IPFIX provides record format flexibility through the use of
        Templates to describe each Data Record, through the use of an IANA
        Registry to define its Information Elements, and through the use of
        enterprise-specific Information Elements.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Self Description</h3>

<p>Archived data may be read at a time in the future where any
        external reference to the meaning of the data may be lost. The ideal
        flow storage format should be self-describing; that is, a process
        reading flow data from storage should be able to properly interpret
        the stored flows without reference to anything other than standard
        sources (e.g., the standards document describing the file format) and
        the stored flow data itself.
</p>
<p>The IPFIX Message format is partially self-describing; that is,
        IPFIX Templates containing only IANA-assigned Information Elements can
        be completely interpreted according to the IPFIX Information Model
        without additional external data.
</p>
<p>However, Templates containing private information elements lack
        detailed type and semantic information; a Collecting Process receiving
        Data Records described by a Template containing enterprise-specific
        Information Elements it does not understand can only treat the data
        contained within those Information Elements as octet arrays. To be
        fully self-describing, enterprise-specific Information Elements must
        be additionally described via IPFIX Options according to the
        Information Element Type Options Template defined in <a class='info' href='#I-D.ietf-ipfix-exporting-type'>"Exporting Type Information for
        IPFIX Information Elements"<span> (</span><span class='info'>Boschi, E., Trammell, B., Mark, L., and T. Zseby, &ldquo;Exporting Type Information for IPFIX Information Elements,&rdquo; June&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;ipfix&#8209;exporting&#8209;type].
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Data Compression</h3>

<p>Regardless of the representation format, flow data describing
        traffic on real networks tends to be highly compressible. Compression
        tends to improve the scalability of flow collection systems, by
        reducing the disk storage and I/O bandwidth requirement for a given
        workload. The ideal flow storage format should support applications
        which wish to leverage this fact by supporting compression of stored
        data.
</p>
<p>The IPFIX Message format has no support for data compression, as
        the IPFIX protocol was designed for speed and simplicity of export. Of
        course, any flat file is readily compressible using a wide variety of
        external data compression tools, formats, and algorithms; therefore,
        this requirement can be met via enapsulation in one of these formats.
        <a class='info' href='#compression-section'>Section&nbsp;10<span> (</span><span class='info'>Compression of IPFIX Files</span><span>)</span></a> specifies an encapsulation based
        on bzip2 or gzip, to maximize interoperability.
</p>
<p>A few simple optimizations can be made by File Writers to increase
        the integrity and usability of compressed IPFIX data; these are
        outlined in <a class='info' href='#compression-errors'>Section&nbsp;10.3<span> (</span><span class='info'>Compression Error Resilience</span><span>)</span></a>.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Indexing and Searching</h3>

<p>Binary, record stream oriented file formats natively support only
        one form of searching, sequential scan in file order. By choosing the
        order of records in a file carefully (e.g., by flow end
        time), a file can be indexed by a single key.
</p>
<p>Beyond this, properly addressing indexing is an
        application-specific problem, as it inherently involves tradeoffs
        between storage complexity and retrieval speed, and requirements vary
        widely based on time scales and the types of queries used from site to
        site. However, a generic standard flow storage format may provide
        limited direct support for indexing and searching.
</p>
<p>The ideal flow storage format will support a limited table of
        contents facility noting that the records in a file contain data
        relating only to certain keys or values of keys, in order to keep
        multi-file search implementations from having to scan a file for data
        it does not contain.
</p>
<p>The IPFIX Message format has no direct support for indexing.
        However, the technique described in <a class='info' href='#RFC5473'>"Reducing
        Redundancy in IPFIX and PSAMP Reports"<span> (</span><span class='info'>Boschi, E., Mark, L., and B. Claise, &ldquo;Reducing Redundancy in IP Flow Information Export (IPFIX) and Packet Sampling (PSAMP) Reports,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5473] can be used to describe
        the contents of a file in a limited way. Additionally, as flow data is
        often sorted and divided by time, the start and end time of the flows
        in a file may be declared using the File Time Window Options Template
        defined in <a class='info' href='#ot-time-window'>Section&nbsp;8.1.2<span> (</span><span class='info'>File Time Window Options Template</span><span>)</span></a>.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
Error Recovery</h3>

<p>When storing flow data for archival purposes, it is important to
        ensure that hardware or software faults do not introduce errors into
        the data over time. The ideal flow storage format will support the
        detection and correction of encoding-level errors in the data.
</p>
<p>Note that more advanced error correction is best
        handled at a layer below that addressed by this document. Error
        correction is a topic well addressed by the storage industry in
        general (e.g. by RAID and other technologies), and by specifying a
        flow storage format based upon files, we can leverage these features
        to meet this requirement.
</p>
<p>However, the ideal flow storage format will be resilient against
        errors, providing an internal facility for the detection of errors and
        the ability to isolate errors to as few data records as possible.
</p>
<p>Note that this requirement interacts with the choice of data
        compression or encryption algorithm. For example, the use of block
        compression algorithms can serve to isolate errors to a single
        compression block, unlike stream compressors, which may fail to
        resynchronize after a single bit error, invalidating the entire
        message stream.
</p>
<p>The IPFIX Message format does not support data integrity assurance.
        It is assumed that advanced error correction will be provided
        externally. Compression and encryption, if used, provide some
        allowance for detection, if not correction, of errors. For simple
        error detection support in the absence of compression or encryption,
        checksums may be attached to messages via IPFIX Options according to
        the Message Checksum Options Template defined in <a class='info' href='#ot-checksum'>Section&nbsp;8.1.1<span> (</span><span class='info'>Message Checksum Options Template</span><span>)</span></a>. 
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.6"></a><h3>5.6.&nbsp;
Authentication, Confidentiality, and Integrity</h3>

<p>Archival storage of flow data may also require assurance that no
        unauthorized entity can read or modify the stored data. Cryptography
        can be applied to this problem to ensure integrity and confidentiality
        by signing and encryption.
</p>
<p>As with error correction, this problem has been addressed well at a
        layer below that addressed by this document. We can leverage the fact
        that existing cryptographic technologies work quite well on data
        stored in files, and that there exist standard and interoperable ways
        to encrypt files and exchange encrypted files, to meet this
        requirement.
</p>
<p>Beyond support for the use of TLS for transport over TCP or DTLS
        for transport over SCTP or UDP, both of which provide transient
        authentication and confidentiality, the IPFIX protocol does not
        support this requirement directly. The IETF has specified <a class='info' href='#RFC3852'>the Cryptographic Message Syntax (CMS)<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; July&nbsp;2004.</span><span>)</span></a> [RFC3852] for
        encapsulating encrypted file data along with key and certificate
        information, and <a class='info' href='#encryption-section'>Section&nbsp;9<span> (</span><span class='info'>Encryption of IPFIX Files</span><span>)</span></a> specifies a
        CMS-based method for encrypting IPFIX Files.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.7"></a><h3>5.7.&nbsp;
Anonymization and Obfuscation</h3>

<p>To ensure the privacy of individuals and organizations at the
        endpoints of communications represented by flow records, it is often
        necessary to obfuscate or anonymize stored and exported flow data. The
        ideal flow storage format will provide for a notation that a given
        information element on a given record type represents anonymized,
        rather than real, data.
</p>
<p>The IPFIX Protocol presently has no support for anonymization
        notation. It should be noted that anonymization is one of the
        requirements given for IPFIX in <a class='info' href='#RFC3917'>[RFC3917]<span> (</span><span class='info'>Quittek, J., Zseby, T., Claise, B., and S. Zander, &ldquo;Requirements for IP Flow Information Export (IPFIX),&rdquo; October&nbsp;2004.</span><span>)</span></a>. The decision
        to qualify this requirement with 'MAY' and not 'MUST' in the
        requirements document, and its subsequent lack of specification in the
        current version of the IPFIX protocol, is due to the fact that
        anonymization algorithms are still an open area of research, and that
        there currently exist no standardized methods for anonymization.
</p>
<p>No support is presently defined in <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a> or this
        IPFIX-based File Format for anonymization, as anonymization notation
        is an area of open work for the IPFIX working group.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8"></a><h3>5.8.&nbsp;
Session Auditability and Replayability</h3>

<p>Certain use cases for archival flow storage require the storage of
        collection infrastructure details alongside the data itself. These
        details include information about how and when data was received, and
        where it was received from, and are useful for auditing as well as for
        the replaying received data for testing purposes.
</p>
<p>The IPFIX Protocol contains no direct support for auditability and
        replayability, though the IPFIX Information Model does define various
        Information Elements required to represent collection infrastructure
        details. These details may be stored in IPFIX Files using the Export
        Session Details Options Template defined in <a class='info' href='#ot-session-detail'>Section&nbsp;8.1.3<span> (</span><span class='info'>Export Session Details Options Template</span><span>)</span></a> and the Message Details Options Template
        defined in <a class='info' href='#ot-message-detail'>Section&nbsp;8.1.4<span> (</span><span class='info'>Message Details Options Template</span><span>)</span></a>.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9"></a><h3>5.9.&nbsp;
Performance Characteristics</h3>

<p>The ideal standard flow storage format will not have a significant
        negative impact on the performance of the application generating or
        processing flow data stored in the format. This is a non-functional
        requirement, but it is important to note that a standard that implies
        a significant performance penalty is unlikely to be widely implemented
        and adopted.
</p>
<p>An examination of the IPFIX Protocol would seem to suggest
        that implementations of it are not particularly prone to slowness;
        indeed, a template-based data representation is more easily subject to
        optimization for common cases than representations that embed
        structural information directly in the data stream (e.g. XML).
        However, a full analysis of the impact of using IPFIX Messages as a
        basis for flow data storage on read/write performance will require
        more implementation experience and performance measurement.
</p>
<a name="applicability-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Applicability</h3>

<p>This section describes the specific applicability of IPFIX Files to
      various use cases. IPFIX Files are particularly useful in a flow
      collection and processing infrastructure using IPFIX for flow export. We
      explore the applicability and provide guidelines for using IPFIX files
      for the storage of flow data collected by IPFIX Collecting Processes and
      NetFlow V9 collectors, the testing of IPFIX Collecting Processes, and
      diagnostics of IPFIX Devices.
</p>
<a name="applicability-collection"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Storage of IPFIX-collected Flow Data</h3>

<p>IPFIX Files can naturally be used to store flow data collected by
        an IPFIX Collecting Process; indeed, this was one of the primary
        initial motivations behind the file format described within this
        document. Using IPFIX Files as such provides a single, standard,
        well-understood encoding to be used for flow data on disk and on the
        wire, and allows IPFIX implementations to leverage substantially the
        same code for flow export and flow storage. In addition, the storage
        of single Transport Sessions in IPFIX Files is particularly important
        for network measurement research, allowing repeatability of
        experiments by providing a format for the storage and exchange of
        IPFIX flow trace data much as the libpcap format is used for
        experiments on packet trace data.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Storage of NetFlow V9-collected Flow Data</h3>

<p>Although the IPFIX protocol is based on the Cisco Netflow Services,
        Version 9 (NetFlow V9) <a class='info' href='#RFC3954'>protocol<span> (</span><span class='info'>Claise, B., &ldquo;Cisco Systems NetFlow Services Export Version 9,&rdquo; October&nbsp;2004.</span><span>)</span></a> [RFC3954], the two
        have diverged since work began on IPFIX. However, since the NetFlow V9
        information model is a compatible subset of the IPFIX information
        model, it is possible to use IPFIX files to store collected NetFlow V9
        flow data. This approach may be particularly useful in multi-vendor,
        multi-protocol collection infrastructures using both NetFlow V9 and
        IPFIX to export flow data.
</p>
<p>The applicability of IPFIX Files to this use case is outlined in  
        <a class='info' href='#v9-applicability'>Appendix&nbsp;B<span> (</span><span class='info'>Applicability of IPFIX Files to NetFlow V9 flow storage</span><span>)</span></a>.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Testing IPFIX Collecting Processes</h3>

<p>IPFIX Files can be used to store IPFIX Messages for the testing of
        IPFIX Collecting Processes. A variety of test cases may be stored in
        IPFIX Files. First, IPFIX data collected in real network
        environments and stored in an IPFIX File can be used as input to check
        the behavior of new or extended implementations of IPFIX Collectors.
        Furthermore, IPFIX Files can be used to validate the operation of a
        given IPFIX Collecting Process in a new environment, i.e., to test
        with recorded IPFIX data from the target network before installing the
        Collecting Process in the network.
</p>
<p>The IPFIX File format can also be used to store artificial,
        non-compliant reference messages for specific Collecting Process test
        cases. Examples for such test cases are sets of IPFIX records with
        undefined Information Elements, Data Records described by missing
        Templates, or incorrectly framed Messages or Data Sets. Representative
        error handling test cases are defined in <a class='info' href='#RFC5471'>"IPFIX Testing"<span> (</span><span class='info'>Schmoll, C., Aitken, P., and B. Claise, &ldquo;Guidelines for IP Flow Information Export (IPFIX) Testing,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5471].
</p>
<p>Furthermore, fast replay of IPFIX Messages stored in a file can be
        used for stress/load tests (e.g., high rate of incoming Data Records,
        large Templates with high Information Element counts), as described in
        <a class='info' href='#RFC5471'>"IPFIX Testing"<span> (</span><span class='info'>Schmoll, C., Aitken, P., and B. Claise, &ldquo;Guidelines for IP Flow Information Export (IPFIX) Testing,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5471]. The
        provisioning and use of a set of reference files for testing
        simplifies the performance of tests and increases the comparability of
        test results.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
IPFIX Device Diagnostics</h3>

<p>As an IPFIX File can be used to store any collection of flows, the
        format may also be used for dumping and storing various types of flow
        data for IPFIX Device diagnostics (e.g., the open flow cache of a
        Metering Process or the flow backlog of an Exporting or Collecting
        Process at the time of a process reset or crash). File-based storage
        is preferable to remote transmission in such error-recovery
        situations.
</p>
<a name="detail-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Detailed File Format Specification</h3>

<p>Any valid serialized IPFIX Message stream MUST be accepted by a File
      Reader as a valid IPFIX File. In this way, the filesystem is simply
      treated as another IPFIX transport alongside SCTP, TCP, and UDP, albeit
      a potentially high-latency transport, as the File Reader and File Writer
      do not necessarily run at the same time.
</p>
<p>This section specifies the detailed actions of File Readers and File
      Writers in handling IPFIX Files, and further specifies actions of File
      Writers in specific use cases. Unless otherwise specified herein, IPFIX
      File Writers MUST behave as IPFIX Exporting Processes, and IPFIX File
      Readers MUST behave as IPFIX Collecting Processes, where
      appropriate.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
File Reader Specification</h3>

<p>An IPFIX File Reader MUST act as an IPFIX Collecting Process as
        specified in <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>, except as modified by this
        document.
</p>
<p>An IPFIX File Reader MUST accept as valid any serialized IPFIX
        Message stream that would be considered valid by one or more of the
        other defined IPFIX transport layers. Practically, this means that the
        union of IPFIX Template management features supported by SCTP, TCP,
        and UDP MUST be supported in IPFIX Files. File Readers MUST:
</p>
<ul class="text">
<li>accept IPFIX Messages containing Template Sets,
          Options Template Sets, and Data Sets within the same message, as
          with IPFIX over TCP or UDP;
</li>
<li>accept Template Sets that define Templates already defined within
          the File, as may occur with retransmission of Templates when using
          IPFIX over UDP as described in section 10.3.6 of <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>;
</li>
<li>resolve any conflict between a resent definition and a previous
          definition by assuming that the new Template replaces the old, as
          consistent with Template expiration and ID reuse when using UDP at
          the IPFIX transport protocol; and
</li>
<li>accept Template Withdrawals as described in section 8 of <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>, provided that the Template to be withdrawn is
          defined, as is the case with IPFIX over TCP and SCTP.
</li>
</ul>
<p>Considering the filesystem-as-transport view, in the general case
        an IPFIX File SHOULD be treated as containing a single Transport
        Session as defined by <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>. However, some
        applications may benefit from the ability to treat a collection of
        IPFIX Files as a single Transport Session; see especially <a class='info' href='#writer-archival-section'>Section&nbsp;7.3.3<span> (</span><span class='info'>Using IPFIX Files for Archival Storage</span><span>)</span></a> below. A File Reader MAY be
        configurable to treat a collection of Files as a single Transport
        Session. However, a File Reader MUST NOT treat a single IPFIX File as
        containing multiple Transport Sessions.
</p>
<p>If an IPFIX File uses the technique described in <a class='info' href='#RFC5473'>"Reducing Redundancy in
        IPFIX and PSAMP Reports"<span> (</span><span class='info'>Boschi, E., Mark, L., and B. Claise, &ldquo;Reducing Redundancy in IP Flow Information Export (IPFIX) and Packet Sampling (PSAMP) Reports,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5473] AND all of the non-Options Templates
        in the File contain the commonPropertiesId Information Element, a File
        Reader MAY assume the set of commonPropertiesId definitions provides a
        complete table of contents for the File for searching purposes.
</p>
<a name="writer-spec-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
File Writer Specification</h3>

<p>An IPFIX File Writer MUST act as an IPFIX Exporting Process as
        specified in <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>, except as modified by this
        document. This section contains specifications for IPFIX File Writers
        in all situations; specifications and recommendations for specific
        File Writer use cases are found in 
        below.
</p>
<p>File Writers SHOULD store the Templates and Options required to
        decode the data within the File in the File itself, unless modified by
        the requirements of a specific use case in a subsection of <a class='info' href='#writer-case-section'>Section&nbsp;7.3<span> (</span><span class='info'>Specific File Writer Use Cases</span><span>)</span></a>. In this way, a single IPFIX File
        generally contains a single notional Transport Session as defined by
        <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>.
</p>
<p>File Writers SHOULD emit each Template Set or Options Template Set
        to appear in the File before any Data Set described by the Templates
        within that Set, to ensure the File Reader can decode every Data Set
        without waiting to process subsequent Templates or Options
        Templates.
</p>
<p>File Writers SHOULD emit Data Records described by Options
        Templates to appear in the File before any Data Records which depend
        on the scopes defined by those options.
</p>
<p>File Writers SHOULD use Template Withdrawals to withdraw Templates
        if Template IDs need to be reused. Template Withdrawals SHOULD NOT be
        used unless necessary to reuse Template IDs.
</p>
<p>File Writers SHOULD write IPFIX Messages within an IPFIX File in
        ascending Export Time order.
</p>
<p>File Writers MAY write Data Records to an IPFIX File in any order.
        However, File Writers that write flow records to an IPFIX File in
        flowStartTime or flowEndTime order SHOULD be consistent in this
        ordering within each File.
</p>
<a name="writer-case-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Specific File Writer Use Cases</h3>

<p>The specifications in this section apply to specific situations.
        Each section below extends or modifies the base File Writer
        specification in <a class='info' href='#writer-spec-section'>Section&nbsp;7.2<span> (</span><span class='info'>File Writer Specification</span><span>)</span></a>. Considerations
        for collocation of a File Writer with IPFIX Collecting Processes and
        Metering Processes are given, as are specific guidelines for using
        IPFIX Files for archival storage, or as documents. Also covered are
        the use of IPFIX Files in the testing and diagnostics of IPFIX
        Devices.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1"></a><h3>7.3.1.&nbsp;
Collocating a File Writer with a Collecting Process</h3>

<p>When collocating a File Writer with an IPFIX Collecting Process
          for archival storage of collected data in IPFIX Files as described
          in <a class='info' href='#applicability-collection'>Section&nbsp;6.1<span> (</span><span class='info'>Storage of IPFIX-collected Flow Data</span><span>)</span></a>, the following
          recommendations may improve the usefulness of the stored data.
</p>
<p>The simplest way for a File Writer to store the data collected in
          a single Transport Session is to simply write the incoming IPFIX
          Messages to an IPFIX File as they are collected. This approach has
          several drawbacks. First, if the original Exporting Process did not
          conform to the recommendations in <a class='info' href='#writer-spec-section'>Section&nbsp;7.2<span> (</span><span class='info'>File Writer Specification</span><span>)</span></a> with respect to Template and Data Record ordering, the written
          file can be difficult to use later; in this case, File Writers MAY
          reorder records as received in order to ensure that Templates appear
          before the Data Records they describe.
</p>
<p>A File Writer collocated with a Collecting Process that starts
          writing data from a running Transport Session SHOULD write all the
          Templates currently active within that Transport Session before
          writing any Data Records described by them.
</p>
<p>Also, the resulting IPFIX Files will lack information about the
          IPFIX Transport Session used to export them, such as the network
          addresses of the Exporting and Collecting Processes and the
          protocols used to transport them. In this case, if information about
          the Transport Session is required, the File Writer SHOULD store a
          single IPFIX Transport Session in an IPFIX File and SHOULD record
          information about the Transport Session using the Export Session
          Details Options Template described in <a class='info' href='#ot-session-detail'>Section&nbsp;8.1.3<span> (</span><span class='info'>Export Session Details Options Template</span><span>)</span></a>.
</p>
<p>Additional per-Message information MAY be recorded by the File
          Writer using the Message Details Options Template described in <a class='info' href='#ot-message-detail'>Section&nbsp;8.1.4<span> (</span><span class='info'>Message Details Options Template</span><span>)</span></a>. Per-Message information includes the
          time at which each IPFIX Message was received at the Collecting
          Process, and can be used to resend IPFIX Messages while keeping the
          original measurement plane traffic profile.
</p>
<p>When collocating a File Writer with a Collecting Process, the
          Export Time of each Message SHOULD be the Export Time of the Message
          received by the Collecting Process containing the first Data Record
          in the Message. Note that File Writers storing IPFIX data collected
          from an IPFIX Collecting Process using SCTP as the transport
          protocol SHOULD interleave messages from multiple streams in order
          to preserve Export Time order, and SHOULD reorder the written
          messages as necessary to ensure that each Template Set or Options
          Template Set appears in the File before any Data Set described by
          the Templates within that Set. Template reordering MUST preserve the
          sequence of Template Sets with Template Withdrawals in order to
          ensure consistency of Templates.
</p>
<p>Note that when adding additional information to IPFIX Messages
          received from Collecting Processes (e.g. Message Checksum Options,
          Message Detail Options), the File Writer SHOULD extend the length of
          the Message for the additional data if possible; otherwise, the
          Message SHOULD be split into two approximately equal-size Messages
          aligned on a Data Set or Template Set boundary from the original
          Message if possible; otherwise, the Message SHOULD be split into
          approximately two equal size Messages aligned on a Data Record
          boundary. Note that, since the MSS or MTU of most network links
          (1500-9000 for common Ethernets) is smaller than the maximum IPFIX
          Message size (65536) within an IPFIX File, it is expected that
          message length extension will suffice in most circumstances.
</p>
<p>A File Writer collocated with a Collecting Process SHOULD NOT
          sign a File as specified in <a class='info' href='#encryption-cms'>Section&nbsp;9.1<span> (</span><span class='info'>Encapsulation within the Cryptographic Message Syntax</span><span>)</span></a>
          unless the Transport Session over which the data was exported was
          protected via TLS or DTLS, and the Collecting Process positively
          identified the Exporting Process by its certificate. See <a class='info' href='#security-trust-chain'>Section&nbsp;12.2<span> (</span><span class='info'>End-to-End Assertions for IPFIX Files</span><span>)</span></a> for more information on this
          issue.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.2"></a><h3>7.3.2.&nbsp;
Collocating a File Writer with a Metering Process</h3>

<p>Note that File Writers may also be collocated directly with IPFIX
          Metering Processes, for writing measured information directly to
          disk without intermediate IPFIX Exporting or Collecting Processes.
          This arrangement may be particularly useful when providing data to
          an analysis environment with an IPFIX File based workflow, when
          testing Metering Processes during development, or when the
          authentication of a Metering Process is important.
</p>
<p>When collocating a File Writer with a Metering Process, note
          that Information Elements associated with Exporting or Collecting
          Processes are meaningless, and SHOULD NOT appear in the Export
          Session Details Options Template described in <a class='info' href='#ot-session-detail'>Section&nbsp;8.1.3<span> (</span><span class='info'>Export Session Details Options Template</span><span>)</span></a> or the Message Details Options Template
          described in <a class='info' href='#ot-message-detail'>Section&nbsp;8.1.4<span> (</span><span class='info'>Message Details Options Template</span><span>)</span></a>.
</p>
<p>When collocating a File Writer with an Metering Process, the
          Export Time of each Message SHOULD be the time at which the first
          Data Record in the Message was received from the Metering
          Process.
</p>
<p>Note that collocating a File Writer with a Metering Process is
          the only way to provide positive authentication of a Metering
          Process through signatures as in <a class='info' href='#encryption-cms'>Section&nbsp;9.1<span> (</span><span class='info'>Encapsulation within the Cryptographic Message Syntax</span><span>)</span></a>. See <a class='info' href='#security-trust-chain'>Section&nbsp;12.2<span> (</span><span class='info'>End-to-End Assertions for IPFIX Files</span><span>)</span></a> for more information on this
          issue.
</p>
<a name="writer-archival-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.3"></a><h3>7.3.3.&nbsp;
Using IPFIX Files for Archival Storage</h3>

<p>While in the general case File Writers should store one Transport
          Session per IPFIX File, some applications storing large collections
          of data over long periods of time may benefit from the ability to
          treat a collection of IPFIX Files as a single Transport Session. A
          File Writer MAY be configurable to write data from a single
          Transport Session into multiple IPFIX Files; however, File Writers
          supporting such a configuration option MUST provide a configuration
          option to support one-file-per-session behavior for interoperability
          purposes.
</p>
<p>File Writers using IPFIX Files for archival storage SHOULD
          support compression as in <a class='info' href='#compression-section'>Section&nbsp;10<span> (</span><span class='info'>Compression of IPFIX Files</span><span>)</span></a>.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.4"></a><h3>7.3.4.&nbsp;
Using IPFIX Files as Documents</h3>

<p>When IPFIX Files are used as documents, to store a set of flows
          relevant to query, investigation, or other common context, or for
          the publication of traffic datasets relevant to network research,
          each File MUST be readable as a single Transport Session,
          self-contained and making no reference to metadata stored in
          separate Files, in order to ensure interoperability.
</p>
<p>When writing Files to be used as documents, File Writers MAY emit
          the special Data Records described by Options Templates before any
          other Data Records in the File in the following order to ease the
          inspection and use of documents by File Readers:
</p>
<ul class="text">
<li>Time Window records described by the File Time Window Options
            Template as defined in <a class='info' href='#ot-time-window'>Section&nbsp;8.1.2<span> (</span><span class='info'>File Time Window Options Template</span><span>)</span></a> below;
            followed by
</li>
<li>Information Element Type Records as described in <a class='info' href='#I-D.ietf-ipfix-exporting-type'>"Exporting Type Information
            for IPFIX Information Elements"<span> (</span><span class='info'>Boschi, E., Trammell, B., Mark, L., and T. Zseby, &ldquo;Exporting Type Information for IPFIX Information Elements,&rdquo; June&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;ipfix&#8209;exporting&#8209;type]; followed by
</li>
<li>commonPropertiesId definitions as described in <a class='info' href='#RFC5473'>"Reducing Redundancy
            in IPFIX and PSAMP Reports"<span> (</span><span class='info'>Boschi, E., Mark, L., and B. Claise, &ldquo;Reducing Redundancy in IP Flow Information Export (IPFIX) and Packet Sampling (PSAMP) Reports,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5473]; followed by
</li>
<li>Export Session details records described by the Export Session
            Details Options Template as defined in <a class='info' href='#ot-session-detail'>Section&nbsp;8.1.3<span> (</span><span class='info'>Export Session Details Options Template</span><span>)</span></a> below.
</li>
</ul>
<p>The Export Time of each Message within a File used as a document
          SHOULD be the time at which the Message was written by the File
          Writer.
</p>
<p>If an IPFIX File used as a document uses the technique described
          in <a class='info' href='#RFC5473'>"Reducing
          Redundancy in IPFIX and PSAMP Reports"<span> (</span><span class='info'>Boschi, E., Mark, L., and B. Claise, &ldquo;Reducing Redundancy in IP Flow Information Export (IPFIX) and Packet Sampling (PSAMP) Reports,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5473] AND all of the
          non-Options Templates in the File contain the commonPropertiesId
          Information Element, a File Reader MAY assume the set of
          commonPropertiesId definitions provides a complete table of contents
          for the File for searching purposes.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.5"></a><h3>7.3.5.&nbsp;
Using IPFIX Files for Testing</h3>

<p>IPFIX Files can be used for testing IPFIX Collecting Processes in
          two ways. First, IPFIX Files can be used to store specific flow data
          for regression and stress testing of Collectors; there are no
          special considerations for IPFIX Files used in this way.
</p>
<p>Second, IPFIX Files are useful for storing reference messages
          which do not comply to the IPFIX Protocol in order to test the error
          handling and recovery behavior of Collectors. Of course, IPFIX Files
          intended to be used in this application necessarily MAY violate any
          of the specifications in this document or in <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>, and such Files MUST NOT be transmitted to
          Collecting Processes or given as input to File Readers not under
          test.
</p>
<p>Note that an extremely simple IPFIX Exporting Process may be
          crafted for testing purposes by simply reading an IPFIX File and
          transmitting it directly to a Collecting Process. Similarly, an
          extremely simple Collecting Process may be crafted for testing
          purposes by simply accepting connections and/or IPFIX Messages from
          Exporting Processes and writing the session's message stream to an
          IPFIX File.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.6"></a><h3>7.3.6.&nbsp;
Writing IPFIX Files for Device Diagnostics</h3>

<p>IPFIX Files can be used in the debugging of devices which use
          flow data as internal state, as a common format for the
          representation of flow tables. In such situations, the opaqueOctets
          information element can be used to store additional non-IPFIX
          encoded, non-flow information (e.g., stack backtraces, process
          state, etc.) within the IPFIX File as in <a class='info' href='#encapsulation-int'>Section&nbsp;11.1<span> (</span><span class='info'>Encapsulation of Non-IPFIX Data in IPFIX Files</span><span>)</span></a>; the IPFIX flow table information
          could also be embedded in a larger proprietary diagnostic format
          using delimiters as in <a class='info' href='#encapsulation-ext'>Section&nbsp;11.2<span> (</span><span class='info'>Encapsulation of IPFIX Files within Other File Formats</span><span>)</span></a>
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.7"></a><h3>7.3.7.&nbsp;
IPFIX File Manipulation</h3>

<p>For many applications, it may prove useful for implementations to
          provide functionality for the manipulation of IPFIX Files; for
          example, to select data from a File, to change the Templates used
          within a File, or to split or join data in Files. Any such utility
          should take special care to ensure that its output remains a valid
          IPFIX File, specifically with respect to Templates and Options,
          which are scoped to Transport Sessions.
</p>
<p>Any operation which splits one File into multiple Files SHOULD
          write all necessary Templates and Options to each resulting File,
          and ensure that written Options are valid for each resulting File
          (e.g., the Time Window Options Template in <a class='info' href='#ot-time-window'>Section&nbsp;8.1.2<span> (</span><span class='info'>File Time Window Options Template</span><span>)</span></a>). Any operation which joins multiple Files
          into a single File should do the same, additionally ensuring that
          Template IDs do not collide, through the use of different
          Observation Domain IDs or Template ID rewrition. Combining
          operations may also want to ensure any desired ordering of flow
          records is maintained.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
Media type of IPFIX Files</h3>

<p>The media type for IPFIX Files is application/ipfix. The <a class='info' href='#RFC4288'>registration information<span> (</span><span class='info'>Freed, N. and J. Klensin, &ldquo;Media Type Specifications and Registration Procedures,&rdquo; December&nbsp;2005.</span><span>)</span></a> [RFC4288] for this media type is given in the IANA Considerations section.
</p>
<a name="templates-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
File Format Metadata Specification</h3>

<p>This section defines the Options Templates used for IPFIX File
      metadata, and the Information Elements they require.
</p>
<a name="ot-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Recommended Options Templates for IPFIX Files</h3>

<p>The following Options Templates allow IPFIX Message streams to meet
        the requirements outlined above without extension to the message
        format or protocol. They are defined in terms of existing Information
        Elements defined in <a class='info' href='#RFC5102'>[RFC5102]<span> (</span><span class='info'>Quittek, J., Bryant, S., Claise, B., Aitken, P., and J. Meyer, &ldquo;Information Model for IP Flow Information Export,&rdquo; January&nbsp;2008.</span><span>)</span></a>, the Information Elements
        defined in <a class='info' href='#I-D.ietf-ipfix-exporting-type'>"Exporting
        Type Information for IPFIX Information Elements"<span> (</span><span class='info'>Boschi, E., Trammell, B., Mark, L., and T. Zseby, &ldquo;Exporting Type Information for IPFIX Information Elements,&rdquo; June&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;ipfix&#8209;exporting&#8209;type], as well as
        Information Elements defined in <a class='info' href='#ie-section'>Section&nbsp;8.2<span> (</span><span class='info'>Recommended Information Elements for IPFIX Files</span><span>)</span></a>. IPFIX
        File Readers and Writers SHOULD support these Options Templates as
        defined below.
</p>
<p>In addition, IPFIX File Readers and Writers SHOULD support the
        Options Templates defined in <a class='info' href='#I-D.ietf-ipfix-exporting-type'>"Exporting Type Information
        for IPFIX Information Elements"<span> (</span><span class='info'>Boschi, E., Trammell, B., Mark, L., and T. Zseby, &ldquo;Exporting Type Information for IPFIX Information Elements,&rdquo; June&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;ipfix&#8209;exporting&#8209;type] in order to support
        self-description of enterprise-specific Information Elements.
</p>
<a name="ot-checksum"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.1"></a><h3>8.1.1.&nbsp;
Message Checksum Options Template</h3>

<p>The Message Checksum Options Template specifies the structure of
          a Data Record for attaching an MD5 message checksum to an IPFIX
          Message. An MD5 message checksum as described MAY be used if
          data integrity is important to the application. The
          described Data Record MUST appear only once per IPFIX Message, but
          MAY appear anywhere within the Message.
</p>
<p>This Options Template SHOULD contain the following Information
          Elements:
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">IE</th><th align="left">Description</th></tr>
<tr>
<td align="left">messageScope [scope]</td>
<td align="left">A marker denoting this Option applies to the whole IPFIX
            Message; content is ignored. This Information Element MUST be
            defined as a Scope Field.</td>
</tr>
<tr>
<td align="left">messageMD5Checksum</td>
<td align="left">The MD5 checksum of the containing IPFIX Message.</td>
</tr>
</table>
<br clear="all" />

<a name="ot-time-window"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.2"></a><h3>8.1.2.&nbsp;
File Time Window Options Template</h3>

<p>The File Time Window Options Template specifies the structure of
          a Data Record for attaching a time window to an IPFIX File; this
          Data Record is referred to as a time window record. A time window
          record defines the earliest flow start time and the latest flow end
          time of the flow records within a File. One and only one time window
          record MAY appear within an IPFIX File if the time window
          information is available; a File Writer MUST NOT write more than one
          time window record to an IPFIX File. A File Writer that writes a
          time window record to a File MUST NOT write any Flow with a start
          time before the beginning of the window or an end time after the end
          of the window to that File.
</p>
<p>This Options Template SHOULD contain the following Information
          Elements:
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">IE</th><th align="left">Description</th></tr>
<tr>
<td align="left">sessionScope [scope]</td>
<td align="left">A marker denoting this Option applies to the whole IPFIX
            Transport Session (i.e., the IPFIX File in the common case);
            content is ignored. This Information Element MUST be defined as a
            Scope Field.</td>
</tr>
<tr>
<td align="left">minFlowStart*</td>
<td align="left">Exactly one of minFlowStartSeconds, minFlowStartMilliseconds,
            minFlowStartMicroseconds, or minFlowStartNanoseconds; SHOULD match
            the precision of the accompanying maxFlowEnd* Information Element.
            The start time of the earliest flow in the Transport Session
            (i.e., File).</td>
</tr>
<tr>
<td align="left">maxFlowEnd*</td>
<td align="left">Exactly one of maxFlowEndSeconds, maxFlowEndMilliseconds,
            maxFlowEndMicroseconds, or maxFlowEndNanoseconds; SHOULD match the
            precision of the accompanying minFlowStart* Information Element.
            The end time of the latest flow in the Transport Session (i.e.,
            File).</td>
</tr>
</table>
<br clear="all" />

<a name="ot-session-detail"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.3"></a><h3>8.1.3.&nbsp;
Export Session Details Options Template</h3>

<p>The Export Session Details Options Template specifies the
          structure of a Data Record for recording the details of an IPFIX
          Transport Session in an IPFIX File. It is intended for use in
          storing a single complete IPFIX Transport Session in a single IPFIX
          File. The described Data Record SHOULD appear only once in a given
          IPFIX File.
</p>
<p>This Options Template SHOULD contain at least the following
          Information Elements, subject to applicability as noted on each
          Information Element:
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">IE</th><th align="left">Description</th></tr>
<tr>
<td align="left">sessionScope [scope]</td>
<td align="left">A marker denoting this Option applies to the whole IPFIX
            Transport Session (i.e., the IPFIX File in the common case);
            content is ignored. This Information Element MUST be defined as a
            Scope Field.</td>
</tr>
<tr>
<td align="left">exporterIPv4Address</td>
<td align="left">IPv4 address of the IPFIX Exporting Process from which the
            Messages in this Transport Session were received. Present only for
            Exporting Processes with an IPv4 interface. For multi-homed SCTP
            associations, this SHOULD be the primary path endpoint address of
            the Exporting Process.</td>
</tr>
<tr>
<td align="left">exporterIPv6Address</td>
<td align="left">IPv6 address of the IPFIX Exporting Process from which the
            Messages in this Transport Session were received. Present only for
            Exporting Processes with an IPv6 interface. For multi-homed SCTP
            associations, this SHOULD be the primary path endpoint address of
            the Exporting Process.</td>
</tr>
<tr>
<td align="left">exporterTransportPort</td>
<td align="left">The source port from which the Messages in this Transport
            Session were received.</td>
</tr>
<tr>
<td align="left">collectorIPv4Address</td>
<td align="left">IPv4 address of the IPFIX Collecting Process which received the
            Messages in this Transport Session. Present only for Collecting
            Processes with an IPv4 interface. For multi-homed SCTP
            associations, this SHOULD be the primary path endpoint address of
            the Collecting Process.</td>
</tr>
<tr>
<td align="left">collectorIPv6Address</td>
<td align="left">IPv6 address of the IPFIX Collecting Process which received
            the Messages in this Transport Session. Present only for
            Collecting Processes with an IPv6 interface. For multi-homed SCTP
            associations, this SHOULD be the primary path endpoint address of
            the Collecting Process.</td>
</tr>
<tr>
<td align="left">collectorTransportPort</td>
<td align="left">The destination port on which the Messages in this Transport
            Session were received.</td>
</tr>
<tr>
<td align="left">collectorTransportProtocol</td>
<td align="left">The IP Protocol Identifier of the transport protocol used to
            transport Messages within this Transport Session.</td>
</tr>
<tr>
<td align="left">collectorProtocolVersion</td>
<td align="left">The version of the export protocol used to transport Messages
            within this Transport Session. Applicable only in mixed NetFlow
            V9-IPFIX collection environments when storing NetFlow V9 data in
            IPFIX Messages, as in <a class='info' href='#v9-applicability'>Appendix&nbsp;B<span> (</span><span class='info'>Applicability of IPFIX Files to NetFlow V9 flow storage</span><span>)</span></a></td>
</tr>
<tr>
<td align="left">minExportSeconds</td>
<td align="left">The Export Time of the first Message in the Transport
            Session.</td>
</tr>
<tr>
<td align="left">maxExportSeconds</td>
<td align="left">The Export Time of the last Message in the Transport
            Session.</td>
</tr>
</table>
<br clear="all" />

<a name="ot-message-detail"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.4"></a><h3>8.1.4.&nbsp;
Message Details Options Template</h3>

<p>The Message Details Options Template specifies the structure of a
          Data Record for attaching additional export details to an IPFIX
          Message. These details include the time at which a message was
          received and information about the export and collection
          infrastructure used to transport the Message. This Options Template
          also allows the storage of the export session metadata provided the
          Export Session Details Options Template, for storing information
          from multiple Transport Sessions in the same IPFIX File.
</p>
<p>This Options Template SHOULD contain at least the following
          Information Elements, subject to applicability as noted for each
          Information Element. Note that when used in conjunction with the
          Export Session Details Options Template, when storing a single
          complete IPFIX Transport Session in an IPFIX File, this Options
          Template SHOULD contain only the messageScope and
          collectionTimeMilliseconds Information Elements, and the
          exportSctpStreamId Information Element for Messages transported via
          SCTP.
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">IE</th><th align="left">Description</th></tr>
<tr>
<td align="left">messageScope [scope]</td>
<td align="left">A marker denoting this Option applies to the whole IPFIX
            message; content is ignored. This Information Element MUST be
            defined as a Scope Field.</td>
</tr>
<tr>
<td align="left">collectionTimeMilliseconds</td>
<td align="left">The absolute time at which this Message was received by the
            IPFIX Collecting Process.</td>
</tr>
<tr>
<td align="left">exporterIPv4Address</td>
<td align="left">IPv4 address of the IPFIX Exporting Process from which this
            Message was received. Present only for Exporting Processes with an
            IPv4 interface, and if this information is not available via the
            Export Session Details Options Template. For multi-homed SCTP
            associations, this SHOULD be the primary path endpoint address of
            the Exporting Process.</td>
</tr>
<tr>
<td align="left">exporterIPv6Address</td>
<td align="left">IPv6 address of the IPFIX Exporting Process this Message was
            received. Present only for Exporting Processes with an IPv6
            interface, and if this information is not available via the Export
            Session Details Options Template. For multi-homed SCTP
            associations, this SHOULD be the primary path endpoint address of
            the Exporting Process.</td>
</tr>
<tr>
<td align="left">exporterTransportPort</td>
<td align="left">The source port from which this Message received. Present only
            if this information is not available via the Export Session
            Details Options Template.</td>
</tr>
<tr>
<td align="left">collectorIPv4Address</td>
<td align="left">IPv4 address of the IPFIX Collecting Process which received
            this Message. Present only for Collecting Processes with an IPv4
            interface, and if this information is not available via the Export
            Session Details Options Template. For multi-homed SCTP
            associations, this SHOULD be the primary path endpoint address of
            the Collecting Process.</td>
</tr>
<tr>
<td align="left">collectorIPv6Address</td>
<td align="left">IPv6 address of the IPFIX Collecting Process which received
            this Message. Present only for Collecting Processes with an IPv6
            interface, and if this information is not available via the Export
            Session Details Options Template. For multi-homed SCTP
            associations, this SHOULD be the primary path endpoint address of
            the Collecting Process.</td>
</tr>
<tr>
<td align="left">collectorTransportPort</td>
<td align="left">The destination port on which this Message was received.
            Present only if this information is not available via the Export
            Session Details Options Template.</td>
</tr>
<tr>
<td align="left">collectorTransportProtocol</td>
<td align="left">The IP Protocol Identifier of the transport protocol used to
            transport this Message. Present only if this information is not
            available via the Export Session Details Options Template.</td>
</tr>
<tr>
<td align="left">collectorProtocolVersion</td>
<td align="left">The version of the export protocol used to transport this
            Message. Present only if necessary and if this information is not
            available via the Export Session Details Options Template.</td>
</tr>
<tr>
<td align="left">exportSctpStreamId</td>
<td align="left">The SCTP stream used to transport this Message. Present only if
            the Message was transported via SCTP.</td>
</tr>
</table>
<br clear="all" />

<a name="ie-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Recommended Information Elements for IPFIX Files</h3>

<p>The following Information Elements are used by the Options
        Templates in <a class='info' href='#ot-section'>Section&nbsp;8.1<span> (</span><span class='info'>Recommended Options Templates for IPFIX Files</span><span>)</span></a> to allow IPFIX Message
        streams to meet the requirements outlined above without extension of
        the protocol. IPFIX File Readers and Writers SHOULD support these
        Information Elements as defined below.
</p>
<p>In addition, IPFIX File Readers and Writers SHOULD support the
        Information Elements defined in <a class='info' href='#I-D.ietf-ipfix-exporting-type'>"Exporting Type Information
        for IPFIX Information Elements"<span> (</span><span class='info'>Boschi, E., Trammell, B., Mark, L., and T. Zseby, &ldquo;Exporting Type Information for IPFIX Information Elements,&rdquo; June&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;ipfix&#8209;exporting&#8209;type] in order to support
        full self-description of Information Elements.
</p>
<a name="ie-collectionTimeMilliseconds"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.1"></a><h3>8.2.1.&nbsp;
collectionTimeMilliseconds</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The absolute timestamp at which the
           data within the scope containing this Information Element was
           received by a Collecting Process. This Information Element SHOULD
           be bound to its containing IPFIX Message via IPFIX Options and
           the messageScope Information Element, as defined below.
</dd>
<dt>Abstract Data Type: </dt>
<dd>dateTimeMilliseconds
</dd>
<dt>ElementId: </dt>
<dd>TBD1
</dd>
<dt>Status: </dt>
<dd>current
</dd>
</dl></blockquote>
<a name="ie-exportSctpStreamId"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.2"></a><h3>8.2.2.&nbsp;
exportSctpStreamId</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The value of the SCTP Stream Identifier
           used by the Exporting Process for exporting IPFIX Message data.
           This is carried in the Stream Identifier field of the header of the
           SCTP DATA chunk containing the IPFIX Message(s).
</dd>
<dt>Abstract Data Type: </dt>
<dd>unsigned16
</dd>
<dt>Data Type Semantics: </dt>
<dd>identifier
</dd>
<dt>ElementId: </dt>
<dd>TBD2
</dd>
<dt>Status: </dt>
<dd>current
</dd>
</dl></blockquote>
<a name="ie-maxExportSeconds"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.3"></a><h3>8.2.3.&nbsp;
maxExportSeconds</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The absolute Export Time of the latest
            IPFIX Message within the scope containing this Information
            Element. This Information Element SHOULD be bound to its
            containing IPFIX Transport Session via IPFIX Options and the
            sessionScope Information Element.
</dd>
<dt>Abstract Data Type: </dt>
<dd>dateTimeSeconds
</dd>
<dt>ElementId: </dt>
<dd>TBD3
</dd>
<dt>Status: </dt>
<dd>current
</dd>
<dt>Units: </dt>
<dd>seconds
</dd>
</dl></blockquote>
<a name="ie-maxFlowEndMicroseconds"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.4"></a><h3>8.2.4.&nbsp;
maxFlowEndMicroseconds</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The latest absolute timestamp of the
            last packet within any Flow within the scope containing this
            Information Element, rounded up to the microsecond if
            necessary. This Information Element SHOULD be bound to its
            containing IPFIX Transport Session via IPFIX Options and the
            sessionScope Information Element. This Information Element SHOULD
            be used only in Transport Sessions containing Flow Records with
            microsecond-precision (or better) timestamp Information
            Elements.
</dd>
<dt>Abstract Data Type: </dt>
<dd>dateTimeMicroseconds
</dd>
<dt>ElementId: </dt>
<dd>TBD11
</dd>
<dt>Status: </dt>
<dd>current
</dd>
<dt>Units: </dt>
<dd>microseconds
</dd>
</dl></blockquote>
<a name="ie-maxFlowEndMilliseconds"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.5"></a><h3>8.2.5.&nbsp;
maxFlowEndMilliseconds</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The latest absolute timestamp of the
            last packet within any Flow within the scope containing this
            Information Element, rounded up to the millisecond if
            necessary. This Information Element SHOULD be bound to its
            containing IPFIX Transport Session via IPFIX Options and the
            sessionScope Information Element. This Information Element SHOULD
            be used only in Transport Sessions containing Flow Records with
            millisecond-precision (or better) timestamp Information
            Elements.
</dd>
<dt>Abstract Data Type: </dt>
<dd>dateTimeMilliseconds
</dd>
<dt>ElementId: </dt>
<dd>TBD12
</dd>
<dt>Status: </dt>
<dd>current
</dd>
<dt>Units: </dt>
<dd>milliseconds
</dd>
</dl></blockquote>
<a name="ie-maxFlowEndNanoseconds"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.6"></a><h3>8.2.6.&nbsp;
maxFlowEndNanoseconds</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The latest absolute timestamp of the
            last packet within any Flow within the scope containing this
            Information Element. This Information Element SHOULD be bound to
            its containing IPFIX Transport Session via IPFIX Options and the
            sessionScope Information Element. This Information Element SHOULD
            be used only in Transport Sessions containing Flow Records with
            nanosecond-precision timestamp Information Elements.
</dd>
<dt>Abstract Data Type: </dt>
<dd>dateTimeNanoseconds
</dd>
<dt>ElementId: </dt>
<dd>TBD13
</dd>
<dt>Status: </dt>
<dd>current
</dd>
<dt>Units: </dt>
<dd>nanoseconds
</dd>
</dl></blockquote>
<a name="ie-maxFlowEndSeconds"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.7"></a><h3>8.2.7.&nbsp;
maxFlowEndSeconds</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The latest absolute timestamp of the
            last packet within any Flow within the scope containing this
            Information Element, rounded up to the second if necessary.
            This Information Element SHOULD be bound to its containing IPFIX
            Transport Session via IPFIX Options and the sessionScope
            Information Element.
</dd>
<dt>Abstract Data Type: </dt>
<dd>dateTimeSeconds
</dd>
<dt>ElementId: </dt>
<dd>TBD4
</dd>
<dt>Status: </dt>
<dd>current
</dd>
<dt>Units: </dt>
<dd>seconds
</dd>
</dl></blockquote>
<a name="ie-messageMD5Checksum"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.8"></a><h3>8.2.8.&nbsp;
messageMD5Checksum</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The MD5 checksum of the IPFIX Message
            containing this record. This Information Element SHOULD be bound
            to its containing IPFIX Message via an options record and the
            messageScope Information Element, as defined below, and SHOULD
            appear only once in a given IPFIX Message. To calculate the value
            of this Information Element, first buffer the containing IPFIX
            Message, setting the value of this Information Element to all
            zeroes. Then calculate the MD5 checksum of the resulting buffer as
            defined in <a class='info' href='#RFC1321'>[RFC1321]<span> (</span><span class='info'>Rivest, R., &ldquo;The MD5 Message-Digest Algorithm,&rdquo; April&nbsp;1992.</span><span>)</span></a>, place the resulting value in
            this Information Element, and export the buffered message. This
            Information Element is intended as a simple checksum only;
            therefore collision resistance and algorithm agility are not
            required, and MD5 is an appropriate message digest.
</dd>
<dt>Abstract Data Type: </dt>
<dd>octetArray (16 bytes)
</dd>
<dt>ElementId: </dt>
<dd>TBD5
</dd>
<dt>Status: </dt>
<dd>current
</dd>
<dt>Reference: </dt>
<dd>
              <a class='info' href='#RFC1321'>RFC 1321, The MD5 Message-Digest Algorithm<span> (</span><span class='info'>Rivest, R., &ldquo;The MD5 Message-Digest Algorithm,&rdquo; April&nbsp;1992.</span><span>)</span></a> [RFC1321]
            
</dd>
</dl></blockquote>
<a name="ie-messageScope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.9"></a><h3>8.2.9.&nbsp;
messageScope</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The presence of this Information
            Element as scope in an Options Template signifies that the options
            described by the Template apply to the IPFIX Message that contains
            them. It is defined for general purpose message scoping of
            options, and proposed specifically to allow the attachment a
            checksum to a message via IPFIX Options. The value of this
            Information Element MUST be written as 0 by the File Writer or
            Exporting Process. The value of this Information Element MUST be
            ignored by the File Reader or the Collecting Process.
</dd>
<dt>Abstract Data Type: </dt>
<dd>octet
</dd>
<dt>ElementId: </dt>
<dd>TBD6
</dd>
<dt>Status: </dt>
<dd>current
</dd>
</dl></blockquote>
<a name="ie-minExportSeconds"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.10"></a><h3>8.2.10.&nbsp;
minExportSeconds</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The absolute Export Time of the
            earliest IPFIX Message within the scope containing this
            Information Element. This Information Element SHOULD be bound to
            its containing IPFIX Transport Session via an options
            record and the sessionScope Information Element.
</dd>
<dt>Abstract Data Type: </dt>
<dd>dateTimeSeconds
</dd>
<dt>ElementId: </dt>
<dd>TBD7
</dd>
<dt>Status: </dt>
<dd>current
</dd>
<dt>Units: </dt>
<dd>seconds
</dd>
</dl></blockquote>
<a name="ie-minFlowStartMicroseconds"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.11"></a><h3>8.2.11.&nbsp;
minFlowStartMicroseconds</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The earliest absolute timestamp of the
            first packet within any Flow within the scope containing this
            Information Element, rounded down to the microsecond if necessary.
            This Information Element SHOULD be bound to its containing IPFIX
            Transport Session via an options record and the sessionScope
            Information Element. This Information Element SHOULD be used only
            in Transport Sessions containing Flow Records with
            microsecond-precision (or better) timestamp Information
            Elements.
</dd>
<dt>Abstract Data Type: </dt>
<dd>dateTimeMicroseconds
</dd>
<dt>ElementId: </dt>
<dd>TBD14
</dd>
<dt>Status: </dt>
<dd>current
</dd>
<dt>Units: </dt>
<dd>microseconds
</dd>
</dl></blockquote>
<a name="ie-minFlowStartMilliseconds"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.12"></a><h3>8.2.12.&nbsp;
minFlowStartMilliseconds</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The earliest absolute timestamp of the
            first packet within any Flow within the scope containing this
            Information Element, rounded down to the millisecond if necessary.
            This Information Element SHOULD be bound to its containing IPFIX
            Transport Session via an options record and the sessionScope
            Information Element. This Information Element SHOULD be used only
            in Transport Sessions containing Flow Records with
            millisecond-precision (or better) timestamp Information
            Elements.
</dd>
<dt>Abstract Data Type: </dt>
<dd>dateTimeMilliseconds
</dd>
<dt>ElementId: </dt>
<dd>TBD15
</dd>
<dt>Status: </dt>
<dd>current
</dd>
<dt>Units: </dt>
<dd>milliseconds
</dd>
</dl></blockquote>
<a name="ie-minFlowStartNanoseconds"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.13"></a><h3>8.2.13.&nbsp;
minFlowStartNanoseconds</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The earliest absolute timestamp of the
            first packet within any Flow within the scope containing this
            Information Element. This Information Element SHOULD be bound to
            its containing IPFIX Transport Session via an options record and
            the sessionScope Information Element. This Information Element
            SHOULD be used only in Transport Sessions containing Flow Records
            with nanosecond-precision timestamp Information Elements.
</dd>
<dt>Abstract Data Type: </dt>
<dd>dateTimeNanoseconds
</dd>
<dt>ElementId: </dt>
<dd>TBD16
</dd>
<dt>Status: </dt>
<dd>current
</dd>
<dt>Units: </dt>
<dd>nanoseconds
</dd>
</dl></blockquote>
<a name="ie-minFlowStartSeconds"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.14"></a><h3>8.2.14.&nbsp;
minFlowStartSeconds</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The earliest absolute timestamp of the
            first packet within any Flow within the scope containing this
            Information Element, rounded down to the second if necessary. This Information
            Element SHOULD be bound to its containing IPFIX Transport Session
            via an options record and the sessionScope
            Information Element.
</dd>
<dt>Abstract Data Type: </dt>
<dd>dateTimeSeconds
</dd>
<dt>ElementId: </dt>
<dd>TBD8
</dd>
<dt>Status: </dt>
<dd>current
</dd>
<dt>Units: </dt>
<dd>seconds
</dd>
</dl></blockquote>
<a name="ie-opaqueOctets"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.15"></a><h3>8.2.15.&nbsp;
opaqueOctets</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>This Information Element is used to
            encapsulate non-IPFIX data into an IPFIX Message stream, for the
            purpose of allowing a non-IPFIX data processor to store a data
            stream inline within an IPFIX File. A Collecting Process or File
            Writer MUST NOT try to interpret this binary data. This
            Information Element differs from paddingOctets as its contents are
            meaningful in some non-IPFIX context, while the contents of
            paddingOctets MUST be 0x00 and are intended only for Information
            Element alignment.
</dd>
<dt>Abstract Data Type: </dt>
<dd>octet
</dd>
<dt>ElementId: </dt>
<dd>TBD9
</dd>
<dt>Status: </dt>
<dd>current
</dd>
</dl></blockquote>
<a name="ie-sessionScope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.16"></a><h3>8.2.16.&nbsp;
sessionScope</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>The presence of this Information
            Element as scope in an Options Template signifies that the options
            described by the Template apply to the IPFIX Transport Session
            that contains them. Note that as all options are implicitly scoped
            to Transport Session and Observation Domain, this Information
            Element is equivalent to a "null" scope. It is defined for general
            purpose session scoping of options, and proposed specifically to
            allow the attachment of time window to an IPFIX File via IPFIX
            Options. The value of this Information Element MUST be written as
            0 by the File Writer or Exporting Process. The value of this
            Information Element MUST be ignored by the File Reader or the
            Collecting Process.
</dd>
<dt>Abstract Data Type: </dt>
<dd>octet
</dd>
<dt>ElementId: </dt>
<dd>TBD10
</dd>
<dt>Status: </dt>
<dd>current
</dd>
</dl></blockquote>
<a name="encryption-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Encryption of IPFIX Files</h3>

<p>Network traffic measurement data of the kind the IPFIX File format is
      designed to store is often considered sensitive, for privacy or business
      reasons. Therefore, IPFIX File Writers and File Readers SHOULD provide
      for the ability to guarantee the integrity and confidentiality of stored
      information; this section specifies a method via encapsulation in
      CMS.
</p>
<a name="encryption-cms"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
Encapsulation within the Cryptographic Message Syntax</h3>

<p><a class='info' href='#RFC3852'>The Cryptographic Message Syntax
        (CMS)<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; July&nbsp;2004.</span><span>)</span></a> [RFC3852] defines an encapsulation syntax for data protection, used
        to digitally sign, authenticate, or encrypt arbitrary message content.
        It is used as the basis of <a class='info' href='#RFC3851'>S/MIME<span> (</span><span class='info'>Ramsdell, B., &ldquo;Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.1 Message Specification,&rdquo; July&nbsp;2004.</span><span>)</span></a> [RFC3851]. It is
        well-suited to the problem of encrypting IPFIX Files, and as such,
        File Writers and File Readers SHOULD support CMS as described within
        this section.
</p>
<p>IPFIX File Writers and File Readers supporting CMS encapsulation
        MUST support the protection of entire IPFIX Files by two methods:
        (1) signing only, and (2) signing and enveloping,. Contents MAY be
        compressed using one of the supported compression formats described
        below in <a class='info' href='#compression-section'>Section&nbsp;10<span> (</span><span class='info'>Compression of IPFIX Files</span><span>)</span></a> before protection. Other
        CMS object types and encapsulation arrangements MAY be supported by
        IPFIX File Writers and IPFIX File Readers, but File Writers SHOULD use
        one of the two supported protection schemes below when
        interoperability is important.
</p>
<p>(1) Signing is accomplished by encapsulating the cleartext IPFIX
        File within a CMS object of type SignedData, and wrapping the result
        in a CMS ContentInfo object. Signing provides authentication of the
        File Writer and message integrity protection, but not
        confidentiality.
</p>
<p>(2) Enveloping and signing is accomplished by encapsulating the
        cleartext IPFIX File within a CMS object of type EnvelopedData,
        encapsulating the result within a CMS object of type SignedData as for
        signing, then wrapping the result in a CMS ContentInfo object.
        Enveloping and signing provides authentication of the File Writer,
        message integrity protection, and confidentiality, and allows
        authentication and message integrity checks without the possession of
        a decryption key.
</p>
<p>The EnvelopedData CMS data type has one or more recipients;
        recipient information is generally used to protect content encryption
        keys with a known public key of each recipient. The File Reader must
        therefore have access to a corresponding private key of one of the
        recipients in order to decrypt the content. In contexts where an IPFIX
        File has one or more "natural" recipients, e.g. it is being treated as
        a document for the use of an individual or group, the keys of those
        recipients should be used. In other contexts (e.g., archival storage),
        it is RECOMMENDED that the recipient(s) of the IPFIX File be one or
        more "role" recipient(s), each created for the purpose of providing
        access to one or more Files, and that the private keys for the role
        recipients be distributed to individuals as necessary. This key
        distribution mechanism and the policies governing it are out of scope
        for this document.
</p>
<p>File Readers and Writers MUST support SHA-1 for digests
        (DigestAlgorithmIdentifier), DSA with SHA-1 and RSA for signatures
        (SignatureAlgorithmIdentifier), RSA for key encryption
        (KeyEncryptionAlgorithmIdentifier), and AES-128, AES-192, and AES-256
        for content encryption (ContentEncryptionAlgorithmIdentifier). Other
        algorithms MAY be supported. As cryptographic algorithms and attacks
        against them continue to progress, implementors and administrators are
        recommended to pay attention to statements on recommended
        cryptographic algorithms (e.g., the SHA-1 hash function) published
        from time to time by various sources, including the IETF, to ensure
        the availability of adequate protection; see also <a class='info' href='#security-stength'>Section&nbsp;12.3<span> (</span><span class='info'>Recommendations for Strength of Cryptography for IPFIX Files</span><span>)</span></a> of this document. Specifically, algorithm
        recommendations given in any document updating or obsoleting <a class='info' href='#RFC3851'>[RFC3851]<span> (</span><span class='info'>Ramsdell, B., &ldquo;Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.1 Message Specification,&rdquo; July&nbsp;2004.</span><span>)</span></a> should be taken to apply to IPFIX Files as
        well.
</p>
<a name="encryption-errors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
Encryption Error Resilience</h3>

<p>File-level encryption has error resilience issues similar to
         file-level compression. Single bit errors in the encrypted data
         stream can result in larger errors in the decrypted stream, depending
         on the encryption scheme used. 
</p>
<p>In applications (e.g. archival storage) in which error resilience
         is very important, File Writers SHOULD use an encryption scheme which
         can resynchronize after bit errors. An common example is a block
         cipher in CBC (Cipher Block Chaining) mode. In this case, File
         Writers MAY also use the Message Checksum Options Template to
         attach a checksum to each IPFIX Message in the IPFIX File, in order
         to support the recognition of errors in the decrypted data.
</p>
<a name="compression-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Compression of IPFIX Files</h3>

<p>Network traffic measurement data is also generally highly
      compressible. IPFIX Templates tend to increase the information content
      per record by not requiring the export of irrelevant or non-present
      fields in records, and the technique described in <a class='info' href='#RFC5473'>[RFC5473]<span> (</span><span class='info'>Boschi, E., Mark, L., and B. Claise, &ldquo;Reducing Redundancy in IP Flow Information Export (IPFIX) and Packet Sampling (PSAMP) Reports,&rdquo; March&nbsp;2009.</span><span>)</span></a> also reduces the export of redundant information.
      However, even with these techniques, generalized compression can
      decrease storage requirements significantly; therefore, IPFIX File
      Writers and File Readers SHOULD support compression as described in this
      section.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1"></a><h3>10.1.&nbsp;
Supported Compression Formats</h3>

<p>IPFIX files support two compression encapsulation formats: <a class='info' href='#bzip2'>bzip2<span> (</span><span class='info'>Seward, J., &ldquo;bzip2 (http://www.bzip.org/),&rdquo; March&nbsp;2008.</span><span>)</span></a> [bzip2] and <a class='info' href='#RFC1952'>gzip<span> (</span><span class='info'>Deutsch, P., Gailly, J-L., Adler, M., Deutsch, L., and G. Randers-Pehrson, &ldquo;GZIP file format specification version 4.3,&rdquo; May&nbsp;1996.</span><span>)</span></a> [RFC1952].
        bzip2 provides better compression than gzip and, as a block
        compression algorithm, better error recovery characteristics, at the
        expense of slower compression. gzip is potentially a better choice
        when compression time is an issue. These two algorithms and
        encapsulation formats were chosen for ubiquity and ease of
        implementation.
</p>
<p>IPFIX File Readers and Writers supporting compression MUST support
        bzip2, and SHOULD support gzip.
</p>
<a name="compression-magic"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2"></a><h3>10.2.&nbsp;
Compression Recognition at the File Reader</h3>

<p>bzip2, gzip, and uncompressed IPFIX Files have distinct magic
        numbers. IPFIX File Readers SHOULD use these magic numbers to
        determine what compression, if any, is in use for an IPFIX File, and
        invoke the proper decompression. bzip2 files are identified by the
        initial three-octet string 0x42, 0x5A, 0x68 ("BZh"). gzip files are
        identified by the initial two-octet string 0x1F, 0x8B. IPFIX Files are
        identified by the initial two-octet string 0x00, 0x0A; these are the
        version bytes of the first IPFIX Message header in the File.
</p>
<a name="compression-errors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.3"></a><h3>10.3.&nbsp;
Compression Error Resilience</h3>

<p>Note that, since any file may be compressed and
        decompressed with a variety of widely available tools
        implementing a variety of compression standards (both
        specified and de facto), compression of IPFIX File data can be
        accomplished externally. However, compression at the file
        level is not particularly resilient to errors; in the worst
        case, a single bit error in a stream-compressed file may
        result in the loss of the entire file.
</p>
<p>Since block compression algorithms that support the identification
        and isolation of blocks containing errors limit the impact of errors
        on the recoverability of compressed data, the use of bzip2 in
        applications where error resilience is important is RECOMMENDED.
</p>
<p>Since the block boundary of a block-compressed IPFIX File
        may fall in the middle of an IPFIX Message, resynchronization
        of an IPFIX Message stream by a File Reader after a
        compression error requires some care. The beginning of an
        IPFIX Message may be identified by its header signature (the
        Version field of the Message Header, 0x00 0x0A, followed by a
        16-bit Message Length), but simply searching for the first
        occurance of the Version field is insufficient, since these
        two bytes may occur in valid IPFIX Template or Data Sets.
</p>
<p>Therefore, we specify the following algorithm for File
        Readers to resynchronize an IPFIX Message Stream after
        skipping a compressed block containing errors:
</p>
<ol class="text">
<li>Search after the error for the first occurrence of the octet
          string 0x00, 0x0A (the IPFIX Message Header Version field.)
</li>
<li>Treat this field as the beginning of a candidate IPFIX Message.
          Read the two bytes following the Version field as a Message Length,
          and seek to that offset from the beginning of the candidate IPFIX
          Message.
</li>
<li>If the first two octets after the candidate IPFIX Message are
          0x00, 0x0A (i.e., the IPFIX Message Header Version field of the next
          message in the stream), or if end-of-file is reached precisely at
          the end of the candidate IPFIX Message, presume that the candidate
          IPFIX Message is valid, and begin reading the IPFIX File from the
          start of the candidate IPFIX Message.
</li>
<li>If not, or if the seek reaches end-of-file or another block
          containing errors before finding the end of the candidate message,
          go back to step 1, starting the search two bytes from the start of
          the candidate IPFIX Message.
</li>
</ol>
<p>The algorithm above will improperly identify a non-message
        as a message approximately 1 in 2^32 times, assuming random
        IPFIX data. It may be expanded to consider multiple candidate
        IPFIX Messages in order to increase reliability.
</p>
<p>In applications (e.g. archival storage) in which error
        resilience is very important, File Writers SHOULD use block
        compression algorithms, and MAY attempt to align IPFIX
        Messages within compression blocks to ease resynchronization
        after errors, if such is supported by the chosen block
        compressor. File Readers SHOULD use the resynchronization
        algorithm above to minimize data loss due to compression
        errors.
</p>
<a name="integration-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Recommended File Integration Strategies</h3>

<p>This section describes methods for integrating IPFIX File data with
      other file formats.
</p>
<a name="encapsulation-int"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1"></a><h3>11.1.&nbsp;
Encapsulation of Non-IPFIX Data in IPFIX Files</h3>

<p>At times it may be useful to export or store non-IPFIX data inline
        in an IPFIX File or Message stream. To do this cleanly, this data must
        be encapsulated into IPFIX Messages so that an IPFIX File Reader or
        Collecting Process can handle it without any need to interpret it. At
        the same time, this data must not be changed during transmission or
        storage. The opaqueOctets Information Element as defined in <a class='info' href='#ie-opaqueOctets'>Section&nbsp;8.2.15<span> (</span><span class='info'>opaqueOctets</span><span>)</span></a> is provided for this encapsulation.
</p>
<p>Processing the encapsulated non-IPFIX data is left to a separate
        processing mechanisms that can identify encapsulated non-IPFIX data in
        an IPFIX message stream, but need not have any other IPFIX handling
        capability, except the ability to skip over all IPFIX messages that do
        not encapsulate non-IPFIX data.
</p>
<p>The Message Checksum Options Template, described in <a class='info' href='#ot-checksum'>Section&nbsp;8.1.1<span> (</span><span class='info'>Message Checksum Options Template</span><span>)</span></a> may be used as a uniform mechanism to identify
        errors within encapsulated data.
</p>
<p>Note that this mechanism can only encapsulate data objects up to
        65,515 octets in length. If the space available in one IPFIX Message
        is not enough for the amount of data to be encapsulated, then the data
        must be broken into smaller segments that are encapsulated into
        consecutive IPFIX Messages. Any additional structuring or semantics of
        the raw data is outside the scope of IPFIX and must be implemented
        within the encapsulated binary data itself. Furthermore, the raw
        encapsulated data cannot be assumed by an IPFIX File Reader to have
        any specific format.
</p>
<a name="encapsulation-ext"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2"></a><h3>11.2.&nbsp;
Encapsulation of IPFIX Files within Other File Formats</h3>

<p>Consequently, it may also be useful to reverse the encapsulation,
        that is, to export or store IPFIX data inline within a non-IPFIX file
        or data stream. This makes sense when the other file format is not
        compatible with the encapsulation described above in <a class='info' href='#encapsulation-int'>Section&nbsp;11.1<span> (</span><span class='info'>Encapsulation of Non-IPFIX Data in IPFIX Files</span><span>)</span></a>. Generally speaking, the encapsulation
        here will be specific to the format of the containing file. For
        example, IPFIX Files may be embedded in XML elements using hex or
        Base64 encoding, or in raw binary files using start and end delimiters
        or some form of run-length encoding. As there are as many potential
        encapsulations here as there are potential file formats, the specifics
        of each are out of scope for this specification.
</p>
<a name="security-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Security Considerations</h3>

<p>The security considerations section of <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>, on
      which the IPFIX File format is based, is largely concerned with the
      proper application of TLS and DTLS to ensure confidentiality and
      integrity when exporting IPFIX Messages. By analogy, this document
      specifies the use of <a class='info' href='#RFC3852'>CMS<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; July&nbsp;2004.</span><span>)</span></a> [RFC3852] to provide
      equivalent security to TLS and DTLS by encapsulation in <a class='info' href='#encryption-cms'>Section&nbsp;9.1<span> (</span><span class='info'>Encapsulation within the Cryptographic Message Syntax</span><span>)</span></a>. However, aside from merely applying CMS,
      there are several security issues which much be considered in certain
      circumstances; these are covered in the subsections below.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
Relationship between IPFIX File and Transport Encryption</h3>

<p>The underlying protocol used to exchange the information that will
        be stored using the format proposed in this document must as well
        apply appropriate procedures to guarantee the integrity and
        confidentiality of the exported information. Such issues are addressed
        in <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>. Specifically, IPFIX Files which store
        data taken from an IPFIX Collecting Process using TLS or DTLS for
        transport security SHOULD be encrypted as in <a class='info' href='#encryption-cms'>Section&nbsp;9.1<span> (</span><span class='info'>Encapsulation within the Cryptographic Message Syntax</span><span>)</span></a>; storage of such flow data in unencrypted
        IPFIX Files may present a potential breach of confidentiality.
        Conversely, flow data considered sensitive enough to require
        encryption in storage that is later transmitted using IPFIX SHOULD be
        transmitted using TLS or DTLS for transport security.
</p>
<a name="security-trust-chain"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
End-to-End Assertions for IPFIX Files</h3>

<p>Note that while both TLS and CMS provide the ability to sign an
        IPFIX Transport Session or an IPFIX File, there exists no method for
        protecting data integrity end-to-end in the case in which a Collecting
        Process is collocated with a File Writer. The channel between the
        Exporting Process to Collecting Process using IPFIX is signed by the
        Exporting Process key and protected via TLS and DTLS, while the File
        is signed by the File Writer key and protected via CMS. The identity
        of the Exporting Process is not asserted in the file, and the records
        may be modified between the Collecting Process and the File
        Writer.
</p>
<p>There are two potential ways to address this issue. The first is by
        fiat, and is appropriate only when the application allows the
        Collecting Process to File Writer channel to be trusted. Simply put,
        in this circumstance, the File Writer's signature is an implicit
        assertion that the channel to the Exporting Process was protected,
        that the Exporting Process's signature was verified, and that the data
        was not changed after collection. For this to work, a File Writer
        collocated with a Collecting Process SHOULD NOT sign a File as
        specified in <a class='info' href='#encryption-cms'>Section&nbsp;9.1<span> (</span><span class='info'>Encapsulation within the Cryptographic Message Syntax</span><span>)</span></a> unless the Transport
        Session over which the data was exported was protected via TLS or
        DTLS, and the Collecting Process positively identified the Exporting
        Process by its certificate.
</p>
<p>In situations in which the Collecting Process and/or File Writer
        cannot be trusted, end-to-end integrity can then be approximated by
        collocating the File Writer with the Metering Process, and removing
        the IPFIX Protocol completely from the chain. In this case, the File
        Writer's signature is an implicit assertion that the Metering Process
        is identified and is not tampering with the information as observed on
        the wire.
</p>
<p>Verification of these trust relationships is out of scope for this
        document, and should be considered on a per-implementation basis.
</p>
<a name="security-stength"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3"></a><h3>12.3.&nbsp;
Recommendations for Strength of Cryptography for IPFIX Files</h3>

<p>Note that when encrypting files for archival storage, the
        cryptographic strength is dependent on the length of time over which
        archival data is expected to be kept. Long term storage may require
        re-application of cryptographic protection, periodically resigning and
        reencrypting files with stronger keys. In this case, it is recommended
        that the existing signed and/or encypted data be encapsulated within
        newer, stronger protection. See <a class='info' href='#RFC4810'>[RFC4810]<span> (</span><span class='info'>Wallace, C., Pordesch, U., and R. Brandner, &ldquo;Long-Term Archive Service Requirements,&rdquo; March&nbsp;2007.</span><span>)</span></a> for a
        discussion of this issue.
</p>
<a name="iana-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
IANA Considerations</h3>

<p>This document specifies the creation of several new IPFIX Information
      Elements in the IPFIX Information Element registry located at
      http://www.iana.org/assignments/ipfix, as defined in <a class='info' href='#ie-section'>Section&nbsp;8.2<span> (</span><span class='info'>Recommended Information Elements for IPFIX Files</span><span>)</span></a> above. IANA has assigned the following
      Information Element numbers for their respective Information Elements as
      specified below:
</p>
<ul class="text">
<li>Information Element number TBD1 for the 
        collectionTimeMilliseconds Information Element.
</li>
<li>Information Element number TBD2 for the exportSctpStreamId
        Information Element.
</li>
<li>Information Element number TBD3 for the maxExportSeconds
        Information Element.
</li>
<li>Information Element number TBD11 for the maxFlowEndMicroseconds
        Information Element.
</li>
<li>Information Element number TBD12 for the maxFlowEndMilliseconds
        Information Element.
</li>
<li>Information Element number TBD13 for the maxFlowEndNanoseconds
        Information Element.
</li>
<li>Information Element number TBD4 for the maxFlowEndSeconds
        Information Element.
</li>
<li>Information Element number TBD5 for the messageMD5Checksum
        Information Element.
</li>
<li>Information Element number TBD6 for the messageScope
        Information Element.
</li>
<li>Information Element number TBD7 for the minExportSeconds
        Information Element.
</li>
<li>Information Element number TBD14 for the minFlowStartMicroseconds
        Information Element.
</li>
<li>Information Element number TBD15 for the minFlowStartMilliseconds
        Information Element.
</li>
<li>Information Element number TBD16 for the minFlowStartNanoseconds
        Information Element.
</li>
<li>Information Element number TBD8 for the minFlowStartSeconds
        Information Element.
</li>
<li>Information Element number TBD9 for the opaqueOctets
        Information Element.
</li>
<li>Information Element number TBD10 for the sessionScope
        Information Element.
</li>
</ul>
<p>[NOTE for IANA: The text TBDn should be replaced
      with the respective assigned Information Element numbers where they
      appear in this document.]
</p>
<p>IANA has created the media type application/ipfix for IPFIX data, as described by the following registration information:
</p>
<blockquote class="text"><dl>
<dt>Type name: </dt>
<dd>application
</dd>
<dt>Subtype name: </dt>
<dd>ipfix
</dd>
<dt>Required parameters: </dt>
<dd>none
</dd>
<dt>Optional parameters: </dt>
<dd>none
</dd>
<dt>Encoding considerations: </dt>
<dd>IPFIX files are binary, and therefore must be encoded in non-binary contexts.
</dd>
<dt>Security considerations: </dt>
<dd>See the Security Considerations section (<a class='info' href='#security-section'>Section&nbsp;12<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>) of this document, and the Security Considerations section of <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>.
</dd>
<dt>Interoperability considerations: </dt>
<dd>See the Detailed Specification section (<a class='info' href='#detail-section'>Section&nbsp;7<span> (</span><span class='info'>Detailed File Format Specification</span><span>)</span></a>) of this document. The format is designed to be broadly interoperable, as any valid stream of IPFIX Messages over any transport specified in <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a> MUST be recognizable as a valid IPFIX File.
</dd>
<dt>Published specification: </dt>
<dd>This document, especially <a class='info' href='#detail-section'>Section&nbsp;7<span> (</span><span class='info'>Detailed File Format Specification</span><span>)</span></a>, and <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>.
</dd>
<dt>Applications that use this media type: </dt>
<dd>Various IPFIX implementations (see <a class='info' href='#RFC5153'>[RFC5153]<span> (</span><span class='info'>Boschi, E., Mark, L., Quittek, J., Stiemerling, M., and P. Aitken, &ldquo;IP Flow Information Export (IPFIX) Implementation Guidelines,&rdquo; April&nbsp;2008.</span><span>)</span></a>) support the construction of IPFIX File Readers and Writers.
</dd>
<dt>Additional information: </dt>
<dd>none
</dd>
<dt>Magic number(s): </dt>
<dd>None, although the first two bytes of any IPFIX file are the first two bytes of a message header, the Version field, which as of <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a> are always 10 in network byte order: 0x00, 0x0A.
</dd>
<dt>File extension(s): </dt>
<dd>none
</dd>
<dt>Macintosh file type code(s): </dt>
<dd>none
</dd>
<dt>For further information: </dt>
<dd>Authors of this document, IETF IPFIX Working Group
</dd>
<dt>Intended usage: </dt>
<dd>LIMITED USE
</dd>
<dt>Restrictions on usage: </dt>
<dd>none
</dd>
<dt>Change controller: </dt>
<dd>Authors of this document, IETF IPFIX Working Group
</dd>
</dl></blockquote>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
Acknowledgements</h3>

<p>Thanks to Maurizio Molina, Tom Kosnar, and Andreas Kind for technical
      assistance with the requirements for a standard flow storage format.
      Thanks to Benoit Claise, Paul Aitken, Andrew Johnson, and Gerhard Muenz
      for their reviews and feedback.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15"></a><h3>15.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>15.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC5101">[RFC5101]</a></td>
<td class="author-text">Claise, B., &ldquo;<a href="http://tools.ietf.org/html/rfc5101">Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information</a>,&rdquo; RFC&nbsp;5101, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5101.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5102">[RFC5102]</a></td>
<td class="author-text">Quittek, J., Bryant, S., Claise, B., Aitken, P., and J. Meyer, &ldquo;<a href="http://tools.ietf.org/html/rfc5102">Information Model for IP Flow Information Export</a>,&rdquo; RFC&nbsp;5102, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5102.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-ipfix-exporting-type">[I-D.ietf-ipfix-exporting-type]</a></td>
<td class="author-text">Boschi, E., Trammell, B., Mark, L., and T. Zseby, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-ipfix-exporting-type-05.txt">Exporting Type Information for IPFIX Information Elements</a>,&rdquo; draft-ietf-ipfix-exporting-type-05 (work in progress), June&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-ipfix-exporting-type-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1321">[RFC1321]</a></td>
<td class="author-text"><a href="mailto:rivest@theory.lcs.mit.edu">Rivest, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1321">The MD5 Message-Digest Algorithm</a>,&rdquo; RFC&nbsp;1321, April&nbsp;1992 (<a href="http://www.rfc-editor.org/rfc/rfc1321.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1952">[RFC1952]</a></td>
<td class="author-text"><a href="mailto:ghost@aladdin.com">Deutsch, P.</a>, <a href="mailto:gzip@prep.ai.mit.edu">Gailly, J-L.</a>, <a href="mailto:madler@alumni.caltech.edu">Adler, M.</a>, <a href="mailto:ghost@aladdin.com">Deutsch, L.</a>, and <a href="mailto:randeg@alumni.rpi.edu">G. Randers-Pehrson</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1952">GZIP file format specification version 4.3</a>,&rdquo; RFC&nbsp;1952, May&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc1952.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc1952.ps">PS</a>, <a href="http://www.rfc-editor.org/rfc/rfc1952.pdf">PDF</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3852">[RFC3852]</a></td>
<td class="author-text">Housley, R., &ldquo;<a href="http://tools.ietf.org/html/rfc3852">Cryptographic Message Syntax (CMS)</a>,&rdquo; RFC&nbsp;3852, July&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3852.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4810">[RFC4810]</a></td>
<td class="author-text">Wallace, C., Pordesch, U., and R. Brandner, &ldquo;<a href="http://tools.ietf.org/html/rfc4810">Long-Term Archive Service Requirements</a>,&rdquo; RFC&nbsp;4810, March&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4810.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="bzip2">[bzip2]</a></td>
<td class="author-text">Seward, J., &ldquo;bzip2 (http://www.bzip.org/),&rdquo; March&nbsp;2008.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>15.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3917">[RFC3917]</a></td>
<td class="author-text">Quittek, J., Zseby, T., Claise, B., and S. Zander, &ldquo;<a href="http://tools.ietf.org/html/rfc3917">Requirements for IP Flow Information Export (IPFIX)</a>,&rdquo; RFC&nbsp;3917, October&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3917.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3954">[RFC3954]</a></td>
<td class="author-text">Claise, B., &ldquo;<a href="http://tools.ietf.org/html/rfc3954">Cisco Systems NetFlow Services Export Version 9</a>,&rdquo; RFC&nbsp;3954, October&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3954.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5153">[RFC5153]</a></td>
<td class="author-text">Boschi, E., Mark, L., Quittek, J., Stiemerling, M., and P. Aitken, &ldquo;<a href="http://tools.ietf.org/html/rfc5153">IP Flow Information Export (IPFIX) Implementation Guidelines</a>,&rdquo; RFC&nbsp;5153, April&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5153.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5470">[RFC5470]</a></td>
<td class="author-text">Sadasivan, G., Brownlee, N., Claise, B., and J. Quittek, &ldquo;<a href="http://tools.ietf.org/html/rfc5470">Architecture for IP Flow Information Export</a>,&rdquo; RFC&nbsp;5470, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5470.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5471">[RFC5471]</a></td>
<td class="author-text">Schmoll, C., Aitken, P., and B. Claise, &ldquo;<a href="http://tools.ietf.org/html/rfc5471">Guidelines for IP Flow Information Export (IPFIX) Testing</a>,&rdquo; RFC&nbsp;5471, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5471.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5472">[RFC5472]</a></td>
<td class="author-text">Zseby, T., Boschi, E., Brownlee, N., and B. Claise, &ldquo;<a href="http://tools.ietf.org/html/rfc5472">IP Flow Information Export (IPFIX) Applicability</a>,&rdquo; RFC&nbsp;5472, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5472.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5473">[RFC5473]</a></td>
<td class="author-text">Boschi, E., Mark, L., and B. Claise, &ldquo;<a href="http://tools.ietf.org/html/rfc5473">Reducing Redundancy in IP Flow Information Export (IPFIX) and Packet Sampling (PSAMP) Reports</a>,&rdquo; RFC&nbsp;5473, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5473.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SAINT2007">[SAINT2007]</a></td>
<td class="author-text">Trammell, B., Boschi, E., Mark, L., and T. Zseby, &ldquo;Requirements for a standardized flow storage solution,&rdquo; &nbsp;in Proceedings of the SAINT 2007 workshop on Internet Measurement Technology, Hiroshima, Japan, January&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4288">[RFC4288]</a></td>
<td class="author-text">Freed, N. and J. Klensin, &ldquo;<a href="http://tools.ietf.org/html/rfc4288">Media Type Specifications and Registration Procedures</a>,&rdquo; BCP&nbsp;13, RFC&nbsp;4288, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4288.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3851">[RFC3851]</a></td>
<td class="author-text">Ramsdell, B., &ldquo;<a href="http://tools.ietf.org/html/rfc3851">Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.1 Message Specification</a>,&rdquo; RFC&nbsp;3851, July&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3851.txt">TXT</a>).</td></tr>
</table>

<a name="examples-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Example IPFIX File</h3>

<p>In this section we will explore an example IPFIX File which
      demonstrates the various features of the IPFIX File format. This File
      contains flow records described by a single Template. This File also
      contains a File Time Window record to note the start and end time of the
      data, and an Export Session Details record to record collection
      infrastructure information. Each Message within this File also contains
      a Message Checksum record, as this File may be externally encrypted
      and/or stored as an archive. The structure of this File is shown in
      <a class='info' href='#ex-structure'>Figure&nbsp;2<span> (</span><span class='info'>File Example Structure</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="ex-structure"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
          +=================================================+
          | IPFIX Message                       seq. 0      |
          | +---------------------------------------------+ |
          | | Template Set (id 2)                  1 rec  | |
          | |   Data Tmpl. id 256                         | |
          | +---------------------------------------------+ |
          | | Options Template Set (id 3)          3 recs | |
          | |   File Time Window Opt. Tmpl. id 257        | |
          | |   Message Checksum Opt. Tmpl. id 259        | |
          | |   Export Session Details Opt. Tmpl. id 258  | |
          | +---------------------------------------------+ |
          | | Data Set (id 259) [Message Checksum] 1 rec  | |
          | +---------------------------------------------+ |
          +=================================================+
          | IPFIX Message                       seq. 1      |
          | +---------------------------------------------+ |
          | | Data Set (id 257) [File Time Window] 1 rec  | |
          | +---------------------------------------------+ |
          | | Data Set (id 258) [Export Session]   1 rec  | |
          | +---------------------------------------------+ |
          | | Data Set (id 259) [Message Checksum] 1 rec  | |
          | +---------------------------------------------+ |
          +=================================================+
          | IPFIX Message                       seq. 4      |
          | +---------------------------------------------+ |
          | | Data Set (id 256)                   50 recs | |
          | |  contains flow data                         | |
          | +---------------------------------------------+ |
          | | Data Set (id 259) [Message Checksum] 1 rec  | |
          | +---------------------------------------------+ |
          +=================================================+
          | IPFIX Message                       seq. 55     |
          |                    . . .                        |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: File Example Structure&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The Template describing the data records contains a flow start
      timestamp, an IPv4 5-tuple, and packet and octet total counts. The
      Template Set defining this is as shown in <a class='info' href='#ex-data-template'>Figure&nbsp;3<span> (</span><span class='info'>File Example Data Template</span><span>)</span></a> below:
</p><br /><hr class="insert" />
<a name="ex-data-template"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Set ID = 2           |          Length =  40         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      Template ID = 256        |        Field Count = 8        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0| flowStartSeconds      = 150 |       Field Length =  4       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0| sourceIPv4Address     =   8 |       Field Length =  4       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0| dest.IPv4Address      =  12 |       Field Length =  4       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0| sourceTransportPort   =   7 |       Field Length =  2       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0| dest.TransportPort    =  11 |       Field Length =  2       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0| protocolIdentifier    =   4 |       Field Length =  1       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0| octetTotalCount       =  85 |       Field Length =  4       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0| packetTotalCount      =  86 |       Field Length =  4       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: File Example Data Template&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Example Options Templates</h3>

<p>This is followed by an Options Template Set containing the Options
        Templates required to read the File: the File Time Window Options
        Template defined in <a class='info' href='#ot-time-window'>Section&nbsp;8.1.2<span> (</span><span class='info'>File Time Window Options Template</span><span>)</span></a> above, the Export
        Session Details Options Template defined in <a class='info' href='#ot-session-detail'>Section&nbsp;8.1.3<span> (</span><span class='info'>Export Session Details Options Template</span><span>)</span></a> above, and the Message Checksum Options
        Template defined in <a class='info' href='#ot-checksum'>Section&nbsp;8.1.1<span> (</span><span class='info'>Message Checksum Options Template</span><span>)</span></a> above. This Options
        Template Set is shown in <a class='info' href='#ex-opt-template-1'>Figure&nbsp;4<span> (</span><span class='info'>File Example Options Templates (Time Window and Checksum)</span><span>)</span></a> and <a class='info' href='#ex-opt-template-2'>Figure&nbsp;5<span> (</span><span class='info'>File Example Options Templates, Continued (Session Details)</span><span>)</span></a> below:
</p><br /><hr class="insert" />
<a name="ex-opt-template-1"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Set ID = 3           |          Length =  80         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      Template ID = 257        |        Field Count = 3        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Scope Field Count = 1      |0| sessionScope        = TBD10 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Field Length =  1       |0| minFlowStartSeconds  = TBD8 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Field Length =  4       |0| maxFlowEndSeconds    = TBD4 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Field Length = 4        |      Template ID = 259        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Field Count = 2         |    Scope Field Count = 1      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0| messageScope         = TBD6 |       Field Length =  1       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0| messageMD5Checksum   = TBD5 |       Field Length = 16       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: File Example Options Templates (Time Window and Checksum)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="ex-opt-template-2"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Template ID = 258       |         Field Count = 9       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Scope Field Count = 1      |0| sessionScope        = TBD10 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Field Length =  1       |0| exporterIPv4Address   = 130 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Field Length =  4       |0| collectorIPv4Address  = 211 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Field Length =  4       |0| exporterTransportPort = 217 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Field Length =  2       |0| col.TransportPort     = 216 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Field Length =  2       |0| col.TransportProtocol = 215 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Field Length =  1       |0| col.ProtocolVersion   = 214 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Field Length =  1       |0| minExportSeconds     = TBD7 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Field Length =  4       |0| maxExportSeconds     = TBD3 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Field Length =  4       |     set padding (2 octets)    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: File Example Options Templates, Continued (Session Details)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Example Supplemental Options Data</h3>

<p>Following the Templates required to decode the File is the
        supplemental IPFIX Options information used to describe the File's
        contents and type information. First comes the File Time Window
        record; it notes that the File contains data from 9 October 2007
        between 00:01:13 and 23:56:27 UTC, and appears as in <a class='info' href='#ex-timewindow'>Figure&nbsp;6<span> (</span><span class='info'>File Example Time Window</span><span>)</span></a>:
</p><br /><hr class="insert" />
<a name="ex-timewindow"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Set ID = 257         |          Length =  13         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| sessionScope  |           minFlowStartSeconds
|       0       |         2007-10-09 00:01:13 UTC           . . .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                |            maxFlowEndSeconds
. . .           |         2007-10-09 23:56:27 UTC           . . .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                |
. . .           |
+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: File Example Time Window&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>This is followed by information about how the data in the File was
        collected, in the Export Session Details record. This record notes
        that the session stored in this File was sent via SCTP from an
        exporter at 192.0.2.30 port 32769 to an collector at 192.0.2.40 port
        4739, and contains messages exported between 00:01:57 and 23:57:12 UTC
        on 9 October 2007; it is represented in its Data Set as in <a class='info' href='#ex-session-detail'>Figure&nbsp;7<span> (</span><span class='info'>File Example Export Session Details</span><span>)</span></a>:
</p><br /><hr class="insert" />
<a name="ex-session-detail"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                    1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Set ID = 258         |          Length =  27         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| sessionScope  |           exporterIPv4Address
|       0       |               192.0.2.30                  . . .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                |           collectorIPv4Address
. . .           |               192.0.2.31                  . . .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                |     exporterTransportPort     |   cTPort
. . .           |             32769             |    4739   . . .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                |   cTProtocol  |  cPVersion    |
. . .           |      132      |     10        |           . . .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
             minExportSeconds                   |
. . .     2007-10-09 00:01:57 UTC               |           . . .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
             maxExportSeconds                   |
. . .     2007-10-09 23:57:12 UTC               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: File Example Export Session Details&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Example Message Checksum</h3>

<p>Each IPFIX Message within the File is completed with a Message
        Checksum record; the structure of this record within its Data Set is
        as in <a class='info' href='#ex-checksum'>Figure&nbsp;8<span> (</span><span class='info'>File Example Message Checksum</span><span>)</span></a>:
</p><br /><hr class="insert" />
<a name="ex-checksum"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Set ID = 259         |          Length =  24         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| messageScope  |                                               |
|       0       |                                               |
+-+-+-+-+-+-+-+-+                                               |
|                       messageMD5Checksum                      |
|           (16 byte MD5 checksum of options message)           |
|                                                               |
|                                                               |
|               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               |              set padding (3 octets)           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: File Example Message Checksum&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.4"></a><h3>A.4.&nbsp;
File Example Data Set</h3>

<p>After the Templates and supplemental Options information comes the
        data itself. The first record of an example Data Set is shown with its
        message and set headers in <a class='info' href='#ex-data'>Figure&nbsp;9<span> (</span><span class='info'>File Example Data Set</span><span>)</span></a>:
</p><br /><hr class="insert" />
<a name="ex-data"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Version = 10              |         Length = 1296         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Export Time = 2007-10-09 00:01:57 UTC                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Sequence Number = 4                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                   Observation Domain ID = 1                   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Set ID = 256           |          Length = 1254         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      flowStartSeconds                         |
|                    2007-10-09 00:01:13 UTC                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      sourceIPv4Address                        |
|                          192.0.2.2                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    destinationIPv4Address                     |
|                          192.0.2.3                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      sourceTransportPort      |   destinationTransportPort    |
|             32770             |               80              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  protocolId   |             totalOctetCount
|       6       |                  18000                    . . .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                |             totalPacketCount
. . .           |                    65                     . . .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                |             (49 more records)
. . .           |
+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;9: File Example Data Set&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.5"></a><h3>A.5.&nbsp;
Complete File Example</h3>

<p>Bringing together the examples above and adding message headers as
        appropriate, a hex dump of the first 317 bytes of the example Gile
        constructed above would appear as in the annotated <a class='info' href='#ex-hex'>Figure&nbsp;10<span> (</span><span class='info'>File Example Hex Dump</span><span>)</span></a> below. [EDITOR'S NOTE: In this figure, xx refers to
        unassigned IANA IE numbers as in the IANA Considerations section above; 
        cs refers to message checksum bytes that depend on
        the rest of the message contents. These will have to be replaced if we
        keep this example once the IE numbers are assigned.] 
</p><br /><hr class="insert" />
<a name="ex-hex"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  0:|00 0A 00 A0 47 0A B6 E5 00 00 00 00 00 00 00 01
   [^ first message header (length 160 bytes) --&gt;
 16:|00 02 00 28 01 00 00 08 00 96 00 04 00 08 00 04
   [^ data template set --&gt;
 32: 00 0C 00 04 00 07 00 02 00 0B 00 02 00 04 00 01

 48: 00 55 00 04 00 56 00 04|00 03 00 50 01 01 00 03
                           [^ opt template set --&gt;
 64: 00 01 xx xx 00 01 xx xx 00 04 xx xx 00 04 01 03

 80: 00 02 00 01 xx xx 00 01 xx xx 00 10 01 02 00 09

 96: 00 01 xx xx 00 01 00 82 00 04 00 D3 00 04 00 D9

112: 00 02 00 D8 00 02 00 D7 00 01 00 D0 00 01 xx xx

128: 00 04 xx xx 00 04 00 00|01 03 00 18 00 cs cs cs
                           [^ checksum record --&gt;
144: cs cs cs cs cs cs cs cs cs cs cs cs cs 00 00 00

176:|00 0A 00 50 47 0A B6 E5 00 00 00 01 00 00 00 01
   [^ second message header (length 80 bytes) --&gt;
192:|01 01 00 0E 00 47 0A B6 B9 47 0C 07 1B 00|01 02
   [^ time window rec -&gt; [ session detail rec ^ --&gt;
208: 00 1C 00 C0 00 02 1E 0C 00 02 1F 80 01 12 83 84

224: 0A 47 0A B6 E5 47 0C 07 48 00|01 03 00 18 00 cs
           [ message checksum rec ^ --&gt;
240: cs cs cs cs cs cs cs cs cs cs cs cs cs cs cs 00

256:|00 0A 05 10 47 0A B6 E5 00 00 00 06 00 00 00 01
   [^ third message header (length 1296 bytes) --&gt;
272:|01 00 04 E6|47 0A B6 B9 C0 00 02 02 C0 00 02 03
   [^ set hdr ][^ first data rec --&gt;
288: 80 02 00 50 06 00 00 46 50 00 00 00 41
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;10: File Example Hex Dump&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="v9-applicability"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Applicability of IPFIX Files to NetFlow V9 flow storage</h3>

<p>As the IPFIX Message format is nearly a superset of the NetFlow V9
      packet format, IPFIX Files can be used for store NetFlow V9 data
      relatively easily. This section describes a method for doing so. The
      differences between the two protocols are outlined in <a class='info' href='#v9-comparison'>Appendix&nbsp;B.1<span> (</span><span class='info'>Comparing NetFlow V9 to IPFIX</span><span>)</span></a> below. A simple, lightweight,
      message-for-message translation method for transforming V9 Packets into
      IPFIX Messages for storage within IPFIX Files is described in <a class='info' href='#v9-transform'>Appendix&nbsp;B.2<span> (</span><span class='info'>A Method for Transforming NetFlow V9 messages to IPFIX</span><span>)</span></a>. An example of this translation method is given
      in <a class='info' href='#v9-example'>Appendix&nbsp;B.3<span> (</span><span class='info'>NetFlow V9 Transformation Example</span><span>)</span></a>.
</p>
<a name="v9-comparison"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1"></a><h3>B.1.&nbsp;
Comparing NetFlow V9 to IPFIX</h3>

<p>With a few caveats, the IPFIX Protocol is a superset of the NetFlow
        V9 protocol, having evolved from it largely through a process of
        feature addition to bring it into compliance with the IPFIX
        Requirements and the needs of stakeholders within the IPFIX Working
        Group. This appendix outlines the differences between the two
        protocols. It is informative only, and presented as an exploration of
        the two protocols to motivate the usage of IPFIX Files to store
        V9-collected flow data.
</p>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1.1"></a><h3>B.1.1.&nbsp;
Message Header Format</h3>

<p>Both NetFlow V9 and IPFIX use streams of messages prefixed by
          a message header, though the message header differs
          significantly between the two. Note that in NetFlow V9
          terminology, these messages are called packets, and messages must
          be delimited by datagram boundaries. IPFIX does not have this
          constraint. The header formats are detailed below:
</p><br /><hr class="insert" />
<a name="v9-packhdr"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Version Number          |            Count              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           sysUpTime                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           UNIX Secs                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Sequence Number                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Source ID                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;11: NetFlow V9 Packet Header Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="v9-msghdr"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Version Number          |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Export Time                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Sequence Number                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Observation Domain ID                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;12: IPFIX Message Header Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<blockquote class="text"><dl>
<dt>Version Number: </dt>
<dd>The IPFIX Version Number MUST be
            10, while the NetFlow V9 Version Number MUST be 9.
</dd>
<dt>Length vs. Count: </dt>
<dd>The Count field in the NetFlow V9
            packet header counts records in the message (including Data and
            Template Records), while the Length field in the IPFIX Message
            Header counts octets in the message. Note that this implies that
            NetFlow V9 collectors must rely on datagram boundaries or some
            other external delimeter; or otherwise must completely consume a
            message before finding its end.
</dd>
<dt>System Uptime: </dt>
<dd>System uptime in milliseconds is
            exported in the NetFlow V9 packet header. This field is not
            present in the IPFIX Message Header, and must be exported using an
            IPFIX Option if required.
</dd>
<dt>Export Time: </dt>
<dd>Aside from being called UNIX Secs in
            the NetFlow V9 packet header specification, the export time in
            seconds since 1 January 1970 at 0000 UTC appears in both NetFlow
            V9 and IPFIX message headers.
</dd>
<dt>Sequence Number: </dt>
<dd>The NetFlow V9 Sequence Number
            counts packets, while the IPFIX Sequence Number counts records in
            Data Sets. Both are scoped to Observation Domain.
</dd>
<dt>Observation Domain ID: </dt>
<dd>Similarly, the NetFlow V9
            sourceID has become the IPFIX Observation Domain ID.
</dd>
</dl></blockquote>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1.2"></a><h3>B.1.2.&nbsp;
Set Header Format</h3>

<p>Set headers are identical between NetFlow V9 and IPFIX; that is,
          each Set (FlowSet in NetFlow V9 terminology) is prefixed by a 4-byte
          set header containing the Set ID and the length of the set in
          octets.
</p>
<p>Note that the special Set IDs are different between IPFIX and
          NetFlow V9. IPFIX Template Sets are identified by Set ID 2, while
          NetFlow V9 Template FlowSets are identified by Set ID 0. Similarly,
          IPFIX Options Template Sets are identified by Set ID 3, while
          NetFlow V9 Options Template FlowSets are identified by Set ID 1.
</p>
<p>Both protocols reserve Set IDs 0-255, and use Set IDs 256-65535
          for Data Sets (or FlowSets, in NetFlow V9 terminology).
</p>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1.3"></a><h3>B.1.3.&nbsp;
Template Format</h3>

<p>Template FlowSets in NetFlow V9 support a subset of functionality
          of those in IPFIX. Specifically, NetFlow V9 does not have any
          support for vendor-specific Information Elements as IPFIX does, so
          there is no enterprise bit or facility for associating a private
          enterprise number with an information element. NetFlow V9 also does
          not support variable-length fields.
</p>
<p>Options Template FlowSets in NetFlow V9 are similar to Options
          Template Sets in IPFIX in the same way.
</p>
<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1.4"></a><h3>B.1.4.&nbsp;
Information Model</h3>

<p>The NetFlow V9 field type definitions are a compatible subset of,
          and have evolved in concert with, the IPFIX Information Model. IPFIX
          Information Element identifiers in the range 1-127 are defined by
          <a class='info' href='#RFC5102'>the IPFIX Information Model<span> (</span><span class='info'>Quittek, J., Bryant, S., Claise, B., Aitken, P., and J. Meyer, &ldquo;Information Model for IP Flow Information Export,&rdquo; January&nbsp;2008.</span><span>)</span></a> [RFC5102] to be
          compatible with the corresponding NetFlow V9 field types.
</p>
<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1.5"></a><h3>B.1.5.&nbsp;
Template Management</h3>

<p>NetFlow V9 has no concept of a Transport Session as in IPFIX, as
          NetFlow V9 was designed with a connectionless transport in mind.
          Template IDs are therefore scoped to an Exporting Process lifetime
          (i.e., an Exporting Process instance between restarts). There is no
          facility in NetFlow V9 as in IPFIX for Template withdrawal or
          Template ID reuse. Template retransmission at the Exporter works as
          in UDP-based IPFIX Exporting Processes.
</p>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1.6"></a><h3>B.1.6.&nbsp;
Transport</h3>

<p>In practice, though NetFlow V9 is designed to be
          transport-independent, it is transported only over UDP. There is no
          facility as in IPFIX for full connection-oriented transport without
          datagram boundaries, due to the use of a record count field as
          opposed to a message length field in the packet header. There is no
          support in NetFlow V9 for transport layer security via TLS or
          DTLS.
</p>
<a name="v9-transform"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.2"></a><h3>B.2.&nbsp;
A Method for Transforming NetFlow V9 messages to IPFIX</h3>

<p>This appendix describes a method for transforming NetFlow V9
        Packets into IPFIX Messages, which can be used to store NetFlow V9
        data in IPFIX Files. A process transforming NetFlow V9 Packets into
        IPFIX Messages must handle the fact that NetFlow V9 Packets and IPFIX
        Messages are framed differently, that sequence numbering works
        differently, and that the NetFlow V9 field type definitions are only
        compatible with the IPFIX Information Model below Information Element
        identifier 128.
</p>
<p>For each incoming NetFlow V9 packet, the transformation process
        must:
</p>
<ol class="text">
<li>Verify that the Version field of the packet header is 9.
</li>
<li>Verify that the Sequence Number field of the packet header is
            valid.
</li>
<li>Scan the packet to:
</li>
<ol class="text">
<li>verify that it contains no Templates with field types outside
            the range 1-127;
</li>
<li>verify that it contains no FlowSets with Set IDs between 2 and
            255 inclusive;
</li>
<li>verify that it contains the number of records in FlowSets,
            Template FlowSets, and Options Template FlowSets declared in the
            Count field of the packet header; and
</li>
<li>count the number of records in Data FlowSets for calculating
            the IPFIX Sequence Number.
</li>
</ol>
<li>Calculate a Sequence Number for each IPFIX Observation Domain by
          storing the last Sequence Number sent for each Observation Domain
          plus the count of records in Data FlowSets in the previous step to
          be sent as the Sequence Number for the IPFIX Message following this
          one within that Observation Domain.
</li>
<li>Generate a new IPFIX Message Header with:
</li>
<ol class="text">
<li>a Version field of 10; 
</li>
<li>a Length field with the number of octets in the IPFIX Message,
            generally available by subtracting 4 from the length of the
            NetFlow V9 packet as returned from the transport layer (accounting
            for the difference in message header lengths);
</li>
<li>the Sequence Number calculated for this message by the Sequence
            Number calculation step; and
</li>
<li>Export Time and Observation Domain ID taken from the UNIX secs
            and Source ID fields of the NetFlow V9 packet header,
            respectively.
</li>
</ol>
<li>Copy each FlowSet from the Netflow V9 packet to the IPFIX Message
          after the header. Replace Set ID 0 with Set ID 2 for Template Sets,
          and Set ID 1 with Set ID 3 for Options Template Sets.
</li>
</ol>
<p>Note that this process loses system uptime information; if such
        information is required, the transformation process will have to
        export that information using IPFIX Options. This may require a more
        sophisticated transformation process structure.
</p>
<a name="v9-example"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.3"></a><h3>B.3.&nbsp;
NetFlow V9 Transformation Example</h3>

<p>The following two figures show a single NetFlow V9 packet with
        templates and the corresponding IPFIX Message, exporting a single
        flow record representing 60,303 octets sent from 192.0.2.2 to
        192.0.2.3.  This would be the 3rd packet exported in Observation
        Domain 33 from the NetFlow V9 exporter, containing records starting
        with the 12th record (packet and record sequence numbers count from
        0).
</p>
<p>The ** symbol in the IPFIX example shows those fields that required
        modification from the NetFlow V9 packet by the transformation
        process.
</p><br /><hr class="insert" />
<a name="v9-expacket"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Version = 9          |         Count = 2             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Uptime = 3750405 ms (1:02:30.405)               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Export Time = 1171557627 epoch sec (2007-02-15 16:40:27)    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Sequence Number = 2                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 Observation Domain ID = 33                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Set ID = 0          |       Set Length = 20         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Template ID = 256       |       Field Count = 3         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| IPV4_SRC_ADDR           =   8 |       Field Length = 4        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| IPV4_DST_ADDR           =  12 |       Field Length = 4        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| IN_BYTES                =   1 |       Field Length = 4        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Set ID = 256         |       Set Length = 16         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         IPV4_SRC_ADDR                         |
|                           192.0.2.2                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         IPV4_DST_ADDR                         |
|                           192.0.2.3                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           IN_BYTES                            |
|                             60303                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;13: Example NetFlow V9 Packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="v9-exmessage"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                    1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| **       Version = 10         | **      Length = 52           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Export Time = 1171557627 epoch sec (2007-02-15 16:40:27)    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| **                   Sequence Number = 11                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                   Observation Domain ID = 33                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| **         Set ID = 2         |       Set Length = 20         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Template ID = 256       |       Field Count  = 3        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0| sourceIPv4Address      =  8 |       Field Length = 4        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0| destinationIPv4Address = 12 |       Field Length = 4        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0| octetDeltaCount        =  1 |       Field Length = 4        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Set ID = 256         |       Set Length = 16         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       sourceIPv4Address                       |
|                           192.0.2.2                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     destinationIPv4Address                    |
|                           192.0.2.3                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        octetDeltaCount                        |
|                             60303                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;14: Corresponding Example IPFIX Message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Brian Trammell</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hitachi Europe</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">c/o ETH Zurich</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gloriastrasse 35</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">8092 Zurich</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Switzerland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+41 44 632 70 13</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:brian.trammell@hitachi-eu.com">brian.trammell@hitachi-eu.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Elisa Boschi</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hitachi Europe</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">c/o ETH Zurich</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gloriastrasse 35</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">8092 Zurich</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Switzerland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+41 44 632 70 57</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:elisa.boschi@hitachi-eu.com">elisa.boschi@hitachi-eu.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Lutz Mark</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Fraunhofer IFAM</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Wiener Str. 12</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">28359 Bremen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+49 421 2246206</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:lutz.mark@ifam.fraunhofer.de">lutz.mark@ifam.fraunhofer.de</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tanja Zseby</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Fraunhofer Institute for Open Communication Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kaiserin-Augusta-Allee 31</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">10589 Berlin</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+49 30 3463 7153</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:tanja.zseby@fokus.fraunhofer.de">tanja.zseby@fokus.fraunhofer.de</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Arno Wagner</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">ETH Zurich</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gloriastrasse 35</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">8092 Zurich</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Switzerland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+41 44 632 70 04</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:arno@wagner.name">arno@wagner.name</a></td></tr>
</table>
</body></html>
