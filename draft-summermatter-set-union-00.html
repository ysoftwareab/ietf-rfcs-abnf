<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Byzantine Fault Tolerant Set Reconciliation</title>
<meta content="Elias Summermatter" name="author">
<meta content="Christian Grothoff" name="author">
<meta content="
       This document contains a protocol specification for Byzantine fault-tolerant
                Set Reconciliation.
       
    " name="description">
<meta content="xml2rfc 3.5.0" name="generator">
<meta content="name systems" name="keyword">
<meta content="draft-summermatter-set-union-00" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.5.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.2.3
    google-i18n-address 2.4.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.2
    kitchen 1.2.6
    lxml 4.6.2
    pycountry 20.7.3
    pyflakes 2.2.0
    PyYAML 5.3.1
    requests 2.25.1
    setuptools 51.0.0
    six 1.15.0
-->
<link href="/tmp/draft-summermatter-set-union-00.exp-xa2bl8k8.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Set Union</td>
<td class="right">January 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Summermatter &amp; Grothoff</td>
<td class="center">Expires 27 July 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Independent Stream</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-summermatter-set-union-00</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-01-23" class="published">23 January 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-07-27">27 July 2021</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">E. Summermatter</div>
<div class="org">Seccom GmbH</div>
</div>
<div class="author">
      <div class="author-name">C. Grothoff</div>
<div class="org">Berner Fachhochschule</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Byzantine Fault Tolerant Set Reconciliation</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document contains a protocol specification for Byzantine fault-tolerant
                Set Reconciliation.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 27 July 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-background" class="xref">Background</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-bloom-filters" class="xref">Bloom Filters</a><a href="#section-toc.1-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1" class="keepWithNext"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-counting-bloom-filter" class="xref">Counting Bloom Filter</a><a href="#section-toc.1-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-invertible-bloom-filter" class="xref">Invertible Bloom Filter</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-structure" class="xref">Structure</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-operations" class="xref">Operations</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="xref">3.2.1</a>.  <a href="#name-insert-element" class="xref">Insert Element</a><a href="#section-toc.1-1.3.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a href="#section-3.2.2" class="xref">3.2.2</a>.  <a href="#name-remove-element" class="xref">Remove Element</a><a href="#section-toc.1-1.3.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.2.2.3">
                    <p id="section-toc.1-1.3.2.2.2.3.1"><a href="#section-3.2.3" class="xref">3.2.3</a>.  <a href="#name-decode-ibf" class="xref">Decode IBF</a><a href="#section-toc.1-1.3.2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.2.2.4">
                    <p id="section-toc.1-1.3.2.2.2.4.1"><a href="#section-3.2.4" class="xref">3.2.4</a>.  <a href="#name-set-difference" class="xref">Set Difference</a><a href="#section-toc.1-1.3.2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-wire-format" class="xref">Wire format</a><a href="#section-toc.1-1.3.2.3.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="xref">3.3.1</a>.  <a href="#name-id-calculation" class="xref">ID Calculation</a><a href="#section-toc.1-1.3.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a href="#section-3.3.2" class="xref">3.3.2</a>.  <a href="#name-mapping-function" class="xref">Mapping Function</a><a href="#section-toc.1-1.3.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.3.2.3">
                    <p id="section-toc.1-1.3.2.3.2.3.1"><a href="#section-3.3.3" class="xref">3.3.3</a>.  <a href="#name-hash-calculation" class="xref">HASH calculation</a><a href="#section-toc.1-1.3.2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-strata-estimator" class="xref">Strata Estimator</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-description" class="xref">Description</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-mode-of-operation" class="xref">Mode of operation</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-full-synchronisation-mode" class="xref">Full Synchronisation Mode</a><a href="#section-toc.1-1.5.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-delta-synchronisation-mode" class="xref">Delta Synchronisation Mode</a><a href="#section-toc.1-1.5.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-combined-mode" class="xref">Combined Mode</a><a href="#section-toc.1-1.5.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-messages" class="xref">Messages</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-operation-request" class="xref">Operation Request</a><a href="#section-toc.1-1.6.2.1.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.6.2.1.2.1">
                    <p id="section-toc.1-1.6.2.1.2.1.1"><a href="#section-6.1.1" class="xref">6.1.1</a>.  <a href="#name-description-2" class="xref">Description</a><a href="#section-toc.1-1.6.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.1.2.2">
                    <p id="section-toc.1-1.6.2.1.2.2.1"><a href="#section-6.1.2" class="xref">6.1.2</a>.  <a href="#name-structure-2" class="xref">Structure</a><a href="#section-toc.1-1.6.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-ibf" class="xref">IBF</a><a href="#section-toc.1-1.6.2.2.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="xref">6.2.1</a>.  <a href="#name-description-3" class="xref">Description</a><a href="#section-toc.1-1.6.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.2.2.2">
                    <p id="section-toc.1-1.6.2.2.2.2.1"><a href="#section-6.2.2" class="xref">6.2.2</a>.  <a href="#name-structure-3" class="xref">Structure</a><a href="#section-toc.1-1.6.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-ibf-2" class="xref">IBF</a><a href="#section-toc.1-1.6.2.3.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.6.2.3.2.1">
                    <p id="section-toc.1-1.6.2.3.2.1.1"><a href="#section-6.3.1" class="xref">6.3.1</a>.  <a href="#name-description-4" class="xref">Description</a><a href="#section-toc.1-1.6.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-elements" class="xref">Elements</a><a href="#section-toc.1-1.6.2.4.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.6.2.4.2.1">
                    <p id="section-toc.1-1.6.2.4.2.1.1"><a href="#section-6.4.1" class="xref">6.4.1</a>.  <a href="#name-description-5" class="xref">Description</a><a href="#section-toc.1-1.6.2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.4.2.2">
                    <p id="section-toc.1-1.6.2.4.2.2.1"><a href="#section-6.4.2" class="xref">6.4.2</a>.  <a href="#name-structure-4" class="xref">Structure</a><a href="#section-toc.1-1.6.2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a href="#section-6.5" class="xref">6.5</a>.  <a href="#name-offer" class="xref">Offer</a><a href="#section-toc.1-1.6.2.5.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.6.2.5.2.1">
                    <p id="section-toc.1-1.6.2.5.2.1.1"><a href="#section-6.5.1" class="xref">6.5.1</a>.  <a href="#name-description-6" class="xref">Description</a><a href="#section-toc.1-1.6.2.5.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.5.2.2">
                    <p id="section-toc.1-1.6.2.5.2.2.1"><a href="#section-6.5.2" class="xref">6.5.2</a>.  <a href="#name-structure-5" class="xref">Structure</a><a href="#section-toc.1-1.6.2.5.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.6">
                <p id="section-toc.1-1.6.2.6.1"><a href="#section-6.6" class="xref">6.6</a>.  <a href="#name-inquiry" class="xref">Inquiry</a><a href="#section-toc.1-1.6.2.6.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.6.2.6.2.1">
                    <p id="section-toc.1-1.6.2.6.2.1.1"><a href="#section-6.6.1" class="xref">6.6.1</a>.  <a href="#name-description-7" class="xref">Description</a><a href="#section-toc.1-1.6.2.6.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.6.2.2">
                    <p id="section-toc.1-1.6.2.6.2.2.1"><a href="#section-6.6.2" class="xref">6.6.2</a>.  <a href="#name-structure-6" class="xref">Structure</a><a href="#section-toc.1-1.6.2.6.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.7">
                <p id="section-toc.1-1.6.2.7.1"><a href="#section-6.7" class="xref">6.7</a>.  <a href="#name-demand" class="xref">Demand</a><a href="#section-toc.1-1.6.2.7.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.6.2.7.2.1">
                    <p id="section-toc.1-1.6.2.7.2.1.1"><a href="#section-6.7.1" class="xref">6.7.1</a>.  <a href="#name-description-8" class="xref">Description</a><a href="#section-toc.1-1.6.2.7.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.7.2.2">
                    <p id="section-toc.1-1.6.2.7.2.2.1"><a href="#section-6.7.2" class="xref">6.7.2</a>.  <a href="#name-structure-7" class="xref">Structure</a><a href="#section-toc.1-1.6.2.7.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.8">
                <p id="section-toc.1-1.6.2.8.1"><a href="#section-6.8" class="xref">6.8</a>.  <a href="#name-done" class="xref">Done</a><a href="#section-toc.1-1.6.2.8.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.6.2.8.2.1">
                    <p id="section-toc.1-1.6.2.8.2.1.1"><a href="#section-6.8.1" class="xref">6.8.1</a>.  <a href="#name-description-9" class="xref">Description</a><a href="#section-toc.1-1.6.2.8.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.8.2.2">
                    <p id="section-toc.1-1.6.2.8.2.2.1"><a href="#section-6.8.2" class="xref">6.8.2</a>.  <a href="#name-structure-8" class="xref">Structure</a><a href="#section-toc.1-1.6.2.8.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.9">
                <p id="section-toc.1-1.6.2.9.1"><a href="#section-6.9" class="xref">6.9</a>.  <a href="#name-full-done" class="xref">Full Done</a><a href="#section-toc.1-1.6.2.9.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.6.2.9.2.1">
                    <p id="section-toc.1-1.6.2.9.2.1.1"><a href="#section-6.9.1" class="xref">6.9.1</a>.  <a href="#name-description-10" class="xref">Description</a><a href="#section-toc.1-1.6.2.9.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.9.2.2">
                    <p id="section-toc.1-1.6.2.9.2.2.1"><a href="#section-6.9.2" class="xref">6.9.2</a>.  <a href="#name-structure-9" class="xref">Structure</a><a href="#section-toc.1-1.6.2.9.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.10">
                <p id="section-toc.1-1.6.2.10.1"><a href="#section-6.10" class="xref">6.10</a>. <a href="#name-request-full" class="xref">Request Full</a><a href="#section-toc.1-1.6.2.10.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.6.2.10.2.1">
                    <p id="section-toc.1-1.6.2.10.2.1.1"><a href="#section-6.10.1" class="xref">6.10.1</a>.  <a href="#name-description-11" class="xref">Description</a><a href="#section-toc.1-1.6.2.10.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.10.2.2">
                    <p id="section-toc.1-1.6.2.10.2.2.1"><a href="#section-6.10.2" class="xref">6.10.2</a>.  <a href="#name-structure-10" class="xref">Structure</a><a href="#section-toc.1-1.6.2.10.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.11">
                <p id="section-toc.1-1.6.2.11.1"><a href="#section-6.11" class="xref">6.11</a>. <a href="#name-strata-estimator-2" class="xref">Strata Estimator</a><a href="#section-toc.1-1.6.2.11.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.6.2.11.2.1">
                    <p id="section-toc.1-1.6.2.11.2.1.1"><a href="#section-6.11.1" class="xref">6.11.1</a>.  <a href="#name-description-12" class="xref">Description</a><a href="#section-toc.1-1.6.2.11.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.11.2.2">
                    <p id="section-toc.1-1.6.2.11.2.2.1"><a href="#section-6.11.2" class="xref">6.11.2</a>.  <a href="#name-structure-11" class="xref">Structure</a><a href="#section-toc.1-1.6.2.11.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.12">
                <p id="section-toc.1-1.6.2.12.1"><a href="#section-6.12" class="xref">6.12</a>. <a href="#name-strata-estimator-compressed" class="xref">Strata Estimator Compressed</a><a href="#section-toc.1-1.6.2.12.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.6.2.12.2.1">
                    <p id="section-toc.1-1.6.2.12.2.1.1"><a href="#section-6.12.1" class="xref">6.12.1</a>.  <a href="#name-description-13" class="xref">Description</a><a href="#section-toc.1-1.6.2.12.2.1.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.13">
                <p id="section-toc.1-1.6.2.13.1"><a href="#section-6.13" class="xref">6.13</a>. <a href="#name-full-element" class="xref">Full Element</a><a href="#section-toc.1-1.6.2.13.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.6.2.13.2.1">
                    <p id="section-toc.1-1.6.2.13.2.1.1"><a href="#section-6.13.1" class="xref">6.13.1</a>.  <a href="#name-description-14" class="xref">Description</a><a href="#section-toc.1-1.6.2.13.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.6.2.13.2.2">
                    <p id="section-toc.1-1.6.2.13.2.2.1"><a href="#section-6.13.2" class="xref">6.13.2</a>.  <a href="#name-structure-12" class="xref">Structure</a><a href="#section-toc.1-1.6.2.13.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-gana-considerations" class="xref">GANA Considerations</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-contributors" class="xref">Contributors</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-appendix.a" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">
                This document describes a Byzantine fault-tolerant set reconciliation protocol used to efficient and
                securely
                synchronize two sets of elements between two peers.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">
                This Byzantine fault-tolerant set reconciliation
                protocol can be used in a variety of applications.

                Our primary envisioned application domain is the
                distribution of revocation messages in the GNU Name
                System (GNS)
                <span>[<a href="#GNUNET" class="xref">GNUNET</a>]</span>
        <span>[<a href="#GNS" class="xref">GNS</a>]</span>
                . In GNS,
                key revocation messages are usually flooded across the
                peer-to-peer overlay network to all connected peers
                whenever a key is revoked. However, as peers may be
                offline or the network might have been partitioned,
                there is a need to reconcile revocation lists whenever
                network partitions are healed or peers go online. The
                GNU Name System uses the protocol described in this
                specification to efficiently distribute revocation
                messages whenever network partitions are healed.

                Another application domain for the protocol described
                in this specification are Byzantine fault-tolerant
                bulletin boards, like those required in some secure
                multiparty computations. A well-known example for
                secure multiparty computations are various E-voting
                protocols
                <span>[<a href="#CryptographicallySecureVoting" class="xref">CryptographicallySecureVoting</a>]</span>
                which
                use a bulletin board to share the votes and intermediate
                computational results. We note that for such systems,
                the set reconciliation protocol is merely a component of
                a multiparty consensus protocol, such as the one
                described in (FIXME-CITE: DOLD MS Thesis! Which paper is his MS thesis on fdold.eu).<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">
                The protocol described in this report is generic and
                suitable for a wide range of applicaitons. As a result,
                the internal structure of the elements in the sets must
                be defined and verified by the application using the
                protocol. This document thus does not cover the elemtn
                structure, except for imposing a limit on the maximum
                size of an element.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">
                The protocol faces an inherent trade-off between minimizing
                the number of network round-trips and the number of bytes
                sent over the network. Thus, for the protocol to choose
                the right parameters for a given situation, applications
                using the protocol must provide a parameter that specifies
                the cost-ratio of round-trips vs. bandwidth usage. Given
                this trade-off factor, the protocol will then choose parameters
                that minimize the total execution cost. In particular, there
                is one major choice to be made, which is between sending the
                full set of elements, or just sending the elements that differ.
                In the latter case, our design is basically a concrete
                implementation of a proposal by Eppstein.
                <span>[<a href="#Eppstein" class="xref">Eppstein</a>]</span><a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">
                We say that our set reconciliation protocol is Byzantine
                fault-tolerant because it provides cryptographic and
                probabilistic methods to discover if the other peer
                is dishonest or misbehaving.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">
                The objective here is to limit resources wasted on
                malicious actors. Malicious actors could send malformed
                messages, including malformed set elements, claim to
                have much larger numbers of valid set elements than the
                actually hold, or request the retransmission of elements
                that they have already received in previous
                interactions. Bounding resources consumed by malicous
                actors is important to ensure that higher-level protocols
                can use set reconciliation and still meet their resource
                targets. This can be particularly critical in multi-round
                synchronous consensus protocols where peers that cannot
                answer in a timely fashion would have to be treated as
                failed or malicious.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">
                To defend against some of these attacks, applications
                need to remember the number of elements previously
                shared with a peer, and offer a means to check that
                elements are well-formed. Applications may also be able
                to provide an upper bound on the total number of valid
                elements that may exist. For example, in E-voting, the
                number of eligible voters could be used to provide such
                an upper bound.<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">
                This document defines the normative wire format of resource records, resolution processes,
                cryptographic routines and security considerations for use by implementors.
                SETU requires a bidirectional secure communication channel between the two parties.
                Specification of the communication channel is out of scope of this document.<a href="#section-1-8" class="pilcrow">¶</a></p>
<p id="section-1-9">
                The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
                NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
                "OPTIONAL" in this document are to be interpreted as described
                in<span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span>.<a href="#section-1-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="background">
<section id="section-2">
      <h2 id="name-background">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-background" class="section-name selfRef">Background</a>
      </h2>
<div id="bf">
<section id="section-2.1">
        <h3 id="name-bloom-filters">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-bloom-filters" class="section-name selfRef">Bloom Filters</a>
        </h3>
<p id="section-2.1-1">
                    A Bloom filter (BF) is a space-efficient datastructure to test if am element is part of a set of
                    elements.
                    Elements are identified by an element ID.
                    Since a BF is a probabilistic datastructure, it is possible to have false-positives: when asked
                    if an element is in the set, the answer from a BF is either "no" or "maybe".<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">
                    A BF consists of L buckets. Every bucket is a binary value that can be either 0 or 1. All buckets
                    are initialized
                    to 0. A mapping function M is used to map each the ID of each element from the set to a subset of k
                    buckets. M is non-injective
                    and can thus map the same element multiple times to the same bucket.
                    The type of the mapping function can thus be described by the following mathematical notation:<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<div id="bf_mapping_function_math">
<figure id="figure-1">
          <div class="artwork art-text alignLeft" id="section-2.1-3.1">
<pre>
------------------------------------
# M: E-&gt;B^k
------------------------------------
# L = Number of buckets
# B = 0,1,2,3,4,...L-1 (the buckets)
# k = Number of buckets per element
# E = Set of elements
------------------------------------
Example: L=256, k=3
M('element-data') = {4,6,255}
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a></figcaption></figure>
</div>
<p id="section-2.1-4">
                    A typical mapping function is constructed by hashing the element, for example
                    using the well-known <span><a href="https://rfc-editor.org/rfc/rfc5869#section-2" class="relref">Section 2</a> of HKDF
                    construction [<a href="#RFC5869" class="xref">RFC5869</a>]</span>.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.1-5">
                    To add an element to the BF, the corresponding buckets under the map M are set to 1.
                    To check if an element may be in the set, one tests if all buckets under the map M are set to 1.<a href="#section-2.1-5" class="pilcrow">¶</a></p>
<p id="section-2.1-6">
                    Further in this document a bitstream outputted by the mapping function is represented by
                    a set of numeric values for example (0101) = (2,4).
                    In the BF the buckets are set to 1 if the corresponding bit in the bitstream is 1.
                    If there is a collision and a bucket is already set to 1, the bucket stays 1.<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<p id="section-2.1-7">
                    In the following example the element M(element) = (1,3) has been added:<a href="#section-2.1-7" class="pilcrow">¶</a></p>
<div id="figure_bf_insert_0">
<figure id="figure-2">
          <div class="artwork art-text alignLeft" id="section-2.1-8.1">
<pre>
    bucket-0     bucket-1       bucket-2      bucket-3
+-------------+-------------+-------------+-------------+
|      0      |      1      |      0      |      1      |
+-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a></figcaption></figure>
</div>
<p id="section-2.1-9">
                    Is easy to see that the M(element) = (0,3) could be in the BF bellow and M(element) = (0,2) can't be
                    in the BF bellow:<a href="#section-2.1-9" class="pilcrow">¶</a></p>
<div id="figure_bf_contains">
<figure id="figure-3">
          <div class="artwork art-text alignLeft" id="section-2.1-10.1">
<pre>
    bucket-0     bucket-1       bucket-2      bucket-3
+-------------+-------------+-------------+-------------+
|      1      |      0      |      0      |      1      |
+-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a></figcaption></figure>
</div>
<p id="section-2.1-11">
                    The parameters L and k depend on the set size and must be
                    chosen carefully to ensure that the BF does not return too
                    many false-positives.<a href="#section-2.1-11" class="pilcrow">¶</a></p>
<p id="section-2.1-12">
                    It is not possible to remove an element from the BF because buckets can only be set to 1 or 0. Hence
                    it is impossible to
                    differentiate between buckets containing one or more elements. To remove elements from the BF a
                    <a href="#cbf" class="xref">Counting Bloom Filter</a>
                    is required.<a href="#section-2.1-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cbf">
<section id="section-2.2">
        <h3 id="name-counting-bloom-filter">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-counting-bloom-filter" class="section-name selfRef">Counting Bloom Filter</a>
        </h3>
<p id="section-2.2-1">
                    A Counting Bloom Filter (CBF) is an extension of the<a href="#bf" class="xref">Bloom Filters</a>. In the CBF,
                    buckets are
                    unsigned numbers instead of binary values. This allows the removal of an elements from the CBF.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">
                    Adding an element to the CBF is similar to the adding operation of the BF. However, instead of
                    setting the bucket on hit to 1 the
                    numeric value stored in the bucket is increased by 1. For example if two colliding elements
                    M(element1) = (1,3) and
                    M(element2) = (0,3) are added to the CBF, bucket 0 and 1 are set to 1 and bucket 3 (the colliding
                    bucket) is set
                    to 2:<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<div id="figure_cbf_insert_0">
<figure id="figure-4">
          <div class="artwork art-text alignLeft" id="section-2.2-3.1">
<pre>
    bucket-0     bucket-1       bucket-2      bucket-3
+-------------+-------------+-------------+-------------+
|      1      |      1      |      0      |      2      |
+-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a></figcaption></figure>
</div>
<p id="section-2.2-4">
                    The counter stored in the bucket is also called the order of the bucket.<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.2-5">
                    To remove an element form the CBF the counters of all buckets the element is mapped to are decreased
                    by 1.<a href="#section-2.2-5" class="pilcrow">¶</a></p>
<p id="section-2.2-6">
                    Removing M(element2) = (1,3) from the CBF above:<a href="#section-2.2-6" class="pilcrow">¶</a></p>
<div id="figure_cbf_remove_0">
<figure id="figure-5">
          <div class="artwork art-text alignLeft" id="section-2.2-7.1">
<pre>
    bucket-0     bucket-1       bucket-2      bucket-3
+-------------+-------------+-------------+-------------+
|      1      |      0      |      0      |      1      |
+-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a></figcaption></figure>
</div>
<p id="section-2.2-8">
                    In practice, the number of bits available for the counters is usually finite. For example, given a
                    4-bit
                    counter, a CBF bucket would overflow once 16 elements are mapped to the same bucket. To efficiently
                    handle this case, the maximum value (15 in our example) is considered to represent "infinity". Once
                    the
                    order of a bucket reaches "infinity", it is no longer incremented or decremented.<a href="#section-2.2-8" class="pilcrow">¶</a></p>
<p id="section-2.2-9">
                    The parameters L and k and the number of bits allocated to the counters should depend on the set
                    size.
                    An IBF will degenerate when subjected to insert and remove iterations of different elements, and
                    eventually all
                    buckets will reach "infinity". The speed of the degradation will depend on the choice of L and k in
                    relation to the number of elements stored in the IBF.<a href="#section-2.2-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ibv">
<section id="section-3">
      <h2 id="name-invertible-bloom-filter">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-invertible-bloom-filter" class="section-name selfRef">Invertible Bloom Filter</a>
      </h2>
<p id="section-3-1">
                An Invertible Bloom Filter (IBF) is a further extension of the<a href="#cbf" class="xref">Counting Bloom Filter</a>.
                An IBF extends the
                <a href="#cbf" class="xref">Counting Bloom Filter</a>
                with two more operations:
                decode and set difference. This two extra operations are useful to efficiently extract
                small differences between large sets.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="ibf_structure">
<section id="section-3.1">
        <h3 id="name-structure">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-structure" class="section-name selfRef">Structure</a>
        </h3>
<p id="section-3.1-1">
                    An IBF consists of a mapping function M and
                    L buckets that each store a signed
                    counter and an XHASH. An XHASH is the XOR of various
                    hash values. As before, the
                    values used for k, L and the number of bits used
                    for the signed counter and the XHASH depend
                    on the set size and various other trade-offs,
                    including the CPU architecture.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">
                    If the IBF size is to small or the mapping
                    function does not spread out the elements
                    uniformly, the signed counter can overflow or
                    underflow. As with the CBF, the "maximum" value is
                    thus used to represent "infinite". As there is no
                    need to distinguish between overflow and
                    underflow, the most canonical representation of
                    "infinite" would be the minimum value of the
                    counter in the canonical 2-complement
                    interpretation. For example, given a 4-bit
                    counter a value of -8 would be used to represent
                    "infinity".<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<div id="figure_ibf_structure">
<figure id="figure-6">
          <div class="artwork art-text alignLeft" id="section-3.1-3.1">
<pre>
            bucket-0     bucket-1       bucket-2      bucket-3
        +-------------+-------------+-------------+-------------+-------
  count |   COUNTER   |   COUNTER   |   COUNTER   |   COUNTER   |  C...
        +-------------+-------------+-------------+-------------+------
  idSum |    IDSUM    |    IDSUM    |    IDSUM    |     IDSUM   |  I...
        +-------------+-------------+-------------+-------------+------
hashSum |   HASHSUM   |   HASHSUM   |   HASHSUM   |    HASHSUM  |  H..
        +-------------+-------------+-------------+-------------+-------
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a></figcaption></figure>
</div>
</section>
</div>
<div id="ibf_operations">
<section id="section-3.2">
        <h3 id="name-operations">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-operations" class="section-name selfRef">Operations</a>
        </h3>
<p id="section-3.2-1">
                    When an IBF is created, all counters and IDSUM and HASHSUM values of
                    all buckets are initialized to zero.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<div id="ibv_operations_insert">
<section id="section-3.2.1">
          <h4 id="name-insert-element">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-insert-element" class="section-name selfRef">Insert Element</a>
          </h4>
<p id="section-3.2.1-1">
                        To add an element to a IBF, the element is mapped to a subset of k buckets using
                        the mapping function M as described in the
                        <a href="#bf" class="xref">Bloom Filters</a>
                        section introducing
                        BFs. For the buckets selected by the mapping function, the counter is increased by one and the
                        IDSUM field is set to the XOR of the element ID and the previously stored IDSUM. Furthermore,
                        the HASHSUM is set to the XOR of the hash of the element ID and the previously stored HASHSUM.<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
<p id="section-3.2.1-2">
                        In the following example, the insert operation is illustrated using an element with the
                        ID 0x0102 and a hash of 0x4242, and a second element with the ID 0x0304 and
                        a hash of 0x0101.<a href="#section-3.2.1-2" class="pilcrow">¶</a></p>
<p id="section-3.2.1-3">Empty IBF:<a href="#section-3.2.1-3" class="pilcrow">¶</a></p>
<div id="figure_ibf_insert_0">
<figure id="figure-7">
            <div class="artwork art-text alignLeft" id="section-3.2.1-4.1">
<pre>
            bucket-0     bucket-1       bucket-2      bucket-3
        +-------------+-------------+-------------+-------------+
  count |      0      |      0      |      0      |      0      |
        +-------------+-------------+-------------+-------------+
  idSum |    0x0000   |    0x0000   |    0x0000   |    0x0000   |
        +-------------+-------------+-------------+-------------+
hashSum |    0x0000   |    0x0000   |    0x0000   |    0x0000   |
        +-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a></figcaption></figure>
</div>
<p id="section-3.2.1-5">Insert first element: [0101] with ID 0x0102 and hash 0x4242:<a href="#section-3.2.1-5" class="pilcrow">¶</a></p>
<div id="figure_ibf_insert_1">
<figure id="figure-8">
            <div class="artwork art-text alignLeft" id="section-3.2.1-6.1">
<pre>
            bucket-0     bucket-1       bucket-2      bucket-3
        +-------------+-------------+-------------+-------------+
  count |      0      |      1      |      0      |      1      |
        +-------------+-------------+-------------+-------------+
  idSum |    0x0000   |   0x0102    |    0x0000   |   0x0102    |
        +-------------+-------------+-------------+-------------+
hashSum |    0x0000   |   0x4242    |    0x0000   |   0x4242    |
        +-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a></figcaption></figure>
</div>
<p id="section-3.2.1-7">Insert second element: [1100] with ID 0x0304 and hash 0101:<a href="#section-3.2.1-7" class="pilcrow">¶</a></p>
<div id="figure_ibf_insert_2">
<figure id="figure-9">
            <div class="artwork art-text alignLeft" id="section-3.2.1-8.1">
<pre>
            bucket-0     bucket-1       bucket-2      bucket-3
        +-------------+-------------+-------------+-------------+
  count |      1      |      2      |      0      |      1      |
        +-------------+-------------+-------------+-------------+
  idSum |    0x0304   |   0x0206    |    0x0000   |   0x0102    |
        +-------------+-------------+-------------+-------------+
hashSum |    0x0101   |   0x4343    |    0x0000   |   0x4242    |
        +-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a></figcaption></figure>
</div>
</section>
</div>
<div id="ibf_operations_remove">
<section id="section-3.2.2">
          <h4 id="name-remove-element">
<a href="#section-3.2.2" class="section-number selfRef">3.2.2. </a><a href="#name-remove-element" class="section-name selfRef">Remove Element</a>
          </h4>
<p id="section-3.2.2-1">
                        To remove an element from the IBF the element is again mapped to a subset of the buckets using
                        M.
                        Then all the counters of the buckets selected by M are reduced by one, the IDSUM is
                        replaced by the XOR of the old IDSUM and the ID of the element being removed, and the
                        HASHSUM is similarly replaced with the XOR of the old HASHSUM and the hash of the ID.<a href="#section-3.2.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2.2-2">
                        In the following example the remove operation for the element [1100] with the hash 0x0101 is
                        demonstrated.<a href="#section-3.2.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2.2-3">IBF with encoded elements:<a href="#section-3.2.2-3" class="pilcrow">¶</a></p>
<div id="figure_ibf_remove_0">
<figure id="figure-10">
            <div class="artwork art-text alignLeft" id="section-3.2.2-4.1">
<pre>
            bucket-0     bucket-1       bucket-2      bucket-3
        +-------------+-------------+-------------+-------------+
  count |      1      |      2      |      0      |      1      |
        +-------------+-------------+-------------+-------------+
  idSum |    0x0304   |   0x0206    |    0x0000   |   0x0102    |
        +-------------+-------------+-------------+-------------+
hashSum |   0x0101    |   0x4343    |    0x0000   |   0x4242    |
        +-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a></figcaption></figure>
</div>
<p id="section-3.2.2-5">Remove element [1100] with ID 0x0304 and hash 0x0101 from the IBF:<a href="#section-3.2.2-5" class="pilcrow">¶</a></p>
<div id="figure_ibf_remove_1">
<figure id="figure-11">
            <div class="artwork art-text alignLeft" id="section-3.2.2-6.1">
<pre>
            bucket-0     bucket-1       bucket-2      bucket-3
        +-------------+-------------+-------------+-------------+
  count |      0      |      1      |      0      |      1      |
        +-------------+-------------+-------------+-------------+
  idSum |    0x0000   |   0x0102    |    0x0000   |   0x0102    |
        +-------------+-------------+-------------+-------------+
hashSum |    0x0000   |   0x4242    |    0x0000   |   0x4242    |
        +-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a></figcaption></figure>
</div>
<p id="section-3.2.2-7">
                        Note that it is possible to "remove" elements from an IBF that were never present
                        in the IBF in the first place. A negative counter value is thus indicative of
                        elements that were removed without having been added. Note that an IBF bucket
                        counter of zero no longer warrants that an element mapped to that bucket is not
                        present in the set: a bucket with a counter of zero can be the result of one
                        element being added and a different element (mapped to the same bucket) being removed.
                        To check that an element is not present requires a counter of zero and an
                        IDSUM and HASHSUM of zero --- and some assurance that there was no collision due
                        to the limited number of bits in IDSUM and HASHSUM. Thus,
                        IBFs are not suitable to replace BFs or IBFs.<a href="#section-3.2.2-7" class="pilcrow">¶</a></p>
<p id="section-3.2.2-8">
                        Buckets in an IBF with a counter of 1 or -1 are crucial for decoding an IBF, as
                        they might represent only a single element, with the IDSUM being the ID of that element.
                        Following Eppstein (CITE), we will call buckets that only represent a single
                        element pure buckets.
                        Note that due to the possibility of multiple insertion and removal operations
                        affecting the same bucket, not all buckets with a counter of 1 or -1 are
                        actually pure buckets. Sometimes a counter can be 1 or -1 because N elements
                        mapped to that bucket were added while N-1 or N+1 different elements also
                        mapped to that bucket were removed.<a href="#section-3.2.2-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ibf_operations_decode">
<section id="section-3.2.3">
          <h4 id="name-decode-ibf">
<a href="#section-3.2.3" class="section-number selfRef">3.2.3. </a><a href="#name-decode-ibf" class="section-name selfRef">Decode IBF</a>
          </h4>
<p id="section-3.2.3-1">
                        Decoding an IBF yields the HASH of an element from the IBF, or failure.<a href="#section-3.2.3-1" class="pilcrow">¶</a></p>
<p id="section-3.2.3-2">
                        A decode operation requires a pure bucket, that is a bucket to which M
                        only mapped a single element, to succeed. Thus, if there is no bucket with
                        a counter of 1 or -1, decoding fails. However, as a counter of 1 or -1 is
                        not a guarantee that the bucket is pure, there is also a chance that the
                        decoder returns an IDSUM value that is actually the XOR of several IDSUMs.
                        This is primarily detected by checking that the HASHSUM is the hash of the IDSUM.
                        Only if the HASHSUM also matches, the bucket could be pure. Additionally,
                        one should check that the IDSUM value actually would be mapped by M to
                        the respective bucket. If not, there was a hash collision.<a href="#section-3.2.3-2" class="pilcrow">¶</a></p>
<p id="section-3.2.3-3">
                        The very rare case that after all these checks a bucket is still
                        falsely identified as pure must be detected (say by determining that
                        extracted element IDs do not match any actual elements), and addressed
                        at a higher level in the protocol. As these failures are probabilistic
                        and depend on element IDs and the IBF construction, they can typically
                        be avoided by retrying with different parameters, such as a different
                        way to assign element IDs to elements, using a larger value for L, or
                        a different mapping function M.
                        A more common scenario (especially if L was too small) is that
                        IBF decoding fails because there is no pure bucket. In this case, the
                        higher-level protocol also should retry using different parameters.<a href="#section-3.2.3-3" class="pilcrow">¶</a></p>
<p id="section-3.2.3-4">
                        Suppose the IBF contains a pure bucket. In this case, the IDSUM in the
                        bucket identifies a single element. Furthermore, it is then possible
                        to remove that element from the IBF (by inserting it if the counter
                        was negative, and by removing it if the counter was positive). This
                        is likely to cause other buckets to become pure, allowing further
                        elements to be decoded. Eventually, decoding should succeed with
                        all counters and IDSUM and HASHSUM values reaching zero. However, it is also
                        possible that an IBF only partly decodes and then decoding fails after
                        yielding some elements.<a href="#section-3.2.3-4" class="pilcrow">¶</a></p>
<p id="section-3.2.3-5">
                        In the following example the successful decoding of an IBF containing
                        the two elements previously added in our running example.<a href="#section-3.2.3-5" class="pilcrow">¶</a></p>
<p id="section-3.2.3-6">
                        IBF with the two encoded elements:<a href="#section-3.2.3-6" class="pilcrow">¶</a></p>
<div id="figure_ibf_decode_0">
<figure id="figure-12">
            <div class="artwork art-text alignLeft" id="section-3.2.3-7.1">
<pre>
            bucket-0     bucket-1       bucket-2      bucket-3
        +-------------+-------------+-------------+-------------+
  count |      1      |      2      |      0      |      1      |
        +-------------+-------------+-------------+-------------+
  idSum |   0x0304    |   0x0206    |    0x0000   |   0x0102    |
        +-------------+-------------+-------------+-------------+
hashSum |   0x0101    |   0x4343    |    0x0000   |   0x4242    |
        +-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a></figcaption></figure>
</div>
<p id="section-3.2.3-8">
                        In the IBF are two pure buckets to decode (bit-1 and bit-4) we choose to start with decoding
                        bucket 1,
                        we decode the element with the hash 1010 and we see that there is a new pure bucket created
                        (bit-2)<a href="#section-3.2.3-8" class="pilcrow">¶</a></p>
<div id="figure_ibf_decode_1">
<figure id="figure-13">
            <div class="artwork art-text alignLeft" id="section-3.2.3-9.1">
<pre>
            bucket-0     bucket-1       bucket-2      bucket-3
        +-------------+-------------+-------------+-------------+
  count |      0      |      1      |      0      |      1      |
        +-------------+-------------+-------------+-------------+
  idSum |    0x0000   |   0x0102    |    0x0000   |   0x0102    |
        +-------------+-------------+-------------+-------------+
hashSum |    0x0000   |   0x4242    |    0x0000   |   0x4242    |
        +-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a></figcaption></figure>
</div>
<p id="section-3.2.3-10">
                        In the IBF only pure buckets are left, we choose to continue decoding bucket 2 and decode
                        element
                        with the hash 0x4242. Now the IBF is empty (all buckets have count 0) that means the IBF has
                        successfully
                        decoded.<a href="#section-3.2.3-10" class="pilcrow">¶</a></p>
<div id="figure_ibf_decode_2">
<figure id="figure-14">
            <div class="artwork art-text alignLeft" id="section-3.2.3-11.1">
<pre>
            bucket-0     bucket-1       bucket-2      bucket-3
        +-------------+-------------+-------------+-------------+
  count |      0      |      0      |      0      |      0      |
        +-------------+-------------+-------------+-------------+
  idSum |    0x0000   |    0x0000   |    0x0000   |    0x0000   |
        +-------------+-------------+-------------+-------------+
hashSum |    0x0000   |    0x0000   |    0x0000   |    0x0000   |
        +-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-14" class="selfRef">Figure 14</a></figcaption></figure>
</div>
</section>
</div>
<div id="ibv_operations_setdiff">
<section id="section-3.2.4">
          <h4 id="name-set-difference">
<a href="#section-3.2.4" class="section-number selfRef">3.2.4. </a><a href="#name-set-difference" class="section-name selfRef">Set Difference</a>
          </h4>
<p id="section-3.2.4-1">
                        Given addition and removal as defined above, it is possible to define an operation on IBFs
                        that computes an IBF representing the set difference. Suppose IBF1 represents set A, and
                        IBF2 represents set B. Then this set difference operation will compute IBF3 which
                        represents the set A - B --- without needing elements from set A or B.

                        To calculate the IBF representing this set difference, both IBFs must have the same
                        length L, the same number of buckets per element k and use the same map M. Given this,
                        one can compute the IBF representing the set difference by taking the XOR of the IDSUM and
                        HASHSUM values
                        of the respective buckets and subtracting the respective counters. Care should be taken
                        to handle overflows and underflows by setting the counter to "infinity" as necessary.
                        The result is a new IBF with the same number of buckets representing the set difference.<a href="#section-3.2.4-1" class="pilcrow">¶</a></p>
<p id="section-3.2.4-2">
                        This new IBF can be decoded as described in section<a href="#ibf_operations_decode" class="xref">3.2.3</a>.
                        The new IBF can have two types of pure buckets with counter set to 1 or -1. If the counter is
                        set to 1
                        the element is missing in the secondary set, and if the counter is set to -1 the element is
                        missing in
                        the primary set.<a href="#section-3.2.4-2" class="pilcrow">¶</a></p>
<p id="section-3.2.4-3">
                        To demonstrate the set difference operation we compare IBF-A with IBF-B and generate as
                        described
                        IBF-AB<a href="#section-3.2.4-3" class="pilcrow">¶</a></p>
<p id="section-3.2.4-4">IBF-A containing elements with hashes 0x0101 and 0x4242:<a href="#section-3.2.4-4" class="pilcrow">¶</a></p>
<div id="figure_ibf_setdiff_A">
<figure id="figure-15">
            <div class="artwork art-text alignLeft" id="section-3.2.4-5.1">
<pre>
            bucket-0     bucket-1       bucket-2      bucket-3
        +-------------+-------------+-------------+-------------+
  count |      1      |      2      |      0      |      1      |
        +-------------+-------------+-------------+-------------+
  idSum |    0x0304   |   0x0206    |    0x0000   |   0x0102    |
        +-------------+-------------+-------------+-------------+
hashSum |    0x0101   |   0x4343    |    0x0000   |   0x4242    |
        +-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-15" class="selfRef">Figure 15</a></figcaption></figure>
</div>
<p id="section-3.2.4-6">IBF-B containing elements with hashes 0x4242 and 0x5050<a href="#section-3.2.4-6" class="pilcrow">¶</a></p>
<div id="figure_ibf_setdiff_B">
<figure id="figure-16">
            <div class="artwork art-text alignLeft" id="section-3.2.4-7.1">
<pre>
            bucket-0     bucket-1       bucket-2      bucket-3
        +-------------+-------------+-------------+-------------+
  count |      0      |      1      |      1      |      1      |
        +-------------+-------------+-------------+-------------+
  idSum |    0x0000   |    0x0102   |    0x1345   |    0x0102    |
        +-------------+-------------+-------------+-------------+
hashSum |    0x0000   |    0x4242   |    0x5050   |    0x4242   |
        +-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-16" class="selfRef">Figure 16</a></figcaption></figure>
</div>
<p id="section-3.2.4-8">IBF-AB XOR value and subtract count:<a href="#section-3.2.4-8" class="pilcrow">¶</a></p>
<div id="figure_ibf_setdiff_AB">
<figure id="figure-17">
            <div class="artwork art-text alignLeft" id="section-3.2.4-9.1">
<pre>
            bucket-0     bucket-1       bucket-2      bucket-3
        +-------------+-------------+-------------+-------------+
  count |      1      |      1      |      -1     |      0      |
        +-------------+-------------+-------------+-------------+
  idSum |    0x0304   |    0x0304   |    0x1345   |    0x0000   |
        +-------------+-------------+-------------+-------------+
hashSum |    0x0101   |    0x0101   |    0x5050   |    0x0000   |
        +-------------+-------------+-------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-17" class="selfRef">Figure 17</a></figcaption></figure>
</div>
<p id="section-3.2.4-10">After calculating and decoding the IBF-AB its clear that in IBF-A the element with the hash
                        0x5050
                        is missing (-1 in bit-3) while in IBF-B the element with the hash 0101 is missing
                        (1 in bit-1 and bit-2). The element with hash 0x4242 is present in IBF-A and IBF-B and is
                        removed by the set difference operation (bit-4).<a href="#section-3.2.4-10" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ibf_format">
<section id="section-3.3">
        <h3 id="name-wire-format">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-wire-format" class="section-name selfRef">Wire format</a>
        </h3>
<p id="section-3.3-1">
                    To facilitate a reasonably CPU-efficient
                    implementation, this specification requires the
                    IBF counter to always use 8 bits. Fewer bits
                    would result in a paritcularly inefficient
                    implementation, while more bits are rarely useful
                    as sets with so many elements should likely be
                    represented using a larger number of buckets. This
                    means the counter of this design can reach a
                    minimum of -127 and a maximum of 127 before the
                    counter reaches "infinity" (-128).<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">
                    For the "IDSUM", we always use a 64-bit representation.
                    The IDSUM value must have sufficient entropy for the
                    mapping function M to yield reasonably random buckets
                    even for very large values of L. With a 32 bit
                    value the chance that multiple elements may be mapped
                    to the same ID would be quite high, even for moderately
                    large sets. Using more than 64 bits would at best make
                    sense for very large sets, but then it is likely always
                    better to simply afford additional round trips to handle
                    the occasional collision. 64 bits are also a reasonable
                    size for many CPU architectures.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3">
                    For the "HASHSUM", we always use a 32-bit
                    representation. Here, it is mostly important to
                    avoid collisions, where different elements are
                    mapped to the same hash. However, we note that
                    by design only a few elements (certainly less than
                    127) should ever be mapped
                    to the same bucket, so a small number of bits
                    should suffice. Furthermore, our protocol is designed
                    to handle occasional collisions, so while with
                    32-bits there remains a chance of
                    accidental collisions, at 32 bit the chance is
                    generally believed to be sufficiently small enough
                    for the protocol to handle those cases efficiently
                    for a wide range of use-cases. Smaller hash
                    values would safe bandwidth, but also drastically
                    increase the chance of collisions. 32 bits are
                    also again a reasonable size for many CPU
                    architectures.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
<div id="ibf_format_id_generation">
<section id="section-3.3.1">
          <h4 id="name-id-calculation">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-id-calculation" class="section-name selfRef">ID Calculation</a>
          </h4>
<p id="section-3.3.1-1">
                        The ID is generated as 64-bit output from a
                        <span><a href="https://rfc-editor.org/rfc/rfc5869#section-2" class="relref">Section 2</a> of HKDF construction [<a href="#RFC5869" class="xref">RFC5869</a>]</span>
                        with HMAC-SHA512 as XTR and HMAC-SHA256 as PRF and salt is set to the unsigned 64-bit equivalent
                        of 0.
                        The output is then truncated to 64-bit.
                        Its important that the elements can be redistributed over the buckets in case the IBF does not
                        decode, that's why the ID is salted with a random salt given in the SALT field of this message.
                        Salting is done by calculation the a random salt modulo 64 (using only the lowest 6-bits of the
                        salt)
                        and do a bitwise right rotation of output of KDF by the 6-bit salts numeric representation.<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.3.1-2">
                        Representation in pseudocode:<a href="#section-3.3.1-2" class="pilcrow">¶</a></p>
<div id="ibf_format_id_generation_pseudo_code">
<figure id="figure-18">
            <div class="artwork art-text alignLeft" id="section-3.3.1-3.1">
<pre>
# INPUTS:
# key: Pre calculated and truncated key from id_calculation function
# ibf_salt: Salt of the IBF
# OUTPUT:
# value: salted key
FUNCTION salt_key(key,ibf_salt):
  s = ibf_salt % 64;
  k = key

  /* rotate ibf key */
  k = (k &gt;&gt; s) | (k &lt;&lt; (64 - k))
  return key


# INPUTS:
# element: Element to calculated id from.
# salt: Salt of the IBF
# OUTPUT:
# value: the ID of the element

FUNCTION id_calculation (element,ibf_salt):
    salt = 0
    XTR=HMAC-SHA256
    PRF=HMAC-SHA256
    key = HKDF(XTR, PRF, salt, element)
    key = key modulo 2^64 // Truncate
    return salt_key(key,ibf_salt)


</pre>
</div>
<figcaption><a href="#figure-18" class="selfRef">Figure 18</a></figcaption></figure>
</div>
</section>
</div>
<div id="ibf_format_bucket_identification">
<section id="section-3.3.2">
          <h4 id="name-mapping-function">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-mapping-function" class="section-name selfRef">Mapping Function</a>
          </h4>
<p id="section-3.3.2-1">
                        The mapping function M as described above in the figure
                        <a href="#bf_mapping_function_math" class="xref">Figure 1</a>
                        decides in which buckets the ID and HASH have to be binary XORed to. In practice
                        there the following algorithm is used:<a href="#section-3.3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.3.2-2">
                        The first index is simply the HASH modulo the IBF size. The second
                        index is calculated by creating a new 64-bit value by shifting the 32-bit
                        value left and setting the lower 32-bit to the number of indexes already processed. From the
                        resulting 64-bit value a CRC32 checksum is created the second index is now the modulo of the
                        CRC32 output this is repeated until the predefined amount indexes is generated.
                        In the case a index is hit twice, which would mean this bucket could not get pure again,
                        the second hit is just skipped and the next iteration is used as.<a href="#section-3.3.2-2" class="pilcrow">¶</a></p>
<div id="ibf_format_bucket_identification_pseudo_code">
<figure id="figure-19">
            <div class="artwork art-text alignLeft" id="section-3.3.2-3.1">
<pre>
# INPUTS:
# key: Is the ID of the element calculated in the id_calculation function above.
# number_of_buckets_per_element: Pre-defined count of buckets elements are inserted into
# ibf_size: the size of the ibf (count of buckets)
# OUTPUT:
# dst: Array with bucket IDs to insert ID and HASH

FUNCTION get_bucket_id (key, number_of_buckets_per_element, ibf_size)
  bucket = CRC32(key)

  i = 0
  filled = 0
  WHILE filled &lt; number_of_buckets_per_element

    element_already_in_bucket = false
    j = 0
    WHILE j &lt; filled
      IF dst[j] == bucket modulo ibf_size THEN
        element_already_in_bucket = true
      ENDIF
      j++
    ENDWHILE

    IF !element_already_in_bucket THEN
        dst[filled++] = bucket modulo ibf_size
    ENDIF

    x = (bucket &lt;&lt; 32) | i
    bucket = CRC32(x)

    i++
  ENDWHILE
  return dst
</pre>
</div>
<figcaption><a href="#figure-19" class="selfRef">Figure 19</a></figcaption></figure>
</div>
</section>
</div>
<div id="ibf_format_HASH_calculation">
<section id="section-3.3.3">
          <h4 id="name-hash-calculation">
<a href="#section-3.3.3" class="section-number selfRef">3.3.3. </a><a href="#name-hash-calculation" class="section-name selfRef">HASH calculation</a>
          </h4>
<p id="section-3.3.3-1">
                        The HASH is calculated by calculating the CRC32 checksum of the 64-bit ID value
                        which returns a 32-bit value.<a href="#section-3.3.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="se">
<section id="section-4">
      <h2 id="name-strata-estimator">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-strata-estimator" class="section-name selfRef">Strata Estimator</a>
      </h2>
<div id="se_description">
<section id="section-4.1">
        <h3 id="name-description">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-description" class="section-name selfRef">Description</a>
        </h3>
<p id="section-4.1-1">
                    Strata Estimators help estimate the size of the set difference between two set of elements.
                    This is necessary to efficiently determinate the tuning parameters for an IBF, in particular
                    a good value for L.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">
                    Basically a Strata Estimator (SE) is a series of IBFs (with a rather small value of L)
                    in which increasingly large subsets of the full set
                    of elements are added to each IBF. For the n-th IBF, the function selecting the
                    subset of elements should sample to select (probabilistically) 1/(2^n) of all
                    elements. This can be done by counting the number of trailing bits set to "1"
                    in an element ID, and then inserting the element into the IBF identified by that
                    counter. As a result, all elements will be mapped to one IBF, with the n-th
                    IBF being statistically expected to contain 1/(2^n) elements.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">
                    Given two SEs, the set size difference can be estimated by trying to decode all of the
                    IBFs. Given that L was set to a rather small value, IBFs containing large strata
                    will likely fail to decode. For those IBFs that failed to decode, one simply
                    extrapolates the number of elements by scaling the numbers obtained from the
                    other IBFs that did decode. If none of the IBFs of the SE decoded (which given
                    a reasonable choice of L should be highly unlikely), one can retry using a different
                    mapping function M.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="modeofoperation">
<section id="section-5">
      <h2 id="name-mode-of-operation">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-mode-of-operation" class="section-name selfRef">Mode of operation</a>
      </h2>
<p id="section-5-1">
                The set union protocol uses IBFs and SEs as primitives.
                Depending on the state of the two sets there are different strategies or operation modes how to
                efficiently
                determinate missing elements between the two sets.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">
                The simplest mode is the "full" synchronization mode. The idea is that if the difference between the
                sets of the two
                peers exceeds a certain threshold, the overhead to determine which elements are different outweighs
                the overhead of sending the complete set. In this case, the most efficient method can be to just
                exchange the full sets.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">

                <a href="https://git.gnunet.org/lsd0003.git/plain/statemaschine/full_state_maschine.jpg">Link to
                    statemachine diagram
        </a><a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">
                The second possibility is that the difference of the sets is small compared to the set size.
                Here, an efficient "delta" synchronization mode is more efficient. Given these two possibilities,
                the first steps of the protocol are used to determine which mode should be used.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">
                Thus, the set synchronization protocol always begins with the following operation mode independent
                steps.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">
                The initiating peer begins in the <strong>Initiating Connection</strong> state and the receiving peer in
                the
                <strong>Expecting Connection</strong>
                state. The first step for the initiating peer in the protocol is to send an
                <em>
                    <a href="#messages_operation_request" class="xref">Operation Request</a>
        </em>
                to the receiving peer and
                transition into the <strong>Expect SE</strong> state. After receiving the
                <em>
                    <a href="#messages_operation_request" class="xref">Operation Request</a>
        </em>
                the receiving peer
                transitions to the <strong>Expecting IBF</strong> state and answers with the
                <em>
                    <a href="#messages_se" class="xref">Strata Estimator</a>
        </em>
                message. When the initiating peer receives the
                <em>
                    <a href="#messages_se" class="xref">Strata Estimator</a>
        </em>
                message,
                it decides with some heuristics which operation mode is likely more suitable for the estimated set
                difference and the application-provided latency-bandwidth tradeoff.
                The detailed tradeoff between the
                <a href="#modeofoperation_full-sync" class="xref">Full Synchronisation Mode</a>
                and the
                <a href="#modeofoperation_individual-elements" class="xref">Delta Synchronisation Mode</a>
                is explained in the section<a href="#modeofoperation_combined-mode" class="xref">Combined Mode</a>.<a href="#section-5-6" class="pilcrow">¶</a></p>
<div id="modeofoperation_full-sync">
<section id="section-5.1">
        <h3 id="name-full-synchronisation-mode">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-full-synchronisation-mode" class="section-name selfRef">Full Synchronisation Mode</a>
        </h3>
<p id="section-5.1-1">
                    When the initiating peer decides to use the full synchronisation mode and the set of the initiating
                    peer is bigger than the set of the receiving peer, the initiating
                    peer sends a
                    <em>
                        <a href="#messages_request_full" class="xref">Request Full</a>
          </em>
                    message, and transitions from <strong>Expecting SE</strong> to the <strong>Full Receiving</strong> state.
                    If the set of the initiating peer is smaller, it sends all set elements to the other peer followed
                    by the
                    <em>
                        <a href="#messages_full_done" class="xref">Full Done</a>
          </em>
                    message, and
                    transitions into the <strong>Full Sending</strong> state.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">

                    <a href="https://git.gnunet.org/lsd0003.git/plain/statemaschine/full_state_maschine.jpg">Link
                        to statemachine diagram
          </a><a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">
                    <strong>The behavior of the participants the different state is described below:</strong><a href="#section-5.1-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.1-4">
          <dt id="section-5.1-4.1">
                        <strong>Expecting IBF:</strong>
          </dt>
          <dd style="margin-left: 1.5em" id="section-5.1-4.2">
                        If a peer in the <strong>Expecting IBF</strong> state receives a
                        <em>
                            <a href="#messages_request_full" class="xref">Request Full</a>
            </em>
                        message from the other peer, the
                        peer sends all the elements of its set followed by a
                        <em>
                            <a href="#messages_full_done" class="xref">Full Done</a>
            </em>
                        message to the other peer, and transitions to the
                        <strong>Full Sending</strong>
                        state. If the peer receives an
                        <em>
                            <a href="#messages_full_element" class="xref">Full Element</a>
            </em>
                        message, it processes the element and transitions to the <strong>Full Receiving</strong> state.<a href="#section-5.1-4.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-4.3">
                        <strong>Full Sending:</strong>
          </dt>
          <dd style="margin-left: 1.5em" id="section-5.1-4.4">
                        While a peer is in <strong>Full Sending</strong> state the peer expects to continuously receive
                        elements from the other
                        peer. As soon as a the
                        <em>
                            <a href="#messages_full_done" class="xref">Full Done</a>
            </em>
                        message is received, the peer transitions into
                        the <strong>Finished</strong> state.<a href="#section-5.1-4.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-4.5">
                        <strong>Full Receiving (In code: Expecting IBF):</strong>
          </dt>
          <dd style="margin-left: 1.5em" id="section-5.1-4.6">
                        While a peer is in the <strong>Full Receiving</strong> state, it expects to continuously receive
                        elements from the other
                        peer. As soon as a the
                        <em>
                            <a href="#messages_full_done" class="xref">Full Done</a>
            </em>
                        message is received, it sends
                        the remaining elements (those it did not receive) from its set to the other
                        peer, followed by a
                        <em>
                            <a href="#messages_full_done" class="xref">Full Done</a>
            </em>
                        .
                        After sending the last message, the peer transitions into the <strong>Finished</strong> state.<a href="#section-5.1-4.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="modeofoperation_individual-elements">
<section id="section-5.2">
        <h3 id="name-delta-synchronisation-mode">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-delta-synchronisation-mode" class="section-name selfRef">Delta Synchronisation Mode</a>
        </h3>
<p id="section-5.2-1">
                    When the initiating peer in the <strong>Expected SE</strong> state decides to use the delta
                    synchronisation mode, it
                    sends a
                    <em>
                        <a href="#messages_ibf" class="xref">IBF</a>
          </em>
                    to the receiving peer and transitions into the <strong>Passive Decoding</strong> state.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">
                    The receiving peer in the <strong>Expecting IBF</strong> state receives the
                    <em>
                        <a href="#messages_ibf" class="xref">IBF</a>
          </em>
                    message from
                    the initiating peer and transitions into the <strong>Expecting IBF Last</strong> state when there
                    are multiple
                    <em>
                        <a href="#messages_ibf" class="xref">IBF</a>
          </em>
                    messages to sent,
                    when there is just a single
                    <em>
                        <a href="#messages_ibf" class="xref">IBF</a>
          </em>
                    message the reviving peer
                    transitions directly to the <strong>Active Decoding</strong> state.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">
                    The peer that is in the <strong>Active Decoding</strong>, <strong>Finish Closing</strong> or in the
                    <strong>Expecting IBF Last</strong>
                    state is called the active peer and the peer that is in either the <strong>Passive Decoding</strong> or
                    the <strong>Finish Waiting</strong> state
                    is called the passive peer.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<p id="section-5.2-4">

                    <a href="https://git.gnunet.org/lsd0003.git/plain/statemaschine/full_state_maschine.jpg">Link
                        to statemachine diagram
          </a><a href="#section-5.2-4" class="pilcrow">¶</a></p>
<p id="section-5.2-5">
                    <strong>The behavior of the participants the different states is described below:</strong><a href="#section-5.2-5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.2-6">
          <dt id="section-5.2-6.1">
                        <strong>Passive Decoding:</strong>
          </dt>
          <dd style="margin-left: 1.5em" id="section-5.2-6.2">
            <p id="section-5.2-6.2.1">
                            In the <strong>Passive Decoding</strong> state the passive peer reacts to requests from the
                            active peer.
                            The action the passive peer executes depends on the message the passive peer receives in the <strong>
                            Passive Decoding
              </strong> state from the active peer
                            and is described below on a per message basis.<a href="#section-5.2-6.2.1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.2-6.2.2">
              <dt id="section-5.2-6.2.2.1">
                                <em>
                                    <a href="#messages_inquiry" class="xref">Inquiry</a>
                </em>
                                message:
              </dt>
              <dd style="margin-left: 1.5em" id="section-5.2-6.2.2.2">
                                The
                                <em>
                                    <a href="#messages_inquiry" class="xref">Inquiry</a>
                </em>
                                message
                                is received if the active peer requests the SHA-512 hash of one or more elements (by
                                sending the 64 bit element ID)
                                that are missing from the active peer's set.
                                In this case the passive peer answers with
                                <em>
                                    <a href="#messages_offer" class="xref">Offer</a>
                </em>
                                messages
                                which contain the SHA-512 hash of the requested element. If the passive peer does not
                                have an element with
                                a matching element ID, it MUST ignore the inquiry. If multiple elements match the 64 bit
                                element ID, the passive
                                peer MUST send offers for all of the matching elements.<a href="#section-5.2-6.2.2.2" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-5.2-6.2.2.3">
                                <em>
                                    <a href="#messages_demand" class="xref">Demand</a>
                </em>
                                message:
              </dt>
              <dd style="margin-left: 1.5em" id="section-5.2-6.2.2.4">
                                The
                                <em>
                                    <a href="#messages_demand" class="xref">Demand</a>
                </em>
                                message
                                is received if the active peer requests a complete element that is missing in the active
                                peers set. If the requested element is valid
                                the passive peer answers with an
                                <em>
                                    <a href="#messages_elements" class="xref">Elements</a>
                </em>
                                message which contains the full,
                                application-dependent data of the requested element. If the passive peer receives a
                                demand for a SHA-512 hash for which
                                it has no element, a protocol violation is detected and the protocol MUST be aborted.
                                Implementations MAY strengthen this and forbid demands without previous matching offers.<a href="#section-5.2-6.2.2.4" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-5.2-6.2.2.5">
                                <em>
                                    <a href="#messages_offer" class="xref">Offer</a>
                </em>
                                message:
              </dt>
              <dd style="margin-left: 1.5em" id="section-5.2-6.2.2.6">
                                The
                                <em>
                                    <a href="#messages_offer" class="xref">Offer</a>
                </em>
                                message
                                is received if the active peer has decoded an element that is present in the active
                                peers set and may be missing in the
                                set of the passive peer. If the SHA-512 hash of the offer is indeed not a hash of any of
                                the elements from the set of
                                the passive peer, the passive peer MUST answer with a
                                <em>
                                    <a href="#messages_demand" class="xref">Demand</a>
                </em>
                                message
                                for that SHA-512 hash and remember that it issued this demand. The send demand need to
                                be added to a list with unsatisfied demands.<a href="#section-5.2-6.2.2.6" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-5.2-6.2.2.7">
                                <em>
                                    <a href="#messages_elements" class="xref">Elements</a>
                </em>
                                message:
              </dt>
              <dd style="margin-left: 1.5em" id="section-5.2-6.2.2.8">
                                When a new element message has been received the peer checks if a corresponding
                                <em>
                                    <a href="#messages_demand" class="xref">Demand</a>
                </em>
                                for the element has been sent
                                and the demand is still unsatisfied.
                                If the element has been demanded the peer checks the element for validity, removed it
                                from the list
                                of pending demands and then then saves the element to the the set otherwise the peer
                                rejects the element.<a href="#section-5.2-6.2.2.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-5.2-6.2.2.9">
                                <em>
                                    <a href="#messages_ibf" class="xref">IBF</a>
                </em>
                                message:
              </dt>
              <dd style="margin-left: 1.5em" id="section-5.2-6.2.2.10">
                                If an
                                <em>
                                    <a href="#messages_ibf" class="xref">IBF</a>
                </em>
                                message is received, this
                                indicates that decoding of the IBF on the active site has failed and roles should be
                                swapped.
                                The receiving passive peer transitions into the <strong>Expecting IBF Last</strong> state,
                                and waits for more
                                <em>
                                    <a href="#messages_ibf" class="xref">IBF</a>
                </em>
                                messages
                                or the final
                                <em>
                                    <a href="#messages_ibf_last" class="xref">IBF</a>
                </em>
                                message to be received.<a href="#section-5.2-6.2.2.10" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-5.2-6.2.2.11">
                                <em>
                                    <a href="#messages_ibf_last" class="xref">IBF</a>
                </em>
                                message:
              </dt>
              <dd style="margin-left: 1.5em" id="section-5.2-6.2.2.12">
                                If an
                                <em>
                                    <a href="#messages_ibf_last" class="xref">IBF</a>
                </em>
                                message is received this
                                indicates that the there is just one IBF slice and a direct state and role transition
                                from
                                <strong>Passive Decoding</strong>
                                to <strong>Active Decoding</strong> is initiated.<a href="#section-5.2-6.2.2.12" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-5.2-6.2.2.13">
                                <em>
                                    <a href="#messages_done" class="xref">Done</a>
                </em>
                                message:
              </dt>
              <dd style="margin-left: 1.5em" id="section-5.2-6.2.2.14">
                                Receiving the
                                <em>
                                    <a href="#messages_done" class="xref">Done</a>
                </em>
                                message signals
                                the passive peer that all demands of the active peer have been satisfied. Alas, the
                                active peer will continue to process demands from the passive peer.
                                Upon receiving this message, the passive peer transitions into the
                                <strong>Finish Waiting</strong>
                                state.<a href="#section-5.2-6.2.2.14" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-6.3">
                        <strong>Active Decoding:</strong>
          </dt>
          <dd style="margin-left: 1.5em" id="section-5.2-6.4">
            <p id="section-5.2-6.4.1">
                            In the <strong>Active Decoding</strong> state the active peer decodes the IBFs and evaluates
                            the set difference
                            between the active and passive peer. Whenever an element ID is obtained by decoding the IBF,
                            the active peer
                            sends either an offer or an inquiry to the passive peer, depending on which site the decoded
                            element is missing.<a href="#section-5.2-6.4.1" class="pilcrow">¶</a></p>
<p id="section-5.2-6.4.2">
                            If the IBF decodes a positive (1) pure bucket, the element is missing on the passive peers
                            site.
                            Thus the active peer sends an
                            <em>
                                <a href="#messages_offer" class="xref">Offer</a>
              </em>
                            to the passive peer.
                            A negative (-1) pure bucket indicates that a element is missing in the active peers set, so
                            the active peer
                            sends a
                            <em>
                                <a href="#messages_inquiry" class="xref">Inquiry</a>
              </em>
                            to the passive peer.<a href="#section-5.2-6.4.2" class="pilcrow">¶</a></p>
<p id="section-5.2-6.4.3">
                            In case the IBF does not successfully decode anymore, the active peer sends a new IBF to the
                            passive client
                            and changes into <strong>Passive Decoding</strong> state. This initiates a role swap.
                            To reduce overhead and prevent double transmission of offers and elements the new IBF is
                            created
                            on the new complete set after all demands and inquiries have been satisfied.<a href="#section-5.2-6.4.3" class="pilcrow">¶</a></p>
<p id="section-5.2-6.4.4">
                            As soon as the active peer successfully finished decoding the IBF, the active peer sends a
                            <em>
                                <a href="#messages_done" class="xref">Done</a>
              </em>
                            message to the passive peer.<a href="#section-5.2-6.4.4" class="pilcrow">¶</a></p>
<p id="section-5.2-6.4.5">
                            All other actions taken by the active peer depend on the message the active peer receives
                            from
                            the passive peer. The actions are described below on a per message basis:<a href="#section-5.2-6.4.5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.2-6.4.6">
              <dt id="section-5.2-6.4.6.1">
                                <em>
                                    <a href="#messages_offer" class="xref">Offer</a>
                </em>
                                message:
              </dt>
              <dd style="margin-left: 1.5em" id="section-5.2-6.4.6.2">
                                The
                                <em>
                                    <a href="#messages_offer" class="xref">Offer</a>
                </em>
                                message indicates that the
                                passive peer received a
                                <em>
                                    <a href="#messages_inquiry" class="xref">Inquiry</a>
                </em>
                                message from
                                the active peer. If a Inquiry has been sent and
                                the offered element is missing in the active peers set,
                                the active peer sends a
                                <em>
                                    <a href="#messages_demand" class="xref">Demand</a>
                </em>
                                message to the
                                passive peer. The send demand need to be added to a list with unsatisfied demands.
                                In the case the received offer is for an element that is already in the set of the peer
                                the offer is ignored.<a href="#section-5.2-6.4.6.2" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-5.2-6.4.6.3">
                                <em>
                                    <a href="#messages_demand" class="xref">Demand</a>
                </em>
                                message:
              </dt>
              <dd style="margin-left: 1.5em" id="section-5.2-6.4.6.4">
                                The
                                <em>
                                    <a href="#messages_demand" class="xref">Demand</a>
                </em>
                                message indicates that the
                                passive peer received a
                                <em>
                                    <a href="#messages_offer" class="xref">Offer</a>
                </em>
                                from
                                the active peer. The active peer satisfies the demand of the passive peer by sending
                                <em>
                                    <a href="#messages_elements" class="xref">Elements</a>
                </em>
                                message if a offer request
                                for the element has been sent.

                                In the case the demanded element does not exist in the
                                set there was probably a bucket decoded that was not really pure so potentially all
                                <em>
                                    <a href="#messages_offer" class="xref">Offer</a>
                </em>
                                and
                                <em>
                                    <a href="#messages_demand" class="xref">Demand</a>
                </em>
                                messages sent after are invalid
                                in this case a role change active -&gt; passive with a new IBF is easiest.
                                If a demand for the same element is received multiple times the demands should be
                                discarded.<a href="#section-5.2-6.4.6.4" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-5.2-6.4.6.5">
                                <em>
                                    <a href="#messages_elements" class="xref">Elements</a>
                </em>
                                message:
              </dt>
              <dd style="margin-left: 1.5em" id="section-5.2-6.4.6.6">
                                A element that is received is marked in the list of demanded elements as satisfied,
                                validated and
                                saved and not further action is taken.
                                Elements that are not demanded or already known are discarded.<a href="#section-5.2-6.4.6.6" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-5.2-6.4.6.7">
                                <em>
                                    <a href="#messages_done" class="xref">Done</a>
                </em>
                                message:
              </dt>
              <dd style="margin-left: 1.5em" id="section-5.2-6.4.6.8">
                                Receiving the message
                                <em>
                                    <a href="#messages_done" class="xref">Done</a>
                </em>
                                indicates
                                that all demands of the passive peer have been satisfied. The active peer then changes
                                into the
                                state <strong>Finish Closing</strong> state.

                                If the IBF is not finished decoding and the
                                <em>
                                    <a href="#messages_done" class="xref">Done</a>
                </em>
                                is received the other peer is not in compliance with the protocol and the set
                                reconciliation MUST be aborted.<a href="#section-5.2-6.4.6.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-6.5">
                        <strong>Expecing IBF Last</strong>
          </dt>
          <dd style="margin-left: 1.5em" id="section-5.2-6.6">
            <p id="section-5.2-6.6.1">
                            In the <strong>Expecing IBF Last</strong> state the active peer continuously receives
                            <em>
                                <a href="#messages_ibf" class="xref">IBF</a>
              </em>
                            messages from the passive peer. When the last
                            <em>
                                <a href="#messages_ibf_last" class="xref">IBF</a>
              </em>
                            message is received
                            the active peer changes into <strong>Active Decoding</strong> state.<a href="#section-5.2-6.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-6.7">
                        <strong>Finish Closing</strong>
                        /
                        <strong>Finish Waiting</strong>
          </dt>
          <dd style="margin-left: 1.5em" id="section-5.2-6.8">
            <p id="section-5.2-6.8.1">
                            In this states the peers are waiting for all demands to be satisfied and for the
                            synchronisation
                            to be completed. When all demands are satisfied the peer changes into state <strong>
                            Finished</strong>.<a href="#section-5.2-6.8.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="modeofoperation_combined-mode">
<section id="section-5.3">
        <h3 id="name-combined-mode">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-combined-mode" class="section-name selfRef">Combined Mode</a>
        </h3>
<p id="section-5.3-1">
                    In the combined mode the
                    <a href="#modeofoperation_full-sync" class="xref">Full Synchronisation Mode</a>
                    and
                    the
                    <a href="#modeofoperation_individual-elements" class="xref">Delta Synchronisation Mode</a>
                    are combined to minimize resource consumption.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">
                    The
                    <a href="#modeofoperation_individual-elements" class="xref">Delta Synchronisation Mode</a>
                    is only efficient on small set
                    differences or if the byte-size of the elements is large. Is the set difference is estimated to be
                    large
                    the
                    <a href="#modeofoperation_full-sync" class="xref">Full Synchronisation Mode</a>
                    is
                    more efficient. The exact heuristics and parameters on which the protocol decides which mode
                    should be used are described in the section of this document.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">
                    There are two main cases when a
                    <a href="#modeofoperation_full-sync" class="xref">Full Synchronisation Mode</a>
                    is always used.
                    The first case is when one of the peers announces having an empty set. This is announced by setting
                    the SETSIZE field in the
                    <em>
                        <a href="#messages_se" class="xref">Strata Estimator</a>
          </em>
                    to 0.
                    The second case is if the application requested full synchronization explicitly.
                    This is useful for testing and should not be used in production.<a href="#section-5.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="messages">
<section id="section-6">
      <h2 id="name-messages">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-messages" class="section-name selfRef">Messages</a>
      </h2>
<div id="messages_operation_request">
<section id="section-6.1">
        <h3 id="name-operation-request">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-operation-request" class="section-name selfRef">Operation Request</a>
        </h3>
<div id="messages_operation_request_description">
<section id="section-6.1.1">
          <h4 id="name-description-2">
<a href="#section-6.1.1" class="section-number selfRef">6.1.1. </a><a href="#name-description-2" class="section-name selfRef">Description</a>
          </h4>
<p id="section-6.1.1-1">
                        This message is the first message of the protocol and it is sent to signal to the receiving peer
                        that the initiating peer wants to initialize a new connection.<a href="#section-6.1.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1.1-2">
                        This message is sent in the transition between the <strong>Initiating Connection</strong> state
                        and the <strong>Expect SE</strong> state.<a href="#section-6.1.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1.1-3">
                        If a peer receives this message and is willing to run the protocol, it answers by sending back a
                        <em>
                            <a href="#messages_se" class="xref">Strata Estimator</a>
            </em>
                        message.
                        Otherwise it simply closes the connection.<a href="#section-6.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="messages_operation_request_structure">
<section id="section-6.1.2">
          <h4 id="name-structure-2">
<a href="#section-6.1.2" class="section-number selfRef">6.1.2. </a><a href="#name-structure-2" class="section-name selfRef">Structure</a>
          </h4>
<div id="figure_operation_request">
<figure id="figure-20">
            <div class="artwork art-text alignLeft" id="section-6.1.2-1.1">
<pre>
        0     8     16    24    32    40    48    56
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |  MSG SIZE |  MSG TYPE |    ELEMENT COUNT      |
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |                      APX
        +-----+-----+-----+-----+-----+-----+-----+-----+                                               /
        /                                               /
        /                                               /
</pre>
</div>
<figcaption><a href="#figure-20" class="selfRef">Figure 20</a></figcaption></figure>
</div>
<p id="section-6.1.2-2">where:<a href="#section-6.1.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.1.2-3">
            <dt id="section-6.1.2-3.1">MSG SIZE</dt>
            <dd style="margin-left: 1.5em" id="section-6.1.2-3.2">
                            is 16-bit unsigned integer in network byte order witch describes the message size in bytes
                            and the header is included.<a href="#section-6.1.2-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.1.2-3.3">MSG TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.1.2-3.4">
                            the type of SETU_P2P_OPERATION_REQUEST as registered in<a href="#gana" class="xref">GANA Considerations</a>,
                            in network byte order.<a href="#section-6.1.2-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.1.2-3.5">ELEMENT COUNT</dt>
            <dd style="margin-left: 1.5em" id="section-6.1.2-3.6">
                            is the number of the elements the requesting party has in its set, as a 32-bit unsigned
                            integer in network byte order.<a href="#section-6.1.2-3.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.1.2-3.7">APX</dt>
            <dd style="margin-left: 1.5em" id="section-6.1.2-3.8">
                            is a SHA-512 hash that identifies the application.<a href="#section-6.1.2-3.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="messages_ibf">
<section id="section-6.2">
        <h3 id="name-ibf">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-ibf" class="section-name selfRef">IBF</a>
        </h3>
<div id="messages_ibf_description">
<section id="section-6.2.1">
          <h4 id="name-description-3">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-description-3" class="section-name selfRef">Description</a>
          </h4>
<p id="section-6.2.1-1">
                        The IBF message contains a slice of the IBF.<a href="#section-6.2.1-1" class="pilcrow">¶</a></p>
<p id="section-6.2.1-2">
                        The <em>IBF</em> message is sent at the start of the protocol from the initiating peer in the
                        transaction
                        between <strong>Expect SE</strong> -&gt; <strong>Expecting IBF Last</strong> or when the IBF does
                        not
                        decode and there is a role change in the transition between <strong>Active Decoding</strong> -&gt; <strong>
                        Expecting IBF Last</strong>.
                        This message is only sent if there are more than one IBF slice to sent, in the case there is
                        just
                        one slice the
                        <a href="#messages_ibf_last" class="xref">IBF</a>
                        message is sent.<a href="#section-6.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="messages_ibf_structure">
<section id="section-6.2.2">
          <h4 id="name-structure-3">
<a href="#section-6.2.2" class="section-number selfRef">6.2.2. </a><a href="#name-structure-3" class="section-name selfRef">Structure</a>
          </h4>
<div id="figure_ibf">
<figure id="figure-21">
            <div class="artwork art-text alignLeft" id="section-6.2.2-1.1">
<pre>
        0     8     16    24    32    40    48    56
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |  MSG SIZE |  MSG TYPE |ORDER|       PAD       |
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |         OFFSET        |          SALT         |
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |                  IBF-SLICE
        +                                               /
        /                                               /
        /                                               /
</pre>
</div>
<figcaption><a href="#figure-21" class="selfRef">Figure 21</a></figcaption></figure>
</div>
<p id="section-6.2.2-2">where:<a href="#section-6.2.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.2.2-3">
            <dt id="section-6.2.2-3.1">MSG SIZE</dt>
            <dd style="margin-left: 1.5em" id="section-6.2.2-3.2">
                            is 16-bit unsigned integer in network byte order witch describes the message size in bytes
                            and the header is included.<a href="#section-6.2.2-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.2.2-3.3">MSG TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.2.2-3.4">
                            the type of SETU_P2P_REQUEST_IBF as registered in
                            <a href="#gana" class="xref">GANA Considerations</a>
                            in network byte order.<a href="#section-6.2.2-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.2.2-3.5">ORDER</dt>
            <dd style="margin-left: 1.5em" id="section-6.2.2-3.6">
                            is a 8-bit unsigned integer which signals the order of the IBF. The order of the IBF
                            is defined as the logarithm of the number of buckets of the IBF.<a href="#section-6.2.2-3.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.2.2-3.7">PAD</dt>
            <dd style="margin-left: 1.5em" id="section-6.2.2-3.8">
                            is 24-bit always set to zero<a href="#section-6.2.2-3.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.2.2-3.9">OFFSET</dt>
            <dd style="margin-left: 1.5em" id="section-6.2.2-3.10">
                            is a 32-bit unsigned integer which signals the offset to the following ibf slices in the
                            original.<a href="#section-6.2.2-3.10" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.2.2-3.11">SALT</dt>
            <dd style="margin-left: 1.5em" id="section-6.2.2-3.12">
                            is a 32-bit unsigned integer that contains the salt which was used to create the
                            IBF.<a href="#section-6.2.2-3.12" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.2.2-3.13">IBF-SLICE</dt>
            <dd style="margin-left: 1.5em" id="section-6.2.2-3.14">
              <p id="section-6.2.2-3.14.1">
                                are variable count of slices in an array. A single slice contains out multiple 64-bit
                                IDSUMS,
                                32-bit HASHSUMS and 8-bit COUNTERS. In the network order the array of IDSUMS is first,
                                followed
                                by an array of HASHSUMS and ended with an array of COUNTERS. Length of the array is
                                defined
                                by MIN( 2^ORDER - OFFSET, MAX_BUCKETS_PER_MESSAGE). MAX_BUCKETS_PER_MESSAGE is defined
                                as
                                32768 divided by the BUCKET_SIZE which is 13-byte (104-bit).<a href="#section-6.2.2-3.14.1" class="pilcrow">¶</a></p>
<p id="section-6.2.2-3.14.2">
                                To get the IDSUM field, all IDs who hit a bucket are added up with a binary XOR
                                operation.
                                See
                                <a href="#ibf_format_id_generation" class="xref">ID Calculation</a>
                                for details about ID generation.<a href="#section-6.2.2-3.14.2" class="pilcrow">¶</a></p>
<p id="section-6.2.2-3.14.3">
                                The calculation of the HASHSUM field is done accordingly to the calculation of the IDSUM
                                field:
                                all HASHes are added up with a binary XOR operation.
                                The HASH value is calculated as described in detail in section<a href="#ibf_format_HASH_calculation" class="xref">HASH calculation</a>.<a href="#section-6.2.2-3.14.3" class="pilcrow">¶</a></p>
<p id="section-6.2.2-3.14.4">
                                The algorithm to find the correct bucket in which the ID and the HASH have to be added
                                is described in detail in section<a href="#ibf_format_bucket_identification" class="xref">Mapping Function</a>.<a href="#section-6.2.2-3.14.4" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
<div id="figure_ibf_slice">
<figure id="figure-22">
            <div class="artwork art-text alignLeft" id="section-6.2.2-4.1">
<pre>
                             IBF-SLICE
        0     8     16    24    32    40    48    56
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |                    IDSUMS                     |
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |                    IDSUMS                     |
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |         HASHSUMS      |        HASHSUMS       |
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |        COUNTERS       |       COUNTERS        |
        +-----+-----+-----+-----+-----+-----+-----+-----+
        /                                               /
        /                                               /
</pre>
</div>
<figcaption><a href="#figure-22" class="selfRef">Figure 22</a></figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="messages_ibf_last">
<section id="section-6.3">
        <h3 id="name-ibf-2">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-ibf-2" class="section-name selfRef">IBF</a>
        </h3>
<div id="messages_ibf_last_description">
<section id="section-6.3.1">
          <h4 id="name-description-4">
<a href="#section-6.3.1" class="section-number selfRef">6.3.1. </a><a href="#name-description-4" class="section-name selfRef">Description</a>
          </h4>
<p id="section-6.3.1-1">
                        This message indicates to the remote peer that all slices of the bloom filter have been sent.
                        The binary structure is exactly the same as the
                        <a href="#messages_ibf_structure" class="xref">Structure</a>
                        of
                        the message
                        <a href="#messages_ibf" class="xref">IBF</a>
                        with a different "MSG TYPE"
                        which is defined in
                        <a href="#gana" class="xref">GANA Considerations</a>
                        "SETU_P2P_IBF_LAST".<a href="#section-6.3.1-1" class="pilcrow">¶</a></p>
<p id="section-6.3.1-2">
                        Receiving this message initiates the state transmissions
                        <strong>Expecting IBF Last</strong>
                        -&gt; <strong>Active Decoding</strong>,
                        <strong>Expecting IBF</strong>
                        -&gt; <strong>Active Decoding</strong> and
                        <strong>Passive Decoding</strong>
                        -&gt; <strong>Active Decoding</strong>. This message
                        can initiate a peer the roll change from <strong>Active Decoding</strong> to
                        <strong>Passive Decoding</strong>.<a href="#section-6.3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="messages_elements">
<section id="section-6.4">
        <h3 id="name-elements">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-elements" class="section-name selfRef">Elements</a>
        </h3>
<div id="messages_elements_description">
<section id="section-6.4.1">
          <h4 id="name-description-5">
<a href="#section-6.4.1" class="section-number selfRef">6.4.1. </a><a href="#name-description-5" class="section-name selfRef">Description</a>
          </h4>
<p id="section-6.4.1-1">
                        The Element message contains an element that is synchronized in the
                        <a href="#modeofoperation_individual-elements" class="xref">Delta Synchronisation Mode</a>
                        and transmits a full element between the peers.<a href="#section-6.4.1-1" class="pilcrow">¶</a></p>
<p id="section-6.4.1-2">
                        This message is sent in the state <strong>Active Decoding</strong> and
                        <strong>Passive Decoding</strong>
                        as answer to a
                        <em>
                            <a href="#messages_demand" class="xref">Demand</a>
            </em>
                        message from the remote peer.
                        The Element message can also be received in the <strong>Finish Closing</strong> or
                        <strong>Finish Waiting</strong>
                        state after receiving a
                        <em>
                            <a href="#messages_done" class="xref">Done</a>
            </em>
                        message from the remote peer, in this
                        case the client changes to the <strong>Finished</strong> state as soon as all demands for
                        elements have been satisfied.<a href="#section-6.4.1-2" class="pilcrow">¶</a></p>
<p id="section-6.4.1-3">
                        This message is exclusively sent in the<a href="#modeofoperation_individual-elements" class="xref">Delta Synchronisation Mode</a>.<a href="#section-6.4.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="messages_elements_structure">
<section id="section-6.4.2">
          <h4 id="name-structure-4">
<a href="#section-6.4.2" class="section-number selfRef">6.4.2. </a><a href="#name-structure-4" class="section-name selfRef">Structure</a>
          </h4>
<div id="figure_elements">
<figure id="figure-23">
            <div class="artwork art-text alignLeft" id="section-6.4.2-1.1">
<pre>
        0     8     16    24    32    40    48    56
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |  MSG SIZE |  MSG TYPE |   E TYPE  |  PADDING  |
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |   E SIZE  |   AE TYPE |           DATA
        +-----+-----+-----+-----+                       /
        /                                               /
        /                                               /
</pre>
</div>
<figcaption><a href="#figure-23" class="selfRef">Figure 23</a></figcaption></figure>
</div>
<p id="section-6.4.2-2">where:<a href="#section-6.4.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.4.2-3">
            <dt id="section-6.4.2-3.1">MSG SIZE</dt>
            <dd style="margin-left: 1.5em" id="section-6.4.2-3.2">
                            is 16-bit unsigned integer in network byte order witch describes the message size in bytes
                            and the header is included.<a href="#section-6.4.2-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.4.2-3.3">MSG TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.4.2-3.4">
                            the type of SETU_P2P_ELEMENTS as registered in
                            <a href="#gana" class="xref">GANA Considerations</a>
                            in network byte order.<a href="#section-6.4.2-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.4.2-3.5">E TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.4.2-3.6">
                            element type is a 16-bit unsigned integer witch defines the element type for
                            the application.<a href="#section-6.4.2-3.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.4.2-3.7">PADDING</dt>
            <dd style="margin-left: 1.5em" id="section-6.4.2-3.8">
                            is 16-bit always set to zero<a href="#section-6.4.2-3.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.4.2-3.9">E SIZE</dt>
            <dd style="margin-left: 1.5em" id="section-6.4.2-3.10">
                            element size is 16-bit unsigned integer that signals the size of the elements data part.<a href="#section-6.4.2-3.10" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.4.2-3.11">AE TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.4.2-3.12">
                            application specific element type is a 16-bit unsigned integer that is needed to identify
                            the type of element that is in the data field<a href="#section-6.4.2-3.12" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.4.2-3.13">DATA</dt>
            <dd style="margin-left: 1.5em" id="section-6.4.2-3.14">
                            is a field with variable length that contains the data of the element.<a href="#section-6.4.2-3.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="messages_offer">
<section id="section-6.5">
        <h3 id="name-offer">
<a href="#section-6.5" class="section-number selfRef">6.5. </a><a href="#name-offer" class="section-name selfRef">Offer</a>
        </h3>
<div id="messages_offer_description">
<section id="section-6.5.1">
          <h4 id="name-description-6">
<a href="#section-6.5.1" class="section-number selfRef">6.5.1. </a><a href="#name-description-6" class="section-name selfRef">Description</a>
          </h4>
<p id="section-6.5.1-1">
                        The offer message is an answer to an
                        <em>
                            <a href="#messages_inquiry" class="xref">Inquiry</a>
            </em>
                        message
                        and transmits the full hash of an element that has been requested by the other peer.
                        This full hash enables the other peer to check if the element is really missing in its set and
                        eventually sends a
                        <em>
                            <a href="#messages_demand" class="xref">Demand</a>
            </em>
                        message for that a element.<a href="#section-6.5.1-1" class="pilcrow">¶</a></p>
<p id="section-6.5.1-2">
                        The offer is sent and received only in the <strong>Active Decoding</strong> and in the
                        <strong>Passive Decoding</strong>
                        state.<a href="#section-6.5.1-2" class="pilcrow">¶</a></p>
<p id="section-6.5.1-3">
                        This message is exclusively sent in the<a href="#modeofoperation_individual-elements" class="xref">Delta Synchronisation Mode</a>.<a href="#section-6.5.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="messages_offer_structure">
<section id="section-6.5.2">
          <h4 id="name-structure-5">
<a href="#section-6.5.2" class="section-number selfRef">6.5.2. </a><a href="#name-structure-5" class="section-name selfRef">Structure</a>
          </h4>
<div id="figure_offer">
<figure id="figure-24">
            <div class="artwork art-text alignLeft" id="section-6.5.2-1.1">
<pre>
        0     8     16    24    32    40    48    56
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |  MSG SIZE |  MSG TYPE |         HASH
        +-----+-----+-----+-----+
        /                                               /
        /                                               /
</pre>
</div>
<figcaption><a href="#figure-24" class="selfRef">Figure 24</a></figcaption></figure>
</div>
<p id="section-6.5.2-2">where:<a href="#section-6.5.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.5.2-3">
            <dt id="section-6.5.2-3.1">MSG SIZE</dt>
            <dd style="margin-left: 1.5em" id="section-6.5.2-3.2">
                            is 16-bit unsigned integer in network byte order witch describes the message size in bytes
                            and the header is included.<a href="#section-6.5.2-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.5.2-3.3">MSG TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.5.2-3.4">
                            the type of SETU_P2P_OFFER as registered in
                            <a href="#gana" class="xref">GANA Considerations</a>
                            in network byte order.<a href="#section-6.5.2-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.5.2-3.5">HASH</dt>
            <dd style="margin-left: 1.5em" id="section-6.5.2-3.6">
                            is a SHA 512-bit hash of the element that is requested with a inquiry message.<a href="#section-6.5.2-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="messages_inquiry">
<section id="section-6.6">
        <h3 id="name-inquiry">
<a href="#section-6.6" class="section-number selfRef">6.6. </a><a href="#name-inquiry" class="section-name selfRef">Inquiry</a>
        </h3>
<div id="messages_inquiry_description">
<section id="section-6.6.1">
          <h4 id="name-description-7">
<a href="#section-6.6.1" class="section-number selfRef">6.6.1. </a><a href="#name-description-7" class="section-name selfRef">Description</a>
          </h4>
<p id="section-6.6.1-1">
                        The Inquiry message is exclusively sent by the active peer in <strong>Active Decoding</strong> state
                        to request the full hash of an element that is missing in the active peers set. This is normally
                        answered
                        by the passive peer with
                        <em>
                            <a href="#messages_offer" class="xref">Offer</a>
            </em>
                        message.<a href="#section-6.6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.6.1-2">
                        This message is exclusively sent in the<a href="#modeofoperation_individual-elements" class="xref">Delta Synchronisation Mode</a>.<a href="#section-6.6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.6.1-3">
                        NOTE: HERE IS AN IMPLEMENTATION BUG UNNECESSARY 32-BIT PADDING!<a href="#section-6.6.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="messages_inquiry_structure">
<section id="section-6.6.2">
          <h4 id="name-structure-6">
<a href="#section-6.6.2" class="section-number selfRef">6.6.2. </a><a href="#name-structure-6" class="section-name selfRef">Structure</a>
          </h4>
<div id="figure_inquiry">
<figure id="figure-25">
            <div class="artwork art-text alignLeft" id="section-6.6.2-1.1">
<pre>
        0     8     16    24    32    40    48    56
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |  MSG SIZE |  MSG TYPE |          SALT         |
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |                    IBF KEY                    |
        +-----+-----+-----+-----+-----+-----+-----+-----+
</pre>
</div>
<figcaption><a href="#figure-25" class="selfRef">Figure 25</a></figcaption></figure>
</div>
<p id="section-6.6.2-2">where:<a href="#section-6.6.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.6.2-3">
            <dt id="section-6.6.2-3.1">MSG SIZE</dt>
            <dd style="margin-left: 1.5em" id="section-6.6.2-3.2">
                            is 16-bit unsigned integer in network byte order witch describes the message size in bytes
                            and the header is included.<a href="#section-6.6.2-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.6.2-3.3">MSG TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.6.2-3.4">
                            the type of SETU_P2P_INQUIRY as registered in
                            <a href="#gana" class="xref">GANA Considerations</a>
                            in network byte order.<a href="#section-6.6.2-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.6.2-3.5">IBF KEY</dt>
            <dd style="margin-left: 1.5em" id="section-6.6.2-3.6">
                            is a 64-bit unsigned integer that contains the key for which the inquiry is sent.<a href="#section-6.6.2-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="messages_demand">
<section id="section-6.7">
        <h3 id="name-demand">
<a href="#section-6.7" class="section-number selfRef">6.7. </a><a href="#name-demand" class="section-name selfRef">Demand</a>
        </h3>
<div id="messages_demand_description">
<section id="section-6.7.1">
          <h4 id="name-description-8">
<a href="#section-6.7.1" class="section-number selfRef">6.7.1. </a><a href="#name-description-8" class="section-name selfRef">Description</a>
          </h4>
<p id="section-6.7.1-1">
                        The demand message is sent in the <strong>Active Decoding</strong> and in the
                        <strong>Passive Decoding</strong>
                        state. It is a answer to a received
                        <em>
                            <a href="#messages_offer" class="xref">Offer</a>
            </em>
                        message
                        and is sent if the element described in the
                        <em>
                            <a href="#messages_offer" class="xref">Offer</a>
            </em>
                        message
                        is missing in the peers set. In the normal workflow the answer to the demand message is an
                        <em>
                            <a href="#messages_elements" class="xref">Elements</a>
            </em>
                        message.<a href="#section-6.7.1-1" class="pilcrow">¶</a></p>
<p id="section-6.7.1-2">
                        This message is exclusively sent in the<a href="#modeofoperation_individual-elements" class="xref">Delta Synchronisation Mode</a>.<a href="#section-6.7.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="messages_demand_structure">
<section id="section-6.7.2">
          <h4 id="name-structure-7">
<a href="#section-6.7.2" class="section-number selfRef">6.7.2. </a><a href="#name-structure-7" class="section-name selfRef">Structure</a>
          </h4>
<div id="figure_demand">
<figure id="figure-26">
            <div class="artwork art-text alignLeft" id="section-6.7.2-1.1">
<pre>
        0     8     16    24    32    40    48    56
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |  MSG SIZE |  MSG TYPE |          HASH
        +-----+-----+-----+-----+
        /                                               /
        /                                               /
</pre>
</div>
<figcaption><a href="#figure-26" class="selfRef">Figure 26</a></figcaption></figure>
</div>
<p id="section-6.7.2-2">where:<a href="#section-6.7.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.7.2-3">
            <dt id="section-6.7.2-3.1">MSG SIZE</dt>
            <dd style="margin-left: 1.5em" id="section-6.7.2-3.2">
                            is 16-bit unsigned integer in network byte order witch describes the message size in bytes
                            and the header is included.<a href="#section-6.7.2-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.7.2-3.3">MSG TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.7.2-3.4">
                            the type of SETU_P2P_DEMAND as registered in
                            <a href="#gana" class="xref">GANA Considerations</a>
                            in network byte order.<a href="#section-6.7.2-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.7.2-3.5">HASH</dt>
            <dd style="margin-left: 1.5em" id="section-6.7.2-3.6">
                            is a 512-bit Hash of the element that is demanded.<a href="#section-6.7.2-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="messages_done">
<section id="section-6.8">
        <h3 id="name-done">
<a href="#section-6.8" class="section-number selfRef">6.8. </a><a href="#name-done" class="section-name selfRef">Done</a>
        </h3>
<div id="messages_done_description">
<section id="section-6.8.1">
          <h4 id="name-description-9">
<a href="#section-6.8.1" class="section-number selfRef">6.8.1. </a><a href="#name-description-9" class="section-name selfRef">Description</a>
          </h4>
<p id="section-6.8.1-1">
                        The done message is sent when all
                        <em>
                            <a href="#messages_demand" class="xref">Demand</a>
            </em>
                        messages
                        have been successfully satisfied and the set is complete synchronized.

                        A final checksum (XOR SHA-512 hash) over all elements of the set is added to the message
                        to allow the other peer to make sure that the sets are equal.<a href="#section-6.8.1-1" class="pilcrow">¶</a></p>
<p id="section-6.8.1-2">
                        This message is exclusively sent in the<a href="#modeofoperation_individual-elements" class="xref">Delta Synchronisation Mode</a>.<a href="#section-6.8.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="messages_done_structure">
<section id="section-6.8.2">
          <h4 id="name-structure-8">
<a href="#section-6.8.2" class="section-number selfRef">6.8.2. </a><a href="#name-structure-8" class="section-name selfRef">Structure</a>
          </h4>
<div id="figure_done">
<figure id="figure-27">
            <div class="artwork art-text alignLeft" id="section-6.8.2-1.1">
<pre>
        0     8     16    24    32    40    48    56
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |  MSG SIZE |  MSG TYPE | HASH
        +-----+-----+-----+-----+

</pre>
</div>
<figcaption><a href="#figure-27" class="selfRef">Figure 27</a></figcaption></figure>
</div>
<p id="section-6.8.2-2">where:<a href="#section-6.8.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.8.2-3">
            <dt id="section-6.8.2-3.1">MSG SIZE</dt>
            <dd style="margin-left: 1.5em" id="section-6.8.2-3.2">
                            is 16-bit unsigned integer in network byte order witch describes the message size in bytes
                            and the header is included.<a href="#section-6.8.2-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.8.2-3.3">MSG TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.8.2-3.4">
                            the type of SETU_P2P_DONE as registered in
                            <a href="#gana" class="xref">GANA Considerations</a>
                            in network byte order.<a href="#section-6.8.2-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.8.2-3.5">HASH</dt>
            <dd style="margin-left: 1.5em" id="section-6.8.2-3.6">
                            is a 512-bit hash of the set to allow a final equality check.<a href="#section-6.8.2-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="messages_full_done">
<section id="section-6.9">
        <h3 id="name-full-done">
<a href="#section-6.9" class="section-number selfRef">6.9. </a><a href="#name-full-done" class="section-name selfRef">Full Done</a>
        </h3>
<div id="messages_full_done_description">
<section id="section-6.9.1">
          <h4 id="name-description-10">
<a href="#section-6.9.1" class="section-number selfRef">6.9.1. </a><a href="#name-description-10" class="section-name selfRef">Description</a>
          </h4>
<p id="section-6.9.1-1">
                        The full done message is sent in the
                        <a href="#modeofoperation_full-sync" class="xref">Full Synchronisation Mode</a>
                        to signal that all remaining elements of the set have been sent. The message is received and
                        sent in in the
                        <strong>Full Sending</strong>
                        and in the <strong>Full Receiving</strong> state. When the full done message is received
                        in <strong>Full Sending</strong> state the peer changes directly into <strong>Finished</strong> state.
                        In
                        <strong>Full Receiving</strong>
                        state receiving a full done message initiates the sending of
                        the remaining elements that are missing in the set of the other peer.<a href="#section-6.9.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="messages_full_done_structure">
<section id="section-6.9.2">
          <h4 id="name-structure-9">
<a href="#section-6.9.2" class="section-number selfRef">6.9.2. </a><a href="#name-structure-9" class="section-name selfRef">Structure</a>
          </h4>
<div id="figure_full_done">
<figure id="figure-28">
            <div class="artwork art-text alignLeft" id="section-6.9.2-1.1">
<pre>
        0     8     16    24    32
        +-----+-----+-----+-----+
        |  MSG SIZE |  MSG TYPE |
        +-----+-----+-----+-----+
</pre>
</div>
<figcaption><a href="#figure-28" class="selfRef">Figure 28</a></figcaption></figure>
</div>
<p id="section-6.9.2-2">where:<a href="#section-6.9.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.9.2-3">
            <dt id="section-6.9.2-3.1">MSG SIZE</dt>
            <dd style="margin-left: 1.5em" id="section-6.9.2-3.2">
                            is 16-bit unsigned integer in network byte order witch describes the message size in bytes
                            and the header is included.<a href="#section-6.9.2-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.9.2-3.3">MSG TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.9.2-3.4">
                            the type of SETU_P2P_FULL_DONE as registered in
                            <a href="#gana" class="xref">GANA Considerations</a>
                            in network byte order.<a href="#section-6.9.2-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="messages_request_full">
<section id="section-6.10">
        <h3 id="name-request-full">
<a href="#section-6.10" class="section-number selfRef">6.10. </a><a href="#name-request-full" class="section-name selfRef">Request Full</a>
        </h3>
<div id="messages_request_full_description">
<section id="section-6.10.1">
          <h4 id="name-description-11">
<a href="#section-6.10.1" class="section-number selfRef">6.10.1. </a><a href="#name-description-11" class="section-name selfRef">Description</a>
          </h4>
<p id="section-6.10.1-1">
                        The request full message is sent by the initiating peer in <strong>Expect SE</strong> state to
                        the receiving peer if
                        the operation mode "<a href="#modeofoperation_full-sync" class="xref">Full Synchronisation Mode</a>" is
                        determined as the better
                        <a href="#modeofoperation" class="xref">Mode of operation</a>
                        and the set size of the initiating peer is smaller
                        than the set size of the receiving peer. The initiating peer changes after sending the request
                        full message into
                        <strong>Full Receiving</strong>
                        state.<a href="#section-6.10.1-1" class="pilcrow">¶</a></p>
<p id="section-6.10.1-2">
                        The receiving peer receives the Request Full message in the <strong>Expecting IBF</strong>,
                        afterwards the receiving peer
                        starts sending its complete set in
                        <a href="#messages_full_element" class="xref">Full Element</a>
                        messages to the initiating peer.<a href="#section-6.10.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="messages_request_full_structure">
<section id="section-6.10.2">
          <h4 id="name-structure-10">
<a href="#section-6.10.2" class="section-number selfRef">6.10.2. </a><a href="#name-structure-10" class="section-name selfRef">Structure</a>
          </h4>
<div id="figure_request_full">
<figure id="figure-29">
            <div class="artwork art-text alignLeft" id="section-6.10.2-1.1">
<pre>
        0     8     16    24    32
        +-----+-----+-----+-----+
        |  MSG SIZE |  MSG TYPE |
        +-----+-----+-----+-----+
</pre>
</div>
<figcaption><a href="#figure-29" class="selfRef">Figure 29</a></figcaption></figure>
</div>
<p id="section-6.10.2-2">where:<a href="#section-6.10.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.10.2-3">
            <dt id="section-6.10.2-3.1">MSG SIZE</dt>
            <dd style="margin-left: 1.5em" id="section-6.10.2-3.2">
                            is 16-bit unsigned integer in network byte order witch describes the message size in bytes
                            and the header is included.<a href="#section-6.10.2-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.10.2-3.3">MSG TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.10.2-3.4">
                            the type of SETU_P2P_REQUEST_FULL as registered in
                            <a href="#gana" class="xref">GANA Considerations</a>
                            in network byte order.<a href="#section-6.10.2-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="messages_se">
<section id="section-6.11">
        <h3 id="name-strata-estimator-2">
<a href="#section-6.11" class="section-number selfRef">6.11. </a><a href="#name-strata-estimator-2" class="section-name selfRef">Strata Estimator</a>
        </h3>
<div id="messages_se_description">
<section id="section-6.11.1">
          <h4 id="name-description-12">
<a href="#section-6.11.1" class="section-number selfRef">6.11.1. </a><a href="#name-description-12" class="section-name selfRef">Description</a>
          </h4>
<p id="section-6.11.1-1">
                        The strata estimator is sent by the receiving peer at the start of the protocol right after the
                        <a href="#messages_operation_request" class="xref">Operation Request</a>
                        message has been received.<a href="#section-6.11.1-1" class="pilcrow">¶</a></p>
<p id="section-6.11.1-2">
                        The strata estimator is used to estimate the difference between the two sets as described in
                        section<a href="#se" class="xref">4</a>.<a href="#section-6.11.1-2" class="pilcrow">¶</a></p>
<p id="section-6.11.1-3">
                        When the initiating peer receives the strata estimator the peer decides which
                        <a href="#modeofoperation" class="xref">Mode of operation</a>
                        to use
                        for the synchronization. Depending on the size of the set difference and the
                        <a href="#modeofoperation" class="xref">Mode of operation</a>
                        the initiating peer
                        changes into <strong>Full Sending</strong>, <strong>Full Receiving</strong> or <strong>Passive
                        Decoding
            </strong> state.<a href="#section-6.11.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="messages_se_structure">
<section id="section-6.11.2">
          <h4 id="name-structure-11">
<a href="#section-6.11.2" class="section-number selfRef">6.11.2. </a><a href="#name-structure-11" class="section-name selfRef">Structure</a>
          </h4>
<div id="figure_se">
<figure id="figure-30">
            <div class="artwork art-text alignLeft" id="section-6.11.2-1.1">
<pre>
        0     8     16    24    32    40    48    56
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |  MSG SIZE |  MSG TYPE |        SETSIZE
        +-----+-----+-----+-----+-----+-----+-----+-----+
              SETSIZE           |          SE-SLICES
        +-----+-----+-----+-----+
        /                                               /
        /                                               /
</pre>
</div>
<figcaption><a href="#figure-30" class="selfRef">Figure 30</a></figcaption></figure>
</div>
<p id="section-6.11.2-2">where:<a href="#section-6.11.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.11.2-3">
            <dt id="section-6.11.2-3.1">MSG SIZE</dt>
            <dd style="margin-left: 1.5em" id="section-6.11.2-3.2">
                            is 16-bit unsigned integer in network byte order witch describes the message size in bytes
                            and the header is included.<a href="#section-6.11.2-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.11.2-3.3">MSG TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.11.2-3.4">
                            the type of SETU_P2P_SE as registered in
                            <a href="#gana" class="xref">GANA Considerations</a>
                            in network byte order.<a href="#section-6.11.2-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.11.2-3.5">SETSIZE</dt>
            <dd style="margin-left: 1.5em" id="section-6.11.2-3.6">
                            is a 64-bit unsigned integer that is defined by the size of the set the SE is<a href="#section-6.11.2-3.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.11.2-3.7">SE-SLICES</dt>
            <dd style="margin-left: 1.5em" id="section-6.11.2-3.8">
                            is variable in size and contains the same structure as the IBF-SLICES field in the IBF
                            message.<a href="#section-6.11.2-3.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="messages_sec">
<section id="section-6.12">
        <h3 id="name-strata-estimator-compressed">
<a href="#section-6.12" class="section-number selfRef">6.12. </a><a href="#name-strata-estimator-compressed" class="section-name selfRef">Strata Estimator Compressed</a>
        </h3>
<div id="messages_sec_description">
<section id="section-6.12.1">
          <h4 id="name-description-13">
<a href="#section-6.12.1" class="section-number selfRef">6.12.1. </a><a href="#name-description-13" class="section-name selfRef">Description</a>
          </h4>
<p id="section-6.12.1-1">
                        The Strata estimator can be compressed with gzip to improve performance. For
                        details see section.<a href="#section-6.12.1-1" class="pilcrow">¶</a></p>
<p id="section-6.12.1-2">
                        Since the content of the message is the same as the uncompressed Strata Estimator, the details
                        aren't repeated here for details see section<a href="#messages_se" class="xref">6.11</a>.<a href="#section-6.12.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="messages_full_element">
<section id="section-6.13">
        <h3 id="name-full-element">
<a href="#section-6.13" class="section-number selfRef">6.13. </a><a href="#name-full-element" class="section-name selfRef">Full Element</a>
        </h3>
<div id="messages_full_element_description">
<section id="section-6.13.1">
          <h4 id="name-description-14">
<a href="#section-6.13.1" class="section-number selfRef">6.13.1. </a><a href="#name-description-14" class="section-name selfRef">Description</a>
          </h4>
<p id="section-6.13.1-1">
                        The full element message is the equivalent of the
                        <a href="#messages_elements" class="xref">Elements</a>
                        message in
                        the<a href="#modeofoperation_full-sync" class="xref">Full Synchronisation Mode</a>. It contains a complete element
                        that is missing
                        in the set of the peer that receives this message.<a href="#section-6.13.1-1" class="pilcrow">¶</a></p>
<p id="section-6.13.1-2">
                        The full element message is exclusively sent in the transitions <strong>Expecting IBF</strong> -&gt; <strong>
                        Full Receiving
            </strong> and
                        <strong>Full Receiving</strong>
                        -&gt; <strong>Finished</strong>. The message is only received in the <strong>Full Sending</strong> and
                        <strong>Full Receiving</strong>
                        state.<a href="#section-6.13.1-2" class="pilcrow">¶</a></p>
<p id="section-6.13.1-3">
                        After the last full element messages has been sent the
                        <a href="#messages_full_done" class="xref">Full Done</a>
                        message
                        is sent to conclude the full synchronisation of the element sending peer.<a href="#section-6.13.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="messages_full_element_structure">
<section id="section-6.13.2">
          <h4 id="name-structure-12">
<a href="#section-6.13.2" class="section-number selfRef">6.13.2. </a><a href="#name-structure-12" class="section-name selfRef">Structure</a>
          </h4>
<div id="figure_full_element">
<figure id="figure-31">
            <div class="artwork art-text alignLeft" id="section-6.13.2-1.1">
<pre>
        0     8     16    24    32    40    48    56
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |  MSG SIZE |  MSG TYPE |   E TYPE  |  PADDING  |
        +-----+-----+-----+-----+-----+-----+-----+-----+
        |    SIZE   |   AE TYPE |  DATA
        +-----+-----+-----+-----+
        /                                               /
        /                                               /
</pre>
</div>
<figcaption><a href="#figure-31" class="selfRef">Figure 31</a></figcaption></figure>
</div>
<p id="section-6.13.2-2">where:<a href="#section-6.13.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.13.2-3">
            <dt id="section-6.13.2-3.1">MSG SIZE</dt>
            <dd style="margin-left: 1.5em" id="section-6.13.2-3.2">
                            is 16-bit unsigned integer in network byte order witch describes the message size in bytes
                            and the header is included.<a href="#section-6.13.2-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.13.2-3.3">MSG TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.13.2-3.4">
                            the type of SETU_P2P_REQUEST_FULL_ELEMENT as registered in
                            <a href="#gana" class="xref">GANA Considerations</a>
                            in network byte order.<a href="#section-6.13.2-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.13.2-3.5">E TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.13.2-3.6">
                            element type is a 16-bit unsigned integer witch defines the element type for
                            the application.<a href="#section-6.13.2-3.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.13.2-3.7">PADDING</dt>
            <dd style="margin-left: 1.5em" id="section-6.13.2-3.8">
                            is 16-bit always set to zero<a href="#section-6.13.2-3.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.13.2-3.9">E SIZE</dt>
            <dd style="margin-left: 1.5em" id="section-6.13.2-3.10">
                            element size is 16-bit unsigned integer that signals the size of the elements data part.<a href="#section-6.13.2-3.10" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.13.2-3.11">AE TYPE</dt>
            <dd style="margin-left: 1.5em" id="section-6.13.2-3.12">
                            application specific element type is a 16-bit unsigned integer that is needed to identify
                            the type of element that is in the data field<a href="#section-6.13.2-3.12" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6.13.2-3.13">DATA</dt>
            <dd style="margin-left: 1.5em" id="section-6.13.2-3.14">
                            is a field with variable length that contains the data of the element.<a href="#section-6.13.2-3.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="gana">
<section id="section-7">
      <h2 id="name-gana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-gana-considerations" class="section-name selfRef">GANA Considerations</a>
      </h2>
<p id="section-7-1">
                <a href="#GANA" class="xref">GNUnet Assigned Numbers Authority (GANA)</a>
                is requested to amend the "GNUnet Message Type" registry
                as follows:<a href="#section-7-1" class="pilcrow">¶</a></p>
<div id="figure_purposenums">
<figure id="figure-32">
        <div class="artwork art-text alignLeft" id="section-7-2.1">
<pre>
Type    | Name                       | References | Description
--------+----------------------------+------------+--------------------------
 559    | SETU_P2P_REQUEST_FULL      | [This.I-D] | Request the full set of the other peer
 560    | SETU_P2P_DEMAND            | [This.I-D] | Demand the whole element from the other peer, given only the hash code.
 561    | SETU_P2P_INQUIRY           | [This.I-D] | Tell the other peer to send us a list of hashes that match an IBF key.
 562    | SETU_P2P_OFFER             | [This.I-D] | Tell the other peer which hashes match a given IBF key.
 563    | SETU_P2P_OPERATION_REQUEST | [This.I-D] | Request a set union operation from a remote peer.
 564    | SETU_P2P_SE                | [This.I-D] | Strata Estimator uncompressed
 565    | SETU_P2P_IBF               | [This.I-D] | Invertible Bloom Filter Slice.
 566    | SETU_P2P_ELEMENTS          | [This.I-D] | Actual set elements.
 567    | SETU_P2P_IBF_LAST          | [This.I-D] | Invertible Bloom Filter Last Slice.
 568    | SETU_P2P_DONE              | [This.I-D] | Set operation is done.
 569    | SETU_P2P_SEC               | [This.I-D] | Strata Estimator compressed
 570    | SETU_P2P_FULL_DONE         | [This.I-D] | All elements in full synchronization mode have been send is done.
 571    | SETU_P2P_FULL_ELEMENT      | [This.I-D] | Send an actual element in full synchronization mode.

</pre>
</div>
<figcaption><a href="#figure-32" class="selfRef">Figure 32</a></figcaption></figure>
</div>
</section>
</div>
<div id="contributors">
<section id="section-8">
      <h2 id="name-contributors">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<p id="section-8-1">
                The original GNUnet implementation of the Byzantine Fault Tolerant Set Reconciliation
                protocol has mainly been written by Florian Dold and Christian Grothoff.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-normative-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="RFC5869">[RFC5869]</dt>
      <dd>
<span class="refAuthor">Krawczyk, H.</span><span class="refAuthor"> and P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5869">https://www.rfc-editor.org/info/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="GANA">[GANA]</dt>
      <dd>
<span class="refAuthor">GNUnet e.V.</span>, <span class="refTitle">"GNUnet Assigned Numbers Authority (GANA)"</span>, <time datetime="2020-04" class="refDate">April 2020</time>, <span>&lt;<a href="https://gana.gnunet.org/">https://gana.gnunet.org/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CryptographicallySecureVoting">[CryptographicallySecureVoting]</dt>
      <dd>
<span class="refAuthor">Dold, F.</span>, <span class="refTitle">"Cryptographically Secure, DistributedElectronic Voting"</span>, <span>&lt;<a href="https://git.gnunet.org/bibliography.git/plain/docs/ba_dold_voting_24aug2014.pdf">https://git.gnunet.org/bibliography.git/plain/docs/ba_dold_voting_24aug2014.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="GNUNET">[GNUNET]</dt>
      <dd>
<span class="refAuthor">Wachs, M.</span><span class="refAuthor">, Schanzenbach, M.</span><span class="refAuthor">, and C. Grothoff</span>, <span class="refTitle">"A Censorship-Resistant, Privacy-Enhancing andFully Decentralized Name System"</span>, <span>&lt;<a href="https://git.gnunet.org/bibliography.git/plain/docs/gns2014wachs.pdf">https://git.gnunet.org/bibliography.git/plain/docs/gns2014wachs.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Eppstein">[Eppstein]</dt>
      <dd>
<span class="refAuthor">Eppstein, D.</span><span class="refAuthor">, Goodrich, M.</span><span class="refAuthor">, Uyeda, F.</span><span class="refAuthor">, and G. Varghese</span>, <span class="refTitle">"What’s the Difference? Efficient Set Reconciliation without Prior Context"</span>, <span>&lt;<a href="https://doi.org/10.1145/2018436.2018462">https://doi.org/10.1145/2018436.2018462</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="GNS">[GNS]</dt>
    <dd>
<span class="refAuthor">Wachs, M.</span><span class="refAuthor">, Schanzenbach, M.</span><span class="refAuthor">, and C. Grothoff</span>, <span class="refTitle">"A Censorship-Resistant, Privacy-Enhancing and Fully Decentralized Name System"</span>, <time datetime="2014" class="refDate">2014</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-319-12280-9_9">https://doi.org/10.1007/978-3-319-12280-9_9</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<div id="authors-addresses">
<section id="section-appendix.a">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Elias Summermatter</span></div>
<div dir="auto" class="left"><span class="org">Seccom GmbH</span></div>
<div dir="auto" class="left"><span class="street-address">Brunnmattstrasse 44</span></div>
<div dir="auto" class="left">CH-<span class="postal-code">3007</span> <span class="locality">Bern</span>
</div>
<div dir="auto" class="left"><span class="country-name">Switzerland</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:elias.summermatter@seccom.ch" class="email">elias.summermatter@seccom.ch</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christian Grothoff</span></div>
<div dir="auto" class="left"><span class="org">Berner Fachhochschule</span></div>
<div dir="auto" class="left"><span class="street-address">Hoeheweg 80</span></div>
<div dir="auto" class="left">CH-<span class="postal-code">2501</span> <span class="locality">Biel/Bienne</span>
</div>
<div dir="auto" class="left"><span class="country-name">Switzerland</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:grothoff@gnunet.org" class="email">grothoff@gnunet.org</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
