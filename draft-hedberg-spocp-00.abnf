command       = starttls / query / add / delete / list / bcondcom
starttls     = "STARTTLS"

query        = "QUERY" [path] s-expr

add          = "ADD" [path] s-expr [ bcond [ return-info ]]

delete       = "DELETE" [path] ruleid

list         = "LIST" [path] *( "+"/"-" s-expr )

logout       = "LOGOUT"

begin        = "BEGIN"

commit       = "COMMIT"

rollback     = "ROLLBACK"

subjectcom   = "SUBJECT" [ s-exp [ token ]]

capability   = "CAPABILITY"

saslauth     = "AUTH" mech token

bcondcom     = "BCOND" ( "ADD" / "DELETE" / "REPLACE" ) bcondname
bcond        = bcondexpr / bcondspec

bcondexpr    = bcondor / bcondand / bcondnot / bcondref

bcondspec    = bcondname ":" typespecific

bcondname    = 1*dirchar

typespecific = octetstring

bcondref     = "(" "ref" 1*dirchar ")"

bcondand     = "(" "and" 1*bcondexpr ")"

bcondor      = "(" "or" 1*bcondexpr ")"

bcondnot     = "(" "not" bcondexpr ")"

mech         = 1*pchar

ruleid       = 1*pchar

path         = "/" / 1*( "/" pathpart )

pathpart     = 1*dirchar

dirchar      = pchar / '-' / '_' / '.'

pchar        = %x30-39 / %x41-5A / %x61-7A

token        = octet-string

s-expr       =   ; defined in [SPOCP Sexp] with one restriction
spocp-response  = *(multiline) singleline

multiline       = multi-response

multi-response  = "201" m-info

singleline      = response
response        = replycode [ octetstring ]

replycode       = ( "2" / "3" / "4" / "5" ) digit digit [
m-info          = return-info / list-info

list-info       = path ruleid s-expr [ return-info ]

return-info     = [ mimecontenttype ] octetstring

mimecontenttype = ; as defined in [RFC2045]

octet-string    = 1*byte

byte            = %x00-FF

