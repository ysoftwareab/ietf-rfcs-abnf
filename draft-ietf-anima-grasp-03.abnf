grasp-message = (message .within message-structure) / noop-message

message-structure = [MESSAGE_TYPE, session-id, +grasp-option]

MESSAGE_TYPE = 1..255
session-id = 0..16777215 ;up to 24 bits
grasp-option = any

discovery-message = [M_DISCOVERY, session-id, objective]

response-message = [M_RESPONSE, session-id,
                       (+locator-option // divert-option), ?objective)]

request-negotiation-message = [M_REQ_NEG, session-id, objective]

request-synchronization-message = [M_REQ_SYN, session-id, objective]


discovery-message = [M_NEGOTIATE, session-id, objective]

end-message = [M_END, session-id, accept-option / decline-option]

wait-message = [M_WAIT, session-id, waiting-time]
waiting-time =        0..4294967295 ; in milliseconds

synch-message = [M_SYNCH, session-id, objective]

flood-message = [M_FLOOD, session-id, +objective]

noop-message = [M_NOOP]

divert-option = [O_DIVERT, +locator-option]
accept-option = [O_ACCEPT]

decline-option = [O_DECLINE, ?reason]
reason = text  ;optional error message

ipv4-locator-option = bytes .size 4

ipv6-locator-option = bytes .size 16

fqdn-locator-option = [O_FQDN_LOCATOR, text]

uri-locator-option = [O_URI_LOCATOR, text]
objective = [objective-name, objective-flags, loop-count, ?any]

objective-name = text
loop-count = 0..255

objective-flags = uint .bits objective-flag
objective-flag = &(
grasp-message = (message .within message-structure) / noop-message

message-structure = [MESSAGE_TYPE, session-id, *grasp-option]

MESSAGE_TYPE = 0..255
session-id = 0..16777215 ;up to 24 bits
grasp-option = any

discovery-message = [M_DISCOVERY, session-id, objective]

response-message = [M_RESPONSE, session-id,
                      (+locator-option // divert-option), ?objective]

synch-message = [M_SYNCH, session-id, objective]

flood-message = [M_FLOOD, session-id, +objective]

request-negotiation-message = [M_REQ_NEG, session-id, objective]

request-synchronization-message = [M_REQ_SYN, session-id, objective]

negotiation-message = [M_NEGOTIATE, session-id, objective]

end-message = [M_END, session-id, accept-option / decline-option ]

wait-message = [M_WAIT, session-id, waiting-time]

noop-message = [M_NOOP]

divert-option = [O_DIVERT, +locator-option]

accept-option = [O_ACCEPT]

decline-option = [O_DECLINE, ?reason]
reason = text  ;optional error message

waiting-time = 0..4294967295 ; in milliseconds

ipv4-locator-option = bytes .size 4
ipv6-locator-option = bytes .size 16

fqdn-locator-option = [O_FQDN_LOCATOR, text]
uri-locator-option = [O_URI_LOCATOR, text]

objective-flags = uint .bits objective-flag

objective-flag = &(
    F_DISC: 0 ; valid for discovery only
    F_NEG: 1 ; valid for discovery and negotiation
    F_SYNCH: 2) ; valid for discovery and synchronization

objective = [objective-name, objective-flags, loop-count, ?any]

objective-name = text ;see specification for uniqueness rules

loop-count = 0..255

M_NOOP = 0
M_DISCOVERY = 1
M_RESPONSE = 2
M_REQ_NEG = 3
M_REQ_SYN = 4
M_NEGOTIATE = 5
M_END = 6
M_WAIT = 7
M_SYNCH = 8
M_FLOOD = 9

O_DIVERT = 100
O_ACCEPT = 101
O_DECLINE = 102
O_FQDN_LOCATOR = 103
O_URI_LOCATOR = 104
M_NOOP = 0
M_DISCOVERY = 1
M_RESPONSE = 2
M_REQUEST = 3
M_NEGOTIATE = 4
M_END = 5
M_WAIT = 6

O_DIVERT = 100
O_ACCEPT = 101
O_DECLINE = 102
O_FQDN_LOCATOR = 103
O_URI_LOCATOR = 104
O_DEVICE_ID = 105

