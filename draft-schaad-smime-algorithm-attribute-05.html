<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Cryptographic Messages Syntax (CMS) Algorithm Identifier Protection Attribute</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Cryptographic Messages Syntax (CMS) Algorithm Identifier Protection Attribute">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">J. Schaad</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Soaring Hawk Consulting</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">January 25, 2011</td></tr>
<tr><td class="header">Expires: July 29, 2011</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Cryptographic Messages Syntax (CMS) Algorithm Identifier Protection Attribute<br />draft-schaad-smime-algorithm-attribute-05</h1>

<h3>Abstract</h3>

<p>The Cryptographic Message Syntax (CMS) unlike X.509/PKIX certificates, are venerable to algorithm substitution attacks.  In an algorithm substitution attack, the attacker changes either the algorithm being used or parameters of the algorithm in order to change the result of a signature verification process.  In X.509 certificates, the signature algorithm is protected because it is duplicated in the TBSCertificate.signature field with the proviso that the validater is to compare both fields as part of the signature validation process.  This document defines a new attribute that contains a copy of the relevant algorithm identifiers so that they are protected by the signature or authentication process.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on July 29, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2011 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Notation<br />
<a href="#anchor3">2.</a>&nbsp;
Attribute Structure<br />
<a href="#anchor4">3.</a>&nbsp;
Verification Process<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.1.</a>&nbsp;
Signed Data Verification Changes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.2.</a>&nbsp;
Authenticated Data Verification Changes<br />
<a href="#anchor7">4.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor8">5.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">6.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">6.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">6.2.</a>&nbsp;
Informational References<br />
<a href="#anchor11">Appendix&nbsp;A.</a>&nbsp;
2008 ASN.1 Module<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The Cryptographic Message Syntax (CMS) <a class='info' href='#CMS'>[CMS]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; September&nbsp;2009.</span><span>)</span></a> unlike X.509/PKIX certificates <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>, are venerable to algorithm substitution attacks.  In an algorithm substitution attack, the attacker changes either the algorithm being used or parameters of the algorithm in order to change the result of a signature verification process.  In X.509 certificates, the signature algorithm is protected because it is duplicated in the TBSCertificate.signature field with the proviso that the validater is to compare both fields as part of the signature validation process.  This document defines a new attribute that contains a copy of the relevant algorithm identifiers so that they are protected by the signature or authentication process.
</p>
<p>In an algorithm substitution attack, the attacker looks for a different algorithm that produces the same result as the algorithm used by the signer.  As an example, if the creator of the message used SHA-1 as the digest algorithm to hash the message content then the attacker looks for a different hash algorithm that produces a result that is the same length, but with which it is easier to find collisions.  Examples of other algorithms that produce a hash value of the same length would be SHA-0 or RIPEMD-160.  Similar attacks can be mounted against parameterized algorithm identifiers.  When looking at some of the proposed randomized hashing functions, such as that in <a class='info' href='#RANDOM-HASH'>[RANDOM&#8209;HASH]<span> (</span><span class='info'>Halevi, S. and H. Krawczyk, &ldquo;Randomized Hashing: Secure Digital Signatures without Collision Resistance,&rdquo; .</span><span>)</span></a>, the associated security proofs assume that the parameters are solely under the control of the originator and not subject to selection by the attacker.
</p>
<p>Some algorithms have been internally designed to be more resistant to this type of attack.  Thus an RSA PKCS #1 v.15 signature <a class='info' href='#RFC3447'>[RFC3447]<span> (</span><span class='info'>Jonsson, J. and B. Kaliski, &ldquo;Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications Version 2.1,&rdquo; February&nbsp;2003.</span><span>)</span></a> cannot have the associated hash algorithm changed because it is encoded as part of the signature.  DSA was originally defined so that it would only work with SHA-1 as a hash algorithm, thus by knowing the public key from the certificate, a validator can be assured that the hash algorithm can not be changed.  There is a convention, undocumented as far as I can tell, that the same hash algorithm should be used for both the content digest and the signature digest.  There are cases, such as third party signers that are only given a content digest, where such a convention cannot be enforced.
</p>
<p>As with all attacks, the attack is going to be desirable on items that are both long term and high value.  One would expect that these attacks are more likely to be made on older documents as the algorithms being used when the message was signed would be more likely to have degraded over time.  Countersigning, the classic method of protecting a signature does not provide any additional protection against an algorithm substitution attack because countersignatures sign just the signature, but the algorithm substitution attacks leave the signature value alone while changing the algorithms being used.
</p>
<p>Using the SignerInfo structure from CMS, let's take a more detailed look at each of the fields in the structure and discuss what fields are and are not protected by the signature.  I have included a copy of the ASN.1 here for convenience. A similar analysis of the AuthenticatedData structure is left to the reader, but it can be done in much the same way.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      SignerInfo ::= SEQUENCE {
        version CMSVersion,
        sid SignerIdentifier,
        digestAlgorithm DigestAlgorithmIdentifier,
        signedAttrs [0] IMPLICIT SignedAttributes OPTIONAL,
        signatureAlgorithm SignatureAlgorithmIdentifier,
        signature SignatureValue,
        unsignedAttrs [1] IMPLICIT UnsignedAttributes OPTIONAL }

</pre></div>
<p>
      </p>
<blockquote class="text"><dl>
<dt>version</dt>
<dd>is not protected by the signature.  As many implementations of CMS today ignore the value of this field that is not a problem.  If the value is increased, then no changes in the processing are expected.  If the value is decreased, implementations that respect the structure would fail to decode, but an erroneous signature validation would not be completed successfully.
</dd>
<dt>sid</dt>
<dd>can be protected using either version of the signing certificate authenticated attribute.  SigningCertificateV2 is defined in <a class='info' href='#RFC5035'>[RFC5035]<span> (</span><span class='info'>Schaad, J., &ldquo;Enhanced Security Services (ESS) Update: Adding CertID Algorithm Agility,&rdquo; August&nbsp;2007.</span><span>)</span></a>.  SigningCertificate is defined in <a class='info' href='#ESS-BASE'>[ESS&#8209;BASE]<span> (</span><span class='info'>Hoffman, P., &ldquo;Enhanced Security Services for S/MIME,&rdquo; June&nbsp;1999.</span><span>)</span></a>.  In addition to allowing for the protection of the signer identifier, the specific certificate is protected by including a hash of the certificate to be used for validation.
</dd>
<dt>digestAlgorithm</dt>
<dd>the digest algorithm used has been implicitly protected by the fact that CMS has only defined one digest algorithm for each hash value length. (The algorithm RIPEM-160 was never standardized).  There is also an unwritten convention that the same digest algorithm should be used both here and for the signature algorithm.  If newer digest algorithms are defined so that there are multiple algorithms for a given hash length (it is expected that the SHA-3 project will do so), or that parameters are defined for a specific algorithm, much of the implicit protection will be lost.
</dd>
<dt>signedAttributes</dt>
<dd>are directly protected by the signature when they are present.  The DER encoding of this value is what is hashed for the signature computation.
</dd>
<dt>signatureAlgorithm</dt>
<dd>has been protected by implication in the past.  

The use of an RSA public key implied that the RSA v 1.5 signature algorithm was being used.  The hash algorithm and this fact could be checked by the internal padding defined.  This is no longer true with the addition of the RSA-PSS signature algorithms.

The use of a DSA public key implied the SHA-1 hash algorithm as that was the only possible hash algorithm and the DSA was the public signature algorithm.  This is still somewhat true as there is an implicit tie between the length of the DSA public key and the length of the hash algorithm to be used, but this is known by convention and there is no explicit enforcement for this.

</dd>
<dt>signature</dt>
<dd>is not directly protected by any other value unless a counter signature is present.  However this represents the cryptographically computed value that protects the rest of the signature information.
</dd>
<dt>unsignedAttrs</dt>
<dd>is not protected by the signature value.  It is also explicitly designed that they not to be protected by the signature value.
</dd>
</dl></blockquote>

<p>As can be seen above, the digestAlgorithm and signatureAlgorithm fields have been indirectly rather than explicitly protected in the past.  With new algorithms that have been or are being defined this will no longer be the case.  This document defines and describes a new attribute that will explicitly protect these fields along with the macAlgorithm field of the AuthenticatedData structure.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Notation</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Attribute Structure</h3>

<p>The following defines the algorithm protection attribute:
</p>
<p>The algorithm-protection attribute has the ASN.1 type CMSAlgorithmProtection:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    aa-cmsAlgorithmProtection ATTRIBUTE ::= {
        TYPE CMSAlgorithmProtection
        IDENTIFIED BY { id-aa-CMSAlgorithmProtection }
    }
</pre></div>
<p>The following object identifier identifies the algorithm-protection attribute:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    id-aa-CMSAlgorithmProtection OBJECT IDENTIFIER ::= { iso(1)
         member-body(2) us(840) rsadsi(113549) pkcs(1) pkcs9(9) 52 }
</pre></div>
<p>The algorithm-protection attribute uses the following ASN.1 type:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   CMSAlgorithmProtection ::= SEQUENCE {
       digestAlgorithm         DigestAlgorithmIdentifier,
       signatureAlgorithm  [1] SignatureAlgorithmIdentifier OPTIONAL,
       macAlgorithm        [2] MessageAuthenticationCodeAlgorithm
                                        OPTIONAL
   }
   (WITH COMPONENTS { signatureAlgorithm PRESENT,
                      macAlgorithm ABSENT } |
    WITH COMPONENTS { signatureAlgorithm ABSENT,
                      macAlgorithm PRESENT })
</pre></div>
<p>The fields are defined as follows:
</p>
<p>
      </p>
<blockquote class="text"><dl>
<dt>digestAlgorithm</dt>
<dd>contains a copy of the SignerInfo.digestAlgorithm field or the AuthenticatedData.digestAlgorithm field including any parameters associated with it.
</dd>
<dt>signatureAlgorithm</dt>
<dd>contains a copy of the signature algorithm identifier and any parameters associated with it (SignerInfo.signatureAlgorithm).  This field is only populated if the attribute is placed in a SignerInfo.signedAttrs sequence.
</dd>
<dt>macAlgorithm</dt>
<dd>contains a copy of the message authentication code algorithm identifier and any parameters associated with it (AuthenticatedData.macAlgorithm).  This field is only populated if the attribute is placed in an AuthenticatedData.authAttrs sequence.
</dd>
</dl></blockquote>

<p>Exactly one of signatureAlgorithm and macAlgorithm SHALL be present.
</p>
<p>An algorithm-protection attribute MUST have a single attribute value, even though the syntax is defined as a SET OF AttributeValue.  There MUST NOT be zero or multiple instances of AttributeValue present.
</p>
<p>The algorithm-protection attribute MUST be a signed attribute or an authenticated attribute;  it MUST NOT be an unsigned attribute, an unauthenticated attribute or an unprotected attribute.
</p>
<p>The SignedAttributes and AuthAttributes syntax are each defined as a SET of Attributes.  The SignedAttributes in a signerInfo MUST include only one instance of the algorithm protection attribute.  Similarly, the AuthAttributes in an AuthenticatedData MUST include only one instance of the algorithm protection attribute.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Verification Process</h3>

<p>
        While the exact verification steps depends on the structure that is being validated, there are some common rules that are to be followed when comparing the two algorithm structures:
        </p>
<ul class="text">
<li>A field with a default value MUST compare as being the same independent of whether the value is defaulted or is explicitly provided.
</li>
<li>It is implementation dependent if, for some algorithms, the absence of a parameter and the presence of a NULL parameter are compared as being equivalent.  This behavior SHOULD NOT be expected.  This is an issue because some implementations will omit a NULL element, while other will encode a NULL element for some digest algorithms such as SHA-1 (see the comments in section 2.1 of <a class='info' href='#RFC3370'>[RFC3370]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS) Algorithms,&rdquo; August&nbsp;2002.</span><span>)</span></a>).  The issue is even worse because the NULL is absent in some cases (<a class='info' href='#RFC3370'>[RFC3370]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS) Algorithms,&rdquo; August&nbsp;2002.</span><span>)</span></a>), but is required in other cases (for example see <a class='info' href='#RFC4056'>[RFC4056]<span> (</span><span class='info'>Schaad, J., &ldquo;Use of the RSASSA-PSS Signature Algorithm in Cryptographic Message Syntax (CMS),&rdquo; June&nbsp;2005.</span><span>)</span></a>).
          
</li>
</ul><p>
      
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Signed Data Verification Changes</h3>

<p>If a CMS validator supports this attribute, the following additional verification steps MUST be performed:
</p>
<p>1.  The SignerInfo.digestAlgorithm field MUST be compared to the digestAlgorithm field in the attribute.  If the fields are not the same (modulo encoding) then signature validation MUST fail.
</p>
<p>2.  The SignerInfo.signatureAlgorithm field MUST be compared to the signatureAlgorithm field in the attribute.  If the fields are not the same (modulo encoding) then the signature validation MUST fail.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Authenticated Data Verification Changes</h3>

<p>If a CMS validator supports this attribute, the following additional verification steps MUST be performed:
</p>
<p>1.  The AuthenticatedData.digestAlgorithm field MUST be compared to the digestAlgorithm field in the attribute.  If the fields are not same (modulo encoding) then authentication MUST fail.
</p>
<p>2.  The AuthenticatedData.macAlgorithm field MUST be compared to the macAlgorithm field in the attribute.  If the fields are not the same (modulo encoding) then the authentication MUST fail.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
IANA Considerations</h3>

<p>There are no IANA considerations.  All identifiers are assigned out of the S/MIME OID arc.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>This document is designed to address the security issue of algorithm substitutions of the algorithms used by the validator.  At this time there is no known method to exploit this type of attack.  If the attack could be successful, then either a weaker algorithm could be substituted for a stronger algorithm or the parameters could be modified by an attacker to change the behavior of the hashing algorithm used.  (One example would be changing the initial parameter value for <a class='info' href='#XOR-HASH'>[XOR&#8209;HASH]<span> (</span><span class='info'>Schaad, J., &ldquo;Experiment: Hash functions with parameters in CMS and S/MIME,&rdquo; January&nbsp;2011.</span><span>)</span></a>.)
</p>
<p>The attribute defined in this document is to be placed in a location that is protected by the signature or message authentication code.  This attribute does not provide any additional security if placed in an un-signed or un-authenticated location.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="ESS-BASE">[ESS-BASE]</a></td>
<td class="author-text"><a href="mailto:phoffman@imc.org">Hoffman, P.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2634">Enhanced Security Services for S/MIME</a>,&rdquo; RFC&nbsp;2634, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2634.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5035">[RFC5035]</a></td>
<td class="author-text">Schaad, J., &ldquo;<a href="http://tools.ietf.org/html/rfc5035">Enhanced Security Services (ESS) Update: Adding CertID Algorithm Agility</a>,&rdquo; RFC&nbsp;5035, August&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc5035.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="CMS">[CMS]</a></td>
<td class="author-text">Housley, R., &ldquo;<a href="http://tools.ietf.org/html/rfc5652">Cryptographic Message Syntax (CMS)</a>,&rdquo; RFC&nbsp;5652, September&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5652.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5912">[RFC5912]</a></td>
<td class="author-text">Hoffman, P. and J. Schaad, &ldquo;<a href="http://tools.ietf.org/html/rfc5912">New ASN.1 Modules for the Public Key Infrastructure Using X.509 (PKIX)</a>,&rdquo; RFC&nbsp;5912, June&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5912.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="ASN.1-2008">[ASN.1-2008]</a></td>
<td class="author-text">ITU-T, &ldquo;ITU-T Recommendations X.680, X.681, X.682, and X.683,&rdquo; 2008.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.2.&nbsp;Informational References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3370">[RFC3370]</a></td>
<td class="author-text">Housley, R., &ldquo;<a href="http://tools.ietf.org/html/rfc3370">Cryptographic Message Syntax (CMS) Algorithms</a>,&rdquo; RFC&nbsp;3370, August&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3370.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3447">[RFC3447]</a></td>
<td class="author-text">Jonsson, J. and B. Kaliski, &ldquo;<a href="http://tools.ietf.org/html/rfc3447">Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications Version 2.1</a>,&rdquo; RFC&nbsp;3447, February&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3447.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4056">[RFC4056]</a></td>
<td class="author-text">Schaad, J., &ldquo;<a href="http://tools.ietf.org/html/rfc4056">Use of the RSASSA-PSS Signature Algorithm in Cryptographic Message Syntax (CMS)</a>,&rdquo; RFC&nbsp;4056, June&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4056.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5280">[RFC5280]</a></td>
<td class="author-text">Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;<a href="http://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>,&rdquo; RFC&nbsp;5280, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5280.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XOR-HASH">[XOR-HASH]</a></td>
<td class="author-text">Schaad, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-schaad-smime-hash-experiment-06.txt">Experiment: Hash functions with parameters in CMS and S/MIME</a>,&rdquo; draft-schaad-smime-hash-experiment-06 (work in progress), January&nbsp;2011 (<a href="http://www.ietf.org/internet-drafts/draft-schaad-smime-hash-experiment-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RANDOM-HASH">[RANDOM-HASH]</a></td>
<td class="author-text">Halevi, S. and H. Krawczyk, &ldquo;<a href="http://www.ietf.org/proceedings/74/slides/saag-4/saag-4_files/frame.htm">Randomized Hashing: Secure Digital Signatures without Collision Resistance</a>,&rdquo; IETF&nbsp;74.</td></tr>
</table>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
2008 ASN.1 Module</h3>

<p>The ASN.1 module defined uses the 2008 ASN.1 definitions found in <a class='info' href='#ASN.1-2008'>[ASN.1&#8209;2008]<span> (</span><span class='info'>ITU-T, &ldquo;ITU-T Recommendations X.680, X.681, X.682, and X.683,&rdquo; 2008.</span><span>)</span></a>.  This module contains the ASN.1 module which contains the required defintions for the types and values defined in this document.  The module uses the ATTRIBUTE class defined in <a class='info' href='#RFC5912'>[RFC5912]<span> (</span><span class='info'>Hoffman, P. and J. Schaad, &ldquo;New ASN.1 Modules for the Public Key Infrastructure Using X.509 (PKIX),&rdquo; June&nbsp;2010.</span><span>)</span></a>.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CMSAlgorithmProtectionAttribute
  { iso(1) member-body(2) us(840) rsadsi(113549)
    pkcs(1) pkcs-9(9) smime(16) modules(0)
    id-mod-cms-algorithmProtect(52) }
DEFINITIONS IMPLICIT TAGS ::=
BEGIN
 IMPORTS

   -- Cryptographic Message Syntax (CMS) [CMS]

   DigestAlgorithmIdentifier, MessageAuthenticationCodeAlgorithm,
   SignatureAlgorithmIdentifier
   FROM  CryptographicMessageSyntax-2009
     { iso(1) member-body(2) us(840) rsadsi(113549)
       pkcs(1) pkcs-9(9) smime(16) modules(0) id-mod-cms-2004-02(41) }

   -- Common PKIX structures [RFC5912]

   ATTRIBUTE
   FROM PKIX-CommonTypes-2009
     { iso(1) identified-organization(3) dod(6) internet(1)
       security(5) mechanisms(5) pkix(7) id-mod(0)
       id-mod-pkixCommon-02(57)};

   --
   --  The CMS Algorithm Protection attribute is a Signed Attribute or
   --  an Authenticated Attribute.
   --
   --  Add this attribute to SignedAttributesSet in [CMS]
   --  Add this attribute to AuthAttributeSet in [CMS]
   --

   aa-cmsAlgorithmProtection ATTRIBUTE ::= {
      TYPE CMSAlgorithmProtection
      IDENTIFIED BY { id-aa-cmsAlgorithmProtect }
   }

   id-aa-cmsAlgorithmProtect OBJECT IDENTIFIER ::= {
      iso(1) member-body(2) us(840) rsadsi(113549) pkcs(1)
      pkcs9(9) 52 }

   CMSAlgorithmProtection ::= SEQUENCE {
      digestAlgorithm         DigestAlgorithmIdentifier,
      signatureAlgorithm  [1] SignatureAlgorithmIdentifier OPTIONAL,
      macAlgorithm        [2] MessageAuthenticationCodeAlgorithm
                                        OPTIONAL
   }
   (WITH COMPONENTS { signatureAlgorithm PRESENT,
                      macAlgorithm ABSENT } |
    WITH COMPONENTS { signatureAlgorithm ABSENT,
                      macAlgorithm PRESENT })

END
</pre></div>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jim Schaad</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Soaring Hawk Consulting</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ietf@augustcellars.com">ietf@augustcellars.com</a></td></tr>
</table>
</body></html>
