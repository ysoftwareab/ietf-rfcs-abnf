<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Flexible Session Protocol</title>
<meta content="Jun-an Gao" name="author">
<meta content="
       FSP is a connection-oriented transport layer protocol that provides
      mobility and multihoming support by introducing the concept of 'upper
      layer thread ID', which is associated with some shared secret that is
      applied with some secure hash or authenticated encryption algorithm to
      protect authenticity of the origin of the FSP packets. It is able to
      provide following services to the upper layer application: 
       
         Stream-oriented send-receive with native message boundary 
         Flexibility to exploit authenticated encryption 
         On-the-wire compression 
         Light-weight session management 
       
    " name="description">
<meta content="xml2rfc 3.10.0" name="generator">
<meta content="draft-gao-flexible-session-protocol-07" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.10.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.4.0
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 58.2.0
    six 1.16.0
-->
<link href="/tmp/draft-gao-flexible-session-protocol-07-dt_wq21f.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Flexible Session Protocol</td>
<td class="right">October 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Gao</td>
<td class="center">Expires 19 April 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-gao-flexible-session-protocol-07</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-10-16" class="published">16 October 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Experimental</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-04-19">19 April 2022</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">J. Gao</div>
<div class="org">Individual</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Flexible Session Protocol</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">FSP is a connection-oriented transport layer protocol that provides
      mobility and multihoming support by introducing the concept of 'upper
      layer thread ID', which is associated with some shared secret that is
      applied with some secure hash or authenticated encryption algorithm to
      protect authenticity of the origin of the FSP packets. It is able to
      provide following services to the upper layer application:<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-abstract-2.1">Stream-oriented send-receive with native message boundary<a href="#section-abstract-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-abstract-2.2">Flexibility to exploit authenticated encryption<a href="#section-abstract-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-abstract-2.3">On-the-wire compression<a href="#section-abstract-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-abstract-2.4">Light-weight session management<a href="#section-abstract-2.4" class="pilcrow">¶</a>
</li>
      </ul>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 19 April 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-features" class="xref">Features</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1.2.1">
                    <p id="section-toc.1-1.1.2.1.2.1.1" class="keepWithNext"><a href="#section-1.1.1" class="xref">1.1.1</a>.  <a href="#name-transport-layer-mobility-su" class="xref">Transport Layer Mobility Support</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1.2.2">
                    <p id="section-toc.1-1.1.2.1.2.2.1" class="keepWithNext"><a href="#section-1.1.2" class="xref">1.1.2</a>.  <a href="#name-flexibility-to-exploit-auth" class="xref">Flexibility to exploit Authenticated Encryption</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1.2.3">
                    <p id="section-toc.1-1.1.2.1.2.3.1" class="keepWithNext"><a href="#section-1.1.3" class="xref">1.1.3</a>.  <a href="#name-transmit-transaction" class="xref">Transmit Transaction</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1.2.4">
                    <p id="section-toc.1-1.1.2.1.2.4.1"><a href="#section-1.1.4" class="xref">1.1.4</a>.  <a href="#name-light-weight-session-manage" class="xref">Light-weight session management</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1.2.5">
                    <p id="section-toc.1-1.1.2.1.2.5.1"><a href="#section-1.1.5" class="xref">1.1.5</a>.  <a href="#name-on-the-wire-compression" class="xref">On-the-wire Compression</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-requirements-language" class="xref">Requirements Language</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1"><a href="#section-1.3" class="xref">1.3</a>.  <a href="#name-conventions" class="xref">Conventions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-abbreviations-and-idioms" class="xref">Abbreviations and Idioms</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-key-mechanisms" class="xref">Key Mechanisms</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-underlying-layer-services-r" class="xref">Underlying Layer Services Required</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="xref">3.1.1</a>.  <a href="#name-handling-of-high-mobility" class="xref">Handling of High Mobility</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="xref">3.1.2</a>.  <a href="#name-network-address-change-noti" class="xref">Network Address Change Notification</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.3">
                    <p id="section-toc.1-1.3.2.1.2.3.1"><a href="#section-3.1.3" class="xref">3.1.3</a>.  <a href="#name-network-congestion-control" class="xref">Network Congestion Control</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-identifying-connection-by-l" class="xref">Identifying Connection by Local ULTID</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-defending-against-connectio" class="xref">Defending Against Connection Hijacking with ICC</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-synchronizing-key-installat" class="xref">Synchronizing Key Installation with Transmit Transaction</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="xref">3.5</a>.  <a href="#name-0-rtt-connection-multiplica" class="xref">0-RTT Connection Multiplication with OOB Packet</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-packet-structure" class="xref">Packet Structure</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-fsp-over-udp-ipv4" class="xref">FSP over UDP/IPv4</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-fsp-over-ipv6" class="xref">FSP over IPv6</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-generic-fsp-header" class="xref">Generic FSP Header</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-fsp-header-signature-and-co" class="xref">FSP Header Signature and Code-Mark-Length Prefix</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.1">
                    <p id="section-toc.1-1.4.2.4.2.1.1"><a href="#section-4.4.1" class="xref">4.4.1</a>.  <a href="#name-operation-code" class="xref">Operation Code</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.2">
                    <p id="section-toc.1-1.4.2.4.2.2.1"><a href="#section-4.4.2" class="xref">4.4.2</a>.  <a href="#name-major" class="xref">Major</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.3">
                    <p id="section-toc.1-1.4.2.4.2.3.1"><a href="#section-4.4.3" class="xref">4.4.3</a>.  <a href="#name-mark" class="xref">Mark</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.4">
                    <p id="section-toc.1-1.4.2.4.2.4.1"><a href="#section-4.4.4" class="xref">4.4.4</a>.  <a href="#name-offset" class="xref">Offset</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.5">
                    <p id="section-toc.1-1.4.2.4.2.5.1"><a href="#section-4.4.5" class="xref">4.4.5</a>.  <a href="#name-length" class="xref">Length</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-preliminary-fsp-packets" class="xref">Preliminary FSP Packets</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.1">
                    <p id="section-toc.1-1.4.2.5.2.1.1"><a href="#section-4.5.1" class="xref">4.5.1</a>.  <a href="#name-connect-initialization" class="xref">Connect Initialization</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.2">
                    <p id="section-toc.1-1.4.2.5.2.2.1"><a href="#section-4.5.2" class="xref">4.5.2</a>.  <a href="#name-acknowledgment-to-connect-i" class="xref">Acknowledgment to Connect Initialization</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.3">
                    <p id="section-toc.1-1.4.2.5.2.3.1"><a href="#section-4.5.3" class="xref">4.5.3</a>.  <a href="#name-connect-request" class="xref">Connect Request</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="xref">4.6</a>.  <a href="#name-normal-fixed-header" class="xref">Normal Fixed Header</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7">
                <p id="section-toc.1-1.4.2.7.1"><a href="#section-4.7" class="xref">4.7</a>.  <a href="#name-sink-parameter" class="xref">Sink Parameter</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8">
                <p id="section-toc.1-1.4.2.8.1"><a href="#section-4.8" class="xref">4.8</a>.  <a href="#name-selective-negative-acknowle" class="xref">Selective Negative Acknowledgment</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.9">
                <p id="section-toc.1-1.4.2.9.1"><a href="#section-4.9" class="xref">4.9</a>.  <a href="#name-reset" class="xref">RESET</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-the-finite-state-machine" class="xref">The Finite State Machine</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-non_existent" class="xref">NON_EXISTENT</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-listening" class="xref">LISTENING</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-connect_bootstrap" class="xref">CONNECT_BOOTSTRAP</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-connect_affirming" class="xref">CONNECT_AFFIRMING</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="xref">5.5</a>.  <a href="#name-challenging" class="xref">CHALLENGING</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a href="#section-5.6" class="xref">5.6</a>.  <a href="#name-active" class="xref">ACTIVE</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.7">
                <p id="section-toc.1-1.5.2.7.1"><a href="#section-5.7" class="xref">5.7</a>.  <a href="#name-committing" class="xref">COMMITTING</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.8">
                <p id="section-toc.1-1.5.2.8.1"><a href="#section-5.8" class="xref">5.8</a>.  <a href="#name-committed" class="xref">COMMITTED</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.9">
                <p id="section-toc.1-1.5.2.9.1"><a href="#section-5.9" class="xref">5.9</a>.  <a href="#name-peer_commit" class="xref">PEER_COMMIT</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.10">
                <p id="section-toc.1-1.5.2.10.1"><a href="#section-5.10" class="xref">5.10</a>. <a href="#name-committing2" class="xref">COMMITTING2</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.11">
                <p id="section-toc.1-1.5.2.11.1"><a href="#section-5.11" class="xref">5.11</a>. <a href="#name-closable" class="xref">CLOSABLE</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.12">
                <p id="section-toc.1-1.5.2.12.1"><a href="#section-5.12" class="xref">5.12</a>. <a href="#name-shut_requested" class="xref">SHUT_REQUESTED</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.13">
                <p id="section-toc.1-1.5.2.13.1"><a href="#section-5.13" class="xref">5.13</a>. <a href="#name-pre_closed" class="xref">PRE_CLOSED</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.14">
                <p id="section-toc.1-1.5.2.14.1"><a href="#section-5.14" class="xref">5.14</a>. <a href="#name-closed" class="xref">CLOSED</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.15">
                <p id="section-toc.1-1.5.2.15.1"><a href="#section-5.15" class="xref">5.15</a>. <a href="#name-cloning" class="xref">CLONING</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.16">
                <p id="section-toc.1-1.5.2.16.1"><a href="#section-5.16" class="xref">5.16</a>. <a href="#name-passive-multiplication" class="xref">Passive Multiplication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.17">
                <p id="section-toc.1-1.5.2.17.1"><a href="#section-5.17" class="xref">5.17</a>. <a href="#name-typical-state-transitions" class="xref">Typical State Transitions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.17.2.1">
                    <p id="section-toc.1-1.5.2.17.2.1.1"><a href="#section-5.17.1" class="xref">5.17.1</a>.  <a href="#name-typical-main-connection" class="xref">Typical Main Connection</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.17.2.2">
                    <p id="section-toc.1-1.5.2.17.2.2.1"><a href="#section-5.17.2" class="xref">5.17.2</a>.  <a href="#name-typical-clone-connection-fo" class="xref">Typical Clone Connection for Get Resource</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.17.2.3">
                    <p id="section-toc.1-1.5.2.17.2.3.1"><a href="#section-5.17.3" class="xref">5.17.3</a>.  <a href="#name-typical-clone-connection-for" class="xref">Typical Clone Connection for Push Message</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.17.2.4">
                    <p id="section-toc.1-1.5.2.17.2.4.1"><a href="#section-5.17.4" class="xref">5.17.4</a>.  <a href="#name-simultaneous-shutdown" class="xref">Simultaneous Shutdown</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-end-to-end-negotiation" class="xref">End-to-End Negotiation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-connect-initialization-2" class="xref">Connect Initialization</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-response-to-connect-initial" class="xref">Response to Connect Initialization</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-connection-incarnation-requ" class="xref">Connection Incarnation Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-connection-incarnation-resp" class="xref">Connection Incarnation Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a href="#section-6.5" class="xref">6.5</a>.  <a href="#name-the-last-confirmation" class="xref">The Last Confirmation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.6">
                <p id="section-toc.1-1.6.2.6.1"><a href="#section-6.6" class="xref">6.6</a>.  <a href="#name-retransmission" class="xref">Retransmission</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-quad-party-session-key-inst" class="xref">Quad-party Session Key Installation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-api-for-session-key-install" class="xref">API for Session Key Installation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-time-to-call-api-for-sessio" class="xref">Time to Call API for Session Key Installation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-time-to-take-new-session-ke" class="xref">Time to Take New Session Key into Effect</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="xref">7.4</a>.  <a href="#name-generating-the-initial-sess" class="xref">Generating the Initial Session Key</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a href="#section-7.5" class="xref">7.5</a>.  <a href="#name-internal-rekeying" class="xref">Internal Rekeying</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.6">
                <p id="section-toc.1-1.7.2.6.1"><a href="#section-7.6" class="xref">7.6</a>.  <a href="#name-sample-sequence-of-installi" class="xref">Sample Sequence of Installing Session Key</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-send-and-receive" class="xref">Send and Receive</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-packet-integrity-protection" class="xref">Packet Integrity Protection</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.1">
                    <p id="section-toc.1-1.8.2.1.2.1.1"><a href="#section-8.1.1" class="xref">8.1.1</a>.  <a href="#name-application-of-crc64" class="xref">Application of CRC64</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.2">
                    <p id="section-toc.1-1.8.2.1.2.2.1"><a href="#section-8.1.2" class="xref">8.1.2</a>.  <a href="#name-packet-authentication-only" class="xref">Packet Authentication Only</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.3">
                    <p id="section-toc.1-1.8.2.1.2.3.1"><a href="#section-8.1.3" class="xref">8.1.3</a>.  <a href="#name-authenticated-encryption-wi" class="xref">Authenticated Encryption with Additional Data</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.4">
                    <p id="section-toc.1-1.8.2.1.2.4.1"><a href="#section-8.1.4" class="xref">8.1.4</a>.  <a href="#name-icc-of-the-out-of-band-pack" class="xref">ICC of the Out-of-Band Packet</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-start-a-new-transmit-transa" class="xref">Start a New Transmit Transaction</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.  <a href="#name-send-a-pure-data-packet" class="xref">Send a Pure Data Packet</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="xref">8.4</a>.  <a href="#name-commit-a-transmit-transacti" class="xref">Commit a Transmit Transaction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4.2.1">
                    <p id="section-toc.1-1.8.2.4.2.1.1"><a href="#section-8.4.1" class="xref">8.4.1</a>.  <a href="#name-initiate-transmit-transacti" class="xref">Initiate Transmit Transaction Commitment</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4.2.2">
                    <p id="section-toc.1-1.8.2.4.2.2.1"><a href="#section-8.4.2" class="xref">8.4.2</a>.  <a href="#name-respond-to-transmit-transac" class="xref">Respond to Transmit Transaction Commitment</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4.2.3">
                    <p id="section-toc.1-1.8.2.4.2.3.1"><a href="#section-8.4.3" class="xref">8.4.3</a>.  <a href="#name-finalize-transmit-transacti" class="xref">Finalize Transmit Transaction Commitment</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4.2.4">
                    <p id="section-toc.1-1.8.2.4.2.4.1"><a href="#section-8.4.4" class="xref">8.4.4</a>.  <a href="#name-time-out-for-committing-tra" class="xref">Time-out for Committing Transmit Transaction</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="xref">8.5</a>.  <a href="#name-retransmission-2" class="xref">Retransmission</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.5.2.1">
                    <p id="section-toc.1-1.8.2.5.2.1.1"><a href="#section-8.5.1" class="xref">8.5.1</a>.  <a href="#name-calculation-of-rtt" class="xref">Calculation of RTT</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.5.2.2">
                    <p id="section-toc.1-1.8.2.5.2.2.1"><a href="#section-8.5.2" class="xref">8.5.2</a>.  <a href="#name-generation-and-transmission" class="xref">Generation and transmission of SNACK</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.5.2.3">
                    <p id="section-toc.1-1.8.2.5.2.3.1"><a href="#section-8.5.3" class="xref">8.5.3</a>.  <a href="#name-negative-acknowledgment-of-" class="xref">Negative acknowledgment of Packets Sent</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.5.2.4">
                    <p id="section-toc.1-1.8.2.5.2.4.1"><a href="#section-8.5.4" class="xref">8.5.4</a>.  <a href="#name-retransmission-interval" class="xref">Retransmission Interval</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.6">
                <p id="section-toc.1-1.8.2.6.1"><a href="#section-8.6" class="xref">8.6</a>.  <a href="#name-flow-control" class="xref">Flow Control</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.7">
                <p id="section-toc.1-1.8.2.7.1"><a href="#section-8.7" class="xref">8.7</a>.  <a href="#name-congestion-control" class="xref">Congestion Control</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.8">
                <p id="section-toc.1-1.8.2.8.1"><a href="#section-8.8" class="xref">8.8</a>.  <a href="#name-on-the-wire-compression-2" class="xref">On-the-Wire Compression</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.9">
                <p id="section-toc.1-1.8.2.9.1"><a href="#section-8.9" class="xref">8.9</a>.  <a href="#name-milk-like-payload-and-minim" class="xref">Milk Like Payload and Minimal Delay Service</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-graceful-shutdown" class="xref">Graceful Shutdown</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-initiation-of-graceful-shut" class="xref">Initiation of Graceful Shutdown</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-acknowledgment-of-graceful-" class="xref">Acknowledgment of Graceful Shutdown</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="xref">9.3</a>.  <a href="#name-finalization-of-graceful-sh" class="xref">Finalization of Graceful Shutdown</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="xref">9.4</a>.  <a href="#name-retransmission-of-release-p" class="xref">Retransmission of RELEASE Packet</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-mobility-and-multi-home-sup" class="xref">Mobility and Multi-home Support</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-heartbeat-signals" class="xref">Heartbeat Signals</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-active-address-change-signa" class="xref">Active Address Change Signaling</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#section-10.3" class="xref">10.3</a>.  <a href="#name-heuristic-remote-address-ch" class="xref">Heuristic Remote Address Change Adaptation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.4">
                <p id="section-toc.1-1.10.2.4.1"><a href="#section-10.4" class="xref">10.4</a>.  <a href="#name-heuristic-address-change-ac" class="xref">Heuristic Address Change Acknowledgement</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.5">
                <p id="section-toc.1-1.10.2.5.1"><a href="#section-10.5" class="xref">10.5</a>.  <a href="#name-nat-traversal-and-multihomi" class="xref">NAT-traversal and Multihoming</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.6">
                <p id="section-toc.1-1.10.2.6.1"><a href="#section-10.6" class="xref">10.6</a>.  <a href="#name-explicit-multi-home-informi" class="xref">Explicit Multi-home Informing</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-connection-multiplication" class="xref">Connection Multiplication</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.  <a href="#name-request-to-multiply-connect" class="xref">Request to Multiply Connection</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.  <a href="#name-response-to-connection-mult" class="xref">Response to Connection Multiplication Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#section-11.3" class="xref">11.3</a>.  <a href="#name-duplicate-detection-of-conn" class="xref">Duplicate Detection of Connection Multiplication Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.4">
                <p id="section-toc.1-1.11.2.4.1"><a href="#section-11.4" class="xref">11.4</a>.  <a href="#name-retransmission-3" class="xref">Retransmission</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.5">
                <p id="section-toc.1-1.11.2.5.1"><a href="#section-11.5" class="xref">11.5</a>.  <a href="#name-key-derivation-for-branch-c" class="xref">Key Derivation for Branch Connection</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-timeouts-and-abrupt-close" class="xref">Timeouts and Abrupt Close</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="xref">12.1</a>.  <a href="#name-timeouts-in-end-to-end-nego" class="xref">Timeouts in End-to-End Negotiation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="xref">12.2</a>.  <a href="#name-timeouts-in-multiply" class="xref">Timeouts in Multiply</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a href="#section-12.3" class="xref">12.3</a>.  <a href="#name-timeout-of-transmit-transac" class="xref">Timeout of Transmit Transaction Commitment</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.4">
                <p id="section-toc.1-1.12.2.4.1"><a href="#section-12.4" class="xref">12.4</a>.  <a href="#name-timeout-of-graceful-shutdow" class="xref">Timeout of Graceful Shutdown</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.5">
                <p id="section-toc.1-1.12.2.5.1"><a href="#section-12.5" class="xref">12.5</a>.  <a href="#name-idle-timeout" class="xref">Idle Timeout</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.6">
                <p id="section-toc.1-1.12.2.6.1"><a href="#section-12.6" class="xref">12.6</a>.  <a href="#name-session-key-timeout" class="xref">Session Key Timeout</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.7">
                <p id="section-toc.1-1.12.2.7.1"><a href="#section-12.7" class="xref">12.7</a>.  <a href="#name-abrupt-close" class="xref">Abrupt Close</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="xref">13</a>. <a href="#name-issues-for-further-study" class="xref">Issues for Further Study</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="xref">13.1</a>.  <a href="#name-resolution-of-ultid-in-dns" class="xref">Resolution of ULTID in DNS</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-13.2" class="xref">13.2</a>.  <a href="#name-proxy-pattern-for-syndicate" class="xref">Proxy Pattern for Syndicated Name Resolution</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.3">
                <p id="section-toc.1-1.13.2.3.1"><a href="#section-13.3" class="xref">13.3</a>.  <a href="#name-asymmetric-transmission" class="xref">Asymmetric Transmission</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="xref">14</a>. <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#section-14.1" class="xref">14.1</a>.  <a href="#name-deny-of-service-attack" class="xref">Deny of Service Attack</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#section-14.2" class="xref">14.2</a>.  <a href="#name-replay-attack" class="xref">Replay Attack</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3">
                <p id="section-toc.1-1.14.2.3.1"><a href="#section-14.3" class="xref">14.3</a>.  <a href="#name-passive-attacks" class="xref">Passive Attacks</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.4">
                <p id="section-toc.1-1.14.2.4.1"><a href="#section-14.4" class="xref">14.4</a>.  <a href="#name-masquerade-attack" class="xref">Masquerade Attack</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.5">
                <p id="section-toc.1-1.14.2.5.1"><a href="#section-14.5" class="xref">14.5</a>.  <a href="#name-active-man-in-the-middle-at" class="xref">Active Man-In-The-Middle Attack</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.6">
                <p id="section-toc.1-1.14.2.6.1"><a href="#section-14.6" class="xref">14.6</a>.  <a href="#name-privacy-concerns" class="xref">Privacy Concerns</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="xref">15</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#section-16" class="xref">16</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.1">
                <p id="section-toc.1-1.16.2.1.1"><a href="#section-16.1" class="xref">16.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.2">
                <p id="section-toc.1-1.16.2.2.1"><a href="#section-16.2" class="xref">16.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-acknowledgements" class="xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#appendix-B" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="sect-1">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The dominating transport layer protocols, TCP and UDP that take use
      of the IP address to identifying the end node, introduce the
      controversial role of IP address both as the identifier and as the
      routing locater.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Flexible Session Protocol, introduces the concept of 'upper layer
      thread ID' (ULTID), which was firstly suggested in <span>[<a href="#Gao2002" class="xref">Gao2002</a>]</span>. The ULTID is unique in the local context of the FSP
      node. Its significance may be compared with the Security Parameter Index
      (SPI) in MOBIKE <span>[<a href="#RFC4555" class="xref">RFC4555</a>]</span>.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">An integrity check code (ICC) field is designed in the FSP packet
      header to protect authenticity and optionally privacy of the FSP packet.
      The ICC field is designed to be associated with some shared secret
      indexed by the source or destination ULTID in the local context of the
      source or destination node, respectively. An FSP packet is assumed to
      originate from the same source if the ICC value associated the ULTID
      passes validation, regardless of the full source or destination address.
      In such a way FSP provides provides mobility, multi-homing and
      multi-path support.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">ICC is either calculated by <span>[<a href="#CRC64" class="xref">CRC64</a>]</span> which protects FSP
      against unintended modification, or a cryptographic hash function, or
      cryptographically calculated with some Authenticated Encryption with
      Additional Data <span>[<a href="#R01" class="xref">R01</a>]</span> algorithm, each of which requires a
      shared secret key.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">In the former case a weak key meant to obfuscate the CRC64 checksum
      is agreed by the FSP participants. In the latter two cases, the shared
      secret key is assumed to be installed by the upper layer application
      (ULA).<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">Either the weak key or the shared secret key is indexed by the source
      or destination ULTID in the local context of the sender or the receiver,
      respectively.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">FSP facilitates secret key installation by introducing the concept of
      transmit transaction. Mechanism of transmit transaction also provides
      the session-connection synchronization service to the upper layer.<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">FSP is a transport layer protocol as specified in <span>[<a href="#RFC1122" class="xref">RFC1122</a>]</span>, provides services alike TCP <span>[<a href="#STD5" class="xref">STD5</a>]</span> to
      ULA, with session layer features as suggested in <span>[<a href="#OSI_RM" class="xref">OSI_RM</a>]</span>, most noticeably session-connection synchronization by
      introducing the concept of transmit transaction.<a href="#section-1-8" class="pilcrow">¶</a></p>
<div id="sect-1.1">
<section id="section-1.1">
        <h3 id="name-features">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-features" class="section-name selfRef">Features</a>
        </h3>
<div id="sect-1.1.1">
<section id="section-1.1.1">
          <h4 id="name-transport-layer-mobility-su">
<a href="#section-1.1.1" class="section-number selfRef">1.1.1. </a><a href="#name-transport-layer-mobility-su" class="section-name selfRef">Transport Layer Mobility Support</a>
          </h4>
<p id="section-1.1.1-1">FSP is meant to be transport layer protocol that keeps the IP
          address as the routing locater but keeps it from being the key
          constituent of the end point identifier of FSP or any upper layer
          protocol built upon FSP.<a href="#section-1.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-1.1.2">
<section id="section-1.1.2">
          <h4 id="name-flexibility-to-exploit-auth">
<a href="#section-1.1.2" class="section-number selfRef">1.1.2. </a><a href="#name-flexibility-to-exploit-auth" class="section-name selfRef">Flexibility to exploit Authenticated Encryption</a>
          </h4>
<p id="section-1.1.2-1">By optionally applying authenticated encryption with additional
          data on each FSP packet, FSP provides both authentication of message
          origin and privacy protection service to the upper layer
          application.<a href="#section-1.1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.1.2-2">The shared key required by the authenticated encryption algorithm
          is supposed to be established and installed onto the FSP layer by
          the upper layer application (ULA), and by introducing the concept of
          transmit tranaction FSP provides mechanism for the connected ULAs to
          synchronize installation of the shared key. Thus FSP makes it
          flexible to test, try or apply new key establish algorithms.<a href="#section-1.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-1.1.3">
<section id="section-1.1.3">
          <h4 id="name-transmit-transaction">
<a href="#section-1.1.3" class="section-number selfRef">1.1.3. </a><a href="#name-transmit-transaction" class="section-name selfRef">Transmit Transaction</a>
          </h4>
<p id="section-1.1.3-1">FSP introduces the concept of transmit transaction, which makes
          it able to mark end of message inherently at the transport layer,
          effectively eliminate the requirement of message delimiters at the
          application layer. Besides, it still provides byte-stream-oriented
          transfer service to its upper layer application which is familiar
          and friendly to application developers.<a href="#section-1.1.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-1.1.4">
<section id="section-1.1.4">
          <h4 id="name-light-weight-session-manage">
<a href="#section-1.1.4" class="section-number selfRef">1.1.4. </a><a href="#name-light-weight-session-manage" class="section-name selfRef">Light-weight session management</a>
          </h4>
<p id="section-1.1.4-1">In addition to transmit transaction mechanism, which is arguably
          a feature of session-connection synchronization, the FSP upper layer
          application is able to fork branch connections of an established
          connection in zero round-trip mode without compromising security. In
          this way FSP provides light-weight session management service to
          ULA.<a href="#section-1.1.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-1.1.5">
<section id="section-1.1.5">
          <h4 id="name-on-the-wire-compression">
<a href="#section-1.1.5" class="section-number selfRef">1.1.5. </a><a href="#name-on-the-wire-compression" class="section-name selfRef">On-the-wire Compression</a>
          </h4>
<p id="section-1.1.5-1">FSP provides on-the-wire compression service through the
          on-the-wire compression and fragmentation function module.<a href="#section-1.1.5-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-1.2">
<section id="section-1.2">
        <h3 id="name-requirements-language">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-requirements-language" class="section-name selfRef">Requirements Language</a>
        </h3>
<p id="section-1.2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in RFC 2119 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span>.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">In this document, these words will appear with that interpretation
        only when in ALL CAPS. Lower case uses of these words are not to be
        interpreted as carrying significance described in RFC 2119.<a href="#section-1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-1.3">
<section id="section-1.3">
        <h3 id="name-conventions">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-conventions" class="section-name selfRef">Conventions</a>
        </h3>
<p id="section-1.3-1">Conventions in describing the finite state machine (FSM) of FSP
        are:<a href="#section-1.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-1.3-2">
<pre>
ESTABLISHED           The string of alphabetic characters designates
                      the name of the           state
[API: Reset]          Upper Layer Application Programming Interface
                      Call
{Notify}              Call back/notify the upper layer application
{new context}         Additional action before or after state
                      transition
[Send                 Send some FSP packet
OPCODE_OF_FSP_PACKET]
[Retransmit           Retransmit some FSP packet
OPCODE_OF_FSP_PACKET]
{On transient state   Timed-out event
Timeout}
{&amp;&amp; additional        Together with some additional condition
condition}
--&gt;                   state transition
|--                   branch
</pre><a href="#section-1.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="sect-2">
<section id="section-2">
      <h2 id="name-abbreviations-and-idioms">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-abbreviations-and-idioms" class="section-name selfRef">Abbreviations and Idioms</a>
      </h2>
<ul class="normal">
<li class="normal" id="section-2-1.1">Connection An FSP connection is the binding of two network nodes
          established through some end-to-end negotiation process. It is
          identified by the ULTID in the local context of each network node,
          respectively.<a href="#section-2-1.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-1.2">
          <p id="section-2-1.2.1">EoT End of Transaction. A transmit transaction is said to reach
          EoT if the EoT flag is set in a legitimate PURE_DATA, PERSIST,
          NULCOMMIT or MULTIPLY packet. We said that the packet terminates the
          transmit transaction if the EoT flag is set.<a href="#section-2-1.2.1" class="pilcrow">¶</a></p>
<p id="section-2-1.2.2">
          An FSP end node SHALL NOT send further data if it has initiated EoT
          of its transmit direction unless a particular ACK_FLUSH packet is
          received. The particular ACK_FLUSH packet MUST acknowledge not only
          the packet with the EoT flag set but all of the packets sent before
          the packet as well.<a href="#section-2-1.2.2" class="pilcrow">¶</a></p>
<p id="section-2-1.2.3"> EoT, i.e. termination
          of transmit transaction is unilateral.<a href="#section-2-1.2.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-1.3">
          <p id="section-2-1.3.1">FREWS<a href="#section-2-1.3.1" class="pilcrow">¶</a></p>
<p id="section-2-1.3.2"> The Flags and advertised REceive
          Window Size. It is the 32-bit combined word next to the ICC field in
          the normal FSP fixed header.<a href="#section-2-1.3.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-1.4">
          <p id="section-2-1.4.1">ICC The Identity Check Code. It is a 64-bit value that depends on
          both the session key and all of the headers of the FSP packet to
          include the ICC, calculated with the same algorithm in the context
          of each FSP participant.<a href="#section-2-1.4.1" class="pilcrow">¶</a></p>
<p id="section-2-1.4.2"> Only a packet with
          correct ICC can be accepted by any FSP participant as soon as the
          connection has been established.<a href="#section-2-1.4.2" class="pilcrow">¶</a></p>
<p id="section-2-1.4.3"> Initially
          CRC64 is exploited to make a checksum that weekly protects the FSP
          packet against unintentional modification. The checksum is
          obfuscated with the initial session key to get the ICC. After the
          ULA installed the long-term session key either some cryptographic
          hash function or some Authenticated Encryption with Additional Data
          algorithm shall be applied to obtain or check the ICC.<a href="#section-2-1.4.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-1.5">
          <p id="section-2-1.5.1">Session An FSP session is the transport-layer association of two
          network nodes. A full FSP session consists of one connection that
          was established from scratch and all of its branches.<a href="#section-2-1.5.1" class="pilcrow">¶</a></p>
<p id="section-2-1.5.2"> However for this version of FSP specification the
          idioms session and connection are interchangeable if not explicitly
          specified.<a href="#section-2-1.5.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-1.6">
          <p id="section-2-1.6.1">Session Key The session key is a bit string of at least 128 bits
          that means to resist against masquerade attack. It is either
          initiated during the end-to-end negotiation phase or installed by
          the ULA after the FSP connection is established.<a href="#section-2-1.6.1" class="pilcrow">¶</a></p>
<p id="section-2-1.6.2"> The session key installed by the ULA is called the
          long-term session key. Here long-term means that the key could be
          used until the packet sequence space is exhausted. The packet
          sequence space is exhausted if the number of packets that use the
          same key reaches or exceeds 2,147,483,647(2^31-1).<a href="#section-2-1.6.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-1.7">
          <p id="section-2-1.7.1">SN The Sequence Number. It is the unsigned 32-bit integer number
          assigned to every FSP packet except the preliminary packets.<a href="#section-2-1.7.1" class="pilcrow">¶</a></p>
<p id="section-2-1.7.2"> Difference of two sequence number is represented by
          a 32-bit signed integer. If the result of SN B subtracting SN A is
          greater than zero, we say that B is greater than A and the packet of
          the sequence number B is later than the packet of the sequence
          number A, although the unsigned integer representation of B may be
          far less that A. Consequently, as the result of A subtracting B is
          less than zero, we say that A is less than B and the packet of the
          sequence number A is earlier than the packet of the sequence number
          A.<a href="#section-2-1.7.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-1.8">
          <p id="section-2-1.8.1">Transmit Transaction A transmit transaction in FSP is a sequence
          of FSP packets that were sent and marked by the ULA as one
          continuous stream where all packets in the stream must be
          acknowledged before any further packet is allowed to be sent.<a href="#section-2-1.8.1" class="pilcrow">¶</a></p>
<p id="section-2-1.8.2"> A ACK_CONNECT_REQ, PERSIST or MULTIPLY packet
          always starts a new transmit transaction.<a href="#section-2-1.8.2" class="pilcrow">¶</a></p>
<p id="section-2-1.8.3">
          Any packet with EoT flag set, including the NULCOMMIT packet which
          is payload-less, terminates the transmit transaction.<a href="#section-2-1.8.3" class="pilcrow">¶</a></p>
<p id="section-2-1.8.4"> The NULCOMMIT both starts and terminates a
          payload-less transmit transaction when it is exploited to
          acknowledge the ACK_CONNECT_REQ or MULTIPLY packet.<a href="#section-2-1.8.4" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-1.9">ULA The Upper Layer Application.<a href="#section-2-1.9" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-1.10">
          <p id="section-2-1.10.1">ULTID The Upper Layer Thread Identifier (ULTID). It is a 32-bit
          word that was allocated by particular network end node of an FSP
          connection and is unique in the local context of the network end
          node.<a href="#section-2-1.10.1" class="pilcrow">¶</a></p>
<p id="section-2-1.10.2"> Theoretically all of the ULAs of a
          network end node MAY establish up to 2^31-1 FSP connections totally.
          Each connection MUST have a unique thread identifier (ULTID)
          assigned in the local context of the network end node.<a href="#section-2-1.10.2" class="pilcrow">¶</a></p>
<p id="section-2-1.10.3"> A session or connection in FSP does not require a
          global ID.<a href="#section-2-1.10.3" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="sect-3">
<section id="section-3">
      <h2 id="name-key-mechanisms">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-key-mechanisms" class="section-name selfRef">Key Mechanisms</a>
      </h2>
<div id="sect-3.1">
<section id="section-3.1">
        <h3 id="name-underlying-layer-services-r">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-underlying-layer-services-r" class="section-name selfRef">Underlying Layer Services Required</a>
        </h3>
<p id="section-3.1-1">FSP requires that the underlying layer provides packet delivery
        service. In addition FSP supposes that the underlying layer has
        following features:<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<div id="sect-3.1.1">
<section id="section-3.1.1">
          <h4 id="name-handling-of-high-mobility">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-handling-of-high-mobility" class="section-name selfRef">Handling of High Mobility</a>
          </h4>
<p id="section-3.1.1-1">Here high mobility refers to scenarios such as high-speed train
          or airplane.<a href="#section-3.1.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1.1-2">FSP solves somewhat coarse-grain or low-speed mobility problem.
          Fine-grain or high-speed mobility is left to the underlying physical
          network. To make mobility support work effectively it is assumed
          that one end-node MUST keep its lower layer address reasonably
          stable while the other end-node SHOULD NOT change its lower layer
          address too frequently.<a href="#section-3.1.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1.1-3">Here the meaning of physical network conforms to what was
          depicted in <span>[<a href="#RFC1122" class="xref">RFC1122</a>]</span>.<a href="#section-3.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-3.1.2">
<section id="section-3.1.2">
          <h4 id="name-network-address-change-noti">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-network-address-change-noti" class="section-name selfRef">Network Address Change Notification</a>
          </h4>
<p id="section-3.1.2-1">Network address change notification is mandatory only in the IPv6
          network.<a href="#section-3.1.2-1" class="pilcrow">¶</a></p>
<p id="section-3.1.2-2">We split the IPv6 address of the IPv6 packet underlying FSP into
          three parts. The leftmost 64-bit long word is the network prefix,
          which SHOULD be the unique IPv6 prefix assigned to the host <span>[<a href="#RFC8273" class="xref">RFC8273</a>]</span>. The centermost 32-bit word is called the
          aggregation host ID, and the rightmost 32-bit word is the ULTID.
          While the ULTID MUST be kept stable even during the life of an FSP
          session, the network prefix part MAY change when an endpoint is
          roaming. The aggregation host ID may change as well. The network
          prefix part together with the aggregation host ID part act as the
          traditional routing locator at the network layer.<a href="#section-3.1.2-2" class="pilcrow">¶</a></p>
<p id="section-3.1.2-3">The aggragation host ID SHOULD NOT be 0, nor hexadecimal value
          FDFFFFFFF, nor hexadecimal value FFFFFFFFF so that the final IPv6
          address assigned can not be an IPv6 subnet anycast address<span>[<a href="#RFC2526" class="xref">RFC2526</a>]</span>.<a href="#section-3.1.2-3" class="pilcrow">¶</a></p>
<p id="section-3.1.2-4">It is supposed that the network layer immediately notifies the
          FSP layer if the network prefix or aggregation host ID changes.<a href="#section-3.1.2-4" class="pilcrow">¶</a></p>
<p id="section-3.1.2-5">An participant of an FSP connection SHALL immediately notify its
          peer whenever its underlying IPv6 address is changed with a
          KEEP_ALIVE packet. The peer shall send packet to the participant
          that has notified the address change with the new address.<a href="#section-3.1.2-5" class="pilcrow">¶</a></p>
<p id="section-3.1.2-6">It is supposed that the packet to inform the remote end to update
          the lower layer address association could reach its destination in a
          satisfying success rate.<a href="#section-3.1.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-3.1.3">
<section id="section-3.1.3">
          <h4 id="name-network-congestion-control">
<a href="#section-3.1.3" class="section-number selfRef">3.1.3. </a><a href="#name-network-congestion-control" class="section-name selfRef">Network Congestion Control</a>
          </h4>
<p id="section-3.1.3-1">Network layer congestion control is mandatory only in future IPv6
          network.<a href="#section-3.1.3-1" class="pilcrow">¶</a></p>
<p id="section-3.1.3-2">It is supposed that end-to-end congestion control is provided at
          some sub-layer of the network layer. Implementation of FSP MUST
          include a congestion manager <span>[<a href="#RFC3124" class="xref">RFC3124</a>]</span> if such
          sub-layer service of the network layer is not provided.<a href="#section-3.1.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-3.2">
<section id="section-3.2">
        <h3 id="name-identifying-connection-by-l">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-identifying-connection-by-l" class="section-name selfRef">Identifying Connection by Local ULTID</a>
        </h3>
<p id="section-3.2-1">Each FSP connection prepares a pair of ULTIDs. An ULTID uniquely
        indexes a connection in the local context of an FSP end node. An FSP
        end node relies neither source IP address nor destination IP address,
        except the ULTID part of the near end's IPv6 address to identify an
        FSP connection.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">Each ULTID is allocated in the local context of the two FSP
        participant respectively. The source ULTID and the destination ULTID
        of an FSP packet usually differ in their values. However, the secret
        keys indexed in the local contexts of the two end-points must have the
        same value.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-3.3">
<section id="section-3.3">
        <h3 id="name-defending-against-connectio">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-defending-against-connectio" class="section-name selfRef">Defending Against Connection Hijacking with ICC</a>
        </h3>
<p id="section-3.3-1">An integrity check code (ICC) field associated with the ULTID is
        designed in the FSP header to protect authenticity and optionally
        privacy of the FSP packet. An FSP packet is assumed to originate from
        the same source if the ICC value associated with certain destination
        ULTID passes validation, regardless of the source or destination
        address in the underlying layer.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">On initiating FSP takes use of <span>[<a href="#CRC64" class="xref">CRC64</a>]</span> to make
        checksum of the FSP packet to protect it against unintentional
        modification. The checksum is taken as the ICC.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3">After the ULA has installed a shared secret key, value of ICC is
        calculated by firstly getting the secret key associated indexed by the
        local ULTID, then calculating the tag value with the AES-GCM <span>[<a href="#GCM" class="xref">GCM</a>]</span> authenticated encryption with additional data algorithm
        , or calculating the message authentication code with the BLAKE2
        algorithm <span>[<a href="#RFC7693" class="xref">RFC7693</a>]</span>.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-3.4">
<section id="section-3.4">
        <h3 id="name-synchronizing-key-installat">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-synchronizing-key-installat" class="section-name selfRef">Synchronizing Key Installation with Transmit Transaction</a>
        </h3>
<p id="section-3.4-1">It is proposed that it is the ULA to do key establishment and/or
        end- point user-agent authentication while the FSP layer provides
        authenticated, optionally encrypted data transfer service.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<p id="section-3.4-2">A dedicate application program interface (API) is designed for the
        ULA to install the secret key established by the ULA participants.<a href="#section-3.4-2" class="pilcrow">¶</a></p>
<p id="section-3.4-3">FSP facilitates shared secret key installation by introducing the
        concept of transmit transaction.<a href="#section-3.4-3" class="pilcrow">¶</a></p>
<p id="section-3.4-4">A transmit transaction of FSP is a sequence of FSP packets that
        were sent and requested by ULA as one continuous stream where all
        packets in the stream MUST be acknowledged before any further packet
        is allowed to be sent.<a href="#section-3.4-4" class="pilcrow">¶</a></p>
<p id="section-3.4-5">A flag called 'End of Transaction' (EoT) is designed in the FSP
        header. When it is set, it marks that the transmit transaction in the
        direction from the source of the FSP packet towards the destination of
        the FSP packet is 'committed'.<a href="#section-3.4-5" class="pilcrow">¶</a></p>
<p id="section-3.4-6">As the FSP node knows when a transmit transaction at FSP layer is
        terminated there is no ambiguity which packet is to be applied with
        the new session key when the key is installed by ULA through the
        dedicated API.<a href="#section-3.4-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-3.5">
<section id="section-3.5">
        <h3 id="name-0-rtt-connection-multiplica">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-0-rtt-connection-multiplica" class="section-name selfRef">0-RTT Connection Multiplication with OOB Packet</a>
        </h3>
<p id="section-3.5-1">An FSP connection MAY be multiplied to get a branch or branches of
        the connection. Multiplication of a connection is protected by
        deriving new session key from the original security context of the
        connection.<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<p id="section-3.5-2">The packet that carries the command to multiply an established FSP
        connection MUST be sent from a new allocated local ULTID towards the
        destination ULTID of the original connection. It is an out-of-band
        (OOB) packet in the context of the original connection and it MUST be
        cryptographically protected by the secret key of the original
        connection. The packet MAY carry payload.<a href="#section-3.5-2" class="pilcrow">¶</a></p>
<p id="section-3.5-3">The receiver of the packet MUST allocate a new local ULTID, accept
        the optional payload in the new context associated with the new ULTID,
        derive a new secret key from the secret key of the original
        connection, and responds from the new context. The response MAY carry
        payload.<a href="#section-3.5-3" class="pilcrow">¶</a></p>
<p id="section-3.5-4">The very first response packet MUST be protected by the new secret
        key. The sender of the multiply command packet MUST automatically
        inaugurate the same secret key, derived from the secret key of the
        same original connection. And it MUST treat the response packet as
        though a transmit transaction had been committed by the responder,
        i.e. authenticity of the response packet is verified with the new
        secret key.<a href="#section-3.5-4" class="pilcrow">¶</a></p>
<p id="section-3.5-5">Thus the branch connection of a new pair of ULTIDs is established
        with zero round-trip overhead. This mechanism may be exploited to
        provide expedited data transfer or parallel data transfer service.<a href="#section-3.5-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-4">
<section id="section-4">
      <h2 id="name-packet-structure">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-packet-structure" class="section-name selfRef">Packet Structure</a>
      </h2>
<div id="sect-4.1">
<section id="section-4.1">
        <h3 id="name-fsp-over-udp-ipv4">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-fsp-over-udp-ipv4" class="section-name selfRef">FSP over UDP/IPv4</a>
        </h3>
<p id="section-4.1-1">In this version of FSP, when FSP is implemented in the IPv4
        network, every FSP packet MUST be encapsulated in a UDP <span>[<a href="#STD6" class="xref">STD6</a>]</span> datagram. The UDP datagram encapsulated the FSP packet
        SHALL have the checksum disabled (i.e. set its value to 0) <span>[<a href="#RFC8085" class="xref">RFC8085</a>]</span>. The Source and the destination ULTIDs are put at
        the leading position of the UDP payload. FSP fixed header, optional
        extension headers and FSP payload follow the ULTIDs:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-2">
<pre>
 0                            15 16                           31
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Source Port           |        Destination Port       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Length             |             0                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 Source Upper Layer Thread ID                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Destination Upper Layer Thread ID               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                          FSP Fix Header                       ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                Optional FSP Extension Headers                 ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                                                               ~
~                       Optional  FSP payload                   ~
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-4.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sect-4.2">
<section id="section-4.2">
        <h3 id="name-fsp-over-ipv6">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-fsp-over-ipv6" class="section-name selfRef">FSP over IPv6</a>
        </h3>
<p id="section-4.2-1">When FSP is implemented over IPv6 <span>[<a href="#RFC8200" class="xref">RFC8200</a>]</span>, the
        ULTID part is embedded in the IPv6 address. FSP fixed header follows
        the IPv6 headers:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2-2">
<pre>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~                          IPv6 Header:                         ~
 0                            15 16                           31
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version| Traffic Class |           Flow Label                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Payload Length        |  Next Header  |   Hop Limit   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                        Source Network Prefix  +
|                                                               |
+                 Source Address    ----------------------------+
|                                   Source Aggregation Host ID  |
+                                   ----------------------------+
|                                 Source Upper Layer Thread ID  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                   Destination Network Prefix  +
|                                                               |
+        Destination Address   ---------------------------------+
|                              Destination Aggregation Host ID  |
+                              ---------------------------------+
|                            Destination Upper Layer Thread ID  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                                                               ~
~                    Optional IPv6 Headers                      ~
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                          FSP Fix Header                       ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                Optional FSP Extension Headers                 ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                                                               ~
~                       Optional  FSP payload                   ~
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-4.2-2" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-4.2-3.1">Network Prefix The leftmost 64-bit of the IPv6 address which
            MAY and usually do have different value at the difference
            interface of an IPv6 end- node.<a href="#section-4.2-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-3.2">Aggregation Host ID The left 32-bit part of the rightmost
            64-bit long word of the IPv6 address. All of the aggregation host
            ID parts of an IPv6 end- node's IPv6 addresses MUST have the same
            value for this version of FSP.<a href="#section-4.2-3.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-4">Network prefix and aggregation host ID make the IPv6 prefix part of
        the IPv6 address under the context of FSP. It is assumed that there is
        a unique IPv6 prefix per host <span>[<a href="#RFC8273" class="xref">RFC8273</a>]</span>.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<p id="section-4.2-5">RFCs related to IPv6 address configuration such as ND for IPv6
        <span>[<a href="#RFC4861" class="xref">RFC4861</a>]</span>, SLAAC <span>[<a href="#RFC4862" class="xref">RFC4862</a>]</span>, 'IPv6 Subnet
        Model' <span>[<a href="#RFC5942" class="xref">RFC5942</a>]</span>, 'IPv6 Address Assignment to End
        Sites' <span>[<a href="#RFC6177" class="xref">RFC6177</a>]</span>, 'Discovery of the IPv6 Prefix Used
        for IPv6 Address Synthesis' <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span>, DHCP <span>[<a href="#RFC8415" class="xref">RFC8415</a>]</span> and 'IPv6 Node Requirements' <span>[<a href="#RFC8504" class="xref">RFC8504</a>]</span> would be reviewed in separate documents.<a href="#section-4.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-4.3">
<section id="section-4.3">
        <h3 id="name-generic-fsp-header">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-generic-fsp-header" class="section-name selfRef">Generic FSP Header</a>
        </h3>
<p id="section-4.3-1">FSP headers include the fixed header and the extension headers. A
        general fixed header consists of a 32-bit FSP Header Signature and
        20-byte operation-code specific fields. An extension header consists
        of a 32-bit Code-Mark-Length Prefix and the operation-code specific
        content. The length of the extension header content may be variable,
        provided that the tail of the full extension header align on 64-bit
        boundary.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">Integers in the FSP fix header are transmitted in network byte
        order. Otherwise, integers in the FSP headers are of
        little-endian.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-3">
<pre>
  0                                                            31
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Header Signature                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                                                               ~
~              Operation Code Specific Fields                   ~
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-4.3-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sect-4.4">
<section id="section-4.4">
        <h3 id="name-fsp-header-signature-and-co">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-fsp-header-signature-and-co" class="section-name selfRef">FSP Header Signature and Code-Mark-Length Prefix</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-4.4-1">
<pre>
 0             7 8            15 16                           31
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Operation Code|     Major     |              Offset           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

 0             7 8            15 16                           31
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Operation Code|     Mark      |              Length           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-4.4-1" class="pilcrow">¶</a>
</div>
<div id="sect-4.4.1">
<section id="section-4.4.1">
          <h4 id="name-operation-code">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-operation-code" class="section-name selfRef">Operation Code</a>
          </h4>
<p id="section-4.4.1-1">The operation code is an octet that stores the code of the
          command which indicates the function of the FSP packet, or specifies
          the type of some extension header.<a href="#section-4.4.1-1" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
            <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Synonym</th>
                <th class="text-left" rowspan="1" colspan="1">CodeC2</th>
                <th class="text-left" rowspan="1" colspan="1">Meaning</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">INIT_CONNECT</td>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Initialize Connection</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">ACK_INIT_CONNECT</td>
                <td class="text-left" rowspan="1" colspan="1">2</td>
                <td class="text-left" rowspan="1" colspan="1">Acknowledge Initialization of Connection</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">CONNECT_REQUEST</td>
                <td class="text-left" rowspan="1" colspan="1">3</td>
                <td class="text-left" rowspan="1" colspan="1">Formally Request to Connect</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">ACK_CONNECT_REQ</td>
                <td class="text-left" rowspan="1" colspan="1">4</td>
                <td class="text-left" rowspan="1" colspan="1">Acknowledge the Connection Request</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">RESET</td>
                <td class="text-left" rowspan="1" colspan="1">5</td>
                <td class="text-left" rowspan="1" colspan="1">Reset a connection. Abort the connection, or refuse to
            establish the connection at the very beginning.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">NULCOMMIT</td>
                <td class="text-left" rowspan="1" colspan="1">6</td>
                <td class="text-left" rowspan="1" colspan="1">Commit without payload. The NULCOMMIT packet MUST be payload-
            less, and its EoT flag MUST be set. It MAY carry optional
            extension headers. It always consumes a slot of the send sequence
            space. It is to commit current transmit transaction, otherwise the
            NULCOMMIT packet itself SHALL just be skipped when delivering data
            to ULA.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">KEEP_ALIVE</td>
                <td class="text-left" rowspan="1" colspan="1">7</td>
                <td class="text-left" rowspan="1" colspan="1">Keep the peer alive. It is an out-of-band control packet acting
            as the heart-beating signal. An out-of-band control packet does
            not consume send sequence space itself. FSP takes use of the
            KEEP_ALIVE packet to inform the peer about the change of the
            source IP addresses. Besides, when the MIND flag is set, the
            KEEP_ALIVE packet is meant to tell the peer which packets should
            be retransmitted.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">PERSIST</td>
                <td class="text-left" rowspan="1" colspan="1">8</td>
                <td class="text-left" rowspan="1" colspan="1">Make a connection persistent. It is meant to start a new
            transmit transaction after a connection migrated to CLOSABLE
            state. It can also acknowledge ACK_CONNECT_REQ or MULTIPLY. It
            MUST carry payload. It always consumes a slot of the send sequence
            space.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">PURE_DATA</td>
                <td class="text-left" rowspan="1" colspan="1">9</td>
                <td class="text-left" rowspan="1" colspan="1">Pure Data. It does not carry any optional header.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">ACK_FLUSH</td>
                <td class="text-left" rowspan="1" colspan="1">10</td>
                <td class="text-left" rowspan="1" colspan="1">ACKnowledge to remote end's commitment (FLUSHing) of transmit
            transaction. It is an out-of-band control packet like KEEP_ALIVE.
            It is sent instantly on having every packet of the last transmit
            transaction received, meant to make acknowledgment to the remote
            end and let the remote end stop sending heart-beat signals.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">RELEASE</td>
                <td class="text-left" rowspan="1" colspan="1">11</td>
                <td class="text-left" rowspan="1" colspan="1">Release the connection. RELEASE packet does not carry payload,
            but it always consumes a slot of the send sequence space.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">MULTIPLY</td>
                <td class="text-left" rowspan="1" colspan="1">12</td>
                <td class="text-left" rowspan="1" colspan="1">Multiply the connection. It is sent in the context of the
            original connection and may carry payload and/or optional headers
            as an out-of-band packet.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">PEER_SUBNETS</td>
                <td class="text-left" rowspan="1" colspan="1">17</td>
                <td class="text-left" rowspan="1" colspan="1">Tell the remote end how to address the sender of the packet in
            the reverse direction. It is the code of the Sink Parameter
            extension header.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">SELECTIVE_NACK</td>
                <td class="text-left" rowspan="1" colspan="1">18</td>
                <td class="text-left" rowspan="1" colspan="1">Tell the remote end to retransmit the packets that were
            negatively acknowledged. It is the code of the Selective Negative
            Acknowledgment extension header.</td>
              </tr>
            </tbody>
          </table>
</section>
</div>
<div id="sect-4.4.2">
<section id="section-4.4.2">
          <h4 id="name-major">
<a href="#section-4.4.2" class="section-number selfRef">4.4.2. </a><a href="#name-major" class="section-name selfRef">Major</a>
          </h4>
<p id="section-4.4.2-1">It is an octet that states current FSP major version. For this
          FSP version it MUST be 0.<a href="#section-4.4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.4.2-2">It is not mandatory for different major versions of FSP to be
          compatible.<a href="#section-4.4.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-4.4.3">
<section id="section-4.4.3">
          <h4 id="name-mark">
<a href="#section-4.4.3" class="section-number selfRef">4.4.3. </a><a href="#name-mark" class="section-name selfRef">Mark</a>
          </h4>
<p id="section-4.4.3-1">It is an octet that marks current minor version of the extension
          header, under the major FSP version specified in the fixed header,
          and/or serves as the flag, depending on the type of the extension
          header.<a href="#section-4.4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.4.3-2">It is mandatory for implementations to be compatible with
          different minor versions of FSP extension header under the same
          major FSP version.<a href="#section-4.4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.4.3-3">It is not mandatory for minor versions of FSP extension header
          under the different major FSP version to be compatible, even if the
          minor versions happen to be the same.<a href="#section-4.4.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-4.4.4">
<section id="section-4.4.4">
          <h4 id="name-offset">
<a href="#section-4.4.4" class="section-number selfRef">4.4.4. </a><a href="#name-offset" class="section-name selfRef">Offset</a>
          </h4>
<p id="section-4.4.4-1">The offset field is a 16-bit unsigned integer that specifies the
          offset of the first octet of the payload, starting from the begin of
          the FSP fixed header. If its value equals the size of the fixed
          header the packet has no extension.<a href="#section-4.4.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-4.4.5">
<section id="section-4.4.5">
          <h4 id="name-length">
<a href="#section-4.4.5" class="section-number selfRef">4.4.5. </a><a href="#name-length" class="section-name selfRef">Length</a>
          </h4>
<p id="section-4.4.5-1">The length field is a 16-bit unsigned integer that specifies the
          length, including the Type-Version-Length Header and the size of the
          the operation code specific content of the extension header.<a href="#section-4.4.5-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-4.5">
<section id="section-4.5">
        <h3 id="name-preliminary-fsp-packets">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-preliminary-fsp-packets" class="section-name selfRef">Preliminary FSP Packets</a>
        </h3>
<p id="section-4.5-1">Preliminary FSP packets are the packets exchanged during the
        end-to- end negotiation phase of FSP connection establishment when it
        is impossible to calculate ICC normally.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<div id="sect-4.5.1">
<section id="section-4.5.1">
          <h4 id="name-connect-initialization">
<a href="#section-4.5.1" class="section-number selfRef">4.5.1. </a><a href="#name-connect-initialization" class="section-name selfRef">Connect Initialization</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-4.5.1-1">
<pre>
 0                                                            31
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Header Signature                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              Salt                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
 +                         Timestamp                            +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                       Init-Check-Code                         +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                                                               ~
~           Host Name of the Responder (optional)               ~
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Operation Code of this type of packet is INIT_CONNECT.
</pre><a href="#section-4.5.1-1" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-4.5.1-2.1">Salt It a 32-bit random bit string that may be exploited to
              make secret key agreement.<a href="#section-4.5.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.1-2.2">Timestamp It is a 64-bit unsigned integer that represents
              number of microseconds elapsed since 00:00, Jan.1, 1970,
              Coordinated Universal Time. It may be exploited to synchronize
              the clocks of the participants and/or estimate delay during data
              transmission in the network.<a href="#section-4.5.1-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.1-2.3">Init-Check-Code It is a 64-bit random <span>[<a href="#RFC4086" class="xref">RFC4086</a>]</span> bit string that means to uniquely associated
              with the connection initiated.<a href="#section-4.5.1-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.1-2.4">Host Name of the Responder The optional payload of the
              Connect Initialization packet is the host name of the responder.
              It MUST be encoded in UTF-8 <span>[<a href="#RFC3629" class="xref">RFC3629</a>]</span> and SHOULD
              be resolvable in DNS,<a href="#section-4.5.1-2.4" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="sect-4.5.2">
<section id="section-4.5.2">
          <h4 id="name-acknowledgment-to-connect-i">
<a href="#section-4.5.2" class="section-number selfRef">4.5.2. </a><a href="#name-acknowledgment-to-connect-i" class="section-name selfRef">Acknowledgment to Connect Initialization</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-4.5.2-1">
<pre>
 0                                                            31
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Header Signature                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Time Delta                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                            Cookie                             +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                       Init-Check-Code                         +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                                                               ~
~                         Sink Parameter                        ~
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Operation Code of this type of packet is ACK_INIT_CONNECT.
</pre><a href="#section-4.5.2-1" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.1">Time Delta It is a 32-bit signed integer which is the
              difference between the near-end's time and the timestamp value
              sent in the Connection Initialization packet. The units and the
              epoch of the near-end's time value and the timestamp value MUST
              be the same. However, the precision or resolution of the time
              delta value is chosen arbitrarily by the responder.<a href="#section-4.5.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.2-2.2">Cookie It is a 64-bit bit string cryptographically generated
              by the responder in a represent-transfer state manner. More
              specifically when the same timestamp, time delta,
              Init-Check-Code, salt, source and destination ULTIDs are sent to
              the responder, the responder MUST be able to generate the
              identical cookie value.<a href="#section-4.5.2-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.2-2.3">Init-Check-Code It MUST be identical to the corresponding
              field in the Connect Initialization packet acknowledged.<a href="#section-4.5.2-2.3" class="pilcrow">¶</a>
</li>
          </ul>
<div class="alignLeft art-text artwork" id="section-4.5.2-3">
<pre>
  o Sink Parameter
  It is an extension header specified in 4.7.
</pre><a href="#section-4.5.2-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sect-4.5.3">
<section id="section-4.5.3">
          <h4 id="name-connect-request">
<a href="#section-4.5.3" class="section-number selfRef">4.5.3. </a><a href="#name-connect-request" class="section-name selfRef">Connect Request</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-4.5.3-1">
<pre>
 0                                                            31
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Header Signature                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              Salt                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                         Time Stamp                            +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                       Init-Check-Code                         +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Initial Sequence Number                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Time Delta                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                            Cookie                             +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                                                               ~
~                         Sink Parameter                        ~
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                                                               ~
~           Host Name of the Initiator (optional)               ~
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Operation Code of this type of packet is CONNECT_REQUEST.
</pre><a href="#section-4.5.3-1" class="pilcrow">¶</a>
</div>
<p id="section-4.5.3-2">The value of each field that has the identical name with the one
          in the associated Connect Initialization and Acknowledgment to
          Connect Initialization packet MUST be assigned the same value as in
          these two packets, except header signature in the packet.<a href="#section-4.5.3-2" class="pilcrow">¶</a></p>
<p id="section-4.5.3-3">Note that the initiator SHALL fill in the time delta field as it
          is and SHALL NOT assume endian-ness of the time delta field.<a href="#section-4.5.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.3-4.1">Sink Parameter It is an extension header specified in
              4.7.<a href="#section-4.5.3-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.3-4.2">
              <p id="section-4.5.3-4.2.1">Host Name of the Initiator The optional payload of the
              Connect Request packet is the host name, which is encoded in
              UTF-8 and SHOULD be resolvable in DNS, of the initiator.<a href="#section-4.5.3-4.2.1" class="pilcrow">¶</a></p>
<p id="section-4.5.3-4.2.2"> It could be exploited by the responder to look
              up the address of the initiator that may receive packets in the
              reverse direction.<a href="#section-4.5.3-4.2.2" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="sect-4.6">
<section id="section-4.6">
        <h3 id="name-normal-fixed-header">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-normal-fixed-header" class="section-name selfRef">Normal Fixed Header</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-4.6-1">
<pre>
 0                            15 16                           31
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Header Signature                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      Flags    |         Advertised Receive Window Size        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Sequence Number                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Expected Sequence Number/Out-of-Band Serial Number         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                     Integrity Check Code                      +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-4.6-1" class="pilcrow">¶</a>
</div>
<p id="section-4.6-2">Operation Code of a normal fixed header may be ACK_CONNECT_REQ,
        PURE_DATA, PERSIST, KEEP_ALIVE, ACK_FLUSH, RELEASE or MULTIPLY.<a href="#section-4.6-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6-3.1">
            <p id="section-4.6-3.1.1">Flags It is bit-field of width 8. From left to right:<a href="#section-4.6-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6-3.1.2.1">End of Transaction (EoT): If the EoT flag of a packet is
                set, it is the last packet of a transmit transaction. A packet
                with the EoT flag set MAY be the start and the single packet
                of the transmit transaction as well.<a href="#section-4.6-3.1.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.6-3.1.2.2">
                <p id="section-4.6-3.1.2.2.1">Minimal-Delay (MIND): If the MIND flag of the Connect
                Request or Acknowledgment to Connect Request packet is set,
                the ULA prefers minimal delay and is willing to tolerate
                packet loss. FSP SHALL drop the packet received earliest when
                there is no enough receive buffer so that the latest packet
                received can be saved and the delay to deliver data to ULA is
                minimized.<a href="#section-4.6-3.1.2.2.1" class="pilcrow">¶</a></p>
<p id="section-4.6-3.1.2.2.2"> If the MIND flag has been
                set the EoT flag of any following packet is simply ignored.<a href="#section-4.6-3.1.2.2.2" class="pilcrow">¶</a></p>
<p id="section-4.6-3.1.2.2.3"> The MIND flag of an FSP packet may be
                set only if the packet does not belong to a compressed
                transmit transaction.<a href="#section-4.6-3.1.2.2.3" class="pilcrow">¶</a></p>
<p id="section-4.6-3.1.2.2.4"> Payload of each
                FSP packet is delivered to the ULA as an independent message
                if the MIND flag has been set.<a href="#section-4.6-3.1.2.2.4" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.6-3.1.2.3">
                <p id="section-4.6-3.1.2.3.1">Compressed (CPR) If the CPR flag of the first packet of a
                transmit transaction is set, compression is applied on the
                octet stream of the payloads of the continuous packets that
                constitute the transmit transaction, or to put it simply, the
                payload octet stream of the transaction transaction. Such
                transmit transaction is called a compressed transmit
                transaction.<a href="#section-4.6-3.1.2.3.1" class="pilcrow">¶</a></p>
<p id="section-4.6-3.1.2.3.2"> When the CPR flag of a
                packet is set, CPR flag of each following packet is ignored
                until reaching termination of the transmit transaction.<a href="#section-4.6-3.1.2.3.2" class="pilcrow">¶</a></p>
<p id="section-4.6-3.1.2.3.3"> If the payload octet stream of the
                transmit transaction is compressed the Minimal-Delay flag of
                any packet in the transmit transaction MUST be cleared.<a href="#section-4.6-3.1.2.3.3" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.6-3.1.2.4">ECN-Echo (ECE): The Explicit Congestion Notification Echo
                flag of a packet is set if the sender of the packet has
                received an underlying IPv6 packet with Congestion Experienced
                code point set for its peer as stated in "The Addition of
                Explicit Congestion Notification (ECN) to IP" <span>[<a href="#RFC3168" class="xref">RFC3168</a>]</span>.<a href="#section-4.6-3.1.2.4" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.6-3.1.2.5">Send Rate Reduced (SRR): The SRR flag of each packet SHALL
                be set as soon as the sender has received a legitimate packet
                with ECE flag set and has informed the congestion manager to
                reduce the send rate, until a sent packet with SRR flag set is
                acknowledged.<a href="#section-4.6-3.1.2.5" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.6-3.1.2.6">The remaining 3 bits are reserved.<a href="#section-4.6-3.1.2.6" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-4.6-3.2">
            <p id="section-4.6-3.2.1">Advertised Receive Window Size It is a 20-bit unsigned integer
            that stores number of the free blocks in the receive buffer of the
            sender of the packet that contains the receive window size field.
            It is count from the slot meant to accept the packet with the
            expected sequence number.<a href="#section-4.6-3.2.1" class="pilcrow">¶</a></p>
<p id="section-4.6-3.2.2"> The sender must
            ensure that the difference between the latest sequence number sent
            out and the largest expected sequence number received does not
            exceed the value of the latest advertised receive window size
            received.<a href="#section-4.6-3.2.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.6-3.3">
            <p id="section-4.6-3.3.1">Sequence Number Each in-band FSP packet is assigned a 32-bit
            unsigned integer as the sequence number. The sequence number
            assigned for in-band FSP packets MUST be in strict order.<a href="#section-4.6-3.3.1" class="pilcrow">¶</a></p>
<p id="section-4.6-3.3.2"> An out-of-band packet that has the operation code
            of KEEP_ALIVE, ACK_FLUSH or MULTIPLY MUST be assigned a sequence
            number that falls in the receive window.<a href="#section-4.6-3.3.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.6-3.4">Expected Sequence Number The 'expected sequence
            number/out-of-band serial number' field stores the earliest
            sequence number of the packets that were not yet received in the
            receive window of the sender for in-band packet. It is an
            accumulative acknowledgment. Any packet with the sequence number
            before the received Expected Sequence Number is supposed to have
            been received by the remote end.<a href="#section-4.6-3.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.6-3.5">
            <p id="section-4.6-3.5.1">Out-of-band Serial Number<a href="#section-4.6-3.5.1" class="pilcrow">¶</a></p>
<p id="section-4.6-3.5.2"> The 'expected
            sequence number/out-of-band serial number' field stores a 32-bit
            unsigned integer that numbers the out-of-band FSP packet
            separately from the sequence space of the in-band packets.<a href="#section-4.6-3.5.2" class="pilcrow">¶</a></p>
<p id="section-4.6-3.5.3"> Each time an out-of-band packet is sent the
            out-of-band serial number SHALL increase by one.<a href="#section-4.6-3.5.3" class="pilcrow">¶</a></p>
<p id="section-4.6-3.5.4"> It is assumed that in the life of the session no
            two packets have the same sequence number and the same out-of-band
            serial number simultaneously.<a href="#section-4.6-3.5.4" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.6-3.6">Integrity Check Code The ICC.<a href="#section-4.6-3.6" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="sect-4.7">
<section id="section-4.7">
        <h3 id="name-sink-parameter">
<a href="#section-4.7" class="section-number selfRef">4.7. </a><a href="#name-sink-parameter" class="section-name selfRef">Sink Parameter</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-4.7-1">
<pre>
 0                                                            31
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Code-Mark-Length Prefix                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Listener ID/Host ID                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                                                               ~
~               Addressable Network Prefixes                    ~
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-4.7-1" class="pilcrow">¶</a>
</div>
<p id="section-4.7-2">Operation Code in the Header Signature of this extension header is
        PEER_SUBNETS.<a href="#section-4.7-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7-3.1">Listener ID It is the ULTID of the responder that is in
            LISTENING state.<a href="#section-4.7-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.7-3.2">Host ID It is the aggregation host id of the sender. It SHALL
            be 0 if it is in the IPv4 network.<a href="#section-4.7-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.7-3.3">
            <p id="section-4.7-3.3.1">Addressable Network Prefixes These are up to 4 64-bit words
            that specify the network prefixes of the lower layer interfaces
            that are addressable by the receiver in the reverse
            direction.<a href="#section-4.7-3.3.1" class="pilcrow">¶</a></p>
<p id="section-4.7-3.3.2"> In this version of the FSP
            'Addressable Network Prefixes' field is of fixed length. The last
            network prefix which is non-zero is the last resort one. There
            MUST be at least one non-zero network prefix. If there are more
            than one non-zero network prefixes those other than the last
            resort are load-balanced preferred.<a href="#section-4.7-3.3.2" class="pilcrow">¶</a></p>
<p id="section-4.7-3.3.3"> In an
            IPv6 network, the addressable network prefix is the leftmost 64
            bits of the IPv6 address. The receiver of the Addressable Network
            Prefixes SHALL send packet in the reverse direction, i.e.<a href="#section-4.7-3.3.3" class="pilcrow">¶</a></p>
<p id="section-4.7-3.3.4"> to the sender of the field with the destination
            IPv6 address generated by combining a preferred network prefix
            with the aggregation host id and the ULTID part of the source
            address in the IPv6 header of the received packet that eventually
            carries the Addressable Network Prefixes.<a href="#section-4.7-3.3.4" class="pilcrow">¶</a></p>
<p id="section-4.7-3.3.5">
            Such feature MAY be exploited to handle links with unidirectional
            connectivity, but it is NOT RECOMMENTED.<a href="#section-4.7-3.3.5" class="pilcrow">¶</a></p>
<p id="section-4.7-3.3.6">
            In an IPv4 network for compatibility with the IPv6 addressed ULA
            the 64-bit word of the addressable network prefix specified is
            composed as following Figure:<a href="#section-4.7-3.3.6" class="pilcrow">¶</a></p>
</li>
        </ul>
<div class="alignLeft art-text artwork" id="section-4.7-4">
<pre>
 0                            15 16                           31
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  0x2002 (IPv6 6to4 prefix)    |IPv4 address (leftmost 16 bits)|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|IPv4 address(rightmost 16 bits)|   UDP port number (16 bits)   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-4.7-4" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel" id="section-4.7-5">
          <dt id="section-4.7-5.1"></dt>
          <dd style="margin-left: 1.0em" id="section-4.7-5.2">Sender of the Sink Parameter packet SHOULD be NAT-aware in the
            IPv4 network. If it is able to obtain the from the NAT box (as
            defined in "Traditional IP Network Address Translator (Traditional
            NAT)" <span>[<a href="#RFC3022" class="xref">RFC3022</a>]</span>) through Port Control Protocol
            (PCP) <span>[<a href="#RFC6887" class="xref">RFC6887</a>]</span> SHOULD fill in the IPv4 address and
            UDP port number fields with the public IP value that were
            obtained. If it does not have such capability, it SHALL fill in
            the addressable network prefix with all binary zeroes.<a href="#section-4.7-5.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="sect-4.8">
<section id="section-4.8">
        <h3 id="name-selective-negative-acknowle">
<a href="#section-4.8" class="section-number selfRef">4.8. </a><a href="#name-selective-negative-acknowle" class="section-name selfRef">Selective Negative Acknowledgment</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-4.8-1">
<pre>
 0                                                            31
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Code-Mark-Length Prefix                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                   Expected Sequence Number                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                Delay Sample Sequence Number                   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                   Acknowledgement Delay                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            Gap Width                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Data Length                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                                                               ~
~          Further pairs of  (Gap Width, Data Length)           ~
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

The operation code of this type of extension header is SNACK.block.
</pre><a href="#section-4.8-1" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-4.8-2.1">
            <p id="section-4.8-2.1.1">Expected Sequence Number It stores the earliest sequence number
            of the packets that were not yet received in the receive window of
            the sender. It is an accumulative acknowledgment. Any packet with
            the sequence number before the received Expected Sequence Number
            is supposed to have been received by the remote end.<a href="#section-4.8-2.1.1" class="pilcrow">¶</a></p>
<p id="section-4.8-2.1.2"> The expected sequence number is represented in
            little endian.<a href="#section-4.8-2.1.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.8-2.2">
            <p id="section-4.8-2.2.1">Delay Sample Sequence Number It stores the sequence number of
            the packet that the acknowledgement delay was calculated
            on.<a href="#section-4.8-2.2.1" class="pilcrow">¶</a></p>
<p id="section-4.8-2.2.2"> The delay sample sequence number is
            represented in little endian.<a href="#section-4.8-2.2.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.8-2.3">
            <p id="section-4.8-2.3.1">Acknowledgement Delay A 32-bit unsigned integer specifies the
            delay in microseconds between sending the packet containing the
            SNACK extension header and accepting the last packet that is
            accumulatively acknowledged by the SNACK extension header.<a href="#section-4.8-2.3.1" class="pilcrow">¶</a></p>
<p id="section-4.8-2.3.2"> The acknowledgement delay is represented in
            little endian.<a href="#section-4.8-2.3.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.8-2.4">
            <p id="section-4.8-2.4.1">Gap Width and Data Length The SNACK header contains the
            descriptor of the receive window gaps. The descriptor itself is a
            list of entries. The length of the list can be zero which means
            that there is no gap in the receive window. If the list is not
            empty, each entry contains the width of one gap (Gap Width) in the
            receive window and the length of the continuously received data
            following the gap (Data Length), respectively.<a href="#section-4.8-2.4.1" class="pilcrow">¶</a></p>
<p id="section-4.8-2.4.2"> The unit of aforementioned length of gaps or
            number of packets is buffer block which size is agreed upon
            connection establishment.<a href="#section-4.8-2.4.2" class="pilcrow">¶</a></p>
<p id="section-4.8-2.4.3"> Gap width and
            data length MUST be transmitted in little endian.<a href="#section-4.8-2.4.3" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sect-4.9">
<section id="section-4.9">
        <h3 id="name-reset">
<a href="#section-4.9" class="section-number selfRef">4.9. </a><a href="#name-reset" class="section-name selfRef">RESET</a>
        </h3>
<p id="section-4.9-1">The 'RESET' packet is a special command packet meant to interrupt
        connection setup process or disconnect abruptly. Operation Code of the
        packet is RESET.<a href="#section-4.9-1" class="pilcrow">¶</a></p>
<p id="section-4.9-2">Structure of a RESET packet in C code snippet with unnamed union
        applied:<a href="#section-4.9-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.9-3">
<pre>
struct FSP$HeaderSignature
{
    octet          opCode;
    octet    major;
    uint16_t offset;
};

struct FSP_RejectConnect
{
     FSP$HeaderSignature hs;
     /* bit field to describe reasons for reset */
     uint32_t reasons;
     /* sequence numbers */
     union
     {
             timestamp_t timeStamp;
             struct
             {
                     uint32_t initial;
                     uint32_t expected;
             } sn;
     };
     /* uniqueness proof */
     union
     {
             uint64_t integrityCode;
             uint64_t cookie;
             uint64_t initCheckCode;
     };
};
</pre><a href="#section-4.9-3" class="pilcrow">¶</a>
</div>
<p id="section-4.9-4">When the RESET packet is the response to a Connect Initialization
        packet both the timeStamp and the initCheckCode fields of the RESET
        packet MUST be set to the same values of Time Stamp and Init-Check-
        Code in the Connect Initialization packet, respectively.<a href="#section-4.9-4" class="pilcrow">¶</a></p>
<p id="section-4.9-5">When the RESET packet is the response to a Connect Request packet
        both the timeStamp and the cookie fields of the RESET packet MUST be
        set to the same value of Time Stamp and Cookie in the Connect Request
        packet, respectively.<a href="#section-4.9-5" class="pilcrow">¶</a></p>
<p id="section-4.9-6">When the RESET packet is the response to a packet with a normal
        fixed header, the sn.initial, the sn.expected and the integrityCode of
        the RESET packet MUST be set as to specification of normal fixed
        header field Sequence Number, Expected Sequence Number and Integrity
        Check Code, respectively.<a href="#section-4.9-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-5">
<section id="section-5">
      <h2 id="name-the-finite-state-machine">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-the-finite-state-machine" class="section-name selfRef">The Finite State Machine</a>
      </h2>
<div id="sect-5.1">
<section id="section-5.1">
        <h3 id="name-non_existent">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-non_existent" class="section-name selfRef">NON_EXISTENT</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.1-1">
<pre>
   ---[API: Listen]--&gt;LISTENING
   |--[API: Connect]--&gt;CONNECT_BOOTSTRAP--&gt;[Send INIT_CONNECT]
   |--[API: Multiply]--&gt;CLONING--&gt;[Send MULTIPLY]
</pre><a href="#section-5.1-1" class="pilcrow">¶</a>
</div>
<p id="section-5.1-2">NON_EXISTENT is a pseudo-state before a connection is created by
        the ULA calling API Listen, Connect or Multiply (or after a connection
        is reset).<a href="#section-5.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.2">
<section id="section-5.2">
        <h3 id="name-listening">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-listening" class="section-name selfRef">LISTENING</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.2-1">
<pre>
   ---[API: Reset]--&gt;NON_EXISTENT
   |&lt;--&gt;[Rcv.INIT_CONNECT]{&amp;&amp; accepted}[Send ACK_INIT_CONNECT]
   |&lt;--&gt;[Rcv.CONNECT_REQUEST]
       |--{&amp;&amp; duplication detected}--[Retransmit ACK_CONNECT_REQ]
       |--{&amp;&amp; no duplication}--&gt;{Notify}
         |--&gt;[API: Accept]
             --&gt;{new context}CHALLENGING--&gt;[Send ACK_CONNECT_REQ]
         |--&gt;[API: Reject]--&gt;[Send RESET]{abort new context, if any}

LISTENING is a state entered by the ULA calling API Listen.
</pre><a href="#section-5.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sect-5.3">
<section id="section-5.3">
        <h3 id="name-connect_bootstrap">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-connect_bootstrap" class="section-name selfRef">CONNECT_BOOTSTRAP</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.3-1">
<pre>
   ---[API: Reset]--&gt;NON_EXISTENT--&gt;[Send RESET]
   |--&gt;[Rcv.ACK_INIT_CONNECT]--&gt;CONNECT_AFFIRMING
       --&gt;[Send CONNECT_REQUEST]
   |--{On transient state Timeout}--&gt;NON_EXISTENT--&gt;[Notify]
</pre><a href="#section-5.3-1" class="pilcrow">¶</a>
</div>
<p id="section-5.3-2">CONNECT_BOOTSTRAP is a state entered by the ULA calling API
        Connect, before receiving the acknowledgement of the remote end to the
        connection initialization packet.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.4">
<section id="section-5.4">
        <h3 id="name-connect_affirming">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-connect_affirming" class="section-name selfRef">CONNECT_AFFIRMING</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.4-1">
<pre>
   ---[API: Reset]--&gt;NON_EXISTENT--&gt;[Send RESET]
   |--[Rcv.ACK_CONNECT_REQ]--&gt;[Notify]
      |--&gt;{Callback return to accept}
         |--&gt;{EOT}
            |--&gt;{No Payload to Send}--&gt;COMMITTING2--&gt;[Send NULCOMMIT]
            |--&gt;{Has Payload to Send}
               |--&gt;{ULA-flushing}--&gt;COMMITTING2
                   --&gt;[Send PERSIST with EoT]
               |--&gt;{Not ULA-flushing}--&gt;PEER_COMMIT--&gt;[Send PERSIST]
         |--&gt;{Not EOT}
            |--&gt;{No Payload to Send}--&gt;COMMITTING--&gt;[Send NULCOMMIT]
            |--&gt;{Has Payload to Send}
               |--&gt;{ULA-flushing}--&gt;COMMITTING
                   --&gt;[Send PERSIST with EoT]
               |--&gt;{Not ULA-flushing}--&gt;ESTABLISHED--&gt;[Send PERSIST]
      |--&gt;{Callback return to reject]--&gt;NON_EXISTENT--&gt;[Send RESET]
   |--[Rcv.RESET]--&gt;NON_EXISTENT--&gt;[Notify]
   |--{On transient state Timeout}--&gt;NON_EXISTENT--&gt;[Notify]
</pre><a href="#section-5.4-1" class="pilcrow">¶</a>
</div>
<p id="section-5.4-2">CONNECT_AFFIRMING is a state entered by the ULA affirming to send
        connect request after receiving the acknowledgement to the connection
        initialization packet.<a href="#section-5.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.5">
<section id="section-5.5">
        <h3 id="name-challenging">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-challenging" class="section-name selfRef">CHALLENGING</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.5-1">
<pre>
   ---[API: Reset]--&gt;NON_EXISTENT--&gt;[Send RESET]
   |&lt;--&gt;[API: Send{new data}]{just pre-buffer}
   |--[Rcv.NULCOMMIT]
      |--&gt;{ULA-flushing}--&gt;CLOSABLE--&gt;[Notify]
          --&gt;[Send ACK_FLUSH]
      |--&gt;{Not ULA-flushing}--&gt;PEER_COMMIT--&gt;[Notify]
          --&gt;[Send ACK_FLUSH]
   |--[Rcv.PERSIST]
      |--&gt;{EOT}
         |--&gt;{ULA-flushing}--&gt;CLOSABLE--&gt;[Notify]
             --&gt;[Send ACK_FLUSH]
         |--&gt;{Not ULA-flushing}--&gt;PEER_COMMIT--&gt;[Notify]
             --&gt;[Send ACK_FLUSH]
      |--&gt;{Not EoT}
         |--&gt;{ULA-flushing}--&gt;COMMITTED--&gt;[Notify]
             --&gt;[Send delay SNACK]
         |--&gt;{Not ULA-flushing}--&gt;ESTABLISHED--&gt;[Notify]
             --&gt;[Send delay SNACK]
   |--[Rcv.RESET]--&gt;NON_EXISTENT--&gt;[Notify]
   |--{On transient state Timeout}--&gt;NON_EXISTENT--&gt;[Notify]
</pre><a href="#section-5.5-1" class="pilcrow">¶</a>
</div>
<p id="section-5.5-2">CHALLENGING is a state entered by the ULA accepting the connection
        request after a new connection context has been incarnated. The new
        connection is incarnated by the FSP context of the near end in the
        LISTENING state as a legitimate CONNECT_REQUEST packet is
        received.<a href="#section-5.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.6">
<section id="section-5.6">
        <h3 id="name-active">
<a href="#section-5.6" class="section-number selfRef">5.6. </a><a href="#name-active" class="section-name selfRef">ACTIVE</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.6-1">
<pre>
   ---[API: Reset]--&gt;NON_EXISTENT--&gt;[Send RESET]
   |--[API: Send{flush}]--&gt;COMMITTING{Urge to commit}
   |&lt;--&gt;[API: Send{more data}][Send PURE_DATA]
   |--[Rcv.NULCOMMIT]
       |--&gt;PEER_COMMIT--&gt;[Send ACK_FLUSH]--&gt;[Notify]
   |--[Rcv.PURE_DATA]
       |--{EOT}--&gt;PEER_COMMIT
          --&gt;[Send ACK_FLUSH]--&gt;[Notify]
       |--{Not EOT}--&gt;[Send SNACK]--&gt;[Notify]
   |--[Rcv.PERSIST]
       |--{EOT}--&gt;PEER_COMMIT
          --&gt;[Send ACK_FLUSH]--&gt;[Notify]
       |--{Not EOT}--&gt;[Send SNACK]
   |--[Rcv.MULTIPLY]{passive multiplication}
   |--[Rcv.RESET]--&gt;NON_EXISTENT--&gt;[Notify]
   |--{On Idle Timeout}--&gt;NON_EXISTENT--&gt;[Notify]
</pre><a href="#section-5.6-1" class="pilcrow">¶</a>
</div>
<p id="section-5.6-2">ACTIVE, also known as ESTABLISHED, is a state that the FSP
        participant has finished end-to-end negotiation but has not committed
        current transmit transaction nor fully received the latest transmit
        transaction of the remote end.<a href="#section-5.6-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.7">
<section id="section-5.7">
        <h3 id="name-committing">
<a href="#section-5.7" class="section-number selfRef">5.7. </a><a href="#name-committing" class="section-name selfRef">COMMITTING</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.7-1">
<pre>
   ---[API: Reset]--&gt;NON_EXISTENT--&gt;[Send RESET]
   |--[Rcv.ACK_FLUSH]--&gt;COMMITTED--&gt;[Notify]
   |--[Rcv.NULCOMMIT]
       |--&gt;COMMITTING2--&gt;[Send ACK_FLUSH]--&gt;[Notify]
   |--[Rcv.PURE_DATA]
       |--{EOT}--&gt;COMMITTING2--&gt;[Send ACK_FLUSH]--&gt;[Notify]
       |--{Not EOT}--&gt;[Send SNACK]--&gt;[Notify]
   |--[Rcv.MULTIPLY]{passive multiplication}
   |--[Rcv.RELEASE]
       |--{EOT}--&gt;SHUT_REQUESTED--&gt;[Send ACK_FLUSH]--&gt;[Notify]
       |--{Not EOT}--&gt;[Send SNACK lazily]
   |--[Rcv.RESET]--&gt;NON_EXISTENT--&gt;[Notify]
   |--{On Idle Timeout}--&gt;NON_EXISTENT--&gt;[Notify]
</pre><a href="#section-5.7-1" class="pilcrow">¶</a>
</div>
<p id="section-5.7-2">COMMITTING is a state that the FSP participant has committed the
        transmit transaction but has not fully received the latest transmit
        transaction of the remote end, nor the acknowledgement to the transmit
        transaction commitment has been received.<a href="#section-5.7-2" class="pilcrow">¶</a></p>
<p id="section-5.7-3">The participant in COMMITTING state SHALL NOT transmit further data
        until current transmit transaction commitment is acknowledged.<a href="#section-5.7-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.8">
<section id="section-5.8">
        <h3 id="name-committed">
<a href="#section-5.8" class="section-number selfRef">5.8. </a><a href="#name-committed" class="section-name selfRef">COMMITTED</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.8-1">
<pre>
   ---[API: Reset]--&gt;NON_EXISTENT--&gt;[Send RESET]
   |--[API: Send{more data}]--&gt;ACTIVE--&gt;[Send PERSIST]
   |--[API: Send{flush}]--&gt;COMMITTING--&gt;{Flush the send queue}
   |--[Rcv.NULCOMMIT]--&gt;CLOSABLE
      --&gt;[Send ACK_FLUSH]--&gt;[Notify]
   |--[Rcv.PURE_DATA]
       |--&gt;{EOT}--&gt;CLOSABLE
           --&gt;[Send ACK_FLUSH]--&gt;[Notify]
       |--&gt;{Not EOT}--&gt;[Send SNACK]--&gt;[Notify]
   |--[Rcv.PERSIST]
       |--&gt;{EOT}--&gt;CLOSABLE
           --&gt;[Send ACK_FLUSH]--&gt;[Notify]
       |--&gt;{Not EOT}--&gt;[Send SNACK]
   |--[Rcv.MULTIPLY]{passive multiplication}
   |--[Rcv.RELEASE]
       |--{EOT}--&gt;SHUT_REQUESTED
          --&gt;[Send ACK_FLUSH]--&gt;[Notify]
       |--{Not EOT}--&gt;[Send SNACK lazily]
   |--[Rcv.RESET]--&gt;NON_EXISTENT--&gt;[Notify]
   |--{On Idle Timeout}--&gt;NON_EXISTENT--&gt;[Notify]
</pre><a href="#section-5.8-1" class="pilcrow">¶</a>
</div>
<p id="section-5.8-2">COMMITTED is a state that the FSP participant has committed current
        transmit transaction and has received the acknowledgement to the
        transmit transaction commitment, but has not fully received the latest
        transmit transaction of the remote end.<a href="#section-5.8-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.9">
<section id="section-5.9">
        <h3 id="name-peer_commit">
<a href="#section-5.9" class="section-number selfRef">5.9. </a><a href="#name-peer_commit" class="section-name selfRef">PEER_COMMIT</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.9-1">
<pre>
   ---[API: Reset]--&gt;NON_EXISTENT--&gt;[Send RESET]
   |--[API: Send{flush}]--&gt;{Mark EoT or append NULCOMMIT}
       --&gt;COMMITTING2--&gt;{Do Send}
   |--[API: Shutdown]--&gt;PRE_CLOSED--&gt;{Append RELEASE}
       --&gt;{Do Send}
   |&lt;--&gt;[API: Send{more data}][Send PURE_DATA]
   |&lt;--&gt;[Rcv.PURE_DATA]{just prebuffer}
   |&lt;--&gt;[Rcv.NULCOMMIT]--&gt;[Send ACK_FLUSH]
   |--[Rcv.PERSIST]
       |&lt;--&gt;{EOT}--&gt;[Send ACK_FLUSH]
           --{&amp;&amp; is new transaction}--&gt;[Notify]
       |--&gt;{Not EOT}--&gt;ACTIVE--&gt;[Send SNACK]
   |--[Rcv.MULTIPLY]{passive multiplication}
   |--[Rcv.RESET]--&gt;NON_EXISTENT--&gt;[Notify]
   |--{On Idle Timeout}--&gt;NON_EXISTENT--&gt;[Notify]
</pre><a href="#section-5.9-1" class="pilcrow">¶</a>
</div>
<p id="section-5.9-2">PEER_COMMIT is a state that the FSP participant has not committed
        current transmit transaction but has fully received the latest
        transmit transaction of the remote end, and the acknowledgement to the
        transmit transaction commitment has not been received yet.<a href="#section-5.9-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.10">
<section id="section-5.10">
        <h3 id="name-committing2">
<a href="#section-5.10" class="section-number selfRef">5.10. </a><a href="#name-committing2" class="section-name selfRef">COMMITTING2</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.10-1">
<pre>
   ---[API: Reset]--&gt;NON_EXISTENT--&gt;[Send RESET]
   |--[API: Shutdown]--&gt;PRE_CLOSED--&gt;{Append RELEASE}--&gt;{Do Send}
   |&lt;--&gt;[Rcv.PURE_DATA]{just prebuffer}
   |&lt;--&gt;[Rcv.NULCOMMIT]--&gt;[Send ACK_FLUSH]
   |--[Rcv.ACK_FLUSH]--&gt;CLOSABLE--&gt;[Notify]
   |--[Rcv.PERSIST]
       |--{EOT}--{but a new transaction}
           --&gt;[Send ACK_FLUSH]--&gt;[Notify]
       |--{Not EOT}--&gt;COMMITTING--&gt;[Send SNACK]
   |--[Rcv.MULTIPLY]{passive multiplication}
   |--[Rcv.RELEASE]--&gt;SHUT_REQUESTED
       --&gt;[Send ACK_FLUSH]--&gt;[Notify]
   |--[Rcv.RESET]--&gt;NON_EXISTENT--&gt;[Notify]
   |--{On Idle Timeout}--&gt;NON_EXISTENT--&gt;[Notify]
</pre><a href="#section-5.10-1" class="pilcrow">¶</a>
</div>
<p id="section-5.10-2">COMMITTING2 is a state that the FSP participant has committed
        current transmit transaction and has fully received the latest
        transmit transaction of the remote end, but the acknowledgement to the
        transmit transaction commitment has not been received yet.<a href="#section-5.10-2" class="pilcrow">¶</a></p>
<p id="section-5.10-3">The participant in COMMITTING2 state SHALL NOT transmit further
        data until current transmit transaction commitment is
        acknowledged.<a href="#section-5.10-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.11">
<section id="section-5.11">
        <h3 id="name-closable">
<a href="#section-5.11" class="section-number selfRef">5.11. </a><a href="#name-closable" class="section-name selfRef">CLOSABLE</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.11-1">
<pre>
   ---[API: Reset]--&gt;NON_EXISTENT--&gt;[Send RESET]
   |--[API: Send{more data}]--&gt;PEER_COMMIT--&gt;[Send PERSIST]
   |--[API: Send{flush}]--&gt;COMMITTING2--&gt;{Flush the send queue}
   |--[API: Shutdown]--&gt;PRE_CLOSED--&gt;{Append RELEASE}--&gt;{Do Send}
   |&lt;--&gt;[Rcv.PURE_DATA]{just prebuffer}
   |&lt;--&gt;[Rcv.NULCOMMIT]--&gt;[Send ACK_FLUSH]
   |--[Rcv.PERSIST]
       |--{EOT}--{but a new transaction}
          --&gt;[Send ACK_FLUSH]--&gt;[Notify]
       |--&gt;{Not EOT}--&gt;COMMITTED--&gt;[Send SNACK]
   |--[Rcv.MULTIPLY]{passive multiplication}
   |--[Rcv.RELEASE]--&gt;SHUT_REQUESTED
      --&gt;[Send ACK_FLUSH]--&gt;[Notify]
   |--[Rcv.RESET]--&gt;NON_EXISTENT--&gt;[Notify]
</pre><a href="#section-5.11-1" class="pilcrow">¶</a>
</div>
<p id="section-5.11-2">CLOSABLE is a state that the FSP participant has committed current
        transmit transaction and has received the acknowledgement to the
        transmit transaction commitment, and has fully received the latest
        transmit transaction of the remote end.<a href="#section-5.11-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.12">
<section id="section-5.12">
        <h3 id="name-shut_requested">
<a href="#section-5.12" class="section-number selfRef">5.12. </a><a href="#name-shut_requested" class="section-name selfRef">SHUT_REQUESTED</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.12-1">
<pre>
   ---[API: Reset]--&gt;NON_EXISTENT--&gt;[Send RESET]
   |--[API: Shutdown]--&gt;CLOSED--&gt;[Notify]
   |&lt;--&gt;[Rcv.RELEASE]--&gt;[Send ACK_FLUSH]
   |--[Rcv.RESET]--&gt;NON_EXISTENT--&gt;[Notify]
</pre><a href="#section-5.12-1" class="pilcrow">¶</a>
</div>
<p id="section-5.12-2">SHUT_REQUESTED is a state entered when a legitimate RELEASE packet
        was received.<a href="#section-5.12-2" class="pilcrow">¶</a></p>
<p id="section-5.12-3">A connection context MAY persist in SHUT_REQUESTED state until the
        session key runs out of life, or the host system needs to recycle the
        resource allocated. A connection in SHUT_REQUESTED state MAY be
        resurrected.<a href="#section-5.12-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.13">
<section id="section-5.13">
        <h3 id="name-pre_closed">
<a href="#section-5.13" class="section-number selfRef">5.13. </a><a href="#name-pre_closed" class="section-name selfRef">PRE_CLOSED</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.13-1">
<pre>
   ---[API: Reset]--&gt;NON_EXISTENT--&gt;[Send RESET]
   |--[Rcv.ACK_FLUSH]--&gt;CLOSED--&gt;[Notify]
   |--[Rcv.RELEASE]--&gt;[Notify]--&gt;CLOSED
   |--[Rcv.RESET]--&gt;NON_EXISTENT--&gt;[Notify]
   |--{On transient state Timeout}--&gt;CLOSED--&gt;[Notify]
</pre><a href="#section-5.13-1" class="pilcrow">¶</a>
</div>
<p id="section-5.13-2">PRE_CLOSED is a state entered on the ULA calling the API Shutdown
        in COMMITTING2 or CLOSABLE state.<a href="#section-5.13-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.14">
<section id="section-5.14">
        <h3 id="name-closed">
<a href="#section-5.14" class="section-number selfRef">5.14. </a><a href="#name-closed" class="section-name selfRef">CLOSED</a>
        </h3>
<span class="break"></span><dl class="dlParallel" id="section-5.14-1">
          <dt id="section-5.14-1.1"></dt>
          <dd style="margin-left: 1.5em" id="section-5.14-1.2">|--{On Recycling Needed}--&gt;NON_EXISTENT<a href="#section-5.14-1.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-5.14-2">CLOSED is a state migrated from PRE_CLOSED state on receiving a
        legitimate ACK_FLUSH packet from the remote end, or from
        SHUT_REQUESTED state on the ULA calling the API Shutdown.<a href="#section-5.14-2" class="pilcrow">¶</a></p>
<p id="section-5.14-3">Unlike TCP <span>[<a href="#STD7" class="xref">STD7</a>]</span>, CLOSED state in FSP is not
        fictional. Instead a connection context MAY persist in CLOSED state
        until the session key runs out of life, or the host system needs to
        recycle the resource allocated to the CLOSED session. A connection in
        CLOSED state MAY be resurrected.<a href="#section-5.14-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.15">
<section id="section-5.15">
        <h3 id="name-cloning">
<a href="#section-5.15" class="section-number selfRef">5.15. </a><a href="#name-cloning" class="section-name selfRef">CLONING</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.15-1">
<pre>
   ---[API: Reset]--&gt;NON_EXISTENT
   |&lt;--&gt;[API: Send{new data}]{just prebuffer}
   |&lt;--&gt;[Rcv.PURE_DATA]{just prebuffer}
   |--[Rcv.NULCOMMIT]
       |--{&amp;&amp; Not ULA-flushing}--&gt;PEER_COMMIT
          --&gt;[Send ACK_FLUSH]--&gt;[Notify]
       |--{&amp;&amp; ULA-flushing}--&gt;CLOSABLE
           ---&gt;[Send ACK_FLUSH]--&gt;[Notify]
   |--[Rcv.PERSIST]
       |--&gt;{Not EOT}
           |--{&amp;&amp; Not ULA-flushing}--&gt;ACTIVE
              --&gt;[Send SNACK]--&gt;[Notify]
           |--{&amp;&amp; ULA-flushing}--&gt;COMMITTED
              --&gt;[Send SNACK]--&gt;[Notify]
       |--&gt;{EOT}
           |--{&amp;&amp; Not ULA-flushing}--&gt;PEER_COMMIT
              --&gt;[Send ACK_FLUSH]--&gt;[Notify]
           |--{&amp;&amp; ULA-flushing}--&gt;CLOSABLE
              --&gt;[Send ACK_FLUSH]--&gt;[Notify]
   |--[Rcv.RESET]--&gt;NON_EXISTENT--&gt;[Notify]
   |--{On transient state Timeout}--&gt;NON_EXISTENT--&gt;[Notify]
</pre><a href="#section-5.15-1" class="pilcrow">¶</a>
</div>
<p id="section-5.15-2">CLONING is a state entered by ULA calling the API Multiply from any
        state that may accepting an out-of-band packet.<a href="#section-5.15-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.16">
<section id="section-5.16">
        <h3 id="name-passive-multiplication">
<a href="#section-5.16" class="section-number selfRef">5.16. </a><a href="#name-passive-multiplication" class="section-name selfRef">Passive Multiplication</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.16-1">
<pre>
  {ACTIVE, COMMITTING, COMMITTED, PEER_COMMIT, COMMITTING2, CLOSABLE}
    |--&gt;/MULTIPLY/--&gt;[API{Callback}]--&gt;{new context}CONNECT_AFFIRMING
       |--&gt;[{Return Accept}]
          |--&gt;{has payload prebuffered}
              --&gt;{Send packet(s) starting with PERSIST}
          |--&gt;{without payload}--&gt;[Send NULCOMMIT]
       |--&gt;[{Return Reject}]--&gt;{abort creating new context}
           --&gt;[Send RESET]
</pre><a href="#section-5.16-1" class="pilcrow">¶</a>
</div>
<p id="section-5.16-2">In the ACTIVE, COMMITTING, COMMITTED, PEER_COMMIT, COMMITTING2 or
        CLOSABLE state an FSP end node MAY accept its peer's connection
        multiplication request and transit to the unnamed, temporary passive
        multiplication state.<a href="#section-5.16-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.17">
<section id="section-5.17">
        <h3 id="name-typical-state-transitions">
<a href="#section-5.17" class="section-number selfRef">5.17. </a><a href="#name-typical-state-transitions" class="section-name selfRef">Typical State Transitions</a>
        </h3>
<p id="section-5.17-1">This section is informative.<a href="#section-5.17-1" class="pilcrow">¶</a></p>
<div id="sect-5.17.1">
<section id="section-5.17.1">
          <h4 id="name-typical-main-connection">
<a href="#section-5.17.1" class="section-number selfRef">5.17.1. </a><a href="#name-typical-main-connection" class="section-name selfRef">Typical Main Connection</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-5.17.1-1">
<pre>
  ***                      Bootstrapping                 ***
  CONNECT_BOOTSTRAP  ------ INIT_CONNECT -------&gt;  LISTENING
      |              &lt;---- ACK_CONNECT_INIT -----
  CONNECT_AFFIRMING  ------ CONNECT_REQUEST ----&gt;      |

  *** Connection affirmation, carrying welcome messages ***
                                                       |
                                                   {Accept}
     {and send a single packet welcome message immediately}
                                                       |
      |            &lt;- ACK_CONNECT_REQ c/w EoT -  CHALLENGING
  PEER_COMMITTED
      |
  {Callback, to send ticket immediately}
  {(a fictional identification token of a single packet)}
      |
  COMMITTING2        ----- PERSIST c/w EoT -----&gt;      |
                                                   CLOSABLE
      |              &lt;-------- ACK_FLUSH --------      |
  CLOSABLE
                                                       |
                                    {Send Server's Challenge}
                                                       |
      |           &lt;----- PERSIST w/o EoT -----  PEER_COMMITED
  COMMITTED          ---- KEEP_ALIVE(SNACK) ----&gt;
                               .
                               .

                               .                       |
                                                   {Flush}
                                                       |
      |            &lt;---- PURE_DATA c/w EoT ----  COMMITTING2
  CLOSABLE
                     --------- ACK_FLUSH -------&gt;      |
                                                   CLOSABLE
      |
  {Send Client's Response}
      |
  PEER_COMMITTED     ----- PERSIST w/o EoT -----&gt;      |
                                                   COMMITTED
      |              &lt;--- KEEP_ALIVE(SNACK) -----      |
                               .
      |              ---- PURE_DATA w/o EoT ----&gt;  COMMITTED
  PEER_COMMITTED     &lt;--- KEEP_ALIVE(SNACK) ----       |
                               .
                               .
      |                        .
  {Flush}
      |
  COMMITTING2        ---- PURE_DATA c/w EoT ----&gt;      |
                                                   CLOSABLE
      |              &lt;-------- ACK_FLUSH --------
  CLOSABLE

** Typical C/S request-response exchange on application layer **
      |
  {Send Request}
      |
  PEER_COMMITTED     ----- PERSIST w/o EoT -----&gt;      |
                                                   COMMITTED
      |              &lt;--- KEEP_ALIVE(SNACK) -----      |
                               .
      |              ---- PURE_DATA w/o EoT ----&gt;  COMMITTED
  PEER_COMMITTED     &lt;--- KEEP_ALIVE(SNACK) -----      |
                               .
                               .
      |                        .
  {Flush}
      |
  COMMITTING2        ---- PURE_DATA c/w EoT ----&gt;      |
                                                   CLOSABLE
      |              &lt;-------- ACK_FLUSH --------
  CLOSALBE
                                                 {Send Response}
                                                       |
      |              &lt;----- PERSIST w/o EoT -----  PEER_COMMITED
  COMMITTED
                     ---- KEEP_ALIVE(SNACK) ----&gt;      |
                               .
      |              &lt;---- PURE_DATA w/o EoT ----  PEER_COMMITED
  COMMITTED          ---- KEEP_ALIVE(SNACK) ----&gt;      |
                               .
                               .
                               .
                                                   {Flush}
                                                       |
      |              &lt;---- PURE_DATA c/w EoT ----  COMMITTING2
  CLOSABLE
                     --------- ACK_FLUSH -------&gt;      |
                                                   CLOSALBE
                               .
                               .
                               .
   *** Following request-responses, e.g. HTTP pipelining ***
                               .
                               .
                               .

  CLOSABLE                                         CLOSALBE
                               .
                               .
   *** End of connection, in a typical C/S application ***
                                                       |
                                                   {Shutdown}
                                                       |
     |               &lt;---------- RELEASE --------  PRE_CLOSED
  SHUT_REQUESTED
                     --------- ACK_FLUSH -------&gt;      |
     |                                               CLOSED
  {Shutdown}
     |
   CLOSED
</pre><a href="#section-5.17.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sect-5.17.2">
<section id="section-5.17.2">
          <h4 id="name-typical-clone-connection-fo">
<a href="#section-5.17.2" class="section-number selfRef">5.17.2. </a><a href="#name-typical-clone-connection-fo" class="section-name selfRef">Typical Clone Connection for Get Resource</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-5.17.2-1">
<pre>
   Client                                                Server
   *** Suppose the browser fork a new connection to request ***
   *** some resource and the URI is short enough to be      ***
   *** encapsulated in a single packet                      ***
  {MultiplyAndWrite}
      |                                      {In Clonable State}
  CLONING            ---- MULTIPLY c/w EoT ----&gt;       *
                                         {Make Clone Connection}
                          {and return resource data immediately}
                                                       |
      |              &lt;---- PERSIST w/o EoT ------  PEER_COMMITTED
  COMMITTED          ---- KEEP_ALIVE(SNACK) ----&gt;

                     &lt;---- PUER_DATA w/o EoT ----  PEER_COMMITTED
  COMMITTED          ---- KEEP_ALIVE(SNACK) ----&gt;
                               .
                               .
                               .                       |
                                                   {Flush}
                                                       |
      |              &lt;--- PURE_DATA c/w EoT -----  COMMITTING2
  CLOSABLE
                     --------- ACK_FLUSH -------&gt;      |
                                                   CLOSABLE
                               .
                               .
                  *** End of Connection ***
</pre><a href="#section-5.17.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sect-5.17.3">
<section id="section-5.17.3">
          <h4 id="name-typical-clone-connection-for">
<a href="#section-5.17.3" class="section-number selfRef">5.17.3. </a><a href="#name-typical-clone-connection-for" class="section-name selfRef">Typical Clone Connection for Push Message</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-5.17.3-1">
<pre>
Initiator of Multiplication              Responder of Multiplication
  *** Suppose the server fork a new connection to push message ***
  (Used to be server side)                  (Used to be client side)
      |
  {MultiplyAndWrite}
      |                                         {In Clonable State}
  CLONING            ---- MULTIPLY w/o EoT ----&gt;       *
                                         {Make Clone Connection}
           *** suppose no immediately available responding data ***
                                                       |
                                                   COMMITTING
      |              &lt;--- NULCOMMIT(c/w EoT) ----      |
  PEER_COMMITTED
      |              --------- ACK_FLUSH -------&gt;  COMMITTED
                               .
      |              ---- PURE_DATA w/o EoT ----&gt;  COMMITTED
  PEER_COMMITTED     &lt;--- KEEP_ALIVE(SNACK) ----       |
                               .
                               .
      |                        .
  {Flush}
      |

  COMMITTING2        ---- PURE_DATA c/w EoT ----&gt;      |
                                                   CLOSABLE
      |              &lt;-------- ACK_FLUSH --------
  CLOSABLE
                               .
                               .
                  *** End of Connection ***
</pre><a href="#section-5.17.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sect-5.17.4">
<section id="section-5.17.4">
          <h4 id="name-simultaneous-shutdown">
<a href="#section-5.17.4" class="section-number selfRef">5.17.4. </a><a href="#name-simultaneous-shutdown" class="section-name selfRef">Simultaneous Shutdown</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-5.17.4-1">
<pre>
CLOSABLE                                         CLOSABLE
   |                                                 |
{Shutdown}                                       {Shutdown}
   |                                                 |
PRE_CLOSED                                       PRE_CLOSED
   |  \                                          /   |
   |   \                                        /    |
   |    \                                      /     |
   |     \------------- RELEASE --------------/-----&gt;+
   +&lt;------------------- RELEASE ------------/       |
   |                                               CLOSED
CLOSED
</pre><a href="#section-5.17.4-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sect-6">
<section id="section-6">
      <h2 id="name-end-to-end-negotiation">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-end-to-end-negotiation" class="section-name selfRef">End-to-End Negotiation</a>
      </h2>
<p id="section-6-1">End-to-end negotiation of FSP session occurs in the connection
      establishment phase. Connection establishment process of FSP consists of
      two and a half pairs of packet exchanges for connection initialization,
      connection incarnation and the last confirmation. During the process
      various optional header or payload MAY be carried in the FSP preliminary
      packets to negotiate end-to-end session parameters.<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="sect-6.1">
<section id="section-6.1">
        <h3 id="name-connect-initialization-2">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-connect-initialization-2" class="section-name selfRef">Connect Initialization</a>
        </h3>
<p id="section-6.1-1">The initiator sends the INIT_CONNECT packet to the responder:
        (INIT_CONNECT, Salt, Timestamp, Init-Check-Code [, Responder's Host
        Name])<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">Connection initialization MAY be syndicated with optional address
        resolution at the gateway in the IPv6 network by carrying the
        responder's host name in the INIT_CONNECT packet.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">If it does carry the responder's host name it MUST take the link-
        local interface address <span>[<a href="#RFC4291" class="xref">RFC4291</a>]</span> as the source IPv6
        address and the default link-local gateway address, FE80::1, as the
        destination IPv6 address no matter whether the global unicast IP
        address of the default gateway is configured.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4">If the gateway that relays the INIT_CONNECT packet finds that the
        responder is on the same link-local network with the initiator it
        SHALL change the source and the destination IP addresses of the
        INIT_CONNECT packet to the link-local IP addresses of the initiator
        and the responder respectively, and relay the packet onto the same
        link-local network.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1-5">On receiving the INIT_CONNECT packet that carries the responder's
        host name the link-local gateway MUST resolute the responder's global
        unicast IPv6 address and map the initiator's global unicast IPv6
        address, and replace the destination and source address of the
        INIT_CONNECT packet respectively, unless it finds that the initiator
        and the responder are on the same link-local network, where the
        gateway SHALL process the packet as stated in the previous
        statement.<a href="#section-6.1-5" class="pilcrow">¶</a></p>
<p id="section-6.1-6">The gateway SHALL silently ignore the INIT_CONNECT packet if it is
        unable to resolve the IP address of the responder.<a href="#section-6.1-6" class="pilcrow">¶</a></p>
<p id="section-6.1-7">If the destination address is the default link-local gateway
        address while the INIT_CONNECT does not carry the responder's host
        name payload, it is supposed that the gateway is the intent
        destination of the connection to initialize.<a href="#section-6.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-6.2">
<section id="section-6.2">
        <h3 id="name-response-to-connect-initial">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-response-to-connect-initial" class="section-name selfRef">Response to Connect Initialization</a>
        </h3>
<p id="section-6.2-1">The responder sends acknowledgment to the initiator:<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">(ACK_INIT_CONNECT, Time-delta, Cookie, Init-Check-Code Reflected,
        Responder's Sink Parameter)<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2-3">If the responder is ready to accept the connection, it SHALL
        generate a cookie which is meant to be reflected by the initiator. The
        responder MUST send the ACK_INIT_CONNECT packet with the new allocated
        local ULTID instead of the original listening ULTID. The initiator
        should be able to find out the original listening ULTID by searching
        its own connection context.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<p id="section-6.2-4">In the Responder's Sink Parameter the original listener ULTID MUST
        be set to the right value.<a href="#section-6.2-4" class="pilcrow">¶</a></p>
<p id="section-6.2-5">The destination address of the packet sent back MUST be set to the
        source address of the corresponding Connect Initialization packet
        whose source and destination address MAY be updated by some
        intermediary such as the link-local gateway of the initiator.<a href="#section-6.2-5" class="pilcrow">¶</a></p>
<p id="section-6.2-6">The responder SHALL NOT make state transition on receiving
        INIT_CONNECT packet.<a href="#section-6.2-6" class="pilcrow">¶</a></p>
<p id="section-6.2-7">If the responder refuses to accept the connection, it SHALL
        silently discard the INIT_CONNECT packet.<a href="#section-6.2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-6.3">
<section id="section-6.3">
        <h3 id="name-connection-incarnation-requ">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-connection-incarnation-requ" class="section-name selfRef">Connection Incarnation Request</a>
        </h3>
<p id="section-6.3-1">(CONNECT_REQUEST, Salt, Timestamp, Init-Check-Code, Initial SN,
        Time- delta Reflected, Cookie Reflected, Initiator's Sink Parameter [,
        Initiator's Host Name])<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">The initiator accepts the Response to Connect Initialization packet
        if and only if both the destination ULTID of the response packet
        matches the source ULTID of the connect initialization packet and the
        Init-Check-Code reflected in the response packet matches the Init-
        Check-Code in the connect initialization packet.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3">If the response packet is accepted the initiator formally requests
        to establish the connection by sending the CONECT_REQUEST packet.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
<p id="section-6.3-4">In the CONNECT_REQUEST packet the value of the Timestamp, the Init-
        Check-Code and the Salt field MUST be the same as in the INIT_CONNECT
        packet while the value of the Cookie Reflected field and the Time-
        delta Reflected field MUST be the same as in the ACK_INIT_ CONNECT
        packet, respectively.<a href="#section-6.3-4" class="pilcrow">¶</a></p>
<p id="section-6.3-5">The initiator MUST send the packet towards the remote ULTID that
        the responder has preserved and sent with the ACK_INIT_CONNECT packet.
        It MUST fill the original listener ID field in the Initiator's Sink
        Parameter with the right value.<a href="#section-6.3-5" class="pilcrow">¶</a></p>
<p id="section-6.3-6">The source address of the CONNECT_REQUEST packet MUST be set to the
        destination address of the received ACK_INIT_CONNECT packet, while the
        network prefix and host-id part of the destination address MUST be set
        to the source address of the received ACK_INIT_CONNECT packet in the
        IPv6 network.<a href="#section-6.3-6" class="pilcrow">¶</a></p>
<p id="section-6.3-7">The initiator SHALL save the cookie value that the responder has
        given to make up the weak session key.<a href="#section-6.3-7" class="pilcrow">¶</a></p>
<p id="section-6.3-8">The initiator MUST fill the Initial SN field with the sequence
        number of the packet that will follow CONNECT_REQUEST. The
        CONNECT_REQUEST packet is payload free and does not consume the
        sequence space.<a href="#section-6.3-8" class="pilcrow">¶</a></p>
<p id="section-6.3-9">The optional fields Initiator's Host Name is put as the payload of
        the CONNECT_REQUEST packet. If presented it MAY be exploited by the
        responder as the last resort to resolute the most recent IP address of
        the initiator in some extraordinary scenarios such as the initiator
        has hibernated for a considerably long time.<a href="#section-6.3-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-6.4">
<section id="section-6.4">
        <h3 id="name-connection-incarnation-resp">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-connection-incarnation-resp" class="section-name selfRef">Connection Incarnation Response</a>
        </h3>
<p id="section-6.4-1">Case 1: (ACK_CONNECT_REQ, FREWS, Initial SN, Expected SN, ICC[,
        Payload])<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<p id="section-6.4-2">Case 2: (RESET, Reason of Failure, Timestamp Reflected, Copy of
        Cookie Reflected)<a href="#section-6.4-2" class="pilcrow">¶</a></p>
<p id="section-6.4-3">The responder responds as in case 1 if the reflected cookie was
        validated, resources were successfully allocated and the initial
        context of the connection was setup. Otherwise it SHOULD respond as in
        case 2.<a href="#section-6.4-3" class="pilcrow">¶</a></p>
<p id="section-6.4-4">However, if the cookie is invalid, the responder SHALL silently
        discard the CONNECT_REQUEST packet.<a href="#section-6.4-4" class="pilcrow">¶</a></p>
<p id="section-6.4-5">The Initial SN in case 1 is the initial sequence number of the
        responder. The responder should fill in the field with a random 32-
        bit unsigned integer. As the ACK_CONNECT_REQ packet may carry payload
        the sequence number of the responder starts from the ACK_CONNECT_REQ
        packet.<a href="#section-6.4-5" class="pilcrow">¶</a></p>
<p id="section-6.4-6">The Expected SN MUST equal to the Initial SN specified in the
        corresponding CONNECT_ REQUEST packet.<a href="#section-6.4-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-6.5">
<section id="section-6.5">
        <h3 id="name-the-last-confirmation">
<a href="#section-6.5" class="section-number selfRef">6.5. </a><a href="#name-the-last-confirmation" class="section-name selfRef">The Last Confirmation</a>
        </h3>
<p id="section-6.5-1">Case 1: (NULCOMMIT, FREWS, Initial SN, Expected SN, ICC)<a href="#section-6.5-1" class="pilcrow">¶</a></p>
<p id="section-6.5-2">Case 2: (PERSIST, FREWS, Initial SN, Expected SN, ICC, payload)<a href="#section-6.5-2" class="pilcrow">¶</a></p>
<p id="section-6.5-3">Case 3: (RESET, Reason of Failure, Initial SN, Expected SN,
        ICC)<a href="#section-6.5-3" class="pilcrow">¶</a></p>
<p id="section-6.5-4">The initiator of the connection MUST eventually confirm to the
        responder that the connection is established by sending a payload-
        less NULCOMMIT packet (case 1) or a PERSIST packet with payload (case
        2).<a href="#section-6.5-4" class="pilcrow">¶</a></p>
<p id="section-6.5-5">Of course the initiator MAY quit to establish the connection by
        sending a legitimate RESET packet (case 3).<a href="#section-6.5-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-6.6">
<section id="section-6.6">
        <h3 id="name-retransmission">
<a href="#section-6.6" class="section-number selfRef">6.6. </a><a href="#name-retransmission" class="section-name selfRef">Retransmission</a>
        </h3>
<p id="section-6.6-1">The initiator SHALL retransmit the INIT_CONNECT packet if the
        corresponding ACK_INIT_CONNECT packet is not received in some limit
        time (by default 15 seconds).<a href="#section-6.6-1" class="pilcrow">¶</a></p>
<p id="section-6.6-2">The initiator SHALL retransmit the CONNECT_CONNECT packet if the
        corresponding ACK_CONNECT_REQ packet is not received in some limit
        time (by default 15 seconds).<a href="#section-6.6-2" class="pilcrow">¶</a></p>
<p id="section-6.6-3">The responder SHALL NOT retransmit ACK_INIT_CONNECT or
        ACK_CONNECT_REQ packet.<a href="#section-6.6-3" class="pilcrow">¶</a></p>
<p id="section-6.6-4">The initiator SHOULD retransmit the right INIT_CONNECT packet or
        CONNECT_CONNECT packet until the legitimate ACK_CONNECT_REQ packet is
        eventually received.<a href="#section-6.6-4" class="pilcrow">¶</a></p>
<p id="section-6.6-5">It SHALL give up if the time starting from the very first
        INIT_CONNECT packet was sent has exceed a longer timed-out value (by
        default 60 seconds) before the legitimate ACK_CONNECT_REQ packet is
        received.<a href="#section-6.6-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-7">
<section id="section-7">
      <h2 id="name-quad-party-session-key-inst">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-quad-party-session-key-inst" class="section-name selfRef">Quad-party Session Key Installation</a>
      </h2>
<p id="section-7-1">It is assumed that in the scenarios applying FSP it is the ULA to do
      key establishment and/or end-point authentication while the FSP layer
      provides authenticated, optionally encrypted data transfer service. The
      ULA installs the established shared secret key as the new session key of
      the FSP layer. Together they establish a secure channel between two
      application end-points.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">In a typical scenario the ULA endpoints first setup the FSP
      connection where resistance against connection redirection is weakly
      enforced by CRC64. After the pair of ULA endpoints have established a
      shared secret key, they install the secret key. Authenticity of the FSP
      packets sent later is cryptographically protected by the new secret key
      and resistance against various attacks is secured.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">Although transmit transaction is actually uni-directional the secret
      key is shared bi-directionally in this version of FSP.<a href="#section-7-3" class="pilcrow">¶</a></p>
<p id="section-7-4">Protocol for installation of the shared secret key is quad-party in
      the sense that both the upper layer application and the FSP layer of
      both the participant nodes MUST agree on the moment of certain state to
      install the shared secret key.<a href="#section-7-4" class="pilcrow">¶</a></p>
<p id="section-7-5">It is arguably much more flexible for the application layer protocols
      to adopt new key establishment algorithm while offloading routine
      authentication and optionally encryption of the data to the underlying
      layers where it may be much easier to exploit hardware-
      acceleration.<a href="#section-7-5" class="pilcrow">¶</a></p>
<div id="sect-7.1">
<section id="section-7.1">
        <h3 id="name-api-for-session-key-install">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-api-for-session-key-install" class="section-name selfRef">API for Session Key Installation</a>
        </h3>
<p id="section-7.1-1">A dedicate application program interface (API) is designed for the
        ULA to install the secret key established by the ULA participants. The
        API SHOULD take four parameters:<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-2.1">A 'handle' to state the connection context for installing the
            session key<a href="#section-7.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.1-2.2">A octet string of initial key materials (IKM)<a href="#section-7.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.1-2.3">An integer to state the length of IKM. The unit is octet.<a href="#section-7.1-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.1-2.4">An integer to state the desired length of the effective session
            key if AEAD is applied. The unit is bit. For this version of FSP
            desired length of the effective session key is either 128 or
            256.<a href="#section-7.1-2.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-7.1-3">The peer MUST have commit a transmit transaction and it SHALL
        install the same secret key on receiving the FSP packet with the EoT
        flag set.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<p id="section-7.1-4">The ULA SHOULD have installed the new shared secret key, or install
        it instantly after accepting the packet with the EoT flag set. If the
        new secret key has ever been installed the packet received after the
        one with the EoT flag set MUST adopt the new secret key.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-7.2">
<section id="section-7.2">
        <h3 id="name-time-to-call-api-for-sessio">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-time-to-call-api-for-sessio" class="section-name selfRef">Time to Call API for Session Key Installation</a>
        </h3>
<p id="section-7.2-1">A participant MAY install new session key if and only if the packet
        with the latest sequence number it has received has EoT flag
        marked.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-7.3">
<section id="section-7.3">
        <h3 id="name-time-to-take-new-session-ke">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-time-to-take-new-session-ke" class="section-name selfRef">Time to Take New Session Key into Effect</a>
        </h3>
<p id="section-7.3-1">By committing a transmit transaction a ULA participant clearly
        tells the underlying FSP layer that the next packet sent MAY adopt a
        new secret key. On receiving a packet with the EoT flag set the ULA is
        informed that the next packet received MAY adopt a new shared secret
        key.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2">After the ULA of a network node installed a new session key, every
        packet to send with sequence number later than the one with the EoT
        flag set just before the API to install session key was called MUST
        adopt the new session key in the FSP layer of the network node.<a href="#section-7.3-2" class="pilcrow">¶</a></p>
<p id="section-7.3-3">Every packet received with the sequence number later than the one
        with EoT flag set when the ULA called the API to install session key
        MUST be validated with the new session key. If the new secret key has
        ever been installed the packet received after the one with the EoT
        flag set MUST adopt the new secret key.<a href="#section-7.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-7.4">
<section id="section-7.4">
        <h3 id="name-generating-the-initial-sess">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-generating-the-initial-sess" class="section-name selfRef">Generating the Initial Session Key</a>
        </h3>
<p id="section-7.4-1">When the ULA install the secret key, it is required to provide the
        initial key material which might have unbalanced bit randomness, not
        the session key itself. HMAC-based Extract-and-Expand Key Derivation
        Function (HKDF) <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span> is applied to generate the
        initial session key.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<p id="section-7.4-2">Given raw key material ikm, length of the ikm nB in octets,
        intended master key length lenb in bits, || is octet string
        concatenation,<a href="#section-7.4-2" class="pilcrow">¶</a></p>
<p id="section-7.4-3">If HMAC only is designated, the nB octets of ikm is hashed into 64
        octets which is taken as the master key.<a href="#section-7.4-3" class="pilcrow">¶</a></p>
<p id="section-7.4-4">If AEAD is designated, the initial session key, or the first secret
        key for packet authentication and payload encryption is obtained as
        specified in <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span>:<a href="#section-7.4-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-7.4-5">
          <dt id="section-7.4-5.1">Key Extract phase,</dt>
          <dd style="margin-left: 1.0em" id="section-7.4-5.2">
            <p id="section-7.4-5.2.1"> Let Km =
            BLAKE2(zeros || ikm) , where<a href="#section-7.4-5.2.1" class="pilcrow">¶</a></p>
<p id="section-7.4-5.2.2"> zeros is 32
            octets of integer 0<a href="#section-7.4-5.2.2" class="pilcrow">¶</a></p>
<p id="section-7.4-5.2.3"> BLAKE2b algorithm
            without key is applied.<a href="#section-7.4-5.2.3" class="pilcrow">¶</a></p>
<p id="section-7.4-5.2.4"> The result Km is
            the master key.<a href="#section-7.4-5.2.4" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-7.4-5.3">Key Expand phase,</dt>
          <dd style="margin-left: 1.0em" id="section-7.4-5.4">
            <p id="section-7.4-5.4.1"> Let Ks =
            BLAKE2(Km, info) , where<a href="#section-7.4-5.4.1" class="pilcrow">¶</a></p>
<p id="section-7.4-5.4.2"> Km is the master
            key generated in previous phase,<a href="#section-7.4-5.4.2" class="pilcrow">¶</a></p>
<p id="section-7.4-5.4.3"> info is
            concatenation of the arbitrary ASCII string "Establishes an FSP
            session", which is 26-octet long, 3 octets of integer 0, and 1
            octet of integer 1.<a href="#section-7.4-5.4.3" class="pilcrow">¶</a></p>
<p id="section-7.4-5.4.4"> BLAKE2b algorithm
            with key is applied. The key applied MUST be the master key Km.<a href="#section-7.4-5.4.4" class="pilcrow">¶</a></p>
<p id="section-7.4-5.4.5"> The result Ks is the initial session key,
            or the first secret key for packet authentication and payload
            encryption.<a href="#section-7.4-5.4.5" class="pilcrow">¶</a></p>
<p id="section-7.4-5.4.6"> For this version FSP the
            generated Ks is a fixed-length AES key together with a 4-octet
            salt. The salt is meant to be passed to AES-GCM as the
            initialization vector together with the sequence number and
            expected sequence number fields in the normal FSP fixed
            header:<a href="#section-7.4-5.4.6" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<div class="alignLeft art-text artwork" id="section-7.4-6">
<pre>
 0                                                            31
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             Salt                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Sequence Number                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Expected Sequence Number/Out-of-band Serial Number        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-7.4-6" class="pilcrow">¶</a>
</div>
<p id="section-7.4-7">The salt is called 'the original salt', separated from 'the second
        salt' in the out-of-band packet.<a href="#section-7.4-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-7.5">
<section id="section-7.5">
        <h3 id="name-internal-rekeying">
<a href="#section-7.5" class="section-number selfRef">7.5. </a><a href="#name-internal-rekeying" class="section-name selfRef">Internal Rekeying</a>
        </h3>
<p id="section-7.5-1">In this version of FSP it is forced to re-key on sending or
        receiving every 536870912? (2^29) packets.<a href="#section-7.5-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-7.5-2">
          <dt id="section-7.5-2.1">Let Ks' = BLAKE2(Km, H || info') , where:</dt>
          <dd style="margin-left: 1.0em" id="section-7.5-2.2"> Km is the master key generated as in section
            7.4.<a href="#section-7.5-2.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<div class="alignLeft art-text artwork" id="section-7.5-3">
<pre>
  H is the 16-octet internal hash sub-key of AES-GCM of previous
  session key,
  info' is concatenation of the arbitrary ASCII string "Sustains an
  FSP connection", which is 26-octet long and the 4 octets in network
  order of the 32-bit unsigned integer that specifies the batch index
  of the session key.
</pre><a href="#section-7.5-3" class="pilcrow">¶</a>
</div>
<p id="section-7.5-4">BLAKE2b algorithm with key is applied. The key applied MUST be the
        master key Km.<a href="#section-7.5-4" class="pilcrow">¶</a></p>
<p id="section-7.5-5">The result Ks' is the new session key, together with the new salt
        meant to be form the IV.<a href="#section-7.5-5" class="pilcrow">¶</a></p>
<p id="section-7.5-6">The batch index of the initial session key is 1, and it is
        increased by 1 every time before it is to re-key.<a href="#section-7.5-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-7.6">
<section id="section-7.6">
        <h3 id="name-sample-sequence-of-installi">
<a href="#section-7.6" class="section-number selfRef">7.6. </a><a href="#name-sample-sequence-of-installi" class="section-name selfRef">Sample Sequence of Installing Session Key</a>
        </h3>
<p id="section-7.6-1">This section is informative.<a href="#section-7.6-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.6-2">
<pre>
      Node A                                          Node B
ULA-A        FSP-A                              FSP-B        ULA-B
{Send Km-A}
               -&gt;[seq_a2b_0]                  -&gt;
                                                       {Send Km-B}
               &lt;-                  [seq_b2a_0]&lt;-
                             .
                             .
                             .
{Commit}
               -&gt;[seq_a2b_m c/w EoT]          -&gt;
                                                     {Install Key}
                             .
{Wait}                       .
                             .
                                                          {Commit}
               &lt;-          [seq_b2a_n c/w EoT]&lt;-
{Install Key}
                             .
                             .                      {Send Further}
               &lt;-                [seq_b2a_n+1]&lt;-
                             .
{Send Further}               .
               -&gt;[seq_a2b_m+1]                -&gt;

  o Send Km-A, Send Km-B
</pre><a href="#section-7.6-2" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel" id="section-7.6-3">
          <dt id="section-7.6-3.1"></dt>
          <dd style="margin-left: 2.0em" id="section-7.6-3.2">ULA of node A and node B send there key material for key
            establishment, respectively.<a href="#section-7.6-3.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-7.6-4.1">
            <ul class="normal">
<li class="normal" id="section-7.6-4.1.1.1">
                <p id="section-7.6-4.1.1.1.1">Commit<a href="#section-7.6-4.1.1.1.1" class="pilcrow">¶</a></p>
<p id="section-7.6-4.1.1.1.2"> ULA of node A or node B
                informs the FSP layer to set the End of Transaction flag of
                the last packet to send and flush the send buffer.<a href="#section-7.6-4.1.1.1.2" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-7.6-4.1.1.2">
                <p id="section-7.6-4.1.1.2.1">Install Key<a href="#section-7.6-4.1.1.2.1" class="pilcrow">¶</a></p>
<p id="section-7.6-4.1.1.2.2"> ULA of node A or node B
                informs the FSP layer to install new session key, giving key
                materials for deriving the session key. A node may call
                Install Key if and only if its peer has just committed a
                transmit transaction.<a href="#section-7.6-4.1.1.2.2" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-7.6-4.1.1.3">
                <p id="section-7.6-4.1.1.3.1">Wait<a href="#section-7.6-4.1.1.3.1" class="pilcrow">¶</a></p>
<p id="section-7.6-4.1.1.3.2"> The ULA MUST wait until it has
                received some packet with EoT set from its peer before it may
                install new session key.<a href="#section-7.6-4.1.1.3.2" class="pilcrow">¶</a></p>
<p id="section-7.6-4.1.1.3.3"> There is no
                mandatory calling order of Commit and Install Key. However, if
                a node Commit before Install Key and it wants to apply new
                session key for the transmit transaction next to the one it
                has just committed, it SHALL NOT send further data until
                Install Key has returned successfully. In the above example,
                for node A packet with sequence number [seq_a2b_m+1] will be
                sent by applying the new session key, for node B packet with
                sequence number [seq_b2a_n+1] will be sent by applying the new
                session key.<a href="#section-7.6-4.1.1.3.3" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-7.6-4.1.1.4">
                <p id="section-7.6-4.1.1.4.1">Send Further<a href="#section-7.6-4.1.1.4.1" class="pilcrow">¶</a></p>
<p id="section-7.6-4.1.1.4.2"> ULA of node A or node
                B sends further data in the new transmit transaction,
                respectively.<a href="#section-7.6-4.1.1.4.2" class="pilcrow">¶</a></p>
<p id="section-7.6-4.1.1.4.3"> There is no mandatory
                order on which node should start new transmit transaction
                firstly.<a href="#section-7.6-4.1.1.4.3" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sect-8">
<section id="section-8">
      <h2 id="name-send-and-receive">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-send-and-receive" class="section-name selfRef">Send and Receive</a>
      </h2>
<div id="sect-8.1">
<section id="section-8.1">
        <h3 id="name-packet-integrity-protection">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-packet-integrity-protection" class="section-name selfRef">Packet Integrity Protection</a>
        </h3>
<div id="sect-8.1.1">
<section id="section-8.1.1">
          <h4 id="name-application-of-crc64">
<a href="#section-8.1.1" class="section-number selfRef">8.1.1. </a><a href="#name-application-of-crc64" class="section-name selfRef">Application of CRC64</a>
          </h4>
<p id="section-8.1.1-1">Starting from ACK_CONNECT_REQUEST, until the ULAs have installed
          the shared secret CRC64 is applied to calculate the value of the ICC
          field. The algorithm:<a href="#section-8.1.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1-2">

              
            <li id="section-8.1.1-2.1">Take pair of the ULDs as the initial value of accumulative
              CRC64<a href="#section-8.1.1-2.1" class="pilcrow">¶</a>
</li>
            <li id="section-8.1.1-2.2">Accumulate the value of the Init-Check-Code field<a href="#section-8.1.1-2.2" class="pilcrow">¶</a>
</li>
            <li id="section-8.1.1-2.3">Accumulate the value of the Cookie field successively<a href="#section-8.1.1-2.3" class="pilcrow">¶</a>
</li>
            <li id="section-8.1.1-2.4">Accumulate the combined value of the salt and the timeDelta
              field where the former is the leftmost 32 bits and the latter is
              the rightmost 32 bits<a href="#section-8.1.1-2.4" class="pilcrow">¶</a>
</li>
            <li id="section-8.1.1-2.5">Accumulate the value of the Time Stamp field<a href="#section-8.1.1-2.5" class="pilcrow">¶</a>
</li>
            <li id="section-8.1.1-2.6">Save the accumulated CRC64 value as the pre-computed CRC64
              value<a href="#section-8.1.1-2.6" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-8.1.1-3">The pair of the ULDs is composed of the near end's ULTID and the
          remote end's ULTID, where the former is the leftmost 32 bits and the
          latter is the rightmost 32 bits of initial value for the send
          direction, and the order is reversed for the receive direction.<a href="#section-8.1.1-3" class="pilcrow">¶</a></p>
<p id="section-8.1.1-4">When calculate the value ICC of a particular FSP packet, firstly
          set ICC to the pre-computed CRC64 value, then calculate the CRC64
          checksum of the whole FSP packet, while ULTIDs are NOT included if
          the FSP packet is encapsulated in UDP. The result is set as the
          final value of the ICC field.<a href="#section-8.1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-8.1.2">
<section id="section-8.1.2">
          <h4 id="name-packet-authentication-only">
<a href="#section-8.1.2" class="section-number selfRef">8.1.2. </a><a href="#name-packet-authentication-only" class="section-name selfRef">Packet Authentication Only</a>
          </h4>
<p id="section-8.1.2-1">The ULA designates the FSP layer to either applying HMAC only or
          applying AEAD.<a href="#section-8.1.2-1" class="pilcrow">¶</a></p>
<p id="section-8.1.2-2">If the HMAC flag of a packet is set the pre-designated
          cryptographic hash function SHALL be applied to get the message
          authentication code (MAC) of the whole packet. Each FSP version MUST
          designate one and only one particular cryptographic hash
          function.<a href="#section-8.1.2-2" class="pilcrow">¶</a></p>
<p id="section-8.1.2-3">For this FSP version, BLAKE2 <span>[<a href="#RFC7693" class="xref">RFC7693</a>]</span> is
          designated as the cryptographic hash function. The input key is the
          secret key that has been derived from the master key installed by
          the ULA. The input data is the full FSP packet, where the ICC field
          is pre-filled the pair of the ULDs. As in making CRC64 checksum, the
          pair of the ULDs is composed of the near end's ULTID and the remote
          end's ULTID, where the former is the leftmost 32 bits and the latter
          is the rightmost 32 bits of initial value for the send direction,
          and the order is reversed for the receive direction.<a href="#section-8.1.2-3" class="pilcrow">¶</a></p>
<p id="section-8.1.2-4">The hash result is truncated to 64 bits to get the final ICC.<a href="#section-8.1.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-8.1.3">
<section id="section-8.1.3">
          <h4 id="name-authenticated-encryption-wi">
<a href="#section-8.1.3" class="section-number selfRef">8.1.3. </a><a href="#name-authenticated-encryption-wi" class="section-name selfRef">Authenticated Encryption with Additional Data</a>
          </h4>
<p id="section-8.1.3-1">FSP provides per-packet authenticated encryption service. Only
          one authenticated encryption algorithm is allowed for a determined
          version of FSP. For this FSP version, the authenticated encryption
          algorithm selected is GCM-AES <span>[<a href="#GCM" class="xref">GCM</a>]</span><span>[<a href="#AES" class="xref">AES</a>]</span>, it is applied to protect integrity of the full FSP
          packets, and privacy of the payload together with the extension
          headers, if any. The four inputs to GCM- AES authenticated
          encryption are:<a href="#section-8.1.3-1" class="pilcrow">¶</a></p>
<p id="section-8.1.3-2">K: the key derived by the master key installed by ULA. The length
          of the session key is determined by the ULA.<a href="#section-8.1.3-2" class="pilcrow">¶</a></p>
<p id="section-8.1.3-3">IV: the initial vector, 96-bit string made by concatenating a
          32-bit salt, the 32-bit sequence number of the packet and the 32-bit
          expected sequence number field of the packet. The salt is derived by
          the master key installed by ULA.<a href="#section-8.1.3-3" class="pilcrow">¶</a></p>
<p id="section-8.1.3-4">P: the plaintext are the bytes following the fixed header up to
          the end of the original payload.<a href="#section-8.1.3-4" class="pilcrow">¶</a></p>
<p id="section-8.1.3-5">AAD: additional authenticated data, for this version of FSP it is
          the fixed header of the FSP packet. The source ULTID MUST be stored
          in the leftmost 32-bit of the ICC field while the destination ULTID
          MUST be stored in the rightmost 32-bit of the ICC field before the
          ICC value is calculated.<a href="#section-8.1.3-5" class="pilcrow">¶</a></p>
<p id="section-8.1.3-6">The length of the authentication tag MUST be 64 bits for FSP
          version 0 and 1. The authentication tag is stored in the ICC
          finally.<a href="#section-8.1.3-6" class="pilcrow">¶</a></p>
<p id="section-8.1.3-7">The inputs to GCM-AES decryption are:<a href="#section-8.1.3-7" class="pilcrow">¶</a></p>
<p id="section-8.1.3-8">K: the key derived by the master key installed by ULA. The length
          of the session key is determined by the ULA.<a href="#section-8.1.3-8" class="pilcrow">¶</a></p>
<p id="section-8.1.3-9">IV: the initial vector, 96-bit string made by concatenating
          consisted of the 32-bit salt, the 32-bit sequence number of the
          packet and the 32-bit expected sequence number field of the
          packet.<a href="#section-8.1.3-9" class="pilcrow">¶</a></p>
<p id="section-8.1.3-10">C: the cipher-text are the bytes following the fixed header up to
          the end of the received payload.<a href="#section-8.1.3-10" class="pilcrow">¶</a></p>
<p id="section-8.1.3-11">AAD: additional authenticated data, for this version of FSP it is
          the fixed header of the FSP packet. The source ULTID MUST be stored
          in the leftmost 32-bit of the ICC field while the destination ULTID
          MUST be stored in the rightmost 32-bit of the ICC field before the
          ICC value is calculated.<a href="#section-8.1.3-11" class="pilcrow">¶</a></p>
<p id="section-8.1.3-12">T: The authentication tag, which is fetched from the ICC field
          received.<a href="#section-8.1.3-12" class="pilcrow">¶</a></p>
<p id="section-8.1.3-13">Only when the outputs of GCM-AES decryption tell that the
          authentication tag passed verification may the receiver deliver the
          decrypted payload to the ULA.<a href="#section-8.1.3-13" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-8.1.4">
<section id="section-8.1.4">
          <h4 id="name-icc-of-the-out-of-band-pack">
<a href="#section-8.1.4" class="section-number selfRef">8.1.4. </a><a href="#name-icc-of-the-out-of-band-pack" class="section-name selfRef">ICC of the Out-of-Band Packet</a>
          </h4>
<p id="section-8.1.4-1">When calculating the ICC of an out-band packet (KEEP_ALIVE,
          ACK_FLUSH or MULTIPLY), the ExpectedSN field SHALL be filled with
          the out-of- band serial number. The first 32-bit word of the fixed
          header is taken as the second salt.<a href="#section-8.1.4-1" class="pilcrow">¶</a></p>
<p id="section-8.1.4-2">To get or check the ICC of the out-of-band packet the original
          salt value that is set on deriving the session key and stored in the
          internal security context MUST be XORed with the second salt value
          before applying GCM-AES. The original salt value MUST be recovered
          instantly after GCM-AES is applied.<a href="#section-8.1.4-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-8.2">
<section id="section-8.2">
        <h3 id="name-start-a-new-transmit-transa">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-start-a-new-transmit-transa" class="section-name selfRef">Start a New Transmit Transaction</a>
        </h3>
<p id="section-8.2-1">The responder starts a transmit transaction by send the
        ACK_CONNECT_REQ packet which MAY terminate the transmit transaction at
        the same time.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">When the initiator further acknowledges ACK_CONNECT_REQ with
        NULCOMMIT it both starts AND terminates a transmit transaction without
        sending any data:<a href="#section-8.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-8.2-3">
          <dt id="section-8.2-3.1"></dt>
          <dd style="margin-left: 1.0em" id="section-8.2-3.2">(NULCOMMIT, FREWS, SN, ExpectedSN, ICC [, Sink Parameter])<a href="#section-8.2-3.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-8.2-4">Any party MAY start a new transmit transaction by sending a PERSIST
        packet:<a href="#section-8.2-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-8.2-5">
          <dt id="section-8.2-5.1"></dt>
          <dd style="margin-left: 1.0em" id="section-8.2-5.2">(PERSIST, FREWS, SN, ExpectedSN, ICC, Payload)<a href="#section-8.2-5.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-8.2-6">PERSIST packet sent by the initiator firstly acknowledges the
        ACK_CONNECT_REQ packet as well.<a href="#section-8.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-8.3">
<section id="section-8.3">
        <h3 id="name-send-a-pure-data-packet">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-send-a-pure-data-packet" class="section-name selfRef">Send a Pure Data Packet</a>
        </h3>
<span class="break"></span><dl class="dlParallel" id="section-8.3-1">
          <dt id="section-8.3-1.1"></dt>
          <dd style="margin-left: 1.0em" id="section-8.3-1.2">(PURE_DATA, FREWS, SN, ExpectedSN, ICC, Payload)<a href="#section-8.3-1.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-8.3-2">After a new transmit transaction has been started further PURE_DATA
        packet MAY be sent until a packet with EoT flag set is sent.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-8.4">
<section id="section-8.4">
        <h3 id="name-commit-a-transmit-transacti">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-commit-a-transmit-transacti" class="section-name selfRef">Commit a Transmit Transaction</a>
        </h3>
<div id="sect-8.4.1">
<section id="section-8.4.1">
          <h4 id="name-initiate-transmit-transacti">
<a href="#section-8.4.1" class="section-number selfRef">8.4.1. </a><a href="#name-initiate-transmit-transacti" class="section-name selfRef">Initiate Transmit Transaction Commitment</a>
          </h4>
<p id="section-8.4.1-1">A participant of an FSP connection MAY notify its peer that a
          transmit transaction shall be committed by setting the EoT flag of
          the last packet of the transmit transaction, be it NULCOMMIT,
          PERSIST, PURE_DATA or MULTIPLY.<a href="#section-8.4.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-8.4.2">
<section id="section-8.4.2">
          <h4 id="name-respond-to-transmit-transac">
<a href="#section-8.4.2" class="section-number selfRef">8.4.2. </a><a href="#name-respond-to-transmit-transac" class="section-name selfRef">Respond to Transmit Transaction Commitment</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-8.4.2-1">
            <dt id="section-8.4.2-1.1"></dt>
            <dd style="margin-left: 1.0em" id="section-8.4.2-1.2">(ACK_FLUSH, FREWS, SN, ExpectedSN, ICC)<a href="#section-8.4.2-1.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-8.4.2-2">If and only if all of the packets in a transmit transaction has
          been received MAY ACK_FLUSH packet be sent.<a href="#section-8.4.2-2" class="pilcrow">¶</a></p>
<p id="section-8.4.2-3">Whenever a legitimate packet falls in the receive window of the
          receiver, and the packet fills in the last gap of the sequence of
          current transmit transaction on receiving direction, or the packet
          with same sequence number has been accepted already, a responding
          ACK_FLUSH SHALL be sent back immediately, and the FSP layer MUST
          immediately notify the ULA that a transmit transaction has been
          committed.<a href="#section-8.4.2-3" class="pilcrow">¶</a></p>
<p id="section-8.4.2-4">The sequence number (SN) of the ACK_FLUSH packet MUST equal the
          latest sequence number of the legitimate packets that have been
          sent.<a href="#section-8.4.2-4" class="pilcrow">¶</a></p>
<p id="section-8.4.2-5">The out-of-band serial number SHALL increase by one whenever a
          new ACK_FLUSH packet is sent.<a href="#section-8.4.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-8.4.3">
<section id="section-8.4.3">
          <h4 id="name-finalize-transmit-transacti">
<a href="#section-8.4.3" class="section-number selfRef">8.4.3. </a><a href="#name-finalize-transmit-transacti" class="section-name selfRef">Finalize Transmit Transaction Commitment</a>
          </h4>
<p id="section-8.4.3-1">After receiving the ACK_FLUSH packet the sender of the EoT flag
          migrates to the COMMITTED or CLOSABLE state from the COMMITTING or
          COMMITTING2 state, respectively.<a href="#section-8.4.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-8.4.4">
<section id="section-8.4.4">
          <h4 id="name-time-out-for-committing-tra">
<a href="#section-8.4.4" class="section-number selfRef">8.4.4. </a><a href="#name-time-out-for-committing-tra" class="section-name selfRef">Time-out for Committing Transmit Transaction</a>
          </h4>
<p id="section-8.4.4-1">The ULA SHALL be timed-out if there is no packet was acknowledged
          in some hard-coded time-out. For this version of FSP the time-out is
          set to 30 seconds.<a href="#section-8.4.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-8.5">
<section id="section-8.5">
        <h3 id="name-retransmission-2">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-retransmission-2" class="section-name selfRef">Retransmission</a>
        </h3>
<div id="sect-8.5.1">
<section id="section-8.5.1">
          <h4 id="name-calculation-of-rtt">
<a href="#section-8.5.1" class="section-number selfRef">8.5.1. </a><a href="#name-calculation-of-rtt" class="section-name selfRef">Calculation of RTT</a>
          </h4>
<p id="section-8.5.1-1">We borrows specifications for calculating RTT (and RTO)
          considerably from Computing TCP's Retransmission Timer <span>[<a href="#RFC6298" class="xref">RFC6298</a>]</span> to calculate Retransmission Time Out (RTO).<a href="#section-8.5.1-1" class="pilcrow">¶</a></p>
<p id="section-8.5.1-2">The sender maintains two state variables, SRTT (smoothed
          round-trip time) and RTTVAR (round-trip time variation). In
          addition, we assume a clock granularity of G seconds.<a href="#section-8.5.1-2" class="pilcrow">¶</a></p>
<p id="section-8.5.1-3">Initial round trip time (RTT) for the Connection Initiator:
          Equals to the mean of the time elapsed when ACK_ INIT_CONNECT was
          received since INIT_CONNECT was sent, and the time elapsed till
          ACK_CONNECT_REQ was received since CONNECT_REQUEST was sent.<a href="#section-8.5.1-3" class="pilcrow">¶</a></p>
<p id="section-8.5.1-4">Initial RTT for the Connection Responder: Equals to the time
          elapsed when the CONNECT_REQUEST packet was received since the
          ACK_INIT_CONNECT packet had been received.<a href="#section-8.5.1-4" class="pilcrow">¶</a></p>
<p id="section-8.5.1-5">Initial RTT for the Initiator of Connection Multiplication:
          Equals to the most recent RTT of the multiplied connection.<a href="#section-8.5.1-5" class="pilcrow">¶</a></p>
<p id="section-8.5.1-6">Initial RTT for the Responder of Connection Multiplication:
          Equals to the most recent RTT of the multiplied connection.<a href="#section-8.5.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.5.1-7.1">When the Initial RTT measurement R is made, the host MUST
              set<a href="#section-8.5.1-7.1" class="pilcrow">¶</a>
</li>
          </ul>
<div class="alignLeft art-text artwork" id="section-8.5.1-8">
<pre>
   SRTT &lt;- R
   RTTVAR &lt;- R/2
</pre><a href="#section-8.5.1-8" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-8.5.1-9.1">When a subsequent RTT measurement R' is made, a host MUST
              set<a href="#section-8.5.1-9.1" class="pilcrow">¶</a>
</li>
          </ul>
<div class="alignLeft art-text artwork" id="section-8.5.1-10">
<pre>
   RTTVAR &lt;- (1 - beta) * RTTVAR + beta * |SRTT - R'|
   SRTT &lt;- (1 - alpha) * SRTT + alpha * R'
</pre><a href="#section-8.5.1-10" class="pilcrow">¶</a>
</div>
<p id="section-8.5.1-11">The value of SRTT used in the update to RTTVAR is its value
          before updating SRTT itself using the second assignment. That is,
          updating RTTVAR and SRTT MUST be computed in the above order.<a href="#section-8.5.1-11" class="pilcrow">¶</a></p>
<p id="section-8.5.1-12">The above SHOULD be computed using alpha=1/8 and beta=1/4.<a href="#section-8.5.1-12" class="pilcrow">¶</a></p>
<p id="section-8.5.1-13">R' SHOULD be measured whenever a packet with the SNACK extension
          header is received.<a href="#section-8.5.1-13" class="pilcrow">¶</a></p>
<p id="section-8.5.1-14">Suppose the packet with the latest SN that is accumulatively
          acknowledged is P-latest, R' equals the time when the SNACK header
          is received, minus the time when P-latest was sent, minus the delay
          that the acknowledgment was made.<a href="#section-8.5.1-14" class="pilcrow">¶</a></p>
<p id="section-8.5.1-15">The delay that the acknowledgment was made is stored in the
          "Acknowledgement Delay" field of the SNACK header. It equals the
          time difference between the time when the acknowledgement was sent
          and the time when P-latest was received.<a href="#section-8.5.1-15" class="pilcrow">¶</a></p>
<p id="section-8.5.1-16">Note that the no packet with SN later than any gap described in
          the SNACK header is considered as the packet with the latest SN that
          is accumulatively acknowledged.<a href="#section-8.5.1-16" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-8.5.2">
<section id="section-8.5.2">
          <h4 id="name-generation-and-transmission">
<a href="#section-8.5.2" class="section-number selfRef">8.5.2. </a><a href="#name-generation-and-transmission" class="section-name selfRef">Generation and transmission of SNACK</a>
          </h4>
<p id="section-8.5.2-1">Whenever the receiver receives a packet it SHALL shift the time
          to send next heartbeat signal earlier to the time of RTT since
          current time, if the time to send next heartbeat signal used to be
          later. If the time is already earlier than the time of RTT since
          current time, it needs not be shifted.<a href="#section-8.5.2-1" class="pilcrow">¶</a></p>
<p id="section-8.5.2-2">On the time to send the heartbeat signal the FSP node generates
          the SNACK header, then generate and send a new KEEP_ALIVE or
          ACK_FLUSH packet to carry the SNACK header. It SHALL send an
          ACK_FLUSH if it is in PEER_COMMIT, COMMITTING2 or CLOSABLE state,
          otherwise it SHALL send a KEEP_ALIVE packet.<a href="#section-8.5.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-8.5.3">
<section id="section-8.5.3">
          <h4 id="name-negative-acknowledgment-of-">
<a href="#section-8.5.3" class="section-number selfRef">8.5.3. </a><a href="#name-negative-acknowledgment-of-" class="section-name selfRef">Negative acknowledgment of Packets Sent</a>
          </h4>
<p id="section-8.5.3-1">Both the ACK_FLUSH and the KEEP_ALIVE packet in FSP carry the
          SNACK extension header, although number of gap descriptors in the
          SNACK extension header in the ACK_FLUSH packet MUST be 0. We call
          them SNACK packets. A SNACK packet P1 is said to be later than P0,
          if and only if SN of P1 is later than SN of P0, or SN of P1 equals
          SN of P0 while the out-of-band sequence number of P1 is later than
          that of P0. If the latest SNACK packet is ACK_FLUSH, all the packets
          with the sequence number later that the expected field of the packet
          are assumed to be negatively acknowledged.<a href="#section-8.5.3-1" class="pilcrow">¶</a></p>
<p id="section-8.5.3-2">By convention when we specify the range, the left square bracket
          meant to be inclusive, while the right parenthesis meant to be
          exclusive, the packets with SN in the ranges:<a href="#section-8.5.3-2" class="pilcrow">¶</a></p>
<p id="section-8.5.3-3">[expectedSN, expectedSN + 1st Gap Width),<a href="#section-8.5.3-3" class="pilcrow">¶</a></p>
<p id="section-8.5.3-4">[expectedSN + 1st Gap Width + 1st Data Length, expectedSN + 1st
          Gap Width + 1st DataLength + 2nd Gap Width), ...<a href="#section-8.5.3-4" class="pilcrow">¶</a></p>
<p id="section-8.5.3-5">[expectedSN + 1st Gap Width + 1st Data Length... + (n-1)th Gap
          Width + (n-1)th Data Length, expectedSN + 1st Gap Width + 1st
          DataLength... + n-th Gap Width)<a href="#section-8.5.3-5" class="pilcrow">¶</a></p>
<p id="section-8.5.3-6">together with the packets with SN later than (expectedSN + 1st
          Gap Width + 1st DataLength + ... + n-th Gap Width), these packets
          are assumed to be negatively acknowledged.<a href="#section-8.5.3-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-8.5.4">
<section id="section-8.5.4">
          <h4 id="name-retransmission-interval">
<a href="#section-8.5.4" class="section-number selfRef">8.5.4. </a><a href="#name-retransmission-interval" class="section-name selfRef">Retransmission Interval</a>
          </h4>
<p id="section-8.5.4-1">Until RTT measurement has been made for a packet sent between the
          sender and receiver, the sender SHOULD set RTO &lt;- 1 second.<a href="#section-8.5.4-1" class="pilcrow">¶</a></p>
<p id="section-8.5.4-2">After computing new SRTT, a host MUST updated RTO &lt;- SRTT +
          max (G, K*RTTVAR) where K = 4.<a href="#section-8.5.4-2" class="pilcrow">¶</a></p>
<p id="section-8.5.4-3">Clock granularity SHOULD be finer than 100msec, that is, it
          SHOULD be that G &lt;= 0.1 second.<a href="#section-8.5.4-3" class="pilcrow">¶</a></p>
<p id="section-8.5.4-4">Whenever RTO is computed, if it is less than 1 second, then the
          RTO SHOULD be rounded up to 1 second.<a href="#section-8.5.4-4" class="pilcrow">¶</a></p>
<p id="section-8.5.4-5">An implementation MUST manage the retransmission timer(s) in such
          a way that A packet is never retransmitted less than one RTO after
          the previous transmission of that packet.<a href="#section-8.5.4-5" class="pilcrow">¶</a></p>
<p id="section-8.5.4-6">Every time an in-band packet is sent (including a
          retransmission), if the timer is not running, start it running so
          that it will expire after RTO seconds (for the current value of
          RTO).<a href="#section-8.5.4-6" class="pilcrow">¶</a></p>
<p id="section-8.5.4-7">When all outstanding data has been acknowledged, turn off the
          retransmission timer.<a href="#section-8.5.4-7" class="pilcrow">¶</a></p>
<p id="section-8.5.4-8">When the retransmission timer expires, retransmit the packets
          that have not been acknowledged by the receiver, but limit by the
          rate throttling mechanism.<a href="#section-8.5.4-8" class="pilcrow">¶</a></p>
<p id="section-8.5.4-9">Rate of retransmission MUST be throttled in a way that No more
          that M/2 packets may be retransmitted in a clock interval, suppose
          in each clock interval M packets were sent averagely.<a href="#section-8.5.4-9" class="pilcrow">¶</a></p>
<p id="section-8.5.4-10">Packet retransmission SHALL be subjected to congestion control as
          well.<a href="#section-8.5.4-10" class="pilcrow">¶</a></p>
<p id="section-8.5.4-11">However, at least one packet MAY be retransmitted in one clock
          interval, provide that the retransmission timer expires for the
          first packet that has not been acknowledged yet.<a href="#section-8.5.4-11" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-8.6">
<section id="section-8.6">
        <h3 id="name-flow-control">
<a href="#section-8.6" class="section-number selfRef">8.6. </a><a href="#name-flow-control" class="section-name selfRef">Flow Control</a>
        </h3>
<p id="section-8.6-1">The participants of an FSP connection negotiate the initial receive
        window size with the FREWS field in the ACK_CONNECT_REQ packet, and
        the first PERSIST or NULCOMMIT packet that acknowledges the
        ACK_CONNECT_REQ packet, respectively. The receive window size SHALL
        NOT be less than 4 and SHALL be less than 2^24.<a href="#section-8.6-1" class="pilcrow">¶</a></p>
<p id="section-8.6-2">An FSP participant advertises current receive window size in the
        FREWS field.<a href="#section-8.6-2" class="pilcrow">¶</a></p>
<p id="section-8.6-3">An FSP participant SHALL NOT send a packet whose sequence number is
        later than the value of the ExpectedSN field plus the advertised
        receive window size, where both value come from the very packet
        received with the latest sequence number.<a href="#section-8.6-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-8.7">
<section id="section-8.7">
        <h3 id="name-congestion-control">
<a href="#section-8.7" class="section-number selfRef">8.7. </a><a href="#name-congestion-control" class="section-name selfRef">Congestion Control</a>
        </h3>
<p id="section-8.7-1">FSP supposes that end-to-end congestion control is provided by some
        shim layer, such as the congestion manager <span>[<a href="#RFC3124" class="xref">RFC3124</a>]</span>
        between the "traditional" IP layer and the FSP transport layer. The
        shim layer is considered as a sub-layer of the network layer.
        Implementation of FSP MUST provide such shim layer if the network
        layer of the end node does not provide end-to-end congestion
        management service.<a href="#section-8.7-1" class="pilcrow">¶</a></p>
<p id="section-8.7-2">FSP layer SHALL provide following information to the congestion
        manager as soon as the first packet on the fly was acknowledged by any
        mean, or a legitimate packet falling in the receive window with the
        ECE flag set is received:<a href="#section-8.7-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.7-3.1">The local interface number that the packet carrying the ECE
            signal is accepted.<a href="#section-8.7-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.7-3.2">The remote network prefix that the congestion information is
            meant to associate. Note that the aggregated host ID part is NOT
            included in the prefix.<a href="#section-8.7-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.7-3.3">The traffic class. For FSP it is bisected: MIND flag set or
            not.<a href="#section-8.7-3.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.7-3.4">Number of outstanding octets, including all of those in the
            payload AND the FSP headers.<a href="#section-8.7-3.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.7-3.5">The effective round trip time calculated in the most recent
            period. Note that retransmitted packets MUST be excluded on
            calculating the effective RTT.<a href="#section-8.7-3.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.7-3.6">Whether an ECN-Echo signal was received. The ECE flag of a
            legitimate packet falling in the receive window is the ECN-Echo
            signal.<a href="#section-8.7-3.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.7-3.7">Whether a sent packet with SRR flag set is acknowledged.<a href="#section-8.7-3.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-8.7-4">The congestion manager SHOULD reduce the send rate if the FSP
        sender informed it that an ECN-Echo signal was received.<a href="#section-8.7-4" class="pilcrow">¶</a></p>
<p id="section-8.7-5">The sender SHALL NOT inform the congestion manager to reduce the
        send rate again even if further packet with ECE flag set is received,
        until at least one sent packet with SRR flag set is acknowledged.<a href="#section-8.7-5" class="pilcrow">¶</a></p>
<p id="section-8.7-6">A packet with ECE flag set received after the packet with SRR flag
        set is acknowledged SHOULD make the congestion manager reduce the send
        rate again.<a href="#section-8.7-6" class="pilcrow">¶</a></p>
<p id="section-8.7-7">Retransmitted packet SHALL be subjected to send rate control at the
        underlying congestion management service sub-layer as well.<a href="#section-8.7-7" class="pilcrow">¶</a></p>
<p id="section-8.7-8">Quota or other means to enforce fairness among various FSP
        connections SHOULD be provided directly to the ULA by the congestion
        management service.<a href="#section-8.7-8" class="pilcrow">¶</a></p>
<p id="section-8.7-9">Requirement of an FSP congestion manager would be detailed in a
        separate document.<a href="#section-8.7-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-8.8">
<section id="section-8.8">
        <h3 id="name-on-the-wire-compression-2">
<a href="#section-8.8" class="section-number selfRef">8.8. </a><a href="#name-on-the-wire-compression-2" class="section-name selfRef">On-the-Wire Compression</a>
        </h3>
<p id="section-8.8-1">FSP exploits the lossless compression algorithm as per <span>[<a href="#LZ4" class="xref">LZ4</a>]</span>.<a href="#section-8.8-1" class="pilcrow">¶</a></p>
<p id="section-8.8-2">If the CPR flag of the first packet of a transmit transaction is
        set, compression is applied on the payload octet stream of the
        transaction transaction.<a href="#section-8.8-2" class="pilcrow">¶</a></p>
<p id="section-8.8-3">When applying compression FSP divides source stream into multiple
        blocks. For this version of FSP length of each block is 128KiB (131072
        octets), except the final block whose length may be less than or equal
        to 128KiB. The final block is the one that terminate the transmit
        transaction, i.e. which contains the last FSP packet of the transmit
        transaction. The last FSP packet of the transmit transaction has the
        EoT flag set. The "LZ4_compress_fast_continue" method SHALL be applied
        on each block. That is, data from previous compressed blocks are taken
        use for better compression ratio.<a href="#section-8.8-3" class="pilcrow">¶</a></p>
<p id="section-8.8-4">When transferring the result data of compressing each block, the
        result data is prefixed with its length. The length is expressed by a
        4-octets little-endian integer.<a href="#section-8.8-4" class="pilcrow">¶</a></p>
<p id="section-8.8-5">On-the-wire compression of each transmit transactions is
        independent. It is the upper layer application that SHALL make
        agreement on which transmit transaction utilizes on-the-wire
        compression.<a href="#section-8.8-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-8.9">
<section id="section-8.9">
        <h3 id="name-milk-like-payload-and-minim">
<a href="#section-8.9" class="section-number selfRef">8.9. </a><a href="#name-milk-like-payload-and-minim" class="section-name selfRef">Milk Like Payload and Minimal Delay Service</a>
        </h3>
<p id="section-8.9-1">An ordinary data flow is wine-like in the sense that the older data
        are more valuable. If it has to, data packet sent latest are dropped
        first. In the contrary, milk-like payload is that the newer data are
        more precious and outdated data packet can be discarded.<a href="#section-8.9-1" class="pilcrow">¶</a></p>
<p id="section-8.9-2">When ULA is willing to accept incomplete message the peer of the
        underling FSP node SHALL set the MIND flag of the first PERSIST packet
        that starts the first transmit transaction, and set the MIND flag of
        every following PURE_DATA packet, while set the Traffic Class of the
        underlying IPv6 packet to some registered value.<a href="#section-8.9-2" class="pilcrow">¶</a></p>
<p id="section-8.9-3">In the transmission path, any relaying middle box, be it router or
        switch, should reserve a reasonably short queue for the packet flow of
        such flow to minimize delay.<a href="#section-8.9-3" class="pilcrow">¶</a></p>
<p id="section-8.9-4">When the receive buffer overflows the receiver discards the
        undelivered packet received first to free buffer space for the latest
        packet received. However it keeps order on delivering the packets to
        he ULA. ULA may choose to discard packets received earlier than some
        threshold.<a href="#section-8.9-4" class="pilcrow">¶</a></p>
<p id="section-8.9-5">The receiver SHOULD NOT make any acknowledgement to the packet
        received with the MIND flag set.<a href="#section-8.9-5" class="pilcrow">¶</a></p>
<p id="section-8.9-6">Minimal delay service is asymmetric in the sense that one
        transmission direction the data flow may be milk-like while in the
        reverse direction the data flow may be wine-like.<a href="#section-8.9-6" class="pilcrow">¶</a></p>
<p id="section-8.9-7">A minimal delay service data flow is terminated by ULA via some
        out- of-band control mechanism.<a href="#section-8.9-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-9">
<section id="section-9">
      <h2 id="name-graceful-shutdown">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-graceful-shutdown" class="section-name selfRef">Graceful Shutdown</a>
      </h2>
<p id="section-9-1">One participant of an FSP connection MAY initiate graceful shutdown
      of the connection if and only if its peer has committed the most recent
      transmit transaction.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">By initiating graceful shutdown the participant tells its peer that
      current transmit transaction is to be committed as well.<a href="#section-9-2" class="pilcrow">¶</a></p>
<div id="sect-9.1">
<section id="section-9.1">
        <h3 id="name-initiation-of-graceful-shut">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-initiation-of-graceful-shut" class="section-name selfRef">Initiation of Graceful Shutdown</a>
        </h3>
<span class="break"></span><dl class="dlParallel" id="section-9.1-1">
          <dt id="section-9.1-1.1"></dt>
          <dd style="margin-left: 1.0em" id="section-9.1-1.2">(RELEASE, FREWS, SN, ExpectedSN, ICC)<a href="#section-9.1-1.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-9.1-2">An FSP end node MAY initiate graceful shutdown if it is in the
        PEER_COMMIT, COMMITTING2 or CLOSABLE state. It SHALL NOT initiate
        graceful shutdown if its peer has not committed current transmit
        transaction.<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<p id="section-9.1-3">Graceful shutdown is signaled to the remote end by sending a
        RELEASE command packet. The FSP end node SHALL migrate to the
        PRE_CLOSED state just before sending the RELEASE packet.<a href="#section-9.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-9.2">
<section id="section-9.2">
        <h3 id="name-acknowledgment-of-graceful-">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-acknowledgment-of-graceful-" class="section-name selfRef">Acknowledgment of Graceful Shutdown</a>
        </h3>
<p id="section-9.2-1">The RELEASE packet may be accepted in the COMMITTING, COMMITTED,
        COMMITTING2, CLOSABLE or PRE_CLOSED state.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<p id="section-9.2-2">If the legitimate RELEASE packet is received in the COMMITTING or
        COMMITTED state, the FSP end node SHALL buffer the RELEASE packet,
        wait each packet of the last transmit transaction of its peer has been
        received, deliver all the buffered payload and then migrate to the
        SHUT_REQUESTED state.<a href="#section-9.2-2" class="pilcrow">¶</a></p>
<p id="section-9.2-3">If the legitimate RELEASE packet is received in the COMMITTING2 or
        CLOSABLE state, the FSP end node SHALL migrate to the SHUT_REQUESTED
        state immediately.<a href="#section-9.2-3" class="pilcrow">¶</a></p>
<p id="section-9.2-4">In either of the two cases the receiver of the RELEASE packet SHALL
        acknowledge the sender of the RELEASE packet with a legitimate out-
        of-band ACK_FLUSH packet.<a href="#section-9.2-4" class="pilcrow">¶</a></p>
<p id="section-9.2-5">If the RELEASE packet is received in the PRE_CLOSED state, it is to
        finalize the graceful shutdown procedure.<a href="#section-9.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-9.3">
<section id="section-9.3">
        <h3 id="name-finalization-of-graceful-sh">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-finalization-of-graceful-sh" class="section-name selfRef">Finalization of Graceful Shutdown</a>
        </h3>
<p id="section-9.3-1">If either the legitimate RELEASE packet or the legitimate ACK_FLUSH
        packet is received in the PRE_CLOSED state the grace shutdown request
        is supposed to be acknowledged and the shutdown procedure SHALL be
        finalized by that the FSP end node migrates to the CLOSED state
        immediately.<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<p id="section-9.3-2">In SHUT_REQUESTED state the FSP node SHALL migrate to CLOSED state
        immediately on the Shutdown API called by the ULA.<a href="#section-9.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-9.4">
<section id="section-9.4">
        <h3 id="name-retransmission-of-release-p">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-retransmission-of-release-p" class="section-name selfRef">Retransmission of RELEASE Packet</a>
        </h3>
<p id="section-9.4-1">The FSP end node in the PRE_CLOSED state SHALL retransmit the
        RELEASE packet until it migrates to CLOSED state or it is timed
        out.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
<p id="section-9.4-2">As RELEASE is the in-band packet retransmission of the RELEASE
        packet is subjected to the normal retransmission rule.<a href="#section-9.4-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-10">
<section id="section-10">
      <h2 id="name-mobility-and-multi-home-sup">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-mobility-and-multi-home-sup" class="section-name selfRef">Mobility and Multi-home Support</a>
      </h2>
<div id="sect-10.1">
<section id="section-10.1">
        <h3 id="name-heartbeat-signals">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-heartbeat-signals" class="section-name selfRef">Heartbeat Signals</a>
        </h3>
<p id="section-10.1-1">FSP requires that the participants periodically send the heartbeat
        signals.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<p id="section-10.1-2">The participant in the ACTIVE, COMMITTING, COMMITTED, PEER_COMMIT,
        COMMITING2 or CLOSABLE state MUST send the KEEP_ ALIVE packet as the
        heart-beat signal periodically to retain the connection in case that
        underlying IP address has changed.<a href="#section-10.1-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-10.1-3">
          <dt id="section-10.1-3.1"></dt>
          <dd style="margin-left: 1.0em" id="section-10.1-3.2">(KEEP_ALIVE, FREWS, SN, ExpectedSN, ICC, Sink Parameter,
            SNACK)<a href="#section-10.1-3.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-10.1-4">Heartbeat signal is an out-of-band control packet. It does not
        carry payload. The sequence number of the KEEP_ALIVE packet SHALL be
        set to the latest sequence number of all of the packets that have been
        sent.<a href="#section-10.1-4" class="pilcrow">¶</a></p>
<p id="section-10.1-5">Only the FSP node in the ACTIVE, COMMITTING, COMMITTED,
        PEER_COMMIT, COMMITING2 or CLOSABLE state MAY process the heartbeat
        signal.<a href="#section-10.1-5" class="pilcrow">¶</a></p>
<p id="section-10.1-6">In this version of FSP the heat-beat period is arbitrarily set to
        600 seconds.<a href="#section-10.1-6" class="pilcrow">¶</a></p>
<p id="section-10.1-7">The sequence number (SN) of the KEEP_ALIVE packet MUST equal the
        latest sequence number of the legitimate packets that have been
        sent.<a href="#section-10.1-7" class="pilcrow">¶</a></p>
<p id="section-10.1-8">The out-of-band serial number SHALL increase by one whenever a new
        KEEP_ALIVE packet is sent.<a href="#section-10.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-10.2">
<section id="section-10.2">
        <h3 id="name-active-address-change-signa">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-active-address-change-signa" class="section-name selfRef">Active Address Change Signaling</a>
        </h3>
<p id="section-10.2-1">During communication process the FSP participant whose underlying
        IP address is changed SHOULD inform its peer such change by transmit a
        KEEP_ALIVE packet with the Sink Parameter extension header and the
        SNACK header so that the peer can retransmit the packets that were
        negatively acknowledged.<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<p id="section-10.2-2">Such informing KEEP_ALIVE packet SHALL be sent in the ACTIVE,
        COMMITTING, COMMITTED, PEER_COMMIT, COMMITING2 or CLOSABLE state.<a href="#section-10.2-2" class="pilcrow">¶</a></p>
<p id="section-10.2-3">Informing KEEP_ALIVE packet SHOULD be sent more frequently than a
        normal heart-beat signaling KEEP_ALIVE packet.<a href="#section-10.2-3" class="pilcrow">¶</a></p>
<p id="section-10.2-4">For this version of FSP informing KEEP_ALIVE packet SHALL be
        retransmitted every 4 RTT interval until the heuristic acknowledgement
        is received.<a href="#section-10.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-10.3">
<section id="section-10.3">
        <h3 id="name-heuristic-remote-address-ch">
<a href="#section-10.3" class="section-number selfRef">10.3. </a><a href="#name-heuristic-remote-address-ch" class="section-name selfRef">Heuristic Remote Address Change Adaptation</a>
        </h3>
<p id="section-10.3-1">A participant of the FSP connection SHALL set the source address of
        the packet to transmit or retransmit to new IP address as soon as the
        near-end IPv4 address or IPv6 network prefix has changed. The ULTID
        field MUST remain the same.<a href="#section-10.3-1" class="pilcrow">¶</a></p>
<p id="section-10.3-2">When a new packet with a later sequence number is received and the
        source IP address of the packet is found to be different with the
        preserved IP address of the remote end, the receiver SHOULD
        automatically update the preserved IP address of the remote end to the
        source IP address of the new packet, unless there is a Sink Parameter
        header in the packet.<a href="#section-10.3-2" class="pilcrow">¶</a></p>
<p id="section-10.3-3">If the sequence number of the packet received is not the latest in
        the receive window the preserved IP address of the remote end SHALL
        NOT be updated even if the source address of the received packet has
        changed.<a href="#section-10.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-10.4">
<section id="section-10.4">
        <h3 id="name-heuristic-address-change-ac">
<a href="#section-10.4" class="section-number selfRef">10.4. </a><a href="#name-heuristic-address-change-ac" class="section-name selfRef">Heuristic Address Change Acknowledgement</a>
        </h3>
<p id="section-10.4-1">The address change signaling KEEP_ALIVE packet is supposed to be
        acknowledged if a packet targeted at the new IP address that the
        KEEP_ALIVE packet has informed is received.<a href="#section-10.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-10.5">
<section id="section-10.5">
        <h3 id="name-nat-traversal-and-multihomi">
<a href="#section-10.5" class="section-number selfRef">10.5. </a><a href="#name-nat-traversal-and-multihomi" class="section-name selfRef">NAT-traversal and Multihoming</a>
        </h3>
<p id="section-10.5-1">When FSP is implemented over UDP in the IPv4 network, each endpoint
        of the FSP connection is bound one and only one IPv4 address as soon
        as the connection is established. Each endpoint SHALL choose the
        source IPv4 address of the last packet received as the destination
        IPv4 address of the packet that it is to send later. By this mean FSP
        over UDP is NAT-friendly.<a href="#section-10.5-1" class="pilcrow">¶</a></p>
<p id="section-10.5-2">When FSP is implemented over IPv6 as soon as the connection is
        established the IPv6 address may be changed dynamically, and one more
        alternate IP address may be added or removed dynamically for
        individual endpoint as well, provided that ULTID part keeps unchanged
        while the host IDs part of all IPv6 address of the endpoint are of the
        same value at any given moment.<a href="#section-10.5-2" class="pilcrow">¶</a></p>
<p id="section-10.5-3">The sender may choose as the source IP address by selecting any
        network prefix that it has most-recently sent to its peer in the
        allowed address list field of the Sink Parameter header, joining with
        the host ID in the Sink Parameter header and the stable ULTID of the
        sender, and choose as the destination IP address by selecting any
        network prefix in the allowed address list field of the Sink Parameter
        header most-recently received from its peer, joining with the peer's
        host ID and the peer's ULTID. Thus multiple multi-homed paths MAY
        co-exist between the two FSP endpoints.<a href="#section-10.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-10.6">
<section id="section-10.6">
        <h3 id="name-explicit-multi-home-informi">
<a href="#section-10.6" class="section-number selfRef">10.6. </a><a href="#name-explicit-multi-home-informi" class="section-name selfRef">Explicit Multi-home Informing</a>
        </h3>
<p id="section-10.6-1">If an FSP end node is configured with multiple IPv4 address other
        than the loop-back address, or with multiply global unicast IPv6
        address, it MAY advertise multiple underlying addresses to the remote
        end by put them in the addressable network prefix list of the Sink
        Parameter extension header. The Sink Parameter extension header may be
        carried in the CONNECT_REQUEST, ACK_CONNECT_REQ, NULCOMMIT, MULTIPLY
        or KEEP_ALIVE packet.<a href="#section-10.6-1" class="pilcrow">¶</a></p>
<p id="section-10.6-2">Any participant of the communication SHALL NOT make discrimination
        of the source or destination IP address of any packet provided that
        both the source ULTID and the destination ULTID keep unchanged and the
        ICC field passes verification.<a href="#section-10.6-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-11">
<section id="section-11">
      <h2 id="name-connection-multiplication">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-connection-multiplication" class="section-name selfRef">Connection Multiplication</a>
      </h2>
<p id="section-11-1">Connection multiplication is the process of incarnating a new
      connection context by re-using security context of an established
      connection.<a href="#section-11-1" class="pilcrow">¶</a></p>
<div id="sect-11.1">
<section id="section-11.1">
        <h3 id="name-request-to-multiply-connect">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-request-to-multiply-connect" class="section-name selfRef">Request to Multiply Connection</a>
        </h3>
<span class="break"></span><dl class="dlParallel" id="section-11.1-1">
          <dt id="section-11.1-1.1"></dt>
          <dd style="margin-left: 1.0em" id="section-11.1-1.2">(MULTIPLY, FREWS, SN, Salt, ICC [, Sink Parameter] [,
            payload])<a href="#section-11.1-1.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-11.1-2">The initiator's initial sequence number of the new connection is
        the sequence number of the packet that piggybacks the connection
        multiplication header. The ExpectedSN field of the normal packet store
        a Salt value instead.<a href="#section-11.1-2" class="pilcrow">¶</a></p>
<p id="section-11.1-3">The FREWS field MUST be processed in the new connection context
        while the ICC MUST be calculated with the session key of the original
        connection.<a href="#section-11.1-3" class="pilcrow">¶</a></p>
<p id="section-11.1-4">The new connection inherits the remaining key life. ULA SHOULD
        negotiate new session key and/or install new session key as soon as
        possible.<a href="#section-11.1-4" class="pilcrow">¶</a></p>
<p id="section-11.1-5">The optional payload of the MULTIPLY packet MUST be processed in
        the new connection context.<a href="#section-11.1-5" class="pilcrow">¶</a></p>
<p id="section-11.1-6">The MULTIPLY packet is an out-of-band command packet in the
        original connection context.<a href="#section-11.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-11.2">
<section id="section-11.2">
        <h3 id="name-response-to-connection-mult">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-response-to-connection-mult" class="section-name selfRef">Response to Connection Multiplication Request</a>
        </h3>
<span class="break"></span><dl class="dlParallel" id="section-11.2-1">
          <dt id="section-11.2-1.1"></dt>
          <dd style="margin-left: 1.0em" id="section-11.2-1.2">Case 1: (NULCOMMIT, FREWS, SN, ExpectedSN, ICC [, Sink
            Parameter])<a href="#section-11.2-1.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-11.2-1.3"></dt>
          <dd style="margin-left: 1.0em" id="section-11.2-1.4">Case 2: (PERSIST, FREWS, SN, ExpectedSN, ICC, Payload)<a href="#section-11.2-1.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-11.2-1.5"></dt>
          <dd style="margin-left: 1.0em" id="section-11.2-1.6">Case 3: (RESET, Reason of Failure, SN, ExpectedSN, ICC)<a href="#section-11.2-1.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-11.2-2">In all of these cases the ULTID of the remote-end MUST be the value
        of the initiator's ULTID in the connection multiplication header.<a href="#section-11.2-2" class="pilcrow">¶</a></p>
<p id="section-11.2-3">It is REQUIRED that only a connection in the ESTABLISHED,
        COMMITTING, COMMITTED, PEER_COMMIT, COMMITTING2 or CLOSABLE state may
        accept a connection multiplication request.<a href="#section-11.2-3" class="pilcrow">¶</a></p>
<p id="section-11.2-4">In case 1 the responder admits the multiplication request AND
        commit the transmit transaction, the new connection enters into the
        PEER_COMMIT or CLOSABLE state immediately, on request of ULA.<a href="#section-11.2-4" class="pilcrow">¶</a></p>
<p id="section-11.2-5">In case 2 the responder admits the multiplication request and the
        new connection enters into the ESTABLISHED, PEER_COMMIT, COMMITTING or
        CLOSABLE state immediately, depending whether the ULA of the
        multiplication initiator has requested to commit the transmit
        transaction immediately and whether the ULA of the multiplication
        responder has requested to commit the transmit transaction in the
        reverse direction immediately.<a href="#section-11.2-5" class="pilcrow">¶</a></p>
<p id="section-11.2-6">In case 3 the responder rejects the multiplication request. To
        defend against spoofing attack ICC MUST be valid. The value of the SN
        field MUST equal the value of the 'Expected SN' field of the
        requesting MULTIPLY packet while the value of ExpectedSN field MUST
        equal the value of the 'Sequence No' field.<a href="#section-11.2-6" class="pilcrow">¶</a></p>
<p id="section-11.2-7">The new connection MUST derive new session key from the session key
        of the original connection where the out-of-band requesting MULTIPLY
        packet is received immediately.<a href="#section-11.2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-11.3">
<section id="section-11.3">
        <h3 id="name-duplicate-detection-of-conn">
<a href="#section-11.3" class="section-number selfRef">11.3. </a><a href="#name-duplicate-detection-of-conn" class="section-name selfRef">Duplicate Detection of Connection Multiplication Request</a>
        </h3>
<p id="section-11.3-1">Every time the responder of connection multiplication receives a
        MULTIPLY packet it MUST check the suggested responder's ULTID and the
        initiator's ULTID.<a href="#section-11.3-1" class="pilcrow">¶</a></p>
<p id="section-11.3-2">The responder MUST reject the multiplication request if the
        suggested responder's ULTID equals the near-end ULTID of some
        connection and the remote-end ULTID of that connection does not equal
        the initiator's ULTID.<a href="#section-11.3-2" class="pilcrow">¶</a></p>
<p id="section-11.3-3">The responder MUST recognize the MULTIPLY packet as a duplicate
        connection request if some connection matches the request and SHOULD
        response by retransmitting the head packet of the send queue of the
        matching connection, be it a PERSIST or a NULCOMMIT packet. A
        connection matches the MULTIPLY request if and only if the suggested
        responder's ULTID in the MULTIPLY packet equals the near-end ULTID of
        the connection and the initiator's ULTID equals the remote-end ULTID
        of the connection.<a href="#section-11.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-11.4">
<section id="section-11.4">
        <h3 id="name-retransmission-3">
<a href="#section-11.4" class="section-number selfRef">11.4. </a><a href="#name-retransmission-3" class="section-name selfRef">Retransmission</a>
        </h3>
<p id="section-11.4-1">The initiating side SHALL retransmit the MULTIPLY packet if the
        corresponding PERSIST packet is not received in some limit time (by
        default 15 seconds).<a href="#section-11.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-11.5">
<section id="section-11.5">
        <h3 id="name-key-derivation-for-branch-c">
<a href="#section-11.5" class="section-number selfRef">11.5. </a><a href="#name-key-derivation-for-branch-c" class="section-name selfRef">Key Derivation for Branch Connection</a>
        </h3>
<span class="break"></span><dl class="dlParallel" id="section-11.5-1">
          <dt id="section-11.5-1.1">Let K_out = BLAKE2(Km, [d] || Label || 0x00 || Context || L), where:</dt>
          <dd style="margin-left: 0.5em" id="section-11.5-1.2">
            <ul class="normal">
<li class="normal" id="section-11.5-1.2.1.1">Km is the master key,<a href="#section-11.5-1.2.1.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-11.5-1.2.1.2">[d] is one octet of integer Depth. It is alike the KDF
                counter mode as the NIST SP800-108. For this version of FSP it
                is the fixed number 1,<a href="#section-11.5-1.2.1.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-11.5-1.2.1.3">Label is the fixed ASCII string "Multiply an FSP
                connection" which is 26-octet long for this version of
                FSP,<a href="#section-11.5-1.2.1.3" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-11.5-1.2.1.4">
                <p id="section-11.5-1.2.1.4.1">Context is concatenation of two 32-bit words idB and
                idR<a href="#section-11.5-1.2.1.4.1" class="pilcrow">¶</a></p>
<p id="section-11.5-1.2.1.4.2"> idB is the ULTID allocated for the
                branch connection in the context of the multiplication
                initiator. idB is byte-order neutral.<a href="#section-11.5-1.2.1.4.2" class="pilcrow">¶</a></p>
<p id="section-11.5-1.2.1.4.3">
                idR is the receiver side ULTID of the original connection that
                is to accept the connection multiplication request. idI or idR
                is byte-order neutral.<a href="#section-11.5-1.2.1.4.3" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-11.5-1.2.1.5">L is a 32-bit network byte-order integer specifying the
                length in bits of the derived key K-out<a href="#section-11.5-1.2.1.5" class="pilcrow">¶</a>
</li>
            </ul>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="sect-12">
<section id="section-12">
      <h2 id="name-timeouts-and-abrupt-close">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-timeouts-and-abrupt-close" class="section-name selfRef">Timeouts and Abrupt Close</a>
      </h2>
<div id="sect-12.1">
<section id="section-12.1">
        <h3 id="name-timeouts-in-end-to-end-nego">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-timeouts-in-end-to-end-nego" class="section-name selfRef">Timeouts in End-to-End Negotiation</a>
        </h3>
<p id="section-12.1-1">Initially the initiator is in the CONNECT_BOOTSTRAP state. It
        migrates to the CONNECT_ AFFIRMING state after it received the
        legitimate ACK_INIT_CONNECT packet. Then it migrates to the
        PEER_COMMIT or CLOSABLE state after it received the legitimate
        ACK_CONNECT _REQ packet, depending on the hint of ULA.<a href="#section-12.1-1" class="pilcrow">¶</a></p>
<p id="section-12.1-2">The responder incarnates a new connection context which is
        initially in the CHALLENGING state after accepting a legitimate
        Connect Request packet. Then it migrates to the COMMITTING or CLOSABLE
        state, depending on the packet received from its peer.<a href="#section-12.1-2" class="pilcrow">¶</a></p>
<p id="section-12.1-3">If the initiator or the responder is unable to migrate to a new
        state in some limit time (by default 60 seconds, except in LISTENING
        state) it aborts the connection by recycling the connection
        context.<a href="#section-12.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-12.2">
<section id="section-12.2">
        <h3 id="name-timeouts-in-multiply">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-timeouts-in-multiply" class="section-name selfRef">Timeouts in Multiply</a>
        </h3>
<p id="section-12.2-1">Initially the initiating side of Connection Multiplication is in
        the CLONING state. It migrates to the ACTIVE, COMMITTED, PEER_COMMIT
        or CLOSABLE state after it received the legitimate PERSIST packet.
        Which state to migrated depends on the EoT flag of the initiating
        MULTIPLY packet and the responding PERSIST packet.<a href="#section-12.2-1" class="pilcrow">¶</a></p>
<p id="section-12.2-2">If the initiating side is unable to migrate to a new state in some
        limit time (by default 60 seconds) it aborts multiplication by
        recycling the new connection context.<a href="#section-12.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-12.3">
<section id="section-12.3">
        <h3 id="name-timeout-of-transmit-transac">
<a href="#section-12.3" class="section-number selfRef">12.3. </a><a href="#name-timeout-of-transmit-transac" class="section-name selfRef">Timeout of Transmit Transaction Commitment</a>
        </h3>
<p id="section-12.3-1">The FSP node MUST abort the connection if the time of no packet
        having arrived has exceed certain limit in the COMMITTING or
        COMMITTING2 state.<a href="#section-12.3-1" class="pilcrow">¶</a></p>
<p id="section-12.3-2">In this FSP version, timeout of transmit transaction commitment is
        set to 5 minutes.<a href="#section-12.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-12.4">
<section id="section-12.4">
        <h3 id="name-timeout-of-graceful-shutdow">
<a href="#section-12.4" class="section-number selfRef">12.4. </a><a href="#name-timeout-of-graceful-shutdow" class="section-name selfRef">Timeout of Graceful Shutdown</a>
        </h3>
<p id="section-12.4-1">It simply migrates to the NON_EXISTENT pseudo-state if timeout in
        the PRE_CLOSED state.<a href="#section-12.4-1" class="pilcrow">¶</a></p>
<p id="section-12.4-2">In this FSP version, timeout of Graceful Shutdown is set to 1
        minute.<a href="#section-12.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-12.5">
<section id="section-12.5">
        <h3 id="name-idle-timeout">
<a href="#section-12.5" class="section-number selfRef">12.5. </a><a href="#name-idle-timeout" class="section-name selfRef">Idle Timeout</a>
        </h3>
<p id="section-12.5-1">If one participant has not received any packet nor has it sent any
        packet in some limit time, it MUST be abruptly closed.<a href="#section-12.5-1" class="pilcrow">¶</a></p>
<p id="section-12.5-2">In this FSP version the time limit, or the idle timeout, is set to
        4 hours.<a href="#section-12.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-12.6">
<section id="section-12.6">
        <h3 id="name-session-key-timeout">
<a href="#section-12.6" class="section-number selfRef">12.6. </a><a href="#name-session-key-timeout" class="section-name selfRef">Session Key Timeout</a>
        </h3>
<p id="section-12.6-1">For this FSP version if a secret key is applied for more than 2^30
        times the FSP node MUST abruptly closed instantly.<a href="#section-12.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-12.7">
<section id="section-12.7">
        <h3 id="name-abrupt-close">
<a href="#section-12.7" class="section-number selfRef">12.7. </a><a href="#name-abrupt-close" class="section-name selfRef">Abrupt Close</a>
        </h3>
<p id="section-12.7-1">An FSP node abruptly shutdown a session by sending a RESET packet
        and release all of the resource occupied by the the session
        immediately.<a href="#section-12.7-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-12.7-2">
          <dt id="section-12.7-2.1"></dt>
          <dd style="margin-left: 1.0em" id="section-12.7-2.2">(RESET, Reason of Failure, SN, ExpectedSN, ICC)<a href="#section-12.7-2.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="sect-13">
<section id="section-13">
      <h2 id="name-issues-for-further-study">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-issues-for-further-study" class="section-name selfRef">Issues for Further Study</a>
      </h2>
<div id="sect-13.1">
<section id="section-13.1">
        <h3 id="name-resolution-of-ultid-in-dns">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-resolution-of-ultid-in-dns" class="section-name selfRef">Resolution of ULTID in DNS</a>
        </h3>
<p id="section-13.1-1">There are two patterns of IP address resolution in FSP: the DNS-
        compatible pattern and the proxy pattern. The former pattern relies on
        some name service to resolve the IP address of the responder for the
        initiator before they exchange end-to-end negotiation packets.<a href="#section-13.1-1" class="pilcrow">¶</a></p>
<p id="section-13.1-2">In the DNS-compatible pattern, the responder side of the FSP
        participants registered its address identifier, such as 'domain name'
        in some name service such as DNS <span>[<a href="#RFC1034" class="xref">RFC1034</a>]</span><span>[<a href="#RFC1035" class="xref">RFC1035</a>]</span>, according to some pre-agreement at first. The
        initiator resolves the current IP address of the responder by
        consulting the name service, such as looking after the A or AAAA
        record <span>[<a href="#RFC3596" class="xref">RFC3596</a>]</span> of the domain name in DNS.<a href="#section-13.1-2" class="pilcrow">¶</a></p>
<p id="section-13.1-3">If UDP over IPv4 is exploited as the under layer data packet
        delivery service the port number of the responder is firstly resolved
        just alike normal network application such as HTTP. Then it is
        extended to 32-bit ULTID, and ULTIDs of FSP can be considered as the
        superset of TCP port numbers.<a href="#section-13.1-3" class="pilcrow">¶</a></p>
<p id="section-13.1-4">If the string representation of IPv4/IPv6 address is applied
        directly as the peer's address identifier instead of the domain name
        there is no need for some real address resolution. But from the API
        caller's point of view it is a DNS-compatible mode address
        resolution.<a href="#section-13.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-13.2">
<section id="section-13.2">
        <h3 id="name-proxy-pattern-for-syndicate">
<a href="#section-13.2" class="section-number selfRef">13.2. </a><a href="#name-proxy-pattern-for-syndicate" class="section-name selfRef">Proxy Pattern for Syndicated Name Resolution</a>
        </h3>
<p id="section-13.2-1">The proxy pattern of IP address resolution in FSP is to embed the
        address resolution information in the connection initialization
        packets and is designed to work in FSP over IPv6 mode only.<a href="#section-13.2-1" class="pilcrow">¶</a></p>
<p id="section-13.2-2">In IPv6 network the rightmost 32 bits of the IPv6 address directly
        maps to the ULTID so FSP does not need additional multiplexing
        mechanism such as port number. And it needs not consult SRV record or
        look for some entry in some 'services' file.<a href="#section-13.2-2" class="pilcrow">¶</a></p>
<p id="section-13.2-3">If the INIT_CONNECT packet carries the responder's host name it
        MUST take the link-local interface address as the source IPv6 address
        and the default link-local gateway address, FE80::1, as the
        destination IPv6 address no matter whether the global unicast IP
        address of the default gateway is configured. In such scenario the
        link-local gateway MUST be able to resolute the responder's host name
        to its global unicast IPv6 address, and the gateway MUST be able to
        map the initiator's link local address to its global unicast IPv6
        address.<a href="#section-13.2-3" class="pilcrow">¶</a></p>
<p id="section-13.2-4">If the gateway that relays the INIT_CONNECT packet finds that the
        responder is on the same link-local network with the initiator it
        SHALL change the source and the destination IP addresses of the
        INIT_CONNECT packet to the link-local IP addresses of the initiator
        and the responder respectively, and relay the packet onto the same
        link-local network.<a href="#section-13.2-4" class="pilcrow">¶</a></p>
<p id="section-13.2-5">On receiving the INIT_CONNECT packet that carries the responder's
        host name the link-local gateway MUST resolute the responder's global
        unicast IPv6 address and map the initiator's global unicast IPv6
        address, and replace the destination and source address of the
        INIT_CONNECT packet respectively, unless it finds that the initiator
        and the responder are on the same link-local network, where the
        gateway SHALL process the packet as stated in the previous
        statement.<a href="#section-13.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-13.3">
<section id="section-13.3">
        <h3 id="name-asymmetric-transmission">
<a href="#section-13.3" class="section-number selfRef">13.3. </a><a href="#name-asymmetric-transmission" class="section-name selfRef">Asymmetric Transmission</a>
        </h3>
<p id="section-13.3-1">If there is one participant whose receive interface is not the same
        as the send interface the participant is called an asymmetric-
        transmission node.<a href="#section-13.3-1" class="pilcrow">¶</a></p>
<p id="section-13.3-2">Asymmetric transmission itself is asymmetric in the sense that one
        participant may be asymmetric-transmission node while its peer is a
        normal node that the send interface is the same receive interface.<a href="#section-13.3-2" class="pilcrow">¶</a></p>
<p id="section-13.3-3">An end node is asymmetric-transmission if it received an
        ACK_CONNECT_REQ packet, NULCOMMIT or PERSIST packet whose source IP
        address that the network interface accepting the packets reported is
        not in the allowed IP address list in the Sink Parameter header of the
        packet.<a href="#section-13.3-3" class="pilcrow">¶</a></p>
<p id="section-13.3-4">For an asymmetric-transmission remote end, the near end cannot rely
        on automatic IP address change detection. Instead IP address change
        notification mechanism shall be utilized.<a href="#section-13.3-4" class="pilcrow">¶</a></p>
<p id="section-13.3-5">However for this version of FSP asymmetric transmission support is
        optional.<a href="#section-13.3-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-14">
<section id="section-14">
      <h2 id="name-security-considerations">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="sect-14.1">
<section id="section-14.1">
        <h3 id="name-deny-of-service-attack">
<a href="#section-14.1" class="section-number selfRef">14.1. </a><a href="#name-deny-of-service-attack" class="section-name selfRef">Deny of Service Attack</a>
        </h3>
<p id="section-14.1-1">FSP is designed to mitigate effect of DoS attack by exploiting
        Cookie.<a href="#section-14.1-1" class="pilcrow">¶</a></p>
<p id="section-14.1-2">However, resistance against distributed DoS attack relies on
        external mechanism.<a href="#section-14.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-14.2">
<section id="section-14.2">
        <h3 id="name-replay-attack">
<a href="#section-14.2" class="section-number selfRef">14.2. </a><a href="#name-replay-attack" class="section-name selfRef">Replay Attack</a>
        </h3>
<p id="section-14.2-1">In-band sequence number and out-of-band sequence number are
        exploited to resist against replay attack.<a href="#section-14.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-14.3">
<section id="section-14.3">
        <h3 id="name-passive-attacks">
<a href="#section-14.3" class="section-number selfRef">14.3. </a><a href="#name-passive-attacks" class="section-name selfRef">Passive Attacks</a>
        </h3>
<p id="section-14.3-1">AEAD MAY be exploited by the ULA to protect it against passive
        attacks such as eavesdropping, gaining advantage by analyzing the data
        sent.<a href="#section-14.3-1" class="pilcrow">¶</a></p>
<p id="section-14.3-2">MAC only service MAY also be utilized. Together with application
        layer stream-mode encryption it protects the ULA against passive
        attacks as well.<a href="#section-14.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-14.4">
<section id="section-14.4">
        <h3 id="name-masquerade-attack">
<a href="#section-14.4" class="section-number selfRef">14.4. </a><a href="#name-masquerade-attack" class="section-name selfRef">Masquerade Attack</a>
        </h3>
<p id="section-14.4-1">Both AEAD and MAC only service may be exploited to protect the
        endpoints against masquerade attack.<a href="#section-14.4-1" class="pilcrow">¶</a></p>
<p id="section-14.4-2">If proxy pattern for syndicated name resolution is exploited for
        FSP over IPv6, secure neighbor discovery <span>[<a href="#RFC3971" class="xref">RFC3971</a>]</span>
        SHOULD be applied instead of common neighbor discovery whenever it is
        feasible.<a href="#section-14.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-14.5">
<section id="section-14.5">
        <h3 id="name-active-man-in-the-middle-at">
<a href="#section-14.5" class="section-number selfRef">14.5. </a><a href="#name-active-man-in-the-middle-at" class="section-name selfRef">Active Man-In-The-Middle Attack</a>
        </h3>
<p id="section-14.5-1">The ULA SHALL take account to protect itself against MITM attack
        when making client authentication and key establishment.<a href="#section-14.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-14.6">
<section id="section-14.6">
        <h3 id="name-privacy-concerns">
<a href="#section-14.6" class="section-number selfRef">14.6. </a><a href="#name-privacy-concerns" class="section-name selfRef">Privacy Concerns</a>
        </h3>
<p id="section-14.6-1">It is beneficial for privacy protection that the ULTID of each
        endpoints of an FSP connection is generated randomly <span>[<a href="#RFC7721" class="xref">RFC7721</a>]</span>.<a href="#section-14.6-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-15">
<section id="section-15">
      <h2 id="name-iana-considerations">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-15-1">It should be requested that the port number registered for UDP
      packets encapsulating FSP in the IPv4 network. The port number 18003 is
      exploited in the concept prototype implementation. The number is the
      decimal presentation of ASCII codes of the character 'F' ('x46') and 'S'
      ('x53') concatenated in network byte order.<a href="#section-15-1" class="pilcrow">¶</a></p>
<p id="section-15-2">It should be requested that the 'Next Header'/protocol number is
      assigned for FSP over IPv6. Decimal number 144 is exploited in the
      concept prototype implementation.<a href="#section-15-2" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-16">
      <h2 id="name-references">
<a href="#section-16" class="section-number selfRef">16. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-16.1">
        <h3 id="name-normative-references">
<a href="#section-16.1" class="section-number selfRef">16.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="AES">[AES]</dt>
        <dd>
<span class="refAuthor">NIST</span>, <span class="refTitle">"Advanced Encryption Standard (AES)"</span>, <time datetime="2001-11" class="refDate">November 2001</time>. </dd>
<dd class="break"></dd>
<dt id="CRC64">[CRC64]</dt>
        <dd>
<span class="refAuthor">ECMA</span>, <span class="refTitle">"Data Interchange on 12.7 mm 48-Track Magnetic Tape Cartridges - DLT1 Format Standard, Annex B"</span>, <time datetime="1992-12" class="refDate">December 1992</time>. </dd>
<dd class="break"></dd>
<dt id="GCM">[GCM]</dt>
        <dd>
<span class="refAuthor">NIST</span>, <span class="refTitle">"Recommendation for Block Cipher Modes of Operation: Galois/Counter Mode (GCM) and GMAC"</span>, <time datetime="2007-11" class="refDate">November 2007</time>. </dd>
<dd class="break"></dd>
<dt id="LZ4">[LZ4]</dt>
        <dd>
<span class="refTitle">"LZ4: Extremely Fast Compression algorithm"</span>, <span>&lt;<a href="https://lz4.github.io/lz4/">https://lz4.github.io/lz4/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OSI_RM">[OSI_RM]</dt>
        <dd>
<span class="refAuthor">ISO and IEC</span>, <span class="refTitle">"Information technology-Open Systems Interconnection - Basic Reference Model: The Basic Model"</span>, <time datetime="1994-11" class="refDate">November 1994</time>. </dd>
<dd class="break"></dd>
<dt id="R01">[R01]</dt>
        <dd>
<span class="refAuthor">Rogaway, P.</span>, <span class="refTitle">"Authenticated encryption with Associated Data"</span>, <time datetime="2002" class="refDate">2002</time>. </dd>
<dd class="break"></dd>
<dt id="RFC1122">[RFC1122]</dt>
        <dd>
<span class="refAuthor">Braden, R., Ed.</span>, <span class="refTitle">"Requirements for Internet Hosts - Communication Layers"</span>, <span class="seriesInfo">STD 3</span>, <span class="seriesInfo">RFC 1122</span>, <span class="seriesInfo">DOI 10.17487/RFC1122</span>, <time datetime="1989-10" class="refDate">October 1989</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1122">https://www.rfc-editor.org/info/rfc1122</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2526">[RFC2526]</dt>
        <dd>
<span class="refAuthor">Johnson, D.</span> and <span class="refAuthor">S. Deering</span>, <span class="refTitle">"Reserved IPv6 Subnet Anycast Addresses"</span>, <span class="seriesInfo">RFC 2526</span>, <span class="seriesInfo">DOI 10.17487/RFC2526</span>, <time datetime="1999-03" class="refDate">March 1999</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2526">https://www.rfc-editor.org/info/rfc2526</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3124">[RFC3124]</dt>
        <dd>
<span class="refAuthor">Balakrishnan, H.</span> and <span class="refAuthor">S. Seshan</span>, <span class="refTitle">"The Congestion Manager"</span>, <span class="seriesInfo">RFC 3124</span>, <span class="seriesInfo">DOI 10.17487/RFC3124</span>, <time datetime="2001-06" class="refDate">June 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3124">https://www.rfc-editor.org/info/rfc3124</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3168">[RFC3168]</dt>
        <dd>
<span class="refAuthor">Ramakrishnan, K.</span>, <span class="refAuthor">Floyd, S.</span>, and <span class="refAuthor">D. Black</span>, <span class="refTitle">"The Addition of Explicit Congestion Notification (ECN) to IP"</span>, <span class="seriesInfo">RFC 3168</span>, <span class="seriesInfo">DOI 10.17487/RFC3168</span>, <time datetime="2001-09" class="refDate">September 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3168">https://www.rfc-editor.org/info/rfc3168</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3629">[RFC3629]</dt>
        <dd>
<span class="refAuthor">Yergeau, F.</span>, <span class="refTitle">"UTF-8, a transformation format of ISO 10646"</span>, <span class="seriesInfo">STD 63</span>, <span class="seriesInfo">RFC 3629</span>, <span class="seriesInfo">DOI 10.17487/RFC3629</span>, <time datetime="2003-11" class="refDate">November 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3629">https://www.rfc-editor.org/info/rfc3629</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4291">[RFC4291]</dt>
        <dd>
<span class="refAuthor">Hinden, R.</span> and <span class="refAuthor">S. Deering</span>, <span class="refTitle">"IP Version 6 Addressing Architecture"</span>, <span class="seriesInfo">RFC 4291</span>, <span class="seriesInfo">DOI 10.17487/RFC4291</span>, <time datetime="2006-02" class="refDate">February 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4291">https://www.rfc-editor.org/info/rfc4291</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span> and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5869">https://www.rfc-editor.org/info/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6887">[RFC6887]</dt>
        <dd>
<span class="refAuthor">Wing, D., Ed.</span>, <span class="refAuthor">Cheshire, S.</span>, <span class="refAuthor">Boucadair, M.</span>, <span class="refAuthor">Penno, R.</span>, and <span class="refAuthor">P. Selkirk</span>, <span class="refTitle">"Port Control Protocol (PCP)"</span>, <span class="seriesInfo">RFC 6887</span>, <span class="seriesInfo">DOI 10.17487/RFC6887</span>, <time datetime="2013-04" class="refDate">April 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6887">https://www.rfc-editor.org/info/rfc6887</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7693">[RFC7693]</dt>
        <dd>
<span class="refAuthor">Saarinen, M-J., Ed.</span> and <span class="refAuthor">J-P. Aumasson</span>, <span class="refTitle">"The BLAKE2 Cryptographic Hash and Message Authentication Code (MAC)"</span>, <span class="seriesInfo">RFC 7693</span>, <span class="seriesInfo">DOI 10.17487/RFC7693</span>, <time datetime="2015-11" class="refDate">November 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7693">https://www.rfc-editor.org/info/rfc7693</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8085">[RFC8085]</dt>
        <dd>
<span class="refAuthor">Eggert, L.</span>, <span class="refAuthor">Fairhurst, G.</span>, and <span class="refAuthor">G. Shepherd</span>, <span class="refTitle">"UDP Usage Guidelines"</span>, <span class="seriesInfo">BCP 145</span>, <span class="seriesInfo">RFC 8085</span>, <span class="seriesInfo">DOI 10.17487/RFC8085</span>, <time datetime="2017-03" class="refDate">March 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8085">https://www.rfc-editor.org/info/rfc8085</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8200">[RFC8200]</dt>
        <dd>
<span class="refAuthor">Deering, S.</span> and <span class="refAuthor">R. Hinden</span>, <span class="refTitle">"Internet Protocol, Version 6 (IPv6) Specification"</span>, <span class="seriesInfo">STD 86</span>, <span class="seriesInfo">RFC 8200</span>, <span class="seriesInfo">DOI 10.17487/RFC8200</span>, <time datetime="2017-07" class="refDate">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8200">https://www.rfc-editor.org/info/rfc8200</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8273">[RFC8273]</dt>
        <dd>
<span class="refAuthor">Brzozowski, J.</span> and <span class="refAuthor">G. Van de Velde</span>, <span class="refTitle">"Unique IPv6 Prefix per Host"</span>, <span class="seriesInfo">RFC 8273</span>, <span class="seriesInfo">DOI 10.17487/RFC8273</span>, <time datetime="2017-12" class="refDate">December 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8273">https://www.rfc-editor.org/info/rfc8273</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="STD5">[STD5]</dt>
        <dd>
<span class="refAuthor">Postel, J.</span>, <span class="refTitle">"Internet Protocol"</span>, <span class="seriesInfo">STD 5</span>, <span class="seriesInfo">RFC 791</span>, <time datetime="1981-09" class="refDate">September 1981</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc791">https://www.rfc-editor.org/rfc/rfc791</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="STD6">[STD6]</dt>
        <dd>
<span class="refAuthor">Postel, J.</span>, <span class="refTitle">"User Datagram Protocol"</span>, <span class="seriesInfo">STD 6</span>, <span class="seriesInfo">RFC 768</span>, <time datetime="1980-08" class="refDate">August 1980</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc768">https://www.rfc-editor.org/rfc/rfc768</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="STD7">[STD7]</dt>
      <dd>
<span class="refAuthor">Postel, J.</span>, <span class="refTitle">"Transmission Control Protocol"</span>, <span class="seriesInfo">STD 7</span>, <span class="seriesInfo">RFC 793</span>, <time datetime="1981-09" class="refDate">September 1981</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc793">https://www.rfc-editor.org/rfc/rfc793</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-16.2">
        <h3 id="name-informative-references">
<a href="#section-16.2" class="section-number selfRef">16.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="Gao2002">[Gao2002]</dt>
        <dd>
<span class="refAuthor">Gao, J.</span>, <span class="refTitle">"Fuzzy-layering and its suggestion"</span>, <span class="seriesInfo">IETF Mail Archive</span>, <time datetime="2002-09" class="refDate">September 2002</time>, <span>&lt;<a href="https://mailarchive.ietf.org/arch/msg/ietf/u-6i-6f-Etuvh80-SUuRbSCDTwg">https://mailarchive.ietf.org/arch/msg/ietf/u-6i-6f-Etuvh80-SUuRbSCDTwg</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC1034">[RFC1034]</dt>
        <dd>
<span class="refAuthor">Mockapetris, P.</span>, <span class="refTitle">"Domain names - concepts and facilities"</span>, <span class="seriesInfo">STD 13</span>, <span class="seriesInfo">RFC 1034</span>, <span class="seriesInfo">DOI 10.17487/RFC1034</span>, <time datetime="1987-11" class="refDate">November 1987</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1034">https://www.rfc-editor.org/info/rfc1034</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC1035">[RFC1035]</dt>
        <dd>
<span class="refAuthor">Mockapetris, P.</span>, <span class="refTitle">"Domain names - implementation and specification"</span>, <span class="seriesInfo">STD 13</span>, <span class="seriesInfo">RFC 1035</span>, <span class="seriesInfo">DOI 10.17487/RFC1035</span>, <time datetime="1987-11" class="refDate">November 1987</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1035">https://www.rfc-editor.org/info/rfc1035</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3022">[RFC3022]</dt>
        <dd>
<span class="refAuthor">Srisuresh, P.</span> and <span class="refAuthor">K. Egevang</span>, <span class="refTitle">"Traditional IP Network Address Translator (Traditional NAT)"</span>, <span class="seriesInfo">RFC 3022</span>, <span class="seriesInfo">DOI 10.17487/RFC3022</span>, <time datetime="2001-01" class="refDate">January 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3022">https://www.rfc-editor.org/info/rfc3022</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3596">[RFC3596]</dt>
        <dd>
<span class="refAuthor">Thomson, S.</span>, <span class="refAuthor">Huitema, C.</span>, <span class="refAuthor">Ksinant, V.</span>, and <span class="refAuthor">M. Souissi</span>, <span class="refTitle">"DNS Extensions to Support IP Version 6"</span>, <span class="seriesInfo">STD 88</span>, <span class="seriesInfo">RFC 3596</span>, <span class="seriesInfo">DOI 10.17487/RFC3596</span>, <time datetime="2003-10" class="refDate">October 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3596">https://www.rfc-editor.org/info/rfc3596</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3971">[RFC3971]</dt>
        <dd>
<span class="refAuthor">Arkko, J., Ed.</span>, <span class="refAuthor">Kempf, J.</span>, <span class="refAuthor">Zill, B.</span>, and <span class="refAuthor">P. Nikander</span>, <span class="refTitle">"SEcure Neighbor Discovery (SEND)"</span>, <span class="seriesInfo">RFC 3971</span>, <span class="seriesInfo">DOI 10.17487/RFC3971</span>, <time datetime="2005-03" class="refDate">March 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3971">https://www.rfc-editor.org/info/rfc3971</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4086">[RFC4086]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span>, <span class="refAuthor">Schiller, J.</span>, and <span class="refAuthor">S. Crocker</span>, <span class="refTitle">"Randomness Requirements for Security"</span>, <span class="seriesInfo">BCP 106</span>, <span class="seriesInfo">RFC 4086</span>, <span class="seriesInfo">DOI 10.17487/RFC4086</span>, <time datetime="2005-06" class="refDate">June 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4086">https://www.rfc-editor.org/info/rfc4086</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4555">[RFC4555]</dt>
        <dd>
<span class="refAuthor">Eronen, P.</span>, <span class="refTitle">"IKEv2 Mobility and Multihoming Protocol (MOBIKE)"</span>, <span class="seriesInfo">RFC 4555</span>, <span class="seriesInfo">DOI 10.17487/RFC4555</span>, <time datetime="2006-06" class="refDate">June 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4555">https://www.rfc-editor.org/info/rfc4555</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4861">[RFC4861]</dt>
        <dd>
<span class="refAuthor">Narten, T.</span>, <span class="refAuthor">Nordmark, E.</span>, <span class="refAuthor">Simpson, W.</span>, and <span class="refAuthor">H. Soliman</span>, <span class="refTitle">"Neighbor Discovery for IP version 6 (IPv6)"</span>, <span class="seriesInfo">RFC 4861</span>, <span class="seriesInfo">DOI 10.17487/RFC4861</span>, <time datetime="2007-09" class="refDate">September 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4861">https://www.rfc-editor.org/info/rfc4861</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4862">[RFC4862]</dt>
        <dd>
<span class="refAuthor">Thomson, S.</span>, <span class="refAuthor">Narten, T.</span>, and <span class="refAuthor">T. Jinmei</span>, <span class="refTitle">"IPv6 Stateless Address Autoconfiguration"</span>, <span class="seriesInfo">RFC 4862</span>, <span class="seriesInfo">DOI 10.17487/RFC4862</span>, <time datetime="2007-09" class="refDate">September 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4862">https://www.rfc-editor.org/info/rfc4862</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5942">[RFC5942]</dt>
        <dd>
<span class="refAuthor">Singh, H.</span>, <span class="refAuthor">Beebee, W.</span>, and <span class="refAuthor">E. Nordmark</span>, <span class="refTitle">"IPv6 Subnet Model: The Relationship between Links and Subnet Prefixes"</span>, <span class="seriesInfo">RFC 5942</span>, <span class="seriesInfo">DOI 10.17487/RFC5942</span>, <time datetime="2010-07" class="refDate">July 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5942">https://www.rfc-editor.org/info/rfc5942</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6177">[RFC6177]</dt>
        <dd>
<span class="refAuthor">Narten, T.</span>, <span class="refAuthor">Huston, G.</span>, and <span class="refAuthor">L. Roberts</span>, <span class="refTitle">"IPv6 Address Assignment to End Sites"</span>, <span class="seriesInfo">BCP 157</span>, <span class="seriesInfo">RFC 6177</span>, <span class="seriesInfo">DOI 10.17487/RFC6177</span>, <time datetime="2011-03" class="refDate">March 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6177">https://www.rfc-editor.org/info/rfc6177</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6298">[RFC6298]</dt>
        <dd>
<span class="refAuthor">Paxson, V.</span>, <span class="refAuthor">Allman, M.</span>, <span class="refAuthor">Chu, J.</span>, and <span class="refAuthor">M. Sargent</span>, <span class="refTitle">"Computing TCP's Retransmission Timer"</span>, <span class="seriesInfo">RFC 6298</span>, <span class="seriesInfo">DOI 10.17487/RFC6298</span>, <time datetime="2011-06" class="refDate">June 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6298">https://www.rfc-editor.org/info/rfc6298</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7050">[RFC7050]</dt>
        <dd>
<span class="refAuthor">Savolainen, T.</span>, <span class="refAuthor">Korhonen, J.</span>, and <span class="refAuthor">D. Wing</span>, <span class="refTitle">"Discovery of the IPv6 Prefix Used for IPv6 Address Synthesis"</span>, <span class="seriesInfo">RFC 7050</span>, <span class="seriesInfo">DOI 10.17487/RFC7050</span>, <time datetime="2013-11" class="refDate">November 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7050">https://www.rfc-editor.org/info/rfc7050</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7721">[RFC7721]</dt>
        <dd>
<span class="refAuthor">Cooper, A.</span>, <span class="refAuthor">Gont, F.</span>, and <span class="refAuthor">D. Thaler</span>, <span class="refTitle">"Security and Privacy Considerations for IPv6 Address Generation Mechanisms"</span>, <span class="seriesInfo">RFC 7721</span>, <span class="seriesInfo">DOI 10.17487/RFC7721</span>, <time datetime="2016-03" class="refDate">March 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7721">https://www.rfc-editor.org/info/rfc7721</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8415">[RFC8415]</dt>
        <dd>
<span class="refAuthor">Mrugalski, T.</span>, <span class="refAuthor">Siodelski, M.</span>, <span class="refAuthor">Volz, B.</span>, <span class="refAuthor">Yourtchenko, A.</span>, <span class="refAuthor">Richardson, M.</span>, <span class="refAuthor">Jiang, S.</span>, <span class="refAuthor">Lemon, T.</span>, and <span class="refAuthor">T. Winters</span>, <span class="refTitle">"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"</span>, <span class="seriesInfo">RFC 8415</span>, <span class="seriesInfo">DOI 10.17487/RFC8415</span>, <time datetime="2018-11" class="refDate">November 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8415">https://www.rfc-editor.org/info/rfc8415</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8504">[RFC8504]</dt>
      <dd>
<span class="refAuthor">Chown, T.</span>, <span class="refAuthor">Loughney, J.</span>, and <span class="refAuthor">T. Winters</span>, <span class="refTitle">"IPv6 Node Requirements"</span>, <span class="seriesInfo">BCP 220</span>, <span class="seriesInfo">RFC 8504</span>, <span class="seriesInfo">DOI 10.17487/RFC8504</span>, <time datetime="2019-01" class="refDate">January 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8504">https://www.rfc-editor.org/info/rfc8504</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="sect-a">
<section id="appendix-A">
      <h2 id="name-acknowledgements">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
    </h2>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jun-an Gao</span></div>
<div dir="auto" class="left"><span class="org">Beijing Capital Highway Development Group Co.,Ltd.</span></div>
<div dir="auto" class="left"><span class="street-address">Shoufa Plaza-A, Liuliqiao South, Fengtai<br>Beijing<br>People's Republic of China</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jagao@outlook.com" class="email">jagao@outlook.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
