<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>BGP MPLS-Based Ethernet VPN</title>
<meta content="Ali Sajassi" name="author">
<meta content="Luc Andre Burdet" name="author">
<meta content="John Drake" name="author">
<meta content="Jorge Rabadan" name="author">
<meta content='
       This document describes procedures for BGP MPLS-based Ethernet VPNs
(EVPN). The procedures described here meet the requirements
specified in RFC 7209 -- "Requirements for Ethernet VPN (EVPN)". 
    ' name="description">
<meta content="xml2rfc 3.10.0" name="generator">
<meta content="RFC7432" name="keyword">
<meta content="EVPN" name="keyword">
<meta content="draft-ietf-bess-rfc7432bis-02" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.10.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.4.0
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 58.2.0
    six 1.16.0
-->
<link href="/tmp/draft-ietf-bess-rfc7432bis-02-dd21n2vw.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">BGP MPLS-Based Ethernet VPN</td>
<td class="right">October 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Sajassi, et al.</td>
<td class="center">Expires 28 April 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">BESS Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-bess-rfc7432bis-02</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-10-25" class="published">25 October 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-04-28">28 April 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">A.S. Sajassi</div>
<div class="org">Cisco</div>
</div>
<div class="author">
      <div class="author-name">LA.B. Burdet, <span class="editor">Ed.</span>
</div>
<div class="org">Cisco</div>
</div>
<div class="author">
      <div class="author-name">J.E.D. Drake</div>
<div class="org">Juniper</div>
</div>
<div class="author">
      <div class="author-name">J.R. Rabadan</div>
<div class="org">Nokia</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">BGP MPLS-Based Ethernet VPN</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes procedures for BGP MPLS-based Ethernet VPNs
(EVPN). The procedures described here meet the requirements
specified in RFC 7209 -- "Requirements for Ethernet VPN (EVPN)".<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note" id="section-note.1">
      <h2 id="name-note-to-readers">
<a href="#name-note-to-readers" class="section-name selfRef">Note to Readers</a>
      </h2>
<p id="section-note.1-1"><em>RFC EDITOR: please remove this section before publication</em><a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">The complete and detailed set of all changes between this version and RFC7432 may be found
    <a href="https://tools.ietf.org/rfcdiff?url1=https://www.rfc-editor.org/rfc/rfc7432.txt&amp;url2=https://www.ietf.org/archive/id/draft-ietf-bess-rfc7432bis-02.txt">as an Annotated Diff (rfcdiff) here</a>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 28 April 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-summary-of-changes-from-rfc" class="xref">Summary of changes from RFC 7432</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-specification-of-requiremen" class="xref">Specification of Requirements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-bgp-mpls-based-evpn-overvie" class="xref">BGP MPLS-Based EVPN Overview</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-ethernet-segment" class="xref">Ethernet Segment</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-ethernet-tag-id" class="xref">Ethernet Tag ID</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-vlan-based-service-interfac" class="xref">VLAN-Based Service Interface</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-vlan-bundle-service-interfa" class="xref">VLAN Bundle Service Interface</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="xref">6.2.1</a>.  <a href="#name-port-based-service-interfac" class="xref">Port-Based Service Interface</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-vlan-aware-bundle-service-i" class="xref">VLAN-Aware Bundle Service Interface</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.1">
                    <p id="section-toc.1-1.6.2.3.2.1.1"><a href="#section-6.3.1" class="xref">6.3.1</a>.  <a href="#name-port-based-vlan-aware-servi" class="xref">Port-Based VLAN-Aware Service Interface</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-evpn-pe-model" class="xref">EVPN PE Model</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-bgp-evpn-routes" class="xref">BGP EVPN Routes</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-ethernet-auto-discovery-rou" class="xref">Ethernet Auto-discovery Route</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-mac-ip-advertisement-route" class="xref">MAC/IP Advertisement Route</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-inclusive-multicast-etherne" class="xref">Inclusive Multicast Ethernet Tag Route</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="xref">7.4</a>.  <a href="#name-ethernet-segment-route" class="xref">Ethernet Segment Route</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a href="#section-7.5" class="xref">7.5</a>.  <a href="#name-esi-label-extended-communit" class="xref">ESI Label Extended Community</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.6">
                <p id="section-toc.1-1.7.2.6.1"><a href="#section-7.6" class="xref">7.6</a>.  <a href="#name-es-import-route-target" class="xref">ES-Import Route Target</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.7">
                <p id="section-toc.1-1.7.2.7.1"><a href="#section-7.7" class="xref">7.7</a>.  <a href="#name-mac-mobility-extended-commu" class="xref">MAC Mobility Extended Community</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.8">
                <p id="section-toc.1-1.7.2.8.1"><a href="#section-7.8" class="xref">7.8</a>.  <a href="#name-default-gateway-extended-co" class="xref">Default Gateway Extended Community</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.9">
                <p id="section-toc.1-1.7.2.9.1"><a href="#section-7.9" class="xref">7.9</a>.  <a href="#name-route-distinguisher-assignm" class="xref">Route Distinguisher Assignment per MAC-VRF</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.10">
                <p id="section-toc.1-1.7.2.10.1"><a href="#section-7.10" class="xref">7.10</a>. <a href="#name-route-targets" class="xref">Route Targets</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.10.2.1">
                    <p id="section-toc.1-1.7.2.10.2.1.1"><a href="#section-7.10.1" class="xref">7.10.1</a>.  <a href="#name-auto-derivation-from-the-et" class="xref">Auto-derivation from the Ethernet Tag (VLAN ID)</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.11">
                <p id="section-toc.1-1.7.2.11.1"><a href="#section-7.11" class="xref">7.11</a>. <a href="#name-evpn-layer-2-attributes-ext" class="xref">EVPN Layer 2 Attributes Extended Community</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.11.2.1">
                    <p id="section-toc.1-1.7.2.11.2.1.1"><a href="#section-7.11.1" class="xref">7.11.1</a>.  <a href="#name-evpn-layer-2-attributes-par" class="xref">EVPN Layer 2 Attributes Partitioning</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.12">
                <p id="section-toc.1-1.7.2.12.1"><a href="#section-7.12" class="xref">7.12</a>. <a href="#name-route-prioritization" class="xref">Route Prioritization</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-multihoming-functions" class="xref">Multihoming Functions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-multihomed-ethernet-segment" class="xref">Multihomed Ethernet Segment Auto-discovery</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.1">
                    <p id="section-toc.1-1.8.2.1.2.1.1"><a href="#section-8.1.1" class="xref">8.1.1</a>.  <a href="#name-constructing-the-ethernet-s" class="xref">Constructing the Ethernet Segment Route</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-fast-convergence" class="xref">Fast Convergence</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.1">
                    <p id="section-toc.1-1.8.2.2.2.1.1"><a href="#section-8.2.1" class="xref">8.2.1</a>.  <a href="#name-constructing-ethernet-a-d-p" class="xref">Constructing Ethernet A-D per Ethernet Segment Route</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.1.2.1">
                        <p id="section-toc.1-1.8.2.2.2.1.2.1.1"><a href="#section-8.2.1.1" class="xref">8.2.1.1</a>.  <a href="#name-ethernet-a-d-route-targets" class="xref">Ethernet A-D Route Targets</a></p>
</li>
                    </ul>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.  <a href="#name-split-horizon" class="xref">Split Horizon</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3.2.1">
                    <p id="section-toc.1-1.8.2.3.2.1.1"><a href="#section-8.3.1" class="xref">8.3.1</a>.  <a href="#name-esi-label-assignment" class="xref">ESI Label Assignment</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3.2.1.2.1">
                        <p id="section-toc.1-1.8.2.3.2.1.2.1.1"><a href="#section-8.3.1.1" class="xref">8.3.1.1</a>.  <a href="#name-ingress-replication" class="xref">Ingress Replication</a></p>
</li>
                      <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3.2.1.2.2">
                        <p id="section-toc.1-1.8.2.3.2.1.2.2.1"><a href="#section-8.3.1.2" class="xref">8.3.1.2</a>.  <a href="#name-p2mp-mpls-lsps" class="xref">P2MP MPLS LSPs</a></p>
</li>
                      <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3.2.1.2.3">
                        <p id="section-toc.1-1.8.2.3.2.1.2.3.1"><a href="#section-8.3.1.3" class="xref">8.3.1.3</a>.  <a href="#name-mp2mp-mpls-lsps" class="xref">MP2MP MPLS LSPs</a></p>
</li>
                    </ul>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="xref">8.4</a>.  <a href="#name-aliasing-and-backup-path" class="xref">Aliasing and Backup Path</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4.2.1">
                    <p id="section-toc.1-1.8.2.4.2.1.1"><a href="#section-8.4.1" class="xref">8.4.1</a>.  <a href="#name-constructing-ethernet-a-d-pe" class="xref">Constructing Ethernet A-D per EVPN Instance Route</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="xref">8.5</a>.  <a href="#name-designated-forwarder-electi" class="xref">Designated Forwarder Election</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.6">
                <p id="section-toc.1-1.8.2.6.1"><a href="#section-8.6" class="xref">8.6</a>.  <a href="#name-signaling-primary-and-backu" class="xref">Signaling Primary and Backup DF Elected PEs</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.7">
                <p id="section-toc.1-1.8.2.7.1"><a href="#section-8.7" class="xref">8.7</a>.  <a href="#name-interoperability-with-singl" class="xref">Interoperability with Single-Homing PEs</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-determining-reachability-to" class="xref">Determining Reachability to Unicast MAC Addresses</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-local-learning" class="xref">Local Learning</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-remote-learning" class="xref">Remote Learning</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2.2.1">
                    <p id="section-toc.1-1.9.2.2.2.1.1"><a href="#section-9.2.1" class="xref">9.2.1</a>.  <a href="#name-constructing-mac-ip-address" class="xref">Constructing MAC/IP Address Advertisement</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2.2.2">
                    <p id="section-toc.1-1.9.2.2.2.2.1"><a href="#section-9.2.2" class="xref">9.2.2</a>.  <a href="#name-route-resolution" class="xref">Route Resolution</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-arp-and-nd" class="xref">ARP and ND</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-default-gateway" class="xref">Default Gateway</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1.2.1">
                    <p id="section-toc.1-1.10.2.1.2.1.1"><a href="#section-10.1.1" class="xref">10.1.1</a>.  <a href="#name-best-path-selection-for-def" class="xref">Best Path selection for Default Gateway</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-handling-of-multi-destinati" class="xref">Handling of Multi-destination Traffic</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.  <a href="#name-constructing-inclusive-mult" class="xref">Constructing Inclusive Multicast Ethernet Tag Route</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.  <a href="#name-p-tunnel-identification" class="xref">P-Tunnel Identification</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-processing-of-unknown-unica" class="xref">Processing of Unknown Unicast Packets</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="xref">12.1</a>.  <a href="#name-ingress-replication-2" class="xref">Ingress Replication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="xref">12.2</a>.  <a href="#name-p2mp-mpls-lsps-2" class="xref">P2MP MPLS LSPs</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="xref">13</a>. <a href="#name-forwarding-unicast-packets" class="xref">Forwarding Unicast Packets</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="xref">13.1</a>.  <a href="#name-forwarding-packets-received" class="xref">Forwarding Packets Received from a CE</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-13.2" class="xref">13.2</a>.  <a href="#name-forwarding-packets-received-" class="xref">Forwarding Packets Received from a Remote PE</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2.2.1">
                    <p id="section-toc.1-1.13.2.2.2.1.1"><a href="#section-13.2.1" class="xref">13.2.1</a>.  <a href="#name-unknown-unicast-forwarding" class="xref">Unknown Unicast Forwarding</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2.2.2">
                    <p id="section-toc.1-1.13.2.2.2.2.1"><a href="#section-13.2.2" class="xref">13.2.2</a>.  <a href="#name-known-unicast-forwarding" class="xref">Known Unicast Forwarding</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="xref">14</a>. <a href="#name-load-balancing-of-unicast-p" class="xref">Load Balancing of Unicast Packets</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#section-14.1" class="xref">14.1</a>.  <a href="#name-load-balancing-of-traffic-f" class="xref">Load Balancing of Traffic from a PE to Remote CEs</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1.2.1">
                    <p id="section-toc.1-1.14.2.1.2.1.1"><a href="#section-14.1.1" class="xref">14.1.1</a>.  <a href="#name-single-active-redundancy-mo" class="xref">Single-Active Redundancy Mode</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1.2.2">
                    <p id="section-toc.1-1.14.2.1.2.2.1"><a href="#section-14.1.2" class="xref">14.1.2</a>.  <a href="#name-all-active-redundancy-mode" class="xref">All-Active Redundancy Mode</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#section-14.2" class="xref">14.2</a>.  <a href="#name-load-balancing-of-traffic-b" class="xref">Load Balancing of Traffic between a PE and a Local CE</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2.2.1">
                    <p id="section-toc.1-1.14.2.2.2.1.1"><a href="#section-14.2.1" class="xref">14.2.1</a>.  <a href="#name-data-plane-learning" class="xref">Data-Plane Learning</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2.2.2">
                    <p id="section-toc.1-1.14.2.2.2.2.1"><a href="#section-14.2.2" class="xref">14.2.2</a>.  <a href="#name-control-plane-learning" class="xref">Control-Plane Learning</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="xref">15</a>. <a href="#name-mac-mobility" class="xref">MAC Mobility</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1">
                <p id="section-toc.1-1.15.2.1.1"><a href="#section-15.1" class="xref">15.1</a>.  <a href="#name-mac-duplication-issue" class="xref">MAC Duplication Issue</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.2">
                <p id="section-toc.1-1.15.2.2.1"><a href="#section-15.2" class="xref">15.2</a>.  <a href="#name-sticky-mac-addresses" class="xref">Sticky MAC Addresses</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.3">
                <p id="section-toc.1-1.15.2.3.1"><a href="#section-15.3" class="xref">15.3</a>.  <a href="#name-loop-protection" class="xref">Loop Protection</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#section-16" class="xref">16</a>. <a href="#name-multicast-and-broadcast" class="xref">Multicast and Broadcast</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.1">
                <p id="section-toc.1-1.16.2.1.1"><a href="#section-16.1" class="xref">16.1</a>.  <a href="#name-ingress-replication-3" class="xref">Ingress Replication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.2">
                <p id="section-toc.1-1.16.2.2.1"><a href="#section-16.2" class="xref">16.2</a>.  <a href="#name-p2mp-or-mp2mp-lsps" class="xref">P2MP or MP2MP LSPs</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.2.2.1">
                    <p id="section-toc.1-1.16.2.2.2.1.1"><a href="#section-16.2.1" class="xref">16.2.1</a>.  <a href="#name-inclusive-trees" class="xref">Inclusive Trees</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#section-17" class="xref">17</a>. <a href="#name-convergence" class="xref">Convergence</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17.2.1">
                <p id="section-toc.1-1.17.2.1.1"><a href="#section-17.1" class="xref">17.1</a>.  <a href="#name-transit-link-and-node-failu" class="xref">Transit Link and Node Failures between PEs</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17.2.2">
                <p id="section-toc.1-1.17.2.2.1"><a href="#section-17.2" class="xref">17.2</a>.  <a href="#name-pe-failures" class="xref">PE Failures</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17.2.3">
                <p id="section-toc.1-1.17.2.3.1"><a href="#section-17.3" class="xref">17.3</a>.  <a href="#name-pe-to-ce-network-failures" class="xref">PE-to-CE Network Failures</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#section-18" class="xref">18</a>. <a href="#name-frame-ordering" class="xref">Frame Ordering</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18.2.1">
                <p id="section-toc.1-1.18.2.1.1"><a href="#section-18.1" class="xref">18.1</a>.  <a href="#name-flow-label" class="xref">Flow Label</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19">
            <p id="section-toc.1-1.19.1"><a href="#section-19" class="xref">19</a>. <a href="#name-use-of-domain-wide-common-b" class="xref">Use of Domain-wide Common Block (DCB) Labels</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.20">
            <p id="section-toc.1-1.20.1"><a href="#section-20" class="xref">20</a>. <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.21">
            <p id="section-toc.1-1.21.1"><a href="#section-21" class="xref">21</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.22">
            <p id="section-toc.1-1.22.1"><a href="#section-22" class="xref">22</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.22.2.1">
                <p id="section-toc.1-1.22.2.1.1"><a href="#section-22.1" class="xref">22.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.22.2.2">
                <p id="section-toc.1-1.22.2.2.1"><a href="#section-22.2" class="xref">22.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.23">
            <p id="section-toc.1-1.23.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-acknowledgments-for-this-do" class="xref">Acknowledgments for This Document (2021)</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.24">
            <p id="section-toc.1-1.24.1"><a href="#appendix-B" class="xref">Appendix B</a>.  <a href="#name-contributors-for-this-docum" class="xref">Contributors for This Document (2021)</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.25">
            <p id="section-toc.1-1.25.1"><a href="#appendix-C" class="xref">Appendix C</a>.  <a href="#name-acknowledgments-from-the-fi" class="xref">Acknowledgments from the First Edition (2015)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.25.2.1">
                <p id="section-toc.1-1.25.2.1.1"><a href="#appendix-C.1" class="xref">C.1</a>.  <a href="#name-contributors-from-the-first" class="xref">Contributors from the First Edition (2015)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.25.2.2">
                <p id="section-toc.1-1.25.2.2.1"><a href="#appendix-C.2" class="xref">C.2</a>.  <a href="#name-authors-from-the-first-edit" class="xref">Authors from the First Edition (2015)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.26">
            <p id="section-toc.1-1.26.1"><a href="#appendix-D" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Virtual Private LAN Service (VPLS), as defined in <span>[<a href="#RFC4664" class="xref">RFC4664</a>]</span>,
    <span>[<a href="#RFC4761" class="xref">RFC4761</a>]</span>, and <span>[<a href="#RFC4762" class="xref">RFC4762</a>]</span>, is a proven and widely deployed technology.
    However, the existing solution has a number of limitations when it
    comes to multihoming and redundancy, multicast optimization,
    provisioning simplicity, flow-based load balancing, and multipathing;
    these limitations are important considerations for Data Center (DC)
    deployments. <span>[<a href="#RFC7209" class="xref">RFC7209</a>]</span> describes the motivation for a new solution
    to address these limitations. It also outlines a set of requirements
    that the new solution must address.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">This document describes procedures for a BGP MPLS-based solution
    called Ethernet VPN (EVPN) to address the requirements specified in
    <span>[<a href="#RFC7209" class="xref">RFC7209</a>]</span>. Please refer to <span>[<a href="#RFC7209" class="xref">RFC7209</a>]</span> for the detailed requirements
    and motivation. EVPN requires extensions to existing IP/MPLS
    protocols as described in this document. In addition to these
    extensions, EVPN uses several building blocks from existing MPLS
    technologies.<a href="#section-1-2" class="pilcrow">¶</a></p>
<div id="changes">
<section id="section-1.1">
        <h3 id="name-summary-of-changes-from-rfc">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-summary-of-changes-from-rfc" class="section-name selfRef">Summary of changes from RFC 7432</a>
        </h3>
<p id="section-1.1-1">This section describes the significant changes between <span>[<a href="#RFC4762" class="xref">RFC4762</a>]</span> and
        this document.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-1.1-2">
          <dt id="section-1.1-2.1">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.2">Updates to <a href="#terminology" class="xref">Terminology</a> i.a. BD, EVI, Ethernet Tag ID, P-tunnel, DF/BDF/NDF, DCB;<a href="#section-1.1-2.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.3">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.4">Added <a href="#pe_model" class="xref">Section 6.4</a> for description and disambiguation of EVPN bridging terminology;<a href="#section-1.1-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.5">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.6">Added ES-Import route target auto-derivation for ESI types 0,4,5;<a href="#section-1.1-2.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.7">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.8">Precision of 'encoding' language for all references to 'Label' fields;<a href="#section-1.1-2.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.9">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.10">Added <a href="#l2attr" class="xref">Section 7.11</a> for usage of <a href="#l2attr" class="xref">EVPN Layer 2 Attributes Extended Community</a> in EVPN Bridging;<a href="#section-1.1-2.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.11">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.12">Added <a href="#route_prioritisation" class="xref">Section 7.12</a> proposes relative order-of-magnitude
            route priority and processing to help achieve fast convergence;<a href="#section-1.1-2.12" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.13">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.14">Corrected <a href="#es_ead_route" class="xref">Section 8.2.1</a> to include reference to E-TREE exception;<a href="#section-1.1-2.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.15">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.16">Updated <a href="#df_election" class="xref">Section 8.5</a> to include Backup- and Non-Designated Forwarder
            roles to DF-Election algorithm, description of those roles and signaling updates;<a href="#section-1.1-2.16" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.17">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.18">Updated <a href="#df_election" class="xref">Section 8.5</a> to specify DF Election behaviour for
          Originating IP in different family<a href="#section-1.1-2.18" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.19">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.20">Added <a href="#mp2mp_lsp" class="xref">Section 8.3.1.3</a> for MP2MP MPLS LSPs and updated <a href="#p2mp_lsp_uu" class="xref">Section 12.2</a>;<a href="#section-1.1-2.20" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.21">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.22">Address conflicts in Best Path algorithm for Default Gateway in <a href="#bestpath_gw" class="xref">Section 10.1.1</a>;<a href="#section-1.1-2.22" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.23">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.24">Update to <a href="#sa_redundancy_mode" class="xref">Section 14.1.1</a> redundancy mode description;<a href="#section-1.1-2.24" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.25">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.26">Added <a href="#loop_protection" class="xref">Section 15.3</a> describing a loop detection and protection mechanism;<a href="#section-1.1-2.26" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.27">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.28">Added <a href="#flow_label" class="xref">Section 18.1</a> describing Flow-label usage and signaling (see also new <a href="#l2attr" class="xref">Section 7.11</a>);<a href="#section-1.1-2.28" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.29">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.30">
            <a href="#dcb" class="xref">Section 19</a> specifies use of Domain-wide Common Block (DCB) for several cases;<a href="#section-1.1-2.30" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.31">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.32">Restructuring, namely <a href="#df_election" class="xref">Section 8.5</a> to <a href="#ethernet_segment" class="xref">Section 5</a>, simplify all
          Ethernet Tag ID references to  <a href="#ethernet_tag_id" class="xref">Section 6</a> ; and<a href="#section-1.1-2.32" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.33">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.34">Corrected Route Target and other extcomm 'attributes' references to 'extended communities';<a href="#section-1.1-2.34" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.35">-</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.36">Cross-references and editorial changes;<a href="#section-1.1-2.36" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="requirements">
<section id="section-2">
      <h2 id="name-specification-of-requiremen">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-specification-of-requiremen" class="section-name selfRef">Specification of Requirements</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
    "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
    document are to be interpreted as described in <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span>.<a href="#section-2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-3">
      <h2 id="name-terminology">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<span class="break"></span><dl class="dlParallel" id="section-3-1">
        <dt id="section-3-1.1">BD:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.2">Broadcast Domain. In a bridged network, the broadcast domain
            corresponds to a Virtual LAN (VLAN), where a VLAN is typically
            represented by a single VLAN ID (VID) but can be represented by
            several VIDs where Shared VLAN Learning (SVL) is used per
            <span>[<a href="#IEEE.802.1Q_2014" class="xref">IEEE.802.1Q_2014</a>]</span>.<a href="#section-3-1.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.3">Bridge Table:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.4">An instantiation of a broadcast domain
            on a MAC-VRF.<a href="#section-3-1.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.5">CE:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.6">Customer Edge device, e.g., a host, router, or switch.<a href="#section-3-1.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.7">EVI:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.8">An EVPN instance spanning the Provider Edge (PE) devices
            participating in that EVPN. An EVI may be comprised of one BD
            (VLAN-based, VLAN Bundle, or Port-based services) or multiple BDs (VLAN-aware
            Bundle or Port-based VLAN-Aware services).<a href="#section-3-1.8" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.9">MAC-VRF:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.10">A Virtual Routing and Forwarding table for
            Media Access Control (MAC) addresses on a PE.<a href="#section-3-1.10" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.11">Ethernet Segment (ES):</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.12">When a customer site
            (device or network) is connected to one or more PEs via a set of
            Ethernet links, then
            that set of links is referred to as an 'Ethernet segment'.<a href="#section-3-1.12" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.13">Ethernet Segment Identifier (ESI):</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.14">A unique non-zero
            identifier that identifies an Ethernet segment is called an
            'Ethernet Segment Identifier'.<a href="#section-3-1.14" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.15">VID:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.16">VLAN Identifier.<a href="#section-3-1.16" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.17">Ethernet Tag:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.18">
            Used to represent a BD that is configured on a given ES for the
            purposes of DF election and &lt;EVI, BD&gt; identification for
            frames received from the CE. Note that any of the following 
            may be used to represent a BD: VIDs (including Q-in-Q tags),
            configured IDs, VNIs (Virtual Extensible Local Area Network (VXLAN) Network Identifiers),
            normalized VIDs, I-SIDs (Service Instance Identifiers), etc., 
            as long as the representation of the BDs is configured consistently
            across the multihomed PEs attached to that ES.<a href="#section-3-1.18" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.19">Ethernet Tag ID:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.20">
         Normalized network wide ID that is used to identify a BD within an EVI
            and carried in EVPN routes.<a href="#section-3-1.20" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.21">LACP:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.22">Link Aggregation Control Protocol.<a href="#section-3-1.22" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.23">MP2MP:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.24">Multipoint to Multipoint.<a href="#section-3-1.24" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.25">MP2P:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.26">Multipoint to Point.<a href="#section-3-1.26" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.27">P2MP:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.28">Point to Multipoint.<a href="#section-3-1.28" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.29">P2P:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.30">Point to Point.<a href="#section-3-1.30" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.31">P-tunnel:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.32">A tunnel through the network of one or more SPs.
            In this document, P-tunnels are instantiated as bidirectional multicast distribution trees.<a href="#section-3-1.32" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.33">PE:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.34">Provider Edge device.<a href="#section-3-1.34" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.35">Single-Active Redundancy Mode:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.36">When only a single PE,
            among all the PEs attached to an Ethernet segment,
            is allowed to forward traffic to/from that Ethernet segment for
            a given VLAN, then the Ethernet segment is defined to be operating
            in Single-Active redundancy mode.<a href="#section-3-1.36" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.37">All-Active Redundancy Mode:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.38">When all PEs attached to
            an Ethernet segment are allowed to forward known unicast traffic
            to/from that Ethernet segment for a given VLAN, then the Ethernet
            segment is defined to be operating in All-Active redundancy mode.<a href="#section-3-1.38" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.39">BUM:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.40">Broadcast, unknown unicast, and multicast.<a href="#section-3-1.40" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.41">DF:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.42">Designated Forwarder.<a href="#section-3-1.42" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.43">Backup-DF (BDF):</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.44">Backup-Designated Forwarder.<a href="#section-3-1.44" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.45">Non-DF (NDF):</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.46">Non-Designated Forwarder.<a href="#section-3-1.46" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.47">DCB:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.48">Domain-wide Common Block (of labels), as in 
             <span>[<a href="#I-D.ietf-bess-mvpn-evpn-aggregation-label" class="xref">I-D.ietf-bess-mvpn-evpn-aggregation-label</a>]</span>.<a href="#section-3-1.48" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.49">AC:</dt>
        <dd style="margin-left: 1.5em" id="section-3-1.50">Attachment Circuit.<a href="#section-3-1.50" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="overview">
<section id="section-4">
      <h2 id="name-bgp-mpls-based-evpn-overvie">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-bgp-mpls-based-evpn-overvie" class="section-name selfRef">BGP MPLS-Based EVPN Overview</a>
      </h2>
<p id="section-4-1">This section provides an overview of EVPN. An EVPN instance
        comprises Customer Edge devices (CEs) that are connected to Provider
        Edge devices (PEs) that form the edge of the MPLS infrastructure. A
        CE may be a host, a router, or a switch. The PEs provide virtual
        Layer 2 bridged connectivity between the CEs. There may be multiple
        EVPN instances in the provider's network.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">The PEs may be connected by an MPLS Label Switched Path (LSP)
        infrastructure, which provides the benefits of MPLS technology, such
        as fast reroute, resiliency, etc. The PEs may also be connected by
        an IP infrastructure, in which case IP/GRE (Generic Routing
        Encapsulation) tunneling or other IP tunneling can be used between
        the PEs. The detailed procedures in this document are specified only
        for MPLS LSPs as the tunneling technology. However, these procedures
        are designed to be extensible to IP tunneling as the Packet Switched
        Network (PSN) tunneling technology.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">In an EVPN, MAC learning between PEs occurs not in the data plane (as
        happens with traditional bridging in VPLS
        <span>[<a href="#RFC4761" class="xref">RFC4761</a>]</span> <span>[<a href="#RFC4762" class="xref">RFC4762</a>]</span>) but in
        the control plane. Control-plane learning offers greater control
        over the MAC learning process, such as restricting who learns what,
        and the ability to apply policies. Furthermore, the control plane
        chosen for advertising MAC reachability information is multi-protocol
        (MP) BGP (similar to IP VPNs <span>[<a href="#RFC4364" class="xref">RFC4364</a>]</span>). This provides flexibility
        and the ability to preserve the "virtualization" or isolation of
        groups of interacting agents (hosts, servers, virtual machines) from
        each other. In EVPN, PEs advertise the MAC addresses learned from
        the CEs that are connected to them, along with an MPLS label, to
        other PEs in the control plane using Multiprotocol BGP (MP-BGP).
        Control-plane learning enables load balancing of traffic to and from
        CEs that are multihomed to multiple PEs. This is in addition to load
        balancing across the MPLS core via multiple LSPs between the same
        pair of PEs. In other words, it allows CEs to connect to multiple
        active points of attachment. It also improves convergence times in
        the event of certain network failures.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">However, learning between PEs and CEs is done by the method best
        suited to the CE: data-plane learning, IEEE 802.1x, the Link Layer
        Discovery Protocol (LLDP), IEEE 802.1aq, Address Resolution Protocol
        (ARP), management plane, or other protocols.<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">It is a local decision as to whether the Layer 2 forwarding table on
        a PE is populated with all the MAC destination addresses known to the
        control plane, or whether the PE implements a cache-based scheme.
        For instance, the MAC forwarding table may be populated only with the
        MAC destinations of the active flows transiting a specific PE.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">The policy attributes of EVPN are very similar to those of IP-VPN.
        An EVPN instance requires a Route Distinguisher (RD) that is unique
        per MAC-VRF and one or more globally unique Route Targets (RTs). A
        CE attaches to a BD on a PE, on an Ethernet interface that may
        be configured for one or more Ethernet tags. If the Ethernet tags
        are VLAN IDs, some deployment scenarios guarantee uniqueness of VLAN IDs 
        across EVPN instances: all points of attachment for a given EVPN 
        instance use the same VLAN ID, and no other EVPN instance uses this 
        VLAN ID.  This document refers to this case as a "Unique VLAN EVPN" 
        and describes simplified procedures to optimize for it.
        See for example <a href="#rt_auto_etag" class="xref">Section 7.10.1</a> which describes deriving 
        automatically the RT(s) for each EVPN instance from the corresponding VID.<a href="#section-4-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ethernet_segment">
<section id="section-5">
      <h2 id="name-ethernet-segment">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-ethernet-segment" class="section-name selfRef">Ethernet Segment</a>
      </h2>
<p id="section-5-1">As indicated in <span>[<a href="#RFC7209" class="xref">RFC7209</a>]</span>, each Ethernet segment needs a unique
        identifier in an EVPN. This section defines how such identifiers are
        assigned and how they are encoded for use in EVPN signaling. Later
        sections of this document describe the protocol mechanisms that
        utilize the identifiers.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">When a customer site is connected to one or more PEs via a set of
        Ethernet links, then this set of Ethernet links constitutes an
        "Ethernet segment". For a multihomed site, each Ethernet segment
        (ES) is identified by a unique non-zero identifier called an Ethernet
        Segment Identifier (ESI). An ESI is encoded as a 10-octet integer in
        line format with the most significant octet sent first. The
        following two ESI values are reserved:<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">- ESI 0 denotes a single-homed site.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">- ESI {0xFF} (repeated 10 times) is known as MAX-ESI and is reserved.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">In general, an Ethernet segment SHOULD have a non-reserved ESI that
   is unique network wide (i.e., across all EVPN instances on all the
   PEs). If the CE(s) constituting an Ethernet segment is (are) managed
   by the network operator, then ESI uniqueness should be guaranteed;
   however, if the CE(s) is (are) not managed, then the operator MUST
   configure a network-wide unique ESI for that Ethernet segment. This
   is required to enable auto-discovery of Ethernet segments and
   Designated Forwarder (DF) election.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">In a network with managed and non-managed CEs, the ESI has the
   following format:<a href="#section-5-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5-7">
<pre>
            +---+---+---+---+---+---+---+---+---+---+
            | T |          ESI Value                |
            +---+---+---+---+---+---+---+---+---+---+

</pre><a href="#section-5-7" class="pilcrow">¶</a>
</div>
<p id="section-5-8">Where:<a href="#section-5-8" class="pilcrow">¶</a></p>
<p id="section-5-9">T (ESI Type) is a 1-octet field (most significant octet) that
    specifies the format of the remaining 9 octets (ESI Value). The
    following six ESI types can be used:<a href="#section-5-9" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5-10">
        <dt id="section-5-10.1">-</dt>
        <dd style="margin-left: 1.0em" id="section-5-10.2">Type 0 (T=0x00) - This type indicates an arbitrary 9-octet ESI
        value, which is managed and configured by the operator.<a href="#section-5-10.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-5-10.3">-</dt>
        <dd style="margin-left: 1.0em" id="section-5-10.4">
          <p id="section-5-10.4.1">Type 1 (T=0x01) - When IEEE 802.1AX LACP is used between the PEs
        and CEs, this ESI type indicates an auto-generated ESI value
        determined from LACP by concatenating the following parameters:<a href="#section-5-10.4.1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5-10.4.2">
            <dt id="section-5-10.4.2.1">+</dt>
            <dd style="margin-left: 1.0em" id="section-5-10.4.2.2">CE LACP System MAC address (6 octets).
                The CE LACP System MAC address MUST be encoded in the high-order
                6 octets of the ESI Value field.<a href="#section-5-10.4.2.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-5-10.4.2.3">+</dt>
            <dd style="margin-left: 1.0em" id="section-5-10.4.2.4">CE LACP Port Key (2 octets).
                The CE LACP port key MUST be encoded in the 2 octets next to
                the System MAC address.<a href="#section-5-10.4.2.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-5-10.4.2.5">+</dt>
            <dd style="margin-left: 1.0em" id="section-5-10.4.2.6">The remaining octet will be set to 0x00.<a href="#section-5-10.4.2.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-5-10.4.3">

        As far as the CE is concerned, it would treat the multiple PEs that
        it is connected to as the same switch. This allows the CE to
        aggregate links that are attached to different PEs in the same
        bundle.<a href="#section-5-10.4.3" class="pilcrow">¶</a></p>
<p id="section-5-10.4.4">
        This mechanism could be used only if it produces ESIs that satisfy
        the uniqueness requirement specified above.<a href="#section-5-10.4.4" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-5-10.5">-</dt>
        <dd style="margin-left: 1.0em" id="section-5-10.6">
          <p id="section-5-10.6.1">Type 2 (T=0x02) - This type is used in the case of indirectly
        connected hosts via a bridged LAN between the CEs and the PEs. The
        ESI Value is auto-generated and determined based on the Layer 2
        bridge protocol as follows: If the Multiple Spanning Tree Protocol
        (MSTP) is used in the bridged LAN, then the value of the ESI is
        derived by listening to Bridge PDUs (BPDUs) on the Ethernet
        segment. To achieve this, the PE is not required to run MSTP.
        However, the PE must learn the Root Bridge MAC address and Bridge
        Priority of the root of the Internal Spanning Tree (IST) by
        listening to the BPDUs. The ESI Value is constructed as follows:<a href="#section-5-10.6.1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5-10.6.2">
            <dt id="section-5-10.6.2.1">+</dt>
            <dd style="margin-left: 1.0em" id="section-5-10.6.2.2">Root Bridge MAC address (6 octets).
                The Root Bridge MAC address MUST be encoded in the high-order
                6 octets of the ESI Value field.<a href="#section-5-10.6.2.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-5-10.6.2.3">+</dt>
            <dd style="margin-left: 1.0em" id="section-5-10.6.2.4">Root Bridge Priority (2 octets).
                The CE Root Bridge Priority MUST be encoded in the 2 octets
                next to the Root Bridge MAC address.<a href="#section-5-10.6.2.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-5-10.6.2.5">+</dt>
            <dd style="margin-left: 1.0em" id="section-5-10.6.2.6">The remaining octet will be set to 0x00.<a href="#section-5-10.6.2.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-5-10.6.3">

        This mechanism could be used only if it produces ESIs that satisfy
        the uniqueness requirement specified above.<a href="#section-5-10.6.3" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-5-10.7">-</dt>
        <dd style="margin-left: 1.0em" id="section-5-10.8">
          <p id="section-5-10.8.1">Type 3 (T=0x03) - This type indicates a MAC-based
        ESI Value that can be auto-generated or configured by the operator.
        The ESI Value is constructed as follows:<a href="#section-5-10.8.1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5-10.8.2">
            <dt id="section-5-10.8.2.1">+</dt>
            <dd style="margin-left: 1.0em" id="section-5-10.8.2.2">System MAC address (6 octets).
                The PE MAC address MUST be
                encoded in the high-order 6 octets of the ESI Value field.<a href="#section-5-10.8.2.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-5-10.8.2.3">+</dt>
            <dd style="margin-left: 1.0em" id="section-5-10.8.2.4">Local Discriminator value (3 octets).
                The Local Discriminator value MUST be encoded in the low-order
                3 octets of the ESI Value.<a href="#section-5-10.8.2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-5-10.8.3">

        This mechanism could be used only if it produces ESIs that satisfy
        the uniqueness requirement specified above.<a href="#section-5-10.8.3" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-5-10.9">-</dt>
        <dd style="margin-left: 1.0em" id="section-5-10.10">
          <p id="section-5-10.10.1">Type 4 (T=0x04) - This type indicates a router-ID ESI Value that
        can be auto-generated or configured by the operator. The ESI Value
        is constructed as follows:<a href="#section-5-10.10.1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5-10.10.2">
            <dt id="section-5-10.10.2.1">+</dt>
            <dd style="margin-left: 1.0em" id="section-5-10.10.2.2">Router ID (4 octets).
                The system router ID MUST be encoded in
                the high-order 4 octets of the ESI Value field.<a href="#section-5-10.10.2.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-5-10.10.2.3">+</dt>
            <dd style="margin-left: 1.0em" id="section-5-10.10.2.4">Local Discriminator value (4 octets).
                The Local Discriminator value MUST be encoded in the 4 octets
                next to the IP address.<a href="#section-5-10.10.2.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-5-10.10.2.5">+</dt>
            <dd style="margin-left: 1.0em" id="section-5-10.10.2.6">The low-order octet of the ESI Value
                will be set to 0x00.<a href="#section-5-10.10.2.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-5-10.10.3">

        This mechanism could be used only if it produces ESIs that satisfy
        the uniqueness requirement specified above.<a href="#section-5-10.10.3" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-5-10.11">-</dt>
        <dd style="margin-left: 1.0em" id="section-5-10.12">
          <p id="section-5-10.12.1">Type 5 (T=0x05) - This type indicates an Autonomous System<a href="#section-5-10.12.1" class="pilcrow">¶</a></p>
<p id="section-5-10.12.2">(AS)-based ESI Value that can be auto-generated
        or configured by the operator. The ESI Value is constructed as follows:<a href="#section-5-10.12.2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5-10.12.3">
            <dt id="section-5-10.12.3.1">+</dt>
            <dd style="margin-left: 1.0em" id="section-5-10.12.3.2">
              <p id="section-5-10.12.3.2.1">AS number (4 octets).
                This is an AS number owned by the system
                and MUST be encoded in the high-order 4 octets of the ESI Value
                field. If a 2-octet AS number is used, the high-order extra<a href="#section-5-10.12.3.2.1" class="pilcrow">¶</a></p>
<p id="section-5-10.12.3.2.2">2 octets will be 0x0000.<a href="#section-5-10.12.3.2.2" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5-10.12.3.3">+</dt>
            <dd style="margin-left: 1.0em" id="section-5-10.12.3.4">Local Discriminator value (4 octets).
                The Local Discriminator value MUST be encoded in the 4 octets
                next to the AS number.<a href="#section-5-10.12.3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-5-10.12.3.5">+</dt>
            <dd style="margin-left: 1.0em" id="section-5-10.12.3.6">The low-order octet of the ESI Value will
                be set to 0x00.<a href="#section-5-10.12.3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-5-10.12.4">

        This mechanism could be used only if it produces ESIs that satisfy
        the uniqueness requirement specified above.<a href="#section-5-10.12.4" class="pilcrow">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-5-11">Note that a CE always sends packets belonging to a specific flow
            using a single link towards a PE. For instance, if the CE is a host,
            then, as mentioned earlier, the host treats the multiple links that
            it uses to reach the PEs as a Link Aggregation Group (LAG). The CE
            employs a local hashing function to map traffic flows onto links in
            the LAG.<a href="#section-5-11" class="pilcrow">¶</a></p>
<p id="section-5-12">If a bridged network is multihomed to more than one PE in an EVPN
            network via switches, then the support of All-Active redundancy mode
            requires the bridged network to be connected to two or more PEs using
            a LAG.<a href="#section-5-12" class="pilcrow">¶</a></p>
<p id="section-5-13">If a bridged network does not connect to the PEs using a LAG, then
            only one of the links between the bridged network and the PEs must be
            the active link for a given &lt;ES, EVI&gt;.
            In this
            case, the set of Ethernet A-D per ES routes advertised by each PE
            MUST have the "Single-Active" bit in the flags of the ESI Label
            extended community set to 1.<a href="#section-5-13" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ethernet_tag_id">
<section id="section-6">
      <h2 id="name-ethernet-tag-id">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-ethernet-tag-id" class="section-name selfRef">Ethernet Tag ID</a>
      </h2>
<p id="section-6-1">An Ethernet Tag ID is a 32-bit field containing either a 12-bit or
    24-bit identifier that identifies a particular broadcast domain
    (e.g., a VLAN) in an EVPN instance.  The 12-bit identifier is called
    the VLAN ID (VID). An EVPN instance consists of one or more
    broadcast domains (one or more VLANs).
    VLANs are assigned to a given EVPN instance by the provider
    of the EVPN service.  A given VLAN can itself be represented by multiple VIDs.
    In such cases, the PEs participating in that VLAN for a given EVPN instance
    are responsible for performing VLAN ID translation
    to/from locally attached CE devices.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">The following subsections discuss the relationship between broadcast
    domains (e.g., VLANs), Ethernet Tag IDs (e.g., VIDs), and MAC-VRFs as
    well as the setting of the Ethernet Tag ID, in the various EVPN BGP
    routes (defined in <a href="#multihoming" class="xref">Section 8</a>), for the different types of service
    interfaces described in <span>[<a href="#RFC7209" class="xref">RFC7209</a>]</span>.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">The following Ethernet Tag ID value is reserved:<a href="#section-6-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6-4">
        <dt id="section-6-4.1">-</dt>
        <dd style="margin-left: 1.0em" id="section-6-4.2">Ethernet Tag ID {0xFFFFFFFF} is known as MAX-ET.<a href="#section-6-4.2" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<div id="etag_vlan_based">
<section id="section-6.1">
        <h3 id="name-vlan-based-service-interfac">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-vlan-based-service-interfac" class="section-name selfRef">VLAN-Based Service Interface</a>
        </h3>
<p id="section-6.1-1">With this service interface, an EVPN instance consists of only a
   single broadcast domain (e.g., a single VLAN). Therefore, there is a
   one-to-one mapping between a VID on this interface and a MAC-VRF.
   Since a MAC-VRF corresponds to a single VLAN, it consists of a single
   bridge table corresponding to that VLAN. If the VLAN is represented
   by multiple VIDs (e.g., a different VID per Ethernet segment per PE),
   then each PE needs to perform VID translation for frames destined to
   its Ethernet segment(s). In such scenarios, the Ethernet frames
   transported over an MPLS/IP network SHOULD remain tagged with the
   originating VID, and a VID translation MUST be supported in the data
   path and MUST be performed on the disposition PE. The Ethernet Tag
   ID in all EVPN routes MUST be set to 0.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="etag_vlan_bundle">
<section id="section-6.2">
        <h3 id="name-vlan-bundle-service-interfa">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-vlan-bundle-service-interfa" class="section-name selfRef">VLAN Bundle Service Interface</a>
        </h3>
<p id="section-6.2-1">With this service interface, an EVPN instance corresponds to multiple
   broadcast domains (e.g., multiple VLANs); however, only a single
   bridge table is maintained per MAC-VRF, which means multiple VLANs
   share the same bridge table. This implies that MAC addresses MUST be
   unique across all VLANs for that EVI in order for this service to
   work. In other words, there is a many-to-one mapping between VLANs
   and a MAC-VRF, and the MAC-VRF consists of a single bridge table.
   Furthermore, a single VLAN must be represented by a single VID --
   e.g., no VID translation is allowed for this service interface type.
   The MPLS-encapsulated frames MUST remain tagged with the originating
   VID. Tag translation is NOT permitted. The Ethernet Tag ID in all
   EVPN routes MUST be set to 0.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<section id="section-6.2.1">
          <h4 id="name-port-based-service-interfac">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-port-based-service-interfac" class="section-name selfRef">Port-Based Service Interface</a>
          </h4>
<p id="section-6.2.1-1">This service interface is a special case of the VLAN bundle service
   interface, where all of the VLANs on the port are part of the same
   service and map to the same bundle. The procedures are identical to
   those described in <a href="#etag_vlan_bundle" class="xref">Section 6.2</a>.<a href="#section-6.2.1-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="etag_vlan_aware_bundle">
<section id="section-6.3">
        <h3 id="name-vlan-aware-bundle-service-i">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-vlan-aware-bundle-service-i" class="section-name selfRef">VLAN-Aware Bundle Service Interface</a>
        </h3>
<p id="section-6.3-1">With this service interface, an EVPN instance consists of multiple
   broadcast domains (e.g., multiple VLANs) with each VLAN having its
   own bridge table -- i.e., multiple bridge tables (one per VLAN) are
   maintained by a single MAC-VRF corresponding to the EVPN instance.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">Broadcast, unknown unicast, or multicast (BUM) traffic is sent only
   to the CEs in a given broadcast domain; however, the broadcast
   domains within an EVI either MAY each have their own P-Tunnel or MAY
   share P-Tunnels -- e.g., all of the broadcast domains in an EVI MAY
   share a single P-Tunnel.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3">In the case where a single VLAN is represented by a single VID and
   thus no VID translation is required, an MPLS-encapsulated packet MUST
   carry that VID. The Ethernet Tag ID in all EVPN routes MUST be set
   to that VID. The advertising PE MAY advertise the MPLS Label1 in the
   MAC/IP Advertisement route representing ONLY the EVI or representing
   both the Ethernet Tag ID and the EVI. This decision is only a local
   matter by the advertising PE (which is also the disposition PE) and
   doesn't affect any other PEs.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
<p id="section-6.3-4">In the case where a single VLAN is represented by different VIDs on
   different CEs and thus VID translation is required, a normalized
   Ethernet Tag ID (VID) MUST be carried in the EVPN BGP routes.
   Furthermore, the advertising PE advertises the MPLS Label1 in the
   MAC/IP Advertisement route representing both the Ethernet Tag ID and
   the EVI, so that upon receiving an MPLS-encapsulated packet, it can
   identify the corresponding bridge table from the MPLS EVPN label and
   perform Ethernet Tag ID translation ONLY at the disposition PE --
   i.e., the Ethernet frames transported over the MPLS/IP network MUST
   remain tagged with the originating VID, and VID translation is
   performed on the disposition PE. The Ethernet Tag ID in all EVPN
   routes MUST be set to the normalized Ethernet Tag ID assigned by the
   EVPN provider.<a href="#section-6.3-4" class="pilcrow">¶</a></p>
<section id="section-6.3.1">
          <h4 id="name-port-based-vlan-aware-servi">
<a href="#section-6.3.1" class="section-number selfRef">6.3.1. </a><a href="#name-port-based-vlan-aware-servi" class="section-name selfRef">Port-Based VLAN-Aware Service Interface</a>
          </h4>
<p id="section-6.3.1-1">This service interface is a special case of the VLAN-aware bundle
   service interface, where all of the VLANs on the port are part of the
   same service and are mapped to a single bundle but without any VID
   translation. The procedures are a subset of those described in
   <a href="#etag_vlan_aware_bundle" class="xref">Section 6.3</a>.<a href="#section-6.3.1-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="pe_model">
<section id="section-6.4">
        <h3 id="name-evpn-pe-model">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-evpn-pe-model" class="section-name selfRef">EVPN PE Model</a>
        </h3>
<p id="section-6.4-1"> Since this document discusses EVPN operation in relationship to
            MAC-VRF, EVI, Broadcast Domain (BD), and Bridge Table (BT), it is 
            important to understand the relationship between these terms.  
            Therefore, the following PE model is depicted below to 
            illustrate the relationship among them.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.4-2">
<pre>

      +--------------------------------------------------+
      |                                                  |
      |              +------------------+        EVPN PE |
      | Attachment   | +------------------+              |
      | Circuit(AC1) | |  +----------+    |       MPLS/NVO tnl
    ----------------------*Bridge    |    |              +-----
      |              | |  |Table(BT1)|    |             / \    \
      |              | |  |          |&lt;------------------&gt; |Eth|
      |              | |  |  VLAN x  |    |             \ /    /
      |              | |  +----------+    |              +-----
      |              | |     ...          |                |
      |              | |  +----------+    |         MPLS/NVO tnl
      |              | |  |Bridge    |    |               +-----
      |              | |  |Table(BT2)|    |              / \    \
      |              | |  |          |&lt;-------------------&gt; |Eth|
    ----------------------*  VLAN y  |    |              \ /    /
      |  AC2         | |  +----------+    |               +-----
      |              | |    MAC-VRF1      |               |
      |              +-+    RD1/RT1       |               |
      |                +------------------+               |
      |                                                   |
      |                                                   |
      +---------------------------------------------------+

                      Figure 1: EVPN PE Model


</pre><a href="#section-6.4-2" class="pilcrow">¶</a>
</div>
<p id="section-6.4-3"> A tenant configured for an EVPN service instance (i.e, EVI) on a PE, is
              instantiated by a single MAC Virtual Routing and Forwarding
              table (MAC-VRF) on that PE. A MAC-VRF consists of one or more 
              Bridge Tables (BTs) where each BT corresponds to a VLAN (broadcast 
              domain - BD). If a service interface for an EVPN PE is configured 
              in VLAN-Based mode (i.e., section 6.1), then there is only a single 
              BT per MAC-VRF (per EVI) - i.e., there is only one  tenant VLAN per 
              EVI. However, if a service interface for an EVPN PE is configured in 
              VLAN-Aware Bundle mode (i.e., section 6.3), then there are several BTs 
              per MAC-VRF (per EVI) - i.e., there are several tenant VLANs per EVI.
              The relationship among these terms can be summarized as follow:<a href="#section-6.4-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.4-4">
          <dt id="section-6.4-4.1">-</dt>
          <dd style="margin-left: 1.0em" id="section-6.4-4.2">
            
                  An EVI consists of one or more BDs and a MAC-VRF consists of one or more BTs, one for each BD.
                  A BD is identified by an Ethernet Tag ID 
               which is typically represented by a single 
               VLAN ID (VID); however, it can be represented by multiple VIDs (i.e., Shared 
               VLAN Learning (SVL) mode in 802.1Q).<a href="#section-6.4-4.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-6.4-4.3">-</dt>
          <dd style="margin-left: 1.0em" id="section-6.4-4.4">In VLAN-based mode, there is one EVI per VLAN and thus one BD/BT 
               per VLAN. Furthermore, there is one BT per MAC-VRF.<a href="#section-6.4-4.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-6.4-4.5">-</dt>
          <dd style="margin-left: 1.0em" id="section-6.4-4.6">In VLAN-bundle service, it can be considered as analogous to SVL 
               mode in 802.1Q i.e., one BD per EVI and one BT per MAC‑VRF with multiple 
               VIDs representing that BD.<a href="#section-6.4-4.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-6.4-4.7">-</dt>
          <dd style="margin-left: 1.0em" id="section-6.4-4.8">In VLAN-aware bundle service, there is one EVI with multiple BDs 
                where each BD is represented by a VLAN. Furthermore, there are multiple BTs 
                in a single MAC‑VRF.<a href="#section-6.4-4.8" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-6.4-5"> Since a single tenant subnet is typically (and in this document) 
                 represented by a VLAN (and thus supported by a single BT), for a given 
                 tenant there are as many BTs as there are subnets as shown in the PE 
                 model above.<a href="#section-6.4-5" class="pilcrow">¶</a></p>
<p id="section-6.4-6"> MAC-VRF is identified by its corresponding route target and route 
                 distinguisher. If operating in EVPN VLAN-Based mode, then a receiving PE 
                 that receives an EVPN route with MAC-VRF route target can identify the 
                 corresponding BT; however, if operating in EVPN VLAN-Aware Bundle mode, 
                 then the receiving PE needs both the MAC-VRF route target and Ethernet Tag ID 
                 in order to identify the corresponding BT.<a href="#section-6.4-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="evpn_routes">
<section id="section-7">
      <h2 id="name-bgp-evpn-routes">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-bgp-evpn-routes" class="section-name selfRef">BGP EVPN Routes</a>
      </h2>
<p id="section-7-1">This document defines a new BGP Network Layer Reachability
        Information (NLRI) called the EVPN NLRI.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">The format of the EVPN NLRI is as follows:<a href="#section-7-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7-3">
<pre>
              +-----------------------------------+
              |    Route Type (1 octet)           |
              +-----------------------------------+
              |     Length (1 octet)              |
              +-----------------------------------+
              | Route Type specific (variable)    |
              +-----------------------------------+

</pre><a href="#section-7-3" class="pilcrow">¶</a>
</div>
<p id="section-7-4">The Route Type field defines the encoding of the rest of the EVPN
        NLRI (Route Type specific EVPN NLRI).<a href="#section-7-4" class="pilcrow">¶</a></p>
<p id="section-7-5">The Length field indicates the length in octets of the Route Type
        specific field of the EVPN NLRI.<a href="#section-7-5" class="pilcrow">¶</a></p>
<p id="section-7-6">This document defines the following Route Types:<a href="#section-7-6" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-7-7.1">
          <p id="section-7-7.1.1">+ 1 - Ethernet Auto-Discovery (A-D) route<a href="#section-7-7.1.1" class="pilcrow">¶</a></p>
<p id="section-7-7.1.2">+ 2 - MAC/IP Advertisement route<a href="#section-7-7.1.2" class="pilcrow">¶</a></p>
<p id="section-7-7.1.3">+ 3 - Inclusive Multicast Ethernet Tag route<a href="#section-7-7.1.3" class="pilcrow">¶</a></p>
<p id="section-7-7.1.4">+ 4 - Ethernet Segment route<a href="#section-7-7.1.4" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-7-8">

        The detailed encoding and procedures for these route types are
        described in subsequent sections.<a href="#section-7-8" class="pilcrow">¶</a></p>
<p id="section-7-9">The EVPN NLRI is carried in BGP <span>[<a href="#RFC4271" class="xref">RFC4271</a>]</span> using BGP Multiprotocol
        Extensions <span>[<a href="#RFC4760" class="xref">RFC4760</a>]</span> with an Address Family Identifier (AFI) of 25
        (L2VPN) and a Subsequent Address Family Identifier (SAFI) of 70
        (EVPN). The NLRI field in the MP_REACH_NLRI/MP_UNREACH_NLRI
        attribute contains the EVPN NLRI (encoded as specified above).<a href="#section-7-9" class="pilcrow">¶</a></p>
<p id="section-7-10">In order for two BGP speakers to exchange labeled EVPN NLRI, they
        must use BGP Capabilities Advertisements to ensure that they both are
        capable of properly processing such NLRI. This is done as specified
        in <span>[<a href="#RFC4760" class="xref">RFC4760</a>]</span>, by using capability code 1 (multiprotocol BGP) with an
        AFI of 25 (L2VPN) and a SAFI of 70 (EVPN).<a href="#section-7-10" class="pilcrow">¶</a></p>
<section id="section-7.1">
        <h3 id="name-ethernet-auto-discovery-rou">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-ethernet-auto-discovery-rou" class="section-name selfRef">Ethernet Auto-discovery Route</a>
        </h3>
<p id="section-7.1-1">An Ethernet A-D route type specific EVPN NLRI consists of the
            following:<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1-2">
<pre>
             +---------------------------------------+
             |  Route Distinguisher (RD) (8 octets)  |
             +---------------------------------------+
             |Ethernet Segment Identifier (10 octets)|
             +---------------------------------------+
             |  Ethernet Tag ID (4 octets)           |
             +---------------------------------------+
             |  MPLS Label (3 octets)                |
             +---------------------------------------+

</pre><a href="#section-7.1-2" class="pilcrow">¶</a>
</div>
<p id="section-7.1-3">For the purpose of BGP route key processing, only the Ethernet
            Segment Identifier and the Ethernet Tag ID are considered to be part
            of the prefix in the NLRI. The MPLS Label field is to be treated as
            a route attribute as opposed to being part of the route.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<p id="section-7.1-4">The MPLS Label field is encoded as 3 octets, where the high-order
            20 bits contain the label value.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
<p id="section-7.1-5">For procedures and usage of this route, please see
            Sections
            <a href="#fast_convergence" class="xref">8.2</a>
            ("<a href="#fast_convergence" class="xref">Fast Convergence</a>") and
            <a href="#aliasing" class="xref">8.4</a>
            ("<a href="#aliasing" class="xref">Aliasing and Backup Path</a>").<a href="#section-7.1-5" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2">
        <h3 id="name-mac-ip-advertisement-route">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-mac-ip-advertisement-route" class="section-name selfRef">MAC/IP Advertisement Route</a>
        </h3>
<p id="section-7.2-1">A MAC/IP Advertisement route type specific EVPN NLRI consists of the
            following:<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.2-2">
<pre>
             +---------------------------------------+
             |  RD (8 octets)                        |
             +---------------------------------------+
             |Ethernet Segment Identifier (10 octets)|
             +---------------------------------------+
             |  Ethernet Tag ID (4 octets)           |
             +---------------------------------------+
             |  MAC Address Length (1 octet)         |
             +---------------------------------------+
             |  MAC Address (6 octets)               |
             +---------------------------------------+
             |  IP Address Length (1 octet)          |
             +---------------------------------------+
             |  IP Address (0, 4, or 16 octets)      |
             +---------------------------------------+
             |  MPLS Label1 (3 octets)               |
             +---------------------------------------+
             |  MPLS Label2 (0 or 3 octets)          |
             +---------------------------------------+
</pre><a href="#section-7.2-2" class="pilcrow">¶</a>
</div>
<p id="section-7.2-3">For the purpose of BGP route key processing, only the Ethernet Tag
            ID, MAC Address Length, MAC Address, IP Address Length, and IP
            Address fields are considered to be part of the prefix in the NLRI.
            The Ethernet Segment Identifier, MPLS Label1, and MPLS Label2 fields
            are to be treated as route attributes as opposed to being part of the
            "route". Both the IP and MAC address lengths are in bits.<a href="#section-7.2-3" class="pilcrow">¶</a></p>
<p id="section-7.2-4">The MPLS Label1 and MPLS Label2 fields are encoded as 3 octets,
            where the high-order 20 bits contain the label value.<a href="#section-7.2-4" class="pilcrow">¶</a></p>
<p id="section-7.2-5">For procedures and usage of this route, please see
            Sections
            <a href="#uc_mac_reach" class="xref">9</a>
            ("<a href="#uc_mac_reach" class="xref">Determining Reachability to Unicast MAC Addresses</a>") and
            <a href="#load_bal_uc_pkt" class="xref">14</a>
            ("<a href="#load_bal_uc_pkt" class="xref">Load Balancing of Unicast Packets</a>").<a href="#section-7.2-5" class="pilcrow">¶</a></p>
</section>
<section id="section-7.3">
        <h3 id="name-inclusive-multicast-etherne">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-inclusive-multicast-etherne" class="section-name selfRef">Inclusive Multicast Ethernet Tag Route</a>
        </h3>
<p id="section-7.3-1">An Inclusive Multicast Ethernet Tag route type specific EVPN NLRI
            consists of the following:<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3-2">
<pre>
            +---------------------------------------+
            |  RD (8 octets)                        |
            +---------------------------------------+
            |  Ethernet Tag ID (4 octets)           |
            +---------------------------------------+
            |  IP Address Length (1 octet)          |
            +---------------------------------------+
            |  Originating Router's IP Address      |
            |          (4 or 16 octets)             |
            +---------------------------------------+

</pre><a href="#section-7.3-2" class="pilcrow">¶</a>
</div>
<p id="section-7.3-3">For procedures and usage of this route, please see Sections
            <a href="#handling_multi_dest" class="xref">11</a>
            ("<a href="#handling_multi_dest" class="xref">Handling of Multi-destination Traffic</a>"),
            <a href="#process_uu_pkt" class="xref">12</a>
            ("<a href="#process_uu_pkt" class="xref">Processing of Unknown Unicast Packets</a>"), and
            <a href="#mb" class="xref">16</a>
            ("<a href="#mb" class="xref">Multicast and Broadcast</a>").
            The IP address length is in bits.
            For the purpose of BGP route key processing, only the Ethernet Tag ID,
            IP Address Length, and Originating Router's IP Address fields are
            considered to be part of the prefix in the NLRI.<a href="#section-7.3-3" class="pilcrow">¶</a></p>
</section>
<section id="section-7.4">
        <h3 id="name-ethernet-segment-route">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-ethernet-segment-route" class="section-name selfRef">Ethernet Segment Route</a>
        </h3>
<p id="section-7.4-1">An Ethernet Segment route type specific EVPN NLRI consists of the
            following:<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.4-2">
<pre>
            +---------------------------------------+
            |  RD (8 octets)                        |
            +---------------------------------------+
            |Ethernet Segment Identifier (10 octets)|
            +---------------------------------------+
            |  IP Address Length (1 octet)          |
            +---------------------------------------+
            |  Originating Router's IP Address      |
            |          (4 or 16 octets)             |
            +---------------------------------------+

</pre><a href="#section-7.4-2" class="pilcrow">¶</a>
</div>
<p id="section-7.4-3">For procedures and usage of this route, please see
            <a href="#df_election" class="xref">Section 8.5</a> ("<a href="#df_election" class="xref">Designated Forwarder Election</a>").
            The IP address length is in bits.
            For the purpose of BGP route key processing, only the Ethernet
            Segment ID, IP Address Length, and Originating Router's IP Address
            fields are considered to be part of the prefix in the NLRI.<a href="#section-7.4-3" class="pilcrow">¶</a></p>
</section>
<section id="section-7.5">
        <h3 id="name-esi-label-extended-communit">
<a href="#section-7.5" class="section-number selfRef">7.5. </a><a href="#name-esi-label-extended-communit" class="section-name selfRef">ESI Label Extended Community</a>
        </h3>
<p id="section-7.5-1">This Extended Community is a new transitive Extended Community having
            a Type field value of 0x06 and the Sub-Type 0x01. It may be
            advertised along with Ethernet Auto-discovery routes, and it enables
            split-horizon procedures for multihomed sites as described in
            <a href="#split_horizon" class="xref">Section 8.3</a> ("<a href="#split_horizon" class="xref">Split Horizon</a>").
            The ESI Label field represents an ES
            by the advertising PE, and it is used in split-horizon filtering by
            other PEs that are connected to the same multihomed Ethernet segment.<a href="#section-7.5-1" class="pilcrow">¶</a></p>
<p id="section-7.5-2">The ESI Label field is encoded as 3 octets, where the high-order
            20 bits contain the label value.<a href="#section-7.5-2" class="pilcrow">¶</a></p>
<p id="section-7.5-3"> The ESI label value MAY be zero if no split-horizon filtering procedures 
            are required in any of the VLANs of the Ethernet Segment. This is
            the case in <span>[<a href="#RFC8214" class="xref">RFC8214</a>]</span> or Ethernet Segments using Local Bias procedures
            in <span>[<a href="#I-D.ietf-bess-evpn-mh-split-horizon" class="xref">I-D.ietf-bess-evpn-mh-split-horizon</a>]</span>.<a href="#section-7.5-3" class="pilcrow">¶</a></p>
<p id="section-7.5-4">Each ESI Label extended community is encoded as an 8-octet value, as
            follows:<a href="#section-7.5-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.5-5">
<pre>
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 | Type=0x06     | Sub-Type=0x01 | Flags(1 octet)|  Reserved=0   |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |  Reserved=0   |          ESI Label                            |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre><a href="#section-7.5-5" class="pilcrow">¶</a>
</div>
<p id="section-7.5-6">The low-order bit of the Flags octet is defined as the
            "Single‑Active" bit. A value of 0 means that the multihomed site
            
            is operating in All-Active redundancy mode, and a value of 1 means
            that the multihomed site is operating in Single-Active redundancy
            mode.<a href="#section-7.5-6" class="pilcrow">¶</a></p>
</section>
<div id="es_import_rt">
<section id="section-7.6">
        <h3 id="name-es-import-route-target">
<a href="#section-7.6" class="section-number selfRef">7.6. </a><a href="#name-es-import-route-target" class="section-name selfRef">ES-Import Route Target</a>
        </h3>
<p id="section-7.6-1">This is a new transitive Route Target extended community carried with
            the Ethernet Segment route. When used, it enables all the PEs
            connected to the same multihomed site to import the Ethernet Segment
            routes.<a href="#section-7.6-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-7.6-2">
          <dt id="section-7.6-2.1">+</dt>
          <dd style="margin-left: 1.0em" id="section-7.6-2.2">The value MAY be derived automatically for ESI Type 0 by encoding the high-order 6-octet portion of the 9-octet ESI
            Value, which corresponds to part of the arbitrary value configured, in the ES-Import Route
            Target.<a href="#section-7.6-2.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.6-2.3">+</dt>
          <dd style="margin-left: 1.0em" id="section-7.6-2.4">The value is derived automatically for ESI Types 1, 2, and 3, by encoding the high-order 6-octet portion of the 9-octet ESI
            Value, which corresponds to a MAC address, in the ES-Import Route Target.<a href="#section-7.6-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.6-2.5">+</dt>
          <dd style="margin-left: 1.0em" id="section-7.6-2.6">The value MAY be derived automatically for ESI Types 4 and 5, by encoding the high-order 6-octet portion of the 9-octet ESI
            Value, which corresponds to a Router ID or AS number (4-octets) respectively, and 2-octets of Local Discriminator, in the ES-Import
            Route Target.<a href="#section-7.6-2.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-7.6-3">The format of this Extended Community is as follows:<a href="#section-7.6-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.6-4">
<pre>
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 | Type=0x06     | Sub-Type=0x02 |          ES-Import            ~
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 ~                     ES-Import Cont'd                          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre><a href="#section-7.6-4" class="pilcrow">¶</a>
</div>
<p id="section-7.6-5">This document expands the definition of the Route Target extended
            community to allow the value of the high-order octet (Type field) to
            be 0x06 (in addition to the values specified in <span>[<a href="#RFC4360" class="xref">RFC4360</a>]</span>). The
            low‑order octet (Sub-Type field) value 0x02 indicates that this
            Extended Community is of type "Route Target". The new Type field
            value 0x06 indicates that the structure of this RT is a 6-octet value
            (e.g., a MAC address). A BGP speaker that implements RT Constraint
            <span>[<a href="#RFC4684" class="xref">RFC4684</a>]</span> MUST apply the RT Constraint procedures to the ES-Import RT
            as well.<a href="#section-7.6-5" class="pilcrow">¶</a></p>
<p id="section-7.6-6">For procedures and usage of this extended community, please see <a href="#mh_es_auto_disco" class="xref">Section 8.1</a>
            ("<a href="#mh_es_auto_disco" class="xref">Multihomed Ethernet Segment Auto-discovery</a>").<a href="#section-7.6-6" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-7.7">
        <h3 id="name-mac-mobility-extended-commu">
<a href="#section-7.7" class="section-number selfRef">7.7. </a><a href="#name-mac-mobility-extended-commu" class="section-name selfRef">MAC Mobility Extended Community</a>
        </h3>
<p id="section-7.7-1">This Extended Community is a new transitive Extended Community having
            a Type field value of 0x06 and the Sub-Type 0x00. It may be
            advertised along with MAC/IP Advertisement routes. The procedures
            for using this extended community are described in  <a href="#mac_mobility" class="xref">Section 15</a>
            ("<a href="#mac_mobility" class="xref">MAC Mobility</a>").<a href="#section-7.7-1" class="pilcrow">¶</a></p>
<p id="section-7.7-2">The MAC Mobility extended community is encoded as an 8-octet value,
            as follows:<a href="#section-7.7-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.7-3">
<pre>
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 | Type=0x06     | Sub-Type=0x00 |Flags(1 octet)|  Reserved=0    |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                       Sequence Number                         |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre><a href="#section-7.7-3" class="pilcrow">¶</a>
</div>
<p id="section-7.7-4">The low-order bit of the Flags octet is defined as the
            "Sticky/⁠static" flag and may be set to 1. A value of 1 means that
            the MAC address is static and cannot move. The sequence number is
            used to ensure that PEs retain the correct MAC/IP Advertisement route
            when multiple updates occur for the same MAC address.<a href="#section-7.7-4" class="pilcrow">¶</a></p>
</section>
<div id="default_gw_extcomm">
<section id="section-7.8">
        <h3 id="name-default-gateway-extended-co">
<a href="#section-7.8" class="section-number selfRef">7.8. </a><a href="#name-default-gateway-extended-co" class="section-name selfRef">Default Gateway Extended Community</a>
        </h3>
<p id="section-7.8-1">The Default Gateway community is an Extended Community of an Opaque
            Type (see Section 3.3 of <span>[<a href="#RFC4360" class="xref">RFC4360</a>]</span>).
            It is a transitive community, which means that the first octet is 0x03.
            The value of the second octet (Sub-Type) is 0x0d (Default Gateway) as assigned by IANA.
            The Value field of this community is reserved (set to 0 by the senders,
            ignored by the receivers). For procedures and usage of this
            extended community, please see
            <a href="#default_gw" class="xref">Section 10.1</a> ("<a href="#default_gw" class="xref">Default Gateway</a>").<a href="#section-7.8-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rd">
<section id="section-7.9">
        <h3 id="name-route-distinguisher-assignm">
<a href="#section-7.9" class="section-number selfRef">7.9. </a><a href="#name-route-distinguisher-assignm" class="section-name selfRef">Route Distinguisher Assignment per MAC-VRF</a>
        </h3>
<p id="section-7.9-1">The Route Distinguisher (RD) MUST be set to the RD of the MAC-VRF
            that is advertising the NLRI. An RD MUST be assigned for a given   
            MAC-VRF on a PE. This RD MUST be unique across all MAC-VRFs on a PE.
            It is RECOMMENDED to use the Type 1 RD <span>[<a href="#RFC4364" class="xref">RFC4364</a>]</span>.
            The value field comprises an IP address of the PE (typically, 
            the loopback address) followed by a number unique to the PE. 
            This number may be generated by the PE. In case of VLAN-based or VLAN 
            Bundle services, this number may also be generated out of the Ethernet Tag ID
            for the BD as long as the value does not exceed a length of 16 bits. 
            Or, in the Unique VLAN EVPN case, the low-order 12 bits 
            may be the 12-bit VLAN ID, with the remaining high-order 4 bits set
            to 0.<a href="#section-7.9-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="route_targets">
<section id="section-7.10">
        <h3 id="name-route-targets">
<a href="#section-7.10" class="section-number selfRef">7.10. </a><a href="#name-route-targets" class="section-name selfRef">Route Targets</a>
        </h3>
<p id="section-7.10-1">The EVPN route MAY carry one or more Route Target (RT) extended communities.
            RTs may be configured (as in IP VPNs) or may be derived
            automatically.<a href="#section-7.10-1" class="pilcrow">¶</a></p>
<p id="section-7.10-2">If a PE uses RT Constraint, the PE advertises all such RTs using RT
            Constraints per <span>[<a href="#RFC4684" class="xref">RFC4684</a>]</span>.
            The use of RT Constraints allows each
            EVPN route to reach only those PEs that are configured to import at
            least one RT from the set of RTs carried in the EVPN route.<a href="#section-7.10-2" class="pilcrow">¶</a></p>
<div id="rt_auto_etag">
<section id="section-7.10.1">
          <h4 id="name-auto-derivation-from-the-et">
<a href="#section-7.10.1" class="section-number selfRef">7.10.1. </a><a href="#name-auto-derivation-from-the-et" class="section-name selfRef">Auto-derivation from the Ethernet Tag (VLAN ID)</a>
          </h4>
<p id="section-7.10.1-1">For the "Unique VLAN EVPN" scenario (<a href="#overview" class="xref">Section 4</a>), it is highly desirable to
                auto‑derive the RT from the Ethernet Tag (VLAN ID).
                The procedure for performing such auto-derivation is as
                follows:<a href="#section-7.10.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-7.10.1-2">
            <dt id="section-7.10.1-2.1">+</dt>
            <dd style="margin-left: 1.0em" id="section-7.10.1-2.2">The Global Administrator field of the RT MUST
                    be set to the Autonomous System (AS) number with which the PE
                    is associated.<a href="#section-7.10.1-2.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-7.10.1-2.3">+</dt>
            <dd style="margin-left: 1.0em" id="section-7.10.1-2.4">The 12-bit VLAN ID MUST be encoded in the lowest
                    12 bits of the Local Administrator field, with the remaining bits
                    set to zero.<a href="#section-7.10.1-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-7.10.1-3">For VLAN-based and VLAN Bundle services, the RT may also be auto-derived
                as per the above rules but replacing the 12-bit VLAN ID with a 
                16-bit Ethernet Tag ID configured for the BD. If the Ethernet Tag ID length 
                is 24 bits, the RT for the MAC-VRF can be auto-derived as per <span>[<a href="#RFC8365" class="xref">RFC8365</a>]</span> 
                section 5.1.2.1.<a href="#section-7.10.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="l2attr">
<section id="section-7.11">
        <h3 id="name-evpn-layer-2-attributes-ext">
<a href="#section-7.11" class="section-number selfRef">7.11. </a><a href="#name-evpn-layer-2-attributes-ext" class="section-name selfRef">EVPN Layer 2 Attributes Extended Community</a>
        </h3>
<p id="section-7.11-1"><span>[<a href="#RFC8214" class="xref">RFC8214</a>]</span> defines this extended community ("L2-Attr"),
            to be included with per-EVI Ethernet A-D routes and mandatory if
            multihoming is enabled.<a href="#section-7.11-1" class="pilcrow">¶</a></p>
<p id="section-7.11-2">Usage and applicability of this Extended community to Bridging
            is clarified here.<a href="#section-7.11-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.11-3">
<pre>
              0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
             +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
             |   MBZ         |RSV|RSV|F|C|P|B|  (MBZ = MUST Be Zero)
             +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre><a href="#section-7.11-3" class="pilcrow">¶</a>
</div>
<p id="section-7.11-4">The following bits in Control Flags from <span>[<a href="#RFC8214" class="xref">RFC8214</a>]</span> are
        listed here for completeness only:<a href="#section-7.11-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.11-5">
<pre>
    Name     Meaning
    ---------------------------------------------------------------
    P        If set to 1 in multihoming Single-Active scenarios,
             this flag indicates that the advertising PE is the
             primary PE.  MUST be set to 1 for multihoming
             All-Active scenarios by all active PE(s).

    B        If set to 1 in multihoming Single-Active scenarios,
             this flag indicates that the advertising PE is the
             backup PE.

    C        If set to 1, a control word [RFC4448] MUST be present
             when sending EVPN packets to this PE.  It is
             recommended that the control word be included in the
             absence of an entropy label [RFC6790].&lt;/t&gt;

</pre><a href="#section-7.11-5" class="pilcrow">¶</a>
</div>
<p id="section-7.11-6">The bits in Control Flags are extended by the following defined
            bits:<a href="#section-7.11-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.11-7">
<pre>
    Name     Meaning
    ---------------------------------------------------------------
    F        If set to 1, a Flow Label MUST be present
             when sending EVPN packets to this PE.
             If set to 0, a Flow Label MUST NOT be present
             when sending EVPN packets to this PE.

</pre><a href="#section-7.11-7" class="pilcrow">¶</a>
</div>
<p id="section-7.11-8">For procedures and usage of this extended community, with respect to Control
            Word and Flow Label, please see <a href="#frame_ordering" class="xref">Section 18</a>.
            ("<a href="#frame_ordering" class="xref">Frame Ordering</a>").<a href="#section-7.11-8" class="pilcrow">¶</a></p>
<p id="section-7.11-9">For procedures and usage of this extended community, with respect to
            Primary‑Backup bits, please see <a href="#df_election" class="xref">Section 8.5</a>.
            ("<a href="#df_election" class="xref">Designated Forwarder Election</a>").<a href="#section-7.11-9" class="pilcrow">¶</a></p>
<section id="section-7.11.1">
          <h4 id="name-evpn-layer-2-attributes-par">
<a href="#section-7.11.1" class="section-number selfRef">7.11.1. </a><a href="#name-evpn-layer-2-attributes-par" class="section-name selfRef">EVPN Layer 2 Attributes Partitioning</a>
          </h4>
<p id="section-7.11.1-1">The information carried in the L2-Attr Extended Community may be
                ESI-specific or BD/MAC-VRF-specific.
                In order to minimize the processing overhead of configuration-time
                items such as MTU not expected to change at runtime based on failures,
                the Extended Community from <span>[<a href="#RFC8214" class="xref">RFC8214</a>]</span> is partitioned, with a subset of
                information carried over each Ethernet A-D per EVI and Inclusive
                Multicast routes.<a href="#section-7.11.1-1" class="pilcrow">¶</a></p>
<p id="section-7.11.1-2">The EVPN Layer 2 Attributes Extended Community, when added to
                Inclusive Multicast route:<a href="#section-7.11.1-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-7.11.1-3">
            <dt id="section-7.11.1-3.1">-</dt>
            <dd style="margin-left: 1.0em" id="section-7.11.1-3.2">BD/MAC-VRF attributes MTU, Control Word
                    and Flow Label are conveyed, and;<a href="#section-7.11.1-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-7.11.1-3.3">-</dt>
            <dd style="margin-left: 1.0em" id="section-7.11.1-3.4">per-ESI attributes P, B MUST be zero.<a href="#section-7.11.1-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<div class="alignLeft art-text artwork" id="section-7.11.1-4">
<pre>
    +-------------------------------------------+
    | Type (0x06) / Sub-type (0x04) (2 octets)  |
    +-------------------------------------------+
    | Control Flags (2 octets)                  |
    +-------------------------------------------+
    | L2 MTU (2 octets)                         |
    +-------------------------------------------+
    | Reserved (2 octets)                       |
    +-------------------------------------------+

                           1 1 1 1 1
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | MBZ           |  MBZ  |F|C|MBZ|    (MBZ = MUST Be Zero)
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre><a href="#section-7.11.1-4" class="pilcrow">¶</a>
</div>
<p id="section-7.11.1-5">The EVPN Layer 2 Attributes Extended Community is included on
                Ethernet A-D per EVI route and:<a href="#section-7.11.1-5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-7.11.1-6">
            <dt id="section-7.11.1-6.1">-</dt>
            <dd style="margin-left: 1.0em" id="section-7.11.1-6.2">per-ESI attributes P, B are conveyed, and;<a href="#section-7.11.1-6.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-7.11.1-6.3">-</dt>
            <dd style="margin-left: 1.0em" id="section-7.11.1-6.4">BD/MAC-VRF attributes MTU, Control Word
                    and Flow Label MUST be zero.<a href="#section-7.11.1-6.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<div class="alignLeft art-text artwork" id="section-7.11.1-7">
<pre>
    +-------------------------------------------+
    | Type (0x06) / Sub-type (0x04) (2 octets)  |
    +-------------------------------------------+
    | Control Flags (2 octets)                  |
    +-------------------------------------------+
    | MBZ (2 octets)                            |
    +-------------------------------------------+
    | Reserved (2 octets)                       |
    +-------------------------------------------+

                           1 1 1 1 1
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | MBZ           |    MBZ    |P|B|    (MBZ = MUST Be Zero)
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre><a href="#section-7.11.1-7" class="pilcrow">¶</a>
</div>
<p id="section-7.11.1-8"> Note that in both of the above cases, the values conveyed in this 
             extended community are at the granularity of an individual EVI 
             (or [EVI, BD] for VLAN-aware bundle) and hence may vary for 
             different EVIs.<a href="#section-7.11.1-8" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="route_prioritisation">
<section id="section-7.12">
        <h3 id="name-route-prioritization">
<a href="#section-7.12" class="section-number selfRef">7.12. </a><a href="#name-route-prioritization" class="section-name selfRef">Route Prioritization</a>
        </h3>
<p id="section-7.12-1">In order to achieve the Fast Convergence referred to in
            (<a href="#fast_convergence" class="xref">Section 8.2</a> ("<a href="#fast_convergence" class="xref">Fast Convergence</a>")),
            BGP speakers SHOULD prioritise advertisement, processing and redistribution of
            routes based on relative scale of priority vs. expected or average scale.<a href="#section-7.12-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.12-2">
<li id="section-7.12-2.1">Ethernet A-D per ES (Mass-Withdraw Route Type 1)
                and Ethernet Segment (Route Type 4) are lower scale and highly
                convergence affecting, and SHOULD be handled in first order of
                priority<a href="#section-7.12-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-7.12-2.2">Ethernet A-D per EVI, Inclusive Multicast Ethernet Tag route, and IP Prefix 
                route defined in  <span>[<a href="#RFC9136" class="xref">RFC9136</a>]</span>
                are sent for each Bridge or AC at medium scale and may be convergence affecting,
                and SHOULD be handled in second order of priority<a href="#section-7.12-2.2" class="pilcrow">¶</a>
</li>
          <li id="section-7.12-2.3">MAC advertisement route (zero and nonzero IP portion), Multicast Join Sync and
                Multicast Leave Sync routes defined in <span>[<a href="#I-D.ietf-bess-evpn-igmp-mld-proxy" class="xref">I-D.ietf-bess-evpn-igmp-mld-proxy</a>]</span>
                are considered 'individual routes' and very-high scale or of relatively
                low importance for fast convergence and SHOULD be handled in last order of priority.<a href="#section-7.12-2.3" class="pilcrow">¶</a>
</li>
        </ol>
</section>
</div>
</section>
</div>
<div id="multihoming">
<section id="section-8">
      <h2 id="name-multihoming-functions">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-multihoming-functions" class="section-name selfRef">Multihoming Functions</a>
      </h2>
<p id="section-8-1">This section discusses the functions, procedures, and associated BGP
        routes used to support multihoming in EVPN. This covers both
        multihomed device (MHD) and multihomed network (MHN) scenarios.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="mh_es_auto_disco">
<section id="section-8.1">
        <h3 id="name-multihomed-ethernet-segment">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-multihomed-ethernet-segment" class="section-name selfRef">Multihomed Ethernet Segment Auto-discovery</a>
        </h3>
<p id="section-8.1-1">PEs connected to the same Ethernet segment can automatically discover
            each other with minimal to no configuration through the exchange of
            the Ethernet Segment route.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<div id="es_route">
<section id="section-8.1.1">
          <h4 id="name-constructing-the-ethernet-s">
<a href="#section-8.1.1" class="section-number selfRef">8.1.1. </a><a href="#name-constructing-the-ethernet-s" class="section-name selfRef">Constructing the Ethernet Segment Route</a>
          </h4>
<p id="section-8.1.1-1">The Route Distinguisher (RD) MUST be a Type 1 RD <span>[<a href="#RFC4364" class="xref">RFC4364</a>]</span>.
                The value field comprises an IP address of the PE (typically, the
                loopback address) followed by a number unique to the PE.<a href="#section-8.1.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1.1-2">The Ethernet Segment Identifier (ESI) MUST be set to the 10-octet
                value described in <a href="#ethernet_segment" class="xref">Section 5</a>.<a href="#section-8.1.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1.1-3">The BGP advertisement that advertises the Ethernet Segment route MUST
                also carry an ES-Import Route Target, as defined in <a href="#es_import_rt" class="xref">Section 7.6</a>.<a href="#section-8.1.1-3" class="pilcrow">¶</a></p>
<p id="section-8.1.1-4">The Ethernet Segment route filtering MUST be done such that the
                Ethernet Segment route is imported only by the PEs that are
                multihomed to the same Ethernet segment. To that end, each PE that
                is connected to a particular Ethernet segment constructs an import
                filtering rule to import a route that carries the ES-Import Route
                Target, constructed from the ESI.<a href="#section-8.1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="fast_convergence">
<section id="section-8.2">
        <h3 id="name-fast-convergence">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-fast-convergence" class="section-name selfRef">Fast Convergence</a>
        </h3>
<p id="section-8.2-1">In EVPN, MAC address reachability is learned via the BGP control
            plane over the MPLS network. As such, in the absence of any fast
            protection mechanism, the network convergence time is a function of
            the number of MAC/IP Advertisement routes that must be withdrawn by
            the PE encountering a failure. For highly scaled environments, this
            scheme yields slow convergence.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">To alleviate this, EVPN defines a mechanism to efficiently and
            quickly signal, to remote PE nodes, the need to update their
            forwarding tables upon the occurrence of a failure in connectivity to
            an Ethernet segment. This is done by having each PE advertise a set
            of one or more Ethernet A-D per ES routes for each locally attached
            Ethernet segment (refer to <a href="#es_ead_route" class="xref">Section 8.2.1</a> below for details on how
            these routes are constructed). A PE may need to advertise more than
            one Ethernet A-D per ES route for a given ES because the ES may be in
            a multiplicity of EVIs and the RTs for all of these EVIs may not fit
            into a single route. Advertising a set of Ethernet A-D per ES routes
            for the ES allows each route to contain a subset of the complete set
            of RTs. Each Ethernet A-D per ES route is differentiated from the
            other routes in the set by a different Route Distinguisher (RD).<a href="#section-8.2-2" class="pilcrow">¶</a></p>
<p id="section-8.2-3">Upon a failure in connectivity to the attached segment, the PE
            withdraws the corresponding set of Ethernet A-D per ES routes. This
            triggers all PEs that receive the withdrawal to update their next-hop
            adjacencies for all MAC addresses associated with the Ethernet
            segment in question. If no other PE had advertised an Ethernet A-D per ES
            route for the same segment, then the PE that received the withdrawal
            simply invalidates the MAC entries for that segment. Otherwise, the
            PE updates its next-hop adjacencies accordingly.<a href="#section-8.2-3" class="pilcrow">¶</a></p>
<div id="es_ead_route">
<section id="section-8.2.1">
          <h4 id="name-constructing-ethernet-a-d-p">
<a href="#section-8.2.1" class="section-number selfRef">8.2.1. </a><a href="#name-constructing-ethernet-a-d-p" class="section-name selfRef">Constructing Ethernet A-D per Ethernet Segment Route</a>
          </h4>
<p id="section-8.2.1-1">This section describes the procedures used to construct the Ethernet
                A-D per ES route, which is used for fast convergence (as discussed
                above) and for advertising the ESI label used for split-horizon
                filtering (as discussed in <a href="#split_horizon" class="xref">Section 8.3</a>).
                Support of this route is REQUIRED.<a href="#section-8.2.1-1" class="pilcrow">¶</a></p>
<p id="section-8.2.1-2">The Route Distinguisher (RD) MUST be a Type 1 RD <span>[<a href="#RFC4364" class="xref">RFC4364</a>]</span>. The
                value field comprises an IP address of the PE (typically, the
                loopback address) followed by a number unique to the PE.<a href="#section-8.2.1-2" class="pilcrow">¶</a></p>
<p id="section-8.2.1-3">The Ethernet Segment Identifier MUST be a 10-octet entity as
                described in <a href="#ethernet_segment" class="xref">Section 5</a>
                ("<a href="#ethernet_segment" class="xref">Ethernet Segment</a>"). The Ethernet A-D route
                is not needed when the Segment Identifier is set to 0 (e.g., single-
                homed scenarios). An exception to this rule is described 
                in <span>[<a href="#RFC8317" class="xref">RFC8317</a>]</span>.<a href="#section-8.2.1-3" class="pilcrow">¶</a></p>
<p id="section-8.2.1-4">The Ethernet Tag ID MUST be set to MAX-ET.<a href="#section-8.2.1-4" class="pilcrow">¶</a></p>
<p id="section-8.2.1-5">The MPLS label in the NLRI MUST be set to 0.<a href="#section-8.2.1-5" class="pilcrow">¶</a></p>
<p id="section-8.2.1-6">The ESI Label extended community MUST be included in the route. If
                All-Active redundancy mode is desired, then the "Single-Active" bit
                in the flags of the ESI Label extended community MUST be set to 0 and
                the MPLS label in that Extended Community MUST be set to a valid MPLS
                label value. The MPLS label in this Extended Community is referred
                to as the ESI label and MUST have the same value in each Ethernet A-D
                per ES route advertised for the ES. This label MUST be a downstream
                assigned MPLS label if the advertising PE is using ingress
                replication for receiving multicast, broadcast, or unknown unicast
                traffic from other PEs. If the advertising PE is using P2MP MPLS
                LSPs for sending multicast, broadcast, or unknown unicast traffic,
                then this label MUST be an upstream assigned MPLS label, unless DCB
                allocated labels are used. The usage
                of this label is described in <a href="#split_horizon" class="xref">Section 8.3</a>.<a href="#section-8.2.1-6" class="pilcrow">¶</a></p>
<p id="section-8.2.1-7">If Single-Active redundancy mode is desired, then the "Single-Active"
                bit in the flags of the ESI Label extended community MUST be set to 1
                and the ESI label SHOULD be set to a valid MPLS label value.<a href="#section-8.2.1-7" class="pilcrow">¶</a></p>
<section id="section-8.2.1.1">
            <h5 id="name-ethernet-a-d-route-targets">
<a href="#section-8.2.1.1" class="section-number selfRef">8.2.1.1. </a><a href="#name-ethernet-a-d-route-targets" class="section-name selfRef">Ethernet A-D Route Targets</a>
            </h5>
<p id="section-8.2.1.1-1">Each Ethernet A-D per ES route MUST carry one or more Route Target
                    (RT) extended communities. The set of Ethernet A-D routes per ES MUST carry
                    the entire set of RTs for all the EVPN instances to which the
                    Ethernet segment belongs.<a href="#section-8.2.1.1-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
</section>
</div>
<div id="split_horizon">
<section id="section-8.3">
        <h3 id="name-split-horizon">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-split-horizon" class="section-name selfRef">Split Horizon</a>
        </h3>
<p id="section-8.3-1">Consider a CE that is multihomed to two or more PEs on an Ethernet
            segment ES1 operating in All-Active redundancy mode. If the CE sends
            a broadcast, unknown unicast, or multicast (BUM) packet to one of the
            Non-Designated Forwarder (Non-DF) PEs, say PE1, then PE1 will forward
            that packet to all or a subset of the other PEs in that EVPN
            instance, including the DF PE for that Ethernet segment. In this
            case, the DF PE to which the CE is multihomed MUST drop the packet
            and not forward back to the CE. This filtering is referred to as
            "split-horizon filtering" in this document.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">When a set of PEs are operating in Single-Active redundancy mode, the
            use of this split-horizon filtering mechanism is highly recommended
            because it prevents transient loops at the time of failure or
            recovery that would impact the Ethernet segment -- e.g., when two PEs
            think that both are DFs for that segment before the DF election
            procedure settles down.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3-3">In order to achieve this split-horizon function, every BUM packet
            originating from a Non-DF PE is encapsulated with an MPLS label that
            identifies the Ethernet segment of origin (i.e., the segment from
            which the frame entered the EVPN network). This label is referred to
            as the ESI label and MUST be distributed by all PEs when operating in
            All-Active redundancy mode using a set of Ethernet A-D per ES routes,
            per <a href="#es_ead_route" class="xref">Section 8.2.1</a> above.
            The ESI label SHOULD be distributed by all
            PEs when operating in Single-Active redundancy mode using a set of
            Ethernet A-D per ES routes. These routes are imported by the PEs
            connected to the Ethernet segment and also by the PEs that have at
            least one EVPN instance in common with the Ethernet segment in the
            route. As described in <a href="#es_route" class="xref">Section 8.1.1</a>, the route MUST carry an ESI
            Label extended community with a valid ESI label. The disposition PE
            relies on the value of the ESI label to determine whether or not a
            BUM frame is allowed to egress a specific Ethernet segment.<a href="#section-8.3-3" class="pilcrow">¶</a></p>
<section id="section-8.3.1">
          <h4 id="name-esi-label-assignment">
<a href="#section-8.3.1" class="section-number selfRef">8.3.1. </a><a href="#name-esi-label-assignment" class="section-name selfRef">ESI Label Assignment</a>
          </h4>
<p id="section-8.3.1-1">The following subsections describe the assignment procedures for the
                ESI label, which differ depending on the type of tunnels being used
                to deliver multi-destination packets in the EVPN network.<a href="#section-8.3.1-1" class="pilcrow">¶</a></p>
<section id="section-8.3.1.1">
            <h5 id="name-ingress-replication">
<a href="#section-8.3.1.1" class="section-number selfRef">8.3.1.1. </a><a href="#name-ingress-replication" class="section-name selfRef">Ingress Replication</a>
            </h5>
<p id="section-8.3.1.1-1">Each PE that operates in All-Active or Single-Active
                    redundancy mode
                    and that uses ingress replication to receive BUM traffic advertises a
                    downstream assigned ESI label in the set of Ethernet A-D per ES
                    routes for its attached ES. This label MUST be programmed in the
                    platform label space by the advertising PE, and the forwarding entry
                    for this label must result in NOT forwarding packets received with
                    this label onto the Ethernet segment for which the label was
                    distributed.<a href="#section-8.3.1.1-1" class="pilcrow">¶</a></p>
<p id="section-8.3.1.1-2">The rules for the inclusion of the ESI label in a BUM packet
                    by the ingress PE operating in All-Active redundancy mode are
                    as follows:<a href="#section-8.3.1.1-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-8.3.1.1-3">
              <dt id="section-8.3.1.1-3.1">-</dt>
              <dd style="margin-left: 1.0em" id="section-8.3.1.1-3.2">A Non-DF ingress PE MUST include the ESI label
                        distributed by the DF egress PE in the copy of a BUM packet
                        sent to it.<a href="#section-8.3.1.1-3.2" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-8.3.1.1-3.3">-</dt>
              <dd style="margin-left: 1.0em" id="section-8.3.1.1-3.4">An ingress PE (DF or Non-DF) SHOULD include
                        the ESI label distributed by each Non-DF egress PE in the copy
                        of a BUM packet sent to it.<a href="#section-8.3.1.1-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
<p id="section-8.3.1.1-4">The rule for the inclusion of the ESI label in a BUM packet by the
                    ingress PE operating in Single-Active redundancy mode is as follows:<a href="#section-8.3.1.1-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-8.3.1.1-5">
              <dt id="section-8.3.1.1-5.1">-</dt>
              <dd style="margin-left: 1.0em" id="section-8.3.1.1-5.2">An ingress DF PE SHOULD include the ESI label
                        distributed by the egress PE in the copy of a BUM packet
                        sent to it.<a href="#section-8.3.1.1-5.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
<p id="section-8.3.1.1-6">In both All-Active and Single-Active redundancy mode, an ingress PE
                    MUST NOT include an ESI label in the copy of a BUM packet sent to an
                    egress PE that is not attached to the ES through which the BUM packet
                    entered the EVI.<a href="#section-8.3.1.1-6" class="pilcrow">¶</a></p>
<p id="section-8.3.1.1-7">As an example, consider PE1 and PE2, which are multihomed to CE1 on
                    ES1 and operating in All-Active multihoming mode. Further, consider
                    that PE1 is using P2P or MP2P LSPs to send packets to PE2. Consider
                    that PE1 is the Non-DF for VLAN1 and PE2 is the DF for VLAN1, and PE1
                    receives a BUM packet from CE1 on VLAN1 on ES1. In this scenario,
                    PE2 distributes an Inclusive Multicast Ethernet Tag route for VLAN1
                    corresponding to an EVPN instance. So, when PE1 sends a BUM packet
                    that it receives from CE1, it MUST first push onto the MPLS label
                    stack the ESI label that PE2 has distributed for ES1. It MUST then
                    push onto the MPLS label stack the MPLS label distributed by PE2 in
                    the Inclusive Multicast Ethernet Tag route for VLAN1. The resulting
                    packet is further encapsulated in the P2P or MP2P LSP label stack
                    required to transmit the packet to PE2. When PE2 receives this
                    packet, it determines, from the top MPLS label, the set of ESIs to
                    which it will replicate the packet after any P2P or MP2P LSP labels
                    have been removed. If the next label is the ESI label assigned by
                    PE2 for ES1, then PE2 MUST NOT forward the packet onto ES1. If the
                    next label is an ESI label that has not been assigned by PE2, then
                    PE2 MUST drop the packet. It should be noted that in this scenario,
                    if PE2 receives a BUM packet for VLAN1 from CE1, then it SHOULD
                    encapsulate the packet with an ESI label received from PE1 when
                    sending it to PE1 in order to avoid any transient loops during a
                    failure scenario that would impact ES1 (e.g., port or link failure).<a href="#section-8.3.1.1-7" class="pilcrow">¶</a></p>
</section>
<div id="p2mp_lsp">
<section id="section-8.3.1.2">
            <h5 id="name-p2mp-mpls-lsps">
<a href="#section-8.3.1.2" class="section-number selfRef">8.3.1.2. </a><a href="#name-p2mp-mpls-lsps" class="section-name selfRef">P2MP MPLS LSPs</a>
            </h5>
<p id="section-8.3.1.2-1">The Non-DF PEs that operate in All-Active redundancy mode and that
                    use P2MP LSPs to send BUM traffic advertise an upstream assigned ESI
                    label in the set of Ethernet A-D per ES routes for their common
                    attached ES. This label is upstream assigned by the PE that
                    advertises the route. This label MUST be programmed by the other PEs
                    that are connected to the ESI advertised in the route, in the context
                    label space for the advertising PE. Further, the forwarding entry
                    for this label must result in NOT forwarding packets received with
                    this label onto the Ethernet segment for which the label was
                    distributed. This label MUST also be programmed by the other PEs
                    that import the route but are not connected to the ESI advertised in
                    the route, in the context label space for the advertising PE.
                    Further, the forwarding entry for this label must be a label pop with
                    no other associated action.<a href="#section-8.3.1.2-1" class="pilcrow">¶</a></p>
<p id="section-8.3.1.2-2">The DF PE that operates in Single-Active redundancy mode and that
                    uses P2MP LSPs to send BUM traffic should advertise an upstream
                    assigned ESI label in the set of Ethernet A-D per ES routes for its
                    attached ES, just as described in the previous paragraph.<a href="#section-8.3.1.2-2" class="pilcrow">¶</a></p>
<p id="section-8.3.1.2-3">As an example, consider PE1 and PE2, which are multihomed to CE1 on
                    ES1 and operating in All-Active multihoming mode. Also, consider
                    that PE3 belongs to one of the EVPN instances of ES1. Further,
                    assume that PE1, which is the Non-DF, is using P2MP MPLS LSPs to send
                    BUM packets. When PE1 sends a BUM packet that it receives from CE1,
                    it MUST first push onto the MPLS label stack the ESI label that it
                    has assigned for the ESI on which the packet was received. The
                    resulting packet is further encapsulated in the P2MP MPLS label stack
                    necessary to transmit the packet to the other PEs. Penultimate hop
                    popping MUST be disabled on the P2MP LSPs used in the MPLS transport
                    infrastructure for EVPN. When PE2 receives this packet, it
                    decapsulates the top MPLS label and forwards the packet using the
                    context label space determined by the top label. If the next label
                    is the ESI label assigned by PE1 to ES1, then PE2 MUST NOT forward
                    the packet onto ES1. When PE3 receives this packet, it decapsulates
                    the top MPLS label and forwards the packet using the context label
                    space determined by the top label. If the next label is the ESI
                    label assigned by PE1 to ES1 and PE3 is not connected to ES1, then
                    PE3 MUST pop the label and flood the packet over all local ESIs in
                    that EVPN instance. It should be noted that when PE2 sends a BUM
                    frame over a P2MP LSP, it should encapsulate the frame with an ESI
                    label even though it is the DF for that VLAN, in order to avoid any
                    transient loops during a failure scenario that would impact ES1
                    (e.g., port or link failure).<a href="#section-8.3.1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mp2mp_lsp">
<section id="section-8.3.1.3">
            <h5 id="name-mp2mp-mpls-lsps">
<a href="#section-8.3.1.3" class="section-number selfRef">8.3.1.3. </a><a href="#name-mp2mp-mpls-lsps" class="section-name selfRef">MP2MP MPLS LSPs</a>
            </h5>
<p id="section-8.3.1.3-1">The procedures for MP2MP tunnels follow <a href="#p2mp_lsp" class="xref">Section 8.3.1.2</a>, with the
             exceptions described in this section.<a href="#section-8.3.1.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3.1.3-2">When MP2MP tunnels are used, ESI-labels MUST be allocated from a DCB and
         the same label must be used by all the PEs attached to the same Ethernet 
         Segment.<a href="#section-8.3.1.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3.1.3-3">In that way, any egress PE with local Ethernet Segments can identify the 
                    source ES of the received BUM packets.<a href="#section-8.3.1.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</section>
</div>
<div id="aliasing">
<section id="section-8.4">
        <h3 id="name-aliasing-and-backup-path">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-aliasing-and-backup-path" class="section-name selfRef">Aliasing and Backup Path</a>
        </h3>
<p id="section-8.4-1">In the case where a CE is multihomed to multiple PE nodes, using a
            Link Aggregation Group (LAG) with All-Active redundancy, it is
            possible that only a single PE learns a set of the MAC addresses
            associated with traffic transmitted by the CE. This leads to a
            situation where remote PE nodes receive MAC/IP Advertisement routes
            for these addresses from a single PE, even though multiple PEs are
            connected to the multihomed segment. As a result, the remote PEs are
            not able to effectively load balance traffic among the PE nodes
            connected to the multihomed Ethernet segment. This could be the
            case, for example, when the PEs perform data-plane learning on the
            access, and the load-balancing function on the CE hashes traffic from
            a given source MAC address to a single PE.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<p id="section-8.4-2">Another scenario where this occurs is when the PEs rely on control-
            plane learning on the access (e.g., using ARP), since ARP traffic
            will be hashed to a single link in the LAG.<a href="#section-8.4-2" class="pilcrow">¶</a></p>
<p id="section-8.4-3">To address this issue, EVPN introduces the concept of 'aliasing',
            which is the ability of a PE to signal that it has reachability to an
            EVPN instance on a given ES even when it has learned no MAC addresses
            from that EVI/ES. The Ethernet A-D per EVI route is used for this
            purpose. A remote PE that receives a MAC/IP Advertisement route with
            a non-reserved ESI SHOULD consider the advertised MAC address to be
            reachable via all PEs that have advertised reachability to that MAC
            address's EVI/ES/Ethernet Tag ID via the combination of an Ethernet A-D per EVI route
            for that EVI/ES/Ethernet Tag ID AND Ethernet A-D
            per ES routes for that ES with the "Single-Active" bit in the flags
            of the ESI Label extended community set to 0.<a href="#section-8.4-3" class="pilcrow">¶</a></p>
<p id="section-8.4-4">Note that the Ethernet A-D per EVI route may be received by a remote
            PE before it receives the set of Ethernet A-D per ES routes.
            Therefore, in order to handle corner cases and race conditions, the
            Ethernet A-D per EVI route MUST NOT be used for traffic forwarding by
            a remote PE until it also receives the associated set of Ethernet A-D
            per ES routes.<a href="#section-8.4-4" class="pilcrow">¶</a></p>
<p id="section-8.4-5">The backup path is a closely related function, but it is used in
            Single-Active redundancy mode. In this case, a PE also advertises
            that it has reachability to a given EVI/ES using the same combination
            of Ethernet A-D per EVI route and Ethernet A-D per ES route as
            discussed above, but with the "Single-Active" bit in the flags of the
            ESI Label extended community set to 1. A remote PE that receives a
            MAC/IP Advertisement route with a non-reserved ESI SHOULD consider
            the advertised MAC address to be reachable via any PE that has
            advertised this combination of Ethernet A-D routes, and it SHOULD
            install a backup path for that MAC address.<a href="#section-8.4-5" class="pilcrow">¶</a></p>
<p id="section-8.4-6"> Please see <a href="#sa_redundancy_mode" class="xref">Section 14.1.1</a> for a description of the
         backup paths operation.<a href="#section-8.4-6" class="pilcrow">¶</a></p>
<section id="section-8.4.1">
          <h4 id="name-constructing-ethernet-a-d-pe">
<a href="#section-8.4.1" class="section-number selfRef">8.4.1. </a><a href="#name-constructing-ethernet-a-d-pe" class="section-name selfRef">Constructing Ethernet A-D per EVPN Instance Route</a>
          </h4>
<p id="section-8.4.1-1">This section describes the procedures used to construct the Ethernet
                A-D per EVPN instance (EVI) route, which is used for aliasing (as
                discussed above). Support of this route is OPTIONAL.<a href="#section-8.4.1-1" class="pilcrow">¶</a></p>
<p id="section-8.4.1-2">The Route Distinguisher (RD) MUST be set per <a href="#rd" class="xref">Section 7.9</a>.<a href="#section-8.4.1-2" class="pilcrow">¶</a></p>
<p id="section-8.4.1-3">The Ethernet Segment Identifier MUST be a 10-octet entity as
                described in
                <a href="#ethernet_segment" class="xref">Section 5</a> ("<a href="#ethernet_segment" class="xref">Ethernet Segment</a>").
                The Ethernet A-D route
                is not needed when the Segment Identifier is set to 0.<a href="#section-8.4.1-3" class="pilcrow">¶</a></p>
<p id="section-8.4.1-4">The Ethernet Tag ID is set as defined in <a href="#ethernet_tag_id" class="xref">Section 6</a>.<a href="#section-8.4.1-4" class="pilcrow">¶</a></p>
<p id="section-8.4.1-5">Note that the above allows the Ethernet A-D per EVI route to be advertised
                with one of the following granularities:<a href="#section-8.4.1-5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-8.4.1-6">
            <dt id="section-8.4.1-6.1">+</dt>
            <dd style="margin-left: 1.0em" id="section-8.4.1-6.2">
              <p id="section-8.4.1-6.2.1">
                One Ethernet A-D route per &lt;ESI, Ethernet Tag ID&gt; tuple per<a href="#section-8.4.1-6.2.1" class="pilcrow">¶</a></p>
<p id="section-8.4.1-6.2.2">
                MAC-VRF. This is applicable when the PE uses MPLS-based
                disposition with VID translation or may be applicable when the<a href="#section-8.4.1-6.2.2" class="pilcrow">¶</a></p>
<p id="section-8.4.1-6.2.3">
                PE uses MAC-based disposition with VID translation.<a href="#section-8.4.1-6.2.3" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.4.1-6.3">+</dt>
            <dd style="margin-left: 1.0em" id="section-8.4.1-6.4">One Ethernet A-D route for each &lt;ESI&gt;
                per MAC-VRF (where the Ethernet Tag ID is set to 0).
                This is applicable when the PE uses MAC-based disposition or
                MPLS-based disposition without VID translation.<a href="#section-8.4.1-6.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-8.4.1-7">The usage of the MPLS label is described in
                <a href="#load_bal_uc_pkt" class="xref">Section 14</a> ("<a href="#load_bal_uc_pkt" class="xref">Load Balancing of Unicast Packets</a>").<a href="#section-8.4.1-7" class="pilcrow">¶</a></p>
<p id="section-8.4.1-8">The Next Hop field of the MP_REACH_NLRI attribute of the route MUST
                be set to the IPv4 or IPv6 address of the advertising PE.<a href="#section-8.4.1-8" class="pilcrow">¶</a></p>
<p id="section-8.4.1-9">The Ethernet A-D per EVI route MUST carry one or more Route Target (RT)
                extended communities, per <a href="#route_targets" class="xref">Section 7.10</a>.<a href="#section-8.4.1-9" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="df_election">
<section id="section-8.5">
        <h3 id="name-designated-forwarder-electi">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-designated-forwarder-electi" class="section-name selfRef">Designated Forwarder Election</a>
        </h3>
<p id="section-8.5-1">Consider a CE that is a host or a router that is multihomed directly
            to more than one PE in an EVPN instance on a given Ethernet segment.
            
            In this scenario, only one of the PEs, referred to as the Designated
            Forwarder (DF), is responsible for certain actions:<a href="#section-8.5-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-8.5-2">
          <dt id="section-8.5-2.1">-</dt>
          <dd style="margin-left: 1.0em" id="section-8.5-2.2">Sending broadcast and multicast traffic for a given EVI
                to that CE.<a href="#section-8.5-2.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-8.5-2.3">-</dt>
          <dd style="margin-left: 1.0em" id="section-8.5-2.4">If the flooding of unknown unicast traffic
                (i.e., traffic for which a PE does not know the destination
                MAC address, see <a href="#process_uu_pkt" class="xref">Section 12</a>)
                is allowed, sending unknown unicast traffic for a given EVI to that CE.<a href="#section-8.5-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-8.5-2.5">-</dt>
          <dd style="margin-left: 1.0em" id="section-8.5-2.6">If the multihoming mode is Single-Active,
                sending (known) unicast traffic for a given EVI to that CE.<a href="#section-8.5-2.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-8.5-3">

            Note that this behavior, which allows selecting a DF at the
            granularity of &lt;ES, EVI&gt; for is the default behavior in
            this specification.<a href="#section-8.5-3" class="pilcrow">¶</a></p>
<p id="section-8.5-4">In this same scenario, a second PE referred to as the Backup‑Designated Forwarder
            (Backup-DF or BDF), is responsible for assuming the role of DF in the event
            of DF's failure. Until this occurs, the Backup-DF PE is a subset of, and behaves like, a Non-DF
            PE for all forwarding considerations.<a href="#section-8.5-4" class="pilcrow">¶</a></p>
<p id="section-8.5-5">All other PEs, referred to as Non-Designated Forwarder (Non-DF or NDF)
          are not responsible for any forwarding nor of assuming any functionality
            from the DF in the event of its failure.<a href="#section-8.5-5" class="pilcrow">¶</a></p>
<p id="section-8.5-6">The default procedure for DF election at the granularity of
            &lt;ES, EVI&gt; is referred to as "service carving".
            With service
            carving, it is possible to perform load‑balancing of
            traffic destined to a given segment.

            The load‑balancing procedure carves the set of EVIs on that ES among the PEs
            nodes evenly such that every PE is the DF for a disjoint and distinct
            set of EVIs for that ES.
            The procedure for service carving is as follows according to the 
            DF Election Finite State Machine as defined in <span>[<a href="#RFC8584" class="xref">RFC8584</a>]</span> Section 2.1:<a href="#section-8.5-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8.5-7">
<li id="section-8.5-7.1">
            <p id="section-8.5-7.1.1">When a PE discovers the ESI of the attached Ethernet segment,<a href="#section-8.5-7.1.1" class="pilcrow">¶</a></p>
<p id="section-8.5-7.1.2">
                it advertises an Ethernet Segment route with the associated
                ES‑Import extended community.<a href="#section-8.5-7.1.2" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.5-7.2">The PE then starts a timer (default value = 3 seconds) to allow
                the reception of Ethernet Segment routes from other PE nodes
                connected to the same Ethernet segment. This timer value should
                be the same across all PEs connected to the same Ethernet segment.<a href="#section-8.5-7.2" class="pilcrow">¶</a>
</li>
          <li id="section-8.5-7.3">
            <p id="section-8.5-7.3.1">When the timer expires, each PE builds an ordered list of the IP
                addresses of all the PE nodes connected to the Ethernet segment
                (including itself), in increasing numeric value. Each IP address
                in this list is extracted from the "IP Address length" and "Originating Router's IP
                address" fields of the advertised Ethernet Segment route. Every PE
                is then given an ordinal indicating its position in the ordered
                list, starting with 0 as the ordinal for the PE with the
                lowest IP address length and numeric value tuple. The ordinals are used to determine
                which PE node will be the DF for a given EVPN instance on the
                Ethernet segment, using the following rule:<a href="#section-8.5-7.3.1" class="pilcrow">¶</a></p>
<p id="section-8.5-7.3.2">
                Assuming a redundancy group of N PE nodes, the PE with ordinal i is the DF for an &lt;ES, EVI&gt; when (V mod N)
                = i, where V is the Ethernet tag for that EVI. For VLAN-Aware Bundle service, then the
                numerically lowest Ethernet tag in that EVI MUST be
                used in the modulo function.<a href="#section-8.5-7.3.2" class="pilcrow">¶</a></p>
<p id="section-8.5-7.3.3">
                It should be noted that using the "Originating Router's IP
                address" field in the Ethernet Segment route to get the PE IP
                address needed for the ordered list allows for a CE to be
                multihomed across different ASes if such a need ever arises.<a href="#section-8.5-7.3.3" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.5-7.4">
            <p id="section-8.5-7.4.1">For each EVPN instance, a second list of the IP addresses 
              of all the PE nodes connected to the Ethernet segment is built. 
                The PE which was determined as DF above is removed from that 
                ordered candidate list, forming a backup redundancy group of M PE 
                nodes.  Every remaining PE is then given a second ordinal indicating 
                its position in the secondary ordered list according to the same 
                criteria as in step 3 above.<a href="#section-8.5-7.4.1" class="pilcrow">¶</a></p>
<p id="section-8.5-7.4.2">
                The second ordinals are used to determine which PE nodes will be 
                the BDF for a given EVPN instance on the Ethernet segment, using 
                the same modulo rule as above, (V mod M) = i.<a href="#section-8.5-7.4.2" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.5-7.5">
            <p id="section-8.5-7.5.1">The PE that is elected as a DF for a given &lt;ES, EVI&gt;
                will unblock BUM traffic, or all traffic if in Single-Active mode, for that EVI on the corresponding ES.
                Note that the DF PE unblocks BUM traffic in the egress direction towards the
                segment. All Non-DF PEs, including the Backup-DF PE, continue to drop multi‑destination
                traffic in the egress direction towards that
                &lt;ES, EVI&gt;.<a href="#section-8.5-7.5.1" class="pilcrow">¶</a></p>
<p id="section-8.5-7.5.2">
                In the case of link or port failure, the affected PE withdraws its
                Ethernet Segment route. This will re-trigger the service carving
                procedures on all the PEs in the redundancy group: the expected 
              new-DF will be BDF previously calculated in step 5. For PE node
                failure, or upon PE commissioning or decommissioning, the PEs
                re-trigger the service carving. In the case of Single-Active
                multihoming, when a service moves from one PE in the redundancy
                group to another PE as a result of re-carving, the PE, which ends
                up being the elected DF for the service, SHOULD trigger a MAC
                address flush notification towards the associated Ethernet
                segment. This can be done, for example, using the IEEE 802.1ak
                Multiple VLAN Registration Protocol (MVRP) 'new' declaration.<a href="#section-8.5-7.5.2" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-8.5-8">It is RECOMMENDED that all future DF Election algorithms specify 
          an algorithm to select one Designated Forwarder (DF) PE, one Backup-DF PE 
          and a residual number of Non-DF PE(s).<a href="#section-8.5-8" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-8.6">
        <h3 id="name-signaling-primary-and-backu">
<a href="#section-8.6" class="section-number selfRef">8.6. </a><a href="#name-signaling-primary-and-backu" class="section-name selfRef">Signaling Primary and Backup DF Elected PEs</a>
        </h3>
<p id="section-8.6-1"> Once the Primary and Backup DF Elected PEs for a given 
            &lt;ES, EVI&gt; are
            determined, the multi-homed PEs for that ES will each advertise
            an Ethernet A-D per EVI route for that EVI and each will include
            an L2-Attr extended community with the P and B bits set to 
            reflect the advertising PE's role for that EVI.<a href="#section-8.6-1" class="pilcrow">¶</a></p>
<p id="section-8.6-2"> It should be noted if L2-Attr extended community is included 
         for All-Active mode, then the P bit must be set for all PEs in
         the redundancy group.<a href="#section-8.6-2" class="pilcrow">¶</a></p>
</section>
<div id="interop_sh">
<section id="section-8.7">
        <h3 id="name-interoperability-with-singl">
<a href="#section-8.7" class="section-number selfRef">8.7. </a><a href="#name-interoperability-with-singl" class="section-name selfRef">Interoperability with Single-Homing PEs</a>
        </h3>
<p id="section-8.7-1">Let's refer to PEs that only support single-homed CE devices as
            single-homing PEs. For single-homing PEs, all the above multihoming
            procedures can be omitted; however, to allow for single-homing PEs
            
            to fully interoperate with multihoming PEs, some of the multihoming
            procedures described above SHOULD be supported even by single-
            
            homing PEs:<a href="#section-8.7-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-8.7-2">
          <dt id="section-8.7-2.1">-</dt>
          <dd style="margin-left: 1.0em" id="section-8.7-2.2">procedures related to processing Ethernet A-D routes
                for the purpose of fast convergence
                (<a href="#fast_convergence" class="xref">Section 8.2</a> ("<a href="#fast_convergence" class="xref">Fast Convergence</a>")), to
                let single-homing PEs benefit from fast convergence<a href="#section-8.7-2.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-8.7-2.3">-</dt>
          <dd style="margin-left: 1.0em" id="section-8.7-2.4">procedures related to processing Ethernet A-D routes
                for the purpose of aliasing
                (<a href="#aliasing" class="xref">Section 8.4</a> ("<a href="#aliasing" class="xref">Aliasing and Backup Path</a>")), to let
                single-homing PEs benefit from load balancing<a href="#section-8.7-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-8.7-2.5">-</dt>
          <dd style="margin-left: 1.0em" id="section-8.7-2.6">procedures related to processing Ethernet A-D routes
                for the purpose of a backup path
                (<a href="#aliasing" class="xref">Section 8.4</a> ("<a href="#aliasing" class="xref">Aliasing and Backup Path</a>")), to let
                single-homing PEs benefit from the corresponding convergence improvement<a href="#section-8.7-2.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="uc_mac_reach">
<section id="section-9">
      <h2 id="name-determining-reachability-to">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-determining-reachability-to" class="section-name selfRef">Determining Reachability to Unicast MAC Addresses</a>
      </h2>
<p id="section-9-1">PEs forward packets that they receive based on the destination MAC
        address. This implies that PEs must be able to learn how to reach a
        given destination unicast MAC address.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">There are two components to MAC address learning -- "local learning"
        and "remote learning":<a href="#section-9-2" class="pilcrow">¶</a></p>
<section id="section-9.1">
        <h3 id="name-local-learning">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-local-learning" class="section-name selfRef">Local Learning</a>
        </h3>
<p id="section-9.1-1">A particular PE must be able to learn the MAC addresses from the CEs
            that are connected to it. This is referred to as local learning.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">The PEs in a particular EVPN instance MUST support local data-plane
            learning using standard IEEE Ethernet learning procedures. A PE must
            be capable of learning MAC addresses in the data plane when it
            receives packets such as the following from the CE network:<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-9.1-3">
          <dt id="section-9.1-3.1">-</dt>
          <dd style="margin-left: 1.0em" id="section-9.1-3.2">DHCP requests<a href="#section-9.1-3.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-3.3">-</dt>
          <dd style="margin-left: 1.0em" id="section-9.1-3.4">An ARP Request for its own MAC<a href="#section-9.1-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-3.5">-</dt>
          <dd style="margin-left: 1.0em" id="section-9.1-3.6">An ARP Request for a peer<a href="#section-9.1-3.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-9.1-4">

            Alternatively, PEs MAY learn the MAC addresses of the CEs in the
            control plane or via management-plane integration between the PEs and
            the CEs.<a href="#section-9.1-4" class="pilcrow">¶</a></p>
<p id="section-9.1-5">There are applications where a MAC address that is reachable via a
            given PE on a locally attached segment (e.g., with ESI X) may move,
            such that it becomes reachable via another PE on another segment
            (e.g., with ESI Y). This is referred to as "MAC Mobility".
            Procedures to support this are described in
             <a href="#mac_mobility" class="xref">Section 15</a>
            ("<a href="#mac_mobility" class="xref">MAC Mobility</a>").<a href="#section-9.1-5" class="pilcrow">¶</a></p>
</section>
<section id="section-9.2">
        <h3 id="name-remote-learning">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-remote-learning" class="section-name selfRef">Remote Learning</a>
        </h3>
<p id="section-9.2-1">A particular PE must be able to determine how to send traffic to MAC
            addresses that belong to or are behind CEs connected to other PEs,
            i.e., to remote CEs or hosts behind remote CEs. We call such MAC
            addresses "remote" MAC addresses.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<p id="section-9.2-2">This document requires a PE to learn remote MAC addresses in the
            control plane. In order to achieve this, each PE advertises the MAC
            addresses it learns from its locally attached CEs in the control
            plane, to all the other PEs in that EVPN instance, using MP-BGP and,
            specifically, the MAC/IP Advertisement route.<a href="#section-9.2-2" class="pilcrow">¶</a></p>
<section id="section-9.2.1">
          <h4 id="name-constructing-mac-ip-address">
<a href="#section-9.2.1" class="section-number selfRef">9.2.1. </a><a href="#name-constructing-mac-ip-address" class="section-name selfRef">Constructing MAC/IP Address Advertisement</a>
          </h4>
<p id="section-9.2.1-1">BGP is extended to advertise these MAC addresses using the MAC/IP
                Advertisement route type in the EVPN NLRI.<a href="#section-9.2.1-1" class="pilcrow">¶</a></p>
<p id="section-9.2.1-2">The RD MUST be set per <a href="#rd" class="xref">Section 7.9</a>.<a href="#section-9.2.1-2" class="pilcrow">¶</a></p>
<p id="section-9.2.1-3">The Ethernet Segment Identifier is set to the 10-octet ESI described
                in <a href="#ethernet_segment" class="xref">Section 5</a>
                ("<a href="#ethernet_segment" class="xref">Ethernet Segment</a>").<a href="#section-9.2.1-3" class="pilcrow">¶</a></p>
<p id="section-9.2.1-4">The Ethernet Tag ID is set as defined in <a href="#ethernet_tag_id" class="xref">Section 6</a>.<a href="#section-9.2.1-4" class="pilcrow">¶</a></p>
<p id="section-9.2.1-5">The MAC Address Length field is in bits, and it is set to 48. MAC
                address length values other than 48 bits are outside the scope of
                this document. The encoding of a MAC address MUST be the 6-octet MAC
                address specified by <span>[<a href="#IEEE.802.1Q_2014" class="xref">IEEE.802.1Q_2014</a>]</span> and
                <span>[<a href="#IEEE.802.1D_2004" class="xref">IEEE.802.1D_2004</a>]</span>.<a href="#section-9.2.1-5" class="pilcrow">¶</a></p>
<p id="section-9.2.1-6">The IP Address field is optional. By default, the IP Address Length
                field is set to 0, and the IP Address field is omitted from the
                route. When a valid IP address needs to be advertised, it is then
                encoded in this route. When an IP address is present, the IP Address
                Length field is in bits, and it is set to 32 or 128 bits. Other IP
                Address Length values are outside the scope of this document. The
                encoding of an IP address MUST be either 4 octets for IPv4 or
                16 octets for IPv6. The Length field of the EVPN NLRI (which is in
                octets and is described in <a href="#evpn_routes" class="xref">Section 7</a>) is sufficient to determine
                whether an IP address is encoded in this route and, if so, whether
                the encoded IP address is IPv4 or IPv6.<a href="#section-9.2.1-6" class="pilcrow">¶</a></p>
<p id="section-9.2.1-7">The MPLS Label1 field is encoded as 3 octets, where the high-order
                20 bits contain the label value. The MPLS Label1 MUST be downstream
                assigned, and it is associated with the MAC address being advertised
                by the advertising PE. The advertising PE uses this label when it
                receives an MPLS-encapsulated packet to perform forwarding based on
                the destination MAC address toward the CE. The forwarding procedures
                are specified in Sections <a href="#fwd_uc_pkt" class="xref">13</a> and
                <a href="#load_bal_uc_pkt" class="xref">14</a>.<a href="#section-9.2.1-7" class="pilcrow">¶</a></p>
<p id="section-9.2.1-8">A PE may advertise the same single EVPN label for all MAC addresses
                in a given MAC-VRF. This label assignment is referred to as a per
                MAC-VRF label assignment. Alternatively, a PE may advertise a unique
                EVPN label per &lt;MAC-VRF, Ethernet tag&gt; combination. This label
                assignment is referred to as a per &lt;MAC-VRF, Ethernet tag&gt; label
                assignment. As a third option, a PE may advertise a unique EVPN
                label per &lt;ESI, Ethernet tag&gt; combination.
                This label assignment is
                referred to as a per &lt;ESI, Ethernet tag&gt; label assignment. As a
                fourth option, a PE may advertise a unique EVPN label per MAC
                address. This label assignment is referred to as a per MAC label
                assignment. All of these label assignment methods have their
                trade‑offs. The choice of a particular label assignment methodology
                is purely local to the PE that originates the route.<a href="#section-9.2.1-8" class="pilcrow">¶</a></p>
<p id="section-9.2.1-9">An assignment per MAC-VRF label requires the least number of EVPN
                labels but requires a MAC lookup in addition to an MPLS lookup on an
                egress PE for forwarding. On the other hand, a unique label per
                &lt;ESI, Ethernet tag&gt; or a unique label per MAC allows an egress
                PE to
                forward a packet that it receives from another PE, to the connected
                CE, after looking up only the MPLS labels without having to perform a
                MAC lookup. This includes the capability to perform appropriate VLAN
                ID translation on egress to the CE.<a href="#section-9.2.1-9" class="pilcrow">¶</a></p>
<p id="section-9.2.1-10">The MPLS Label2 field is an optional field. If it is present, then
                it is encoded as 3 octets, where the high-order 20 bits contain the
                label value.<a href="#section-9.2.1-10" class="pilcrow">¶</a></p>
<p id="section-9.2.1-11">The Next Hop field of the MP_REACH_NLRI attribute of the route MUST
                be set to the IPv4 or IPv6 address of the advertising PE.<a href="#section-9.2.1-11" class="pilcrow">¶</a></p>
<p id="section-9.2.1-12">The BGP advertisement for the MAC/IP Advertisement route MUST also
                carry one or more Route Target (RT) extended communities. RTs may be
                configured (as in IP VPNs) or may be derived automatically in the
                "Unique VLAN EVPN" case from the Ethernet Tag (VLAN ID), as described in
                <a href="#rt_auto_etag" class="xref">Section 7.10.1</a>.<a href="#section-9.2.1-12" class="pilcrow">¶</a></p>
<p id="section-9.2.1-13">It is to be noted that this document does not require PEs to create
                forwarding state for remote MACs when they are learned in the control
                plane. When this forwarding state is actually created is a local
                implementation matter.<a href="#section-9.2.1-13" class="pilcrow">¶</a></p>
</section>
<section id="section-9.2.2">
          <h4 id="name-route-resolution">
<a href="#section-9.2.2" class="section-number selfRef">9.2.2. </a><a href="#name-route-resolution" class="section-name selfRef">Route Resolution</a>
          </h4>
<p id="section-9.2.2-1">If the Ethernet Segment Identifier field in a received MAC/IP
                Advertisement route is set to the reserved ESI value of 0 or MAX-ESI,
                then if the receiving PE decides to install forwarding state for the
                associated MAC address, it MUST be based on the MAC/IP Advertisement
                route alone.<a href="#section-9.2.2-1" class="pilcrow">¶</a></p>
<p id="section-9.2.2-2">If the Ethernet Segment Identifier field in a received MAC/IP
                Advertisement route is set to a non-reserved ESI, and the receiving
                PE is locally attached to the same ESI, then the PE does not alter
                its forwarding state based on the received route. This ensures that
                local routes are preferred to remote routes.<a href="#section-9.2.2-2" class="pilcrow">¶</a></p>
<p id="section-9.2.2-3">If the Ethernet Segment Identifier field in a received MAC/IP
                Advertisement route is set to a non-reserved ESI, then if the
                receiving PE decides to install forwarding state for the associated
                MAC address, it MUST be when both the MAC/IP Advertisement route AND
                the associated set of Ethernet A-D per ES routes have been received.
                The dependency of MAC route installation on Ethernet A-D per ES
                routes is to ensure that MAC routes don't get accidentally installed
                during a mass withdraw period.<a href="#section-9.2.2-3" class="pilcrow">¶</a></p>
<p id="section-9.2.2-4">To illustrate this with an example, consider two PEs (PE1 and PE2)
                connected to a multihomed Ethernet segment ES1. All-Active
                redundancy mode is assumed. A given MAC address M1 is learned by PE1
                but not PE2. On PE3, the following states may arise:<a href="#section-9.2.2-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-9.2.2-5">
            <dt id="section-9.2.2-5.1">T1  </dt>
            <dd style="margin-left: 3.0em" id="section-9.2.2-5.2">When the MAC/IP Advertisement route
                    from PE1 and the set of
                    Ethernet A-D per ES routes and Ethernet A-D per EVI routes from
                    PE1 and PE2 are received, PE3 can forward traffic destined to
                    M1 to both PE1 and PE2.<a href="#section-9.2.2-5.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-9.2.2-5.3">T2  </dt>
            <dd style="margin-left: 3.0em" id="section-9.2.2-5.4">If after T1 PE1 withdraws its set of
                    Ethernet A-D per ES routes, then PE3 forwards traffic destined
                    to M1 to PE2 only.<a href="#section-9.2.2-5.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-9.2.2-5.5">T2' </dt>
            <dd style="margin-left: 3.0em" id="section-9.2.2-5.6">If after T1 PE2 withdraws its set of
                    Ethernet A-D per ES routes, then PE3 forwards traffic destined
                    to M1 to PE1 only.<a href="#section-9.2.2-5.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-9.2.2-5.7">T2''</dt>
            <dd style="margin-left: 3.0em" id="section-9.2.2-5.8">If after T1 PE1 withdraws its MAC/IP
                    Advertisement route, then PE3 treats traffic to M1 as unknown
                    unicast.<a href="#section-9.2.2-5.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-9.2.2-5.9">T3  </dt>
            <dd style="margin-left: 3.0em" id="section-9.2.2-5.10">PE2 also advertises a MAC route for M1,
                    and then PE1 withdraws its MAC route for M1.
                    PE3 continues forwarding traffic destined to M1 to both PE1 and PE2.
                    In other words, despite M1
                    withdrawal by PE1, PE3 forwards the traffic destined to M1 to
                    both PE1 and PE2. This is because a flow from the CE,
                    resulting in M1 traffic getting hashed to PE1, can get
                    terminated, resulting in M1 being aged out in PE1; however, M1
                    can be reachable by both PE1 and PE2.<a href="#section-9.2.2-5.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</section>
</section>
</div>
<section id="section-10">
      <h2 id="name-arp-and-nd">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-arp-and-nd" class="section-name selfRef">ARP and ND</a>
      </h2>
<p id="section-10-1">The IP Address field in the MAC/IP Advertisement route may optionally
        carry one of the IP addresses associated with the MAC address. This
        provides an option that can be used to minimize the flooding of ARP
        or Neighbor Discovery (ND) messages over the MPLS network and to
        remote CEs. This option also minimizes ARP (or ND) message
        processing on end-stations/hosts connected to the EVPN network. A PE
        may learn the IP address associated with a MAC address in the control
        or management plane between the CE and the PE. Or, it may learn this
        binding by snooping certain messages to or from a CE. When a PE
        learns the IP address associated with a MAC address of a locally
        connected CE, it may advertise this address to other PEs by including
        it in the MAC/IP Advertisement route. The IP address may be an IPv4
        address encoded using 4 octets or an IPv6 address encoded using
        16 octets. For ARP and ND purposes, the IP Address Length field MUST
        be set to 32 for an IPv4 address or 128 for an IPv6 address.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">If there are multiple IP addresses associated with a MAC address,
        then multiple MAC/IP Advertisement routes MUST be generated, one for
        each IP address. For instance, this may be the case when there are
        both an IPv4 and an IPv6 address associated with the same MAC address
        for dual-IP-stack scenarios. When the IP address is dissociated with
        the MAC address, then the MAC/IP Advertisement route with that
        particular IP address MUST be withdrawn.<a href="#section-10-2" class="pilcrow">¶</a></p>
<p id="section-10-3">Note that a MAC-only route can be advertised along with, but
        independent from, a MAC/IP route for scenarios where the MAC learning
        over an access network/node is done in the data plane and independent
        from ARP snooping that generates a MAC/IP route. In such scenarios,
        when the ARP entry times out and causes the MAC/IP to be withdrawn,
        then the MAC information will not be lost. In scenarios where the
        host MAC/IP is learned via the management or control plane, then the
        sender PE may only generate and advertise the MAC/IP route. If the
        receiving PE receives both the MAC-only route and the MAC/IP route,
        then when it receives a withdraw message for the MAC/IP route, it
        MUST delete the corresponding entry from the ARP table but not the
        MAC entry from the MAC-VRF table, unless it receives a withdraw
        message for the MAC-only route.<a href="#section-10-3" class="pilcrow">¶</a></p>
<p id="section-10-4">When a PE receives an ARP Request for an IP address from a CE, and if
        the PE has the MAC address binding for that IP address, the PE SHOULD
        perform ARP proxy by responding to the ARP Request.<a href="#section-10-4" class="pilcrow">¶</a></p>
<p id="section-10-5">In the same way, when a PE receives a Neighbor Solicitation for an IP
     address from a CE, the PE SHOULD perform ND proxy and respond if the PE
     has the binding information for the IP.<a href="#section-10-5" class="pilcrow">¶</a></p>
<div id="default_gw">
<section id="section-10.1">
        <h3 id="name-default-gateway">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-default-gateway" class="section-name selfRef">Default Gateway</a>
        </h3>
<p id="section-10.1-1">When a PE needs to perform inter-subnet forwarding where each subnet
            is represented by a different broadcast domain (e.g., a different
            VLAN), the inter-subnet forwarding is performed at Layer 3, and the
            PE that performs such a function is called the default gateway for
            the EVPN instance. In this case, when the PE receives an ARP Request
            for the IP address configured as the default gateway address, the PE
            originates an ARP Reply.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<p id="section-10.1-2">Each PE that acts as a default gateway for a given EVPN instance MAY
            advertise in the EVPN control plane its default gateway MAC address
            using the MAC/IP Advertisement route, and each such PE indicates that
            such a route is associated with the default gateway. This is
            accomplished by requiring the route to carry the Default Gateway
            extended community defined in
            <a href="#default_gw_extcomm" class="xref">Section 7.8</a> ("<a href="#default_gw_extcomm" class="xref">Default Gateway Extended Community</a>").
            The ESI field is set to zero when advertising the MAC
            route with the Default Gateway extended community.<a href="#section-10.1-2" class="pilcrow">¶</a></p>
<p id="section-10.1-3">The IP Address field of the MAC/IP Advertisement route is set to the
            default gateway IP address for that subnet (e.g., an EVPN instance).
            For a given subnet (e.g., a VLAN or EVPN instance), the default
            gateway IP address is the same across all the participant PEs. The
            inclusion of this IP address enables the receiving PE to check its
            configured default gateway IP address against the one received in the
            MAC/IP Advertisement route for that subnet (or EVPN instance), and if
            there is a discrepancy, then the PE SHOULD notify the operator and
            log an error message.<a href="#section-10.1-3" class="pilcrow">¶</a></p>
<p id="section-10.1-4">Unless it is known a priori (by means outside of this document) that
            all PEs of a given EVPN instance act as a default gateway for that
            EVPN instance, the MPLS label MUST be set to a valid downstream
            assigned label.<a href="#section-10.1-4" class="pilcrow">¶</a></p>
<p id="section-10.1-5">Furthermore, even if all PEs of a given EVPN instance do act as a
            default gateway for that EVPN instance, but only some, but not all,
            of these PEs have sufficient (routing) information to provide
            inter‑subnet routing for all the inter-subnet traffic originated
            within the subnet associated with the EVPN instance, then when such a
            PE advertises in the EVPN control plane its default gateway MAC
            address using the MAC/IP Advertisement route and indicates that such
            a route is associated with the default gateway, the route MUST carry
            a valid downstream assigned label.<a href="#section-10.1-5" class="pilcrow">¶</a></p>
<p id="section-10.1-6">If all PEs of a given EVPN instance act as a default gateway for that
            EVPN instance, and the same default gateway MAC address is used
            across all gateway devices, then no such advertisement is needed.
            However, if each default gateway uses a different MAC address, then
            each default gateway needs to be aware of other gateways' MAC
            addresses and thus the need for such an advertisement. This is
            called MAC address aliasing, since a single default gateway can be
            represented by multiple MAC addresses.<a href="#section-10.1-6" class="pilcrow">¶</a></p>
<p id="section-10.1-7">Each PE that receives this route and imports it as per procedures
            specified in this document follows the procedures in this section
            when replying to ARP Requests that it receives.<a href="#section-10.1-7" class="pilcrow">¶</a></p>
<p id="section-10.1-8">Each PE that acts as a default gateway for a given EVPN instance that
            receives this route and imports it as per procedures specified in
            this document MUST create MAC forwarding state that enables it to
            apply IP forwarding to the packets destined to the MAC address
            carried in the route.<a href="#section-10.1-8" class="pilcrow">¶</a></p>
<div id="bestpath_gw">
<section id="section-10.1.1">
          <h4 id="name-best-path-selection-for-def">
<a href="#section-10.1.1" class="section-number selfRef">10.1.1. </a><a href="#name-best-path-selection-for-def" class="section-name selfRef">Best Path selection for Default Gateway</a>
          </h4>
<p id="section-10.1.1-1"> Default gateway MAC address that is assigned to an IRB interface
             (for a subnet) in a PE MUST be unique in context of that subnet. 
             In other words, the same MAC address cannot be used by a host either 
             intentionally or accidently. Therefore, in case such conflicts arises, 
             there needs to be scheme to detect it and resolve it. In order to properly 
             detect such conflicts, the following BGP best path selection MUST be 
             applied.<a href="#section-10.1.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-10.1.1-2">
            <dt id="section-10.1.1-2.1">*</dt>
            <dd style="margin-left: 1.0em" id="section-10.1.1-2.2">When comparing two routes, the route which has
                  Default Gateway extended community 
                   is preferred over a route which does not have the extended comunity. The PE that has 
                   advertised the MAC route without Default Gateway extended community,
                      upon receiving the route with Default Gateway extended community,
                      SHALL withdraw its route and raise an alarm.<a href="#section-10.1.1-2.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-10.1.1-2.3">*</dt>
            <dd style="margin-left: 1.0em" id="section-10.1.1-2.4">When comparing two routes where both routes have the
                  Default Gateway extended community, normal BGP best path processing is be applied.<a href="#section-10.1.1-2.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-10.1.1-2.5">*</dt>
            <dd style="margin-left: 1.0em" id="section-10.1.1-2.6">When comparing local and remote routes with
                  Default Gateway extended community, the local route is always preferred.<a href="#section-10.1.1-2.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-10.1.1-2.7">*</dt>
            <dd style="margin-left: 1.0em" id="section-10.1.1-2.8">MAC Mobility extended community SHALL NOT be attached to routes
                  which also have Default Gateway extended community
               on the sending side and SHALL be ignored on the receiving side.<a href="#section-10.1.1-2.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
</section>
<div id="handling_multi_dest">
<section id="section-11">
      <h2 id="name-handling-of-multi-destinati">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-handling-of-multi-destinati" class="section-name selfRef">Handling of Multi-destination Traffic</a>
      </h2>
<p id="section-11-1">Procedures are required for a given PE to flood broadcast or multicast
        traffic received from a CE and with a given Ethernet tag to the other PEs 
        in the associated [EVI, BD] (EVPN instance). In certain scenarios, as
        described in <a href="#process_uu_pkt" class="xref">Section 12</a>
        ("<a href="#process_uu_pkt" class="xref">Processing of Unknown Unicast Packets</a>"), a
        given PE may also need to flood unknown unicast traffic to other PEs.<a href="#section-11-1" class="pilcrow">¶</a></p>
<p id="section-11-2">The PEs in a particular EVPN instance may use ingress replication,
        P2MP LSPs, or MP2MP LSPs to send unknown unicast, broadcast, or
        multicast traffic to other PEs.<a href="#section-11-2" class="pilcrow">¶</a></p>
<p id="section-11-3">Each PE MUST advertise an "Inclusive Multicast Ethernet Tag route" to
        enable the above. The following subsection provides the procedures
        to construct the Inclusive Multicast Ethernet Tag route. Subsequent
        subsections describe its usage in further detail.<a href="#section-11-3" class="pilcrow">¶</a></p>
<section id="section-11.1">
        <h3 id="name-constructing-inclusive-mult">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-constructing-inclusive-mult" class="section-name selfRef">Constructing Inclusive Multicast Ethernet Tag Route</a>
        </h3>
<p id="section-11.1-1">The RD MUST be set per <a href="#rd" class="xref">Section 7.9</a>.<a href="#section-11.1-1" class="pilcrow">¶</a></p>
<p id="section-11.1-2">The Ethernet Tag ID is set as defined in <a href="#ethernet_tag_id" class="xref">Section 6</a>.<a href="#section-11.1-2" class="pilcrow">¶</a></p>
<p id="section-11.1-3">The Originating Router's IP Address field value MUST be set to an IP
           address of the PE that should be common for all the EVIs on the PE
           (e.g., this address may be the PE's loopback address). The IP
           Address Length field is in bits.<a href="#section-11.1-3" class="pilcrow">¶</a></p>
<p id="section-11.1-4">The Next Hop field of the MP_REACH_NLRI attribute of the route MUST
           be set to the IPv4 or IPv6 address of the advertising PE.<a href="#section-11.1-4" class="pilcrow">¶</a></p>
<p id="section-11.1-5">The BGP advertisement for the Inclusive Multicast Ethernet Tag route
           MUST also carry one or more Route Target (RT) extended communities. The
           assignment of RTs as described in <a href="#route_targets" class="xref">Section 7.10</a> MUST be followed.<a href="#section-11.1-5" class="pilcrow">¶</a></p>
</section>
<section id="section-11.2">
        <h3 id="name-p-tunnel-identification">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-p-tunnel-identification" class="section-name selfRef">P-Tunnel Identification</a>
        </h3>
<p id="section-11.2-1">In order to identify the P-tunnel used for sending broadcast, unknown
            unicast, or multicast traffic, the Inclusive Multicast Ethernet Tag
            route MUST carry a Provider Multicast Service Interface (PMSI) Tunnel
            attribute as specified in <span>[<a href="#RFC6514" class="xref">RFC6514</a>]</span>.<a href="#section-11.2-1" class="pilcrow">¶</a></p>
<p id="section-11.2-2">Depending on the technology used for the P-tunnel for the EVPN
            instance on the PE, the PMSI Tunnel attribute of the Inclusive
            Multicast Ethernet Tag route is constructed as follows.<a href="#section-11.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-11.2-3">
          <dt id="section-11.2-3.1">+</dt>
          <dd style="margin-left: 1.0em" id="section-11.2-3.2">If the PE that originates the advertisement
                uses a P-multicast tree
                for the P-tunnel for EVPN, the PMSI Tunnel attribute MUST contain
                the identity of the tree (note that the PE could create the
                identity of the tree prior to the actual instantiation of the
                tree).<a href="#section-11.2-3.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-11.2-3.3">+</dt>
          <dd style="margin-left: 1.0em" id="section-11.2-3.4">A PE that uses a P-multicast tree for the P-tunnel 
                MAY aggregate two or more Broadcast Domains (BDs) present on the PE onto the 
                same tree.  In this case, in addition to carrying the identity of 
                the tree, the PMSI Tunnel attribute MUST carry an MPLS label, 
                which the PE has bound uniquely to the BD associated with this update 
                (as determined by its RTs and Ethernet Tag ID). The assigned MPLS label 
                is upstream allocated unless the procedures in section 19 
                (Use of Domain-wide Common Block (DCB) Labels) are followed. If 
                the PE has already advertised Inclusive Multicast Ethernet Tag 
                routes for two or more BDs that it now desires to aggregate, then 
                the PE MUST re-advertise those routes. The re-advertised routes 
                MUST be the same as the original ones, except for the PMSI Tunnel 
                attribute and the label carried in that attribute.<a href="#section-11.2-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-11.2-3.5">+</dt>
          <dd style="margin-left: 1.0em" id="section-11.2-3.6">If the PE that originates the advertisement uses ingress
                replication for the P-tunnel for EVPN, the route MUST include the
                PMSI Tunnel attribute with the Tunnel Type set to Ingress
                Replication and the Tunnel Identifier set to a routable address of
                the PE. The PMSI Tunnel attribute MUST carry a downstream assigned
                MPLS label. This label is used to demultiplex the broadcast,
                multicast, or unknown unicast EVPN traffic received over an MP2P
                tunnel by the PE.<a href="#section-11.2-3.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</section>
</div>
<div id="process_uu_pkt">
<section id="section-12">
      <h2 id="name-processing-of-unknown-unica">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-processing-of-unknown-unica" class="section-name selfRef">Processing of Unknown Unicast Packets</a>
      </h2>
<p id="section-12-1">The procedures in this document do not require the PEs to flood
        unknown unicast traffic to other PEs. If PEs learn CE MAC addresses
        via a control-plane protocol, the PEs can then distribute MAC
        addresses via BGP, and all unicast MAC addresses will be learned
        prior to traffic to those destinations.<a href="#section-12-1" class="pilcrow">¶</a></p>
<p id="section-12-2">However, if a destination MAC address of a received packet is not
        known by the PE, the PE may have to flood the packet. When flooding,
        one must take into account "split-horizon forwarding" as follows: The
        principles behind the following procedures are borrowed from the
        split-horizon forwarding rules in VPLS solutions <span>[<a href="#RFC4761" class="xref">RFC4761</a>]</span> <span>[<a href="#RFC4762" class="xref">RFC4762</a>]</span>.
        When a PE capable of flooding (say PEx) receives an unknown
        destination MAC address, it floods the frame. If the frame arrived
        from an attached CE, PEx must send a copy of that frame on every
        Ethernet segment (belonging to that EVI) for which it is the DF,
        other than the Ethernet segment on which it received the frame. In
        addition, the PE must flood the frame to all other PEs participating
        in that EVPN instance. If, on the other hand, the frame arrived from
        another PE (say PEy), PEx must send a copy of the packet on each
        Ethernet segment (belonging to that EVI) for which it is the DF. PEx
        MUST NOT send the frame to other PEs, since PEy would have already
        done so. Split-horizon forwarding rules apply to unknown MAC
        addresses.<a href="#section-12-2" class="pilcrow">¶</a></p>
<p id="section-12-3">Whether or not to flood packets to unknown destination MAC addresses
        should be an administrative choice, depending on how learning happens
        between CEs and PEs.<a href="#section-12-3" class="pilcrow">¶</a></p>
<p id="section-12-4">The PEs in a particular EVPN instance may use ingress replication
        using RSVP-TE P2P LSPs or LDP MP2P LSPs for sending unknown unicast
        traffic to other PEs. Or, they may use RSVP-TE P2MP or LDP P2MP for
        sending such traffic to other PEs.<a href="#section-12-4" class="pilcrow">¶</a></p>
<section id="section-12.1">
        <h3 id="name-ingress-replication-2">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-ingress-replication-2" class="section-name selfRef">Ingress Replication</a>
        </h3>
<p id="section-12.1-1">If ingress replication is in use, the P-tunnel attribute, carried in
            the Inclusive Multicast Ethernet Tag routes for the EVPN instance,
            specifies the downstream label that the other PEs can use to send
            unknown unicast, multicast, or broadcast traffic for that EVPN
            instance to this particular PE.<a href="#section-12.1-1" class="pilcrow">¶</a></p>
<p id="section-12.1-2">The PE that receives a packet with this particular MPLS label MUST
            treat the packet as a broadcast, multicast, or unknown unicast
            packet. Further, if the MAC address is a unicast MAC address, the PE
            MUST treat the packet as an unknown unicast packet.<a href="#section-12.1-2" class="pilcrow">¶</a></p>
</section>
<div id="p2mp_lsp_uu">
<section id="section-12.2">
        <h3 id="name-p2mp-mpls-lsps-2">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-p2mp-mpls-lsps-2" class="section-name selfRef">P2MP MPLS LSPs</a>
        </h3>
<p id="section-12.2-1">The procedures for using P2MP or MP2MP LSPs are 
         very similar to the VPLS
            procedures described in <span>[<a href="#RFC7117" class="xref">RFC7117</a>]</span>. The P-tunnel attribute used by a
            PE for sending unknown unicast, broadcast, or multicast traffic for a
            particular EVPN instance is advertised in the Inclusive Multicast
            Ethernet Tag route as described in
            <a href="#handling_multi_dest" class="xref">Section 11</a>
            ("<a href="#handling_multi_dest" class="xref">Handling of Multi-destination Traffic</a>").<a href="#section-12.2-1" class="pilcrow">¶</a></p>
<p id="section-12.2-2">The P-tunnel attribute specifies the P2MP or MP2MP LSP identifier. This is
            the equivalent of an Inclusive tree as described in <span>[<a href="#RFC7117" class="xref">RFC7117</a>]</span>.
            Note that multiple BDs in the same or different EVIs
            may use the same P2MP or MP2MP LSP, using upstream labels
            <span>[<a href="#RFC7117" class="xref">RFC7117</a>]</span> or DCB 
            labels <span>[<a href="#I-D.ietf-bess-mvpn-evpn-aggregation-label" class="xref">I-D.ietf-bess-mvpn-evpn-aggregation-label</a>]</span>. 
            This is the equivalent of an Aggregate Inclusive tree
            <span>[<a href="#RFC7117" class="xref">RFC7117</a>]</span>. When P2MP or MP2MP LSPs are used for flooding unknown unicast
            traffic, packet reordering is possible.<a href="#section-12.2-2" class="pilcrow">¶</a></p>
<p id="section-12.2-3">The PE that receives a packet on the P2MP or MP2MP LSP specified in the PMSI
            Tunnel attribute MUST treat the packet as a broadcast, multicast, or
            unknown unicast packet. Further, if the MAC address is a unicast MAC
            address, the PE MUST treat the packet as an unknown unicast packet.<a href="#section-12.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="fwd_uc_pkt">
<section id="section-13">
      <h2 id="name-forwarding-unicast-packets">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-forwarding-unicast-packets" class="section-name selfRef">Forwarding Unicast Packets</a>
      </h2>
<p id="section-13-1">This section describes procedures for forwarding unicast packets by
        PEs, where such packets are received from either directly connected
        CEs or some other PEs.<a href="#section-13-1" class="pilcrow">¶</a></p>
<section id="section-13.1">
        <h3 id="name-forwarding-packets-received">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-forwarding-packets-received" class="section-name selfRef">Forwarding Packets Received from a CE</a>
        </h3>
<p id="section-13.1-1">When a PE receives a packet from a CE with a given Ethernet Tag, it
            must first look up the packet's source MAC address. In certain
            environments that enable MAC security, the source MAC address MAY be
            used to validate the host identity and determine that traffic from
            the host can be allowed into the network. Source MAC lookup MAY also
            be used for local MAC address learning.<a href="#section-13.1-1" class="pilcrow">¶</a></p>
<p id="section-13.1-2">If the PE decides to forward the packet, the destination MAC address
            of the packet must be looked up. If the PE has received MAC address
            advertisements for this destination MAC address from one or more
            other PEs or has learned it from locally connected CEs, the MAC
            address is considered a known MAC address. Otherwise, it is
            considered an unknown MAC address.<a href="#section-13.1-2" class="pilcrow">¶</a></p>
<p id="section-13.1-3">For known MAC addresses, the PE forwards this packet to one of the
            remote PEs or to a locally attached CE. When forwarding to a remote
            PE, the packet is encapsulated in the EVPN MPLS label advertised by
            the remote PE, for that MAC address, and in the MPLS LSP label stack
            to reach the remote PE.<a href="#section-13.1-3" class="pilcrow">¶</a></p>
<p id="section-13.1-4">If the MAC address is unknown and if the administrative policy on the
            PE requires flooding of unknown unicast traffic, then:<a href="#section-13.1-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-13.1-5">
          <dt id="section-13.1-5.1">-</dt>
          <dd style="margin-left: 1.0em" id="section-13.1-5.2">
            <p id="section-13.1-5.2.1">The PE MUST flood the packet to other PEs.
                The PE MUST first encapsulate the packet in the ESI MPLS label
                as described in <a href="#split_horizon" class="xref">Section 8.3</a>.

                If ingress replication is used, the packet MUST be
                replicated to each remote PE, with the VPN label being the MPLS
                label advertised by the remote PE in a PMSI Tunnel attribute in the Inclusive Multicast
                Ethernet Tag route for the [EVI, BD] associated with the received packet's Ethernet tag.<a href="#section-13.1-5.2.1" class="pilcrow">¶</a></p>
<p id="section-13.1-5.2.2">
                If P2MP LSPs are being used, the packet MUST be sent on
                the P2MP LSP of which the PE is the root, for the [EVI, BD]
                associated with the received packet's Ethernet tag.
                If the same P2MP LSP is used for all the BD's in the EVI,
                then all the PEs in the EVI MUST be the leaves of
                the P2MP LSP. If a different P2MP LSP is used for a given BD in the EVI,
                then only the PEs in that BD MUST be the leaves of the P2MP LSP. The packet MUST be
                encapsulated in the P2MP LSP label stack.<a href="#section-13.1-5.2.2" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-13.1-6">If the MAC address is unknown, then, if the administrative policy on
            the PE does not allow flooding of unknown unicast traffic:<a href="#section-13.1-6" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-13.1-7">
          <dt id="section-13.1-7.1">-</dt>
          <dd style="margin-left: 1.0em" id="section-13.1-7.2">the PE MUST drop the packet.<a href="#section-13.1-7.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
<section id="section-13.2">
        <h3 id="name-forwarding-packets-received-">
<a href="#section-13.2" class="section-number selfRef">13.2. </a><a href="#name-forwarding-packets-received-" class="section-name selfRef">Forwarding Packets Received from a Remote PE</a>
        </h3>
<p id="section-13.2-1">This section describes the procedures for forwarding known and
            unknown unicast packets received from a remote PE.<a href="#section-13.2-1" class="pilcrow">¶</a></p>
<section id="section-13.2.1">
          <h4 id="name-unknown-unicast-forwarding">
<a href="#section-13.2.1" class="section-number selfRef">13.2.1. </a><a href="#name-unknown-unicast-forwarding" class="section-name selfRef">Unknown Unicast Forwarding</a>
          </h4>
<p id="section-13.2.1-1">When a PE receives an MPLS packet from a remote PE, then, after
                processing the MPLS label stack, if the top MPLS label ends up being
                a P2MP LSP label associated with an EVPN instance or -- in the case
                of ingress replication -- the downstream label advertised in the
                P-tunnel attribute, and after performing the split-horizon procedures
                described in <a href="#split_horizon" class="xref">Section 8.3</a>:<a href="#section-13.2.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-13.2.1-2">
            <dt id="section-13.2.1-2.1">-</dt>
            <dd style="margin-left: 1.0em" id="section-13.2.1-2.2">If the PE is the designated forwarder of
                    BUM traffic on a
                    particular set of ESes for the [EVI, BD], the default behavior
                    is for the PE to flood that traffic to these ESes.
                    In other words,
                    the default behavior is for the PE to assume that for BUM traffic
                    it is not required to perform a destination MAC address lookup. As
                    an option, the PE may perform a destination MAC lookup to flood the
                    packet to only a subset of these ESes.
                    For instance, the PE may decide to not flood a BUM packet on
                    certain Ethernet segments even if it is the DF on the Ethernet
                    segment, based on administrative policy.<a href="#section-13.2.1-2.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-13.2.1-2.3">-</dt>
            <dd style="margin-left: 1.0em" id="section-13.2.1-2.4">If the PE is not the designated forwarder
                    for any ES associated with the [EVI, BD], the default behavior
                    is for it to drop the BUM traffic.<a href="#section-13.2.1-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
<section id="section-13.2.2">
          <h4 id="name-known-unicast-forwarding">
<a href="#section-13.2.2" class="section-number selfRef">13.2.2. </a><a href="#name-known-unicast-forwarding" class="section-name selfRef">Known Unicast Forwarding</a>
          </h4>
<p id="section-13.2.2-1">If the top MPLS label ends up being an EVPN label
                that was advertised in the unicast MAC advertisements,
                then the PE either forwards the
                packet based on CE next-hop forwarding information associated with
                the label or does a destination MAC address lookup to forward the
                packet to a CE.<a href="#section-13.2.2-1" class="pilcrow">¶</a></p>
</section>
</section>
</section>
</div>
<div id="load_bal_uc_pkt">
<section id="section-14">
      <h2 id="name-load-balancing-of-unicast-p">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-load-balancing-of-unicast-p" class="section-name selfRef">Load Balancing of Unicast Packets</a>
      </h2>
<p id="section-14-1">This section specifies the load-balancing procedures for sending
        known unicast packets to a multihomed CE.<a href="#section-14-1" class="pilcrow">¶</a></p>
<section id="section-14.1">
        <h3 id="name-load-balancing-of-traffic-f">
<a href="#section-14.1" class="section-number selfRef">14.1. </a><a href="#name-load-balancing-of-traffic-f" class="section-name selfRef">Load Balancing of Traffic from a PE to Remote CEs</a>
        </h3>
<p id="section-14.1-1">When a remote PE imports a MAC/IP Advertisement route for a given
            ES in a MAC-VRF, it MUST examine all imported
            Ethernet A-D routes for that ESI in order to determine the load-
            balancing characteristics of the Ethernet segment.<a href="#section-14.1-1" class="pilcrow">¶</a></p>
<div id="sa_redundancy_mode">
<section id="section-14.1.1">
          <h4 id="name-single-active-redundancy-mo">
<a href="#section-14.1.1" class="section-number selfRef">14.1.1. </a><a href="#name-single-active-redundancy-mo" class="section-name selfRef">Single-Active Redundancy Mode</a>
          </h4>
<p id="section-14.1.1-1">  For a given ES, if a remote PE has imported the set of Ethernet A‑D
                 per ES routes from at least one PE, where the "Single-Active" flag in
                 the ESI Label extended community is set, then that remote PE MUST
                 deduce that the ES is operating in Single-Active redundancy mode.<a href="#section-14.1.1-1" class="pilcrow">¶</a></p>
<p id="section-14.1.1-2"> This means that for a given [EVI, BD], a given MAC address is only reachable
                 only via the PE announcing the associated MAC/IP Advertisement route -
                 this PE will also have advertised an Ethernet A-D per EVI route for that
                 [EVI, BD] with an L2-Attr extended community in which the P bit is set.
                 I.e., the Primary DF Elected PE is also responsible for sending known
                 unicast frames to the CE and receiving unicast and BUM frames from it.
                 Similarly, the Backup DF Elected PE will have advertised an Ethernet AD
                 per EVI route for [EVI, BD] with an L2-Attr extended community in
                 which the B bit is set.<a href="#section-14.1.1-2" class="pilcrow">¶</a></p>
<p id="section-14.1.1-3"> If the Primary DF Elected PE loses connectivity to the CE it SHOULD
                 withdraw its set of Ethernet A-D per ES routes for the affected ES
                 prior to withdrawing the affected MAC/IP Advertisement routes. The Backup 
                 DF Elected PE (which is now the Primary DF Elected PE) needs to advertise 
                 an Ethernet A-D per EVI route for [EVI, BD] with an L2-Attr extended 
                 community in which the P bit is set. Furthermore, the new Backup DF Elected PE 
                 needs to advertise an Ethernet A-D per EVI route for [EVI, BD] with an
                 L2-Attr extended community in which the B bit is set.<a href="#section-14.1.1-3" class="pilcrow">¶</a></p>
<p id="section-14.1.1-4"> A remote PE SHOULD use the Primary DF Elected PE's withdrawal of its
                 set of Ethernet A-D per ES routes as a trigger to update its forwarding
                 entries for the associated MAC addresses to point at the Backup DF
                 Elected PE.  As the Backup DF Elected PE starts learning the MAC
                 addresses over its attached ES, it will start sending MAC/IP Advertisement
                 routes while the failed PE withdraws its routes.  This mechanism minimizes
                 the flooding of traffic during fail-over events.<a href="#section-14.1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-14.1.2">
          <h4 id="name-all-active-redundancy-mode">
<a href="#section-14.1.2" class="section-number selfRef">14.1.2. </a><a href="#name-all-active-redundancy-mode" class="section-name selfRef">All-Active Redundancy Mode</a>
          </h4>
<p id="section-14.1.2-1">For a given ES, if the remote PE has imported the set of
                Ethernet A-D per ES routes from one or more PEs
                and none of them have the
                "Single‑Active" flag in the ESI Label extended community set,
                then the remote PE MUST deduce that the ES is operating in All-Active
                redundancy mode. A remote PE that receives a MAC/IP Advertisement
                route with a non-reserved ESI SHOULD consider the advertised MAC
                address to be reachable via all PEs that have advertised reachability
                to that MAC address's EVI/ES/Ethernet Tag ID via the combination of an Ethernet A-D
                per EVI route for that EVI/ES/Ethernet Tag ID AND
                an Ethernet A-D per ES route for that ES. The remote PE MUST use
                received MAC/IP Advertisement routes and Ethernet A-D per EVI/per ES
                routes to construct the set of next hops for the advertised MAC
                address.<a href="#section-14.1.2-1" class="pilcrow">¶</a></p>
<p id="section-14.1.2-2">Each next hop comprises an MPLS label stack that is to be used
                to reach a given egress PE and allow it to forward a packet.
                The portion of the MPLS label stack that is to be used by that egress PE
                to forward a packet is constructed by the remote PE as follows:<a href="#section-14.1.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-14.1.2-3">
            <dt id="section-14.1.2-3.1">-</dt>
            <dd style="margin-left: 1.0em" id="section-14.1.2-3.2">If a MAC/IP Advertisement route was received
                    from that PE, then its label stack MUST be used in the next hop.<a href="#section-14.1.2-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-14.1.2-3.3">-</dt>
            <dd style="margin-left: 1.0em" id="section-14.1.2-3.4">Otherwise, the label stack from the Ethernet A-D per EVI
                    route that matches the MAC address' EVI/ES/Ethernet Tag ID
                    MUST be used in the next hop.<a href="#section-14.1.2-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-14.1.2-4">The following example explains the above.<a href="#section-14.1.2-4" class="pilcrow">¶</a></p>
<p id="section-14.1.2-5">Consider a CE (CE1) that is dual-homed to two PEs (PE1 and PE2) on a
                LAG interface (ES1), and is sending packets with source MAC address
                MAC1 on VLAN1 (mapped to EVI1). A remote PE, say PE3, is able to
                learn that MAC1 is reachable via PE1 and PE2. Both PE1 and PE2 may
                advertise MAC1 if they receive packets with MAC1 from CE1. If
                this is not the case, and if MAC1 is advertised only by PE1, PE3
                still considers MAC1 as reachable via both PE1 and PE2, as both PE1
                and PE2 advertise a set of Ethernet A-D per ES routes for ES1 as well
                as an Ethernet A-D per EVI route for &lt;EVI1, ES1&gt;.<a href="#section-14.1.2-5" class="pilcrow">¶</a></p>
<p id="section-14.1.2-6">The MPLS label stack to send the packets to PE1 is the MPLS LSP stack
                to get to PE1 (at the top of the stack) followed by the EVPN label
                advertised by PE1 for CE1's MAC.<a href="#section-14.1.2-6" class="pilcrow">¶</a></p>
<p id="section-14.1.2-7">The MPLS label stack to send packets to PE2 is the MPLS LSP stack to
                get to PE2 (at the top of the stack) followed by the MPLS label in
                the Ethernet A-D route advertised by PE2 for &lt;EVI1, ES1&gt;,
                if PE2 has not advertised MAC1 in BGP.<a href="#section-14.1.2-7" class="pilcrow">¶</a></p>
<p id="section-14.1.2-8">We will refer to these label stacks as MPLS next hops.<a href="#section-14.1.2-8" class="pilcrow">¶</a></p>
<p id="section-14.1.2-9">The remote PE (PE3) can now load balance the traffic it receives from
                its CEs, destined for CE1, between PE1 and PE2. PE3 may use N-tuple
                flow information to hash traffic into one of the MPLS next hops for
                load balancing of IP traffic. Alternatively, PE3 may rely on the
                source MAC addresses for load balancing.<a href="#section-14.1.2-9" class="pilcrow">¶</a></p>
<p id="section-14.1.2-10">Note that once PE3 decides to send a particular packet to PE1 or PE2,
                it can pick one out of multiple possible paths to reach the
                particular remote PE using regular MPLS procedures. For instance, if
                the tunneling technology is based on RSVP-TE LSPs and PE3 decides to
                send a particular packet to PE1, then PE3 can choose from multiple
                RSVP-TE LSPs that have PE1 as their destination.<a href="#section-14.1.2-10" class="pilcrow">¶</a></p>
<p id="section-14.1.2-11">When PE1 or PE2 receives the packet destined for CE1 from PE3, if the
                packet is a known unicast, it is forwarded to CE1.<a href="#section-14.1.2-11" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-14.2">
        <h3 id="name-load-balancing-of-traffic-b">
<a href="#section-14.2" class="section-number selfRef">14.2. </a><a href="#name-load-balancing-of-traffic-b" class="section-name selfRef">Load Balancing of Traffic between a PE and a Local CE</a>
        </h3>
<p id="section-14.2-1">A CE may be configured with more than one interface connected to
            different PEs or the same PE for load balancing, using a technology
            such as a LAG. The PE(s) and the CE can load balance traffic onto
            these interfaces using one of the following mechanisms.<a href="#section-14.2-1" class="pilcrow">¶</a></p>
<section id="section-14.2.1">
          <h4 id="name-data-plane-learning">
<a href="#section-14.2.1" class="section-number selfRef">14.2.1. </a><a href="#name-data-plane-learning" class="section-name selfRef">Data-Plane Learning</a>
          </h4>
<p id="section-14.2.1-1">Consider that the PEs perform data-plane learning for local MAC
                addresses learned from local CEs. This enables the PE(s) to learn a
                particular MAC address and associate it with one or more interfaces,
                if the technology between the PE and the CE supports multipathing.
                The PEs can now load balance traffic destined to that MAC address on
                the multiple interfaces.<a href="#section-14.2.1-1" class="pilcrow">¶</a></p>
<p id="section-14.2.1-2">Whether the CE can load balance traffic that it generates on the
                multiple interfaces is dependent on the CE implementation.<a href="#section-14.2.1-2" class="pilcrow">¶</a></p>
</section>
<section id="section-14.2.2">
          <h4 id="name-control-plane-learning">
<a href="#section-14.2.2" class="section-number selfRef">14.2.2. </a><a href="#name-control-plane-learning" class="section-name selfRef">Control-Plane Learning</a>
          </h4>
<p id="section-14.2.2-1">The CE can be a host that advertises the same MAC address using a
                control protocol on all interfaces. This enables the PE(s) to learn
                the host's MAC address and associate it with all interfaces. The PEs
                can now load balance traffic destined to the host on all these
                interfaces. The host can also load balance the traffic it generates
                onto these interfaces, and the PE that receives the traffic employs
                EVPN forwarding procedures to forward the traffic.<a href="#section-14.2.2-1" class="pilcrow">¶</a></p>
</section>
</section>
</section>
</div>
<div id="mac_mobility">
<section id="section-15">
      <h2 id="name-mac-mobility">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-mac-mobility" class="section-name selfRef">MAC Mobility</a>
      </h2>
<p id="section-15-1">It is possible for a given host or end-station (as defined by its MAC
        address) to move from one Ethernet segment to another; this is
        referred to as 'MAC Mobility' or 'MAC move', and it is different from
        the multihoming situation in which a given MAC address is reachable
        via multiple PEs for the same Ethernet segment. In a MAC move, there
        would be two sets of MAC/IP Advertisement routes -- one set with the
        new Ethernet segment and one set with the previous Ethernet segment
        -- and the MAC address would appear to be reachable via each of these
        segments.<a href="#section-15-1" class="pilcrow">¶</a></p>
<p id="section-15-2">In order to allow all of the PEs in the EVPN instance to correctly
        determine the current location of the MAC address, all advertisements
        of it being reachable via the previous Ethernet segment MUST be
        withdrawn by the PEs, for the previous Ethernet segment, that had
        advertised it.<a href="#section-15-2" class="pilcrow">¶</a></p>
<p id="section-15-3">If local learning is performed using the data plane, these PEs will
        not be able to detect that the MAC address has moved to another
        Ethernet segment, and the receipt of MAC/IP Advertisement routes,
        with the MAC Mobility extended community, from other PEs
        serves as the trigger for these PEs to withdraw their advertisements.
        If local learning is performed using the control or management
        planes, these interactions serve as the trigger for these PEs to
        withdraw their advertisements.<a href="#section-15-3" class="pilcrow">¶</a></p>
<p id="section-15-4">In a situation where there are multiple moves of a given MAC,
        possibly between the same two Ethernet segments, there may be
        multiple withdrawals and re-advertisements. In order to ensure that
        all PEs in the EVPN instance receive all of these correctly through
        the intervening BGP infrastructure, introducing a sequence number
        into the MAC Mobility extended community is necessary.<a href="#section-15-4" class="pilcrow">¶</a></p>
<p id="section-15-5">In order to process mobility events correctly, an implementation MUST
        handle scenarios in which sequence number wraparound occurs.<a href="#section-15-5" class="pilcrow">¶</a></p>
<p id="section-15-6">Every MAC mobility event for a given MAC address will contain a
        sequence number that is set using the following rules:<a href="#section-15-6" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-15-7">
        <dt id="section-15-7.1">-</dt>
        <dd style="margin-left: 1.0em" id="section-15-7.2">A PE advertising a MAC address for the first time
            advertises it with no MAC Mobility extended community.<a href="#section-15-7.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-15-7.3">-</dt>
        <dd style="margin-left: 1.0em" id="section-15-7.4">A PE detecting a locally attached MAC address
            for which it had
            previously received a MAC/IP Advertisement route with a different
            Ethernet segment identifier advertises the MAC address in a MAC/IP
            Advertisement route tagged with a MAC Mobility extended community
            with a sequence number one greater than the sequence
            number in the MAC Mobility extended community of the
            received MAC/IP Advertisement route. In the case of the first
            mobility event for a given MAC address, where the received MAC/IP
            Advertisement route does not carry a MAC Mobility extended
            community, the value of the sequence number in the
            received route is assumed to be 0 for the purpose of this
            processing.<a href="#section-15-7.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-15-7.5">-</dt>
        <dd style="margin-left: 1.0em" id="section-15-7.6">
          <p id="section-15-7.6.1">A PE detecting a locally attached MAC address
            for which it had
            previously received a MAC/IP Advertisement route with the same
            non‑zero Ethernet segment identifier advertises it with:<a href="#section-15-7.6.1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-15-7.6.2">
            <dt id="section-15-7.6.2.1">1.</dt>
            <dd style="margin-left: 1.5em" id="section-15-7.6.2.2">no MAC Mobility extended community,
                if the received route did not carry said extended community.<a href="#section-15-7.6.2.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-15-7.6.2.3">2.</dt>
            <dd style="margin-left: 1.5em" id="section-15-7.6.2.4">a MAC Mobility extended community
                with the sequence number equal to the highest of the 
                sequence number(s) in the received MAC/IP Advertisement route(s),
                if the received route(s) is (are) tagged with a MAC Mobility
                extended community.<a href="#section-15-7.6.2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</dd>
        <dd class="break"></dd>
<dt id="section-15-7.7">-</dt>
        <dd style="margin-left: 1.0em" id="section-15-7.8">A PE detecting a locally attached MAC address
            for which it had
            previously received a MAC/IP Advertisement route with the same zero
            Ethernet segment identifier (single-homed scenarios) advertises it
            with a MAC Mobility extended community with the sequence
            number set properly. In the case of single-homed scenarios, there
            is no need for ESI comparison. ESI comparison is done for
            multihoming in order to prevent false detection of MAC moves among
            the PEs attached to the same multihomed site.<a href="#section-15-7.8" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-15-8">A PE receiving a MAC/IP Advertisement route for a MAC address with a
        different Ethernet segment identifier and a higher sequence number
        than that which it had previously advertised withdraws its MAC/IP
        Advertisement route. If two (or more) PEs advertise the same MAC
        address with the same sequence number but different Ethernet segment
        identifiers, a PE that receives these routes selects the route
        advertised by the PE with the lowest IP address as the best route.
        If the PE is the originator of the MAC route and it receives the same
        MAC address with the same sequence number that it generated, it will
        compare its own IP address with the IP address of the remote PE and
        will select the lowest IP. If its own route is not the best one, it
        will withdraw the route.<a href="#section-15-8" class="pilcrow">¶</a></p>
<section id="section-15.1">
        <h3 id="name-mac-duplication-issue">
<a href="#section-15.1" class="section-number selfRef">15.1. </a><a href="#name-mac-duplication-issue" class="section-name selfRef">MAC Duplication Issue</a>
        </h3>
<p id="section-15.1-1">A situation may arise where the same MAC address is learned by
            different PEs in the same VLAN because of two (or more) hosts being
            misconfigured with the same (duplicate) MAC address. In such a
            situation, the traffic originating from these hosts would trigger
            continuous MAC moves among the PEs attached to these hosts. It is
            important to recognize such a situation and avoid incrementing the
            sequence number (in the MAC Mobility extended community) to
            infinity. In order to remedy such a situation, a PE that detects a
            MAC mobility event via local learning starts an M-second timer (with
            a default value of M = 180), and if it detects N MAC moves before the
            timer expires (with a default value of N = 5), it concludes that a
            duplicate-MAC situation has occurred. The PE MUST alert the operator
            and stop sending and processing any BGP MAC/IP Advertisement routes
            for that MAC address until a corrective action is taken by the
            operator. The values of M and N MUST be configurable to allow for
            flexibility in operator control. Note that the other PEs in the EVPN
            instance will forward the traffic for the duplicate MAC address to
            one of the PEs advertising the duplicate MAC address.<a href="#section-15.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-15.2">
        <h3 id="name-sticky-mac-addresses">
<a href="#section-15.2" class="section-number selfRef">15.2. </a><a href="#name-sticky-mac-addresses" class="section-name selfRef">Sticky MAC Addresses</a>
        </h3>
<p id="section-15.2-1">There are scenarios in which it is desired to configure some MAC
            addresses as static so that they are not subjected to MAC moves. In
            such scenarios, these MAC addresses are advertised with a MAC
            Mobility extended community where the static flag is set to 1 and the
            sequence number is set to zero. If a PE receives such advertisements
            and later learns the same MAC address(es) via local learning, then
            the PE MUST alert the operator.<a href="#section-15.2-1" class="pilcrow">¶</a></p>
</section>
<div id="loop_protection">
<section id="section-15.3">
        <h3 id="name-loop-protection">
<a href="#section-15.3" class="section-number selfRef">15.3. </a><a href="#name-loop-protection" class="section-name selfRef">Loop Protection</a>
        </h3>
<p id="section-15.3-1">The EVPN MAC Duplication procedure in section 15.1 prevents an endless 
            EVPN MAC/IP route advertisement exchange for a duplicate MAC between
            two (or more) PEs. While this helps the control plane settle, in case 
            there is backdoor link (loop) between two or more PEs attached to the 
            same BD, BUM frames being sent by a CE are still endlessly looped within 
            the BD through the backdoor link and among the PEs. This may cause 
            unpredictable issues in the CEs connected to the affected BD.<a href="#section-15.3-1" class="pilcrow">¶</a></p>
<p id="section-15.3-2">The EVPN MAC Duplication Mechanism in section 15.1 MAY be extended with 
            a Loop-protection action that is applied on the duplicate-MAC addresses. 
            This additional mechanism resolves loops created by accidental or intentional 
            backdoor links and SHOULD be enabled in all the PEs attached to the BD.<a href="#section-15.3-2" class="pilcrow">¶</a></p>
<p id="section-15.3-3">After following the procedure in section 15.1, when a PE detects a MAC M 
            as duplicate, the PE behaves as follows:<a href="#section-15.3-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-15.3-4">
          <dt id="section-15.3-4.1">a)</dt>
          <dd style="margin-left: 1.0em" id="section-15.3-4.2">Stops advertising M and logs a duplicate event.<a href="#section-15.3-4.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.3-4.3">b)</dt>
          <dd style="margin-left: 1.0em" id="section-15.3-4.4">Initializes a retry-timer, R seconds.<a href="#section-15.3-4.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.3-4.5">c)</dt>
          <dd style="margin-left: 1.0em" id="section-15.3-4.6">Since Loop Protection is enabled, the PE executes a 
                 Loop Protection action, which we refer to as "Black-Holing" M.<a href="#section-15.3-4.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-15.3-5">When the PE programs M as a Black-Hole MAC in the Bridge Table, M is no
         longer associated to the backdoor Attachment Circuit (AC), but to a 
         Black-Hole destination.<a href="#section-15.3-5" class="pilcrow">¶</a></p>
<p id="section-15.3-6">At this point and while M is in Black-Hole state:<a href="#section-15.3-6" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-15.3-7">
          <dt id="section-15.3-7.1">a)</dt>
          <dd style="margin-left: 1.0em" id="section-15.3-7.2">If a new frame is received (from the EVPN network or the backdoor AC) 
     with MAC SA = M, the PE identifies M to be Black-Holed and discards 
     the frame, ending the loop.<a href="#section-15.3-7.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.3-7.3">b)</dt>
          <dd style="margin-left: 1.0em" id="section-15.3-7.4">Optionally, instead of simply discarding the frame with MAC SA = M, 
     the PE MAY bring down the AC on which the offending frame is seen last.<a href="#section-15.3-7.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.3-7.5">c)</dt>
          <dd style="margin-left: 1.0em" id="section-15.3-7.6">Optionally, any frame that arrives at the PE with MAC DA = M SHOULD 
     be discarded too.<a href="#section-15.3-7.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-15.3-8">When the retry-timer R for M expires, the PE flushes M from the Bridge Table 
 and the process is restarted. In general, a Black-Hole MAC M can be flushed 
 from the Bridge Table if any of the following events occur:<a href="#section-15.3-8" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-15.3-9">
          <dt id="section-15.3-9.1">o</dt>
          <dd style="margin-left: 1.0em" id="section-15.3-9.2">Retry-timer R for duplicate-MAC M expires (as discussed). R is 
 initialized when M is detected as duplicate-MAC. Its value is configurable 
 and SHOULD be at least three times the EVPN MAC Duplication M-timer window.<a href="#section-15.3-9.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.3-9.3">o</dt>
          <dd style="margin-left: 1.0em" id="section-15.3-9.4">The operator manually flushes a Black-Hole MAC M. This should be done only 
 if the conditions under which M was identified as duplicate have been cleared.<a href="#section-15.3-9.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.3-9.5">o</dt>
          <dd style="margin-left: 1.0em" id="section-15.3-9.6">The remote PE withdraws the MAC/IP route for M and there are no other remote 
 MAC/IP routes for M.<a href="#section-15.3-9.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.3-9.7">o</dt>
          <dd style="margin-left: 1.0em" id="section-15.3-9.8">The remote PE sends a MAC/IP route update for M with the sticky-bit set 
 (in the MAC Mobility extended community).<a href="#section-15.3-9.8" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="mb">
<section id="section-16">
      <h2 id="name-multicast-and-broadcast">
<a href="#section-16" class="section-number selfRef">16. </a><a href="#name-multicast-and-broadcast" class="section-name selfRef">Multicast and Broadcast</a>
      </h2>
<p id="section-16-1">The PEs in a particular EVPN instance may use ingress replication or
        P2MP or MP2MP LSPs to send multicast traffic to other PEs.<a href="#section-16-1" class="pilcrow">¶</a></p>
<section id="section-16.1">
        <h3 id="name-ingress-replication-3">
<a href="#section-16.1" class="section-number selfRef">16.1. </a><a href="#name-ingress-replication-3" class="section-name selfRef">Ingress Replication</a>
        </h3>
<p id="section-16.1-1">The PEs may use ingress replication for flooding BUM traffic as
            described in <a href="#handling_multi_dest" class="xref">Section 11</a>
            ("<a href="#handling_multi_dest" class="xref">Handling of Multi-destination Traffic</a>").
            A given broadcast packet must be sent to all the remote PEs. However,
            a given multicast packet for a multicast flow may be sent to only a
            subset of the PEs. Specifically, a given multicast flow may be sent
            to only those PEs that have receivers that are interested in the
            multicast flow. Determining which of the PEs have receivers for a
            given multicast flow is done using the procedures of 
            <span>[<a href="#I-D.ietf-bess-evpn-igmp-mld-proxy" class="xref">I-D.ietf-bess-evpn-igmp-mld-proxy</a>]</span>.<a href="#section-16.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-16.2">
        <h3 id="name-p2mp-or-mp2mp-lsps">
<a href="#section-16.2" class="section-number selfRef">16.2. </a><a href="#name-p2mp-or-mp2mp-lsps" class="section-name selfRef">P2MP or MP2MP LSPs</a>
        </h3>
<p id="section-16.2-1">A PE may use an "Inclusive" tree for sending a BUM packet. This
            terminology is borrowed from <span>[<a href="#RFC7117" class="xref">RFC7117</a>]</span>.<a href="#section-16.2-1" class="pilcrow">¶</a></p>
<p id="section-16.2-2">A variety of transport technologies may be used in the service
            provider (SP) network. For Inclusive P-multicast trees, these
            transport technologies include point-to-multipoint LSPs created by
            RSVP-TE or Multipoint LDP (mLDP) or BIER.<a href="#section-16.2-2" class="pilcrow">¶</a></p>
<section id="section-16.2.1">
          <h4 id="name-inclusive-trees">
<a href="#section-16.2.1" class="section-number selfRef">16.2.1. </a><a href="#name-inclusive-trees" class="section-name selfRef">Inclusive Trees</a>
          </h4>
<p id="section-16.2.1-1">An Inclusive tree allows the use of a single multicast distribution
                tree, referred to as an Inclusive P-multicast tree, in the SP network
                to carry all the multicast traffic from a specified set of EVPN
                instances on a given PE. A particular P-multicast tree can be set up
                to carry the traffic originated by sites belonging to a single EVPN
                instance, or to carry the traffic originated by sites belonging to
                several EVPN instances. The ability to carry the traffic of more
                than one EVPN instance on the same tree is termed 'Aggregation', and
                the tree is called an Aggregate Inclusive P-multicast tree or
                Aggregate Inclusive tree for short. The Aggregate Inclusive tree
                needs to include every PE that is a member of any of the EVPN
                instances that are using the tree. This implies that a PE may
                receive BUM traffic even if it doesn't have any receivers that are
                interested in receiving that traffic.<a href="#section-16.2.1-1" class="pilcrow">¶</a></p>
<p id="section-16.2.1-2">An Inclusive or Aggregate Inclusive tree as defined in this document
                is a P2MP tree. A P2MP or MP2MP tree is used to carry traffic only for EVPN
                CEs that are connected to the PE that is the root of the tree.<a href="#section-16.2.1-2" class="pilcrow">¶</a></p>
<p id="section-16.2.1-3">The procedures for signaling an Inclusive tree are the same as those
                in <span>[<a href="#RFC7117" class="xref">RFC7117</a>]</span>, with the VPLS A-D route replaced with the Inclusive
                Multicast Ethernet Tag route. The P-tunnel attribute <span>[<a href="#RFC7117" class="xref">RFC7117</a>]</span> for
                an Inclusive tree is advertised with the Inclusive Multicast Ethernet
                Tag route as described in <a href="#handling_multi_dest" class="xref">Section 11</a>
                ("<a href="#handling_multi_dest" class="xref">Handling of Multi-destination Traffic</a>").
                Note that for an Aggregate Inclusive tree, a PE can
                "aggregate" multiple EVPN instances on the same P2MP LSP using
                upstream labels or DCB allocated 
                labels <span>[<a href="#I-D.ietf-bess-mvpn-evpn-aggregation-label" class="xref">I-D.ietf-bess-mvpn-evpn-aggregation-label</a>]</span>.
                The procedures for aggregation are the same as
                those described in <span>[<a href="#RFC7117" class="xref">RFC7117</a>]</span>,
                with VPLS A-D routes replaced by EVPN
                Inclusive Multicast Ethernet Tag routes.<a href="#section-16.2.1-3" class="pilcrow">¶</a></p>
</section>
</section>
</section>
</div>
<section id="section-17">
      <h2 id="name-convergence">
<a href="#section-17" class="section-number selfRef">17. </a><a href="#name-convergence" class="section-name selfRef">Convergence</a>
      </h2>
<p id="section-17-1">This section describes failure recovery from different types of
        network failures.<a href="#section-17-1" class="pilcrow">¶</a></p>
<section id="section-17.1">
        <h3 id="name-transit-link-and-node-failu">
<a href="#section-17.1" class="section-number selfRef">17.1. </a><a href="#name-transit-link-and-node-failu" class="section-name selfRef">Transit Link and Node Failures between PEs</a>
        </h3>
<p id="section-17.1-1">The use of existing MPLS fast-reroute mechanisms can provide failure
            recovery on the order of 50 ms, in the event of transit link and node
            failures in the infrastructure that connects the PEs.<a href="#section-17.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-17.2">
        <h3 id="name-pe-failures">
<a href="#section-17.2" class="section-number selfRef">17.2. </a><a href="#name-pe-failures" class="section-name selfRef">PE Failures</a>
        </h3>
<p id="section-17.2-1">Consider a host CE1 that is dual-homed to PE1 and PE2. If PE1 fails,
            a remote PE, PE3, can discover this based on the failure of the BGP
            session. This failure detection can be in the sub-second range if
            Bidirectional Forwarding Detection (BFD) is used to detect BGP
            session failures. PE3 can update its forwarding state to start
            sending all traffic for CE1 to only PE2.<a href="#section-17.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-17.3">
        <h3 id="name-pe-to-ce-network-failures">
<a href="#section-17.3" class="section-number selfRef">17.3. </a><a href="#name-pe-to-ce-network-failures" class="section-name selfRef">PE-to-CE Network Failures</a>
        </h3>
<p id="section-17.3-1">If the connectivity between the multihomed CE and one of the PEs to
            which it is attached fails, the PE MUST withdraw the set of Ethernet
            A-D per ES routes that had been previously advertised for that ES.
            This enables the remote PEs to remove the MPLS next hop to this
            particular PE from the set of MPLS next hops that can be used to
            forward traffic to the CE. When the MAC entry on the PE ages out,
            the PE MUST withdraw the MAC address from BGP.<a href="#section-17.3-1" class="pilcrow">¶</a></p>
<p id="section-17.3-2">When an EVI is decommissioned on an Ethernet segment the PE MUST
            withdraw the Ethernet A-D per EVI route(s) announced for
            that &lt;EVI, ES&gt;.
            In addition, the PE MUST also withdraw the MAC/IP Advertisement
            routes that are impacted by the decommissioning.<a href="#section-17.3-2" class="pilcrow">¶</a></p>
<p id="section-17.3-3">The Ethernet A-D per ES routes should be used by an implementation to
            optimize the withdrawal of MAC/IP Advertisement routes. When a PE
            receives a withdrawal of a particular Ethernet A-D route from an
            advertising PE, it SHOULD consider all the MAC/IP Advertisement
            routes that are learned from the same ESI as in the Ethernet A-D
            route from the advertising PE as having been withdrawn. This
            optimizes the network convergence times in the event of PE-to-CE
            failures.<a href="#section-17.3-3" class="pilcrow">¶</a></p>
</section>
</section>
<div id="frame_ordering">
<section id="section-18">
      <h2 id="name-frame-ordering">
<a href="#section-18" class="section-number selfRef">18. </a><a href="#name-frame-ordering" class="section-name selfRef">Frame Ordering</a>
      </h2>
<p id="section-18-1">In a MAC address, if the value of the first nibble (bits 8 through 5)
        of the most significant octet of the destination MAC address (which
        follows the last MPLS label) happens to be 0x4 or 0x6, then the
        Ethernet frame can be misinterpreted as an IPv4 or IPv6 packet by
        intermediate P nodes performing ECMP based on deep packet inspection,
        thus resulting in load balancing packets belonging to the same flow
        on different ECMP paths and subjecting those packets to different
        delays. Therefore, packets belonging to the same flow can arrive at
        the destination out of order. This out-of-order delivery can happen
        during steady state in the absence of any failures, resulting in
        significant impact on network operations.<a href="#section-18-1" class="pilcrow">¶</a></p>
<p id="section-18-2">In order to avoid frame misordering described in <a href="#frame_ordering" class="xref">Section 18</a>,
        the following network-wide rules are applied:<a href="#section-18-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-18-3">
        <dt id="section-18-3.1">-</dt>
        <dd style="margin-left: 1.0em" id="section-18-3.2"> If a network uses deep packet inspection for its ECMP, then the
               "Preferred PW MPLS Control Word" <span>[<a href="#RFC4385" class="xref">RFC4385</a>]</span> MUST be used with the
               value 0 (e.g., a 4-octet field with a value of zero) when sending
               unicast EVPN-encapsulated packets over an MP2P LSP.<a href="#section-18-3.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-18-3.3">-</dt>
        <dd style="margin-left: 1.0em" id="section-18-3.4"> When sending EVPN-encapsulated packets over a P2MP or P2P 
             RSVP-TE LSP, then the control word SHOULD NOT be used.<a href="#section-18-3.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-18-3.5">-</dt>
        <dd style="margin-left: 1.0em" id="section-18-3.6"> When sending EVPN-encapsulated packets over a P2MP LSP (e.g.,  
            using mLDP signaling), then the control word SHOULD be used.<a href="#section-18-3.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-18-3.7">-</dt>
        <dd style="margin-left: 1.0em" id="section-18-3.8"> If a network uses entropy labels per <span>[<a href="#RFC6790" class="xref">RFC6790</a>]</span>, 
            then the control word SHOULD NOT be used when sending EVPN-encapsulated packets 
            over an MP2P LSP.<a href="#section-18-3.8" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<div id="flow_label">
<section id="section-18.1">
        <h3 id="name-flow-label">
<a href="#section-18.1" class="section-number selfRef">18.1. </a><a href="#name-flow-label" class="section-name selfRef">Flow Label</a>
        </h3>
<p id="section-18.1-1">Flow label is used to add entropy to divisible flows, and creates
         ECMP load-balancing in the network.  The Flow Label MAY be used 
         in EVPN networks to achieve better load-balancing in the network, 
         when transit nodes perform deep packet inspection for ECMP hashing.
         The following rules apply:<a href="#section-18.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-18.1-2">
          <dt id="section-18.1-2.1">-</dt>
          <dd style="margin-left: 1.0em" id="section-18.1-2.2">
            <p id="section-18.1-2.2.1"> When F-bit is set to 1, the PE announces the capability of
                both sending and receiving flow label for known unicast. If the PE is capable 
                of supporting Flow Label, then :<a href="#section-18.1-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-18.1-2.2.2.1">upon receiving the F-bit set (F=1) from a remote PE, it MUST send known unicast packets
                  to that PE with Flow labels;<a href="#section-18.1-2.2.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-18.1-2.2.2.2">alternately, upon receiving the F-bit unset (F=0) from a remote PE, it MUST NOT send known unicast packets
                  to that PE with Flow labels.<a href="#section-18.1-2.2.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</dd>
          <dd class="break"></dd>
<dt id="section-18.1-2.3">-</dt>
          <dd style="margin-left: 1.0em" id="section-18.1-2.4">The Flow Label MUST NOT be used for EVPN-encapsulated BUM packets.<a href="#section-18.1-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.1-2.5">-</dt>
          <dd style="margin-left: 1.0em" id="section-18.1-2.6">An ingress PE will push the Flow Label at the bottom of the stack 
             of the EVPN-encapsulated known unicast packets sent to an egress PE 
             that previously signaled F-bit set to 1.<a href="#section-18.1-2.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.1-2.7">-</dt>
          <dd style="margin-left: 1.0em" id="section-18.1-2.8"> If a PE receives a unicast packet with two labels, then it 
             can differentiate 
                between [VPN label + ESI label] and [VPN label + Flow label] and there should 
                be no ambiguity between ESI and Flow labels even if they overlap. The reason 
                for this is that the downstream assigned VPN label for known unicast is different 
                than for BUM traffic and ESI label (if present) comes after BUM VPN label. Therefore,
                from the VPN label, the receiving PE knows whether the next label is a ESI label
                or a Flow label - i.e., if the VPN label is for known unicast, then the next 
                label MUST be a flow label and if the VPN label is for BUM traffic, then the next
                label MUST be an ESI label because BUM packets are not sent with Flow labels.<a href="#section-18.1-2.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.1-2.9">-</dt>
          <dd style="margin-left: 1.0em" id="section-18.1-2.10">When sending EVPN-encapsulated packets over a P2MP LSP
             (either RSVP-TE or mLDP), flow label SHOULD NOT be used.
                This is independant of any F-bit signalling in the L2-Attr Extended
                Community which would still apply to unicast.<a href="#section-18.1-2.10" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="dcb">
<section id="section-19">
      <h2 id="name-use-of-domain-wide-common-b">
<a href="#section-19" class="section-number selfRef">19. </a><a href="#name-use-of-domain-wide-common-b" class="section-name selfRef">Use of Domain-wide Common Block (DCB) Labels</a>
      </h2>
<p id="section-19-1">The use of DCB labels as in <span>[<a href="#I-D.ietf-bess-mvpn-evpn-aggregation-label" class="xref">I-D.ietf-bess-mvpn-evpn-aggregation-label</a>]</span>
        is RECOMMENDED in the following cases:<a href="#section-19-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-19-2">
        <dt id="section-19-2.1">+</dt>
        <dd style="margin-left: 1.0em" id="section-19-2.2">Aggregate P-multicast trees: A P-multicast tree MAY 
     aggregate the traffic of two or more BDs on a given ingress PE. When aggregation 
     is needed, DCB Labels <span>[<a href="#I-D.ietf-bess-mvpn-evpn-aggregation-label" class="xref">I-D.ietf-bess-mvpn-evpn-aggregation-label</a>]</span> 
     MAY be used in the MPLS label field of the Inclusive Multicast Ethernet 
     Tag routes PMSI Tunnel Attribute. The use of DCB Labels, instead of upstream 
     allocated labels, can greatly reduce the number of labels that the egress PEs 
     need to process when P-multicast tunnel aggregation is used in a 
     network with a large number of BDs.<a href="#section-19-2.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-19-2.3">+</dt>
        <dd style="margin-left: 1.0em" id="section-19-2.4">BIER tunnels: As described in <span>[<a href="#I-D.ietf-bier-evpn" class="xref">I-D.ietf-bier-evpn</a>]</span>, the use of 
 labels with BIER tunnels in EVPN networks is similar to aggregate tunnels, 
 since the ingress PE uses upstream allocated labels to identify the BD. As 
 described in [I-D.ietf-bier-evpn], DCB labels can be allocated instead of 
 upstream labels in the PMSI Tunnel Attribute so that the number of labels 
 required on the egress PEs can be reduced.<a href="#section-19-2.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-19-2.5">+</dt>
        <dd style="margin-left: 1.0em" id="section-19-2.6">ESI labels: The ESI labels advertised with EVPN A-D per ES routes 
     MAY be allocated as DCB labels in general, and are RECOMMENDED to be allocated 
     as DCB labels when used in combination with P2MP/BIER tunnels.<a href="#section-19-2.6" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-19-3">When MP2MP tunnels are used, ESI-labels MUST be allocated from a DCB and the 
             same label must be used by all the PEs attached to the same Ethernet Segment. 
             In that way, any egress PE with local Ethernet Segments can identify the 
             source ES of the received BUM packets.<a href="#section-19-3" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-20">
      <h2 id="name-security-considerations">
<a href="#section-20" class="section-number selfRef">20. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-20-1">Security considerations discussed in <span>[<a href="#RFC4761" class="xref">RFC4761</a>]</span> and
        <span>[<a href="#RFC4762" class="xref">RFC4762</a>]</span> apply to
        this document for MAC learning in the data plane over an Attachment
        Circuit (AC) and for flooding of unknown unicast and ARP messages
        over the MPLS/IP core. Security considerations discussed in
        <span>[<a href="#RFC4364" class="xref">RFC4364</a>]</span> apply to this document for MAC learning in the control
        plane over the MPLS/IP core. This section describes additional
        considerations.<a href="#section-20-1" class="pilcrow">¶</a></p>
<p id="section-20-2">As mentioned in <span>[<a href="#RFC4761" class="xref">RFC4761</a>]</span>, there are two aspects to
        achieving data
        privacy and protecting against denial-of-service attacks in a VPN:
        securing the control plane and protecting the forwarding path.
        Compromise of the control plane could result in a PE sending customer
        data belonging to some EVPN to another EVPN, or black-holing EVPN
        customer data, or even sending it to an eavesdropper, none of which
        are acceptable from a data privacy point of view. In addition,
        compromise of the control plane could provide opportunities for
        unauthorized EVPN data usage (e.g., exploiting traffic replication
        within a multicast tree to amplify a denial-of-service attack based
        on sending large amounts of traffic).<a href="#section-20-2" class="pilcrow">¶</a></p>
<p id="section-20-3">The mechanisms in this document use BGP for the control plane.
        Hence, techniques such as those discussed in 
        inter-AS BGP sessions between the Autonomous System Border Routers
        (ASBRs), the PEs, or the Route Reflectors.<span>[<a href="#RFC5925" class="xref">RFC5925</a>]</span> help
        authenticate BGP messages, making it harder to spoof updates (which
                can be used to divert EVPN traffic to the wrong EVPN instance) or
        withdrawals (denial-of-service attacks). In the multi-AS backbone
        options (b) and (c) <span>[<a href="#RFC4364" class="xref">RFC4364</a>]</span>, this also means protecting the<a href="#section-20-3" class="pilcrow">¶</a></p>
<p id="section-20-4">Further discussion of security considerations for BGP may be found in
        the BGP specification itself <span>[<a href="#RFC4271" class="xref">RFC4271</a>]</span> and in the security
        analysis for BGP <span>[<a href="#RFC4272" class="xref">RFC4272</a>]</span>.
        The original discussion of the use of the TCP MD5
        signature option to protect BGP sessions is found in <span>[<a href="#RFC5925" class="xref">RFC5925</a>]</span>,
        while <span>[<a href="#RFC6952" class="xref">RFC6952</a>]</span> includes an analysis of BGP keying and
        authentication issues.<a href="#section-20-4" class="pilcrow">¶</a></p>
<p id="section-20-5">Note that 
        a VPN.<span>[<a href="#RFC5925" class="xref">RFC5925</a>]</span> will not help in keeping MPLS
        labels private -- knowing the labels, one can eavesdrop on EVPN traffic.
        Such eavesdropping additionally requires access to the data path within an
        SP network. Users of VPN services are expected to take appropriate
        precautions (such as encryption) to protect the data exchanged over<a href="#section-20-5" class="pilcrow">¶</a></p>
<p id="section-20-6">One of the requirements for protecting the data plane is that the
        MPLS labels be accepted only from valid interfaces. For a PE, valid
        interfaces comprise links from other routers in the PE's own AS. For
        an ASBR, valid interfaces comprise links from other routers in the
        ASBR's own AS, and links from other ASBRs in ASes that have instances
        of a given EVPN. It is especially important in the case of multi-AS
        EVPN instances that one accept EVPN packets only from valid
        interfaces.<a href="#section-20-6" class="pilcrow">¶</a></p>
<p id="section-20-7">It is also important to help limit malicious traffic into a network
        for an impostor MAC address. The mechanism described in Section 15.1
        shows how duplicate MAC addresses can be detected and continuous
        false MAC mobility can be prevented. The mechanism described in
        Section 15.2 shows how MAC addresses can be pinned to a given
        Ethernet segment, such that if they appear behind any other Ethernet
        segments, the traffic for those MAC addresses can be prevented from
        entering the EVPN network from the other Ethernet segments.<a href="#section-20-7" class="pilcrow">¶</a></p>
</section>
<div id="IANA">
<section id="section-21">
      <h2 id="name-iana-considerations">
<a href="#section-21" class="section-number selfRef">21. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-21-1">This document defines a new NLRI, called "EVPN", to be carried in BGP
        using multiprotocol extensions. This NLRI uses the existing AFI of
        25 (L2VPN). IANA has assigned BGP EVPNs a SAFI value of 70.<a href="#section-21-1" class="pilcrow">¶</a></p>
<p id="section-21-2">IANA has allocated the following EVPN Extended Community sub-types in
        <span>[<a href="#RFC7153" class="xref">RFC7153</a>]</span>,
        and this document is the only reference for them, in addition to <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span>.<a href="#section-21-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-21-3">
<pre>
   0x00     MAC Mobility                 [RFC7432]
   0x01     ESI Label                    [RFC7432]
   0x02     ES-Import Route Target       [RFC7432]
</pre><a href="#section-21-3" class="pilcrow">¶</a>
</div>
<p id="section-21-4">This document creates a registry called "EVPN Route Types". New
        registrations will be made through the "RFC Required" procedure
        defined in <span>[<a href="#RFC5226" class="xref">RFC5226</a>]</span>. The registry has a maximum value of 255.
        Initial registrations from <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span> are as follows:<a href="#section-21-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-21-5">
<pre>
   0     Reserved                           [RFC7432]
   1     Ethernet Auto-discovery            [RFC7432]
   2     MAC/IP Advertisement               [RFC7432]
   3     Inclusive Multicast Ethernet Tag   [RFC7432]
   4     Ethernet Segment                   [RFC7432]
</pre><a href="#section-21-5" class="pilcrow">¶</a>
</div>
<p id="section-21-6">This document requests allocation of bit 3 in the
        "EVPN Layer 2 Attributes Control Flags" registry with name F:<a href="#section-21-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-21-7">
<pre>
   F     Flow Label MUST be present
</pre><a href="#section-21-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<section id="section-22">
      <h2 id="name-references">
<a href="#section-22" class="section-number selfRef">22. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-22.1">
        <h3 id="name-normative-references">
<a href="#section-22.1" class="section-number selfRef">22.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4271">[RFC4271]</dt>
        <dd>
<span class="refAuthor">Rekhter, Y., Ed.</span>, <span class="refAuthor">Li, T., Ed.</span>, and <span class="refAuthor">S. Hares, Ed.</span>, <span class="refTitle">"A Border Gateway Protocol 4 (BGP-4)"</span>, <span class="seriesInfo">RFC 4271</span>, <span class="seriesInfo">DOI 10.17487/RFC4271</span>, <time datetime="2006-01" class="refDate">January 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4271">https://www.rfc-editor.org/info/rfc4271</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4360">[RFC4360]</dt>
        <dd>
<span class="refAuthor">Sangli, S.</span>, <span class="refAuthor">Tappan, D.</span>, and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"BGP Extended Communities Attribute"</span>, <span class="seriesInfo">RFC 4360</span>, <span class="seriesInfo">DOI 10.17487/RFC4360</span>, <time datetime="2006-02" class="refDate">February 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4360">https://www.rfc-editor.org/info/rfc4360</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4364">[RFC4364]</dt>
        <dd>
<span class="refAuthor">Rosen, E.</span> and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"BGP/MPLS IP Virtual Private Networks (VPNs)"</span>, <span class="seriesInfo">RFC 4364</span>, <span class="seriesInfo">DOI 10.17487/RFC4364</span>, <time datetime="2006-02" class="refDate">February 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4364">https://www.rfc-editor.org/info/rfc4364</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4760">[RFC4760]</dt>
        <dd>
<span class="refAuthor">Bates, T.</span>, <span class="refAuthor">Chandra, R.</span>, <span class="refAuthor">Katz, D.</span>, and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"Multiprotocol Extensions for BGP-4"</span>, <span class="seriesInfo">RFC 4760</span>, <span class="seriesInfo">DOI 10.17487/RFC4760</span>, <time datetime="2007-01" class="refDate">January 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4760">https://www.rfc-editor.org/info/rfc4760</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4761">[RFC4761]</dt>
        <dd>
<span class="refAuthor">Kompella, K., Ed.</span> and <span class="refAuthor">Y. Rekhter, Ed.</span>, <span class="refTitle">"Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling"</span>, <span class="seriesInfo">RFC 4761</span>, <span class="seriesInfo">DOI 10.17487/RFC4761</span>, <time datetime="2007-01" class="refDate">January 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4761">https://www.rfc-editor.org/info/rfc4761</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4762">[RFC4762]</dt>
        <dd>
<span class="refAuthor">Lasserre, M., Ed.</span> and <span class="refAuthor">V. Kompella, Ed.</span>, <span class="refTitle">"Virtual Private LAN Service (VPLS) Using Label Distribution Protocol (LDP) Signaling"</span>, <span class="seriesInfo">RFC 4762</span>, <span class="seriesInfo">DOI 10.17487/RFC4762</span>, <time datetime="2007-01" class="refDate">January 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4762">https://www.rfc-editor.org/info/rfc4762</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7153">[RFC7153]</dt>
        <dd>
<span class="refAuthor">Rosen, E.</span> and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"IANA Registries for BGP Extended Communities"</span>, <span class="seriesInfo">RFC 7153</span>, <span class="seriesInfo">DOI 10.17487/RFC7153</span>, <time datetime="2014-03" class="refDate">March 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7153">https://www.rfc-editor.org/info/rfc7153</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7432">[RFC7432]</dt>
        <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Aggarwal, R.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Isaac, A.</span>, <span class="refAuthor">Uttaro, J.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"BGP MPLS-Based Ethernet VPN"</span>, <span class="seriesInfo">RFC 7432</span>, <span class="seriesInfo">DOI 10.17487/RFC7432</span>, <time datetime="2015-02" class="refDate">February 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7432">https://www.rfc-editor.org/info/rfc7432</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8214">[RFC8214]</dt>
        <dd>
<span class="refAuthor">Boutros, S.</span>, <span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Salam, S.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">J. Rabadan</span>, <span class="refTitle">"Virtual Private Wire Service Support in Ethernet VPN"</span>, <span class="seriesInfo">RFC 8214</span>, <span class="seriesInfo">DOI 10.17487/RFC8214</span>, <time datetime="2017-08" class="refDate">August 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8214">https://www.rfc-editor.org/info/rfc8214</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8584">[RFC8584]</dt>
      <dd>
<span class="refAuthor">Rabadan, J., Ed.</span>, <span class="refAuthor">Mohanty, S., Ed.</span>, <span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Nagaraj, K.</span>, and <span class="refAuthor">S. Sathappan</span>, <span class="refTitle">"Framework for Ethernet VPN Designated Forwarder Election Extensibility"</span>, <span class="seriesInfo">RFC 8584</span>, <span class="seriesInfo">DOI 10.17487/RFC8584</span>, <time datetime="2019-04" class="refDate">April 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8584">https://www.rfc-editor.org/info/rfc8584</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-22.2">
        <h3 id="name-informative-references">
<a href="#section-22.2" class="section-number selfRef">22.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-bess-evpn-igmp-mld-proxy">[I-D.ietf-bess-evpn-igmp-mld-proxy]</dt>
        <dd>
<span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Thoria, S.</span>, <span class="refAuthor">Mishra, M. P.</span>, <span class="refAuthor">Patel, K.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">W. Lin</span>, <span class="refTitle">"IGMP and MLD Proxy for EVPN"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-evpn-igmp-mld-proxy-07</span>, <time datetime="2021-04-12" class="refDate">12 April 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-bess-evpn-igmp-mld-proxy-07.txt">https://www.ietf.org/archive/id/draft-ietf-bess-evpn-igmp-mld-proxy-07.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-bess-evpn-mh-split-horizon">[I-D.ietf-bess-evpn-mh-split-horizon]</dt>
        <dd>
<span class="refAuthor">Rabadan, J.</span>, <span class="refAuthor">Nagaraj, K.</span>, <span class="refAuthor">Lin, W.</span>, and <span class="refAuthor">A. Sajassi</span>, <span class="refTitle">"EVPN Multi-Homing Extensions for Split Horizon Filtering"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-evpn-mh-split-horizon-01</span>, <time datetime="2021-04-12" class="refDate">12 April 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-bess-evpn-mh-split-horizon-01.txt">https://www.ietf.org/archive/id/draft-ietf-bess-evpn-mh-split-horizon-01.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-bess-mvpn-evpn-aggregation-label">[I-D.ietf-bess-mvpn-evpn-aggregation-label]</dt>
        <dd>
<span class="refAuthor">Zhang, Z. J.</span>, <span class="refAuthor">Rosen, E. C.</span>, <span class="refAuthor">Lin, W.</span>, <span class="refAuthor">Li, Z.</span>, and <span class="refAuthor">I. Wijnands</span>, <span class="refTitle">"MVPN/EVPN Tunnel Aggregation with Common Labels"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-mvpn-evpn-aggregation-label-06</span>, <time datetime="2021-04-19" class="refDate">19 April 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-bess-mvpn-evpn-aggregation-label-06.txt">https://www.ietf.org/archive/id/draft-ietf-bess-mvpn-evpn-aggregation-label-06.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-bier-evpn">[I-D.ietf-bier-evpn]</dt>
        <dd>
<span class="refAuthor">Zhang, Z.</span>, <span class="refAuthor">Przygienda, T.</span>, <span class="refAuthor">Sajassi, A.</span>, and <span class="refAuthor">J. Rabadan</span>, <span class="refTitle">"EVPN BUM Using BIER"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bier-evpn-04</span>, <time datetime="2020-12-02" class="refDate">2 December 2020</time>, <span>&lt;<a href="https://www.ietf.org/internet-drafts/draft-ietf-bier-evpn-04.txt">https://www.ietf.org/internet-drafts/draft-ietf-bier-evpn-04.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IEEE.802.1D_2004">[IEEE.802.1D_2004]</dt>
        <dd>
<span class="refAuthor">IEEE</span>, <span class="refTitle">"IEEE Standard for Local and metropolitan area networks: Media Access Control (MAC) Bridges"</span>, <span class="seriesInfo">IEEE 802.1D-2004</span>, <span class="seriesInfo">DOI 10.1109/ieeestd.2004.94569</span>, <time datetime="2004-07-06" class="refDate">6 July 2004</time>, <span>&lt;<a href="http://ieeexplore.ieee.org/servlet/opac?punumber=9155">http://ieeexplore.ieee.org/servlet/opac?punumber=9155</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IEEE.802.1Q_2014">[IEEE.802.1Q_2014]</dt>
        <dd>
<span class="refAuthor">IEEE</span>, <span class="refTitle">"IEEE Standard for Local and metropolitan area networks--Bridges and Bridged Networks"</span>, <span class="seriesInfo">IEEE 802.1Q-2014</span>, <span class="seriesInfo">DOI 10.1109/ieeestd.2014.6991462</span>, <time datetime="2014-12-18" class="refDate">18 December 2014</time>, <span>&lt;<a href="http://ieeexplore.ieee.org/servlet/opac?punumber=6991460">http://ieeexplore.ieee.org/servlet/opac?punumber=6991460</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4272">[RFC4272]</dt>
        <dd>
<span class="refAuthor">Murphy, S.</span>, <span class="refTitle">"BGP Security Vulnerabilities Analysis"</span>, <span class="seriesInfo">RFC 4272</span>, <span class="seriesInfo">DOI 10.17487/RFC4272</span>, <time datetime="2006-01" class="refDate">January 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4272">https://www.rfc-editor.org/info/rfc4272</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4385">[RFC4385]</dt>
        <dd>
<span class="refAuthor">Bryant, S.</span>, <span class="refAuthor">Swallow, G.</span>, <span class="refAuthor">Martini, L.</span>, and <span class="refAuthor">D. McPherson</span>, <span class="refTitle">"Pseudowire Emulation Edge-to-Edge (PWE3) Control Word for Use over an MPLS PSN"</span>, <span class="seriesInfo">RFC 4385</span>, <span class="seriesInfo">DOI 10.17487/RFC4385</span>, <time datetime="2006-02" class="refDate">February 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4385">https://www.rfc-editor.org/info/rfc4385</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4664">[RFC4664]</dt>
        <dd>
<span class="refAuthor">Andersson, L., Ed.</span> and <span class="refAuthor">E. Rosen, Ed.</span>, <span class="refTitle">"Framework for Layer 2 Virtual Private Networks (L2VPNs)"</span>, <span class="seriesInfo">RFC 4664</span>, <span class="seriesInfo">DOI 10.17487/RFC4664</span>, <time datetime="2006-09" class="refDate">September 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4664">https://www.rfc-editor.org/info/rfc4664</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4684">[RFC4684]</dt>
        <dd>
<span class="refAuthor">Marques, P.</span>, <span class="refAuthor">Bonica, R.</span>, <span class="refAuthor">Fang, L.</span>, <span class="refAuthor">Martini, L.</span>, <span class="refAuthor">Raszuk, R.</span>, <span class="refAuthor">Patel, K.</span>, and <span class="refAuthor">J. Guichard</span>, <span class="refTitle">"Constrained Route Distribution for Border Gateway Protocol/MultiProtocol Label Switching (BGP/MPLS) Internet Protocol (IP) Virtual Private Networks (VPNs)"</span>, <span class="seriesInfo">RFC 4684</span>, <span class="seriesInfo">DOI 10.17487/RFC4684</span>, <time datetime="2006-11" class="refDate">November 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4684">https://www.rfc-editor.org/info/rfc4684</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5226">[RFC5226]</dt>
        <dd>
<span class="refAuthor">Narten, T.</span> and <span class="refAuthor">H. Alvestrand</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">RFC 5226</span>, <span class="seriesInfo">DOI 10.17487/RFC5226</span>, <time datetime="2008-05" class="refDate">May 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5226">https://www.rfc-editor.org/info/rfc5226</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5925">[RFC5925]</dt>
        <dd>
<span class="refAuthor">Touch, J.</span>, <span class="refAuthor">Mankin, A.</span>, and <span class="refAuthor">R. Bonica</span>, <span class="refTitle">"The TCP Authentication Option"</span>, <span class="seriesInfo">RFC 5925</span>, <span class="seriesInfo">DOI 10.17487/RFC5925</span>, <time datetime="2010-06" class="refDate">June 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5925">https://www.rfc-editor.org/info/rfc5925</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6514">[RFC6514]</dt>
        <dd>
<span class="refAuthor">Aggarwal, R.</span>, <span class="refAuthor">Rosen, E.</span>, <span class="refAuthor">Morin, T.</span>, and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"BGP Encodings and Procedures for Multicast in MPLS/BGP IP VPNs"</span>, <span class="seriesInfo">RFC 6514</span>, <span class="seriesInfo">DOI 10.17487/RFC6514</span>, <time datetime="2012-02" class="refDate">February 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6514">https://www.rfc-editor.org/info/rfc6514</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6790">[RFC6790]</dt>
        <dd>
<span class="refAuthor">Kompella, K.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Amante, S.</span>, <span class="refAuthor">Henderickx, W.</span>, and <span class="refAuthor">L. Yong</span>, <span class="refTitle">"The Use of Entropy Labels in MPLS Forwarding"</span>, <span class="seriesInfo">RFC 6790</span>, <span class="seriesInfo">DOI 10.17487/RFC6790</span>, <time datetime="2012-11" class="refDate">November 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6790">https://www.rfc-editor.org/info/rfc6790</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6952">[RFC6952]</dt>
        <dd>
<span class="refAuthor">Jethanandani, M.</span>, <span class="refAuthor">Patel, K.</span>, and <span class="refAuthor">L. Zheng</span>, <span class="refTitle">"Analysis of BGP, LDP, PCEP, and MSDP Issues According to the Keying and Authentication for Routing Protocols (KARP) Design Guide"</span>, <span class="seriesInfo">RFC 6952</span>, <span class="seriesInfo">DOI 10.17487/RFC6952</span>, <time datetime="2013-05" class="refDate">May 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6952">https://www.rfc-editor.org/info/rfc6952</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7117">[RFC7117]</dt>
        <dd>
<span class="refAuthor">Aggarwal, R., Ed.</span>, <span class="refAuthor">Kamite, Y.</span>, <span class="refAuthor">Fang, L.</span>, <span class="refAuthor">Rekhter, Y.</span>, and <span class="refAuthor">C. Kodeboniya</span>, <span class="refTitle">"Multicast in Virtual Private LAN Service (VPLS)"</span>, <span class="seriesInfo">RFC 7117</span>, <span class="seriesInfo">DOI 10.17487/RFC7117</span>, <time datetime="2014-02" class="refDate">February 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7117">https://www.rfc-editor.org/info/rfc7117</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7209">[RFC7209]</dt>
        <dd>
<span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Aggarwal, R.</span>, <span class="refAuthor">Uttaro, J.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Henderickx, W.</span>, and <span class="refAuthor">A. Isaac</span>, <span class="refTitle">"Requirements for Ethernet VPN (EVPN)"</span>, <span class="seriesInfo">RFC 7209</span>, <span class="seriesInfo">DOI 10.17487/RFC7209</span>, <time datetime="2014-05" class="refDate">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7209">https://www.rfc-editor.org/info/rfc7209</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8317">[RFC8317]</dt>
        <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Salam, S.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Uttaro, J.</span>, <span class="refAuthor">Boutros, S.</span>, and <span class="refAuthor">J. Rabadan</span>, <span class="refTitle">"Ethernet-Tree (E-Tree) Support in Ethernet VPN (EVPN) and Provider Backbone Bridging EVPN (PBB-EVPN)"</span>, <span class="seriesInfo">RFC 8317</span>, <span class="seriesInfo">DOI 10.17487/RFC8317</span>, <time datetime="2018-01" class="refDate">January 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8317">https://www.rfc-editor.org/info/rfc8317</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8365">[RFC8365]</dt>
        <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Drake, J., Ed.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Shekhar, R.</span>, <span class="refAuthor">Uttaro, J.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"A Network Virtualization Overlay Solution Using Ethernet VPN (EVPN)"</span>, <span class="seriesInfo">RFC 8365</span>, <span class="seriesInfo">DOI 10.17487/RFC8365</span>, <time datetime="2018-03" class="refDate">March 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8365">https://www.rfc-editor.org/info/rfc8365</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9136">[RFC9136]</dt>
      <dd>
<span class="refAuthor">Rabadan, J., Ed.</span>, <span class="refAuthor">Henderickx, W.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Lin, W.</span>, and <span class="refAuthor">A. Sajassi</span>, <span class="refTitle">"IP Prefix Advertisement in Ethernet VPN (EVPN)"</span>, <span class="seriesInfo">RFC 9136</span>, <span class="seriesInfo">DOI 10.17487/RFC9136</span>, <time datetime="2021-10" class="refDate">October 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9136">https://www.rfc-editor.org/info/rfc9136</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<section id="appendix-A">
      <h2 id="name-acknowledgments-for-this-do">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-acknowledgments-for-this-do" class="section-name selfRef">Acknowledgments for This Document (2021)</a>
    </h2>
</section>
<section id="appendix-B">
      <h2 id="name-contributors-for-this-docum">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-contributors-for-this-docum" class="section-name selfRef">Contributors for This Document (2021)</a>
      </h2>
<p id="appendix-B-1">In addition to the authors listed on the front page, the following co-authors
        have also contributed to this document:<a href="#appendix-B-1" class="pilcrow">¶</a></p>
</section>
<section id="appendix-C">
      <h2 id="name-acknowledgments-from-the-fi">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-acknowledgments-from-the-fi" class="section-name selfRef">Acknowledgments from the First Edition (2015)</a>
      </h2>
<p id="appendix-C-1">Special thanks to Yakov Rekhter for reviewing this document several
        times and providing valuable comments, and for his very engaging
        discussions on several topics of this document that helped shape this
        document. We would also like to thank Pedro Marques, Kaushik Ghosh,
        Nischal Sheth, Robert Raszuk, Amit Shukla, and Nadeem Mohammed for
        discussions that helped shape this document. We would also like to
        thank Han Nguyen for his comments and support of this work. We would
        also like to thank Steve Kensil and Reshad Rahman for their reviews.
        We would like to thank Jorge Rabadan for his contribution to
        <a href="#ethernet_segment" class="xref">Section 5</a> of this document.
        We would like to thank Thomas Morin for
        his review of this document and his contribution of <a href="#interop_sh" class="xref">Section 8.7</a>.
        Many thanks to Jakob Heitz for his help to improve several sections
        of this document.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<p id="appendix-C-2">We would also like to thank Clarence Filsfils, Dennis Cai, Quaizar
        Vohra, Kireeti Kompella, and Apurva Mehta for their contributions to
        this document.<a href="#appendix-C-2" class="pilcrow">¶</a></p>
<p id="appendix-C-3">Last but not least, special thanks to Giles Heron (our WG chair) for
        his detailed review of this document in preparation for WG Last Call
        and for making many valuable suggestions.<a href="#appendix-C-3" class="pilcrow">¶</a></p>
<section id="appendix-C.1">
        <h3 id="name-contributors-from-the-first">
<a href="#appendix-C.1" class="section-number selfRef">C.1. </a><a href="#name-contributors-from-the-first" class="section-name selfRef">Contributors from the First Edition (2015)</a>
        </h3>
<p id="appendix-C.1-1">In addition to the authors listed on the front page, the following
            co-authors have also contributed to this document:<a href="#appendix-C.1-1" class="pilcrow">¶</a></p>
<p id="appendix-C.1-2">Keyur Patel
            Samer Salam
            Sami Boutros
            Cisco<a href="#appendix-C.1-2" class="pilcrow">¶</a></p>
<p id="appendix-C.1-3">Yakov Rekhter
            Ravi Shekhar
            Juniper Networks<a href="#appendix-C.1-3" class="pilcrow">¶</a></p>
<p id="appendix-C.1-4">Florin Balus
            Nuage Networks<a href="#appendix-C.1-4" class="pilcrow">¶</a></p>
</section>
<section id="appendix-C.2">
        <h3 id="name-authors-from-the-first-edit">
<a href="#appendix-C.2" class="section-number selfRef">C.2. </a><a href="#name-authors-from-the-first-edit" class="section-name selfRef">Authors from the First Edition (2015)</a>
        </h3>
<p id="appendix-C.2-1">Original Authors:<a href="#appendix-C.2-1" class="pilcrow">¶</a></p>
<p id="appendix-C.2-2">
            Ali Sajassi
            Cisco
            
            EMail: sajassi@cisco.com<a href="#appendix-C.2-2" class="pilcrow">¶</a></p>
<p id="appendix-C.2-3">
            Rahul Aggarwal
            Arktan
            
            EMail: raggarwa_1@yahoo.com<a href="#appendix-C.2-3" class="pilcrow">¶</a></p>
<p id="appendix-C.2-4">
            Nabil Bitar
            Verizon Communications
            
            EMail : nabil.n.bitar@verizon.com<a href="#appendix-C.2-4" class="pilcrow">¶</a></p>
<p id="appendix-C.2-5">
            Aldrin Isaac
            Bloomberg
            
            EMail: aisaac71@bloomberg.net<a href="#appendix-C.2-5" class="pilcrow">¶</a></p>
<p id="appendix-C.2-6">
            James Uttaro
            AT&amp;T
            
            EMail: uttaro@att.com<a href="#appendix-C.2-6" class="pilcrow">¶</a></p>
<p id="appendix-C.2-7">
            John Drake
            Juniper Networks
            
            EMail: jdrake@juniper.net<a href="#appendix-C.2-7" class="pilcrow">¶</a></p>
<p id="appendix-C.2-8">
            Wim Henderickx
            Alcatel-Lucent
            
            EMail: wim.henderickx@alcatel-lucent.com<a href="#appendix-C.2-8" class="pilcrow">¶</a></p>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Ali Sajassi</span></div>
<div dir="auto" class="left"><span class="org">Cisco</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:sajassi@cisco.com" class="email">sajassi@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Luc Andre Burdet (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Cisco</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:lburdet@cisco.com" class="email">lburdet@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">John Drake</span></div>
<div dir="auto" class="left"><span class="org">Juniper</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jdrake@juniper.net" class="email">jdrake@juniper.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jorge Rabadan</span></div>
<div dir="auto" class="left"><span class="org">Nokia</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jorge.rabadan@nokia.com" class="email">jorge.rabadan@nokia.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
