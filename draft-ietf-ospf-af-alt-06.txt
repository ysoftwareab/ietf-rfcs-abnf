


Network Working Group                                 A. Lindem (Editor)
Internet-Draft                                          Redback Networks
Intended status: Standards Track                            S. Mirtorabi
Expires: April 3, 2008                                  Force10 Networks
                                                                  A. Roy
                                                               M. Barnes
                                                           Cisco Systems
                                                             R. Aggarwal
                                                        Juniper Networks
                                                            October 2007


                 Support of address families in OSPFv3
                     draft-ietf-ospf-af-alt-06.txt

Status of this Memo

   By submitting this Internet-Draft, each author represents that any
   applicable patent or other IPR claims of which he or she is aware
   have been or will be disclosed, and any of which he or she becomes
   aware will be disclosed, in accordance with Section 6 of BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on April 3, 2008.

Copyright Notice

   Copyright (C) The IETF Trust (2007).








Lindem (Editor), et al.   Expires April 3, 2008                 [Page 1]

Internet-Draft                  OSPFv3 AF                   October 2007


Abstract

   This document describes a mechanism for supporting multiple address
   families in OSPFv3 using multiple instances.  It maps an address
   family (AF) to an OSPFv3 instance using the Instance ID field in the
   OSPFv3 packet header.  This approach is fairly simple and minimizes
   extensions to OSPFv3 for supporting multiple AFs.


Table of Contents

   1.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  3
     1.1.  Design Considerations  . . . . . . . . . . . . . . . . . .  3
     1.2.  Requirements notation  . . . . . . . . . . . . . . . . . .  3
   2.  Protocol Details . . . . . . . . . . . . . . . . . . . . . . .  4
     2.1.  Instance ID values for new AFs . . . . . . . . . . . . . .  4
     2.2.  OSPFv3 Options and Prefix Options Changes  . . . . . . . .  4
       2.2.1.  OSPFv3 Options . . . . . . . . . . . . . . . . . . . .  4
       2.2.2.  Prefix Options . . . . . . . . . . . . . . . . . . . .  5
     2.3.  Advertising Prefixes in new AFs  . . . . . . . . . . . . .  5
     2.4.  Changes to the Hello processing  . . . . . . . . . . . . .  6
     2.5.  Next hop for IPv4 unicast and multicast AFs  . . . . . . .  6
     2.6.  AS External LSA Forwarding Address for IPv4 Unicast
           and  IPv4 Multicast AFs  . . . . . . . . . . . . . . . . .  7
     2.7.  Operation over Virtual Links . . . . . . . . . . . . . . .  7
   3.  Backward Compatibility . . . . . . . . . . . . . . . . . . . .  8
   4.  Security Considerations  . . . . . . . . . . . . . . . . . . .  9
   5.  IANA Considerations  . . . . . . . . . . . . . . . . . . . . . 10
   6.  References . . . . . . . . . . . . . . . . . . . . . . . . . . 12
     6.1.  Normative References . . . . . . . . . . . . . . . . . . . 12
     6.2.  Informative References . . . . . . . . . . . . . . . . . . 12
   Appendix A.  Acknowledgments . . . . . . . . . . . . . . . . . . . 13
   Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . . . 14
   Intellectual Property and Copyright Statements . . . . . . . . . . 15

















Lindem (Editor), et al.   Expires April 3, 2008                 [Page 2]

Internet-Draft                  OSPFv3 AF                   October 2007


1.  Introduction

   OSPFv3 has been defined to support the base IPv6 unicast Address
   Family (AF).  There is a requirement to advertise other AFs in OSPFv3
   including multicast IPv6, unicast IPv4, and multicast IPv4.  This
   document supports these other AFs in OSPFv3 by mapping each to a
   separate Instance ID and OSPFv3 instance.

1.1.  Design Considerations

   This section describes the rationale for using the multiple instance
   ID approach to support multiple address families in OSPFv3.  As
   described earlier, OSPFv3 is designed to support multiple instances.
   Hence mapping an instance to an address family doesn't introduce any
   new mechanisms to the protocol.  It minimizes the protocol extensions
   required and it simplifies the implementation.  The presence of a
   separate link state database per address family is also easier to
   debug and operate.  Additionally, it doesn't change the existing
   instance, area, and interface based configuration model in most
   OSPFv3 implementations.

1.2.  Requirements notation

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC-KEYWORDS].

























Lindem (Editor), et al.   Expires April 3, 2008                 [Page 3]

Internet-Draft                  OSPFv3 AF                   October 2007


2.  Protocol Details

   Currently the entire Instance ID number space is used for IPv6
   unicast.  This specification assigns different Instance ID ranges to
   different AFs in order to support other AFs in OSPFv3.  Each Instance
   ID implies a separate OSPFv3 instance with its own neighbor
   adjacencies, link state database, protocol data structures, and
   shortest path first (SPF) computation.  Additionally, the current
   LSAs that are defined to advertise IPv6 unicast prefixes can be used
   without any modifications to advertise prefixes from other AFs.

   It should be noted that OSPFv3 is running on the top of IPv6 and uses
   IPv6 link local addresses for OSPFv3 control packets and next hop
   calculations.  Therefore, it is required that IPv6 be enabled on a
   link, although the link may not be participating in the IPv6 unicast
   AF.

2.1.  Instance ID values for new AFs

   Instance ID zero is already defined by default for the IPv6 unicast
   AF.  We define the following ranges for different AFs.  The first
   value of each range is considered as the default value for the
   corresponding AF.

      Instance ID # 0    -  # 31     IPv6 unicast AF
      Instance ID # 32   -  # 63     IPv6 multicast AF
      Instance ID # 64   -  # 95     IPv4 unicast AF
      Instance ID # 96   -  # 127    IPv4 multicast AF
      Instance ID # 128  -  # 255    Unassigned

                            OSPFv3 Instance IDs

2.2.  OSPFv3 Options and Prefix Options Changes

   A new bit is added to the OSPFv3 options field.  A couple of the
   option bits are only applicable to the IPv6 unicast AF.

2.2.1.  OSPFv3 Options



                               1                     2
           0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8  9  0  1  2  3
          +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+--+-+-+--+--+--+
          | | | | | | | | | | | | | | | |AF|*|*|DC|R|N|MC| E|V6|
          +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+--+-+-+--+--+--+

                           The Options field



Lindem (Editor), et al.   Expires April 3, 2008                 [Page 4]

Internet-Draft                  OSPFv3 AF                   October 2007


                              OSPFv3 Options


   V6-bit
      The V6 bit is used in OSPFv3 to exclude a node from IPv6 unicast
      route calculation but allow it in the SPF calculation for other
      address families.  Since Instance ID now denotes the AF
      explicitly, this bit is ignored in AFs other than IPv6 unicast.

   MC-bit
      This bit is not used in other AFs introduced in this document.

   AF-bit
      When a router supports AF, it MUST set this new bit in the OSPFv3
      Options field of Hello Packets, DD packets, and LSAs.

2.2.2.  Prefix Options


                0  1  2  3  4  5  6  7
               +--+--+--+--+--+--+--+--+
               |  |  |  |  | P|* |LA|NU|
               +--+--+--+--+--+--+--+--+


                              Prefix Options


   MC-bit
      This bit is ignored in AFs other than IPv6 Unicast.

   NU-bit
      The NU bit MUST be clear in all unicast AFs and it MUST be set in
      all multicast AFs.

   Note that all bits unused in a given AF MAY be redefined for AF
   specific purposes in future specifications.

2.3.  Advertising Prefixes in new AFs

   Each Prefix defined in OSPFv3 has a prefix length field.  This
   facilitate advertising prefixes of different lengths in different
   AFs.  The existing LSAs defined in OSPFv3 are used for this purpose
   and there is no need to define new LSAs.







Lindem (Editor), et al.   Expires April 3, 2008                 [Page 5]

Internet-Draft                  OSPFv3 AF                   October 2007


2.4.  Changes to the Hello processing

   When a router does not support an AF but it is configured the
   corresponding Instance ID packets could be black holed.  This could
   happen due to misconfiguration or a router software downgrade.  Black
   holing is possible because the router which doesn't support the AF
   can still be included in the SPF calculated path as long as it
   establishes adjacencies using the Instance ID corresponding to the
   AF.  Note that router and network LSAs are AF independent.

   In order to avoid the above situation, hello processing is changed in
   order to only establish adjacencies with routers that have the AF-bit
   set in their Options field.

   Receiving Hello Packets is specified in section 3.2.2.1 of [OSPFV3].
   The following check is added to Hello reception:


   o  When a router participates in an AF (sets the AF-bit in Options
      field) it MUST discard Hello packets having the AF-bit clear in
      the Options field.  The only exception is IPv6 unicast AF, where
      this check MUST NOT be done (for backward compatibility).

2.5.  Next hop for IPv4 unicast and multicast AFs

   OSPFv3 runs on the top of IPv6 and uses IPv6 link local addresses for
   OSPFv3 control packets and next hop calculations.  Although IPV6 link
   local addresses could be used as next hops for IPv4 address families,
   it is desirable to have IPv4 next hop addresses.  For example, in
   IPv4 multicast having the next hop address the same as the Protocol
   Independent Multicast (PIM) [PIM] neighbor address (IPv4 address)
   makes it easier to determine which upstream neighbor to send a PIM
   join when doing a Reverse Path Forwarding (RPF) lookup.  It is also
   easier for troubleshooting to have a next hop with the same AF.

   In order to achieve this, the link's IPv4 address will be advertised
   in the "link local address" field of the IPv4 instance's Link-LSA.
   This address is placed in the first 32 bit of "link local address"
   field and used for IPv4 next hop calculations.

   We call direct interface address (DIA) the address that is reachable
   directly via the link provided that a layer 3 to layer 2 mapping is
   available.  Note that there is no explicit need for the IPv4 link
   addresses to be on the same subnet.  An implementation should resolve
   layer 3 to layer 2 mappings via Address Resolution Protocol (ARP)
   [ARP] or Neighbor Discovery (ND) [ND] for a DIA even if the IPv4
   address is not on the same subnet as the router's interface IP
   address.



Lindem (Editor), et al.   Expires April 3, 2008                 [Page 6]

Internet-Draft                  OSPFv3 AF                   October 2007


2.6.  AS External LSA Forwarding Address for IPv4 Unicast and  IPv4
      Multicast AFs

   For OSPFv3, this address is fully qualified IPv6 address (128 bits).
   If included, data traffic for the advertised destination will be
   forwarded to this address.  For IPv4 unicast and IPv4 multicast AFs,
   the Forwarding address in AS-external-LSAs MUST encode an IPv4
   address.  To achieve this, the IPv4 Forwarding address is advertised
   by placing it in the first 32 bits of the Forwarding address field in
   the AS-external-LSAs.  The remaining bits MUST be set to zero.

2.7.  Operation over Virtual Links

   OSPFv3 control packets sent over a virtual link are IPv6 packets and
   may traverse multiples hops.  Therefore, there must be a global IPv6
   address associated with the virtual link so that the control packet
   is forwarded correctly by the intermediate hops between virtual link
   endpoints.  Although this requirement can be satisfied in IPv6
   unicast AFs, it will not function in other AFs as there will not be a
   routable global IPv6 address or forwarding path.  Therefore, virtual
   links are not supported in AFs other than IPv6 Unicast.






























Lindem (Editor), et al.   Expires April 3, 2008                 [Page 7]

Internet-Draft                  OSPFv3 AF                   October 2007


3.  Backward Compatibility

   In this section, we will define a non-capable OSPFv3 router as one
   not supporting this specification.  Each new AF will have a
   corresponding Instance ID and can interoperate with the existing non-
   capable OSPFv3 routers in an IPv6 unicast topology.  Furthermore,
   when a non-capable OSPFv3 router uses an Instance ID which is
   reserved for a given AF, no adjacency will be formed with this router
   since the AF-bit in the Options field will not be set in Hello
   packets.  Therefore, there are no backward compatibility issues.  AFs
   can be gradually deployed without disturbing networks with non-
   capable OSPFv3 routers.







































Lindem (Editor), et al.   Expires April 3, 2008                 [Page 8]

Internet-Draft                  OSPFv3 AF                   October 2007


4.  Security Considerations

   The function described in this document does not create any new
   security issues for the OSPF protocol.  Security considerations for
   the OSPFv3 are covered in [OSPFV3].














































Lindem (Editor), et al.   Expires April 3, 2008                 [Page 9]

Internet-Draft                  OSPFv3 AF                   October 2007


5.  IANA Considerations

   The following IANA assignments are to be made from existing
   registries:

   o  An OSPFv3 options bit will be allocated for support of address
      families using separate instances.

   IANA is requested to create a new registry, "OSPFv3 Instance ID
   Address Family Values". for assignment of address families IDs.  Note
   that the Instance ID MAY be used for applications other than the
   support of multiple address families.  However, if it is being used
   for address families the assignments herein should be honored.

            +-------------+----------------------+--------------------+
            | Value/Range | Designation          | Assignment Policy  |
            +-------------+----------------------+--------------------+
            | 0           | Base IPv6 Unicast AF | Already assigned   |
            |             |                      |                    |
            | 1-31        | IPv6 Unicast AFs     | Already assigned   |
            |             | dependent on local   |                    |
            |             | policy               |                    |
            |             |                      |                    |
            | 32          | Base IPv6 Multicast  | Already assigned   |
            |             |                      |                    |
            | 33-63       | IPv6 Multicast AFs   | Already assigned   |
            |             | dependent on local   |                    |
            |             | policy               |                    |
            |             |                      |                    |
            | 64          | Base IPv4 Unicast AF | Already assigned   |
            |             |                      |                    |
            | 65-95       | IPv4 Unicast AFs     | Already assigned   |
            |             | dependent on local   |                    |
            |             | policy               |                    |
            |             |                      |                    |
            | 96          | Base IPv4 Multicast  | Already assigned   |
            |             |                      |                    |
            | 97-127      | IPv4 Multicast AFs   | Already assigned   |
            |             | dependent on local   |                    |
            |             | policy               |                    |
            |             |                      |                    |
            | 128-255     | Unassigned           | Standards Action   |
            +-------------+----------------------+--------------------+

                 OSPFv3 Address Family Use of Instance IDs






Lindem (Editor), et al.   Expires April 3, 2008                [Page 10]

Internet-Draft                  OSPFv3 AF                   October 2007


   o  Instancs IDs 0-127 are assigned by this specification.

   o  Instance IDs in the range 128-255 are not assigned at this time.
      Before any assignments can be made in this range, there MUST be a
      Standards Track RFC including IANA Considerations explicitely
      specifying the AF Instance IDs being assigned.













































Lindem (Editor), et al.   Expires April 3, 2008                [Page 11]

Internet-Draft                  OSPFv3 AF                   October 2007


6.  References

6.1.  Normative References

   [OSPFV3]   Coltun, R., Ferguson, D., and J. Moy, "OSPF for IPv6",
              RFC 2740, December 1999.

   [RFC-KEYWORDS]
              Bradner, S., "Key words for use in RFC's to Indicate
              Requirement Levels", RFC 2119, March 1997.

6.2.  Informative References

   [ARP]      Plummer, D., "An Ethernet Address Resolution Protocol",
              RFC 826, November 1982.

   [ND]       Narten, T., Nordmark, E., and W. Simpson, "Neighbor
              Discovery for IP Version 6 (IPv6)", RFC 2461,
              December 1998.

   [PIM]      Fenner, B., Handley, M., Holbrook, H., and I. Kouvelas,
              "Protocol Independent Multicast - Sparse Mode (PIM-SM):
              Protocol Specification (Revised)", RFC 4601, August 2006.




























Lindem (Editor), et al.   Expires April 3, 2008                [Page 12]

Internet-Draft                  OSPFv3 AF                   October 2007


Appendix A.  Acknowledgments

   The RFC text was produced using Marshall Rose's xml2rfc tool.

   Thanks to Tom Henderson and the folks at Boeing for implementing in
   quagga.













































Lindem (Editor), et al.   Expires April 3, 2008                [Page 13]

Internet-Draft                  OSPFv3 AF                   October 2007


Authors' Addresses

   Acee Lindem
   Redback Networks
   102 Carric Bend Court
   Cary, NC  27519
   USA

   Email: acee@redback.com


   Sina Mirtorabi
   Force10 Networks
   350 Holger Way
   San Jose, CA  95134
   USA

   Email: sina@force10networks.com


   Abhay Roy
   Cisco Systems
   225 West Tasman Drive
   San Jose, CA  95134
   USA

   Email: akr@cisco.com


   Michael Barnes
   Cisco Systems
   225 West Tasman Drive
   San Jose, CA  95134
   USA

   Email: mjbarnes@cisco.com


   Rahul Aggarwal
   Juniper Networks
   1194 N. Mathilda Ave.
   Sunnyvale, CA  94089
   USA

   Email: rahul@juniper.net






Lindem (Editor), et al.   Expires April 3, 2008                [Page 14]

Internet-Draft                  OSPFv3 AF                   October 2007


Full Copyright Statement

   Copyright (C) The IETF Trust (2007).

   This document is subject to the rights, licenses and restrictions
   contained in BCP 78, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.


Acknowledgment

   Funding for the RFC Editor function is provided by the IETF
   Administrative Support Activity (IASA).





Lindem (Editor), et al.   Expires April 3, 2008                [Page 15]

