<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>LISP Mapping Versioning</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="LISP Mapping Versioning">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">L. Iannone</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">TU Berlin - Deutsche Telekom</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">Laboratories AG</td></tr>
<tr><td class="header">Expires: September 9, 2010</td><td class="header">D. Saucez</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">O. Bonaventure</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Universite catholique de Louvain</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 08, 2010</td></tr>
</table></td></tr></table>
<h1><br />LISP Mapping Versioning<br />draft-iannone-lisp-mapping-versioning-01.txt</h1>

<h3>Abstract</h3>

<p>The present document sketches an optional approach to provide 
    in-packet information about EID-to-RLOC mappings used to
    encapsulate LISP data packets. 
    The proposed approach is based on associating a version number to
    EID-to-RLOC mappings and transport such a version number in the
    LISP specific header of LISP-encapsulated packets.
    This versioning approach is particularly useful to inform
    communicating xTRs about modification of the mappings used to
    encapsulate packets. 
    Modification of mappings could mean adding/removing an RLOC, or
    just a modification in the reachability, priority, or weight of
    one or more RLOCs. Each time a mapping is modified, a new version
    number is generated and propagated in the LISP data packet.   
    The use of version numbers allows to avoid repeated Map-Request
    upon mappings change, limits the interaction between Control and
    Data planes, improves security, offer support for caching on
    Map-Servers, and could be used also in mobile scenarios. 
    
</p>
<p>The proposed mechanism is optional and does not need any
    modification on the base LISP encapsulation. Rather, it uses one
    of the reserved bits of the LISP specific header and overloads the
    Locator Status Bits. Similarly, no modification are necessary in
    the base LISP Map-Reply records. LISP versioning uses part of the
    reserved bits. In both cases, LISP encapsulation and Map-Reply
    records, bits used for LISP versioning can be safely ignored by
    xTRs that do not support the mechanism.
    Further, mappings can be distributed as usual through both
    existing and future mapping distribution system (e.g., ALT). 
    The infrastructure build by each specific mapping distribution
    system does not change anyhow. Even more, existing mapping
    distribution protocol are able to rely LISP control plane
    packets containing version numbers and do not need modifications. 
    All of these features make LISP versioning a completely transparent 
    optional mechanism with respect to the LISP base specification.
    
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 9, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Requirements notation<br />
<a href="#anchor2">2.</a>&nbsp;
Introduction<br />
<a href="#anchor3">3.</a>&nbsp;
EID-to-RLOC Mapping Version Number<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
Mapping Version Numbers wrap-around<br />
<a href="#dealing">4.</a>&nbsp;
Dealing with Version Numbers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dmvn">4.1.</a>&nbsp;
Handling Destination Mapping Version Number<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#smvn">4.2.</a>&nbsp;
Handling Source Mapping Version Number<br />
<a href="#lisphdr">5.</a>&nbsp;
LISP header and Mapping Version Numbers<br />
<a href="#vnumpkt">6.</a>&nbsp;
Map Record and Mapping Version Number<br />
<a href="#anchor5">7.</a>&nbsp;
Benefits and case studies for Mapping Versioning<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">7.1.</a>&nbsp;
Mapping Versioning to simplify LISP
		  implementation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">7.2.</a>&nbsp;
Synchronization of different xTRs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">7.3.</a>&nbsp;
Map Versioning and unidirectional traffic<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">7.4.</a>&nbsp;
Mapping Versioning and interworking<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">7.5.</a>&nbsp;
Mapping Versioning vs. Checksum<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">7.6.</a>&nbsp;
Mapping Versioning and mobility<br />
<a href="#truelisp">8.</a>&nbsp;
Incremental deployment and implementation status<br />
<a href="#anchor12">9.</a>&nbsp;
Mapping Versioning and path-liveness<br />
<a href="#security">10.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">10.1.</a>&nbsp;
Mapping Versioning against traffic disruption<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dos">10.2.</a>&nbsp;
Mapping Versioning against reachability
		    information DoS<br />
<a href="#anchor14">11.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">12.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">12.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">12.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Requirements notation</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
      "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
      and "OPTIONAL" in this document are to be interpreted as
      described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction</h3>

<p>The present document introduces the use of version
      numbers in order to provide information on a change in the
      EID-to-RLOC mappings used in the LISP 
      (<a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; January&nbsp;2010.</span><span>)</span></a> ) context to perform
      encapsulation.  
      The mechanism is optional and totally transparent to xTRs not
      supporting such a functionality.
      The basic mechanism is to associate version numbers to each
      mapping and transport such a version number in the LISP specific
      header. 
      When a mapping changes, a new version number is assigned to
      the updated mapping. 
      A change in an EID-to-RLOC mapping can be a change in the RLOCs
      set, by adding or removing one or more RLOCs, but it can also be
      a change in the priority or weight of one or more RLOCs.
      The change can even consist in the reachability of one or more 
      RLOCs. Reachability information is intended from the
      local-domain perspective, and can be obtained for instance
      monitoring IGP's routing tables. This should not be confused
      with the intra-domain "Locator Path Liveness problem" described
      in <a class='info' href='#I-D.meyer-loc-id-implications'>[I&#8209;D.meyer&#8209;loc&#8209;id&#8209;implications]<span> (</span><span class='info'>Meyer, D. and D. Lewis, &ldquo;Architectural Implications of Locator/ID Separation,&rdquo; January&nbsp;2009.</span><span>)</span></a>.
    
</p>
<p>
     With this approach, LISP-encapsulated data packets contain 
     the version number of the mappings used to select
     the RLOCs in the outer header (both source and destination). 
     These version numbers are contained in the second 32-bits of the
     LISP header and indicated a specific bit in the reserved flags
     (first 8 bits of the LISP header. Details about the header are
     described in <a class='info' href='#lisphdr'>Section&nbsp;5<span> (</span><span class='info'>LISP header and Mapping Version Numbers</span><span>)</span></a>. Note that it is not all
     packets need to carry version numbers.  
   
</p>
<p>
     When an ITR encapsulates a packet, it puts in the LISP-specific
     header two version numbers:  
      </p>
<ol class="text">
<li> The version number assigned to the mapping (contained in
	the EID-to-RLOC Database) used to select the source RLOC.
	
</li>
<li> The version number assigned to the mapping (contained in
	the EID-to-RLOC Cache) used to select the destination RLOC.   
	
</li>
</ol><p>
      This operation is two-fold. On the one hand it enables the ETR
      receiving the packet to know if the ITR that sent it is using
      the latest mapping for the destination EID. If it is not the
      case the ETR can send to the ITR a Map-Request containing the
      updated mapping or invoking a Map-Request from the ITR
      (both cases are already defined in 
      <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; January&nbsp;2010.</span><span>)</span></a>). 
      In this way the ITR can update its cache. 
      On the other hand, it enables the ETR receiving the packet to
      know if it has in its cache the latest mapping for the source
      EID. Is it is not the case a Map-Request can be send.
   
</p>
<p>
     With Mapping Versioning there is no need to re-design the mapping
     distribution infrastructure, which is always done 
     through the mapping distribution protocol (e.g., CONS,
     TREE, ALT <a class='info' href='#I-D.ietf-lisp-alt'>[I&#8209;D.ietf&#8209;lisp&#8209;alt]<span> (</span><span class='info'>Fuller, V., Farinacci, D., Meyer, D., and D. Lewis, &ldquo;LISP Alternative Topology (LISP+ALT),&rdquo; January&nbsp;2010.</span><span>)</span></a>).
     The mappings are distributed as usual through the
     Map-Request/Map-Reply message exchange. Map-Request and Map-Reply
     messages can carry mapping version in bits that are reserved (in
     the current version of the LISP specifications). Details on how
     to carry mapping version numbers in those messages are given in
     section <a class='info' href='#vnumpkt'>Section&nbsp;6<span> (</span><span class='info'>Map Record and Mapping Version Number</span><span>)</span></a>.
   
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
EID-to-RLOC Mapping Version Number</h3>

<p> The EID-to-RLOC Mapping Version Number consist in  an unsigned
      16-bit integer. 
      The version number is assigned in a per-mapping fashion, meaning
      that different mappings will have assigned a different version
      number, which is also updated independently. An update in the
      version number (i.e., a newer version) consist in incrementing
      by one the older version number. The initial version number of a
      new mapping can be randomly generated.   
    
</p>
<p>The space of version numbers has a circular order where half of
      the version numbers is greater than the current mapping version
      number and the other half is smaller than current mapping
      version number. 
      In a more formal way, assuming we have two version numbers V1
      and V2 and that the numbers are expressed on N bits,
      the following three cases may happen:
    
</p>
<p>
      </p>
<blockquote class="text"><dl>
<dt>V1 = V2 :</dt>
<dd> This is the exact match case.
	
</dd>
<dt>V1 < V2 :</dt>
<dd>
	  True if and only if V1 < V2 < (V1 + 2**(N-1)).
        
</dd>
<dt>V1 > V2 :</dt>
<dd>
	  True if and only if V1 > V2 > (V1 - 2**(N-1)).
	
</dd>
</dl></blockquote><p>
    
</p>
<p> Using 16 bits, as proposed in this document, and if the
    Mapping Version Number is 0,  versions in  [1; (2**15)-1] are
    greater and versions in [2**15; (2**16)-1] are  smaller. 
    
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Mapping Version Numbers wrap-around</h3>

<p> 
      The proposed 16 bits size for the Mapping Version Number based
      on the assumption that Map-Requests are rate limited with a
      granularity of seconds. Using a granularity of seconds and
      assuming as worst case that a new version is issued each second,
      it takes around 18 hours before the versions wraps 
      around, which is a reasonable time.
      Alternatively a granularity of minutes can also be used, as
      for the TTL of the Map-Reply (<a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; January&nbsp;2010.</span><span>)</span></a>). 
      Using a granularity of minutes leads to very long time before
      wrap-around.   
      Hereafter there is a table with a rough estimation of the time
      before wrap-around happens considering different sizes of the 
      Mapping Version Number and different time granularity. 
    
</p><br /><hr class="insert" />
<a name="wraparound"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+---------------+--------------------------------------------+
|Version Number |           Time before wrap around          |
|  Size (bits)  +--------------------------------------------+
|               |Granularity: Minutes | Granularity: Seconds |
+------------------------------------------------------------+
|          32   |   8171 Years        |  136 Years           |
|          30   |   2042 Years        |   34 Years           |
|          24   |     31 Years        |  194 Days            |
|          16   |     45 Days         |   18 Hours           |
|          15   |     22 Days         |    9 Hours           |
|          14   |     11 Days         |    4 Hours           |
+---------------+---------------------+----------------------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Estimation of time before wrap-around&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="dealing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Dealing with Version Numbers</h3>

<p> 
      The main idea of using Mapping Version Numbers is that whenever
      there is a change in the mapping (e.g., adding/removing 
      RLOCs, a change in the weights due to new TE policies, or
      a change in the priorities) or an ISP realizes that one or more
      of its own RLOCs are not reachable anymore from a local
      perspective (e.g., through IGP, or policy changes) the ISP
      updates the mapping with a new mapping version number. 
    
</p>
<p>
      In order to announce in a data-driven fashion that the mapping
      has been updated, mapping version numbers used to create the
      outer IP header of the LISP encapsulated packet are embedded in
      the LISP specific header. 
      This means that the header needs to contain two mapping version
      numbers:
      </p>
<ul class="text">
<li>
	  A first one from the EID-to-RLOC mapping in the EID-to-RLOC 
	  Database used to select the source RLOC, and called Source
	  Mapping Version Number.
	
</li>
<li>
	  A second one from the EID-to-RLOC mapping in the EID-to-RLOC
	  Cache used to select the destination RLOC, and called
	  Destination Mapping Version Number.
	
</li>
</ul><p>
      By embedding both Source Mapping Version Number and Destination
      Mapping Version Number an ETR can perform the following checks:
      </p>
<ol class="text">
<li>
	  The ITR has an up-to-date mapping in its cache for the
	  destination EID and is performing encapsulation correctly.
	
</li>
<li> The mapping in the local ETR cache for the source EID 
	is up-to-date.
	
</li>
</ol><p>
      If one or both of the above conditions do not hold, the ETR can
      send a Map-Request either to make the ITR aware that a new
      mapping is available (see <a class='info' href='#dmvn'>Section&nbsp;4.1<span> (</span><span class='info'>Handling Destination Mapping Version Number</span><span>)</span></a>) or to
      updated local mapping in the cache (see section <a class='info' href='#smvn'>Section&nbsp;4.2<span> (</span><span class='info'>Handling Source Mapping Version Number</span><span>)</span></a>). 
    
</p>
<a name="dmvn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Handling Destination Mapping Version Number</h3>

<p>
	When an ETR receives a packet, the Destination Mapping
	Version Number relates to the mapping for the destination EID
	for which the ETR is a RLOC. This mapping is part of the ETR
	LISP Database. Since the ETR is authoritative for the mapping, 
	it has the correct and up-to-date Destination Mapping Version
	Number.
	A check on this version number is done, where the following
	cases can arise: 
	
	</p>
<ul class="text">
<li> 
	    The packets arrive with the same Destination Mapping
	    Version Number stored in the EID-to-RLOC Database. This
	    is the regular case. 
	    The ITR sending the packet has in its EID-to-RLOC Cache an
	    up-to-date mapping. No further actions are needed. 
	  
</li>
<li> 
	    The packet arrives with a Destination Mapping Version
	    Number greater (i.e., newer) than the one stored in the
	    EID-to-RLOC Database. 
	    Since the ETR is authoritative on the mapping, this means
	    that someone is not behaving correctly w.r.t. the
	    specifications, thus the packets carries a not valid
	    version number and can be silently dropped.  
	  
</li>
<li> 
	    The packets arrive with an Destination Mapping Version
	    Number smaller (i.e., older) than the one stored in the
	    EID-to-RLOC Database. 
	    This means that the ITR sending the packet has an old
	    mapping in its EID-to-RLOC Cache containing stale
	    information. 
	    Further actions are needed. The ITR sending the packet
	    must be informed that a newer mapping is available. 
	    This is done with a "Map-Request" message sent back to the
	    ITR. The Map-Request will piggy-back the newer mapping.
	    This is not a new mechanism, how to piggy-back mappings in
	    Map-Request messages is already described in 
	    <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; January&nbsp;2010.</span><span>)</span></a>.   
	    These Map-Request message should be rate limited (rate
	    limitation policies are also described in 
	    <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; January&nbsp;2010.</span><span>)</span></a>).
	    The gain introduced by Mapping Version Numbers is that
	    after a certain number of retries, if the Destination
	    Mapping Version Number in the packets is not updated,
	    packet can be silently dropped because either the ITR is
	    refusing to use the mapping for which the ETR is
	    authoritative or it might be some form of attack.
	    Note that the rule can be even more restrictive. If the mapping
	    has been the same for a period of time as long as the TTL
	    (defined in LISP  <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; January&nbsp;2010.</span><span>)</span></a>)  of the
	    previous version of the mapping, all packets arriving with
	    an old mapping version can be silently dropped right away
	    without issuing any Map-Request. 
	    Indeed, if the new mapping with the updated version number
	    has been stable for at least the same time as the TTL of
	    the older mapping, all the entries in the caches of ITRs
	    must have expired. If packets with old mapping version
	    number are still received, the reason is that either
	    someone has not respected the TTL, or it is a spoof. In
	    both cases this is not valid behavior w.r.t. the
	    specifications and the packet can be silently dropped.   
	  
</li>
</ul><p>

      
</p>
<a name="smvn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Handling Source Mapping Version Number</h3>

<p>
	When an ETR receives a packet, the Source Mapping Version
	Number relates to the mapping for the source EID for which
	the ITR is authoritative. If the ETR has an entry in its LISP
	Cache a check is performed and the following cases can arise: 
	
	</p>
<ul class="text">
<li> 
	    The packet arrives with the same Source Mapping Version
	    Number stored in the LISP Cache. This is the correct
	    regular case. The ETR has in its cache an up-to-date copy
	    of the mapping. No further actions are needed.
	  
</li>
<li> 
	    The packet arrives with a Source Mapping Version Number
	    greater (i.e., newer) than the one stored in the local 
	    LISP Cache. This means that ETR has in its cache a
	    mapping that is stale and needs to be updated.
	    The packet is considered valid but further actions are
	    needed. In particular a Map-Request must be sent to
	    get the new mapping for the source EID.
	    This is a normal Map-Request message and must respect the
	    specifications in <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; January&nbsp;2010.</span><span>)</span></a>.
	  
</li>
<li> 
	    The packet arrives with a Source Mapping Version Number
	    smaller (i.e., older) than the one stored in the local 
	    LISP Cache. Such a case is not valid w.r.t. the
	    specifications. Indeed, if the mapping is already present in
	    the LISP Cache, this means that an explicit Map-Request has been
	    send and a Map-Reply has been received from an
	    authoritative source. Assuming that the mapping system is not
	    corrupted anyhow, the mapping version in the LISP Cache is
	    the correct one, hence the packet is not valid and can be
	    silently dropped. 
	  
</li>
</ul><p>

      
</p>
<a name="lisphdr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
LISP header and Mapping Version Numbers</h3>

<p> In order for the versioning approach to work, the LISP
    specific header has to carry both Source Mapping Version Number
    and Destination Mapping Version Number. This can be done by using
    one bit (indicated by V) of the reserved flags to state that the
    second 32 bits of the LISP header have to be interpreted as two
    version numbers of 16 bits each. The Source Version Number is
    carried in the 16 most significant bits of the second 32-bits of
    the LISP header. The Destination Version Number is carried in the
    16 most significant bits of the second 32-bits of the LISP header.  
    
</p>
<p> Hereafter is the example of LISP header carrying version
    numbers in the case of IPv4-in-IPv4 encapsulation. The same
    setting can be used for any other case (IPv4-in-IPv6,
    IPv6-in-IPv4, IPv6-in-IPv6).
    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /|Version|  IHL  |Type of Service|          Total Length         |
  / +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 /  |         Identification        |Flags|      Fragment Offset    |
/   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
OH  |  Time to Live | Protocol = 17 |         Header Checksum       |
\   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 \  |                    Source Routing Locator                     |
  \ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   \|                 Destination Routing Locator                   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  / |       Source Port = xxxx      |       Dest Port = 4341        |
UDP +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  \ |           UDP Length          |        UDP Checksum           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  / |N|L|E|V| rflags|                  Nonce                        |
LISP+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  \ | Source Mapping V.N.           | Destination Mapping V.N.      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /|Version|  IHL  |Type of Service|          Total Length         |
  / +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 /  |         Identification        |Flags|      Fragment Offset    |
/   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
IH  |  Time to Live |    Protocol   |         Header Checksum       |
\   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 \  |                           Source EID                          |
  \ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   \|                         Destination EID                       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>
      </p>
<blockquote class="text"><dl>
<dt>V:</dt>
<dd>
	  this is the Versioning bit. When this bit is set to 1 the
	  second 32-bits of the LISP header contain version numbers.
	
</dd>
<dt>Source Mapping Version Number (16 bits):</dt>
<dd>
	  Version of the mapping used by the ITR to select the RLOC
	  present in the "Source Routing Locator" field. Note that the
	  mapping used for such a selection is determined by the
	  Source EID through asearch in the LISP Database of the ITR. 
	
</dd>
<dt>Destination Mapping Version Number (16 bits):</dt>
<dd>
	  Version of the mapping used by the ITR to select the RLOC
	  present in the "Destination Routing Locator" field. Note
	  that the mapping used for such a selection is determined by
	  the Destination EID, used as lookup key in the LISP
	  Cache of the ITR. 
	
</dd>
</dl></blockquote><p>
    
</p>
<p> Not all of the LISP encapsulated packets need to carry version
    numbers. When mapping version number are carried the V bit must be
    set to 1.
    The V bit is conflict with the L bit, since both relate to the
    second 32 bits of the LISP header. The possible combinations (and
    related meaning) for L and V bits are the following:
    
</p>
<p>
      </p>
<blockquote class="text"><dl>
<dt>L=0, V=0:</dt>
<dd> 
	  This is a valid combination. In this case neither
	  Locator-Status-Bits nor Version Number are used. The second
	  32 bits of the LISP header can be ignored.
	
</dd>
<dt>L:0 V:1</dt>
<dd> 
	  This is a valid combination. In this case the second 32
	  bits of the LISP header contain version numbers and should
	  be treated according to the present document.
	
</dd>
<dt>L:1 V:1</dt>
<dd>
	  This is no a valid combination since two different bits
	  indicate different content for the same 32 bits. For
	  compatibility with the LISP specifications 
	  (<a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; January&nbsp;2010.</span><span>)</span></a>) each time the the L bit is
	  set to 1 the V bit must be ignored and the second 32 bits of
	  the LISP header interpreted as Locator-Status-Bits.
	  This approach ensures transparent and coherent
	  interoperability between xTRs using Versioning and xTRs that
	  do not use it. 
	
</dd>
<dt>L:1 V:0</dt>
<dd>
	  This is a valid combination. In this case the second 32 bits
	  of the LISP header contain Locator-Status-Bit. Note that
	  according with the previous combination, since the L bit is
	  set to 1 the V bit can be safely ignored. 
	
</dd>
</dl></blockquote><p>
    
</p>
<a name="vnumpkt"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Map Record and Mapping Version Number</h3>

<p> 
      To accommodate the proposed mechanism, the Map records that are
      transported on Map-Request/Map-Reply messages need to carry the
      Mapping Version Number as well.
      For this purpose it is possible to use part of the reserved bits
      of the record. The original definition of Record is in 
      <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; January&nbsp;2010.</span><span>)</span></a>.
    
</p>
<p>
      </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   |                          Record  TTL                          |
|   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
R   | Locator Count | EID mask-len  | ACT |A|V|  Reserved           |
e   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
c   | Mapping Version Number        |            EID- AFI           |
o   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
r   |                          EID-prefix                           |
d   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  /|    Priority   |    Weight     |  M Priority   |   M Weight    |
| / +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Loc|      Unused Flags           |R|           Loc-AFI             |
| \ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  \|                             Locator                           |
+-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>


      </p>
<blockquote class="text"><dl>
<dt>Mapping Version Number:</dt>
<dd>
	  Version Number of the mapping in the Record.
	
</dd>
</dl></blockquote><p>
    
</p>
<p>
      This is a simple change to carry the version number assigned to
      the mapping in this message and works perfectly with xTR that do
      not support mapping versioning, since they can simply ignore
      those bits. Furthermore, existing and futre mapping distribution
      protocol (e.g., ALT <a class='info' href='#I-D.ietf-lisp-alt'>[I&#8209;D.ietf&#8209;lisp&#8209;alt]<span> (</span><span class='info'>Fuller, V., Farinacci, D., Meyer, D., and D. Lewis, &ldquo;LISP Alternative Topology (LISP+ALT),&rdquo; January&nbsp;2010.</span><span>)</span></a>) are able
      to carry version numbers without needing any modification.
      The same applies to the LISP Map Server 
      (<a class='info' href='#I-D.ietf-lisp-ms'>[I&#8209;D.ietf&#8209;lisp&#8209;ms]<span> (</span><span class='info'>Fuller, V. and D. Farinacci, &ldquo;LISP Map Server,&rdquo; October&nbsp;2009.</span><span>)</span></a>) which will still work without
      any change since reserved bits are simply ignored.
    
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Benefits and case studies for Mapping Versioning</h3>

<p>In the following sections we provide more discussion on various
  aspects of the mapping versioning. Security observations are instead
  grouped in <a class='info' href='#security'>Section&nbsp;10<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>. 
  
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Mapping Versioning to simplify LISP
		  implementation</h3>

<p> 
      The use of mapping versioning can help in simplifying the
      implementation of LISP. In the current LISP specifications the
      set of RLOCs must always be maintained ordered and consistent
      with the content of the Loc Status Bits (see section 6.5 of 
      <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; January&nbsp;2010.</span><span>)</span></a>). When using mapping
      versioning such type of mechanisms are not necessary anymore
      since there is no direct relation between the order of the
      locators and the bits of the mapping version number.
    
</p>
<p>
      When a new RLOC is added to a mapping, it is not necessary to
      "append" new locators to the existing ones as explained in Section
      6.5 of the LISP draft. 
      A new mapping with a new version number will be issued, and
      since the old locators are still valid the transition will be
      disruptionless. 
      The same applies for the case a RLOC is withdrawn. 
      There is no need to maintain holes in the list of
      locators, as is the case when using Loc Status Bits, for sites
      that are not using the RLOC that has been withdrawn, the
      transition will be disruptionless. 
    
</p>
<p>
      It is even possible to perform a graceful shutdown. 
      This is obtained by simply issuing a mapping where the specific
      RLOC to be shut down is withdrawn or announced as unreachable (R
      bit in the Map Record), but without actually turning it
      off.  
      Once no more traffic is received by the RLOC, because all sites 
      have updated the mapping, it can be shut down safely. 
    
</p>
<p> All of these operations, as already stated, do not need to
      maintain any consistency among Loc Status Bits, and the way RLOC
      are stored in the cache. This eases implementation.    
    
</p>
<p> Finally, with the versioning approach there is
      no need to perform a "clock sweep" as described in
      Section 6.5.1 of the LISP draft. Every LISP site communicating
      to a specific LISP site that has updated the mapping will be
      informed of the available new mapping in a data-driven manner. 
    
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Synchronization of different xTRs</h3>

<p>
      Mapping Versioning does not require additional synchronization
      mechanism compared to the normal functioning of LISP without
      mapping versioning. Clearly all the ETRs have to reply with the
      same versioning number, otherwise there can be an inconsistency
      that creates additional control traffic.
    
</p>
<p>
      As an example, let's consider the topology of figure 
      <a class='info' href='#vtraffic'>Figure&nbsp;2</a> where ITR A.1 of domain A is sending
      unidirectional traffic to the xTR B of domain B, while xTR A.2 of
      domain A and xTR B of domain B exchange bidirectional traffic. 
    
</p>
<p>
      <br /><hr class="insert" />
<a name="vtraffic"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 +-+-+-+-+-+-+-+-+-+              +-+-+-+-+-+-+-+-+-+
 | Domain A        |              | Domain B        |
 |       +-+-+-+-+-+              |                 |
 |       | xTR A.1 |---           |                 |
 |       +-+-+-+-+-+    \         +-+-+-+-+-+       |
 |                 |     --------&gt;| xTR B   |       |
 |                 |     --------&gt;|         |       |
 |       +-+-+-+-+-+    /         +-+-+-+-+-+       |
 |       | xTR A.2 |&lt;--           |                 |
 |       +-+-+-+-+-+              |                 |
 |                 |              |                 |
 +-+-+-+-+-+-+-+-+-+              +-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

    
</p>
<p> 
      Obviously in the case of Mapping Versioning both xTRs of domain
      A must use the same value otherwise the xTR of domain B will
      start to sen Map-Requests.
    
</p>
<p>
      The same problem can, however, arise without mapping versioning. 
      For instance if the two xTRs of domain A send different Loc
      Status Bits. In this case either the traffic is disrupted, if
      the xTR B trusts the Loc Status Bits, or it xTR B will start
      sending Map-Requests to confirm the each change in the
      reachability.
    
</p>
<p> 
      So far, LISP does not provide any specific synchronization
      mechanism, but assumes that synchronization is provided by
      configuring the different xTRs consistently.
      The same applies for mapping versioning. If in the future any
      synchronization mechanism is provided, mapping versioning will
      take advantage of it automatically if the record format described
      in <a class='info' href='#vnumpkt'>Section&nbsp;6<span> (</span><span class='info'>Map Record and Mapping Version Number</span><span>)</span></a> is used.
    
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Map Versioning and unidirectional traffic</h3>

<p> 
      When using mapping versioning as specified in this document the
      LIS specific header carries two mapping version numbers, 
      for both source and destination mapping. 
      This can raise the question on what will happen in the case of
      unidirectional flows, like for instance in the case presented in 
      <a class='info' href='#utraffic'>Figure&nbsp;3</a>, since LISP specification do
      not mandate for ETR to have a mapping for the source EID. 
     

      <br /><hr class="insert" />
<a name="utraffic"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 +-+-+-+-+-+-+-+-+-+            +-+-+-+-+-+-+-+-+-+
 | Domain A        |            | Domain B        |
 |       +-+-+-+-+-+            +-+-+-+-+-+       |
 |       | ITR A   |-----------&gt;| ETR B   |       |
 |       +-+-+-+-+-+            +-+-+-+-+-+       |
 |                 |            |                 |
 +-+-+-+-+-+-+-+-+-+            +-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

    
</p>
<p>
      For what concerns the ITR, it is able to put both source and
      destination version number in the LISP header since the source
      mapping version number is in ITR's database, while the
      destination mapping version number is in ITR's cache.
    
</p>
<p> 
      For what concerns the ETR, it simply checks only the destination
      version number in the same way as described in 
      <a class='info' href='#dealing'>Section&nbsp;4<span> (</span><span class='info'>Dealing with Version Numbers</span><span>)</span></a>, ignoring the source mapping version
      number. 
    
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
Mapping Versioning and interworking</h3>

<p>
      Mapping versioning works also in the context of interworking
      between LISP and IPv4 and IPv6
      (<a class='info' href='#I-D.ietf-lisp-interworking'>[I&#8209;D.ietf&#8209;lisp&#8209;interworking]<span> (</span><span class='info'>Lewis, D., Meyer, D., Farinacci, D., and V. Fuller, &ldquo;Interworking LISP with IPv4 and IPv6,&rdquo; May&nbsp;2009.</span><span>)</span></a>).
      The case of PTR encapsulating packet for LISP sites is basically
      the same as the unidirectional traffic case presented in the
      previous section. The same rules can be applied.
    
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5"></a><h3>7.5.&nbsp;
Mapping Versioning vs. Checksum</h3>

<p>
      Noel Chiappa has several times proposed on the LISP WG mailing
      list to use a form of "checksum" as a mapping version number.
      This is an interesting idea. Nevertheless, from our
      understanding, this implies that the notion of ordering between
      different mappings for the same EID-Prefix (e.g., whether a
      mapping is more recent) get lost. This means that a large part
      of the filtering that can be done on not valid version numbers
      (see <a class='info' href='#dealing'>Section&nbsp;4<span> (</span><span class='info'>Dealing with Version Numbers</span><span>)</span></a>) cannot be done anymore, hence
      loosing an important feature of mapping versioning. 
      Certainly, if it would be possible to find a "checksum" function
      that embeds some form of ordering, this can be discussed and
      integrated in future version of this document.
    
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.6"></a><h3>7.6.&nbsp;
Mapping Versioning and mobility</h3>

<p>
      Mapping versioning can help in managing mobility in the
      LISP context (<a class='info' href='#I-D.meyer-lisp-mn'>[I&#8209;D.meyer&#8209;lisp&#8209;mn]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Lewis, D., and D. Meyer, &ldquo;LISP Mobile Node,&rdquo; February&nbsp;2010.</span><span>)</span></a>).
      We are working in deploying Mapping Versioning on a Wireless Mesh
      Network.  
      Results concerning this deployment will be provided in future
      versions of this document. 
    
</p>
<a name="truelisp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Incremental deployment and implementation status</h3>

<p>
      The solution proposed in this draft includes the use of bits
      that are marked as reserved in the main LISP specifications.
      This means that any LISP element that does not support Mapping
      Versioning will safely ignore them.
      Further, there is no need of any specific mechanism to discover
      if an xTR supports or not Mapping Versioning. This information
      is already included in the Map Record.
    
</p>
<p> 
      Mapping Versioning can be incrementally deployed without any
      negative impact on existing LISP xTRs.
      Mapping Versioning is currently implemented in OpenLISP
      <a class='info' href='#I-D.iannone-openlisp-implementation'>[I&#8209;D.iannone&#8209;openlisp&#8209;implementation]<span> (</span><span class='info'>Iannone, L., Saucez, D., and O. Bonaventure, &ldquo;OpenLISP Implementation Report,&rdquo; July&nbsp;2008.</span><span>)</span></a>.
    
</p>
<p>Note that the reference document for LISP implementation
    and interoperability tests remains <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; January&nbsp;2010.</span><span>)</span></a>.
    
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Mapping Versioning and path-liveness</h3>

<p> When the reachability problem occurs on the path
      between two RLOCs of different LISP sites (this is called
      path-liveness problem in the recent draft by D. Meyer and
      D. Lewis <a class='info' href='#I-D.meyer-loc-id-implications'>[I&#8209;D.meyer&#8209;loc&#8209;id&#8209;implications]<span> (</span><span class='info'>Meyer, D. and D. Lewis, &ldquo;Architectural Implications of Locator/ID Separation,&rdquo; January&nbsp;2009.</span><span>)</span></a>),
      the versioning approach does not help.  
      In this case other mechanisms are necessary, however,
      such an issue is not new and is part of all loc/ID split
      solutions, thus versioning does not introduce a new issue. 
    
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security Considerations</h3>

<p>
      Mapping Versioning does not introduces any new security issue
      concerning both the data-plane and the control-plane. 
      On the contrary, as described in the following, if Mapping
      Versioning is used also to update mappings in case of change in
      the reachability information (i.e., instead of the Loc Status
      Bits) it is possible to reduce the effects of some DoS or
      spoofing attacks that can happen in an untrusted environment.
    
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1"></a><h3>10.1.&nbsp;
Mapping Versioning against traffic disruption</h3>

<p>
	An attacker can try to disrupt ongoing communications by
	creating LISP encapsulated packets with wrong Loc Status
	Bits. If the xTR blindly trusts the Loc Status Bits it will
	change the encapsulation accordingly, which can result in
	traffic disruption. 
      
</p>
<p> 
	This does not happen in the case of Mapping Versioning. As
	described in <a class='info' href='#dealing'>Section&nbsp;4<span> (</span><span class='info'>Dealing with Version Numbers</span><span>)</span></a>, upon a version
	number change the xTR first issues a Map-Request. The
	assumption is that the mapping distribution system is
	sufficiently secure that Map-Request and Map-Reply messages
	and their content can be trusted. 
	Security issues concerning specific mapping distribution system
	are out of the scope of this document. 
	Note also that in the case of Mapping Versioning the attacker
	should "guess" a valid version number that triggers a
	Map-Request, as described in <a class='info' href='#dealing'>Section&nbsp;4<span> (</span><span class='info'>Dealing with Version Numbers</span><span>)</span></a>,
	otherwise the packet is simply dropped.
      
</p>
<p>
	Note that a similar level of security can be obtained with Loc
	Status Bits, by simply making mandatory to verify any change
	through a Map-Request. However, in this case Loc Status Bits
	loose their meaning, because, it does not matter anymore which
	specific bits has changed, the xTR will query the mapping system
	and trust the content of the received Map-Reply. Furthermore
	there is no way to perform filtering as in the mapping
	versioning in order to drop packets that do not carry a valid
	mapping version number.
	In the case of Loc Status Bits, any random change can trigger
	a Map-Request (unless rate limitation is enabled which raise
	another type of attack discussed in <a class='info' href='#dos'>Section&nbsp;10.2<span> (</span><span class='info'>Mapping Versioning against reachability 		    information DoS</span><span>)</span></a>). 
      
</p>
<a name="dos"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2"></a><h3>10.2.&nbsp;
Mapping Versioning against reachability
		    information DoS</h3>

<p>
	Attackers can try to trigger a large amount of Map-Request by
	simply by forging packets with random mapping version or
	random Loc Status Bits. 
	In both cases the Map-Requests are rate limited as described
	in <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; January&nbsp;2010.</span><span>)</span></a>. 
	However, differently from Loc Status Bit where there is no
	filtering possible,  in the case of mapping versioning is
	possible to filter not valid version numbers before triggering
	a Map-Request, thus helping in reducing the effects of DoS
	attacks.
	In other words the use of mapping versioning enables a fine
	control on when to update a mapping or when to notify that a
	mapping has been updated.       
      
</p>
<p> It is clear, that mapping versioning does not protect against
	DoS  and DDoS attacks, where an xTR looses processing power doing
	checks on the LISP header of packets sent by attackers. This is
	independent from mapping versioning and is the same for Loc
	Status Bits.
      
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Acknowledgements</h3>

<p> The authors would like to thank Pierre Francois, Noel Chiappa, Dino
    Farinacci for their comments and review.
    
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.iannone-openlisp-implementation">[I-D.iannone-openlisp-implementation]</a></td>
<td class="author-text">Iannone, L., Saucez, D., and O. Bonaventure, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-iannone-openlisp-implementation-01.txt">OpenLISP Implementation Report</a>,&rdquo; draft-iannone-openlisp-implementation-01 (work in progress), July&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-iannone-openlisp-implementation-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-lisp">[I-D.ietf-lisp]</a></td>
<td class="author-text">Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-06.txt">Locator/ID Separation Protocol (LISP)</a>,&rdquo; draft-ietf-lisp-06 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-lisp-alt">[I-D.ietf-lisp-alt]</a></td>
<td class="author-text">Fuller, V., Farinacci, D., Meyer, D., and D. Lewis, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-alt-02.txt">LISP Alternative Topology (LISP+ALT)</a>,&rdquo; draft-ietf-lisp-alt-02 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-alt-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-lisp-interworking">[I-D.ietf-lisp-interworking]</a></td>
<td class="author-text">Lewis, D., Meyer, D., Farinacci, D., and V. Fuller, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-interworking-00.txt">Interworking LISP with IPv4 and IPv6</a>,&rdquo; draft-ietf-lisp-interworking-00 (work in progress), May&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-interworking-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-lisp-ms">[I-D.ietf-lisp-ms]</a></td>
<td class="author-text">Fuller, V. and D. Farinacci, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-ms-04.txt">LISP Map Server</a>,&rdquo; draft-ietf-lisp-ms-04 (work in progress), October&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-ms-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.meyer-lisp-mn">[I-D.meyer-lisp-mn]</a></td>
<td class="author-text">Farinacci, D., Fuller, V., Lewis, D., and D. Meyer, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-meyer-lisp-mn-01.txt">LISP Mobile Node</a>,&rdquo; draft-meyer-lisp-mn-01 (work in progress), February&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-meyer-lisp-mn-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.meyer-loc-id-implications">[I-D.meyer-loc-id-implications]</a></td>
<td class="author-text">Meyer, D. and D. Lewis, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-meyer-loc-id-implications-01.txt">Architectural Implications of Locator/ID Separation</a>,&rdquo; draft-meyer-loc-id-implications-01 (work in progress), January&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-meyer-loc-id-implications-01.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Luigi Iannone</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">TU Berlin - Deutsche Telekom Laboratories AG</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ernst-Reuter Platz 7</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Berlin</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:luigi@net.t-labs.tu-berlin.de">luigi@net.t-labs.tu-berlin.de</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Damien Saucez</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Universite catholique de Louvain</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Place St. Barbe 2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Louvain la Neuve</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Belgium</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:damien.saucez@uclouvain.be">damien.saucez@uclouvain.be</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Olivier Bonaventure</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Universite catholique de Louvain</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Place St. Barbe 2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Louvain la Neuve</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Belgium</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:olivier.bonaventure@uclouvain.be">olivier.bonaventure@uclouvain.be</a></td></tr>
</table>
</body></html>
