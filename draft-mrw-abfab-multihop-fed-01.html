<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Multihop Federations for Application Bridging for Federation Beyond the Web (ABFAB)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Motivation">
<link href="#rfc.section.4" rel="Chapter" title="4 Multihop Federation Example">
<link href="#rfc.section.5" rel="Chapter" title="5 Trust Router Protocol">
<link href="#rfc.section.6" rel="Chapter" title="6 Trust Path Query">
<link href="#rfc.section.7" rel="Chapter" title="7 Temporary Identity Request">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Threat Model">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Security Requirements">
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 Data Origin validation and signatures">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document describes a mechanism for establishing trust across a multihop federation within the Application Bridging for Federation Beyond the Web (ABFAB) framework.  " />
  <meta name="description" content="This document describes a mechanism for establishing trust across a multihop federation within the Application Bridging for Federation Beyond the Web (ABFAB) framework.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">M. Wasserman</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Painless Security</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">H. Tschofenig</td>
</tr>
<tr>
<td class="left">Expires: January 13, 2012</td>
<td class="right">Nokia Siemens Networks</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">S. Hartman</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Painless Security</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">July 12, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Multihop Federations for Application Bridging for Federation Beyond the Web (ABFAB)<br />
  <span class="filename">draft-mrw-abfab-multihop-fed-01.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes a mechanism for establishing trust across a multihop federation within the Application Bridging for Federation Beyond the Web (ABFAB) framework.  </p>
<p>This document introduces a new entity, the Trust Router.  Trust Routers exchange information about the availability of Trust Paths across a multihop federation.  They can be queried by a Relying Party to obtain the best Trust Path to reach an Identity Provider.  They also provide temporary identities that can be used by a Relying Party to traverse a Trust Path.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 13, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Motivation</a>
</li>
<li>4.   <a href="#rfc.section.4">Multihop Federation Example</a>
</li>
<li>5.   <a href="#rfc.section.5">Trust Router Protocol</a>
</li>
<li>6.   <a href="#rfc.section.6">Trust Path Query</a>
</li>
<li>7.   <a href="#rfc.section.7">Temporary Identity Request</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">Threat Model</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">Security Requirements</a>
</li>
<li>8.3.   <a href="#rfc.section.8.3">Data Origin validation and signatures</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">Acknowledgements</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">This document describes a mechanism for establishing trust across a multihop federation within the Application Bridging for Federation Beyond the Web (ABFAB) framework <a href="#I-D.lear-abfab-arch">[I-D.lear-abfab-arch]</a>.  </p>
<p id="rfc.section.1.p.2">This document introduces a new ABFAB entity, the Trust Router.  Trust Routers exchange information about the availability of Trust Paths across a multihop federation.  ABFAB entity, the Trust Router. These paths are used by RPs to contruct transitive trust chains across a federation to a Radius or Diameter server within a target IdP.  </p>
<p id="rfc.section.1.p.3">A Trust Path consists of one or more Trust Links.  A Trust Link is an assertion that a specific Trust Router is capable of providing temporary identies that can be used to access another entity in the ABFAB system.  At this point, we anticipate that there will be two types of Trust Links in ABFAB: a Trust Link that indicates that one Trust Router can be used to reach another Trust Router, and a Trust Link that indicates that a Trust Router can be used to reach a Radius or Diameter Server.  The first type (Trust Router Links) are shown as A-&gt;B(T), which indicates that the Trust Router in realm A can create identities to reach the trust router in Realm B.  The second type (Radius/Diameter Links) are shown as A-&gt;B(R), to indicate that a trust router in Realm A can be used to reach a Radius, RadSec or Diameter server in Realm B.  </p>
<p id="rfc.section.1.p.4">Trust Routers exchange information about available Trust Links within a federation, and each Trust Router maintains a tree of available paths to reach all of the IdPs within the federation that can be reached from the local realm of the Trust Router.  </p>
<p id="rfc.section.1.p.5">When an RP receives a request from a party within a realm that not known directly to the RP, the RP will query its local Trust Router to obtain the best Trust Path to reach that IdP. Note that we use the term 'best' here to highlight that there may well be multiple paths to reach an IdP from a given RP, and the selection of the 'best' path may involve several factors in addition to the length of the path, such as security and privacy practices, or monetary costs.  </p>
<p id="rfc.section.1.p.6">The RP will travers the Trust Path obtained from it's local Trust Router.  At each step, the RP will request a temporary identity to access the next step in the Trust Path, contructing a transitive chain of trust to a Radius or Diameter server within the target IdP.  </p>
<p id="rfc.section.1.p.7">To summarize, the Trust Router performs three functions: </p>

<ul>
<li>Trust Routers peer with other Trust Routers to exchange information about available Trust Links, and Trust Paths.  This information is exchanged between Trust Routers using the Trust Router Protocol.  The Trust Router Protocol is described in more detail in <a href="#TrustRouter">Section 5</a>.  </li>
<li>Trust Routers respond to queries from Relying Parties to make information about Trust Paths available. This exchange is referred to as a Trust Path Query Protocol, which is described in <a href="#TrustPathQuery">Section 6</a>.  </li>
<li>To follow the Trust Path across a federation, the RP will use KNP to ask each Trust Router along the path to provision a temporary identity that can be used to gain access to the next step in the path.  This mechanism is called a Temporary Identity Request, which is described in <a href="#IdentityRequest">Section 7</a>.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 <a href="#RFC2119">[RFC2119]</a>.  </p>
<p id="rfc.section.2.p.2">This document introduces the following terms: </p>

<dl>
<dt>Trust Router:</dt>
<dd style="margin-left: 8">
<br><br> This is a logical ABFAB entity that exchanges information about Trust Paths that Relying Parties can use to create transtitive chains of trust across multihop ABFAB federations.  </dd>
<dt>Trust Link:</dt>
<dd style="margin-left: 8">
<br><br> A Trust Link is an assertion that a given Trust Router is capable of providing a temporary identity to communicate with another ABFAB entity (either another Trust Router, or a Radius/Diameter server within an IdP).  </dd>
<dt>Trust Path:</dt>
<dd style="margin-left: 8">
<br><br> A Trust Path is a concatenation of Trust Links that can be used by an RP to contruct a transitive trust chain across a federation to a target IdP.  </dd>
<dt>Trust Router Protocol:</dt>
<dd style="margin-left: 8">
<br><br> The Trust Router Protocol is the mechanism used by two Trust Routers to exchange information about Trust Links and Trust Paths.  </dd>
</dl>

<p> </p>
<p id="rfc.section.2.p.3">The terms Identity Provider (IdP), Relying Party (RP), Subject, and Federation are used as defined in <a href="#I-D.lear-abfab-arch">[I-D.lear-abfab-arch]</a>.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Motivation</h1>
<p><a href="#one-to-many">Figure 1</a> shows an example federation where the Relying Party Foo, has established relationships with various Identity Providers.  </p>
<div id="#rfc.figure.1"></div>
<div id="#one-to-many"></div>
<pre> 
 
 +---------------+
 | Identity      |   
 | Provider      | `..
 | Example-A.org |    `-._
 +---------------+        `..
                             `-._
 +---------------+               `._   +-----------+
 | Identity      |                  `- | Relying   |
 | Provider      | ------------------  | Party Foo |
 | Example-B.org |                 _.- +-----------+
 +---------------+             _,-'
                            ,,'
 +---------------+      _.-'           o
 | Identity      |  _,-'              \|/
 | Provider      | '                   |
 | Example-C.org |                    / \
 +---------------+                  Subject
 
	  </pre>
<p></p>
<p id="rfc.section.3.p.3">When an RP receives a request to access a protected resource (or requires authentication and authorization for other purposes) the request includes a realm name that indicates the IdP the Subject has selected for this exchange. Offering the Subject the ability to choose among many different IdPs is necessary because a Subject may have, and want to maintain, uncorrelated identities in several different realms within a single federation (i.e. work, school, social networking, etc.).  However, this also places a burden on the RPs to establish and maintain business agreements and exchange security credentials with a potentially large number of Identity Providers.  </p>
<p id="rfc.section.3.p.4">In order for a single-hop federation to function, each IdP needs to maintain business agreements and exchange credentials with every RP that its Subjects are authorized to access.  <a href="#mesh">Figure 2</a>, shows the likely outcome, which is that a single-hop federation will come to resemble a dense mesh topology.  </p>
<div id="#rfc.figure.2"></div>
<div id="#mesh"></div>
<pre> 
 
  +---------------+
  | Identity      |   
  | Provider      |-.._
  | Example-A.org |`.  ``-.._
  +---------------+  `-.     ``-..__    +-----------+
                        `.          `--.| Relying   |
  +---------------+       `.      __..--| Party Foo |
  | Identity      |       __:.--''   .-'+-----------+
  | Provider      |_..--''     `. .-'
  | Example-B.org |          .-'.
  +---------------+         .'   '.     +-----------+
                         .-'       -.   | Relying   |
  +---------------+   .-'            `-.| Party Bar |
  | Identity      |.-'     ____....---''+-----------+
  | Provider      |.----'''
  | Example-C.org |
  +---------------+            o
                              \|/
                               |
                              / \
                            Subject
 
	  </pre>
<p></p>
<p id="rfc.section.3.p.6">As discussed in section 2.1.1 of <a href="#I-D.lear-abfab-arch">[I-D.lear-abfab-arch]</a>, as the number of organizations involved in a ABFAB federation increase, static configuration may not scale sufficiently.  Also, using a Trust Broker to establish keys between entities near the RP and entities near the IDP with improve the security and privacy of an ABFAB federation.  <a href="#trust-broker">Figure 3</a> shows the structure of a federation where each IdP and RP has a single connection to the Trust Router infrastructure.  </p>
<div id="#rfc.figure.3"></div>
<div id="#trust-broker"></div>
<pre> 
 
  +---------------+ 
  | Identity      | 
  | Provider      |\
  | Example-A.org | `.
  +---------------+   \                             +-----------+
                       \                         .-'| Relying   |
  +---------------+     `. +---------------+   .'   | Party Foo |
  | Identity      |       \|    Trust      |.-'     +-----------+
  | Provider      |........|    Broker     |
  | Example-B.org |       /|               |`-.
  +---------------+     .' +---------------+   `.   +-----------+
                       /                         `-.| Relying   |
  +---------------+   /                             | Party Bar |
  | Identity      | .'                              +-----------+
  | Provider      |/                O
  | Example-C.org |                \|/
  +---------------+                 |
                                   / \
                                 Subject
 
	  </pre>
<p></p>
<p id="rfc.section.3.p.8">To improve the operational scalability and security of large ABFAB federations, this document proposes a Trust Broker solution consisting of of a set of Trust Routers, as described in this document, and the Key Negotiation Protocol (KNP), as described in <a href="#I-D.howlett-radsec-knp">[I-D.howlett-radsec-knp]</a>.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Multihop Federation Example</h1>
<p id="rfc.section.4.p.1">The diagram below shows an example of a successful exchange in a multihop federation using the Trust Router Protocol and KNP: </p>
<div id="#rfc.figure.4"></div>
<pre> 
                  
     Realm D     |    Realm C     |     Realm B    |    Realm A

                 |                |                |
   +----------+     +----------+     +----------+     +----------+
   |  Trust   |  |  |  Trust   |  |  |  Trust   |  |  |  Trust   |
   | Router D |&lt;-1-&gt;| Router C |&lt;-1-&gt;| Router B |&lt;-1-&gt;| Router A |
   +----------+  |  +----------+  |  +----------+  |  +----------+
        ^                ^                ^                   ^
        |        |       |        |       |        |          |
        |                |                +---4------------ + |
        |        |       |        |                |        | |
        |                +----------------5---------------+ | 3
        |        |                |                |      | | |
        +----------------6------------------------------+ | | |
                 |                |                |    | | | |
                                                        v v v v
   +----------+  |                |                |  +----------+
   | Identity |&lt;---------7---------------------------&gt;| Relying  |
   | Provider |  |                |                |  |  Party   |
   +----------+                                       +----------+
        ^        |                |                |       ^
        1                                                  |
        |        |                |                |       |
        v                                                  |
   +----------+  |                |                |       |
   | Subject  |----------2---------------------------------+
   |          |  |                |                |
   +----------+  
                 |                |                |
 
</pre>
<p></p>
<p id="rfc.section.4.p.3">A multihop federation exchange matching the above diagram can be summarized as follows: </p>

<ol>
<li>We start with a single federation including four realms, each containing a single Trust Router.  The Trust Routers are peered, such that their interconnections form a multihop federation.  </li>
<li>A Subject (with an identity in Realm D) attempts to access a service provided by a Relying Party in Realm A.  </li>
<li>The Relying Party does not have direct access to a Radius or Diameter server in Realm D that it can use to authenticate the Subject, so it asks its local Trust Router for a Trust Path to reach Realm D.  The Trust Router in Realm A returns the path A-&gt;B(T)-&gt;C(T)-&gt;D(T)-&gt;D(R), which indicates that the Relying Party should use the Trust Routers in Realms B, C and D to reach a RADIUS or RADSEC server in Realm D, which could then be used to authenticate the Subject.  </li>
<li>The Relying Party contacts a Trust Router in Realm B (using its permanent identity in Realm A), and requests the creation of a temporary identity that can be used to communicate with the Trust Router in Realm C.  </li>
<li>The Relying Party then contacts the Trust Router in Realm C (using the temporary identity returned in the previous step), and asks for a temporary identity that can be used to communicate with the Trust Router in realm D.  </li>
<li>The Relying Party then contacts the Trust Router in Realm D (using the temporary identity returned in the previous step), and asks the Trust Router to provision an identity that it can use to speak to the Radius or Diameter server in Realm D (which is part of Realm D's Identity Provider).  </li>
<li>At this point, the Relying Party can reach the Subject's Identity provider, and the rest of the ABFAB exchange can continue, as described in <a href="#I-D.lear-abfab-arch">[I-D.lear-abfab-arch]</a>.  </li>
</ol>

<p> </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#TrustRouter" id="TrustRouter">Trust Router Protocol</a>
</h1>
<p id="rfc.section.5.p.1">Trust Routers use the Trust Router Protocol to exchange information about available Trust Links, and Trust Paths across a federation.  </p>
<p id="rfc.section.5.p.2">The Trust Router Protocol differs from an Internet Routing Protocol in a couple of important ways: </p>

<ul>
<li>Trust Links are unidirectional.  It can not be assumed that the fact that a Trust Router in Realm A is authorized to create temporary identities to access a Trust Router in realm B, that the opposite is also true (A -&gt; B(T) does not imply B-&gt;A(T)).  </li>
<li>Realm names are not necessarily hierarchical.  Although aggregation might be possible as a later optimization, the ability to aggregate realm names based on shared roots is not currently assumed.  </li>
</ul>

<p> </p>
<p id="rfc.section.5.p.3">In addition to the existence of the links themselves, Trust Links have a set of associated attributes that can be used for filtering and tree computation, including: </p>

<ul>
<li>The cost of the link.  </li>
<li>Any security and privacy characteristics associated with the link.  </li>
<li>Information indicating how/if the link should be propagated across the federation.  </li>
</ul>

<p> </p>
<p id="rfc.section.5.p.4">Current thinking is that we will use a BGP-based algorithm for computation of the local tree at each Trust Router, and that we will communicate a similar set of information between Trust Routers as would be communicated between Internet Routers running BGP.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#TrustPathQuery" id="TrustPathQuery">Trust Path Query</a>
</h1>
<p id="rfc.section.6.p.1">A Trust Path Query is generated by a RP to request a Trust Path to reach a specific realm within a given Policy Regime.  If possible, the Trust Router will reply with a Trust Path that consists of zero or more Trust Router steps and ends with a Radius or Diameter server within the IdP for the indicated realm.  </p>
<p id="rfc.section.6.p.2">The Trust Path Query is initiated by the RP, and the initial query message will contain the destination realm and Policy Regime.  </p>
<p id="rfc.section.6.p.3">When a Trust Path Query is received by a Trust Router, the router will first authenticate the RP, and check local policy information to determine whether or not to reply.  </p>
<p id="rfc.section.6.p.4">Assuming that the RP is successfully authenticated and the request passes local policy checks, the Trust Router will search it's tree of Trust Path information to determine whether a Trust Path exists that will reach the destination Realm within the indicated Policy Regime.  If so, the shortest/best Trust Path will be returned to the Relying Party.  </p>
<p id="rfc.section.6.p.5">A Trust Path will consist of a list of steps, each of which will contain: The type of the step (Trust Router or Radius/Diameter), the Policy Regime associated with each step, information needed to reach the indicated Trust Router or server (domain name or IP address), and any special attributes associated with that step.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#IdentityRequest" id="IdentityRequest">Temporary Identity Request</a>
</h1>
<p id="rfc.section.7.p.1">A Temporary Identity Request is issued by a Relying Party in order to obtain an identity that can be used to traverse each step in the Trust Path.  When a Temporary Identity is requested, a Trust Router will provision a new identity in its local Radius or Diameter infrastructure that can be used by the Relying Party to communicate with the Trust Router or Radus/Diameter server that represents the next step in the Trust Path.  Current thinking is that KNP will be used as the protocol mechanism for these requests.  </p>
<p id="rfc.section.7.p.2">These Temporary Identities will have a finite lifetime and, when authenticated, will include a Radius Attribute/Diameter AVP indicating that they were generated based on a Temporary Identity Request.  This attribute will inlcude the chain of identities that preceeded the current identity in the traversal of the Trust Path.  </p>
<p id="rfc.section.7.p.3">The details of how these messages will be encoded has not yet been determined.  However, it is expected that, for each Trust Router step in the Trust Path, the following actions will take place: </p>

<ol>
<li>The Relying Party will send a Temporary Identity Request message to the Trust Router, containing the identity of the next step in the Trust Path, the destination realm that it is trying to reach, and the Policy Regime in use.  This request will be sent using the identity that the Trust Router obtained from the previous step in the Trust Path (or the Trust Router's permanent identity in it's home realm, if this is the first step).  </li>
<li>The Trust Router will authenticate the Relying Party.  </li>
<li>If the authentication is successful, the Trust Router will check local policy to determine whether it should provision an identity for the Relying Party for the indicated purpose (details of this check may be implementation dependent).  </li>
<li>If the request passes any policy requirements, the Trust Router will provision a temporary identity for the Relying Party within the Trust Router's local realm that can be used to access the next-hop Trust Router or RADIUS/RADSEC server in the Trust Path.  </li>
</ol>

<p> </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Security Considerations</h1>
<p id="rfc.section.8.p.1">As discussed in <a href="#I-D.lear-abfab-arch">[I-D.lear-abfab-arch]</a>, the trust broker architecture is a mechanism for establishing technical trust in an ABFAB federation. Technical trust mechanisms have three primary responsibilities in ABFAB. They are responsible for integrity protection of AAA traffic. They are responsible for constraining the naming of ABFAB entities: for example the technical trust mechanism assures that the entity claiming to be the IDP is authenticated and authorized to act as the IDP for the realm containing the subject. The technical trust mechanism also determines where AAA messages are routed.  </p>
<p id="rfc.section.8.p.2">The trust broker architecture described in this document is designed to meet the security and operational requirements of federations and groups of federations with  large numbers of organizations. In these environments depending on any common credentials or trust mechanism does not make sense. While federations are expected to interconnect, they are not expected to have a common set of trust anchors for a public-key infrastructure. Each realm needs to be able to choose the appropriate credentials and security policies to use when establishing a relationship with another realm.</p>
<p id="rfc.section.8.p.3">by design, this approach provides flexibility. Parts of the interconnected set of realms can use high-assurance processes and mechanisms including strong authentication mechanisms and rigorous credentialing and enrollment processes. Other realms can use lower-assurance mechanisms and processes, balancing cost and speed against security. However this flexibility complicates the security policy. Just because the local realm has a high-assurance trust link does not mean that the path is high-assurance. Operational mechanisms are required in order for RPs to express their security requirements and for the trust routers to make sure that resulting trust paths meet these requirements. Similarly, trust routers need to make sure that paths to a given IDP are not announced unless that IDP's security requirements will be met.</p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> Threat Model</h1>
<p id="rfc.section.8.1.p.1">Like all Internet protocols, the trust router protocols and KNP need to have strong protection against parties who are not authorized to be part of an exchange. Such attackers do not start out knowing credentials necessary to participate in the system. However these attackers can be assumed to observe trust router, KNP, AAA and ABFAB exchanges. The system needs to maintain integrity of all data, confidentiality of keys and in some cases confidentiality of other data even when these attackers can insert, suppress, modify or replay packets. Reasonable defenses against attacks on the availability of the system are required, although  obviously there are limits to these defenses. An attacker who can disrupt connectivity with a realm can impact availability.</p>
<p id="rfc.section.8.1.p.2">The interesting threat model surrounds malicious participants authorized to participate in the system. The threat model is similar to that of routing protocols <a href="#I-D.ietf-karp-threats-reqs">[I-D.ietf-karp-threats-reqs]</a>. Defending against a compromised actor announcing a trust link that actor would be permitted to announce were it functioning correctly is out of scope. Similarly, defending against an compromised actor performing some action that actor is authorized to take is out of scope for this threat model.</p>
<p id="rfc.section.8.1.p.3">However, it is a requirement that the system needs to provide tools to limit the authorization of actors. For example if a particular session between two trust routers is not authorized to announce a trust link to a given realm or with certain properties, then attacks permitting such a link to be announced are in scope. Similarly an attack permitting a temporary identity with properties inconsistent with administrative limits would be in scope.</p>
<p id="rfc.section.8.1.p.4">The system must permit zones of more or less trust to be created. An attack that permits insiders in the zones of less trust to compromise a zone of higher trust beyond what the zone of lesser trust is permitted is within the scope of threats. However, trust can only decrease as distance across the transitive network of trust routers increases. A peer two hops away cannot be permitted to make any statement that a peer one hop away cannot make. In general, it is unknown whether the peer two hops away actually made the statement.</p>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> Security Requirements</h1>
<p id="rfc.section.8.2.p.1">TBD</p>
<h1 id="rfc.section.8.3">
<a href="#rfc.section.8.3">8.3.</a> Data Origin validation and signatures</h1>
<p id="rfc.section.8.3.p.1">TBD</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> IANA Considerations</h1>
<p id="rfc.section.9.p.1">There are no IANA actions required for this document at this time.  </p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Acknowledgements</h1>
<p id="rfc.section.10.p.1">This document was written using the xml2rfc tool described in RFC 2629 <a href="#RFC2629">[RFC2629]</a>.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.lear-abfab-arch">[I-D.lear-abfab-arch]</b></td>
<td class="top">
<a>Howlett, J</a>, <a>Hartman, S</a>, <a>Tschofenig, H</a> and <a>E Lear</a>, "<a href="http://tools.ietf.org/html/draft-lear-abfab-arch-02">Application Bridging for Federated Access Beyond Web (ABFAB) Architecture</a>", Internet-Draft draft-lear-abfab-arch-02, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.howlett-radsec-knp">[I-D.howlett-radsec-knp]</b></td>
<td class="top">
<a>Howlett, J</a> and <a>S Hartman</a>, "<a href="http://tools.ietf.org/html/draft-howlett-radsec-knp-02">Key Negotiation Protocol (KNP)</a>", Internet-Draft draft-howlett-radsec-knp-02, October 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2629">[RFC2629]</b></td>
<td class="top">
<a href="mailto:mrose@not.invisible.net" title="Invisible Worlds, Inc.">Rose, M.T.</a>, "<a href="http://tools.ietf.org/html/rfc2629">Writing I-Ds and RFCs using XML</a>", RFC 2629, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-karp-threats-reqs">[I-D.ietf-karp-threats-reqs]</b></td>
<td class="top">
<a>Lebovitz, G</a>, <a>Bhatia, M</a> and <a>R White</a>, "<a href="http://tools.ietf.org/html/draft-ietf-karp-threats-reqs-03">The Threat Analysis and Requirements for Cryptographic Authentication of Routing Protocols' Transports</a>", Internet-Draft draft-ietf-karp-threats-reqs-03, June 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Margaret Wasserman</span> 
	  <span class="n hidden">
		<span class="family-name">Wasserman</span>
	  </span>
	</span>
	<span class="org vcardline">Painless Security</span>
	<span class="adr">
	  <span>356 Abbott Street</span>

	  <span class="vcardline">
		<span class="locality">North Andover</span>,  
		<span class="region">MA</span> 
		<span class="code">01845</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 781 405 7464</span>

<span class="vcardline">EMail: <a href="mailto:mrw@painless-security.com">mrw@painless-security.com</a></span>

<span class="vcardline">URI: <a href="http://www.painless-security.com">http://www.painless-security.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Hannes Tschofenig</span> 
	  <span class="n hidden">
		<span class="family-name">Tschofenig</span>
	  </span>
	</span>
	<span class="org vcardline">Nokia Siemens Networks</span>
	<span class="adr">
	  <span>Linnoitustie 6</span>

	  <span class="vcardline">
		<span class="locality">Espoo</span>,  
		<span class="region"></span>
		<span class="code">02600</span>
	  </span>
	  <span class="country-name vcardline">Finland</span>
	</span>
	<span class="vcardline">Phone: +358 (50) 4871445</span>

<span class="vcardline">EMail: <a href="mailto:Hannes.Tschofenig@gmx.net">Hannes.Tschofenig@gmx.net</a></span>

<span class="vcardline">URI: <a href="http://www.tschofenig.priv.at">http://www.tschofenig.priv.at</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Sam Hartman</span> 
	  <span class="n hidden">
		<span class="family-name">Hartman</span>
	  </span>
	</span>
	<span class="org vcardline">Painless Security</span>
	<span class="adr">
	  <span>356 Abbott Street</span>

	  <span class="vcardline">
		<span class="locality">North Andover</span>,  
		<span class="region">MA</span> 
		<span class="code">01845</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:hartmans@painless-security.com">hartmans@painless-security.com</a></span>

<span class="vcardline">URI: <a href="http://www.painless-security.com">http://www.painless-security.com</a></span>

  </address>
</div>

</body>
</html>