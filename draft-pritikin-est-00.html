<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Enrollment over Secure Transport</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Language">
<link href="#rfc.section.2" rel="Chapter" title="2 Overview">
<link href="#rfc.section.3" rel="Chapter" title="3 URLs">
<link href="#rfc.section.4" rel="Chapter" title="4 Distribution of CA certificates">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Distribution of CA certificates response">
<link href="#rfc.section.5" rel="Chapter" title="5 Simple Enrollment of Clients">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Simple Re-Enrollment of Clients">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Simple Enroll and Re-Enroll Response">
<link href="#rfc.section.6" rel="Chapter" title="6 Full CMC ">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Full CMC Response">
<link href="#rfc.section.7" rel="Chapter" title="7 Authentication and Authorization">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 HTTPS Based Server Authentication">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Server Authorization">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 HTTPS Based Client Authentication">
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 HTTP Based Client Authentication">
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 Client Authorization">
<link href="#rfc.section.7.6" rel="Chapter" title="7.6 Peer Authentication">
<link href="#rfc.section.8" rel="Chapter" title="8 Contributors/Acknowledgements ">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Server Discovery">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B External TLS concentrator">
<link href="#rfc.appendix.Appendix%20C" rel="Chapter" title="Appendix C CGI Server implementation">
<link href="#rfc.appendix.Appendix%20D" rel="Chapter" title="Appendix D Updating SCEP implementations">
<link href="#rfc.appendix.Appendix%20E" rel="Chapter" title="Appendix E Key Update mechanisms">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document specifies certificate Enrollment over Secure Transport (EST). EST is a certificate enrollment over HTTPS protocol that is trivially accessible by modern clients. The CMC "Simple PKI Messages" and simple certificate responses are leveraged and EST is designed to be easily implemented by clients and servers running other common enrollment mechanisms such as SCEP. Renewal and rekey mechanisms are described consistent with CMP." />
  <meta name="description" content="This document specifies certificate Enrollment over Secure Transport (EST). EST is a certificate enrollment over HTTPS protocol that is trivially accessible by modern clients. The CMC "Simple PKI Messages" and simple certificate responses are leveraged and EST is designed to be easily implemented by clients and servers running other common enrollment mechanisms such as SCEP. Renewal and rekey mechanisms are described consistent with CMP." />
  <meta name="keywords" content="pki" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Internet Engineering Task Force</td>
<td class="right">M. Pritikin, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Cisco Systems, Inc.</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">March 08, 2011</td>
</tr>
<tr>
<td class="left">Expires: September 09, 2011</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Enrollment over Secure Transport<br />
  <span class="filename">draft-pritikin-est-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies certificate Enrollment over Secure Transport (EST). EST is a certificate enrollment over HTTPS protocol that is trivially accessible by modern clients. The CMC "Simple PKI Messages" and simple certificate responses are leveraged and EST is designed to be easily implemented by clients and servers running other common enrollment mechanisms such as SCEP. Renewal and rekey mechanisms are described consistent with CMP.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 09, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Requirements Language</a>
</li>
<li>2.   <a href="#rfc.section.2">Overview</a>
</li>
<li>3.   <a href="#rfc.section.3">URLs</a>
</li>
<li>4.   <a href="#rfc.section.4">Distribution of CA certificates</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Distribution of CA certificates response</a>
</li>
<li>5.   <a href="#rfc.section.5">Simple Enrollment of Clients</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Simple Re-Enrollment of Clients</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Simple Enroll and Re-Enroll Response</a>
</li>
<li>6.   <a href="#rfc.section.6">Full CMC </a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Full CMC Response</a>
</li>
<li>7.   <a href="#rfc.section.7">Authentication and Authorization</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">HTTPS Based Server Authentication</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">Server Authorization</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">HTTPS Based Client Authentication</a>
</li>
<li>7.4.   <a href="#rfc.section.7.4">HTTP Based Client Authentication</a>
</li>
<li>7.5.   <a href="#rfc.section.7.5">Client Authorization</a>
</li>
<li>7.6.   <a href="#rfc.section.7.6">Peer Authentication</a>
</li>
<li>8.   <a href="#rfc.section.8">Contributors/Acknowledgements </a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">Security Considerations</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Server Discovery</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">External TLS concentrator</a>
</li>
<li>Appendix C.   <a href="#rfc.appendix.Appendix%20C">CGI Server implementation</a>
</li>
<li>Appendix D.   <a href="#rfc.appendix.Appendix%20D">Updating SCEP implementations</a>
</li>
<li>Appendix E.   <a href="#rfc.appendix.Appendix%20E">Key Update mechanisms</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">This specification profiles the use of <a href="#RFC5272">Certificate Management over CMS</a> <cite title="NONE">[RFC5272]</cite> "simple PKI Request" and "simple PKI Response" messages over HTTPS. A functional certificate management protocol is thus described that is appropriate for simple PKI clients interested in maintaining client certificate(s) and associated infrastructure certificate(s). Suite B compatibility is addressed.</p>
<p id="rfc.section.1.p.2">A full implementation of all <a href="#RFC5272">CMC</a> <cite title="NONE">[RFC5272]</cite> features is not required to be compliant with this specification. This is consistent with the <a href="#RFC5272">CMC</a> <cite title="NONE">[RFC5272]</cite> protocol specification of "simple" messages for clients to use "in the event no other services are needed". When using these messages <a href="#RFC5272">CMC</a> <cite title="NONE">[RFC5272]</cite> section 3.1 notes that "the Simple PKI Request MUST NOT be used if a proof-of-identity needs to be included"; which precludes their use if inline authentication and/or authorization is required unless a secured transport is also specified. Many simple clients engaged in certificate enrollment operations will have a TLS client implementation available for secure transport, so HTTPS is specified herein. A Suite B compatible TLS specification exists.</p>
<p id="rfc.section.1.p.3">Advanced clients, or components of the PKI hierarchy itself, will possibly require a complete implementation of the <a href="#RFC5272">CMC</a> <cite title="NONE">[RFC5272]</cite> specification or additional specifications.  This document provides an appropriate transport for the full <a href="#RFC5272">CMC</a> <cite title="NONE">[RFC5272]</cite> specification that is compliant with <a href="#RFC5273">[RFC5273]</a>.</p>
<p id="rfc.section.1.p.4">Servers SHOULD implement the full <a href="#RFC5272">CMC</a> <cite title="NONE">[RFC5272]</cite> functionality. Clients MAY limit their implementation to the abbreviated functionalities described in this document.</p>
<p id="rfc.section.1.p.5">Additionally <a href="#RFC5272">CMC</a> <cite title="NONE">[RFC5272]</cite> indicates that: "No special services are provided for doing either renewal (new certificates with the same key) or re-keying (new certificates on new keys) of clients. Instead a renewal/re-key message looks the same as any enrollment message, with the identity proof being supplied by existing certificates from the CA." This profile clarifies the renewal and re-key behavior of both the client and server by specifying the exact functionality and by specific references to the compatible renew and re-key specifications mechanisms documented in <a href="#RFC4210">CMP</a> <cite title="NONE">[RFC4210]</cite>.</p>
<p id="rfc.section.1.p.6">[[EDNOTE: Comments such as this one, included within double brackets and initiated with an 'EDNOTE', are for editorial use and shall be removed as the document is polished.]]</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Requirements Language</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#overview" id="overview">Overview</a>
</h1>
<p id="rfc.section.2.p.1">This profile reduces certificate enrollment for clients to the following operations:</p>
<p></p>

<ul>
<li>Distribution of CA certificates</li>
<li>Authorized enrollment and re-enrollment of clients</li>
</ul>

<p>These functions are provided by methods at a specified HTTPS URL.</p>
<p id="rfc.section.2.p.3">Some messages formats are defined in <a href="#RFC5272">CMC</a> <cite title="NONE">[RFC5272]</cite> and include subsets of the <a href="#RFC2986">PKCS#10 Certification Request</a> <cite title="NONE">[RFC2986]</cite> and the <a href="#RFC2315">PKCS#7</a> <cite title="NONE">[RFC2315]</cite> message specifications. Additional simple message formats are defined. </p>
<p id="rfc.section.2.p.4">This document specifies a method for authorization of client enrollment requests using existing certificates either issued by the CA or issued by a distinct PKI hierarchy such as with an <a href="#IDevID">IEEE 802.1AR IDevID</a> <cite title="NONE">[IDevID]</cite> credential. Additionally this document specifies username/password authentication methods beyond those included in CMC. The necessary authentication and authorization mechanisms are provided by HTTP and TLS (HTTPS) mechanisms as indicated in this document.</p>
<p id="rfc.section.2.p.5">HTTP Content-Type headers are as specified in <a href="#RFC5273">CMC: Transport Protocols</a> <cite title="NONE">[RFC5273]</cite>, Table 1. This document introduces new content types for the simple format messages not specified by <a href="#RFC5272">CMC</a> <cite title="NONE">[RFC5272]</cite>.</p>
<p id="rfc.section.2.p.6">The HTTP server MAY provide non-EST services on other URLs. The server MAY handle full CMC messages over HTTP.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> URLs</h1>
<p id="rfc.section.3.p.1">EST uses the HTTP "GET" and "POST" messages to communicate with the CA. The following describes the syntax of these messages:</p>
<div id="#rfc.figure.1"></div>
<pre>"GET" BASEPATH OPERATIONPATH
"POST" BASEPATH OPERATIONPATH</pre>
<p id="rfc.section.3.p.2">where:</p>
<p></p>

<ul>
<li>BASEPATH is a common path for all EST operations</li>
<li>OPERATIONPATH specifies the specific operation.</li>
</ul>
<p id="rfc.section.3.p.4">When an URL is formed the BASEPATH and OPERATIONPATH are combined to form the <a href="#RFC2616">[RFC2616]</a> abs_path. The server and port and MUST be pre-configured or otherwise discovered by the client as described in <a href="#discovery">Appendix Appendix A</a>. Fully formed base URLs are:</p>
<p></p>

<ul>
<li>https://example.org/BASEPATH</li>
<li>https://example.org:8080/arbitrary/base/path</li>
</ul>
<p id="rfc.section.3.p.6">These can be conveniently distributed as they are a form end users are comfortable with. The following operation URLs for client to access are defined relative to the EST base URL:</p>
<p></p>

<ul>
<li>/CACerts - The server responds to an HTTPS GET with the CA certificates as defined in <a href="#CACerts">Distribution of CA certificates</a> <cite title="NONE">[CACerts]</cite>.</li>
<li>/simpleEnroll - The client sends a CMC Simple PKI Enrollment message as specified in <a href="#Enroll">Enrollment of Clients</a> <cite title="NONE">[Enroll]</cite>, the response is a CMC Simple PKI Response message as specified in <a href="#EnrollResponse">Enroll Response</a> <cite title="NONE">[EnrollResponse]</cite>.</li>
<li>/simpleReEnroll - Exactly the same as 'simpleEnroll' except that the request is explicitly for re-enrollment purposes.</li>
<li>/fullCMC - Provides for a CMC transport</li>
</ul>
<p id="rfc.section.3.p.8">Such that the following examples form valid complete URLs:</p>

<ul>
<li>https://example.org/BASEPATH/CACerts</li>
<li>https://example2.org/arbitrary/base/path/simpleEnroll</li>
<li>https://example2.org/arbitrary/base/path/simpleReEnroll</li>
<li>https://example3.org/example/ca/fullCMC</li>
</ul>

<p>The mechanisms by which the EST server interacts with an HTTPS server to handle GET and POST operations at these URLs is out of scope.  The use of distinct URLs ensures easy implementation for servers that do not perform client authentication when distributing "CACerts" responses.</p>
<p id="rfc.section.3.p.9">NOTE: A simple CGI application at each fully specified path, configured with appropriate permissions as per the HTTPS server configuration, is sufficient for a working example.</p>
<p id="rfc.section.3.p.10">[[EDNOTE: This does not use the mechanism specified in "Defining Well-Known Uniform Resource Identifiers (URIs)" [RFC5785]. That would be a possibility here for a base url of "https://example.org/.well-known/EST" but such would preclude the flexibility associated with multiple base urls being handled by the same server unless some form of "?designator=value" is included.]]</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#CACerts" id="CACerts">Distribution of CA certificates</a>
</h1>
<p id="rfc.section.4.p.1">At any time a client MAY request an up to date list of the CA certificates by sending an HTTPS GET message to the EST base URL with the relative path extension 'CACerts'.</p>
<p id="rfc.section.4.p.2">The server SHOULD NOT require client authentication or authorization to service this request.</p>
<p id="rfc.section.4.p.3">The client MUST authenticate the server as specified in <a href="#AuthCandAuthZ">Authentication and Authorization</a> <cite title="NONE">[AuthCandAuthZ]</cite>. If the authentication and authorization is successful the client accepts the CA certificates and stores them appropriately. If the authentication and authorization is not successful then when the response is received the client extracts the CA root certificate and MUST either engage the end-user or otherwise authorize the credential using out-of-band pre-configuration data such as a CA certificate "fingerprint" (eg. a SHA-1, SHA-256, SHA-512, or MD5 hash on the whole CA certificate).</p>
<p id="rfc.section.4.p.4">Although not recommended an unconfigured client MAY accept the CA root certificate automatically if this is appropriate for the solution.  A possible example is deployment of a client within an absolutely known to be secured network. The server MUST still perform appropriate authorization.</p>
<p id="rfc.section.4.p.5">Subsequent connections to the EST server validate the TLS server certificate using the stored CA root certificates as described in <a href="#AuthCandAuthZ">Authentication and Authorization</a> <cite title="NONE">[AuthCandAuthZ]</cite>.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Distribution of CA certificates response</h1>
<p id="rfc.section.4.1.p.1">The server MUST respond with a list of certificates containing the current CA certificates. This includes any Root CA Key Update certificates (<a href="#keyupdatemechanisms">Appendix Appendix E</a> provides an informative summary of key renewal).</p>
<p id="rfc.section.4.1.p.2">The response format is a text file containing a list of certificates each formatted as specified in <a href="#RFC4945">Section 6.1 of</a> <cite title="NONE">[RFC4945]</cite>. Each certificate is delimited by a newline. The content-type of "application/x-est-cacerts" MUST be specified.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#Enroll" id="Enroll">Simple Enrollment of Clients</a>
</h1>
<p id="rfc.section.5.p.1">At any time the client MAY request a certificate from the EST base URL with the relative path extension "simpleEnroll'.</p>
<p id="rfc.section.5.p.2">When HTTPS POSTing to the 'Enroll' location the client MUST include a CMC Simple PKI Enrollment request as specified in <a href="#RFC5272">CMC</a> <cite title="NONE">[RFC5272]</cite> Section 3.1 (a <a href="#RFC2986">PKCS#10 Certification Request</a> <cite title="NONE">[RFC2986]</cite>.). The content-type of "application/x-est-pkcs10" MUST be specified. The format of the request is as specified in <a href="#RFC4945">Section 6.4 of </a> <cite title="NONE">[RFC4945]</cite>.</p>
<p id="rfc.section.5.p.3">The signatureAlgorithm MAY be ecdsa-with-sha256 for P-256 certificate requests, or MAY be ecdsa-with-sha384 for P-384 certificate requests in addition to other algorithms.</p>
<p id="rfc.section.5.p.4">[[EDNOTE: This is in alignment with draft-turner-suitb-cmc-03 section 4.1]]</p>
<p id="rfc.section.5.p.5">The server MUST authenticate the client as specified in <a href="#AuthCandAuthZ">Authentication and Authorization</a> <cite title="NONE">[AuthCandAuthZ]</cite>. The server MAY apply any authorization or policy logic when determining if the certificate should be issued. The server MAY choose to issue a certificate modified from the initial request as specified in <a href="#RFC5272">CMC</a> <cite title="NONE">[RFC5272]</cite> Section 3.1.</p>
<p id="rfc.section.5.p.6">The client MUST authenticate the server as specified in <a href="#TLSserverAuthC">Section 7.1</a>.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Simple Re-Enrollment of Clients</h1>
<p id="rfc.section.5.1.p.1">At any time the client MAY request a re-enrollment certificate from the EST base URL with the relative path extension "simpleReEnroll'.</p>
<p id="rfc.section.5.1.p.2">The server MUST treat the enrollment as a re-enrollment request. As specified in <a href="#RFC5272">CMC</a> <cite title="NONE">[RFC5272]</cite> Section 2 "renewal and rekey requests look the same as any certification request, except that the identity proof is supplied by existing certificates from a trusted CA". The proof of client identity is supplied by client authentication during the HTTPS handshake. When attempting to re-enroll the client MUST use the existing certificate to be renewed.</p>
<p id="rfc.section.5.1.p.3">[[EDNOTE: draft-turner-suiteb-cmc defines a method of recognizing an re-enroll based on PKCS10 contents, see section 4.1. The method described herein is explicit.]]</p>
<p id="rfc.section.5.1.p.4">If the server forwards the request to back-end processes it SHOULD communicate that this is a re-enrollment attempt. For example if using this protocol to communicate with a CA the /simpleReEnroll URL is used.</p>
<p id="rfc.section.5.1.p.5">The server MAY revoke the existing certificate once a replacement has been issued.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#EnrollResponse" id="EnrollResponse">Simple Enroll and Re-Enroll Response</a>
</h1>
<p id="rfc.section.5.2.p.1">The server responds with the client's newly issued certificate or provides an error response for either 'simpleEnroll' or 'simpleReEnroll'.</p>
<p id="rfc.section.5.2.p.2">If the enrollment is successful the server response MUST have a response code of 200 with a content-type of "application/x-est-x509".  The response data is the certificate formatted as specified in <a href="#RFC4945">Section 6.1 of</a> <cite title="NONE">[RFC4945]</cite>.</p>
<p id="rfc.section.5.2.p.3">When rejecting a request the server MUST specify either an <a href="#RFC2616">HTTP</a> <cite title="NONE">[RFC2616]</cite> 4xx/401 error, or an HTTP 5xx error. A simple CMC response with content-type of "application/pkcs7-mime" MAY be included in the response data for any error response. If the content-type is not set the response data MUST be a plain text human readable error message. Client MAY skip parsing of CMC error responses in favor of a generic error message.</p>
<p id="rfc.section.5.2.p.4">If the server responds with an <a href="#RFC2616">HTTP</a> <cite title="NONE">[RFC2616]</cite> 501 this indicates that the attempted EST mechanisms is not implemented. The client SHOULD try using 'fullCMC'.</p>
<p id="rfc.section.5.2.p.5">If the server responds with an <a href="#RFC2616">HTTP</a> <cite title="NONE">[RFC2616]</cite> 202 this indicates that the request has been accepted for processing but that a response is not yet available. The server SHOULD include a Retry-After header similar to those seen in 503 responses. The client MUST wait at least the specified 'retry-after' time before re-attempting. If no time is specified then the client polls using an upper-bound-limited exponential back-off. The client repeats the initial enrollment request after the appropriate polling interval as expired. The client SHOULD log or inform the end user of this event.  The server is responsible for maintaining all state necessary to recognize and handle subsequent poll operations as the client is stateless in this regard (it simply sends the same request repeatedly until it receives a different response code).</p>
<p id="rfc.section.5.2.p.6">[[EDNOTE: An RFC reference for a back-off algorithm would be appropriate here. The initial time increment should reflect the timing of the TLS connection and message processing; selection of initial increment should reflect this.]]</p>
<p id="rfc.section.5.2.p.7">All other return codes are handled as specified in <a href="#RFC2616">HTTP</a> <cite title="NONE">[RFC2616]</cite>.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Full CMC </h1>
<p id="rfc.section.6.p.1">At any time the client MAY request a certificate from the EST base URL with the relative path extension "fullCMC".</p>
<p id="rfc.section.6.p.2">When HTTPS POSTing to the 'fullCMC' location the client MUST include a valid CMC message. The content-type MUST be set to "application/pkcs7-mime" as specified in <a href="#RFC5273">CMC: Transport Protocols</a> <cite title="NONE">[RFC5273]</cite>.</p>
<p id="rfc.section.6.p.3">The client MUST authenticate the server as specified in <a href="#TLSserverAuthC">Server Authentication</a> <cite title="NONE">[TLSserverAuthC]</cite> if an HTTPS url is used.</p>
<p id="rfc.section.6.p.4">The server SHOULD authenticate the client as specified in <a href="#AuthCandAuthZ">Authentication and Authorization</a> <cite title="NONE">[AuthCandAuthZ]</cite>. The server MAY apply any authorization or policy logic when determining if the certificate should be issued. The server MAY choose to issue a certificate modified from the initial request as specified in <a href="#RFC5272">CMC</a> <cite title="NONE">[RFC5272]</cite> Section 3.1. The CMS proof-of-identity mechanism MAY be used to bind the CMS message to the TLS protected session. If HTTP is used to post the request then the normal CMC proof-of-identity mechanisms are used without change.</p>
<p id="rfc.section.6.p.5">[[EDNOTE: text detailing which and how the TLS session key is used to do this will be specified here.]]</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> Full CMC Response</h1>
<p id="rfc.section.6.1.p.1">The server responds with the client's newly issued certificate or provides an error response.</p>
<p id="rfc.section.6.1.p.2">If the enrollment is successful the server response MUST have a response code of 200 with a content-type of "application/pkcs7-mime" as specified in <a href="#RFC5273">CMC: Transport Protocols</a> <cite title="NONE">[RFC5273]</cite>. The response data includes either the CMC Simple PKI Response or the CMC Full PKI Response.</p>
<p id="rfc.section.6.1.p.3">When rejecting a request the server MAY specify either an <a href="#RFC2616">HTTP</a> <cite title="NONE">[RFC2616]</cite> 4xx/401 error, an HTTP 5xx error or a response code 200. A CMC response with content-type of "application/pkcs7-mime" MUST be included in the response data for any error response. The client MUST parse the CMC response to determine the current status.</p>
<p id="rfc.section.6.1.p.4">If the server responds with an <a href="#RFC2616">HTTP</a> <cite title="NONE">[RFC2616]</cite> 501 this indicates that the attempted EST mechanisms is not implemented. The client SHOULD try using 'simpleEnroll'.</p>
<p id="rfc.section.6.1.p.5">All other return codes are handled as specified in <a href="#EnrollResponse">Section 5.2</a> or <a href="#RFC2616">HTTP</a> <cite title="NONE">[RFC2616]</cite>.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#AuthCandAuthZ" id="AuthCandAuthZ">Authentication and Authorization</a>
</h1>
<p><a href="#RFC5273">"CMC: Transport Protocols"</a> <cite title="NONE">[RFC5273]</cite> provides some guidance for running CMC over HTTP but only notes that "clients MAY attempt to send HTTP requests using TLS 1.0 [TLS] or later, although servers are not required to support TLS". No attempt is made to specify how the client and server might take advantage of a secured transport to better leverage the simple the PKI messages. This profile specifies the transport mechanisms and how values from the TLS exchange, the HTTP exchange, and the CMC Simple PKI messages are used for authentication and authorization purposes by the server. HTTPS MUST be used. TLS 'session resumption' SHOULD be supported.</p>
<p id="rfc.section.7.p.2">HTTPS is defined in <a href="#RFC2818">HTTP Over TLS</a> <cite title="NONE">[RFC2818]</cite> and is a definition of how HTTP messages may be sent over TLS. HTTPS (HTTP over TLS) is a commonly used transport and can be easily layered on top of extremely simple client or server code and in some environments even by using an external process. Specifying HTTPS as the secured transport for PKI enrollment messages introduces two potential 'layers' for communication of authorization data or for status/informative responses during the protocol exchange:</p>

<ul>
<li>TLS</li>
<li>HTTPS</li>
</ul>
<p id="rfc.section.7.p.3">This profile specifies when information is used from each layer.</p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#TLSserverAuthC" id="TLSserverAuthC">HTTPS Based Server Authentication</a>
</h1>
<p id="rfc.section.7.1.p.1">Clients MUST request server_auth and servers MUST support server_auth. The client MUST support TLS_RSA_WITH_AES_128_CBC_SHA, and MAY support other cipher-suites such as the suite-B cipher suites indicated in Suite B Profile for Transport Layer Security (TLS) [RFC5430].</p>
<p id="rfc.section.7.1.p.2">[[EDNOTE: To what extent should be specify mandatory cipher suites? TLS_SRP_SHA_RSA_WITH_AES_256_CBC_SHA or similar such as TLS_SRP_SHA_WITH_AES_128_CBC_SHA would also be interesting. It is worth calling this out? Note that the methods below are defined such that they work with this type of cipher suite.]]</p>
<p id="rfc.section.7.1.p.3">The client validates the HTTPS server certificate presented during the <a href="#RFC5246">TLS</a> <cite title="NONE">[RFC5246]</cite> defined Server Certificate message. There are multiple methods of validation depending on the current state of the client:</p>
<p></p>

<ol>
<li>If the client has a store of certificates for validating HTTPS connections the client MAY validate the HTTPS server certificate using the standard HTTP logic of checking the server's identity as presented in the server's Certificate message against the URL used (see <a href="#RFC2818">HTTPS Over TLS, Section 3.1 Server Identity</a> <cite title="NONE">[RFC2818]</cite>. This method makes it possible for clients with a large store of HTTPS certificates to securely obtain the CA server certificate by leveraging the HTTPS security model (see <a href="#TLSserverAuthZ">Section 7.2</a>).</li>
<li>If the client already has CA root certificate(s) associated with this EST server the client MAY validate the TLS server certificate using the previously known CA root certificate(s) (see <a href="#TLSserverAuthZ">Section 7.2</a> for authorization details).</li>
<li>If the client does not yet have CA root certificate(s) associated with this EST server then the client MAY provisionally accept the TLS connection but the inner data must be accepted manually as described in <a href="#CACerts">Section 4</a>. The TLS server certificates, including any root certificates, are discarded.</li>
<li>[[EDNOTE: The use of password based cipher suite such as SRP would be described here. If the client obtains successful authentication via SRP then the certificates received are accepted as valid.]]</li>
</ol>
<p id="rfc.section.7.1.p.5">If there are any errors the client MUST reject the CA certificate(s) and SHOULD log or inform the end user.</p>
<p id="rfc.section.7.1.p.6">The actual CA certificate MUST NOT be used to protect the TLS tunnel, thus a CA MUST generate separate certificates for server_auth.  These are the equivalent of <a href="#RFC5273">"CMC: Transport Protocols"</a> <cite title="NONE">[RFC5273]</cite> Local Registration Authority (LRA) certificates. The EST server MAY be implemented as a <a href="#RFC5273">"CMC: Transport Protocols"</a> <cite title="NONE">[RFC5273]</cite> described LRA, or an implementation specific communication channel MAY be used between the EST server and the CA.</p>
<p id="rfc.section.7.1.p.7">The client MUST support the Root CA Key Update verification mechanisms specified in <a href="#RFC4210">CMP</a> <cite title="NONE">[RFC4210]</cite> section 4.4 when validating TLS server certificates. <a href="#keyupdatemechanisms">Appendix Appendix E</a> provides an informative summary of key renewal.</p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> <a href="#TLSserverAuthZ" id="TLSserverAuthZ">Server Authorization</a>
</h1>
<p id="rfc.section.7.2.p.1">The server certificate MUST either be authorized according to <a href="#RFC2818">Section 3.1 Server Identity</a> <cite title="NONE">[RFC2818]</cite> or via the 'LRA Authorization' Certificate Policy extension OID.</p>
<p id="rfc.section.7.2.p.2">[[EDNOTE: The appropriate OID mechanism is not defined in CMC and will be defined in this document. This is the appropriate location to do so. The HTTP over TLS method will work ok in some use cases but requires an external cert to be issued and used with associated complexity on the client. The OID method is better for clients that will have the root cert distributed to them or where the CaCerts method is used and manually authorized and then an HTTPS connection is established.]]</p>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> <a href="#TLSclientAuthC" id="TLSclientAuthC">HTTPS Based Client Authentication</a>
</h1>
<p id="rfc.section.7.3.p.1">The server MUST send a <a href="#RFC5246">TLS</a> <cite title="NONE">[RFC5246]</cite> section 7.4.4 "Certificate Request" and the client MUST respond. The client MUST respond with a certificate that allows it to subsequently send the a <a href="#RFC5246">TLS</a> <cite title="NONE">[RFC5246]</cite> Section 7.4.8 "Certificate Verify" (i.e. the client MUST use "a client certificate that has signing capability"). The server MUST verify the Certificate Verify message. The server MUST support TLS_DHE_RSA_WITH_AES_128_CBC_SHA, and SHOULD support other cipher-suites such as the suite-B cipher suites indicated in Suite B Profile for Transport Layer Security (TLS) [RFC5430].</p>
<p id="rfc.section.7.3.p.2">The certificate presented by the client MAY be from the same PKI hierarchy as the Server Certificate, from a completely different PKI hierarchy such as an IEEE 802.1AR IDevID issued by the device manufacturer, or as a last resort the client MAY respond with a self-signed certificate. The certificate supplied during authentication is used during <a href="#ClientAuthorization">client authorization</a> <cite title="NONE">[ClientAuthorization]</cite>.</p>
<p id="rfc.section.7.3.p.3">The server MUST support the Root CA Key Update verification mechanisms specified in <a href="#RFC4210">CMP</a> <cite title="NONE">[RFC4210]</cite> section 4.4 when validating TLS client certificates. <a href="#keyupdatemechanisms">Appendix Appendix E</a> provides an informative summary on key renewal.</p>
<h1 id="rfc.section.7.4">
<a href="#rfc.section.7.4">7.4.</a> <a href="#HTTPuserAuthCandAuthZ" id="HTTPuserAuthCandAuthZ">HTTP Based Client Authentication</a>
</h1>
<p id="rfc.section.7.4.p.1">As specified in <a href="#RFC5273">CMC: Transport Protocols</a> <cite title="NONE">[RFC5273]</cite> the server "MUST NOT assume client support for any type of HTTP authentication such as cookies, Basic authentication, or Digest authentication". Clients intended for deployments where password authentication is advantageous MAY support this mechanism.  Servers SHOULD provide configurable support.</p>
<p id="rfc.section.7.4.p.2">Servers that support this mechanism reject requests using the <a href="#RFC2616">HTTP</a> <cite title="NONE">[RFC2616]</cite> defined WWW-Authenticate response-header (Section 14.47). At which point the client SHOULD repeat the request, including the appropriate <a href="#RFC2617">HTTP</a> <cite title="NONE">[RFC2617]</cite> Authorization Request Header (Section 3.2.2) as appropriate within the client security settings.</p>
<p id="rfc.section.7.4.p.3">Support for Basic authentication as specified in <a href="#RFC2617">HTTP</a> <cite title="NONE">[RFC2617]</cite> allows the server access to the cleartext password. This provides integration with legacy username password databases but involves distribution of the password. The client MUST NOT respond to this request unless TLS server certificate authentication was fully successful.</p>
<p id="rfc.section.7.4.p.4">[[EDNOTE: the TLS SRP methods MAY be supported and do provide a secure password method.]]</p>
<p id="rfc.section.7.4.p.5">Password based client authentication does not provide renewal/rekey functionality.</p>
<h1 id="rfc.section.7.5">
<a href="#rfc.section.7.5">7.5.</a> <a href="#ClientAuthorization" id="ClientAuthorization">Client Authorization</a>
</h1>
<p id="rfc.section.7.5.p.1">When the EST server receives a CMC Simple PKI Enrollment or re-enrollment message it MUST determine authorization before responding. The exact authorization checks are out-of-scope but can proceed as follows:</p>
<p></p>

<ul>
<li>Verify TLS client Certificate and Certificate Verify messages</li>
<li>Perform any appropriate policy lookups based on client certificate</li>
<li>(optionally) Request additional HTTP user authentication credentials,</li>
<li>(optionally) Perform additional policy lookups based on user authentication credentials.</li>
</ul>

<p>The server MAY use local policy to determine if the certificate should be issued. The server MAY use any information from TLS or HTTP client authentication to determine appropriate authorization and values for the certificate issued.</p>
<p id="rfc.section.7.5.p.3">If the client certificate is determined to be an RA certificate this can be used to determine appropriate behavior. An RA MUST only forward enrollment requests it has determined to be appropriately authorized. The server MAY still reject the request.</p>
<h1 id="rfc.section.7.6">
<a href="#rfc.section.7.6">7.6.</a> Peer Authentication</h1>
<p id="rfc.section.7.6.p.1">Authentication of protocol peers that have obtained credentials via EST but are communicating using other protocols is out of scope.</p>
<p id="rfc.section.7.6.p.2">The EST server can itself be an EST client. Authentication of credentials identifying an EST peer is in scope such that appropriate generic credential authentication in an environment supporting Root CA Key Update is defined. EST clients validating peer (other EST client) certificates MUST support the Root CA Key Update verification mechanisms specified in <a href="#RFC4210">CMP</a> <cite title="NONE">[RFC4210]</cite> section 4.4 when validating the peer certificates. <a href="#keyupdatemechanisms">Appendix Appendix E</a> provides an informative summary on key renewal.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Contributors/Acknowledgements </h1>
<p id="rfc.section.8.p.1">The editor would like to thank Vinod Arjun and others for their consistent feedback and prototypes based on early drafts. </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> IANA Considerations</h1>
<p id="rfc.section.9.p.1">(This section is incomplete)</p>
<p id="rfc.section.9.p.2">The following aspects should be registered with IANA Considerations:</p>
<p id="rfc.section.9.p.3">[[EDNOTE: The authorization mechanism as discussed in <a href="#TLSserverAuthZ">Section 7.2</a> may require registration with IANA.]]</p>
<p id="rfc.section.9.p.4">[[EDNOTE: The URLs specified in <a href="#overview">Section 2</a> probably do not need to be registered with IANA.]]</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#SecurityConsiderations" id="SecurityConsiderations">Security Considerations</a>
</h1>
<p id="rfc.section.10.p.1">(This section is incomplete)</p>
<p id="rfc.section.10.p.2">"Badges? We ain't got no badges. We don't need no badges! I don't have to show you any stinkin' badges!" -- The Treasure of the Sierra Madre.</p>
<p id="rfc.section.10.p.3">The proof-of-identity mechanism specified in <a href="#AuthCandAuthZ">Authentication and Authorization</a> <cite title="NONE">[AuthCandAuthZ]</cite> does not support linking the client identity with the proof-of-possession as described for Full PKI Requests in <a href="#RFC5272">CMC Section 6.3</a> <cite title="NONE">[RFC5272]</cite>. EST servers effectively trust that the client is presenting an appropriate request without a cryptographic binding between the certificate request and the outer TLS connection. A strong binding between the TLS session and the certificate requests would preclude implementations as described in <a href="#externalconcentrator">Appendix Appendix B</a> and <a href="#cgiserver">Appendix Appendix C</a> or running in an RA mode where the request is authorized and forwarded using the RA's credentials but with the request signature intact. Where a cryptographic binding between the client identity and the proof-of-possession is necessary the full CMC specification MUST be used.</p>
<p id="rfc.section.10.p.4">As indicated in <a href="#RFC5272">CMC Section 6.7</a> <cite title="NONE">[RFC5272]</cite>, "For keys that can be used as signature keys, signing the certification request with the private key serves as a POP on that key pair". For support of keys that can not be used for signatures the full CMC specification MUST be used.</p>
<p id="rfc.section.10.p.5">As indicated in <a href="#TLSclientAuthC">Section 7.3</a> clients use an existing certificate for TLS client authentication. If a certificate with appropriate key usage is not available the full CMC specification MUST be used. If a self-signed certificate with appropriate key usage is used the server will require HTTP based client authentication according to server policy as described in <a href="#TLSclientAuthC">Section 7.3</a> and <a href="#ClientAuthorization">Section 7.5</a>.</p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2315">[RFC2315]</b></td>
<td class="top">
<a href="mailto:burt@rsa.com" title="RSA Laboratories East">Kaliski, B.</a>, "<a href="http://tools.ietf.org/html/rfc2315">PKCS #7: Cryptographic Message Syntax Version 1.5</a>", RFC 2315, March 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2616">[RFC2616]</b></td>
<td class="top">
<a href="mailto:fielding@ics.uci.edu" title="Department of Information and Computer Science">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="World Wide Web Consortium">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="World Wide Web Consortium">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a> and <a href="mailto:timbl@w3.org" title="World Wide Web Consortium">T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2617">[RFC2617]</b></td>
<td class="top">
<a href="mailto:john@math.nwu.edu" title="Northwestern University, Department of Mathematics">Franks, J.</a>, <a href="mailto:pbaker@verisign.com" title="Verisign Inc.">Hallam-Baker, P.M.</a>, <a href="mailto:jeff@AbiSource.com" title="AbiSource, Inc.">Hostetler, J.L.</a>, <a href="mailto:lawrence@agranat.com" title="Agranat Systems, Inc.">Lawrence, S.D.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.J.</a>, <a title="Netscape Communications Corporation">Luotonen, A.</a> and <a href="mailto:stewart@OpenMarket.com" title="Open Market, Inc.">L. Stewart</a>, "<a href="http://tools.ietf.org/html/rfc2617">HTTP Authentication: Basic and Digest Access Authentication</a>", RFC 2617, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2986">[RFC2986]</b></td>
<td class="top">
<a>Nystrom, M.</a> and <a>B. Kaliski</a>, "<a href="http://tools.ietf.org/html/rfc2986">PKCS #10: Certification Request Syntax Specification Version 1.7</a>", RFC 2986, November 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4210">[RFC4210]</b></td>
<td class="top">
<a>Adams, C.</a>, <a>Farrell, S.</a>, <a>Kause, T.</a> and <a>T. Mononen</a>, "<a href="http://tools.ietf.org/html/rfc4210">Internet X.509 Public Key Infrastructure Certificate Management Protocol (CMP)</a>", RFC 4210, September 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4945">[RFC4945]</b></td>
<td class="top">
<a>Korver, B.</a>, "<a href="http://tools.ietf.org/html/rfc4945">The Internet IP Security PKI Profile of IKEv1/ISAKMP, IKEv2, and PKIX</a>", RFC 4945, August 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5272">[RFC5272]</b></td>
<td class="top">
<a>Schaad, J.</a> and <a>M. Myers</a>, "<a href="http://tools.ietf.org/html/rfc5272">Certificate Management over CMS (CMC)</a>", RFC 5272, June 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5273">[RFC5273]</b></td>
<td class="top">
<a>Schaad, J.</a> and <a>M. Myers</a>, "<a href="http://tools.ietf.org/html/rfc5273">Certificate Management over CMS (CMC): Transport Protocols</a>", RFC 5273, June 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2818">[RFC2818]</b></td>
<td class="top">
<a>Rescorla, E.</a>, "<a href="http://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>", RFC 2818, May 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="IDevID">[IDevID]</b></td>
<td class="top">
<a title="IEEE">IEEE Std, </a>, "<a>IEEE 802.1AR Secure Device Identifier</a>", December 2009.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#discovery" id="discovery">Server Discovery</a>
</h1>
<p id="rfc.section.Appendix A.p.1">(informative)</p>
<p id="rfc.section.Appendix A.p.2">(This section is incomplete)</p>
<p id="rfc.section.Appendix A.p.3">Cients MAY use DNS-SD or similar discovery algorithms to determine the EST base URL. In such cases it is expected that <a href="#TLSserverAuthC">method 1</a> <cite title="NONE">[TLSserverAuthC]</cite> be used during server authentication.</p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> <a href="#externalconcentrator" id="externalconcentrator">External TLS concentrator</a>
</h1>
<p id="rfc.section.Appendix B.p.1">(informative)</p>
<p id="rfc.section.Appendix B.p.2">In some deployments it may be beneficial to use a TLS concentrator to offload the TLS processing from the server. In such a deployment the TLS client authentication result must, in some way, be forwarded to the server.</p>
<p id="rfc.section.Appendix B.p.3">The TLS server SHOULD NOT reject the connection based on PKIX validation of the client certificate. The client certificate SHOULD be passed to the EST layer for verification and authorization. This allows support of external TLS concentrators, or an external web server, that might provide an independent TLS implementation.</p>
<p id="rfc.section.Appendix B.p.4">The TLS concentrator MUST validate the <a href="#RFC5246">TLS</a> <cite title="NONE">[RFC5246]</cite> Section 7.4.8 'Certificate Verify'.</p>
<p id="rfc.section.Appendix B.p.5">A TLS concentrator MUST insert the client certificate into the HTTP header. The TLS concentrator MUST first remove any existing client certificates, possibly inserted by a nefarious client, from the HTTP headers before forwarding the HTTP connection to the server.</p>
<p id="rfc.section.Appendix B.p.6">[TBD - need to better understand what would happen in the case of proxy's or multiple concentrators. Or specifically state that as out of scope.]</p>
<p id="rfc.section.Appendix B.p.7">[TBD - the HTTP header field names etc shall be specified here]</p>
<p id="rfc.section.Appendix B.p.8">The EST server MUST be specifically configured by the administrator to accept this mechanism.</p>
<h1 id="rfc.appendix.Appendix C">
<a href="#rfc.appendix.Appendix%20C">Appendix C.</a> <a href="#cgiserver" id="cgiserver">CGI Server implementation</a>
</h1>
<p id="rfc.section.Appendix C.p.1">(informative)</p>
<p id="rfc.section.Appendix C.p.2">In some deployments it may be beneficial to use a HTTPS server that runs the EST server as a CGI application. In such a deployment the HTTPS server client authentication result must, in some way, be forwarded to the server.</p>
<p id="rfc.section.Appendix C.p.3">An HTTPS server MUST insert the client certificate into environment variables before calling a server CGI application.</p>
<p id="rfc.section.Appendix C.p.4">[TBD - describe the CGI environment variables here. Can likely follow the apache example].</p>
<p id="rfc.section.Appendix C.p.5">An HTTP server MUST insert the client certificate into environment variables before calling a server CGI application.</p>
<p id="rfc.section.Appendix C.p.6">[TBD - describe the CGI environment variables here. Can likely follow the apache example].</p>
<h1 id="rfc.appendix.Appendix D">
<a href="#rfc.appendix.Appendix%20D">Appendix D.</a> Updating SCEP implementations</h1>
<p id="rfc.section.Appendix D.p.1">(informative)</p>
<p id="rfc.section.Appendix D.p.2">SCEP has been used instead of a full implementation of CMC for the same simplicity reasons discussed in <a href="#introduction">Section 1</a>. Such implementations would benefit from being updated to this specification in the following ways:</p>

<ul>
<li>Implementing a subset of <a href="#RFC5272">CMC</a> <cite title="NONE">[RFC5272]</cite> provides an enhancement path if the full CMC functionality is required.</li>
<li>The use of HTTPS as a transport is often percieved as more secure. Although the SCEP protocol specification includes mechanisms (and complexity) to address security issues avoiding a vendor requirement to educate systems administrators is beneficial.  Implementors can benefit from the wide availability of existing HTTPS/TLS libraries.</li>
<li>SCEP servers can use their CA certificate to protect SCEP traffic in ways that are not appropriate. (See SCEP draft Section 8.2). This specification precludes those misuses.</li>
<li>The SCEP draft Appendix D renew and re-key functionalities impy a 'flag moment' where the PKI infrastructure transitions from an (expired) CA certificate to a new CA certificate. This specification specifies the better mechanism defined in <a href="#RFC4210">CMP</a> <cite title="NONE">[RFC4210]</cite>.</li>
</ul>

<p>Updating an SCEP client implementation to support this protocol involves the following changes to the SCEP implementation. There is no server side indication that SCEP clients should be so modified so this depends on a client side configuration:</p>
<p></p>

<ul>
<li>The SCEP client supports HTTPS server authentication and authorization as detailed <a href="#TLSserverAuthC">Section 7.1</a>.</li>
<li>The SCEP client supports HTTPS client authentication as detailed in <a href="#TLSclientAuthC">Section 7.3</a>.</li>
<li>When performing the "Get CA Cert" SCEP transaction the client supports the <a href="#CACerts">Section 4</a> described CMC Simple PKI Response (ref CMC 4.1, which is extremely similar to the SCEP "CA/RA Certificate Response Message Format" if not exactly the same).</li>
<li>When performing the certificate enrollment via SCEP PKCSReq the outgoing message is simplified to be only the inner PKCS10 (ref CMC section 3.2.1.2.1).</li>
<li>When handling the certificate enrollment response the response format is simplified to be only the SCEP inner 'messageData' containing the actual certificates in the degenerate PKCS7 form.  (ref CMC 4.1) The only 'authenticatedAttributes' value of remaining importance is the 'pkiStatus' and this value is now found in the HTTP header as defined in <a href="#EnrollResponse">Section 5.2</a>.</li>
<li>Polling is simplified with clients repeatingly establishing the full HTTPS connection; no polling specific state information is encoded into the EST messages.</li>
<li>GetCert is deprecated.</li>
<li>GetCRL is deprecated.</li>
</ul>

<p>These simplifications to an existing SCEP implementation result in an SCEP client that is compliant with CMC when using the EST transport.</p>
<h1 id="rfc.appendix.Appendix E">
<a href="#rfc.appendix.Appendix%20E">Appendix E.</a> <a href="#keyupdatemechanisms" id="keyupdatemechanisms">Key Update mechanisms</a>
</h1>
<p id="rfc.section.Appendix E.p.1">(informative)</p>
<p id="rfc.section.Appendix E.p.2">(This section is incomplete)</p>
<p id="rfc.section.Appendix E.p.3">The <a href="#RFC4210">CMP</a> <cite title="NONE">[RFC4210]</cite> section 4.4 defined Root CA Key Update mechanisms are repeated here for easier reference.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Max Pritikin</span> editor
	  <span class="n hidden">
		<span class="family-name">Pritikin</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems, Inc.</span>
	<span class="adr">
	  <span>510 McCarthy Drive</span>

	  <span class="vcardline">
		<span class="locality">Milpitas</span>,  
		<span class="region">CA</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:pritikin@cisco.com">pritikin@cisco.com</a></span>

  </address>
</div>

</body>
</html>