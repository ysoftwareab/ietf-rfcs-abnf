<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Framework for CDN Interconnection</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Terminology">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Reference Model">
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 Structure Of This Document">
<link href="#rfc.section.2" rel="Chapter" title="2 Building Blocks">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Request Redirection">
<link href="#rfc.section.2.1.1" rel="Chapter" title="2.1.1 DNS Redirection">
<link href="#rfc.section.2.1.2" rel="Chapter" title="2.1.2 HTTP Redirection">
<link href="#rfc.section.3" rel="Chapter" title="3 Overview of CDNI Operation">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Preliminaries">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 HTTP Redirect Example">
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 Comments on the example">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Recursive Redirection Example">
<link href="#rfc.section.3.3.1" rel="Chapter" title="3.3.1 Comments on the example">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 DNS-based redirection example">
<link href="#rfc.section.3.4.1" rel="Chapter" title="3.4.1 Comments on the example">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Dynamic Footprint Discovery">
<link href="#rfc.section.3.6" rel="Chapter" title="3.6 Content Removal">
<link href="#rfc.section.3.7" rel="Chapter" title="3.7 Pre-Positioned Content Acquisition Example">
<link href="#rfc.section.3.8" rel="Chapter" title="3.8 Asynchronous CDNI Metadata Example">
<link href="#rfc.section.3.9" rel="Chapter" title="3.9 Synchronous CDNI Metadata Acquisition Example">
<link href="#rfc.section.4" rel="Chapter" title="4 Main Interfaces">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 In-Band versus Out-of-Band Interfaces">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Request Routing Interface">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Logging Interface">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Control Interface">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Metadata Interface">
<link href="#rfc.section.5" rel="Chapter" title="5 Deployment Models">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Meshed CDNs">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 CSP combined with CDN">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 CSP using CDNI Request Routing Interface">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 CDN Federations and CDN Exchanges">
<link href="#rfc.section.6" rel="Chapter" title="6 Trust Model">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Security of CDNI Interfaces">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Digital Rights Management">
<link href="#rfc.section.9" rel="Chapter" title="9 Contributors">
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document presents a framework for Content Distribution Network Interconnection (CDNI). The purpose of the framework is to provide an overall picture of the problem space of CDNI and to describe the relationships among the various components necessary to interconnect CDNs. CDN Interconnection requires the specification of several interfaces and mechanisms to address issues such as request routing, metadata exchange, and the acquisition of content by one CDN from another. The intent of this document is to outline what each interface needs to accomplish, and to describe how these interfaces and mechanisms fit together, while leaving their detailed specification to other documents." />
  <meta name="description" content="This document presents a framework for Content Distribution Network Interconnection (CDNI). The purpose of the framework is to provide an overall picture of the problem space of CDNI and to describe the relationships among the various components necessary to interconnect CDNs. CDN Interconnection requires the specification of several interfaces and mechanisms to address issues such as request routing, metadata exchange, and the acquisition of content by one CDN from another. The intent of this document is to outline what each interface needs to accomplish, and to describe how these interfaces and mechanisms fit together, while leaving their detailed specification to other documents." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">B. Davie, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Cisco Systems, Inc.</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">L. . Peterson, Ed.</td>
</tr>
<tr>
<td class="left">Expires: May 03, 2012</td>
<td class="right">Verivue, Inc.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 31, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Framework for CDN Interconnection<br />
  <span class="filename">draft-davie-cdni-framework-01</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document presents a framework for Content Distribution Network Interconnection (CDNI). The purpose of the framework is to provide an overall picture of the problem space of CDNI and to describe the relationships among the various components necessary to interconnect CDNs. CDN Interconnection requires the specification of several interfaces and mechanisms to address issues such as request routing, metadata exchange, and the acquisition of content by one CDN from another. The intent of this document is to outline what each interface needs to accomplish, and to describe how these interfaces and mechanisms fit together, while leaving their detailed specification to other documents.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 03, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Terminology</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Reference Model</a>
</li>
<li>1.3.   <a href="#rfc.section.1.3">Structure Of This Document</a>
</li>
<li>2.   <a href="#rfc.section.2">Building Blocks</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Request Redirection</a>
</li>
<li>2.1.1.   <a href="#rfc.section.2.1.1">DNS Redirection</a>
</li>
<li>2.1.2.   <a href="#rfc.section.2.1.2">HTTP Redirection</a>
</li>
<li>3.   <a href="#rfc.section.3">Overview of CDNI Operation</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Preliminaries</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">HTTP Redirect Example</a>
</li>
<li>3.2.1.   <a href="#rfc.section.3.2.1">Comments on the example</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Recursive Redirection Example</a>
</li>
<li>3.3.1.   <a href="#rfc.section.3.3.1">Comments on the example</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">DNS-based redirection example</a>
</li>
<li>3.4.1.   <a href="#rfc.section.3.4.1">Comments on the example</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">Dynamic Footprint Discovery</a>
</li>
<li>3.6.   <a href="#rfc.section.3.6">Content Removal</a>
</li>
<li>3.7.   <a href="#rfc.section.3.7">Pre-Positioned Content Acquisition Example</a>
</li>
<li>3.8.   <a href="#rfc.section.3.8">Asynchronous CDNI Metadata Example</a>
</li>
<li>3.9.   <a href="#rfc.section.3.9">Synchronous CDNI Metadata Acquisition Example</a>
</li>
<li>4.   <a href="#rfc.section.4">Main Interfaces</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">In-Band versus Out-of-Band Interfaces</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Request Routing Interface</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Logging Interface</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Control Interface</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Metadata Interface</a>
</li>
<li>5.   <a href="#rfc.section.5">Deployment Models</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Meshed CDNs</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">CSP combined with CDN</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">CSP using CDNI Request Routing Interface</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">CDN Federations and CDN Exchanges</a>
</li>
<li>6.   <a href="#rfc.section.6">Trust Model</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">Security of CDNI Interfaces</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">Digital Rights Management</a>
</li>
<li>9.   <a href="#rfc.section.9">Contributors</a>
</li>
<li>10.   <a href="#rfc.section.10">Acknowledgements</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The interconnection of Content Distribution Networks (CDNs) is motivated by several use cases, such as those described in <a href="#I-D.ietf-cdni-use-cases">[I-D.ietf-cdni-use-cases]</a>. The overall problem space for CDN Interconnection is described in <a href="#I-D.ietf-cdni-problem-statement">[I-D.ietf-cdni-problem-statement]</a>. The purpose of this document is to provide an overview of the various components necessary to interconnect CDNs. CDN Interconnection requires the specification of several interfaces and mechanisms to address issues such as request routing, metadata exchange, and the acquisition of content by one CDN from another. The intent of this document is to describe how these interfaces and mechanisms fit together, leaving their detailed specification to other documents. We make extensive use of message flow examples to illustrate the operation of interconnected CDNs, but these examples should be considered illustrative rather than prescriptive.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Terminology</h1>
<p id="rfc.section.1.1.p.1">This document draws freely on the terminology defined in <a href="#RFC3466">[RFC3466]</a> and <a href="#I-D.ietf-cdni-problem-statement">[I-D.ietf-cdni-problem-statement]</a>.</p>
<p id="rfc.section.1.1.p.2">We also introduce the following terms:</p>
<p id="rfc.section.1.1.p.3">CDN Domain: a host name (FQDN) at the beginning of a URL, representing a set of content that is served by a given CDN. For example, in the URL http://cdn.csp.com/...rest of url..., the CDN domain is cdn.csp.com.</p>
<p id="rfc.section.1.1.p.4">Distinguished CDN Domain: a CDN domain that is allocated by a CDN for the purposes of communication with a peer CDN, but which is not found in client requests. Such CDN domains may be used for inter-CDN acquisition, or as redirection targets, and enable a CDN to distinguish a request from a peer CDN from an end-user request.</p>
<p id="rfc.section.1.1.p.5">Recursive CDNI request routing: When an Upstream CDN elects to redirect a request towards a Downstream CDN, the Upstream CDN can query the Downstream CDN Request Routing system via the CDNI Request Routing interface (or use information cached from earlier similar queries) to find out how the Downstream CDN wants the request to be redirected, which allows the Upstream CDN to factor in the Downstream CDN response when redirecting the user agent. This approach is referred to as "recursive" CDNI request routing. Note that the Downstream CDN may elect to have the request redirected directly to a Surrogate inside the Downstream CDN, to the Request-Routing System of the Downstream CDN, to another CDN, or to any other system that the Downstream CDN sees as fit for handling the redirected request.</p>
<p id="rfc.section.1.1.p.6">Iterative CDNI Request Routing: When an Upstream CDN elects to redirect a request towards a Downstream CDN, the Upstream CDN can base its redirection purely on a local decision (and without attempting to take into account how the Downstream CDN may in turn redirect the user agent). In that case, the Upstream CDN redirects the request to the request routing system in the Downstream CDN, which in turn will decide how to redirect that request: this approach is referred to as "iterative" CDNI request routing.</p>
<p id="rfc.section.1.1.p.7">Synchronous CDNI operations: operations between CDNs that happen during the process of servicing a user request, i.e. between the time that the user agent begins its attempt to obtain content and the time at which that request is served.</p>
<p id="rfc.section.1.1.p.8">Asynchronous CDNI operations: operations between CDNs that happen independently of any given user request, such as advertisement of footprint information or pre-positioning of content for later delivery.</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> Reference Model</h1>
<p id="rfc.section.1.2.p.1">This document uses the reference model in <a href="#refmod">Figure 1</a> as originally created in <a href="#I-D.ietf-cdni-problem-statement">[I-D.ietf-cdni-problem-statement]</a>.</p>
<div id="#rfc.figure.1"></div>
<div id="#refmod"></div>
<p></p>
<pre>   -------- 
  /        \
  |   CSP  |
  \        /
   --------
       *
       *
       *                         /\
       *                        /  \
   ----------------------      |CDNI|        ----------------------
  /     Upstream CDN     \     |    |       /    Downstream CDN    \
  |      +-------------+ | Control Interface| +-------------+      |
  |*******   Control   |&lt;======|====|========&gt;|   Control   *******|
  |*     +------*----*-+ |     |    |       | +-*----*------+     *|
  |*            *    *   |     |    |       |   *    *            *|
  |*     +------*------+ | Logging Interface| +------*------+     *|
  |* *****   Logging   |&lt;======|====|========&gt;|   Logging   ***** *|
  |* *   +-*-----------+ |     |    |       | +-----------*-+   * *|
  |* *     *         *   | Request Routing  |   *         *     * *|
.....*...+-*---------*-+ |    Interface     | +-*---------*-+...*.*...
. |* * *** Req-Routing |&lt;======|====|========&gt;| Req-Routing *** * *| .
. |* * * +-------------+.|     |    |       | +-------------+ * * *| .
. |* * *                 .  CDNI Metadata   |                 * * *| .
. |* * * +-------------+ |.   Interface     | +-------------+ * * *| .
. |* * * | Distribution|&lt;==.===|====|========&gt;| Distribution| * * *| .
. |* * * |             | |  .   \  /        | |             | * * *| .
. |* * * |+---------+  | |   .   \/         | |  +---------+| * * *| .
. |* * ***| +---------+| |    ....Request......+---------+ |*** * *| .
. |* *****+-|Surrogate|************************|Surrogate|-+***** *| .
. |*******  +---------+| |   Acquisition    | |+----------+ *******| .
. |      +-------------+ |                  | +-------*-----+      | .
. \                      /                  \         *            / .
.  ----------------------                    ---------*------------  .
.                                                     *              .
.                                                     * Delivery     .
.                                                     *              .
.                                                  +--*---+          .
...............Request.............................| User |..Request..
                                                   | Agent|
                                                   +------+

&lt;==&gt;  interfaces inside the scope of CDNI

****  interfaces outside the scope of CDNI
....  interfaces outside the scope of CDNI
</pre>
<p id="rfc.section.1.2.p.2">We note that while some interfaces in the reference model are "out of scope" for the CDNI WG (in the sense that there is no need to define new protocols for those interfaces) we still need to refer to them in this document to explain the overall operation of CDNI.</p>
<p id="rfc.section.1.2.p.3">We also note that, while we generally show only one uCDN serving a given CSP, it is entirely possible that multiple uCDNs can serve a single CSP. In fact, this situation effectively exists today in the sense that a single CSP can connect to more than one CDN today. </p>
<p id="rfc.section.1.2.p.4">Definitions of the four CDNI interfaces follow. More discussion of these interfaces appears in <a href="#interfaces">Section 4</a>. </p>

<ul>
<li>Control Interface: Operations to discover, initialize, and parameterize the other CDNI interfaces. Once established, all runtime control over CDNI behavior is under the purview of one of these other interfaces.</li>
<li>Request Routing Interface: Operations to determine what CDN (and optionally what surrogate within a CDN) is to serve end-user's requests. May include a combination of: <ul>
<li>Asynchronous operations to exchange routing information (e.g., the network footprint served by a given CDN) that enables CDN selection for subsequent user requests; and</li>
<li>Synchronous operations to select a delivery CDN (surrogate) for a given user request.</li>
</ul>
</li>
<li>Metadata Interface: Operations to communicate metadata that governs the how content is delivered by interconnected CDNs.  Examples of CDNI metadata include geo-blocking directives, availability windows, access control mechanisms, and purge directives. May include a combination of: <ul>
<li>Asynchronous operations to exchange metadata that govern subsequent user requests for content; and</li>
<li>Synchronous operations that govern behavior for a given user request for content.</li>
</ul>
</li>
<li>Logging Interface: Operations that allow interconnected CDNs to exchange relevant activity logs. May include a combination of: <ul>
<li>Real-time exchanges, suitable for runtime traffic monitoring; and</li>
<li>Off-line exchanges, suitable for analytics and billing.</li>
</ul>
</li>
</ul>
<h1 id="rfc.section.1.3">
<a href="#rfc.section.1.3">1.3.</a> Structure Of This Document</h1>
<p id="rfc.section.1.3.p.1">The remainder of this document is organized as follows: </p>

<ul>
<li>
<a href="#blocks">Section 2</a> describes some essential building blocks for CDNI, notably the various options for redirecting user requests to a given CDN.</li>
<li>
<a href="#operation">Section 3</a> provides a number of illustrative examples of various CDNI operations.</li>
<li>
<a href="#interfaces">Section 4</a> describes the functionality of the four main CDNI interfaces.</li>
<li>
<a href="#deploy">Section 5</a> shows how various deployment models of CDNI may be achieved using the defined interfaces.</li>
<li>
<a href="#trust">Section 6</a> describes the trust model of CDNI and the issues of transitive trust in particular that CDNI raises.</li>
</ul>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#blocks" id="blocks">Building Blocks</a>
</h1>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#redirection" id="redirection">Request Redirection</a>
</h1>
<p id="rfc.section.2.1.p.1">At its core, CDN Interconnection requires the redirection of requests from one CDN to another. For any given request that is received by an upstream CDN, it will either respond to the request directly, or somehow redirect the request to a downstream CDN. Two main mechanisms are available for redirecting a request to a downstream CDN. The first leverages the DNS name resolution process and the second uses in-protocol redirection mechanisms such as the HTTP 302 redirection response. We discuss these below as background before discussing some examples of their use in <a href="#operation">Section 3</a>.</p>
<h1 id="rfc.section.2.1.1">
<a href="#rfc.section.2.1.1">2.1.1.</a> DNS Redirection</h1>
<p id="rfc.section.2.1.1.p.1">DNS redirection is based on returning different IP addresses for the same DNS name, for example, to balance server load or to account for the client&#8217;s location in the network. A DNS server, sometimes called the Local DNS (LDNS), resolves DNS names on behalf of an end-user. The LDNS server in turn queries other DNS servers until it reaches the authoritative DNS server for the CDN-domain.  The network operator typically provides the LDNS server, although the user is free to choose other DNS servers (e.g., OpenDNS, Google Public DNS).</p>
<p id="rfc.section.2.1.1.p.2">The advantage of DNS redirection is that it is completely transparent to the end user&#8212;the user sends a DNS name to the LDNS server and gets back an IP address. On the other hand, DNS redirection is problematic because the DNS request comes from the LDNS server, not the end-user. This may affect the accuracy of server selection that is based on the user&#8217;s location. The transparency of DNS redirection is also a problem in that there is no opportunity to modify the path component of the URL being accessed by the client. We consider two main forms of DNS redirection: simple and CNAME-based.</p>
<p id="rfc.section.2.1.1.p.3">In simple DNS redirection, the authoritative DNS server for the name simply returns an IP address from a set of possible IP addresses. The answer is chosen from the set based on characteristics of the set (e.g., the relative loads on the servers) or characteristics of the client (e.g., the location of the client relative to the servers). Simple redirection is straightforward. The only caveats are (1) there is a limit to the number of delivery nodes a single DNS server can manage; and (2) DNS responses are cached by downstream servers so the TTL on the response must be set to an appropriate value so as to preserve the timeliness of the redirection.</p>
<p id="rfc.section.2.1.1.p.4">In CNAME-based DNS redirection, the authoritative server returns a CNAME response to the DNS request, telling the LDNS server to restart the name lookup using a new name. A CNAME is essentially a symbolic link in the DNS namespace, and like a symbolic link, redirection is transparent to the client&#8212;the LDNS server gets the CNAME response and re-executes the lookup. Only when the name has been resolved to an IP address does it return the result to the user. Note that DNAME would be preferable to CNAME if it becomes widely supported.</p>
<h1 id="rfc.section.2.1.2">
<a href="#rfc.section.2.1.2">2.1.2.</a> HTTP Redirection</h1>
<p id="rfc.section.2.1.2.p.1">HTTP redirection makes use of the &#8220;302&#8221; redirection response of the HTTP protocol. This response contains a new URL that the application should fetch instead of the original URL. By changing the URL appropriately, the server can cause the user to redirect to a different server. The advantages of 302 redirection are that (1) the server can change the URL fetched by the client to include, for example, both the DNS name of the particular server to use, as well as the original HTTP server that was being accessed; and (2) the client sends the HTTP request to the server, so that its IP address is known and can be used in selecting the server.</p>
<p id="rfc.section.2.1.2.p.2">The disadvantages of HTTP redirection are (1) it is visible to the application, so it requires application support and may affect the application behavior (e.g., web browsers will not send cookies if the URL changes to a different domain); (2) HTTP is a heavy-weight protocol layered on TCP so it has relatively high overhead; and (3) the results of HTTP redirection are not cached so that all redirections must go through to the server.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#operation" id="operation">Overview of CDNI Operation</a>
</h1>
<p id="rfc.section.3.p.1">To provide a big-picture overview of the various components of CDN Interconnection, we walk through a "day in the life" of a content item that is made available via a pair of interconnected CDNs. This will serve to illustrate many of the functions that need to be supported in a complete CDNI solution. We give examples using both DNS-based and HTTP-based redirection. We begin with very simple examples and then how additional capabilities, such as recursive request redirection and content removal, might be added.</p>
<p id="rfc.section.3.p.2">Before walking through some specific examples, we present a high-level view of the operations that may take place. This high-level overview is illustrated in <a href="#high-level-ops">Figure 2</a>. Note that most operations will involve only a subset of all the messages shown below, and that the order and number of operations may vary considerably, as more detailed examples illustrate below.</p>
<p id="rfc.section.3.p.3">The following shows Operator A as the upstream CDN (uCDN) and Operator B as the downstream CDN (dCDN), where the former has a relationship with a content provider and the latter being the best CDN to deliver content to the end-user. The interconnection relationship may be symmetric between these two CDN operators, but for simplicity we show the interaction in one direction only.</p>
<div id="#rfc.figure.2"></div>
<div id="#high-level-ops"></div>
<pre>


      End-User                  Operator B                Operator A
          |                         |                         |
          |                         |                         |
          |                         |  [Async Metadata Push]  | (1)
          |                         |                         |
          |                         |  [Async RRI Push]       | (2)
          |                         |                         |
          | CONTENT REQUEST         |                         |
          |--------------------------------------------------&gt;| (3)
          |                         |                         |
          |                         | [Sync RRI Pull]         | (4)
          |                         |                         |
          | CONTENT REDIRECTION     |                         |
          |&lt;--------------------------------------------------| (5)
          |                         |                         |
          |                         |                         |
          | CONTENT REQUEST         |                         |
          |------------------------&gt;|                         | (6)
          |                         |                         |
          |                         | [Sync Metadata Pull]    | (7)
          |                         |                         |
          |                         | ACQUISITION REQUEST     |
          |                         X------------------------&gt;| (8)
          |                         X                         |
          |                         X CONTENT DATA            |
          |                         X&lt;------------------------| (9)
          |                         |                         |
          | CONTENT DATA            |                         |
          |&lt;------------------------|                         | (10)
          |                         |                         |
          :                         :                         :
	  :    [Other content requests  ]                     :
          :                         :                         :
          |                         |  [Content Purge]        | (11)
          :                         :                         :
          |                         |  [Logging exchange]     | (12)
          |                         |                         |


</pre>
<p id="rfc.section.3.p.4">The operations shown in the Figure are as follows: </p>

<ol>
<li>Prior to any content request, metadata may be asynchronously pushed from uCDN to dCDN so that it is available in readiness for later content requests.</li>
<li>dCDN may advertise information relevant to its delivery capabilities (e.g. geographic footprint, reachable address prefixes) prior to any content requests being redirected.</li>
<li>A content request from a user agent arrives at uCDN.</li>
<li>uCDN may synchronously request information from dCDN regarding its delivery capabilities to decide if dCDN is a suitable target for redirection of this request.</li>
<li>uCDN redirects the request to dCDN by sending some response (DNS, HTTP) to the user agent.</li>
<li>The user agent requests the content from dCDN.</li>
<li>dCDN may synchronously request metadata related to this content from uCDN, e.g. to decide whether to serve it.</li>
<li>If the content is not already in a suitable cache in dCDN, dCDN may acquire it from uCDN.</li>
<li>The content is delivered to dCDN from uCDN.</li>
<li>The content is delivered to the user agent by dCDN.</li>
<li>Some time later, perhaps at the request of the CSP (not shown) uCDN may instruct dCDN to purge the content to ensure it is not delivered again.</li>
<li>After one or more content delivery actions by dCDN, a log of delivery actions may be provided to uCDN.</li>
</ol>
<p id="rfc.section.3.p.5">The following sections show some more specific examples of how these operations may be combined to perform various delivery, control and logging operations across a pair of CDNs.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Preliminaries</h1>
<p id="rfc.section.3.1.p.1">Initially, we assume that there is at least one CSP that has contracted with an upstream CDN (uCDN) to deliver content on its behalf. We are not particularly concerned with the interface between the CSP and uCDN, other than to note that it is expected to be the same as in the "traditional" (non-interconnected) CDN case. Existing mechanisms such as DNS CNAMEs or HTTP redirects (<a href="#blocks">Section 2</a>) can be used to direct a user request for a piece of content from the CSP towards the CSP's chosen upstream CDN.</p>
<p id="rfc.section.3.1.p.2">We use the term "CDN-domain" to refer to the host name (a FQDN) at the beginning of each URL. We assume Operator A provides an upstream CDN that serves content on behalf of a CSP with CDN-domain cdn.csp.com. We assume that Operator B provides a downstream CDN. An end user at some point makes a request for URL</p>
<p id="rfc.section.3.1.p.3">http://cdn.csp.com/...rest of url...</p>
<p id="rfc.section.3.1.p.4">It may well be the case that cdn.csp.com is just a CNAME for some other CDN-domain (such as csp.op-a.net). Nevertheless, the HTTP request in the examples that follow is assumed to be for the example URL above.</p>
<p id="rfc.section.3.1.p.5">Our goal is to enable content identified by the above URL to be served by the CDN of operator B. In the following sections we will walk through some scenarios in which content is served, as well as other CDNI operations such as the removal of content from a downstream CDN.</p>
<p></p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#http-redir" id="http-redir">HTTP Redirect Example</a>
</h1>
<p id="rfc.section.3.2.p.1">In this section we walk through a simple, illustrative example using HTTP redirection from uCDN to dCDN. The example also assumes the use of HTTP redirection inside uCDN and dCDN; however, this is independent of the choice of redirection approach across CDNs, so an alternative example could be constructed still showing HTTP redirection from uCDN to dCDN but using DNS for handling of request inside each CDN.</p>
<p id="rfc.section.3.2.p.2">We assume for this example that Operators A and B have established an agreement to interconnect their CDNs, with A being upstream and B being downstream. (It is likely that the agreement would be made in both directions, but we focus on just one here for clarity.)</p>
<p id="rfc.section.3.2.p.3">The operators agree that a CDN-domain peer-a.op-b.net will be used as the target of redirections from uCDN to dCDN. The name of this domain must be communicated by some means to each CDN. (This could be established out-of-band or via a CDNI interface.) We refer to this domain as a "distinguished" CDN domain to convey the fact that its use is limited to the interconnection mechanism; such a domain is never embedded in URLs that end-users request.</p>
<p id="rfc.section.3.2.p.4">The operators must also agree on some distinguished CDN-domain that will be used for inter-CDN acquisition of CSP's content from uCDN by dCDN. In this example, we'll use op-b-acq.op-a.net.</p>
<p id="rfc.section.3.2.p.5">The operators must also exchange information regarding which requests dCDN is prepared to serve. For example, dCDN may be prepared to serve requests from clients in a given geographical region or a set of IP address prefixes. This information may again be provided out of band or via a defined interface.</p>
<p id="rfc.section.3.2.p.6">DNS must be configured in the following way:</p>

<ul>
<li>The content provider must be configured to make operator A the authoritative DNS server for cdn.csp.com (or to return a CNAME for cdn.csp.com for which operator A is the authoritative DNS server).</li>
<li>Operator A must be configured so that a DNS request for op-b-acq.op-a.net returns a request router in Operator A.</li>
<li>Operator B must be configured so that a DNS request for peer-a.op-b.net/cdn.csp.com returns a request router in Operator B.</li>
</ul>
<p><a href="#simple-http">Figure 3</a> illustrates how a client request for</p>
<p id="rfc.section.3.2.p.8">http://cdn.csp.com/...rest of url...</p>
<p id="rfc.section.3.2.p.9">is handled.</p>
<div id="#rfc.figure.3"></div>
<div id="#simple-http"></div>
<pre>
      End-User                 Operator B                Operator A
          |DNS cdn.csp.com          |                         |
          |--------------------------------------------------&gt;|
          |                         |                         |(1)
          |IPaddr of A's Request Router                       |
          |&lt;--------------------------------------------------|
          |HTTP cdn.csp.com         |                         |
          |--------------------------------------------------&gt;|
          |                         |                         |(2)
          |302 peer-a.op-b.net/cdn.csp.com                    |
          |&lt;--------------------------------------------------|
          |DNS peer-a.op-b.net      |                         |
          |------------------------&gt;|                         |
          |                         |(3)                      |
          |IPaddr of B's Request Router                       |
          |&lt;------------------------|                         |
          |                         |                         |
          |HTTP peer-a.op-b.net/cdn.csp.com                   |
          |------------------------&gt;|                         |
          |                         |(4)                      |
          |302 node1.peer-a.op-b.net/cdn.csp.com              |
          |&lt;------------------------|                         |
          |DNS node1.peer-a.op-b.net|                         |
          |------------------------&gt;|                         |
          |                         |(5)                      |
          |IPaddr of B's Delivery Node                        |
          |&lt;------------------------|                         |
          |                         |                         |
          |HTTP node1.peer-a.op-b.net/cdn.csp.com             |
          |------------------------&gt;|                         |
          |                         |(6)                      |
          |                         |DNS op-b-acq.op-a.net    |
          |                         |------------------------&gt;|
          |                         |                         |(7)
          |                         |IPaddr of A's Request Router
          |                         |&lt;------------------------|
          |                         |HTTP op-b-acq.op-a.net   |
          |                         |------------------------&gt;|
          |                         |                         |(8)
          |                         |302 node2.op-b.acq.op-A.net
          |                         |&lt;------------------------|
          |                         |DNS node2.op-b-acq.op-a.net
          |                         |------------------------&gt;|
          |                         |                         |(9)
          |                         |IPaddr of A's Delivery Node
          |                         |&lt;------------------------|
          |                         |                         |(10)
          |                         |Data                     |
          |                         |&lt;------------------------|
          |Data                     |                         |
          |&lt;------------------------|                         |
</pre>
<p id="rfc.section.3.2.p.10">The steps illustrated in the figure are as follows:</p>

<ol>
<li>A DNS resolver for Operator A processes the DNS request for its customer based on CDN-domain cdn.csp.com. It returns the IP address of a request router in Operator A.</li>
<li>A Request Router for Operator A processes the HTTP request and recognizes that the end-user is best served by another CDN&#8212;specifically one provided by Operator B&#8212;and so it returns a 302 redirect message for a new URL constructed by &#8220;stacking&#8221; Operator B&#8217;s distinguished CDN-domain (peer-a.op-b.net) on the front of the original URL. (Note that more complex URL manipulations are possible, such as replacing the initial CDN-domain by some opaque handle.)</li>
<li>The end-user does a DNS lookup using Operator B&#8217;s distinguished CDN-domain (peer-a.op-b.net). B&#8217;s DNS resolver returns the IP address of a request router for Operator B. Note that if request routing within dCDN was performed using DNS instead of HTTP redirection, B's DNS resolver would also behave as the request router and directly return the IP address of a delivery node.</li>
<li>The request router for Operator B processes the HTTP request and selects a suitable delivery node to serve the end-user request, and returns a 302 redirect message for a new URL constructed by replacing the hostname by a subdomain of the Operator B&#8217;s distinguished CDN-domain that points to the selected delivery node.</li>
<li>The end-user does a DNS lookup using Operator B&#8217;s delivery node subdomain (node1.peer-a.op-b.net). B&#8217;s DNS resolver returns the IP address of the delivery node.</li>
<li>The end-user requests the content from B&#8217;s delivery node.  In the case of a cache hit, steps 6, 7, 8, 9 and 10 below do not happen, and the content data is directly returned by the delivery node to the end-user. In the case of a cache miss, the content needs to be acquired by dCDN from uCDN (not the CSP). The distinguished CDN-domain peer-a.op-b.net indicates to dCDN that this content is to be acquired from uCDN; stripping the CDN-domain reveals the original CDN-domain cdn.csp.com and dCDN may verify that this CDN-domain belongs to a known peer (so as to avoid being tricked into serving as an open proxy). It then does a DNS request for an inter-CDN acquisition CDN-domain as agreed above (in this case, op-b-acq.op-a.net).</li>
<li>Operator A's DNS resolver processes the DNS request and returns the IP address of a request router in operator A.</li>
<li>The request router for Operator A processes the HTTP request from Operator B delivery node. Operator A request router recognizes that the request is from a peer CDN rather than an end-user because of the dedicated inter-CDN acquisition domain (op-b-acq.op-a.net). (Note that without this specially defined inter-CDN acquisition domain, operator A would be at risk of redirecting the request back to operator B, resulting in an infinite loop). The request router for Operator A selects a suitable delivery node in uCDN to serve the inter-CDN acquisition request and returns a 302 redirect message for a new URL constructed by replacing the hostname by a subdomain of the Operator A&#8217;s distinguished inter-CDN acquisition domain that points to the selected delivery node.</li>
<li>Operator A DNS resolver processes the DNS request and returns the IP address of the delivery node in operator A.</li>
<li>Operator A serves content for the requested CDN-domain to dCDN.  Although not shown, it is at this point that Operator A processes the rest of the URL: it extracts information identifying the origin server, validates that this server has been registered, and determines the content provider that owns the origin server. It may also perform its own content acquisition steps if needed before returning the content to dCDN.</li>
</ol>
<h1 id="rfc.section.3.2.1">
<a href="#rfc.section.3.2.1">3.2.1.</a> Comments on the example</h1>
<p id="rfc.section.3.2.1.p.1">The main advantage of this design is that it is simple: each CDN need only know the distinguished CDN-domain for each peer, with the upstream CDN &#8220;pushing&#8221; the downstream CDN-domain onto the URL as part of its redirect (step 2) and the downstream CDN &#8220;popping&#8221; its CDN-domain off the URL to expose a CDN-domain that the upstream CDN can correctly process. Neither CDN needs to be aware of the internal structure of the other's URLs.  Moreover, the inter-CDN redirection is entirely supported by a single HTTP redirect; neither CDN needs to be aware of the other's internal redirection mechanism (i.e., whether it is DNS or HTTP based).</p>
<p id="rfc.section.3.2.1.p.2">One disadvantage is that the end-user's browser is redirected to a new URL that is not in the same domain of the original URL. This has implications on a number of security or validation mechanisms sometimes used on endpoints. For example, it is important that any redirected URL be in the same domain (e.g., csp.com) if the browser is expected to send any cookies associated with that domain. As another example, some video players enforce validation of a cross domain policy that needs to allow for the domains involved in the CDN redirection. These problems are generally soluble, but the solutions complicate the example, so we do not discuss them further in this version of the draft.</p>
<p id="rfc.section.3.2.1.p.3">We note that this example begins to illustrate some of the interfaces that may be required for CDNI, but does not require all of them. For example, obtaining information from dCDN regarding the set of client IP addresses or geographic regions it might be able to serve is an aspect of the request routing interface. Important configuration information such as the distinguished names used for redirection and inter-CDN acquisition could also be conveyed via a CDNI interface (e.g., perhaps the control interface).  The example also shows how existing HTTP-based methods suffice for the acquisition interface. Arguably, the absolute minimum metadata required for CDNI is the information required to acquire the content, and this information was provided "in-band" in this example by means of the URI handed to the client in the HTTP 302 response.  Hence, there is no explicit metadata interface invoked in this example. There is also no explicit logging interface discussed in this example.</p>
<p id="rfc.section.3.2.1.p.4">We also note that the step of deciding when a request should be redirected to dCDN rather than served by uCDN has been somewhat glossed over. It may be as simple as checking the client IP address against a list of prefixes, or it may be considerably more complex, involving a wide range of factors, such as the geographic location of the client (perhaps determined from a third party service), CDN load, or specific business rules.</p>
<p id="rfc.section.3.2.1.p.5">This example uses the "iterative" CDNI request routing approach. That is, uCDN performs part of the request routing function to determine that dCDN should serve the request, and then redirects the client to a request router in dCDN to perform the rest of the request routing function. If request routing is performed in the dCDN using HTTP redirection, this translates in the end-user experiencing two successive HTTP redirections. By contrast, the alternative approach of "recursive" CDNI request routing  effectively coalesces these two successive HTTP redirections into a single one, sending the end-user directly to the right delivery node in the dCDN. This "recursive" CDNI request routing approach is discussed in the next section.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#recurse" id="recurse">Recursive Redirection Example</a>
</h1>
<p id="rfc.section.3.3.p.1">The following example builds on the previous one to illustrate the use of the Request Routing interface to enable "recursive" CDNI request routing. We build on the HTTP-based redirection approach because it illustrates the principles and benefits clearly, but it is equally possible to perform recursive redirection when DNS-based redirection is employed.</p>
<p id="rfc.section.3.3.p.2">In contrast to the prior example, the operators need not agree in advance on a CDN-domain to serve as the target of redirections from uCDN to dCDN. The operators still must agree on some distinguished CDN-domain that will be used for inter-CDN acquisition of CSP's content by dCDN. In this example, we'll use op-b-acq.op-a.net.</p>
<p id="rfc.section.3.3.p.3">The operators must also exchange information regarding which requests dCDN is prepared to serve. For example, dCDN may be prepared to serve requests from clients in a given geographical region or a set of IP address prefixes. This information may again be provided out of band or via a defined protocol.</p>
<p id="rfc.section.3.3.p.4">DNS must be configured in the following way:</p>

<ul>
<li>The content provider must be configured to make operator A the authoritative DNS server for cdn.csp.com (or to return a CNAME for cdn.csp.com for which operator A is the authoritative DNS server).</li>
<li>Operator A must be configured so that a DNS request for op-b-acq.op-a.net returns a request router in Operator A.</li>
<li>Operator B must be configured so that a request for node1.op-b.net/cdn.csp.com returns the IP address of a delivery node. Note that there might be a number of such delivery nodes.</li>
</ul>
<p><a href="#simple-http">Figure 3</a> illustrates how a client request for</p>
<p id="rfc.section.3.3.p.6">http://cdn.csp.com/...rest of url...</p>
<p id="rfc.section.3.3.p.7">is handled.</p>
<div id="#rfc.figure.4"></div>
<div id="#recurse-http"></div>
<pre>      End-User                 Operator B                Operator A
          |DNS cdn.csp.com          |                         |
          |--------------------------------------------------&gt;|
          |                         |                         |(1)
          |IPaddr of A's Request Router                       |
          |&lt;--------------------------------------------------|
          |HTTP cdn.csp.com         |                         |
          |--------------------------------------------------&gt;|
          |                         |                         |(2)
          |                         |RRI REQ cdn.csp.com      |
          |                         |&lt;------------------------|
          |                         |                         |
          |                         |RRI RESP node1.op-b.net  |
          |                         |------------------------&gt;|
          |                         |                         |(3)
          |302 node1.op-b.net/cdn.csp.com                     |
          |&lt;--------------------------------------------------|
          |DNS mode1.op-b.net       |                         |
          |------------------------&gt;|                         |
          |                         |(4)                      |
          |IPaddr of B's Delivery Node                        |
          |&lt;------------------------|                         |
          |HTTP node1.op-b.net/cdn.csp.com                    |
          |------------------------&gt;|                         |
          |                         |(5)                      |
          |                         |DNS op-b-acq.op-a.net    |
          |                         |------------------------&gt;|
          |                         |                         |(6)
          |                         |IPaddr of A's Request Router
          |                         |&lt;------------------------|
          |                         |HTTP op-b-acq.op-a.net   |
          |                         |------------------------&gt;|
          |                         |                         |(7)
          |                         |302 node2.op-b.acq.op-A.net
          |                         |&lt;------------------------|
          |                         |DNS node2.op-b-acq.op-a.net
          |                         |------------------------&gt;|
          |                         |                         |(8)
          |                         |IPaddr of A's Delivery Node
          |                         |&lt;------------------------|
          |                         |                         |(9)
          |                         |Data                     |
          |                         |&lt;------------------------|
          |Data                     |                         |
          |&lt;------------------------|                         |
</pre>
<p id="rfc.section.3.3.p.8">The steps illustrated in the figure are as follows:</p>

<ol>
<li>A DNS resolver for Operator A processes the DNS request for its customer based on CDN-domain cdn.csp.com. It returns the IP address of a Request Router in Operator A.</li>
<li>A Request Router for Operator A processes the HTTP request and recognizes that the end-user is best served by another CDN&#8212;specifically one provided by Operator B&#8212;and so it queries the CDNI Request Routing interface of Operator B, providing a set of information about the request including the URL requested. Operator B replies with the DNS name of a delivery node.</li>
<li>Operator A returns a 302 redirect message for a new URL obtained from the Request Routing Interface.</li>
<li>The end-user does a DNS lookup using the host name of the URL just provided (node1.op-b.net). B&#8217;s DNS resolver returns the IP address of the corresponding delivery node. Note that, since the name of the delivery node was already obtained from B using the CDNI Request Routing Interface, there should not be any further redirection here (in contrast to the iterative method described above.)</li>
<li>The end-user requests the content from B&#8217;s delivery node, potentially resulting in a cache miss. In the case of a cache miss, the content needs to be acquired from uCDN (not the CSP.) The distinguished CDN-domain op-b.net indicates to dCDN that this content is to be acquired from another CDN; stripping the CDN-domain reveals the original CDN-domain cdn.csp.com, dCDN may verify that this CDN-domain belongs to a known peer (so as to avoid being tricked into serving as an open proxy). It then does a DNS request for the inter-CDN Acquisition &#8220;distinguished&#8221; CDN-domain as agreed above (in this case, op-b-acq.op-a.net).</li>
<li>Operator A DNS resolver processes the DNS request and returns the IP address of a request router in operator A.</li>
<li>The request router for Operator A processes the HTTP request from Operator B delivery node. Operator A request router recognizes that the request is from a peer CDN rather than an end-user because of the dedicated inter-CDN acquisition domain (op-b-acq.op-a.net). (Note that without this specially defined inter-CDN acquisition domain, operator A would be at risk of redirecting the request back to operator B, resulting in an infinite loop). The request router for Operator A selects a suitable delivery node in uCDN to serve the inter-CDN acquisition request and returns a 302 redirect message for a new URL constructed by replacing the hostname by a subdomain of the Operator A&#8217;s distinguished inter-CDN acquisition domain that points to the selected delivery node.</li>
<li>Operator A recognizes that the DNS request is from a peer CDN rather than an end-user (due to the internal CDN-domain) and so returns the address of a delivery node. (Note that without this specially defined internal domain, Operator A would be at risk of redirecting the request back to Operator B, resulting in an infinite loop.)</li>
<li>Operator A serves content for the requested CDN-domain to dCDN.  Although not shown, it is at this point that Operator A processes the rest of the URL: it extracts information identifying the origin server, validates that this server has been registered, and determines the content provider that owns the origin server. It may also perform its own content acquisition steps if needed before returning the content to dCDN.</li>
</ol>
<h1 id="rfc.section.3.3.1">
<a href="#rfc.section.3.3.1">3.3.1.</a> Comments on the example</h1>
<p id="rfc.section.3.3.1.p.1">Recursive redirection has the advantage over iterative of being more transparent from the end-user's perspective, but the disadvantage of each CDN exposing more of its internal structure (in particular, the addresses of edge caches) to peer CDNs. By contrast, iterative redirection does not require dCDN to expose the addresses of its edge caches to uCDN. </p>
<p id="rfc.section.3.3.1.p.2">This example happens to use HTTP-based redirection in both CDN A and CDN B, but a similar example could be constructed using DNS-based redirection in either CDN.  Hence, the key point to take away here is simply that the end user only sees a single redirection of some type, as opposed to the pair of redirections in the prior (iterative) example. </p>
<p id="rfc.section.3.3.1.p.3">The use of the Request Routing Interface requires that interface to be appropriately configured and bootstrapped, which is not shown here. More discussion on the bootstrapping of interfaces is provided in <a href="#interfaces">Section 4</a></p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#DNS-eg" id="DNS-eg">DNS-based redirection example</a>
</h1>
<p id="rfc.section.3.4.p.1">In this section we walk through a simple example using DNS-based redirection for request redirection from uCDN to dCDN (as well as for request routing inside dCDN and uCDN). As noted in <a href="#redirection">Section 2.1</a>, DNS-based redirection has certain advantages over HTTP-based redirection (notably, it is transparent to the end-user) as well as some drawbacks (notably the client IP address is not visible to the request router).</p>
<p id="rfc.section.3.4.p.2">As before, Operator A must learn the set of requests that dCDN is willing or able to serve (e.g. which client IP address prefixes or geographic regions are part of the dCDN footprint). Operator B must have and make known to operator A some unique identifier that can be used for the construction of a distinguished CDN domain, as shown in more detail below. (This identifier strictly needs only to be unique within the scope of Operator A, but a globally unique identifier, such as an AS number assigned to B, is one easy way to achieve that.) Also, Operator A must obtain the NS records for Operator B's externally visible redirection servers. Also, as before, a distinguished CDN-domain, such as op-b-acq.op-a.net, must be assigned for inter-CDN acquisition.</p>
<p id="rfc.section.3.4.p.3">DNS must be configured in the following way:</p>

<ul>
<li>The CSP must be configured to make Operator A the authoritative DNS server for cdn.csp.com (or to return a CNAME for cdn.csp.com for which operator A is the authoritative DNS server).</li>
<li>When uCDN sees a request best served by dCDN, it returns CNAME and NS records for "b.cdn.csp.com", where "b" is the unique identifier assigned to Operator B. (It may, for example, be an AS number assigned to Operator B.)</li>
<li>dCDN must be configured so that a request for "b.cdn.csp.com" returns a delivery node in dCDN.</li>
<li>uCDN must be configured so that a request for "op-b-acq.op-a.net" returns a delivery node in uCDN.</li>
</ul>
<p><a href="#simple-DNS">Figure 5</a> depicts the exchange of DNS and HTTP requests. The main differences from <a href="#simple-http">Figure 3</a> are the lack of HTTP redirection and transparency to the end-user.</p>
<div id="#rfc.figure.5"></div>
<div id="#simple-DNS"></div>
<pre>      End-User                 Operator B                Operator A
          |DNS cdn.csp.com          |                         |
          |--------------------------------------------------&gt;|
          |                         |                         |(1)
          |CNAME b.cdn.csp.com      |                         |
          |NS records for b.cdn.csp.com                       |
          |&lt;--------------------------------------------------|
          |DNS b.cdn.csp.com        |                         |
          |------------------------&gt;|                         |
          |                         |(2)                      |
          |IPaddr of B's Delivery Node                        |
          |&lt;------------------------|                         |
          |HTTP cdn.csp.com         |                         |
          |------------------------&gt;|                         |
          |                         |(3)                      |
          |                         |DNS op-b-acq.op-a.net    |
          |                         |------------------------&gt;|
          |                         |                         |(4)
          |                         |IPaddr of A's Delivery Node
          |                         |&lt;------------------------|
          |                         |HTTP op-b-acq.op-a.net   |
          |                         |------------------------&gt;|
          |                         |                         |(5)
          |                         |Data                     |
          |                         |&lt;------------------------|
          |Data                     |                         |
          |&lt;------------------------|                         |
</pre>
<p id="rfc.section.3.4.p.5">The steps illustrated in the figure are as follows:</p>

<ol>
<li>Request Router for Operator A processes the DNS request for CDN-domain cdn.csp.com and recognizes that the end-user is best served by another CDN. (This may depend on the IP address of the user's local DNS resolver, or other information discussed below.) The Request Router returns a DNS CNAME response by &#8220;stacking&#8221; the distinguished identifier for Operator B onto the original CDN-domain (e.g., b.cdn.csp.com), plus an NS record that maps b.cdn.csp.com to B&#8217;s Request Router.</li>
<li>The end-user does a DNS lookup using the modified CDN-domain (i.e., b.cdn.csp.com). This causes B&#8217;s Request Router to respond with a suitable delivery node.</li>
<li>The end-user requests the content from B&#8217;s delivery node.  The requested URL contains the name cdn.csp.com. (Note that the returned CNAME does not affect the URL.) At this point the delivery node has the correct IP address of the end-user and can do an HTTP 302 redirect if the redirections in steps 2 and 3 were incorrect. Otherwise B verifies that this CDN-domain belongs to a known peer (so as to avoid being tricked into serving as an open proxy). It then does a DNS request for an &#8220;internal&#8221; CDN-domain as agreed above (op-b-acq.op-a.net).</li>
<li>Operator A recognizes that the DNS request is from a peer CDN rather than an end-user (due to the internal CDN-domain) and so returns the address of a delivery node in uCDN.</li>
<li>Operator A serves content to dCDN. Although not shown, it is at this point that Operator A processes the rest of the URL: it extracts information identifying the origin server, validates that this server has been registered, and determines the content provider that owns the origin server.</li>
</ol>
<h1 id="rfc.section.3.4.1">
<a href="#rfc.section.3.4.1">3.4.1.</a> Comments on the example</h1>
<p id="rfc.section.3.4.1.p.1">The advantages of this approach are that it is more transparent to the end-user and requires fewer round trips than HTTP-based redirection.  A potential problem is that the upstream CDN depends on being able to learn the correct downstream CDN that serves the end-user from the client address in the DNS request. In standard DNS operation, uCDN will only obtain the address of the client's local DNS resolver (LDNS), which is not guaranteed to be in the same network (or geographic region) as the client. If not&#8212;e.g., the end-user uses a global DNS service&#8212;then the upstream CDN cannot determine the appropriate downstream CDN to serve the end-user. In this case, one option is for the upstream CDN to treat the end-user as it would any user not connected to a peer CDN. Another option is for the upstream CDN to &#8220;fall back&#8221; to a pure HTTP-based redirection strategy in this case (i.e., use the first method). Note that this problem affects existing CDNs that rely on DNS to determine where to redirect client requests, but the consequences are arguably less serious since the LDNS is likely in the same network as the dCDN serves. One approach to ensuring that the client's IP address prefix is correctly determined in such situations is described in <a href="#I-D.vandergaast-edns-client-subnet">[I-D.vandergaast-edns-client-subnet]</a>.</p>
<p id="rfc.section.3.4.1.p.2">As with the prior example, this example partially illustrates the various interfaces involved in CDNI. Operator A could learn dynamically from Operator B the set of prefixes or regions that B is willing and able to serve via the request routing interface. The distinguished name used for acquisition and the identifier for Operator B that is prepended to the CDN domain on redirection are examples of information elements that might also be conveyed by CDNI interfaces (or, alternatively, statically configured). As before, minimal metadata sufficient to obtain the content is carried "in-band" as part of the redirection process, and standard HTTP is used for inter-CDN acquisition. There is no explicit logging interface discussed in this example.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> Dynamic Footprint Discovery</h1>
<p id="rfc.section.3.5.p.1">There could be situations where being able to dynamically discover the set of requests that a given dCDN is willing and able to serve is beneficial. For example, a CDN might at one time be able to serve a certain set of client IP prefixes, but that set might change over time due to changes in the topology and routing policies of the IP network.  The following example illustrates this capability. We have chosen the example of DNS-based redirection, but HTTP-based redirection could equally well use this approach.</p>
<p></p>
<div id="#rfc.figure.6"></div>
<div id="#dynamic-footprint"></div>
<pre>      End-User                 Operator B                Operator A
          |DNS cdn.csp.com          |                         |
          |--------------------------------------------------&gt;|
          |                         |                         |(1)
          |                         | RRI REQ op-b.net        |
          |                         |&lt;------------------------|
          |                         |                         |(2)
          |                         | RRI REPLY               |
          |                         |------------------------&gt;|
          |                         |                         |(3)
          |CNAME b.cdn.csp.com      |                         |
          |NS records for b.cdn.csp.com                       |
          |&lt;--------------------------------------------------|
          |DNS b.cdn.csp.com        |                         |
          |------------------------&gt;|                         |
          |                         |(2)                      |
          |IPaddr of B's Delivery Node                        |
          |&lt;------------------------|                         |
          |HTTP cdn.csp.com         |                         |
          |------------------------&gt;|                         |
          |                         |(3)                      |
          |                         |DNS op-b-acq.op-a.net    |
          |                         |------------------------&gt;|
          |                         |                         |(4)
          |                         |IPaddr of A's Delivery Node
          |                         |&lt;------------------------|
          |                         |HTTP op-b-acq.op-a.net   |
          |                         |------------------------&gt;|
          |                         |                         |(5)
          |                         |Data                     |
          |                         |&lt;------------------------|
          |Data                     |                         |
          |&lt;------------------------|                         |
</pre>
<p id="rfc.section.3.5.p.3">This example differs from the one in <a href="#simple-DNS">Figure 5</a> only in the addition of a CDNI Request Routing Interface request (step 2) and corresponding response (step 3). The RRI Req could be a message such as "Can you serve clients from this IP Prefix?" or it could be "Provide the list of client IP prefixes you can currently serve". In either case the response might be cached by operator A to avoid repeatedly asking the same question.  Alternatively, or in addition, Operator B may spontaneously advertise to Operator A information (or changes) on the set of requests it is willing and able to serve on behalf of operator A; in that case, Operator B may spontaneously issue RRI REPLY messages that are not in direct response to a corresponding RRI REQ message. (Note that the issues of determining the client's subnet from DNS requests, as described above, are exactly the same here as in <a href="#DNS-eg">Section 3.4</a>.)</p>
<p id="rfc.section.3.5.p.4">Once Operator A obtains the RRI response, it is now able to determine that Operator B's CDN is an appropriate dCDN for this request and therefore a valid candidate dCDN to consider in its Redirection decision. If that dCDN is selected, the redirection and serving of the request proceeds as before (i.e. in the absence of dynamic footprint discovery).</p>
<h1 id="rfc.section.3.6">
<a href="#rfc.section.3.6">3.6.</a> Content Removal</h1>
<p id="rfc.section.3.6.p.1">The following example illustrates how the Metadata interface may be used to remove an item of content. In this example, user requests for a particular content, and corresponding redirection of such requests from Operator A to Operator B CDN, may (or may not) have taken place earlier. Then, at some point in time, the uCDN (for example, in response to a corresponding trigger from the Content Provider) uses the Metadata Interface to request that content identified by a particular URL be removed from dCDN. The following diagram illustrates the operation.</p>
<div id="#rfc.figure.7"></div>
<div id="#removal"></div>
<pre>      End-User                 Operator B                Operator A
          |                         |MI purge cdn.csp.com/... |
          |                         |&lt;------------------------|
          |                         |                         |(1)
          |                         |MI OK                    |
          |                         |------------------------&gt;|
          |                         |                         |(2)
     
</pre>
<p id="rfc.section.3.6.p.2">The metadata interface is used to convey the request from uCDN to dCDN that some previously acquired content should be deleted. The URL in the request specifies which content to remove. This example corresponds to a DNS-based redirection scenario such as <a href="#DNS-eg">Section 3.4</a>. If HTTP-based redirection had been used, the URL for removal would be of the form peer-a.op-b.net/cdn.csp.com/...</p>
<p id="rfc.section.3.6.p.3">The dCDN is expected to confirm to the uCDN, as illustrated by the MI OK message, the completion of the removal of the targeted content from all the caches in dCDN.</p>
<h1 id="rfc.section.3.7">
<a href="#rfc.section.3.7">3.7.</a> Pre-Positioned Content Acquisition Example</h1>
<p id="rfc.section.3.7.p.1">The following example illustrates how the metadata interface may be used to pre-position an item of content in the dCDN. In this example, Operator A uses the Metadata Interface to request that content identified by a particular URL be pre-positioned into Operator B CDN.</p>
<p></p>
<div id="#rfc.figure.8"></div>
<div id="#pre-positioning"></div>
<pre>      End-User                 Operator B                Operator A

          |                         |MI pre-position cdn.csp.com/...
          |                         |&lt;------------------------|
          |                         |                         |(1)
          |                         |MI OK                    |
          |                         |------------------------&gt;|
          |                         |                         |
          |                         |DNS op-b-acq.op-a.net    |
          |                         |------------------------&gt;|
          |                         |                         |(2)
          |                         |IPaddr of A's Delivery Node
          |                         |&lt;------------------------|
          |                         |HTTP op-b-acq.op-a.net   |
          |                         |------------------------&gt;|
          |                         |                         |(3)
          |                         |Data                     |
          |                         |&lt;------------------------|
          |DNS cdn.csp.com          |                         |
          |--------------------------------------------------&gt;|
          |                         |                         |(4)
          |IPaddr of A's Request Router                       |
          |&lt;--------------------------------------------------|
          |HTTP cdn.csp.com         |                         |
          |--------------------------------------------------&gt;|
          |                         |                         |(5)
          |302 peer-a.op-b.net/cdn.csp.com                    |
          |&lt;--------------------------------------------------|
          |DNS peer-a.op-b.net      |                         |
          |------------------------&gt;|                         |
          |                         |(6)                      |
          |IPaddr of B's Delivery Node                        |
          |&lt;------------------------|                         |
          |HTTP peer-a.op-b.net/cdn.csp.com                   |
          |------------------------&gt;|                         |
          |                         |(7)                      |
          |Data                     |                         |
          |&lt;------------------------|                         |
</pre>
<p id="rfc.section.3.7.p.3">The steps illustrated in the figure are as follows:<a href="#simple-http">Figure 3</a>, only this time those steps happen as the result of the Pre-positioning request instead of as the result of a cache miss.</p>

<ol><li>Operator A uses the Metadata Interface to request that Operator B pre-positions a particular content item identified by its URL. Operator B responds by confirming that it is willing to perform this operation.</li></ol>

<p>Steps 2 and 3 are exactly the same as steps 5 and 6 of </p>
<p id="rfc.section.3.7.p.4">Steps 4, 5, 6, 7 are exactly the same as steps 1, 2, 3, 4 of <a href="#simple-http">Figure 3</a>, only this time Operator B CDN can serve the end-user request without triggering dynamic content acquisition, since the content has been pre-positioned in dCDN. Note that, depending on dCDN operations and policies, the content pre-positioned in the dCDN may be pre-positioned to all, or a subset of, dCDN caches.  In the latter case, intra-CDN dynamic content acquisition may take place inside the dCDN serving requests from caches on which the content has not been pre-positioning; however, such intra-CDN dynamic acquisition would not involve the uCDN.</p>
<p></p>
<h1 id="rfc.section.3.8">
<a href="#rfc.section.3.8">3.8.</a> Asynchronous CDNI Metadata Example</h1>
<p id="rfc.section.3.8.p.1">In this section we walk through a simple example illustrating a scenario of asynchronously exchanging CDNI metadata, where the downstream CDN obtains CDNI metadata for content ahead of a corresponding content request. The example that follows assumes that HTTP-based inter-CDN redirection and recursive CDNI request-routing are used, as in <a href="#recurse">Section 3.3</a>. However, asynchronous exchange of CDNI Metadata is similarly applicable to DNS-based inter-CDN redirection and iterative request routing (in which cases the CDNI metadata may be used at slightly different processing stages of the message flows).</p>
<div id="#rfc.figure.9"></div>
<div id="#meta-pre-positioning"></div>
<pre>  
      End-User                 Operator B                Operator A
          |                         |                         |
          |                         |MI push (cdn.csp.com/...,|
          |                         |   distribution policy)  |
          |                         |&lt;------------------------|(1)
          |                         |                         |
          |                         |                         |
          | CONTENT REQUEST         |                         |
          |--------------------------------------------------&gt;| (2)
          |                         |                         |
          |                         |RRI REQ                  |
          |                      (3)|&lt;------------------------|
          |                         |                         |
          |                         |                         |
          |                         |RRI RESP                 |
          |                         |------------------------&gt;|(4)
          |                         |                         |
          | CONTENT REDIRECTION     |                         |
          |&lt;--------------------------------------------------| (5)
          |                         |                         |
          | CONTENT REQUEST         |                         |
          |------------------------&gt;| (6)                     |
          |                         |                         |
          :                         :                         :
          | CONTENT DATA            |                         |
          |&lt;------------------------|                         | (7)

</pre>
<p id="rfc.section.3.8.p.2">The steps illustrated in the figure are as follows:</p>

<ol>
<li>Operator A uses the Metadata Interface to asynchronously push CDNI metadata to Operator B.  The present document does not constrain how the CDNI metadata information is actually represented.  For the purposes of this example, we assume that Operator A provides CDNI metadata to Operator B indicating that: <ul>
<li>this CDNI Metadata is applicable to any content referenced by "cdn.csp.com/op-b.net/..." (assuming HTTP redirection is used - it would be applicable to "cdn.csp.com/..." if DNS redirection were used as in <a href="#DNS-eg">Section 3.4</a>).</li>
<li>this CDNI metadata consists of a distribution policy requiring enforcement by the delivery node of a specific per-request authorization mechanism (e.g. URI signature or token validation).</li>
</ul>
</li>
<li>A Content Request occurs as usual.</li>
<li>A CDNI Request Routing Request (RRI REQ) is issued by operator A CDN, as discussed in <a href="#recurse">Section 3.3</a>. Operator B's request router can access the CDNI Metadata that are relevant to the requested content and that have been pre-positioned as per Step 1, which may or may not affect the response.</li>
<li>Operator B's request router issues a CDNI Request Routing Response (RRI RESP) as in <a href="#recurse">Section 3.3</a>.</li>
<li>Operator B performs content redirection as discussed in <a href="#recurse">Section 3.3</a>.</li>
<li>On receipt of the Content Request by the end user, the delivery node detects that previously acquired CDNI metadata is applicable to the requested content. In accordance with the specific CDNI metadata of this example, the delivery node will invoke the appropriate per-request authorization mechanism, before serving the content. (Details of this authorization are not shown.)</li>
<li>Assuming successful per-request authorization, serving of Content Data (possibly preceded by inter-CDN acquisition) proceeds as in <a href="#recurse">Section 3.3</a>.</li>
</ol>
<h1 id="rfc.section.3.9">
<a href="#rfc.section.3.9">3.9.</a> Synchronous CDNI Metadata Acquisition Example</h1>
<p id="rfc.section.3.9.p.1">In this section we walk through a simple example illustrating a scenario of synchronous CDNI metadata acquisition, in which the downstream CDN obtains CDNI metadata for content at the time of handling a first request for the corresponding content. As in the preceding section, this example assumes that HTTP-based inter-CDN redirection and recursive CDNI request-routing are used (as in <a href="#recurse">Section 3.3</a>), but dynamic CDNI metadata acquisition is applicable to other variations of request routing.</p>
<div id="#rfc.figure.10"></div>
<div id="#meta-pull"></div>
<pre>  
    End-User                 Operator B                Operator A
          |                         |                         |
          |                         |MI push (cdn.csp.com/...,|
          |                         |   CDNI metadata acquisition info)
          |                         |&lt;------------------------|(1)
          |                         |                         |
          :                         :                         :
          | CONTENT REQUEST         |                         |
          |--------------------------------------------------&gt;|(2)
          |                         |                         |
          |                         |RRI REQ                  |
          |                      (3)|&lt;------------------------|
          |                         |                         |
          |                         |MI REQ                   |
          |                      (4)|------------------------&gt;|
          |                         |MI RESP                  |
          |                         |&lt;------------------------|(5)
          |                         |                         |
          |                         |RRI RESP                 |
          |                         |------------------------&gt;|(6)
          |                         |                         |
          |                         |                         |
          | CONTENT REDIRECTION     |                         |
          |&lt;--------------------------------------------------|(7)
          |                         |                         |
          | CONTENT REQUEST         |                         |
          |------------------------&gt;| (8)                     |
          |                         |                         |
          |                         |MI REQ                   |
          |                      (9)|------------------------&gt;|
          |                         |MI RESP                  |
          |                         |&lt;------------------------|(10)
          |                         |                         |
          :                         :                         :
          | CONTENT DATA            |                         |
          |&lt;------------------------|                         | (11)

</pre>
<p id="rfc.section.3.9.p.2">The steps illustrated in the figure are as follows:</p>
<p></p>

<ol>
<li>Operator A initially uses the Metadata Interface to asynchronously push seed metadata to Operator B. For example, this seed information may include a URI indicating where CDNI Metadata can later be pulled from for some content set. (There are alternative ways that this seeding information may be provided, such as piggybacking on the CDNI RRI REQ message of Step 3.)</li>
<li>A Content Request arrives as normal.</li>
<li>A Request Routing Interface request occurs as in the prior example.</li>
<li>On receipt of the CDNI Request Routing Request, Operator B's CDN initiates synchronous acquisition of CDNI Metadata that are needed for routing of the end-user request. The seeding information provided in Step 1 is used to determine how to obtain the metadata. Note that there may exist cases in which this step does not occur (e.g., because the CDNI metadata seeding information indicates CDNI metadata are not needed at that stage).</li>
<li>On receipt of a CDNI Metadata MI Request, Operator A's CDN responds, making the corresponding CDNI metadata information available to Operator B's CDN. This metadata is considered by operator B's CDN before responding to the Request Routing request.  (In a simple case, the metadata could simply be an allow or deny response for this particular request.)</li>
<li>Response to the RRI request as normal.</li>
<li>Redirection message is sent to the end user.</li>
<li>A delivery node of Operator B receives the end user request.</li>
<li>The delivery node triggers dynamic acquisition of additional CDNI metadata that are needed to process the end-user content request. Again the seeding information provided in Step 1 is used to determine how to acquire the needed CDNI metadata. Note that there may exist cases where this step need not happen, either because the metadata were already acquired previously, or because the seeding information indicates no metadata are required.</li>
<li>Operator A's CDN responds to the CDNI Metadata Request and makes the corresponding CDNI metadata available to Operator B.  This metadata influence how Operator B's CDN processes the end-user request.</li>
<li>Content is served (possibly preceded by inter-CDN acquisition) as in <a href="#recurse">Section 3.3</a>.</li>
</ol>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#interfaces" id="interfaces">Main Interfaces</a>
</h1>
<p><a href="#refmod">Figure 1</a> illustrates the four main interfaces that are in scope for the CDNI WG, along with several others. The detailed specifications of these interfaces are left to other documents (mostly still to be written, but see <a href="#I-D.ietf-cdni-problem-statement">[I-D.ietf-cdni-problem-statement]</a> and <a href="#I-D.ietf-cdni-requirements">[I-D.ietf-cdni-requirements]</a> for some discussion of the interfaces).</p>
<p id="rfc.section.4.p.2">One interface that is not shown in <a href="#refmod">Figure 1</a> is the interface between the user and the CSP. While for the purposes of CDNI that interface is out of scope, it is worth noting that it does exist and can provide useful functions, such as end-to-end performance monitoring and some forms of authentication and authorization.</p>
<p id="rfc.section.4.p.3">There is also an important interface between the user and the Request Routing function of both uCDN and dCDN. As we saw in some of the preceding examples, that interface can be used as a way of passing information such as the metadata that is required to obtain the content in dCDN from uCDN.</p>
<p id="rfc.section.4.p.4">In this section we will provide an overview of the functions performed by each of the CDNI interfaces and discuss how they fit into the overall solution. We also examine some of the design tradeoffs. We begin with an examination of one such tradeoff that affects all the interfaces - the use of in-band or out-of-band communication.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> In-Band versus Out-of-Band Interfaces</h1>
<p id="rfc.section.4.1.p.1">Before getting to the individual interfaces, we observe that there is a high-level design choice for each, involving the use of existing in-band communication channels versus defining new out-of-band interfaces.</p>
<p id="rfc.section.4.1.p.2">It is possible that the information needed to carry out various interconnection functions can be communicated between peer CDNs using existing in-band protocols. The use of HTTP 302 redirect is an example of how certain aspects of request routing can be implemented in-band (embedded in URIs). Note that using existing in-band protocols does not imply that the CDNI interfaces are null; it is still necessary to establish the rules (conventions) by which such protocols are used to implement the various interface functions.</p>
<p id="rfc.section.4.1.p.3">There are other opportunities for in-band communication beyond HTTP redirects. For example, many of the HTTP directives used by proxy servers can also be used by peer CDNs to inform each other of caching activity. Of these, one that is particularly relevant is the If-Modified-Since directive, which is used with the GET method to make it conditional: if the requested object has not been modified since the time specified in this field, a copy of the object will not be returned, and instead, a 304 (not modified) response will be returned.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Request Routing Interface</h1>
<p id="rfc.section.4.2.p.1">We may think of the request routing interface as comprising two parts: the asynchronous advertisement of footprint and capabilities by a dCDN that allows a uCDN to decide whether to redirect particular user requests to that dCDN; and the synchronous operation of actually redirecting a user request. (These are somewhat analogous to the operations of routing and forwarding in IP.)</p>
<p id="rfc.section.4.2.p.2">As illustrated in <a href="#operation">Section 3</a>, the synchronous part of the request routing interface may be implemented in part by DNS and HTTP. Naming conventions may be established by which CDN peers communicate whether a request should be routed or content served.</p>
<p id="rfc.section.4.2.p.3">In support of these exchanges, it is necessary for CDN peers to exchange additional information with each other. Depending on the method(s) supported, this includes </p>

<ul>
<li>The operator&#8217;s unique id (operator-id) or distinguished CDN-domain (operator-domain);</li>
<li>NS records for the operator&#8217;s set of externally visible request routers;</li>
<li>The set of requests the dCDN operator is prepared to serve (e.g. a set of client IP prefixes or geographic regions that may be served by dCDN).</li>
</ul>
<p id="rfc.section.4.2.p.4">Of these, the two operator identifiers are fixed, and can be exchanged off-line as part of a peering agreement. The NS records potentially change with some frequency, but an existing protocol&#8212;DNS&#8212;can be used to dynamically track this information. That is, a peer can do a DNS lookup on operator-domain to retrieve the set of NS records corresponding to the peer&#8217;s redirection service.</p>
<p id="rfc.section.4.2.p.5">The set of requests that dCDN is willing to serve could in some cases be relatively static (e.g., a set of IP prefixes) which could be exchanged off-line, or might even be negotiated as part of a peering agreement. However, it may also be more dynamic, in which case an explicit protocol for its exchange would be be helpful.</p>
<p id="rfc.section.4.2.p.6">A variety of options exist for the dCDN operator to advertise its footprint to uCDN. As discussed in <a href="#I-D.previdi-cdni-footprint-advertisement">[I-D.previdi-cdni-footprint-advertisement]</a>, footprint is comprised of two components: <a href="#I-D.previdi-cdni-footprint-advertisement">[I-D.previdi-cdni-footprint-advertisement]</a> describes an approach to advertising such footprint information asynchronously using BGP. In addition to this sort of information, a dCDN might also advertise "capabilities" such as the ability to handle certain types of content (e.g. specific streaming formats) or quality of service (QoS) capabilities. <a href="#I-D.xiaoyan-cdni-request-routing-protocol">[I-D.xiaoyan-cdni-request-routing-protocol]</a> describes an approach that exchanges CDN "capabilities" over HTTP, while <a href="#I-D.seedorf-alto-for-cdni">[I-D.seedorf-alto-for-cdni]</a> describes how ALTO <a href="#RFC5693">[RFC5693]</a> may be used to obtain request routing information.</p>

<ul>
<li>a class of end user requests (represented, for example, by a set of IP prefixes, or a geographic region) that the dCDN is willing and able to serve directly, without use of another dCDN;</li>
<li>the connectivity of the dCDN to other CDNs that may be able to serve content to users on behalf of dCDN.</li>
</ul>

<p> </p>
<p id="rfc.section.4.2.p.7">We also note that the Request Routing interface plays a key role in enabling recursive redirection, as illustrated in <a href="#recurse">Section 3.3</a>. It enables the user to be redirected to the correct delivery node in dCDN with only a single redirection step (as seen by the user). This may be particularly valuable as the chain of interconnected CDNs increases beyond two CDNs.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> Logging Interface</h1>
<p id="rfc.section.4.3.p.1">It is necessary for the upstream CDN to have visibility into the delivery of content it originates to end-users connected to the downstream CDN. This allows the upstream CDN to properly bill its customers for multiple deliveries of content cached by the downstream CDN, as well as to report accurate traffic statistics to those content providers. This is one role of the Logging interface.</p>
<p id="rfc.section.4.3.p.2">Other operational data that may be relevant to CDNI can also be exchanged by the Logging interface. For example, dCDN may report the amount of content it has acquired from uCDN, and how much cache storage has been consumed by content cached on behalf of uCDN.</p>
<p id="rfc.section.4.3.p.3">Traffic logs are easily exchanged off-line. For example, the following traffic log is a small deviation from the Apache log file format, where entries include the following fields: </p>

<ul>
<li>Domain &#8211; the full domain name of the origin server</li>
<li>IP address &#8211; the IP address of the client making the request</li>
<li>End time &#8211; the ending time of the transfer</li>
<li>Time zone &#8211; any time zone modifier for the end time</li>
<li>Method &#8211; the transfer command itself (e.g., GET, POST, HEAD)</li>
<li>URL &#8211; the requested URL</li>
<li>Version &#8211; the protocol version, such as HTTP/1.0</li>
<li>Response &#8211; a numeric response code indicating transfer result</li>
<li>Bytes Sent &#8211; the number of bytes in the body sent to the client</li>
<li>Request ID &#8211; a unique identifier for this transfer</li>
<li>User agent &#8211; the user agent, if supplied</li>
<li>Duration &#8211; the duration of the transfer in milliseconds</li>
<li>Cached Bytes &#8211; the number of body bytes served from the cache</li>
<li>Referrer &#8211; the referrer string from the client, if supplied</li>
</ul>
<p id="rfc.section.4.3.p.4">Of these, only the Domain field is indirect in the downstream CDN&#8212;it is set to the CDN-domain used by the upstream CDN rather than the actual origin server. This field could then used to filter traffic log entries so only those entries matching the upstream CDN are reported to the corresponding operator.</p>
<p id="rfc.section.4.3.p.5">One open question is who does the filtering. One option is that the downstream CDN filters its own logs, and passes the relevant records directly to each upstream peer. This requires that the downstream CDN knows the set of CDN-domains that belong to each upstream peer. If this information is already exchanged between peers as part of the request routing interface, then direct peer-to-peer reporting is straightforward. If it is not available, and operators do not wish to advertise the set of CDN-domains they serve to their peers, then the second option is for each CDN to send both its non-local traffic records and the set of CDN-domains it serves to an independent third-party (i.e., a CDN Exchange), which subsequently filters, merges, and distributes traffic records on behalf of each participating CDN operator.</p>
<p id="rfc.section.4.3.p.6">A second open question is how timely traffic information should be.  For example, in addition to off-line traffic logs, accurate real-time traffic monitoring might also be useful, but such information requires that the downstream CDN inform the upstream CDN each time it serves upstream content from its cache. The downstream CDN can do this, for example, by sending a conditional HTTP GET request (If-Modified-Since) to the upstream CDN each time it receives an HTTP GET request from one of its end-users. This allows the upstream CDN to record that a request has been issued for the purpose of real-time traffic monitoring. The upstream CDN can also use this information to validate the traffic logs received later from the downstream CDN.</p>
<p id="rfc.section.4.3.p.7">There is obviously a tradeoff between accuracy of such monitoring and the overhead of the downstream CDN having to go back to the upstream CDN for every request.</p>
<p id="rfc.section.4.3.p.8">Another design tradeoff in the Logging interface is the degree of aggregation or summarization of data. One situation that lends itself to summarization is the delivery of HTTP-based adaptive bit-rate video. Most schemes to deliver such video use a large number of relatively small HTTP requests (e.g. one request per 2-second chunk of video.) It may be desirable to aggregate logging information so that a single log entry is provided for the entire video rather than for each chunk. Note however that such aggregation requires a degree of application awareness in dCDN to recognize that the many HTTP requests correspond to a single video.</p>
<p id="rfc.section.4.3.p.9">Other forms of aggregation may also be useful. For example, there may be situations where bulk metrics such as bytes delivered per hour may suffice rather than the detailed per-request logs outlined above.  It seems likely that a range of granularities of logging will be needed along with ways to specify the type and degree of aggregation required.</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> Control Interface</h1>
<p id="rfc.section.4.4.p.1">The control interface is primarily used for the bootstrapping of other interfaces. As a simple example, it could be used to provide the address of the logging server in dCDN to uCDN in order to bootstrap the logging interface. It may also be used, for example, to establish security associations for the other interfaces. We discuss the relationship between the Control and Metadata interfaces in the next section. </p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> Metadata Interface</h1>
<p id="rfc.section.4.5.p.1">The role of the metadata interface is to enable CDNI distribution metadata to be conveyed to the downstream CDN by the upstream CDN.  Such metadata includes geo-blocking restrictions, availability windows, access control policies, and so on. It may also include policy information such as the desire to pre-position content rather than fetch it on demand.</p>
<p id="rfc.section.4.5.p.2">Some metadata may be able to be conveyed using in-band mechanisms.  For example, to inform the downstream CDN of any geo-blocking restrictions or availability windows, the upstream can elect to redirect a request to the downstream CDN only if that CDN's advertised delivery footprint is acceptable for the requested URL. Similarly, the request could be forwarded only if the current time is within the availability window.</p>
<p id="rfc.section.4.5.p.3">Similarly, some forms of access control may also be performed on a per-request basis using HTTP directives. For example, being able to respond to a conditional GET request gives the upstream CDN an opportunity to influence how the downstream CDN delivers its content.  Minimally, the upstream CDN can invalidate (purge) content previously cached by the downstream CDN.</p>
<p id="rfc.section.4.5.p.4">Fine-grain control over how the downstream CDN delivers content on behalf of the upstream CDN is also possible. For example, by including the X-Forwarded-For HTTP header with the conditional GET request, the downstream CDN can report the end-user&#8217;s IP address to the upstream CDN, giving it an opportunity to control whether the downstream CDN should serve the content to this particular end-user.  The upstream CDN would communicate its directive through its response to the conditional GET. The downstream CDN can cache information for a period of time specified by the upstream CDN, thereby reducing control overhead.</p>
<p id="rfc.section.4.5.p.5">Thinking beyond what metadata operations can be done in-line, we note that all CDNs already export a &#8220;content purge&#8220; operation to their customers. The CDNI metadata interface could support a similar "content purge" API call. When a CSP invokes purge on the upstream CDN, that CDN in turn invokes purge on all downstream CDNs that might be caching the content. Of course, agreement as to the syntax and semantics of this call is required.</p>
<p id="rfc.section.4.5.p.6">One open question is how to distinguish between what functionality is supported by the Metadata interface and what functionality is supported by the Control interface. The approach taken in this document is to assume a minimal Control interface that is used to bootstrap the other interfaces. We assume all information that governs peer CDN behavior at the granularity of individual content items is exchanged via the Metadata interface. We note that some other documents have suggested that the purge operation should be part of the Control Interface. The authors' view is that purging a piece of content is just another form of metadata, similar to an availability window. In effect, a purge is equivalent to a statement that the availability window for that content has now expired. The timeliness requirements for purge operations may affect the detailed design of the metadata interface.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#deploy" id="deploy">Deployment Models</a>
</h1>
<p id="rfc.section.5.p.1">In this section we describe a number of possible deployment models that may be achieved using the CDNI interfaces described above. We note that these models are by no means exhaustive, and that may other models may be possible.  </p>
<p id="rfc.section.5.p.2">Although the reference model of <a href="#refmod">Figure 1</a> shows all CDN functions on each side of the CDNI interface, deployments can rely on entities that are involved in any subset of these functions, and therefore only support the relevant subset of CDNI interfaces. As already noted in <a href="#operation">Section 3</a>, effective CDNI deployments can be built without necessarily implementing all four interfaces. Some examples of such deployments  are shown below.</p>
<p id="rfc.section.5.p.3">Note that, while we refer to upstream and downstream CDNs, this distinction applies to specific content items and transactions. That is, a given CDN may be upstream for some transactions and downstream for others, depending on many factors such as location of the requesting client and the particular piece of content requested.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Meshed CDNs</h1>
<p id="rfc.section.5.1.p.1">Although the reference model illustrated in <a href="#refmod">Figure 1</a> shows a unidirectional CDN interconnection with a single uCDN and a single dCDN, any arbitrary CDNI meshing can be built from this, such as the example meshing illustrated in <a href="#depmodmesh">Figure 11</a>. (Support for arbitrary meshing may or may not be in the initial scope for the working group, but the model allows for it.)</p>
<div id="#rfc.figure.11"></div>
<div id="#depmodmesh"></div>
<pre>
      -------------             -----------
     /    CDN A    \&lt;==CDNI===&gt;/   CDN B   \
     \             /           \           /
      -------------             -----------  
           /\      \\                 /\
           ||       \\                ||
          CDNI       \==CDNI===\\    CDNI
           ||                   \\    ||
           \/                   \/    \/
      -------------             -----------
     /    CDN C    \===CDNI===&gt;/   CDN D   \
     \             /           \           /
      -------------             -----------  
           /\
           ||
          CDNI
           ||
           \/
      -------------
     /    CDN E    \
     \             /
      ------------- 

   ===&gt;  CDNI interfaces, with right-hand side CDN acting as dCDN
         to left-hand side CDN
   &lt;==&gt;  CDNI interfaces, with right-hand side CDN acting as dCDN
         to left-hand side CDN and with left-hand side CDN acting
         as dCDN to right-hand side CDN
</pre>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> CSP combined with CDN</h1>
<p id="rfc.section.5.2.p.1">Note that our terminology refers to functional roles and not economic or business roles. That is, a given organization may be operating as both a CSP and a fully-fledged uCDN when we consider the functions performed, as illustrated in <a href="#depmodcombined">Figure 12</a>.</p>
<div id="#rfc.figure.12"></div>
<div id="#depmodcombined"></div>
<pre>#####################################       ##################
#                                   #       #                #
#       Organization A              #       # Organization B #
#                                   #       #                #
#     --------       -------------  #       #  -----------   #
#    /   CSP  \     /   uCDN      \ #       # /   dCDN    \  #
#    |        |     |  +----+     | #       # |  +----+   |  #
#    |        |     |  | C  |     | #       # |  | C  |   |  #
#    |        |     |  +----+     | #       # |  +----+   |  #
#    |        |     |  +----+     | #       # |  +----+   |  #
#    |        |     |  | L  |     | #       # |  | L  |   |  #
#    |        |*****|  +----+     |===CDNI===&gt;|  +----+   |  #
#    |        |     |  +----+     | #       # |  +----+   |  #
#    |        |     |  | RR |     | #       # |  | RR |   |  #
#    |        |     |  +----+     | #       # |  +----+   |  #
#    |        |     |  +----+     | #       # |  +----+   |  #
#    |        |     |  | D  |     | #       # |  | D  |   |  #
#    |        |     |  +----+     | #       # |  +----+   |  #
#    \        /     \             / #       # \           /  #
#     --------       -------------  #       #  -----------   #
#                                   #       #                #
#####################################       ##################

===&gt;  CDNI interfaces, with right-hand side CDN acting as dCDN
      to left-hand side CDN
****  interfaces outside the scope of CDNI
C     Control component of the CDN
L     Logging component of the CDN
RR    Request Routing component of the CDN
D     Distribution component of the CDN
</pre>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> <a href="#csp-rri" id="csp-rri">CSP using CDNI Request Routing Interface</a>
</h1>
<p id="rfc.section.5.3.p.1">As another example, a content provider organization may choose to run its own request routing function as a way to select among multiple candidate CDN providers; In this case the content provider may be modeled as the combination of a CSP and of a special, restricted case of a CDN. In that case, as illustrated in <a href="#depmodsplit">Figure 13</a>, the CDNI Request Routing interface can be used between the restricted CDN operated by the content provider Organization and the CDN operated by the full-CDN organization acting as a dCDN in the request routing control plane. Interfaces outside the scope of the CDNI work can be used between the CSP functional entities of the content provider organization and the CDN operated by the full-CDN organization acting as a uCDN) in the CDNI control planes other than the request routing plane (i.e. Control, Distribution, Logging).</p>
<p></p>
<div id="#rfc.figure.13"></div>
<div id="#depmodsplit"></div>
<pre>#####################################       ##################
#                                   #       #                #
#       Organization A              #       # Organization B #
#                                   #       #                #
#     --------       -------------  #       #  -----------   #
#    /   CSP  \     /  uCDN(RR)   \ #       # /  dCDN(RR) \  #
#    |        |     |  +----+     | #       # |  +----+   |  #
#    |        |*****|  | RR |==========CDNI=====&gt;| RR |   |  #
#    |        |     |  +----+     | #   RR  # |  +----+   |  #
#    |        |     \             / #       # |           |  #
#    |        |      -------------  #       # |uCDN(C,L,D)|  #
#    |        |                     #       # |  +----+   |  #
#    |        |                     #       # |  | C  |   |  #
#    |        |*******************************|  +----+   |  #
#    |        |                     #       # |  +----+   |  #
#    |        |                     #       # |  | L  |   |  #
#    |        |                     #       # |  +----+   |  #
#    |        |                     #       # |  +----+   |  #
#    |        |                     #       # |  | D  |   |  #
#    |        |                     #       # |  +----+   |  #
#    \        /                     #       # \           /  #
#     --------                      #       #  -----------   #
#                                   #       #                #
#####################################       ##################

===&gt;  CDNI Request Routing interface
****  interfaces outside the scope of CDNI
</pre>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> CDN Federations and CDN Exchanges</h1>
<p id="rfc.section.5.4.p.1">There are two additional concepts related to, but distinct from CDN Interconnection. The first is CDN Federation. Our view is that CDNI is the more general concept, involving two or more CDNs serving content to each other&#8217;s users, while federation implies a multi-lateral interconnection arrangement, but other CDN interconnection agreements are also possible (e.g., symmetric bilateral, asymmetric bilateral). An important conclusion is that CDNI technology should not presume (or bake in) a particular interconnection agreement, but should instead be general enough to permit alternative interconnection arrangements to evolve.</p>
<p id="rfc.section.5.4.p.2">The second concept often used in the context of CDN Federation is CDN Exchange&#8212;a third party broker or exchange that is used to facilitate a CDN federation. Our view is that a CDN exchange offers valuable machinery to scale the number of CDN operators involved in a multi-lateral (federated) agreement, but that this machinery is built on top of the core CDNI interconnection mechanisms. For example, as illustrated in <a href="#depmodexchange">Figure 14</a>, the exchange might aggregate and redistribute information about each CDN footprint and capacity, as well as collect, filter, and re-distribute traffic logs that each participant needs for interconnection settlement, but inter-CDN request routing, inter-CDN content distribution (including inter-CDN acquisition) and inter-CDN control which fundamentally involve a direct interaction between an upstream CDN and a downstream CDN&#8212;operate exactly as in a pair-wise peering arrangement. Turning to <a href="#depmodexchange">Figure 14</a>, we observe that in this example:</p>
<p></p>

<ul>
<li>each CDN supports a direct CDNI Control interface to every other CDN</li>
<li>each CDN supports a direct CDNI Metadata interface to every other CDN</li>
<li>each CDN supports a CDNI Logging interface with the CDN Exchange</li>
<li>each CDN supports both a CDNI request Routing interface with the CDN Exchange (for aggregation and redistribution of dynamic CDN footprint discovery information) and a direct CDNI Request Routing interface to every other CDN (for actual request redirection).</li>
</ul>
<div id="#rfc.figure.14"></div>
<div id="#depmodexchange"></div>
<pre>
          ----------                            ---------
         /    CDN A \                          /   CDN B  \
         | +----+   |                         |  +----+   |
//========&gt;| C  |&lt;==============CDNI============&gt;| C  |&lt;==========\\
||       | +----+   |            C            |  +----+   |       ||
||       | +----+   |                         |  +----+   |       ||
|| //=====&gt;| D  |&lt;==============CDNI============&gt;| D  |&lt;=======\\ ||
|| ||    | +----+   |            M            |  +----+   |    || ||
|| ||    |          |     /------------\      |           |    || ||
|| ||    | +----+   |     | +--+ CDN Ex|      |  +----+   |    || ||
|| || //==&gt;| RR |&lt;===CDNI==&gt;|RR|&lt;=======CDNI====&gt;| RR |&lt;====\\ || ||
|| || || | +----+   | RR  | +--+       | RR   |  +----+   | || || ||
|| || || |          |     |  /\        |      |           | || || ||
|| || || | +----+   |     |  ||  +---+ |      |  +----+   | || || ||
|| || || | | L  |&lt;===CDNI=======&gt;| L |&lt;=CDNI====&gt;| L  |   | || || ||
|| || || | +----+   |  L  |  ||  +---+ |  L   |  +----+   | || || ||
|| || || \          /     \  ||    /\  /      \           / || || ||
|| || || -----------       --||----||--        -----------  || || ||
|| || ||                     ||    ||                       || || ||
|| || ||                  CDNI RR  ||                       || || ||
|| || ||                     ||   CDNI L                    || || ||
|| || ||                     ||    ||                       || || ||
|| || ||                  ---||----||----                   || || ||
|| || ||                 /   \/    ||    \                  || || ||
|| || ||                 |  +----+ ||    |                  || || ||
|| || \\=====CDNI==========&gt;| RR |&lt;=============CDNI========// || ||
|| ||         RR         |  +----+ \/    |       RR            || ||
|| ||                    |        +----+ |                     || ||
|| ||                    |        | L  | |                     || ||
|| ||                    |        +----+ |                     || ||
|| ||                    |  +----+       |                     || ||
|| \\=======CDNI===========&gt;| D  |&lt;=============CDNI===========// ||
||           M           |  +----+       |       M                ||
||                       |  +----+       |                        ||
\\==========CDNI===========&gt;| C  |&lt;=============CDNI==============//
             C           |  +----+       |       C
                         \        CDN C  /
                          --------------

&lt;=CDNI RR=&gt;     CDNI Request Routing interface
&lt;=CDNI M==&gt;     CDNI Metadata interface
&lt;=CDNI C==&gt;     CDNI Control interface
&lt;=CDNI L==&gt;     CDNI Logging interface
</pre>
<p id="rfc.section.5.4.p.4">Note that a CDN exchange may alternatively support a different set of functionality (e.g. Logging only, or Logging and full request routing, or all the functionality of a CDN including content distribution). All these options are expected to be allowed by the IETF CDNI specifications.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#trust" id="trust">Trust Model</a>
</h1>
<p id="rfc.section.6.p.1">There are a number of trust issues that need to be addressed by a CDNI solution. Many of them are in fact similar or identical to those in a simple CDN without interconnection. In a standard CDN environment (without CDNI), the CSP places a degree of trust in a single CDN operator to perform many functions. The CDN is trusted to deliver content with appropriate quality of experience for the end user. The CSP trusts the CDN operator not to corrupt or modify the content. The CSP often relies on the CDN operator to provide reliable accounting information regarding the volume of delivered content. The CSP may also trust the CDN operator to perform actions such as timely invalidation of content and restriction of access to content based on certain criteria such as location of the user and time of day, and to enforce per-request authorization performed by the CSP using techniques such as URI signing.</p>
<p id="rfc.section.6.p.2">A CSP also places trust in the CDN not to distribute any information that is confidential to the CSP (e.g., how popular a given piece of content is) or confidential to the end user (e.g., which content has been watched by which user).</p>
<p id="rfc.section.6.p.3">A CSP does not necessarily have to place complete trust in a CDN. A CSP will in some cases take steps to protect its content from improper distribution by a CDN, e.g. by encrypting it and distributing keys in some out of band way. A CSP also depends on monitoring (possibly by third parties) and reporting to verify that the CDN has performed adequately. A CSP may use techniques such as client-based metering to verify that accounting information provided by the CDN is reliable. HTTP conditional requests may be used to provide the CSP with some checks on CDN operation. In other words, while a CSP may trust a CDN to perform some functions in the short term, the CSP is able in most cases to verify whether these actions have been performed correctly and to take action (such as moving the content to a different CDN) if the CDN does not live up to expectations.</p>
<p id="rfc.section.6.p.4">The main trust issue raised by CDNI is that it introduces transitive trust. A CDN that has a direct relationship with a CSP can now "outsource" the delivery of content to another (downstream) CDN. That CDN may in term outsource delivery to yet another downstream CDN, and so on.</p>
<p id="rfc.section.6.p.5">The top level CDN in such a chain of delegation is responsible for ensuring that the requirements of the CSP are met. Failure to do so is presumably just as serious as in the traditional single CDN case. Hence, an upstream CDN is essentially trusting a downstream CDN to perform functions on its behalf in just the same way as a CSP trusts a single CDN. Monitoring and reporting can similarly be used to verify that the downstream CDN has performed appropriately. However, the introduction of multiple CDNs in the path between CSP and end user complicates the picture. For example, third party monitoring of CDN performance (or other aspects of operation, such as timely invalidation) might be able to identify the fact that a problem occurred somewhere in the chain but not point to the particular CDN at fault.</p>
<p id="rfc.section.6.p.6">In summary, we assume that an upstream CDN will invest a certain amount of trust in a downstream CDN, but that it will verify that the downstream CDN is performing correctly, and take corrective action (including potentially breaking off its relationship with that CDN) if behavior is not correct. We do not expect that the trust relationship between a CSP and its "top level" CDN will differ significantly from that found today in single CDN situations. However, it does appear that more sophisticated tools and techniques for monitoring CDN performance and behavior will be required to enable the identification of the CDN at fault in a particular delivery chain.</p>
<p id="rfc.section.6.p.7">We expect that the detailed designs for the specific interfaces for CDNI will need to take the transitive trust issues into account. For example, explicit confirmation that some action (such as content removal) has taken place in a downstream CDN may help to mitigate some issues of transitive trust.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.7.p.1">This memo includes no request to IANA.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.8.p.1">While there is a variety of security issues introduced by a single CDN, we are concerned here specifically with the additional issues that arise when CDNs are interconnected. For example, when a single CDN has the ability to distribute content on behalf of a CSP, there may be concerns that such content could be distributed to parties who are not authorized to receive it, and there are mechanisms to deal with such concerns. Our focus in this section is on how CDN interconnection introduces new security issues not found in the single CDN case.</p>
<p id="rfc.section.8.p.2">Many of the security issues that arise in CDNI are related to the transitivity of trust (or lack thereof) described in <a href="#trust">Section 6</a>. As noted above, the design of the various interfaces for CDNI must take account of the additional risks posed by the fact that a CDN with whom a CSP has no direct relationship is now potentially distributing content for that CSP. The mechanisms used to mitigate these risks may be similar to those used in the single CDN case, but their suitability in this more complex environment must be validated.</p>
<p id="rfc.section.8.p.3">Another concern that arises in any CDN is that information about the behavior of users (what content they access, how much content they consume, etc.) may be gathered by the CDN. This risk certainly exists in inter-connected CDNs, but it should be possible to apply the same techniques to mitigate it as in the single CDN case.</p>
<p id="rfc.section.8.p.4">CDNs today offer a variety of means to control access to content, such as time-of-day restrictions, geo-blocking, and URI signing. These mechanisms must continue to function in CDNI environments, and this consideration is likely to affect the design of certain CDNI interfaces (e.g. metadata, request routing.)</p>
<p id="rfc.section.8.p.5">Just as with a single CDN, each peer CDN must ensure that it is not used as an "open proxy" to deliver content on behalf of a malicious CSP.  Whereas a single CDN typically addresses this problem by having CSPs explicitly register content (or origin servers) that is to be served, simply propagating this information to peer downstream CDNs may be problematic because it reveals more information than the upstream CDN is willing to specify. (To this end, the content acquisition step in the earlier examples force the dCDN to retrieve content from the uCDN rather than go directly to the origin server.)</p>
<p id="rfc.section.8.p.6">There are several approaches to this problem. One is for the uCDN to encoded a signed token generated from a shared secret in each URL routed to a dCDN, and for the dCDN to validate the request based on this token.  Another one is to have each upstream CDN advertise the set of CDN-domains they serve, where the downstream CDN checks each request against this set before caching and delivering the associated object.  Although straightforward, this approach requires operators to reveal additional information, which may or may not be an issue.</p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> Security of CDNI Interfaces</h1>
<p id="rfc.section.8.1.p.1">It is noted in <a href="#I-D.ietf-cdni-requirements">[I-D.ietf-cdni-requirements]</a> that all CDNI interfaces must be able to operate securely over insecure IP networks. Since it is expected that the CDNI interfaces will be implemented using existing application protocols such as HTTP or XMPP, we also expect that the security mechanisms available to those protocols may be used by the CDNI interfaces. Details of how these interfaces are secured will be specified in the relevant interface documents.</p>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> Digital Rights Management</h1>
<p id="rfc.section.8.2.p.1">Issues of digital rights management (DRM, also sometimes called digital restrictions management) is often employed for content distributed via CDNs. In general, DRM relies on the CDN to distribute encrypted content, with decryption keys distributed to users by some other means (e.g. directly from the CSP to the end user.) For this reason, DRM is considered out of scope for the CDNI WG <a href="#I-D.ietf-cdni-problem-statement">[I-D.ietf-cdni-problem-statement]</a> and does not introduce additional security issues for CDNI.  </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Contributors</h1>
<p id="rfc.section.9.p.1">The following individuals contributed to this document:</p>
<p></p>

<ul>
<li>Francois le Faucheur</li>
<li>Ben Niven-Jenkins</li>
<li>David Ferguson</li>
<li>John Hartman</li>
</ul>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Acknowledgements</h1>
<p id="rfc.section.10.p.1">We thank Aaron Falk and Huw Jones for their helpful input to the draft.</p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC3466">[RFC3466]</b></td>
<td class="top">
<a>Day, M.</a>, <a>Cain, B.</a>, <a>Tomlinson, G.</a> and <a>P. Rzewski</a>, "<a href="http://tools.ietf.org/html/rfc3466">A Model for Content Internetworking (CDI)</a>", RFC 3466, February 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5693">[RFC5693]</b></td>
<td class="top">
<a>Seedorf, J.</a> and <a>E. Burger</a>, "<a href="http://tools.ietf.org/html/rfc5693">Application-Layer Traffic Optimization (ALTO) Problem Statement</a>", RFC 5693, October 2009.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-cdni-problem-statement">[I-D.ietf-cdni-problem-statement]</b></td>
<td class="top">
<a>Niven-Jenkins, B</a>, <a>Faucheur, F</a> and <a>N Bitar</a>, "<a href="http://tools.ietf.org/html/draft-ietf-cdni-problem-statement-01">Content Distribution Network Interconnection (CDNI) Problem Statement</a>", Internet-Draft draft-ietf-cdni-problem-statement-01, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-cdni-use-cases">[I-D.ietf-cdni-use-cases]</b></td>
<td class="top">
<a>Bertrand, G</a>, <a>Emile, S</a>, <a>Watson, G</a>, <a>Burbridge, T</a>, <a>Eardley, P</a> and <a>K Ma</a>, "<a href="http://tools.ietf.org/html/draft-ietf-cdni-use-cases-00">Use Cases for Content Delivery Network Interconnection</a>", Internet-Draft draft-ietf-cdni-use-cases-00, September 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.vandergaast-edns-client-subnet">[I-D.vandergaast-edns-client-subnet]</b></td>
<td class="top">
<a>Contavalli, C</a>, <a>Gaast, W</a>, <a>Leach, S</a> and <a>D Rodden</a>, "<a href="http://tools.ietf.org/html/draft-vandergaast-edns-client-subnet-00">Client subnet in DNS requests</a>", Internet-Draft draft-vandergaast-edns-client-subnet-00, January 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-cdni-requirements">[I-D.ietf-cdni-requirements]</b></td>
<td class="top">
<a>Leung, K</a> and <a>Y Lee</a>, "<a href="http://tools.ietf.org/html/draft-ietf-cdni-requirements-01">Content Distribution Network Interconnection (CDNI) Requirements</a>", Internet-Draft draft-ietf-cdni-requirements-01, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.previdi-cdni-footprint-advertisement">[I-D.previdi-cdni-footprint-advertisement]</b></td>
<td class="top">
<a>Previdi, S</a>, <a>Faucheur, F</a>, <a>Faucheur, L</a> and <a>J Medved</a>, "<a href="http://tools.ietf.org/html/draft-previdi-cdni-footprint-advertisement-00">CDNI Footprint Advertisement</a>", Internet-Draft draft-previdi-cdni-footprint-advertisement-00, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.xiaoyan-cdni-request-routing-protocol">[I-D.xiaoyan-cdni-request-routing-protocol]</b></td>
<td class="top">
<a>He, X</a>, <a>Li, J</a>, <a>Dawkins, S</a> and <a>G Chen</a>, "<a href="http://tools.ietf.org/html/draft-xiaoyan-cdni-request-routing-protocol-00">Request Routing Protocol for CDN Interconnection</a>", Internet-Draft draft-xiaoyan-cdni-request-routing-protocol-00, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.seedorf-alto-for-cdni">[I-D.seedorf-alto-for-cdni]</b></td>
<td class="top">
<a>Seedorf, J</a>, "<a href="http://tools.ietf.org/html/draft-seedorf-alto-for-cdni-00">ALTO for CDNi Request Routing</a>", Internet-Draft draft-seedorf-alto-for-cdni-00, October 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Bruce Davie</span> editor
	  <span class="n hidden">
		<span class="family-name">Davie</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems, Inc.</span>
	<span class="adr">
	  <span>1414 Mass. Ave.</span>

	  <span class="vcardline">
		<span class="locality">Boxborough</span>,  
		<span class="region">MA</span> 
		<span class="code">01719</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:bsd@cisco.com">bsd@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Larry Peterson</span> editor
	  <span class="n hidden">
		<span class="family-name">Peterson</span>
	  </span>
	</span>
	<span class="org vcardline">Verivue, Inc.</span>
	<span class="adr">
	  <span>2 Research Way</span>

	  <span class="vcardline">
		<span class="locality">Princeton</span>,  
		<span class="region">NJ</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 978 303 8032</span>

<span class="vcardline">EMail: <a href="mailto:lpeterson@verivue.com">lpeterson@verivue.com</a></span>

  </address>
</div>

</body>
</html>