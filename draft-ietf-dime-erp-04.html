<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Diameter Support for the EAP Re-authentication Protocol (ERP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Diameter Support for the EAP Re-authentication Protocol (ERP)">
<meta name="keywords" content="Internet-Draft, EAP, Diameter, Re-authentication, AAA, inter-authenticator roaming">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">J. Bournelle</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">L. Morand</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Orange Labs</td></tr>
<tr><td class="header">Expires: March 10, 2011</td><td class="header">S. Decugis, Ed.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">NICT</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Q. Wu</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Huawei</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">G. Zorn, Ed.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Network Zen</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">September 6, 2010</td></tr>
</table></td></tr></table>
<h1><br />Diameter Support for the EAP Re-authentication Protocol (ERP)<br />draft-ietf-dime-erp-04.txt</h1>

<h3>Abstract</h3>

<p>
				The EAP Re-authentication Protocol (ERP) defines extensions to the
				Extensible Authentication Protocol (EAP) to support efficient
				re-authentication between the peer and an EAP Re-authentication (ER)
				server through a compatible authenticator. This document specifies
				Diameter support for ERP. It defines a new Diameter ERP application to
				transport ERP messages between an ER authenticator and the ER server, and a set
				of new AVPs that can be used to transport the cryptographic material
				needed by the re-authentication server.
			
</p>
<h3>Status of This Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on March 10, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#Introduction">1.</a>&nbsp;
Introduction<br />
<a href="#anchor1">2.</a>&nbsp;
Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">2.1.</a>&nbsp;
Requirements Language<br />
<a href="#anchor3">3.</a>&nbsp;
Assumptions<br />
<a href="#Overview">4.</a>&nbsp;
Protocol Overview<br />
<a href="#Bootstrapping">5.</a>&nbsp;
Bootstrapping the ER Server<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">5.1.</a>&nbsp;
Bootstrapping During the Initial EAP authentication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">5.2.</a>&nbsp;
Bootstrapping During the First Re-authentication<br />
<a href="#Re-authentication">6.</a>&nbsp;
Re-Authentication<br />
<a href="#ApplicationId">7.</a>&nbsp;
Application Id<br />
<a href="#AVPs">8.</a>&nbsp;
AVPs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">8.1.</a>&nbsp;
ERP-RK-Request AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">8.2.</a>&nbsp;
ERP-Realm AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#KAVP">8.3.</a>&nbsp;
Key AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">8.3.1.</a>&nbsp;
Key-Type AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">8.3.2.</a>&nbsp;
Keying-Material AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">8.3.3.</a>&nbsp;
Key-Name AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">8.3.4.</a>&nbsp;
Key-Lifetime AVP<br />
<a href="#Issues">9.</a>&nbsp;
Open issues<br />
<a href="#Acknowledgements">10.</a>&nbsp;
Acknowledgements<br />
<a href="#IANA">11.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#IANA_AppId">11.1.</a>&nbsp;
Diameter Application Identifier<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#IANA_AVP">11.2.</a>&nbsp;
New AVPs<br />
<a href="#Security">12.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">13.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">13.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">13.2.</a>&nbsp;
Informative References<br />
</p>
<br clear="all" />

<a name="Introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
				<a class='info' href='#RFC5296'>RFC 5296<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5296] defines the EAP Re-authentication
				Protocol (ERP). It consists of the following steps:
				</p>
<blockquote class="text"><dl>
<dt>Bootstrapping</dt>
<dd>
						
						A root key for re-authentication is derived from
						the Extended Master Session Key (EMSK) created during EAP
						authentication <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>. 
						This root key is transported from the EAP server to the ER server.
					
</dd>
<dt>Re-authentication</dt>
<dd>
						
						A one-round-trip exchange between the peer and
						the ER server, resulting in mutual authentication. To support the
						EAP reauthentication functionality, ERP defines two new EAP codes -
						EAP-Initiate and EAP-Finish.
					
</dd>
</dl></blockquote><p>
				This document defines how Diameter transports the ERP messages
				during the re-authentication process. For this purpose, we define a new Application
				Identifier for ERP, and re-use the Diameter EAP commands (DER/DEA).
				<br />
<br />

				This document also discusses the distribution of the root key
				during bootstrapping, in conjunction with either the initial EAP authentication
				(implicit bootstrapping) or the first ERP exchange (explicit
				bootstrapping). Security considerations for this key distribution are
				detailed in <a class='info' href='#RFC5295'>RFC 5295<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5295].
			
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>
				This document uses terminology defined in <a class='info' href='#RFC3748'>RFC 3748<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a> [RFC3748], 
				<a class='info' href='#RFC5295'>RFC 5295<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5295], 
				<a class='info' href='#RFC5296'>RFC 5296<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5296], 
				and <a class='info' href='#RFC4072'>RFC 4072<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a> [RFC4072].
				<br />
<br />

				"Root key" (RK) or "bootstrapping material" refer to the rRK or rDSRK
				derived from an EMSK, depending on the location of the ER server in home
				or foreign domain.
				<br />
<br />

				We use the notation "ERP/DER" and "ERP/DEA" in this document to refer to 
				Diameter-EAP-Request and Diameter-EAP-Answer commands with the Application Id
				set to "Diameter ERP Application"
				<a class='info' href='#IANA_AppId'>Section&nbsp;11.1<span> (</span><span class='info'>Diameter Application Identifier</span><span>)</span></a>; 
				the same commands are denoted "EAP/DER" and "EAP/DEA"
				when the Application Id in the message is set to "Diameter EAP Application"
				<a class='info' href='#RFC4072'>[RFC4072]<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a>.
			
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Requirements Language</h3>

<p>
					The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
					"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
					document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
				
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Assumptions</h3>

<p>
				This document assumes the existence of at most one logical ER server entity in a domain. If
				several physical servers are deployed for robustness, a replication
				mechanism must be deployed to synchronize the ERP states 
				(root keys) between these servers. This
				replication mechanism is out of the scope of this document. If multiple
				ER servers are deployed in the domain, we assume that they can be used
				interchangeably.
			
</p>
<a name="Overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Protocol Overview</h3>

<p>
				The following figure shows the components involved in ERP, and their
				interactions.
				
<br /><hr class="insert" />
<a name="Fig-Overview"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
                        Diameter                    +--------+
        +-------------+   ERP   +-----------+  (*)  |  Home  |
Peer &lt;-&gt;|Authenticator|&lt;=======&gt;| ER server | &lt;---&gt; |  EAP   |
        +-------------+         +-----------+       | server |
                                                    +--------+
(*) Diameter EAP application, explicit bootstrapping scenario only.
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Diameter ERP Overview&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


				The ER server is located either in the home domain (same as EAP
				server) or in the visited domain (same as authenticator, when it differs
				from the home domain). 
				</p>
<blockquote class="text"><dl>
<dt>QUESTION:</dt>
<dd>
						
						Can the ER server be located in a third domain (ex: broker's) according to ERP mechanism?
					
</dd>
</dl></blockquote><p>				
				<br />
<br />

				When the peer initiates an ERP exchange, the authenticator creates a
				Diameter-EAP-Request message 
				<a class='info' href='#RFC4072'>[RFC4072]<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a>. The Application Id of the message is set
				to that of the Diameter ERP application (code: TBD) in the
				message. 
				The generation of the ERP/DER message is
				detailed in <a class='info' href='#Re-authentication'>Section&nbsp;6<span> (</span><span class='info'>Re-Authentication</span><span>)</span></a>.
				<br />
<br />

				If there is an ER server in the same domain as the authenticator
				(local domain), Diameter routing MUST 
				</p>
<blockquote class="text"><dl>
<dt>QUESTION:</dt>
<dd>
						
						Should this say "SHOULD: instead of "MUST"?
					
</dd>
</dl></blockquote><p>
				be
				configured so that this ERP/DER message reachs this server, even if the
				Destination-Realm is not the local domain.
				<br />
<br />
			
				If there is no local ER server, the message is routed according to
				its Destination-Realm AVP content, extracted from the realm component of
				the keyName-NAI attribute. As specified in 
				<a class='info' href='#RFC5296'>RFC 5296<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5296], this realm is the home domain of the peer in
				case of a bootstrapping exchange (the 'B' flag is set in the ERP message) or the
				domain of the bootstrapped ER server otherwise.  
				</p>
<blockquote class="text"><dl>
<dt>NOTE:</dt>
<dd>
											
						This actually might allow the ER server to be in a third party realm.
					
</dd>
</dl></blockquote><p>
				<br />
<br />

				If no ER server is available in the home domain either, the ERP/DER
				message cannot be delivered, and an error DIAMETER_UNABLE_TO_DELIVER is
				generated <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> and returned to
				the authenticator. The authenticator may cache this information (with
				limited duration) to avoid further attempts for ERP with this realm. It
				may also fallback to full EAP authentication to authenticate the
				peer.
				<br />
<br />

				When an ER server receives the ERP/DER message, it searches its local
				database for a root key 
				</p>
<blockquote class="text"><dl>
<dt>FFS:</dt>
<dd>
						
						and authorization state?
					
</dd>
</dl></blockquote><p>
				matching
				the keyName part of the User-Name AVP. If such key is found, the ER
				server processes the ERP message as described in 
				<a class='info' href='#RFC5296'>RFC 5296<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5296] then creates the ERP/DEA answer as described in
				<a class='info' href='#Re-authentication'>Section&nbsp;6<span> (</span><span class='info'>Re-Authentication</span><span>)</span></a>. The rMSK is included in this
				answer.
				<br />
<br />

				Finally, the authenticator extracts the rMSK from the ERP/DEA as
				described in <a class='info' href='#RFC5296'>RFC 5296<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5296], and forwards the content of
				the EAP-Payload AVP, the EAP-Finish/Re-Auth message, to the peer.
				<br />
<br />

				If the EAP-Initiate/Re-Auth message has its 'B' flag set
				(Bootstrapping exchange), the ER server should not possess the root key
				in its local database 
				</p>
<blockquote class="text"><dl>
<dt>COMMENT:</dt>
<dd>
						
						This may not be true in future RFC5296bis?
					
</dd>
</dl></blockquote><p>
				In this case, the ER server acts as a proxy, and forwards the
				message to the home EAP server after changing its Application Id to
				Diameter EAP and adding an AVP to request the root key. See
				<a class='info' href='#Bootstrapping'>Section&nbsp;5<span> (</span><span class='info'>Bootstrapping the ER Server</span><span>)</span></a> for more detail on this
				process.
			
</p>
<a name="Bootstrapping"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Bootstrapping the ER Server</h3>

<p>
				The bootstrapping process involves the home EAP server and the ER
				server, but also impacts the peer and the authenticator. In ERP, the
				peer must derive the same keying material as the ER server. To achieve
				this, it must learn the domain name of the ER server. How this
				information is acquired is outside the scope of this specification, but
				it may involves that the authenticator is configured to advertize this
				domain name, especially in the case of re-authentication after a
				handover.
				<br />
<br />

				The bootstrapping of an ER server with a given root key happens
				either during the initial EAP authentication of the peer when the EMSK
				-- from which the root key is derived -- is created, during the first
				re-authentication, or sometime between those events. We only consider
				the first two possibilities in this specification, in the following
				sub-sections.
			
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Bootstrapping During the Initial EAP authentication</h3>

<p>
					Bootstrapping the ER server during the initial EAP authentication
					(also known as implicit bootstrapping) offers the advantage that the
					server is immediatly available for re-authentication of the peer, thus
					minimizing re-authentication delay. On the other hand, it is
					possible that only a small number of peers will use re-authentication
					in the visited domain. Deriving and caching key material for all the
					peers (for example, for the peers that do not support ERP) is a waste
					of resources and SHOULD be avoided.
					<br />
<br />

					To achieve implicit bootstrapping, the ER server must act as a
					Diameter EAP Proxy as defined in the Diameter Base Protocol <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>, and routing must be configured so that
					Diameter messages of a full EAP authentication are routed through this
					proxy. The figure bellow illustrates this mechanism.
<br /><hr class="insert" />
<a name="Implict"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
                         ER server &amp;
Authenticator             EAP Proxy               Home EAP server
=============            ===========              ===============
     -------------------------&gt;
         Diameter EAP/DER
          (EAP-Response)
                               -------------------------&gt;
                                  Diameter EAP/DER
                                   (EAP-Response)
                                  (ERP-RK-Request)

     &lt;==================================================&gt;
        Multi-round Diameter EAP exchanges, unmodified

                               &lt;-------------------------
                                   Diameter EAP/DEA
                                    (EAP-Success)
                                        (MSK)
                                   (Key AVP (rRK))
     &lt;-------------------------
         Diameter EAP/DEA
           (EAP-Success)
               (MSK)
            [ERP-Realm]
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: ERP Bootstrapping During Full EAP Authentication&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

					The ER server proxies the first DER of the full EAP authentication
					and adds the ERP-RK-Request AVP inside, if this AVP is not already in
					the message (which might happen if there are ER servers in the visited
					and the home domains), then forwards the request.
					<br />
<br />

					If the EAP server does not support the ERP extensions, it will simply
					ignore this grouped AVP and continue as specified in <a class='info' href='#RFC4072'>RFC 4072<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a> [RFC4072]. If the server supports the ERP extensions,
					it caches the ERP-Realm value with the session data, and continues the EAP
					authentication. When the authentication is complete, if it is
					successful and the EAP method generated an EMSK, the server MUST
					derive the rRK as
					specified in <a class='info' href='#RFC5296'>RFC 5296<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5296], and include an instance of the Key
					AVP <a class='info' href='#KAVP'>Section&nbsp;8.3<span> (</span><span class='info'>Key AVP</span><span>)</span></a>
					in the Diameter-EAP-Answer message.
					<br />
<br />

					When the ER server proxies a Diameter-EAP-Answer message with a
					Session-Id corresponding to a message to which it added an
					ERP-RK-Answer, and the Result-Code is DIAMETER_SUCCESS, it MUST
					examine the message, extract and remove any Key AVP 
					<a class='info' href='#KAVP'>Section&nbsp;8.3<span> (</span><span class='info'>Key AVP</span><span>)</span></a>
					from the
					message, and save its content. If the message does not contain an
					ERP-RK-Answer AVP, the ER server MAY cache this information to avoid
					possible subsequent re-authentication attempts for this session. In
					any case, the information stored SHOULD NOT have a lifetime greater
					than the EMSK lifetime 
					</p>
<blockquote class="text"><dl>
<dt>QUESTION:</dt>
<dd>
							
							How does the ER server knows the EMSK
							lifetime, if there is no ERP-RK-Answer? What is the lifetime of the
							MSK for example?
						
</dd>
</dl></blockquote><p>
					<br />
<br />

					If the ER server is successfully bootstrapped, it MAY also add the
					ERP-Realm AVP after removing the ERP-RK-Answer AVP in the EAP/DEA
					message. This could be used by the authenticator to notify the peer
					that ERP is bootstrapped, with the ER domain information. How this
					information can be transmitted to the peer is outside the scope of
					this document. 
					</p>
<blockquote class="text"><dl>
<dt>QUESTION:</dt>
<dd>
							
							Is this possible? It might be useful...
						
</dd>
</dl></blockquote><p>
				
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Bootstrapping During the First Re-authentication</h3>

<p>
					Bootstrapping the ER server during the first re-authentication
					(also known as explicit bootstrapping) offers several advantages: it
					saves resources, since we generate and cache only root keys that we
					actually need, and it can accomodate inter-domain handovers or ER
					servers that lose their state (for example after reboot).
					</p>
<blockquote class="text"><dl>
<dt>COMMENT:</dt>
<dd>
							
							This	last point might not be true currently, since the peer would not issue
							a bootstrapping exchange... But this might change also with RFC5296bis
							AFAIU						
						
</dd>
</dl></blockquote><p>
					On the other hand, the first re-authentication with the
					ER server requires a one-round-trip exchange with the home EAP server,
					which adds some delay to the process (but it is more efficient than a
					full EAP authentication in any case). It also requires some
					synchronization between the peer and the visited domain: since the ERP
					message used is different
					</p>
<blockquote class="text"><dl>
<dt>QUESTION:</dt>
<dd>
													
							and the root key used also?	
						
</dd>
</dl></blockquote><p>
					for the
					explicit bootstrapping exchange than for normal re-authentication;
					explicit bootstrapping should not be used if implicit bootstrapping
					was already performed.
					</p>
<blockquote class="text"><dl>
<dt>QUESTION:</dt>
<dd>
							
							What should we do if the ER server receives an explicit
							bootstrapping request but already possess the rDSRK? Can it answer
							without going to the home server? That would be simpler -- planned in
							rfc5296bis ?						
						
</dd>
</dl></blockquote><p>
					<br />
<br />

					The ER server receives the ERP/DER message containing the
					EAP-Initiate/Re-Auth message with the 'B' flag set. It proxies this
					message, and performs the following processing in addition to standard proxy
					operations:
					</p>
<blockquote class="text">
<p>
							Changes the Application Id in the header of the message to
							Diameter EAP Application (code 5).
					   
</p>
<p>
							Change the content of Application-Auth-Id accordingly. 
							</p>
<blockquote class="text"><dl>
<dt>QUESTION:</dt>
<dd>
									
									Is t better to leave it unmodified?
</dd>
</dl></blockquote>
						

<p>
							Add the ERP-RK-Request AVP, which contains the name of the
							domain where the ER server is located.
						
</p>
<p>
							</p>
<blockquote class="text"><dl>
<dt>QUESTION:</dt>
<dd>
									
									Add the Destination-Host to reach the appropriate EAP
									server, the one with the EMSK. How does the ER server know this
									information?
								
</dd>
</dl></blockquote>
						

</blockquote><p>
					Then the server forwards the EAP/DER request, which is routed
					to the home EAP server.
					<br />
<br />

					If the home EAP server does not support the ERP extensions, it replies
					with an error since the encapsulated EAP-Initiate/Re-auth command is
					not understood. Otherwise, it processes the ERP request as described
					in <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>. 
					In particular, it includes the
					Domain-Name TLV attribute with the content from the ERP-Realm AVP. It
					creates the EAP/DEA reply message
					<a class='info' href='#RFC4072'>[RFC4072]<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a>. including an instance of the Key AVP <a class='info' href='#KAVP'>Section&nbsp;8.3<span> (</span><span class='info'>Key AVP</span><span>)</span></a>. 
					</p>
<blockquote class="text"><dl>
<dt>QUESTION:</dt>
<dd>
							
							What about authorization AVPs?
						
</dd>
</dl></blockquote><p>
					<br />
<br />

					The ER server receives this EAP/DEA and proxies it as follows, in
					addition to standard proxy operations:
					</p>
<blockquote class="text">
<p>
							Set the Application Id back to Diameter ERP (code TBD)
						
</p>
<p>
							Extract and cache the content of the Key AVP. 
							</p>
<blockquote class="text"><dl>
<dt>QUESTION:</dt>
<dd>
									
									And authorization AVPs ?
								
</dd>
</dl></blockquote>
						

</blockquote><p>
					The DEA is then forwarded to the authenticator, that can use
					the rMSK as described in <a class='info' href='#RFC5296'>RFC 5296<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5296].
					<br />
<br />

					The figure below captures this proxy behavior:

<br /><hr class="insert" />
<a name="FigExplicit"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
Authenticator            ER server             Home EAP server
=============            =========             ===============
      -----------------------&gt;
          Diameter ERP/DER
           (EAP-Initiate)
                              ------------------------&gt;
                                    Diameter EAP/DER
                                     (EAP-Initiate)
                                    (ERP-RK-Request)

                              &lt;------------------------
                                    Diameter EAP/DEA
                                      (EAP-Finish)
                                       (Key AVP)
      &lt;----------------------
          Diameter ERP/DEA
            (EAP-Finish)
             (Key AVP)
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: ERP Explicit Bootstrapping Message Flow&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

					
</p>
<a name="Re-authentication"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Re-Authentication</h3>

<p>
				This section describes in detail a re-authentication exchange with a
				(bootstrapped) ER server. The following figure summarizes the
				re-authentication exchange.
<br /><hr class="insert" />
<a name="FigReauth"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
                                                     ER server
                                                   (bootstrapped)
 Peer                 Authenticator            (local or home domain)
 ====                 =============            ======================
 [ &lt;------------------------         ]
 [optional EAP-Initiate/Re-auth-start]

   -----------------------&gt;
     EAP-Initiate/Re-auth
                           ===============================&gt;
                              Diameter ERP, cmd code DER
                                User-Name: Keyname-NAI
                           EAP-Payload: EAP-Initiate/Re-auth

                           &lt;===============================
                              Diameter ERP, cmd code DEA
                            EAP-Payload: EAP-Finish/Re-auth
                                     Key AVP: rMSK
    &lt;----------------------
      EAP-Finish/Re-auth
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Diameter ERP Re-authentication Exchange&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

			
				In ERP, the peer sends an EAP-Initiate/Re-auth message to the ER
				server via the authenticator. Alternatively, the authenticator may send an
				EAP-Initiate/Re-auth-Start message to the peer to trigger the start of
				ERP. 
				In this case, the peer responds with an EAP-Initiate/Re-auth
				message.
				<br />
<br />

				If the authenticator does not support ERP 
				(pure <a class='info' href='#RFC4072'>[RFC4072]<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a> support), it discards the EAP packets with an
				unknown ERP-specific code (EAP-Initiate). The peer may fallback to full
				EAP authentication in this case.
				<br />
<br />

				When the authenticator receives an EAP-Initiate/Re-auth message from
				the peer, it process as described in <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> with
				regards to the EAP state machine. It creates a Diameter EAP Request
				message following the general process of 
				<a class='info' href='#RFC4072'>DiameterEAP<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a> [RFC4072], with the following differences:
				</p>
<blockquote class="text">
<p>
						The Application Id in the header is set to Diameter ERP (code TBD).
					
</p>
<p>
						The value in Auth-Application-Id AVP is also set to Diameter ERP
						Application.
					
</p>
<p>
						The keyName-NAI attribute from ERP message is used to create the
						content of User-Name AVP and Destination-Realm AVP.
					
</p>
<p>
						</p>
<blockquote class="text"><dl>
<dt>FFS:</dt>
<dd>
								
								 What about Session-ID AVP -- in case of re-auth at the
								same place, and in case of handover?
							
</dd>
</dl></blockquote>
					

<p>
						The Auth-Request-Type AVP content is set to [Editor's note:
						FFS].
						</p>
<blockquote class="text"><dl>
<dt>QUESTION:</dt>
<dd>
								
								Do we really do authorization with Diameter ERP ? -- need
								to pass the authorization attrs to the ER server in that case. Idea
								FFS: we do authorization only for explicit bootstrapping
								exchanges...
							
</dd>
</dl></blockquote>
					

<p>
						The EAP-Payload AVP contains the ERP message,
						EAP-Initiate/Re-Auth.
					
</p>
</blockquote><p>
				Then this ERP/DER message is sent as described in <a class='info' href='#Overview'>Section&nbsp;4<span> (</span><span class='info'>Protocol Overview</span><span>)</span></a>.
				<br />
<br />

				The ER server receives and processes this request as described in
				<a class='info' href='#Overview'>Section&nbsp;4<span> (</span><span class='info'>Protocol Overview</span><span>)</span></a>. It then creates an
				ERP/DEA message following the general processing described in 
				<a class='info' href='#RFC4072'>RFC 4072<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a> [RFC4072], with the following differences:
				</p>
<blockquote class="text">
<p>
						The Application Id in the header is set to Diameter ERP (code
						TBD).
					
</p>
<p>
						The value of the Auth-Application-Id AVP is also set to Diameter ERP
					Application.
				
</p>
<p>
					The EAP-Payload AVP contains the ERP message,
					EAP-Finish/Re-auth.
				
</p>
<p>
					In case of successful authentication, an instance of the Key
					AVP containing the Re-authentication Master Session Key (rMSK) derived
					by ERP is included.
					</p>
<blockquote class="text"><dl>
<dt>QUESTION:</dt>
<dd>
							
							What about all the authorization attributes? If we want to
							include them, they have to be present on the ER server...
						
</dd>
</dl></blockquote>
				

</blockquote><p>
			When the authenticator receives this ERP/DEA answer, it processes it
			as described in <a class='info' href='#RFC4072'>Diameter EAP<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a> [RFC4072] 
			and <a class='info' href='#RFC5296'>RFC 5296<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5296]: the content of EAP-Payload AVP content is
			forwarded to the peer, and the contents of the Keying-Material AVP <a class='info' href='#I-D.ietf-dime-local-keytran'>[I&#8209;D.ietf&#8209;dime&#8209;local&#8209;keytran]<span> (</span><span class='info'>Zorn, G., Wu, W., and V. Cakulev, &ldquo;Diameter Attribute-Value Pairs for Cryptographic Key Transport,&rdquo; June&nbsp;2010.</span><span>)</span></a>
			is used as a shared secret for Secure Association Protocol.
</p>
<a name="ApplicationId"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Application Id</h3>

<p>
				We define a new Diameter application in this document, Diameter ERP
				Application, with an Application Id value of TBD.
				Diameter nodes conforming to this specification in the role of ER server
				MUST advertise support by including an Auth-Application-Id AVP with a
				value of Diameter ERP Application in the of the
				Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands
				<a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>.
				<br />
<br />

				The primary use of the Diameter ERP Application Id is to ensure
				proper routing of the messages, and that the nodes that advertise the
				support for this application do understand the new AVPs defined in
				<a class='info' href='#AVPs'>Section&nbsp;8<span> (</span><span class='info'>AVPs</span><span>)</span></a>, although these AVP have the 'M'
				flag cleared.
			
</p>
<a name="AVPs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
AVPs</h3>

<p>
				This section discusses the AVPs used by the Diameter ERP application.
			
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
ERP-RK-Request AVP</h3>

<p>
					The ERP-RK-Request AVP (AVP Code TBD) is of
					type grouped AVP. This AVP is used by the ER server to indicate its
					willingness to act as ER server for a particular session.
					<br />
<br />

					This AVP has the M and V bits cleared.
<br /><hr class="insert" />
<a name="ERRABNF"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
      ERP-RK-Request ::= &lt; AVP Header: TBD &gt;
                         { ERP-Realm }
                       * [ AVP ]
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: ERP-RK-Request ABNF&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

				
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
ERP-Realm AVP</h3>

<p>
					The ERP-Realm AVP (AVP Code TBD) is of type
					DiameterIdentity. It contains the name of the realm in which the ER
					server is located.
					</p>
<blockquote class="text"><dl>
<dt>FFS:</dt>
<dd>
							
							We may re-use Origin-Realm here instead? On the other
							hand, ERP-Realm may be useful if the ER server is in a third-party
							realm, if this is possible.
						
</dd>
</dl></blockquote><p>
					<br />
<br />

					This AVP has the M and V bits cleared.
				
</p>
<a name="KAVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
Key AVP</h3>

<p>
					The Key AVP <a class='info' href='#I-D.ietf-dime-local-keytran'>[I&#8209;D.ietf&#8209;dime&#8209;local&#8209;keytran]<span> (</span><span class='info'>Zorn, G., Wu, W., and V. Cakulev, &ldquo;Diameter Attribute-Value Pairs for Cryptographic Key Transport,&rdquo; June&nbsp;2010.</span><span>)</span></a> is of type "Grouped" and is used to carry the rMSK
					and associated attributes.  The usage of the Key AVP and its constituent AVPs in this application is specified in the following sub-sections.
				
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.1"></a><h3>8.3.1.&nbsp;
Key-Type AVP</h3>

<p>
						The value of the Key-Type AVP MUST be set to 3 for rRK.
					
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.2"></a><h3>8.3.2.&nbsp;
Keying-Material AVP</h3>

<p>
						The Keying-Material AVP contains rRK sent by
						the home EAP server to the ER server, in answer to a request containing
						an ERP-RK-Request AVP. How this material is derived and used is
						specified in <a class='info' href='#RFC5296'>RFC 5296<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5296].
					
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.3"></a><h3>8.3.3.&nbsp;
Key-Name AVP</h3>

<p>
						This AVP contains the EMSKname which identifies the
						keying material. 
						The derivation of this name is specified in <a class='info' href='#RFC5296'>RGC 5296<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5296].
					
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.4"></a><h3>8.3.4.&nbsp;
Key-Lifetime AVP</h3>

<p>
						The Key-Lifetime AVP contains the lifetime of the keying material in
						seconds. It MUST NOT be greater than the remaining lifetime of the
						EMSK from which the material was derived.
					
</p>
<a name="Issues"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Open issues</h3>

<p>
				This document does not address some known issues in Diameter ERP
				mechanism. The authors would like to hear ideas about how to address
				them.
				<br />
<br />

				The main issue is the use of ERP for authentication after a handover
				of the peer to a new authenticator (or different authenticator port).
				Diameter ERP is not meant to be a mobility protocol. A number of issues
				appear when we try to do handover in Diameter ERP (alone): how to manage
				the Session-Id AVP; how does the ER server provide the Authorization
				AVPs; how does the peer learn the ERP domain of the new authenticator;
				how does the home server reachs the peer to for example terminate the
				session; and so on... Therefore, the management of the session for a
				mobile peer is not (yet) addressed in this document. It must be studied
				how Diameter ERP can be for example used in conjunction with a mobility
				application (Diameter MIP4, Diameter MIP6) to support the optimized
				re-authentication in such situation.
				<br />
<br />

				Another issue concerns the case where the home realm contains several
				EAP servers. In multi rounds full EAP authentication, the
				 Destination-Host AVP provides the solution to reach the same server
				across the exchanges. Only this server possess the EMSK for the session.
				In case of explicit bootstrapping, the ER server must therefore be able
				to reach the correct server to request the DSRK. A solution might
				consist in saving the Origin-Host AVP of all successful EAP/DEA in the
				ER server, which is a bit similar to the implicit bootstrapping scenario
				described here -- only we save the server name instead of the root key,
				and we must then be able to match the DSRK with the user name.
				<br />
<br />

				Finally, this document currently lacks a description of what happens
				when a Re-Auth-Request is received for a peer on the authenticator.
			
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgements</h3>

<p>
				Hannes Tschofenig wrote the initial draft for this document and
				provided useful reviews.
				<br />
<br />
		 
				Vidya Narayanan reviewed a rough draft version of the document and
				found some errors.
				<br />
<br />

				Lakshminath Dondeti contributed to the early versions of the
				document.
				<br />
<br />

				Many thanks to these people!
			
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
IANA Considerations</h3>

<p>
				This document requires IANA registration of the following new
				elements in the <a href='http://www.iana.org/assignments/aaa-parameters/'>Authentication,
				Authorization, and Accounting (AAA) Parameters</a> registries.
			
</p>
<a name="IANA_AppId"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1"></a><h3>11.1.&nbsp;
Diameter Application Identifier</h3>

<p>
					This specification requires IANA to allocate a new value "Diameter
					ERP" in the "Application IDs" registry 
					<a class='info' href='#RFC3588'>using the policy specified in Section 11.3 of RFC 3588<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> [RFC3588].
				
</p>
<a name="IANA_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2"></a><h3>11.2.&nbsp;
New AVPs</h3>

<p>
					This specification requires IANA to allocate new values from the
					"AVP Codes" registry
					<a class='info' href='#RFC3588'>according to the policy specified in Section 11.1 of RFC 3588<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> [RFC3588]
					for the
					following AVPs:
					</p>
<blockquote class="text">
<p>ERP-RK-Request
</p>
<p>ERP-Realm
</p>
</blockquote><p>These AVPs are defined in <a class='info' href='#AVPs'>Section&nbsp;8<span> (</span><span class='info'>AVPs</span><span>)</span></a>.
				
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Security Considerations</h3>

<p>
				The security considerations from the following documents also apply here: 
				</p>
<ul class="text">
<li><a class='info' href='#RFC3588'>RFC 3588<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> [RFC3588]
</li>
<li><a class='info' href='#RFC4072'>RFC 4072<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a> [RFC4072]
</li>
<li><a class='info' href='#RFC5247'>RFC 5247<span> (</span><span class='info'>Aboba, B., Simon, D., and P. Eronen, &ldquo;Extensible Authentication Protocol (EAP) Key Management Framework,&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5247]
</li>
<li><a class='info' href='#RFC5295'>RFC 5295<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5295]
</li>
<li><a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>
</li>
</ul><p>
				</p>
<blockquote class="text"><dl>
<dt>FFS:</dt>
<dd>
						
						Do we really respect these security considerations with
						the mechanism we describe here? 
						Is it safe to use ERP-RK-Request /
						Answer AVPs? What is the worst case?
					
</dd>
</dl></blockquote><p>
				EAP channel bindings may be necessary to ensure that the Diameter
				client and the server are in sync regarding the key Requesting Entity's
				Identity. Specifically, the Requesting Entity advertises its identity
				through the EAP lower layer, and the user or the EAP peer communicates
				that identity to the EAP server (and the EAP server communicates that
				identity to the Diameter server) via the EAP method for user/peer to
				server verification of the Requesting Entity's Identity.
				</p>
<blockquote class="text"><dl>
<dt>QUESTION:</dt>
<dd>
						
						What does this paragraph actually mean?
					
</dd>
</dl></blockquote><p>
			
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-dime-local-keytran">[I-D.ietf-dime-local-keytran]</a></td>
<td class="author-text">Zorn, G., Wu, W., and V. Cakulev, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-local-keytran-07.txt">Diameter Attribute-Value Pairs for Cryptographic Key Transport</a>,&rdquo; draft-ietf-dime-local-keytran-07 (work in progress), June&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-local-keytran-07.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3588">[RFC3588]</a></td>
<td class="author-text">Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>,&rdquo; RFC&nbsp;3588, September&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3588.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3748">[RFC3748]</a></td>
<td class="author-text">Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;<a href="http://tools.ietf.org/html/rfc3748">Extensible Authentication Protocol (EAP)</a>,&rdquo; RFC&nbsp;3748, June&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3748.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4072">[RFC4072]</a></td>
<td class="author-text">Eronen, P., Hiller, T., and G. Zorn, &ldquo;<a href="http://tools.ietf.org/html/rfc4072">Diameter Extensible Authentication Protocol (EAP) Application</a>,&rdquo; RFC&nbsp;4072, August&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4072.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5295">[RFC5295]</a></td>
<td class="author-text">Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;<a href="http://tools.ietf.org/html/rfc5295">Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK)</a>,&rdquo; RFC&nbsp;5295, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5295.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5296">[RFC5296]</a></td>
<td class="author-text">Narayanan, V. and L. Dondeti, &ldquo;<a href="http://tools.ietf.org/html/rfc5296">EAP Extensions for EAP Re-authentication Protocol (ERP)</a>,&rdquo; RFC&nbsp;5296, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5296.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC5247">[RFC5247]</a></td>
<td class="author-text">Aboba, B., Simon, D., and P. Eronen, &ldquo;<a href="http://tools.ietf.org/html/rfc5247">Extensible Authentication Protocol (EAP) Key Management Framework</a>,&rdquo; RFC&nbsp;5247, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5247.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Julien Bournelle</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Orange Labs</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">38-40 rue du general Leclerc</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Issy-Les-Moulineaux  92794</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:julien.bournelle@orange-ftgroup.com">julien.bournelle@orange-ftgroup.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Lionel Morand</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Orange Labs</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">38-40 rue du general Leclerc</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Issy-Les-Moulineaux  92794</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:lionel.morand@orange-ftgroup.com">lionel.morand@orange-ftgroup.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sebastien Decugis (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NICT</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">4-2-1 Nukui-Kitamachi</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tokyo  184-8795</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Koganei, Japan</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:sdecugis@nict.go.jp">sdecugis@nict.go.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Qin Wu</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies Co., Ltd</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Site B, Floor 12F, Huihong Mansion, No.91 Baixia Rd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nanjing  210001</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:sunseawq@huawei.com">sunseawq@huawei.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Glen Zorn (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Network Zen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1463 East Republican Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Seattle, Washington  98112</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 206 931 0768</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:gwz@net-zen.net">gwz@net-zen.net</a></td></tr>
</table>
</body></html>
