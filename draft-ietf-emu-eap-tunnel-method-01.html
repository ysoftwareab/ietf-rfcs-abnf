<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Tunnel EAP Method (TEAP) Version 1</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Specification Requirements">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Design Goals">
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 Terminology">
<link href="#rfc.section.2" rel="Chapter" title="2 Protocol Overview">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Architectural Model">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Protocol Layering Model">
<link href="#rfc.section.3" rel="Chapter" title="3 TEAP Protocol">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Version Negotiation">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 TEAP Authentication Phase 1: Tunnel Establishment">
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 TLS Session Resume Using Server State">
<link href="#rfc.section.3.2.2" rel="Chapter" title="3.2.2 TLS Session Resume Using a PAC">
<link href="#rfc.section.3.2.3" rel="Chapter" title="3.2.3 Transition between Abbreviated and Full TLS Handshake">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 TEAP Authentication Phase 2: Tunneled Authentication">
<link href="#rfc.section.3.3.1" rel="Chapter" title="3.3.1 EAP Sequences">
<link href="#rfc.section.3.3.2" rel="Chapter" title="3.3.2 Optional Password Authentication">
<link href="#rfc.section.3.3.3" rel="Chapter" title="3.3.3 Protected Termination and Acknowledged Result Indication">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Determining Peer-Id and Server-Id">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 TEAP Session Identifier">
<link href="#rfc.section.3.6" rel="Chapter" title="3.6 Error Handling">
<link href="#rfc.section.3.6.1" rel="Chapter" title="3.6.1 TLS Layer Errors">
<link href="#rfc.section.3.6.2" rel="Chapter" title="3.6.2 Phase 2 Errors">
<link href="#rfc.section.3.7" rel="Chapter" title="3.7 Fragmentation">
<link href="#rfc.section.3.8" rel="Chapter" title="3.8 PAC Provisioning Within Tunnel">
<link href="#rfc.section.4" rel="Chapter" title="4 Message Formats">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 TEAP Message Format">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 TEAP TLV Format and Support">
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 General TLV Format">
<link href="#rfc.section.4.2.2" rel="Chapter" title="4.2.2 Result TLV">
<link href="#rfc.section.4.2.3" rel="Chapter" title="4.2.3 NAK TLV">
<link href="#rfc.section.4.2.4" rel="Chapter" title="4.2.4 Error TLV">
<link href="#rfc.section.4.2.5" rel="Chapter" title="4.2.5 Vendor-Specific TLV">
<link href="#rfc.section.4.2.6" rel="Chapter" title="4.2.6 EAP-Payload TLV">
<link href="#rfc.section.4.2.7" rel="Chapter" title="4.2.7 Intermediate-Result TLV">
<link href="#rfc.section.4.2.8" rel="Chapter" title="4.2.8 PAC TLV Format">
<link href="#rfc.section.4.2.8.1" rel="Chapter" title="4.2.8.1 Formats for PAC Attributes">
<link href="#rfc.section.4.2.8.2" rel="Chapter" title="4.2.8.2 PAC-Key">
<link href="#rfc.section.4.2.8.3" rel="Chapter" title="4.2.8.3 PAC-Opaque">
<link href="#rfc.section.4.2.8.4" rel="Chapter" title="4.2.8.4 PAC-Info">
<link href="#rfc.section.4.2.8.5" rel="Chapter" title="4.2.8.5 PAC-Acknowledgement TLV">
<link href="#rfc.section.4.2.8.6" rel="Chapter" title="4.2.8.6 PAC-Type TLV">
<link href="#rfc.section.4.2.9" rel="Chapter" title="4.2.9 Crypto-Binding TLV">
<link href="#rfc.section.4.2.10" rel="Chapter" title="4.2.10 Authority-ID TLV">
<link href="#rfc.section.4.2.11" rel="Chapter" title="4.2.11 Request-Action TLV">
<link href="#rfc.section.4.2.12" rel="Chapter" title="4.2.12 Trusted-Server-Root TLV">
<link href="#rfc.section.4.2.13" rel="Chapter" title="4.2.13 PKCS#7 TLV">
<link href="#rfc.section.4.2.14" rel="Chapter" title="4.2.14 PKCS#10 TLV">
<link href="#rfc.section.4.2.15" rel="Chapter" title="4.2.15 Channel-Binding TLV">
<link href="#rfc.section.4.2.16" rel="Chapter" title="4.2.16 Identity-Type TLV">
<link href="#rfc.section.4.2.17" rel="Chapter" title="4.2.17 Basic-Password-Auth-Req TLV">
<link href="#rfc.section.4.2.18" rel="Chapter" title="4.2.18 Basic-Password-Auth-Resp TLV">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Table of TLVs">
<link href="#rfc.section.5" rel="Chapter" title="5 Cryptographic Calculations">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 TEAP Authentication Phase 1: Key Derivations">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Intermediate Compound Key Derivations">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Computing the Compound MAC">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 EAP Master Session Key Generation">
<link href="#rfc.section.6" rel="Chapter" title="6 IANA Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Mutual Authentication and Integrity Protection ">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Method Negotiation">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Separation of Phase 1 and Phase 2 Servers">
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 Mitigation of Known Vulnerabilities and Protocol Deficiencies">
<link href="#rfc.section.7.4.1" rel="Chapter" title="7.4.1 User Identity Protection and Verification">
<link href="#rfc.section.7.4.2" rel="Chapter" title="7.4.2 Dictionary Attack Resistance">
<link href="#rfc.section.7.4.3" rel="Chapter" title="7.4.3 Protection against Man-in-the-Middle Attacks">
<link href="#rfc.section.7.4.4" rel="Chapter" title="7.4.4 PAC Binding to User Identity">
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 Protecting against Forged Clear Text EAP Packets">
<link href="#rfc.section.7.6" rel="Chapter" title="7.6 Server Certificate Validation">
<link href="#rfc.section.7.7" rel="Chapter" title="7.7 Tunnel PAC Considerations">
<link href="#rfc.section.7.8" rel="Chapter" title="7.8 Security Claims">
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Evaluation Against Tunnel Based EAP Method Requirements">
<link href="#rfc.appendix.Appendix%20A.1" rel="Chapter" title="Appendix A.1 Requirement 4.1.1 RFC Compliance">
<link href="#rfc.appendix.Appendix%20A.2" rel="Chapter" title="Appendix A.2 Requirement 4.2.1 TLS Requirements">
<link href="#rfc.appendix.Appendix%20A.3" rel="Chapter" title="Appendix A.3 Requirement 4.2.1.1.1 Cipher Suite Negotiation">
<link href="#rfc.appendix.Appendix%20A.4" rel="Chapter" title="Appendix A.4 Requirement 4.2.1.1.2 Tunnel Data Protection Algorithms">
<link href="#rfc.appendix.Appendix%20A.5" rel="Chapter" title="Appendix A.5 Requirement 4.2.1.1.3 Tunnel Authentication and Key Establishment">
<link href="#rfc.appendix.Appendix%20A.6" rel="Chapter" title="Appendix A.6 Requirement 4.2.1.2 Tunnel Replay Protection">
<link href="#rfc.appendix.Appendix%20A.7" rel="Chapter" title="Appendix A.7 Requirement 4.2.1.3 TLS Extensions">
<link href="#rfc.appendix.Appendix%20A.8" rel="Chapter" title="Appendix A.8 Requirement 4.2.1.4 Peer Identity Privacy">
<link href="#rfc.appendix.Appendix%20A.9" rel="Chapter" title="Appendix A.9 Requirement 4.2.1.5 Session Resumption">
<link href="#rfc.appendix.Appendix%20A.10" rel="Chapter" title="Appendix A.10 Requirement 4.2.2 Fragmentation">
<link href="#rfc.appendix.Appendix%20A.11" rel="Chapter" title="Appendix A.11 Requirement 4.2.3 Protection of Data External to Tunnel">
<link href="#rfc.appendix.Appendix%20A.12" rel="Chapter" title="Appendix A.12 Requirement 4.3.1 Extensible Attribute Types">
<link href="#rfc.appendix.Appendix%20A.13" rel="Chapter" title="Appendix A.13 Requirement 4.3.2 Request/Challenge Response Operation">
<link href="#rfc.appendix.Appendix%20A.14" rel="Chapter" title="Appendix A.14 Requirement 4.3.3 Indicating Criticality of Attributes">
<link href="#rfc.appendix.Appendix%20A.15" rel="Chapter" title="Appendix A.15 Requirement 4.3.4 Vendor Specific Support">
<link href="#rfc.appendix.Appendix%20A.16" rel="Chapter" title="Appendix A.16 Requirement 4.3.5 Result Indication">
<link href="#rfc.appendix.Appendix%20A.17" rel="Chapter" title="Appendix A.17 Requirement 4.3.6 Internationalization of Display Strings">
<link href="#rfc.appendix.Appendix%20A.18" rel="Chapter" title="Appendix A.18 Requirement 4.4 EAP Channel Binding Requirements">
<link href="#rfc.appendix.Appendix%20A.19" rel="Chapter" title="Appendix A.19 Requirement 4.5.1.1 Confidentiality and Integrity">
<link href="#rfc.appendix.Appendix%20A.20" rel="Chapter" title="Appendix A.20 Requirement 4.5.1.2 Authentication of Server">
<link href="#rfc.appendix.Appendix%20A.21" rel="Chapter" title="Appendix A.21 Requirement 4.5.1.3 Server Certificate Revocation Checking">
<link href="#rfc.appendix.Appendix%20A.22" rel="Chapter" title="Appendix A.22 Requirement 4.5.2  Internationalization">
<link href="#rfc.appendix.Appendix%20A.23" rel="Chapter" title="Appendix A.23 Requirement 4.5.3 Meta-data">
<link href="#rfc.appendix.Appendix%20A.24" rel="Chapter" title="Appendix A.24 Requirement 4.5.4 Password Change">
<link href="#rfc.appendix.Appendix%20A.25" rel="Chapter" title="Appendix A.25 Requirement 4.6.1 Method Negotiation">
<link href="#rfc.appendix.Appendix%20A.26" rel="Chapter" title="Appendix A.26 Requirement 4.6.2 Chained Methods">
<link href="#rfc.appendix.Appendix%20A.27" rel="Chapter" title="Appendix A.27 Requirement 4.6.3 Cryptographic Binding with the TLS Tunnel">
<link href="#rfc.appendix.Appendix%20A.28" rel="Chapter" title="Appendix A.28 Requirement 4.6.4 Peer Initiated">
<link href="#rfc.appendix.Appendix%20A.29" rel="Chapter" title="Appendix A.29 Requirement 4.6.5 Method Meta-data">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B Major Differences from EAP-FAST">
<link href="#rfc.appendix.Appendix%20C" rel="Chapter" title="Appendix C Examples">
<link href="#rfc.appendix.Appendix%20C.1" rel="Chapter" title="Appendix C.1 Successful Authentication">
<link href="#rfc.appendix.Appendix%20C.2" rel="Chapter" title="Appendix C.2 Failed Authentication">
<link href="#rfc.appendix.Appendix%20C.3" rel="Chapter" title="Appendix C.3 Full TLS Handshake using Certificate-based Cipher Suite">
<link href="#rfc.appendix.Appendix%20C.4" rel="Chapter" title="Appendix C.4 Client authentication during Phase 1 with identity privacy">
<link href="#rfc.appendix.Appendix%20C.5" rel="Chapter" title="Appendix C.5 Fragmentation and Reassembly">
<link href="#rfc.appendix.Appendix%20C.6" rel="Chapter" title="Appendix C.6 Sequence of EAP Methods">
<link href="#rfc.appendix.Appendix%20C.7" rel="Chapter" title="Appendix C.7 Failed Crypto-binding">
<link href="#rfc.appendix.Appendix%20C.8" rel="Chapter" title="Appendix C.8 Sequence of EAP Method with Vendor-Specific TLV Exchange">
<link href="#rfc.appendix.Appendix%20D" rel="Chapter" title="Appendix D Major Differences from previous revisions">
<link href="#rfc.appendix.Appendix%20D.1" rel="Chapter" title="Appendix D.1 Changes from -00">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document defines the Tunnel Extensible Authentication Protocol (TEAP) protocol version 1.  TEAP is a tunnel based EAP method that enables secure communication between a peer and a server by using the Transport Layer Security (TLS) to establish a mutually authenticated tunnel. Within the tunnel, Type-Length-Value (TLV) objects are used to convey authentication related data between the EAP peer and the EAP server." />
  <meta name="description" content="This document defines the Tunnel Extensible Authentication Protocol (TEAP) protocol version 1.  TEAP is a tunnel based EAP method that enables secure communication between a peer and a server by using the Transport Layer Security (TLS) to establish a mutually authenticated tunnel. Within the tunnel, Type-Length-Value (TLV) objects are used to convey authentication related data between the EAP peer and the EAP server." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">EMU Working Group</td>
<td class="right">H. Zhou</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">N. Cam-Winget</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">J. Salowey</td>
</tr>
<tr>
<td class="left">Expires: April 22, 2012</td>
<td class="right">Cisco Systems</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">S. Hanna</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Juniper Networks</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 20, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Tunnel EAP Method (TEAP) Version 1<br />
  <span class="filename">draft-ietf-emu-eap-tunnel-method-01.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document defines the Tunnel Extensible Authentication Protocol (TEAP) protocol version 1.  TEAP is a tunnel based EAP method that enables secure communication between a peer and a server by using the Transport Layer Security (TLS) to establish a mutually authenticated tunnel. Within the tunnel, Type-Length-Value (TLV) objects are used to convey authentication related data between the EAP peer and the EAP server.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 22, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Specification Requirements</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Design Goals</a>
</li>
<li>1.3.   <a href="#rfc.section.1.3">Terminology</a>
</li>
<li>2.   <a href="#rfc.section.2">Protocol Overview</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Architectural Model</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Protocol Layering Model</a>
</li>
<li>3.   <a href="#rfc.section.3">TEAP Protocol</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Version Negotiation</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">TEAP Authentication Phase 1: Tunnel Establishment</a>
</li>
<li>3.2.1.   <a href="#rfc.section.3.2.1">TLS Session Resume Using Server State</a>
</li>
<li>3.2.2.   <a href="#rfc.section.3.2.2">TLS Session Resume Using a PAC</a>
</li>
<li>3.2.3.   <a href="#rfc.section.3.2.3">Transition between Abbreviated and Full TLS Handshake</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">TEAP Authentication Phase 2: Tunneled Authentication</a>
</li>
<li>3.3.1.   <a href="#rfc.section.3.3.1">EAP Sequences</a>
</li>
<li>3.3.2.   <a href="#rfc.section.3.3.2">Optional Password Authentication</a>
</li>
<li>3.3.3.   <a href="#rfc.section.3.3.3">Protected Termination and Acknowledged Result Indication</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Determining Peer-Id and Server-Id</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">TEAP Session Identifier</a>
</li>
<li>3.6.   <a href="#rfc.section.3.6">Error Handling</a>
</li>
<li>3.6.1.   <a href="#rfc.section.3.6.1">TLS Layer Errors</a>
</li>
<li>3.6.2.   <a href="#rfc.section.3.6.2">Phase 2 Errors</a>
</li>
<li>3.7.   <a href="#rfc.section.3.7">Fragmentation</a>
</li>
<li>3.8.   <a href="#rfc.section.3.8">PAC Provisioning Within Tunnel</a>
</li>
<li>4.   <a href="#rfc.section.4">Message Formats</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">TEAP Message Format</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">TEAP TLV Format and Support</a>
</li>
<li>4.2.1.   <a href="#rfc.section.4.2.1">General TLV Format</a>
</li>
<li>4.2.2.   <a href="#rfc.section.4.2.2">Result TLV</a>
</li>
<li>4.2.3.   <a href="#rfc.section.4.2.3">NAK TLV</a>
</li>
<li>4.2.4.   <a href="#rfc.section.4.2.4">Error TLV</a>
</li>
<li>4.2.5.   <a href="#rfc.section.4.2.5">Vendor-Specific TLV</a>
</li>
<li>4.2.6.   <a href="#rfc.section.4.2.6">EAP-Payload TLV</a>
</li>
<li>4.2.7.   <a href="#rfc.section.4.2.7">Intermediate-Result TLV</a>
</li>
<li>4.2.8.   <a href="#rfc.section.4.2.8">PAC TLV Format</a>
</li>
<li>4.2.8.1.   <a href="#rfc.section.4.2.8.1">Formats for PAC Attributes</a>
</li>
<li>4.2.8.2.   <a href="#rfc.section.4.2.8.2">PAC-Key</a>
</li>
<li>4.2.8.3.   <a href="#rfc.section.4.2.8.3">PAC-Opaque</a>
</li>
<li>4.2.8.4.   <a href="#rfc.section.4.2.8.4">PAC-Info</a>
</li>
<li>4.2.8.5.   <a href="#rfc.section.4.2.8.5">PAC-Acknowledgement TLV</a>
</li>
<li>4.2.8.6.   <a href="#rfc.section.4.2.8.6">PAC-Type TLV</a>
</li>
<li>4.2.9.   <a href="#rfc.section.4.2.9">Crypto-Binding TLV</a>
</li>
<li>4.2.10.   <a href="#rfc.section.4.2.10">Authority-ID TLV</a>
</li>
<li>4.2.11.   <a href="#rfc.section.4.2.11">Request-Action TLV</a>
</li>
<li>4.2.12.   <a href="#rfc.section.4.2.12">Trusted-Server-Root TLV</a>
</li>
<li>4.2.13.   <a href="#rfc.section.4.2.13">PKCS#7 TLV</a>
</li>
<li>4.2.14.   <a href="#rfc.section.4.2.14">PKCS#10 TLV</a>
</li>
<li>4.2.15.   <a href="#rfc.section.4.2.15">Channel-Binding TLV</a>
</li>
<li>4.2.16.   <a href="#rfc.section.4.2.16">Identity-Type TLV</a>
</li>
<li>4.2.17.   <a href="#rfc.section.4.2.17">Basic-Password-Auth-Req TLV</a>
</li>
<li>4.2.18.   <a href="#rfc.section.4.2.18">Basic-Password-Auth-Resp TLV</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Table of TLVs</a>
</li>
<li>5.   <a href="#rfc.section.5">Cryptographic Calculations</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">TEAP Authentication Phase 1: Key Derivations</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Intermediate Compound Key Derivations</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Computing the Compound MAC</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">EAP Master Session Key Generation</a>
</li>
<li>6.   <a href="#rfc.section.6">IANA Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">Mutual Authentication and Integrity Protection </a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">Method Negotiation</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">Separation of Phase 1 and Phase 2 Servers</a>
</li>
<li>7.4.   <a href="#rfc.section.7.4">Mitigation of Known Vulnerabilities and Protocol Deficiencies</a>
</li>
<li>7.4.1.   <a href="#rfc.section.7.4.1">User Identity Protection and Verification</a>
</li>
<li>7.4.2.   <a href="#rfc.section.7.4.2">Dictionary Attack Resistance</a>
</li>
<li>7.4.3.   <a href="#rfc.section.7.4.3">Protection against Man-in-the-Middle Attacks</a>
</li>
<li>7.4.4.   <a href="#rfc.section.7.4.4">PAC Binding to User Identity</a>
</li>
<li>7.5.   <a href="#rfc.section.7.5">Protecting against Forged Clear Text EAP Packets</a>
</li>
<li>7.6.   <a href="#rfc.section.7.6">Server Certificate Validation</a>
</li>
<li>7.7.   <a href="#rfc.section.7.7">Tunnel PAC Considerations</a>
</li>
<li>7.8.   <a href="#rfc.section.7.8">Security Claims</a>
</li>
<li>8.   <a href="#rfc.section.8">Acknowledgements</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Evaluation Against Tunnel Based EAP Method Requirements</a>
</li>
<li>Appendix A.1.   <a href="#rfc.appendix.Appendix%20A.1">Requirement 4.1.1 RFC Compliance</a>
</li>
<li>Appendix A.2.   <a href="#rfc.appendix.Appendix%20A.2">Requirement 4.2.1 TLS Requirements</a>
</li>
<li>Appendix A.3.   <a href="#rfc.appendix.Appendix%20A.3">Requirement 4.2.1.1.1 Cipher Suite Negotiation</a>
</li>
<li>Appendix A.4.   <a href="#rfc.appendix.Appendix%20A.4">Requirement 4.2.1.1.2 Tunnel Data Protection Algorithms</a>
</li>
<li>Appendix A.5.   <a href="#rfc.appendix.Appendix%20A.5">Requirement 4.2.1.1.3 Tunnel Authentication and Key Establishment</a>
</li>
<li>Appendix A.6.   <a href="#rfc.appendix.Appendix%20A.6">Requirement 4.2.1.2 Tunnel Replay Protection</a>
</li>
<li>Appendix A.7.   <a href="#rfc.appendix.Appendix%20A.7">Requirement 4.2.1.3 TLS Extensions</a>
</li>
<li>Appendix A.8.   <a href="#rfc.appendix.Appendix%20A.8">Requirement 4.2.1.4 Peer Identity Privacy</a>
</li>
<li>Appendix A.9.   <a href="#rfc.appendix.Appendix%20A.9">Requirement 4.2.1.5 Session Resumption</a>
</li>
<li>Appendix A.10.   <a href="#rfc.appendix.Appendix%20A.10">Requirement 4.2.2 Fragmentation</a>
</li>
<li>Appendix A.11.   <a href="#rfc.appendix.Appendix%20A.11">Requirement 4.2.3 Protection of Data External to Tunnel</a>
</li>
<li>Appendix A.12.   <a href="#rfc.appendix.Appendix%20A.12">Requirement 4.3.1 Extensible Attribute Types</a>
</li>
<li>Appendix A.13.   <a href="#rfc.appendix.Appendix%20A.13">Requirement 4.3.2 Request/Challenge Response Operation</a>
</li>
<li>Appendix A.14.   <a href="#rfc.appendix.Appendix%20A.14">Requirement 4.3.3 Indicating Criticality of Attributes</a>
</li>
<li>Appendix A.15.   <a href="#rfc.appendix.Appendix%20A.15">Requirement 4.3.4 Vendor Specific Support</a>
</li>
<li>Appendix A.16.   <a href="#rfc.appendix.Appendix%20A.16">Requirement 4.3.5 Result Indication</a>
</li>
<li>Appendix A.17.   <a href="#rfc.appendix.Appendix%20A.17">Requirement 4.3.6 Internationalization of Display Strings</a>
</li>
<li>Appendix A.18.   <a href="#rfc.appendix.Appendix%20A.18">Requirement 4.4 EAP Channel Binding Requirements</a>
</li>
<li>Appendix A.19.   <a href="#rfc.appendix.Appendix%20A.19">Requirement 4.5.1.1 Confidentiality and Integrity</a>
</li>
<li>Appendix A.20.   <a href="#rfc.appendix.Appendix%20A.20">Requirement 4.5.1.2 Authentication of Server</a>
</li>
<li>Appendix A.21.   <a href="#rfc.appendix.Appendix%20A.21">Requirement 4.5.1.3 Server Certificate Revocation Checking</a>
</li>
<li>Appendix A.22.   <a href="#rfc.appendix.Appendix%20A.22">Requirement 4.5.2  Internationalization</a>
</li>
<li>Appendix A.23.   <a href="#rfc.appendix.Appendix%20A.23">Requirement 4.5.3 Meta-data</a>
</li>
<li>Appendix A.24.   <a href="#rfc.appendix.Appendix%20A.24">Requirement 4.5.4 Password Change</a>
</li>
<li>Appendix A.25.   <a href="#rfc.appendix.Appendix%20A.25">Requirement 4.6.1 Method Negotiation</a>
</li>
<li>Appendix A.26.   <a href="#rfc.appendix.Appendix%20A.26">Requirement 4.6.2 Chained Methods</a>
</li>
<li>Appendix A.27.   <a href="#rfc.appendix.Appendix%20A.27">Requirement 4.6.3 Cryptographic Binding with the TLS Tunnel</a>
</li>
<li>Appendix A.28.   <a href="#rfc.appendix.Appendix%20A.28">Requirement 4.6.4 Peer Initiated</a>
</li>
<li>Appendix A.29.   <a href="#rfc.appendix.Appendix%20A.29">Requirement 4.6.5 Method Meta-data</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">Major Differences from EAP-FAST</a>
</li>
<li>Appendix C.   <a href="#rfc.appendix.Appendix%20C">Examples</a>
</li>
<li>Appendix C.1.   <a href="#rfc.appendix.Appendix%20C.1">Successful Authentication</a>
</li>
<li>Appendix C.2.   <a href="#rfc.appendix.Appendix%20C.2">Failed Authentication</a>
</li>
<li>Appendix C.3.   <a href="#rfc.appendix.Appendix%20C.3">Full TLS Handshake using Certificate-based Cipher Suite</a>
</li>
<li>Appendix C.4.   <a href="#rfc.appendix.Appendix%20C.4">Client authentication during Phase 1 with identity privacy</a>
</li>
<li>Appendix C.5.   <a href="#rfc.appendix.Appendix%20C.5">Fragmentation and Reassembly</a>
</li>
<li>Appendix C.6.   <a href="#rfc.appendix.Appendix%20C.6">Sequence of EAP Methods</a>
</li>
<li>Appendix C.7.   <a href="#rfc.appendix.Appendix%20C.7">Failed Crypto-binding</a>
</li>
<li>Appendix C.8.   <a href="#rfc.appendix.Appendix%20C.8">Sequence of EAP Method with Vendor-Specific TLV Exchange</a>
</li>
<li>Appendix D.   <a href="#rfc.appendix.Appendix%20D">Major Differences from previous revisions</a>
</li>
<li>Appendix D.1.   <a href="#rfc.appendix.Appendix%20D.1">Changes from -00</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">An Extensible Authentication Protocol (EAP) tunnel method is an EAP method that establishes a secure tunnel and executes other EAP methods under the protection of that secure tunnel.  An EAP tunnel method can be used in any lower layer protocol that supports EAP authentication.  There are several existing EAP tunnel methods that use Transport Layer Security (TLS) to establish the secure tunnel. EAP methods supporting this include Protected EAP (PEAP) <a href="#PEAP">[PEAP]</a>, Tunneled Transport Layer Security EAP (TTLS) <a href="#RFC5281">[RFC5281]</a> and EAP Flexible Authentication via Secure Tunneling (EAP-FAST) <a href="#RFC4851">[RFC4851]</a>. However, they all are either vendor specific or informational and industry calls for a standard-track tunnel EAP method. <a href="#I-D.ietf-emu-eaptunnel-req">[I-D.ietf-emu-eaptunnel-req]</a> outlines the list of requirements for a standard tunnel based EAP method. </p>
<p id="rfc.section.1.p.2">Since the introduction of EAP-FAST <a href="#RFC4851">[RFC4851]</a> a few years ago, it has been widely adopted in variety of devices and platforms due to its strong security, flexibility and ease of deployment.  It has been adopted by EMU working group as the basis for the standard tunnel based EAP method. This document describes TEAP version 1, based on EAP-FAST <a href="#RFC4851">[RFC4851]</a> with some minor changes, to meet the requirements outlined in <a href="#I-D.ietf-emu-eaptunnel-req">[I-D.ietf-emu-eaptunnel-req]</a> for a standard tunnel based EAP method. </p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Specification Requirements</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a> .</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> <a href="#goals" id="goals">Design Goals</a>
</h1>
<p id="rfc.section.1.2.p.1">Network access solutions requiring user friendly and easily deployable secure authentication mechanisms highlight the need for strong mutual authentication protocols that enable the use of weaker user credentials. This document defines an Extensible Authentication Protocol (EAP) which consists of establishing a Transport Layer Security (TLS) tunnel using TLS 1.2 <a href="#RFC5246">[RFC5246]</a> or a successor version of TLS, using the latest version supported by both parties. Once the tunnel is established, the protocol further exchanges data in the form of Type-Length-Value (TLV) objects to perform further authentication. TEAP supports the TLS extension defined in <a href="#RFC5077">[RFC5077]</a> to support fast re-establishment of the secure tunnel without having to maintain per-session state on the server. </p>
<p id="rfc.section.1.2.p.2">TEAP's design motivations included:</p>
<p></p>

<ul>
<li>Mutual authentication: an EAP server must be able to verify the identity and authenticity of the peer, and the peer must be able to verify the authenticity of the EAP server. <br><br>
</li>
<li>Immunity to passive dictionary attacks: many authentication protocols require a password to be explicitly provided (either as cleartext or hashed) by the peer to the EAP server; at minimum, the communication of the weak credential (e.g., password) must be immune from eavesdropping. <br><br>
</li>
<li>Immunity to man-in-the-middle (MitM) attacks: in establishing a mutually authenticated protected tunnel, the protocol must prevent adversaries from successfully interjecting information into the conversation between the peer and the EAP server. <br><br>
</li>
<li>Flexibility to enable support for most password authentication interfaces: as many different password interfaces (e.g., Microsoft Challenge Handshake Authentication Protocol (MS-CHAP), Lightweight Directory Access Protocol (LDAP), One-Time Password (OTP), etc.) exist to authenticate a peer, the protocol must provide this support for legacy password authentication seamlessly. <br><br>
</li>
<li>Cryptographic algorithm agility: a cryptographic algorithm's strength is not perpetual, as weaknesses in an algorithm are discovered or increased processing power overtakes an algorithm over time. Hence, the protocol must not be tied to any single cryptographic algorithm.  Instead, it MUST support run-time negotiation to select among an extensible set of cryptographic algorithms and also allow users to choose the algorithm that best meets their needs.</li>
<li>Sequence of chained EAP methods:  Several circumstances are best addressed by using chained EAP methods.  For example, it may be desirable to authenticate the user and also authenticate the device being used. The protocol must support chained EAP methods while including protection against attacks on method chaining.</li>
</ul>
<p id="rfc.section.1.2.p.4">With these motivational goals defined, further secondary design criteria are imposed:</p>
<p></p>

<ul>
<li>Flexibility to extend the communications inside the tunnel: with the growing complexity in network infrastructures, the need to gain authentication, authorization, and accounting is also evolving. For instance, there may be instances in which multiple existing authentication protocols are required to achieve mutual authentication. Similarly, different protected conversations may be required to achieve the proper authorization once a peer has successfully authenticated.</li>
<li>Minimize the authentication server's per user authentication state requirements: with large deployments, it is typical to have servers authenticating many peers. With many different authentication servers deployed, a peer's session state may need to be replicated to allow for high availability or mobility scenarios.  To facilitate scalable authentication server deployments and more efficient per user state management, it is desirable for a peer to cache its session state that has been securely encapsulated by the authentication server infrastructure.</li>
<li>Efficiency: specifically when using wireless media, peers will be limited in computational and power resources. The protocol must enable the network access communication to be computationally lightweight.</li>
<li>Channel bindings: EAP channel bindings seek to authenticate previously unauthenticated information provided by the authenticator to the EAP peer, by allowing the peer and server to compare their perception of network properties in a secure channel. It is used to solve the lying NAS and the lying provider problems. The protocol should provide support for EAP channel bindings as defined in <a href="#I-D.ietf-emu-chbind">[I-D.ietf-emu-chbind]</a>.</li>
</ul>
<h1 id="rfc.section.1.3">
<a href="#rfc.section.1.3">1.3.</a> Terminology</h1>
<p id="rfc.section.1.3.p.1">Much of the terminology in this document comes from <a href="#RFC3748">[RFC3748]</a>. Additional terms are defined below:</p>
<p></p>

<dl>
<dt>Protected Access Credential (PAC)</dt>
<dd style="margin-left: 8">
<br><br>Credentials distributed to a peer for future optimized network authentication. The PAC consists of a minimum of two components: a shared secret and an opaque element.  The shared secret component contains the pre-shared key between the peer and the authentication server.  The opaque part is provided to the peer and is presented to the authentication server when the peer wishes to obtain access to network resources.  The opaque element and shared secret are used with TLS stateless session resumption defined in RFC 5077 <a href="#RFC5077">[RFC5077]</a> to establish a protected TLS session.  The secret key and opaque part may distributed using RFC 5077 messages or using TLVs within the TEAP tunnel. Finally, a PAC may optionally include other information that may be useful to the peer. </dd>
<dt>Type-Length-Value (TLV)</dt>
<dd style="margin-left: 8">
<br><br>The TEAP protocol utilizes objects in Type Length Value (TLV) format.  The TLV format is defined in <a href="#tlvformat">Section 4.2</a>.</dd>
</dl>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#protocoloverview" id="protocoloverview">Protocol Overview</a>
</h1>
<p id="rfc.section.2.p.1">TEAP authentication occurs in two phases. In the first phase, TEAP employs the TLS <a href="#RFC5246">[RFC5246]</a> handshake to provide an authenticated key exchange and to establish a protected tunnel. Once the tunnel is established, the second phase begins with the peer and server engaging in further conversations to establish the required authentication and authorization policies. TEAP makes use of Type-Length-Value objects (TLVs) to carry out the inner authentication, results and other information, such as channel binding information. </p>
<p id="rfc.section.2.p.2">TEAP makes use of the TLS enhancements in Ticket Extension <a href="#RFC5077">[RFC5077]</a> to enable an optimized TLS tunnel session resume while minimizing server state.  The ticket is referred to as the Protected Access Credential opaque data (or PAC-Opaque).  The PAC-Opaque may be distributed through the use of the NewSessionTicket message or through a mechanism that uses TLVs within phase 2 of TEAP.  The secret key used to resume the session in TEAP is referred to as the Protected Access Credential key (or PAC-Key).  When the NewSessionTicket message is being used to distribute the PAC-Opaque the PAC-Key is the Master Secret for the session.  If TEAP phase 2 is used to distribute the PAC-Opaque then the PAC-Key is distributed along with the PAC-Opaque.  TEAP implementations MUST support the RFC 5077 mechanism for distributing a PAC-Opaque and it is RECOMMENDED that implementations support the capability to distribute the ticket and secret key within the TEAP tunnel.</p>
<p id="rfc.section.2.p.3">The TEAP conversation is used to establish or resume an existing session to typically establish network connectivity between a peer and the network. Upon successful execution of TEAP, both EAP peer and EAP server derive strong session key material that can then be communicated to the network access server (NAS) for use in establishing a link layer security association.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#archmodel" id="archmodel">Architectural Model</a>
</h1>
<p id="rfc.section.2.1.p.1">The network architectural model for TEAP usage is shown below:</p>
<div id="#rfc.figure.1"></div>
<pre>
	     
 +----------+      +----------+      +----------+      +----------+  
 |          |      |          |      |          |      |  Inner   |  
 |   Peer   |&lt;----&gt;|  Authen- |&lt;----&gt;|   TEAP   |&lt;----&gt;|  Method  |  
 |          |      |  ticator |      |  server  |      |  server  |  
 |          |      |          |      |          |      |          |  
 +----------+      +----------+      +----------+      +----------+ 
    
  </pre>
<p id="rfc.section.2.1.p.2">The entities depicted above are logical entities and may or may not correspond to separate network components. For example, the TEAP server and inner method server might be a single entity; or the authenticator and TEAP server might be a single entity; or the functions of the authenticator, TEAP server, and inner method server might be combined into a single physical device. For example, typical IEEE 802.11 deployments place the Authenticator in an access point (AP) while a Radius server may provide the TEAP and inner method server components. The above diagram illustrates the division of labor among entities in a general manner and shows how a distributed system might be constructed; however, actual systems might be realized more simply. The security considerations <a href="#sepp1p2">Section 7.3</a> provides an additional discussion of the implications of separating the TEAP server from the inner method server.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#protlayermodel" id="protlayermodel">Protocol Layering Model</a>
</h1>
<p id="rfc.section.2.2.p.1">TEAP packets are encapsulated within EAP; EAP in turn requires a carrier protocol for transport. TEAP packets encapsulate TLS, which is then used to encapsulate user authentication information. Thus, TEAP messaging can be described using a layered model, where each layer encapsulates the layer above it. The following diagram clarifies the relationship between protocols:</p>
<div id="#rfc.figure.2"></div>
<pre>
	
 +---------------------------------------------------------------+ 
 |       Inner EAP Method     |     Other TLV information        |                
 |---------------------------------------------------------------|
 |                 TLV Encapsulation (TLVs)                      | 
 |---------------------------------------------------------------| 
 |                TLS         |        Optional TLVs             | 
 |---------------------------------------------------------------| 
 |                         TEAP                                  | 
 |---------------------------------------------------------------| 
 |                         EAP                                   | 
 |---------------------------------------------------------------| 
 |    Carrier Protocol (EAP over LAN, RADIUS, Diameter, etc.)    | 
 +---------------------------------------------------------------+ 
	
	</pre>
<p id="rfc.section.2.2.p.2">The TLV layer is a payload with Type-Length-Value (TLV) Objects defined in <a href="#tlvformat">Section 4.2</a>. The TLV objects are used to carry arbitrary parameters between an EAP peer and an EAP server.  All conversations in the TEAP protected tunnel must be encapsulated in a TLV layer.</p>
<p id="rfc.section.2.2.p.3">TEAP packets may include TLVs both inside and outside the TLS tunnel.  The term "Outer TLVs" is used to refer to optional TLVs outside the TLS tunnel, which are only allowed in the first two messages in the TEAP protocol.  That is the first EAP server to peer message and first peer to EAP server message.  If the message is fragmented, the whole set of messages is counted as one message.  The term "Inner TLVs" is used to refer to TLVs sent within the TLS tunnel. In TEAP Phase 1, Outer TLVs are used to help establishing the TLS tunnel, but no Inner TLVs are used. In Phase 2 of the TEAP conversation, TLS records may encapsulate zero or more Inner TLVs, but no Outer TLVs.</p>
<p id="rfc.section.2.2.p.4">Methods for encapsulating EAP within carrier protocols are already defined. For example, IEEE 802.1X <a href="#IEEE.802-1X.2004">[IEEE.802-1X.2004]</a> may be used to transport EAP between the peer and the authenticator; RADIUS <a href="#RFC3579">[RFC3579]</a> or Diameter <a href="#RFC4072">[RFC4072]</a> may be used to transport EAP between the authenticator and the EAP server.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#teapprotocol" id="teapprotocol">TEAP Protocol</a>
</h1>
<p id="rfc.section.3.p.1">TEAP authentication occurs in two phases. In the first phase, TEAP employs the TLS handshake to provide an authenticated key exchange and to establish a protected tunnel. Once the tunnel is established the second phase begins with the peer and server engaging in further conversations to establish the required authentication and authorization policies. The operation of the protocol, including Phase 1 and Phase 2, is the topic of this section. The format of TEAP messages is given in <a href="#messageformats">Section 4</a> and the cryptographic calculations are given in <a href="#crypto">Section 5</a>.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#versionnegotiation" id="versionnegotiation">Version Negotiation</a>
</h1>
<p id="rfc.section.3.1.p.1">TEAP packets contain a 3-bit version field, following the TLS Flags field, which enables TEAP implementations to be backward compatible with previous versions of the protocol. This specification documents the TEAP version 1 protocol; implementations of this specification MUST use a version field set to 1.</p>
<p id="rfc.section.3.1.p.2">Version negotiation proceeds as follows:</p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 8">In the first EAP-Request sent with EAP type=TEAP, the EAP server must set the version field to the highest supported version number. <br><br>
</dd>
<dt></dt>
<dd style="margin-left: 8">If the EAP peer supports this version of the protocol, it MUST respond with an EAP-Response of EAP type=TEAP, and the version number proposed by the TEAP server. <br><br>
</dd>
<dt></dt>
<dd style="margin-left: 8">If the TEAP peer does not support this version, it responds with an EAP-Response of EAP type=TEAP and the highest supported version number that's less than the number proposed by the TEAP server. <br><br>
</dd>
<dt></dt>
<dd style="margin-left: 8">If the TEAP server does not support the version number proposed by the TEAP peer, it MAY terminate the conversation with EAP-Failure or negotiate for another EAP type.  Otherwise the TEAP conversation continues.</dd>
</dl>
<p id="rfc.section.3.1.p.4">The version negotiation procedure guarantees that the TEAP peer and server will agree to the latest version supported by both parties.  If version negotiation fails, then use of TEAP will not be possible, and another mutually acceptable EAP method will need to be negotiated if authentication is to proceed.</p>
<p id="rfc.section.3.1.p.5">The TEAP version is not protected by TLS; and hence can be modified in transit. In order to detect a modification of the TEAP version, the peers MUST exchange the TEAP version number received during version negotiation using the Crypto-Binding TLV described in <a href="#cbtlv">Section 4.2.9</a>. The receiver of the Crypto-Binding TLV MUST verify that the version received in the Crypto-Binding TLV matches the version sent by the receiver in the TEAP version negotiation.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#phase1" id="phase1">TEAP Authentication Phase 1: Tunnel Establishment</a>
</h1>
<p id="rfc.section.3.2.p.1">TEAP is based on the TLS handshake <a href="#RFC5246">[RFC5246]</a> to establish an authenticated and protected tunnel. The TLS version offered by the peer and server MUST be TLS version 1.2 <a href="#RFC5246">[RFC5246]</a> or later.  This version of the TEAP implementation MUST support the following TLS ciphersuites:</p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 8">TLS_RSA_WITH_AES_128_CBC_SHA <a href="#RFC3268">[RFC3268]</a>
</dd>
<dt></dt>
<dd style="margin-left: 8">TLS_DHE_RSA_WITH_AES_128_CBC_SHA <a href="#RFC3268">[RFC3268]</a>
</dd>
</dl>
<p id="rfc.section.3.2.p.3">Other ciphersuites MAY be supported. It is RECOMMENDED that anonymous ciphersuites such as TLS_DH_anon_WITH_AES_128_CBC_SHA only be used in the case when the inner authentication method provides man-in-the-middle protection [Editor's Note: The use of Anonymous Cipher Suites is still under discussion on the list]. Care must be taken to address potential man-in-the-middle attacks when ciphersuites that do not provide authenticated tunnel establishment are used. During the TEAP Phase 1 conversation the TEAP endpoints MAY negotiate TLS compression. During TLS tunnel establishment, TLS extensions MAY be used. For instance, Certificate Status Request extension <a href="#RFC6066">[RFC6066]</a> can be used to leverage a certificate-status protocol such as OCSP <a href="#RFC2560">[RFC2560]</a> to check the validity of server certificates.  TLS renegotiation indications defined in RFC 5746 <a href="#RFC5746">[RFC5746]</a> MUST be supported.</p>
<p id="rfc.section.3.2.p.4">The EAP server initiates the TEAP conversation with an EAP request containing an TEAP/Start packet. This packet includes a set Start (S) bit, the TEAP version as specified in <a href="#versionnegotiation">Section 3.1</a>, and an authority identity. The TLS payload in the initial packet is empty. The authority identity (Authority-ID TLV) is used to provide the peer a hint of the server's identity that may be useful in helping the peer select the appropriate credential to use. Assuming that the peer supports TEAP the conversation continues with the peer sending an EAP-Response packet with EAP type of TEAP with the Start (S) bit clear and the version as specified in <a href="#versionnegotiation">Section 3.1</a>. This message encapsulates one or more TLS records containing the TLS handshake messages. If the TEAP version negotiation is successful then the TEAP conversation continues until the EAP server and EAP peer are ready to enter Phase 2. When the full TLS handshake is performed, then the first payload of TEAP Phase 2 MAY be sent along with server-finished handshake message to reduce the number of round trips.</p>
<p id="rfc.section.3.2.p.5">TEAP implementations MUST support client authentication during tunnel establishment using the TLS ciphersuites specified in <a href="#phase1">Section 3.2</a>.  The EAP peer does not need to authenticate as part of the TLS exchange, but can alternatively be authenticated through additional EAP exchanges carried out in Phase 2.</p>
<p id="rfc.section.3.2.p.6">The TEAP tunnel protects peer identity information exchanged during phase 2 from disclosure outside the tunnel. Implementations that wish to provide identity privacy for the peer identity must carefully consider what information is disclosed outside the tunnel prior to phase 2.  TEAP implementations SHOULD support the immediate renegotiation of a TLS session to initiate a new handshake message exchange under the protection of the current cipher suite. This allows support for protection of the peer's identity when using TLS client authentication.  </p>
<p id="rfc.section.3.2.p.7">The following sections describe resuming a TLS session based on server-side or client-side state.</p>
<h1 id="rfc.section.3.2.1">
<a href="#rfc.section.3.2.1">3.2.1.</a> <a href="#sessres" id="sessres">TLS Session Resume Using Server State</a>
</h1>
<p id="rfc.section.3.2.1.p.1">TEAP session resumption is achieved in the same manner TLS achieves session resume. To support session resumption, the server and peer must minimally cache the Session ID, master secret, and ciphersuite. The peer attempts to resume a session by including a valid Session ID from a previous handshake in its ClientHello message. If the server finds a match for the Session ID and is willing to establish a new connection using the specified session state, the server will respond with the same Session ID and proceed with the TEAP Authentication Phase 1 tunnel establishment based on a TLS abbreviated handshake. After a successful conclusion of the TEAP Authentication Phase 1 conversation, the conversation then continues on to Phase 2.</p>
<h1 id="rfc.section.3.2.2">
<a href="#rfc.section.3.2.2">3.2.2.</a> <a href="#tunnelpac" id="tunnelpac">TLS Session Resume Using a PAC</a>
</h1>
<p id="rfc.section.3.2.2.p.1">TEAP supports the resumption of sessions based on client-side state using the TLS SessionTicket extension techniques described in <a href="#RFC5077">[RFC5077]</a>.  This version of TEAP supports the provisioning of a ticket called a Protected Access Credential (PAC) through the use of the NewSessionTicket handshake described in <a href="#RFC5077">[RFC5077]</a>, as well as provisioning of a PAC inside the protected tunnel.  Implementations may provide additional ways to provision the PAC, such as manual configuration. Since the PAC mentioned here is used for establishing the TLS Tunnel, it is more specifically referred to as the Tunnel PAC. The Tunnel PAC is a security credential provided by the EAP server to a peer and comprised of:</p>
<p></p>

<ol>
<li>PAC-Key: this is the key used by the peer as the TLS master secret to establish the TEAP Phase 1 tunnel.  The PAC-Key is a strong high-entropy 48-octet key and is typically the master secret from a previous TLS session.  The PAC-Key is a secret and MUST be treated accordingly. In the case that a PAC-Key is provisioned to the client through another means it must have its confidentiality and integrity protected by a mechanism, such as the TEAP phase 2 tunnel. The PAC-Key must be stored securely by the peer. <br><br>
</li>
<li>PAC-Opaque: this is a variable length field containing the ticket that is sent to the EAP server during the TEAP Phase 1 tunnel establishment based on RFC 5077.  The PAC-Opaque can only be interpreted by the EAP server to recover the required information for the server to validate the peer's identity and authentication. The PAC-Opaque includes the PAC-Key and other TLS session parameters.  It may contain the PAC's peer identity.  The PAC-Opaque format and contents are specific to the PAC issuing server. The PAC-Opaque may be presented in the clear, so an attacker MUST NOT be able to gain useful information from the PAC-Opaque itself. The server issuing the PAC-Opaque must ensure it is protected with strong cryptographic keys and algorithms.  The PAC-Opaque may be distributed using the NewSessionTicket message defined in RFC 5077 or it may be distributed through another mechanism such as the phase 2 TLVs defined in this document.  <br><br>
</li>
<li>PAC-Info: this is an optional variable length field used to provide, at a minimum, the authority identity of the PAC issuer. Other useful but not mandatory information, such as the PAC-Key lifetime, may also be conveyed by the PAC issuing server to the peer during PAC provisioning or refreshment.  PAC-Info is not included if the NewSessionTicket message is used to provision the PAC.</li>
</ol>
<p id="rfc.section.3.2.2.p.3">The use of the PAC is based on the SessionTicket extension defined in <a href="#RFC5077">[RFC5077]</a>. The EAP server initiates the TEAP conversation as normal. Upon receiving the Authority-ID TLV from the server, the peer checks to see if it has an existing valid PAC-Key and PAC-Opaque for the server. If it does, then it obtains the PAC-Opaque and puts it in the SessionTicket extension in the ClientHello. It is RECOMMENDED in TEAP that the peer include an empty Session ID in a ClientHello containing a PAC-Opaque. This version of TEAP supports the NewSessionTicket Handshake message as described in <a href="#RFC5077">[RFC5077]</a> for distribution of a new PAC, as well as the provisioning of PAC inside the protected tunnel. If the PAC-Opaque included in the SessionTicket extension is valid and the EAP server permits the abbreviated TLS handshake, it will select the cipher suite from information within the PAC-Opaque and finish with the abbreviated TLS handshake. If the server receives a Session ID and a PAC-Opaque in the SessionTicket extension in a ClientHello, it should place the same Session ID in the ServerHello if it is resuming a session based on the PAC-Opaque.  The conversation then proceeds as described in <a href="#RFC5077">[RFC5077]</a> until the handshake completes or a fatal error occurs. After the abbreviated handshake completes, the peer and the server are ready to commence Phase 2.</p>
<h1 id="rfc.section.3.2.3">
<a href="#rfc.section.3.2.3">3.2.3.</a> Transition between Abbreviated and Full TLS Handshake</h1>
<p id="rfc.section.3.2.3.p.1">If session resumption based on server-side or client-side state fails, the server can gracefully fall back to a full TLS handshake. If the ServerHello received by the peer contains an empty Session ID or a Session ID that is different than in the ClientHello, the server may fall back to a full handshake. The peer can distinguish the server's intent of negotiating full or abbreviated TLS handshake by checking the next TLS handshake messages in the server response to the ClientHello.  If ChangeCipherSpec follows the ServerHello in response to the ClientHello, then the server has accepted the session resumption and intends to negotiate the abbreviated handshake. Otherwise, the server intends to negotiate the full TLS handshake. A peer can request for a new PAC to be provisioned after the full TLS handshake and mutual authentication of the peer and the server. In order to facilitate the fallback to a full handshake the peer SHOULD include cipher suites that allow for a full handshake and possibly PAC provisioning so the server can select one of these in case session resumption fails. An example of the transition is shown in <a href="#examples">Appendix Appendix C</a>.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#phase2" id="phase2">TEAP Authentication Phase 2: Tunneled Authentication</a>
</h1>
<p id="rfc.section.3.3.p.1">The second portion of the TEAP Authentication occurs immediately after successful completion of Phase 1. Phase 2 occurs even if both peer and authenticator are authenticated in the Phase 1 TLS negotiation. Phase 2 MUST NOT occur if the Phase 1 TLS handshake fails. Phase 2 consists of a series of requests and responses encapsulated in TLV objects defined in <a href="#tlvformat">Section 4.2</a>. Phase 2 MUST always end with a protected termination exchange described in <a href="#proterm">Section 3.3.3</a>. The TLV exchange may include the execution of zero or more EAP methods within the protected tunnel as described in <a href="#eapseq">Section 3.3.1</a>. A server MAY proceed directly to the protected termination exchange if it does not wish to request further authentication from the peer. However, the peer and server must not assume that either will skip inner EAP methods or other TLV exchanges.  The peer may have roamed to a network that requires conformance with a different authentication policy or the peer may request the server take additional action through the use of the Request-Action TLV.</p>
<h1 id="rfc.section.3.3.1">
<a href="#rfc.section.3.3.1">3.3.1.</a> <a href="#eapseq" id="eapseq">EAP Sequences</a>
</h1>
<p id="rfc.section.3.3.1.p.1">EAP <a href="#RFC3748">[RFC3748]</a> prohibits use of multiple authentication methods within a single EAP conversation in order to limit vulnerabilities to man-in-the-middle attacks. TEAP addresses man-in-the-middle attacks through support for cryptographic protection of the inner EAP exchange and cryptographic binding of the inner authentication method(s) to the protected tunnel. EAP methods are executed serially in a sequence. This version of TEAP does not support initiating multiple EAP methods simultaneously in parallel. The methods need not be distinct. For example, EAP-TLS could be run twice as an inner method, first using machine credentials followed by a second instance using user credentials.</p>
<p id="rfc.section.3.3.1.p.2">EAP method messages are carried within EAP-Payload TLVs defined in <a href="#eappayloadtlv">Section 4.2.6</a>. If more than one method is going to be executed in the tunnel, then upon method completion, the server MUST send an Intermediate-Result TLV indicating the result. The peer MUST respond to the Intermediate-Result TLV indicating its result. If the result indicates success, the Intermediate-Result TLV MUST be accompanied by a Crypto-Binding TLV.  The Crypto-Binding TLV is further discussed in <a href="#cbtlv">Section 4.2.9</a> and <a href="#compmac">Section 5.3</a>. The Intermediate-Result TLVs can be included with other TLVs such as EAP-Payload TLVs starting a new EAP conversation or with the Result TLV used in the protected termination exchange. </p>
<p id="rfc.section.3.3.1.p.3">If both peer and server indicate success, then the method is considered complete. If either indicates failure, then the method is considered failed. The result of failure of an EAP method does not always imply a failure of the overall authentication. If one authentication method fails, the server may attempt to authenticate the peer with a different method.</p>
<h1 id="rfc.section.3.3.2">
<a href="#rfc.section.3.3.2">3.3.2.</a> <a href="#passauth" id="passauth">Optional Password Authentication</a>
</h1>
<p id="rfc.section.3.3.2.p.1">The use of EAP-FAST-GTC as defined in RFC 5421 <a href="#RFC5421">[RFC5421]</a> is not recommended with TEAPv1.  Implementations should instead make use of the password authentication TLVs defined in this specification. The authentication server initiates password authentication by sending a Basic-Password-Auth-Req TLV defined in <a href="#passreq">Section 4.2.17</a>.  If the peer wishes to participate in password authentication then it responds with a Basic-Password-Auth-Resp TLV as defined in <a href="#passresp">Section 4.2.18</a> that contains the username and password.  If it does not wish to perform password authentication then it responds with a NAK TLV indicating the rejection of the Basic-Password-Auth-Req TLV.  Upon receiving the response the server indicates the success or failure of the exchange using an Intermediate-Result TLV.  Multiple roundtrips of password authentication requests and responses MAY be used to support some "housecleaning" functions such as password change, change pin, etc.  before a user is authenticated.  </p>
<h1 id="rfc.section.3.3.3">
<a href="#rfc.section.3.3.3">3.3.3.</a> <a href="#proterm" id="proterm">Protected Termination and Acknowledged Result Indication</a>
</h1>
<p id="rfc.section.3.3.3.p.1">A successful TEAP Phase 2 conversation MUST always end in a successful Result TLV exchange. An TEAP server may initiate the Result TLV exchange without initiating any EAP conversation in TEAP Phase 2. After the final Result TLV exchange, the TLS tunnel is terminated and a clear text EAP-Success or EAP-Failure is sent by the server. The format of the Result TLV is described in <a href="#resulttlv">Section 4.2.2</a>.</p>
<p id="rfc.section.3.3.3.p.2">A server initiates a successful protected termination exchange by sending a Result TLV indicating success. The server may send the Result TLV along with an Intermediate-Result TLV and a Crypto-Binding TLV. If the peer requires nothing more from the server it will respond with a Result TLV indicating success accompanied by an Intermediate-Result TLV and Crypto-Binding TLV if necessary. The server then tears down the tunnel and sends a clear text EAP-Success.</p>
<p id="rfc.section.3.3.3.p.3">If the peer receives a Result TLV indicating success from the server, but its authentication policies are not satisfied (for example it requires a particular authentication mechanism be run or it wants to request a PAC), it may request further action from the server using the Request-Action TLV. The Request-Action TLV is sent along with the Result TLV indicating what EAP Success/Failure result the peer would expect if the requested action is not granted. The value of the Request-Action TLV indicates what the peer would like to do next. The format and values for the Request-Action TLV are defined in <a href="#ratlv">Section 4.2.11</a>.</p>
<p id="rfc.section.3.3.3.p.4">Upon receiving the Request-Action TLV the server may process the request or ignore it, based on its policy. If the server ignores the request, it proceeds with termination of the tunnel and send the clear text EAP Success or Failure message based on the value of the peer's result TLV. If the server honors and processes the request, it continues with the requested action. The conversation completes with a Result TLV exchange. The Result TLV may be included with the TLV that completes the requested action.</p>
<p id="rfc.section.3.3.3.p.5">Error handling for Phase 2 is discussed in <a href="#phase2err">Section 3.6.2</a>.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#peerid" id="peerid">Determining Peer-Id and Server-Id</a>
</h1>
<p id="rfc.section.3.4.p.1">The Peer-Id and Server-Id may be determined based on the types of credentials used during either the TEAP tunnel creation or authentication. In the case of multiple peer authentications, the Peer-ID is determined from the first peer authenticatication.</p>
<p id="rfc.section.3.4.p.2">When X.509 certificates are used for peer authentication, the Peer-Id is determined by the subject or subjectAltName fields in the peer certificate.  As noted in <a href="#RFC3280">[RFC3280]</a> (updated by <a href="#RFC4630">[RFC4630]</a>):</p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 2">The subject field identifies the entity associated with the public key stored in the subject public key field.  The subject name MAY be carried in the subject field and/or the subjectAltName extension....  If subject naming information is present only in the subjectAltName extension (e.g., a key bound only to an email address or URI), then the subject name MUST be an empty sequence and the subjectAltName extension MUST be critical.</dd>
<dt></dt>
<dd style="margin-left: 2">Where it is non-empty, the subject field MUST contain an X.500 distinguished name (DN).</dd>
</dl>
<p id="rfc.section.3.4.p.4">If an inner EAP method is run, then the Peer-Id is obtained from the inner method.</p>
<p id="rfc.section.3.4.p.5">When the server uses an X.509 certificate to establish the TLS tunnel, the Server-Id is determined in a similar fashion as stated above for the Peer-Id; e.g., the subject or subjectAltName field in the server certificate defines the Server-Id.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> <a href="#sessionid" id="sessionid">TEAP Session Identifier</a>
</h1>
<p id="rfc.section.3.5.p.1">The EAP session identifier is constructed using the random values provided by the peer and server during the TLS tunnel establishment.  The randoms from the outermost TLS handshake are used in the case that renegotiation is used.  The Session-Id is defined as follows:</p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 2">Session-Id  = teap_type || client_random || server_random</dd>
<dt></dt>
<dd style="margin-left: 2">type_type = EAP method type assigned to TEAP</dd>
<dt></dt>
<dd style="margin-left: 2">client_random = 32 octet nonce generated by the peer for the initial TLS handshake</dd>
<dt></dt>
<dd style="margin-left: 2">server_random = 32 octet nonce generated by the server for the initial TLS handshake</dd>
</dl>
<h1 id="rfc.section.3.6">
<a href="#rfc.section.3.6">3.6.</a> <a href="#error" id="error">Error Handling</a>
</h1>
<p id="rfc.section.3.6.p.1">TEAP uses the following error handling rules summarized below:</p>
<p></p>

<ol>
<li>Errors in the TLS layer are communicated via TLS alert messages in all phases of TEAP.</li>
<li>The Intermediate-Result TLVs carry success or failure indications of the individual EAP methods in TEAP Phase 2.  Errors within the EAP conversation in Phase 2 are expected to be handled by individual EAP methods.</li>
<li>Violations of the TLV rules are handled using Result TLVs together with Error TLVs.</li>
<li>Tunnel compromised errors (errors caused by Crypto-Binding failed or missing) are handled using Result TLVs and Error TLVs.</li>
</ol>
<h1 id="rfc.section.3.6.1">
<a href="#rfc.section.3.6.1">3.6.1.</a> <a href="#tlserr" id="tlserr">TLS Layer Errors</a>
</h1>
<p id="rfc.section.3.6.1.p.1">If the TEAP server detects an error at any point in the TLS Handshake or the TLS layer, the server SHOULD send an TEAP request encapsulating a TLS record containing the appropriate TLS alert message rather than immediately terminating the conversation so as to allow the peer to inform the user of the cause of the failure and possibly allow for a restart of the conversation. The peer MUST send an TEAP response to an alert message. The EAP-Response packet sent by the peer may encapsulate a TLS ClientHello handshake message, in which case the TEAP server MAY allow the TEAP conversation to be restarted, or it MAY contain an TEAP response with a zero-length message, in which case the server MUST terminate the conversation with an EAP-Failure packet.  It is up to the TEAP server whether to allow restarts, and if so, how many times the conversation can be restarted. An TEAP server implementing restart capability SHOULD impose a limit on the number of restarts, so as to protect against denial-of-service attacks.</p>
<p id="rfc.section.3.6.1.p.2">If the TEAP peer detects an error at any point in the TLS layer, the TEAP peer should send an TEAP response encapsulating a TLS record containing the appropriate TLS alert message. The server may restart the conversation by sending an TEAP request packet encapsulating the TLS HelloRequest handshake message. The peer may allow the TEAP conversation to be restarted or it may terminate the conversation by sending an TEAP response with an zero-length message.</p>
<h1 id="rfc.section.3.6.2">
<a href="#rfc.section.3.6.2">3.6.2.</a> <a href="#phase2err" id="phase2err">Phase 2 Errors</a>
</h1>
<p id="rfc.section.3.6.2.p.1">Any time the peer or the server finds a fatal error outside of the TLS layer during Phase 2 TLV processing, it MUST send a Result TLV of failure and an Error TLV with the appropriate error code. For errors involving the processing of the sequence of exchanges, such as a violation of TLV rules (e.g., multiple EAP-Payload TLVs), the error code is Unexpected_TLVs_Exchanged. For errors involving a tunnel compromise, the error-code is Tunnel_Compromise_Error. Upon sending a Result TLV with a fatal Error TLV the sender terminates the TLS tunnel. Note that a server will still wait for a message from the peer after it sends a failure, however the server does not need to process the contents of the response message.</p>
<p id="rfc.section.3.6.2.p.2">If a server receives a Result TLV of failure with a fatal Error TLV, it SHOULD send a clear text EAP-Failure. If a peer receives a Result TLV of failure, it MUST respond with a Result TLV indicating failure. If the server has sent a Result TLV of failure, it ignores the peer response, and it SHOULD send a clear text EAP-Failure.</p>
<h1 id="rfc.section.3.7">
<a href="#rfc.section.3.7">3.7.</a> <a href="#frag" id="frag">Fragmentation</a>
</h1>
<p id="rfc.section.3.7.p.1">A single TLS record may be up to 16384 octets in length, but a TLS message may span multiple TLS records, and a TLS certificate message may in principle be as long as 16 MB. This is larger than the maximum size for a message on most media types, therefore it is desirable to support fragmentation. Note that in order to protect against reassembly lockup and denial-of-service attacks, it may be desirable for an implementation to set a maximum size for one such group of TLS messages. Since a typical certificate chain is rarely longer than a few thousand octets, and no other field is likely to be anywhere near as long, a reasonable choice of maximum acceptable message length might be 64 KB. This is still a fairly large message packet size so an TEAP implementation MUST provide its own support for fragmentation and reassembly.</p>
<p id="rfc.section.3.7.p.2">Since EAP is a lock-step protocol, fragmentation support can be added in a simple manner. In EAP, fragments that are lost or damaged in transit will be retransmitted, and since sequencing information is provided by the Identifier field in EAP, there is no need for a fragment offset field.</p>
<p id="rfc.section.3.7.p.3">TEAP fragmentation support is provided through the addition of flag bits within the EAP-Response and EAP-Request packets, as well as a TLS Message Length field of four octets. Flags include the Length included (L), More fragments (M), and TEAP Start (S) bits. The L flag is set to indicate the presence of the four-octet TLS Message Length field, and MUST be set for the first fragment of a fragmented TLS message or set of messages. The M flag is set on all but the last fragment. The S flag is set only within the TEAP start message sent from the EAP server to the peer. The TLS Message Length field is four octets, and provides the total length of the TLS message or set of messages that is being fragmented; this simplifies buffer allocation.</p>
<p id="rfc.section.3.7.p.4">When an TEAP peer receives an EAP-Request packet with the M bit set, it MUST respond with an EAP-Response with EAP-Type of TEAP and no data. This serves as a fragment ACK. The EAP server must wait until it receives the EAP-Response before sending another fragment. In order to prevent errors in processing of fragments, the EAP server MUST increment the Identifier field for each fragment contained within an EAP-Request, and the peer must include this Identifier value in the fragment ACK contained within the EAP-Response. Retransmitted fragments will contain the same Identifier value.</p>
<p id="rfc.section.3.7.p.5">Similarly, when the TEAP server receives an EAP-Response with the M bit set, it must respond with an EAP-Request with EAP-Type of TEAP and no data. This serves as a fragment ACK. The EAP peer MUST wait until it receives the EAP-Request before sending another fragment. In order to prevent errors in the processing of fragments, the EAP server MUST increment the Identifier value for each fragment ACK contained within an EAP-Request, and the peer MUST include this Identifier value in the subsequent fragment contained within an EAP-Response.</p>
<h1 id="rfc.section.3.8">
<a href="#rfc.section.3.8">3.8.</a> <a href="#pacprovision" id="pacprovision">PAC Provisioning Within Tunnel</a>
</h1>
<p id="rfc.section.3.8.p.1">To request provisioning of a PAC, a peer sends a PAC TLV as defined in <a href="#pactlv">Section 4.2.8</a> containing a PAC Attribute as defined in <a href="#pacat">Section 4.2.8.1</a> of PAC Type set to the appropriate value.  The request MAY be issued after the peer has determined that it has successfully authenticated the EAP server and validated the Crypto-Binding TLV as defined in <a href="#cbtlv">Section 4.2.9</a> to ensure that the TLS tunnel's integrity is intact.  The peer MUST send separate PAC TLVs for each type of PAC it wants to be provisioned.  Multiple PAC TLVs can be sent in the same packet or different packets.  The EAP server will send the PACs after its internal policy has been satisfied, or it MAY ignore the request or request additional authentications if its policy dictates.  If a peer receives a PAC with an unknown type, it MUST ignore it.</p>
<p id="rfc.section.3.8.p.2">A PAC-TLV containing PAC-Acknowledge attribute MUST be sent by the peer to acknowledge the receipt of the Tunnel PAC.  A PAC-TLV conatining PAC-Acknowledge attribute MUST NOT be used by the peer to acknowledge the receipt of other types of PACs.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#messageformats" id="messageformats">Message Formats</a>
</h1>
<p id="rfc.section.4.p.1">The following sections describe the message formats used in TEAP.  The fields are transmitted from left to right in network byte order.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> TEAP Message Format</h1>
<p id="rfc.section.4.1.p.1">A summary of the TEAP Request/Response packet format is shown below.</p>
<div id="#rfc.figure.3"></div>
<pre>
 0                   1                   2                   3 
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|     Code      |   Identifier  |            Length             | 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|     Type      |   Flags | Ver |        Message Length         : 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
:         Message Length        |         TLS Data...            
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|       Outer TLVs...        
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ </pre>
<div id="#rfc.figure.4"></div>
<pre>   
       0 1 2 3 4 
      +-+-+-+-+-+ 
      |L M S R R| 
      +-+-+-+-+-+ 
      </pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 1"><dl>
<dt>Code</dt>
<dd style="margin-left: 3">
<br><br>The code field is one octet in length defined as follows:<br><br><ul class="empty">
<li>Request</li>
<li>Response<br><br>
</li>
</ul>
</dd>
<dt>Identifier</dt>
<dd style="margin-left: 3">
<br><br> The Identifier field is one octet and aids in matching responses with requests. The Identifier field MUST be changed on each Request packet. The Identifier field in the Response packet MUST match the Identifier field from the corresponding request.<br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 3">
<br><br>The Length field is two octets and indicates the length of the EAP packet including the Code, Identifier, Length, Type, Flags, Ver, Message Length, TLS Data, and Outer TLVs fields. Octets outside the range of the Length field should be treated as Data Link Layer padding and should be ignored on reception. <br><br>
</dd>
<dt>Type</dt>
<dd style="margin-left: 3">
<br><br>TBD for TEAP <br><br>
</dd>
<dt>Flags</dt>
<dd style="margin-left: 3">
<ul class="empty">
<li>Length included; set to indicate the presence of the four octet Message Length field</li>
<li>More fragments; set on all but the last fragment</li>
<li>TEAP start; set in an TEAP Start message</li>
<li>Reserved (must be zero)</li>
</ul>
<p> </p>
<br><br>
</dd>
<dt>Ver</dt>
<dd style="margin-left: 3">
<br><br> This field contains the version of the protocol. This document describes version 1 (001 in binary) of TEAP. <br><br>
</dd>
<dt>Message Length</dt>
<dd style="margin-left: 3">
<br><br> The Message Length field is four octets, and is present only if the L bit is set. This field provides the total length of the message that may be fragmented over the data fields of multiple packets. <br><br>
</dd>
<dt>TLS Data</dt>
<dd style="margin-left: 3">
<br><br> When the Data field is present, it consists of an encapsulated TLS packet in TLS record format. A TEAP packet with Flags and Version fields, but with zero length TLS data field, is used to indicate TEAP acknowledgement for either a fragmented message, a TLS Alert message or a TLS Finished message.</dd>
<dt>Outer TLVs</dt>
<dd style="margin-left: 3">
<br><br> The Outer-TLVs consist of the optional data used to help establishing the TLS tunnel in TLV format. They are only allowed in the first two messages in the TEAP protocol.  That is the first EAP server to peer message and first peer to EAP server message.  The start of the Outer-TLV can be derived from the EAP Length field and Message Length field.</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#tlvformat" id="tlvformat">TEAP TLV Format and Support</a>
</h1>
<p id="rfc.section.4.2.p.1">The TLVs defined here are standard Type-Length-Value (TLV) objects.  The TLV objects could be used to carry arbitrary parameters between EAP peer and EAP server within the protected TLS tunnel.</p>
<p id="rfc.section.4.2.p.2">The EAP peer may not necessarily implement all the TLVs supported by the EAP server. To allow for interoperability, TLVs are designed to allow an EAP server to discover if a TLV is supported by the EAP peer, using the NAK TLV. The mandatory bit in a TLV indicates whether support of the TLV is required. If the peer or server does not support a TLV marked mandatory, then it MUST send a NAK TLV in the response, and all the other TLVs in the message MUST be ignored. If an EAP peer or server finds an unsupported TLV that is marked as optional, it can ignore the unsupported TLV. It MUST NOT send an NAK TLV for a TLV that is not marked mandatory. If all TLVs in a message are marked optional and none are understood by the peer, then an EMPTY TEAP Phase 2 message must still be sent to the other side in order to continue the conversation.  </p>
<p id="rfc.section.4.2.p.3">Note that a peer or server may support a TLV with the mandatory bit set, but may not understand the contents. The appropriate response to a supported TLV with content that is not understood is defined by the individual TLV specification.</p>
<p id="rfc.section.4.2.p.4">EAP implementations compliant with this specification MUST support TLV exchanges, as well as the processing of mandatory/optional settings on the TLV. Implementations conforming to this specification MUST support the following TLVs:<br><br></p>

<dl>
<dt></dt>
<dd style="margin-left: 3">Result TLV</dd>
<dt></dt>
<dd style="margin-left: 3">NAK TLV</dd>
<dt></dt>
<dd style="margin-left: 3">Error TLV</dd>
<dt></dt>
<dd style="margin-left: 3">EAP-Payload TLV</dd>
<dt></dt>
<dd style="margin-left: 3">Intermediate-Result TLV</dd>
<dt></dt>
<dd style="margin-left: 3">Crypto-Binding TLV</dd>
<dt></dt>
<dd style="margin-left: 3">Authority-ID TLV</dd>
<dt></dt>
<dd style="margin-left: 3">Request-Action TLV</dd>
</dl>
<h1 id="rfc.section.4.2.1">
<a href="#rfc.section.4.2.1">4.2.1.</a> <a href="#basicformat" id="basicformat">General TLV Format</a>
</h1>
<p id="rfc.section.4.2.1.p.1">TLVs are defined as described below. The fields are transmitted from left to right.</p>
<div id="#rfc.figure.5"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|M|R|            TLV Type       |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              Value...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 0"><dl>
<dt>M</dt>
<dd style="margin-left: 3">
<br><br><ul class="empty">
<li>Optional TLV</li>
<li>Mandatory TLV<br><br>
</li>
</ul>
</dd>
<dt>R</dt>
<dd style="margin-left: 3">
<br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 3">
<br><br>A 14-bit field, denoting the TLV type. Allocated Types include: <br><br><ul class="empty">
<li>Unassigned</li>
<li>Authority-ID TLV (<a href="#aidtlv">Section 4.2.10</a>)</li>
<li>Identity-Type TLV (<a href="#identitytype">Section 4.2.16</a>)</li>
<li>Result TLV (<a href="#resulttlv">Section 4.2.2</a>)</li>
<li>NAK TLV (<a href="#naktlv">Section 4.2.3</a>)</li>
<li>Error TLV (<a href="#errtlv">Section 4.2.4</a>)</li>
<li>Channel-Binding TLV (<a href="#channelbinding">Section 4.2.15</a>)</li>
<li>Vendor-Specific TLV (<a href="#vendortlv">Section 4.2.5</a>)</li>
<li>Unassigned</li>
<li>EAP-Payload TLV (<a href="#eappayloadtlv">Section 4.2.6</a>)</li>
<li>Intermediate-Result TLV (<a href="#intrestlv">Section 4.2.7</a>)</li>
<li>PAC TLV (<a href="#pactlv">Section 4.2.8</a>)</li>
<li>Crypto-Binding TLV (<a href="#cbtlv">Section 4.2.9</a>)</li>
<li>Basic-Password-Auth-Req TLV (<a href="#passreq">Section 4.2.17</a>)</li>
<li>Basic-Password-Auth-Resp TLV (<a href="#passresp">Section 4.2.18</a>)</li>
<li>PKCS#10 TLV (<a href="#pkcs10tlv">Section 4.2.14</a>)</li>
<li>Unassigned</li>
<li>Unassigned</li>
<li>Server-Trusted-Root TLV (<a href="#trustroottlv">Section 4.2.12</a>)</li>
<li>Request-Action TLV (<a href="#ratlv">Section 4.2.11</a>)</li>
<li>PKCS#7 TLV (<a href="#pkcstlv">Section 4.2.13</a>)</li>
</ul>
<br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 3">
<br><br>The length of the Value field in octets.<br><br>
</dd>
<dt>Value</dt>
<dd style="margin-left: 3">
<br><br> The value of the TLV.</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.2.2">
<a href="#rfc.section.4.2.2">4.2.2.</a> <a href="#resulttlv" id="resulttlv">Result TLV</a>
</h1>
<p id="rfc.section.4.2.2.p.1">The Result TLV provides support for acknowledged success and failure messages for protected termination within TEAP. If the Status field does not contain one of the known values, then the peer or EAP server MUST treat this as a fatal error of Unexpected_TLVs_Exchanged. The behavior of the Result TLV is further discussed in <a href="#proterm">Section 3.3.3</a> and <a href="#phase2err">Section 3.6.2</a>. A Result TLV indicating failure MUST NOT be accompanied by the following TLVs: NAK, EAP-Payload TLV, or Crypto-Binding TLV. The Result TLV is defined as follows:</p>
<div id="#rfc.figure.6"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|M|R|         TLV Type          |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             Status            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 0"><dl>
<dt>M</dt>
<dd style="margin-left: 3">
<br><br>Mandatory, set to one (1)<br><br>
</dd>
<dt>R</dt>
<dd style="margin-left: 3">
<br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 3">
<br><br>3 for Result TLV<br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 3">
<br><br>2<br><br>
</dd>
<dt>Status</dt>
<dd style="margin-left: 3">
<br><br>The Status field is two octets. Values include: <br><br><dl>
<dt>1</dt>
<dd style="margin-left: 8">Success</dd>
<dt>2</dt>
<dd style="margin-left: 8">Failure<br><br>
</dd>
</dl>
</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.2.3">
<a href="#rfc.section.4.2.3">4.2.3.</a> <a href="#naktlv" id="naktlv">NAK TLV</a>
</h1>
<p id="rfc.section.4.2.3.p.1">The NAK TLV allows a peer to detect TLVs that are not supported by the other peer. An TEAP packet can contain 0 or more NAK TLVs. A NAK TLV should not be accompanied by other TLVs. A NAK TLV MUST NOT be sent in response to a message containing a Result TLV, instead a Result TLV of failure should be sent indicating failure and an Error TLV of Unexpected_TLVs_Exchanged. The NAK TLV is defined as follows:</p>
<div id="#rfc.figure.7"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|M|R|         TLV Type          |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          Vendor-Id                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            NAK-Type           |           TLVs...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 0"><dl>
<dt>M</dt>
<dd style="margin-left: 3">
<br><br>Mandatory, set to one (1)<br><br>
</dd>
<dt>R</dt>
<dd style="margin-left: 3">
<br><br><br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 3">
<br><br>4 for NAK TLV<br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 3">
<br><br>&gt;=6<br><br>
</dd>
<dt>Vendor-Id</dt>
<dd style="margin-left: 3">
<br><br>The Vendor-Id field is four octets, and contains the Vendor-Id of the TLV that was not supported. The high-order octet is 0 and the low-order three octets are the Structure of Management Information (SMI) Network Management Private Enterprise Code of the Vendor in network byte order.  The Vendor-Id field MUST be zero for TLVs that are not Vendor-Specific TLVs. <br><br>
</dd>
<dt>NAK-Type</dt>
<dd style="margin-left: 3">
<br><br>The NAK-Type field is two octets. The field contains the Type of the TLV that was not supported. A TLV of this Type MUST have been included in the previous packet.<br><br>
</dd>
<dt>TLVs</dt>
<dd style="margin-left: 3">
<br><br> This field contains a list of zero or more TLVs, each of which MUST NOT have the mandatory bit set. These optional TLVs are for future extensibility to communicate why the offending TLV was determined to be unsupported.<br><br>
</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.2.4">
<a href="#rfc.section.4.2.4">4.2.4.</a> <a href="#errtlv" id="errtlv">Error TLV</a>
</h1>
<p id="rfc.section.4.2.4.p.1">The Error TLV allows an EAP peer or server to indicate errors to the other party. An TEAP packet can contain 0 or more Error TLVs. The Error-Code field describes the type of error. Error Codes 1-999 represent successful outcomes (informative messages), 1000-1999 represent warnings, and codes 2000-2999 represent fatal errors. A fatal Error TLV MUST be accompanied by a Result TLV indicating failure and the conversation must be terminated as described in <a href="#phase2err">Section 3.6.2</a>. The Error TLV is defined as follows:</p>
<div id="#rfc.figure.8"></div>
<pre>

 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|M|R|         TLV Type          |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Error-Code                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	</pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 0"><dl>
<dt>M</dt>
<dd style="margin-left: 3">
<br><br>Mandatory, set to one (1)<br><br>
</dd>
<dt>R</dt>
<dd style="margin-left: 3">
<br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 3">
<br><br>5 for Error TLV <br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 3">
<br><br>4 <br><br>
</dd>
<dt>Error-Code</dt>
<dd style="margin-left: 3">
<br><br> The Error-Code field is four octets. Currently defined values for Error-Code include:<br><br> <dl>
<dt></dt>
<dd style="margin-left: 8">2001 Tunnel_Compromise_Error</dd>
<dt></dt>
<dd style="margin-left: 8">2002 Unexpected_TLVs_Exchanged</dd>
</dl>
</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.2.5">
<a href="#rfc.section.4.2.5">4.2.5.</a> <a href="#vendortlv" id="vendortlv">Vendor-Specific TLV</a>
</h1>
<p id="rfc.section.4.2.5.p.1">The Vendor-Specific TLV is available to allow vendors to support their own extended attributes not suitable for general usage. A Vendor-Specific TLV attribute can contain one or more TLVs, referred to as Vendor TLVs. The TLV-type of a Vendor-TLV is defined by the vendor. All the Vendor TLVs inside a single Vendor-Specific TLV belong to the same vendor. There can be multiple Vendor-Specific TLVs from different vendors in the same message.</p>
<p id="rfc.section.4.2.5.p.2">Vendor TLVs may be optional or mandatory. Vendor TLVs sent with Result TLVs MUST be marked as optional.</p>
<p id="rfc.section.4.2.5.p.3">The Vendor-Specific TLV is defined as follows:</p>
<div id="#rfc.figure.9"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|M|R|         TLV Type          |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          Vendor-Id                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Vendor TLVs....
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 0"><dl>
<dt>M</dt>
<dd style="margin-left: 3">
<br><br>0 or 1<br><br>
</dd>
<dt>R</dt>
<dd style="margin-left: 3">
<br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 3">
<br><br>7 for Vendor Specific TLV<br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 3">
<br><br>4 + cumulative length of all included Vendor TLVs<br><br>
</dd>
<dt>Vendor-Id</dt>
<dd style="margin-left: 3">
<br><br>The Vendor-Id field is four octets, and contains the Vendor-Id of the TLV. The high-order octet is 0 and the low-order 3 octets are the SMI Network Management Private Enterprise Code of the Vendor in network byte order. <br><br>
</dd>
<dt>Vendor TLVs</dt>
<dd style="margin-left: 3">
<br><br>This field is of indefinite length. It contains vendor-specific TLVs, in a format defined by the vendor.</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.2.6">
<a href="#rfc.section.4.2.6">4.2.6.</a> <a href="#eappayloadtlv" id="eappayloadtlv">EAP-Payload TLV</a>
</h1>
<p id="rfc.section.4.2.6.p.1">To allow piggybacking an EAP request or response with other TLVs, the EAP-Payload TLV is defined, which includes an encapsulated EAP packet and a list of optional TLVs. The optional TLVs are provided for future extensibility to provide hints about the current EAP authentication. Only one EAP-Payload TLV is allowed in a message.  The EAP-Payload TLV is defined as follows:</p>
<div id="#rfc.figure.10"></div>
<pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|M|R|         TLV Type          |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          EAP packet...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             TLVs...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 0"><dl>
<dt>M</dt>
<dd style="margin-left: 3">
<br><br>Mandatory, set to (1)<br><br>
</dd>
<dt>R</dt>
<dd style="margin-left: 3">
<br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 3">
<br><br>9 for EAP-Payload TLV<br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 3">
<br><br>length of embedded EAP packet + cumulative length of additional TLVs<br><br>
</dd>
<dt>EAP packet</dt>
<dd style="margin-left: 3">
<br><br> This field contains a complete EAP packet, including the EAP header (Code, Identifier, Length, Type) fields. The length of this field is determined by the Length field of the encapsulated EAP packet.<br><br>
</dd>
<dt> TLVs</dt>
<dd style="margin-left: 3">
<br><br> This (optional) field contains a list of TLVs associated with the EAP packet field. The TLVs MUST NOT have the mandatory bit set. The total length of this field is equal to the Length field of the EAP-Payload TLV, minus the Length field in the EAP header of the EAP packet field.</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.2.7">
<a href="#rfc.section.4.2.7">4.2.7.</a> <a href="#intrestlv" id="intrestlv">Intermediate-Result TLV</a>
</h1>
<p id="rfc.section.4.2.7.p.1">The Intermediate-Result TLV provides support for acknowledged intermediate Success and Failure messages between multiple inner EAP methods within EAP. An Intermediate-Result TLV indicating success MUST be accompanied by a Crypto-Binding TLV. The optional TLVs associated with this TLV are provided for future extensibility to provide hints about the current result. The Intermediate-Result TLV is defined as follows:</p>
<div id="#rfc.figure.11"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|M|R|         TLV Type          |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             Status            |        TLVs...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 0"><dl>
<dt>M</dt>
<dd style="margin-left: 3">
<br><br>Mandatory, set to (1)<br><br>
</dd>
<dt>R</dt>
<dd style="margin-left: 3">
<br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 3">
<br><br>10 for Intermediate-Result TLV<br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 3">
<br><br>2 + cumulative length of the embedded associated TLVs<br><br>
</dd>
<dt>Status</dt>
<dd style="margin-left: 3">
<br><br>The Status field is two octets. Values include: <br><br> <dl>
<dt>1</dt>
<dd style="margin-left: 8">Success</dd>
<dt>2</dt>
<dd style="margin-left: 8">Failure<br><br>
</dd>
</dl>
</dd>
<dt>TLVs</dt>
<dd style="margin-left: 3">
<br><br>This field is of indeterminate length, and contains zero or more of the TLVs associated with the Intermediate Result TLV. The TLVs in this field MUST NOT have the mandatory bit set.</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.2.8">
<a href="#rfc.section.4.2.8">4.2.8.</a> <a href="#pactlv" id="pactlv">PAC TLV Format</a>
</h1>
<p id="rfc.section.4.2.8.p.1">The PAC TLV provides support for provisioning the Protected Access Credential (PAC) defined within <a href="#RFC4851">[RFC4851]</a>. The PAC TLV carries the PAC and related information within PAC attribute fields. Additionally, the PAC TLV MAY be used by the peer to request provisioning of a PAC of the type specified in the PAC Type PAC attribute.  The PAC TLV MUST only be used in a protected tunnel providing encryption and integrity protection. A general PAC TLV format is defined as follows:  </p>
<div id="#rfc.figure.12"></div>
<pre>
0                   1                   2                   3  
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|M|R|         TLV Type          |            Length             |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|                        PAC Attributes...  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  </pre>
<p></p>

<ul class="empty"><li><dl>
<dt>M</dt>
<dd style="margin-left: 5">
<br><br>0 - Non-mandatory TLV <br>1 - Mandatory TLV</dd>
<dt>R</dt>
<dd style="margin-left: 5">
<br><br>Reserved, set to zero (0)</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 5">
<br><br>11 - PAC TLV</dd>
<dt>Length</dt>
<dd style="margin-left: 5">
<br><br>Two octets containing the length of the PAC attributes field in octets.</dd>
<dt>PAC Attributes</dt>
<dd style="margin-left: 5">
<br><br>A list of PAC attributes in the TLV format.</dd>
</dl></li></ul>
<p></p>
<h1 id="rfc.section.4.2.8.1">
<a href="#rfc.section.4.2.8.1">4.2.8.1.</a> <a href="#pacat" id="pacat">Formats for PAC Attributes</a>
</h1>
<p id="rfc.section.4.2.8.1.p.1">Each PAC attribute in a PAC TLV is formatted as a TLV defined as follows:     </p>
<div id="#rfc.figure.13"></div>
<pre>
 0                   1                   2                   3  
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|            Type               |            Length             |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|                              Value...  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 	</pre>
<p><br><br>The Type field is two octets, denoting the attribute type.  Allocated Types include:</p>
<div id="#rfc.figure.14"></div>
<pre>
                  1 - PAC-Key
                  2 - PAC-Opaque
                  3 - PAC-Lifetime
                  4 - A-ID
                  5 - I-ID
                  6 - Reserved
                  7 - A-ID-Info
                  8 - PAC-Acknowledgement
                  9 - PAC-Info
                  10 - PAC-Type
</pre>
<p></p>
<p><br><br>Two octets containing the length of the Value field in octets.  </p>
<p><br><br>The value of the PAC attribute.</p>
<h1 id="rfc.section.4.2.8.2">
<a href="#rfc.section.4.2.8.2">4.2.8.2.</a> PAC-Key</h1>
<p id="rfc.section.4.2.8.2.p.1">The PAC-Key is a secret key distributed in a PAC attribute of type PAC-Key. The PAC-Key attribute is included within the PAC TLV whenever the server wishes to issue or renew a PAC that is bound to a key such as a Tunnel PAC. The key is a randomly generated octet string, which is 48 octets in length.  The generator of this key is the issuer of the credential, which is identified by the Authority Identifier (A-ID). </p>
<div id="#rfc.figure.15"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|            Type               |            Length             |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|                                                               |  
~                              Key                              ~  
|                                                               |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  </pre>
<p></p>

<ul class="empty"><li>
<dl>
<dt>Type</dt>
<dd style="margin-left: 8">
<br><br>1 - PAC-Key</dd>
<dt>Length</dt>
<dd style="margin-left: 8">
<br><br>2-octet length indicating the length of the key</dd>
<dt>Key</dt>
<dd style="margin-left: 8">
<br><br>The value of the PAC-Key.</dd>
</dl>
<p> </p>
</li></ul>
<h1 id="rfc.section.4.2.8.3">
<a href="#rfc.section.4.2.8.3">4.2.8.3.</a> PAC-Opaque</h1>
<p id="rfc.section.4.2.8.3.p.1">The PAC-Opaque attribute is included within the PAC TLV whenever the server wishes to issue or renew a PAC.  </p>
<p id="rfc.section.4.2.8.3.p.2">The PAC-Opaque is opaque to the peer and thus the peer MUST NOT attempt to interpret it.  A peer that has been issued a PAC-Opaque by a server stores that data and presents it back to the server according to its PAC Type.  The Tunnel PAC is used in the ClientHello SessionTicket extension field defined in <a href="#RFC5077">[RFC5077]</a>. If a peer has opaque data issued to it by multiple servers, then it stores the data issued by each server separately according to the A-ID.  This requirement allows the peer to maintain and use each opaque datum as an independent PAC pairing, with a PAC-Key mapping to a PAC-Opaque identified by the A-ID. As there is a one-to-one correspondence between the PAC-Key and PAC-Opaque, the peer determines the PAC-Key and corresponding PAC-Opaque based on the A-ID provided in the TEAP/Start message and the A-ID provided in the PAC-Info when it was provisioned with a PAC-Opaque. </p>
<p id="rfc.section.4.2.8.3.p.3">The PAC-Opaque attribute format is summarized as follows:</p>
<div id="#rfc.figure.16"></div>
<pre>
 0                   1                   2                   3  
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1   
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|            Type               |            Length             |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|                              Value ...                                    
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ </pre>
<p></p>

<ul class="empty"><li><dl>
<dt>Type</dt>
<dd style="margin-left: 8">
<br><br>2 - PAC-Opaque </dd>
<dt>Length</dt>
<dd style="margin-left: 8">
<br><br>The Length filed is two octets, which contains the length of the Value field in octets.</dd>
<dt>Value</dt>
<dd style="margin-left: 8">
<br><br>The Value field contains the actual data for the PAC-Opaque. It is specific to the server implementation.</dd>
</dl></li></ul>
<h1 id="rfc.section.4.2.8.4">
<a href="#rfc.section.4.2.8.4">4.2.8.4.</a> PAC-Info</h1>
<p id="rfc.section.4.2.8.4.p.1">The PAC-Info is comprised of a set of PAC attributes as defined in <a href="#pacat">Section 4.2.8.1</a>.  The PAC-Info attribute MUST contain the A-ID, A-ID-Info, and PAC-Type attributes.  Other attributes MAY be included in the PAC-Info to provide more information to the peer. The PAC-Info attribute MUST NOT contain the PAC-Key, PAC-Acknowledgement, PAC-Info, or PAC-Opaque attributes.  The PAC-Info attribute is included within the PAC TLV whenever the server wishes to issue or renew a PAC.</p>
<div id="#rfc.figure.17"></div>
<pre>
 0                   1                   2                   3 
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|            Type               |            Length             |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|                           Attributes...                        
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  </pre>
<p></p>

<ul class="empty"><li><dl>
<dt>Type</dt>
<dd style="margin-left: 8">
<br><br>9 - PAC-Info</dd>
<dt>Length</dt>
<dd style="margin-left: 8">
<br><br>2-octet Length field containing the length of the attributes field in octets. </dd>
<dt>Attributes</dt>
<dd style="margin-left: 8">
<br><br>The attributes field contains a list of PAC attributes.  Each mandatory and optional field type is defined as follows: <dl>
<dt>3 - PAC-LIFETIME</dt>
<dd style="margin-left: 8">
<br><br> This is a 4-octet quantity representing the expiration time of the credential expressed as the number of seconds, excluding leap seconds, after midnight UTC, January 1, 1970. This attribute MAY be provided to the peer as part of the PAC-Info.  </dd>
<dt>4 - A-ID</dt>
<dd style="margin-left: 8">
<br><br>The A-ID is the identity of the authority that issued the PAC.  The A-ID is intended to be unique across all issuing servers to avoid namespace collisions.  The A-ID is used by the peer to determine which PAC to employ. The A-ID is treated as an opaque octet string. This attribute MUST be included in the PAC-Info attribute.  The A-ID MUST match the Authority-ID the server used to establish the tunnel.  One method for generating the A-ID is to use a high-quality random number generator to generate a random number.  An alternate method would be to take the hash of the public key or public key certificate belonging a server represented by the A-ID.   </dd>
<dt>5 - I-ID</dt>
<dd style="margin-left: 8">
<br><br>Initiator identifier (I-ID) is the peer identity associated with the credential.   This identity is derived from the inner EAP exchange or from the client-side authentication during tunnel establishment if inner EAP method authentication is not used.  The server employs the I-ID in the TEAP phase 2 conversation to validate that the same peer identity used to execute TEAP phase 1 is also used in at minimum one inner EAP method in TEAP phase 2.  If the server is enforcing the I-ID validation on the inner EAP method, then the I-ID MUST be included in the PAC-Info, to enable the peer to also enforce a unique PAC for each unique user. If the I-ID is missing from the PAC-Info, it is assumed that the Tunnel PAC can be used for multiple users and the peer will not enforce the unique-Tunnel-PAC-per-user policy.</dd>
<dt>7 - A-ID-Info</dt>
<dd style="margin-left: 8">
<br><br>Authority Identifier Information is intended to provide a user-friendly name for the A-ID. It may contain the enterprise name and server name in a human-readable format. This TLV serves as an aid to the peer to better inform the end-user about the A-ID.  The name is encoded in UTF-8 <a href="#RFC3629">[RFC3629]</a> format. This attribute MUST be included in the PAC-Info.  </dd>
<dt>10 - PAC-type</dt>
<dd style="margin-left: 8">
<br><br>The PAC-Type is intended to provide the type of PAC. This attribute SHOULD be included in the PAC-Info. If the PAC-Type is not present, then it defaults to a Tunnel PAC (Type 1). </dd>
</dl>
<p> </p>
</dd>
</dl></li></ul>
<h1 id="rfc.section.4.2.8.5">
<a href="#rfc.section.4.2.8.5">4.2.8.5.</a> PAC-Acknowledgement TLV</h1>
<p id="rfc.section.4.2.8.5.p.1">The PAC-Acknowledgement is used to acknowledge the receipt of the Tunnel PAC by the peer. The peer includes the PAC-Acknowledgement TLV in a PAC-TLV sent to the server to indicate the result of the processing and storing of a newly provisioned Tunnel PAC. This TLV is only used when Tunnel PAC is provisioned.</p>
<div id="#rfc.figure.18"></div>
<pre>
 0                   1                   2                   3  
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|            Type               |            Length             |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|            Result             |                                 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  </pre>
<div id="#rfc.figure.19"></div>
<pre>
            1 - Success
            2 - Failure
</pre>
<p></p>

<ul class="empty"><li><dl>
<dt>Type</dt>
<dd style="margin-left: 8">
<br><br>8 - PAC-Acknowledgement</dd>
<dt>Length</dt>
<dd style="margin-left: 8">
<br><br>The length of this field is two octets containing a value of 2.</dd>
<dt>Result</dt>
<dd style="margin-left: 8">
<br><br>The resulting value MUST be one of the following: </dd>
<dt></dt>
<dd style="margin-left: 8"></dd>
</dl></li></ul>
<h1 id="rfc.section.4.2.8.6">
<a href="#rfc.section.4.2.8.6">4.2.8.6.</a> PAC-Type TLV</h1>
<p id="rfc.section.4.2.8.6.p.1">The PAC-Type TLV is a TLV intended to specify the PAC type. It is included in a PAC-TLV sent by the peer to request PAC provisioning from the server. Its format is described below: </p>
<div id="#rfc.figure.20"></div>
<pre>
 0                   1                   2                   3  
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|            Type               |            Length             |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|         PAC Type              |                                 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  </pre>
<div id="#rfc.figure.21"></div>
<pre>
            1 - Tunnel PAC
</pre>
<p></p>

<ul class="empty"><li><dl>
<dt>Type</dt>
<dd style="margin-left: 8">
<br><br>10 - PAC-Type </dd>
<dt>Length</dt>
<dd style="margin-left: 8">
<br><br>2-octet Length field with a value of 2</dd>
<dt>PAC Type</dt>
<dd style="margin-left: 8">
<br><br>This 2-octet field defines the type of PAC being requested or provisioned.  The following values are defined:</dd>
<dt></dt>
<dd style="margin-left: 8"></dd>
</dl></li></ul>
<h1 id="rfc.section.4.2.9">
<a href="#rfc.section.4.2.9">4.2.9.</a> <a href="#cbtlv" id="cbtlv">Crypto-Binding TLV</a>
</h1>
<p id="rfc.section.4.2.9.p.1">The Crypto-Binding TLV is used to prove that both the peer and server participated in the tunnel establishment and sequence of authentications. It also provides verification of the TEAP version negotiated before TLS tunnel establishment, see <a href="#versionnegotiation">Section 3.1</a>.</p>
<p id="rfc.section.4.2.9.p.2">The Crypto-Binding TLV MUST be included with the Intermediate-Result TLV to perform Cryptographic Binding after each successful EAP method in a sequence of EAP methods. The Crypto-Binding TLV can be issued at other times as well. </p>
<p id="rfc.section.4.2.9.p.3">The Crypto-Binding TLV is valid only if the following checks pass:</p>
<p></p>

<ul>
<li>The Crypto-Binding TLV version is supported</li>
<li>The MAC verifies correctly</li>
<li>The received version in the Crypto-Binding TLV matches the version sent by the receiver during the EAP version negotiation</li>
<li>The subtype is set to the correct value</li>
</ul>
<p id="rfc.section.4.2.9.p.5">If any of the above checks fails, then the TLV is invalid. An invalid Crypto-Binding TLV is a fatal error and is handled as described in <a href="#phase2err">Section 3.6.2</a></p>
<p id="rfc.section.4.2.9.p.6">The Crypto-Binding TLV is defined as follows:</p>
<div id="#rfc.figure.22"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|M|R|         TLV Type          |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Reserved   |    Version    |  Received Ver.|   Sub-Type    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                             Nonce                             ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                          Compound MAC                         ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 0"><dl>
<dt>M</dt>
<dd style="margin-left: 3">
<br><br>Mandatory, set to (1)<br><br>
</dd>
<dt>R</dt>
<dd style="margin-left: 3">
<br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 3">
<br><br>12 for Crypto-Binding TLV<br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 3">
<br><br>56<br><br>
</dd>
<dt>Reserved</dt>
<dd style="margin-left: 3">
<br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>Version</dt>
<dd style="margin-left: 3">
<br><br>The Version field is a single octet, which is set to the version of Crypto-Binding TLV the EAP method is using. For an implementation compliant with this version of TEAP, the version number MUST be set to 1.<br><br>
</dd>
<dt>Received Version</dt>
<dd style="margin-left: 3">
<br><br>The Received Version field is a single octet and MUST be set to the EAP version number received during version negotiation.  Note that this field only provides protection against downgrade attacks, where a version of EAP requiring support for this TLV is required on both sides.<br><br>
</dd>
<dt>Sub-Type</dt>
<dd style="margin-left: 3">
<br><br>The Sub-Type field is one octet. Defined values include <br><br><dl>
<dt>0</dt>
<dd style="margin-left: 8">Binding Request</dd>
<dt>1</dt>
<dd style="margin-left: 8">Binding Response<br><br>
</dd>
</dl>
</dd>
<dt>Nonce</dt>
<dd style="margin-left: 3">
<br><br> The Nonce field is 32 octets. It contains a 256-bit nonce that is temporally unique, used for compound MAC key derivation at each end. The nonce in a request MUST have its least significant bit set to 0 and the nonce in a response MUST have the same value as the request nonce except the least significant bit MUST be set to 1. <br><br>
</dd>
<dt>Compound MAC</dt>
<dd style="margin-left: 3">
<br><br> The Compound MAC field is 20 octets. This can be the Server MAC (B1_MAC) or the Client MAC (B2_MAC). The computation of the MAC is described in <a href="#compmac">Section 5.3</a>.</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.2.10">
<a href="#rfc.section.4.2.10">4.2.10.</a> <a href="#aidtlv" id="aidtlv">Authority-ID TLV</a>
</h1>
<div id="#rfc.figure.23"></div>
<pre>
 0                   1                   2                   3 
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|M|R|         TLV Type          |            Length             | 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|                              ID... 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
  </pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 0"><dl>
<dt>M</dt>
<dd style="margin-left: 3">
<br><br>Mandatory, set to (0)<br><br>
</dd>
<dt>R</dt>
<dd style="margin-left: 3">
<br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>Type</dt>
<dd style="margin-left: 3">
<br><br> The Type field is two octets. It is set to 16 for Authority ID<br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 3">
<br><br>The Length filed is two octets, which contains the length of the ID field in octets.<br><br>
</dd>
<dt>ID</dt>
<dd style="margin-left: 3">
<br><br>Hint of the identity of the server, to help the peer to match the credetials avaiable for the server. It should be unique across the deployment.</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.2.11">
<a href="#rfc.section.4.2.11">4.2.11.</a> <a href="#ratlv" id="ratlv">Request-Action TLV</a>
</h1>
<p id="rfc.section.4.2.11.p.1">The Request-Action TLV MAY be sent by the peer along with a Result TLV in response to a server's successful Result TLV. It allows the peer to request the EAP server to negotiate additional EAP methods or process TLVs specified in the response packet. The server MAY ignore this TLV.</p>
<p id="rfc.section.4.2.11.p.2">The Request-Action TLV is defined as follows:</p>
<div id="#rfc.figure.24"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|M|R|         TLV Type          |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             Action            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 0"><dl>
<dt>M</dt>
<dd style="margin-left: 1">
<br><br>Mandatory set to one (1)<br><br>
</dd>
<dt>R</dt>
<dd style="margin-left: 1">
<br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 1">
<br><br>19 for Request-Action TLV<br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 1">
<br><br>2<br><br>
</dd>
<dt>Action</dt>
<dd style="margin-left: 1">
<br><br> The Action field is two octets. Values include: <br><br><dl>
<dt>1</dt>
<dd style="margin-left: 8">Process-TLV</dd>
<dt>2</dt>
<dd style="margin-left: 8">Negotiate-EAP<br><br>
</dd>
</dl>
</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.2.12">
<a href="#rfc.section.4.2.12">4.2.12.</a> <a href="#trustroottlv" id="trustroottlv">Trusted-Server-Root TLV</a>
</h1>
<p id="rfc.section.4.2.12.p.1">Trusted-Server-Root TLV facilitates the request and delivery of a trusted server root certificate. The Trusted-Server-Root TLV can be exchanged in regular TEAP authentication mode or provisioning mode. The Trusted-Server-Root TLV is always marked as optional, and cannot be responded to with a Negative Acknowledgement (NAK) TLV. The Trusted-Server-Root TLV MUST only be sent as an inner TLV (inside the protection of the tunnel).</p>
<p id="rfc.section.4.2.12.p.2">After the peer has determined that it has successfully authenticated the EAP server and validated the Crypto-Binding TLV, it MAY send one or more Trusted-Server-Root TLVs (marked as optional) to request the trusted server root certificates from the EAP server. The EAP server MAY send one or more root certificates with a Public Key Cryptographic System #7 (PKCS#7) TLV inside Server-Trusted-Root TLV. The EAP server MAY also choose not to honor the request.  </p>
<p id="rfc.section.4.2.12.p.3">The Trusted-Server-Root TLV allows the peer to send a request to the EAP server for a list of trusted roots. The server may respond with one or more root certificates in PKCS#7 <a href="#RFC2315">[RFC2315]</a> format.</p>
<p id="rfc.section.4.2.12.p.4">If the EAP server sets the credential format to PKCS#7-Server- Certificate-Root, then the Trusted-Server-Root TLV should contain the root of the certificate chain of the certificate issued to the EAP server packaged in a PKCS#7 TLV.  If the Server certificate is a self-signed certificate, then the root is the self-signed certificate. </p>
<p id="rfc.section.4.2.12.p.5">If the Trusted-Server-Root TLV credential format contains a value unknown to the peer, then the EAP peer should ignore the TLV. </p>
<p id="rfc.section.4.2.12.p.6">The Trusted-Server-Root TLV is defined as follows: </p>
<div id="#rfc.figure.25"></div>
<pre>
 0                   1                   2                   3 
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|M|R|         TLV Type          |            Length             | 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|           Credential-Format   |     Cred TLVs... 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-</pre>
<p></p>

<ul class="empty"><li><dl>
<dt>M</dt>
<dd style="margin-left: 5">
<br><br>0 - Non-mandatory TLV</dd>
<dt>R</dt>
<dd style="margin-left: 5">
<br><br>Reserved, set to zero (0)</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 5">
<br><br>18 - Trusted-Server-Root TLV  [RFC4851]</dd>
<dt>Length</dt>
<dd style="margin-left: 5">
<br><br>&gt;=2 octets</dd>
<dt>Credential-Format</dt>
<dd style="margin-left: 5">
<br><br>The Credential-Format field is two octets.  Values include: <dl>
<dt></dt>
<dd style="margin-left: 8">1 - PKCS#7-Server-Certificate-Root</dd>
</dl>
</dd>
<dt>Cred TLVs</dt>
<dd style="margin-left: 5">
<br><br>This field is of indefinite length.  It contains TLVs associated with the credential format. The peer may leave this field empty when using this TLV to request server trust roots. </dd>
</dl></li></ul>
<h1 id="rfc.section.4.2.13">
<a href="#rfc.section.4.2.13">4.2.13.</a> <a href="#pkcstlv" id="pkcstlv">PKCS#7 TLV</a>
</h1>
<p id="rfc.section.4.2.13.p.1">The PKCS#7 TLV is sent by the EAP server to the peer inside the Server-Trusted-Root TLV. It contains PKCS#7-wrapped <a href="#RFC2315">[RFC2315]</a> X.509 certificates.  The format consists of a certificate or certificate chain in a Certificates-Only PKCS#7 SignedData message as defined in <a href="#RFC2311">[RFC2311]</a>.</p>
<p id="rfc.section.4.2.13.p.2">The PKCS#7 TLV is always marked as optional, which cannot be responded to with a NAK TLV.  TEAP server implementations that claim to support the dynamic provisioning defined in this document SHOULD support this TLV. TEAP peer implementations MAY support this TLV. </p>
<p id="rfc.section.4.2.13.p.3">If the PKCS#7 TLV contains a certificate or certificate chain that is not acceptable to the peer, then the peer MUST ignore the TLV. </p>
<p id="rfc.section.4.2.13.p.4">The PKCS#7 TLV is defined as follows: </p>
<div id="#rfc.figure.26"></div>
<pre>
 0                   1                   2                   3 
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|M|R|         TLV Type          |            Length             | 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|           PKCS #7 Data... 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- </pre>
<p></p>

<ul class="empty"><li><dl>
<dt>M</dt>
<dd style="margin-left: 8">
<br><br>0 - Optional TLV</dd>
<dt>R</dt>
<dd style="margin-left: 8">
<br><br>Reserved, set to zero (0)</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 8">
<br><br>20 - PKCS#7 TLV  [RFC4851]</dd>
<dt>Length</dt>
<dd style="margin-left: 8">
<br><br>The length of the PKCS #7 Data field. </dd>
<dt>PKCS #7 Data</dt>
<dd style="margin-left: 8">
<br><br> This field contains the X.509 certificate or certificate chain in a Certificates-Only PKCS#7 SignedData message.</dd>
</dl></li></ul>
<h1 id="rfc.section.4.2.14">
<a href="#rfc.section.4.2.14">4.2.14.</a> <a href="#pkcs10tlv" id="pkcs10tlv">PKCS#10 TLV</a>
</h1>
<p id="rfc.section.4.2.14.p.1">The PKCS#10 TLV is used by the peer to initiate the "simple PKI" Request/Response from <a href="#RFC5272">[RFC5272]</a>. The format of the request is as specified in Section 6.4 of <a href="#RFC4945">[RFC4945]</a>.</p>
<p id="rfc.section.4.2.14.p.2">The PKCS#10 TLV is always marked as optional, which cannot be responded to with a NAK TLV.   </p>
<p id="rfc.section.4.2.14.p.3">The PKCS#10 TLV is defined as follows: </p>
<div id="#rfc.figure.27"></div>
<pre>
 0                   1                   2                   3 
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|M|R|         TLV Type          |            Length             | 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|           PKCS #10 Data... 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- </pre>
<p></p>

<ul class="empty"><li><dl>
<dt>M</dt>
<dd style="margin-left: 8">
<br><br>0 - Optional TLV</dd>
<dt>R</dt>
<dd style="margin-left: 8">
<br><br>Reserved, set to zero (0)</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 8">
<br><br>[tbd]</dd>
<dt>Length</dt>
<dd style="margin-left: 8">
<br><br>The length of the PKCS #7 Data field. </dd>
<dt>PKCS #10 Data</dt>
<dd style="margin-left: 8">
<br><br> This field contains the PKCS#10 certificate request.</dd>
</dl></li></ul>
<h1 id="rfc.section.4.2.15">
<a href="#rfc.section.4.2.15">4.2.15.</a> <a href="#channelbinding" id="channelbinding">Channel-Binding TLV</a>
</h1>
<p id="rfc.section.4.2.15.p.1">The Channel-Binding TLV allows an EAP-peer to send channel binding data to the EAP-server as described in <a href="#I-D.ietf-emu-chbind">[I-D.ietf-emu-chbind]</a>.  TEAPv1 implementations MAY support this TLV, which cannot be responded to with a NAK TLV.  If the Channel-Binding data field does not contain one of the known values or if the EAP server does not support this TLV, then the server MUST ignore the value.  The Channel-Binding TLV is defined as follows: </p>
<div id="#rfc.figure.28"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|M|R|         TLV Type          |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Data ...              
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 0"><dl>
<dt>M</dt>
<dd style="margin-left: 1">
<br><br>0 (Optional)<br><br>
</dd>
<dt>R</dt>
<dd style="margin-left: 1">
<br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 1">
<br><br>6 for Channel-Binding TLV<br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 1">
<br><br>variable<br><br>
</dd>
<dt>Data</dt>
<dd style="margin-left: 1">
<br><br> The data field contains channel binding data defined in <a href="#I-D.ietf-emu-chbind">[I-D.ietf-emu-chbind]</a>. <br><br>
</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.2.16">
<a href="#rfc.section.4.2.16">4.2.16.</a> <a href="#identitytype" id="identitytype">Identity-Type TLV</a>
</h1>
<p id="rfc.section.4.2.16.p.1">The Identity-Type TLV allows an EAP server to send a hint to help the EAP peer select the right type of identity; for example; user or machine. TEAPv1 implementations MUST support this TLV. If the Identity-Type field does not contain one of the known values or if the EAP peer does not have an identity corresponding to the identity-type, then the peer SHOULD respond with a NAK TLV.  The Identity-Type TLV is defined as follows: </p>
<div id="#rfc.figure.29"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|M|R|         TLV Type          |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Identity-Type         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 0"><dl>
<dt>M</dt>
<dd style="margin-left: 1">
<br><br>0 (Optional)<br><br>
</dd>
<dt>R</dt>
<dd style="margin-left: 1">
<br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 1">
<br><br>17 for Identity-Type TLV<br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 1">
<br><br>2<br><br>
</dd>
<dt>Identity-Type</dt>
<dd style="margin-left: 1">
<br><br> The Identity-Type field is two octets. Values include: <br><br><dl>
<dt>1</dt>
<dd style="margin-left: 8">User</dd>
<dt>2</dt>
<dd style="margin-left: 8">Machine<br><br>
</dd>
</dl>
</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.2.17">
<a href="#rfc.section.4.2.17">4.2.17.</a> <a href="#passreq" id="passreq">Basic-Password-Auth-Req TLV</a>
</h1>
<p id="rfc.section.4.2.17.p.1">The Basic-Password-Auth-Req TLV is used by the authentication server to request a username and password from the peer.  It contains an optional user prompt message for the request.  The peer is expected to obtain the username and password and send them in a Basic-Password-Auth-Resp TLV.  </p>
<p id="rfc.section.4.2.17.p.2">The Basic-Password-Auth-Req TLV is defined as follows:</p>
<div id="#rfc.figure.30"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|M|R|         TLV Type          |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Prompt ....                        
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 0"><dl>
<dt>M</dt>
<dd style="margin-left: 1">
<br><br>0 (Optional)<br><br>
</dd>
<dt>R</dt>
<dd style="margin-left: 1">
<br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 1">
<br><br>13 for Basic-Password-Auth-Req TLV<br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 1">
<br><br>variable<br><br>
</dd>
<dt>Prompt</dt>
<dd style="margin-left: 1">
<br><br>optional user prompt message in UTF-8 format<br><br>
</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.2.18">
<a href="#rfc.section.4.2.18">4.2.18.</a> <a href="#passresp" id="passresp">Basic-Password-Auth-Resp TLV</a>
</h1>
<p id="rfc.section.4.2.18.p.1">The Basic-Password-Auth-Resp TLV is used by the peer to respond to a Basic-Password-Auth-Req TLV with a username and password.  The TLV contains a username and password.  The username and password are in UTF-8 format and prepared as defined in <a href="#RFC4013">SASLprep</a> <cite title="NONE">[RFC4013]</cite>.  </p>
<p id="rfc.section.4.2.18.p.2">The Basic-Password-Auth-Resp TLV is defined as follows:</p>
<div id="#rfc.figure.31"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|M|R|         TLV Type          |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Userlen     |             Username                         
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      ...     Username    ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Passlen     |             Password                         
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      ...     Password    ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 0"><dl>
<dt>M</dt>
<dd style="margin-left: 1">
<br><br>0 (Optional)<br><br>
</dd>
<dt>R</dt>
<dd style="margin-left: 1">
<br><br>Reserved, set to zero (0)<br><br>
</dd>
<dt>TLV Type</dt>
<dd style="margin-left: 1">
<br><br>14 for Basic-Password-Auth-Resp TLV<br><br>
</dd>
<dt>Length</dt>
<dd style="margin-left: 1">
<br><br>variable <br><br>
</dd>
<dt>Userlen</dt>
<dd style="margin-left: 1">
<br><br>Length of Username field in octets<br><br>
</dd>
<dt>Username</dt>
<dd style="margin-left: 1">
<br><br>Username in UTF-8 format<br><br>
</dd>
<dt>Passlen</dt>
<dd style="margin-left: 1">
<br><br>Length of Password field in octets<br><br>
</dd>
<dt>Password</dt>
<dd style="margin-left: 1">
<br><br>Password in UTF-8 format<br><br>
</dd>
</dl></dd>
</dl>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#tlvtable" id="tlvtable">Table of TLVs</a>
</h1>
<p id="rfc.section.4.3.p.1">The following table provides a guide to which TLVs may be found in which kinds of messages, and in what quantity. The messages are as follows: Request is an TEAP Request, Response is an TEAP Response, Success is a message containing a successful Result TLV, and Failure is a message containing a failed Result TLV.</p>
<div id="#rfc.figure.32"></div>
<pre>
Request  Response    Success   Failure   TLVs
0-1      0-1         0-1       0-1       Intermediate-Result
0-1      0-1         0         0         EAP-Payload
0-1      0-1         1         1         Result
0-1      0-1         0-1       0-1       Crypto-Binding
0+       0+          0+        0+        Error
0+       0+          0         0         NAK
0+       0+          0+        0+        Vendor-Specific [NOTE1]

0-1      0-1         0         0         Authority-ID
0        0-1         0-1       0-1       Request-Action
0        0-1         0         0         Channel-Binding 
0-1      0-1         0         0         Identity-Type 
0-1      0           0         0         Basic-Password-Auth-Req
0        0-1         0         0         Basic-Password-Auth-Resp
</pre>
<p id="rfc.section.4.3.p.2">[NOTE1] Vendor TLVs (included in Vendor-Specific TLVs) sent with a Result TLV MUST be marked as optional.</p>
<p id="rfc.section.4.3.p.3">The following table defines the meaning of the table entries in the sections below:</p>
<p id="rfc.section.4.3.p.4">0   This TLV MUST NOT be present in the message.</p>
<p id="rfc.section.4.3.p.5">0+  Zero or more instances of this TLV MAY be present in the message.</p>
<p id="rfc.section.4.3.p.6">0-1 Zero or one instance of this TLV MAY be present in the message.</p>
<p id="rfc.section.4.3.p.7">1   Exactly one instance of this TLV MUST be present in the message.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#crypto" id="crypto">Cryptographic Calculations</a>
</h1>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#phase1key" id="phase1key">TEAP Authentication Phase 1: Key Derivations</a>
</h1>
<p id="rfc.section.5.1.p.1">With TEAPv1, the TLS master secret is generated as specified in TLS.  If a PAC is used then the master secret is obtained as described in RFC 5077 <a href="#RFC5077">[RFC5077]</a>.  </p>
<p id="rfc.section.5.1.p.2">TEAPv1 makes use of the TLS Keying Material Exporters defined in RFC 5705 <a href="#RFC5705">[RFC5705]</a> to derive the session_key_seed.  The Label used in the derivation is "EXPORTER-TEAP-SKS".  The length of the session key seed material is 40 octets.  No context data is used in the export process.</p>
<p id="rfc.section.5.1.p.3">The session_key_seed is used by the TEAP Authentication Phase 2 conversation to both cryptographically bind the inner method(s) to the tunnel as well as generate the resulting TEAP session keys. The other quantities are used as they are defined in <a href="#RFC5246">[RFC5246]</a>.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#phase2key" id="phase2key">Intermediate Compound Key Derivations</a>
</h1>
<p id="rfc.section.5.2.p.1">The session_key_seed derived as part of TEAP Phase 2 is used in TEAP Phase 2 to generate an Intermediate Compound Key (IMCK) used to verify the integrity of the TLS tunnel after each successful inner authentication and in the generation of Master Session Key (MSK) and Extended Master Session Key (EMSK) defined in <a href="#RFC3748">[RFC3748]</a>. Note that the IMCK must be recalculated after each successful inner EAP method.</p>
<div id="#rfc.figure.33"></div>
<p></p>

<p>The first step in these calculations is the generation of the base compound key, IMCK[n] from the session_key_seed and any session keys derived from the successful execution of n inner EAP methods. The inner EAP method(s) may provide Master Session Keys, MSK1..MSKn, corresponding to inner methods 1 through n. The MSK is truncated at 32 octets if it is longer than 32 octets or padded to a length of 32 octets with zeros if it is less than 32 octets. If the ith inner method does not generate an MSK, then MSKi is set to zero (e.g., MSKi = 32 octets of 0x00s). If an inner method fails, then it is not included in this calculation. The derivations of S-IMCK is as follows:</p>
<pre>
   S-IMCK[0] = session_key_seed
   For j = 1 to n-1 do
        IMCK[j] = TLS-PRF(S-IMCK[j-1], "Inner Methods Compound Keys", 
             MSK[j], 60)
        S-IMCK[j] = first 40 octets of IMCK[j]
        CMK[j] = last 20 octets of IMCK[j]
</pre>
<p>where TLS-PRF is the PRF negotiated as part of TLS handshake <a href="#RFC5246">[RFC5246]</a>.</p>
<p></p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> <a href="#compmac" id="compmac">Computing the Compound MAC</a>
</h1>
<p id="rfc.section.5.3.p.1">For authentication methods that generate keying material, further protection against man-in-the-middle attacks is provided through cryptographically binding keying material established by both TEAP Phase 1 and TEAP Phase 2 conversations. After each successful inner EAP authentication, EAP MSKs are cryptographically combined with key material from TEAP Phase 1 to generate a compound session key, CMK. The CMK is used to calculate the Compound MAC as part of the Crypto-Binding TLV described in <a href="#cbtlv">Section 4.2.9</a>, which helps provide assurance that the same entities are involved in all communications in TEAP. During the calculation of the Compound-MAC the MAC field is filled with zeros.</p>
<div id="#rfc.figure.34"></div>
<p></p>

<p>The Compound MAC computation is as follows:</p>
<pre>
   CMK = CMK[j]
   Compound-MAC = HMAC-HASH( CMK, BUFFER )
</pre>
<p>where j is the number of the last successfully executed inner EAP method, HASH is the default hash function or the alternative hash function negotiated in TLS 1.2 <a href="#RFC5246">[RFC5246]</a>, and BUFFER is created after concatenating these fields in the following order:</p>
<p></p>

<dl>
<dt>1</dt>
<dd style="margin-left: 8">The entire Crypto-Binding TLV attribute with the MAC field zeroed out. </dd>
<dt>2</dt>
<dd style="margin-left: 8">The EAP Type sent by the other party in the first TEAP message. </dd>
<dt>3</dt>
<dd style="margin-left: 8">All the Outer-TLVs from the first TEAP message sent by EAP server to peer.  If a single TEAP message is fragmented into multiple TEAP packets; then the Outer-TLVs in all the fragments of that message MUST be included. </dd>
<dt>4</dt>
<dd style="margin-left: 8">All the Outer-TLVs from the first TEAP message sent by the peer to the EAP server.  If a single TEAP message is fragmented into multiple TEAP packets, then the Outer-TLVs in all the fragments of that message MUST be included. </dd>
</dl>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> <a href="#sesskey" id="sesskey">EAP Master Session Key Generation</a>
</h1>
<p></p>
<div id="#rfc.figure.35"></div>
<p></p>

<p>TEAP Authentication assures the master session key (MSK) and Extended Master Session Key (EMSK) output from the EAP method are the result of all authentication conversations by generating an Intermediate Compound Key (IMCK). The IMCK is mutually derived by the peer and the server as described in <a href="#phase2key">Section 5.2</a> by combining the MSKs from inner EAP methods with key material from TEAP Phase 1. The resulting MSK and EMSK are generated as part of the IMCKn key hierarchy as follows:</p>
<pre>
   MSK  = TLS-PRF(S-IMCK[j], "Session Key Generating Function", 64)
   EMSK = TLS-PRF(S-IMCK[j], 
        "Extended Session Key Generating Function", 64)
</pre>
<p>where j is the number of the last successfully executed inner EAP method.</p>
<p id="rfc.section.5.4.p.3">The EMSK is typically only known to the TEAP peer and server and is not provided to a third party. The derivation of additional keys and transportation of these keys to a third party is outside the scope of this document.</p>
<p id="rfc.section.5.4.p.4">If no EAP methods have been negotiated inside the tunnel or no EAP methods have been successfully completed inside the tunnel, the MSK and EMSK will be generated directly from the session_key_seed meaning S-IMCK = session_key_seed.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.6.p.1">This section provides guidance to the Internet Assigned Numbers Authority (IANA) regarding registration of values related to the TEAP protocol, in accordance with BCP 26, <a href="#RFC2434">[RFC2434]</a>.</p>
<p id="rfc.section.6.p.2">The EAP Method Type number for TEAP needs to be assigned.</p>
<p id="rfc.section.6.p.3">The document defines a registry for TEAP TLV types, which may be assigned by Specification Required as defined in <a href="#RFC2434">[RFC2434]</a>. <a href="#tlvformat">Section 4.2</a> defines the TLV types that initially populate the registry. A summary of the TEAP TLV types is given below:</p>
<p><br><br></p>

<dl>
<dt></dt>
<dd style="margin-left: 8"><dl>
<dt>0</dt>
<dd style="margin-left: 8">Unassigned</dd>
<dt>1</dt>
<dd style="margin-left: 8">Authority-ID TLV</dd>
<dt>2</dt>
<dd style="margin-left: 8">Identity-Type TLV</dd>
<dt>3</dt>
<dd style="margin-left: 8">Result TLV</dd>
<dt>4</dt>
<dd style="margin-left: 8">NAK TLV</dd>
<dt>5</dt>
<dd style="margin-left: 8">Error TLV</dd>
<dt>6</dt>
<dd style="margin-left: 8">Channel-Binding TLV </dd>
<dt>7</dt>
<dd style="margin-left: 8">Vendor-Specific TLV</dd>
<dt>8</dt>
<dd style="margin-left: 8">Unassigned</dd>
<dt>9</dt>
<dd style="margin-left: 8">EAP-Payload TLV</dd>
<dt>10</dt>
<dd style="margin-left: 8">Intermediate-Result TLV</dd>
<dt>11</dt>
<dd style="margin-left: 8">PAC TLV </dd>
<dt>12</dt>
<dd style="margin-left: 8">Crypto-Binding TLV</dd>
<dt>13</dt>
<dd style="margin-left: 8">Basic-Password-Auth-Req TLV</dd>
<dt>14</dt>
<dd style="margin-left: 8">Basic-Password-Auth-Resp TLV </dd>
<dt>15</dt>
<dd style="margin-left: 8">PKCS#10 TLV</dd>
<dt>16</dt>
<dd style="margin-left: 8">Unassigned</dd>
<dt>17</dt>
<dd style="margin-left: 8">Unassigned</dd>
<dt>18</dt>
<dd style="margin-left: 8">Trusted-Server-Root TLV </dd>
<dt>19</dt>
<dd style="margin-left: 8">Request-Action TLV</dd>
<dt>20</dt>
<dd style="margin-left: 8">PKCS#7 TLV </dd>
</dl></dd>
</dl>
<p id="rfc.section.6.p.5">The Error-TLV defined in <a href="#errtlv">Section 4.2.4</a> requires an error-code. TEAP Error-TLV error-codes are assigned based on Specification Required as defined in <a href="#RFC2434">[RFC2434]</a>. The initial list of error codes is as follows:</p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 8">2001 Tunnel_Compromise_Error</dd>
<dt></dt>
<dd style="margin-left: 8">2002 Unexpected_TLVs_Exchanged</dd>
</dl>
<p id="rfc.section.6.p.7">The Request-Action TLV defined in section <a href="#ratlv">Section 4.2.11</a> contains an action code which is assigned on a Specification Required basis as defined in <a href="#RFC2434">[RFC2434]</a>. The initial actions defined are:</p>
<p></p>
<p></p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 8"><dl>
<dt>1</dt>
<dd style="margin-left: 8">Process-TLV</dd>
<dt>2</dt>
<dd style="margin-left: 8">Negotiate-EAP<br><br>
</dd>
</dl></dd>
</dl>
<p id="rfc.section.6.p.11">The various values under Vendor-Specific TLV are assigned by Private Use and do not need to be assigned by IANA.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#securityconsiderations" id="securityconsiderations">Security Considerations</a>
</h1>
<p id="rfc.section.7.p.1">TEAP is designed with a focus on wireless media, where the medium itself is inherent to eavesdropping. Whereas in wired media, an attacker would have to gain physical access to the wired medium; wireless media enables anyone to capture information as it is transmitted over the air, enabling passive attacks. Thus, physical security can not be assumed and security vulnerabilities are far greater. The threat model used for the security evaluation of TEAP is defined in the EAP <a href="#RFC3748">[RFC3748]</a>.</p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#mutauth" id="mutauth">Mutual Authentication and Integrity Protection </a>
</h1>
<p id="rfc.section.7.1.p.1">TEAP as a whole, provides message and integrity protection by establishing a secure tunnel for protecting the authentication method(s). The confidentiality and integrity protection is defined by TLS and provides the same security strengths afforded by TLS employing a strong entropy shared master secret. The integrity of the key generating authentication methods executed within the TEAP tunnel is verified through the calculation of the Crypto-Binding TLV.  This ensures that the tunnel endpoints are the same as the inner method endpoints.</p>
<p id="rfc.section.7.1.p.2">The Result TLV is protected and conveys the true Success or Failure of TEAP, and should be used as the indicator of its success or failure respectively. However, as EAP must terminate with a clear text EAP Success or Failure, a peer will also receive a clear text EAP Success or Failure. The received clear text EAP Success or Failure must match that received in the Result TLV; the peer SHOULD silently discard those clear text EAP success or failure messages that do not coincide with the status sent in the protected Result TLV.</p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> <a href="#nego" id="nego">Method Negotiation</a>
</h1>
<p id="rfc.section.7.2.p.1">As is true for any negotiated EAP protocol, NAK packets used to suggest an alternate authentication method are sent unprotected and as such, are subject to spoofing. During unprotected EAP method negotiation, NAK packets may be interjected as active attacks to negotiate down to a weaker form of authentication, such as EAP-MD5 (which only provides one-way authentication and does not derive a key). Both the peer and server should have a method selection policy that prevents them from negotiating down to weaker methods. Inner method negotiation resists attacks because it is protected by the mutually authenticated TLS tunnel established. Selection of TEAP as an authentication method does not limit the potential inner authentication methods, so TEAP should be selected when available.</p>
<p id="rfc.section.7.2.p.2">An attacker cannot readily determine the inner EAP method used, except perhaps by traffic analysis. It is also important that peer implementations limit the use of credentials with an unauthenticated or unauthorized server.</p>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> <a href="#sepp1p2" id="sepp1p2">Separation of Phase 1 and Phase 2 Servers</a>
</h1>
<p id="rfc.section.7.3.p.1">Separation of the TEAP Phase 1 from the Phase 2 conversation is not recommended. Allowing the Phase 1 conversation to be terminated at a different server than the Phase 2 conversation can introduce vulnerabilities if there is not a proper trust relationship and protection for the protocol between the two servers. Some vulnerabilities include:</p>
<p></p>

<ul>
<li>Loss of identity protection</li>
<li>Offline dictionary attacks</li>
<li>Lack of policy enforcement</li>
</ul>
<p id="rfc.section.7.3.p.3">There may be cases where a trust relationship exists between the Phase 1 and Phase 2 servers, such as on a campus or between two offices within the same company, where there is no danger in revealing the inner identity and credentials of the peer to entities between the two servers. In these cases, using a proxy solution without end-to-end protection of TEAP MAY be used. The TEAP encrypting/decrypting gateway SHOULD, at a minimum, provide support for IPsec or similar protection in order to provide confidentiality for the portion of the conversation between the gateway and the EAP server.</p>
<h1 id="rfc.section.7.4">
<a href="#rfc.section.7.4">7.4.</a> Mitigation of Known Vulnerabilities and Protocol Deficiencies</h1>
<p id="rfc.section.7.4.p.1">TEAP addresses the known deficiencies and weaknesses in the EAP method. By employing a shared secret between the peer and server to establish a secured tunnel, TEAP enables:</p>
<p></p>

<ul>
<li>Per packet confidentiality and integrity protection</li>
<li>User identity protection</li>
<li>Better support for notification messages</li>
<li>Protected EAP inner method negotiation</li>
<li>Sequencing of EAP methods</li>
<li>Strong mutually derived master session keys</li>
<li>Acknowledged success/failure indication</li>
<li>Faster re-authentications through session resumption</li>
<li>Mitigation of dictionary attacks</li>
<li>Mitigation of man-in-the-middle attacks</li>
<li>Mitigation of some denial-of-service attacks</li>
</ul>
<p id="rfc.section.7.4.p.3">It should be noted that TEAP, as in many other authentication protocols, a denial-of-service attack can be mounted by adversaries sending erroneous traffic to disrupt the protocol. This is a problem in many authentication or key agreement protocols and is therefore noted for TEAP as well.</p>
<p id="rfc.section.7.4.p.4">TEAP was designed with a focus on protected authentication methods that typically rely on weak credentials, such as password-based secrets. To that extent, the TEAP Authentication mitigates several vulnerabilities, such as dictionary attacks, by protecting the weak credential-based authentication method. The protection is based on strong cryptographic algorithms in TLS to provide message confidentiality and integrity. The keys derived for the protection relies on strong random challenges provided by both peer and server as well as an established key with strong entropy.  Implementations should follow the recommendation in <a href="#RFC4086">[RFC4086]</a> when generating random numbers.</p>
<h1 id="rfc.section.7.4.1">
<a href="#rfc.section.7.4.1">7.4.1.</a> User Identity Protection and Verification</h1>
<p id="rfc.section.7.4.1.p.1">The initial identity request response exchange is sent in cleartext outside the protection of TEAP. Typically the Network Access Identifier (NAI) <a href="#RFC4282">[RFC4282]</a> in the identity response is useful only for the realm information that is used to route the authentication requests to the right EAP server. This means that the identity response may contain an anonymous identity and just contain realm information. In other cases, the identity exchange may be eliminated altogether if there are other means for establishing the destination realm of the request. In no case should an intermediary place any trust in the identity information in the identity response since it is unauthenticated and may not have any relevance to the authenticated identity. TEAP implementations should not attempt to compare any identity disclosed in the initial cleartext EAP Identity response packet with those Identities authenticated in Phase 2.</p>
<p id="rfc.section.7.4.1.p.2">Identity request-response exchanges sent after the TEAP tunnel is established are protected from modification and eavesdropping by attackers.</p>
<p id="rfc.section.7.4.1.p.3">Note that since TLS client certificates are sent in the clear, if identity protection is required, then it is possible for the TLS authentication to be re-negotiated after the first server authentication. To accomplish this, the server will typically not request a certificate in the server_hello, then after the server_finished message is sent, and before TEAP Phase 2, the server MAY send a TLS hello_request. This allows the client to perform client authentication by sending a client_hello if it wants to, or send a no_renegotiation alert to the server indicating that it wants to continue with TEAP Phase 2 instead. Assuming that the client permits renegotiation by sending a client_hello, then the server will respond with server_hello, a certificate and certificate_request messages. The client replies with certificate, client_key_exchange and certificate_verify messages. Since this re-negotiation occurs within the encrypted TLS channel, it does not reveal client certificate details. It is possible to perform certificate authentication using an EAP method (for example: EAP-TLS) within the TLS session in TEAP Phase 2 instead of using TLS handshake renegotiation.</p>
<h1 id="rfc.section.7.4.2">
<a href="#rfc.section.7.4.2">7.4.2.</a> Dictionary Attack Resistance</h1>
<p id="rfc.section.7.4.2.p.1">TEAP was designed with a focus on protected authentication methods that typically rely on weak credentials, such as password-based secrets. TEAP mitigates dictionary attacks by allowing the establishment of a mutually authenticated encrypted TLS tunnel providing confidentiality and integrity to protect the weak credential based authentication method.</p>
<h1 id="rfc.section.7.4.3">
<a href="#rfc.section.7.4.3">7.4.3.</a> Protection against Man-in-the-Middle Attacks</h1>
<p id="rfc.section.7.4.3.p.1">Allowing methods to be executed both with and without the protection of a secure tunnel opens up a possibility of a man-in-the-middle attack. To avoid man-in-the-middle attacks it is recommended to always deploy authentication methods with protection of TEAP. TEAP provides protection from man-in-the-middle attacks even if a deployment chooses to execute inner EAP methods both with and without TEAP protection, TEAP prevents this attack in two ways:</p>
<p></p>

<ol>
<li>By using the PAC-Key to mutually authenticate the peer and server during TEAP Authentication Phase 1 establishment of a secure tunnel.</li>
<li>By using the keys generated by the inner authentication method (if the inner methods are key generating) in the crypto-binding exchange and in the generation of the key material exported by the EAP method described in <a href="#crypto">Section 5</a>.</li>
</ol>
<h1 id="rfc.section.7.4.4">
<a href="#rfc.section.7.4.4">7.4.4.</a> PAC Binding to User Identity</h1>
<p id="rfc.section.7.4.4.p.1">A PAC may be bound to a user identity. A compliant implementation of TEAP MUST validate that an identity obtained in the PAC-Opaque field matches at minimum one of the identities provided in the TEAP Phase 2 authentication method. This validation provides another binding to ensure that the intended peer (based on identity) has successfully completed the TEAP Phase 1 and proved identity in the Phase 2 conversations.</p>
<h1 id="rfc.section.7.5">
<a href="#rfc.section.7.5">7.5.</a> Protecting against Forged Clear Text EAP Packets</h1>
<p id="rfc.section.7.5.p.1">EAP Success and EAP Failure packets are, in general, sent in clear text and may be forged by an attacker without detection. Forged EAP Failure packets can be used to attempt to convince an EAP peer to disconnect. Forged EAP Success packets may be used to attempt to convince a peer that authentication has succeeded, even though the authenticator has not authenticated itself to the peer.</p>
<p id="rfc.section.7.5.p.2">By providing message confidentiality and integrity, TEAP provides protection against these attacks. Once the peer and AS initiate the TEAP Authentication Phase 2, compliant TEAP implementations must silently discard all clear text EAP messages, unless both the TEAP peer and server have indicated success or failure using a protected mechanism. Protected mechanisms include TLS alert mechanism and the protected termination mechanism described in <a href="#proterm">Section 3.3.3</a>.</p>
<p id="rfc.section.7.5.p.3">The success/failure decisions within the TEAP tunnel indicate the final decision of the TEAP authentication conversation. After a success/failure result has been indicated by a protected mechanism, the TEAP peer can process unprotected EAP Success and EAP Failure messages; however the peer MUST ignore any unprotected EAP success or failure messages where the result does not match the result of the protected mechanism.</p>
<p id="rfc.section.7.5.p.4">To abide by <a href="#RFC3748">[RFC3748]</a>, the server must send a clear text EAP Success or EAP Failure packet to terminate the EAP conversation. However, since EAP Success and EAP Failure packets are not retransmitted, the final packet may be lost. While an TEAP protected EAP Success or EAP Failure packet should not be a final packet in an TEAP conversation, it may occur based on the conditions stated above, so an EAP peer should not rely upon the unprotected EAP success and failure messages.</p>
<h1 id="rfc.section.7.6">
<a href="#rfc.section.7.6">7.6.</a> Server Certificate Validation</h1>
<p id="rfc.section.7.6.p.1">As part of the TLS negotiation, the server presents a certificate to the peer. The peer MUST verify the validity of the EAP server certificate, and SHOULD also examine the EAP server name presented in the certificate, in order to determine whether the EAP server can be trusted. Please note that in the case where the EAP authentication is remoted, the EAP server will not reside on the same machine as the authenticator, and therefore the name in the EAP server's certificate cannot be expected to match that of the intended destination. In this case, a more appropriate test might be whether the EAP server's certificate is signed by a CA controlling the intended domain and whether the authenticator can be authorized by a server in that domain.</p>
<h1 id="rfc.section.7.7">
<a href="#rfc.section.7.7">7.7.</a> Tunnel PAC Considerations</h1>
<p id="rfc.section.7.7.p.1">Since the Tunnel PAC is stored by the peer, special care should be given to the overall security of the peer.  The Tunnel PAC must be securely stored by the peer to prevent theft or forgery of any of the Tunnel PAC components.  In particular, the peer must securely store the PAC-Key and protect it from disclosure or modification.  Disclosure of the PAC-Key enables an attacker to establish the TEAP tunnel; however, disclosure of the PAC-Key does not reveal the peer or server identity or compromise any other peer's PAC credentials.  Modification of the PAC-Key or PAC-Opaque components of the Tunnel PAC may also lead to denial of service as the tunnel establishment will fail.  The PAC-Opaque component is the effective TLS ticket extension used to establish the tunnel using the techniques of <a href="#RFC5077">[RFC5077]</a>.  Thus, the security considerations defined by <a href="#RFC5077">[RFC5077]</a> also apply to the PAC- Opaque.  The PAC-Info may contain information about the Tunnel PAC such as the identity of the PAC issuer and the Tunnel PAC lifetime for use in the management of the Tunnel PAC.  The PAC-Info should be securely stored by the peer to protect it from disclosure and modification.</p>
<h1 id="rfc.section.7.8">
<a href="#rfc.section.7.8">7.8.</a> Security Claims</h1>
<p id="rfc.section.7.8.p.1">This section provides the needed security claim requirement for EAP [RFC3748].</p>
<p></p>

<dl>
<dt>Auth. mechanism:</dt>
<dd style="margin-left: 25">Certificate based, shared secret based and various tunneled authentication mechanisms.</dd>
<dt>Ciphersuite negotiation:</dt>
<dd style="margin-left: 25">Yes</dd>
<dt>Mutual authentication:</dt>
<dd style="margin-left: 25">Yes</dd>
<dt>Integrity protection:</dt>
<dd style="margin-left: 25">Yes, Any method executed within the TEAP tunnel is integrity protected. The cleartext EAP headers outside the tunnel are not integrity protected.</dd>
<dt>Replay protection:</dt>
<dd style="margin-left: 25">Yes</dd>
<dt>Confidentiality:</dt>
<dd style="margin-left: 25">Yes</dd>
<dt>Key derivation:</dt>
<dd style="margin-left: 25">Yes</dd>
<dt>Key strength:</dt>
<dd style="margin-left: 25">See Note 1 below.</dd>
<dt>Dictionary attack prot.:</dt>
<dd style="margin-left: 25">Yes</dd>
<dt>Fast reconnect:</dt>
<dd style="margin-left: 25">Yes</dd>
<dt>Cryptographic binding:</dt>
<dd style="margin-left: 25">Yes</dd>
<dt>Session independence:</dt>
<dd style="margin-left: 25">Yes</dd>
<dt>Fragmentation:</dt>
<dd style="margin-left: 25">Yes</dd>
<dt>Key Hierarchy:</dt>
<dd style="margin-left: 25">Yes</dd>
<dt>Channel binding:</dt>
<dd style="margin-left: 25">Yes</dd>
</dl>
<p id="rfc.section.7.8.p.3">Notes</p>
<p></p>

<ol><li>BCP 86 <a href="#RFC3766">[RFC3766]</a> offers advice on appropriate key sizes.  The National Institute for Standards and Technology (NIST) also offers advice on appropriate key sizes in <a href="#NIST-SP-800-57">[NIST-SP-800-57]</a>.  <a href="#RFC3766">[RFC3766]</a> Section 5 advises use of the following required RSA or DH module and DSA subgroup size in bits, for a given level of attack resistance in bits.  Based on the table below, a 2048-bit RSA key is required to provide 128-bit equivalent key strength:</li></ol>
<div id="#rfc.figure.36"></div>
<pre>
      Attack Resistance     RSA or DH Modulus            DSA subgroup
       (bits)                  size (bits)                size (bits)
      -----------------     -----------------            ------------
         70                        947                        129
         80                       1228                        148
         90                       1553                        167
        100                       1926                        186
        150                       4575                        284
        200                       8719                        383
        250                      14596                        482
</pre>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Acknowledgements</h1>
<p id="rfc.section.8.p.1">The TEAP v1 design and protocol specification is based on the ideas and hard efforts of Pad Jakkahalli, Mark Krischer, Doug Smith, and Glen Zorn of Cisco Systems, Inc.</p>
<p id="rfc.section.8.p.2">The TLV processing was inspired from work on the Protected Extensible Authentication Protocol version 2 (PEAPv2) with Ashwin Palekar, Dan Smith and Simon Josefsson. Helpful review comments were provided by Russ Housley, Jari Arkko, Ilan Frenkel and Jeremy Steiglitz.</p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3748">[RFC3748]</b></td>
<td class="top">
<a>Aboba, B.</a>, <a>Blunk, L.</a>, <a>Vollbrecht, J.</a>, <a>Carlson, J.</a> and <a>H. Levkowetz</a>, "<a href="http://tools.ietf.org/html/rfc3748">Extensible Authentication Protocol (EAP)</a>", RFC 3748, June 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3268">[RFC3268]</b></td>
<td class="top">
<a>Chown, P.</a>, "<a href="http://tools.ietf.org/html/rfc3268">Advanced Encryption Standard (AES) Ciphersuites for Transport Layer Security (TLS)</a>", RFC 3268, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2434">[RFC2434]</b></td>
<td class="top">
<a href="mailto:narten@raleigh.ibm.com" title="IBM Corporation">Narten, T.</a> and <a href="mailto:Harald@Alvestrand.no" title="Maxware">H.T. Alvestrand</a>, "<a href="http://tools.ietf.org/html/rfc2434">Guidelines for Writing an IANA Considerations Section in RFCs</a>", BCP 26, RFC 2434, October 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5422">[RFC5422]</b></td>
<td class="top">
<a>Cam-Winget, N.</a>, <a>McGrew, D.</a>, <a>Salowey, J.</a> and <a>H. Zhou</a>, "<a href="http://tools.ietf.org/html/rfc5422">Dynamic Provisioning Using Flexible Authentication via Secure Tunneling Extensible Authentication Protocol (EAP-FAST)</a>", RFC 5422, March 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4851">[RFC4851]</b></td>
<td class="top">
<a>Cam-Winget, N.</a>, <a>McGrew, D.</a>, <a>Salowey, J.</a> and <a>H. Zhou</a>, "<a href="http://tools.ietf.org/html/rfc4851">The Flexible Authentication via Secure Tunneling Extensible Authentication Protocol Method (EAP-FAST)</a>", RFC 4851, May 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5077">[RFC5077]</b></td>
<td class="top">
<a>Salowey, J.</a>, <a>Zhou, H.</a>, <a>Eronen, P.</a> and <a>H. Tschofenig</a>, "<a href="http://tools.ietf.org/html/rfc5077">Transport Layer Security (TLS) Session Resumption without Server-Side State</a>", RFC 5077, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4013">[RFC4013]</b></td>
<td class="top">
<a>Zeilenga, K.</a>, "<a href="http://tools.ietf.org/html/rfc4013">SASLprep: Stringprep Profile for User Names and Passwords</a>", RFC 4013, February 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5705">[RFC5705]</b></td>
<td class="top">
<a>Rescorla, E.</a>, "<a href="http://tools.ietf.org/html/rfc5705">Keying Material Exporters for Transport Layer Security (TLS)</a>", RFC 5705, March 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5746">[RFC5746]</b></td>
<td class="top">
<a>Rescorla, E.</a>, <a>Ray, M.</a>, <a>Dispensa, S.</a> and <a>N. Oskov</a>, "<a href="http://tools.ietf.org/html/rfc5746">Transport Layer Security (TLS) Renegotiation Indication Extension</a>", RFC 5746, February 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-emu-chbind">[I-D.ietf-emu-chbind]</b></td>
<td class="top">
<a>Hartman, S</a>, <a>Clancy, C</a> and <a>K Hoeper</a>, "<a href="http://tools.ietf.org/html/draft-ietf-emu-chbind-06">Channel Binding Support for EAP Methods</a>", Internet-Draft draft-ietf-emu-chbind-06, October 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2311">[RFC2311]</b></td>
<td class="top">
<a href="mailto:spock@rsa.com" title="RSA Data Security, Inc.">Dusse, S.</a>, <a href="mailto:phoffman@imc.org" title="Internet Mail Consortium">Hoffman, P.</a>, <a href="mailto:blaker@deming.com" title="Worldtalk">Ramsdell, B.</a>, <a href="mailto:lgl@qualcomm.com" title="QUALCOMM Incorporated">Lundblade, L.</a> and <a href="mailto:repka@netscape.com" title="Netscape Communications Corporation">L. Repka</a>, "<a href="http://tools.ietf.org/html/rfc2311">S/MIME Version 2 Message Specification</a>", RFC 2311, March 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2315">[RFC2315]</b></td>
<td class="top">
<a href="mailto:burt@rsa.com" title="RSA Laboratories East">Kaliski, B.</a>, "<a href="http://tools.ietf.org/html/rfc2315">PKCS #7: Cryptographic Message Syntax Version 1.5</a>", RFC 2315, March 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2560">[RFC2560]</b></td>
<td class="top">
<a href="mailto:mmyers@verisign.com" title="VeriSign, Inc.">Myers, M.</a>, <a href="mailto:rankney@erols.com" title="CertCo, LLC">Ankney, R.</a>, <a href="mailto:ambarish@valicert.com" title="ValiCert, Inc.">Malpani, A.</a>, <a href="mailto:galperin@mycfo.com" title="My CFO, Inc.">Galperin, S.</a> and <a href="mailto:cadams@entrust.com" title="Entrust Technologies">C. Adams</a>, "<a href="http://tools.ietf.org/html/rfc2560">X.509 Internet Public Key Infrastructure Online Certificate Status Protocol - OCSP</a>", RFC 2560, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5216">[RFC5216]</b></td>
<td class="top">
<a>Simon, D.</a>, <a>Aboba, B.</a> and <a>R. Hurst</a>, "<a href="http://tools.ietf.org/html/rfc5216">The EAP-TLS Authentication Protocol</a>", RFC 5216, March 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4282">[RFC4282]</b></td>
<td class="top">
<a>Aboba, B.</a>, <a>Beadles, M.</a>, <a>Arkko, J.</a> and <a>P. Eronen</a>, "<a href="http://tools.ietf.org/html/rfc4282">The Network Access Identifier</a>", RFC 4282, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4072">[RFC4072]</b></td>
<td class="top">
<a>Eronen, P.</a>, <a>Hiller, T.</a> and <a>G. Zorn</a>, "<a href="http://tools.ietf.org/html/rfc4072">Diameter Extensible Authentication Protocol (EAP) Application</a>", RFC 4072, August 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4086">[RFC4086]</b></td>
<td class="top">
<a>Eastlake, D.</a>, <a>Schiller, J.</a> and <a>S. Crocker</a>, "<a href="http://tools.ietf.org/html/rfc4086">Randomness Requirements for Security</a>", BCP 106, RFC 4086, June 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3579">[RFC3579]</b></td>
<td class="top">
<a>Aboba, B.</a> and <a>P. Calhoun</a>, "<a href="http://tools.ietf.org/html/rfc3579">RADIUS (Remote Authentication Dial In User Service) Support For Extensible Authentication Protocol (EAP)</a>", RFC 3579, September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3766">[RFC3766]</b></td>
<td class="top">
<a>Orman, H.</a> and <a>P. Hoffman</a>, "<a href="http://tools.ietf.org/html/rfc3766">Determining Strengths For Public Keys Used For Exchanging Symmetric Keys</a>", BCP 86, RFC 3766, April 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6066">[RFC6066]</b></td>
<td class="top">
<a>Eastlake, D.</a>, "<a href="http://tools.ietf.org/html/rfc6066">Transport Layer Security (TLS) Extensions: Extension Definitions</a>", RFC 6066, January 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-emu-eaptunnel-req">[I-D.ietf-emu-eaptunnel-req]</b></td>
<td class="top">
<a>Hoeper, K</a>, <a>Hanna, S</a>, <a>Zhou, H</a> and <a>J Salowey</a>, "<a href="http://tools.ietf.org/html/draft-ietf-emu-eaptunnel-req-09">Requirements for a Tunnel Based EAP Method</a>", Internet-Draft draft-ietf-emu-eaptunnel-req-09, December 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5421">[RFC5421]</b></td>
<td class="top">
<a>Cam-Winget, N.</a> and <a>H. Zhou</a>, "<a href="http://tools.ietf.org/html/rfc5421">Basic Password Exchange within the Flexible Authentication via Secure Tunneling Extensible Authentication Protocol (EAP-FAST)</a>", RFC 5421, March 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3280">[RFC3280]</b></td>
<td class="top">
<a>Housley, R.</a>, <a>Polk, W.</a>, <a>Ford, W.</a> and <a>D. Solo</a>, "<a href="http://tools.ietf.org/html/rfc3280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>", RFC 3280, April 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3629">[RFC3629]</b></td>
<td class="top">
<a>Yergeau, F.</a>, "<a href="http://tools.ietf.org/html/rfc3629">UTF-8, a transformation format of ISO 10646</a>", STD 63, RFC 3629, November 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4630">[RFC4630]</b></td>
<td class="top">
<a>Housley, R.</a> and <a>S. Santesson</a>, "<a href="http://tools.ietf.org/html/rfc4630">Update to DirectoryString Processing in the Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>", RFC 4630, August 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5281">[RFC5281]</b></td>
<td class="top">
<a>Funk, P.</a> and <a>S. Blake-Wilson</a>, "<a href="http://tools.ietf.org/html/rfc5281">Extensible Authentication Protocol Tunneled Transport Layer Security Authenticated Protocol Version 0 (EAP-TTLSv0)</a>", RFC 5281, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5272">[RFC5272]</b></td>
<td class="top">
<a>Schaad, J.</a> and <a>M. Myers</a>, "<a href="http://tools.ietf.org/html/rfc5272">Certificate Management over CMS (CMC)</a>", RFC 5272, June 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4945">[RFC4945]</b></td>
<td class="top">
<a>Korver, B.</a>, "<a href="http://tools.ietf.org/html/rfc4945">The Internet IP Security PKI Profile of IKEv1/ISAKMP, IKEv2, and PKIX</a>", RFC 4945, August 2007.</td>
</tr>
<tr>
<td class="reference"><b id="IEEE.802-1X.2004">[IEEE.802-1X.2004]</b></td>
<td class="top">
<a>Local and Metropolitan Area Networks: Port-Based Network Access Control</a>", IEEE Standard 802.1X, December 2004.</td>, "</tr>
<tr>
<td class="reference"><b id="PEAP">[PEAP]</b></td>
<td class="top">
<a>Microsoft Corporation</a>, "<a>"[MS-PEAP]: Protected Extensible Authentication Protocol (PEAP) Specification"</a>", August 2009.</td>
</tr>
<tr>
<td class="reference"><b id="NIST-SP-800-57">[NIST-SP-800-57]</b></td>
<td class="top">
<a>National Institute of Standards and Technology</a>, "<a>"Recommendation for Key Management"</a>", NIST Special Publication 800-57, May 2006.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#evaluation" id="evaluation">Evaluation Against Tunnel Based EAP Method Requirements</a>
</h1>
<p id="rfc.section.Appendix A.p.1">This section evaluates all tunnel based EAP method requirements described in <a href="#I-D.ietf-emu-eaptunnel-req">[I-D.ietf-emu-eaptunnel-req]</a> against TEAP version 1.</p>
<h1 id="rfc.appendix.Appendix A.1">
<a href="#rfc.appendix.Appendix%20A.1">Appendix A.1.</a> Requirement 4.1.1 RFC Compliance</h1>
<p id="rfc.section.Appendix A.1.p.1">TEAP v1 meets this requirement by being compliant to RFC 3748, RFC 4017, RFC 5247, and RFC 4962. It is also compliant with the "cryptographic algorithm agility" requirement by leveraging TLS 1.2 for all cryptographic algorithm negotiation.</p>
<h1 id="rfc.appendix.Appendix A.2">
<a href="#rfc.appendix.Appendix%20A.2">Appendix A.2.</a> Requirement 4.2.1 TLS Requirements</h1>
<p id="rfc.section.Appendix A.2.p.1">Requirement 4.2.1 states:</p>
<p id="rfc.section.Appendix A.2.p.2">The tunnel based method MUST support TLS version 1.2 [RFC5246] and may support earlier versions greater than SSL 2.0 to enable the possibility of backwards compatibility.</p>
<p id="rfc.section.Appendix A.2.p.3">TEAP v1 meets this requirement by mandating TLS version 1.2 support as defined in <a href="#phase1">Section 3.2</a>.</p>
<h1 id="rfc.appendix.Appendix A.3">
<a href="#rfc.appendix.Appendix%20A.3">Appendix A.3.</a> Requirement 4.2.1.1.1 Cipher Suite Negotiation</h1>
<p id="rfc.section.Appendix A.3.p.1">Requirement 4.2.1.1.1 states:</p>
<p id="rfc.section.Appendix A.3.p.2">Hence, the tunnel method MUST provide integrity protected cipher suite negotiation with secure integrity algorithms and integrity keys.</p>
<p id="rfc.section.Appendix A.3.p.3">TEAP v1 meets this requirement by using TLS to provide protected cipher suite negotiation.</p>
<h1 id="rfc.appendix.Appendix A.4">
<a href="#rfc.appendix.Appendix%20A.4">Appendix A.4.</a> Requirement 4.2.1.1.2 Tunnel Data Protection Algorithms</h1>
<p id="rfc.section.Appendix A.4.p.1">Requirement 4.2.1.1.2 states:</p>
<p id="rfc.section.Appendix A.4.p.2">The tunnel method MUST provide at least one mandatory to implement cipher suite that provides the equivalent security of 128-bit AES for encryption and message authentication.</p>
<p id="rfc.section.Appendix A.4.p.3">TEAP v1 meets this requirement by mandating TLS_RSA_WITH_AES_128_CBC_SHA as a mandatory to implement cipher suite as defined in <a href="#phase1">Section 3.2</a>.</p>
<h1 id="rfc.appendix.Appendix A.5">
<a href="#rfc.appendix.Appendix%20A.5">Appendix A.5.</a> Requirement 4.2.1.1.3 Tunnel Authentication and Key Establishment</h1>
<p id="rfc.section.Appendix A.5.p.1">TEAP v1 meets this requirement by mandating TLS_RSA_WITH_AES_128_CBC_SHA as a mandatory to implement cipher suite which provides certificate-based authentication of the server and is approved by NIST. The mandatory to implement cipher suites only include cipher suites that use strong cryptographic algorithms.  They do not include cipher suites providing mutually anonymous authentication or static Diffie-Hellman cipher suites as defined in <a href="#phase1">Section 3.2</a>.</p>
<h1 id="rfc.appendix.Appendix A.6">
<a href="#rfc.appendix.Appendix%20A.6">Appendix A.6.</a> Requirement 4.2.1.2 Tunnel Replay Protection</h1>
<p id="rfc.section.Appendix A.6.p.1">TEAP v1 meets this requirement by using TLS to provide sufficient replay protection.</p>
<h1 id="rfc.appendix.Appendix A.7">
<a href="#rfc.appendix.Appendix%20A.7">Appendix A.7.</a> Requirement 4.2.1.3 TLS Extensions</h1>
<p id="rfc.section.Appendix A.7.p.1">TEAP v1 meets this requirement by allowing TLS extensions, such as TLS Certificate Status Request extension <a href="#RFC6066">[RFC6066]</a> and SessionTicket extension <a href="#RFC5077">[RFC5077]</a> to be used during TLS tunnel establishment.</p>
<h1 id="rfc.appendix.Appendix A.8">
<a href="#rfc.appendix.Appendix%20A.8">Appendix A.8.</a> Requirement 4.2.1.4 Peer Identity Privacy</h1>
<p id="rfc.section.Appendix A.8.p.1">TEAP v1 meets this requirement by establishment of the TLS tunnel and protection of inner method specific identities.  In addition, the peer certificate can be sent confidentially (i.e. encrypted).</p>
<h1 id="rfc.appendix.Appendix A.9">
<a href="#rfc.appendix.Appendix%20A.9">Appendix A.9.</a> Requirement 4.2.1.5 Session Resumption</h1>
<p id="rfc.section.Appendix A.9.p.1">TEAP v1 meets this requirement by mandating support of TLS session resumption as defined in <a href="#sessres">Section 3.2.1</a> and TLS Session Resume Using a PAC as defined in <a href="#tunnelpac">Section 3.2.2</a> .</p>
<h1 id="rfc.appendix.Appendix A.10">
<a href="#rfc.appendix.Appendix%20A.10">Appendix A.10.</a> Requirement 4.2.2 Fragmentation</h1>
<p id="rfc.section.Appendix A.10.p.1">TEAP v1 meets this requirement by leveraging fragmentation support provided by TLS as defined in <a href="#frag">Section 3.7</a>.</p>
<h1 id="rfc.appendix.Appendix A.11">
<a href="#rfc.appendix.Appendix%20A.11">Appendix A.11.</a> Requirement 4.2.3 Protection of Data External to Tunnel</h1>
<p id="rfc.section.Appendix A.11.p.1">TEAP v1 meets this requirement by including TEAP version number received in the computation of crypto-binding TLV as defined in <a href="#cbtlv">Section 4.2.9</a>.</p>
<h1 id="rfc.appendix.Appendix A.12">
<a href="#rfc.appendix.Appendix%20A.12">Appendix A.12.</a> Requirement 4.3.1 Extensible Attribute Types</h1>
<p id="rfc.section.Appendix A.12.p.1">TEAP v1 meets this requirement by using an extensible TLV data layer inside the tunnel as defined in <a href="#tlvformat">Section 4.2</a>.</p>
<h1 id="rfc.appendix.Appendix A.13">
<a href="#rfc.appendix.Appendix%20A.13">Appendix A.13.</a> Requirement 4.3.2 Request/Challenge Response Operation</h1>
<p id="rfc.section.Appendix A.13.p.1">TEAP v1 meets this requirement by allowing multiple TLVs to be sent in a single EAP request or response packet, while maintaining the half-duplex operation typical of EAP.</p>
<h1 id="rfc.appendix.Appendix A.14">
<a href="#rfc.appendix.Appendix%20A.14">Appendix A.14.</a> Requirement 4.3.3 Indicating Criticality of Attributes</h1>
<p id="rfc.section.Appendix A.14.p.1">TEAP v1 meets this requirement by having a mandatory bit in TLV to indicate whether it is mandatory to support or not as defined in <a href="#tlvformat">Section 4.2</a>.</p>
<h1 id="rfc.appendix.Appendix A.15">
<a href="#rfc.appendix.Appendix%20A.15">Appendix A.15.</a> Requirement 4.3.4 Vendor Specific Support</h1>
<p id="rfc.section.Appendix A.15.p.1">TEAP v1 meets this requirement by having a Vendor-Specific TLV to allow vendors to define their own attributes as defined in <a href="#vendortlv">Section 4.2.5</a>.</p>
<h1 id="rfc.appendix.Appendix A.16">
<a href="#rfc.appendix.Appendix%20A.16">Appendix A.16.</a> Requirement 4.3.5 Result Indication</h1>
<p id="rfc.section.Appendix A.16.p.1">TEAP v1 meets this requirement by having a Result TLV to exchange the final result of the EAP authentication so both the peer and server have a synchronized state as defined in <a href="#resulttlv">Section 4.2.2</a>.</p>
<h1 id="rfc.appendix.Appendix A.17">
<a href="#rfc.appendix.Appendix%20A.17">Appendix A.17.</a> Requirement 4.3.6 Internationalization of Display Strings</h1>
<p id="rfc.section.Appendix A.17.p.1">TEAP v1 meets this requirement by supporting UTF-8 format in Basic-Password-Auth-Req TLV as defined in <a href="#passreq">Section 4.2.17</a> and Basic-Password-Auth-Resp TLV as defined in <a href="#passresp">Section 4.2.18</a>.</p>
<h1 id="rfc.appendix.Appendix A.18">
<a href="#rfc.appendix.Appendix%20A.18">Appendix A.18.</a> Requirement 4.4 EAP Channel Binding Requirements</h1>
<p id="rfc.section.Appendix A.18.p.1">TEAP v1 meets this requirement by having a Channel-Binding TLV to exchange the EAP channel binding data as defined in <a href="#channelbinding">Section 4.2.15</a>.</p>
<h1 id="rfc.appendix.Appendix A.19">
<a href="#rfc.appendix.Appendix%20A.19">Appendix A.19.</a> Requirement 4.5.1.1 Confidentiality and Integrity</h1>
<p id="rfc.section.Appendix A.19.p.1">TEAP v1 meets this requirement by running the password authentication inside a protected TLS tunnel.</p>
<h1 id="rfc.appendix.Appendix A.20">
<a href="#rfc.appendix.Appendix%20A.20">Appendix A.20.</a> Requirement 4.5.1.2 Authentication of Server</h1>
<p id="rfc.section.Appendix A.20.p.1">TEAP v1 meets this requirement by mandating authentication of the server before establishment of the protected TLS and then running inner password authentication as defined in <a href="#phase1">Section 3.2</a>.</p>
<h1 id="rfc.appendix.Appendix A.21">
<a href="#rfc.appendix.Appendix%20A.21">Appendix A.21.</a> Requirement 4.5.1.3 Server Certificate Revocation Checking</h1>
<p id="rfc.section.Appendix A.21.p.1">TEAP v1 meets this requirement by supporting TLS Certificate Status Request extension <a href="#RFC6066">[RFC6066]</a> during tunnel establishment.</p>
<h1 id="rfc.appendix.Appendix A.22">
<a href="#rfc.appendix.Appendix%20A.22">Appendix A.22.</a> Requirement 4.5.2  Internationalization</h1>
<p id="rfc.section.Appendix A.22.p.1">TEAP v1 meets this requirement by supporting UTF-8 format in Basic-Password-Auth-Req TLV as defined in <a href="#passreq">Section 4.2.17</a> and Basic-Password-Auth-Resp TLV as defined in <a href="#passresp">Section 4.2.18</a>.</p>
<h1 id="rfc.appendix.Appendix A.23">
<a href="#rfc.appendix.Appendix%20A.23">Appendix A.23.</a> Requirement 4.5.3 Meta-data</h1>
<p id="rfc.section.Appendix A.23.p.1">TEAP v1 meets this requirement by supporting Identity-Type TLV as defined in <a href="#identitytype">Section 4.2.16</a> to indicate whether the authentication is for a user or a machine.</p>
<h1 id="rfc.appendix.Appendix A.24">
<a href="#rfc.appendix.Appendix%20A.24">Appendix A.24.</a> Requirement 4.5.4 Password Change</h1>
<p id="rfc.section.Appendix A.24.p.1">TEAP v1 meets this requirement by supporting multiple Basic-Password-Auth-Req TLV and Basic-Password-Auth-Resp TLV exchanges within a single EAP authentication, which allows "housekeeping"" functions such as password change.</p>
<h1 id="rfc.appendix.Appendix A.25">
<a href="#rfc.appendix.Appendix%20A.25">Appendix A.25.</a> Requirement 4.6.1 Method Negotiation</h1>
<p id="rfc.section.Appendix A.25.p.1">TEAP v1 meets this requirement by supporting inner EAP method negotiation within the protected TLS tunnel.</p>
<h1 id="rfc.appendix.Appendix A.26">
<a href="#rfc.appendix.Appendix%20A.26">Appendix A.26.</a> Requirement 4.6.2 Chained Methods</h1>
<p id="rfc.section.Appendix A.26.p.1">TEAP v1 meets this requirement by supporting inner EAP method chaining within protected TLS tunnel as defined in <a href="#eapseq">Section 3.3.1</a>.</p>
<h1 id="rfc.appendix.Appendix A.27">
<a href="#rfc.appendix.Appendix%20A.27">Appendix A.27.</a> Requirement 4.6.3 Cryptographic Binding with the TLS Tunnel</h1>
<p id="rfc.section.Appendix A.27.p.1">TEAP v1 meets this requirement by supporting cryptographic binding of the inner EAP method keys with the keys derived from the TLS tunnel as defined in <a href="#cbtlv">Section 4.2.9</a>.</p>
<h1 id="rfc.appendix.Appendix A.28">
<a href="#rfc.appendix.Appendix%20A.28">Appendix A.28.</a> Requirement 4.6.4 Peer Initiated</h1>
<p id="rfc.section.Appendix A.28.p.1">TEAP v1 meets this requirement by supporting Request-Action TLV as defined in <a href="#ratlv">Section 4.2.11</a> to allow peer to initiate another inner EAP method.</p>
<h1 id="rfc.appendix.Appendix A.29">
<a href="#rfc.appendix.Appendix%20A.29">Appendix A.29.</a> Requirement 4.6.5 Method Meta-data</h1>
<p id="rfc.section.Appendix A.29.p.1">TEAP v1 meets this requirement by supporting Identity-Type TLV as defined in <a href="#identitytype">Section 4.2.16</a> to indicate whether the authentication is for a user or a machine.</p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> <a href="#changes" id="changes">Major Differences from EAP-FAST</a>
</h1>
<p id="rfc.section.Appendix B.p.1">This document is a new standard tunnel EAP method based on revision of the EAP-FAST version 1 <a href="#RFC4851">[RFC4851]</a> which contains improved flexibility, particularly for negotiation of cryptographic algorithms.  The major changes are:</p>
<p></p>

<ol>
<li>The EAP method name have been changed from EAP-FAST to TEAP, hence it would require a new EAP method type to be assigned.</li>
<li>This version of TEAP MUST support TLS 1.2 <a href="#RFC5246">[RFC5246]</a>.</li>
<li>The key derivation now makes use of TLS keying material exporters <a href="#RFC5705">[RFC5705]</a> and the PRF and hash function negotiated in TLS.  This is to simplify implementation and better support cryptographic algorithm agility.</li>
<li>TEAP is in full conformance with TLS Ticket extension <a href="#RFC5077">[RFC5077]</a> as described in <a href="#tunnelpac">Section 3.2.2</a>.</li>
<li>Support of passing optional outer TLVs in the first two message exchanges, in addtion to the Authority-ID TLV data in EAP-FAST.</li>
<li>Basic password authentication on the TLV level has been added in addition to the existing inner EAP method.</li>
<li>Additional TLV types have been defined to support EAP channel binding and meta-data. They are Identity Type TLV and Channel-Binding TLVs, defined in <a href="#tlvformat">Section 4.2</a>.</li>
</ol>
<h1 id="rfc.appendix.Appendix C">
<a href="#rfc.appendix.Appendix%20C">Appendix C.</a> <a href="#examples" id="examples">Examples</a>
</h1>
<h1 id="rfc.appendix.Appendix C.1">
<a href="#rfc.appendix.Appendix%20C.1">Appendix C.1.</a> Successful Authentication</h1>
<p id="rfc.section.Appendix C.1.p.1">The following exchanges show a successful TEAP authentication with optional PAC refreshment, the conversation will appear as follows:</p>
<div id="#rfc.figure.37"></div>
<pre>
    Authenticating Peer     Authenticator 
    -------------------     ------------- 
                            &lt;- EAP-Request/ 
                            Identity 
    EAP-Response/ 
    Identity (MyID1) -&gt; 
                            
                            &lt;- EAP-Request/ 
                            EAP-Type=TEAP, V=1 
                            (TEAP Start, S bit set, Authority-ID) 
     
    EAP-Response/ 
    EAP-Type=TEAP, V=1 
    (TLS client_hello with  
     PAC-Opaque in SessionTicket extension)-&gt; 
     
                            &lt;- EAP-Request/ 
                            EAP-Type=TEAP, V=1 
                            (TLS server_hello, 
                            (TLS change_cipher_spec, 
                             TLS finished) 
     
  


  
    EAP-Response/ 
    EAP-Type=TEAP, V=1 -&gt; 
    (TLS change_cipher_spec, 
     TLS finished) 
     
    TLS channel established 
    (messages sent within the TLS channel) 
     
                           &lt;- EAP Payload TLV, EAP-Request,  
                            EAP-GTC, Challenge 
     
    EAP Payload TLV, EAP-Response, 
    EAP-GTC, Response with both  
    user name and password) -&gt; 
     
    optional additional exchanges (new pin mode,  
    password change etc.) ... 
     
                            &lt;- Intermediate-Result TLV (Success) 
                            Crypto-Binding TLV (Request)
     
  
    Intermediate-Result TLV (Success) 
    Crypto-Binding TLV(Response) -&gt; 
     
                             &lt;- Result TLV (Success) 
                               (Optional PAC TLV)  
     
    Result TLV (Success) 
    (PAC TLV Acknowledgment) -&gt; 
     
    TLS channel torn down 
    (messages sent in clear text) 
     
                            &lt;- EAP-Success 
</pre>
<h1 id="rfc.appendix.Appendix C.2">
<a href="#rfc.appendix.Appendix%20C.2">Appendix C.2.</a> Failed Authentication</h1>
<p id="rfc.section.Appendix C.2.p.1">The following exchanges show a failed TEAP authentication due to wrong user credentials, the conversation will appear as follows:</p>
<div id="#rfc.figure.38"></div>
<pre>
    Authenticating Peer     Authenticator 
    -------------------     ------------- 
                            &lt;- EAP-Request/ 
                            Identity 
     
    EAP-Response/ 
    Identity (MyID1) -&gt; 
     
  
                            &lt;- EAP-Request/ 
                            EAP-Type=TEAP, V=1 
                            (TEAP Start, S bit set, Authority-ID) 
     
    EAP-Response/ 
    EAP-Type=TEAP, V=1 
    (TLS client_hello with  
     PAC-Opaque in SessionTicket extension)-&gt; 
     
                            &lt;- EAP-Request/ 
                            EAP-Type=TEAP, V=1 
                            (TLS server_hello, 
                            (TLS change_cipher_spec, 
                             TLS finished) 
     
    EAP-Response/ 
    EAP-Type=TEAP, V=1 -&gt; 
    (TLS change_cipher_spec, 
     TLS finished) 
     
    TLS channel established 
    (messages sent within the TLS channel) 
     
                           &lt;- EAP Payload TLV, EAP-Request,  
                            EAP-GTC, Challenge 
     
    EAP Payload TLV, EAP-Response, 
    EAP-GTC, Response with both  
    user name and password) -&gt; 
     
                           &lt;- EAP Payload TLV, EAP-Request,  
                            EAP-GTC, error message
     
    EAP Payload TLV, EAP-Response, 
    EAP-GTC, empty data packet to  
    acknowledge unrecoverable error) -&gt; 
     
                            &lt;- Result TLV (Failure) 
     
    Result TLV (Failure) -&gt; 
     
    TLS channel torn down 
    (messages sent in clear text) 
     
                            &lt;- EAP-Failure </pre>
<h1 id="rfc.appendix.Appendix C.3">
<a href="#rfc.appendix.Appendix%20C.3">Appendix C.3.</a> <a href="#fullcertex" id="fullcertex">Full TLS Handshake using Certificate-based Cipher Suite</a>
</h1>
<p id="rfc.section.Appendix C.3.p.1">In the case where an abbreviated TLS handshake is tried and failed and falls back to certificate based full TLS handshake occurs within TEAP Phase 1, the conversation will appear as follows:</p>
<div id="#rfc.figure.39"></div>
<pre>
   Authenticating Peer    Authenticator
   -------------------    -------------
                          &lt;- EAP-Request/Identity
   EAP-Response/
   Identity (MyID1) -&gt;

   // Identity sent in the clear. May be a hint to help route
      the authentication request to EAP server, instead of the
      full user identity.

                           &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TEAP Start, S bit set, Authority-ID)
   EAP-Response/
   EAP-Type=TEAP, V=1
   (TLS client_hello
   [PAC-Opaque extension])-&gt; 

   // Peer sends PAC-Opaque of Tunnel PAC along with a list of 
      ciphersuites supported. If the server rejects the PAC-
      Opaque, if falls through to the full TLS handshake

                           &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TLS server_hello,
                            TLS certificate,
                           [TLS server_key_exchange,]
                           [TLS certificate_request,]
                            TLS server_hello_done)
   EAP-Response/
   EAP-Type=TEAP, V=1
   ([TLS certificate,]
    TLS client_key_exchange,
   [TLS certificate_verify,]
    TLS change_cipher_spec,
    TLS finished) -&gt;
                           &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TLS change_cipher_spec,
                            TLS finished,
                            EAP-Payload-TLV[EAP-Request/
                            Identity])


   // TLS channel established 
      (messages sent within the TLS channel)

   // First EAP Payload TLV is piggybacked to the TLS Finished as 
      Application Data and protected by the TLS tunnel

   EAP-Payload-TLV
   [EAP-Response/Identity (MyID2)]-&gt;

   // identity protected by TLS. 

                            &lt;- EAP-Payload-TLV
                            [EAP-Request/EAP-Type=X]

   EAP-Payload-TLV
   [EAP-Response/EAP-Type=X] -&gt;

   // Method X exchanges followed by Protected Termination

                            &lt;- Crypto-Binding TLV (Version=1,
                            TEAP Version=1, Nonce, 
                            CompoundMAC),
                            Result TLV (Success)

   Crypto-Binding TLV (Version=1,
   TEAP Version=1, Nonce, 
   CompoundMAC),
   Result-TLV (Success) -&gt;

   // TLS channel torn down
   (messages sent in clear text)

                           &lt;- EAP-Success</pre>
<h1 id="rfc.appendix.Appendix C.4">
<a href="#rfc.appendix.Appendix%20C.4">Appendix C.4.</a> Client authentication during Phase 1 with identity privacy</h1>
<p id="rfc.section.Appendix C.4.p.1">In the case where a certificate based TLS handshake occurs within TEAP Phase 1, and client certificate authentication and identity privacy is desired, the conversation will appear as follows:</p>
<div id="#rfc.figure.40"></div>
<pre>
   Authenticating Peer     Authenticator
   -------------------     -------------
                          &lt;- EAP-Request/Identity
   EAP-Response/
   Identity (MyID1) -&gt;

   // Identity sent in the clear. May be a hint to help route
      the authentication request to EAP server, instead of the
      full user identity.

                           &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TEAP Start, S bit set, Authority-ID)
   EAP-Response/
   EAP-Type=TEAP, V=1
   (TLS client_hello)-&gt;
                           &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TLS server_hello,
                            TLS certificate,
                           [TLS server_key_exchange,]
                           [TLS certificate_request,]
                            TLS server_hello_done)
   EAP-Response/
   EAP-Type=TEAP, V=1
   (TLS client_key_exchange,
    TLS change_cipher_spec,
    TLS finished) -&gt;
                           &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TLS change_cipher_spec,
                            TLS finished,TLS Hello-Request)

   // TLS channel established 
      (messages sent within the TLS channel)

   // TLS Hello-Request is piggybacked to the TLS Finished as 
      Handshake Data and protected by the TLS tunnel

   TLS client_hello -&gt;


                           &lt;- TLS server_hello,
                            TLS certificate,
                            [TLS server_key_exchange,]
                            [TLS certificate_request,]
                            TLS server_hello_done
   [TLS certificate,]
    TLS client_key_exchange,
   [TLS certificate_verify,]
    TLS change_cipher_spec,
    TLS finished -&gt;

                           &lt;- TLS change_cipher_spec,
                              TLS finished, 
                              Result TLV (Success)

   Result-TLV (Success)) -&gt;

   //TLS channel torn down
   (messages sent in clear text)

                           &lt;- EAP-Success

</pre>
<h1 id="rfc.appendix.Appendix C.5">
<a href="#rfc.appendix.Appendix%20C.5">Appendix C.5.</a> Fragmentation and Reassembly</h1>
<p id="rfc.section.Appendix C.5.p.1">In the case where TEAP fragmentation is required, the conversation will appear as follows:</p>
<div id="#rfc.figure.41"></div>
<pre>
   Authenticating Peer     Authenticator
   -------------------     -------------
                           &lt;- EAP-Request/
                           Identity
   EAP-Response/
   Identity (MyID) -&gt;
                           &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TEAP Start, S bit set, Authority-ID)

   EAP-Response/
   EAP-Type=TEAP, V=1
   (TLS client_hello)-&gt;
                           &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TLS server_hello,
                            TLS certificate,
                           [TLS server_key_exchange,]
                           [TLS certificate_request,]
                            TLS server_hello_done)
                           (Fragment 1: L, M bits set)

   EAP-Response/
   EAP-Type=TEAP, V=1 -&gt;

                           &lt;- EAP-Request/
                              EAP-Type=TEAP, V=1
                           (Fragment 2: M bit set)
   EAP-Response/
   EAP-Type=TEAP, V=1 -&gt;
                           &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (Fragment 3)
   EAP-Response/
   EAP-Type=TEAP, V=1
   ([TLS certificate,]
    TLS client_key_exchange,
   [TLS certificate_verify,]
    TLS change_cipher_spec,
    TLS finished)
    (Fragment 1: L, M bits set)-&gt;

                            &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
   EAP-Response/
   EAP-Type=TEAP, V=1
   (Fragment 2)-&gt;
                          &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TLS change_cipher_spec,
                            TLS finished, 
                           [EAP-Payload-TLV[
                           EAP-Request/Identity]])

   // TLS channel established 
      (messages sent within the TLS channel)

   // First EAP Payload TLV is piggybacked to the TLS Finished as 
      Application Data and protected by the TLS tunnel

   EAP-Payload-TLV
   [EAP-Response/Identity (MyID2)]-&gt;

   // identity protected by TLS. 

                            &lt;- EAP-Payload-TLV
                            [EAP-Request/EAP-Type=X]

   EAP-Payload-TLV
   [EAP-Response/EAP-Type=X] -&gt;

   // Method X exchanges followed by Protected Termination

                            &lt;- Crypto-Binding TLV (Version=1,
                            TEAP Version=1, Nonce, 
                            CompoundMAC),
                            Result TLV (Success)

   Crypto-Binding TLV (Version=1,
   TEAP Version=1, Nonce, 
   CompoundMAC),
   Result-TLV (Success) -&gt;

   // TLS channel torn down
   (messages sent in clear text)

                           &lt;- EAP-Success

</pre>
<h1 id="rfc.appendix.Appendix C.6">
<a href="#rfc.appendix.Appendix%20C.6">Appendix C.6.</a> Sequence of EAP Methods</h1>
<p id="rfc.section.Appendix C.6.p.1">When TEAP is negotiated, with a sequence of EAP method X followed by method Y, the conversation will occur as follows:</p>
<div id="#rfc.figure.42"></div>
<pre>
   Authenticating Peer     Authenticator
   -------------------     -------------
                           &lt;- EAP-Request/
                           Identity
   EAP-Response/
   Identity (MyID1) -&gt;
                           &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TEAP Start, S bit set, Authority-ID)

   EAP-Response/
   EAP-Type=TEAP, V=1
   (TLS client_hello)-&gt;
                           &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TLS server_hello,
                            TLS certificate,
                           [TLS server_key_exchange,]
                           [TLS certificate_request,]
                            TLS server_hello_done)
   EAP-Response/
   EAP-Type=TEAP, V=1
   ([TLS certificate,]
    TLS client_key_exchange,
   [TLS certificate_verify,]
    TLS change_cipher_spec,
    TLS finished) -&gt;
                          &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TLS change_cipher_spec,
                            TLS finished,
                           EAP-Payload-TLV[
                           EAP-Request/Identity])

   // TLS channel established 
      (messages sent within the TLS channel)

   // First EAP Payload TLV is piggybacked to the TLS Finished as 
      Application Data and protected by the TLS tunnel

   EAP-Payload-TLV
   [EAP-Response/Identity] -&gt;

                           &lt;- EAP-Payload-TLV
                         [EAP-Request/EAP-Type=X]

   EAP-Payload-TLV
   [EAP-Response/EAP-Type=X] -&gt;

          // Optional additional X Method exchanges... 

                          &lt;- EAP-Payload-TLV
                         [EAP-Request/EAP-Type=X]

   EAP-Payload-TLV
   [EAP-Response/EAP-Type=X]-&gt;

                           &lt;- Intermediate Result TLV (Success),
                            Crypto-Binding TLV (Version=1
                            TEAP Version=1, Nonce, 
                            CompoundMAC),
                            EAP Payload TLV [EAP-Type=Y],

   // Next EAP conversation started after successful completion 
      of previous method X. The Intermediate-Result and Crypto-
      Binding TLVs are sent in next packet to minimize round-
      trips.  In this example, identity request is not sent 
      before negotiating EAP-Type=Y.

   // Compound MAC calculated using Keys generated from
      EAP methods X and the TLS tunnel.
  
   Intermediate Result TLV (Success),
   Crypto-Binding TLV (Version=1,
   TEAP Version=1, Nonce, 
   CompoundMAC),
   EAP-Payload-TLV [EAP-Type=Y] -&gt;

          // Optional additional Y Method exchanges... 

                          &lt;- EAP Payload TLV [
                          EAP-Type=Y]

   EAP Payload TLV
   [EAP-Type=Y] -&gt;

                          &lt;- Intermediate-Result-TLV (Success),
                            Crypto-Binding TLV (Version=1
                            TEAP Version=1, Nonce, 
                            CompoundMAC),
                            Result TLV (Success)

   Intermediate-Result-TLV (Success),
   Crypto-Binding TLV (Version=1,
   TEAP Version=1, Nonce, 
   CompoundMAC),
   Result-TLV (Success) -&gt;

   // Compound MAC calculated using Keys generated from EAP 
      methods X and Y and the TLS tunnel. Compound Keys 
      generated using Keys generated from EAP methods X and Y; 
      and the TLS tunnel.
   
   // TLS channel torn down (messages sent in clear text)

                           &lt;- EAP-Success
</pre>
<h1 id="rfc.appendix.Appendix C.7">
<a href="#rfc.appendix.Appendix%20C.7">Appendix C.7.</a> Failed Crypto-binding</h1>
<p id="rfc.section.Appendix C.7.p.1">The following exchanges show a failed crypto-binding validation.  The conversation will appear as follows:</p>
<div id="#rfc.figure.43"></div>
<pre>
Authenticating Peer     Authenticator
-------------------     -------------
                        &lt;- EAP-Request/
                        Identity
EAP-Response/
Identity (MyID1) -&gt;
                        &lt;- EAP-Request/
                        EAP-Type=TEAP, V=1
                        (TEAP Start, S bit set, Authority-ID)

EAP-Response/
EAP-Type=TEAP, V=1
(TLS client_hello without 
PAC-Opaque extension)-&gt;
                        &lt;- EAP-Request/
                        EAP-Type=TEAP, V=1
                        (TLS Server Key Exchange 
                         TLS Server Hello Done)
EAP-Response/
EAP-Type=TEAP, V=1 -&gt;
(TLS Client Key Exchange
 TLS change_cipher_spec,
 TLS finished)

                        &lt;- EAP-Request/
                        EAP-Type=TEAP, V=1
                        (TLS change_cipher_spec
                         TLS finished)
                         EAP-Payload-TLV[
                         EAP-Request/Identity])

   // TLS channel established 
      (messages sent within the TLS channel)

   // First EAP Payload TLV is piggybacked to the TLS Finished as 
      Application Data and protected by the TLS tunnel

EAP-Payload TLV/
EAP Identity Response -&gt;

                       &lt;-  EAP Payload TLV, EAP-Request, 
                           (EAP-MSCHAPV2, Challenge)

EAP Payload TLV, EAP-Response,
(EAP-MSCHAPV2, Response) -&gt;

                       &lt;-  EAP Payload TLV, EAP-Request, 
                           (EAP-MSCHAPV2, Success Request)

EAP Payload TLV, EAP-Response,
(EAP-MSCHAPV2, Success Response) -&gt;
    
                         &lt;- Crypto-Binding TLV (Version=1,
                            TEAP Version=1, Nonce, 
                            CompoundMAC),
                            Result TLV (Success)

   Result TLV (Failure) 
   Error TLV with 
   (Error Code = 2001) -&gt;

// TLS channel torn down
   (messages sent in clear text)

                        &lt;- EAP-Failure
</pre>
<h1 id="rfc.appendix.Appendix C.8">
<a href="#rfc.appendix.Appendix%20C.8">Appendix C.8.</a> Sequence of EAP Method with Vendor-Specific TLV Exchange</h1>
<p id="rfc.section.Appendix C.8.p.1">When TEAP is negotiated, with a sequence of EAP method followed by Vendor-Specific TLV exchange, the conversation will occur as follows:</p>
<div id="#rfc.figure.44"></div>
<pre>
   Authenticating Peer     Authenticator
   -------------------     -------------
                           &lt;- EAP-Request/
                           Identity
   EAP-Response/
   Identity (MyID1) -&gt;
                           &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TEAP Start, S bit set, Authority-ID)

   EAP-Response/
   EAP-Type=TEAP, V=1
   (TLS client_hello)-&gt;
                           &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TLS server_hello,
                            TLS certificate,
                    [TLS server_key_exchange,]
                    [TLS certificate_request,]
                        TLS server_hello_done)

   EAP-Response/
   EAP-Type=TEAP, V=1
   ([TLS certificate,]
    TLS client_key_exchange,
   [TLS certificate_verify,]
    TLS change_cipher_spec,
    TLS finished) -&gt;
                          &lt;- EAP-Request/
                           EAP-Type=TEAP, V=1
                           (TLS change_cipher_spec,
                            TLS finished,
                           EAP-Payload-TLV[
                           EAP-Request/Identity])

   // TLS channel established 
      (messages sent within the TLS channel)

   // First EAP Payload TLV is piggybacked to the TLS Finished as 
      Application Data and protected by the TLS tunnel

   EAP-Payload-TLV
   [EAP-Response/Identity] -&gt;

                         &lt;- EAP-Payload-TLV
                         [EAP-Request/EAP-Type=X]

   EAP-Payload-TLV
   [EAP-Response/EAP-Type=X] -&gt;

                          &lt;- EAP-Payload-TLV
                         [EAP-Request/EAP-Type=X]

   EAP-Payload-TLV
   [EAP-Response/EAP-Type=X]-&gt;

                           &lt;- Intermediate Result TLV (Success),
                            Crypto-Binding TLV (Version=1
                            TEAP Version=1, Nonce, 
                            CompoundMAC),
                            Vendor-Specific TLV,

   // Vendor Specific TLV exchange started after successful  
      completion of previous method X. The Intermediate-Result
      and Crypto-Binding TLVs are sent with Vendor Specific TLV 
      in next packet to minimize round-trips.  

   // Compound MAC calculated using Keys generated from
      EAP methods X and the TLS tunnel.

   Intermediate Result TLV (Success),
   Crypto-Binding TLV (Version=1,
   TEAP Version=1, Nonce, 
   CompoundMAC),
   Vendor-Specific TLV -&gt;

       // Optional additional Vendor-Specific TLV exchanges... 

                          &lt;- Vendor-Specific TLV 

   Vendor Specific TLV -&gt;
                          &lt;- Result TLV (Success)

   Result-TLV (Success) -&gt;
  
   // TLS channel torn down (messages sent in clear text)

                           &lt;- EAP-Success</pre>
<h1 id="rfc.appendix.Appendix D">
<a href="#rfc.appendix.Appendix%20D">Appendix D.</a> <a href="#revchanges" id="revchanges">Major Differences from previous revisions</a>
</h1>
<h1 id="rfc.appendix.Appendix D.1">
<a href="#rfc.appendix.Appendix%20D.1">Appendix D.1.</a> <a href="#rev01" id="rev01">Changes from -00</a>
</h1>
<p></p>

<ol>
<li>Changed protocol name to TEAP: Tunnel EAP Method</li>
<li>Changed version of protocol to version 1</li>
<li>Revised introduction</li>
<li>Moved differences section to appendix</li>
<li>Revised design goals section</li>
<li>Revised PAC definition</li>
<li>Revised protocol description to be in line with RFC 5077 PAC distribution</li>
<li>Revised EAP Sequences Section</li>
<li>Added section on PAC provisioning within tunnel</li>
<li>Added outer TLVs to the message format</li>
<li>Renumbered TLVs</li>
<li>Included PAC TLVs</li>
<li>Added Authority ID TLV</li>
<li>Added PKCS#7 and server trust root TLV definitions</li>
<li>Added PKCS#10 TLV</li>
<li>Added EAP-Type and outer TLVs to crypto binding compound MAC</li>
</ol>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Hao Zhou</span> 
	  <span class="n hidden">
		<span class="family-name">Zhou</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems</span>
	<span class="adr">
	  <span>4125 Highlander Parkway</span>

	  <span class="vcardline">
		<span class="locality">Richfield</span>,  
		<span class="region">OH</span> 
		<span class="code">44286</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:hzhou@cisco.com">hzhou@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Nancy Cam-Winget</span> 
	  <span class="n hidden">
		<span class="family-name">Cam-Winget</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems</span>
	<span class="adr">
	  <span>3625 Cisco Way</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">CA</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ncamwing@cisco.com">ncamwing@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Joseph Salowey</span> 
	  <span class="n hidden">
		<span class="family-name">Salowey</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems</span>
	<span class="adr">
	  <span>2901 3rd Ave</span>

	  <span class="vcardline">
		<span class="locality">Seattle</span>,  
		<span class="region">WA</span> 
		<span class="code">98121</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jsalowey@cisco.com">jsalowey@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Stephen Hanna</span> 
	  <span class="n hidden">
		<span class="family-name">Hanna</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks</span>
	<span class="adr">
	  <span>79 Parsons Street</span>

	  <span class="vcardline">
		<span class="locality">Brighton</span>,  
		<span class="region">MA</span> 
		<span class="code">02135</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:shanna@juniper.net">shanna@juniper.net</a></span>

  </address>
</div>

</body>
</html>