<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>The Messaging Layer Security (MLS) Architecture</title>
<meta content="Emad Omara" name="author">
<meta content="Benjamin Beurdouche" name="author">
<meta content="Eric Rescorla" name="author">
<meta content="Srinivas Inguva" name="author">
<meta content="Albert Kwon" name="author">
<meta content="Alan Duric" name="author">
<meta content="
       This document describes the reference architecture, functional and
security requirements for the Messaging Layer Security (MLS) protocol.
MLS provides a security layer for group messaging applications, where
the number of clients ranges from two to many. It is meant to protect
against eavesdropping, tampering, and message forgery. 
    " name="description">
<meta content="xml2rfc 2.47.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-mls-architecture-05" name="ietf.draft">
<link href="/tmp/draft-ietf-mls-architecture-05-3_8hpfca.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">MLS Architecture</td>
<td class="right">July 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Omara, et al.</td>
<td class="center">Expires 27 January 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-mls-architecture-05</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-07-26" class="published">26 July 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-01-27">27 January 2021</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">E. Omara</div>
<div class="org">Google</div>
</div>
<div class="author">
      <div class="author-name">B. Beurdouche</div>
<div class="org">INRIA</div>
</div>
<div class="author">
      <div class="author-name">E. Rescorla</div>
<div class="org">Mozilla</div>
</div>
<div class="author">
      <div class="author-name">S. Inguva</div>
<div class="org">Twitter</div>
</div>
<div class="author">
      <div class="author-name">A. Kwon</div>
<div class="org">MIT</div>
</div>
<div class="author">
      <div class="author-name">A. Duric</div>
<div class="org">Wire</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">The Messaging Layer Security (MLS) Architecture</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes the reference architecture, functional and
security requirements for the Messaging Layer Security (MLS) protocol.
MLS provides a security layer for group messaging applications, where
the number of clients ranges from two to many. It is meant to protect
against eavesdropping, tampering, and message forgery.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
  <span><a href="https://github.com/mlswg/mls-architecture">https://github.com/mlswg/mls-architecture</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 27 January 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-general-setting" class="xref">General Setting</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-group-members-and-clients" class="xref">Group, Members and Clients</a><a href="#section-toc.1-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1" class="keepWithNext"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-authentication-service" class="xref">Authentication Service</a><a href="#section-toc.1-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-delivery-service" class="xref">Delivery Service</a><a href="#section-toc.1-1.2.2.3.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.2.2.3.2.1">
                    <p id="section-toc.1-1.2.2.3.2.1.1"><a href="#section-2.3.1" class="xref">2.3.1</a>.  <a href="#name-key-storage" class="xref">Key Storage</a><a href="#section-toc.1-1.2.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.2.2.3.2.2">
                    <p id="section-toc.1-1.2.2.3.2.2.1"><a href="#section-2.3.2" class="xref">2.3.2</a>.  <a href="#name-key-retrieval" class="xref">Key Retrieval</a><a href="#section-toc.1-1.2.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.2.2.3.2.3">
                    <p id="section-toc.1-1.2.2.3.2.3.1"><a href="#section-2.3.3" class="xref">2.3.3</a>.  <a href="#name-delivery-of-messages-and-at" class="xref">Delivery of messages and attachments</a><a href="#section-toc.1-1.2.2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.2.2.3.2.4">
                    <p id="section-toc.1-1.2.2.3.2.4.1"><a href="#section-2.3.4" class="xref">2.3.4</a>.  <a href="#name-membership-knowledge" class="xref">Membership knowledge</a><a href="#section-toc.1-1.2.2.3.2.4.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.2.2.3.2.5">
                    <p id="section-toc.1-1.2.2.3.2.5.1"><a href="#section-2.3.5" class="xref">2.3.5</a>.  <a href="#name-membership-and-offline-memb" class="xref">Membership and offline members</a><a href="#section-toc.1-1.2.2.3.2.5.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-system-requirements" class="xref">System Requirements</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-functional-requirements" class="xref">Functional Requirements</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="xref">3.1.1</a>.  <a href="#name-asynchronous-usage" class="xref">Asynchronous Usage</a><a href="#section-toc.1-1.3.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="xref">3.1.2</a>.  <a href="#name-recovery-after-state-loss" class="xref">Recovery After State Loss</a><a href="#section-toc.1-1.3.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.3.2.1.2.3">
                    <p id="section-toc.1-1.3.2.1.2.3.1"><a href="#section-3.1.3" class="xref">3.1.3</a>.  <a href="#name-support-for-multiple-device" class="xref">Support for Multiple Devices</a><a href="#section-toc.1-1.3.2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.3.2.1.2.4">
                    <p id="section-toc.1-1.3.2.1.2.4.1"><a href="#section-3.1.4" class="xref">3.1.4</a>.  <a href="#name-extensibility-pluggability" class="xref">Extensibility / Pluggability</a><a href="#section-toc.1-1.3.2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.3.2.1.2.5">
                    <p id="section-toc.1-1.3.2.1.2.5.1"><a href="#section-3.1.5" class="xref">3.1.5</a>.  <a href="#name-privacy" class="xref">Privacy</a><a href="#section-toc.1-1.3.2.1.2.5.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.3.2.1.2.6">
                    <p id="section-toc.1-1.3.2.1.2.6.1"><a href="#section-3.1.6" class="xref">3.1.6</a>.  <a href="#name-federation" class="xref">Federation</a><a href="#section-toc.1-1.3.2.1.2.6.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.3.2.1.2.7">
                    <p id="section-toc.1-1.3.2.1.2.7.1"><a href="#section-3.1.7" class="xref">3.1.7</a>.  <a href="#name-compatibility-with-future-v" class="xref">Compatibility with future versions of MLS</a><a href="#section-toc.1-1.3.2.1.2.7.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-security-requirements" class="xref">Security Requirements</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="xref">3.2.1</a>.  <a href="#name-connections-between-clients" class="xref">Connections between Clients and Servers (one-to-one)</a><a href="#section-toc.1-1.3.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a href="#section-3.2.2" class="xref">3.2.2</a>.  <a href="#name-message-secrecy-and-authent" class="xref">Message Secrecy and Authentication</a><a href="#section-toc.1-1.3.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-transport-security-links" class="xref">Transport Security Links</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-delivery-service-compromise" class="xref">Delivery Service Compromise</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-authentication-service-comp" class="xref">Authentication Service Compromise</a><a href="#section-toc.1-1.4.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-client-compromise" class="xref">Client Compromise</a><a href="#section-toc.1-1.4.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-contributors" class="xref">Contributors</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-appendix.a" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">RFC EDITOR: PLEASE REMOVE THE FOLLOWING PARAGRAPH<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The source for this draft is maintained in GitHub.  Suggested changes should
be submitted as pull requests at https://github.com/mlswg/mls-architecture.
Instructions are on that page as well.  Editorial changes can be managed in
GitHub, but any substantive change should be discussed on the MLS mailing list.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">End-to-end security is a requirement for instant messaging systems and
is commonly deployed in many such systems. In this context,
"end-to-end" captures the notion that users of the system enjoy some
level of security - with the precise level depending on the system
design - even when the service provider they are using performs
unsatisfactorily.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">Messaging Layer Security (MLS) specifies an architecture (this
document) and an abstract protocol <span>[<a href="#MLSPROTO" class="xref">MLSPROTO</a>]</span> for providing
end-to-end security in this setting. MLS is not intended as a full
instant messaging protocol but rather is intended to be embedded in a
concrete protocol such as XMPP <span>[<a href="#RFC6120" class="xref">RFC6120</a>]</span>. In addition, it does not
specify a complete wire encoding, but rather a set of abstract data
structures which can then be mapped onto a variety of concrete
encodings, such as TLS <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>, CBOR <span>[<a href="#RFC7049" class="xref">RFC7049</a>]</span>, and
JSON <span>[<a href="#RFC7159" class="xref">RFC7159</a>]</span>.  Implementations which adopt compatible encodings
will have some degree of interoperability at the message level, though
they may have incompatible identity/authentication infrastructures.
The MLS protocol has been designed to provide the same security
guarantees to all users, for all group sizes, even when it reduces to
only two users.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">This document is intended to describe the overall messaging system
architecture which the MLS protocol fits into, including the
operational requirements needed to achieve a functional system, and to
describe the security goals it is intended to fulfill.<a href="#section-1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="general-setting">
<section id="section-2">
      <h2 id="name-general-setting">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-general-setting" class="section-name selfRef">General Setting</a>
      </h2>
<p id="section-2-1">Informally, a group is a set of users who possibly use multiple
endpoint devices to interact with the Service Provider (SP).
A group may be as small as two members (the simple case of person to
person messaging) or as large as thousands.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">In order to communicate securely, users initially interact with
services at their disposal to establish the necessary values and
credentials required for encryption and authentication.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">The Service Provider presents two abstract services that allow
clients to prepare for sending and receiving messages securely:<a href="#section-2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-4.1">An Authentication Service (AS) which is responsible for maintaining
user long term identities, issuing credentials which allow them to
authenticate each other, and potentially allowing users to
discover each other's long-term identity keys.<a href="#section-2-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-4.2">A Delivery Service (DS) which is responsible for receiving and
redistributing messages between group members.
In the case of group messaging, the delivery service may also be
responsible for acting as a "broadcaster" where the sender sends a
single message to a group which is then forwarded to each recipient
in the group by the DS. The DS is also responsible for storing and
delivering initial public key material required by clients in order
to proceed with the group secret key establishment process.<a href="#section-2-4.2" class="pilcrow">¶</a>
</li>
      </ul>
<div class="artwork art-text alignLeft" id="section-2-5">
<pre>
      ----------------      --------------
     | Authentication |    | Delivery     |
     | Service (AS)   |    | Service (DS) |
      ----------------      --------------
                         /        |         \            Group
                        / ************************************
                       /  *       |           \              *
            ----------    *   ----------        ----------   *
           | Client 0 |   *  | Member 1 |      | Member N |  *
            ----------    *   ----------        ----------   *
           ............   *  ............      ............  *
           User 0         *  User 0            User 1        *
                          *                                  *
                          ************************************
</pre><a href="#section-2-5" class="pilcrow">¶</a>
</div>
<p id="section-2-6">In many systems, the AS and the DS are actually operated by the same
entity and may even be the same server. However, they are logically
distinct and, in other systems, may be operated by different entities,
hence we show them as being separate here. Other partitions are also
possible, such as having a separate directory server.<a href="#section-2-6" class="pilcrow">¶</a></p>
<p id="section-2-7">A typical group messaging scenario might look like this:<a href="#section-2-7" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2-8">
        <li id="section-2-8.1">Alice, Bob and Charlie create accounts with a service
provider and obtain credentials from the AS.<a href="#section-2-8.1" class="pilcrow">¶</a>
</li>
        <li id="section-2-8.2">Alice, Bob and Charlie authenticate to the DS and store
some initial keying material which can be used to send encrypted
messages to them for the first time. This keying material is
authenticated with their long term credentials.<a href="#section-2-8.2" class="pilcrow">¶</a>
</li>
        <li id="section-2-8.3">When Alice wants to send a message to Bob and Charlie, she
contacts the DS and looks up their initial keying material.
She uses these keys to establish a new set of keys which she can
use to send encrypted messages to Bob and Charlie. She then sends
the encrypted message(s) to the DS, which forwards them to the
recipients.<a href="#section-2-8.3" class="pilcrow">¶</a>
</li>
        <li id="section-2-8.4">Bob and/or Charlie respond to Alice's message. In addtion, they
might choose to update their key material which provides
post-compromise security <a href="#fs-and-pcs" class="xref">Section 3.2.2.1</a>. As a consequence of that
change, the group secrets are updated<a href="#section-2-8.4" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-2-9">Clients may wish to do the following:<a href="#section-2-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-10.1">create a group by inviting a set of other clients;<a href="#section-2-10.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-10.2">add one or more clients to an existing group;<a href="#section-2-10.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-10.3">remove one or more members from an existing group;<a href="#section-2-10.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-10.4">update their own key material<a href="#section-2-10.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-10.5">join an existing group;<a href="#section-2-10.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-10.6">leave a group;<a href="#section-2-10.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-10.7">send a message to everyone in the group;<a href="#section-2-10.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-10.8">receive a message from someone in the group.<a href="#section-2-10.8" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-11">At the cryptographic level, clients (and by extension members in
groups) have equal permissions. For instance, any member can add
or remove another client in a group. This is in contrast to some
designs in which there is a single group controller who can modify the
group. MLS is compatible with having group administration restricted
to certain users, but we assume that those restrictions are enforced
by authentication and access control at the application layer.<a href="#section-2-11" class="pilcrow">¶</a></p>
<p id="section-2-12">Thus, for instance, while the MLS protocol allows for any existing
member of a group to add a new client, applications which use MLS
might enforce additional restrictions for which only a subset of
members can qualify, and thus will handle enforcing group policies
(such as determining if a user is allowed to add new users to the
group) at the application level.<a href="#section-2-12" class="pilcrow">¶</a></p>
<div id="group-members-and-clients">
<section id="section-2.1">
        <h3 id="name-group-members-and-clients">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-group-members-and-clients" class="section-name selfRef">Group, Members and Clients</a>
        </h3>
<p id="section-2.1-1">While informally, a group can be considered to be a set of users
possibly using multiple endpoint devices to interact with the
Service Provider, this definition is too simplistic.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">Formally, a Client is a set of cryptographic objects composed by
public values such as a name (an identity), a public encryption key
and a public signature key. Ownership of a Client by a user is
determined by the fact that the user has knowledge of the
associated secret values. When a Client is part of a Group, it is
called a Member and its signature key pair uniquely defines its
identity to other clients or members a the Group.
In some messaging systems, clients belonging to the same user must
all share the same identity key pair, but MLS does not assume this.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">Users will typically own multiple Clients, potentially one or more per
end-user devices (phones, web clients or other devices...) and may
choose to authenticate using the same signature key across devices,
using one signature key per device or even one signature key per group.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">The formal definition of a Group in MLS is the set of clients that
have knowledge of the shared group secret established in the group key
establishment phase of the protocol and have contributed to it.
Until a Member has contributed to the group secret, other members
cannot assume she is a member of the group.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authentication-service">
<section id="section-2.2">
        <h3 id="name-authentication-service">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-authentication-service" class="section-name selfRef">Authentication Service</a>
        </h3>
<p id="section-2.2-1">The basic function of the Authentication Service (AS) is to provide a
trusted mapping from user identities (usernames, phone numbers, etc.),
to long-term identity keys, which may either be one per Client or may
be shared amongst the clients attached to a user.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">The Authentication Service (AS) is expected to play multiple roles in the
architecture:<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-3.1">A certification authority or similar service which signs some sort of
portable credential binding an identity to a signature key.<a href="#section-2.2-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.2-3.2">A directory server which provides the key for a given identity
(presumably this connection is secured via some form of transport
security such as TLS).<a href="#section-2.2-3.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.2-4">The MLS protocol assumes a signature keypair for authentication of
messages. It is important to note that this signature keypair might be
the identity keypair directly, or a different signature keypair for
which the public key has been for example signed by the identity
private key. This flexibility allows for multiple infrastructure
considerations and has the benefit of providing ways to use
different signature keys across different groups by using hierarchical
authentication keys. This flexibility also comes at the price of a
security tradeoff, described in the security considerations, between
potential unlinkability of the signature keys across groups and the
amount of time required to reinstate authentication and secrecy of
messages after the compromise of a device.<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.2-5">Ultimately, the only requirement is for the applications to be able to
check the credential containing the protocol signing key and the
identity against the Authentication Service at any time.<a href="#section-2.2-5" class="pilcrow">¶</a></p>
<p id="section-2.2-6">By definition, the Authentication Service is invested with a large
amount of trust.  A malicious AS can impersonate - or allow an
attacker to impersonate - any user of the system. As a corollary, by
impersonating identities authorized to be members of a group, an AS
can break confidentiality.<a href="#section-2.2-6" class="pilcrow">¶</a></p>
<p id="section-2.2-7">This risk can be mitigated by publishing the binding between
identities and keys in a public log such as Key Transparency (KT)
<span>[<a href="#KeyTransparency" class="xref">KeyTransparency</a>]</span>. It is possible to build a functional MLS system
without any kind of public key logging, but such a system will
necessarily be somewhat vulnerable to attack by a malicious or
untrusted AS.<a href="#section-2.2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="delivery-service">
<section id="section-2.3">
        <h3 id="name-delivery-service">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-delivery-service" class="section-name selfRef">Delivery Service</a>
        </h3>
<p id="section-2.3-1">The Delivery Service (DS) is expected to play multiple roles in the
Service Provider architecture:<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3-2.1">To act as a directory service providing the initial keying material
for clients to use.
This allows a client to establish a shared key and send encrypted
messages to other clients even if the other client is offline.<a href="#section-2.3-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.3-2.2">To route messages between clients and to act as a message
broadcaster, taking in one message and forwarding it to multiple
clients (also known as "server side fanout").<a href="#section-2.3-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.3-3">Because the MLS protocol provides a way for Clients to send and receive
application messages asynchronously, it only provides causal
ordering of application messages from senders while it has to enforce
global ordering of group operations to provide Group Agreement.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
<p id="section-2.3-4">Depending on the level of trust given by the group to the Delivery
Service, the functional and privacy guarantees provided by MLS may
differ but the Authentication and Confidentiality guarantees remain
the same.<a href="#section-2.3-4" class="pilcrow">¶</a></p>
<p id="section-2.3-5">Unlike the Authentication Service which is trusted for authentication
and secrecy, the Delivery Service is completely untrusted regarding
this property. While privacy of group membership might be a problem
in the case of a DS server fanout, the Delivery Service can be
considered as an active adaptative network attacker from the point of
view of the security analysis.<a href="#section-2.3-5" class="pilcrow">¶</a></p>
<div id="key-storage">
<section id="section-2.3.1">
          <h4 id="name-key-storage">
<a href="#section-2.3.1" class="section-number selfRef">2.3.1. </a><a href="#name-key-storage" class="section-name selfRef">Key Storage</a>
          </h4>
<p id="section-2.3.1-1">Upon joining the system, each client stores its initial cryptographic
key material with the Delivery Service. This key material, called
KeyPackage, advertises the functional abilities of the Client such as
supported protocol versions and extensions and the following
cryptographic information:<a href="#section-2.3.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.1-2.1">A credential from the Authentication Service attesting to the
binding between the identity and the client's signature key.<a href="#section-2.3.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.3.1-2.2">The client's asymmetric encryption key material signed with the
signature key associated with the credential.<a href="#section-2.3.1-2.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-2.3.1-3">As noted above, users may own multiple clients, each with their
own keying material, and thus there may be multiple entries
stored by each user.<a href="#section-2.3.1-3" class="pilcrow">¶</a></p>
<p id="section-2.3.1-4">The Delivery Service is also responsible for allowing users to add,
remove or update their initial keying material and to ensure
that the identifier for these keys are unique across all keys
stored on the DS.<a href="#section-2.3.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-retrieval">
<section id="section-2.3.2">
          <h4 id="name-key-retrieval">
<a href="#section-2.3.2" class="section-number selfRef">2.3.2. </a><a href="#name-key-retrieval" class="section-name selfRef">Key Retrieval</a>
          </h4>
<p id="section-2.3.2-1">When a client wishes to establish a group, it first contacts the DS to
request a KeyPackage for each other client, authenticate it using
the signature keys, and then can use those to form the group.<a href="#section-2.3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="delivery-guarantees">
<section id="section-2.3.3">
          <h4 id="name-delivery-of-messages-and-at">
<a href="#section-2.3.3" class="section-number selfRef">2.3.3. </a><a href="#name-delivery-of-messages-and-at" class="section-name selfRef">Delivery of messages and attachments</a>
          </h4>
<p id="section-2.3.3-1">The main responsibility of the Delivery Service is to ensure delivery
of messages. Specifically, we assume that DSs provide:<a href="#section-2.3.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.3-2.1">Reliable delivery: when a message is provided to the DS,
it is eventually delivered to all clients.<a href="#section-2.3.3-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.3.3-2.2">In-order delivery: messages are delivered to the group
in the order they are received by the Delivery Service
and in approximately the order in which they are sent
by clients. The latter is an approximate guarantee because
multiple clients may send messages at the same time
and so the DS needs some latitude in enforcing ordering
across clients.<a href="#section-2.3.3-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.3.3-2.3">Consistent ordering: the DS must ensure that all clients
have the same view of message ordering for cryptographically
relevant operations. This means that the DS MUST enforce
global consistency of the ordering of group operation messages.<a href="#section-2.3.3-2.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-2.3.3-3">Note that the protocol provides three important information
within an MLSCiphertext message in order to provide ordering:<a href="#section-2.3.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.3-4.1">The Group Identifier (GID) to allow to distinguish the group for
which the message has been sent;<a href="#section-2.3.3-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.3.3-4.2">The Epoch number, which represent the number of changes (version) of
the group associated with a specific GID, and allows for
lexicographical ordering of two messages from the same group;<a href="#section-2.3.3-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.3.3-4.3">The Content Type of the message, which allows the DS to determine
the ordering requirement on the message.<a href="#section-2.3.3-4.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-2.3.3-5">The MLS protocol itself can verify these properties. For instance, if
the DS reorders messages from a Client or provides different Clients
with inconsistent orderings, then Clients can detect this
misconduct. However, the protocol relies on the ordering, and on the
fact that only one honest group operation message is faned-out to
clients per Epoch, to provide Clients with a consistent view of the
evolving Group State.<a href="#section-2.3.3-5" class="pilcrow">¶</a></p>
<p id="section-2.3.3-6">Note that some forms of DS misbehavior are still possible and
difficult to detect. For instance, a DS can simply refuse
to relay messages to and from a given client. Without some
sort of side information, other clients cannot generally
distinguish this form of Denial of Service (DoS) attack.<a href="#section-2.3.3-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="membership-knowledge">
<section id="section-2.3.4">
          <h4 id="name-membership-knowledge">
<a href="#section-2.3.4" class="section-number selfRef">2.3.4. </a><a href="#name-membership-knowledge" class="section-name selfRef">Membership knowledge</a>
          </h4>
<p id="section-2.3.4-1">Group membership is itself sensitive information and MLS is designed
to drastically limit the amount of persisted metadata. However, large
groups often require an infrastructure which provides server fanout.
In the case of client fanout, the destinations of a message is known by
all clients, hence the server usually does not need this information.
However, they may learn this information through traffic analysis.
Unfortunately, in a server side fanout model, the DS can learn that a given
client is sending the same message to a set of other clients. In
addition, there may be applications of MLS in which the group
membership list is stored on some server associated with the DS.<a href="#section-2.3.4-1" class="pilcrow">¶</a></p>
<p id="section-2.3.4-2">While this knowledge is not a break of authentication or
confidentiality, it is a serious issue for privacy. In the case where
metadata has to be persisted for functionality, it SHOULD be stored
encrypted at rest.<a href="#section-2.3.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="membership-and-offline-members">
<section id="section-2.3.5">
          <h4 id="name-membership-and-offline-memb">
<a href="#section-2.3.5" class="section-number selfRef">2.3.5. </a><a href="#name-membership-and-offline-memb" class="section-name selfRef">Membership and offline members</a>
          </h4>
<p id="section-2.3.5-1">Because Forward Secrecy (FS) and Post-Compromise Security (PCS) rely
on the active deletion and replacement of keying material, any client
which is persistently offline may still be holding old keying material
and thus be a threat to both FS and PCS if it is later compromised.<a href="#section-2.3.5-1" class="pilcrow">¶</a></p>
<p id="section-2.3.5-2">MLS cannot inherently defend against this problem, especially in the
case where the Client hasn't processed messages but MLS-using
systems can enforce some mechanism to try retaining these properties.
Typically this will consist of evicting clients which are idle for too
long, thus containing the threat of compromise. The precise details of
such mechanisms are a matter of local policy and beyond the scope of
this document.<a href="#section-2.3.5-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="system-requirements">
<section id="section-3">
      <h2 id="name-system-requirements">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-system-requirements" class="section-name selfRef">System Requirements</a>
      </h2>
<div id="functional-requirements">
<section id="section-3.1">
        <h3 id="name-functional-requirements">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-functional-requirements" class="section-name selfRef">Functional Requirements</a>
        </h3>
<p id="section-3.1-1">MLS is designed as a large scale group messaging protocol and hence
aims to provide performance and safety to its users.  Messaging
systems that implement MLS provide support for conversations involving
two or more members, and aim to scale to groups as large as 50,000 members,
typically including many users using multiple devices.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<div id="asynchronous-usage">
<section id="section-3.1.1">
          <h4 id="name-asynchronous-usage">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-asynchronous-usage" class="section-name selfRef">Asynchronous Usage</a>
          </h4>
<p id="section-3.1.1-1">No operation in MLS requires two distinct clients or members to be
online simultaneously. In particular, members participating in
conversations protected using MLS can update shared keys, add or
remove new members, and send messages and attachments without waiting
for another user's reply.<a href="#section-3.1.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1.1-2">Messaging systems that implement MLS have to provide a transport layer
for delivering messages asynchronously and reliably.<a href="#section-3.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="recovery-after-state-loss">
<section id="section-3.1.2">
          <h4 id="name-recovery-after-state-loss">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-recovery-after-state-loss" class="section-name selfRef">Recovery After State Loss</a>
          </h4>
<p id="section-3.1.2-1">Conversation participants whose local MLS state is lost or corrupted
can reinitialize their state and continue participating in the
conversation.<a href="#section-3.1.2-1" class="pilcrow">¶</a></p>
<p id="section-3.1.2-2">[[OPEN ISSUE: The previous statement seems too strong, establish
what exact functional requirement we have regarding state recovery.
Previously: "This may entail some level of message loss, but
does not result in permanent exclusion from the group."]]<a href="#section-3.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="support-for-multiple-devices">
<section id="section-3.1.3">
          <h4 id="name-support-for-multiple-device">
<a href="#section-3.1.3" class="section-number selfRef">3.1.3. </a><a href="#name-support-for-multiple-device" class="section-name selfRef">Support for Multiple Devices</a>
          </h4>
<p id="section-3.1.3-1">It is typically expected for users within a Group to own different
devices.<a href="#section-3.1.3-1" class="pilcrow">¶</a></p>
<p id="section-3.1.3-2">A new device can be added to a group and be considered as a new client
by the protocol. This client will not gain access to the history even
if it is owned by someone who owns another member of the Group.
Restoring history is typically not allowed at the protocol level but
applications can elect to provide such a mechanism outside of MLS.
Such mechanisms, if used, may undermine the FS and PCS guarantees
provided by MLS.<a href="#section-3.1.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="extensibility-pluggability">
<section id="section-3.1.4">
          <h4 id="name-extensibility-pluggability">
<a href="#section-3.1.4" class="section-number selfRef">3.1.4. </a><a href="#name-extensibility-pluggability" class="section-name selfRef">Extensibility / Pluggability</a>
          </h4>
<p id="section-3.1.4-1">Messages that do not affect the group state can carry an arbitrary
payload with the purpose of sharing that payload between group
members. No assumptions are made about the format of the payload.<a href="#section-3.1.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="privacy">
<section id="section-3.1.5">
          <h4 id="name-privacy">
<a href="#section-3.1.5" class="section-number selfRef">3.1.5. </a><a href="#name-privacy" class="section-name selfRef">Privacy</a>
          </h4>
<p id="section-3.1.5-1">The protocol is designed in a way that limits the server-side (AS and
DS) metadata footprint. The DS only persists data required for the
delivery of messages and avoids Personally Identifiable Information
(PII) or other sensitive metadata wherever possible. A Service Provider
that has control over both the AS and the DS, will not be able to correlate
encrypted messages forwarded by the DS, with the initial public keys signed
by the AS.<a href="#section-3.1.5-1" class="pilcrow">¶</a></p>
<p id="section-3.1.5-2">[[OPEN ISSUE: These privacy statements seem very strong.
BB. I would be willing to keep them as requirements since we have
example solutions in the Server-Assist draft.]]<a href="#section-3.1.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="federation">
<section id="section-3.1.6">
          <h4 id="name-federation">
<a href="#section-3.1.6" class="section-number selfRef">3.1.6. </a><a href="#name-federation" class="section-name selfRef">Federation</a>
          </h4>
<p id="section-3.1.6-1">The protocol aims to be compatible with federated environments. While
this document does not specify all necessary mechanisms required for
federation, multiple MLS implementations can interoperate to form
federated systems if they use compatible authentication mechanisms
and infrastructure functionalities.<a href="#section-3.1.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="compatibility-with-future-versions-of-mls">
<section id="section-3.1.7">
          <h4 id="name-compatibility-with-future-v">
<a href="#section-3.1.7" class="section-number selfRef">3.1.7. </a><a href="#name-compatibility-with-future-v" class="section-name selfRef">Compatibility with future versions of MLS</a>
          </h4>
<p id="section-3.1.7-1">It is important that multiple versions of MLS be able to coexist in
the future.  Thus, MLS offers a version negotiation mechanism; this
mechanism prevents version downgrade attacks where an attacker would
actively rewrite messages with a lower protocol version than the ones
originally offered by the endpoints. When multiple versions of MLS are
available, the negotiation protocol guarantees that the version agreed
upon will be the highest version supported in common by the group.<a href="#section-3.1.7-1" class="pilcrow">¶</a></p>
<p id="section-3.1.7-2">In MLS 1.0, the creator of the group is responsible for selecting the
best ciphersuite proposed across clients. Each client is able to
verify availability of protocol version, ciphersuites and extensions
at all times once he has at least received the first group operation
message.<a href="#section-3.1.7-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-requirements">
<section id="section-3.2">
        <h3 id="name-security-requirements">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-security-requirements" class="section-name selfRef">Security Requirements</a>
        </h3>
<div id="connections-between-clients-and-servers-one-to-one">
<section id="section-3.2.1">
          <h4 id="name-connections-between-clients">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-connections-between-clients" class="section-name selfRef">Connections between Clients and Servers (one-to-one)</a>
          </h4>
<p id="section-3.2.1-1">We assume that all transport connections are secured via some transport
layer security mechanism such as TLS <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>. However,
as noted above, the security of MLS will generally survive compromise
of the transport layer, so long as identity keys provided by the AS are
authenticated at a minimum. However, MLS ciphertext contains the Group
Identifier, Epoch number and Content Type that may be used to improve
attacks on the privacy of the group.<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="message-secrecy-authentication">
<section id="section-3.2.2">
          <h4 id="name-message-secrecy-and-authent">
<a href="#section-3.2.2" class="section-number selfRef">3.2.2. </a><a href="#name-message-secrecy-and-authent" class="section-name selfRef">Message Secrecy and Authentication</a>
          </h4>
<p id="section-3.2.2-1">The trust establishment step of the MLS protocol is followed by a
conversation protection step where encryption is used by clients to
transmit authenticated messages to other clients through the DS.
This ensures that the DS does not have access to the group's private
content.<a href="#section-3.2.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2.2-2">MLS aims to provide secrecy, integrity and authentication for all
messages.<a href="#section-3.2.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2.2-3">Message Secrecy in the context of MLS means that only intended
recipients (current group members), can read any message sent to the
group, even in the context of an active attacker as described in the
threat model.<a href="#section-3.2.2-3" class="pilcrow">¶</a></p>
<p id="section-3.2.2-4">Message Integrity and Authentication mean that an honest Client can
only accept a message if it was sent by a group member and that no
Client can send a message which other Clients accept as being from
another Client.<a href="#section-3.2.2-4" class="pilcrow">¶</a></p>
<p id="section-3.2.2-5">A corollary to this statement is that the AS and the DS cannot read
the content of messages sent between Members as they are not Members
of the Group. MLS optionally provides additional protections regarding
traffic analysis so as to reduce the ability of attackers, or a
compromised member of the messaging system, to deduce the content of
the messages depending on (for example) their size. One of these
protections includes padding messages in order to produce ciphertexts
of standard length. While this protection is highly recommended it is
not mandatory as it can be costly in terms of performance for clients
and the SP.<a href="#section-3.2.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2.2-6">Message content can be deniable if the signature keys are exchanged
over a deniable channel prior to signing messages.<a href="#section-3.2.2-6" class="pilcrow">¶</a></p>
<div id="fs-and-pcs">
<section id="section-3.2.2.1">
            <h5 id="name-forward-and-post-compromise">
<a href="#section-3.2.2.1" class="section-number selfRef">3.2.2.1. </a><a href="#name-forward-and-post-compromise" class="section-name selfRef">Forward and Post-Compromise Security</a>
            </h5>
<p id="section-3.2.2.1-1">MLS provides additional protection regarding secrecy of past messages
and future messages. These cryptographic security properties are
Forward Secrecy (FS) and Post-Compromise Security (PCS).<a href="#section-3.2.2.1-1" class="pilcrow">¶</a></p>
<p id="section-3.2.2.1-2">FS means that access to all encrypted traffic history combined with an
access to all current keying material on clients will not defeat the
secrecy properties of messages older than the oldest key of the
compromised client.
Note that this means that clients have the extremely important role of
deleting appropriate keys as soon as they have been used with the
expected message, otherwise the secrecy of the messages and the
security for MLS is considerably weakened.<a href="#section-3.2.2.1-2" class="pilcrow">¶</a></p>
<p id="section-3.2.2.1-3">PCS means that if a group member's state is compromised at some time t
but the group member subsequently performs an update at some time t',
then all MLS guarantees apply to messages sent by the member after
time t', and by other members after they have processed the
update. For example, if an attacker learns all secrets known to Alice
at time t, including both Alice's long-term secret keys and all shared
group keys, but Alice performs a key update at time t', then the
attacker is unable to violate any of the MLS security properties after
the updates have been processed.<a href="#section-3.2.2.1-3" class="pilcrow">¶</a></p>
<p id="section-3.2.2.1-4">Both of these properties are satisfied even against compromised
DSs and ASs.<a href="#section-3.2.2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="membership-changes">
<section id="section-3.2.2.2">
            <h5 id="name-membership-changes">
<a href="#section-3.2.2.2" class="section-number selfRef">3.2.2.2. </a><a href="#name-membership-changes" class="section-name selfRef">Membership Changes</a>
            </h5>
<p id="section-3.2.2.2-1">MLS aims to provide agreement on group membership, meaning that all
group members have agreed on the list of current group members.<a href="#section-3.2.2.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2.2.2-2">Some applications may wish to enforce ACLs to limit addition or
removal of group members, to privileged clients or users. Others may
wish to require authorization from the current group members or a
subset thereof.  Regardless, MLS does not allow addition or removal of
group members without informing all other members.<a href="#section-3.2.2.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2.2.2-3">Once a client is part of a group, the set of devices controlled by the
user can only be altered by an authorized member of the group.
This authorization could depend on the application: some applications
might want to allow certain other members of the group to add or
remove devices on behalf of another member, while other applications
might want a more strict policy and allow only the owner of the
devices to add or remove them at the potential cost of weaker PCS
guarantees.<a href="#section-3.2.2.2-3" class="pilcrow">¶</a></p>
<p id="section-3.2.2.2-4">Members who are removed from a group do not enjoy special privileges:
compromise of a removed group member does not affect the security
of messages sent after their removal but might affect previous messages
if the group secrets have not been deleted properly.<a href="#section-3.2.2.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="parallel-groups">
<section id="section-3.2.2.3">
            <h5 id="name-parallel-groups">
<a href="#section-3.2.2.3" class="section-number selfRef">3.2.2.3. </a><a href="#name-parallel-groups" class="section-name selfRef">Parallel Groups</a>
            </h5>
<p id="section-3.2.2.3-1">Any user may have membership in several Groups simultaneously.
The set of members of any group may or may not form a subset of the
members of another group. MLS guarantees that the FS and PCS goals are
maintained and not weakened by user membership in multiple groups.<a href="#section-3.2.2.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-of-attachments">
<section id="section-3.2.2.4">
            <h5 id="name-security-of-attachments">
<a href="#section-3.2.2.4" class="section-number selfRef">3.2.2.4. </a><a href="#name-security-of-attachments" class="section-name selfRef">Security of Attachments</a>
            </h5>
<p id="section-3.2.2.4-1">The security properties expected for attachments in the MLS protocol
are very similar to the ones expected from messages. The distinction
between messages and attachments stems from the fact that the typical
average time between the download of a message and the one from the
attachments may be different. For many reasons (a typical reason being
the lack of high bandwidth network connectivity), the lifetime of the
cryptographic keys for attachments is usually higher than for
messages, hence slightly weakening the PCS guarantees for attachments.<a href="#section-3.2.2.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="denial-of-service">
<section id="section-3.2.2.5">
            <h5 id="name-denial-of-service">
<a href="#section-3.2.2.5" class="section-number selfRef">3.2.2.5. </a><a href="#name-denial-of-service" class="section-name selfRef">Denial of Service</a>
            </h5>
<p id="section-3.2.2.5-1">In general we do not consider Denial of Service (DoS) resistance to be
the responsibility of the protocol. However, it should not be possible
for anyone aside from the DS to perform a trivial DoS attack from
which it is hard to recover.<a href="#section-3.2.2.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="non-repudiation-vs-deniability">
<section id="section-3.2.2.6">
            <h5 id="name-non-repudiation-vs-deniabil">
<a href="#section-3.2.2.6" class="section-number selfRef">3.2.2.6. </a><a href="#name-non-repudiation-vs-deniabil" class="section-name selfRef">Non-Repudiation vs Deniability</a>
            </h5>
<p id="section-3.2.2.6-1">As described in <a href="#client-compromise" class="xref">Section 4.4</a>, MLS provides strong
authentication within a group, such that a group member cannot send a
message that appears to be from another group member. Additionally,
some services require that a recipient be able to prove to the
service provider that a message was sent by a given client, in order
to report abuse. MLS supports both of these use cases. In some
deployments, these services are provided by mechanisms which allow the
receiver to prove a message's origin to a third party (this if often
called "non-repudiation"), but it should also be possible to operate
MLS in a "deniable" mode where such proof is not possible.
[[OPEN ISSUE: Exactly how to supply this is still a protocol question.]]<a href="#section-3.2.2.6-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-4">
      <h2 id="name-security-considerations">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-4-1">MLS adopts the Internet threat model <span>[<a href="#RFC3552" class="xref">RFC3552</a>]</span> and therefore
assumes that the attacker has complete control of the network. It is
intended to provide the security services described in the face of
such attackers.
In addition, these guarantees are intended to degrade gracefully in
the presence of compromise of the transport security links as well as
of both Clients and elements of the messaging system, as described in
the remainder of this section.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="transport-security-links">
<section id="section-4.1">
        <h3 id="name-transport-security-links">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-transport-security-links" class="section-name selfRef">Transport Security Links</a>
        </h3>
<p id="section-4.1-1">[TODO: Mostly DoS, message suppression, and leakage of group membership.]<a href="#section-4.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="delivery-service-compromise">
<section id="section-4.2">
        <h3 id="name-delivery-service-compromise">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-delivery-service-compromise" class="section-name selfRef">Delivery Service Compromise</a>
        </h3>
<p id="section-4.2-1">MLS is intended to provide strong guarantees in the face of compromise
of the DS. Even a totally compromised DS should not be able to read
messages or inject messages that will be acceptable to legitimate
clients. It should also not be able to undetectably remove, reorder
or replay messages.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">However, a DS can mount a variety of DoS attacks on the system,
including total DoS attacks (where it simply refuses to forward any
messages) and partial DoS attacks (where it refuses to forward
messages to and from specific clients).
As noted in <a href="#delivery-guarantees" class="xref">Section 2.3.3</a>, these attacks are only partially
detectable by clients without an out-of-band channel. Ultimately,
failure of the DS to provide reasonable service must be dealt with as
a customer service matter, not via technology.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">Because the DS is responsible for providing the initial keying
material to clients, it can provide stale keys. This does not
inherently lead to compromise of the message stream, but does allow it
to attack forward security to a limited extent.  This threat can be
mitigated by having initial keys expire.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authentication-service-compromise">
<section id="section-4.3">
        <h3 id="name-authentication-service-comp">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-authentication-service-comp" class="section-name selfRef">Authentication Service Compromise</a>
        </h3>
<p id="section-4.3-1">A compromised AS is a serious matter, as the AS can provide incorrect
or attacker-provided identities to clients.  As noted in
<a href="#authentication-service" class="xref">Section 2.2</a>, detecting this form of attack requires
some sort of transparency/logging mechanism. Without such a mechanism,
MLS cannot detect a compromised AS.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-compromise">
<section id="section-4.4">
        <h3 id="name-client-compromise">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-client-compromise" class="section-name selfRef">Client Compromise</a>
        </h3>
<p id="section-4.4-1">MLS provides a limited form of protection against compromised Clients
through PCS. When the Client is fully compromised, then the attacker
will be able to decrypt any messages for groups in which the Client is a
member, and will be able to send messages impersonating the compromised
Client. However, if the Client afterwards updates its keying material
(see <a href="#fs-and-pcs" class="xref">Section 3.2.2.1</a>) (using fresh randomness that the attacker does not
know) then the PCS property enables the Client to recover.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">In addition, a client cannot send a message to a group which appears to
be from another client with a different identity. Note that if devices
from the same user share keying material, then one will be able to
impersonate another.<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<p id="section-4.4-3">Finally, clients should not be able to perform DoS attacks
<a href="#denial-of-service" class="xref">Section 3.2.2.5</a>.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-5">
      <h2 id="name-iana-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-5-1">This document makes no requests of IANA.<a href="#section-5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="contributors">
<section id="section-6">
      <h2 id="name-contributors">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<ul class="normal">
<li class="normal" id="section-6-1.1">
          <p id="section-6-1.1.1">Katriel Cohn-Gordon<a href="#section-6-1.1.1" class="pilcrow">¶</a></p>
<p id="section-6-1.1.2">
University of Oxford<a href="#section-6-1.1.2" class="pilcrow">¶</a></p>
<p id="section-6-1.1.3">
me@katriel.co.uk<a href="#section-6-1.1.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-1.2">
          <p id="section-6-1.2.1">Cas Cremers<a href="#section-6-1.2.1" class="pilcrow">¶</a></p>
<p id="section-6-1.2.2">
University of Oxford<a href="#section-6-1.2.2" class="pilcrow">¶</a></p>
<p id="section-6-1.2.3">
cas.cremers@cs.ox.ac.uk<a href="#section-6-1.2.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-1.3">
          <p id="section-6-1.3.1">Thyla van der Merwe<a href="#section-6-1.3.1" class="pilcrow">¶</a></p>
<p id="section-6-1.3.2">
Royal Holloway, University of London<a href="#section-6-1.3.2" class="pilcrow">¶</a></p>
<p id="section-6-1.3.3">
thyla.van.der@merwe.tech<a href="#section-6-1.3.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-1.4">
          <p id="section-6-1.4.1">Jon Millican<a href="#section-6-1.4.1" class="pilcrow">¶</a></p>
<p id="section-6-1.4.2">
Facebook<a href="#section-6-1.4.2" class="pilcrow">¶</a></p>
<p id="section-6-1.4.3">
jmillican@fb.com<a href="#section-6-1.4.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-1.5">
          <p id="section-6-1.5.1">Raphael Robert<a href="#section-6-1.5.1" class="pilcrow">¶</a></p>
<p id="section-6-1.5.2">
Wire<a href="#section-6-1.5.2" class="pilcrow">¶</a></p>
<p id="section-6-1.5.3">
raphael@wire.com<a href="#section-6-1.5.3" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<section id="section-7">
      <h2 id="name-informative-references">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
      </h2>
<dl class="references">
<dt id="KeyTransparency">[KeyTransparency]</dt>
      <dd>
<span class="refAuthor">Google, .</span>, <span class="refTitle">"Key Transparency"</span>, <time datetime="2017" class="refDate">2017</time>, <span>&lt;<a href="https://KeyTransparency.org">https://KeyTransparency.org</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="MLSPROTO">[MLSPROTO]</dt>
      <dd>
<span class="refAuthor">Barnes, R.</span><span class="refAuthor">, Beurdouche, B.</span><span class="refAuthor">, Millican, J.</span><span class="refAuthor">, Omara, E.</span><span class="refAuthor">, Cohn-Gordon, K.</span><span class="refAuthor">, and R. Robert</span>, <span class="refTitle">"Messaging Layer Security Protocol"</span>, <time datetime="2018" class="refDate">2018</time>. </dd>
<dd class="break"></dd>
<dt id="RFC3552">[RFC3552]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span><span class="refAuthor"> and B. Korver</span>, <span class="refTitle">"Guidelines for Writing RFC Text on Security Considerations"</span>, <span class="seriesInfo">BCP 72</span>, <span class="seriesInfo">RFC 3552</span>, <span class="seriesInfo">DOI 10.17487/RFC3552</span>, <time datetime="2003-07" class="refDate">July 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3552">https://www.rfc-editor.org/info/rfc3552</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6120">[RFC6120]</dt>
      <dd>
<span class="refAuthor">Saint-Andre, P.</span>, <span class="refTitle">"Extensible Messaging and Presence Protocol (XMPP): Core"</span>, <span class="seriesInfo">RFC 6120</span>, <span class="seriesInfo">DOI 10.17487/RFC6120</span>, <time datetime="2011-03" class="refDate">March 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6120">https://www.rfc-editor.org/info/rfc6120</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7049">[RFC7049]</dt>
      <dd>
<span class="refAuthor">Bormann, C.</span><span class="refAuthor"> and P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">RFC 7049</span>, <span class="seriesInfo">DOI 10.17487/RFC7049</span>, <time datetime="2013-10" class="refDate">October 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7049">https://www.rfc-editor.org/info/rfc7049</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7159">[RFC7159]</dt>
      <dd>
<span class="refAuthor">Bray, T., Ed.</span>, <span class="refTitle">"The JavaScript Object Notation (JSON) Data Interchange Format"</span>, <span class="seriesInfo">RFC 7159</span>, <span class="seriesInfo">DOI 10.17487/RFC7159</span>, <time datetime="2014-03" class="refDate">March 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7159">https://www.rfc-editor.org/info/rfc7159</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
    <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<div id="authors-addresses">
<section id="section-appendix.a">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Emad Omara</span></div>
<div dir="auto" class="left"><span class="org">Google</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:emadomara@google.com" class="email">emadomara@google.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Benjamin Beurdouche</span></div>
<div dir="auto" class="left"><span class="org">INRIA</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:benjamin.beurdouche@inria.fr" class="email">benjamin.beurdouche@inria.fr</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Eric Rescorla</span></div>
<div dir="auto" class="left"><span class="org">Mozilla</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ekr@rtfm.com" class="email">ekr@rtfm.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Srinivas Inguva</span></div>
<div dir="auto" class="left"><span class="org">Twitter</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:singuva@twitter.com" class="email">singuva@twitter.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Albert Kwon</span></div>
<div dir="auto" class="left"><span class="org">MIT</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:kwonal@mit.edu" class="email">kwonal@mit.edu</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Alan Duric</span></div>
<div dir="auto" class="left"><span class="org">Wire</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:alan@wire.com" class="email">alan@wire.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
