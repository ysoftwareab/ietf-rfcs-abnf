<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>The Subnetwork Encapsulation and Adaptation Layer (SEAL)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Motivation">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Approach">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology and Requirements">
<link href="#rfc.section.3" rel="Chapter" title="3 Applicability Statement">
<link href="#rfc.section.4" rel="Chapter" title="4 SEAL Specification">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 VET Interface Model">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 SEAL Model of Operation">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 SEAL Header and Trailer Format">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 ITE Specification">
<link href="#rfc.section.4.4.1" rel="Chapter" title="4.4.1 Tunnel Interface MTU">
<link href="#rfc.section.4.4.2" rel="Chapter" title="4.4.2 Tunnel Neighbor Soft State">
<link href="#rfc.section.4.4.3" rel="Chapter" title="4.4.3 Pre-Encapsulation">
<link href="#rfc.section.4.4.4" rel="Chapter" title="4.4.4 SEAL Encapsulation">
<link href="#rfc.section.4.4.5" rel="Chapter" title="4.4.5 Outer Encapsulation">
<link href="#rfc.section.4.4.6" rel="Chapter" title="4.4.6 Path Probing and ETE Reachability Verification">
<link href="#rfc.section.4.4.7" rel="Chapter" title="4.4.7 Processing ICMP Messages">
<link href="#rfc.section.4.4.8" rel="Chapter" title="4.4.8 IPv4 Middlebox Reassembly Testing">
<link href="#rfc.section.4.4.9" rel="Chapter" title="4.4.9 Stateful MTU Determination">
<link href="#rfc.section.4.4.10" rel="Chapter" title="4.4.10 Detecting Path MTU Changes">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 ETE Specification">
<link href="#rfc.section.4.5.1" rel="Chapter" title="4.5.1 Tunnel Neighbor Soft State">
<link href="#rfc.section.4.5.2" rel="Chapter" title="4.5.2 Reassembly Buffer Requirements">
<link href="#rfc.section.4.5.3" rel="Chapter" title="4.5.3 IP-Layer Reassembly">
<link href="#rfc.section.4.5.4" rel="Chapter" title="4.5.4 Decapsulation and Re-Encapsulation">
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 The SEAL Control Message Protocol (SCMP)">
<link href="#rfc.section.4.6.1" rel="Chapter" title="4.6.1 Generating SCMP Error Messages">
<link href="#rfc.section.4.6.1.1" rel="Chapter" title="4.6.1.1 Generating SCMP Packet Too Big (SPTB) Messages">
<link href="#rfc.section.4.6.1.2" rel="Chapter" title="4.6.1.2 Generating Other SCMP Error Messages">
<link href="#rfc.section.4.6.2" rel="Chapter" title="4.6.2 Processing SCMP Error Messages">
<link href="#rfc.section.4.6.2.1" rel="Chapter" title="4.6.2.1 Processing SCMP PTB Messages">
<link href="#rfc.section.4.6.2.2" rel="Chapter" title="4.6.2.2 Processing Other SCMP Error Messages">
<link href="#rfc.section.5" rel="Chapter" title="5 Link Requirements">
<link href="#rfc.section.6" rel="Chapter" title="6 End System Requirements">
<link href="#rfc.section.7" rel="Chapter" title="7 Router Requirements">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Security Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 Related Work">
<link href="#rfc.section.11" rel="Chapter" title="11 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="12 References">
<link href="#rfc.references.1" rel="Chapter" title="12.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="12.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Reliability">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B Integrity">
<link href="#rfc.appendix.Appendix%20C" rel="Chapter" title="Appendix C Transport Mode">
<link href="#rfc.appendix.Appendix%20D" rel="Chapter" title="Appendix D Historic Evolution of PMTUD">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="For the purpose of this document, a subnetwork is defined as a virtual topology configured over a connected IP network routing region and bounded by encapsulating border nodes. These virtual topologies are manifested by tunnels that may span multiple IP and/or sub-IP layer forwarding hops, and can introduce failure modes due to packet duplication and/or links with diverse Maximum Transmission Units (MTUs).  This document specifies a Subnetwork Encapsulation and Adaptation Layer (SEAL) that accommodates such virtual topologies over diverse underlying link technologies." />
  <meta name="description" content="For the purpose of this document, a subnetwork is defined as a virtual topology configured over a connected IP network routing region and bounded by encapsulating border nodes. These virtual topologies are manifested by tunnels that may span multiple IP and/or sub-IP layer forwarding hops, and can introduce failure modes due to packet duplication and/or links with diverse Maximum Transmission Units (MTUs).  This document specifies a Subnetwork Encapsulation and Adaptation Layer (SEAL) that accommodates such virtual topologies over diverse underlying link technologies." />
  <meta name="keywords" content="I-D, Internet-Draft" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">F. L. Templin, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Boeing Research &amp; Technology</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">November 14, 2011</td>
</tr>
<tr>
<td class="left">Expires: May 17, 2012</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">The Subnetwork Encapsulation and Adaptation Layer (SEAL)<br />
  <span class="filename">draft-templin-intarea-seal-37.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>For the purpose of this document, a subnetwork is defined as a virtual topology configured over a connected IP network routing region and bounded by encapsulating border nodes. These virtual topologies are manifested by tunnels that may span multiple IP and/or sub-IP layer forwarding hops, and can introduce failure modes due to packet duplication and/or links with diverse Maximum Transmission Units (MTUs).  This document specifies a Subnetwork Encapsulation and Adaptation Layer (SEAL) that accommodates such virtual topologies over diverse underlying link technologies.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 17, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Motivation</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Approach</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology and Requirements</a>
</li>
<li>3.   <a href="#rfc.section.3">Applicability Statement</a>
</li>
<li>4.   <a href="#rfc.section.4">SEAL Specification</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">VET Interface Model</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">SEAL Model of Operation</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">SEAL Header and Trailer Format</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">ITE Specification</a>
</li>
<li>4.4.1.   <a href="#rfc.section.4.4.1">Tunnel Interface MTU</a>
</li>
<li>4.4.2.   <a href="#rfc.section.4.4.2">Tunnel Neighbor Soft State</a>
</li>
<li>4.4.3.   <a href="#rfc.section.4.4.3">Pre-Encapsulation</a>
</li>
<li>4.4.4.   <a href="#rfc.section.4.4.4">SEAL Encapsulation</a>
</li>
<li>4.4.5.   <a href="#rfc.section.4.4.5">Outer Encapsulation</a>
</li>
<li>4.4.6.   <a href="#rfc.section.4.4.6">Path Probing and ETE Reachability Verification</a>
</li>
<li>4.4.7.   <a href="#rfc.section.4.4.7">Processing ICMP Messages</a>
</li>
<li>4.4.8.   <a href="#rfc.section.4.4.8">IPv4 Middlebox Reassembly Testing</a>
</li>
<li>4.4.9.   <a href="#rfc.section.4.4.9">Stateful MTU Determination</a>
</li>
<li>4.4.10.   <a href="#rfc.section.4.4.10">Detecting Path MTU Changes</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">ETE Specification</a>
</li>
<li>4.5.1.   <a href="#rfc.section.4.5.1">Tunnel Neighbor Soft State</a>
</li>
<li>4.5.2.   <a href="#rfc.section.4.5.2">Reassembly Buffer Requirements</a>
</li>
<li>4.5.3.   <a href="#rfc.section.4.5.3">IP-Layer Reassembly</a>
</li>
<li>4.5.4.   <a href="#rfc.section.4.5.4">Decapsulation and Re-Encapsulation</a>
</li>
<li>4.6.   <a href="#rfc.section.4.6">The SEAL Control Message Protocol (SCMP)</a>
</li>
<li>4.6.1.   <a href="#rfc.section.4.6.1">Generating SCMP Error Messages</a>
</li>
<li>4.6.1.1.   <a href="#rfc.section.4.6.1.1">Generating SCMP Packet Too Big (SPTB) Messages</a>
</li>
<li>4.6.1.2.   <a href="#rfc.section.4.6.1.2">Generating Other SCMP Error Messages</a>
</li>
<li>4.6.2.   <a href="#rfc.section.4.6.2">Processing SCMP Error Messages</a>
</li>
<li>4.6.2.1.   <a href="#rfc.section.4.6.2.1">Processing SCMP PTB Messages</a>
</li>
<li>4.6.2.2.   <a href="#rfc.section.4.6.2.2">Processing Other SCMP Error Messages</a>
</li>
<li>5.   <a href="#rfc.section.5">Link Requirements</a>
</li>
<li>6.   <a href="#rfc.section.6">End System Requirements</a>
</li>
<li>7.   <a href="#rfc.section.7">Router Requirements</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Security Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">Related Work</a>
</li>
<li>11.   <a href="#rfc.section.11">Acknowledgments</a>
</li>
<li>12.   <a href="#rfc.references">References</a>
</li>
<li>12.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>12.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Reliability</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">Integrity</a>
</li>
<li>Appendix C.   <a href="#rfc.appendix.Appendix%20C">Transport Mode</a>
</li>
<li>Appendix D.   <a href="#rfc.appendix.Appendix%20D">Historic Evolution of PMTUD</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">As Internet technology and communication has grown and matured, many techniques have developed that use virtual topologies (including tunnels of one form or another) over an actual network that supports the Internet Protocol (IP) <a href="#RFC0791">[RFC0791]</a><a href="#RFC2460">[RFC2460]</a>. Those virtual topologies have elements that appear as one hop in the virtual topology, but are actually multiple IP or sub-IP layer hops. These multiple hops often have quite diverse properties that are often not even visible to the endpoints of the virtual hop. This introduces failure modes that are not dealt with well in current approaches.</p>
<p id="rfc.section.1.p.2">The use of IP encapsulation (also known as "tunneling") has long been considered as the means for creating such virtual topologies. However, the insertion of an outer IP header reduces the effective path MTU visible to the inner network layer. When IPv4 is used, this reduced MTU can be accommodated through the use of IPv4 fragmentation, but unmitigated in-the-network fragmentation has been found to be harmful through operational experience and studies conducted over the course of many years <a href="#FRAG">[FRAG]</a><a href="#FOLK">[FOLK]</a><a href="#RFC4963">[RFC4963]</a>. Additionally, classical path MTU discovery <a href="#RFC1191">[RFC1191]</a> has known operational issues that are exacerbated by in-the-network tunnels <a href="#RFC2923">[RFC2923]</a><a href="#RFC4459">[RFC4459]</a>. The following subsections present further details on the motivation and approach for addressing these issues.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Motivation</h1>
<p id="rfc.section.1.1.p.1">Before discussing the approach, it is necessary to first understand the problems. In both the Internet and private-use networks today, IPv4 is ubiquitously deployed as the Layer 3 protocol. The primary functions of IPv4 are to provide for routing, addressing, and a fragmentation and reassembly capability used to accommodate links with diverse MTUs. While it is well known that the IPv4 address space is rapidly becoming depleted, there is a lesser-known but growing consensus that other IPv4 protocol limitations have already or may soon become problematic.</p>
<p id="rfc.section.1.1.p.2">First, the IPv4 header Identification field is only 16 bits in length, meaning that at most 2^16 unique packets with the same (source, destination, protocol)-tuple may be active in the Internet at a given time <a href="#I-D.ietf-intarea-ipv4-id-update">[I-D.ietf-intarea-ipv4-id-update]</a>.  Due to the escalating deployment of high-speed links, however, this number has become too small by several orders of magnitude for high data rate packet sources such as tunnel endpoints <a href="#RFC4963">[RFC4963]</a>. Furthermore, there are many well-known limitations pertaining to IPv4 fragmentation and reassembly &#8211; even to the point that it has been deemed &#8220;harmful&#8221; in both classic and modern-day studies (see above). In particular, IPv4 fragmentation raises issues ranging from minor annoyances (e.g., in-the-network router fragmentation <a href="#RFC1981">[RFC1981]</a>) to the potential for major integrity issues (e.g., mis-association of the fragments of multiple IP packets during reassembly <a href="#RFC4963">[RFC4963]</a>).</p>
<p id="rfc.section.1.1.p.3">As a result of these perceived limitations, a fragmentation-avoiding technique for discovering the MTU of the forward path from a source to a destination node was devised through the deliberations of the Path MTU Discovery Working Group (PMTUDWG) during the late 1980&#8217;s through early 1990&#8217;s (see Appendix D). In this method, the source node provides explicit instructions to routers in the path to discard the packet and return an ICMP error message if an MTU restriction is encountered. However, this approach has several serious shortcomings that lead to an overall &#8220;brittleness&#8221; <a href="#RFC2923">[RFC2923]</a>.</p>
<p id="rfc.section.1.1.p.4">In particular, site border routers in the Internet have been known to discard ICMP error messages coming from the outside world. This is due in large part to the fact that malicious spoofing of error messages in the Internet is trivial since there is no way to authenticate the source of the messages <a href="#RFC5927">[RFC5927]</a>. Furthermore, when a source node that requires ICMP error message feedback when a packet is dropped due to an MTU restriction does not receive the messages, a path MTU-related black hole occurs. This means that the source will continue to send packets that are too large and never receive an indication from the network that they are being discarded. This behavior has been confirmed through documented studies showing clear evidence of path MTU discovery failures in the Internet today <a href="#TBIT">[TBIT]</a><a href="#WAND">[WAND]</a><a href="#SIGCOMM">[SIGCOMM]</a>.</p>
<p id="rfc.section.1.1.p.5">The issues with both IPv4 fragmentation and this &#8220;classical&#8221; method of path MTU discovery are exacerbated further when IP tunneling is used <a href="#RFC4459">[RFC4459]</a>. For example, an ingress tunnel endpoint (ITE) may be required to forward encapsulated packets into the subnetwork on behalf of hundreds, thousands, or even more original sources within the end site that it serves. If the ITE allows IPv4 fragmentation on the encapsulated packets, persistent fragmentation could lead to undetected data corruption due to Identification field wrapping. If the ITE instead uses classical IPv4 path MTU discovery, it must rely on ICMP error messages coming from the subnetwork that may be suspect, subject to loss due to filtering middleboxes, or insufficiently provisioned for translation into error messages to be returned to the original sources.</p>
<p id="rfc.section.1.1.p.6">Although recent works have led to the development of a robust end-to-end MTU determination scheme <a href="#RFC4821">[RFC4821]</a>, they do not excuse tunnels from delivering path MTU discovery feedback when packets are lost due to size restrictions. Moreover, in current practice existing tunneling protocols mask the MTU issues by selecting a "lowest common denominator" MTU that may be much smaller than necessary for most paths and difficult to change at a later date.  Therefore, a new approach to accommodate tunnels over links with diverse MTUs is necessary.</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> Approach</h1>
<p id="rfc.section.1.2.p.1">For the purpose of this document, a subnetwork is defined as a virtual topology configured over a connected network routing region and bounded by encapsulating border nodes. Example connected network routing regions include Mobile Ad hoc Networks (MANETs), enterprise networks and the global public Internet itself. Subnetwork border nodes forward unicast and multicast packets over the virtual topology across multiple IP and/or sub-IP layer forwarding hops that may introduce packet duplication and/or traverse links with diverse Maximum Transmission Units (MTUs).</p>
<p id="rfc.section.1.2.p.2">This document introduces a Subnetwork Encapsulation and Adaptation Layer (SEAL) for tunneling network layer protocols (e.g., IPv4, IPv6, OSI, etc.) over IP subnetworks that connect Ingress and Egress Tunnel Endpoints (ITEs/ETEs) of border nodes. It provides a modular specification designed to be tailored to specific associated tunneling protocols. A transport-mode of operation is also possible, and described in Appendix C.</p>
<p id="rfc.section.1.2.p.3">SEAL provides a mid-layer encapsulation that accommodates links with diverse MTUs and allows routers in the subnetwork to perform efficient duplicate packet detection. The encapsulation further ensures data origin authentication, packet header integrity and anti-replay.</p>
<p id="rfc.section.1.2.p.4">SEAL treats tunnels that traverse the subnetwork as ordinary links that must support network layer services. Moreover, SEAL provides dynamic mechanisms to ensure a maximal path MTU over the tunnel. This is in contrast to static approaches which avoid MTU issues by selecting a lowest common denominator MTU value that may be overly conservative for the vast majority of tunnel paths and difficult to change even when larger MTUs become available.</p>
<p id="rfc.section.1.2.p.5">The following sections provide the SEAL normative specifications, while the appendices present non-normative additional considerations.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology and Requirements</h1>
<p id="rfc.section.2.p.1">The following terms are defined within the scope of this document:</p>
<p></p>

<dl>
<dt>subnetwork</dt>
<dd style="margin-left: 8">
<br>a virtual topology configured over a connected network routing region and bounded by encapsulating border nodes.</dd>
<dt>Ingress Tunnel Endpoint (ITE)</dt>
<dd style="margin-left: 8">
<br>a virtual interface over which an encapsulating border node (host or router) sends encapsulated packets into the subnetwork.</dd>
<dt>Egress Tunnel Endpoint (ETE)</dt>
<dd style="margin-left: 8">
<br>a virtual interface over which an encapsulating border node (host or router) receives encapsulated packets from the subnetwork.</dd>
<dt>ETE Link Path</dt>
<dd style="margin-left: 8">
<br>a subnetwork path from an ITE to an ETE beginning with an underlying link of the ITE as the first hop.</dd>
<dt>inner packet</dt>
<dd style="margin-left: 8">
<br>an unencapsulated network layer protocol packet (e.g., IPv6 <a href="#RFC2460">[RFC2460]</a>, IPv4 <a href="#RFC0791">[RFC0791]</a>, OSI/CLNP <a href="#RFC1070">[RFC1070]</a>, etc.) before any outer encapsulations are added. Internet protocol numbers that identify inner packets are found in the IANA Internet Protocol registry <a href="#RFC3232">[RFC3232]</a>. SEAL protocol packets that incur an additional layer of SEAL encapsulation are also considered inner packets.</dd>
<dt>outer IP packet</dt>
<dd style="margin-left: 8">
<br>a packet resulting from adding an outer IP header (and possibly other outer headers) to a SEAL-encapsulated inner packet.</dd>
<dt>packet-in-error</dt>
<dd style="margin-left: 8">
<br>the leading portion of an invoking data packet encapsulated in the body of an error control message (e.g., an ICMPv4 <a href="#RFC0792">[RFC0792]</a> error message, an ICMPv6 <a href="#RFC4443">[RFC4443]</a> error message, etc.).</dd>
<dt>Packet Too Big (PTB)</dt>
<dd style="margin-left: 8">
<br>a control plane message indicating an MTU restriction (e.g., an ICMPv6 "Packet Too Big" message <a href="#RFC4443">[RFC4443]</a>, an ICMPv4 "Fragmentation Needed" message <a href="#RFC0792">[RFC0792]</a>, etc.).</dd>
<dt>IP</dt>
<dd style="margin-left: 8">
<br>used to generically refer to either Internet Protocol (IP) version, i.e., IPv4 or IPv6.</dd>
</dl>
<p id="rfc.section.2.p.3">The following abbreviations correspond to terms used within this document and/or elsewhere in common Internetworking nomenclature:</p>
<p></p>

<ul class="empty">
<li>DF - the IPv4 header "Don't Fragment" flag <a href="#RFC0791">[RFC0791]</a><br>
</li>
<li>ETE - Egress Tunnel Endpoint<br>
</li>
<li>HLEN - the length of the SEAL header plus outer headers<br>
</li>
<li>ICV - Integrity Check Vector<br>
</li>
<li>ITE - Ingress Tunnel Endpoint<br>
</li>
<li>MTU - Maximum Transmission Unit<br>
</li>
<li>SCMP - the SEAL Control Message Protocol<br>
</li>
<li>SDU - SCMP Destination Unreachable message<br>
</li>
<li>SNA - SCMP Neighbor Advertisement message<br>
</li>
<li>SNS - SCMP Neighbor Solicitation message<br>
</li>
<li>SPP - SCMP Parameter Problem message<br>
</li>
<li>SPTB - SCMP Packet Too Big message<br>
</li>
<li>SEAL - Subnetwork Encapsulation and Adaptation Layer<br>
</li>
<li>SEAL_PORT - a transport-layer service port number used for SEAL<br>
</li>
<li>SEAL_PROTO - an IP protocol number used for SEAL<br>
</li>
<li>TE - Tunnel Endpoint (i.e., either ingress or egress) <br>
</li>
<li>VET - Virtual Enterprise Traversal<br>
</li>
</ul>
<p id="rfc.section.2.p.5">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>. When used in lower case (e.g., must, must not, etc.), these words MUST NOT be interpreted as described in <a href="#RFC2119">[RFC2119]</a>, but are rather interpreted as they would be in common English.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Applicability Statement</h1>
<p id="rfc.section.3.p.1">SEAL was originally motivated by the specific case of subnetwork abstraction for Mobile Ad hoc Networks (MANETs), however the domain of applicability also extends to subnetwork abstractions over enterprise networks, ISP networks, SOHO networks, the global public Internet itself, and any other connected network routing region. SEAL, along with the Virtual Enterprise Traversal (VET) <a href="#I-D.templin-intarea-vet">[I-D.templin-intarea-vet]</a> tunnel virtual interface abstraction, are the functional building blocks for the Internet Routing Overlay Network (IRON) <a href="#I-D.templin-ironbis">[I-D.templin-ironbis]</a> and Routing and Addressing in Networks with Global Enterprise Recursion (RANGER) <a href="#RFC5720">[RFC5720]</a><a href="#RFC6139">[RFC6139]</a> architectures.</p>
<p id="rfc.section.3.p.2">SEAL provides a network sublayer for encapsulation of an inner network layer packet within outer encapsulating headers. SEAL can also be used as a sublayer within a transport layer protocol data payload, where transport layer encapsulation is typically used for Network Address Translator (NAT) traversal as well as operation over subnetworks that give preferential treatment to certain "core" Internet protocols (e.g., TCP, UDP, etc.). The SEAL header is processed the same as for IPv6 extension headers, i.e., it is not part of the outer IP header but rather allows for the creation of an arbitrarily extensible chain of headers in the same way that IPv6 does.</p>
<p id="rfc.section.3.p.3">To accommodate MTU diversity, the Egress Tunnel Endpoint (ETE) acts as a passive observer that simply informs the Ingress Tunnel Endpoint (ITE) of any packet size limitations. This allows the ITE to return appropriate path MTU discovery feedback even if the network path between the ITE and ETE filters ICMP messages.</p>
<p id="rfc.section.3.p.4">SEAL further ensures data origin authentication, packet header integrity, and anti-replay. The SEAL framework is therefore similar to the IP Security (IPsec) Authentication Header (AH) <a href="#RFC4301">[RFC4301]</a><a href="#RFC4302">[RFC4302]</a>, however it provides only minimal hop-by-hop authenticating services along a path while leaving full data integrity, authentication and confidentiality services as an end-to-end consideration. While SEAL performs data origin authentication, the origin site must also perform the necessary ingress filtering in order to provide full source address verification <a href="#I-D.ietf-savi-framework">[I-D.ietf-savi-framework]</a>.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> SEAL Specification</h1>
<p id="rfc.section.4.p.1">The following sections specify the operation of SEAL:</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> VET Interface Model</h1>
<p id="rfc.section.4.1.p.1">SEAL is an encapsulation sublayer used within VET non-broadcast, multiple access (NBMA) tunnel virtual interfaces. Each VET interface is configured over one or more underlying interfaces attached to subnetwork links. The VET interface connects an ITE to one or more ETE "neighbors" via tunneling across an underlying subnetwork, where tunnel neighbor relationship may be either unidirectional or bidirectional.</p>
<p id="rfc.section.4.1.p.2">A unidirectional tunnel neighbor relationship allows the near end ITE to send data packets forward to the far end ETE, while the ETE only returns control messages when necessary. A bidirectional tunnel neighbor relationship is one over which both TEs can exchange both data and control messages.</p>
<p id="rfc.section.4.1.p.3">Implications of the VET unidirectional and bidirectional models are discussed in <a href="#I-D.templin-intarea-vet">[I-D.templin-intarea-vet]</a>.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> SEAL Model of Operation</h1>
<p id="rfc.section.4.2.p.1">SEAL-enabled ITEs encapsulate each inner packet in a SEAL header, any outer header encapsulations, and in some instances a SEAL trailer as shown in <a href="#encaps1">Figure 1</a>:</p>
<div id="#rfc.figure.1"></div>
<div id="#encaps1"></div>
<pre>                             +--------------------+
                             ~   outer IP header  ~
                             +--------------------+
                             ~  other outer hdrs  ~
                             +--------------------+
                             ~    SEAL Header     ~
+--------------------+       +--------------------+
|                    |  --&gt;  |                    |
~        Inner       ~  --&gt;  ~        Inner       ~
~       Packet       ~  --&gt;  ~       Packet       ~
|                    |  --&gt;  |                    |
+--------------------+       +--------------------+
                             |    SEAL Trailer    |
                             +--------------------+
</pre>
<p></p>
<p id="rfc.section.4.2.p.3">The ITE inserts the SEAL header according to the specific tunneling protocol. For simple encapsulation of an inner network layer packet within an outer IP header (e.g., <a href="#RFC1070">[RFC1070]</a><a href="#RFC2003">[RFC2003]</a><a href="#RFC2473">[RFC2473]</a><a href="#RFC4213">[RFC4213]</a>, etc.), the ITE inserts the SEAL header between the inner packet and outer IP headers as: IP/SEAL/{inner packet}.</p>
<p id="rfc.section.4.2.p.4">For encapsulations over transports such as UDP, the ITE inserts the SEAL header between the outer transport layer header and the inner packet, e.g., as IP/UDP/SEAL/{inner packet} (similar to <a href="#RFC4380">[RFC4380]</a>). In that case, the UDP header is seen as an "other outer header" as depicted in <a href="#encaps1">Figure 1</a>.</p>
<p id="rfc.section.4.2.p.5">When necessary, the ITE also appends a SEAL trailer at the end of the SEAL packet. In that case, the trailer is added after the final byte of the encapsulated packet.</p>
<p id="rfc.section.4.2.p.6">SEAL supports both "nested" tunneling and "re-encapsulating" tunneling. Nested tunneling occurs when a first tunnel is encapsulated within a second tunnel, which may then further be encapsulated within additional tunnels. Nested tunneling can be useful, and stands in contrast to "recursive" tunneling which is an anomalous condition incurred due to misconfiguration or a routing loop. Considerations for nested tunneling are discussed in Section 4 of <a href="#RFC2473">[RFC2473]</a>.</p>
<p id="rfc.section.4.2.p.7">Re-encapsulating tunneling occurs when a packet emerges from a first ETE, which then acts as an ITE to re-encapsulate and forward the packet to a second ETE connected to the same subnetwork. In that case each ITE/ETE transition represents a segment of a bridged path between the ITE nearest the source and the ETE nearest the destination.  Combinations of nested and re-encapsulating tunneling are also naturally supported by SEAL.</p>
<p id="rfc.section.4.2.p.8">The SEAL ITE considers each {underlying interface, IP address} pair as the ingress attachment point to a unidirectional subnetwork link path to the ETE. The ITE therefore maintains path MTU state on a per ETE link path basis, although it may instead maintain only the lowest-common-denominator values for all of the ETE's link paths in order to reduce state.</p>
<p id="rfc.section.4.2.p.9">Finally, the SEAL ITE ensures that the inner network layer protocol will see a minimum MTU of 1280 bytes over each ETE link path regardless of the outer network layer protocol version, i.e., even if a small amount of fragmentation and reassembly are necessary.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> SEAL Header and Trailer Format</h1>
<p id="rfc.section.4.3.p.1">The SEAL header is formatted as follows:</p>
<div id="#rfc.figure.2"></div>
<div id="#minimal"></div>
<pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |VER|C|P|R|T|U|Z|     NEXTHDR   |    PREFLEN    | LINK_ID |LEVEL|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             PKT_ID                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              ICV1                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   ~                      PREFIX (when present)                    ~
   . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
</pre>
<p></p>
<p></p>

<dl>
<dt>VER (2)</dt>
<dd style="margin-left: 8">
<br>a 2-bit version field. This document specifies Version 0 of the SEAL protocol, i.e., the VER field encodes the value 0.</dd>
<dt>C (1)</dt>
<dd style="margin-left: 8">
<br>the "Control/Data" bit. Set to 1 by the ITE in SEAL Control Message Protocol (SCMP) control messages, and set to 0 in ordinary data packets.</dd>
<dt>P (1)</dt>
<dd style="margin-left: 8">
<br>the "Prefix Included" bit. Set to 1 if the header includes a Prefix Field. Used for SCMP messages that do not include a packet-in-error (see: <a href="#I-D.templin-intarea-vet">[I-D.templin-intarea-vet]</a>), and for NULL SEAL data packets used as probes (see: Section 4.4.6).</dd>
<dt>R (1)</dt>
<dd style="margin-left: 8">
<br>the "Redirects Permitted" bit. For data packets, set to 1 by the ITE to inform the ETE that the source is accepting Redirects (see:<a href="#I-D.templin-intarea-vet">[I-D.templin-intarea-vet]</a>).</dd>
<dt>T (1)</dt>
<dd style="margin-left: 8">
<br>the "Trailer Included" bit. Set to 1 if the ITE was obliged to include a trailer.</dd>
<dt>U (1)</dt>
<dd style="margin-left: 8">
<br>the "Unfragmented Packet" bit. Set to 1 by the ITE in SEAL data packets for which it wishes to receive an explicit acknowledgement from the ETE if the packet arrives unfragmented.</dd>
<dt>Z (1)</dt>
<dd style="margin-left: 8">
<br>the "Reserved" bit. Must be set to 0 for this version of the SEAL specification.</dd>
<dt>NEXTHDR (8)</dt>
<dd style="margin-left: 8">an 8-bit field that encodes the next header Internet Protocol number the same as for the IPv4 protocol and IPv6 next header fields.</dd>
<dt>PREFLEN (8)</dt>
<dd style="margin-left: 8">an 8-bit field that encodes the length of the prefix to be applied to the source address of the inner packets (when P==0) or the prefix included in the PREFIX field (when P==1).</dd>
<dt>LINK_ID (5)</dt>
<dd style="margin-left: 8">
<br>a 5-bit link identification value, set to a unique value by the ITE for each underlying link as the first hop of a path over which it will send encapsulated packets to ETEs. Up to 32 ETE link paths are therefore supported for each ETE.</dd>
<dt>LEVEL (3)</dt>
<dd style="margin-left: 8">
<br>a 3-bit nesting level; use to limit the number of tunnel nesting levels. Set to an integer value up to 7 in the innermost SEAL encapsulation, and decremented by 1 for each successive additional SEAL encapsulation nesting level.  Up to 8 levels of nesting are therefore supported.</dd>
<dt>PKT_ID (32)</dt>
<dd style="margin-left: 8">
<br>a 32-bit per-packet identification field. Set to a monotonically-incrementing 32-bit value for each SEAL packet transmitted to this ETE, beginning with 0.</dd>
<dt>ICV1 (32)</dt>
<dd style="margin-left: 8">
<br>a 32-bit header integrity check value that covers the leading 128 bytes of the packet beginning with the SEAL header. The value 128 is chosen so that at least the SEAL header as well as the inner packet network and transport layer headers are covered by the integrity check.</dd>
<dt>PREFIX (variable)</dt>
<dd style="margin-left: 8">
<br>a variable-length string of bytes; present only when P==1. The field length is determined by calculating Len=(Ceiling(PREFLEN / 32) * 4). For example, if PREFLEN==63, the field is 8 bytes in length and encodes the leading 63 bits of the inner network layer prefix beginning with the most significant bit.</dd>
</dl>

<p>When T==1, SEAL encapsulation also includes a trailer formatted as follows:</p>
<div id="#rfc.figure.3"></div>
<div id="#min2"></div>
<pre>     0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              ICV2                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p></p>
<p></p>

<dl>
<dt>ICV2 (32)</dt>
<dd style="margin-left: 8">
<br>a 32-bit packet integrity check value. Present only when T==1, and covers the remaining length of the encapsulated packet beyond the leading 128 bytes (i.e., the remaining portion that was not covered by ICV1). Added as a trailing 32 bit field following the final byte of the encapsulated SEAL packet and used to detect reassembly misassociations. Need not be aligned on an even byte boundary.</dd>
</dl>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> ITE Specification</h1>
<h1 id="rfc.section.4.4.1">
<a href="#rfc.section.4.4.1">4.4.1.</a> Tunnel Interface MTU</h1>
<p id="rfc.section.4.4.1.p.1">The tunnel interface must present a constant MTU value to the inner network layer as the size for admission of inner packets into the interface. Since VET NBMA tunnel virtual interfaces may support a large set of ETE link paths that accept widely varying maximum packet sizes, however, a number of factors should be taken into consideration when selecting a tunnel interface MTU.</p>
<p id="rfc.section.4.4.1.p.2">Due to the ubiquitous deployment of standard Ethernet and similar networking gear, the nominal Internet cell size has become 1500 bytes; this is the de facto size that end systems have come to expect will either be delivered by the network without loss due to an MTU restriction on the path or a suitable ICMP Packet Too Big (PTB) message returned. When large packets sent by end systems incur additional encapsulation at an ITE, however, they may be dropped silently within the tunnel since the network may not always deliver the necessary PTBs <a href="#RFC2923">[RFC2923]</a>.</p>
<p id="rfc.section.4.4.1.p.3">The ITE should therefore set a tunnel interface MTU of at least 1500 bytes plus extra room to accommodate any additional encapsulations that may occur on the path from the original source.  The ITE can also set smaller MTU values; however, care must be taken not to set so small a value that original sources would experience an MTU underflow. In particular, IPv6 sources must see a minimum path MTU of 1280 bytes, and IPv4 sources should see a minimum path MTU of 576 bytes.</p>
<p id="rfc.section.4.4.1.p.4">The inner network layer protocol consults the tunnel interface MTU when admitting a packet into the interface. For non-SEAL inner IPv4 packets with the IPv4 Don't Fragment (DF) bit set to 0, if the packet is larger than the tunnel interface MTU the inner IPv4 layer uses IPv4 fragmentation to break the packet into fragments no larger than the tunnel interface MTU. The ITE then admits each fragment into the interface as an independent packet.</p>
<p id="rfc.section.4.4.1.p.5">For all other inner packets, the inner network layer admits the packet if it is no larger than the tunnel interface MTU; otherwise, it drops the packet and sends a PTB error message to the source with the MTU value set to the tunnel interface MTU. The message contains as much of the invoking packet as possible without the entire message exceeding the network layer minimum MTU (e.g., 1280 bytes for IPv6, 576 bytes for IPv4, etc.).</p>
<p id="rfc.section.4.4.1.p.6">The ITE can alternatively set an indefinite MTU on the tunnel interface such that all inner packets are admitted into the interface regardless of their size. For ITEs that host applications that use the tunnel interface directly, this option must be carefully coordinated with protocol stack upper layers since some upper layer protocols (e.g., TCP) derive their packet sizing parameters from the MTU of the outgoing interface and as such may select too large an initial size. This is not a problem for upper layers that use conservative initial maximum segment size estimates and/or when the tunnel interface can reduce the upper layer's maximum segment size, e.g., by reducing the size advertised in the MSS option of outgoing TCP messages (sometimes known as "MSS clamping").</p>
<p id="rfc.section.4.4.1.p.7">In light of the above considerations, the ITE SHOULD configure an indefinite MTU on tunnel *router* interfaces so that subnetwork adaptation is handled from within the interface. The ITE MAY instead set a finite MTU on tunnel *host* interfaces.</p>
<h1 id="rfc.section.4.4.2">
<a href="#rfc.section.4.4.2">4.4.2.</a> Tunnel Neighbor Soft State</h1>
<p id="rfc.section.4.4.2.p.1">Within the tunnel virtual interface, the ITE maintains a per tunnel neighbor (i.e., a per-ETE) integrity check vector (ICV) calculation algorithm and (when data origin authentication is required) a symmetric secret key to calculate the ICV(s) in packets it will send to this ETE. The ITE also maintains a window of PKT_ID values for the packets it has recently sent to this ETE.</p>
<p id="rfc.section.4.4.2.p.2">For each ETE link path, the ITE maintains a constant value "HLEN" set to the sum of the lengths of the SEAL header plus outer transport and IP layer headers that will be used for encapsulation of the inner packet. The ITE must include the length of the uncompressed outer headers when calculating HLEN even if header compression is enabled. The ITE also maintains a per ETE link path variable "PATH_MTU" initialized to the MTU of the underlying link, and sets a companion constant value "MIN_MTU" to 1280+HLEN.</p>
<p id="rfc.section.4.4.2.p.3">For IPv4, the ITE also maintains the per ETE link path boolean variables "USE_DF" (initialized to "FALSE") and "USE_TRAILER" (initialized to "FALSE" if PATH_MTU is no smaller than MIN_MTU; otherwise initialized to "TRUE") .</p>
<p id="rfc.section.4.4.2.p.4">The ITE may instead maintain HLEN, PATH_MTU, MIN_MTU, USE_DF, and USE_TRAILER as per ETE (rather than per ETE link path) values. In that case, the values reflect the lowest-common-denominator MTU across all of the ETE's link paths.</p>
<h1 id="rfc.section.4.4.3">
<a href="#rfc.section.4.4.3">4.4.3.</a> Pre-Encapsulation</h1>
<p id="rfc.section.4.4.3.p.1">For each inner packet admitted into the tunnel interface, if the packet is itself a SEAL packet (i.e., one with either SEAL_PROTO in the IP protocol/next-header field, or with SEAL_PORT in the transport layer destination port field), the inner packet is undergoing nested encapsulation, and the LEVEL field of the SEAL header contains the value 0, the ITE silently discards the packet.</p>
<p id="rfc.section.4.4.3.p.2">Otherwise, for IPv4 inner packets with DF==0 in the IPv4 header, if the packet is larger than 512 bytes and is not the first fragment of a SEAL packet (i.e., not a packet that includes a SEAL header) the ITE fragments the packet into inner fragments no larger than 512 bytes. The ITE then submits each inner fragment for SEAL encapsulation as specified in Section 4.4.4.</p>
<p id="rfc.section.4.4.3.p.3">For all other packets, if the packet is no larger than (MAX(PATH_MTU, MIN_MTU)-HLEN) for the corresponding ETE link path, the ITE submits it for SEAL encapsulation as specified in Section 4.4.4. Otherwise, the ITE sends a PTB error message toward the source address of the inner packet. (Note that for IPv4 SEAL packets this is true even if DF==0, and is a necessary condition for supporting nested SEAL encapsulations.)</p>
<p id="rfc.section.4.4.3.p.4">To send the PTB message, the ITE first checks its forwarding tables to discover the previous hop toward the source address of the inner packet. If the previous hop is reached via the same tunnel interface, the ITE sends an SCMP PTB (SPTB) message to the previous hop (see: Section 4.6.1.1) with the MTU field set to (MAX(PATH_MTU, MIN_MTU)-HLEN). Otherwise, the ITE sends an ordinary PTB message appropriate to the inner protocol version with the MTU field set to (MAX(PATH_MTU, MIN_MTU)-HLEN).</p>
<p id="rfc.section.4.4.3.p.5">After sending the (S)PTB message, the ITE discards the inner packet.</p>
<h1 id="rfc.section.4.4.4">
<a href="#rfc.section.4.4.4">4.4.4.</a> SEAL Encapsulation</h1>
<p id="rfc.section.4.4.4.p.1">The ITE next encapsulates the inner packet in a SEAL header formatted as specified in Section 4.3. The ITE sets NEXTHDR to the protocol number corresponding to the address family of the encapsulated inner packet. For example, the ITE sets NEXTHDR to the value '4' for encapsulated IPv4 packets <a href="#RFC2003">[RFC2003]</a>, '41' for encapsulated IPv6 packets <a href="#RFC2473">[RFC2473]</a><a href="#RFC4213">[RFC4213]</a>, '80' for encapsulated OSI/CLNP packets <a href="#RFC1070">[RFC1070]</a>, etc.</p>
<p id="rfc.section.4.4.4.p.2">The ITE then sets R=1 if redirects are permitted (see: <a href="#I-D.templin-intarea-vet">[I-D.templin-intarea-vet]</a>) and sets PREFLEN to the length of the prefix to be applied to the inner source address. The ITE's claimed PREFLEN is subject to verification by the ETE; hence, the ITE MUST set PREFLEN to the exact prefix length that it is authorized to use. (Note that if this process is entered via re-encapsulation (see: Section 4.5.4), PREFLEN and R are instead copied from the SEAL header of the re-encapsulated packet. This implies that the PREFLEN and R values are propagated across a re-encapsulating chain of ITE/ETEs that must all be authorized to represent the prefix.)</p>
<p id="rfc.section.4.4.4.p.3">Next, the ITE sets (C=0; P=0; Z=0), then sets LINK_ID to the value assigned to the underlying ETE link path and sets PKT_ID to a monotonically-increasing integer value for this ETE, beginning with 0 in the first packet transmitted. The ITE also sets U=1 if it needs to determine whether the ETE will receive the packet without fragmentation, e.g., for ETE reachability determination (see: Section 4.4.6), to test whether a middlebox on the path is reassembling fragmented packets before they arrive at the ETE (see: Section 4.4.8), for stateful MTU determination (see Section 4.4.9), etc. Otherwise, the ITE sets U=0.</p>
<p id="rfc.section.4.4.4.p.4">Next, if the inner packet is not itself a SEAL packet the ITE sets LEVEL to an integer value between 0 and 7 as a specification of the number of additional layers of nested SEAL encapsulations permitted. If the inner packet is a SEAL packet that is undergoing nested encapsulation, the ITE instead sets LEVEL to the value that appears in the inner packet's SEAL header minus 1. If the inner packet is undergoing SEAL re-encapsulation, the ITE instead copies the LEVEL value from the SEAL header of the re-encapsulated packet.</p>
<p id="rfc.section.4.4.4.p.5">Next, if this is an IPv4 ETE link path with USE_TRAILER==TRUE, and the inner packet is larger than 128 bytes minus the SEAL header length but no larger than 1280 bytes, the ITE sets T=1. Otherwise, the ITE sets T=0.</p>
<p id="rfc.section.4.4.4.p.6">The ITE finally sets ICV1 to 0 and calculates the packet ICVs.  The ICVs are calculated using an algorithm agreed on by the ITE and ETE. When data origin authentication is required, the algorithm uses a symmetric secret key so that the ETE can verify that the ICVs were generated by the ITE.</p>
<p id="rfc.section.4.4.4.p.7">The ITE first calculates the ICV over the leading 128 bytes of the packet beginning with the SEAL header (or up to the end of the packet if there are fewer than 128 bytes) then places result in the ICV1 field in the header. If T==1, the ITE next calculates the ICV over the remainder of the packet and places the result in the ICV2 field in the SEAL trailer. The ITE then submits the packet for outer encapsulation.</p>
<h1 id="rfc.section.4.4.5">
<a href="#rfc.section.4.4.5">4.4.5.</a> Outer Encapsulation</h1>
<p id="rfc.section.4.4.5.p.1">Following SEAL encapsulation, the ITE next encapsulates the packet in the requisite outer headers according to the specific encapsulation format (e.g., <a href="#RFC1070">[RFC1070]</a>, <a href="#RFC2003">[RFC2003]</a>, <a href="#RFC2473">[RFC2473]</a>, <a href="#RFC4213">[RFC4213]</a>, etc.), except that it writes 'SEAL_PROTO' in the protocol field of the outer IP header (when simple IP encapsulation is used) or writes 'SEAL_PORT' in the outer destination transport service port field (e.g., when IP/UDP encapsulation is used).</p>
<p id="rfc.section.4.4.5.p.2">When UDP encapsulation is used, the ITE sets the UDP header fields as specified in Section 5.5.4 of <a href="#I-D.templin-intarea-vet">[I-D.templin-intarea-vet]</a> (where the UDP header length field includes the length of the SEAL trailer, if present).  The ITE then performs outer IP header encapsulation as specified in Section 5.5.5 of <a href="#I-D.templin-intarea-vet">[I-D.templin-intarea-vet]</a>. If this process is entered via re-encapsulation (see: Section 4.5.4), the ITE instead follows the outer IP/UDP re-encapsulation procedures specified in Section 5.5.6 of <a href="#I-D.templin-intarea-vet">[I-D.templin-intarea-vet]</a>.</p>
<p id="rfc.section.4.4.5.p.3">When IPv4 is used as the outer encapsulation layer, if USE_DF==FALSE the ITE sets DF=0 in the IPv4 header to allow the packet to be fragmented within the subnetwork if it encounters a restricting link. Otherwise, the ITE sets DF=1.</p>
<p id="rfc.section.4.4.5.p.4">When IPv6 is used as the outer encapsulation layer, the "DF" flag is absent but implicitly set to 1. The packet therefore will not be fragmented within the subnetwork, since IPv6 deprecates in-the-network fragmentation.</p>
<p id="rfc.section.4.4.5.p.5">Next, the ITE uses IP fragmentation if necessary to fragment the encapsulated packet into outer IP fragments that are no larger than PATH_MTU. By virtue of the pre-encapsulation packet size calculations specified in Section 4.4.3, fragmentation will therefore only occur for outer packets that are larger than PATH_MTU but no larger than MIN_MTU. (Note that for IPv6 fragmentation must be performed by the ITE itself, while for IPv4 the fragmentation could instead be performed by a router in the ETE link path.)</p>
<p id="rfc.section.4.4.5.p.6">The ITE then sends each outer packet/fragment via the underlying link corresponding to LINK_ID.</p>
<h1 id="rfc.section.4.4.6">
<a href="#rfc.section.4.4.6">4.4.6.</a> Path Probing and ETE Reachability Verification</h1>
<p id="rfc.section.4.4.6.p.1">All SEAL data packets sent by the ITE are considered implicit probes. SEAL data packets will elicit an SCMP message from the ETE if it needs to acknowledge a probe and/or report an error condition.  SEAL data packets may also be dropped by either the ETE or a router on the path, which will return an ICMP message.</p>
<p id="rfc.section.4.4.6.p.2">The ITE can also send an SCMP Router/Neighbor Solicitation message to elicit an SCMP Router/Neighbor Advertisement response (see: <a href="#I-D.templin-intarea-vet">[I-D.templin-intarea-vet]</a>) as verification that the ETE is still reachable via a specific link path.</p>
<p id="rfc.section.4.4.6.p.3">The ITE processes ICMP messages as specified in Section 4.4.7.</p>
<p id="rfc.section.4.4.6.p.4">The ITE processes SCMP messages as specified in Section 4.6.2.</p>
<h1 id="rfc.section.4.4.7">
<a href="#rfc.section.4.4.7">4.4.7.</a> Processing ICMP Messages</h1>
<p id="rfc.section.4.4.7.p.1">When the ITE sends SEAL packets, it may receive raw ICMP error messages<a href="#RFC0792">[RFC0792]</a><a href="#RFC4443">[RFC4443]</a> from either the ETE or from a router within the subnetwork. Each ICMP message includes an outer IP header, followed by an ICMP header, followed by a portion of the SEAL data packet that generated the error (also known as the "packet-in-error") beginning with the outer IP header.</p>
<p id="rfc.section.4.4.7.p.2">The ITE should process raw ICMPv4 Protocol Unreachable messages and ICMPv6 Parameter Problem messages with Code "Unrecognized Next Header type encountered" as a hint that the ETE does not implement the SEAL protocol. The ITE can also process other raw ICMP messages that do not include sufficient information in the packet-in-error as a hint that the ETE link path may be failing. Specific actions that the ITE may take in these cases are out of scope.</p>
<p id="rfc.section.4.4.7.p.3">For other ICMP messages, the ITE examines the packet-in-error beginning with the SEAL header. If the value in the PKT_ID field is not within the window of packets the ITE has recently sent to this ETE, or if the value in the SEAL header ICV1 field is incorrect, the ITE discards the message. The ITE instead processes the ICMP message if there is operational assurance that it has not been crafted by a misbehaving middlebox, e.g., if the source of the ICMP message is within the same administrative domain as the ITE.</p>
<p id="rfc.section.4.4.7.p.4">Next, if the received ICMP message is a PTB the ITE sets the temporary variable "PMTU" for this ETE link path to the MTU value in the PTB message. If PMTU==0, the ITE consults a plateau table (e.g., as described in <a href="#RFC1191">[RFC1191]</a>) to determine PMTU based on the length field in the outer IP header of the packet-in-error. (For example, if the ITE receives a PTB message with MTU==0 and length 1500, it can set PMTU=1450. If the ITE subsequently receives a PTB message with MTU==0 and length 1450, it can set PMTU=1400, etc.) If the ITE is performing stateful MTU determination for this ETE link path (see Section 4.4.9) and PMTU is no less than MIN_MTU, the ITE next sets PATH_MTU=PMTU. If PMTU is less than MIN_MTU, however, the ITE discards the PTB message and sets PATH_MTU=PMTU.</p>
<p id="rfc.section.4.4.7.p.5">If the ICMP message was not discarded, the ITE then transcribes it into a message to return to the previous hop. If the previous hop toward the inner source address is reached via the same tunnel interface the SEAL data packet was sent on, the ITE transcribes the ICMP message into an SCMP message (see: Section 4.6.1) and forwards it to the previous hop. Otherwise, the ITE transcribes the ICMP message into a message appropriate for the inner protocol version and forwards it to the inner source address.</p>
<p id="rfc.section.4.4.7.p.6">To transcribe the message, the ITE extracts the inner packet from within the ICMP message packet-in-error field and uses it to generate a new SCMP/ICMP message corresponding to the type of the received ICMP message. For (S)PTB messages, the ITE writes (PMTU-HLEN) in the MTU field.</p>
<h1 id="rfc.section.4.4.8">
<a href="#rfc.section.4.4.8">4.4.8.</a> IPv4 Middlebox Reassembly Testing</h1>
<p id="rfc.section.4.4.8.p.1">For IPv4, the ITE can perform a qualification exchange over an ETE link path to ensure that the subnetwork correctly delivers fragments to the ETE. This procedure can be used, e.g., to determine whether there are middleboxes on the path that violate the <a href="#RFC1812">[RFC1812]</a>, Section 5.2.6 requirement that: "A router MUST NOT reassemble any datagram before forwarding it".</p>
<p id="rfc.section.4.4.8.p.2">When possible, the ITE should use knowledge of its topological arrangement as an aid in determining when middlebox reassembly testing is necessary. For example, if the ITE is aware that the ETE is located somewhere in the public Internet, middlebox reassembly testing is unnecessary. If the ITE is aware that the ETE is located behind a NAT or a firewall, however, then middlebox reassembly testing is recommended.</p>
<p id="rfc.section.4.4.8.p.3">The ITE can perform a middlebox reassembly test by setting U=1 in the header of a SEAL data packet to be used as a probe. Next, the ITE encapsulates the packet in the appropriate outer headers, splits it into two outer IPv4 fragments, then sends both fragments over the same ETE link path.</p>
<p id="rfc.section.4.4.8.p.4">While performing the test, the ITE should select only inner packets that are no larger than 1280 bytes for testing purposes in order to avoid reassembly buffer overruns. The ITE can also construct a NULL test packet instead of using ordinary SEAL data packets for testing.</p>
<p id="rfc.section.4.4.8.p.5">To create the NULL packet, the ITE prepares a data packet with (C=0; P=1; R=0; T=0; U=1; Z=0) in the SEAL header, writes the length of the ITE's claimed prefix in the PREFLEN field, and writes the ITE's claimed prefix in the PREFIX field. The ITE then sets NEXTHDR according to the address family of the PREFIX, i.e., it sets NEXTHDR to the value '4' for an IPv4 prefix, '41' for an IPv6 prefix , '80' for an OSI/CLNP prefix, etc.</p>
<p id="rfc.section.4.4.8.p.6">The ITE can further add padding following the PREFIX field to a length that would not cause the size of the NULL packet to exceed 1280 bytes before encapsulation. The ITE then sets LINK_ID, LEVEL and PKT_ID to the appropriate values for this ETE link path and calculates ICV1 the same as for an ordinary SEAL data packet.</p>
<p id="rfc.section.4.4.8.p.7">The ITE should send a series of test packets (e.g., 3-5 tests with 1sec intervals between tests) instead of a single isolated test in case of packet loss, and will eventually receive an SPTB message from the ITE (see: Section 4.6.2.1). If the ETE returns an SCMP PTB message with MTU != 0, then the ETE link path correctly supports fragmentation.</p>
<p id="rfc.section.4.4.8.p.8">If the ETE returns an SCMP PTB message with MTU==0, however, then a middlebox in the subnetwork is reassembling the fragments before forwarding them to the ETE. In that case, the ITE sets PATH_MTU=MIN_MTU and sets (USE_TRAILER=TRUE; USE_DF=FALSE). The ITE may instead enable stateful MTU determination for this ETE link path as specified in Section 4.4.9 to attempt to discover larger MTUs.</p>
<p id="rfc.section.4.4.8.p.9">NB: Examples of middleboxes that may perform reassembly include stateful NATs and firewalls. Such devices could still allow for stateless MTU determination if they gather the fragments of a fragmented IPv4 SEAL data packet for packet analysis purposes but then forward the fragments on to the final destination rather than forwarding the reassembled packet.</p>
<h1 id="rfc.section.4.4.9">
<a href="#rfc.section.4.4.9">4.4.9.</a> Stateful MTU Determination</h1>
<p id="rfc.section.4.4.9.p.1">SEAL supports a stateless MTU determination capability, however the ITE may in some instances wish to impose a stateful MTU limit on a particular ETE link path. For example, when the ETE is situated behind a middlebox that performs IPv4 reassembly (see: Section 4.4.8) it is imperative that fragmentation of large packets be avoided on the path to the middlebox. In other instances (e.g., when the ETE link path includes performance-constrained links), the ITE may deem it necessary to cache a conservative static MTU in order to avoid sending large packets that would only be dropped due to an MTU restriction somewhere on the path.</p>
<p id="rfc.section.4.4.9.p.2">To determine a static MTU value, the ITE can send a series of probe packets of various sizes to the ETE with U=1 in the SEAL header and DF=1 in the outer IP header. The ITE can then cache the size of the largest packet for which it receives a probe reply from the ETE as the PATH_MTU value this ETE link path.</p>
<p id="rfc.section.4.4.9.p.3">For example, the ITE could send NULL probe packets of 1500 bytes, followed by 1450 bytes, followed by 1400 bytes, etc. then set PATH_MTU for this ETE link path to the size of the largest probe packet for which it receives an SPTB reply message. While probing with NULL probe packets, the ITE processes any ICMP PTB message it receives as an indication of probe failure then discards the message.</p>
<p id="rfc.section.4.4.9.p.4">For IPv4, if the largest successful probe is larger than MIN_MTU the ITE then sets (USE_TRAILER=FALSE; USE_DF=TRUE) for this ETE link path; otherwise, the ITE sets (USE_TRAILER=TRUE; USE_DF=FALSE).</p>
<h1 id="rfc.section.4.4.10">
<a href="#rfc.section.4.4.10">4.4.10.</a> Detecting Path MTU Changes</h1>
<p id="rfc.section.4.4.10.p.1">For IPv6, when PATH_MTU==MIN_MTU the ITE can periodically reset PATH_MTU to the MTU of the underlying link to determine whether the ETE link path now supports larger packet sizes. If the path still has a too-small MTU, the ITE will receive an (S)PTB message that reports a size smaller than MIN_MTU. In that case, the ITE should again set PATH_MTU=MIN_MTU.</p>
<p id="rfc.section.4.4.10.p.2">For IPv4, when USE_TRAILER==TRUE and PATH_MTU is larger than MIN_MTU the ITE can periodically reset USE_TRAILER=FALSE to determine whether the ETE link path still requires trailers. If the ITE receives an SPTB message for an inner packet that is no larger than 1280 bytes (see: Section 4.6.1.1), the ITE should again set USE_TRAILER=TRUE.</p>
<p id="rfc.section.4.4.10.p.3">When stateful MTU determination is used, the ITE should periodically re-probe the path as described in Section 4.4.9 to determine whether routing changes have resulted in a reduced or increased PATH_MTU.</p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> ETE Specification</h1>
<h1 id="rfc.section.4.5.1">
<a href="#rfc.section.4.5.1">4.5.1.</a> Tunnel Neighbor Soft State</h1>
<p id="rfc.section.4.5.1.p.1">The ETE maintains a per-ITE ICV calculation algorithm and (when data origin authentication is required) a symmetric secret key to verify the ICV(s) in the SEAL header and trailer. The ETE also maintains a window of PKT_ID values for the packets it has recently received from this ITE.</p>
<h1 id="rfc.section.4.5.2">
<a href="#rfc.section.4.5.2">4.5.2.</a> Reassembly Buffer Requirements</h1>
<p id="rfc.section.4.5.2.p.1">The ETE must maintain a minimum IP-layer reassembly buffer size of 1500 bytes for both IPv4 <a href="#RFC0791">[RFC0791]</a> and IPv6 <a href="#RFC2460">[RFC2460]</a>. The ETE must also be capable of partially reassembling and delivering at least the leading 1280 byte portion of the inner packet even if the completely reassembled packet would exceed that size.</p>
<p id="rfc.section.4.5.2.p.2">The ETE should maintain conservative IP-layer reassembly cache high- and low-water marks. When the size of the reassembly cache exceeds this high-water mark, the ETE should actively discard stale incomplete reassemblies (e.g., using an Active Queue Management (AQM) strategy) until the size falls below the low-water mark. The ETE should also actively discard any pending reassemblies that clearly have no opportunity for completion, e.g., when a considerable number of new fragments have arrived before a fragment that completes a pending reassembly arrives.</p>
<h1 id="rfc.section.4.5.3">
<a href="#rfc.section.4.5.3">4.5.3.</a> IP-Layer Reassembly</h1>
<p id="rfc.section.4.5.3.p.1">The ETE processes non-SEAL IP packets as specified in the normative references, i.e., it performs any necessary IP reassembly then delivers the (reassembled) packet to the appropriate upper layer protocol module.</p>
<p id="rfc.section.4.5.3.p.2">The ETE gathers the outer IP fragments of an IP encapsulated SEAL packet until it has received at least the first 1280 bytes beyond the SEAL header or up to the end of the packet. The ETE then delivers this (partially) reassembled packet for decapsulation as specified in Section 4.5.4.</p>
<h1 id="rfc.section.4.5.4">
<a href="#rfc.section.4.5.4">4.5.4.</a> Decapsulation and Re-Encapsulation</h1>
<p id="rfc.section.4.5.4.p.1">For each IP encapsulated SEAL packet submitted for decapsulation, the ETE first examines the PKT_ID and ICV1 fields. If the PKT_ID is not within the window of acceptable values for this ITE, or if the ICV1 field includes an incorrect value, the ETE silently discards the packet.</p>
<p id="rfc.section.4.5.4.p.2">Next, if the SEAL header has (C==1 &amp;&amp; T==0) and the inner packet is larger than 128 bytes minus the SEAL header length, if the SEAL header has T==1 and the inner packet is larger than 1280 bytes, or if there is another incorrect value in a SEAL header field, the ETE returns an SCMP "Parameter Problem" (SPP) message (see Section 4.6.1.2) and discards the packet.</p>
<p id="rfc.section.4.5.4.p.3">Next, if the packet arrived as multiple IP fragments and the inner packet is larger than 1280 bytes, the ETE sends an SPTB message back to the ITE with MTU set to the size of the largest fragment received (see: Section 4.6.1.1) and silently discards the packet.</p>
<p id="rfc.section.4.5.4.p.4">Next, if the packet arrived as multiple IPv4 fragments, if the SEAL header has T=0 and the inner packet is larger than 128 bytes minus the SEAL header length but no larger than 1280 bytes the ETE sends an SPTB message back to the ITE with MTU set to the size of the largest fragment received (see: Section 4.6.1.1) then continues to process the packet.</p>
<p id="rfc.section.4.5.4.p.5">Next, if the SEAL header has T==1 the ETE verifies the ICV2 value and silently discards the packet if the value is incorrect.</p>
<p id="rfc.section.4.5.4.p.6">Next, if the SEAL header has C==1, the ETE processes the packet as an SCMP packet as specified in Section 4.6.2. Otherwise, the ETE continues to process the packet as a SEAL data packet.</p>
<p id="rfc.section.4.5.4.p.7">Next, if the packet arrived unfragmented and the SEAL header has U==1, the ETE sends an SPTB message back to the ITE with MTU=0 (see: Section 4.6.1.1).</p>
<p id="rfc.section.4.5.4.p.8">Next, if the SEAL header has P==1 the ETE discards the (NULL) packet.</p>
<p id="rfc.section.4.5.4.p.9">Finally, the ETE discards the outer headers and processes the inner packet according to the header type indicated in the SEAL NEXTHDR field. If the next hop toward the inner destination address is via a different interface than the SEAL packet arrived on, the ETE discards the SEAL header and delivers the inner packet either to the local host or to the next hop interface if the packet is not destined to the local host. If the next hop is on the same interface the SEAL packet arrived on, however, the ETE submits the packet for SEAL re-encapsulation beginning with the specification in Section 4.4.3 above.</p>
<h1 id="rfc.section.4.6">
<a href="#rfc.section.4.6">4.6.</a> The SEAL Control Message Protocol (SCMP)</h1>
<p id="rfc.section.4.6.p.1">SEAL provides a companion SEAL Control Message Protocol (SCMP) that uses the same message types and formats as for the Internet Control Message Protocol for IPv6 (ICMPv6) <a href="#RFC4443">[RFC4443]</a>.  When the TE prepares an SCMP message, it sets the Type and Code fields to the same values that would appear in the corresponding ICMPv6 message, but it does not calculate the SCMP message checksum. The TE then formats the Message Body the same as for the corresponding ICMPv6 message. The TE then encapsulates the SCMP message in the SEAL header and trailer as well as the outer headers as shown in <a href="#scmpencaps">Figure 4</a>:</p>
<div id="#rfc.figure.4"></div>
<div id="#scmpencaps"></div>
<pre>                                    +--------------------+
                                    ~   outer IP header  ~
                                    +--------------------+
                                    ~  other outer hdrs  ~
                                    +--------------------+
                                    ~    SEAL Header     ~
       +--------------------+       +--------------------+
       ~ SCMP message header~  --&gt;  ~ SCMP message header~
       +--------------------+  --&gt;  +--------------------+
       ~  SCMP message body ~  --&gt;  ~  SCMP message body ~
       +--------------------+  --&gt;  +--------------------+
                                    |    SEAL Trailer    |
                                    +--------------------+

            SCMP Message                  SCMP Packet
        before encapsulation          after encapsulation</pre>
<p></p>
<p id="rfc.section.4.6.p.3">The following sections specify the generation, processing and relaying of SCMP messages.</p>
<h1 id="rfc.section.4.6.1">
<a href="#rfc.section.4.6.1">4.6.1.</a> Generating SCMP Error Messages</h1>
<p id="rfc.section.4.6.1.p.1">ETEs generate SCMP error messages in response to receiving certain SEAL data packets using the format shown in <a href="#control2">Figure 5</a>:</p>
<div id="#rfc.figure.5"></div>
<div id="#control2"></div>
<pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |     Code      |           Reserved            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Type-Specific Data                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           As much of invoking SEAL data packet as             |
   ~    possible (beginning immediately after the SEAL header)     ~
   |        without the SCMP packet exceeding 576 bytes (*)        |

   (*) also known as the "packet-in-error"</pre>
<p></p>
<p id="rfc.section.4.6.1.p.3">When the ETE processes a SEAL data packet for which the ICVs are correct but an error must be returned, it prepares an SCMP error message as shown in <a href="#control2">Figure 5</a>. The ETE sets the Type and Code fields in the SCMP header according to the appropriate error message type, sets the Reserved field to 0, fills out the Type-Specific Data field and includes the packet-in-error.</p>
<p id="rfc.section.4.6.1.p.4">The ETE next encapsulates the SCMP message in the requisite SEAL header, outer headers and SEAL trailer as shown in <a href="#scmpencaps">Figure 4</a>. During encapsulation, the ETE sets the outer destination address/port numbers of the SCMP packet to the outer source address/port numbers of the original SEAL data packet and sets the outer source address/port numbers to its own outer address/port numbers.</p>
<p id="rfc.section.4.6.1.p.5">The ETE then sets (C=1; R=0; U=0; Z=0) in the SEAL header, then sets NEXTHDR, PREFLEN, LINK_ID, LEVEL, and PKT_ID to the same values that appeared in the SEAL data packet header. If the SEAL data packet had P==1, the ETE also copies the PREFIX field from the data packet into the SEAL header and sets P=1; otherwise, it sets P=0.  Next, if the SCMP message includes more than 128 bytes beginning with the SEAL header, the ETE sets T=1; otherwise it sets T=0.</p>
<p id="rfc.section.4.6.1.p.6">The ETE then calculates and sets the ICV1 field (and also the ICV2 field if T==1) the same as specified for SEAL data packet encapsulation in Section 4.4.4. Next, the ETE encapsulates the SCMP message in the requisite outer encapsulations and sends the resulting SCMP packet to the ITE the same as specified for SEAL data packets in Section 4.4.5.</p>
<p id="rfc.section.4.6.1.p.7">The following sections describe additional considerations for various SCMP error messages:</p>
<h1 id="rfc.section.4.6.1.1">
<a href="#rfc.section.4.6.1.1">4.6.1.1.</a> Generating SCMP Packet Too Big (SPTB) Messages</h1>
<p id="rfc.section.4.6.1.1.p.1">An ETE generates an SCMP "Packet Too Big" (SPTB) message when it receives a SEAL data packet that arrived as multiple outer IP fragments and for which the reassembled inner packet would be larger than 1280 bytes. The ETE also generates an SPTB when it receives the fragments of a fragmented IPv4-encapsulated SEAL data packet with T==0 in the SEAL header but that following reassembly would be larger 128 bytes minus the SEAL header length but no larger than 1280 bytes. The ETE prepares the SPTB message the same as for the corresponding ICMPv6 PTB message, and writes the length of the largest outer IP fragment received in the MTU field of the message.</p>
<p id="rfc.section.4.6.1.1.p.2">The ETE also generates an SPTB message when it accepts a SEAL protocol data packet which did not undergo IP fragmentation and with U==1 in the SEAL header. The ETE prepares the SPTB message the same as above, except that it writes the value 0 in the MTU field.</p>
<h1 id="rfc.section.4.6.1.2">
<a href="#rfc.section.4.6.1.2">4.6.1.2.</a> Generating Other SCMP Error Messages</h1>
<p id="rfc.section.4.6.1.2.p.1">An ETE generates an SCMP "Destination Unreachable" (SDU) message under the same circumstances that an IPv6 system would generate an ICMPv6 Destination Unreachable message.</p>
<p id="rfc.section.4.6.1.2.p.2">An ETE generates an SCMP "Parameter Problem" (SPP) message when it receives a SEAL packet with an incorrect value in the SEAL header. IN THIS CASE ALONE, the ETE prepares the packet-in-error beginning with the SEAL header instead of beginning immediately after the SEAL header.</p>
<p id="rfc.section.4.6.1.2.p.3">TEs generate other SCMP message types using methods and procedures specified in other documents. For example, SCMP message types used for tunnel neighbor coordinations are specified in VET <a href="#I-D.templin-intarea-vet">[I-D.templin-intarea-vet]</a>.</p>
<h1 id="rfc.section.4.6.2">
<a href="#rfc.section.4.6.2">4.6.2.</a> Processing SCMP Error Messages</h1>
<p id="rfc.section.4.6.2.p.1">For each SCMP error message it receives, the ITE first verifies that the outer addresses of the SCMP packet are correct and that the PKT_ID is within its window of values for this ETE. The ITE next verifies that the SEAL header fields are set correctly as specified in Section 4.6.1. The ITE then verifies the ICV value(s). If the outer addresses, SEAL header information and/or ICVs are incorrect, the ITE discards the message; otherwise, it processes the message as follows:</p>
<h1 id="rfc.section.4.6.2.1">
<a href="#rfc.section.4.6.2.1">4.6.2.1.</a> Processing SCMP PTB Messages</h1>
<p id="rfc.section.4.6.2.1.p.1">After an ITE sends a SEAL data packet to an ETE, it may receive an SPTB message with a packet-in-error containing the leading portion of the inner packet (see: Section 4.6.1.1). If the SPTB message has MTU==0, the ITE processes the message as confirmation that the ETE received an unfragmented SEAL data packet with U==1 in the SEAL header. The ITE then discards the message.</p>
<p id="rfc.section.4.6.2.1.p.2">If MTU != 0 the ITE instead processes the message as an indication of a packet size limitation as follows. The ITE first determines the inner packet length by examining the length field in the UDP header within the packet-in-error and subtracting the length of the SEAL header. If the inner packet is no larger than 1280 bytes, the ITE sets USE_TRAILER=TRUE for IPv4 SPTB messages and instead sets PATH_MTU=MIN_MTU for IPv6 SPTB messages.</p>
<p id="rfc.section.4.6.2.1.p.3">If the inner packet is larger than 1280 bytes, the ITE next examines the SPTB message MTU field. If the MTU value is not substantially less that 1500, the value is likely to represent the true MTU of the restricting link on the path to the ETE; otherwise, a router on the path may be generating runt fragments.  In that case, the ITE can consult a plateau table (e.g., as described in <a href="#RFC1191">[RFC1191]</a>) to rewrite the MTU value to a reduced size. For example, if the ITE receives an SPTB message with MTU==256 and inner packet length 1500, it can rewrite the MTU to 1450. If the ITE subsequently receives an SPTB message with MTU==256 and inner packet length 1450, it can rewrite the MTU to 1400, etc. If the ITE is performing stateful MTU determination for this ETE link path, it then writes the new MTU value in PATH_MTU.</p>
<p id="rfc.section.4.6.2.1.p.4">The ITE then checks its forwarding tables to determine the previous hop on the reverse path toward the source address of the inner packet in the packet-in-error. If the previous hop is reached over a different interface than the SPTB message arrived on, the ITE transcribes the message into a format appropriate for the inner packet (i.e., the same as described for transcribing ICMP messages in Section 4.4.7) and sends the resulting transcribed message to the original source. The ITE then discards the SPTB message.</p>
<p id="rfc.section.4.6.2.1.p.5">If the previous hop is reached over the same tunnel interface that the SPTB message arrived on, the ITE instead relays the message to the previous hop. In order to relay the message, the ITE rewrites the SEAL header fields with values corresponding to the previous hop and recalculates the ICV values using the ICV calculation parameters associated with the previous hop. Next, the ITE replaces the SPTB's outer headers with headers of the appropriate protocol version and fills in the header fields as specified in Sections 5.5.4-5.5.6 of <a href="#I-D.templin-intarea-vet">[I-D.templin-intarea-vet]</a>, where the destination address/port correspond to the previous hop and the source address/port correspond to the ITE. The ITE then sends the message to the previous hop the same as if it were issuing a new SPTB message.</p>
<h1 id="rfc.section.4.6.2.2">
<a href="#rfc.section.4.6.2.2">4.6.2.2.</a> Processing Other SCMP Error Messages</h1>
<p id="rfc.section.4.6.2.2.p.1">An ITE may receive an SDU message with an appropriate code under the same circumstances that an IPv6 node would receive an ICMPv6 Destination Unreachable message. The ITE either transcribes or relays the message toward the source address of the inner packet within the packet-in-error the same as specified for SPTB messages in Section 4.6.2.1.</p>
<p id="rfc.section.4.6.2.2.p.2">An ITE may receive an SPP message when the ETE receives a SEAL packet with an incorrect value in the SEAL header. The ITE should examine the SEAL header within the packet-in-error to determine whether a different setting should be used in subsequent packets, but does not relay the message further.</p>
<p id="rfc.section.4.6.2.2.p.3">TEs process other SCMP message types using methods and procedures specified in other documents. For example, SCMP message types used for tunnel neighbor coordinations are specified in VET <a href="#I-D.templin-intarea-vet">[I-D.templin-intarea-vet]</a>.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Link Requirements</h1>
<p id="rfc.section.5.p.1">Subnetwork designers are expected to follow the recommendations in Section 2 of <a href="#RFC3819">[RFC3819]</a> when configuring link MTUs.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> End System Requirements</h1>
<p id="rfc.section.6.p.1">End systems are encouraged to implement end-to-end MTU assurance (e.g., using Packetization Layer Path MTU Discovery per <a href="#RFC4821">[RFC4821]</a>) even if the subnetwork is using SEAL.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Router Requirements</h1>
<p id="rfc.section.7.p.1">Routers within the subnetwork are expected to observe the router requirements found in the normative references, including the implementation of IP fragmentation and reassembly <a href="#RFC1812">[RFC1812]</a><a href="#RFC2460">[RFC2460]</a> as well as the generation of ICMP messages <a href="#RFC0792">[RFC0792]</a><a href="#RFC4443">[RFC4443]</a>.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> IANA Considerations</h1>
<p id="rfc.section.8.p.1">The IANA is instructed to allocate an IP protocol number for 'SEAL_PROTO' in the 'protocol-numbers' registry.</p>
<p id="rfc.section.8.p.2">The IANA is instructed to allocate a Well-Known Port number for 'SEAL_PORT' in the 'port-numbers' registry.</p>
<p id="rfc.section.8.p.3">The IANA is instructed to establish a "SEAL Protocol" registry to record SEAL Version values. This registry should be initialized to include the initial SEAL Version number, i.e., Version 0.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#security" id="security">Security Considerations</a>
</h1>
<p id="rfc.section.9.p.1">SEAL provides a segment-by-segment data origin authentication and anti-replay service across the (potentially) multiple segments of a re-encapsulating tunnel. It further provides a segment-by-segment integrity check of the headers of encapsulated packets, but does not verify the integrity of the rest of the packet beyond the headers unless fragmentation is unavoidable. SEAL therefore considers full message integrity checking, authentication and confidentiality as end-to-end considerations in a manner that is compatible with securing mechanisms such as TLS/SSL <a href="#RFC5246">[RFC5246]</a>.</p>
<p id="rfc.section.9.p.2">An amplification/reflection/buffer overflow attack is possible when an attacker sends IP fragments with spoofed source addresses to an ETE in an attempt to clog the ETE's reassembly buffer and/or cause the ETE to generate a stream of SCMP messages returned to a victim ITE. The SCMP message ICVs, PKT_ID, as well as the inner headers of the packet-in-error, provide mitigation for the ETE to detect and discard SEAL segments with spoofed source addresses.</p>
<p id="rfc.section.9.p.3">The SEAL header is sent in-the-clear the same as for the outer IP and other outer headers. In this respect, the threat model is no different than for IPv6 extension headers. Unlike IPv6 extension headers, however, the SEAL header is protected by an integrity check that also covers the inner packet headers.</p>
<p id="rfc.section.9.p.4">Security issues that apply to tunneling in general are discussed in <a href="#RFC6169">[RFC6169]</a>.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Related Work</h1>
<p id="rfc.section.10.p.1">Section 3.1.7 of <a href="#RFC2764">[RFC2764]</a> provides a high-level sketch for supporting large tunnel MTUs via a tunnel-level segmentation and reassembly capability to avoid IP level fragmentation. This capability was implemented in the first edition of SEAL, but is now deprecated.</p>
<p id="rfc.section.10.p.2">Section 3 of <a href="#RFC4459">[RFC4459]</a> describes inner and outer fragmentation at the tunnel endpoints as alternatives for accommodating the tunnel MTU.</p>
<p id="rfc.section.10.p.3">Section 4 of <a href="#RFC2460">[RFC2460]</a> specifies a method for inserting and processing extension headers between the base IPv6 header and transport layer protocol data. The SEAL header is inserted and processed in exactly the same manner.</p>
<p id="rfc.section.10.p.4">IPsec/AH is <a href="#RFC4301">[RFC4301]</a><a href="#RFC4301">[RFC4301]</a> is used for full message integrity verification between tunnel endpoints, whereas SEAL only ensures integrity for the inner packet headers. The AYIYA proposal <a href="#I-D.massar-v6ops-ayiya">[I-D.massar-v6ops-ayiya]</a> uses similar means for providing full message authentication and integrity.</p>
<p id="rfc.section.10.p.5">The concepts of path MTU determination through the report of fragmentation and extending the IPv4 Identification field were first proposed in deliberations of the TCP-IP mailing list and the Path MTU Discovery Working Group (MTUDWG) during the late 1980's and early 1990's. An historical analysis of the evolution of these concepts, as well as the development of the eventual path MTU discovery mechanism, appears in Appendix D of this document.</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#acknowledge" id="acknowledge">Acknowledgments</a>
</h1>
<p id="rfc.section.11.p.1">The following individuals are acknowledged for helpful comments and suggestions: Jari Arkko, Fred Baker, Iljitsch van Beijnum, Oliver Bonaventure, Teco Boot, Bob Braden, Brian Carpenter, Steve Casner, Ian Chakeres, Noel Chiappa, Remi Denis-Courmont, Remi Despres, Ralph Droms, Aurnaud Ebalard, Gorry Fairhurst, Washam Fan, Dino Farinacci, Joel Halpern, Sam Hartman, John Heffner, Thomas Henderson, Bob Hinden, Christian Huitema, Eliot Lear, Darrel Lewis, Joe Macker, Matt Mathis, Erik Nordmark, Dan Romascanu, Dave Thaler, Joe Touch, Mark Townsley, Ole Troan, Margaret Wasserman, Magnus Westerlund, Robin Whittle, James Woodyatt, and members of the Boeing Research &amp; Technology NST DC&amp;NT group.</p>
<p id="rfc.section.11.p.2">Discussions with colleagues following the publication of RFC5320 have provided useful insights that have resulted in significant improvements to this, the Second Edition of SEAL.</p>
<p id="rfc.section.11.p.3">Path MTU determination through the report of fragmentation was first proposed by Charles Lynn on the TCP-IP mailing list in 1987. Extending the IP identification field was first proposed by Steve Deering on the MTUDWG mailing list in 1989.</p>
<h1 id="rfc.references">
<a href="#rfc.references">12.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">12.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC0791">[RFC0791]</b></td>
<td class="top">
<a title="University of Southern California (USC)/Information Sciences Institute">Postel, J.</a>, "<a href="http://tools.ietf.org/html/rfc791">Internet Protocol</a>", STD 5, RFC 791, September 1981.</td>
</tr>
<tr>
<td class="reference"><b id="RFC0792">[RFC0792]</b></td>
<td class="top">
<a title="University of Southern California (USC)/Information Sciences Institute">Postel, J.</a>, "<a href="http://tools.ietf.org/html/rfc792">Internet Control Message Protocol</a>", STD 5, RFC 792, September 1981.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4443">[RFC4443]</b></td>
<td class="top">
<a>Conta, A.</a>, <a>Deering, S.</a> and <a>M. Gupta</a>, "<a href="http://tools.ietf.org/html/rfc4443">Internet Control Message Protocol (ICMPv6) for the Internet Protocol Version 6 (IPv6) Specification</a>", RFC 4443, March 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3971">[RFC3971]</b></td>
<td class="top">
<a>Arkko, J.</a>, <a>Kempf, J.</a>, <a>Zill, B.</a> and <a>P. Nikander</a>, "<a href="http://tools.ietf.org/html/rfc3971">SEcure Neighbor Discovery (SEND)</a>", RFC 3971, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4861">[RFC4861]</b></td>
<td class="top">
<a>Narten, T.</a>, <a>Nordmark, E.</a>, <a>Simpson, W.</a> and <a>H. Soliman</a>, "<a href="http://tools.ietf.org/html/rfc4861">Neighbor Discovery for IP version 6 (IPv6)</a>", RFC 4861, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2460">[RFC2460]</b></td>
<td class="top">
<a href="mailto:deering@cisco.com" title="Cisco Systems, Inc.">Deering, S.E.</a> and <a href="mailto:hinden@iprg.nokia.com" title="Nokia">R.M. Hinden</a>, "<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>", RFC 2460, December 1998.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">12.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC1063">[RFC1063]</b></td>
<td class="top">
<a title="Digital Equipment Corporation (DEC)">Mogul, J.</a>, <a title="Digital Equipment Corporation (DEC)">Kent, C.</a>, <a title="Bolt Baranek and Newman (BBN)">Partridge, C.</a> and <a title="The Wollongong Group (TWG)">K. McCloghrie</a>, "<a href="http://tools.ietf.org/html/rfc1063">IP MTU discovery options</a>", RFC 1063, July 1988.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1191">[RFC1191]</b></td>
<td class="top">
<a href="mailto:mogul@decwrl.dec.com" title="Digital Equipment Corporation (DEC) , Western Research Laboratory">Mogul, J.</a> and <a href="mailto:deering@xerox.com" title="Xerox Palo Alto Research Center">S. Deering</a>, "<a href="http://tools.ietf.org/html/rfc1191">Path MTU discovery</a>", RFC 1191, November 1990.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1981">[RFC1981]</b></td>
<td class="top">
<a href="mailto:mccann@zk3.dec.com" title="Digital Equipment Corporation">McCann, J.</a>, <a href="mailto:deering@parc.xerox.com" title="Xerox Palo Alto Research Center">Deering, S.</a> and <a href="mailto:mogul@pa.dec.com" title="Digital Equipment Corporation, Western Research Laboratory">J. Mogul</a>, "<a href="http://tools.ietf.org/html/rfc1981">Path MTU Discovery for IP version 6</a>", RFC 1981, August 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2003">[RFC2003]</b></td>
<td class="top">
<a href="mailto:perk@watson.ibm.com" title="Room H3-D34">Perkins, C.</a>, "<a href="http://tools.ietf.org/html/rfc2003">IP Encapsulation within IP</a>", RFC 2003, October 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2473">[RFC2473]</b></td>
<td class="top">
<a href="mailto:aconta@lucent.com" title="Lucent Technologies Inc.">Conta, A.</a> and <a href="mailto:deering@cisco.com" title="Cisco Systems">S. Deering</a>, "<a href="http://tools.ietf.org/html/rfc2473">Generic Packet Tunneling in IPv6 Specification</a>", RFC 2473, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2923">[RFC2923]</b></td>
<td class="top">
<a>Lahey, K.</a>, "<a href="http://tools.ietf.org/html/rfc2923">TCP Problems with Path MTU Discovery</a>", RFC 2923, September 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3366">[RFC3366]</b></td>
<td class="top">
<a>Fairhurst, G.</a> and <a>L. Wood</a>, "<a href="http://tools.ietf.org/html/rfc3366">Advice to link designers on link Automatic Repeat reQuest (ARQ)</a>", BCP 62, RFC 3366, August 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3819">[RFC3819]</b></td>
<td class="top">
<a>Karn, P.</a>, <a>Bormann, C.</a>, <a>Fairhurst, G.</a>, <a>Grossman, D.</a>, <a>Ludwig, R.</a>, <a>Mahdavi, J.</a>, <a>Montenegro, G.</a>, <a>Touch, J.</a> and <a>L. Wood</a>, "<a href="http://tools.ietf.org/html/rfc3819">Advice for Internet Subnetwork Designers</a>", BCP 89, RFC 3819, July 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4213">[RFC4213]</b></td>
<td class="top">
<a>Nordmark, E.</a> and <a>R. Gilligan</a>, "<a href="http://tools.ietf.org/html/rfc4213">Basic Transition Mechanisms for IPv6 Hosts and Routers</a>", RFC 4213, October 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1812">[RFC1812]</b></td>
<td class="top">
<a href="mailto:fred@cisco.com" title="Cisco Systems">Baker, F.</a>, "<a href="http://tools.ietf.org/html/rfc1812">Requirements for IP Version 4 Routers</a>", RFC 1812, June 1995.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4380">[RFC4380]</b></td>
<td class="top">
<a>Huitema, C.</a>, "<a href="http://tools.ietf.org/html/rfc4380">Teredo: Tunneling IPv6 over UDP through Network Address Translations (NATs)</a>", RFC 4380, February 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4301">[RFC4301]</b></td>
<td class="top">
<a>Kent, S.</a> and <a>K. Seo</a>, "<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>", RFC 4301, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4302">[RFC4302]</b></td>
<td class="top">
<a>Kent, S.</a>, "<a href="http://tools.ietf.org/html/rfc4302">IP Authentication Header</a>", RFC 4302, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4459">[RFC4459]</b></td>
<td class="top">
<a>Savola, P.</a>, "<a href="http://tools.ietf.org/html/rfc4459">MTU and Fragmentation Issues with In-the-Network Tunneling</a>", RFC 4459, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4821">[RFC4821]</b></td>
<td class="top">
<a>Mathis, M.</a> and <a>J. Heffner</a>, "<a href="http://tools.ietf.org/html/rfc4821">Packetization Layer Path MTU Discovery</a>", RFC 4821, March 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4963">[RFC4963]</b></td>
<td class="top">
<a>Heffner, J.</a>, <a>Mathis, M.</a> and <a>B. Chandler</a>, "<a href="http://tools.ietf.org/html/rfc4963">IPv4 Reassembly Errors at High Data Rates</a>", RFC 4963, July 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2764">[RFC2764]</b></td>
<td class="top">
<a href="mailto:bgleeson@shastanets.com" title="Nortel Networks">Gleeson, B.</a>, <a href="mailto:jh@telia.fi" title="Telia Finland, Inc.">Heinanen, J.</a>, <a href="mailto:alin@shastanets.com" title="Nortel Networks">Lin, A.</a>, <a href="mailto:gja@lucent.com" title="Bell Labs Research Silicon Valley, Lucent Technologies">Armitage, G.</a> and <a href="mailto:amalis@lucent.com" title="Lucent Technologies">A.G. Malis</a>, "<a href="http://tools.ietf.org/html/rfc2764">A Framework for IP Based Virtual Private Networks</a>", RFC 2764, February 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2675">[RFC2675]</b></td>
<td class="top">
<a href="mailto:dab@bsdi.com" title="Berkeley Software Design, Inc.">Borman, D.</a>, <a href="mailto:deering@cisco.com" title="Cisco Systems, Inc.">Deering, S.</a> and <a href="mailto:hinden@iprg.nokia.com" title="Nokia">R. Hinden</a>, "<a href="http://tools.ietf.org/html/rfc2675">IPv6 Jumbograms</a>", RFC 2675, August 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5445">[RFC5445]</b></td>
<td class="top">
<a>Watson, M.</a>, "<a href="http://tools.ietf.org/html/rfc5445">Basic Forward Error Correction (FEC) Schemes</a>", RFC 5445, March 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1070">[RFC1070]</b></td>
<td class="top">
<a href="mailto:hagens@cs.wisc.edu" title="University of Wisconsin, Madison, Computer Sciences Department">Hagens, R.</a>, <a href="mailto:nhall@cs.wisc.edu" title="University of Wisconsin, Madison, Computer Sciences Department">Hall, N.</a> and <a href="mailto:mrose@twg.com" title="The Wollongong Group">M. Rose</a>, "<a href="http://tools.ietf.org/html/rfc1070">Use of the Internet as a subnetwork for experimentation with the OSI network layer</a>", RFC 1070, February 1989.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3232">[RFC3232]</b></td>
<td class="top">
<a>Reynolds, J.</a>, "<a href="http://tools.ietf.org/html/rfc3232">Assigned Numbers: RFC 1700 is Replaced by an On-line Database</a>", RFC 3232, January 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4191">[RFC4191]</b></td>
<td class="top">
<a>Draves, R.</a> and <a>D. Thaler</a>, "<a href="http://tools.ietf.org/html/rfc4191">Default Router Preferences and More-Specific Routes</a>", RFC 4191, November 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4987">[RFC4987]</b></td>
<td class="top">
<a>Eddy, W.</a>, "<a href="http://tools.ietf.org/html/rfc4987">TCP SYN Flooding Attacks and Common Mitigations</a>", RFC 4987, August 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5720">[RFC5720]</b></td>
<td class="top">
<a>Templin, F.</a>, "<a href="http://tools.ietf.org/html/rfc5720">Routing and Addressing in Networks with Global Enterprise Recursion (RANGER)</a>", RFC 5720, February 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.templin-intarea-vet">[I-D.templin-intarea-vet]</b></td>
<td class="top">
<a>Templin, F</a>, "<a href="http://tools.ietf.org/html/draft-templin-intarea-vet-31">Virtual Enterprise Traversal (VET)</a>", Internet-Draft draft-templin-intarea-vet-31, November 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-savi-framework">[I-D.ietf-savi-framework]</b></td>
<td class="top">
<a>Wu, J</a>, <a>Bi, J</a>, <a>Bagnulo, M</a>, <a>Baker, F</a> and <a>C Vogt</a>, "<a href="http://tools.ietf.org/html/draft-ietf-savi-framework-05">Source Address Validation Improvement Framework</a>", Internet-Draft draft-ietf-savi-framework-05, July 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.templin-ironbis">[I-D.templin-ironbis]</b></td>
<td class="top">
<a>Templin, F</a>, "<a href="http://tools.ietf.org/html/draft-templin-ironbis-08">The Internet Routing Overlay Network (IRON)</a>", Internet-Draft draft-templin-ironbis-08, November 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6139">[RFC6139]</b></td>
<td class="top">
<a>Russert, S.</a>, <a>Fleischman, E.</a> and <a>F. Templin</a>, "<a href="http://tools.ietf.org/html/rfc6139">Routing and Addressing in Networks with Global Enterprise Recursion (RANGER) Scenarios</a>", RFC 6139, February 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5927">[RFC5927]</b></td>
<td class="top">
<a>Gont, F.</a>, "<a href="http://tools.ietf.org/html/rfc5927">ICMP Attacks against TCP</a>", RFC 5927, July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6169">[RFC6169]</b></td>
<td class="top">
<a>Krishnan, S.</a>, <a>Thaler, D.</a> and <a>J. Hoagland</a>, "<a href="http://tools.ietf.org/html/rfc6169">Security Concerns with IP Tunneling</a>", RFC 6169, April 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-intarea-ipv4-id-update">[I-D.ietf-intarea-ipv4-id-update]</b></td>
<td class="top">
<a>Touch, J</a>, "<a href="http://tools.ietf.org/html/draft-ietf-intarea-ipv4-id-update-04">Updated Specification of the IPv4 ID Field</a>", Internet-Draft draft-ietf-intarea-ipv4-id-update-04, September 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.templin-aero">[I-D.templin-aero]</b></td>
<td class="top">
<a>Templin, F</a>, "<a href="http://tools.ietf.org/html/draft-templin-aero-04">Asymmetric Extended Route Optimization (AERO)</a>", Internet-Draft draft-templin-aero-04, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.massar-v6ops-ayiya">[I-D.massar-v6ops-ayiya]</b></td>
<td class="top">
<a>Massar, J</a>, "<a href="http://tools.ietf.org/html/draft-massar-v6ops-ayiya-02">AYIYA: Anything In Anything</a>", Internet-Draft draft-massar-v6ops-ayiya-02, July 2004.</td>
</tr>
<tr>
<td class="reference"><b id="FRAG">[FRAG]</b></td>
<td class="top">
<a>Kent, C</a> and <a>J Mogul</a>, "<a>Fragmentation Considered Harmful</a>", October 1987.</td>
</tr>
<tr>
<td class="reference"><b id="FOLK">[FOLK]</b></td>
<td class="top">
<a>Shannon, C</a>, <a>Moore, D</a> and <a>k claffy</a>, "<a>Beyond Folklore: Observations on Fragmented Traffic</a>", December 2002.</td>
</tr>
<tr>
<td class="reference"><b id="MTUDWG">[MTUDWG]</b></td>
<td class="top">
<a>, </a>, "<a>IETF MTU Discovery Working Group mailing list, gatekeeper.dec.com/pub/DEC/WRL/mogul/mtudwg-log, November 1989 - February 1995.</a>", .</td>
</tr>
<tr>
<td class="reference"><b id="TCP-IP">[TCP-IP]</b></td>
<td class="top">
<a>, </a>, "<a>Archive/Hypermail of Early TCP-IP Mail List, http://www-mice.cs.ucl.ac.uk/multimedia/misc/tcp_ip/, May 1987 - May 1990.</a>", .</td>
</tr>
<tr>
<td class="reference"><b id="TBIT">[TBIT]</b></td>
<td class="top">
<a>Medina, A</a>, <a>Allman, M</a> and <a>S Floyd</a>, "<a>Measuring Interactions Between Transport Protocols and Middleboxes</a>", October 2004.</td>
</tr>
<tr>
<td class="reference"><b id="WAND">[WAND]</b></td>
<td class="top">
<a>Luckie, M</a>, <a>Cho, K</a> and <a>B Owens</a>, "<a>Inferring and Debugging Path MTU Discovery Failures</a>", October 2005.</td>
</tr>
<tr>
<td class="reference"><b id="SIGCOMM">[SIGCOMM]</b></td>
<td class="top">
<a>Luckie, M</a> and <a>B Stasiewicz</a>, "<a>Measuring Path MTU Discovery Behavior</a>", November 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> Reliability</h1>
<p id="rfc.section.Appendix A.p.1">Although a SEAL tunnel may span an arbitrarily-large subnetwork expanse, the IP layer sees the tunnel as a simple link that supports the IP service model. Links with high bit error rates (BERs) (e.g., IEEE 802.11) use Automatic Repeat-ReQuest (ARQ) mechanisms <a href="#RFC3366">[RFC3366]</a> to increase packet delivery ratios, while links with much lower BERs typically omit such mechanisms. Since SEAL tunnels may traverse arbitrarily-long paths over links of various types that are already either performing or omitting ARQ as appropriate, it would therefore often be inefficient to also require the tunnel endpoints to also perform ARQ.</p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> Integrity</h1>
<p id="rfc.section.Appendix B.p.1">The SEAL header includes an ICV field that covers the SEAL header and at least the inner packet headers. This provides for header integrity verification on a segment-by-segment basis for a segmented re-encapsulating tunnel path. When IPv4 fragmentation is needed, the SEAL packet also contains a trailer with a secondary ICV that covers the remainder of the packet.</p>
<p id="rfc.section.Appendix B.p.2">Fragmentation and reassembly schemes must consider packet-splicing errors, e.g., when two fragments from the same packet are concatenated incorrectly, when a fragment from packet X is reassembled with fragments from packet Y, etc. The primary sources of such errors include implementation bugs and wrapping IPv4 ID fields.</p>
<p id="rfc.section.Appendix B.p.3">In terms of wrapping ID fields, the IPv4 16-bit ID field can wrap with only 64K packets with the same (src, dst, protocol)-tuple alive in the system at a given time <a href="#RFC4963">[RFC4963]</a> increasing the likelihood of reassembly mis-associations</p>
<p id="rfc.section.Appendix B.p.4">When reassembly is unavoidable, SEAL provides an extended ICV to detect reassembly mis-associations for packets no larger than 1280 bytes and also discards any reassembled packets larger than 1280 bytes.</p>
<h1 id="rfc.appendix.Appendix C">
<a href="#rfc.appendix.Appendix%20C">Appendix C.</a> Transport Mode</h1>
<p id="rfc.section.Appendix C.p.1">SEAL can also be used in "transport-mode", e.g., when the inner layer comprises upper-layer protocol data rather than an encapsulated IP packet. For instance, TCP peers can negotiate the use of SEAL (e.g., by inserting a 'SEAL_OPTION' TCP option during connection establishment) for the carriage of protocol data encapsulated as IP/SEAL/TCP. In this sense, the "subnetwork" becomes the entire end-to-end path between the TCP peers and may potentially span the entire Internet.</p>
<p id="rfc.section.Appendix C.p.2">If both TCPs agree on the use of SEAL, their protocol messages will be carried as IP/SEAL/TCP and the connection will be serviced by the SEAL protocol using TCP (instead of an encapsulating tunnel endpoint) as the transport layer protocol. The SEAL protocol for transport mode otherwise observes the same specifications as for Section 4.</p>
<h1 id="rfc.appendix.Appendix D">
<a href="#rfc.appendix.Appendix%20D">Appendix D.</a> Historic Evolution of PMTUD</h1>
<p id="rfc.section.Appendix D.p.1">The topic of Path MTU discovery (PMTUD) saw a flurry of discussion and numerous proposals in the late 1980's through early 1990. The initial problem was posed by Art Berggreen on May 22, 1987 in a message to the TCP-IP discussion group <a href="#TCP-IP">[TCP-IP]</a>. The discussion that followed provided significant reference material for [FRAG]. An IETF Path MTU Discovery Working Group <a href="#MTUDWG">[MTUDWG]</a> was formed in late 1989 with charter to produce an RFC. Several variations on a very few basic proposals were entertained, including:</p>
<p></p>

<ol>
<li>Routers record the PMTUD estimate in ICMP-like path probe messages (proposed in [FRAG] and later <a href="#RFC1063">[RFC1063]</a>)</li>
<li>The destination reports any fragmentation that occurs for packets received with the "RF" (Report Fragmentation) bit set (Steve Deering's 1989 adaptation of Charles Lynn's Nov. 1987 proposal)</li>
<li>A hybrid combination of 1) and Charles Lynn's Nov. 1987 (straw RFC draft by McCloughrie, Fox and Mogul on Jan 12, 1990)</li>
<li>Combination of the Lynn proposal with TCP (Fred Bohle, Jan 30, 1990)</li>
<li>Fragmentation avoidance by setting "IP_DF" flag on all packets and retransmitting if ICMPv4 "fragmentation needed" messages occur (Geof Cooper's 1987 proposal; later adapted into <a href="#RFC1191">[RFC1191]</a> by Mogul and Deering).</li>
</ol>
<p id="rfc.section.Appendix D.p.3">Option 1) seemed attractive to the group at the time, since it was believed that routers would migrate more quickly than hosts. Option 2) was a strong contender, but repeated attempts to secure an "RF" bit in the IPv4 header from the IESG failed and the proponents became discouraged. 3) was abandoned because it was perceived as too complicated, and 4) never received any apparent serious consideration.  Proposal 5) was a late entry into the discussion from Steve Deering on Feb. 24th, 1990. The discussion group soon thereafter seemingly lost track of all other proposals and adopted 5), which eventually evolved into <a href="#RFC1191">[RFC1191]</a> and later <a href="#RFC1981">[RFC1981]</a>.</p>
<p id="rfc.section.Appendix D.p.4">In retrospect, the "RF" bit postulated in 2) is not needed if a "contract" is first established between the peers, as in proposal 4) and a message to the MTUDWG mailing list from jrd@PTT.LCS.MIT.EDU on Feb 19.  1990. These proposals saw little discussion or rebuttal, and were dismissed based on the following the assertions:</p>
<p></p>

<ul>
<li>routers upgrade their software faster than hosts</li>
<li>PCs could not reassemble fragmented packets</li>
<li>Proteon and Wellfleet routers did not reproduce the "RF" bit properly in fragmented packets</li>
<li>Ethernet-FDDI bridges would need to perform fragmentation (i.e., "translucent" not "transparent" bridging)</li>
<li>the 16-bit IP_ID field could wrap around and disrupt reassembly at high packet arrival rates</li>
</ul>

<p>The first four assertions, although perhaps valid at the time, have been overcome by historical events. The final assertion is addressed by the mechanisms specified in SEAL.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Fred L. Templin</span> editor
	  <span class="n hidden">
		<span class="family-name">Templin</span>
	  </span>
	</span>
	<span class="org vcardline">Boeing Research & Technology</span>
	<span class="adr">
	  <span>P.O. Box 3707</span>

	  <span class="vcardline">
		<span class="locality">Seattle</span>,  
		<span class="region">WA</span> 
		<span class="code">98124</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:fltemplin@acm.org">fltemplin@acm.org</a></span>

  </address>
</div>

</body>
</html>