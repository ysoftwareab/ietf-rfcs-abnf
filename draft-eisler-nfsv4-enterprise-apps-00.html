<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Extending NFS to Support Enterprise Applications</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Extending NFS to Support Enterprise Applications">
<meta name="keywords" content="template">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Engineering Task Force</td><td class="header">M. Eisler, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">NetApp</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">M. Susairaj, Ed.</td></tr>
<tr><td class="header">Expires: April 17, 2011</td><td class="header">Oracle</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 14, 2010</td></tr>
</table></td></tr></table>
<h1><br />Extending NFS to Support Enterprise Applications<br />draft-eisler-nfsv4-enterprise-apps-00</h1>

<h3>Abstract</h3>

<p>This document proposes a new operating to efficiently initialize files.
      
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on April 17, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Requirements Language<br />
<a href="#anchor3">2.</a>&nbsp;
Operation XX: INITIALIZE - Initialize File<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.1.</a>&nbsp;
ARGUMENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.2.</a>&nbsp;
RESULT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.3.</a>&nbsp;
MOTIVATION<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.4.</a>&nbsp;
DESCRIPTION<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">2.5.</a>&nbsp;
IMPLEMENTATION<br />
<a href="#anchor9">3.</a>&nbsp;
Operation XX: IO_ADVISE - Advise server of client's intended I/O access pattern<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.1.</a>&nbsp;
ARGUMENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">3.2.</a>&nbsp;
RESULT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">3.3.</a>&nbsp;
MOTIVATION<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">3.4.</a>&nbsp;
DESCRIPTION<br />
<a href="#anchor14">4.</a>&nbsp;
Operation XX: READ_WITH_ADVICE - READ with advice<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">4.1.</a>&nbsp;
ARGUMENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">4.2.</a>&nbsp;
RESULT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">4.3.</a>&nbsp;
MOTIVATION<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">4.4.</a>&nbsp;
DESCRIPTION<br />
<a href="#anchor19">5.</a>&nbsp;
Operation XX: WRITE_WITH_ADVICE - WRITE with advice<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">5.1.</a>&nbsp;
ARGUMENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">5.2.</a>&nbsp;
RESULT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">5.3.</a>&nbsp;
MOTIVATION<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">5.4.</a>&nbsp;
DESCRIPTION<br />
<a href="#anchor24">6.</a>&nbsp;
Operation XX: SET_WORKFLOW_TAG - Sets the workflow tag of a given session<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">6.1.</a>&nbsp;
ARGUMENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">6.2.</a>&nbsp;
RESULT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">6.3.</a>&nbsp;
MOTIVATION<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">6.4.</a>&nbsp;
DESCRIPTION<br />
<a href="#anchor29">7.</a>&nbsp;
Operation XX: SESSION_CTL - Adjust session parameters<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor30">7.1.</a>&nbsp;
ARGUMENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">7.2.</a>&nbsp;
RESULT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">7.3.</a>&nbsp;
MOTIVATION<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor33">7.4.</a>&nbsp;
DESCRIPTION<br />
<a href="#anchor34">8.</a>&nbsp;
Modification to Operation 42: EXCHANGE_ID - Instantiate Client ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor35">8.1.</a>&nbsp;
ARGUMENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor36">8.2.</a>&nbsp;
RESULT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor37">8.3.</a>&nbsp;
MOTIVATION<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor38">8.4.</a>&nbsp;
DESCRIPTION<br />
<a href="#anchor39">9.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor40">10.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor41">11.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">12.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">12.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">12.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Enterprise applications (such as databases) have requirements that go beyond the traditional
         use cases for NFS. The requirements falls into two broad categories: (1) data integrity and
         (2) quality of service.

         This document proposes a set of operatons for a future minor version of NFSv4 to support requirements of enterprise applications.

        
      
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Operation XX: INITIALIZE - Initialize File</h3>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
ARGUMENT</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
struct INITIALIZE4args {
           /* CURRENT_FH: file */
           stateid4        ia_stateid;
           offset4         ia_offset;
           length4         ia_blocksize
           length4         ia_blockcount;
           length4         ia_reloff_pattern;
           length4         ia_reloff_blocknum;
           opaque          ia_pattern&lt;&gt;;
};

</pre></div>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
RESULT</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 nfsstat4;
</pre></div>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
MOTIVATION</h3>

<p>
         Most enterprise applications that use files almost always need to initialize such files to a known state.
         Even with existing files, after such a file grows, the application
         needs to initialize the expanded region the file.

         The most trivial initial state is intialize every byte to zero. The problem with initializing to
         zero is that it is often difficult to distinguish a byte-range of initialized to all zeroes from
         data corruption, since a pattern of zeroes is a probable pattern for corruption. Instead, some applications,
         such as database management systems, use pattern consisting of bytes or words of non-zero values.
         Ideally one would like to efficiently initialize an entire file to a specified pattern without
         having to send WRITE requests for the entire file. The INITIALIZE operation is bandwidth conserving
         operation for initializing file state.
         
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
DESCRIPTION</h3>

<p>
        The INITIALIZE operation is used to initialize an open file
        to an iterated pattern. The pattern consists of a fixed
        string, and a block number. The pattern is defined by the arguments.
        </p>
<ul class="text">
<li>
            ia_offset: where to start the iterated pattern. This value
            is specified in bytes.
           
</li>
<li>
             ia_blocksize: the size of each iteration of the pattern. Each
             iteration is called a block.
           
</li>
<li>
             ia_reloff_pattern: the relative offset within a block
             where to write the specified pattern encoded in
             ia_pattern.
           
</li>
<li>
             ia_reloff_blocknum: the relative offset within a block
             where to write a 64 bit block number. The
             block number is incremented once a block is
             written. The block number is always written in
             little endian order. If ia_reloff_blocknum is set to NFS4_UINT64_MAX,
             then this informs the server that no block number is to be written.
           
</li>
<li>
             ia_pattern: a fixed string written to every block. If the length of ia_pattern is zero, then
             this informs the server that no string is to be written.
             
           
</li>
</ul><p>
        
</p>
<p>
          The field ia_stateid is the stateid corresponding to the
          current filehandle's share reservation, delegation, or
          byte range lock.
        
</p>
<p>
          An example will illustrate how the client uses INITIALIZE.
          Suppose the arguments (except for ia_stateid) are: 
         { 0, 500, 1000, 8, 0, "DeadBeef" }. Then starting with offset zero,
         the content of the file will have these contents.
  
         </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
offset value (decimal or ASCII)
0      0   0   0   0   0   0   0   0
8      'D' 'e' 'a' 'd' 'B' 'e' 'e' 'f'
16-499 zeroes

500    0   0   0   0   0   0   0   1
508    'D' 'e' 'a' 'd' 'B' 'e' 'e' 'f'
516-999 zeroes

...

499500  0   0   0   0   0   0   3   231
499508  'D' 'e' 'a' 'd' 'B' 'e' 'e' 'f'
499516-499999 zeroes

</pre></div><p>

      
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
IMPLEMENTATION</h3>

<p>
      When an NFS server receives this operation, instead of writing the iterated pattern over each block,
      it should de-allocate the data of affected range of the file and record the the values of 
      ia_offset, ia_blocksize, ia_blockcount, ia_reloff_pattern, ia_reloff_blocknum,
      and ia_pattern<> in the file's system metadata. When a client sends a READ request, instead of returning zeroes,
      it should construct a response corresponding to the pattern specified in the arguments to INITIALIZE.
    
</p>
<p>
      An application likely has a legacy pattern for initialized blocks which cannot be mapped to that specified for INITIALIZE.
      The application should modified to detect that the block corresponds to INITIALIZE's pattern. When the application sees such a block, it
      can overwrite the block with the legacy pattern. Note that will cause the block to be allocated on the NFS server.

    
</p>
<p>
      When the length of ia_pattern is zero and the value of ia_reloff_blocknum is NFS4_UINT64_MAX, then the client is requesting
      that a hole be punched into the file.
    
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Operation XX: IO_ADVISE - Advise server of client's intended I/O access pattern</h3>

<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
ARGUMENT</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        enum io_advise_type {
           IO_ADVISE4_SEQUENTIAL_CACHE       = 0,
           IO_ADVISE4_SEQUENTIAL_DONTCACHE       = 1,
           IO_ADVISE4_RANDOM           = 2,
    	   IO_ADVISE4_PREFETCH         = 3,
           IO_ADVISE4_PREFETCH_OPPORTUNISTIC = 4,
	   IO_ADVISE4_INTENT_TO_WRITE = 5,
	   IO_ADVISE4_RECENTLY_USED = 6
   	};


        struct io_directions {
		stateid4	iod_stateid;
                offset4         iod_offset;
                bitmap4		iod_flags;
	};

        struct IO_ADVISE4args {
               /* CURRENT_FH: file */
               io_directions ioaa_directions;
               length4       ioaa_count;
        };


</pre></div>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
RESULT</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   struct IO_ADVISE4resok {
	   bitmap4		ioar_flags;
   };

   union IO_ADVISE4res switch (nfsstat4 ioar_status) {
    case NFS4_OK:
            IO_ADVISE4resok  ioar_resok4;
    default:
            void;
   };

</pre></div>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
MOTIVATION</h3>

<p>
          The client is in a better position to deduce the intended I/O pattern than the server, especially if the application
          provides this information. With this information, the server can optimize I/O to the file.
         
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
DESCRIPTION</h3>

<p>
        The IO_ADVISE operation is used advise the server as to how the holder of the stateid intends to access the file over the
        specified byte range (iod_offset through iod_offset + ioaa_count - 1).
        </p>
<ul class="text">
<li>IO_ADVISE4_SEQUENTIAL_CACHE: Sequential access to data expected. The server should leave data in its cache.
</li>
<li>IO_ADVISE4_SEQUENTIAL_DONTCACHE: Sequential access to data expected. The server does not need to leave data in its cache.  
</li>
<li>IO_ADVISE4_RANDOM: Random access to data expected.     
</li>
<li>IO_ADVISE4_PREFETCH: Stateid holder expects to access the data soon; prefetch data in preparation.
</li>
<li>IO_ADVISE4_PREFETCH_OPPORTUNISTIC: Stateid holder expects to access the data soon; prefetch if it can be done at a marginal cost.
</li>
<li>IO_ADVISE4_INTENT_TO_WRITE: Byte range will be written soon so no point in caching data.
</li>
<li>IO_ADVISE4_RECENTLY_USED: The client has recently accessed the byte range in its own cache. This informs the server
              that the data in the byte range remains important to the client. When the server reaches resource exhaustion, knowing
              which data is more important allows the server to make better choices about which data to, for example purge from
              a cache, or move to secondary storage. It also informs the server which delegations are more important, since
              if delegations are working correctly, once delegated to a client, a server might never receive another I/O
              request for the file.
</li>
</ul><p>
        
</p>
<p>The results indicate which advice the server intends to follow. 
           The server MUST NOT return an error if it does not
           recognize or does not support the requested advice. The
           server MAY return different advice than what the client requested.
           
           If it does, then this might be due to one of several
           conditions, including, but not limited to: another client
           advising of a different I/O access pattern; a
           different I/O access pattern from another client that
           that the server has heuristically detected; or the server
           is not able to support the requested I/O access pattern,
           perhaps due to a temporary resource limitation (for example,
           a request for IO_ADVISE4_SEQUENTIAL_CACHE might not be supported
           because the server cannot afford to cache data, and/or
           cannot afford to queue read-a-head requests).
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Operation XX: READ_WITH_ADVICE - READ with advice</h3>

<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
ARGUMENT</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        enum io_advise_type {
           IO_ADVISE4_SEQUENTIAL_CACHE       = 0,
           IO_ADVISE4_SEQUENTIAL_DONTCACHE       = 1,
           IO_ADVISE4_RANDOM           = 2,
    	   IO_ADVISE4_PREFETCH         = 3,
           IO_ADVISE4_PREFETCH_OPPORTUNISTIC = 4,
	   IO_ADVISE4_INTENT_TO_WRITE = 5,
	   IO_ADVISE4_RECENTLY_USED = 6
   	};


        struct io_directions {
		stateid4	iod_stateid;
                offset4         iod_offset;

                bitmap4		iod_flags;
	};

   struct READ_WITH_ADVICE4args {
           /* CURRENT_FH: file */
           io_directions rwaa_directions;
           length4       rwaa_count;
   };



</pre></div>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
RESULT</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   const NFS4_TWO_GB            = 0x80000000;

   typedef opaque twoGB_byte_array4[NFS4_INT32_MAX];

   struct fourGB_buffer4 {
        twoGB_byte_array4[2];
   }

   struct large_buffer4 {
           fourGB_buffer4 lb_big_buffers&lt;&gt;;
           opaque         lb_small_buffer&lt;&gt;;
   }


   struct READ_WITH_ADVICE4resok {
           bool                 rwar_eof;
	   bitmap4		rwar_flags;
           large_buffer4        rwar_data;

   };

   union READ_WITH_ADVICE4res switch (nfsstat4 rwar_status) {
    case NFS4_OK:
            READ_WITH_ADVICE4resok  rwar_resok4;
    default:
            void;
   };

</pre></div>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
MOTIVATION</h3>

<p>
          Under some circumstances, the IO_ADVISE operation is insufficient when the client is also performing a READ operation.
          Some advice needs to be communicated atomically with the READ operation and an IO_ADVISE in the same COMPOUND operation as the READ operation
          would fail to provide the necessary advice. For example, if IO_ADVISE proceeded READ, and the server was given advice to not cache
          the data requested by READ, the IO_ADVISE would be too late, because the server might already have cached the data. If IO_ADVISE
          preceded READ, in order to be effective, the advice would have to be communicated across two operations in the same COMPOUND. This
          would complicate the server implementation. 
         
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
DESCRIPTION</h3>

<p>
        The READ_WITH_ADVICE operation is used read from a file and to advise the server as to how the reader of intends to access the file over the
        specified byte range (iod_offset through iod_offset + rwaa_count - 1).
        </p>
<ul class="text">
<li>IO_ADVISE4_SEQUENTIAL_CACHE: Sequential access to data expected. The server should leave data in its cache.
</li>
<li>IO_ADVISE4_SEQUENTIAL_DONTCACHE: Sequential access to data expected. The server does not need to leave data in its cache.  
</li>
<li>IO_ADVISE4_RANDOM: Random access to data expected.     
</li>
<li>IO_ADVISE4_PREFETCH: Not applicable.
</li>
<li>IO_ADVISE4_PREFETCH_OPPORTUNISTIC: Not applicable.
</li>
<li>IO_ADVISE4_INTENT_TO_WRITE: Byte range will be written soon so no point in caching data.
</li>
<li>IO_ADVISE4_RECENTLY_USED: Explicit hint to keep data of byte range in cache.
</li>
</ul><p>
        
</p>
<p>The results indicate which advice the server intends to follow. The server MUST NOT return an error if it does not
           recognize or does not support the requested advice.
</p>
<p>The intent is that READ_WITH_ADVICE is preferred over READ. In addition to providing I/O hints, READ_WITH_ADVICE uses 64 bit data lengths,
           which anticipates the expected improvements in average network speeds and network buffer capacities. Because the XDR standard does not support
           64 bit array lengths, the large_buffer4 data type is introduced to encode an array of zero or more buffers of fixed size of 2^32 bytes, 
           followed by a variable length array of up to 2^32 - 1 bytes
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Operation XX: WRITE_WITH_ADVICE - WRITE with advice</h3>

<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
ARGUMENT</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
           enum stable_how4 { /* from NFSv4.0 */
            UNSTABLE4       = 0,
            DATA_SYNC4      = 1,
            FILE_SYNC4      = 2,
            LAYOUT_SYNC4    = 3 /* new */
           };

        enum io_advise_type {
           IO_ADVISE4_SEQUENTIAL_CACHE       = 0,
           IO_ADVISE4_SEQUENTIAL_DONTCACHE       = 1,
           IO_ADVISE4_RANDOM           = 2,
    	   IO_ADVISE4_PREFETCH         = 3,
           IO_ADVISE4_PREFETCH_OPPORTUNISTIC = 4,
	   IO_ADVISE4_INTENT_TO_WRITE = 5,
	   IO_ADVISE4_RECENTLY_USED = 6
   	};

        struct io_directions {
		stateid4	iod_stateid;
                offset4         iod_offset;
                bitmap4		iod_flags;
	};

   struct WRITE_WITH_ADVICE4args {
           /* CURRENT_FH: file */
           stable_how4     wwaa_stable;
           io_directions   wwaa_directions;
           large_buffer4   wwaa_data&lt;&gt;;
   };




</pre></div>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
RESULT</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   struct WRITE_WITH_ADVICE4resok {
           length4              wwar_count;
           stable_how4          wwar_committed;
	   bitmap4		wwar_flags;


   };

   union WRITE_WITH_ADVICE4res switch (nfsstat4 wwar_status) {
    case NFS4_OK:
            WRITE_WITH_ADVICE4resok  wwar_resok4;
    default:
            void;
   };

</pre></div>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
MOTIVATION</h3>

<p>
         Under some circumstances, the IO_ADVISE operation is insufficient when the client is also performing a WRITE operation.
          Some advice needs to be communicated atomically with the WRITE operation and an IO_ADVISE in the same COMPOUND operation as the WRITE operation
          would fail to provide the necessary advice. For example, if IO_ADVISE proceeded WRITE and the server was given advice to not cache
          the data requested by WRITE the IO_ADVISE would be too late, because the server might already have cached the data. If IO_ADVISE
          preceded WRITE in order to be effective, the advice would have to be communicated across two operations in the same COMPOUND. This
          would complicate the server implementation.  
         
</p>
<p>
           This operation adds a new enumerated value for stable_how4 called LAYOUT_SYNC4 in order to reduce the need for LAYOUT_COMMIT operations.
         
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
DESCRIPTION</h3>

<p>
        The WRITE_WITH_ADVICE operation is used write to a file and to advise the server as to how the writer intends to access the file over the
        specified byte range (iod_offset through iod_offset + amount of data in wwaa_data - 1).
        </p>
<ul class="text">
<li>IO_ADVISE4_SEQUENTIAL_CACHE: Sequential access to data expected. The server should leave data in its cache.
</li>
<li>IO_ADVISE4_SEQUENTIAL_DONTCACHE: Sequential access to data expected. The server does not need to leave data in its cache.  
</li>
<li>IO_ADVISE4_RANDOM: Random access to data expected.     
</li>
<li>IO_ADVISE4_PREFETCH: Not applicable.
</li>
<li>IO_ADVISE4_PREFETCH_OPPORTUNISTIC: Not applicable.
</li>
<li>IO_ADVISE4_INTENT_TO_WRITE: Byte range will be over-written soon so no point in caching data.
</li>
<li>IO_ADVISE4_RECENTLY_USED: Explicit hint to keep data of byte range in cache.
</li>
</ul><p>
        
</p>
<p>The results indicate which advice the server intends to follow. The server MUST NOT return an error if it does not
           recognize or does not support the requested advice.
</p>
<p>The intent is that WRITE_WITH_ADVICE is preferred over WRITE.

        In addition to providing I/O hints, WRITE_WITH_ADVICE uses 64 bit data lengths, which
           anticipates the expected improvements in average network speeds and network buffer capacities. Because the XDR standard does not support
           64 bit array lengths, the large_buffer4 data type is introduced to encode an array of zero or more buffers of fixed size of 2^32 bytes, 
           followed by a variable length array of up to 2^32 - 1 bytes
</p>
<p>
           If general, if the value of wwaa_stable is valid, then the value of wwar_committed in 
           the reply MUST NOT be less than the value of wwaa_stable. The exception is if the wwaa_stable is LAYOUT_SYNC4.
           LAYOUT_SYNC4 is an enumerated value that can be used by the client when the server is an pNFS data server, and the client has
           a layout that covers the byte range specified by iod_offset and the amlount of data in wwaa_data. 
           If the client sends a WRITE_WITH_ADVICE to a data server with wwaa_stable set to LAYOUT_SYNC4, then a successful reply MUST return value of
           wwar_committed equal to LAYOUT_SYNC4 or FILE_SYNC4. Regardless what value wwaa_stable is, if the server is a pNFS data server, it MAY
           return a value of wwar_committed equal to LAYOUT_SYNC4. Whenever wwar_committed is LAYOUT_SYNC4, this indicates that range of the
           layout covered by iod_offset and wwar_count has been committed to the metadata server, 
           and there is not need to send a LAYOUT_COMMIT for that range.
         
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Operation XX: SET_WORKFLOW_TAG - Sets the workflow tag of a given session</h3>

<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
ARGUMENT</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>


   struct SET_WORKFLOW_TAG 4args {

           uint64_t  swta_tag;
   };

</pre></div>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
RESULT</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

        nfsstat4

</pre></div>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
MOTIVATION</h3>

<p>
          Enterprise applications require guarantees of quality and/or priority 
          of service Providing end-to-end guarantees requires
          awareness at the file services level of the necessary quality and/or priority.
         
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
DESCRIPTION</h3>

<p>

	Sets the workflow tag of a given session. All operations in progress before the 
        server receives SET_WORKFLOW_TAG use the previous tag (if any). All operations 
        received after the server receives SET_WORKFLOW_TAG use the new tag.

     
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Operation XX: SESSION_CTL - Adjust session parameters</h3>

<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
ARGUMENT</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   struct channel_attrs4 { /* from NFSv4.1 */
           count4                  ca_headerpadsize;
           count4                  ca_maxrequestsize;
           count4                  ca_maxresponsesize;
           count4                  ca_maxresponsesize_cached;
           count4                  ca_maxoperations;
           count4                  ca_maxrequests;
           uint32_t                ca_rdma_ird&amp;lt1&gt;;
   };

   /* from NFSv4.1 */

   const CREATE_SESSION4_FLAG_PERSIST              = 0x00000001;
   const CREATE_SESSION4_FLAG_CONN_BACK_CHAN       = 0x00000002;
   const CREATE_SESSION4_FLAG_CONN_RDMA            = 0x00000004;

  struct session_ctl4 {
         uint32_t                sc_flags;
         channel_attrs4          sc_fore_chan_attrs;
         channel_attrs4          sc_back_chan_attrs;
  };

  typedef session_ctl SESSION_CTL4args;



</pre></div>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
RESULT</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   union SESSION_CTL4res switch (nfsstat4 scr_status) {
   case NFS4_OK:
           session_ctl4  scr_resok4;
   default:
           void;
   };


</pre></div>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
MOTIVATION</h3>

<p>
          The introduction of the session model in NFSv4.1 imposes an explicit limitation on the number of outstanding requests a
          client can make of an NFS server. In enterprise applications, it is possible each NFS request corresponds to a single
          application request. Thus, the size of the slot table can bound the number of outstanding application requests. While there are
          workarounds (examples include (1)implement a mapping layer between application's request slot list and the client's slot table (2) create
          additional sessions in order to preserve a one-to-one mapping between application and client slots), these workarounds introduce complexity.
          The application's needs for more slots are dynamic. The NFSv4.1 model assumes a dynamic slot table, but the size of the slot table
          is driven by the server via the reply to the SEQUENCE operation and the CB_RECALL_SLOT operation. What is missing is a method for
          the client to request a larger slot table.
        
</p>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
DESCRIPTION</h3>

<p>
           This operation allows the client to request changes to the session's parameters. There are three major fields in the arguments and results:
          
           </p>
<ul class="text">
<li>
          sc_flags. These flags correspond to the csa_flags and csr_flags argument and result of CREATE_SESSION. In the result, the value of a bit 
          in sc_flags MUST be one of:
          
<ul class="text">
<li>
             The corresponding bit in sc_flags of the arguments to SESSION_CTL.
          
</li>
<li>
             The corresponding bit in sc_flags of the result of the previous SESSION_CTL that the server executed.
          
</li>
<li>
             If the server has not executed a previous SESSION_CTL, then the corresponding bit in the csr_flags field of the reply
             the CREATE_SESSION operation that created the session.
          
</li>
</ul>     
    
           
</li>
<li>
             sc_fore_chan_attrs. In the arguments of SESSION_CTL, the fields within sc_fore_chan_attrs correspond to the fields of the argument
               csa_fore_chan_attrs in the arguments of CREATE_SESSION. In the results of SESSION_CTL, the values fields within sc_fore_chan_attrs
               correspond to the fields of the result csr_fore_chan_attrs in the response to CREATE_SESSION. The values of the fields in the result
               sc_fore_chan_attrs are governed according to the same rules that govern the values of the fields of csr_fore_chan_attrs.
          

           
</li>
<li>
              sc_back_chan_attrs. In the arguments of SESSION_CTL, the fields within sc_back_chan_attrs correspond to the fields of the argument
               csa_back_chan_attrs in the arguments of CREATE_SESSION. In the results of SESSION_CTL, the values fields within sc_back_chan_attrs
               correspond to the fields of the result csr_back_chan_attrs in the response to CREATE_SESSION. The values of the fields in the result
               sc_back_chan_attrs are governed according to the same rules that govern the values of the fields of csr_back_chan_attrs.
           
           
</li>
</ul><p>
      
</p>
<p>
         The SESSION_CTL operation MUST be sent on a COMPOUND operation prefixed by a SEQUENCE operation with the sa_slotid argument set to zero.
         If SESSION_CTL requests a smaller slot table on the fore channel, and there are operations in progress on other slots of the fore channel, 
         the server MUST do one of (1) return NFS4ERR_FORE_CHAN_BUSY (a new error); (2) 
         allow SESSION_CTL to succeed, wait for the in progress operations to complete and reply to those operations before replying
         to SESSION_CTL; or (3) if all the in progress operations allow the one or both of the errors NFS4ERR_DELAY or NFS4ERR_SERVERFAULT, allow 
         SESSION_CTL to succeed, abort the in progress operations, reply with to those operations with either NFS4ERR_DELAY or NFS4ERR_SERVERFAULT, and then
         reply to SESSION_CTL.
         Because a server is free to return NFS4ERR_FORE_CHAN_BUSY, it is strongly RECOMMENDED 
         that when a client sends a SESSION_CTL operation that it have no other requests in progress.
      
</p>
<p>
         If SESSION_CTL request a smaller slot table on the backchannel and there are operations in progress on other slots of the backchannel,
         the server MUST do one of (1) return NFS4ERR_BACK_CHAN_BUSY; (2) allow SESSION_CTL to succeed, and for wait replies to the in progress backchannel
         operations before replying to SESSION_CTL; or (3) if all the in progress operations allow the one or 
         both of the errors NFS4ERR_DELAY or NFS4ERR_SERVERFAULT, allow 
         SESSION_CTL to succeed, abort the in progress operations, reply with to those operations 
         with either NFS4ERR_DELAY or NFS4ERR_SERVERFAULT, and then
         reply to SESSION_CTL.
         Before a client sends a SESSION_CTL operation, it SHOULD reply to all in progress
         backchannel requests of the same session as the SESSION_CTL operation.
      
</p>
<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Modification to Operation 42: EXCHANGE_ID - Instantiate Client ID</h3>

<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
ARGUMENT</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
/* new */
const EXCHGID4_FLAG_SUPP_FENCE_OPS     = 0x00000004;

</pre></div>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
RESULT</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>Unchanged

</pre></div>
<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
MOTIVATION</h3>

<p>
          Enterprise applications require guarantees that an operation has either aborted or completed. NFSv4.1 provides this guarantee as
          long as the session is alive: simply send a SEQUENCE operation on the same slot with a new sequence number, and
          the successful return of SEQUENCE indicates the previous operation has completed.
         However, if the session is lost, there is no way to know when any in progress operations have
          aborted or completed. In hindsight, the NFSv4.1 specification should have mandated that DESTROY_SESSION abort/complete all
          outstanding operations. 
         
</p>
<a name="anchor38"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
DESCRIPTION</h3>

<p>
A client MAY request the EXCHGID4_FLAG_SUPP_FENCE_OPS  capability when it sends 
an EXCHANGE_ID operation. The server MAY set this capability in the EXCHANGE_ID 
request whether the client requests it or not. If the client ID is created with 
this capability then the following will occur:
</p>
<ul class="text">
<li>The server will not reply to DESTROY_SESSION until all operations in progress are completed or aborted.
</li>
<li>	The server will not reply to subsequent EXCHANGE_ID invoked on the same Client Owner with a 
new verifier until all operations in progress on the Client ID's session are completed or aborted.
</li>
<li>When DESTROY_CLIENTID is invoked, if there are sessions (both idle and non-idle), 
opens, locks, delegations, layouts, and/or wants (Section 18.49) associated 
with the client ID are removed. Pending operations will be completed or 
aborted before the sessions, opens, locks, delegations, layouts, and/or wants are deleted.
</li>
<li>The NFS server SHOULD support client ID trunking, and if it does and the 
EXCHGID4_FLAG_SUPP_FENCE_OPS capability is enabled, then a session ID created 
on one node of the storage cluster MUST be destroyable via DESTROY_SESSION. 
In addition, DESTROY_CLIENTID and an EXCHANGE_ID with a new verifier affects 
all sessions regardless what node the sessions were created on.
</li>
</ul><p>



</p>
<a name="anchor39"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Acknowledgements</h3>

<p>
Contributors to this document include: Sumanta Chatterjee, 
Steve Daniel, Mike Eisler, Jeff Kimmel,
Akshay Shah, Margaret Susairaj, and Lynne Thieme.

</p>
<a name="anchor40"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
IANA Considerations</h3>

<p>The IO_ADVISE4 flags are considered extendable. Values 32 through 63 are reserved for private use. All others
       are standards track.
</p>
<a name="anchor41"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Security Considerations</h3>

<p>None.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.eisler-nfsv4-pnfs-dedupe">[I-D.eisler-nfsv4-pnfs-dedupe]</a></td>
<td class="author-text">Eisler, M., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-eisler-nfsv4-pnfs-dedupe-00.txt">Storage De-Duplication Awareness in NFS</a>,&rdquo; draft-eisler-nfsv4-pnfs-dedupe-00 (work in progress), October&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-eisler-nfsv4-pnfs-dedupe-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.eisler-nfsv4-pnfs-metastripe">[I-D.eisler-nfsv4-pnfs-metastripe]</a></td>
<td class="author-text">Eisler, M., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-eisler-nfsv4-pnfs-metastripe-01.txt">Metadata Striping for pNFS</a>,&rdquo; draft-eisler-nfsv4-pnfs-metastripe-01 (work in progress), October&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-eisler-nfsv4-pnfs-metastripe-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.faibish-nfsv4-pnfs-access-permissions-check">[I-D.faibish-nfsv4-pnfs-access-permissions-check]</a></td>
<td class="author-text">Faibish, S., Black, D., Eisler, M., and J. Glasgow, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-faibish-nfsv4-pnfs-access-permissions-check-03.txt">pNFS Access Permissions Check</a>,&rdquo; draft-faibish-nfsv4-pnfs-access-permissions-check-03 (work in progress), July&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-faibish-nfsv4-pnfs-access-permissions-check-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-nfsv4-minorversion1">[I-D.ietf-nfsv4-minorversion1]</a></td>
<td class="author-text">Shepler, S., Eisler, M., and D. Noveck, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-nfsv4-minorversion1-29.txt">NFS Version 4 Minor Version 1</a>,&rdquo; draft-ietf-nfsv4-minorversion1-29 (work in progress), December&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-nfsv4-minorversion1-29.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.lentini-nfsv4-server-side-copy">[I-D.lentini-nfsv4-server-side-copy]</a></td>
<td class="author-text">Lentini, J., Eisler, M., Kenchammana, D., Madan, A., and R. Iyer, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-lentini-nfsv4-server-side-copy-05.txt">NFS Server-side Copy</a>,&rdquo; draft-lentini-nfsv4-server-side-copy-05 (work in progress), July&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-lentini-nfsv4-server-side-copy-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.myklebust-nfsv4-pnfs-backend">[I-D.myklebust-nfsv4-pnfs-backend]</a></td>
<td class="author-text">Myklebust, T., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-myklebust-nfsv4-pnfs-backend-00.txt">Network File System (NFS) version 4 pNFS back end protocol extensions</a>,&rdquo; draft-myklebust-nfsv4-pnfs-backend-00 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-myklebust-nfsv4-pnfs-backend-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.quigley-nfsv4-sec-label">[I-D.quigley-nfsv4-sec-label]</a></td>
<td class="author-text">Quigley, D. and J. Morris, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-quigley-nfsv4-sec-label-01.txt">MAC Security Label Support for NFSv4</a>,&rdquo; draft-quigley-nfsv4-sec-label-01 (work in progress), February&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-quigley-nfsv4-sec-label-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3530">[RFC3530]</a></td>
<td class="author-text">Shepler, S., Callaghan, B., Robinson, D., Thurlow, R., Beame, C., Eisler, M., and D. Noveck, &ldquo;<a href="http://tools.ietf.org/html/rfc3530">Network File System (NFS) version 4 Protocol</a>,&rdquo; RFC&nbsp;3530, April&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3530.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Michael Eisler (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NetApp</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">5765 Chase Point Circle</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Colorado Springs, CO  80919</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 719 599 9026</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mike@eisler.com">mike@eisler.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Margaret Susairaj (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Oracle</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">7806 Garden Bend</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sugar Land, TX  77479</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 408 431 7405</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Margaret.Susairaj@oracle.com">Margaret.Susairaj@oracle.com</a></td></tr>
</table>
</body></html>
