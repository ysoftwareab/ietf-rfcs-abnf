<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Traversal Using Relays around NAT (TURN) Extension for IPv6</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Traversal Using Relays around NAT (TURN) Extension for IPv6">
<meta name="keywords" content="STUN, TURN, IPv6">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">BEHAVE</td><td class="header">G. Camarillo</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">O. Novo</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Ericsson</td></tr>
<tr><td class="header">Expires: January 9, 2011</td><td class="header">S. Perreault, Ed.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Viag√©nie</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">July 8, 2010</td></tr>
</table></td></tr></table>
<h1><br />Traversal Using Relays around NAT (TURN) Extension for IPv6<br />draft-ietf-behave-turn-ipv6-11</h1>

<h3>Abstract</h3>

<p>
This document adds IPv6 support to Traversal Using Relays around NAT
(TURN). IPv6 support in TURN includes IPv4-to-IPv6, IPv6-to-IPv6, and
IPv6-to-IPv4 relaying. This document defines the
REQUESTED-ADDRESS-FAMILY attribute for TURN. The REQUESTED-ADDRESS-FAMILY
attribute allows a client to explicitly request the address type the
TURN server will allocate (e.g., an IPv4-only node may request the
TURN server to allocate an IPv6 address).

</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on January 9, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<a href="#anchor3">3.</a>&nbsp;
Overview of Operation<br />
<a href="#anchor4">4.</a>&nbsp;
Creating an Allocation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.1.</a>&nbsp;
Sending an Allocate Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-attribute">4.1.1.</a>&nbsp;
The REQUESTED-ADDRESS-FAMILY Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.2.</a>&nbsp;
Receiving an Allocate Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-440">4.2.1.</a>&nbsp;
Unsupported Address Family<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.3.</a>&nbsp;
Receiving an Allocate Error Response<br />
<a href="#anchor8">5.</a>&nbsp;
Refreshing an Allocation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">5.1.</a>&nbsp;
Sending a Refresh Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">5.2.</a>&nbsp;
Receiving a Refresh Request<br />
<a href="#anchor11">6.</a>&nbsp;
CreatePermission<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">6.1.</a>&nbsp;
Sending a CreatePermission Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">6.2.</a>&nbsp;
Receiving a CreatePermission request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-443">6.2.1.</a>&nbsp;
Peer Address Family Mismatch<br />
<a href="#anchor14">7.</a>&nbsp;
Channels<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">7.1.</a>&nbsp;
Sending a ChannelBind Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">7.2.</a>&nbsp;
Receiving a ChannelBind Request<br />
<a href="#anchor17">8.</a>&nbsp;
Packet Translations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">8.1.</a>&nbsp;
IPv4-to-IPv6 Translations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">8.2.</a>&nbsp;
IPv6-to-IPv6 Translations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">8.3.</a>&nbsp;
IPv6-to-IPv4 Translations<br />
<a href="#anchor21">9.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">9.1.</a>&nbsp;
Tunnel Amplification Attack<br />
<a href="#anchor23">10.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">10.1.</a>&nbsp;
New STUN Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">10.2.</a>&nbsp;
New STUN Error Codes<br />
<a href="#anchor26">11.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">12.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">12.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">12.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
Traversal Using Relays around NAT (TURN) <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a> is a protocol that allows for an
element behind a NAT to receive incoming data over UDP or TCP. It is
most useful for elements behind NATs without Endpoint-Independent Mapping <a class='info' href='#RFC4787'>[RFC4787]<span> (</span><span class='info'>Audet, F. and C. Jennings, &ldquo;Network Address Translation (NAT) Behavioral Requirements for Unicast UDP,&rdquo; January&nbsp;2007.</span><span>)</span></a> that wish to be on the receiving end of a connection to a
single peer.

</p>
<p>
The base specification of TURN <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>
only defines IPv4-to-IPv4 relaying. This document adds IPv6 support to
TURN, which includes IPv4-to-IPv6, IPv6-to-IPv6, and IPv6-to-IPv4
relaying. This document defines the REQUESTED-ADDRESS-FAMILY attribute,
which is an extension to TURN that allows a client to explicitly
request the address type the TURN server will allocate (e.g., an
IPv4-only node may request the TURN server to allocate an IPv6
address). This document also defines and registers new error
response codes.

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Overview of Operation</h3>

<p>
When a user wishes a TURN server to allocate an address of a specific
type, it sends an Allocate Request to the TURN server with a
REQUESTED-ADDRESS-FAMILY attribute. TURN can run over UDP and TCP, and it
allows for a client to request address/port pairs for receiving both
UDP and TCP.

</p>
<p>
After the request has been successfully authenticated,
the TURN server allocates a transport address of the type indicated in
the REQUESTED-ADDRESS-FAMILY attribute. This address is called the
relayed transport address.

</p>
<p>
The TURN server returns the relayed transport address in the response to the
Allocate Request. This response contains a XOR-RELAYED-ADDRESS
attribute indicating the IP address and port that the server allocated
for the client.

</p>
<p>
TURN servers allocate a single relayed transport address per
allocation request. Therefore, Allocate Requests cannot carry more
than one REQUESTED-ADDRESS-FAMILY attribute. Consequently, a client that
wishes to allocate more than one relayed transport address at a TURN server (e.g., an
IPv4 and an IPv6 address) needs to perform several allocation requests
(one allocation request per relayed transport address).

</p>
<p>
A TURN server that supports a set of address families is assumed to be
able to relay packets between them. If a server does not support the
address family requested by a client, the server returns a 440
(Address Family not Supported) error response.

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Creating an Allocation</h3>

<p>
The behavior specified here affects the processing defined in Section
6 of <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>.

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Sending an Allocate Request</h3>

<p>
A client that wishes to obtain a relayed transport address of a specific
address type includes a REQUESTED-ADDRESS-FAMILY attribute, which is
defined in <a class='info' href='#sec-attribute'>Section&nbsp;4.1.1<span> (</span><span class='info'>The REQUESTED-ADDRESS-FAMILY Attribute</span><span>)</span></a>, in the Allocate Request
that it sends to the TURN server. Clients MUST NOT include more than one
REQUESTED-ADDRESS-FAMILY attribute in an Allocate Request. The
mechanisms to formulate an Allocate Request are described in Section
6.1 of <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>.

</p>
<p>
Clients MUST NOT include a REQUESTED-ADDRESS-FAMILY attribute in an
Allocate request that contains a RESERVATION-TOKEN attribute.

</p>
<a name="sec-attribute"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1"></a><h3>4.1.1.&nbsp;
The REQUESTED-ADDRESS-FAMILY Attribute</h3>

<p>
The REQUESTED-ADDRESS-FAMILY attribute is used by clients to request the
allocation of a specific address type from a server. The following is
the format of the REQUESTED-ADDRESS-FAMILY attribute. Note that
TURN attributes are TLV (Type-Length-Value) encoded, with a 16 bit
type, a 16 bit length, and a variable-length value.

</p><br /><hr class="insert" />
<a name="fig-arch"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>


¬†¬†0 ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†1 ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†2 ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†3
¬†¬†0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
¬†+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
¬†| ¬†¬†¬†¬†¬†¬†¬†¬†Type ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†| ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†Length ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|
¬†+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
¬†| ¬†¬†¬†¬†Family ¬†¬†¬†| ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†Reserved ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†|
¬†+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Format of REQUESTED-ADDRESS-FAMILY Attribute&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
Type: the type of the REQUESTED-ADDRESS-FAMILY attribute is 0x0017. ¬†As
specified in <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a>, attributes
with values between 0x0000 and 0x7FFF are comprehension-required, 
which means that the client or server cannot successfully process the
message unless it understands the attribute.

</p>
<p>
Length: this 16-bit field contains the length of the attribute in
bytes. The length of this attribute is 4 bytes.

</p>
<p>
    Family: there are two values defined for this field and specified in <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a>, Section 15.1: 0x01 for IPv4 addresses and 0x02 for IPv6 addresses.

</p>
<p>
Reserved: at this point, the 24 bits in the reserved field MUST be
set to zero by the client and MUST be ignored by the server.

</p>
<p>
The REQUEST-ADDRESS-TYPE attribute MAY only be present in Allocate
Requests.

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Receiving an Allocate Request</h3>

<p>
Once a server has verified that the request is authenticated and has not been tampered with,
the TURN server processes the Allocate request. If it contains both a
RESERVATION-TOKEN and a REQUESTED-ADDRESS-FAMILY, the server replies with a 400
(Bad Request) Allocate Error Response. Following the rules in <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a>, if the server does not understand the
REQUESTED-ADDRESS-FAMILY attribute, it generates an Allocate Error Response,
which includes an ERROR-CODE attribute with response code 420 (Unknown
Attribute). This response will contain an UNKNOWN-ATTRIBUTE attribute listing
the unknown REQUESTED-ADDRESS-FAMILY attribute.

</p>
<p>
If the server can successfully process the request, it allocates a
transport address for the TURN client, called the relayed transport
address, and returns it in the response to the Allocate Request.

</p>
<p>
As specified in <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>, the Allocate
Response contains the same transaction ID contained in the Allocate
Request and the XOR-RELAYED-ADDRESS attribute is set to the relayed transport
address.

</p>
<p>
The XOR-RELAYED-ADDRESS attribute indicates the allocated IP address
and port. ¬†It is encoded in the same way as the XOR-MAPPED-ADDRESS
<a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a>.

</p>
<p>
If the REQUESTED-ADDRESS-FAMILY attribute is absent, the server MUST
allocate an IPv4 relayed transport address for the TURN client. If allocation of IPv4
addresses is disabled by local policy, the server returns a a 440 (Address
Family not Supported) Allocate Error Response.

</p>
<p>
If the server does not support the address family requested by the client, 
it MUST generate an Allocate Error Response, and it MUST include an 
ERROR-CODE attribute with the 440 (Address Family not Supported)
response code, which is defined in <a class='info' href='#sec-440'>Section&nbsp;4.2.1<span> (</span><span class='info'>Unsupported Address Family</span><span>)</span></a>.

</p>
<a name="sec-440"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Unsupported Address Family</h3>

<p>
This document defines the following new error response code:

</p>
<p>
</p>
<blockquote class="text"><dl>
<dt>440 (Address Family not Supported):</dt>
<dd> The server did not
support the address family requested by the client. 

</dd>
</dl></blockquote><p>

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Receiving an Allocate Error Response</h3>

<p>
If the client receives an Allocate error response with the 440
(Unsupported Address Family) error code, the client MUST NOT retry
its request.

</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Refreshing an Allocation</h3>

<p>
The behavior specified here affects the processing defined in Section
7 of <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>.

</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Sending a Refresh Request</h3>

<p>
To perform an allocation refresh, the client generates a Refresh Request
as described in Section 7.1 of <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>.
The client MUST NOT include any REQUESTED-ADDRESS-FAMILY attribute in
its Refresh Request.

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Receiving a Refresh Request</h3>

<p>
If a server receives a Refresh Request with a REQUESTED-ADDRESS-FAMILY
attribute, and the attribute's value doesn't match the address family of the
allocation, the server MUST reply with a 443 (Peer Address Family Mismatch)
Refresh Error Response.

</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
CreatePermission</h3>

<p>
The behavior specified here affects the processing defined in Section
9 of <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>.

</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Sending a CreatePermission Request</h3>

<p>
The client MUST only include XOR-PEER-ADDRESS attributes with
addresses of the same address family as the relayed transport address
for the allocation.

</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Receiving a CreatePermission request</h3>

<p>
If an XOR-PEER-ADDRESS attribute contains an address of an address
family different than the relayed transport address for the
allocation, the server MUST generate an error response with the
443 (Peer Address Family Mismatch) response code, which is defined in
<a class='info' href='#sec-443'>Section&nbsp;6.2.1<span> (</span><span class='info'>Peer Address Family Mismatch</span><span>)</span></a>.

</p>
<a name="sec-443"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.1"></a><h3>6.2.1.&nbsp;
Peer Address Family Mismatch</h3>

<p>
This document defines the following new error response code:

</p>
<p>
</p>
<blockquote class="text"><dl>
<dt>443 (Peer Address Family Mismatch):</dt>
<dd> A peer address was
of a different address family than the relayed transport address of
the allocation.

</dd>
</dl></blockquote><p>

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Channels</h3>

<p>
The behavior specified here affects the processing defined in Section
11 of <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>.

</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Sending a ChannelBind Request</h3>

<p>
The client MUST only include a XOR-PEER-ADDRESS attribute with
an address of the same address family as the relayed transport address
for the allocation.

</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Receiving a ChannelBind Request</h3>

<p>
If the XOR-PEER-ADDRESS attribute contains an address of an address
family different than the relayed transport address for the
allocation, the server MUST generate an error response with the
443 (Peer Address Family Mismatch) response code, which is defined in
<a class='info' href='#sec-443'>Section&nbsp;6.2.1<span> (</span><span class='info'>Peer Address Family Mismatch</span><span>)</span></a>.

</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Packet Translations</h3>

<p>
The TURN specification <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a> describes
how TURN relays should relay traffic consisting of IPv4 packets (i.e.,
IPv4-to-IPv4 translations). The relay translates the IP addresses and
port numbers of the packets based on the allocation's state data. How
to translate other header fields is also specified in <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>. This document addresses IPv4-to-IPv6,
IPv6-to-IPv4, and IPv6-to-IPv6 translations.

</p>
<p>
TURN relays performing any translation MUST translate the IP addresses
and port numbers of the packets based on the allocation's state
information as specified in <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>. The following sections specify how to
translate other header fields.

</p>
<p>
As discussed in Section 2.6 of <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>,
translations in TURN are designed so that a TURN server can be
implemented as an application that runs in userland under commonly
available operating systems and that does not require special
privileges. The translations specified in the following sections
follow this principle.

</p>
<p>The descriptions below have two parts: a preferred behavior and an alternate
  behavior.  The server SHOULD implement the preferred behavior.  Otherwise, the
  server MUST implement the alternate behavior and MUST NOT do anything else.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
IPv4-to-IPv6 Translations</h3>

<p>Traffic Class
</p>
<p>
    </p>
<blockquote class="text">
<p>
</p>
<p>Preferred behavior: as specified in Section 3 of <a class='info' href='#I-D.ietf-behave-v6v4-xlate'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate]<span> (</span><span class='info'>Li, X., Bao, C., and F. Baker, &ldquo;IP/ICMP Translation Algorithm,&rdquo; May&nbsp;2010.</span><span>)</span></a>.
</p>
<p>
</p>
<p>Alternate behavior: the relay sets the Traffic Class to the default
        value for outgoing packets.
</p>
</blockquote><p>
  
</p>
<p>
Flow Label

</p>
<p>
</p>
<blockquote class="text">
<p>
</p>
<p> 
Preferred behavior: The relay sets the Flow label to 0. The relay can
choose to set the Flow label to a different value if it supports <a class='info' href='#RFC3697'>[RFC3697]<span> (</span><span class='info'>Rajahalme, J., Conta, A., Carpenter, B., and S. Deering, &ldquo;IPv6 Flow Label Specification,&rdquo; March&nbsp;2004.</span><span>)</span></a>.

</p>
<p>
</p>
<p>
Alternate behavior: the relay sets the Flow label to the default
value for outgoing packets.

</p>
</blockquote><p>

</p>
<p>
Hop Limit

</p>
<p>
</p>
<blockquote class="text">
<p>
</p>
<p>
Preferred behavior: as specified in Section 3 of <a class='info' href='#I-D.ietf-behave-v6v4-xlate'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate]<span> (</span><span class='info'>Li, X., Bao, C., and F. Baker, &ldquo;IP/ICMP Translation Algorithm,&rdquo; May&nbsp;2010.</span><span>)</span></a>.

</p>
<p>
</p>
<p>
Alternate behavior: the relay sets the Hop Limit to the default
value for outgoing packets.

</p>
</blockquote><p>

</p>
<p>
Fragmentation

</p>
<p>
</p>
<blockquote class="text">
<p>
</p>
<p>
Preferred behavior: as specified in Section 3 of <a class='info' href='#I-D.ietf-behave-v6v4-xlate'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate]<span> (</span><span class='info'>Li, X., Bao, C., and F. Baker, &ldquo;IP/ICMP Translation Algorithm,&rdquo; May&nbsp;2010.</span><span>)</span></a>.

</p>
<p>
</p>
<p>
Alternate behavior: the relay assembles incoming fragments. The
relay follows its default behavior to send outgoing packets.

</p>
<p>
</p>
<p>For both preferred and alternate behavior, the DONT-FRAGMENT attribute (<a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a>, Section 14.8) MUST
    be ignored by the server.
</p>
</blockquote><p>

</p>
<p>
Extension Headers

</p>
<p>
</p>
<blockquote class="text">
<p>
</p>
<p>
Preferred behavior: the relay sends outgoing packet without any IPv6
extension headers, with the exception of the Fragmentation header as
described above.

</p>
<p>
</p>
<p>
Alternate behavior: same as preferred.

</p>
</blockquote><p>

</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
IPv6-to-IPv6 Translations</h3>

<p>
Flow Label

</p>
<p>
The relay should consider that it is handling two different IPv6
flows. Therefore, the Flow label <a class='info' href='#RFC3697'>[RFC3697]<span> (</span><span class='info'>Rajahalme, J., Conta, A., Carpenter, B., and S. Deering, &ldquo;IPv6 Flow Label Specification,&rdquo; March&nbsp;2004.</span><span>)</span></a> SHOULD NOT
be copied as part of the translation.

</p>
<p>
</p>
<blockquote class="text">
<p> 
Preferred behavior: The relay sets the Flow label to 0. The relay can
choose to set the Flow label to a different value if it supports <a class='info' href='#RFC3697'>[RFC3697]<span> (</span><span class='info'>Rajahalme, J., Conta, A., Carpenter, B., and S. Deering, &ldquo;IPv6 Flow Label Specification,&rdquo; March&nbsp;2004.</span><span>)</span></a>.

</p>
<p>
</p>
<p>
Alternate behavior: the relay sets the Flow label to the default
value for outgoing packets.

</p>
</blockquote><p>

</p>
<p>
Hop Limit

</p>
<p>
</p>
<blockquote class="text">
<p>
</p>
<p>
Preferred behavior: the relay acts as a regular router with respect to
decrementing the Hop Limit and generating an ICMPv6 error if it
reaches zero.

</p>
<p>
</p>
<p>
Alternate behavior: the relay sets the Hop Limit to the default
value for outgoing packets.

</p>
</blockquote><p>

</p>
<p>
Fragmentation

</p>
<p>
</p>
<blockquote class="text">
<p>
</p>
<p>
Preferred behavior: If the incoming packet did not include a Fragment
header and the outgoing packet size does not exceed the outgoing
link's MTU, the relay sends the outgoing packet without a Fragment
header.

</p>
<p>
</p>
<p>
If the incoming packet did not include a Fragment header and the
outgoing packet size exceeds the outgoing link's MTU, the relay drops
the outgoing packet and send an ICMP message of type 2 code 0 ("Packet
too big") to the sender of the incoming packet. ¬†If the packet is
being sent to the peer, the relay reduces the MTU reported in the ICMP
message by 48 bytes to allow room for the overhead of a Data
indication.

</p>
<p>
</p>
<p>
If the incoming packet included a Fragment header and the outgoing
packet size (with a Fragment header included) does not exceed the
outgoing link's MTU, the relay sends the outgoing packet with a
Fragment header. The relay sets the fields of the Fragment header as
appropriate for a packet originating from the server.

</p>
<p>
</p>
<p>
If the incoming packet included a Fragment header and the outgoing
packet size exceeds the outgoing link's MTU, the relay MUST fragment
the outgoing packet into fragments of no more than 1280 bytes. The
relay sets the fields of the Fragment header as appropriate for a
packet originating from the server.

</p>
<p>
</p>
<p>
Alternate behavior: the relay assembles incoming fragments. The
relay follows its default behavior to send outgoing packets.

</p>
<p>
</p>
<p>For both preferred and alternate behavior, the DONT-FRAGMENT attribute MUST
    be ignored by the server.
</p>
</blockquote><p>

</p>
<p>
Extension Headers

</p>
<p>
</p>
<blockquote class="text">
<p>
</p>
<p>
Preferred behavior: the relay sends outgoing packet without any IPv6
extension headers, with the exception of the Fragmentation header as
described above.

</p>
<p>
</p>
<p>
Alternate behavior: same as preferred.

</p>
</blockquote><p>

</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
IPv6-to-IPv4 Translations</h3>

<p>
Type of Service and Precedence

</p>
<p>
</p>
<blockquote class="text">
<p>
</p>
<p> 
Preferred behavior: as specified in Section 4 of <a class='info' href='#I-D.ietf-behave-v6v4-xlate'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate]<span> (</span><span class='info'>Li, X., Bao, C., and F. Baker, &ldquo;IP/ICMP Translation Algorithm,&rdquo; May&nbsp;2010.</span><span>)</span></a>.

</p>
<p>
</p>
<p>
Alternate behavior: the relay sets the Type of Service and
Precedence to the default value for outgoing packets.

</p>
</blockquote><p>

</p>
<p>
Time to Live

</p>
<p>
</p>
<blockquote class="text">
<p>
</p>
<p>
Preferred behavior: as specified in Section 4 of <a class='info' href='#I-D.ietf-behave-v6v4-xlate'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate]<span> (</span><span class='info'>Li, X., Bao, C., and F. Baker, &ldquo;IP/ICMP Translation Algorithm,&rdquo; May&nbsp;2010.</span><span>)</span></a>.

</p>
<p>
</p>
<p>
Alternate behavior: the relay sets the Time to Live to the default
value for outgoing packets.

</p>
</blockquote><p>

</p>
<p>
Fragmentation

</p>
<p>
</p>
<blockquote class="text">
<p>
</p>
<p>
Preferred behavior: as specified in Section 4 of <a class='info' href='#I-D.ietf-behave-v6v4-xlate'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate]<span> (</span><span class='info'>Li, X., Bao, C., and F. Baker, &ldquo;IP/ICMP Translation Algorithm,&rdquo; May&nbsp;2010.</span><span>)</span></a>. ¬†Additionally, when the outgoing packet's size
exceeds the outgoing link's MTU, the relay needs to generate an ICMP
error (ICMPv6 Packet Too Big) reporting the MTU size. If the packet is
being sent to the peer, the relay SHOULD reduce the MTU reported in
the ICMP message by 48 bytes to allow room for the overhead of a Data
indication.

</p>
<p>
</p>
<p>
Alternate behavior: the relay assembles incoming fragments. The
relay follows its default behavior to send outgoing packets.

</p>
<p>
</p>
<p>For both preferred and alternate behavior, the DONT-FRAGMENT attribute MUST
    be ignored by the server.
</p>
</blockquote><p>

</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Security Considerations</h3>

<p>Translation between IPv4 and IPv6 creates a new way for clients to obtain
    IPv4 or IPv6 access which they did not have before. For example, an
    IPv4-only client having access to a TURN server implementing this
    specification is now able to access the IPv6 internet. This needs to be
    considered when establishing security and monitoring policies.
</p>
<p>The loop attack described in <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a> Section
    17.1.7 may be more easily done in cases where address spoofing is easier to
    accomplish over IPv6. Mitigation of this attack over IPv6 is the same as for
    IPv4.
</p>
<p>
All the security considerations applicable to STUN <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a> and
TURN <a class='info' href='#I-D.ietf-behave-turn'>[I&#8209;D.ietf&#8209;behave&#8209;turn]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN),&rdquo; July&nbsp;2009.</span><span>)</span></a> are applicable to this document as well.

</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
Tunnel Amplification Attack</h3>

<p>An attacker might attempt to cause data packets to loop numerous times
    between a TURN server and a tunnel between IPv4 and IPv6. The attack goes
    as follows.
</p>
<p>Suppose an attacker knows that a tunnel endpoint will forward encapsulated
    packets from a given IPv6 address (this doesn't necessarily need to be the
    tunnel endpoint's address).  Suppose he then spoofs two packets from this
    address:
    </p>
<ol class="text">
<li>An allocate request asking for a v4 address, and
</li>
<li>A ChannelBind request establishing a channel to the IPv4 address of the
        tunnel endpoint
</li>
</ol><p>
  
</p>
<p>Then he has set up an amplification attack:
    </p>
<ul class="text">
<li>The TURN relay will re-encapsulate IPv6 UDP data in v4 and send it to
        the tunnel endpoint
</li>
<li>The tunnel endpoint will decapsulate packets from the v4 interface and
        send them to v6
</li>
</ul><p>
  
</p>
<p>So if the attacker sends a packet of the following form...
    </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  IPv6: src=2001:DB9::1 dst=2001:DB8::2
  UDP:  &lt;ports&gt;
  TURN: &lt;channel id&gt;
  IPv6: src=2001:DB9::1 dst=2001:DB8::2
  UDP:  &lt;ports&gt;
  TURN: &lt;channel id&gt;
  IPv6: src=2001:DB9::1 dst=2001:DB8::2
  UDP:  &lt;ports&gt;
  TURN: &lt;channel id&gt;
  ...
</pre></div><p>

    Then the TURN relay and the tunnel endpoint will send it back and forth
    until the last TURN header is consumed, at which point the TURN relay will
    send an empty packet, which the tunnel endpoint will drop.
</p>
<p>The amplification potential here is limited by the MTU, so it's not huge:
    IPv6+UDP+TURN takes 334 bytes, so you could get a four-to-one amplification
    out of a 1500-byte packet.  But the attacker could still increase traffic
    volume by sending multiple packets or by establishing multiple channels
    spoofed from different addresses behind the same tunnel endpoint.
</p>
<p>The attack is mitigated as follows. It is RECOMMENDED that TURN relays not
    accept allocation or channel binding requests from addresses known to be
    tunneled, and that they not forward data to such addresses.  In particular,
    a TURN relay MUST NOT accept Teredo or 6to4 addresses in these requests.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
IANA Considerations</h3>

<p>
The IANA is requested to register the following values under the STUN
Attributes registry and under the STUN Error Codes registry.

</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1"></a><h3>10.1.&nbsp;
New STUN Attribute</h3>

<p>
    </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  0x0017: REQUESTED-ADDRESS-FAMILY
</pre></div><p>


</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2"></a><h3>10.2.&nbsp;
New STUN Error Codes</h3>

<p>
    </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  440 ¬†Address Family not Supported
  443  Peer Address Family Mismatch
</pre></div><p>


</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Acknowledgements</h3>

<p>
The authors would like to thank Alfred E. Heggestad, Dan Wing, Magnus
Westerlund, Marc Petit-Huguenin, Philip Matthews, and R√©mi Denis-Courmont for
their feedback on this document.

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-turn">[I-D.ietf-behave-turn]</a></td>
<td class="author-text">Rosenberg, J., Mahy, R., and P. Matthews, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-turn-16.txt">Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN)</a>,&rdquo; draft-ietf-behave-turn-16 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-turn-16.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-v6v4-xlate">[I-D.ietf-behave-v6v4-xlate]</a></td>
<td class="author-text">Li, X., Bao, C., and F. Baker, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-xlate-20.txt">IP/ICMP Translation Algorithm</a>,&rdquo; draft-ietf-behave-v6v4-xlate-20 (work in progress), May&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-xlate-20.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3697">[RFC3697]</a></td>
<td class="author-text">Rajahalme, J., Conta, A., Carpenter, B., and S. Deering, &ldquo;<a href="http://tools.ietf.org/html/rfc3697">IPv6 Flow Label Specification</a>,&rdquo; RFC&nbsp;3697, March&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3697.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5389">[RFC5389]</a></td>
<td class="author-text">Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;<a href="http://tools.ietf.org/html/rfc5389">Session Traversal Utilities for NAT (STUN)</a>,&rdquo; RFC&nbsp;5389, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5389.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC4787">[RFC4787]</a></td>
<td class="author-text">Audet, F. and C. Jennings, &ldquo;<a href="http://tools.ietf.org/html/rfc4787">Network Address Translation (NAT) Behavioral Requirements for Unicast UDP</a>,&rdquo; BCP&nbsp;127, RFC&nbsp;4787, January&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4787.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gonzalo Camarillo</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ericsson</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hirsalantie 11</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jorvas  02420</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Gonzalo.Camarillo@ericsson.com">Gonzalo.Camarillo@ericsson.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Oscar Novo</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ericsson</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hirsalantie 11</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jorvas  02420</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Oscar.Novo@ericsson.com">Oscar.Novo@ericsson.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Simon Perreault (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Viag√©nie</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">2600 boul. Laurier, suite 625</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Qu√©bec, QC  G1V 4W1</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Canada</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 418 656 9254</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:simon.perreault@viagenie.ca">simon.perreault@viagenie.ca</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.viagenie.ca">http://www.viagenie.ca</a></td></tr>
</table>
</body></html>
