<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Lightweight Certificate Management Protocol (CMP) Profile</title>
<meta content="Hendrik Brockhaus" name="author">
<meta content="Steffen Fries" name="author">
<meta content="David von Oheimb" name="author">
<meta content="
       The goal of this document is to facilitate interoperability and automation by profiling the Certificate Management Protocol (CMP) version 2, the related Certificate Request Message Format (CRMF) version 2, and the HTTP Transfer for the Certificate Management Protocol. It specifies a subset of CMP and CRMF focusing on typical use cases relevant for managing certificates of devices in many industrial and IoT scenarios. To limit the overhead of certificate management for more constrained devices only the most crucial types of operations are specified as mandatory. To foster interoperability in more complex scenarios, other types of operations are specified as recommended or optional. 
    " name="description">
<meta content="xml2rfc 3.5.0" name="generator">
<meta content="CMP" name="keyword">
<meta content="draft-ietf-lamps-lightweight-cmp-profile-05" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.5.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.3
    google-i18n-address 2.4.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.2
    pycountry 20.7.3
    pyflakes 2.2.0
    PyYAML 5.4.1
    requests 2.25.1
    setuptools 53.0.0
    six 1.15.0
-->
<link href="/tmp/draft-ietf-lamps-lightweight-cmp-profile-05-rz17a1ba.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Lightweight CMP Profile</td>
<td class="right">February 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Brockhaus, et al.</td>
<td class="center">Expires 26 August 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">LAMPS Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-lamps-lightweight-cmp-profile-05</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-02-22" class="published">22 February 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-08-26">26 August 2021</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">H. Brockhaus, <span class="editor">Ed.</span>
</div>
<div class="org">Siemens</div>
</div>
<div class="author">
      <div class="author-name">S. Fries</div>
<div class="org">Siemens</div>
</div>
<div class="author">
      <div class="author-name">D. von Oheimb</div>
<div class="org">Siemens</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Lightweight Certificate Management Protocol (CMP) Profile</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The goal of this document is to facilitate interoperability and automation by profiling the Certificate Management Protocol (CMP) version 2, the related Certificate Request Message Format (CRMF) version 2, and the HTTP Transfer for the Certificate Management Protocol. It specifies a subset of CMP and CRMF focusing on typical use cases relevant for managing certificates of devices in many industrial and IoT scenarios. To limit the overhead of certificate management for more constrained devices only the most crucial types of operations are specified as mandatory. To foster interoperability in more complex scenarios, other types of operations are specified as recommended or optional.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 26 August 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-motivation-for-profiling-cm" class="xref">Motivation for profiling CMP</a><a href="#section-toc.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-motivation-for-a-lightweigh" class="xref">Motivation for a lightweight profile for CMP</a><a href="#section-toc.1-1.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="xref">1.3</a>.  <a href="#name-existing-cmp-profiles" class="xref">Existing CMP profiles</a><a href="#section-toc.1-1.1.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.1.2.4">
                <p id="section-toc.1-1.1.2.4.1"><a href="#section-1.4" class="xref">1.4</a>.  <a href="#name-compatibility-with-existing" class="xref">Compatibility with existing CMP profiles</a><a href="#section-toc.1-1.1.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.1.2.5">
                <p id="section-toc.1-1.1.2.5.1"><a href="#section-1.5" class="xref">1.5</a>.  <a href="#name-scope-of-this-document" class="xref">Scope of this document</a><a href="#section-toc.1-1.1.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.1.2.6">
                <p id="section-toc.1-1.1.2.6.1"><a href="#section-1.6" class="xref">1.6</a>.  <a href="#name-structure-of-this-document" class="xref">Structure of this document</a><a href="#section-toc.1-1.1.2.6.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.1.2.7">
                <p id="section-toc.1-1.1.2.7.1"><a href="#section-1.7" class="xref">1.7</a>.  <a href="#name-convention-and-terminology" class="xref">Convention and Terminology</a><a href="#section-toc.1-1.1.2.7.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-architecture-and-use-cases" class="xref">Architecture and use cases</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-solution-architecture" class="xref">Solution architecture</a><a href="#section-toc.1-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-basic-generic-cmp-message-c" class="xref">Basic generic CMP message content</a><a href="#section-toc.1-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-supported-pki-management-op" class="xref">Supported PKI management operations</a><a href="#section-toc.1-1.2.2.3.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.2.2.3.2.1">
                    <p id="section-toc.1-1.2.2.3.2.1.1"><a href="#section-2.3.1" class="xref">2.3.1</a>.  <a href="#name-mandatory-pki-management-op" class="xref">Mandatory PKI management operations</a><a href="#section-toc.1-1.2.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.2.2.3.2.2">
                    <p id="section-toc.1-1.2.2.3.2.2.1"><a href="#section-2.3.2" class="xref">2.3.2</a>.  <a href="#name-recommended-pki-management-" class="xref">Recommended PKI management operations</a><a href="#section-toc.1-1.2.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.2.2.3.2.3">
                    <p id="section-toc.1-1.2.2.3.2.3.1"><a href="#section-2.3.3" class="xref">2.3.3</a>.  <a href="#name-optional-pki-management-ope" class="xref">Optional PKI management operations</a><a href="#section-toc.1-1.2.2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="xref">2.4</a>.  <a href="#name-cmp-message-transport" class="xref">CMP message transport</a><a href="#section-toc.1-1.2.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-generic-parts-of-the-pki-me" class="xref">Generic parts of the PKI message</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-general-description-of-the-" class="xref">General description of the CMP message header</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-general-description-of-the-c" class="xref">General description of the CMP message protection</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-general-description-of-cmp-" class="xref">General description of CMP message extraCerts</a><a href="#section-toc.1-1.3.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-end-entity-pki-management-o" class="xref">End Entity PKI management operations</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-requesting-a-new-certificat" class="xref">Requesting a new certificate from a PKI</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-requesting-a-certificate-fr" class="xref">Requesting a certificate from a new PKI with signature protection</a><a href="#section-toc.1-1.4.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="xref">4.1.2</a>.  <a href="#name-requesting-a-certificate-fro" class="xref">Requesting a certificate from a trusted PKI with signature protection</a><a href="#section-toc.1-1.4.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.1.2.3">
                    <p id="section-toc.1-1.4.2.1.2.3.1"><a href="#section-4.1.3" class="xref">4.1.3</a>.  <a href="#name-updating-an-existing-certif" class="xref">Updating an existing certificate with signature protection</a><a href="#section-toc.1-1.4.2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.1.2.4">
                    <p id="section-toc.1-1.4.2.1.2.4.1"><a href="#section-4.1.4" class="xref">4.1.4</a>.  <a href="#name-requesting-a-certificate-from" class="xref">Requesting a certificate from a PKI with MAC protection</a><a href="#section-toc.1-1.4.2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.1.2.5">
                    <p id="section-toc.1-1.4.2.1.2.5.1"><a href="#section-4.1.5" class="xref">4.1.5</a>.  <a href="#name-requesting-a-certificate-from-" class="xref">Requesting a certificate from a legacy PKI using PKCS#10 request</a><a href="#section-toc.1-1.4.2.1.2.5.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.1.2.6">
                    <p id="section-toc.1-1.4.2.1.2.6.1"><a href="#section-4.1.6" class="xref">4.1.6</a>.  <a href="#name-generateing-the-key-pair-ce" class="xref">Generateing the key pair centrally at the PKI management entity</a><a href="#section-toc.1-1.4.2.1.2.6.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.4.2.1.2.6.2.1">
                        <p id="section-toc.1-1.4.2.1.2.6.2.1.1"><a href="#section-4.1.6.1" class="xref">4.1.6.1</a>.  <a href="#name-using-key-agreement-key-man" class="xref">Using key agreement key management technique</a><a href="#section-toc.1-1.4.2.1.2.6.2.1.1" class="pilcrow">¶</a></p>
</li>
                      <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.1.2.6.2.2">
                        <p id="section-toc.1-1.4.2.1.2.6.2.2.1"><a href="#section-4.1.6.2" class="xref">4.1.6.2</a>.  <a href="#name-using-key-transport-key-man" class="xref">Using key transport key management technique</a><a href="#section-toc.1-1.4.2.1.2.6.2.2.1" class="pilcrow">¶</a></p>
</li>
                      <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.1.2.6.2.3">
                        <p id="section-toc.1-1.4.2.1.2.6.2.3.1"><a href="#section-4.1.6.3" class="xref">4.1.6.3</a>.  <a href="#name-using-password-based-key-ma" class="xref">Using password-based key management technique</a><a href="#section-toc.1-1.4.2.1.2.6.2.3.1" class="pilcrow">¶</a></p>
</li>
                    </ul>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.1.2.7">
                    <p id="section-toc.1-1.4.2.1.2.7.1"><a href="#section-4.1.7" class="xref">4.1.7</a>.  <a href="#name-delayed-enrollment" class="xref">Delayed enrollment</a><a href="#section-toc.1-1.4.2.1.2.7.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-revoking-a-certificate" class="xref">Revoking a certificate</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-error-reporting" class="xref">Error reporting</a><a href="#section-toc.1-1.4.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-support-messages" class="xref">Support messages</a><a href="#section-toc.1-1.4.2.4.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.4.2.4.2.1">
                    <p id="section-toc.1-1.4.2.4.2.1.1"><a href="#section-4.4.1" class="xref">4.4.1</a>.  <a href="#name-get-ca-certificates" class="xref">Get CA certificates</a><a href="#section-toc.1-1.4.2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.4.2.2">
                    <p id="section-toc.1-1.4.2.4.2.2.1"><a href="#section-4.4.2" class="xref">4.4.2</a>.  <a href="#name-get-root-ca-certificate-upd" class="xref">Get root CA certificate update</a><a href="#section-toc.1-1.4.2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.4.2.3">
                    <p id="section-toc.1-1.4.2.4.2.3.1"><a href="#section-4.4.3" class="xref">4.4.3</a>.  <a href="#name-get-certificate-request-tem" class="xref">Get certificate request template</a><a href="#section-toc.1-1.4.2.4.2.3.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-lra-and-ra-pki-management-o" class="xref">LRA and RA PKI management operations</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-forwarding-messages" class="xref">Forwarding messages</a><a href="#section-toc.1-1.5.2.1.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="xref">5.1.1</a>.  <a href="#name-not-changing-protection" class="xref">Not changing protection</a><a href="#section-toc.1-1.5.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="xref">5.1.2</a>.  <a href="#name-replacing-protection" class="xref">Replacing protection</a><a href="#section-toc.1-1.5.2.1.2.2.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.5.2.1.2.2.2.1">
                        <p id="section-toc.1-1.5.2.1.2.2.2.1.1"><a href="#section-5.1.2.1" class="xref">5.1.2.1</a>.  <a href="#name-keeping-proof-of-possession" class="xref">Keeping proof-of-possession</a><a href="#section-toc.1-1.5.2.1.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                      <li class="ulEmpty toc compact" id="section-toc.1-1.5.2.1.2.2.2.2">
                        <p id="section-toc.1-1.5.2.1.2.2.2.2.1"><a href="#section-5.1.2.2" class="xref">5.1.2.2</a>.  <a href="#name-breaking-proof-of-possessio" class="xref">Breaking proof-of-possession</a><a href="#section-toc.1-1.5.2.1.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                    </ul>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.5.2.1.2.3">
                    <p id="section-toc.1-1.5.2.1.2.3.1"><a href="#section-5.1.3" class="xref">5.1.3</a>.  <a href="#name-adding-protection" class="xref">Adding Protection</a><a href="#section-toc.1-1.5.2.1.2.3.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.5.2.1.2.3.2.1">
                        <p id="section-toc.1-1.5.2.1.2.3.2.1.1"><a href="#section-5.1.3.1" class="xref">5.1.3.1</a>.  <a href="#name-handling-a-single-pki-manag" class="xref">Handling a single PKI management message</a><a href="#section-toc.1-1.5.2.1.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                      <li class="ulEmpty toc compact" id="section-toc.1-1.5.2.1.2.3.2.2">
                        <p id="section-toc.1-1.5.2.1.2.3.2.2.1"><a href="#section-5.1.3.2" class="xref">5.1.3.2</a>.  <a href="#name-handling-a-batch-of-pki-man" class="xref">Handling a batch of PKI management messages</a><a href="#section-toc.1-1.5.2.1.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                    </ul>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.5.2.1.2.4">
                    <p id="section-toc.1-1.5.2.1.2.4.1"><a href="#section-5.1.4" class="xref">5.1.4</a>.  <a href="#name-initiating-delayed-enrollme" class="xref">Initiating delayed enrollment</a><a href="#section-toc.1-1.5.2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-revoking-certificates-on-be" class="xref">Revoking certificates on behalf of another's PKI entities</a><a href="#section-toc.1-1.5.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-error-reporting-2" class="xref">Error reporting</a><a href="#section-toc.1-1.5.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-cmp-message-transport-mecha" class="xref">CMP message transport mechanisms</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-http-transport" class="xref">HTTP transport</a><a href="#section-toc.1-1.6.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-https-transport-using-certi" class="xref">HTTPS transport using certificates</a><a href="#section-toc.1-1.6.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-https-transport-using-share" class="xref">HTTPS transport using shared secrets</a><a href="#section-toc.1-1.6.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-offline-transport" class="xref">Offline transport</a><a href="#section-toc.1-1.6.2.4.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.6.2.4.2.1">
                    <p id="section-toc.1-1.6.2.4.2.1.1"><a href="#section-6.4.1" class="xref">6.4.1</a>.  <a href="#name-file-based-transport" class="xref">File-based transport</a><a href="#section-toc.1-1.6.2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.6.2.4.2.2">
                    <p id="section-toc.1-1.6.2.4.2.2.1"><a href="#section-6.4.2" class="xref">6.4.2</a>.  <a href="#name-other-asynchronous-transpor" class="xref">Other asynchronous transport protocols</a><a href="#section-toc.1-1.6.2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a href="#section-6.5" class="xref">6.5</a>.  <a href="#name-coap-transport" class="xref">CoAP transport</a><a href="#section-toc.1-1.6.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.6.2.6">
                <p id="section-toc.1-1.6.2.6.1"><a href="#section-6.6" class="xref">6.6</a>.  <a href="#name-piggybacking-on-other-relia" class="xref">Piggybacking on other reliable transport</a><a href="#section-toc.1-1.6.2.6.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-acknowledgements" class="xref">Acknowledgements</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.10.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.10.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-example-certreqtemplate" class="xref">Example CertReqTemplate</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-appendix.b" class="xref">Appendix B</a>.  <a href="#name-history-of-changes" class="xref">History of changes</a><a href="#section-toc.1-1.12.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-appendix.c" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.13.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="Introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">[RFC Editor: please delete]:!!! The change history was moved to <a href="#History" class="xref">Appendix B</a> !!!<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">[RFC Editor: please delete]: The labels 'RFC-CMP-Updates', 'RFC-CMP-Alg', and 'RFC-CRMF-Alg' in ASN.1 Syntax needs to be replaced with the RFC numbers of <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span>, <span><a href="#I-D.ietf-lamps-cmp-algorithms" class="xref">CMP Algorithms</a> [<a href="#I-D.ietf-lamps-cmp-algorithms" class="xref">I-D.ietf-lamps-cmp-algorithms</a>]</span> and <span><a href="#I-D.ietf-lamps-crmf-update-algs" class="xref">CRMF Algorithm Requirements Update</a> [<a href="#I-D.ietf-lamps-crmf-update-algs" class="xref">I-D.ietf-lamps-crmf-update-algs</a>]</span>, when available.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This document specifies PKI management operations supporting machine-to-machine and IoT use cases. The focus lies on maximum automation and interoperable implementation of all involved PKI entities from end entities (EE) through an optional Local Registration Authority (LRA) and the RA up to the CA. The profile makes use of the concepts and syntax specified in <span><a href="#RFC4210" class="xref">CMP</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span>, <span><a href="#RFC4211" class="xref">CRMF</a> [<a href="#RFC4211" class="xref">RFC4211</a>]</span>, <span><a href="#RFC6712" class="xref">HTTP transfer for CMP</a> [<a href="#RFC6712" class="xref">RFC6712</a>]</span>, and <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span>. Especially CMP and CRMF are very feature-rich standards, while in most environments only a limited subset of the specified functionality is needed. Additionally, the standards are not always precise enough on how to interpret and implement the described concepts. Therefore, this document aims at tailoring and specifying in more detail how to use these concepts to implement lightweight automated certificate management.<a href="#section-1-3" class="pilcrow">¶</a></p>
<div id="Motivation">
<section id="section-1.1">
        <h3 id="name-motivation-for-profiling-cm">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-motivation-for-profiling-cm" class="section-name selfRef">Motivation for profiling CMP</a>
        </h3>
<p id="section-1.1-1">CMP was standardized in 1999 and is implemented in several PKI products. In 2005 a completely reworked and enhanced version 2 of <span><a href="#RFC4210" class="xref">CMP</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span> and <span><a href="#RFC4211" class="xref">CRMF</a> [<a href="#RFC4211" class="xref">RFC4211</a>]</span> has been published followed by a document specifying a transfer mechanism for CMP messages using HTTP <span>[<a href="#RFC6712" class="xref">RFC6712</a>]</span> in 2012.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">Though CMP is a very solid and capable protocol it is so far not used very widely.  The most important reason appears to be that the protocol offers a too large set of features and options.  On the one hand, this makes CMP applicable to a very wide range of scenarios, but on the other hand a full implementation of all options is not realistic because this would take undue effort.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">Moreover, many details of the CMP protocol have been left open or have not been specified in full preciseness. The profiles specified in Appendix D and E of <span>[<a href="#RFC4210" class="xref">RFC4210</a>]</span> define some more detailed PKI management operations. Yet the specific needs of highly automated scenarios for a machine-to-machine communication are not covered sufficiently.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4">As also 3GPP and UNISIG already put across, profiling is a way of coping with the challenges mentioned above. To profile means to take advantage of the strengths of the given protocol, while explicitly narrowing down the options it provides to those needed for the purpose(s) at hand and eliminating all identified ambiguities. In this way all the general and applicable aspects of the general protocol are taken over and only the peculiarities of the target scenario need to be dealt with specifically.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5">Defining such a profile for a new target environment take a high effort because the range of available options needs to be well understood and the selected options need to be consistent with each other and with the intended usage scenario. Since most industrial PKI management use cases typically have much in common it is worth sharing this effort, which is the aim of this document. Other standardization bodies can reference this document and do not need to come up with individual profiles.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Lightweight_profile">
<section id="section-1.2">
        <h3 id="name-motivation-for-a-lightweigh">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-motivation-for-a-lightweigh" class="section-name selfRef">Motivation for a lightweight profile for CMP</a>
        </h3>
<p id="section-1.2-1">The profiles specified in <span><a href="#RFC4210" class="xref">Appendix D and E of RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span> have been developed particularly for managing certificates of human end entities. With the evolution of distributed systems and client-server architectures, certificates for machines and applications on them have become widely used. This trend has strengthened even more in emerging industrial and IoT scenarios. CMP is sufficiently flexible to support them well.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">Today's IT security architectures for industrial solutions typically use certificates for endpoint authentication within protocols like IPSec, TLS, or SSH. Therefore, the security of these architectures highly relies upon the security and availability of the implemented certificate management procedures.<a href="#section-1.2-2" class="pilcrow">¶</a></p>
<p id="section-1.2-3">Due to increasing security needs in operational networks as well as availability requirements, especially on critical infrastructures and systems with a high volume of certificates, a state-of-the-art certificate management must be constantly available and cost-efficient, which calls for high automation and reliability. The <span><a href="#NIST.CSWP.04162018" class="xref">NIST Framework for Improving Critical Infrastructure Cybersecurity</a> [<a href="#NIST.CSWP.04162018" class="xref">NIST.CSWP.04162018</a>]</span> also refers to proper processes for issuance, management, verification, revocation, and audit for authorized devices, users and processes involving identity and credential management. Such PKI operation according to commonly accepted best practices is also required in <span><a href="#IEC.62443-3-3" class="xref">IEC 62443-3-3</a> [<a href="#IEC.62443-3-3" class="xref">IEC.62443-3-3</a>]</span> for security level 2 and higher.<a href="#section-1.2-3" class="pilcrow">¶</a></p>
<p id="section-1.2-4">Further challenges in many industrial systems are network segmentation and asynchronous communication, while PKI operation typically is not deployed on-site but in a more protected environment of a data center or trust center. Certificate management must be able to cope with such network architectures. CMP offers the required flexibility and functionality, namely self-contained messages, efficient polling, and support for asynchronous message transfer while retaining end-to-end security.<a href="#section-1.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Existing_profiles">
<section id="section-1.3">
        <h3 id="name-existing-cmp-profiles">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-existing-cmp-profiles" class="section-name selfRef">Existing CMP profiles</a>
        </h3>
<p id="section-1.3-1">As already stated, <span><a href="#RFC4210" class="xref">RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span> contains profiles with mandatory and optional PKI management operations in Appendix D and E. Those profiles focus on management of human user certificates and do only partly address the specific needs for certificate management automation for unattended machines or application-oriented end entities.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
<p id="section-1.3-2"><span><a href="#RFC4210" class="xref">RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span> specifies in Appendix D the following mandatory PKI management operations. All requirements regarding algorithm support have been updated by <span><a href="#I-D.ietf-lamps-cmp-algorithms" class="xref">CMP Algorithms Section 7.2</a> [<a href="#I-D.ietf-lamps-cmp-algorithms" class="xref">I-D.ietf-lamps-cmp-algorithms</a>]</span>, all operations may enroll up to two certificates, one for a locally generated and optionally another one for a centrally generated key pair, and all require use of certConf/pkiConf messages for confirmation.<a href="#section-1.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-3.1">Initial registration/certification; an (uninitialized) end entity requests a (first) certificate from a CA using shared secret based message authentication. The content is similar to the PKI management operation specified in <a href="#EE_MAC" class="xref">Section 4.1.4</a> of this document.<a href="#section-1.3-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-3.2">Certificate request; an (initialized) end entity requests another certificate from a CA using signature-based or shared secret-based message authentication. The content is similar to the PKI management operation specified in <a href="#EE_trustedPKI" class="xref">Section 4.1.2</a> of this document.<a href="#section-1.3-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-3.3">Key update; an (initialized) end entity requests a certificate from a CA (to update the key pair and/or corresponding certificate that it already possesses) using signature-based or shared secret-based message authentication. The content is similar to the PKI management operation specified in <a href="#EE_Update" class="xref">Section 4.1.3</a> of this document.<a href="#section-1.3-3.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.3-4">Two certificates may be enrolled and authentication is based on shared secrets because these PKI management operations focus on the enrollment of certificates of humans.<a href="#section-1.3-4" class="pilcrow">¶</a></p>
<p id="section-1.3-5"><span><a href="#RFC4210" class="xref">RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span> specifies in Appendix E the following optional PKI management operations. All requirements regarding algorithm support have been updated by <span><a href="#I-D.ietf-lamps-cmp-algorithms" class="xref">CMP Algorithms Section 7.2</a> [<a href="#I-D.ietf-lamps-cmp-algorithms" class="xref">I-D.ietf-lamps-cmp-algorithms</a>]</span>.<a href="#section-1.3-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-6.1">Root CA key update; a root CA updates its key pair and produces a CA key update announcement message, which can be made available (via some transport mechanism) to the relevant end entities. This operation only supports a push model. The content is similar to the PKI management operation supporting the pull model specified in <a href="#EE_RootCAUpdate" class="xref">Section 4.4.2</a> of this document.<a href="#section-1.3-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-6.2">Information request/response; an end entity sends a general message to the PKI requesting details that will be required for later PKI management operations. The content is similar to the PKI management operation specified in <a href="#EE_Temp" class="xref">Section 4.4.3</a> of this document.<a href="#section-1.3-6.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-6.3">Cross-certification request/response (1-way); creation of a single cross-certificate (i.e., not two at once). The requesting CA MAY choose who is responsible for publication of the cross-certificate created by the responding CA through use of the PKIPublicationInfo control.<a href="#section-1.3-6.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-6.4">In-band initialization using an external identity certificate (this PKI management operation may also enroll up to two certificates and requires use of certConf/pkiConf messages for confirmation as specified in <span><a href="#RFC4210" class="xref">Appendix D of RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span>). An (uninitialized) end entity wishes to initialize into the PKI with a CA, CA-1.  It uses, for authentication purposes, a pre-existing identity certificate issued by another (external) CA, CA-X.  A trust relationship must already have been established already between CA-1 and CA-X so that CA-1 can validate the EE's identity certificate signed by CA-X. Furthermore, some mechanism must already have been established within the Personal Security Environment (PSE) of the EE enabling it to authenticate and verify PKIMessages signed by CA-1. The content is similar to the PKI management operation specified in <a href="#EE_newPKI" class="xref">Section 4.1.1</a> of this document.<a href="#section-1.3-6.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.3-7">Both these Appendixes D and E focus on EE-to-CA/RA PKI management operations and do not address further profiling of RA to CA communication as typically needed for full backend automation.<a href="#section-1.3-7" class="pilcrow">¶</a></p>
<p id="section-1.3-8">3GPP makes use of <span><a href="#RFC4210" class="xref">CMP</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span> in its <span><a href="#ETSI-3GPP.33.310" class="xref">Technical Specification 33.310</a> [<a href="#ETSI-3GPP.33.310" class="xref">ETSI-3GPP.33.310</a>]</span> for automatic management of IPSec certificates in 3G, LTE, and 5G backbone networks. Since 2010 a dedicated CMP profile for initial certificate enrollment and certificate update operations between EE and RA/CA is specified in that document.<a href="#section-1.3-8" class="pilcrow">¶</a></p>
<p id="section-1.3-9">UNISIG has included a CMP profile for certificate enrollment in the subset 137 specifying the <span><a href="#UNISIG.Subset-137" class="xref">ETRAM/ECTS on-line key management for train control systems</a> [<a href="#UNISIG.Subset-137" class="xref">UNISIG.Subset-137</a>]</span> in 2015.<a href="#section-1.3-9" class="pilcrow">¶</a></p>
<p id="section-1.3-10">Both standardization bodies use <span><a href="#RFC4210" class="xref">CMP</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span>, <span><a href="#RFC4211" class="xref">CRMF</a> [<a href="#RFC4211" class="xref">RFC4211</a>]</span>, and <span><a href="#RFC6712" class="xref">HTTP transfer for CMP</a> [<a href="#RFC6712" class="xref">RFC6712</a>]</span> to add tailored means for automated PKI management operations for unattended devices and services.<a href="#section-1.3-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Compatibility">
<section id="section-1.4">
        <h3 id="name-compatibility-with-existing">
<a href="#section-1.4" class="section-number selfRef">1.4. </a><a href="#name-compatibility-with-existing" class="section-name selfRef">Compatibility with existing CMP profiles</a>
        </h3>
<p id="section-1.4-1" class="keepWithNext">The profile specified in this document is compatible with <span><a href="#RFC4210" class="xref">RFC 4210 Appendixes D and E (PKI Management Message Profiles)</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span>, with the following exceptions:<a href="#section-1.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.4-2.1">signature-based protection is the default protection; an initial PKI management operation may also use MAC-based protection,<a href="#section-1.4-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.4-2.2">certification of a second key pair within the same PKI management operation is not supported,<a href="#section-1.4-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.4-2.3">proof-of-possession (POPO) with self-signature of the certTemplate according to <span><a href="#RFC4210" class="xref">RFC 4210 Section 4.1</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span> clause 3 is the recommended default POPO method (deviations are possible for EEs when requesting central key generation, for (L)RAs when using raVerified, and if the newly generated keypair is technically not capable to generate digital signatures),<a href="#section-1.4-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.4-2.4">confirmation of newly enrolled certificates may be omitted, and<a href="#section-1.4-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.4-2.5">all PKI management operations consist of request-response message pairs originating at the EE, i.e., announcement messages (requiring the push model) are omitted.<a href="#section-1.4-2.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.4-3" class="keepWithNext">The profile specified in this document is compatible with the CMP profile for 3G, LTE, and 5G network domain security and authentication framework <span>[<a href="#ETSI-3GPP.33.310" class="xref">ETSI-3GPP.33.310</a>]</span>, except that:<a href="#section-1.4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.4-4.1">protection of initial PKI management operations may be MAC-based,<a href="#section-1.4-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.4-4.2">the subject field is mandatory in certificate templates, and<a href="#section-1.4-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.4-4.3">confirmation of newly enrolled certificates may be omitted.<a href="#section-1.4-4.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.4-5" class="keepWithNext">The profile specified in this document is compatible with the CMP profile for on-line key management in rail networks as specified in <span><a href="#UNISIG.Subset-137" class="xref">UNISIG Subset-137</a> [<a href="#UNISIG.Subset-137" class="xref">UNISIG.Subset-137</a>]</span>, except that:<a href="#section-1.4-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.4-6.1">A certificate enrollment request message consists of only one  certificate request (CertReqMsg). As <span><a href="#UNISIG.Subset-137" class="xref">UNISIG Subset-137 Table 6</a> [<a href="#UNISIG.Subset-137" class="xref">UNISIG.Subset-137</a>]</span> allows to transport more than one certificate request message, this conflicts with this document.<a href="#section-1.4-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.4-6.2">As of <span><a href="#RFC4210" class="xref">RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span> the messageTime is required to be Greenwich Mean Time coded as generalizedTime As <span><a href="#UNISIG.Subset-137" class="xref">UNISIG Subset-137 Table 5</a> [<a href="#UNISIG.Subset-137" class="xref">UNISIG.Subset-137</a>]</span> explicitly states that the messageTime in required to be 'UTC time', it is not clear if this means a coding as UTCTime or generalizedTime and if other time zones than Greenwich Mean Time shall be allowed. Therefore, <span><a href="#UNISIG.Subset-137" class="xref">UNISIG Subset-137</a> [<a href="#UNISIG.Subset-137" class="xref">UNISIG.Subset-137</a>]</span> may conflict with <span><a href="#RFC4210" class="xref">RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span>. Both time formats are described in <span><a href="#RFC5280" class="xref">RFC 5280 Section 4.1.2.5</a> [<a href="#RFC5280" class="xref">RFC5280</a>]</span>.<a href="#section-1.4-6.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.4-6.3">This profile requires usage of the same type of protection for all messages of one PKI management operation. This means, in case the request message is MAC protected, also the response, certConf, and pkiConf messages have a MAC-based protection. As <span><a href="#UNISIG.Subset-137" class="xref">UNISIG Subset-137 Table 5</a> [<a href="#UNISIG.Subset-137" class="xref">UNISIG.Subset-137</a>]</span> specifies for the first certificate request MAC protection for all messages send by the client and signature protection for all messages send by the server, this conflicts with this document.<a href="#section-1.4-6.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.4-6.4">Use of caPubs is not required but typically allowed in combination with MAC-based protected PKI management operations.  On the other hand <span><a href="#UNISIG.Subset-137" class="xref">UNISIG Subset-137 Table 12</a> [<a href="#UNISIG.Subset-137" class="xref">UNISIG.Subset-137</a>]</span> requires using caPubs.  Note that in case the protection of the response is changed to signature-based protection using a certificate issued under the root CA that is to be transported in the caPubs field, this is not a  secure delivery of the root CA certificate.<a href="#section-1.4-6.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.4-6.5">This profile requires that the certConf message has one CertStatus element where the statusInfo field is recommended. In contrast, <span><a href="#UNISIG.Subset-137" class="xref">UNISIG Subset-137 Table 18</a> [<a href="#UNISIG.Subset-137" class="xref">UNISIG.Subset-137</a>]</span> requires that the certConf message has one CertStatus element where the statusInfo field must be absent. This precludes sending a negative certConf message in case the EE rejects the newly enrolled certificate. This results in violating the general rule that a certificate request transaction must include a certConf message (since moreover using implicitConfirm is not allowed there, neither).<a href="#section-1.4-6.5" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="Scope">
<section id="section-1.5">
        <h3 id="name-scope-of-this-document">
<a href="#section-1.5" class="section-number selfRef">1.5. </a><a href="#name-scope-of-this-document" class="section-name selfRef">Scope of this document</a>
        </h3>
<p id="section-1.5-1">This document specifies requirements on generating PKI management messages on the sender side. It does not specify strictness of verification on the receiving side and how in detail to handle error cases.<a href="#section-1.5-1" class="pilcrow">¶</a></p>
<p id="section-1.5-2">Especially on the EE side this profile aims at a lightweight implementation. This means that the number of PKI management operations that implementations must support are reduced to a reasonable minimum to support most typical certificate management use cases in industrial machine-to-machine environments. On the EE side only limited resources are expected, while on the side of the PKI management entities the profile accepts higher resources needed.<a href="#section-1.5-2" class="pilcrow">¶</a></p>
<p id="section-1.5-3">For the sake of robustness and preservation of security properties implementations should, as far as security is not affected, adhere to Postel's law: "Be conservative in what you do, be liberal in what you accept from others" (often reworded as: "Be conservative in what you send, be liberal in what you accept").<a href="#section-1.5-3" class="pilcrow">¶</a></p>
<p id="section-1.5-4">When in <a href="#GenericParts" class="xref">Section 3</a>, <a href="#EE_UseCases" class="xref">Section 4</a>, and <a href="#RA_UseCases" class="xref">Section 5</a> a field of the ASN.1 syntax as defined in <span><a href="#RFC4210" class="xref">RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span> and <span><a href="#RFC4211" class="xref">RFC 4211</a> [<a href="#RFC4211" class="xref">RFC4211</a>]</span> is not explicitly specified, it SHOULD not be used by the sending entity. The receiving entity MUST NOT require its absence and if present MUST gracefully handle its presence.<a href="#section-1.5-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Structure">
<section id="section-1.6">
        <h3 id="name-structure-of-this-document">
<a href="#section-1.6" class="section-number selfRef">1.6. </a><a href="#name-structure-of-this-document" class="section-name selfRef">Structure of this document</a>
        </h3>
<p id="section-1.6-1"><a href="#Architecture_UseCases" class="xref">Section 2</a> introduces the general PKI architecture and approach to certificate management using CMP that is assumed in this document. Then it enlists the  PKI management operations specified in this document and describes them in general words. The list of supported PKI management operations is divided into mandatory, recommended, and optional ones.<a href="#section-1.6-1" class="pilcrow">¶</a></p>
<p id="section-1.6-2"><a href="#GenericParts" class="xref">Section 3</a> profiles the CMP message header, protection, and extraCerts fields as they are general elements of CMP messages.<a href="#section-1.6-2" class="pilcrow">¶</a></p>
<p id="section-1.6-3"><a href="#EE_UseCases" class="xref">Section 4</a> profiles the exchange of CMP messages between an EE and the first PKI management entity. There are various flavors of certificate enrollment requests, optionally with polling, revocation, error handling, and general support PKI management operations.<a href="#section-1.6-3" class="pilcrow">¶</a></p>
<p id="section-1.6-4"><a href="#RA_UseCases" class="xref">Section 5</a> profiles the message exchange between PKI management entities. In the first place this consists of forwarding messages coming from or going to an EE.  This may include delayed delivery of messages, which involves polling for certificate responses.  Additionally, it specifies operations where a PKI management entity manages certificates on behalf of an EE or for itself.<a href="#section-1.6-4" class="pilcrow">¶</a></p>
<p id="section-1.6-5"><a href="#Transport_variants" class="xref">Section 6</a> outlines several mechanisms for CMP message transfer, namely HTTP-based transfer as already specified in <span><a href="#RFC6712" class="xref">RFC 6712</a> [<a href="#RFC6712" class="xref">RFC6712</a>]</span>, using an additional TLS layer, or offline file-based transport.  <span><a href="#RFC7252" class="xref">CoAP</a> [<a href="#RFC7252" class="xref">RFC7252</a>]</span> and piggybacking CMP messages<a href="#section-1.6-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Convention_Terminology">
<section id="section-1.7">
        <h3 id="name-convention-and-terminology">
<a href="#section-1.7" class="section-number selfRef">1.7. </a><a href="#name-convention-and-terminology" class="section-name selfRef">Convention and Terminology</a>
        </h3>
<p id="section-1.7-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-1.7-1" class="pilcrow">¶</a></p>
<p id="section-1.7-2" class="keepWithNext">Technical terminology is used in conformance with <span><a href="#RFC4210" class="xref">RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span>, <span><a href="#RFC4211" class="xref">RFC 4211</a> [<a href="#RFC4211" class="xref">RFC4211</a>]</span>, <span><a href="#RFC5280" class="xref">RFC 5280</a> [<a href="#RFC5280" class="xref">RFC5280</a>]</span>, and <span><a href="#IEEE.802.1AR_2018" class="xref">IEEE 802.1AR</a> [<a href="#IEEE.802.1AR_2018" class="xref">IEEE.802.1AR_2018</a>]</span>. The following key words are used:<a href="#section-1.7-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-1.7-3">
          <dt id="section-1.7-3.1">CA:</dt>
          <dd style="margin-left: 3.0em" id="section-1.7-3.2">Certification authority, which issues certificates.<a href="#section-1.7-3.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.7-3.3">RA:</dt>
          <dd style="margin-left: 3.0em" id="section-1.7-3.4">Registration authority, an optional PKI component to which a CA delegates certificate management functions such as authorization checks.<a href="#section-1.7-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.7-3.5">LRA:</dt>
          <dd style="margin-left: 3.0em" id="section-1.7-3.6">Local registration authority, an optional RA system component with proximity to the end entities.<a href="#section-1.7-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.7-3.7">KGA:</dt>
          <dd style="margin-left: 3.0em" id="section-1.7-3.8">Key generation authority, an optional system component, typically co-located with an LRA, RA, or CA, that offers key generation services to end entities.<a href="#section-1.7-3.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.7-3.9">EE:</dt>
          <dd style="margin-left: 3.0em" id="section-1.7-3.10">End entity, a user, device, or service that holds public-private key pair for which it manages a public-key certificate. An identifier for the EE is given as the subject of its certificate.<a href="#section-1.7-3.10" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-1.7-4" class="keepWithNext">The following terminology is reused from <span><a href="#RFC4210" class="xref">RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span> and used as follows:<a href="#section-1.7-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-1.7-5">
          <dt id="section-1.7-5.1">PKI management operation:</dt>
          <dd style="margin-left: 13.5em" id="section-1.7-5.2">All CMP messages belonging to one transaction context. The transaction is identified in the transactionID field of the message header.<a href="#section-1.7-5.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.7-5.3">PKI management entity:</dt>
          <dd style="margin-left: 13.5em" id="section-1.7-5.4">All non-EE PKI entities such as LRA, RA, and CA.<a href="#section-1.7-5.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.7-5.5">PKI entity:</dt>
          <dd style="margin-left: 13.5em" id="section-1.7-5.6">EEs and PKI management entities<a href="#section-1.7-5.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="Architecture_UseCases">
<section id="section-2">
      <h2 id="name-architecture-and-use-cases">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-architecture-and-use-cases" class="section-name selfRef">Architecture and use cases</a>
      </h2>
<div id="Architecture">
<section id="section-2.1">
        <h3 id="name-solution-architecture">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-solution-architecture" class="section-name selfRef">Solution architecture</a>
        </h3>
<p id="section-2.1-1">In order to facilitate secure automatic certificate enrollment if the device hosting an EE is equipped with a manufacturer issued certificate during production. Such a manufacturer issued certificate is installed during production to identify the device throughout its lifetime. This manufacturer certificate can be used to protect the initial enrollment of operational certificates after installation of the EE on site in its operational environment. An operational certificate is issued by the owner or operator of the device to identify the device during operation for use, e.g., in a security protocol like IPSec, TLS, or SSH. In <span><a href="#IEEE.802.1AR_2018" class="xref">IEEE 802.1AR</a> [<a href="#IEEE.802.1AR_2018" class="xref">IEEE.802.1AR_2018</a>]</span> a manufacturer certificate is called IDevID certificate and an operational certificate is called LDevID certificate.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">Note: According to <span><a href="#IEEE.802.1AR_2018" class="xref">IEEE 802.1AR</a> [<a href="#IEEE.802.1AR_2018" class="xref">IEEE.802.1AR_2018</a>]</span> a DevID comprises the triplet of the certificate and the corresponding private key as well as certificate chain up to the root certificate.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">All certificate management transactions specified in this document are initiated by the EE. The EE creates a CMP request message, protects it using some asymmetric credential or shared secret information, as far as available, and sends it to its locally reachable PKI component. This PKI component may be an LRA, RA, or the CA, which checks the request, responds to it itself, or forwards the request upstream to the next PKI component. In case an (L)RA changes the CMP request message header or body or wants to prove a successful verification or authorization, it can apply a protection of its own. Especially the communication between an LRA and RA can be performed synchronously or asynchronously. Synchronous communication describes a timely uninterrupted communication between two communication partners, while asynchronous communication is not performed in a timely consistent manner, e.g., because of a delayed message delivery.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<span id="name-certificate-management-on-s"></span><div id="CertManUseCasesFigure">
<figure id="figure-1">
          <div class="artwork art-text alignCenter" id="section-2.1-4.1">
<pre>
+-----+            +-----+                +-----+            +-----+
|     |            |     |                |     |            |     |
| EE  |&lt;----------&gt;| LRA |&lt;--------------&gt;| RA  |&lt;----------&gt;| CA  |
|     |            |     |                |     |            |     |
+-----+            +-----+                +-----+            +-----+

        synchronous        (a)synchronous       (a)synchronous
   +----connection----+------connection------+----connection----+

        on site at                operators          service partner
+----------plant---------+-----backend services-----+-trust center-+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-certificate-management-on-s" class="selfRef">Certificate management on site</a>
          </figcaption></figure>
</div>
<p id="section-2.1-5">In operation environments a layered LRA-RA-CA architecture can be deployed, e.g., with LRAs bundling requests from multiple EEs at dedicated locations and one (or more than one) central RA aggregating the requests from multiple LRAs. Every (L)RA in this scenario typically has a shared secret information (one per EE) for password-based protection or a CMP protection key and certificate containing an extended key usage as specified in  <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span> allowing it to protect CMP messages it processes. The figure above shows an architecture using one LRA and one RA. It is also possible to have only an RA or multiple LRAs and/or RAs. Depending on the network infrastructure, the message transfer between PKI management entities may be based on synchronous online connections, delayed asynchronous connections, or even offline (e.g., file-based) transfer.<a href="#section-2.1-5" class="pilcrow">¶</a></p>
<p id="section-2.1-6">This profile focusses on specifying the pull model, where the EE always requests a specific PKI management operation.<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<p id="section-2.1-7">Note: CMP response messages, especially in case of central key generation, as described in <a href="#EE_centralKeyGeneration" class="xref">Section 4.1.6</a>, could also be used proactively to implement the push model towards the EE.<a href="#section-2.1-7" class="pilcrow">¶</a></p>
<p id="section-2.1-8">Third-party CAs typically implement other variants of CMP, different standardized protocols, or even proprietary interfaces for certificate management.  Therefore, the LRA or the RA may need to adapt the exchanged CMP messages to the flavor of certificate management interaction required by the CA.<a href="#section-2.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Generic_Parts">
<section id="section-2.2">
        <h3 id="name-basic-generic-cmp-message-c">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-basic-generic-cmp-message-c" class="section-name selfRef">Basic generic CMP message content</a>
        </h3>
<p id="section-2.2-1"><a href="#GenericParts" class="xref">Section 3</a> specifies the generic parts of the CMP messages as used later in <a href="#EE_UseCases" class="xref">Section 4</a> and <a href="#RA_UseCases" class="xref">Section 5</a>.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-2.1">Header of a CMP message; see <a href="#Header" class="xref">Section 3.1</a>.<a href="#section-2.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.2-2.2">Protection of a CMP message; see <a href="#Protection" class="xref">Section 3.2</a>.<a href="#section-2.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.2-2.3">ExtraCerts field of a CMP message; see <a href="#extraCerts" class="xref">Section 3.3</a>.<a href="#section-2.2-2.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="UseCases">
<section id="section-2.3">
        <h3 id="name-supported-pki-management-op">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-supported-pki-management-op" class="section-name selfRef">Supported PKI management operations</a>
        </h3>
<p id="section-2.3-1">Following the scope outlined in <a href="#Scope" class="xref">Section 1.5</a>, this section gives a brief overview of the PKI management operations specified in <a href="#EE_UseCases" class="xref">Section 4</a> and <a href="#RA_UseCases" class="xref">Section 5</a> and states whether implementation by compliant EE or PKI management entities is mandatory, recommended, or optional.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<div id="Mandatory">
<section id="section-2.3.1">
          <h4 id="name-mandatory-pki-management-op">
<a href="#section-2.3.1" class="section-number selfRef">2.3.1. </a><a href="#name-mandatory-pki-management-op" class="section-name selfRef">Mandatory PKI management operations</a>
          </h4>
<p id="section-2.3.1-1">The mandatory PKI management operations in this document limit the overhead of certificate management. This minimal set of operations may be helpful for keeping development effort low and for use in memory-constrained devices.<a href="#section-2.3.1-1" class="pilcrow">¶</a></p>
<span id="name-mandatory-end-entity-pki-ma"></span><div id="EE_UseCases_Mandatory">
<table class="left" id="table-1">
            <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-mandatory-end-entity-pki-ma" class="selfRef">Mandatory End Entity PKI management operations</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">PKI management operations</th>
                <th class="text-left" rowspan="1" colspan="1">Section</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Request a certificate from a new PKI with signature protection</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#EE_newPKI" class="xref">Section 4.1.1</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Request to update an existing certificate with signature protection</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#EE_Update" class="xref">Section 4.1.3</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Error reporting</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#EE_Error" class="xref">Section 4.3</a>
</td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-2.3.1-3" class="keepWithNext"></p>
<span id="name-mandatory-lra-and-ra-pki-ma"></span><div id="RA_UseCases_Mandatory">
<table class="left" id="table-2">
            <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-mandatory-lra-and-ra-pki-ma" class="selfRef">Mandatory LRA and RA PKI management operations</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">PKI management operations</th>
                <th class="text-left" rowspan="1" colspan="1">Section</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Forward messages without changes</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#RA_noChange" class="xref">Section 5.1.1</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Forward messages with replaced protection and keeping the original proof-of-possession</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#RA_keepPOPO" class="xref">Section 5.1.2.1</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Forward messages with replaced protection and setting raVerified as proof-of-possession</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#RA_breakPOPO" class="xref">Section 5.1.2.2</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Error reporting</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#RA_Error" class="xref">Section 5.3</a>
</td>
              </tr>
            </tbody>
          </table>
</div>
</section>
</div>
<div id="Recommended">
<section id="section-2.3.2">
          <h4 id="name-recommended-pki-management-">
<a href="#section-2.3.2" class="section-number selfRef">2.3.2. </a><a href="#name-recommended-pki-management-" class="section-name selfRef">Recommended PKI management operations</a>
          </h4>
<p id="section-2.3.2-1">Additional recommended PKI management operations shall support some more complex scenarios, that are considered beneficial for environments with more specific boundary conditions.<a href="#section-2.3.2-1" class="pilcrow">¶</a></p>
<p id="section-2.3.2-2" class="keepWithNext"></p>
<span id="name-recommended-end-entity-pki-"></span><div id="EE_UseCases_Recommended">
<table class="left" id="table-3">
            <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-recommended-end-entity-pki-" class="selfRef">Recommended End Entity PKI management operations</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">PKI management operations</th>
                <th class="text-left" rowspan="1" colspan="1">Section</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Request a certificate from a PKI with MAC protection</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#EE_MAC" class="xref">Section 4.1.4</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Revoke a certificate of its own</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#EE_Revoke" class="xref">Section 4.2</a>
</td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-2.3.2-4" class="keepWithNext"></p>
<span id="name-recommended-lra-and-ra-pki-"></span><div id="RA_UseCases_Recommended">
<table class="left" id="table-4">
            <caption>
<a href="#table-4" class="selfRef">Table 4</a>:
<a href="#name-recommended-lra-and-ra-pki-" class="selfRef">Recommended LRA and RA PKI management operations</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">PKI management operations</th>
                <th class="text-left" rowspan="1" colspan="1">Section</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Revoke a certificate of another entity </td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#RA_Revoke" class="xref">Section 5.2</a>
</td>
              </tr>
            </tbody>
          </table>
</div>
</section>
</div>
<div id="Optional">
<section id="section-2.3.3">
          <h4 id="name-optional-pki-management-ope">
<a href="#section-2.3.3" class="section-number selfRef">2.3.3. </a><a href="#name-optional-pki-management-ope" class="section-name selfRef">Optional PKI management operations</a>
          </h4>
<p id="section-2.3.3-1">The optional PKI management operations support specific requirements seen only in some environments with special requirements.<a href="#section-2.3.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3.3-2" class="keepWithNext"></p>
<span id="name-optional-end-entity-pki-man"></span><div id="EE_UseCases_Optional">
<table class="left" id="table-5">
            <caption>
<a href="#table-5" class="selfRef">Table 5</a>:
<a href="#name-optional-end-entity-pki-man" class="selfRef">Optional End Entity PKI management operations</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">PKI management operations</th>
                <th class="text-left" rowspan="1" colspan="1">Section</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Request a certificate from a trusted PKI with signature protection</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#EE_trustedPKI" class="xref">Section 4.1.2</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Request a certificate from a legacy PKI using a <span><a href="#RFC2986" class="xref">PKCS#10</a> [<a href="#RFC2986" class="xref">RFC2986</a>]</span> request</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#EE_P10" class="xref">Section 4.1.5</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Add central generation of a key pair to a certificate request. (If central key generation is supported, the key agreement key management technique is REQUIRED to be supported, and the key transport and password-based key management techniques are OPTIONAL.)</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#EE_centralKeyGeneration" class="xref">Section 4.1.6</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Handle delayed enrollment due to asynchronous or offline message delivery</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#EE_Polling" class="xref">Section 4.1.7</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Additional support messages - distribution of CA certificates, update of a root CA certificate and provisioning of certificate request template</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#EE_GeneralMessage" class="xref">Section 4.4</a>
</td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-2.3.3-4" class="keepWithNext"></p>
<span id="name-optional-lra-and-ra-pki-man"></span><div id="RA_UseCases_Optional">
<table class="left" id="table-6">
            <caption>
<a href="#table-6" class="selfRef">Table 6</a>:
<a href="#name-optional-lra-and-ra-pki-man" class="selfRef">Optional LRA and RA PKI management operations</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">PKI management operations</th>
                <th class="text-left" rowspan="1" colspan="1">Section</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Forward messages with additional protection</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#RA_Add" class="xref">Section 5.1.3</a>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Initiate delayed enrollment due to asynchronous or offline message delivery</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <a href="#RA_Polling" class="xref">Section 5.1.4</a>
</td>
              </tr>
            </tbody>
          </table>
</div>
</section>
</div>
</section>
</div>
<div id="Transport">
<section id="section-2.4">
        <h3 id="name-cmp-message-transport">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-cmp-message-transport" class="section-name selfRef">CMP message transport</a>
        </h3>
<p id="section-2.4-1">On different links between PKI entities, e.g., EE-RA and RA-CA, different transport MAY be used.  As CMP does not have specific needs regarding message transport, virtually any reliable transport mechanism may be used, e.g., HTTP, CoAP, and offline file-based transport. Therefore, this document does not require any specific transport protocol to be supported by conforming implementations.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.4-2">HTTP transfer is RECOMMENDED to use for all PKI entities, yet full flexibility is retained to choose whatever transport is suitable, for instance for devices with special constraints.<a href="#section-2.4-2" class="pilcrow">¶</a></p>
<span id="name-recommended-transport-mecha"></span><div id="Trans_Options_Recommended">
<table class="left" id="table-7">
          <caption>
<a href="#table-7" class="selfRef">Table 7</a>:
<a href="#name-recommended-transport-mecha" class="selfRef">Recommended transport mechanisms</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Transport</th>
              <th class="text-left" rowspan="1" colspan="1">Section</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Transfer CMP messages using HTTP</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#HTTP" class="xref">Section 6.1</a>
</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-2.4-4" class="keepWithNext"></p>
<span id="name-optional-transport-mechanis"></span><div id="Trans_Options_Optional">
<table class="left" id="table-8">
          <caption>
<a href="#table-8" class="selfRef">Table 8</a>:
<a href="#name-optional-transport-mechanis" class="selfRef">Optional transport mechanisms</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Transport</th>
              <th class="text-left" rowspan="1" colspan="1">Section</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Transfer CMP messages using HTTPS with certificate-based authentication</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#HTTPS_Cert" class="xref">Section 6.2</a>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Transfer CMP messages using HTTPS with shared secret-based authentication</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#HTTPS_PWD" class="xref">Section 6.3</a>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Offline CMP message transport</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#Offline" class="xref">Section 6.4</a>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Transfer CMP messages using CoAP</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#CoAP" class="xref">Section 6.5</a>
</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</div>
</section>
</div>
<div id="GenericParts">
<section id="section-3">
      <h2 id="name-generic-parts-of-the-pki-me">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-generic-parts-of-the-pki-me" class="section-name selfRef">Generic parts of the PKI message</a>
      </h2>
<p id="section-3-1">The generic parts of the CMP message profiles specified in <a href="#EE_UseCases" class="xref">Section 4</a> and <a href="#RA_UseCases" class="xref">Section 5</a> are standardized to the maximum extent possible and are described centrally in this section to reduce redundancy in the description and to ease implementation.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2" class="keepWithNext">As described in section 5.1 of <span>[<a href="#RFC4210" class="xref">RFC4210</a>]</span>, all CMP messages have the following general structure:<a href="#section-3-2" class="pilcrow">¶</a></p>
<span id="name-cmp-message-structure"></span><div id="CMP_messageStructure">
<figure id="figure-2">
        <div class="artwork art-text alignCenter" id="section-3-3.1">
<pre>
+--------------------------------------------+
| PKIMessage                                 |
| +----------------------------------------+ |
| | header                                 | |
| +----------------------------------------+ |
| +----------------------------------------+ |
| | body                                   | |
| +----------------------------------------+ |
| +----------------------------------------+ |
| | protection (OPTIONAL)                  | |
| +----------------------------------------+ |
| +----------------------------------------+ |
| | extraCerts (OPTIONAL)                  | |
| +----------------------------------------+ |
+--------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-cmp-message-structure" class="selfRef">CMP message structure</a>
        </figcaption></figure>
</div>
<p id="section-3-4">The general contents of the message header, protection, and extraCerts fields are specified in the following subsections.<a href="#section-3-4" class="pilcrow">¶</a></p>
<p id="section-3-5">In case a specific CMP message profile needs different contents in the header, protection, or extraCerts fields, the differences are described in the respective message profile.<a href="#section-3-5" class="pilcrow">¶</a></p>
<p id="section-3-6">The CMP message body contains the message-specific information. It is described as part <a href="#EE_UseCases" class="xref">Section 4</a> and <a href="#RA_UseCases" class="xref">Section 5</a>.<a href="#section-3-6" class="pilcrow">¶</a></p>
<p id="section-3-7">The behavior in case an error occurs while handling the generic parts of a CMP message is described in <a href="#RA_Error" class="xref">Section 5.3</a>.<a href="#section-3-7" class="pilcrow">¶</a></p>
<div id="Header">
<section id="section-3.1">
        <h3 id="name-general-description-of-the-">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-general-description-of-the-" class="section-name selfRef">General description of the CMP message header</a>
        </h3>
<p id="section-3.1-1">This section describes the generic header field of all CMP messages with signature-based protection. The only variations described here are in the recipient, transactionID, and recipNonce fileds of the first message of a PKI management operation.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">In case a message has MAC-based protection the changes are described in <a href="#EE_MAC" class="xref">Section 4.1.4</a>. The variations will affect the fields sender, protectionAlg, and senderKID.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">For requirements regarding proper random number generation please refer to <span>[<a href="#RFC4086" class="xref">RFC4086</a>]</span>. Any message-specific fields or variations are described in <a href="#EE_UseCases" class="xref">Section 4</a> and <a href="#RA_UseCases" class="xref">Section 5</a>.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1-4">
<pre>
header
  pvno                        REQUIRED
    -- MUST be set to 3 to indicate CMP V3 in all cases where
    -- EnvelopedData is supported and expected to be used in this PKI
    -- management operation
    -- MUST be set to 2 to indicate CMP V2 in all other cases
    -- For details on version negotiation see RFC-CMP-Updates
  sender                      REQUIRED
    -- MUST contain a name representing the originator of the message
    -- SHOULD be the subject of the CMP protection certificate, i.e.,
    -- the certificate for the private key used to sign the message
  recipient                   REQUIRED
    -- SHOULD be the name of the intended recipient and
    -- MAY be a NULL-DN, i.e., a zero-length SEQUENCE OF
    -- RelativeDistinguishedNames, if the sender does not know the
    -- DN of the recipient
    -- If this is the first message of a transaction: SHOULD be the
    -- subject of the issuing CA certificate
    -- In all other messages: SHOULD be the same name as in the
    -- sender field of the previous message in the same transaction
  messageTime                 RECOMMENDED
    -- MUST be the time at which the message was produced, if
    -- present
  protectionAlg               REQUIRED
    -- MUST be the algorithm OID of the algorithm used for
    -- calculating the protection bits
    -- The signature algorithm MUST be a MSG_SIG_ALG as specified in
    -- RFC-CMP-Alg Section 3 and MUST be consistent with the
    -- subjectPublicKeyInfo field of the protection certificate
    -- The MAC algorithm MUST be a MSG_MAC_ALG as specified in
    -- RFC-CMP-Alg Section 6
    algorithm                 REQUIRED
    -- MUST be the OID of the signature or MAC algorithm
  senderKID                   RECOMMENDED
    -- MUST be the SubjectKeyIdentifier of the CMP protection
    -- certificate or a reference of the shared secret information
    -- used for the protection
  transactionID               REQUIRED
    -- If this is the first message of a transaction:
    -- MUST be 128 bits of random data for the start of a
    -- transaction, to minimize the probability of having the
    -- transactionID already in use at the server
    -- In all other messages:
    -- MUST be the value from the previous message in the same
    -- transaction
  senderNonce                 REQUIRED
    -- MUST be cryptographically secure and fresh 128 random bits
  recipNonce                  RECOMMENDED
    -- If this is the first message of a transaction: SHOULD be
    -- absent
    -- In all other messages: MUST be present and contain the value
    -- of the senderNonce of the previous message in the same
    -- transaction
  generalInfo                 OPTIONAL
    implicitConfirm           OPTIONAL
    -- The field is optional in ir/cr/kur/p10cr requests and
    -- ip/cp/kup response messages and PROHIBTED in other types of
    -- messages
    -- Added to request messages to request omission of the certConf
    -- message
    -- See [RFC4210] Section 5.1.1.1.
    -- Added to response messages to grant omission of the certConf
    -- message
      ImplicitConfirmValue    REQUIRED
    -- ImplicitConfirmValue of the request message MUST be NULL if
    -- the EE wants to request not to send a confirmation message
    -- ImplicitConfirmValue MUST be NULL if the PKI management
    -- entity wants to grant not sending a confirmation message
</pre><a href="#section-3.1-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="Protection">
<section id="section-3.2">
        <h3 id="name-general-description-of-the-c">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-general-description-of-the-c" class="section-name selfRef">General description of the CMP message protection</a>
        </h3>
<p id="section-3.2-1">This section describes the generic protection field of all CMP messages with signature-based protection. The certificate for the private key used to sign a CMP message is called 'protection certificate'. Any included keyUsage extension SHOULD allow digitalSignature.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.2-2">
<pre>
protection                    RECOMMENDED
    -- MUST contain the signature calculated using the private key
    -- of the entity protecting the message. The signature
    -- algorithm used MUST be given in the protectionAlg field.
</pre><a href="#section-3.2-2" class="pilcrow">¶</a>
</div>
<p id="section-3.2-3">Generally, CMP message protection is required for CMP messages, but there are cases where protection of error messages as specified in <a href="#EE_Error" class="xref">Section 4.3</a> and <a href="#RA_Error" class="xref">Section 5.3</a> is not possible and therefore MAY be omitted.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<p id="section-3.2-4">For MAC-based protection as specified in <a href="#EE_MAC" class="xref">Section 4.1.4</a> major differences apply as described in the respective section.<a href="#section-3.2-4" class="pilcrow">¶</a></p>
<p id="section-3.2-5">The CMP message protection provides, if available, message origin authentication and integrity protection for the CMP message header and body. The CMP message extraCerts field is not covered by this protection.<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2-6">Note: The extended key usages specified in <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span> can be used for authorization of a sending PKI management entity.<a href="#section-3.2-6" class="pilcrow">¶</a></p>
<p id="section-3.2-7">Note: The requirements for checking certificates given in <span>[<a href="#RFC5280" class="xref">RFC5280</a>]</span> MUST be the followed for signature-based CMP message protection.  In case the CMP protection certificate is not the CA certificate that signed the newly issued certificate, certificate status checking SHOULD be used for the CMP protection certificates of communication partners.<a href="#section-3.2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="extraCerts">
<section id="section-3.3">
        <h3 id="name-general-description-of-cmp-">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-general-description-of-cmp-" class="section-name selfRef">General description of CMP message extraCerts</a>
        </h3>
<p id="section-3.3-1">This section describes the generic extraCerts field of all CMP messages with signature-based protection. If extraCerts are required, recommended, or optional is specified in the respective PKI management operation.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3-2">
<pre>
extraCerts
    -- SHOULD contain the CMP protection certificate together with
    -- its chain, if needed and the self-signed root certificate
    -- SHOULD be omitted
    -- If present, the first certificate in this field MUST be
    -- the CMP protection certificate and each followed by its chain
    -- where each element SHOULD directly certify the one
    -- immediately preceding it.
    -- Self-signed certificates SHOULD be omitted from extraCerts,
    -- unless they are the same as the protection certificate and
    -- MUST NOT be trusted based on their inclusion in any case
</pre><a href="#section-3.3-2" class="pilcrow">¶</a>
</div>
<p id="section-3.3-3">Note: For maximum compatibility, all implementations SHOULD be prepared to handle potentially additional certificates and arbitrary orderings of the certificates.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="EE_UseCases">
<section id="section-4">
      <h2 id="name-end-entity-pki-management-o">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-end-entity-pki-management-o" class="section-name selfRef">End Entity PKI management operations</a>
      </h2>
<p id="section-4-1">This chapter focuses on the communication of the EE with the PKI management entity it immediately talks to.  Depending on the network and PKI solution, this can be an LRA, RA, or directly a CA.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2" class="keepWithNext">The PKI management operations specified in this section cover the following:<a href="#section-4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-3.1">Requesting a certificate from a PKI with variations like initial enrollment and updates, central key generation, and various protection mechanisms<a href="#section-4-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-3.2">Revocation of a certificate<a href="#section-4-3.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-3.3">General messages for further support functions<a href="#section-4-3.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-4-4">These operations mainly specify the message body of the CMP messages and utilize the specification of the message header, protection and extraCerts as specified in <a href="#EE_UseCases" class="xref">Section 4</a>.<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">The behavior in case an error occurs is described in <a href="#EE_Error" class="xref">Section 4.3</a>.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">This section is aligned with <span><a href="#RFC4210" class="xref">RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span>. The general rules for interpretation stated in <span><a href="#RFC4210" class="xref">Appendix D.1 of RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span> shall be applied here, too.<a href="#section-4-6" class="pilcrow">¶</a></p>
<p id="section-4-7">Guidelines as well as an algorithm use profile for this document are available in CMP Algorithms [draft-ietf-lamps-cmp-algorithms].<a href="#section-4-7" class="pilcrow">¶</a></p>
<div id="EE_request">
<section id="section-4.1">
        <h3 id="name-requesting-a-new-certificat">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-requesting-a-new-certificat" class="section-name selfRef">Requesting a new certificate from a PKI</a>
        </h3>
<p id="section-4.1-1">There are various approaches for requesting a certificate from a PKI.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2" class="keepWithNext">These approaches differ in the way the EE authenticates itself to the PKI and in the way that the key pair to be certified is generated.  The authentication mechanisms may be as follows:<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-3.1">Using a certificate from a trusted PKI and the corresponding private key, e.g., a manufacturer issued certificate<a href="#section-4.1-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-3.2">Using the certificate to be updated and the corresponding private key<a href="#section-4.1-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-3.3">Using shared secret information known to the EE and the PKI<a href="#section-4.1-3.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.1-4">An EE requests a certificate indirectly or directly from a CA.  When the PKI management entity responds with a message containing the requested certificate, the EE MUST reply with a confirmation message.  The PKI management entity then MUST respond with a confirmation, closing the transaction.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">The message sequences in this section allow the EE to request certification of a locally generated public-private key pair. For requirements regarding proper random number and key generation please refer to <span>[<a href="#RFC4086" class="xref">RFC4086</a>]</span>. The EE SHOULD provide a signature-based proof-of-possession of the private key associated with the public key contained in the certificate request as defined by <span><a href="#RFC4211" class="xref">RFC 4211 Section 4.1</a> [<a href="#RFC4211" class="xref">RFC4211</a>]</span> case 3. To this end it is assumed that the private key can technically be used for signing.  This is the case for the most commonly used algorithms RSA and ECDSA, regardless of potentially intended restrictions of the key usage.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1-6">Note: In conformance with <span><a href="#NIST.SP.800-57p1r5" class="xref">NIST SP 800-57 Part 1 Section 8.1.5.1.1.2</a> [<a href="#NIST.SP.800-57p1r5" class="xref">NIST.SP.800-57p1r5</a>]</span> the newly generated private key MAY be used for self-signature, if technically possible, even if the keyUsage extension requested in the certificate request prohibits generation of digital signatures.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<p id="section-4.1-7">The requesting EE provides the binding of the proof-of-possession to its identity by signature-based or MAC-based protection of the CMP request message containing that POPO. As will be detailed in <a href="#RA_Replace" class="xref">Section 5.1.2</a>, the targeted  PKI management entity should verify whether this EE is authorized to obtain a certificate with the requested subject and other fields and extensions. Especially when removing the protection provided by the EE and applying a new protection, the PKI management entity MUST verify in particular the included proof-of-possession self-signature of the certTemplate or the PKCS#10 certificationRequestInfo using the public key of the requested certificate and MUST check that the EE, as authenticated by the message protection, is authorized to request a certificate with the subject as specified in the certTemplate.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1-8">When an EE verifies the protection of a response message with signature-based protection it needs a trust anchor to verify the protection certificate. There are several ways to install the Root CA certificate of a new PKI on an EE. The installation can be performed in an out-of-band manner, using general messages, a <span><a href="#RFC8366" class="xref">voucher</a> [<a href="#RFC8366" class="xref">RFC8366</a>]</span>, or other formats for enrollment, or in-band of CMP by the caPubs field in the certificate response message. In case the installation of the new root CA certificate is performed using the caPubs field, the certificate response message MUST be properly authenticated, and the sender of this message MUST be authorized to install new root CA certificates on the EE. This authorization is typically indicated by using shared secret information, but it can also be indicated by using a private key with a certificate issued by another PKI authorized for this purpose, for the CMP message protection.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
<div id="EE_newPKI">
<section id="section-4.1.1">
          <h4 id="name-requesting-a-certificate-fr">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-requesting-a-certificate-fr" class="section-name selfRef">Requesting a certificate from a new PKI with signature protection</a>
          </h4>
<p id="section-4.1.1-1">This PKI management operation should be used by an EE to request a certificate from a new PKI using an existing certificate from an external PKI, e.g., a manufacturer-issued IDevID certificate <span>[<a href="#IEEE.802.1AR_2018" class="xref">IEEE.802.1AR_2018</a>]</span>, to authenticate itself to the new PKI. The EE already has established trust in this new PKI it is about to enroll to, e.g., by voucher exchange or configuration means. The certificate request message is signature-protected using the existing certificate from the external PKI.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.1-2" class="keepWithNext">Preconditions:<a href="#section-4.1.1-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-4.1.1-3">
     <dt>1</dt>
<dd id="section-4.1.1-3.1">The EE MUST have a certificate enrolled by an external PKI in advance to this PKI management operation to authenticate itself to the PKI management entity using signature-based protection, e.g., using a manufacturer issued certificate.<a href="#section-4.1.1-3.1" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>2</dt>
<dd id="section-4.1.1-3.2">The EE SHOULD know the subject name of the new CA it requests a certificate from; this name MAY be established using an enrollment voucher, the issuer field from a CertReqTemplate response message, or other configuration means. If the EE does not know the name of the CA, the PKI management entity MUST know where to route these requests to.<a href="#section-4.1.1-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>3</dt>
<dd id="section-4.1.1-3.3">The EE MUST authenticate responses from the PKI management entity; trust MAY be established using an enrollment voucher or other configuration means.<a href="#section-4.1.1-3.3" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>4</dt>
<dd id="section-4.1.1-3.4">The PKI management entity MUST trust the external PKI the EE uses to authenticate itself; trust MAY be established using some configuration means.<a href="#section-4.1.1-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.1.1-4">The general message flow for this PKI management operation is like that given in <span><a href="#RFC4210" class="xref">RFC 4210 Appendix E.7</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span>.<a href="#section-4.1.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1.1-5" class="keepWithNext">Message flow:<a href="#section-4.1.1-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.1-6">
<pre>
Step# EE                                  PKI management entity
  1   format ir
  2                      -&gt;   ir      -&gt;
  3                                        handle, re-protect or
                                             forward ir
  4                                        format or receive ip
  5                                        possibly grant implicit
                                             confirm
  6                      &lt;-   ip      &lt;-
  7   handle ip
  8                                        In case of status
                                             "rejection" in the
                                             ip message, no certConf
                                             and pkiConf are sent
  9   format certConf (optional)
 10                      -&gt;   certConf -&gt;
 11                                        handle, re-protect or
                                             forward certConf
 12                                        format or receive pkiConf
 13                      &lt;-   pkiconf  &lt;-
 14   handle pkiConf (optional)
</pre><a href="#section-4.1.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.1.1-7">For this PKI management operation, the EE MUST include exactly one single CertReqMsg in the ir.  If more certificates are required, further requests MUST be sent using separate PKI management operation.  If the EE wants to omit sending a certificate confirmation message after receiving the ip, e.g., to reduce the number of protocol messages exchanged in this PKI management operation, it MUST request this by including the implicitConfirm extension in the header of the ir message, see <a href="#Header" class="xref">Section 3.1</a>.<a href="#section-4.1.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1.1-8">If the request was accepted and a new certificate was issued by the CA, the PKI management entity MUST return the new certificate in the certifiedKeyPair field of the ip message.  If the EE requested omission of the certConf message, the PKI management entity MAY grant this by including the implicitConfirm extension, else this is rejected by not including the implicitConfirm field in the ip message.<a href="#section-4.1.1-8" class="pilcrow">¶</a></p>
<p id="section-4.1.1-9">If the EE did not request implicit confirmation or the request was not granted by the PKI management entity, certificate confirmation MUST be performed as follows.  If the EE successfully received the certificate and accepts it, the EE MUST send a certConf message, which the PKI management entity must respond using a pkiConf message.  If the PKI management entity does not receive the expected certConf message in time it MUST handle this like a rejection by the EE.  In this case the PKI management entity SHALL terminate the PKI management operation.  The PKI MAY revoke the newly issued certificates depending on the local policy.<a href="#section-4.1.1-9" class="pilcrow">¶</a></p>
<p id="section-4.1.1-10">If the certificate request was rejected by the CA, the PKI management entity must return an ip message containing the status code "rejection" as described in <a href="#RA_Error" class="xref">Section 5.3</a> and no certifiedKeyPair field.  The EE MUST NOT react to such an ip message with a certConf message and the PKI management operation MUST be terminated.<a href="#section-4.1.1-10" class="pilcrow">¶</a></p>
<p id="section-4.1.1-11" class="keepWithNext">Detailed message description:<a href="#section-4.1.1-11" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.1-12">
<pre>
Certification Request -- ir

Field                         Value

header
    -- As described in Section 3.1

body
    -- The request of the EE for a new certificate
  ir                          REQUIRED
    -- MUST be exactly one CertReqMsg
    -- If more certificates are required, further requests MUST be
    -- packaged in separate PKI Messages
    certReq                   REQUIRED
      certReqId               REQUIRED
    -- MUST be set to 0
      certTemplate            REQUIRED
        version               OPTIONAL
    -- MUST be 2 if supplied.
        subject               REQUIRED
    -- The EE subject name MUST be carried in the subject field
    -- and/or the subjectAltName extension.
    -- If subject name is present only in the subjectAltName
    -- extension, then the subject field MUST be a NULL-DN
        publicKey             REQUIRED
          algorithm           REQUIRED
    -- MUST include the subject public key algorithm OID and valueany
    -- parameters
    -- In case a central key generation is requested, this field
    -- contains the algorithm and parameter preferences of the
    -- requesting entity regarding the to-be-generated key pair
          subjectPublicKey    REQUIRED
    -- MUST contain the public key to be certified in case of
    -- local key generation
    -- MUST contain a zero-length BIT STRING in case a central key
    -- generation is requested
        extensions            OPTIONAL
    -- MAY include end-entity-specific X.509 extensions of the
    -- requested certificate like subject alternative name,
    -- key usage, and extended key usage
    -- The subjectAltName extension MUST be present if the EE
    -- subject name includes a subject alternative name.
    Popo                      REQUIRED
      POPOSigningKey          OPTIONAL
    -- MUST be used in case subjectPublicKey contains a public key
    -- MUST be absent in case subjectPublicKey contains a
    -- zero-length BIT STRING
        poposkInput           PROHIBITED
    -- MUST NOT be used; it is not needed because subject and
    -- publicKey are both present in the certTemplate
        algorithmIdentifier   REQUIRED
    -- The signature algorithm MUST be consistent with the
    -- publicKey field of the certTemplate
        signature             REQUIRED
    -- MUST be the signature computed over the DER-encoded
    -- certTemplate

protection                    REQUIRED
    -- As described in Section 3.2

extraCerts                    REQUIRED
    -- As described in Section 3.3


Certification Response -- ip

Field                         Value

header
    -- As described in Section 3.1

body
    -- The response of the CA to the request as appropriate
  ip                          REQUIRED
    caPubs                    OPTIONAL
    -- MAY be used
    -- If used it MUST contain only the root certificate of the
    -- certificate contained in certOrEncCert
    response                  REQUIRED
    -- MUST be exactly one CertResponse
      certReqId               REQUIRED
    -- MUST be set to 0
      status                  REQUIRED
    -- PKIStatusInfo structure MUST be present
        status                REQUIRED
    -- positive values allowed: "accepted", "grantedWithMods"
    -- negative values allowed: "rejection"
        statusString          OPTIONAL
    -- MAY be any human-readable text for debugging, logging or to
    -- display in a GUI
        failInfo              OPTIONAL
    -- MUST be present if status is "rejection"
    -- MUST be absent if the status is "accepted" or
    -- "grantedWithMods"
      certifiedKeyPair        OPTIONAL
    -- MUST be present if status is "accepted" or "grantedWithMods"
    -- MUST be absent if status is "rejection"
        certOrEncCert         REQUIRED
    -- MUST be present when certifiedKeyPair is present
          certificate         REQUIRED
    -- MUST be present when certifiedKeyPair is present
    -- MUST contain the newly enrolled X.509 certificate
        privateKey            OPTIONAL
    -- MUST be absent in case of local key-generation
    -- MUST contain the encrypted private key in an EnvelopedData
    -- structure as specified in section 5.1.5 in case the private
    -- key was generated centrally

protection                    REQUIRED
    -- As described in Section 3.2

extraCerts                    REQUIRED
    -- As described in Section 3.3
    -- MUST contain the chain of the certificate present in
    -- certOrEncCert
    -- Self-signed root certificate SHOULD be omitted
    -- Duplicate certificates MAY be omitted


Certificate Confirmation -- certConf

Field                         Value

header
    -- As described in Section 3.1

body
    -- The message of the EE sends confirmation to the PKI
    -- management entity to accept or reject the issued certificates
  certConf                    REQUIRED
    -- MUST be exactly one CertStatus
    CertStatus                REQUIRED
      certHash                REQUIRED
    -- MUST be the hash of the certificate, using the same hash
    -- algorithm as used to create the certificate signature
      certReqId               REQUIRED
    -- MUST be set to 0
      statusInfo              RECOMMENDED
    -- PKIStatusInfo structure SHOULD be present
    -- Omission indicates acceptance of the indicated certificate
        status                REQUIRED
    -- positive values allowed: "accepted"
    -- negative values allowed: "rejection"
        statusString          OPTIONAL
    -- MAY be any human-readable text for debugging, logging, or to
    -- display in a GUI
        failInfo              OPTIONAL
    -- MUST be present if status is "rejection"
    -- MUST be absent if the status is "accepted"

protection                    REQUIRED
    -- As described in Section 3.2
    -- MUST use the same certificate as for protecting the ir

extraCerts                    RECOMMENDED
    -- As described in Section 3.3
    -- Any certificates in extraCerts MAY be omitted if the message
    -- size is critical and the PKI management entity caches the
    -- extraCerts from the ir

PKI Confirmation -- pkiconf

Field                         Value

header
    -- As described in Section 3.1

body
  pkiconf                     REQUIRED
    -- The content of this field MUST be NULL

protection                    REQUIRED
    -- As described in Section 3.2
    -- MUST use the same certificate as for protecting the ip
extraCerts                    RECOMMENDED
    -- As described in Section 3.3
    -- Any certificates in extraCerts MAY be omitted if the message
    -- size is critical and the EE has cached the extraCerts from the
    -- ip
</pre><a href="#section-4.1.1-12" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="EE_trustedPKI">
<section id="section-4.1.2">
          <h4 id="name-requesting-a-certificate-fro">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-requesting-a-certificate-fro" class="section-name selfRef">Requesting a certificate from a trusted PKI with signature protection</a>
          </h4>
<p id="section-4.1.2-1">This PKI management operation should be used by an EE to request an additional certificate of the same PKI it already has certificates from.  The EE uses one of these existing certificates to authenticate itself by signing its request messages using the respective private key.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.2-2">The general message flow for this PKI management operation is the same as given in <a href="#EE_newPKI" class="xref">Section 4.1.1</a>.<a href="#section-4.1.2-2" class="pilcrow">¶</a></p>
<p id="section-4.1.2-3" class="keepWithNext">Preconditions:<a href="#section-4.1.2-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-4.1.2-4">
     <dt>1</dt>
<dd id="section-4.1.2-4.1">The EE MUST have a certificate enrolled by the PKI it requests another certificate from in advance to this PKI management operation to authenticate itself to the PKI management entity using signature-based protection.<a href="#section-4.1.2-4.1" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>2</dt>
<dd id="section-4.1.2-4.2">The EE SHOULD know the subject name of the CA it requests a certificate from; this name MAY be established using an enrollment voucher, the issuer field from a CertReqTemplate response message, or other configuration means. If the EE does not know the name of the CA, the PKI management entity MUST know where to route this request to.<a href="#section-4.1.2-4.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>3</dt>
<dd id="section-4.1.2-4.3">The EE MUST authenticate responses from the PKI management entity; trust MAY be established using an enrollment voucher or other configuration means.<a href="#section-4.1.2-4.3" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>4</dt>
<dd id="section-4.1.2-4.4">The PKI management entity MUST trust the current PKI; trust MAY be established using some configuration means.<a href="#section-4.1.2-4.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.1.2-5">The message sequence for this PKI management operation is like that given in <span>[<a href="#RFC4210" class="xref">RFC4210</a>]</span> Appendix D.5.<a href="#section-4.1.2-5" class="pilcrow">¶</a></p>
<p id="section-4.1.2-6" class="keepWithNext">The message sequence for this PKI management operation is identical to that given in <a href="#EE_newPKI" class="xref">Section 4.1.1</a>, with the following changes:<a href="#section-4.1.2-6" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-4.1.2-7">
     <dt>1</dt>
<dd id="section-4.1.2-7.1">The body of the first request and response MUST be cr and cp, respectively.<a href="#section-4.1.2-7.1" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>2</dt>
<dd id="section-4.1.2-7.2">The caPubs field in the cp message SHOULD be absent.<a href="#section-4.1.2-7.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="EE_Update">
<section id="section-4.1.3">
          <h4 id="name-updating-an-existing-certif">
<a href="#section-4.1.3" class="section-number selfRef">4.1.3. </a><a href="#name-updating-an-existing-certif" class="section-name selfRef">Updating an existing certificate with signature protection</a>
          </h4>
<p id="section-4.1.3-1">This PKI management operation should be used by an EE to request an update for one of its certificates that is still valid.  The EE uses the certificate it wishes to update to authenticate itself and for proving ownership of the certificate to be updated by signing its request messages with the corresponding private key.<a href="#section-4.1.3-1" class="pilcrow">¶</a></p>
<p id="section-4.1.3-2">The general message flow for this PKI management operation is the same as given in <a href="#EE_newPKI" class="xref">Section 4.1.1</a>.<a href="#section-4.1.3-2" class="pilcrow">¶</a></p>
<p id="section-4.1.3-3" class="keepWithNext">Preconditions:<a href="#section-4.1.3-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-4.1.3-4">
     <dt>1</dt>
<dd id="section-4.1.3-4.1">The certificate the EE wishes to update MUST NOT be expired or revoked.<a href="#section-4.1.3-4.1" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>2</dt>
<dd id="section-4.1.3-4.2">A new public-private key pair SHOULD be used.<a href="#section-4.1.3-4.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.1.3-5">The message sequence for this PKI management operation is like that given in <span>[<a href="#RFC4210" class="xref">RFC4210</a>]</span> Appendix D.6.<a href="#section-4.1.3-5" class="pilcrow">¶</a></p>
<p id="section-4.1.3-6" class="keepWithNext">The message sequence for this PKI management operation is identical to that given in <a href="#EE_newPKI" class="xref">Section 4.1.1</a>, with the following changes:<a href="#section-4.1.3-6" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-4.1.3-7">
     <dt>1</dt>
<dd id="section-4.1.3-7.1">The body of the first request and response MUST be kur and kup, respectively.<a href="#section-4.1.3-7.1" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>2</dt>
<dd id="section-4.1.3-7.2">Protection of the kur MUST be performed using the certificate to be updated.<a href="#section-4.1.3-7.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>3</dt>
<dd id="section-4.1.3-7.3">The subject field and/or the subjectAltName extension of the CertTemplate MUST contain the EE subject name of the existing certificate to be updated, without modifications.<a href="#section-4.1.3-7.3" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>4</dt>
<dd id="section-4.1.3-7.4">The CertTemplate SHOULD contain the subject and publicKey of the EE only.<a href="#section-4.1.3-7.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>5</dt>
<dd id="section-4.1.3-7.5">The oldCertId control SHOULD be used to make clear which certificate is to be updated.<a href="#section-4.1.3-7.5" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>6</dt>
<dd id="section-4.1.3-7.6">The caPubs field in the kup message MUST be absent.<a href="#section-4.1.3-7.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.1.3-8" class="keepWithNext">As part of the certReq structure of the kur the oldCertId control is added right after the certTemplate.<a href="#section-4.1.3-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.3-9">
<pre>
    controls
      type                    RECOMMENDED
    -- MUST be the value id-regCtrl-oldCertID, if present
      value
        issuer                REQUIRED
        serialNumber          REQUIRED
    -- MUST contain the issuer and serialNumber of the certificate
    -- to be updated
</pre><a href="#section-4.1.3-9" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="EE_MAC">
<section id="section-4.1.4">
          <h4 id="name-requesting-a-certificate-from">
<a href="#section-4.1.4" class="section-number selfRef">4.1.4. </a><a href="#name-requesting-a-certificate-from" class="section-name selfRef">Requesting a certificate from a PKI with MAC protection</a>
          </h4>
<p id="section-4.1.4-1">This PKI management operation should be used by an EE to request a certificate of a new PKI without having a certificate to prove its identity to the target PKI, but there is shared secret information established between the EE and the PKI. Therefore, the initialization request is MAC-protected using this shared secret information. The PKI management entity checking the MAC-based protection SHOULD replace this protection according to <a href="#RA_Replace" class="xref">Section 5.1.2</a> in case the next hop does not know the shared secret information.<a href="#section-4.1.4-1" class="pilcrow">¶</a></p>
<p id="section-4.1.4-2">For requirements regarding proper random number and key generation please refer to <span>[<a href="#RFC4086" class="xref">RFC4086</a>]</span>.<a href="#section-4.1.4-2" class="pilcrow">¶</a></p>
<p id="section-4.1.4-3">The general message flow for this PKI management operation is the same as given in <a href="#EE_newPKI" class="xref">Section 4.1.1</a>.<a href="#section-4.1.4-3" class="pilcrow">¶</a></p>
<p id="section-4.1.4-4" class="keepWithNext">Preconditions:<a href="#section-4.1.4-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-4.1.4-5">
     <dt>1</dt>
<dd id="section-4.1.4-5.1">The EE and the PKI management entity MUST share secret information, this MAY be established by a service technician during initial local configuration.<a href="#section-4.1.4-5.1" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>2</dt>
<dd id="section-4.1.4-5.2">The EE SHOULD know the subject name of the new CA it requests a certificate from; this name MAY be established using an enrollment voucher, the issuer field from a CertReqTemplate response message, or other configuration means. If the EE does not know the name of the CA, the PKI management entity MUST know where to route this request to.<a href="#section-4.1.4-5.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>3</dt>
<dd id="section-4.1.4-5.3">The EE MUST authenticate responses from the PKI management entity; trust is established using the shared secret information.<a href="#section-4.1.4-5.3" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.1.4-6">The message sequence for this PKI management operation is like that given in <span>[<a href="#RFC4210" class="xref">RFC4210</a>]</span> Appendix D.4.<a href="#section-4.1.4-6" class="pilcrow">¶</a></p>
<p id="section-4.1.4-7" class="keepWithNext">The message sequence for this PKI management operation is identical to that given in <a href="#EE_newPKI" class="xref">Section 4.1.1</a>, with the following changes:<a href="#section-4.1.4-7" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-4.1.4-8">
     <dt>1</dt>
<dd id="section-4.1.4-8.1">The protection of all messages MUST be calculated using Message Authentication Code (MAC).<a href="#section-4.1.4-8.1" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>2</dt>
<dd id="section-4.1.4-8.2">The sender MUST contain a name representing the originator of the message. The senderKID MUST contain a reference all participating entities can use to identify the shared secret information used for the protection, e.g., the username of the EE.<a href="#section-4.1.4-8.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>3</dt>
<dd id="section-4.1.4-8.3">The extraCerts of the ir, certConf, and pkiConf messages MUST be absent.<a href="#section-4.1.4-8.3" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>4</dt>
<dd id="section-4.1.4-8.4">The extraCerts of the ip message MUST contain the chain of the issued certificate and root certificates SHOULD not be included and MUST NOT be directly trusted in any case.<a href="#section-4.1.4-8.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.1.4-9">See <a href="#Transport_variants" class="xref">Section 6</a> of <span><a href="#I-D.ietf-lamps-cmp-algorithms" class="xref">CMP Algorithms</a> [<a href="#I-D.ietf-lamps-cmp-algorithms" class="xref">I-D.ietf-lamps-cmp-algorithms</a>]</span> for details on message authentication code algorithms (MSG_MAC_ALG) to use. Typically, parameters are part of the protectionAlg structure, e.g., used for key derivation, like a salt and an iteration count.  Such fields SHOULD remain constant for message protection throughout this PKI management operation to reduce the computational overhead.<a href="#section-4.1.4-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="EE_P10">
<section id="section-4.1.5">
          <h4 id="name-requesting-a-certificate-from-">
<a href="#section-4.1.5" class="section-number selfRef">4.1.5. </a><a href="#name-requesting-a-certificate-from-" class="section-name selfRef">Requesting a certificate from a legacy PKI using PKCS#10 request</a>
          </h4>
<p id="section-4.1.5-1">This PKI management operation can be used by an EE to request a certificate using a legacy <span><a href="#RFC2986" class="xref">PKCS#10</a> [<a href="#RFC2986" class="xref">RFC2986</a>]</span> request instead of <span><a href="#RFC4211" class="xref">CRMF</a> [<a href="#RFC4211" class="xref">RFC4211</a>]</span>. The EE can prove its identity to the target PKI by using various protection means as described in <a href="#EE_newPKI" class="xref">Section 4.1.1</a> or <a href="#EE_MAC" class="xref">Section 4.1.4</a>.<a href="#section-4.1.5-1" class="pilcrow">¶</a></p>
<p id="section-4.1.5-2">This operation should be used only for compatibility reasons if the other PKI management operations described in <a href="#EE_request" class="xref">Section 4.1</a> are not possible, for instance because a legacy component of the EE only produces PKCS#10 requests or a legacy CA system can handle only PKCS#10 requests. In such case the PKI management entity MUST extract the PKCS#10 certificate request from the p10cr and provids it separately to the CA.<a href="#section-4.1.5-2" class="pilcrow">¶</a></p>
<p id="section-4.1.5-3">The general message flow for this PKI management operation is the same as given in <a href="#EE_newPKI" class="xref">Section 4.1.1</a>, but the public key and all further certificate template date is contained in the subjectPKInfo and other certificationRequestInfo fields of the PKCS#10 certificate request.<a href="#section-4.1.5-3" class="pilcrow">¶</a></p>
<p id="section-4.1.5-4" class="keepWithNext">Preconditions:<a href="#section-4.1.5-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-4.1.5-5">
     <dt>1</dt>
<dd id="section-4.1.5-5.1">The EE MUST either have a certificate enrolled from this or any other accepted PKI, or shared secret information known to the PKI and the EE to authenticate itself to the RA.<a href="#section-4.1.5-5.1" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>2</dt>
<dd id="section-4.1.5-5.2">The EE SHOULD know the subject name of the CA it requests a certificate from; this name MAY be established using an enrollment voucher, the issuer field from a CertReqTemplate response message, or other configuration means. If the EE does not know the name of the CA, the RA MUST know where to route this request to.<a href="#section-4.1.5-5.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>3</dt>
<dd id="section-4.1.5-5.3">The EE MUST authenticate responses from the RA; trust MAY be established by an available root certificate, using an enrollment voucher, or other configuration means.<a href="#section-4.1.5-5.3" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>4</dt>
<dd id="section-4.1.5-5.4">The addressed PKI management entity MUST trust the PKI the EE uses to authenticate itself when using the signature protection; trust MAY be established by a corresponding available root certificate or using some configuration means. When using MAC-based protection the EE and PKI must share secret information.<a href="#section-4.1.5-5.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.1.5-6" class="keepWithNext">The message sequence for this PKI management operation is identical to that given in <a href="#EE_newPKI" class="xref">Section 4.1.1</a>, with the following changes:<a href="#section-4.1.5-6" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-4.1.5-7">
<dt>1</dt>
<dd id="section-4.1.5-7.1">The body of the first request and response MUST be p10cr and cp, respectively.<a href="#section-4.1.5-7.1" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>2</dt>
<dd id="section-4.1.5-7.2">The certReqId in the cp message MUST be 0.<a href="#section-4.1.5-7.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>3</dt>
<dd id="section-4.1.5-7.3">The caPubs field in the cp message SHOULD be absent.<a href="#section-4.1.5-7.3" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.1.5-8" class="keepWithNext">Detailed description of the p10cr message:<a href="#section-4.1.5-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.5-9">
<pre>
Certification Request -- p10cr

Field                         Value

header
    -- As described in Section 3.1

body
    -- The request of the EE for a new certificate using a PKCS#10
    -- certificate request
  p10cr                       REQUIRED
    certificationRequestInfo  REQUIRED
      version                 REQUIRED
    -- MUST be set to 0 to indicate PKCS#10 V1.7
      subject                 REQUIRED
    -- The EE subject name MUST be carried in the subject field
    -- and/or the subjectAltName extension.
    -- If subject name is present only in the subjectAltName
    -- extension, then the subject field MUST be a NULL-DN
      subjectPKInfo           REQUIRED
        algorithm             REQUIRED
    -- MUST include the subject public key algorithm ID
        subjectPublicKey      REQUIRED
    -- MUST include the public key to be certified
      attributes              OPTIONAL
    -- MAY include end-entity-specific X.509 extensions of the
    -- requested certificate like subject alternative name,
    -- key usage, and extended key usage.
    -- The subjectAltName extension MUST be present if the EE
       -- subject name includes a subject alternative name.
    signatureAlgorithm        REQUIRED
    -- The signature algorithm MUST be consistent with the
    -- subjectPKInfo field.
    signature                 REQUIRED
    -- MUST containing the self-signature for proof-of-possession

protection                    REQUIRED
    -- As described in Section 3.2

extraCerts                    REQUIRED
    -- As described in Section 3.3
</pre><a href="#section-4.1.5-9" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="EE_centralKeyGeneration">
<section id="section-4.1.6">
          <h4 id="name-generateing-the-key-pair-ce">
<a href="#section-4.1.6" class="section-number selfRef">4.1.6. </a><a href="#name-generateing-the-key-pair-ce" class="section-name selfRef">Generateing the key pair centrally at the PKI management entity</a>
          </h4>
<p id="section-4.1.6-1">This functional extension can be applied in combination with certificate enrollment as described in <a href="#EE_newPKI" class="xref">Section 4.1.1</a>, <a href="#EE_trustedPKI" class="xref">Section 4.1.2</a>, and <a href="#EE_MAC" class="xref">Section 4.1.4</a>.  The functional extension can be used in case an EE is not able to generate its new public-private key pair itself or central generation the EE key material is preferred.  It is a matter of the local implementation which PKI management entity will act as Key Generation Authority (KGA) and perform the key generation.  This PKI management entity MUST have a certificate containing the additional extended key usage extension id-kp-cmKGA in order to be accepted by the EE as a legitimate key generation authority.   The KGA can use one of the PKI management operations described in the sections above to request the certificate for this key pair on behalf of the EE.<a href="#section-4.1.6-1" class="pilcrow">¶</a></p>
<p id="section-4.1.6-2">Generally speaking, in machine-to-machine scenarios it is strongly preferable to generate public-private key pairs locally at the EE.  Together with proof-of-possession of the private key in the certification request, this helps a lot to make sure that the entity identified in the newly issued certificate is the only entity that knows the private key.<a href="#section-4.1.6-2" class="pilcrow">¶</a></p>
<p id="section-4.1.6-3" class="keepWithNext">Reasons for central key generation may include the following:<a href="#section-4.1.6-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.6-4.1">Lack of sufficient initial entropy.<a href="#section-4.1.6-4.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.1.6-5">Note: Good random numbers are needed not only for key generation but also for session keys and nonces in any security protocol. Therefore, a decent security architecture should anyways support good random number generation on the EE side or provide enough initial entropy for the RNG seed to guarantee good pseudo-random number generation.  Yet maybe this is not the case at the time of requesting an initial certificate during manufacturing.<a href="#section-4.1.6-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.6-6.1">Lack of computational resources, e.g., in case of RSA key generation.<a href="#section-4.1.6-6.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.1.6-7">Note: Since key generation could be performed in advance to the certificate enrollment communication, it is often not time critical.<a href="#section-4.1.6-7" class="pilcrow">¶</a></p>
<p id="section-4.1.6-8">Note: As mentioned in <a href="#Architecture" class="xref">Section 2.1</a> central key generation may be required in a push model, where the certificate response message is transferred by the PKI management entity to the EE without a previous request message.<a href="#section-4.1.6-8" class="pilcrow">¶</a></p>
<p id="section-4.1.6-9">If the EE wishes to request central key generation, it MUST fill the subjectPublicKey field in the certTemplate structure of the request message with a zero-length BIT STRING. This indicates to the PKI management entity that a new key pair shall be generated centrally on behalf of the EE.<a href="#section-4.1.6-9" class="pilcrow">¶</a></p>
<p id="section-4.1.6-10">Note: As the protection of centrally generated keys in the response message is being extended from EncryptedValue to EncryptedKey by <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span>, also the alternative EnvelopedData can be used. In <span><a href="#RFC4211" class="xref">CRMF Section 2.1.9</a> [<a href="#RFC4211" class="xref">RFC4211</a>]</span> the use of EncryptedValue has been deprecated in favor of the EnvelopedData structure. Therefore, this profile requires using EnvelopedData as specified in <span><a href="#RFC5652" class="xref">CMS Section 6</a> [<a href="#RFC5652" class="xref">RFC5652</a>]</span>. When EnvelopedData is to be used in a transaction, CMP V3 MUST be indicated in the message header, see <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span>.<a href="#section-4.1.6-10" class="pilcrow">¶</a></p>
<span id="name-encrypted-private-key-conta"></span><div id="CMP_envelop">
<figure id="figure-3">
            <div class="artwork art-text alignCenter" id="section-4.1.6-11.1">
<pre>
+----------------------------------+
| EnvelopedData                    |
| [RFC5652] section 6              |
| +------------------------------+ |
| | SignedData                   | |
| | [RFC5652] section 5          | |
| | +--------------------------+ | |
| | | AsymmetricKeyPackage     | | |
| | | [RFC5958]                | | |
| | | +----------------------+ | | |
| | | | privateKey           | | | |
| | | | OCTET STRING         | | | |
| | | +----------------------+ | | |
| | +--------------------------+ | |
| +------------------------------+ |
+----------------------------------+
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-encrypted-private-key-conta" class="selfRef">Encrypted private key container</a>
            </figcaption></figure>
</div>
<p id="section-4.1.6-12">The PKI management entity delivers the private key in the privateKey field in the certifiedKeyPair structure of the response message also containing the newly issued certificate.<a href="#section-4.1.6-12" class="pilcrow">¶</a></p>
<p id="section-4.1.6-13">The private key MUST be provided as an AsymmetricKeyPackage structure as defined in <span><a href="#RFC5958" class="xref">RFC 5958</a> [<a href="#RFC5958" class="xref">RFC5958</a>]</span>.<a href="#section-4.1.6-13" class="pilcrow">¶</a></p>
<p id="section-4.1.6-14">This AsymmetricKeyPackage structure MUST be wrapped in a SignedData structure, as specified in <span><a href="#RFC5652" class="xref">CMS Section 5</a> [<a href="#RFC5652" class="xref">RFC5652</a>]</span>, signed by the KGA generating the key pair. The signature MUST be performed using a private key related to a certificate asserting the extended key usage kp-id-cmKGA as described in <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span> in order to show the authorization to generate key pairs on behalf of an EE.<a href="#section-4.1.6-14" class="pilcrow">¶</a></p>
<p id="section-4.1.6-15">Note: When of using password-based key management technique as described in <a href="#EE_KGPB" class="xref">Section 4.1.6.3</a> it may not be possible or meaningful to the EE to validate the KGA signature in the SignedData structure since shared secret information is used for initial authentication. In this case the EE MAY omit this signature validation.<a href="#section-4.1.6-15" class="pilcrow">¶</a></p>
<p id="section-4.1.6-16">This SignedData structure MUST be wrapped in an EnvelopedData structure, as specified in <span><a href="#RFC5652" class="xref">CMS Section 6</a> [<a href="#RFC5652" class="xref">RFC5652</a>]</span>, encrypting it using a newly generated symmetric content-encryption key.<a href="#section-4.1.6-16" class="pilcrow">¶</a></p>
<p id="section-4.1.6-17">This content-encryption key MUST be securely provided as part of the EnvelopedData structure to the EE using one of three key management techniques. The choice of the key management technique to be used by the PKI management entity depends on the authentication mechanism the EE choose to protect the request message. See <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates section 3.4</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span> for more details on which key management technique to use.<a href="#section-4.1.6-17" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.6-18.1">
              <p id="section-4.1.6-18.1.1">Signature-protected request message:<a href="#section-4.1.6-18.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.6-18.1.2.1">The content-encryption key SHALL be protected using the key agreement key management technique, see <a href="#EE_KGAgree" class="xref">Section 4.1.6.1</a>, if the certificate used by the EE for protecting the request message allows the key usage keyAgreement.  If the certificate also allows the key usage keyEncipherment, the key transport key management technique SHALL NOT be used.<a href="#section-4.1.6-18.1.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.1.6-18.1.2.2">The content-encryption key SHALL be protected using the key transport key management technique, see <a href="#EE_KGTrans" class="xref">Section 4.1.6.2</a>, if the certificate used by the EE for protecting the respective request message allows the key usage keyEncipherment but not keyAgreement.<a href="#section-4.1.6-18.1.2.2" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.1.6-18.2">
              <p id="section-4.1.6-18.2.1">MAC-protected request message:<a href="#section-4.1.6-18.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.6-18.2.2.1">The content-encryption key SHALL be protected using the password-based key management technique, see <a href="#EE_KGPB" class="xref">Section 4.1.6.3</a>, if and only if the EE used MAC protection for the request message.<a href="#section-4.1.6-18.2.2.1" class="pilcrow">¶</a>
</li>
              </ul>
</li>
          </ul>
<p id="section-4.1.6-19">If central key generation is supported, support of the key agreement key management technique is REQUIRED and support of key transport and password-based key management techniques are OPTIONAL.  This is due to two reasons: The key agreement key management technique is supported by most asymmetric algorithms, while the key transport key management technique is supported only by a very few asymmetric algorithms.  And as mentioned the password-based key management technique shall only be used in combination with MAC protection, which is a sideline in this document.<a href="#section-4.1.6-19" class="pilcrow">¶</a></p>
<p id="section-4.1.6-20">For details on algorithms to be used, please see <span><a href="#I-D.ietf-lamps-cmp-algorithms" class="xref">CMP Algorithms Section 4 and 5</a> [<a href="#I-D.ietf-lamps-cmp-algorithms" class="xref">I-D.ietf-lamps-cmp-algorithms</a>]</span>.<a href="#section-4.1.6-20" class="pilcrow">¶</a></p>
<p id="section-4.1.6-21">For encrypting the SignedData structure containing the private key a fresh content-encryption key MUST be generated with sufficient entropy for the symmetric encryption algorithm used.<a href="#section-4.1.6-21" class="pilcrow">¶</a></p>
<p id="section-4.1.6-22">Note: Depending on the lifetime of the certificate and the criticality of the generated private key, it is advisable to use the strongest available symmetric encryption algorithm.<a href="#section-4.1.6-22" class="pilcrow">¶</a></p>
<p id="section-4.1.6-23" class="keepWithNext">The detailed description of the privateKey field as follows:<a href="#section-4.1.6-23" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.6-24">
<pre>
        privateKey            OPTIONAL
    -- MUST be an EnvelopedData structure as specified in
    -- CMS [RFC5652] section 6
          version             REQUIRED
    -- MUST be set to 2 for recipientInfo type KeyAgreeRecipientInfo
    -- and KeyTransRecipientInfo
    -- MUST be set to 0 for recipientInfo type PasswordRecipientInfo
          recipientInfos      REQUIRED
    -- MUST be exactly one RecipientInfo
            recipientInfo     REQUIRED
    -- MUST be either KeyAgreeRecipientInfo (see section 4.1.6.1),
    -- KeyTransRecipientInfo (see section 4.1.6.2), or
    -- PasswordRecipientInfo (see section 4.1.6.3)
    -- If central key generation is supported, support of
    -- KeyAgreeRecipientInfo is REQUIRED and support of
    -- KeyTransRecipientInfo and PasswordRecipientInfo are OPTIONAL
          encryptedContentInfo
                              REQUIRED
            contentType       REQUIRED
    -- MUST be id-signedData
            contentEncryptionAlgorithm
                              REQUIRED
    -- MUST specify the algorithm OID of the algorithm used for
    -- content encryption
    -- The algorithm MUST be a PROT_SYM_ALG as specified in
    -- RFC-CMP-Alg Section 5
            encryptedContent  REQUIRED
    -- MUST be the SignedData structure as specified in
    -- CMS Section 5 [RFC5652] in encrypted form
              version         REQUIRED
    -- MUST be set to 3 if X.509 V3 certificates are included
              digestAlgorithms
                              REQUIRED
    -- MUST be exactly one digestAlgorithm OID
                digestAlgorithmIdentifier
                              REQUIRED
    -- MUST be the OID of the digest algorithm used for generating
    -- the signature and match the signature algorithm specified in
    -- signatureAlgorithm
              encapContentInfo
                              REQUIRED
    -- MUST contain the content that is to be signed
                eContentType   REQUIRED
    -- MUST be id-ct-KP-aKeyPackage as specified in [RFC5958]
                eContent       REQUIRED
                  AsymmetricKeyPackage
                              REQUIRED
    -- MUST contain exactly one OneAsymmetricKey element
                    OneAsymmetricKey
                              REQUIRED
                      version REQUIRED
    -- MUST be set to 1
                      privateKeyAlgorithm
                              REQUIRED
    -- The privateKeyAlgorithm field MUST contain
    -- the OID of the asymmetric key pair algorithm
                      privateKey
                              REQUIRED
    -- MUST contain the new private key
                      attributes
                              OPTIONAL
    -- The attributes field SHOULD not be used
                      publicKey
                              REQUIRED
    -- MUST contain the public key corresponding to the private key
    -- for simplicity and consistency with V2 of OneAsymmetricKey
              certificates    REQUIRED
    -- SHOULD contain the certificate, for the private key used
    -- to sign the content, together with its chain
    -- If present, the first certificate in this field MUST
    -- be the certificate used for protecting this content
    -- Self-signed certificates SHOULD NOT be included
    -- and MUST NOT be trusted based on their inclusion in any case
              crls            OPTIONAL
    -- MAY be present to provide status information on the protection
    -- certificate or its CA certificates
              signerInfos     REQUIRED
    -- MUST be exactly one signerInfo
                version       REQUIRED
    -- MUST be set to 3
                sid           REQUIRED
                  subjectKeyIdentifier
                              REQUIRED
    -- MUST be the subjectKeyIdentifier of the protection certificate
                digestAlgorithm
                              REQUIRED
    -- MUST be the same as in digestAlgorithmIdentifier
                signedAttrs   REQUIRED
    -- MUST contain an id-contentType attribute containing the same
    -- value as eContentType
    -- MUST contain an id-messageDigest attribute containing the
    -- message digest of eContent
    -- MAY contain an id-signingTime attribute containing the time of
    -- signature
    -- For details on the signed attributes see CMS Section 5.3
    -- and Section 11 [RFC5652]
                signatureAlgorithm
                              REQUIRED
    -- MUST be the algorithm OID of the signature algorithm used for
    -- calculation of the signature bits
    -- The signature algorithm MUST be a MSG_SIG_ALG as specified in
    -- RFC-CMP-Alg Section 3 and MUST be consistent with the
    -- subjectPublicKeyInfo field of the CMP KGA certificate
                signature     REQUIRED
    -- MUST be the result of the digital signature generation
</pre><a href="#section-4.1.6-24" class="pilcrow">¶</a>
</div>
<p id="section-4.1.6-25">NOTE: As defined in Section 1.5 any field of the ASN.1 syntax as defined in RFC 5652 [RFC5652] not explicitly specified here, SHOULD NOT be used by the sending entity.<a href="#section-4.1.6-25" class="pilcrow">¶</a></p>
<div id="EE_KGAgree">
<section id="section-4.1.6.1">
            <h5 id="name-using-key-agreement-key-man">
<a href="#section-4.1.6.1" class="section-number selfRef">4.1.6.1. </a><a href="#name-using-key-agreement-key-man" class="section-name selfRef">Using key agreement key management technique</a>
            </h5>
<p id="section-4.1.6.1-1">This key management technique can be applied in combination with the PKI management operations specified in <a href="#EE_newPKI" class="xref">Section 4.1.1</a> to <a href="#EE_Update" class="xref">Section 4.1.3</a> using signature-based protected CMP messages. The public key of the EE certificate used for the signature-based protection of the request message MUST also be used for the key establishment of the content-encryption key. To use this key management technique the KeyAgreeRecipientInfo structure MUST be used in the contentInfo field.<a href="#section-4.1.6.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.6.1-2">The KeyAgreeRecipientInfo structure included into the EnvelopedData structure is specified in <span><a href="#RFC5652" class="xref">CMS Section 6.2.2</a> [<a href="#RFC5652" class="xref">RFC5652</a>]</span>.<a href="#section-4.1.6.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1.6.1-3" class="keepWithNext">The detailed description of the KeyAgreeRecipientInfo structure looks like this:<a href="#section-4.1.6.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.6.1-4">
<pre>
            recipientInfo     REQUIRED
    -- MUST be KeyAgreeRecipientInfo as specified in
              version         REQUIRED
    -- MUST be set to 3
              originator      REQUIRED
    -- MUST contain the originatorKey choice
                algorithm     REQUIRED
    -- MUST be the algorithm OID of the key agreement algorithm
    -- The algorithm MUST be a KM_KA_ALG as specified in
    -- RFC-CMP-Alg Section 4.1
                publicKey     REQUIRED
    -- MUST be the ephemeral public key of the sending party
              ukm             RECOMMENDED
    -- MUST be used when 1-pass ECMQV is used
    -- SHOULD be present to ensure uniqueness of the key
    -- encryption key, see [RFC8419]
              keyEncryptionAlgorithm
                              REQUIRED
    -- MUST be the algorithm OID of the key wrap algorithm
    -- The algorithm MUST be a KM_KW_ALG as specified in
    -- RFC-CMP-Alg Section 4.3
              recipientEncryptedKeys
                              REQUIRED
    -- MUST contain exactly one RecipientEncryptedKey element
                  rid         REQUIRED
    -- MUST contain the rKeyId choice
                    rKeyId    REQUIRED
                      subjectKeyIdentifier
                              REQUIRED
    -- MUST contain the same value as the senderKID in the
    -- respective request messages
                  encryptedKey
                              REQUIRED
    -- MUST be the encrypted content-encryption key
</pre><a href="#section-4.1.6.1-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="EE_KGTrans">
<section id="section-4.1.6.2">
            <h5 id="name-using-key-transport-key-man">
<a href="#section-4.1.6.2" class="section-number selfRef">4.1.6.2. </a><a href="#name-using-key-transport-key-man" class="section-name selfRef">Using key transport key management technique</a>
            </h5>
<p id="section-4.1.6.2-1">This key management technique can be applied in combination with the PKI management operations specified in <a href="#EE_newPKI" class="xref">Section 4.1.1</a> to <a href="#EE_Update" class="xref">Section 4.1.3</a> using signature-based protected CMP messages. The public key of the EE certificate used for the signature-based protection of the request message MUST also be used for key encipherment of the content-encryption key. To use this key management technique the KeyTransRecipientInfo structure MUST be used in the contentInfo field.<a href="#section-4.1.6.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.6.2-2">The KeyTransRecipientInfo structure included into the EnvelopedData structure is specified in <span><a href="#RFC5652" class="xref">CMS Section 6.2.1</a> [<a href="#RFC5652" class="xref">RFC5652</a>]</span>.<a href="#section-4.1.6.2-2" class="pilcrow">¶</a></p>
<p id="section-4.1.6.2-3" class="keepWithNext">The detailed description of the KeyTransRecipientInfo structure looks like this:<a href="#section-4.1.6.2-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.6.2-4">
<pre>
            recipientInfo     REQUIRED
    -- MUST be KeyTransRecipientInfo as specified in
    -- CMS section 6.2.1 [RFC5652]
              version         REQUIRED
    -- MUST be set to 2
              rid             REQUIRED
       -- MUST contain the subjectKeyIdentifier choice
                subjectKeyIdentifier
                              REQUIRED
    -- MUST contain the same value as the senderKID in the respective
    -- request messages
              keyEncryptionAlgorithm
                              REQUIRED
    -- MUST be the algorithm OID of the key transport algorithm
    -- The algorithm MUST be a KM_KT_ALG as specified in RFC-CMP-Alg
    -- Section 4.2
              encryptedKey    REQUIRED
    -- MUST be the encrypted content-encryption key
</pre><a href="#section-4.1.6.2-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="EE_KGPB">
<section id="section-4.1.6.3">
            <h5 id="name-using-password-based-key-ma">
<a href="#section-4.1.6.3" class="section-number selfRef">4.1.6.3. </a><a href="#name-using-password-based-key-ma" class="section-name selfRef">Using password-based key management technique</a>
            </h5>
<p id="section-4.1.6.3-1">This key management technique can be applied in combination with the PKI management operation specified in <a href="#EE_MAC" class="xref">Section 4.1.4</a> using MAC-based protected CMP messages. The shared secret information used for the MAC-based protection MUST also be used for the encryption of the content-encryption key but with a different salt value applied in the key derivation algorithm  as used for the MAC-based protection . To use this key management technique the PasswordRecipientInfo structure MUST be used in the contentInfo field.<a href="#section-4.1.6.3-1" class="pilcrow">¶</a></p>
<p id="section-4.1.6.3-2">The PasswordRecipientInfo structure included into the EnvelopedData structure is specified in <span><a href="#RFC5652" class="xref">CMS Section 6.2.4</a> [<a href="#RFC5652" class="xref">RFC5652</a>]</span>.<a href="#section-4.1.6.3-2" class="pilcrow">¶</a></p>
<p id="section-4.1.6.3-3" class="keepWithNext">The detailed description of the PasswordRecipientInfo structure looks like this:<a href="#section-4.1.6.3-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.6.3-4">
<pre>
            recipientInfo     REQUIRED
    -- MUST be PasswordRecipientInfo as specified in
    -- CMS section 6.2.4 [RFC5652]
              version         REQUIRED
    -- MUST be set to 0
              keyDerivationAlgorithm
                              REQUIRED
    -- MUST be the algorithm OID of the key derivation algorithm
    -- The algorithm MUST be a KM_KD_ALG as specified in RFC-CMP-Alg
    -- Section 4.4
              keyEncryptionAlgorithm
                              REQUIRED
    -- MUST be the algorithm OID of the key wrap algorithm
    -- The algorithm MUST be a KM_KW_ALG as specified in RFC-CMP-Alg
    -- Section 4.3
              encryptedKey    REQUIRED
    -- MUST be the encrypted content-encryption key
</pre><a href="#section-4.1.6.3-4" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="EE_Polling">
<section id="section-4.1.7">
          <h4 id="name-delayed-enrollment">
<a href="#section-4.1.7" class="section-number selfRef">4.1.7. </a><a href="#name-delayed-enrollment" class="section-name selfRef">Delayed enrollment</a>
          </h4>
<p id="section-4.1.7-1">This functional extension can be applied in combination with certificate enrollment as described in <a href="#EE_newPKI" class="xref">Section 4.1.1</a> to <a href="#EE_P10" class="xref">Section 4.1.5</a>.  The functional extension can be used in case a PKI management entity cannot respond to the certificate request in a timely manner, e.g., due to offline upstream communication or required registration officer interaction.  Depending on the PKI architecture, the entity initiating delayed enrollment is not necessarily the PKI management entity directly addressed by the EE.<a href="#section-4.1.7-1" class="pilcrow">¶</a></p>
<p id="section-4.1.7-2">Note: According to <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span> polling is also possible for PKI management operations starting with a p10cr request message.<a href="#section-4.1.7-2" class="pilcrow">¶</a></p>
<p id="section-4.1.7-3">The PKI management entity initiating the delayed enrollment MUST respond with an ip/cp/kup message including the status "waiting".  When receiving a response with status "waiting" the EE MUST send a poll request to the same PKI management entity as before.  The PKI management entity that initiated the delayed enrollment MUST answer with a poll response containing a checkAfter time.  This value indicates the minimum number of seconds that should elapse before the EE sends another poll request.  This is repeated as long as no final response is available or any party involved gives up on the current transaction.  When the PKI management entity that initiated delayed enrollment can provide the final ip/cp/kup message for the initial request of the EE, it MUST provide this message in response to a poll request.  After receiving this response, the EE can continue the original PKI management operation as described in the respective section of this document, e.g., sending a certConf message.<a href="#section-4.1.7-3" class="pilcrow">¶</a></p>
<p id="section-4.1.7-4" class="keepWithNext">Message flow:<a href="#section-4.1.7-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.7-5">
<pre>
Step# EE                                   PKI management entity
 1   format ir/cr/p10cr/kur
     As described in the
       respective section
       in this document
 2                    -&gt;ir/cr/p10cr/kur-&gt;
 3                                        handle request as described
                                            in the respective section
                                            in this document
 4                                        in case no immediate final
                                            response is possible,
                                            receive or format ip, cp
                                            or kup message containing
                                            status "waiting"
 5                      &lt;-  ip/cp/kup  &lt;-
 6   handle ip/cp/kup with status "waiting"
 7   format pollReq
 8                      -&gt;   pollReq   -&gt;
 9                                        handle, re-protect or
                                            forward pollReq
10                                        in case the requested
                                            certificate or a
                                            corresponding response
                                            message is available,
                                            receive or format ip, cp,
                                            or kup containing the
                                            issued certificate, else
                                          format or receive pollRep
                                            with appropriate
                                            checkAfter value
11                      &lt;-   pollRep   &lt;-
12   handle pollRep
13   let checkAfter
       time elapse
14   continue with line 7
</pre><a href="#section-4.1.7-5" class="pilcrow">¶</a>
</div>
<p id="section-4.1.7-6" class="keepWithNext">Detailed description of the first ip/cp/kup:<a href="#section-4.1.7-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.7-7">
<pre>
Response with status 'waiting'  -- ip/cp/kup

Field                         Value

header
    -- MUST contain a header as described for the first response
    -- message of the respective PKI management operation

body
    -- The response of the PKI management entity to the request in
    -- case no immediate appropriate response can be sent
  ip/cp/kup                   REQUIRED
    response                  REQUIRED
    -- MUST contain exactly one CertResponse
      certReqId               REQUIRED
    -- MUST be 0
      status                  REQUIRED
    -- PKIStatusInfo structure MUST be present
        status                REQUIRED
    -- MUST be "waiting"
        statusString          OPTIONAL
    -- MAY be any human-readable text for debugging, logging or to
    -- display in a GUI
        failInfo              PROHIBITED
      certifiedKeyPair        PROHIBITED

protection                    REQUIRED
    -- MUST contain protection as described for the first response
    -- message of the respective PKI management operation, except
    -- that the PKI management entity that initiated the delayed
    -- enrollment and created this response MUST apply its own
    -- protection

extraCerts                    REQUIRED
    -- MUST contain certificates as described for the first response
    -- message of the respective PKI management operation. Yet since
    -- no new certificate is included yet, no respective certificate
    -- chain is included


Polling Request -- pollReq

Field                         Value

header
    -- MUST contain a header as described for the certConf message
    -- of the respective PKI management operation

body
    -- The message of the EE asks for the final response or for a
    -- time to check again
  pollReq                     REQUIRED
    -- MUST contain exactly one element
    certReqId                 REQUIRED
    -- MUST be 0

protection                    REQUIRED
    -- MUST contain protection as described for the certConf message
    -- of the respective PKI management operation

extraCerts                    OPTIONAL
    -- MUST be as described for the certConf message of the
    -- respective PKI management operation


Polling Response -- pollRep

Field                         Value

header
    -- MUST contain a header as described for the pkiConf message
    -- of the respective PKI management operation

body
    -- The message indicates the delay after which the EE may send
    -- another pollReq message for this transaction
  pollRep                     REQUIRED
    -- MUST contain exactly one entry
    certReqId                 REQUIRED
    -- MUST be 0
    checkAfter                REQUIRED
    -- time in seconds to elapse before a new pollReq should be sent
    reason                    OPTIONAL
    -- MAY be any human-readable text for debugging, logging or to
    -- display in a GUI

protection                    REQUIRED
    -- MUST contain protection as described for the pkiConf message
    -- of the respective profile, except that the PKI management
    -- entity that initiated the delayed enrollment and created this
    -- response MUST apply its own protection

extraCerts                    OPTIONAL
    -- If present, it MUST contain certificates as described for the
    -- pkiConf message of the respective PKI management operation.


Final response -- ip/cp/kup

Field                         Value

header
    -- MUST contain a header as described for the first
    -- except that the PKI management entity that initiated the
    -- delayed enrollment MUST replace the recipNonce by be the
    -- senderNonce of the last pollReq message

body
    -- The response of the PKI management entity to the initial
    -- request as described in the respective PKI management
    -- operation

protection                    REQUIRED
    -- MUST contain protection as described for the first response
    -- message of the respective PKI management operation, except
    -- that the PKI management entity that initiated the delayed
    -- enrollment MUST re-protect the response message

extraCerts                    REQUIRED
    -- MUST contain certificates as described for the first
    -- response message of the respective PKI management operation
</pre><a href="#section-4.1.7-7" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="EE_Revoke">
<section id="section-4.2">
        <h3 id="name-revoking-a-certificate">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-revoking-a-certificate" class="section-name selfRef">Revoking a certificate</a>
        </h3>
<p id="section-4.2-1">This PKI management operation should be used by an entity to request revocation of a certificate. Here the revocation request is used by an EE to revoke one of its own certificates. A PKI management entity could also act as an EE to revoke one of its own certificates.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">The revocation request message MUST be signed using the certificate that is to be revoked to prove the authorization to revoke. The revocation request message is signature-protected using this certificate.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">An EE requests the revocation of an own certificate at the CA that issued this certificate. The PKI management entity responds with a message that contains the status of the revocation from the CA.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4" class="keepWithNext">Preconditions:<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-4.2-5">
   <dt>1</dt>
<dd id="section-4.2-5.1">The certificate the EE wishes to revoke is not yet expired or revoked.<a href="#section-4.2-5.1" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-4.2-6" class="keepWithNext">Message flow:<a href="#section-4.2-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2-7">
<pre>

Step# EE                                  PKI management entity
  1   format rr
  2                      -&gt;   rr      -&gt;
  3                                        handle, re-protect or
                                             forward rr
  4                                        format or receive rp
  5                      &lt;-   rp      &lt;-
  6   handle rp
</pre><a href="#section-4.2-7" class="pilcrow">¶</a>
</div>
<p id="section-4.2-8">For this PKI management operation, the EE MUST include exactly one RevDetails structure in the rr message body. In case no error occurred the response to the rr MUST be an rp message containing a status field with a single set of values.<a href="#section-4.2-8" class="pilcrow">¶</a></p>
<p id="section-4.2-9" class="keepWithNext">Detailed message description:<a href="#section-4.2-9" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2-10">
<pre>
Revocation Request -- rr

Field                         Value

header
    -- As described in Section 3.1

body
    -- The request of the EE to revoke its certificate
  rr                          REQUIRED
    -- MUST contain exactly one element of type RevDetails
    -- If more revocations are desired, further requests MUST be
    -- packaged in separate PKI Messages
    certDetails               REQUIRED
    -- MUST be present and be of type CertTemplate
      serialNumber            REQUIRED
    -- MUST contain the certificate serialNumber attribute of the
    -- X.509 certificate to be revoked
      issuer                  REQUIRED
    -- MUST contain the issuer attribute of the X.509 certificate to
    -- be revoked
    crlEntryDetails           REQUIRED
    -- MUST contain exactly one reasonCode of type CRLReason (see
    -- [RFC5280] section 5.3.1)
    -- If the reason for this revocation is not known or shall not be
    -- published the reasonCode MUST be 0 = unspecified

protection                    REQUIRED
    -- As described in Section 3.2 and using the private key related
    -- to the certificate to be revoked

extraCerts                    REQUIRED
    -- As described in Section 3.3


Revocation Response -- rp

Field                         Value

header
    -- As described in Section 3.1

body
    -- The responds of the PKI management entity to the request as
    -- appropriate
  rp                          REQUIRED
    status                    REQUIRED
    -- MUST contain exactly one element of type PKIStatusInfo
      status                  REQUIRED
    -- positive value allowed: "accepted"
    -- negative value allowed: "rejection"
      statusString            OPTIONAL
    -- MAY be any human-readable text for debugging, logging or to
    -- display in a GUI
      failInfo                OPTIONAL
    -- MAY be present if and only if status is "rejection"

protection                    REQUIRED
    -- As described in section 3.2

extraCerts                    REQUIRED
    -- As described in section 3.3
</pre><a href="#section-4.2-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="EE_Error">
<section id="section-4.3">
        <h3 id="name-error-reporting">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-error-reporting" class="section-name selfRef">Error reporting</a>
        </h3>
<p id="section-4.3-1">This functionality should be used by an EE to report error conditions upstream to the PKI management entity such that the involved PKI management entities can immediately free their resources related to the current transaction. Error reporting by a PKI management entity downstream to the EE is described in <a href="#RA_Error" class="xref">Section 5.3</a>.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">In case the error condition is related to specific details of an ip, cp, or kup response message and a confirmation is expected the error condition MUST be reported in the respective certConf message with negative contents.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">General error conditions, e.g., problems with the message header, protection, or extraCerts, and negative feedback on rp, pollRep, or pkiConf messages MUST be reported in the form of an error message.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">In both situations the EE reports the status "rejection" in the PKIStatusInfo structure of the respective message.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<p id="section-4.3-5">Depending on the PKI architecture, the addressed PKI management entity MUST forward the error message (upstream) to the next PKI management entity and MUST terminate this PKI management operation on receiving any response.<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<p id="section-4.3-6" class="keepWithNext">The PKIStatusInfo structure is used to report errors. The PKIStatusInfo structure consists of the following fields:<a href="#section-4.3-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-7.1">status: Here the PKIStatus value "rejection" is the only one allowed.<a href="#section-4.3-7.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-7.2">statusString: Here any human-readable valid value for logging or to display in a GUI SHOULD be added.<a href="#section-4.3-7.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-7.3">
            <p id="section-4.3-7.3.1" class="keepWithNext">failInfo: Here the PKIFailureInfo values MAY be used in the way explained in <span><a href="#RFC4210" class="xref">Appendix F of RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span>. The following PKIFailureInfo values have specific usage and therefore are described in detail here:<a href="#section-4.3-7.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-7.3.2.1">transactionIdInUse: This is sent by a PKI management entity in case the received request contains a transaction ID that has already been used for another transaction. An EE receiving such error message SHOULD resend the request in a new transaction using a different transaction ID.<a href="#section-4.3-7.3.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.3-7.3.2.2">systemUnavail or systemFailure: This is sent by a PKI management entity in case a back-end system is not available or currently not functioning correctly. An EE receiving such error message SHOULD resend the request in a new transaction after some time.<a href="#section-4.3-7.3.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
<p id="section-4.3-8" class="keepWithNext">Detailed error message description:<a href="#section-4.3-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.3-9">
<pre>
Error Message -- error

Field                         Value

header
    -- As described in Section 3.1

body
    -- The message sent by the EE or the (L)RA/CA to indicate an
    -- error that occurred
  error                       REQUIRED
    pKIStatusInfo             REQUIRED
      status                  REQUIRED
    -- MUST have the value "rejection"
      statusString            RECOMMENDED
    -- SHOULD be any human-readable text for debugging, logging
    -- or to display in a GUI
      failInfo                OPTIONAL
    -- MAY be present

protection                    REQUIRED
    -- As described in Section 3.2

extraCerts                    OPTIONAL
    -- As described in Section 3.3
</pre><a href="#section-4.3-9" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="EE_GeneralMessage">
<section id="section-4.4">
        <h3 id="name-support-messages">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-support-messages" class="section-name selfRef">Support messages</a>
        </h3>
<p id="section-4.4-1">The following support messages offer on demand in-band transport of content relevant to the EE that may be provided by the PKI management entity.  CMP general messages and general response are used for this purpose.  Depending on the environment, these requests may be answered by an LRA, RA, or CA.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">The general messages and general response messages transport InfoTypeAndValue structures. In addition to those infoType values defined in <span><a href="#RFC4210" class="xref">RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span> further OIDs MAY be used to define new PKI management operations or new general-purpose support messages as needed in specific environments.<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<p id="section-4.4-3" class="keepWithNext">The following contents are specified in this document:<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-4.1">Get CA certificates<a href="#section-4.4-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-4.2">Get root CA certificate updates<a href="#section-4.4-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-4.3">PGet certificate request templates<a href="#section-4.4-4.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.4-5">The PKI management operation is similar to that given in <span><a href="#RFC4210" class="xref">Appendix E.5 of RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span>. In this section the aspects common to all general messages (genm) and to all general responses (genp) are described.<a href="#section-4.4-5" class="pilcrow">¶</a></p>
<p id="section-4.4-6">The behavior in case an error occurs is described in <a href="#EE_Error" class="xref">Section 4.3</a>.<a href="#section-4.4-6" class="pilcrow">¶</a></p>
<p id="section-4.4-7" class="keepWithNext">Message flow:<a href="#section-4.4-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.4-8">
<pre>
Step# EE                                   PKI management entity
 1   format genm
 2                      -&gt;   genm    -&gt;
 3                                        handle, re-protect or
                                            forward genm
 4                                        format or receive genp
 5                      &lt;-   genp    &lt;-
 6   handle genp
</pre><a href="#section-4.4-8" class="pilcrow">¶</a>
</div>
<p id="section-4.4-9" class="keepWithNext">Detailed message description:<a href="#section-4.4-9" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.4-10">
<pre>
General Message -- genm

Field                         Value

header
    -- As described in Section 3.1

body
    -- A request by the EE to receive information
  genm                        REQUIRED
    -- MUST contain exactly one element of type
    -- InfoTypeAndValue
    infoType                  REQUIRED
    -- MUST be the OID identifying the specific PKI
    -- management operation described below
    infoValue                 OPTIONAL
    -- MUST be as described in the specific PKI
    -- management operation described below

protection                    REQUIRED
    -- As described in Section 3.2

extraCerts                    REQUIRED
    -- As described in Section 3.3


General Response -- genp

Field                         Value

header
    -- As described in Section 3.1

body
    -- The response of the PKI management entity to an
    -- information request
  genp                        REQUIRED
    -- MUST contain exactly one element of type
    -- InfoTypeAndValue
    infoType                  REQUIRED
    -- MUST be the OID identifying the specific PKI
    -- management operation described below
    infoValue                 OPTIONAL
    -- MUST be as described in the specific PKI
    -- management operation described below

protection                    REQUIRED
    -- As described in Section 3.2

extraCerts                    REQUIRED
    -- As described in Section 3.3
</pre><a href="#section-4.4-10" class="pilcrow">¶</a>
</div>
<div id="EE_CACerts">
<section id="section-4.4.1">
          <h4 id="name-get-ca-certificates">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-get-ca-certificates" class="section-name selfRef">Get CA certificates</a>
          </h4>
<p id="section-4.4.1-1">This PKI management operation can be used by an EE to request CA certificates from the PKI management entity.<a href="#section-4.4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.4.1-2">An EE requests CA certificates from the PKI management entity by sending a general message with OID id-it-caCerts as specified in <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span>. The PKI management entity responds with a general response with the same OID that either contains a SEQUENCE of certificates populated with the available CA intermediate and issuing CA certificates or with no content in case no CA certificate is available.<a href="#section-4.4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.4.1-3" class="keepWithNext">The message sequence for this PKI management operation is as given in <a href="#EE_GeneralMessage" class="xref">Section 4.4</a>, with the following specific content:<a href="#section-4.4.1-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-4.4.1-4">
     <dt>1</dt>
<dd id="section-4.4.1-4.1">the body MUST contain as infoType the OID id-it-caCerts<a href="#section-4.4.1-4.1" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>2</dt>
<dd id="section-4.4.1-4.2">the infoValue of the request MUST be absent<a href="#section-4.4.1-4.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>3</dt>
<dd id="section-4.4.1-4.3">if present, the infoValue of the response MUST contain a sequence of certificates<a href="#section-4.4.1-4.3" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.4.1-5" class="keepWithNext">The infoValue field of the general response containing the id-it-caCerts OID looks like this:<a href="#section-4.4.1-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.4.1-6">
<pre>
      infoValue               OPTIONAL
    -- MUST be absent if no CA certificate is available
    -- MUST be present if CA certificates are available
    -- MUST be a sequence of CMPCertificate
</pre><a href="#section-4.4.1-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="EE_RootCAUpdate">
<section id="section-4.4.2">
          <h4 id="name-get-root-ca-certificate-upd">
<a href="#section-4.4.2" class="section-number selfRef">4.4.2. </a><a href="#name-get-root-ca-certificate-upd" class="section-name selfRef">Get root CA certificate update</a>
          </h4>
<p id="section-4.4.2-1">This PKI management operation can be used by an EE to retrieve any updated root CA Certificate as described in <span><a href="#RFC4210" class="xref">Section 4.4 of RFC 4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span>.<a href="#section-4.4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.4.2-2">An EE requests a root CA certificate update from the PKI management entity by sending a general message with OID id-it-rootCaKeyUpdate as specified in <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span>. The PKI management entity responds with a general response with the same OID that either contains the update of the root CA certificate consisting of up to three certificates, or with no content in case no update is available.<a href="#section-4.4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.4.2-3">The newWithNew certificate is the new root CA certificate and is REQUIRED to be present in the response message.  The newWithOld certificate is RECOMMENDED to be present in the response message, because it is needed for those cases where the receiving entity trusts the old root CA certificate and wishes to gain trust in the new root CA certificate. It MAY be omitted if the PKI management entity that performed the message protection of the response message is authorization to update the trust store of the EE.  The oldWithNew certificate is OPTIONAL, because it is only needed in a scenario where the requesting entity does not have an own certificate under the new root CA and wishes to authenticate to entities not trusting the old root CA.<a href="#section-4.4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.4.2-4" class="keepWithNext">The message sequence for this PKI management operation is as given in <a href="#EE_GeneralMessage" class="xref">Section 4.4</a>, with the following specific content:<a href="#section-4.4.2-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-4.4.2-5">
     <dt>1</dt>
<dd id="section-4.4.2-5.1">the body MUST contain as infoType the OID id-it-rootCaKeyUpdate<a href="#section-4.4.2-5.1" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>2</dt>
<dd id="section-4.4.2-5.2">the infoValue of the request MUST be absent<a href="#section-4.4.2-5.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>3</dt>
<dd id="section-4.4.2-5.3">if present, the infoValue of the response MUST be a RootCaKeyUpdate structure<a href="#section-4.4.2-5.3" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.4.2-6" class="keepWithNext">The infoValue field of the general response containing the id-it-rootCaKeyUpdate extension looks like this:<a href="#section-4.4.2-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.4.2-7">
<pre>
      infoValue               OPTIONAL
    -- MUST be absent if no update of the root CA certificate is
    -- available
    -- MUST be present if an update of the root CA certificate
    -- is available and MUST be of type RootCaKeyUpdate
        newWithNew            REQUIRED
    -- MUST be present if infoValue is present
    -- MUST contain the new root CA certificate
        newWithOld            RECOMMENDED
    -- SHOULD be present if infoValue is present
    -- MUST contain a certificate containing the new public
    -- root CA key signed with the old private root CA key
        oldWithNew            OPTIONAL
    -- MAY be present if infoValue is present
    -- MUST contain a certificate containing the old public
    -- root CA key signed with the new private root CA key
</pre><a href="#section-4.4.2-7" class="pilcrow">¶</a>
</div>
<p id="section-4.4.2-8">&lt; TBD: In case the PKI management entity serves for more than one Root CA.  There are three different options to handle this: - The EE specifies by means of a respective label in the HTTP endpoint for which Root CA certificate the update is requested. - The EE transfers the oldWithOld certificate or its S/N+issuer in the InfoValue of the request. - The PKI management entity provides several InfoTypeAndValue pairs in the response containing a RootCaKeyUpdate element for each Root CA where an update is available. &gt;<a href="#section-4.4.2-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="EE_Temp">
<section id="section-4.4.3">
          <h4 id="name-get-certificate-request-tem">
<a href="#section-4.4.3" class="section-number selfRef">4.4.3. </a><a href="#name-get-certificate-request-tem" class="section-name selfRef">Get certificate request template</a>
          </h4>
<p id="section-4.4.3-1">This PKI management operation can be used by an EE to request a template with parameters for a future certificate requests.<a href="#section-4.4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.4.3-2">An EE requests certificate request parameters from the PKI management entity by sending a general message with OID id-it-certReqTemplate as specified in <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span>.  The PKI management entity responds with a general response with the same OID that either contains a certificate template containing requirements on certificate fields and extensions and optionally a keySpec field containing requirements on algorithms  acceptable for key pair generation, or with no content in case no specific requirements are imposed by the PKI.<a href="#section-4.4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.4.3-3">The EE SHOULD follow the requirements from the received CertTemplate and the optional keySpec field, by including in the certTemplate of certificate requests all the fields requested, taking over all the field values provided and filling in any remaining fields values.  The EE SHOULD NOT add further CertTemplate fields, Name components, and extensions or their (sub-)components.<a href="#section-4.4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.4.3-4">Note: We deliberately do not use 'MUST' or 'MUST NOT' here in order to allow more flexibility in case the rules given here are not sufficient for specific scenarios. The EE can populate the certificate request as wanted and ignore any of the requirements contained in the CertReqTemplate response message. On the other hand, a PKI management entity is free to ignore or replace any parts of the content of the certificate request provided by the EE. The CertReqTemplate PKI management operation offers means to ease a joint understanding which fields and/or which field values should be used.<a href="#section-4.4.3-4" class="pilcrow">¶</a></p>
<p id="section-4.4.3-5">In case a field of type Name, e.g., issuer or subject, is present in the CertTemplate but has the value NULL-DN (i.e., has an empty list of RDN components) the field SHOULD be included in the certTemplate and filled with content provided by the EE. Similarly, in case an X.509v3 extension is present but its extnValue is empty this means that the extension SHOULD be included and filled with content provided by the EE. In case a Name component, for instance a common name or serial number, is given but has an empty string value the EE SHOULD fill in a value. Similarly, in case an extension has sub-components (e.g., an IP address in a SubjectAltName field) with empty value, the EE SHOULD fill in a value.<a href="#section-4.4.3-5" class="pilcrow">¶</a></p>
<p id="section-4.4.3-6">The EE MUST ignore (i.e., not include and fill in) empty fields, extensions, and sub-components that it does not understand or does not know suitable values to be filled in.<a href="#section-4.4.3-6" class="pilcrow">¶</a></p>
<p id="section-4.4.3-7">The publicKey field of type SubjectPublicKeyInfo in the CertTemplate MUST be omitted. In case the PKI management entity wishes to make stipulation on supported algorithms the EE may use for key generation, this MUST be specified using the control fields as specified in <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span>.<a href="#section-4.4.3-7" class="pilcrow">¶</a></p>
<p id="section-4.4.3-8">The keySpec field, if present, specifies the public key types and lengths for which a certificate may be requested.<a href="#section-4.4.3-8" class="pilcrow">¶</a></p>
<p id="section-4.4.3-9">The value of a keySpec with the OID id-regCtrl-algId, as specified in <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span>, MUST be of type AlgorithmIdentitier and gives an algorithm other than RSA.  For EC keys the full curve information MUST be specified as described in the respective standard documents.<a href="#section-4.4.3-9" class="pilcrow">¶</a></p>
<p id="section-4.4.3-10">The value of a keySpec with the OID id-regCtrl-rsaKeyLen, as specified in <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span>, MUST be of type Integer and gives an RSA key length.<a href="#section-4.4.3-10" class="pilcrow">¶</a></p>
<p id="section-4.4.3-11">The PKI management entity responds with a general response with the same OID that either contains a certificate template containing requirements on certificate fields and extensions and optionally a keySpec field containing requirements on algorithms acceptable for key pair generation, or with no content in case no specific requirements are imposed by the PKI.<a href="#section-4.4.3-11" class="pilcrow">¶</a></p>
<p id="section-4.4.3-12">The EE SHOULD follow the requirements from the received CertTemplate and the optional keySpec field, by including in the certTemplate of certificate requests all the fields requested, taking over all the field values provided and filling in any remaining fields values.  The EE SHOULD NOT add further CertTemplate fields, name components, and extensions or their (sub-)components.  In case several keySpec elements are present the EE can choose one of the specified algorithms for key pair generation.  In case the keySpec field is absent the EE is free to choose any public key type including parameters.<a href="#section-4.4.3-12" class="pilcrow">¶</a></p>
<p id="section-4.4.3-13">In the CertTemplate structure the serialNumber, signingAlg, publicKey, issuerUID, and subjectUID fields MUST be omitted.<a href="#section-4.4.3-13" class="pilcrow">¶</a></p>
<p id="section-4.4.3-14" class="keepWithNext">The message sequence for this PKI management operation is as given in <a href="#EE_GeneralMessage" class="xref">Section 4.4</a>, with the following specific content:<a href="#section-4.4.3-14" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-4.4.3-15">
<dt>1</dt>
<dd id="section-4.4.3-15.1">the body MUST contain as infoType the OID id-it-certReqTemplate<a href="#section-4.4.3-15.1" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>2</dt>
<dd id="section-4.4.3-15.2">the infoValue of the request MUST be absent<a href="#section-4.4.3-15.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt>3</dt>
<dd id="section-4.4.3-15.3">if present, the infoValue of the response MUST be a CertTemplate structure and an optional SEQUENCE of AttributeTypeAndValue with attribute type id-regCtrl-algId or id-regCtrl-rsaKeyLen<a href="#section-4.4.3-15.3" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.4.3-16" class="keepWithNext">The infoValue field of the general response containing the id-it-certReqTemplate OID looks like this:<a href="#section-4.4.3-16" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.4.3-17">
<pre>
      InfoValue               OPTIONAL
    -- MUST be absent if no requirements are available
    -- MUST be present if the PKI management entity has any
    -- requirements on the content of the certificates template
        certTemplate          REQUIRED
    -- MUST be present if infoValue is present
    -- MUST contain the prefilled CertTemplate structure elements
    -- The SubjectPublicKeyInfo MUST contain no algorithm ID i.e.,
    -- the null OBJECT IDENTIFIER) in the algorithm field and a
    -- zero-length BIT STRING in the subjectPublicKey field
        keySpec               OPTIONAL
    -- MUST be absent if no requirements on the public key are
    -- available MUST be present if the PKI management entity has any
    -- requirements on the key generation
    -- MUST contain one AttributeTypeAndValue per supported algorithm
    -- with attribute id-regCtrl-algId or id-regCtrl-rsaKeyLen
</pre><a href="#section-4.4.3-17" class="pilcrow">¶</a>
</div>
<p id="section-4.4.3-18">&lt; TBD: In case the PKI management entity offers for more than one set of certificate request parameters.  There are three different options to handle this: - The EE specifies by means of a respective label in the HTTP endpoint for which set of certificate request parameters is requested the template. - The EE neame of the set of certificate request parameters in the InfoValue of the request. - The PKI management entity provides several InfoTypeAndValue pairs in the response containing a set of certificate request parameter in each InfoTypeAndValue pairs. &gt;<a href="#section-4.4.3-18" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="RA_UseCases">
<section id="section-5">
      <h2 id="name-lra-and-ra-pki-management-o">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-lra-and-ra-pki-management-o" class="section-name selfRef">LRA and RA PKI management operations</a>
      </h2>
<p id="section-5-1">This section focuses on the communication among PKI management entities.  Depending on the network and PKI solution design, these can be LRAs, RAs, and CAs.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">A PKI management entity typically forwards request messages from downstream, but it may also reply to them itself.  Besides forwarding received messages, a PKI management entity may need to revoke certificates of EEs, report errors, or may need to manage its own certificates.<a href="#section-5-2" class="pilcrow">¶</a></p>
<div id="RA_forwarde_messages">
<section id="section-5.1">
        <h3 id="name-forwarding-messages">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-forwarding-messages" class="section-name selfRef">Forwarding messages</a>
        </h3>
<p id="section-5.1-1">In case the PKI solution consists of several PKI management entities, each CMP request message (i.e., ir, cr, p10cr, kur, pollReq, or certConf) or error message coming from an EE or any other downstream PKI management entity MUST be sent to the next (upstream) PKI management entity.  Any received response message MUST be forwarded downstream to the next PKI management entity or EE.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">The PKI management entity SHOULD verify the protection, the syntax, the required message fields, the message type, and if applicable the authorization and the proof-of-possession of the message. Additional checks or actions MAY be applied depending on the PKI solution requirements and concept. If one of these verification procedures fails, the (L)RA SHOULD switch to the operation described in <a href="#RA_Error" class="xref">Section 5.3</a>, i.e., respond with a negative response message and then MUST NOT forward the request message further upstream.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">A PKI management entity SHOULD not change the received message unless necessary. The PKI management entity SHOULD only update the message protection if this is technically necessary. Concrete PKI system specifications may define in more detail when to do so.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1-4">This is particularly relevant in the upstream communication of a request message.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5" class="keepWithNext">Each hop in a chain of PKI management entity has one or more functionalities, e.g., a PKI management entity may<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-6.1">verify the identities of EEs or base authorization decisions for certification request processing on specific knowledge of the local setup, e.g., by consulting an inventory or asset management system,<a href="#section-5.1-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-6.2">add fields to certificate request messages,<a href="#section-5.1-6.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-6.3">store data from a message in a database for later usage or audit purposes,<a href="#section-5.1-6.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-6.4">provide traversal of a network boundary,<a href="#section-5.1-6.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-6.5">replace a MAC-based protection by a signature-based protection that can be verified also further upstream,<a href="#section-5.1-6.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-6.6">double-check if the messages transferred back and forth are properly protected and well-formed,<a href="#section-5.1-6.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-6.7">provide an authentic indication that it has performed all required checks,<a href="#section-5.1-6.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-6.8">initiate a delayed enrollment due to offline upstream communication or registration officer interaction,<a href="#section-5.1-6.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-6.9">grant the request of an EE to omit sending a confirmation message, or<a href="#section-5.1-6.9" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-6.10">collect messages from ultiple LRAs and forward them jointly.<a href="#section-5.1-6.10" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.1-7" class="keepWithNext">Therefore, the decision if a message should be forwarded<a href="#section-5.1-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-8.1">unchanged with the original protection,<a href="#section-5.1-8.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-8.2">unchanged with a new protection, or<a href="#section-5.1-8.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-8.3">changed with a new protection<a href="#section-5.1-8.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.1-9">depends on the PKI solution design and the associated security policy (<span><a href="#RFC3647" class="xref">CP/CPS</a> [<a href="#RFC3647" class="xref">RFC3647</a>]</span>).<a href="#section-5.1-9" class="pilcrow">¶</a></p>
<p id="section-5.1-10">This section specifies the options a PKI management entity may implement and use.<a href="#section-5.1-10" class="pilcrow">¶</a></p>
<p id="section-5.1-11" class="keepWithNext">A PKI management entity MAY update the protection of a message if it<a href="#section-5.1-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-12.1">performs changes to the header or the body of the message,<a href="#section-5.1-12.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-12.2">needs to securely indicate that it has done checks or validations on the message to one of the next (upstream) PKI components,<a href="#section-5.1-12.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-12.3">needs to protect the message using a key and certificate from a different PKI, or<a href="#section-5.1-12.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-12.4">needs to replace or produce a MAC-based protection.<a href="#section-5.1-12.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.1-13">This is particularly relevant in the upstream communication of certificate request messages.<a href="#section-5.1-13" class="pilcrow">¶</a></p>
<p id="section-5.1-14">Note that the message protection covers only the header and the body and not the extraCerts.  The PKI management entity MAY change the extraCerts in any of the following message adaptations, e.g., to sort, add, or delete certificates to support the next hop.  This may be particularly helpful to augment upstream messages with additional certificates or to reduce the number of certificates in downstream messages when forwarding to constrained devices.<a href="#section-5.1-14" class="pilcrow">¶</a></p>
<div id="RA_noChange">
<section id="section-5.1.1">
          <h4 id="name-not-changing-protection">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-not-changing-protection" class="section-name selfRef">Not changing protection</a>
          </h4>
<p id="section-5.1.1-1">This variant means that a PKI management entity forwards a CMP message without changing the header, body, or protection.  In this case the PKI management entity acts more like a proxy, e.g., on a network boundary, implementing no specific RA-like security functionality that require an authentic indication to the PKI. Still the PKI management entity might implement checks that result in refusing to forward the request message and instead responding with an error message as specified in <a href="#RA_Error" class="xref">Section 5.3</a>.<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1.1-2">This variant of forwarding a message SHOULD be used for kur messages because their protection (using the certificate to be updated) MUST NOT be changed.  If the respective PKI management entity really needs approve such a request it MUST use a nested message as described in <a href="#RA_Add" class="xref">Section 5.1.3</a>.<a href="#section-5.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="RA_Replace">
<section id="section-5.1.2">
          <h4 id="name-replacing-protection">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-replacing-protection" class="section-name selfRef">Replacing protection</a>
          </h4>
<p id="section-5.1.2-1">The following two alternatives to forwarding a message can be used by any PKI management entity forwarding a CMP message with or without changes, while providing its own protection asserting approval of messages. In this case the PKI management entity acts as an actual Registration Authority (RA), which implements important security functionality of the PKI.<a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
<p id="section-5.1.2-2">Before replacing the existing protection by a new protection, the PKI management entity MUST verify the protection provided and approve its content including any own modifications. For certificate requests the PKI management entity MUST verify (except in case of central key generation) the presence and contents of the proof-of-possession self-signature of the certTemplate using the public key of the requested certificate and MUST check that the EE, as authenticated by the message protection, is authorized to request a certificate with the subject as specified in the certTemplate.<a href="#section-5.1.2-2" class="pilcrow">¶</a></p>
<p id="section-5.1.2-3">In case the received message has been protected by a CA or another PKI management entity, the current PKI management entity MUST verify its protection and approve its content including any own modifications. For request messages the PKI management entity MUST check that the other PKI management entity, as authenticated by the protection of the incoming message, was authorized to issue or forward the request.<a href="#section-5.1.2-3" class="pilcrow">¶</a></p>
<p id="section-5.1.2-4">These message adaptations MUST NOT be applied to kur request messages as described in <a href="#EE_Update" class="xref">Section 4.1.3</a> since their original protection using the key and certificate to be updated needs to be preserved, unless the regCtrl OldCertId is used to strongly identify the certificate to be updated.<a href="#section-5.1.2-4" class="pilcrow">¶</a></p>
<p id="section-5.1.2-5">These message adaptations MUST NOT be applied to certificate request messages as described in <a href="#EE_centralKeyGeneration" class="xref">Section 4.1.6</a>since their original protection needs to be preserved up to the Key Generation Authority, which needs to use it for encrypting the new private key for the EE.<a href="#section-5.1.2-5" class="pilcrow">¶</a></p>
<p id="section-5.1.2-6">In both the kur and central key generation cases, if a PKI management entity needs to state its approval of the original request message it MUST provide this using a nested message as specified in <a href="#RA_Add" class="xref">Section 5.1.3</a>.<a href="#section-5.1.2-6" class="pilcrow">¶</a></p>
<p id="section-5.1.2-7">When an intermediate PKI management entity modifies a message, it SHOULD NOT change the transactionID nor the sender and recipient nonce except as stated for delayed enrollment in Section 4.1.7. <a href="#EE_Polling" class="xref">Section 4.1.7</a>.<a href="#section-5.1.2-7" class="pilcrow">¶</a></p>
<div id="RA_keepPOPO">
<section id="section-5.1.2.1">
            <h5 id="name-keeping-proof-of-possession">
<a href="#section-5.1.2.1" class="section-number selfRef">5.1.2.1. </a><a href="#name-keeping-proof-of-possession" class="section-name selfRef">Keeping proof-of-possession</a>
            </h5>
<p id="section-5.1.2.1-1">This variant of forwarding a message means that a PKI management entity forwards a CMP message with or without modifying the message header or body while preserving any included proof-of-possession.<a href="#section-5.1.2.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1.2.1-2">By replacing the existing protection using its own CMP protecting key the PKI management entity provides a proof of verifying and approving of the message as described above.<a href="#section-5.1.2.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1.2.1-3">In case the PKI management entity modifies the certTemplate of an ir or cr message, the message adaptation in <a href="#RA_breakPOPO" class="xref">Section 5.1.2.2</a> needs to be applied instead.<a href="#section-5.1.2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="RA_breakPOPO">
<section id="section-5.1.2.2">
            <h5 id="name-breaking-proof-of-possessio">
<a href="#section-5.1.2.2" class="section-number selfRef">5.1.2.2. </a><a href="#name-breaking-proof-of-possessio" class="section-name selfRef">Breaking proof-of-possession</a>
            </h5>
<p id="section-5.1.2.2-1">This variant of forwarding a message means that a PKI management entity forwards an ir or cr message with modifications of the certTemplate, i.e., modification, addition, or removal of fields.  Such changes will break the signature-based proof-of-possession provided by the EE in the original message.<a href="#section-5.1.2.2-1" class="pilcrow">¶</a></p>
<p id="section-5.1.2.2-2">By replacing the existing protection and using its own CMP protection key the PKI management entity provides a proof of verifying and approving the request message as described above.<a href="#section-5.1.2.2-2" class="pilcrow">¶</a></p>
<p id="section-5.1.2.2-3">In addition, the PKI management entity MUST verify the proof-of-possession contained in the original message as described above.  If these checks were successful, the PKI management entity MUST change the popo to raVerified.<a href="#section-5.1.2.2-3" class="pilcrow">¶</a></p>
<p id="section-5.1.2.2-4" class="keepWithNext">The popo field MUST contain the raVerified choice in the certReq structure of the modified message as follows:<a href="#section-5.1.2.2-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.1.2.2-5">
<pre>
    popo
      raVerified              REQUIRED
    -- MUST have the value NULL and indicates that the PKI
    -- management entity verified the popo of the original
    -- message
</pre><a href="#section-5.1.2.2-5" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="RA_Add">
<section id="section-5.1.3">
          <h4 id="name-adding-protection">
<a href="#section-5.1.3" class="section-number selfRef">5.1.3. </a><a href="#name-adding-protection" class="section-name selfRef">Adding Protection</a>
          </h4>
<p id="section-5.1.3-1">This variant of forwarding a message means that a PKI management entity adds another protection to PKI management messages before forwarding them.  Applying an additional protection is specifically relevant when forwarding a message that requests a certificate update or a central key generation. This is because the original protection of the EE must be preserved while adding an indication of approval.<a href="#section-5.1.3-1" class="pilcrow">¶</a></p>
<p id="section-5.1.3-2">The nested message is a PKI management message containing a PKIMessages sequence as its body containing one or more CMP messages.<a href="#section-5.1.3-2" class="pilcrow">¶</a></p>
<p id="section-5.1.3-3">As specified in the updated <span><a href="#RFC4210" class="xref">Section 5.1.3.4 of RFC4210</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span> (see <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span>) there are various use case for adding another protection by a PKI management entity. Specific procedures are described in more detail in the following sections.<a href="#section-5.1.3-3" class="pilcrow">¶</a></p>
<p id="section-5.1.3-4">The behavior in case an error occurs is described in <a href="#EE_Error" class="xref">Section 4.3</a>.<a href="#section-5.1.3-4" class="pilcrow">¶</a></p>
<p id="section-5.1.3-5" class="keepWithNext">Message flow:<a href="#section-5.1.3-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.1.3-6">
<pre>
Step# PKI management entity               PKI management entity
 1   format nested
 2                      -&gt;  nested   -&gt;
 3                                        handle, re-protect or
                                            forward nested
 4                                        format or receive nested
 5                      &lt;-  nested   &lt;-
 6   handle nested
</pre><a href="#section-5.1.3-6" class="pilcrow">¶</a>
</div>
<p id="section-5.1.3-7" class="keepWithNext">Detailed message description:<a href="#section-5.1.3-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.1.3-8">
<pre>
Nested Message - nested

Field                         Value

header
    -- As described in Section 3.1

body
    -- Container to provide additional protection to original
    -- messages and to bundle request messages or alternatively
    -- response messages
  PKIMessages                 REQUIRED
    -- MUST be a sequence of one or more CMP messages

protection                    REQUIRED
    -- As described in Section 3.2 using the CMP protection key of
    -- the PKI management entity

extraCerts                    REQUIRED
    -- As described in Section 3.3
</pre><a href="#section-5.1.3-8" class="pilcrow">¶</a>
</div>
<div id="RA_AddSingel">
<section id="section-5.1.3.1">
            <h5 id="name-handling-a-single-pki-manag">
<a href="#section-5.1.3.1" class="section-number selfRef">5.1.3.1. </a><a href="#name-handling-a-single-pki-manag" class="section-name selfRef">Handling a single PKI management message</a>
            </h5>
<p id="section-5.1.3.1-1">A PKI management entity may authentically indicate successful validation and authorization of a PKI management message by adding an additional signature to the original PKI management message.<a href="#section-5.1.3.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1.3.1-2">A PKI management entity SHALL wrap the original PKI management messages in a nested message structure. The additional signature as prove of verification and authorization by the PKI management entity MUST be applied as signature-based message protection of the nested message.<a href="#section-5.1.3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="RA_AddBatch">
<section id="section-5.1.3.2">
            <h5 id="name-handling-a-batch-of-pki-man">
<a href="#section-5.1.3.2" class="section-number selfRef">5.1.3.2. </a><a href="#name-handling-a-batch-of-pki-man" class="section-name selfRef">Handling a batch of PKI management messages</a>
            </h5>
<p id="section-5.1.3.2-1">A PKI management entity MAY bundle any number of PKI management messages for batch processing or to transfer a bulk of PKI management messages via an offline interface using the nested message structure. Nested messages can be used on the upstream interface towards the next PKI management entity and/or on the downstream interface from the PKI management entity towards the EE.<a href="#section-5.1.3.2-1" class="pilcrow">¶</a></p>
<p id="section-5.1.3.2-2">This PKI management operation is typically used on the interface between LRA and RA to bundle several PKI management messages for offline transport. In this case the LRA needs to initiate delayed enrollment as described in <a href="#RA_Polling" class="xref">Section 5.1.4</a>. If the RA may need different routing information per nested PKI management message a suitable mechanism may need to be implemented. This mechanism strongly depends on the requirements of the target architecture. Therefore, it is out of scope of this document.<a href="#section-5.1.3.2-2" class="pilcrow">¶</a></p>
<p id="section-5.1.3.2-3">An initial nested message is generated locally at the PKI management entity. For the initial nested message, the PKI management entity acts as a protocol end point and therefore a fresh transactionId and a fresh senderNonce MUST be used in the header of the nested message. The recipient field MUST identify the PKI management entity that is expected to unpack the nested message. An initial nested message may contain request messages, e.g., ir, cr, p10cr, kur, certConf, rr, or genm. While building the initial nested message the PKI management entity SHOULD store the transactionIds and the senderNonces of all bundled messages together with the transactionId of the initial nested message.<a href="#section-5.1.3.2-3" class="pilcrow">¶</a></p>
<p id="section-5.1.3.2-4">Such an initial nested message is sent to the next PKI management entity, which MUST unbundle the included request messages and handle each of them as usual. It SHOULD answer with a responding nested message.  This responding message MUST use the transactionId of the initial nested message and return the senderNonce of the initial nested message as recipNonce of the responding nested message.  The responding nested message SHOULD bundle the individual response messages (e.g., ip, cp, kup, pkiconf, rp, genp, error) for all original request messages of the initial nested message.  While unbundling the responding nested message, the former PKI management entity can determine lost and unexpected responses based on the previously stored transactionIds and senderNonces.  When it forwards the unbundled responses, any extra messages SHOULD be dropped, and any missing message SHOULD be replaced by an error message to inform the respective EE about the failed certificate management operation.<a href="#section-5.1.3.2-4" class="pilcrow">¶</a></p>
<p id="section-5.1.3.2-5">The PKI management entity building the nested message applies a signature-based protection using its CMP protection key as transport protection.  This protection SHALL NOT be regarded as an indication of verification or approval of the bundled PKI request messages.<a href="#section-5.1.3.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="RA_Polling">
<section id="section-5.1.4">
          <h4 id="name-initiating-delayed-enrollme">
<a href="#section-5.1.4" class="section-number selfRef">5.1.4. </a><a href="#name-initiating-delayed-enrollme" class="section-name selfRef">Initiating delayed enrollment</a>
          </h4>
<p id="section-5.1.4-1">This functional extension can be used by a PKI management entity to initiate delayed enrollment. In this case a PKI management entity MUST set the status "waiting" in the response message. The PKI management entity MUST then reply to the pollReq messages as described in <a href="#EE_Polling" class="xref">Section 4.1.7</a>.<a href="#section-5.1.4-1" class="pilcrow">¶</a></p>
<p id="section-5.1.4-2">Typically, as stated in <a href="#RA_Replace" class="xref">Section 5.1.2</a>, an intermediate PKI management entity SHOULD NOT change the sender and recipient nonces even in case it modifies a request or a response message.  In the special case of polling initiated by an intermediate PKI management entity, for example by an LRA with offline transport to an upstream RA, there is an exception.  Between the EE and that entity, pollReq and pollRep messages are exchanged handling the nonces as usual.  Yet when, after some pollRep, the final response from upstream arrives at that PKI management entity, this response contains the recipNonce set to the value copied (as usual) from the senderNonce in the original request message.  The mentioned entity needs to replace the recipNonce in the response message with the senderNonce of the last received pollReq because the downstream entities, including the EE, will expect it in this way.<a href="#section-5.1.4-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="RA_Revoke">
<section id="section-5.2">
        <h3 id="name-revoking-certificates-on-be">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-revoking-certificates-on-be" class="section-name selfRef">Revoking certificates on behalf of another's PKI entities</a>
        </h3>
<p id="section-5.2-1">This PKI management operation can be used by a PKI management entity to revoke a certificate of another PKI entity. This revocation request message MUST be signed by the PKI management entity using its own CMP protection key to prove to the PKI authorization to revoke the certificate on behalf of that PKI entity.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2" class="keepWithNext">Preconditions:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-5.2-3">
   <dt>1</dt>
<dd id="section-5.2-3.1">the certificate to be revoked MUST be known to the PKI management entity<a href="#section-5.2-3.1" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt>2</dt>
<dd id="section-5.2-3.2">the PKI management entity MUST have the authorization to revoke the certificates of other entities issued by the corresponding CA<a href="#section-5.2-3.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-5.2-4" class="keepWithNext">The message sequence for this PKI management operation is identical to that given in <a href="#EE_Revoke" class="xref">Section 4.2</a>, with the following changes:<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-5.2-5">
   <dt>1</dt>
<dd id="section-5.2-5.1">it is not required that the certificate to be revoked is not yet expired or revoked<a href="#section-5.2-5.1" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt>2</dt>
<dd id="section-5.2-5.2">the PKI management entity acts as EE for this message exchange<a href="#section-5.2-5.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt>3</dt>
<dd id="section-5.2-5.3">the rr message MUST be signed using the CMP protection key of the PKI management entity.<a href="#section-5.2-5.3" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="RA_Error">
<section id="section-5.3">
        <h3 id="name-error-reporting-2">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-error-reporting-2" class="section-name selfRef">Error reporting</a>
        </h3>
<p id="section-5.3-1">This functionality should be used by the PKI management entity to report any arising error conditions downstream to the EE. Note that error reporting by the EE upstream to the PKI management entity is described in <a href="#EE_Error" class="xref">Section 4.3</a>.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">In case the error condition is related to specific details of an ir, cr, p10cr, or kur request message it MUST be reported in the specific response message, i.e., an ip, cp, or kup with negative contents.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">General error conditions, e.g., problems with the message header, protection, or extraCerts, and negative feedback on rr, pollReq, certConf, or error messages MUST be reported in the form of an error message.<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<p id="section-5.3-4">In both situations the PKI management entity reports the errors in the PKIStatusInfo structure of the respective message as described in <a href="#EE_Error" class="xref">Section 4.3</a>.<a href="#section-5.3-4" class="pilcrow">¶</a></p>
<p id="section-5.3-5">An EE receiving any such negative feedback SHOULD log the error appropriately and MUST terminate the current transaction.<a href="#section-5.3-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="Transport_variants">
<section id="section-6">
      <h2 id="name-cmp-message-transport-mecha">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-cmp-message-transport-mecha" class="section-name selfRef">CMP message transport mechanisms</a>
      </h2>
<p id="section-6-1">The CMP messages are designed to be self-contained, such that in principle any transport can be used. HTTP SHOULD be used for online transport while file-based transport MAY be used in case offline transport is required. In case HTTP transport is not desired or possible, CMP messages MAY also be piggybacked on any other reliable transport protocol such as <span><a href="#RFC7252" class="xref">CoAP</a> [<a href="#RFC7252" class="xref">RFC7252</a>]</span>.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">Independently of the means of transport it can happen that messages are lost or that a communication partner does not respond. To prevent waiting indefinitely, each CMP client component SHOULD use a configurable per-request timeout, and each CMP server component SHOULD use a configurable per-response timeout in case a further message is to be expected from the client side. In this way a hanging transaction can be closed cleanly with an error and related resources (for instance, any cached extraCerts) can be freed.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">When conveying a CMP messages in HTTP or MIME-based transport protocols the internet media type "application/pkixcmp" MUST be set for transport encoding as specified in <span><a href="#RFC2510" class="xref">Section 5.3 of RFC 2510</a> [<a href="#RFC2510" class="xref">RFC2510</a>]</span> and <span><a href="#RFC6712" class="xref">Section 3.4 of RFC 6712</a> [<a href="#RFC6712" class="xref">RFC6712</a>]</span>.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">Note: When using TCP as reliable transport layer protocol, which is typical in conjunction with HTTP, there is the option to keep the connection open over the lifetime of transactions containing multiple request-response message pairs. This may improve efficiency but is not required from a security point of view.<a href="#section-6-4" class="pilcrow">¶</a></p>
<div id="HTTP">
<section id="section-6.1">
        <h3 id="name-http-transport">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-http-transport" class="section-name selfRef">HTTP transport</a>
        </h3>
<p id="section-6.1-1">This transport mechanism can be used by a PKI entity to transfer CMP messages over HTTP. If HTTP transport is used the specifications as described in <span>[<a href="#RFC6712" class="xref">RFC6712</a>]</span> and updated by <span><a href="#I-D.ietf-lamps-cmp-updates" class="xref">CMP Updates</a> [<a href="#I-D.ietf-lamps-cmp-updates" class="xref">I-D.ietf-lamps-cmp-updates</a>]</span> MUST be followed.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2" class="keepWithNext">PKI management operations SHOULD use the following URI path:<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<span id="name-http-endpoints"></span><div id="http_endpoints">
<table class="left" id="table-9">
          <caption>
<a href="#table-9" class="selfRef">Table 9</a>:
<a href="#name-http-endpoints" class="selfRef">HTTP endpoints</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">PKI management operation</th>
              <th class="text-center" rowspan="1" colspan="1">Path</th>
              <th class="text-left" rowspan="1" colspan="1">Details</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Enroll client to new PKI</td>
              <td class="text-center" rowspan="1" colspan="1">/initialization</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#EE_newPKI" class="xref">Section 4.1.1</a>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Enroll client to existing PKI</td>
              <td class="text-center" rowspan="1" colspan="1">/certification</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#EE_trustedPKI" class="xref">Section 4.1.2</a>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Update client certificate</td>
              <td class="text-center" rowspan="1" colspan="1">/keyupdate</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#EE_Update" class="xref">Section 4.1.3</a>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Enroll client using PKCS#10</td>
              <td class="text-center" rowspan="1" colspan="1">/p10</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#EE_P10" class="xref">Section 4.1.5</a>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <p id="section-6.1-3.2.5.1.1">Enroll client using central key generation<a href="#section-6.1-3.2.5.1.1" class="pilcrow">¶</a></p>
<p id="section-6.1-3.2.5.1.2">Note: This path element MAY also be appended to each of the path elements listed above.<a href="#section-6.1-3.2.5.1.2" class="pilcrow">¶</a></p>
</td>
              <td class="text-center" rowspan="1" colspan="1">/serverkeygen</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#EE_centralKeyGeneration" class="xref">Section 4.1.6</a>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Revoke client certificate</td>
              <td class="text-center" rowspan="1" colspan="1">/revocation</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#EE_Revoke" class="xref">Section 4.2</a>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Get CA certificates</td>
              <td class="text-center" rowspan="1" colspan="1">/getcacert</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#EE_CACerts" class="xref">Section 4.4.1</a>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Get root CA certificate update</td>
              <td class="text-center" rowspan="1" colspan="1">/getrootupdate</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#EE_RootCAUpdate" class="xref">Section 4.4.2</a>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Get certificate request template</td>
              <td class="text-center" rowspan="1" colspan="1">/getcertreqtemplate</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#EE_Temp" class="xref">Section 4.4.3</a>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <p id="section-6.1-3.2.10.1.1">Additional protection<a href="#section-6.1-3.2.10.1.1" class="pilcrow">¶</a></p>
<p id="section-6.1-3.2.10.1.2">Note: This path element is applicable only between PKI management entities.<a href="#section-6.1-3.2.10.1.2" class="pilcrow">¶</a></p>
</td>
              <td class="text-center" rowspan="1" colspan="1">/nested</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#RA_Add" class="xref">Section 5.1.3</a>
</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-6.1-4">Subsequent certConf, error, and pollReq messages are sent to the URI of the respective PKI management operation.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1-5">The PKI entity will recognize by the HTTP response status code if a configured URI is supported by the PKI management entity by sending a request to its preferred enrollment endpoint.<a href="#section-6.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="HTTPS_Cert">
<section id="section-6.2">
        <h3 id="name-https-transport-using-certi">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-https-transport-using-certi" class="section-name selfRef">HTTPS transport using certificates</a>
        </h3>
<p id="section-6.2-1">This transport mechanism can be used by a PKI entity to further protect the HTTP transport described in <a href="#HTTP" class="xref">Section 6.1</a> using <span><a href="#RFC5246" class="xref">TLS 1.2</a> [<a href="#RFC5246" class="xref">RFC5246</a>]</span> or <span><a href="#RFC8446" class="xref">TLS 1.3</a> [<a href="#RFC8446" class="xref">RFC8446</a>]</span> with certificate-based authentication as described in <span>[<a href="#RFC2818" class="xref">RFC2818</a>]</span>. Using this transport mechanism, the CMP transport via HTTPS MUST use TLS server authentication and SHOULD use TLS client authentication.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2" class="keepWithNext">TLS client:<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-3.1">The client SHOULD use a TLS client certificate as far as available. If no dedicated TLS certificate is available on an EE side, this EE SHOULD use an already existing certificate identifying the EE (e.g., a manufacturer issued certificate).  Each PKI management entity SHOULD use a dedicated TLS client certificate on its upstream (client) interface.<a href="#section-6.2-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.2-3.2">If no usable client certificate is available at the client, server-only authenticated TLS MUST be used.<a href="#section-6.2-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.2-3.3">The client MUST validate the TLS server certificate of its communication partner.<a href="#section-6.2-3.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.2-4" class="keepWithNext">TLS server:<a href="#section-6.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-5.1">The server MUST use a TLS server certificate.<a href="#section-6.2-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.2-5.2">The server MUST validate the TLS certificate of its clients if client authentication is available.<a href="#section-6.2-5.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.2-6">Note: The requirements for checking certificates given in <span>[<a href="#RFC5280" class="xref">RFC5280</a>]</span>, <span>[<a href="#RFC5246" class="xref">RFC5246</a>]</span> and <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span> MUST be followed for the TLS layer. Certificate status checking SHOULD be used for the TLS certificates of communication partners.<a href="#section-6.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="HTTPS_PWD">
<section id="section-6.3">
        <h3 id="name-https-transport-using-share">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-https-transport-using-share" class="section-name selfRef">HTTPS transport using shared secrets</a>
        </h3>
<p id="section-6.3-1">This transport mechanism can be used by a PKI entity to further protect the HTTP transport as described in <a href="#HTTP" class="xref">Section 6.1</a> using <span><a href="#RFC5246" class="xref">TLS 1.2</a> [<a href="#RFC5246" class="xref">RFC5246</a>]</span> or <span><a href="#RFC8446" class="xref">TLS 1.3</a> [<a href="#RFC8446" class="xref">RFC8446</a>]</span> as described in <span>[<a href="#RFC2818" class="xref">RFC2818</a>]</span> with mutual authentication based on shared secret information as described in <span>[<a href="#RFC5054" class="xref">RFC5054</a>]</span>.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">&lt; TBD: Add an appropriate shared secret-based mechanism for TLS 1.3. &gt;<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3" class="keepWithNext">TLS client:<a href="#section-6.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.3-4.1">The client MUST use its shared  secret information for authentication.<a href="#section-6.3-4.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.3-5" class="keepWithNext">TLS server:<a href="#section-6.3-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.3-6.1">The server MUST use a suitable shared secret information for authentication.<a href="#section-6.3-6.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.3-7">&lt; TBD: It needs to be clarified which cipher suite shall be recommended as there seems to be no support for TLS-SRP un JavaSE. &gt;<a href="#section-6.3-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Offline">
<section id="section-6.4">
        <h3 id="name-offline-transport">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-offline-transport" class="section-name selfRef">Offline transport</a>
        </h3>
<p id="section-6.4-1">For transporting CMP messages between PKI entities any mechanism can be used that is able to store and forward binary objects of sufficient length and with sufficient reliability while preserving the order of messages for each transaction.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<p id="section-6.4-2">The transport mechanism SHOULD be able to indicate message loss, excessive delay, and possibly other transmission errors. In such cases the PKI entities using this mechanism SHOULD report an error as specified in <a href="#EE_Error" class="xref">Section 4.3</a> as fare as possible.<a href="#section-6.4-2" class="pilcrow">¶</a></p>
<div id="File-based">
<section id="section-6.4.1">
          <h4 id="name-file-based-transport">
<a href="#section-6.4.1" class="section-number selfRef">6.4.1. </a><a href="#name-file-based-transport" class="section-name selfRef">File-based transport</a>
          </h4>
<p id="section-6.4.1-1">CMP messages MAY be transferred between PKI entities using file-system-based mechanisms, for instance when an off-line end entity or a PKI management entity performs delayed enrollment. Each file MUST contain the ASN.1 DER encoding of one CMP message only, which may be nested. There MUST be no extraneous header or trailer information in the file. The file name extension ".PKI" MUST be used.<a href="#section-6.4.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Other_trans">
<section id="section-6.4.2">
          <h4 id="name-other-asynchronous-transpor">
<a href="#section-6.4.2" class="section-number selfRef">6.4.2. </a><a href="#name-other-asynchronous-transpor" class="section-name selfRef">Other asynchronous transport protocols</a>
          </h4>
<p id="section-6.4.2-1">Other asynchronous transport protocols, e.g., email or website up-/download, MAY transfer CMP messages between PKI entities. A MIME wrapping is defined for those environments that are MIME native. The MIME wrapping in this section is specified in <span>[<a href="#RFC8551" class="xref">RFC8551</a>]</span>, section 3.1.<a href="#section-6.4.2-1" class="pilcrow">¶</a></p>
<p id="section-6.4.2-2">The ASN.1 DER encoding of the CMP messages MUST be transferred using the "application/pkixcmp" content type and base64-encoded content-transfer-encoding as specified in <span>[<a href="#RFC2510" class="xref">RFC2510</a>]</span>, section 5.3. A filename MUST be included either in a content-type or a content-disposition statement. The file name extension ".PKI" MUST be used.<a href="#section-6.4.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="CoAP">
<section id="section-6.5">
        <h3 id="name-coap-transport">
<a href="#section-6.5" class="section-number selfRef">6.5. </a><a href="#name-coap-transport" class="section-name selfRef">CoAP transport</a>
        </h3>
<p id="section-6.5-1">In constrained environments where no HTTP transport is desired or possible, <span><a href="#RFC7252" class="xref">CoAP</a> [<a href="#RFC7252" class="xref">RFC7252</a>]</span> as specified in <span>[<a href="#I-D.ietf-ace-cmpv2-coap-transport" class="xref">I-D.ietf-ace-cmpv2-coap-transport</a>]</span> MAY be used.<a href="#section-6.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Piggybacking">
<section id="section-6.6">
        <h3 id="name-piggybacking-on-other-relia">
<a href="#section-6.6" class="section-number selfRef">6.6. </a><a href="#name-piggybacking-on-other-relia" class="section-name selfRef">Piggybacking on other reliable transport</a>
        </h3>
<p id="section-6.6-1">For online transfer where no HTTP transport is desired or possible CMP messages MAY also be transported on some other reliable protocol. Connection and error handling mechanisms like those specified for HTTP in <span>[<a href="#RFC6712" class="xref">RFC6712</a>]</span> need to be implemented.<a href="#section-6.6-1" class="pilcrow">¶</a></p>
<p id="section-6.6-2">A more detailed specification is out of scope of this document and would need to be given in a separate document, for instance in the scope of the transport protocol used.<a href="#section-6.6-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="IANA">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
    </h2>
</section>
</div>
<div id="Security">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">&lt; TBD: Add any security considerations &gt;<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Acknowledgements">
<section id="section-9">
      <h2 id="name-acknowledgements">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-9-1">We thank the various reviewers of this document.<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-10">
      <h2 id="name-references">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-lamps-cmp-algorithms">[I-D.ietf-lamps-cmp-algorithms]</dt>
        <dd>
<span class="refAuthor">Brockhaus, H.</span><span class="refAuthor">, Aschauer, H.</span><span class="refAuthor">, Ounsworth, M.</span><span class="refAuthor">, and S. Mister</span>, <span class="refTitle">"CMP Algorithms"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lamps-cmp-algorithms-02</span>, <time datetime="2021-01-20" class="refDate">20 January 2021</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-lamps-cmp-algorithms-02">https://tools.ietf.org/html/draft-ietf-lamps-cmp-algorithms-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-lamps-cmp-updates">[I-D.ietf-lamps-cmp-updates]</dt>
        <dd>
<span class="refAuthor">Brockhaus, H.</span><span class="refAuthor"> and D. V. Oheimb</span>, <span class="refTitle">"Certificate Management Protocol (CMP) Updates"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lamps-cmp-updates-08</span>, <time datetime="2021-02-22" class="refDate">22 February 2021</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-lamps-cmp-updates-08">https://tools.ietf.org/html/draft-ietf-lamps-cmp-updates-08</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-lamps-crmf-update-algs">[I-D.ietf-lamps-crmf-update-algs]</dt>
        <dd>
<span class="refAuthor">Housley, R.</span>, <span class="refTitle">"Algorithm Requirements Update to the Internet X.509 Public Key Infrastructure Certificate Request Message Format (CRMF)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lamps-crmf-update-algs-04</span>, <time datetime="2021-02-19" class="refDate">19 February 2021</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-lamps-crmf-update-algs-04">https://tools.ietf.org/html/draft-ietf-lamps-crmf-update-algs-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2986">[RFC2986]</dt>
        <dd>
<span class="refAuthor">Nystrom, M.</span><span class="refAuthor"> and B. Kaliski</span>, <span class="refTitle">"PKCS #10: Certification Request Syntax Specification Version 1.7"</span>, <span class="seriesInfo">RFC 2986</span>, <span class="seriesInfo">DOI 10.17487/RFC2986</span>, <time datetime="2000-11" class="refDate">November 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2986">https://www.rfc-editor.org/info/rfc2986</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4086">[RFC4086]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span><span class="refAuthor">, Schiller, J.</span><span class="refAuthor">, and S. Crocker</span>, <span class="refTitle">"Randomness Requirements for Security"</span>, <span class="seriesInfo">BCP 106</span>, <span class="seriesInfo">RFC 4086</span>, <span class="seriesInfo">DOI 10.17487/RFC4086</span>, <time datetime="2005-06" class="refDate">June 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4086">https://www.rfc-editor.org/info/rfc4086</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4210">[RFC4210]</dt>
        <dd>
<span class="refAuthor">Adams, C.</span><span class="refAuthor">, Farrell, S.</span><span class="refAuthor">, Kause, T.</span><span class="refAuthor">, and T. Mononen</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate Management Protocol (CMP)"</span>, <span class="seriesInfo">RFC 4210</span>, <span class="seriesInfo">DOI 10.17487/RFC4210</span>, <time datetime="2005-09" class="refDate">September 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4210">https://www.rfc-editor.org/info/rfc4210</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4211">[RFC4211]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate Request Message Format (CRMF)"</span>, <span class="seriesInfo">RFC 4211</span>, <span class="seriesInfo">DOI 10.17487/RFC4211</span>, <time datetime="2005-09" class="refDate">September 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4211">https://www.rfc-editor.org/info/rfc4211</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5280">[RFC5280]</dt>
        <dd>
<span class="refAuthor">Cooper, D.</span><span class="refAuthor">, Santesson, S.</span><span class="refAuthor">, Farrell, S.</span><span class="refAuthor">, Boeyen, S.</span><span class="refAuthor">, Housley, R.</span><span class="refAuthor">, and W. Polk</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"</span>, <span class="seriesInfo">RFC 5280</span>, <span class="seriesInfo">DOI 10.17487/RFC5280</span>, <time datetime="2008-05" class="refDate">May 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5280">https://www.rfc-editor.org/info/rfc5280</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5652">[RFC5652]</dt>
        <dd>
<span class="refAuthor">Housley, R.</span>, <span class="refTitle">"Cryptographic Message Syntax (CMS)"</span>, <span class="seriesInfo">STD 70</span>, <span class="seriesInfo">RFC 5652</span>, <span class="seriesInfo">DOI 10.17487/RFC5652</span>, <time datetime="2009-09" class="refDate">September 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5652">https://www.rfc-editor.org/info/rfc5652</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5958">[RFC5958]</dt>
        <dd>
<span class="refAuthor">Turner, S.</span>, <span class="refTitle">"Asymmetric Key Packages"</span>, <span class="seriesInfo">RFC 5958</span>, <span class="seriesInfo">DOI 10.17487/RFC5958</span>, <time datetime="2010-08" class="refDate">August 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5958">https://www.rfc-editor.org/info/rfc5958</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6712">[RFC6712]</dt>
        <dd>
<span class="refAuthor">Kause, T.</span><span class="refAuthor"> and M. Peylo</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure -- HTTP Transfer for the Certificate Management Protocol (CMP)"</span>, <span class="seriesInfo">RFC 6712</span>, <span class="seriesInfo">DOI 10.17487/RFC6712</span>, <time datetime="2012-09" class="refDate">September 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6712">https://www.rfc-editor.org/info/rfc6712</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="ETSI-3GPP.33.310">[ETSI-3GPP.33.310]</dt>
        <dd>
<span class="refAuthor">3GPP</span>, <span class="refTitle">"Network Domain Security (NDS); Authentication Framework (AF)"</span>, <span class="seriesInfo">3GPP TS 33.310 16.6.0</span>, <time datetime="2020-12-16" class="refDate">16 December 2020</time>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-cmpv2-coap-transport">[I-D.ietf-ace-cmpv2-coap-transport]</dt>
        <dd>
<span class="refAuthor">Sahni, M.</span><span class="refAuthor"> and S. Tripathi</span>, <span class="refTitle">"CoAP Transport for CMPV2"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-cmpv2-coap-transport-00</span>, <time datetime="2021-02-21" class="refDate">21 February 2021</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-ace-cmpv2-coap-transport-00">https://tools.ietf.org/html/draft-ietf-ace-cmpv2-coap-transport-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IEC.62443-3-3">[IEC.62443-3-3]</dt>
        <dd>
<span class="refAuthor">IEC</span>, <span class="refTitle">"Industrial communication networks - Network and system security - Part 3-3: System security requirements and security levels"</span>, <span class="seriesInfo">IEC 62443-3-3</span>, <time datetime="2013-08" class="refDate">August 2013</time>, <span>&lt;<a href="https://webstore.iec.ch/publication/7033">https://webstore.iec.ch/publication/7033</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IEEE.802.1AR_2018">[IEEE.802.1AR_2018]</dt>
        <dd>
<span class="refAuthor">IEEE</span>, <span class="refTitle">"IEEE Standard for Local and metropolitan area networks - Secure Device Identity"</span>, <span class="seriesInfo">IEEE 802.1AR-2018</span>, <span class="seriesInfo">DOI 10.1109/IEEESTD.2018.8423794</span>, <time datetime="2018-08-02" class="refDate">2 August 2018</time>, <span>&lt;<a href="https://ieeexplore.ieee.org/document/8423794">https://ieeexplore.ieee.org/document/8423794</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NIST.CSWP.04162018">[NIST.CSWP.04162018]</dt>
        <dd>
<span class="refAuthor">National Institute of Standards and Technology (NIST)</span>, <span class="refTitle">"Framework for Improving Critical Infrastructure Cybersecurity, Version 1.1"</span>, <span class="seriesInfo">NIST NIST CSWP 04162018</span>, <span class="seriesInfo">DOI 10.6028/NIST.CSWP.04162018</span>, <time datetime="2018-04" class="refDate">April 2018</time>, <span>&lt;<a href="http://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf">http://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NIST.SP.800-57p1r5">[NIST.SP.800-57p1r5]</dt>
        <dd>
<span class="refAuthor">Barker, E B.</span>, <span class="refTitle">"Recommendation for key management, part 1 :general"</span>, <span class="seriesInfo">NIST NIST.SP.800-57pt1r5</span>, <span class="seriesInfo">DOI 10.6028/NIST.SP.800-57pt1r5</span>, <time datetime="2020" class="refDate">2020</time>, <span>&lt;<a href="https://doi.org/10.6028/NIST.SP.800-57pt1r5">https://doi.org/10.6028/NIST.SP.800-57pt1r5</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2510">[RFC2510]</dt>
        <dd>
<span class="refAuthor">Adams, C.</span><span class="refAuthor"> and S. Farrell</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate Management Protocols"</span>, <span class="seriesInfo">RFC 2510</span>, <span class="seriesInfo">DOI 10.17487/RFC2510</span>, <time datetime="1999-03" class="refDate">March 1999</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2510">https://www.rfc-editor.org/info/rfc2510</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2818">[RFC2818]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"HTTP Over TLS"</span>, <span class="seriesInfo">RFC 2818</span>, <span class="seriesInfo">DOI 10.17487/RFC2818</span>, <time datetime="2000-05" class="refDate">May 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2818">https://www.rfc-editor.org/info/rfc2818</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3647">[RFC3647]</dt>
        <dd>
<span class="refAuthor">Chokhani, S.</span><span class="refAuthor">, Ford, W.</span><span class="refAuthor">, Sabett, R.</span><span class="refAuthor">, Merrill, C.</span><span class="refAuthor">, and S. Wu</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate Policy and Certification Practices Framework"</span>, <span class="seriesInfo">RFC 3647</span>, <span class="seriesInfo">DOI 10.17487/RFC3647</span>, <time datetime="2003-11" class="refDate">November 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3647">https://www.rfc-editor.org/info/rfc3647</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5054">[RFC5054]</dt>
        <dd>
<span class="refAuthor">Taylor, D.</span><span class="refAuthor">, Wu, T.</span><span class="refAuthor">, Mavrogiannopoulos, N.</span><span class="refAuthor">, and T. Perrin</span>, <span class="refTitle">"Using the Secure Remote Password (SRP) Protocol for TLS Authentication"</span>, <span class="seriesInfo">RFC 5054</span>, <span class="seriesInfo">DOI 10.17487/RFC5054</span>, <time datetime="2007-11" class="refDate">November 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5054">https://www.rfc-editor.org/info/rfc5054</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5246">[RFC5246]</dt>
        <dd>
<span class="refAuthor">Dierks, T.</span><span class="refAuthor"> and E. Rescorla</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.2"</span>, <span class="seriesInfo">RFC 5246</span>, <span class="seriesInfo">DOI 10.17487/RFC5246</span>, <time datetime="2008-08" class="refDate">August 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5246">https://www.rfc-editor.org/info/rfc5246</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span><span class="refAuthor">, Hartke, K.</span><span class="refAuthor">, and C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7252">https://www.rfc-editor.org/info/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8366">[RFC8366]</dt>
        <dd>
<span class="refAuthor">Watsen, K.</span><span class="refAuthor">, Richardson, M.</span><span class="refAuthor">, Pritikin, M.</span><span class="refAuthor">, and T. Eckert</span>, <span class="refTitle">"A Voucher Artifact for Bootstrapping Protocols"</span>, <span class="seriesInfo">RFC 8366</span>, <span class="seriesInfo">DOI 10.17487/RFC8366</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8366">https://www.rfc-editor.org/info/rfc8366</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8551">[RFC8551]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span><span class="refAuthor">, Ramsdell, B.</span><span class="refAuthor">, and S. Turner</span>, <span class="refTitle">"Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 4.0 Message Specification"</span>, <span class="seriesInfo">RFC 8551</span>, <span class="seriesInfo">DOI 10.17487/RFC8551</span>, <time datetime="2019-04" class="refDate">April 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8551">https://www.rfc-editor.org/info/rfc8551</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="UNISIG.Subset-137">[UNISIG.Subset-137]</dt>
      <dd>
<span class="refAuthor">UNISIG</span>, <span class="refTitle">"Subset-137; ERTMS/ETCS On-line Key Management FFFIS; V1.0.0"</span>, <time datetime="2015-12" class="refDate">December 2015</time>, <span>&lt;<a href="https://www.era.europa.eu/filebrowser/download/542_en">https://www.era.europa.eu/filebrowser/download/542_en</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="Param_Example">
<section id="section-appendix.a">
      <h2 id="name-example-certreqtemplate">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-example-certreqtemplate" class="section-name selfRef">Example CertReqTemplate</a>
      </h2>
<p id="section-appendix.a-1">This section provides a concrete example for the content of an infoValue used of type id-it-certReqTemplate as described in <a href="#EE_Temp" class="xref">Section 4.4.3</a>.<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
<p id="section-appendix.a-2" class="keepWithNext">Suppose the server requires that the certTemplate contains the issuer field with a value to be filled in by the EE, the subject field with a common name to be filled in by the EE and two organizational unit fields with given values "myDept" and "myGroup", the publicKey field with an ECC key on curve secp256r1 or RSA public key of length 2048, the subjectAltName extension with DNS name "www.myServer.com" and an IP address to be filled in, the keyUsage extension marked critical with the value digitalSignature and keyAgreement, and the extKeyUsage extension with values to be filled in by the EE. Then the infoValue with certTemplate and keySpec returned to the EE must be encoded as follows:<a href="#section-appendix.a-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-appendix.a-3">
<pre>
SEQUENCE {
  SEQUENCE {
    [3] {
      SEQUENCE {}
      }
    [5] {
      SEQUENCE {
        SET {
          SEQUENCE {
            OBJECT IDENTIFIER commonName (2 5 4 3)
            UTnF8String ''
            }
          }
          SEQUENCE {
            OBJECT IDENTIFIER organizationalUnitName (2 5 4 11)
            UTF8String 'myDept'
            }
          }
        SET {
          SEQUENCE {
            OBJECT IDENTIFIER organizationalUnitName (2 5 4 11)
            UTF8String 'myGroup'
            }
          }
        }
    [6] {
      SEQUENCE {
        null
        NULL
        }
      BIT STRING, encapsulates {
        SEQUENCE {}
        }
      }
    [9] {
      SEQUENCE {
        OBJECT IDENTIFIER subjectAltName (2 5 29 17)
        OCTET STRING, encapsulates {
          SEQUENCE {
            [2] 'www.myServer.com'
            [7] ''
            }
          }
        }
      SEQUENCE {
        OBJECT IDENTIFIER keyUsage (2 5 29 15)
        BOOLEAN TRUE
        OCTET STRING, encapsulates {
          BIT STRING 3 unused bits
            '10001'B
          }
        }
      SEQUENCE {
        OBJECT IDENTIFIER extKeyUsage (2 5 29 37)
        OCTET STRING, encapsulates {
          SEQUENCE {}
          }
        }
      }
    }
  SEQUENCE {
    SEQUENCE {
      OBJECT IDENTIFIER aldId (1 3 6 1 5 5 7 5 1 TBD3)
        SEQUENCE {
          OBJECT IDENTIFIER ecPublicKey (1 2 840 10045 2 1)
          OBJECT IDENTIFIER secp256r1 (1 2 840 10045 3 1 7)
          }
      }
    SEQUENCE {
      OBJECT IDENTIFIER rsaKeyLen (1 3 6 1 5 5 7 5 1 TBD4)
      INTEGER 2048
      }
    }
  }
</pre><a href="#section-appendix.a-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="History">
<section id="section-appendix.b">
      <h2 id="name-history-of-changes">
<a href="#section-appendix.b" class="section-number selfRef">Appendix B. </a><a href="#name-history-of-changes" class="section-name selfRef">History of changes</a>
      </h2>
<p id="section-appendix.b-1">Note: This appendix will be deleted in the final version of the document.<a href="#section-appendix.b-1" class="pilcrow">¶</a></p>
<p id="section-appendix.b-2" class="keepWithNext">From version 04 -&gt; 05:<a href="#section-appendix.b-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-appendix.b-3.1">Changed to XML V3<a href="#section-appendix.b-3.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-3.2">Added algorithm names introducted in CMP Algorithms Section 7.3 to Section 4 of this document<a href="#section-appendix.b-3.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-3.3">Updates Syntax in Section 4.4.3 due to changes made in CMP Updates<a href="#section-appendix.b-3.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-3.4">Deleted the text on HTTP-based discovery as discussed in Section 6.1<a href="#section-appendix.b-3.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-3.5">Updates Appendix A due to change syntax in Section 4.4.3<a href="#section-appendix.b-3.5" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-3.6">Many clarifications and changes in wording thanks to David's extensive review<a href="#section-appendix.b-3.6" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.b-4" class="keepWithNext">From version 03 -&gt; 04:<a href="#section-appendix.b-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-appendix.b-5.1">Deleted normative text sections on algorithms and refer to CMP Algorithms and CRMF Algorithm Requirements Update instead<a href="#section-appendix.b-5.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-5.2">Some clarifications and changes in wording<a href="#section-appendix.b-5.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.b-6" class="keepWithNext">From version 02 -&gt; 03:<a href="#section-appendix.b-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-appendix.b-7.1">Updated the interoperability with [UNISIG.Subset-137] in Section 1.4.<a href="#section-appendix.b-7.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-7.2">Changed Section 2.3 to a tabular layout to enhanced readability<a href="#section-appendix.b-7.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-7.3">Added a ToDo to section 3.1 on aligning with the CMP Algorithms draft that will be set up as decided in IETF 108<a href="#section-appendix.b-7.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-7.4">Updated section 4.1.6 to add the AsymmetricKey Package structure to transport a newly generated private key as decided in IETF 108<a href="#section-appendix.b-7.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-7.5">Added a ToDo to section 4.1.7 on required review of the nonce handling in case an offline LRA responds and not forwards the pollReq messages<a href="#section-appendix.b-7.5" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-7.6">Updated Section 4 due to the definition of the new ITAV OIDs in CMP Updates<a href="#section-appendix.b-7.6" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-7.7">Updated Section 4.4.4 to utilize controls instead of rsaKeyLen (see thread "dtaft-ietf-lamps-cmp-updates and rsaKeyLen")<a href="#section-appendix.b-7.7" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-7.8">Deleted the section on definition and discovery of HTTP URIs and copied the text to the HTTP transport section and to CMP Updates section 3.2<a href="#section-appendix.b-7.8" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-7.9">Added some explanation to Section 5.1.2 and Section 5.1.3 on using nested messages when a protection by the RA is required.<a href="#section-appendix.b-7.9" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-7.10">Deleted the section on HTTP URI definition and discovery as some content was moved to CMP Updates. The rest of the content was moved back to the HTTP transport section<a href="#section-appendix.b-7.10" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-7.11">Deleted the ASN.1 module after moving the new OIDs id-it-caCerts, id-it-rootCaKeyUpdate, and id-it-certReqTemplate to CMP Updates<a href="#section-appendix.b-7.11" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-7.12">Minor changes in wording and addition of some open ToDos<a href="#section-appendix.b-7.12" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.b-8" class="keepWithNext">From version 01 -&gt; 02:<a href="#section-appendix.b-8" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-appendix.b-9.1">Extend <a href="#Compatibility" class="xref">Section 1.4</a> with regard to conflicts with UNISIG Subset-137.<a href="#section-appendix.b-9.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-9.2">Minor clarifications on extraCerts in <a href="#extraCerts" class="xref">Section 3.3</a> and <a href="#EE_newPKI" class="xref">Section 4.1.1</a>.<a href="#section-appendix.b-9.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-9.3">Complete specification of requesting a certificate from a trusted PKI with signature protection in <a href="#EE_trustedPKI" class="xref">Section 4.1.2</a>.<a href="#section-appendix.b-9.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-9.4">Changed from symmetric key-encryption to password-based key management technique in section <a href="#EE_KGPB" class="xref">Section 4.1.6.3</a> as discussed on the mailing list (see thread "draft-ietf-lamps-lightweight-cmp-profile-01, section 5.1.6.1")<a href="#section-appendix.b-9.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-9.5">Changed delayed enrollment described in <a href="#EE_Polling" class="xref">Section 4.1.7</a> from recommended to optional as decided at IETF 107<a href="#section-appendix.b-9.5" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-9.6">Introduced the new RootCAKeyUpdate structure for root CA certificate update in <a href="#EE_RootCAUpdate" class="xref">Section 4.4.2</a> as decided at IETF 107 (also see email thread "draft-ietf-lamps-lightweight-cmp-profile-01, section 5.4.3")<a href="#section-appendix.b-9.6" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-9.7">Extend the description of the CertReqTemplate PKI management operation, including an example added in the Appendix.  Keep rsaKeyLen as a single integer value in <a href="#EE_Temp" class="xref">Section 4.4.3</a> as discussed on the mailing list (see thread "draft-ietf-lamps-lightweight-cmp-profile-01, section 5.4.4")<a href="#section-appendix.b-9.7" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-9.8">Deleted Sections "Get certificate management configuration" and "Get enrollment voucher" as decided at IETF 107<a href="#section-appendix.b-9.8" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-9.9">Complete specification of adding an additional protection by an PKI management entity in <a href="#RA_Add" class="xref">Section 5.1.3</a>.<a href="#section-appendix.b-9.9" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-9.10">Added a section on HTTP URI definition and discovery and extended <a href="#HTTP" class="xref">Section 6.1</a> on definition and discovery of supported HTTP URIs and content types, add a path for nested messages as specified in <a href="#RA_Add" class="xref">Section 5.1.3</a> and delete the paths for /getCertMgtConfig and /getVoucher<a href="#section-appendix.b-9.10" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-9.11">Changed <a href="#Offline" class="xref">Section 6.4</a> to address offline transport and added more detailed specification file-based transport of CMP<a href="#section-appendix.b-9.11" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-9.12">Added a reference to the new I-D of Mohit Sahni on "CoAP Transport for CMPV2" in <a href="#CoAP" class="xref">Section 6.5</a>; thanks to Mohit supporting the effort to ease utilization of CMP<a href="#section-appendix.b-9.12" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-9.13">Moved the change history to the Appendix<a href="#section-appendix.b-9.13" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-9.14">Minor changes in wording<a href="#section-appendix.b-9.14" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.b-10" class="keepWithNext">From version 00 -&gt; 01:<a href="#section-appendix.b-10" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-appendix.b-11.1">
          <p id="section-appendix.b-11.1.1">Harmonize terminology with <span><a href="#RFC4210" class="xref">CMP</a> [<a href="#RFC4210" class="xref">RFC4210</a>]</span>, e.g.,<a href="#section-appendix.b-11.1.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-appendix.b-11.1.2.1">transaction, message sequence, exchange, use case -&gt; PKI management operation<a href="#section-appendix.b-11.1.2.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-appendix.b-11.1.2.2">PKI component, (L)RA/CA -&gt; PKI management entity<a href="#section-appendix.b-11.1.2.2" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="compact" id="section-appendix.b-11.2">Minor changes in wording<a href="#section-appendix.b-11.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.b-12" class="keepWithNext">From draft-brockhaus-lamps-lightweight-cmp-profile-03 -&gt; draft-ietf-lamps-lightweight-cmp-profile-00:<a href="#section-appendix.b-12" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-appendix.b-13.1">Changes required to reflect WG adoption<a href="#section-appendix.b-13.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-13.2">Minor changes in wording<a href="#section-appendix.b-13.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.b-14" class="keepWithNext">From version 02 -&gt; 03:<a href="#section-appendix.b-14" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-appendix.b-15.1">Added a short summary of <span>[<a href="#RFC4210" class="xref">RFC4210</a>]</span> Appendix D and E in <a href="#Existing_profiles" class="xref">Section 1.3</a>.<a href="#section-appendix.b-15.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-15.2">Clarified some references to different sections and added some clarification in response to feedback from Michael Richardson and Tomas Gustavsson.<a href="#section-appendix.b-15.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-15.3">Added an additional label to the operational path to address multiple CAs or certificate profiles in <a href="#HTTP" class="xref">Section 6.1</a>.<a href="#section-appendix.b-15.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.b-16" class="keepWithNext">From version 01 -&gt; 02:<a href="#section-appendix.b-16" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-appendix.b-17.1">Added some clarification on the key management techniques for protection of centrally generated keys in <a href="#EE_centralKeyGeneration" class="xref">Section 4.1.6</a>.<a href="#section-appendix.b-17.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-17.2">Added some clarifications on the certificates for root CA certificate update in <a href="#EE_RootCAUpdate" class="xref">Section 4.4.2</a>.<a href="#section-appendix.b-17.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-17.3">Added a section to specify the usage of nested messages for RAs to add an additional protection for further discussion, see <a href="#RA_Add" class="xref">Section 5.1.3</a>.<a href="#section-appendix.b-17.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-17.4">Added a table containing endpoints for HTTP transport in <a href="#HTTP" class="xref">Section 6.1</a> to simplify addressing PKI management entities.<a href="#section-appendix.b-17.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-17.5">Added some ToDos resulting from discussion with Tomas Gustavsson.<a href="#section-appendix.b-17.5" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-17.6">Minor clarifications and changes in wording.<a href="#section-appendix.b-17.6" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.b-18" class="keepWithNext">From version 00 -&gt; 01:<a href="#section-appendix.b-18" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-appendix.b-19.1">Added a section to specify the enrollment with an already trusted PKI for further discussion, see <a href="#EE_trustedPKI" class="xref">Section 4.1.2</a>.<a href="#section-appendix.b-19.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-19.2">Complete specification of requesting a certificate from a legacy PKI using a <span><a href="#RFC2986" class="xref">PKCS#10</a> [<a href="#RFC2986" class="xref">RFC2986</a>]</span> request in <a href="#EE_P10" class="xref">Section 4.1.5</a>.<a href="#section-appendix.b-19.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-19.3">Complete specification of adding central generation of a key pair on behalf of an end entity in <a href="#EE_centralKeyGeneration" class="xref">Section 4.1.6</a>.<a href="#section-appendix.b-19.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-19.4">Complete specification of handling delayed enrollment due to asynchronous message delivery in <a href="#EE_Polling" class="xref">Section 4.1.7</a>.<a href="#section-appendix.b-19.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-19.5">Complete specification of additional support messages, e.g., to update a Root CA certificate or to request an <span><a href="#RFC8366" class="xref">RFC 8366</a> [<a href="#RFC8366" class="xref">RFC8366</a>]</span> voucher, in <a href="#EE_GeneralMessage" class="xref">Section 4.4</a>.<a href="#section-appendix.b-19.5" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-19.6">Minor changes in wording.<a href="#section-appendix.b-19.6" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.b-20" class="keepWithNext">From draft-brockhaus-lamps-industrial-cmp-profile-00 -&gt; draft-brockhaus-lamps-lightweight-cmp-profile-00:<a href="#section-appendix.b-20" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-appendix.b-21.1">Change focus from industrial to more multi-purpose use cases and lightweight CMP profile.<a href="#section-appendix.b-21.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-21.2">Incorporate the omitted confirmation into the header specified in <a href="#Header" class="xref">Section 3.1</a> and described in the standard enrollment use case in <a href="#EE_newPKI" class="xref">Section 4.1.1</a> due to discussion with Tomas Gustavsson.<a href="#section-appendix.b-21.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-21.3">Change from OPTIONAL to RECOMMENDED for use case 'Revoke another's entities certificate' in <a href="#RA_Revoke" class="xref">Section 5.2</a>, because it is regarded as important functionality in many environments to enable the management station to revoke EE certificates.<a href="#section-appendix.b-21.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-21.4">Complete the specification of the revocation message flow in <a href="#EE_Revoke" class="xref">Section 4.2</a> and <a href="#RA_Revoke" class="xref">Section 5.2</a>.<a href="#section-appendix.b-21.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-21.5">The CoAP based transport mechanism and piggybacking of CMP messages on top of other reliable transport protocols is out of scope of this document and would need to be specified in another document.<a href="#section-appendix.b-21.5" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-appendix.b-21.6">Further minor changes in wording.<a href="#section-appendix.b-21.6" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.c">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Hendrik Brockhaus (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Siemens AG</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:hendrik.brockhaus@siemens.com" class="email">hendrik.brockhaus@siemens.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Steffen Fries</span></div>
<div dir="auto" class="left"><span class="org">Siemens AG</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:steffen.fries@siemens.com" class="email">steffen.fries@siemens.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">David von Oheimb</span></div>
<div dir="auto" class="left"><span class="org">Siemens AG</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:david.von.oheimb@siemens.com" class="email">david.von.oheimb@siemens.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
