<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>The Hypertext Transfer Protocol (HTTP)
  Entity Tag ("ETag") Response Header in Write Operations</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="The Hypertext Transfer Protocol (HTTP)
  Entity Tag (&quot;ETag&quot;) Response Header in Write Operations">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">J. Reschke</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">greenbytes</td></tr>
<tr><td class="header">Updates: <a href='http://tools.ietf.org/html/rfc2616'>2616</a> (if&nbsp;approved)</td><td class="header">October 25, 2007</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: April 27, 2008</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />The Hypertext Transfer Protocol (HTTP)
  Entity Tag ("ETag") Response Header in Write Operations<br />draft-reschke-http-etag-on-write-08</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 27, 2008.</p>

<h3>Abstract</h3>

<p>
      The Hypertext Transfer Protocol (HTTP) specifies a state identifier,
      called "Entity Tag", to be returned in the "ETag" response header.  However,
      the description of this header for write operations
      such as PUT is incomplete, and has caused confusion among developers and
      protocol designers, and potentially interoperability problems.
    
</p>
<p>
      This document explains the problem in detail and suggests both a 
      clarification for a revision to the HTTP/1.1 specification (RFC2616) and a new header for use in responses,
      making HTTP entity tags more useful for user agents that want to avoid
      round-trips to the server after modifying a resource.
    
</p>
<h3>Editorial Note (To be removed by RFC Editor before publication)</h3>

<p>
      Distribution of this document is unlimited. Please send comments to the 
      Hypertext Transfer Protocol (HTTP) mailing list at <a href='mailto:ietf-http-wg@w3.org'>ietf-http-wg@w3.org</a>, which may be joined by sending a message with subject 
      "subscribe" to <a href='mailto:ietf-http-wg-request@w3.org?subject=subscribe'>ietf-http-wg-request@w3.org</a>.
    
</p>
<p>
      Discussions of the HTTP working group are archived at
      <a href='http://lists.w3.org/Archives/Public/ietf-http-wg/'>http://lists.w3.org/Archives/Public/ietf-http-wg/</a>.               
    
</p>
<p>
      XML versions, latest edits and the issues list for this document
      are available from <a href='http://greenbytes.de/tech/webdav/#draft-reschke-http-etag-on-write'>http://greenbytes.de/tech/webdav/#draft-reschke-http-etag-on-write</a>.
    
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#introduction">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">1.1.</a>&nbsp;
Questions out of Scope<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#problem">1.2.</a>&nbsp;
The Interoperability Problem<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc2616.definitions">1.3.</a>&nbsp;
Analysis of RFC2616's Definitions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.4.</a>&nbsp;
Prior Work<br />
<a href="#notational.conventions">2.</a>&nbsp;
Notational Conventions<br />
<a href="#clarifications">3.</a>&nbsp;
Clarifications on the Behavior of the 'ETag' Response Header<br />
<a href="#header.entity-transform">4.</a>&nbsp;
The 'Entity-Transform' Header<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">4.1.</a>&nbsp;
Examples<br />
<a href="#anchor4">5.</a>&nbsp;
How This Helps<br />
<a href="#anchor5">6.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor6">7.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#anchor9">Appendix&nbsp;A.</a>&nbsp;
Use Cases<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#simple.authoring">A.1.</a>&nbsp;
Simple Authoring<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">A.2.</a>&nbsp;
Simple Authoring, with Entity-Transform header<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#setting.both.content.and.metadata">A.3.</a>&nbsp;
Setting both Content and Metadata<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#setting.both.content.and.metadata.new.style">A.4.</a>&nbsp;
Setting both Content and Metadata, new style<br />
<a href="#anchor11">Appendix&nbsp;B.</a>&nbsp;
Change Log (to be removed by RFC Editor before publication)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">B.1.</a>&nbsp;
Since draft-reschke-http-etag-on-write-00<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">B.2.</a>&nbsp;
Since draft-reschke-http-etag-on-write-01<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">B.3.</a>&nbsp;
Since draft-reschke-http-etag-on-write-02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">B.4.</a>&nbsp;
Since draft-reschke-http-etag-on-write-03<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">B.5.</a>&nbsp;
Since draft-reschke-http-etag-on-write-04<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">B.6.</a>&nbsp;
Since draft-reschke-http-etag-on-write-05<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">B.7.</a>&nbsp;
Since draft-reschke-http-etag-on-write-06<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">B.8.</a>&nbsp;
Since draft-reschke-http-etag-on-write-07<br />
<a href="#anchor20">Appendix&nbsp;C.</a>&nbsp;
Open issues (to be removed by RFC Editor prior to publication)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">C.1.</a>&nbsp;
edit<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
    The Hypertext Transfer Protocol (HTTP) specifies a state identifier,
    called "Entity Tag", to be returned in the "ETag" response header (see
    <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, Section 14.19).  However,
    the description of this header for write operations
    such as PUT is incomplete, and has caused confusion among developers and
    protocol designers, and potentially interoperability problems.
  
</p>
<p>
    This document explains the problem in detail and suggests both a 
    clarification for a revision to <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a> 
    and a new header for use in responses, making HTTP entity tags more useful for user agents that want to avoid
    round-trips to the server after modifying a resource. 
  
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Questions out of Scope</h3>

<p>
    Note that there is a related problem: modifying content-negotiated
    resources.  Here the consensus seems to be simply not to do it. Instead,
    the origin server should reveal specific URIs of content that is not
    content-negotiated in the Content-Location response header (<a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, Section 14.14), and user
    agents should use this more specific URI for authoring. Thus, the remainder
    of this document will focus on resources for which no content negotiation
    takes place.
  
</p>
<p>
    Another related question is the usability of the weak entity tags for
    authoring (see <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, Section 13.3.3). Although
    this document focuses on the usage of strong entity tags, it is believed
    that the changes suggested in this document could be applied to weak
    entity tags as well.
  
</p>
<a name="problem"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
The Interoperability Problem</h3>

<p>
    For a long time, nobody realized that there was a problem at all, or
    those who realized preferred to ignore it.     
  
</p>
<p>
    Server implementers added code that would return the new value of the
    "ETag" header in a response to a successful PUT request. After all, the client
    could be interested in it.
  
</p>
<p>
    User agent developers in turn were happy to get a new "ETag" value, saving
    a subsequent HEAD request to retrieve the new entity tag.
  
</p>
<p>
    However, at some point of time, potentially during a Web Distributed
    Authoring and Versioning (WebDAV, <a class='info' href='#RFC2518'>[RFC2518]<span> (</span><span class='info'>Goland, Y., Whitehead, E., Faizi, A., Carter, S., and D. Jensen, &ldquo;HTTP Extensions for Distributed Authoring -- WEBDAV,&rdquo; February&nbsp;1999.</span><span>)</span></a>, obsoleted by <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., Ed., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>) interoperability
    event, client programmers asked server programmers to always return "ETag" headers
    upon PUT, never ever to change the entity tag without "good reason", and
    - by the way - always to guarantee that the server stores the new content
    octet-by-octet. 
  
</p>
<p>
    From the perspective of client software that wants to treat an HTTP 
    server as a file system replacement, this makes a lot of sense. After all,
    when one writes to a file one usually expects the file system to
    store what was written, and not to unexpectedly change the contents.
  
</p>
<p>
    However, in general, an HTTP server is not a file system replacement. There
    may be some that have been designed that way, and some that expose some
    parts of their namespace that have this quality.
    But in general, HTTP server implementers have a lot of freedom in how 
    resources are implemented. Indeed, this flexibility is one of the reasons
    for HTTP's success, allowing it to be used for a wide range of tasks, of which
    replacing file systems is just one (and not necessarily the most
    interesting one).
  
</p>
<p>
    In particular:
    </p>
<ul class="text">
<li>
      A server may not store a resource as a binary object - in this case,
      the representation returned in a subsequent GET request may just
      be similar, but not identical to what was written. Good examples
      are servers that use HTTP to access XML data (<a class='info' href='#RFC4825'>[RFC4825]<span> (</span><span class='info'>Rosenberg, J., &ldquo;The Extensible Markup Language (XML) Configuration Access Protocol (XCAP),&rdquo; May&nbsp;2007.</span><span>)</span></a>),
      Calendaring data (<a class='info' href='#RFC4791'>[RFC4791]<span> (</span><span class='info'>Daboo, C., Desruisseaux, B., and L. Dusseault, &ldquo;Calendaring Extensions to WebDAV (CalDAV),&rdquo; March&nbsp;2007.</span><span>)</span></a>) or newsfeed data
      (<a class='info' href='#RFC5023'>[RFC5023]<span> (</span><span class='info'>Gregorio, J., Ed. and B. de hOra, Ed., &ldquo;The Atom Publishing Protocol,&rdquo; October&nbsp;2007.</span><span>)</span></a>).
      
</li>
<li>
      A server may change the data being written on purpose, while it is
      being written. Examples that immediately come to mind are keyword
      substitution in a source control system, or filters that remove
      potentially insecure parts out of HTML pages.
      
</li>
</ul><p>
  
</p>
<p>
    Furthermore:
    </p>
<ul class="text">
<li>
      An "unrelated" method such as WebDAV's PROPPATCH (see <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., Ed., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>, Section 9.2)
      may affect the entity body and therefore the entity tag in an
      unexpected way, because the server stores some or all of the WebDAV
      properties inside the entity body (for instance, GPS information inside a
      JPG image file).
      
</li>
</ul><p>
  
</p>
<p>
    As long as servers store the content octet-by-octet, and return exactly
    what the client wrote, there is no problem at all.
  
</p>
<p>
    Things get more interesting when a server does change the content,
    such as in the "simple authoring" example given in <a class='info' href='#simple.authoring'>Appendix&nbsp;A.1<span> (</span><span class='info'>Simple Authoring</span><span>)</span></a>.
    Here, the server does change the content upon writing to the resource,
    yet no harm is done, because the final state of the resource on the
    server does not depend on the client being aware of that.
  
</p>
<p>
    All of the content rewriting examples mentioned above have this quality:
    the client can safely continue to edit the entity it sent, because
    the result of the transformation done by the server will be the same
    in the end. Formally, if we call the server-side transformation "t", the
    initial content "c", and the client-side editing steps "e1" and "e2",
    then
  
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
t(e2(e1(c))) = t(e2(t(e1(c))))
</pre></div>
<p>
      e.g., it is irrelevant whether the client obtained the current entity
      body before doing its second edit.
    
</p>
<p>
    <a class='info' href='#comment.example.for.non.safe.rewrite'>[example.for.non.safe.rewrite]<span> (</span><span class='info'>julian.reschke@greenbytes.de: Question: does anybody know a real-world example for server-side content rewriting where the above is not true?</span><span>)</span></a><a name='example.for.non.safe.rewrite'></a>
  
</p>
<p>
    Problems will only occur if the client uses the entity body it sent,
    and the entity tag it obtained
    in return, in subsequent requests that only transfer part of the 
    entity body, such as GET or PUT requests using the "Range" request header
    (see <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, Section 14.35).
  
</p>
<p>
    Furthermore, some clients need to expose the actual contents to the end user.
    These clients will have to ensure that they really have the current
    representation. 
  
</p>
<p>
    Entity bodies (and thus entity tags) changing due to side effects of
    seemingly unrelated requests are indeed a problem, as demonstrated in
    <a class='info' href='#setting.both.content.and.metadata'>Appendix&nbsp;A.3<span> (</span><span class='info'>Setting both Content and Metadata</span><span>)</span></a>, and this specification
    proposes a way to resolve this in <a class='info' href='#clarifications'>Section&nbsp;3<span> (</span><span class='info'>Clarifications on the Behavior of the 'ETag' Response Header</span><span>)</span></a>.
  
</p>
<a name="rfc2616.definitions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Analysis of RFC2616's Definitions</h3>

<p>
    There are several places in the HTTP/1.1 specification (<a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>) 
    mentioning the "ETag" response header. 
  
</p>
<p>
    Let us start with the header definition in Section 14.19:
  
</p>
<p></p>
<blockquote class="text">
<p>
      The ETag response-header field provides the current value of the entity
      tag for the requested variant. Sections 14.24, 14.26 and 14.44
      describe the headers used with entity tags. The entity tag MAY be
      used for comparison with other entities from the same resource (see
      Section 13.3.3).
    
</p>
</blockquote>

<p>
    The meaning of a "response-header" in turn is defined in Section 6.2:
  
</p>
<p></p>
<blockquote class="text">
<p>
      The response-header fields allow the server to pass additional information
      about the response which cannot be placed in the Status-Line. These header
      fields give information about the server and about further access to the
      resource identified by the Request-URI.
    
</p>
</blockquote>

<p>
    The "ETag" response header itself is mentioned mainly in the context
    of cache validation, such as in Section 13.3.2.
    What is missing is a coherent description on how the origin server can notify the
    user-agent when the entity tag changes as result of a write operation, such 
    as PUT.
  
</p>
<p>
    Indeed, the definition of the 201 Created status code mentions entity tags (Section 10.2.2):
  
</p>
<p></p>
<blockquote class="text">
<p>
      A 201 response MAY contain an ETag response header field indicating the
      current value of the entity tag for the requested variant just created,
      see Section 14.19.
    
</p>
</blockquote>

<p>
    The "ETag" response header is mentioned again in the definition of
    206 Partial Content (Section 10.2.7)
    and 304 Not Modified (Section 10.3.5),
    but notably missing are statements about other 2xx series status codes
    that can occur upon a successful PUT operation, such as 200 OK (Section 10.2.1)
    and 204 No Content (Section 10.2.5).
  
</p>
<p>
    Summarizing, the specification is a bit vague about what an ETag
    response header upon a write operation means,
    but this problem is somewhat mitigated by the precise definition
    of a response header. A proposal for enhancing <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>
    in this regard is made in <a class='info' href='#clarifications'>Section&nbsp;3<span> (</span><span class='info'>Clarifications on the Behavior of the 'ETag' Response Header</span><span>)</span></a> below.
  
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
Prior Work</h3>

<p>
  While working on the revision of <a class='info' href='#RFC2518'>[RFC2518]<span> (</span><span class='info'>Goland, Y., Whitehead, E., Faizi, A., Carter, S., and D. Jensen, &ldquo;HTTP Extensions for Distributed Authoring -- WEBDAV,&rdquo; February&nbsp;1999.</span><span>)</span></a>, the IETF WebDAV
  working group realized that this is a generic problem that needs attention
  independently of WebDAV. An initial attempt was made with
  <a class='info' href='#draft-whitehead-http-etag'>[draft&#8209;whitehead&#8209;http&#8209;etag]<span> (</span><span class='info'>Whitehead, J., &ldquo;Design Considerations for State Identifiers in HTTP and WebDAV,&rdquo; February&nbsp;2006.</span><span>)</span></a> in February 2006, but no
  progress was made since.

</p>
<p>
  At the time of this writing in May 2007, two specifications based on HTTP
  were just published by the RFC Editor, taking two opposite approaches:

  </p>
<ul class="text">
<li>Section 8.5 of <a class='info' href='#RFC4825'>[RFC4825]<span> (</span><span class='info'>Rosenberg, J., &ldquo;The Extensible Markup Language (XML) Configuration Access Protocol (XCAP),&rdquo; May&nbsp;2007.</span><span>)</span></a> makes it a MUST-level
    requirement to return an entity tag upon PUT, even though the very nature of
    an XCAP server will cause it to rewrite contents (due to its XML-based
    storage).
    
</li>
<li>Section 5.3.4 of <a class='info' href='#RFC4791'>[RFC4791]<span> (</span><span class='info'>Daboo, C., Desruisseaux, B., and L. Dusseault, &ldquo;Calendaring Extensions to WebDAV (CalDAV),&rdquo; March&nbsp;2007.</span><span>)</span></a> explicitly forbids
    ("MUST NOT") returning an entity tag upon PUT if the content was rewritten.
    
</li>
</ul><p>

</p>
<p>
  In essence, this makes it impossible to implement an HTTP resource that
  conforms to both specifications. Due to the differing use cases of XCAP and CalDAV,
  this may not be a problem in practice, but the disagreement in itself is
  scary. Publication of these specifications on the standards track will
  make it much harder for future protocols to deal with this topic in a 
  meaningful way (comments were sent during IETF Last Call for CalDAV,
  see <a href='http://www1.ietf.org/mail-archive/web/ietf/current/msg43021.html'>http://www1.ietf.org/mail-archive/web/ietf/current/msg43021.html</a>).

</p>
<a name="notational.conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Notational Conventions</h3>

<p>
    The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL-NOT", "SHOULD",
    "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
    interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>. 
  
</p>
<p>
    The terminology used here follows and extends that in the HTTP specification
    <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, notably the augmented Backus-Naur Form (BNF) defined
    in Section 2.1 of that document.
  
</p>
<a name="clarifications"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Clarifications on the Behavior of the 'ETag' Response Header</h3>

<p>
  This section describes a minimal change to <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, proposed
  in <a href='http://lists.w3.org/Archives/Public/ietf-http-wg/2006JanMar/0003.html'>http://lists.w3.org/Archives/Public/ietf-http-wg/2006JanMar/0003.html</a>.

</p>
<p>
  At the end of Section 10.2 of <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, add:

</p>
<p></p>
<blockquote class="text">
<p>
  The response MAY contain an ETag response header field indicating the
  current value of the entity tag (Section 14.19) for the requested
  variant.  The value SHOULD be the same as the one returned upon a
  subsequent HEAD request addressing the same variant.

</p>
</blockquote>

<p>
  In Section 10.2.1 of <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, remove:

</p>
<p></p>
<blockquote class="text">
<p>
   A 201 response MAY contain an ETag response header field indicating
   the current value of the entity tag for the requested variant just
   created, see Section 14.19.

</p>
</blockquote>

<p>
  In essence, this moves the statement about entity tags in write operations
  from the specific case of status 201 Created into the more generic
  description of the 2xx series status codes.

</p>
<p>
  
  Note that the term "requested variant" is somewhat misleading, in particular
  in the context of write operations (see <a href='http://www.w3.org/Protocols/HTTP/1.1/rfc2616bis/issues/#i69'>http://www.w3.org/Protocols/HTTP/1.1/rfc2616bis/issues/#i69</a>
  on the RFC2616bis issues list).
  

</p>
<a name="header.entity-transform"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
The 'Entity-Transform' Header</h3>

<p>
  The 'Entity-Transform' entity header provides information about whether a 
  transformation has been applied to an entity body.

</p>
<p>
  When used in an HTTP request, its meaning is undefined. In an HTTP response,
  it provides information whether the server has applied a transformation
  when the entity was stored last.

</p>
<p>
  In general, entity headers may be stored in intermediates. The main use
  of this header however applies to the HTTP PUT method, of which by default
  the results are not cacheable (see <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, Section 9.6).
  In addition, the value format is defined so that a client can reliably
  detect whether the information is fresh.

</p>
<p>Format:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Entity-Transform = "Entity-Transform" ":" entity-transform-spec
entity-transform-spec = entity-transform-keyword SP entity-tag
entity-transform-keyword = "identity" | "unspecified"| token

entity-tag = &lt;entity-tag: defined in [RFC2616], Section 3.11&gt;
token = &lt;token: defined in [RFC2616], Section 2.2&gt;
</pre></div>
<p>
  The entity-tag specifies the entity body to which this information applies.

</p>
<p>
  An entity-transform-keyword of "identity" specifies that the origin server has stored the
  entity octet-by-octet, thus the user agent MAY use a local copy of the entity body
  with the given entity-tag for subsequent requests that rely on octet-by-octet identity (such
  as a PUT with "Range" request header).

</p>
<p>
  Both the absence of this response header and any entity-transform-keyword value other than "identity"
  specify that the origin server may have transformed the entity before
  storage, thus a subsequent retrieval will not necessarily return an exact
  copy of the submitted entity.

</p>
<p></p>
<blockquote class="text">
<p>
  Note: usage of keywords other than "identity" or "unspecified" is
  reserved for future revisisions of this specification.

</p>
<p>
  Further note that the definition of the "identity" keyword is independant
  of the type of entity-tag. Thus, when "identity" is returned with a weak
  entity-tag, the client can indeed rely on octet-by-octet identity.

</p>
</blockquote>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Examples</h3>

<p>Content was stored octet-by-octet:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
ETag: "1"
Entity-Transform: identity "1"
</pre></div>
<p>Content was transformed:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
ETag: "2"
Entity-Transform: unspecified "2"
</pre></div>
<p>Response containing a stale "Entity-Transform" header:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
ETag: "3"
Entity-Transform: unspecified "2"
</pre></div>
<p>Note that in this case the newly assigned entity tag and the
entity tag returned in "Entity-Transform" do not match, thus the client is
aware that the header value is stale and can't be used.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
How This Helps</h3>

<p>
  The clarification of <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a> (see <a class='info' href='#clarifications'>Section&nbsp;3<span> (</span><span class='info'>Clarifications on the Behavior of the 'ETag' Response Header</span><span>)</span></a>)
  makes it clear that user agents can use "ETag" headers obtained in write
  operations, as long as they do not require octet-by-octet identity.  In
  particular, a new entity tag can be returned for any method, such
  as a WebDAV PROPPATCH (see <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., Ed., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>, Section 9.2).
  This helps dealing with the problem described in <a class='info' href='#setting.both.content.and.metadata'>Appendix&nbsp;A.3<span> (</span><span class='info'>Setting both Content and Metadata</span><span>)</span></a>.
  See <a class='info' href='#setting.both.content.and.metadata.new.style'>Appendix&nbsp;A.4<span> (</span><span class='info'>Setting both Content and Metadata, new style</span><span>)</span></a> for details.

</p>
<p>
  The addition of the "Entity-Transform" header (see <a class='info' href='#header.entity-transform'>Section&nbsp;4<span> (</span><span class='info'>The 'Entity-Transform' Header</span><span>)</span></a>)
  enables origin servers to signal that they stored an exact copy of the
  content, thus allowing clients not to refetch the content. Note that by
  default (in absence of the response header), a client can not make any
  assumptions about the server's behavior in this regard.  Thus clients will
  only benefit from new servers explicitly setting the new header.

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>
  This document specifies the new HTTP header listed below.

</p>
<p>
</p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Entity-Transform
</dd>
<dt>Applicable protocol:</dt>
<dd>http
</dd>
<dt>Status:</dt>
<dd>informational
</dd>
<dt>Author/Change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document:</dt>
<dd><a class='info' href='#header.entity-transform'>Section&nbsp;4<span> (</span><span class='info'>The 'Entity-Transform' Header</span><span>)</span></a> of this specification
</dd>
</dl></blockquote>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>
  This specification introduces no new security considerations beyond those
  discussed in Section 15 of <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>.

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="HTML">[HTML]</a></td>
<td class="author-text"><a href="mailto:dsr@w3.org">Raggett, D.</a>, Hors, A., and I. Jacobs, &ldquo;<a href="http://www.w3.org/TR/html401/">HTML 4.01 Specification</a>,&rdquo; W3C&nbsp;REC-html401-19991224, December&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2518">[RFC2518]</a></td>
<td class="author-text"><a href="mailto:yarong@microsoft.com">Goland, Y.</a>, <a href="mailto:ejw@ics.uci.edu">Whitehead, E.</a>, <a href="mailto:asad@netscape.com">Faizi, A.</a>, <a href="mailto:srcarter@novell.com">Carter, S.</a>, and <a href="mailto:dcjensen@novell.com">D. Jensen</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2518">HTTP Extensions for Distributed Authoring -- WEBDAV</a>,&rdquo; RFC&nbsp;2518, February&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4791">[RFC4791]</a></td>
<td class="author-text"><a href="mailto:cyrus@daboo.name">Daboo, C.</a>, <a href="mailto:bernard.desruisseaux@oracle.com">Desruisseaux, B.</a>, and <a href="mailto:ldusseault@commerce.net">L. Dusseault</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc4791">Calendaring Extensions to WebDAV (CalDAV)</a>,&rdquo; RFC&nbsp;4791, March&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4825">[RFC4825]</a></td>
<td class="author-text"><a href="mailto:jdrosen@cisco.com">Rosenberg, J.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc4825">The Extensible Markup Language (XML) Configuration Access Protocol (XCAP)</a>,&rdquo; RFC&nbsp;4825, May&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4918">[RFC4918]</a></td>
<td class="author-text"><a href="mailto:ldusseault@commerce.net">Dusseault, L., Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc4918">HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV)</a>,&rdquo; RFC&nbsp;4918, June&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5023">[RFC5023]</a></td>
<td class="author-text"><a href="mailto:joe@bitworking.org">Gregorio, J., Ed.</a> and <a href="mailto:bill@dehora.net">B. de hOra, Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc5023">The Atom Publishing Protocol</a>,&rdquo; RFC&nbsp;5023, October&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="draft-whitehead-http-etag">[draft-whitehead-http-etag]</a></td>
<td class="author-text"><a href="mailto:ejw@cse.ucsc.edu">Whitehead, J.</a>, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-whitehead-http-etag-00.txt">Design Considerations for State Identifiers in HTTP and WebDAV</a>,&rdquo; draft-whitehead-http-etag-00 (work in progress), February&nbsp;2006.<p>
(As of November 2006, there didn't appear to be any activity related to
    this draft.)
</p>
</td></tr>
</table>

<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Use Cases</h3>

<a name="simple.authoring"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Simple Authoring</h3>

<p>
    Let us consider a server not having the quality of preserving octet-by-octet
    identity, for instance because
    of SVN-style keyword expansion in text content (<a href='http://svnbook.red-bean.com/en/1.2/svn-book.html#svn.advanced.props.special.keywords'>http://svnbook.red-bean.com/en/1.2/svn-book.html#svn.advanced.props.special.keywords</a>).
  
</p>
<p>
    In this case, the client has previously retrieved the representation for
    &lt;http://example.com/test&gt;, and the server has returned the ETag "1":
  
</p>
<p>
      &gt;&gt; Request (1)
    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET /test HTTP/1.1
Host: example.com</pre></div>
<p>
      &gt;&gt; Response (1)
    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
Content-Type: text/plain
ETag: "1"

# $Revision: 1 $
Sample text.</pre></div>
<p>
    The client now wants to update the resource. To avoid overwriting
    somebody else's changes, it submits the PUT request with the HTTP
    "If-Match" request header (see <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, Section 14.24):
  
</p>
<p>
      &gt;&gt; Request (2)
    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
PUT /test HTTP/1.1
Host: example.com
If-Match: "1"

# $Revision: 1 $
New sample text.</pre></div>
<p>
    If the resource was modified in the meantime, the server will reject
    the request with a 412 Precondition Failed status:
  
</p>
<p>
      &gt;&gt; Response (2a)
    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 412 Precondition Failed
Content-Type: text/plain

Precondition Failed: entity tag supplied in If-Match request header
did not match current.
</pre></div>
<p>
    In this case, the client usually has take care of merging the changes
    made locally with those made on the server ("Merge Conflict").
  
</p>
<p>
    If there was no overlapping update, the server will execute the
    request and return a new entity tag:
  
</p>
<p>
      &gt;&gt; Response (2b)
    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
Content-Type: text/plain
ETag: "2"</pre></div>
<p>
      Note however, that at this point the client knows the new entity tag,
      but doesn not know the current representation, which will have been
      updated by the server to:
    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
# $Revision: 2 $
New sample text.</pre></div>
<p>
    What seems to be a problem at first may not be a real problem in 
    practice. Let us assume that the client continues editing the resource,
    using the entity tag obtained from the previous request, but editing
    the entity it last sent:
  
</p>
<p>
      &gt;&gt; Request (3)
    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
PUT /test HTTP/1.1
Host: example.com
If-Match: "2"

# $Revision: 1 $
A third attempt.</pre></div>
<p>
    Assuming there was no overlapping update, the PUT request will succeed:
  
</p>
<p>
      &gt;&gt; Response (3)
    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
Content-Type: text/plain
ETag: "3"</pre></div>
<p>
    Note that the only problem here is that the client doesn't have an exact
    copy of the entity it is editing. However, from the server's point of view
    this is entirely irrelevant, because the "Revision" keyword will be
    automatically updated upon every write anyway.
  
</p>
<p>
    In any case, the final contents will be:
  
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
# $Revision: 3 $
A third attempt.</pre></div>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Simple Authoring, with Entity-Transform header</h3>

<p>
    In the example above (<a class='info' href='#simple.authoring'>Appendix&nbsp;A.1<span> (</span><span class='info'>Simple Authoring</span><span>)</span></a>, Response 2b), the server
    returns an ETag response header upon PUT, although the content actually
    was rewritten due to keyword substitution.
  
</p>
<p>
    A server implementing this specification would instead respond with:
  
</p>
<p>
      &gt;&gt; Response (2c)
    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
Content-Type: text/plain
ETag: "2"
Entity-Transform: unspecified "2"</pre></div>
<p>
    This indicates that the content that was sent is not
    octet-by-octet identical to what a subsequent GET request would retrieve.
    It is then up to the client to decide whether it wants to re-fetch the
    content before continuing edits.
  
</p>
<a name="setting.both.content.and.metadata"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Setting both Content and Metadata</h3>

<p>
    In this example, the server exposes data extracted from the HTML
    &lt;title&gt; element (<a class='info' href='#HTML'>[HTML]<span> (</span><span class='info'>Raggett, D., Hors, A., and I. Jacobs, &ldquo;HTML 4.01 Specification,&rdquo; December&nbsp;1999.</span><span>)</span></a>, Section 7.4.2)
    as a custom WebDAV property (<a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., Ed., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>, Section 4), 
    allowing both read and write access.
  
</p>
<p>
    In the first step, the client obtains the current representation for
    &lt;http://example.com/test.html&gt;:
  
</p>
<p>
    &gt;&gt; Request (1)
  
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET /test.html HTTP/1.1
Host: example.com</pre></div>
<p>
    &gt;&gt; Response (1)
  
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
Content-Type: text/html
ETag: "A"

&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div>
<p>
    Next, it adds one paragraph to the &lt;body&gt; element, and gets back
    a new entity tag:
  
</p>
<p>
    &gt;&gt; Request (2)
  
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
PUT /test.html HTTP/1.1
Host: example.com
If-Match: "A"

&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;First paragraph.&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div>
<p>
    &gt;&gt; Response (2)
  
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
ETag: "B"</pre></div>
<p>
    Next, the client sets a custom "title" property (see <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., Ed., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>, Section 9.2):
  
</p>
<p>
    &gt;&gt; Request (3)
  
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
PROPPATCH /test.html HTTP/1.1
Host: example.com
Content-Type: application/xml

&lt;proppatch xmlns="DAV:"&gt;
  &lt;set&gt;
    &lt;prop&gt;
      &lt;title xmlns="http://ns.example.org/"
      &gt;A sample document&lt;/title&gt;
    &lt;/prop&gt;
  &lt;/set&gt;
&lt;/proppatch&gt;</pre></div>
<p>
    &gt;&gt; Response (3)
  
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 207 Multi-Status
Content-Type: application/xml

&lt;multistatus xmlns="DAV:"&gt;
  &lt;response&gt;
    &lt;href&gt;/test.html&lt;/href&gt;
    &lt;propstat&gt;
      &lt;prop&gt;
        &lt;title xmlns="http://ns.example.org/"/&gt;
      &lt;/prop&gt;
      &lt;status&gt;HTTP/1.1 2OO OK&lt;/status&gt;
    &lt;/propstat&gt;
  &lt;/response&gt;
&lt;/multistatus&gt;</pre></div>
<p>
    The server knows how to propagate property changes into the HTML
    content, so it updates the entity by adding an HTML title document
    accordingly. This causes the entity tag changing to "C".
  
</p>
<p>
    The new entity body is shown below, but the client does not
    realize that it did change at all.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;A sample document&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;First paragraph.&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div>
<p>
    A subsequent attempt by the client to update the entity body will fail,
    unless it realizes that changing WebDAV properties may affect the
    entity as well. In this case, it would have had to get the current
    entity tag before proceeding. Of course, this introduces an additional
    round-trip, and a timing window during which overlapping updates by
    other clients would go unnoticed.
  
</p>
<p></p>
<blockquote class="text">
<p>
    Note that a client would be affected by this behaviour even in the
    presence of an exclusive WebDAV write lock (see <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., Ed., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>, Section 7).
  
</p>
</blockquote>

<a name="setting.both.content.and.metadata.new.style"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.4"></a><h3>A.4.&nbsp;
Setting both Content and Metadata, new style</h3>

<p>
    Below we repeat the example from above (<a class='info' href='#setting.both.content.and.metadata'>Appendix&nbsp;A.3<span> (</span><span class='info'>Setting both Content and Metadata</span><span>)</span></a>),
    but here the origin server returns entity tags for all write operations,
    and the user agent knows how to deal with them. That is, both take
    advantage of what <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a> already allows.
  
</p>
<p>
    &gt;&gt; Request (3)
  
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
PROPPATCH /test.html HTTP/1.1
Host: example.com
Content-Type: application/xml

&lt;proppatch xmlns="DAV:"&gt;
  &lt;set&gt;
    &lt;prop&gt;
      &lt;title xmlns="http://ns.example.org/"&gt;
        A sample document
      &lt;/title&gt;
    &lt;/prop&gt;
  &lt;/set&gt;
&lt;/proppatch&gt;</pre></div>
<p>
    &gt;&gt; Response (3)
  
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 207 Multi-Status
Content-Type: application/xml
ETag: "C"

&lt;multistatus xmlns="DAV:"&gt;
  &lt;response&gt;
    &lt;href&gt;/test.html&lt;/href&gt;
    &lt;propstat&gt;
      &lt;prop&gt;
        &lt;title xmlns="http://ns.example.org/"/&gt;
      &lt;/prop&gt;
      &lt;status&gt;HTTP/1.1 2OO OK&lt;/status&gt;
    &lt;/propstat&gt;
  &lt;/response&gt;
&lt;/multistatus&gt;</pre></div>
<p>
    As before, this causes the entity to change, and a new entity tag
    to be assigned. But in this case, the origin server actually
    notifies the client of the changed state by including the 
    "ETag" response header.
  
</p>
<p>
    The client now will be aware that the requested entity change, and can
    use the new entity tag in subsequent requests (potentially after
    refreshing the local copy).
  
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Change Log (to be removed by RFC Editor before publication)</h3>

<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1"></a><h3>B.1.&nbsp;
Since draft-reschke-http-etag-on-write-00</h3>

<p>
  Add and resolves issues "entity-header" and "extensibility", by removing
  the extension hooks, and by redefining the header to it can be used as an
  Entity header.

</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.2"></a><h3>B.2.&nbsp;
Since draft-reschke-http-etag-on-write-01</h3>

<p>
  Update APP and CALDAV references. Remove RFC3986 reference (not needed anymore after
  the simplication in draft 01). Fix typo in header description ("submitted entity", not
  "stored entity"). Remove comparison about how XCAP and CALDAV profile
  RFC2616: after all, both mandate a behaviour that was legal but optional before.
  Add "Updates: RFC2616".

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.3"></a><h3>B.3.&nbsp;
Since draft-reschke-http-etag-on-write-02</h3>

<p>
  In the references, note that there was no activitiy on draft-whitehead-http-etag-00
  anymore. Change intended status to "Experimental". Update APP reference.
  Update statements about current status of XCAP and CALDAV.
  Add and resolve "clarify-extension".

</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.4"></a><h3>B.4.&nbsp;
Since draft-reschke-http-etag-on-write-03</h3>

<p>
  Update XCAP reference. Update header definition to use prose rules
  rather than comments. Clarify "identity" keyword when appearing with 
  a weak entity-tag. In PROPPATCH/HTML example, fix whitespace so that
  the HTML title element has exactly the same value as the one that was
  PROPPATCHed. Mention that ETags changing due to a PROPPATCH could even
  occur in presence of a WebDAV write lock. Expand keyword substitution
  example with variant where Entity-Transform is returned.

</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.5"></a><h3>B.5.&nbsp;
Since draft-reschke-http-etag-on-write-04</h3>

<p>
  Update APP reference. Update CalDAV reference (published as RFC4791).
  Update "prior work" (RFC4791 being published, XCAP having been approved).

</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.6"></a><h3>B.6.&nbsp;
Since draft-reschke-http-etag-on-write-05</h3>

<p>
  Update XCAP reference (published as RFC4825).
  Update "prior work" (RFC4825 being published).

</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.7"></a><h3>B.7.&nbsp;
Since draft-reschke-http-etag-on-write-06</h3>

<p>
  Replace RFC2518 references with RFC4918 where appropriate.
  Update APP reference.

</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.8"></a><h3>B.8.&nbsp;
Since draft-reschke-http-etag-on-write-07</h3>

<p>
  Update APP reference.
  Reference the "requested variant" issue on the RFC2616bis issues list
  (<a href='http://www.w3.org/Protocols/HTTP/1.1/rfc2616bis/issues/#i69'>http://www.w3.org/Protocols/HTTP/1.1/rfc2616bis/issues/#i69</a>).

</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
Open issues (to be removed by RFC Editor prior to publication)</h3>

<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.1"></a><h3>C.1.&nbsp;
edit</h3>

<p>
      Type: edit
</p>
<p>julian.reschke@greenbytes.de (2006-08-10): 
    Umbrella issue for editorial fixes/enhancements.
  
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Julian F. Reschke</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">greenbytes GmbH</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hafenweg 16</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Muenster, NW  48155</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+49 251 2807760</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:julian.reschke@greenbytes.de">julian.reschke@greenbytes.de</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://greenbytes.de/tech/webdav/">http://greenbytes.de/tech/webdav/</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2007).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
