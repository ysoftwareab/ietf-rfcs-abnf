<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>The Session Initiation Protocol (SIP) P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="The Session Initiation Protocol (SIP) P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem">
<meta name="keywords" content="SIP, S-CSCF, AS, ISC">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">SIPPING Working Group</td><td class="header">J. van Elburg</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Ericsson Telecommunicatie B.V.</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">July 11, 2008</td></tr>
<tr><td class="header">Expires: January 12, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />The Session Initiation Protocol (SIP) P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem<br />draft-vanelburg-sipping-served-user-06.txt</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on January 12, 2009.</p>

<h3>Abstract</h3>

<p>
This document specifies the SIP P-Served-User P-header. This header field addresses an issue that was found in the 3rd-Generation Partnership Project (3GPP) IMS (IP Multimedia Subsystem) between an S-CSCF (Serving Call Session Control Function) and an AS (Application Server) on the ISC (IMS Subsystem Service Control) interface. This header field conveys the identity of the served user and the session case that applies to this particular communication session and application invocation.
    
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#sec-conventions">2.</a>&nbsp;
Conventions<br />
<a href="#sec-definitions">3.</a>&nbsp;
Definitions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-definitions-identity">3.1.</a>&nbsp;
Identity, Network Asserted Identity, Trust Domain and Spec(T)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-definitions-served-user">3.2.</a>&nbsp;
Served User<br />
<a href="#sec-scenarios">4.</a>&nbsp;
Scenarios<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-scenarios-general">4.1.</a>&nbsp;
General<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-scenarios-diversion-terminating">4.2.</a>&nbsp;
Diversion; continue on terminating leg, but finish subsequent terminating iFC first<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-scenarios-diversion-originating">4.3.</a>&nbsp;
Diversion; create new originating leg and provide originating iFC processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-scenarios-callblue">4.4.</a>&nbsp;
Call out of the blue; on behalf of user B, but service profile of service identity C<br />
<a href="#sec-reqs">5.</a>&nbsp;
Requirements<br />
<a href="#sec-header">6.</a>&nbsp;
P-Served-User header field Definition<br />
<a href="#proxy-behaviour">7.</a>&nbsp;
Proxy behaviour<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#proxy-behaviour-generating">7.1.</a>&nbsp;
Generating the P-Served-User header<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#proxy-behaviour-consuming">7.2.</a>&nbsp;
Consuming the P-Served-User header<br />
<a href="#sec-applicability">8.</a>&nbsp;
Applicability<br />
<a href="#sec-iana">9.</a>&nbsp;
IANA Considerations<br />
<a href="#sec-security">10.</a>&nbsp;
Security Considerations<br />
<a href="#sec-acks">11.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">12.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">12.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">12.2.</a>&nbsp;
Informative References<br />
<a href="#app-history-info">Appendix&nbsp;A.</a>&nbsp;
Why the History-Info header is not suitable to convey the served user information on the ISC interface<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#app-hi-general">A.1.</a>&nbsp;
Semantics<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#app-hi-arguments">A.2.</a>&nbsp;
Additional Observations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#app-hi-conclusion">A.3.</a>&nbsp;
Conclusion<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
The 3rd-Generation Partnership Project (3GPP) IMS (IP Multimedia
Subsystem) uses SIP (RFC 3261 <a class='info' href='#RFC3261'>[2]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>) as its main signaling
protocol. (For more information on the IMS, a detailed description can
be found in 3GPP TS 23.228 <a class='info' href='#3GPP.23.228'>[9]<span> (</span><span class='info'>3GPP, &ldquo;IP Multimedia Subsystem (IMS); Stage 2,&rdquo; .</span><span>)</span></a> and 3GPP TS
24.229 <a class='info' href='#3GPP.24.229'>[11]<span> (</span><span class='info'>3GPP, &ldquo;Internet Protocol (IP) multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3,&rdquo; .</span><span>)</span></a>.) 3GPP has identified issues with the linking in of a SIP application server that are most appropriately resolved by defining a new SIP P-header, 
according to the procedures in RFC 3427 <a class='info' href='#RFC3427'>[5]<span> (</span><span class='info'>Mankin, A., Bradner, S., Mahy, R., Willis, D., Ott, J., and B. Rosen, &ldquo;Change Process for the Session Initiation Protocol (SIP),&rdquo; December&nbsp;2002.</span><span>)</span></a>.

</p>
<p>
The remainder of this document is organized as follows. <a class='info' href='#sec-scenarios'>Section&nbsp;4<span> (</span><span class='info'>Scenarios</span><span>)</span></a> outlines the problem using particular service scenarios  
and <a class='info' href='#sec-reqs'>Section&nbsp;5<span> (</span><span class='info'>Requirements</span><span>)</span></a> discusses the requirements derived from
these scenarios. <a class='info' href='#sec-header'>Section&nbsp;6<span> (</span><span class='info'>P-Served-User header field Definition</span><span>)</span></a> defines the
P-Served-User header field, which meets those requirements, and
<a class='info' href='#sec-applicability'>Section&nbsp;8<span> (</span><span class='info'>Applicability</span><span>)</span></a> discusses the applicability and
scope of this new header field. <a class='info' href='#sec-iana'>Section&nbsp;9<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a> registers
the P-Served-User header field with the IANA and <a class='info' href='#sec-security'>Section&nbsp;10<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> discusses the security properties of the
environment where this header field is intended to be used.

</p>
<a name="sec-conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions</h3>

<p>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14, RFC 2119 <a class='info' href='#RFC2119'>[1]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.

</p>
<a name="sec-definitions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Definitions</h3>

<a name="sec-definitions-identity"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Identity, Network Asserted Identity, Trust Domain and Spec(T)</h3>

<p>
The terms Identity, Network Asserted Identity, Trust Domain and Spec(T) in this document are specified in RFC 3324 <a class='info' href='#RFC3324'>[3]<span> (</span><span class='info'>Watson, M., &ldquo;Short Term Requirements for Network Asserted Identity,&rdquo; November&nbsp;2002.</span><span>)</span></a>.

</p>
<a name="sec-definitions-served-user"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Served User</h3>

<p>
The served user to an S-CSCF (Serving Call Session Control Function)or AS (Application Server) is the user whose service profile is accessed by that S-CSCF or AS when an initial request is received originated by, originated on behalf of or terminated to that user; this profile in turn provides some useful information (preferences or permissions) for processing at an S-CSCF and potentially at an AS.

</p>
<a name="sec-scenarios"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Scenarios</h3>

<a name="sec-scenarios-general"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
General</h3>

<p>
In the 3GPP IMS (IP Multimedia Subsystem) the S-CSCF (Serving CSCF) is a SIP proxy that serves as a registrar and handles originating and terminating session states for users allocated to it. This means that any call that is originated by a specific user or any call that is terminated to that specific user will pass through the S-CSCF that is allocated to that user.

</p>
<p>
At the moment that an S-CSCF is allocated for a specific user, a user profile is downloaded to the S-CSCF from the HSS (Home Subscriber Server) over the Cx interface. This user profile tells the S-CSCF whether the user is allowed to originate or terminate calls or whether an AS needs to be linked in over the ISC interface. The user profile information that determines whether a particular initial request needs to be sent to a particular AS is called initial Filter Criteria (iFC), see for example 3GPP TS 23.218 <a class='info' href='#3GPP.23.218'>[8]<span> (</span><span class='info'>3GPP, &ldquo;IP Multimedia (IM) session handling; IM call model; Stage 2,&rdquo; .</span><span>)</span></a>.

</p>
<p>
For an S-CSCF to be able to meet its responsibilities, it needs to determine on which user's behalf it is performing its tasks and which session case is applicable for the particular request. (For a definition of session case see 3GPP TS 29.228 <a class='info' href='#3GPP.29.228'>[12]<span> (</span><span class='info'>3GPP, &ldquo;IP Multimedia (IM) Subsystem Cx and Dx interfaces; Signalling flows and message contents,&rdquo; .</span><span>)</span></a>) The session case distinguishes the originating and terminating call cases and whether the particular user is registered or not. 

</p>
<p>
When the S-CSCF determines that for an incoming initial request the originating call case applies, it determines the served user by looking at the P-Asserted-Identity header field (RFC 3325 <a class='info' href='#RFC3325'>[4]<span> (</span><span class='info'>Jennings, C., Peterson, J., and M. Watson, &ldquo;Private Extensions to the Session Initiation Protocol (SIP) for Asserted Identity within Trusted Networks,&rdquo; November&nbsp;2002.</span><span>)</span></a>) which carries the network asserted identity of the originating user. When after processing the iFC for this initial request, the S-CSCF decides to forward the request to an AS, the AS has to go through a similar process of determining the session case and the served user. Since it should come to the same conclusion that this is an originating session case, it also has to look at the P-Asserted-Identity header field to determine the served user

</p>
<p>
When the S-CSCF determines that for an incoming initial request the terminating call case applies, it determines the served user by looking at the Request-URI (RFC 3261 <a class='info' href='#RFC3261'>[2]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>) which carries the identity of the intended terminating user. When after processing the iFC for this initial request, the S-CSCF decides to forward the request to an AS, the AS has to go through a similar process of determining the session case and the served user. Since it should come to the same conclusion that this is a terminating session case, it also has to look at the Request-URI to determine the served user.

</p>
<p>
In the originating case it can be observed that while the P-Asserted-Identity header field just represents the originating user when it enters the S-CSCF, it is overloaded with another meaning when it is sent to an AS over the ISC interface. This other meaning is that it serves as a representation of the served user.

</p>
<p>
In the terminating case a similar overloading happens to the Request-URI, while it first only represented the identity of the intended terminating user, it is overloaded with another meaning when it is sent to an AS over the ISC interface. This other meaning is that it serves as a representation of the served user.

</p>
<p>
In basic call scenarios this does not show up as a problem, but once more complicated service scenarios (notably forwarding services) needs to be realized, it poses severe limitations. Such scenarios are brought forward in the following sub sections.

</p>
<a name="sec-scenarios-diversion-terminating"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Diversion; continue on terminating leg, but finish subsequent terminating iFC first</h3>

<p>
Imagine a service scenario where a user B has a terminating service that diverts the call to a different destination, but it is required that subsequent terminating services for the same user are still executed. This means that this particular user has multiple iFC configured that are applicable for an incoming initial request. When the S-CSCF receives an initial INVITE request it analyses the request and determines that the session case is for a terminating registered user, then it determines the served user to be user B by looking at the Request-URI.

</p>
<p>
Now the S-CSCF starts the iFC processing, the first iFC that matches the INVITE request causes the INVITE to be forwarded over the ISC interface to an AS that hosts user B's diversion service, by adding the AS and S-CSCF's own hostnames to the Route header. The S-CSCF adds an Original Dialog Identifier (ODI) to the S-CSCF's own hostname on the Route header. This allows the S-CSCF to correlate an INVITE coming from an AS over the ISC interface to the existing session that forwarded the INVITE to the AS in the first place. 

</p>
<p>
When the AS receives the initial INVITE request it analyses the request and determines that the session case is for a terminating registered user, then it determines the served user to be user B by looking at the Request-URI. Based on some criteria, the diversion service concludes that the request needs to be diverted to another user or application C. It does this by changing the Request-URI to C. Optionally it records the Request-URI history by using the History-Info header field (RFC 4244 <a class='info' href='#RFC4244'>[7]<span> (</span><span class='info'>Barnes, M., &ldquo;An Extension to the Session Initiation Protocol (SIP) for Request History Information,&rdquo; November&nbsp;2005.</span><span>)</span></a>). Then the AS removes itself from the Route header and routes  the INVITE request back to the S-CSCF by using the topmost Route header field.

</p>
<p>
When the S-CSCF receives the INVITE over the ISC interface it can see that the Route header contains its own hostname and an ODI that correlates to an existing terminating session for user B. This can be used by the S-CSCF to analyze whether there are still unexecuted iFC. (Note that the current behavior of the S-CSCF on receiving an INVITE with a changed Request-URI is to terminate the iFC processing and to route the request based on the new Request-URI value.)

</p>
<p>
The process repeats itself, the INVITE is forwarded to the AS that is associated with this particular iFC. When the AS receives the initial INVITE request it analyses the request and determines that the session case is for a terminating registered user, then it determines the served user to be user C by looking at the Request-URI. This is clearly wrong as the user being served is still user B. 

</p>
<p>
This scenario clearly shows the problem that occurs when the Request-URI is overloaded with the meanings "intended target identity" and "served user" with the operation as described in <a class='info' href='#sec-scenarios-general'>Section&nbsp;4.1<span> (</span><span class='info'>General</span><span>)</span></a>. And it shows that this use case can not be realized without introducing a mechanism that conveys information about the served user from the S-CSCF to the AS. Use of the History-Info element does not solve this problem as it does not tell the AS which user is being served, but just presents a history of diversions that might not be even caused by the systems serving this particular user. A more detailed analysis on why the History-Info header field can't be used is provided in <a class='info' href='#app-history-info'>Appendix&nbsp;A<span> (</span><span class='info'>Why the History-Info header is not suitable to convey the served user information on the ISC interface</span><span>)</span></a>.

</p>
<a name="sec-scenarios-diversion-originating"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Diversion; create new originating leg and provide originating iFC processing</h3>

<p>
Imagine a service scenario where a user B has a terminating service that diverts the call to a different destination. It is required that forwarded call leg is handled as an originating call leg and that originating services for user B are executed. This means that this particular user has one or more iFC configured that are applicable for an outgoing initial request.

</p>
<p>
When the S-CSCF receives an initial INVITE request, it analyses the request and determines that the session case is for a terminating registered user, then it determines the served user to be user B by looking at the Request-URI.

</p>
<p>
Now the S-CSCF starts the iFC processing, the first iFC that matches the INVITE request causes the INVITE to be forwarded over the ISC interface to an AS that hosts user B's diversion service, by adding the AS and S-CSCF's own hostnames to the Route header. The S-CSCF adds an Original Dialog Identifier (ODI) to the S-CSCF's own hostname on the Route header, this allows the S-CSCF to correlate an INVITE coming from an AS over the ISC interface to the existing session that forwarded the INVITE to the AS in the first place. 

</p>
<p>
When the AS receives the initial INVITE request, it analyses the request and determines that the session case is for a terminating registered user, then it determines the served user to be user B by looking at the Request-URI. Based on some criteria the diversion service concludes that the request needs to be diverted to another user or application C. It does this by changing the Request-URI to C. Optionally it records the Request-URI history by using the History-Info header field (RFC 4244 <a class='info' href='#RFC4244'>[7]<span> (</span><span class='info'>Barnes, M., &ldquo;An Extension to the Session Initiation Protocol (SIP) for Request History Information,&rdquo; November&nbsp;2005.</span><span>)</span></a>). Then the AS removes itself from the Route header. To make sure that the request is handled as a new originating call on behalf of user B, the AS adds the "orig" parameter to the topmost route header.  Then it routes  the INVITE request back to the S-CSCF by using this topmost Route header field.

</p>
<p>
When the S-CSCF receives the INVITE over the ISC interface, it can see that the topmost Route header contains its own hostname and an "orig" parameter. Because the topmost Route header contains the "orig" parameter, the S-CSCF concludes that the INVITE should be handled as if a call is originated by the served user. The served user is determined from the P-Asserted-Identity header to be user A. This is clearly wrong as the user being served is and should be user B.

</p>
<p>
For the sake of discussion lets assume that the S-CSCF can determine that the served user is user B. Then the procedure would continue as follows: The S-CSCF starts the originating iFC processing, the first iFC that matches the INVITE request causes the INVITE to be forwarded over the ISC interface to an AS that hosts an originating service of user B, by adding the AS and S-CSCF's own hostnames to the Route header. The S-CSCF adds an Original Dialog Identifier (ODI) to the S-CSCF's own hostname on the Route header. 

</p>
<p>
The INVITE is forwarded to the AS that is associated with this particular iFC. When the AS receives the initial INVITE request it analyses the request and determines that the session case is for an originating registered user, then it determines the served user to be user A by looking at the P-Asserted-Identity. This is clearly wrong as the user being served is and should be user B. 

</p>
<p>
This scenario clearly shows the problem that occurs when the P-Asserted-Identity is overloaded with the meanings "call originator" and "served user" with the operation as described in chapter <a class='info' href='#sec-scenarios-general'>Section&nbsp;4.1<span> (</span><span class='info'>General</span><span>)</span></a>. And it shows that this use case can not be realized without introducing a mechanism that conveys information about the served user from the S-CSCF to the AS and from the AS to the S-CSCF. Use of the History-Info element does not solve this problem as it does not tell the AS which user is being served, but just presents a history of diversions that might not be even caused by the systems serving this particular user. A more detailed analysis on why the History-Info header field can't be used is provided in <a class='info' href='#app-history-info'>Appendix&nbsp;A<span> (</span><span class='info'>Why the History-Info header is not suitable to convey the served user information on the ISC interface</span><span>)</span></a>.

</p>
<a name="sec-scenarios-callblue"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Call out of the blue; on behalf of user B, but service profile of service identity C</h3>

<p>
There are services that need to be able to initiate a call, whereby the call appears to be coming from a user B, but service profile on behalf of service identity C needs to be executed in the S-CSCF.

</p>
<p>
When a call needs to appear as coming from user B, that means that the P-Asserted-Identity needs to contain B's identity. This is because the Originating Identity Presentation (OIP) service as defined in 3GPP TS 24.173 <a class='info' href='#3GPP.24.173'>[10]<span> (</span><span class='info'>3GPP, &ldquo;IMS multimedia telephony communication service and supplementary services; Stage 3,&rdquo; .</span><span>)</span></a> uses the P-Asserted-Identity to present the call originator. Which makes sense because that is the main meaning expressed by the P-Asserted-Identity header field.

</p>
<p>
It is clear that no INVITE request can be constructed currently that would achieve both requirements expressed in the first paragraph, because the P-Asserted-Identity is overloaded with two meanings on the ISC interface. When the S-CSCF will receive this request it will determine that the served user is user B, which is not what we want to achieve.

</p>
<a name="sec-reqs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Requirements</h3>

<p>
This section lists the requirements derived from the previous scenarios:

</p>
<p>
</p>
<ol class="text">
<li>
To be able to offer real world application services it is required that the identity of the served user can be conveyed on the ISC interface (see 3GPP TS 23.218 <a class='info' href='#3GPP.23.218'>[8]<span> (</span><span class='info'>3GPP, &ldquo;IP Multimedia (IM) session handling; IM call model; Stage 2,&rdquo; .</span><span>)</span></a>).

</li>
<li>
To be able to offer appropriate services to the served user it is required that in addition to the served user identity the session case is conveyed.

</li>
</ol><p>

</p>
<a name="sec-header"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
P-Served-User header field Definition</h3>

<p>
This document defines the SIP P-Served-User P-header. This header
field can be added to initial requests for a dialog or standalone requests routed from a node in a trust domain for served user like for example between an S-CSCF and an AS. The P-Served-User P-header contains an identity of the user that is (to be) served by the S-CSCF. The sescase parameter may be used to convey whether the initial request is originated by or destined for the served user. The regstate parameter may be used by the S-CSCF towards an AS to indicate whether the initial request is for a registered or an unregistered user.

</p>
<p>
The augmented Backus-Naur Form (BNF) (RFC 5234 <a class='info' href='#RFC5234'>[6]<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>) syntax
of the P-Served-User header field is the following:

</p>
<p>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
P-Served-User            = "P-Served-User" HCOLON PServedUser-value
                                           *(SEMI served-user-param)
served-user-param        = sessioncase-param
                           / registration-state-param
                           / generic-param
PServedUser-value        = name-addr / addr-spec
sessioncase-param        = "sescase" EQUAL "orig" / "term"
registration-state-param = "regstate" EQUAL "unreg" / "reg"
</pre></div><p>


</p>
<p>
EQUAL, HCOLON, SEMI, name-addr, addr-spec and generic-param are defined in RFC 3261 <a class='info' href='#RFC3261'>[2]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>.

</p>
<p>
The following is an example of a P-Served-User header field:

</p>
<p>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
P-Served-User: &lt;sip:user@example.com&gt;; sescase=orig; regstate=reg
</pre></div><p>


</p>
<a name="proxy-behaviour"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Proxy behaviour</h3>

<a name="proxy-behaviour-generating"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Generating the P-Served-User header</h3>

<p>
      Proxies that support the header MUST only insert the header in initial requests for a dialog or standalone requests when the following conditions hold:
      </p>
<ul class="text">
<li>
	  The proxy has the capability to determine the served user for the current request.
	
</li>
<li>
	  The next hop proxy is part of the same Trust Domain for P-Served-User.
	
</li>
<li>
	  The next hop proxy supports the P-Served-User header.
	
</li>
<li>
	  The next hop proxy requires the served user information for its proper operation.
	
</li>
</ul><p>
    
</p>
<p>
      When the above conditions do not hold the proxy MUST NOT insert the header. 
    
</p>
<a name="proxy-behaviour-consuming"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Consuming the P-Served-User header</h3>

<p>
      A proxy that supports the header, MUST upon receiving the P-Served-User header in initial requests for a dialog or standalone requests take the value of the P-Served-User header to represent the served user in operations that require such information.
    
</p>
<p>
      A proxy that supports the header, MUST remove the header from requests or responses before further forwarding the message. 
    
</p>
<p>
      When the next hop might requires served user information, then the procedure as in <a class='info' href='#proxy-behaviour-generating'>Section&nbsp;7.1<span> (</span><span class='info'>Generating the P-Served-User header</span><span>)</span></a> MUST apply before forwarding the message.
    
</p>
<a name="sec-applicability"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Applicability</h3>

<p>
    According to RFC 3427 <a class='info' href='#RFC3427'>[5]<span> (</span><span class='info'>Mankin, A., Bradner, S., Mahy, R., Willis, D., Ott, J., and B. Rosen, &ldquo;Change Process for the Session Initiation Protocol (SIP),&rdquo; December&nbsp;2002.</span><span>)</span></a>, P-headers have a
    limited applicability. Specifications of P-headers such as this RFC
    need to clearly document the useful scope of the proposal, and explain
    its limitations and why it is not suitable for the general use of SIP
    on the Internet.
  
</p>
<p>
    The use of the P-Served-User header field extensions is only applicable inside a Trust
    Domain for served user.  Nodes in such a Trust Domain explicitly trust each other
    to convey the served user, and to be responsible for withholding that information outside of the Trust Domain.  The means by which the network determines the served user and the policies that are executed for a specific served user is outside the scope of this document.
  
</p>
<p>
    The served user information lacks an indication of who or what specifically
    determined the served user, and so it must be assumed that the Trust
    Domain determined the served user.  Therefore, the information is only
    meaningful when securely received from a node known to be a member of
    the Trust Domain.
  
</p>
<p>
    Because the served user typically only has validity in one administrative domain it is in general not suitable for inter-domain use or use in the Internet at large.  
  
</p>
<p>
    Despite these limitations, there are sufficiently useful specialized
    deployments that meet the assumptions described above, and can accept
    the limitations that result, to warrant informational publication of
    this mechanism.  An example deployment would be a closed network
    like 3GPP IMS.
  
</p>
<a name="sec-iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>
This document defines a new SIP header field: P-Served-User. This
header field needs to be registered by the IANA in the SIP Parameters
registry under the Header Fields subregistry.

</p>
<a name="sec-security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security Considerations</h3>

<p>
The P-Served-User header field defined in this document is to be used in an
environment where elements are trusted and where attackers are not
supposed to have access to the protocol messages between those
elements. Traffic protection between network elements is sometimes
achieved by using IPsec and sometimes by physically protecting the
network. In any case, the environment where the P-Served-User header
field will be used ensures the integrity and the confidentiality of
the contents of this header field.

</p>
<p>
The Spec(T) that defines the Trust Domain for P-Served-User MUST require
that member nodes understand the P-Served-User header extension.

</p>
<p>
There is a security risk if a P-Served-User header field is
allowed to propagate out of the trust domain where it was
generated. In that case user-sensitive information would be 
revealed by such a breach. To prevent such a breach from happening:
Proxies MUST NOT insert the header when forwarding requests to a next hop 
located outside the trust domain. When forwarding the request to a trusted node, 
proxies MUST NOT insert the header unless they have sufficient knowledge that 
the route set includes another proxy in the trust domain that understands the 
header, such as the home proxy. There is no automatic mechanism to learn the 
support for this specification. Proxies MUST remove the header when forwarding 
requests to untrusted nodes or when the proxy does not have knowledge of any 
other proxy in the route set that is able to understand the header.

</p>
<a name="sec-acks"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Acknowledgments</h3>

<p>
Alf Heidermark, Hubert Przybysz and Erik Rolin for the discussion that led to the solution written down in this document. Spencer Dawkins for performing the expert review. Jon Peterson for performing the AD review. Gonzalo Camarillo, Paul Kyzivat, Nils Hänström, Arunachalam Venkatraman, Mikael Forsberg, Miguel Garcia, Jozsef Varga, Keith Drage and Tim Polk for providing improvements. Francis Dupont for performing the general area review. Sandy Murphy for performing the security area review.

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[1]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3261">[2]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3324">[3]</a></td>
<td class="author-text">Watson, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3324">Short Term Requirements for Network Asserted Identity</a>,&rdquo; RFC&nbsp;3324, November&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3324.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3325">[4]</a></td>
<td class="author-text">Jennings, C., Peterson, J., and M. Watson, &ldquo;<a href="http://tools.ietf.org/html/rfc3325">Private Extensions to the Session Initiation Protocol (SIP) for Asserted Identity within Trusted Networks</a>,&rdquo; RFC&nbsp;3325, November&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3325.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3427">[5]</a></td>
<td class="author-text">Mankin, A., Bradner, S., Mahy, R., Willis, D., Ott, J., and B. Rosen, &ldquo;<a href="http://tools.ietf.org/html/rfc3427">Change Process for the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;3427, December&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3427.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5234">[6]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5234.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC4244">[7]</a></td>
<td class="author-text">Barnes, M., &ldquo;<a href="http://tools.ietf.org/html/rfc4244">An Extension to the Session Initiation Protocol (SIP) for Request History Information</a>,&rdquo; RFC&nbsp;4244, November&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4244.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="3GPP.23.218">[8]</a></td>
<td class="author-text">3GPP, &ldquo;<a href="http://www.3gpp.org/ftp/Specs/html-info/23218.htm">IP Multimedia (IM) session handling; IM call model; Stage 2</a>,&rdquo; 3GPP TS&nbsp;23.218 V7.</td></tr>
<tr><td class="author-text" valign="top"><a name="3GPP.23.228">[9]</a></td>
<td class="author-text">3GPP, &ldquo;<a href="http://www.3gpp.org/ftp/Specs/html-info/23228.htm">IP Multimedia Subsystem (IMS); Stage 2</a>,&rdquo; 3GPP TS&nbsp;23.228 V7.</td></tr>
<tr><td class="author-text" valign="top"><a name="3GPP.24.173">[10]</a></td>
<td class="author-text">3GPP, &ldquo;<a href="http://www.3gpp.org/ftp/Specs/html-info/24173.htm">IMS multimedia telephony communication service and supplementary services; Stage 3</a>,&rdquo; 3GPP TS&nbsp;24.173 V7.</td></tr>
<tr><td class="author-text" valign="top"><a name="3GPP.24.229">[11]</a></td>
<td class="author-text">3GPP, &ldquo;<a href="http://www.3gpp.org/ftp/Specs/html-info/24229.htm">Internet Protocol (IP) multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3</a>,&rdquo; 3GPP TS&nbsp;24.229 V7.</td></tr>
<tr><td class="author-text" valign="top"><a name="3GPP.29.228">[12]</a></td>
<td class="author-text">3GPP, &ldquo;<a href="http://www.3gpp.org/ftp/Specs/html-info/29228.htm">IP Multimedia (IM) Subsystem Cx and Dx interfaces; Signalling flows and message contents</a>,&rdquo; 3GPP TS&nbsp;29.228 V7.</td></tr>
</table>

<a name="app-history-info"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Why the History-Info header is not suitable to convey the served user information on the ISC interface</h3>

<a name="app-hi-general"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Semantics</h3>

<p>
    The History-Info as specified in (RFC 4244 <a class='info' href='#RFC4244'>[7]<span> (</span><span class='info'>Barnes, M., &ldquo;An Extension to the Session Initiation Protocol (SIP) for Request History Information,&rdquo; November&nbsp;2005.</span><span>)</span></a>) holds a record of Request-URI's that are put on an initial request during its processing in the network and then particularly when the request is retargeted or forwarded.   
    
</p>
<p>
    If it would be possible at all to use the History-Info header for the purpose of communicating the served user, then again the same overloading would occur as the one that we are trying to get rid of (<a class='info' href='#sec-scenarios-diversion-terminating'>Section&nbsp;4.2<span> (</span><span class='info'>Diversion; continue on terminating leg, but finish subsequent terminating iFC first</span><span>)</span></a>). Because in that case we overload the particular History-Info header field's hi-entry with the meaning "historic target identity" and "served user". 
    
</p>
<p>
    Another reason that the History-Info header can not solve the requirements as expressed in this draft is that in originating session case scenarios the served user is currently determined from the P-Asserted-Identity as that header field contains the asserted originating user's identity. The History-Info header being a record of Request-URI's can never be a solution for this case. 
    
</p>
<p>
    Looking at the call out of the blue scenario (<a class='info' href='#sec-scenarios-callblue'>Section&nbsp;4.4<span> (</span><span class='info'>Call out of the blue; on behalf of user B, but service profile of service identity C</span><span>)</span></a>) it is impossible to construct a History-Info header for an INVITE request on behalf of user C appearing to come from user B and targeting user D that would express the served user C without violating the original semantics of the History-Info header according to (RFC 4244 <a class='info' href='#RFC4244'>[7]<span> (</span><span class='info'>Barnes, M., &ldquo;An Extension to the Session Initiation Protocol (SIP) for Request History Information,&rdquo; November&nbsp;2005.</span><span>)</span></a>).
    
</p>
<a name="app-hi-arguments"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Additional Observations</h3>

<p>
    The purpose of the History-Info header is a header that has an end to end application. For the purpose of informing an AS on the ISC interface this is overkill.
    
</p>
<p>
    At the moment that the AS receives an initial INVITE over the ISC interface, this INVITE may have passed a vast number of proxies that may either have added history information or not. On top of that, the request may have traversed several AS instances for the same served user. In case several subsequent iFC are active all these AS instances may perform a forwarding. This means  that it is not possible to define an algorithm that points out which hi-entry of a History-Info header should represent the served user. In other words a History-Info header field with n entries expresses a branch of depth n. Any or none of these elements could be the served user identity.
    
</p>
<p>
    The History-Info header does not comply with the second requirement as expressed in <a class='info' href='#sec-reqs'>Section&nbsp;5<span> (</span><span class='info'>Requirements</span><span>)</span></a>, as it does not have a means to express the session case in a natural way.
    
</p>
<a name="app-hi-conclusion"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Conclusion</h3>

<p>
    Each of the observations in the previous subsections in isolation is enough to disregard the History-Info header as an information element that is suitable for transporting the served user information over the ISC interface. 
    
</p>
<p>
    Note that this does not prohibit the use of the P-Served-User header and the History-Info header in the same request. In fact that will be a quite likely scenario for network based diversion services like for example the Communication Diversion service as specified in (3GPP TS 24.173 <a class='info' href='#3GPP.24.173'>[10]<span> (</span><span class='info'>3GPP, &ldquo;IMS multimedia telephony communication service and supplementary services; Stage 3,&rdquo; .</span><span>)</span></a>).  
    
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hans Erik van Elburg</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ericsson Telecommunicatie B.V.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ericssonstraat 2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rijen  5121 ML</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">The Netherlands</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:HansErik.van.Elburg@ericsson.com">HansErik.van.Elburg@ericsson.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
