<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Transmission of Syslog Messages over TCP</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Transmission of Syslog Messages over TCP">
<meta name="keywords" content="SYSLOG, SYSLOG transport TCP">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">R. Gerhards</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Adiscon GmbH</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">C. Lonvick</td></tr>
<tr><td class="header">Expires: September 9, 2010</td><td class="header">Cisco Systems, Inc</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 08, 2010</td></tr>
</table></td></tr></table>
<h1><br />Transmission of Syslog Messages over TCP<br />draft-gerhards-syslog-plain-tcp-02.txt</h1>

<h3>Abstract</h3>

<p>
		There have been many implementations and deployments of legacy
		syslog over TCP for many years.  That protocol has evolved without
		being standardized and has proven to be quite interoperable in 
		practice.
		
</p>
<p>
		The aim of this specification is to document three things: how 
		to transmit standardized syslog over TCP, how this has been done
		for legacy syslog, and how the new syslog architecture can
		interoperate with the legacy deployments.
		
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 9, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#conventions">2.</a>&nbsp;
Conventions Used in This Document<br />
<a href="#using">3.</a>&nbsp;
Message Transmission<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#session">3.1.</a>&nbsp;
Session<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sessionInit">3.2.</a>&nbsp;
Session Initiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msgxfer">3.3.</a>&nbsp;
Message Transfer<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#octet-counting">3.3.1.</a>&nbsp;
Octet-Counting<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#octet-stuffing">3.3.2.</a>&nbsp;
Octet-Stuffing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msg">3.4.</a>&nbsp;
Retaining the Original Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sessionClose">3.5.</a>&nbsp;
Session Closure<br />
<a href="#security">4.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#authentication">4.1.</a>&nbsp;
Sender Authentication and Message Forgery<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#observation">4.2.</a>&nbsp;
Message Observation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#replaying">4.3.</a>&nbsp;
Replaying<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#prioritization">4.4.</a>&nbsp;
Message Prioritization and Differentiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dos">4.5.</a>&nbsp;
Denial of Service<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#reliability">4.6.</a>&nbsp;
Reliability<br />
<a href="#iana">5.</a>&nbsp;
IANA Considerations<br />
<a href="#acks">6.</a>&nbsp;
Acknowledgments<br />
<a href="#NoteToEditor">7.</a>&nbsp;
Notes to the RFC Editor and Change Log<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative<br />
<a href="#legacy">Appendix&nbsp;A.</a>&nbsp;
Applicability to Legacy syslog<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#change">A.1.</a>&nbsp;
Method Change<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#octet-counting-legacy">A.2.</a>&nbsp;
Octet-Counting<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#octet-stuffing-legacy">A.3.</a>&nbsp;
Octet Stuffing<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
			The <a class='info' href='#RFC5424'>syslog protocol<span> (</span><span class='info'>Gerhards, R., &ldquo;The Syslog Protocol,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5424] is a text-based protocol
			used to convey event information.  Before that standard was produced, syslog messages were being transmitted
			over UDP.  This was described in the INFORMATIONAL document <a class='info' href='#RFC3164'>[RFC3164]<span> (</span><span class='info'>Lonvick, C., &ldquo;The BSD Syslog Protocol,&rdquo; August&nbsp;2001.</span><span>)</span></a>.
			While there has been no documented standard for transporting syslog messages over TCP, it is widely
			used in practice and has proven to be quite interoperable among the 
			implementations, with some minor issues in some configurations.
                        While existing implementations interoperate quite well with each other,
                        there are some differences in protocol handling. This document will describe
                        the most commonly used approach and explain how to interoperate with them
                        in a consistent way.
		
</p>
<p>
			This specification applies to messages transmitted using the <a class='info' href='#RFC5424'>[RFC5424]<span> (</span><span class='info'>Gerhards, R., &ldquo;The Syslog Protocol,&rdquo; March&nbsp;2009.</span><span>)</span></a>
			format.  Diagram 1 shows how this relates to the other syslog message transport protocols.
			In this diagram three originators are seen, labeled A, B, and C, along with one collector.
			Originator A is using the TCP transport which is described in this document.  Originator
			B is using the UDP transport which is described in <a class='info' href='#RFC5426'>[RFC5426]<span> (</span><span class='info'>Okmianski, A., &ldquo;Transmission of Syslog Messages over UDP,&rdquo; March&nbsp;2009.</span><span>)</span></a>.  Originator
			C is using the TLC transport which is described in <a class='info' href='#RFC5425'>[RFC5425]<span> (</span><span class='info'>Miao, F., Ma, Y., and J. Salowey, &ldquo;Transport Layer Security (TLS) Transport Mapping for Syslog,&rdquo; March&nbsp;2009.</span><span>)</span></a>.  The collector
			is shown with the capability to accept all three transports.
		
</p>
<p>
			A discussion of how this may be applied to legacy syslog as described in <a class='info' href='#RFC3164'>[RFC3164]<span> (</span><span class='info'>Lonvick, C., &ldquo;The BSD Syslog Protocol,&rdquo; August&nbsp;2001.</span><span>)</span></a> 
			is contained below.  Two format options have been observed with legacy syslog being transported
			over TCP.  These are called octet-stuffing and octet-counting and are described in Section 3.3.
			This specification is written this way, with two format options, 
			in an attempt to ensure that syslog transport receivers can receive and properly
			interpret messages sent from legacy syslog senders. 
		
</p>
<p>
			To ensure interoperability between syslog senders and receivers, the octet-counting method is REQUIRED
			and the octet-stuffing method is NOT RECOMMENDED.
		
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 +---------------------+
 | Originator A        |
 |---------------------|
 |  syslog application |
 |                     |
 |---------------------|
 |  syslog transport   |
 |        TCP          |
 +---------------------+
           v
           |
          /                            +---------------------+
         /                             | Originator B        |
        /                              |---------------------|
       /   +----------------------+    |  syslog application |
      /    | Collector            |    |                     |
     |     |----------------------|    |---------------------|
     |     |  syslog application  |    |  syslog transport   |
     |     |                      |    |        UDP          |
     |     |----------------------|    |---------------------|
     |     |  syslog transport    |              v
     |     |  TCP |  TLS  |  UDP  |              |
     |     +----------------------+              |
     |         ^      ^       ^                  |
     |         |      |       |                  |
     \         /      |       \                  /
      ---------       |        ------------------
                      |
                      |
                      |     +---------------------+
                      |     | Originator C        |
                      |     |---------------------|
                      |     |  syslog application |
                      |     |                     |
                      |     |---------------------|
                      |     |  syslog transport   |
                      |     |        TLS          |
                      |     +---------------------+
                      |               v
                      \               /
                       ---------------

             Diagram 1.  Syslog Layers
</pre></div>
<p>
			There are several advantages to using TCP: flow control, error recovery, reliability, to name a few.
			One potential disadvantage is the buffering mechanism used by TCP.  Ordinarily, TCP decides when 
			enough data has been received from the application to form a segment for transmission.  This may
			be adjusted through timers but still, some application data may wait in a buffer for a relatively 
			long time.  Syslog data is not normally time-sensitive but if this delay is a concern, the 
			syslog transport sender may utilize the PUSH Flag to have the sending TCP immediately send all
			buffered data.  <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>
		
</p>
<p>
			It is still RECOMMENDED to use the <a class='info' href='#RFC5424'>TLS transport<span> (</span><span class='info'>Gerhards, R., &ldquo;The Syslog Protocol,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5424] to 
			convey syslog messages.  This specification is provided to ensure interoperability 
			for transporting syslog over TCP.
		
</p>
<a name="conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions Used in This Document</h3>

<p>
			The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
			"SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this
			document are to be interpreted as described in
			<a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
		
</p>
<p>
			The terminology defined in Section 3 of <a class='info' href='#RFC5424'>[RFC5424]<span> (</span><span class='info'>Gerhards, R., &ldquo;The Syslog Protocol,&rdquo; March&nbsp;2009.</span><span>)</span></a> is
			used throughout this specification.  The reader should be familiar with
			that to follow this discussion.
		
</p>
<p>
			This document also references devices that use syslog transported over UDP as described in
			<a class='info' href='#RFC3164'>[RFC3164]<span> (</span><span class='info'>Lonvick, C., &ldquo;The BSD Syslog Protocol,&rdquo; August&nbsp;2001.</span><span>)</span></a>.  Devices that continue to use that will be described as legacy
			syslog senders and receivers in this document.
		
</p>
<a name="using"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Message Transmission</h3>

<p>
				As described in <a class='info' href='#RFC5424'>[RFC5424]<span> (</span><span class='info'>Gerhards, R., &ldquo;The Syslog Protocol,&rdquo; March&nbsp;2009.</span><span>)</span></a>, syslog is simplex
				in nature.  Traditional implementations of syslog over TCP do not use any backchannel
				mechanism to convey information to the transport sender, and consequently do not
				use any application-level acknowledgement for syslog receiver to sender
				signaling.  Reliability and flow control are provided by the capabilities of TCP.
			
</p>
<a name="session"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Session</h3>

<p>
				A syslog over TCP session is a TCP connection between a client
				and a server.  The syslog transport sender is the host that sends the original
				SYN.  The syslog transport receiver is the device that receives the original
				SYN and responds with a SYN+ACK.  After initiation, messages are sent from the transport
				sender to the transport receiver.  No application-level data is transmitted
				from the transport receiver to the transport sender.  The roles of transport
				sender and receiver are fixed once the session is established, and they can
				not be reversed during the session.  However, there can be multiple sessions between
				two TCP hosts, and for each session the role of transport sender and
				transport receiver can be different based upon which device initiates the session.
			
</p>
<p>
				It is valid (but rare) for no messages to be exchanged during a TCP session.
			
</p>
<p>
				If an error occurs, the peer detecting the error will gracefully close the TCP session, but
				has no means to notify its remote peer about the state of the peer syslog application.
			
</p>
<a name="sessionInit"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Session Initiation</h3>

<p>
				The peer that intends to act as a syslog transport receiver listens to TCP port &lt;TBD&gt;.  
				The peer that intends to act as the transport sender initiates a 
				TCP session to the syslog transport receiver as specified in <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>.  
			
</p>
<a name="msgxfer"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Message Transfer</h3>

<p>
				During the message transfer phase, the syslog transport sender sends a 
				stream of messages to the transport receiver.  Either of the peers may initiate 
				session closure at any time as specified in Section 3.5 
				of <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>.  In practice, this is often seen
				after a prolonged time of inactivity.
			
</p>
<p>
				Syslog messages are sent in sequence within a TCP transport
				stream.  One message is encapsulated inside a frame.
				Syslog transport senders MUST support the octet-counting method and they 
				MAY support the octet-stuffing method.  Syslog transport receivers are 
				REQUIRED to support the octet-counting method and are
				RECOMMENDED to support the octet-stuffing method to promote interoperability
				with legacy devices that may only use that framing method.
				Transport senders do not send any notice about the format they
				use to the transport receiver.  However, the format itself enables
				the transport receiver to detect which framing is used.  The syslog transport sender
				MUST NOT change the format after it has sent the first message.  If the format needs 
				to be changed, the TCP session must be concluded and a new session established.
			
</p>
<p>
				All syslog messages MUST be sent as TCP "data" as per 
				<a class='info' href='#RFC0793'>Transmission Control Protocol<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> [RFC0793].
				The syslog message stream has the following <a class='info' href='#RFC5234'>ABNF<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a> [RFC5234]
				definition:
				</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    TCP-DATA = *SYSLOG-FRAME

    SYSLOG-FRAME = MSG-LEN SP SYSLOG-MSG   ; Octet-counting method
    SYSLOG-FRAME =/ SYSLOG-MSG TRAILER     ; Octet-stuffing method

    MSG-LEN = NONZERO-DIGIT *DIGIT

    SP = %d32

    NONZERO-DIGIT = %d49-57

    DIGIT = %d48 / NONZERO-DIGIT

    TRAILER = LF | APP-DEFINED

    LF = %d10

    APP-DEFINED = 1*2OCTET

    SYSLOG-MSG is defined in the syslog protocol [RFC5424]

</pre></div><p>

			
</p>
<a name="octet-counting"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1"></a><h3>3.3.1.&nbsp;
Octet-Counting</h3>

<p>
				This mode is somewhat similar to the framing used in 
				<a class='info' href='#RFC5425'>[RFC5425]<span> (</span><span class='info'>Miao, F., Ma, Y., and J. Salowey, &ldquo;Transport Layer Security (TLS) Transport Mapping for Syslog,&rdquo; March&nbsp;2009.</span><span>)</span></a>. Here the message length, in octets,
				is specified as HEADER, followed by SYSLOG-MSG and no trailer.
				
</p>
<p>
				MSG-LEN is the octet count of the SYSLOG-MSG in the
				SYSLOG-FRAME.  A transport receiver MUST use the message length to
				delimit a syslog message.  There is no upper limit for a message
				length per se.  However, in order to establish a baseline for
				interoperability, this specification requires that a transport
				receiver MUST be able to process messages with a length up to and
				including 2048 octets.  Transport receivers SHOULD be able to process
				messages with lengths up to and including 8192 octets.
				
</p>
<p>
				A transport receiver MUST
				assume that octet-counting framing is used if a syslog frame
				starts with a digit.
				
</p>
<a name="octet-stuffing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.2"></a><h3>3.3.2.&nbsp;
Octet-Stuffing</h3>

<p>
				In octet-stuffing mode, there is no header, but a trailer
				is appended after SYSLOG-MSG.  For this specification, this character
				MUST be the USASCII LF (%d10) character.  
				
</p>
<p>
				A transport receiver MUST accept the USASCII LF character as a TRAILER.
				It MAY be configurable to accept other characters.  A discussion of this is below.
				
</p>
<p>
				A transport receiver MUST 
				assume that octet-stuffing framing is used if a syslog frame
				starts with the USASCII character "&lt;" (%d60).
				
</p>
<p>
				The octet-stuffing method is NOT RECOMMENDED.
				
</p>
<a name="msg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Retaining the Original Message</h3>

<p>
				In both of these methods, a modification is made to the original message.  This
				is a temporary transformation performed by the transport sender.  According to
				Section 5 of <a class='info' href='#RFC5425'>[RFC5425]<span> (</span><span class='info'>Miao, F., Ma, Y., and J. Salowey, &ldquo;Transport Layer Security (TLS) Transport Mapping for Syslog,&rdquo; March&nbsp;2009.</span><span>)</span></a>, this temporary transformation MUST be
				reversed by the transport protocol at the transport receiver so 
				that the relay or collector will see an exact copy of the message
				generated by the originator or relay.
				
</p>
<p>
				In the octet-counting method, a count and a space character are prepended to
				the messages.  This is very much like the method described in <a class='info' href='#RFC5426'>[RFC5426]<span> (</span><span class='info'>Okmianski, A., &ldquo;Transmission of Syslog Messages over UDP,&rdquo; March&nbsp;2009.</span><span>)</span></a>.
				The count and space character MUST be removed by the transport receiver after it 
				has validated that the count is correct.
				
</p>
<p>
				Similarly, the syslog transport receiver MUST discard the TRAILER as it accepts the packet
				in the octet-stuffing method.
				
</p>
<a name="sessionClose"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Session Closure</h3>

<p>
				The SYSLOG session is closed when one of the peers decides to do
				so. It then initiates a local TCP session closure.  It does not notify
				its remote peer of its intension to close the session, nor does
				it accept any messages that are still in transit.
			
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security Considerations</h3>

<p>
		Using this specification on an unsecured network is NOT RECOMMENDED.
		Several syslog security considerations are discussed in <a class='info' href='#RFC5424'>[RFC5424]<span> (</span><span class='info'>Gerhards, R., &ldquo;The Syslog Protocol,&rdquo; March&nbsp;2009.</span><span>)</span></a>
		This section focuses on security considerations specific to the
		syslog transport over TCP.  Some of the security issues raised in
		this section can be mitigated through the use of TLS as defined in
		<a class='info' href='#RFC5425'>[RFC5425]<span> (</span><span class='info'>Miao, F., Ma, Y., and J. Salowey, &ldquo;Transport Layer Security (TLS) Transport Mapping for Syslog,&rdquo; March&nbsp;2009.</span><span>)</span></a>
		
</p>
<a name="authentication"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Sender Authentication and Message Forgery</h3>

<p>
		This transport mapping does not provide for strong transport sender
		authentication.  The receiver of the syslog message will not be able
		to ascertain that the message was indeed sent from the reported
		sender, or whether the packet was sent from another device.  This can
		also lead to a case of mistaken identity if an inappropriately
		configured machine sends syslog messages representing
		itself as another machine.
		
</p>
<p>
		This transport mapping does not provide protection against syslog
		message forgery.  An attacker can transmit syslog messages (either
		from the machine from which the messages are purportedly sent or from
		any other machine) to a receiver.
		
</p>
<p>
		In one case, an attacker can hide the true nature of an attack amidst
		many other messages.  As an example, an attacker can start generating
		forged messages indicating a problem on some machine.  This can get
		the attention of the system administrators, who will spend their time
		investigating the alleged problem.  During this time, the attacker
		could be able to compromise a different machine or a different
		process on the same machine.
		
</p>
<p>
		Additionally, an attacker can generate false syslog messages to give
		untrue indications of the status of systems.  As an example, an
		attacker can stop a critical process on a machine, which could
		generate a notification of exit.  The attacker can subsequently
		generate a forged notification that the process had been restarted.
		The system administrators could accept that misinformation and not
		verify that the process had indeed not been restarted.
		
</p>
<a name="observation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Message Observation</h3>

<p>
		This transport mapping does not provide confidentiality of the
		messages in transit.  If syslog messages are in clear text, this is
		how they will be transferred.  In most cases, passing clear-text,
		human-readable messages is a benefit to the administrators.
		Unfortunately, an attacker could also be able to observe the human-
		readable contents of syslog messages.  The attacker could then use
		the knowledge gained from these messages to compromise a machine.  It
		is RECOMMENDED that no sensitive information be transmitted via this
		transport mapping or that transmission of such information be
		restricted to properly secured networks.
		
</p>
<a name="replaying"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Replaying</h3>

<p>
		Message forgery and observation can be combined into a replay attack.
		An attacker could record a set of messages that indicate normal
		activity of a machine.  At a later time, an attacker could remove
		that machine from the network and replay the syslog messages with new
		time stamps.  The administrators could find nothing unusual in the
		received messages, and their receipt would falsely indicate normal
		activity of the machine.
		
</p>
<a name="prioritization"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Message Prioritization and Differentiation</h3>

<p>
		This transport mapping does not mandate prioritization of syslog
		messages either on the wire or when processed on the receiving host
		based on their severity.  Unless some prioritization is implemented
		by sender, receiver, and/or network, the security implication of such
		behavior is that the syslog receiver or network devices could get
		overwhelmed with low-severity messages and be forced to discard
		potentially high-severity messages.
		
</p>
<a name="dos"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Denial of Service</h3>

<p>
		An attacker could overwhelm a receiver by sending more messages to it
		than could be handled by the infrastructure or the device itself.
		Implementers SHOULD attempt to provide features that minimize this
		threat, such as optionally restricting reception of messages to a set
		of known source IP addresses.
		
</p>
<a name="reliability"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
Reliability</h3>

<p>
		It should be noted that the syslog transport specified in this
		document does not use application-layer acknowledgments.  TCP uses
		retransmissions to provide protection against some forms of data
		loss.  However, if the TCP connection is broken for
		some reason (or closed by the transport receiver), the syslog
		transport sender cannot always know what messages were successfully
		delivered to the syslog application at the other end.
		
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>
	IANA is requested to provide a TCP port for this protocol.
	
</p>
<p>
	After that port has been assigned, this section will be revised to 
	list that port.
	
</p>
<a name="acks"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Acknowledgments</h3>

<p>
			The authors wish to thank David Harrington
			and all other people who commented on various versions of this proposal.
			
</p>
<a name="NoteToEditor"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Notes to the RFC Editor and Change Log</h3>

<p>
				These are notes to the RFC editor. Please delete this section
				after the notes have been followed.
			
</p>
<p>
			   Please replace the instances of &lt;TBD> the port number assigned by IANA.
			   
</p>
<p>
			This is version -01 based upon review comments from David Harrington.
			
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC0793">[RFC0793]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc793">Transmission Control Protocol</a>,&rdquo; STD&nbsp;7, RFC&nbsp;793, September&nbsp;1981 (<a href="http://www.rfc-editor.org/rfc/rfc793.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5234">[RFC5234]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5234.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5424">[RFC5424]</a></td>
<td class="author-text">Gerhards, R., &ldquo;<a href="http://tools.ietf.org/html/rfc5424">The Syslog Protocol</a>,&rdquo; RFC&nbsp;5424, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5424.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5425">[RFC5425]</a></td>
<td class="author-text">Miao, F., Ma, Y., and J. Salowey, &ldquo;<a href="http://tools.ietf.org/html/rfc5425">Transport Layer Security (TLS) Transport Mapping for Syslog</a>,&rdquo; RFC&nbsp;5425, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5425.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5426">[RFC5426]</a></td>
<td class="author-text">Okmianski, A., &ldquo;<a href="http://tools.ietf.org/html/rfc5426">Transmission of Syslog Messages over UDP</a>,&rdquo; RFC&nbsp;5426, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5426.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3164">[RFC3164]</a></td>
<td class="author-text">Lonvick, C., &ldquo;<a href="http://tools.ietf.org/html/rfc3164">The BSD Syslog Protocol</a>,&rdquo; RFC&nbsp;3164, August&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3164.txt">TXT</a>).</td></tr>
</table>

<a name="legacy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Applicability to Legacy syslog</h3>

<p>
			This is an informative appendix provided to promote interoperability within the various observed
			implementations.  Even though this specification does not cover legacy syslog messages, the 
			language used here will be consistent with <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> to be clear in this and
			to show how the new syslog architecture will interoperate with the legacy implementations.
			
</p>
<p>
			Syslog over TCP has been around for a number of years.  Just like legacy syslog over UDP,
			several different implementations exist.  The older method of octet-stuffing
			has problems so is NOT RECOMMENDED, but SHOULD be implemented to ensure interoperability with older
			clients or servers that may only use this method.  The newer
			method of octet-counting is reliable and, as is consistent with this specification, SHOULD be implemented.
			When implementers do implement both methods, it is RECOMMENDED that the default method be octet-counting.
			
</p>
<a name="change"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Method Change</h3>

<p>
			It has been observed in legacy implementations that the framing may change on a frame-by-frame
			basis.  This behavior is NOT RECOMMENDED.  However, for interoperability, a transport receiver 
			wishing to interoperate with these legacy systems SHOULD be prepared to accept different framing for each frame received. 
			
</p>
<a name="octet-counting-legacy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Octet-Counting</h3>

<p>
                        This framing allows for the transmission of all characters inside SYSLOG-MSG.  
			Along these lines, some transport senders have been seen to use this
                        framing to stack multiple messages within a single TCP frame by using a USASCII NL (%d10) character to
			separate them.  As an example, two messages
			may be placed within a single frame with a NL character between them.
			This behavior is NOT RECOMMENDED although it has been observed.  Since it cannot be known in advance if the
			legacy transport sender is going to send multiple messages within single frames, it MUST
			be assumed that they WILL NOT, and that each frame using this method contains only one syslog message.
			Implementers MAY attempt to address this by looking for TRAILER characters within each frame
			to try to separate multiple messages.  However, this may lead to more problems than it resolves.
                        
</p>
<p>
			A transport receiver MUST assume that octet-counting framing is used
			if a syslog frame starts with a digit.
			
</p>
<a name="octet-stuffing-legacy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Octet Stuffing</h3>

<p>
			The problem with octet-stuffing framing comes from the use of 
			<a class='info' href='#RFC3164'>[RFC3164]<span> (</span><span class='info'>Lonvick, C., &ldquo;The BSD Syslog Protocol,&rdquo; August&nbsp;2001.</span><span>)</span></a> messages.  In that, the traditional trailer character
			is not escaped within SYSLOG-MSG which causes problems for the receiver.  
			For example, a message in the style of <a class='info' href='#RFC3164'>[RFC3164]<span> (</span><span class='info'>Lonvick, C., &ldquo;The BSD Syslog Protocol,&rdquo; August&nbsp;2001.</span><span>)</span></a>
			containing one or more LF characters may
			be misinterpreted as multiple messages by the transport
			receiver.  There is no method to avoid this problem with the
			octet-stuffing framing.
			
</p>
<p>
			In this legacy implementation, the TRAILER consists of a single
			character and most often is the USASCII LF (%d10) character.
			However, other characters have also been seen occasionally, with
			USACII NUL (%d00) being a prominent example.  Some devices also
			emit a two-character TRAILER, which is usually CR and LF.  
			
</p>
<p>
			Transport senders MUST support the option to use the USASCII LF character.  Transport
			receivers MUST also support this.  Transport senders and receivers MAY
			also support other characters.
			
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rainer Gerhards</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Adiscon GmbH</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mozartstrasse 21</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Grossrinderfeld, BW  97950</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:rgerhards@adiscon.com">rgerhards@adiscon.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chris Lonvick</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems, Inc</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">12515 Research Blvd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Austin, TX  78759</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:clonvick@cisco.com">clonvick@cisco.com</a></td></tr>
</table>
</body></html>
