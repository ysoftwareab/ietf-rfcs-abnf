<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>TWAMP Reflect Octets
    and Symmetrical Size Features</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="TWAMP Reflect Octets
    and Symmetrical Size Features">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">A. Morton</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">L. Ciavattone</td></tr>
<tr><td class="header">Updates: <a href='http://tools.ietf.org/html/rfc5357'>5357</a> (if&nbsp;approved)</td><td class="header">AT&amp;T Labs</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">August 17, 2010</td></tr>
<tr><td class="header">Expires: February 18, 2011</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />TWAMP Reflect Octets
    and Symmetrical Size Features<br />draft-ietf-ippm-twamp-reflect-octets-09</h1>

<h3>Abstract</h3>

<p>This memo describes two closely-related features for the core
      specification of TWAMP - the Two-Way Active Measurement Protocol: an
      optional capability where the responding host returns some of the
      command octets or padding octets to the sender, and an optional sender
      packet format that ensures equal test packet sizes are used in both
      directions.
</p>
<h3>Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on February 18, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Purpose and Scope<br />
<a href="#anchor3">3.</a>&nbsp;
TWAMP Control Extensions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
Connection Setup with New Features<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
Reflect Octets: Request-TW-Session Packet Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.3.</a>&nbsp;
Reflect Octets: Accept Session Packet Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.4.</a>&nbsp;
Additional considerations<br />
<a href="#anchor8">4.</a>&nbsp;
Extended TWAMP Test <br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.1.</a>&nbsp;
Sender Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">4.1.1.</a>&nbsp;
Packet Timings<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">4.1.2.</a>&nbsp;
Reflect Octets: Packet Formats and Contents<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">4.1.3.</a>&nbsp;
Reflect Octets: Interaction with Padding Truncation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">4.1.4.</a>&nbsp;
Symmetrical Size: Session-Sender Packet Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">4.1.5.</a>&nbsp;
Symmetrical Size AND Reflect Octets: Session-Sender Packet Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">4.2.</a>&nbsp;
Reflector Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">4.2.1.</a>&nbsp;
Reflect Octets: Session-Reflector Packet Format and Contents<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">4.2.2.</a>&nbsp;
Symmetrical Size: Session-Reflector Packet Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">4.2.3.</a>&nbsp;
Symmetrical Size AND Reflect Octets: Session-Sender Packet Format<br />
<a href="#Security">5.</a>&nbsp;
Security Considerations<br />
<a href="#IANA">6.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">6.1.</a>&nbsp;
Registry Specification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">6.2.</a>&nbsp;
Registry Contents<br />
<a href="#Acknowledgements">7.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>TWAMP - the Two-Way Active Measurement Protocol <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a> is an extension of the One-way Active
      Measurement Protocol, OWAMP <a class='info' href='#RFC4656'>[RFC4656]<span> (</span><span class='info'>Shalunov, S., Teitelbaum, B., Karp, A., Boote, J., and M. Zekauskas, &ldquo;A One-way Active Measurement Protocol (OWAMP),&rdquo; September&nbsp;2006.</span><span>)</span></a>. The TWAMP
      specification gathered wide review as it approached completion, and the
      by-products were several recommendations for new features in TWAMP.
</p>
<p>This memo describes two closely-related features for TWAMP.
</p>
<p>One is the OPTIONAL capability for the responder host to return a
      limited number of unassigned (padding) octets to the Control-Client or
      Session-Sender entities in both the TWAMP-Control and TWAMP-Test
      protocols. With this capability, the Control-Client or Session-Sender
      can embed octets of information it deems useful and have the assurance
      that the corresponding reply/test packet will contain that information
      when it is reflected and returned (by the Server or
      Session-Reflector).
</p>
<p>The memo also adds an OPTIONAL capability to assure that reflected
      test packets are the same size in both directions of transmission. This
      is accomplished by specifying a new TWAMP-Test Session-Sender packet
      format. Although TWAMP <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a> recommends padding
      truncation to achieve symmetrical sizes (to compensate for the
      Session-Reflector's larger test packet header), it's not guaranteed that
      the Session-Reflector will truncate the padding, and it's not possible
      if there's insufficient padding.
</p>
<p>This memo is an update to the TWAMP core protocol specified in <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a>. Measurement systems are not required to
      implement the features described in this memo to claim compliance with
      <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a>.
</p>
<p>Throughout this memo, the bits marked MBZ (Must Be Zero) MUST be set
      to zero by senders and MUST be ignored by receivers. Also, the HMAC
      (Hashed Message Authentication Code) MUST be calculated as defined in
      Section 3.2 of <a class='info' href='#RFC4656'>[RFC4656]<span> (</span><span class='info'>Shalunov, S., Teitelbaum, B., Karp, A., Boote, J., and M. Zekauskas, &ldquo;A One-way Active Measurement Protocol (OWAMP),&rdquo; September&nbsp;2006.</span><span>)</span></a>.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Purpose and Scope</h3>

<p>The purpose of this memo is to define two OPTIONAL closely-related
      features for TWAMP <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a>. The features enhance
      the TWAMP host's capabilities to perform a simple operation on control
      and test packets: the reflection of octets or padding, and the
      capability to ensure symmetrical size TWAMP-Test packets. Motivations
      include permitting the controller host to tag packets with an index for
      simplified identification, and/or assert that the same size test packets
      will be used in each direction.
</p>
<p>The scope of the memo is limited to specifications of the following
      features:
</p>
<p></p>
<ul class="text">
<li>Reflect Octets: the capability of the Server/Session-Reflector to
          reflect specific octets back to the Client/Session-Sender, and a
          similar service provided by the Client and Session-Sender.
</li>
<li>Symmetrical Size: the capability to ensure that TWAMP-Test
          protocol uses the same packet size in both directions through
          support of a new TWAMP-Test Session-Sender test packet format in
          both the Session-Sender and the Session-Reflector. Only the
          Session-Sender test packet format is new.
</li>
</ul><p>This memo extends the modes of operation through assignment of
      two new values in the Modes Field (see section 3.1 of<a class='info' href='#RFC4656'>[RFC4656]<span> (</span><span class='info'>Shalunov, S., Teitelbaum, B., Karp, A., Boote, J., and M. Zekauskas, &ldquo;A One-way Active Measurement Protocol (OWAMP),&rdquo; September&nbsp;2006.</span><span>)</span></a> for the format of the Server Greeting message),
      while retaining backward compatibility with the core TWAMP <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a> implementations. The two new values correspond
      to the two features defined in this memo.
</p>
<p>When the Server and Control-Client have agreed to use the Reflect
      Octets mode during control connection setup, then the Control-Client,
      the Server, the Session-Sender, and the Session-Reflector MUST all
      conform to the requirements of that mode, as identified below.
</p>
<p>When the Server and Control-Client have agreed to use the Symmetrical
      Size mode during control connection setup, then the Control-Client, the
      Server, the Session-Sender, and the Session-Reflector MUST all conform
      to the requirements of that mode, as identified below.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
TWAMP Control Extensions</h3>

<p>TWAMP-Control protocol <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a> uses the Modes
      Field to identify and select specific communication capabilities, and
      this field is a recognized extension mechanism. The following sections
      describe two such extensions.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Connection Setup with New Features</h3>

<p>TWAMP connection establishment follows the procedure defined in
        section 3.1 of <a class='info' href='#RFC4656'>[RFC4656]<span> (</span><span class='info'>Shalunov, S., Teitelbaum, B., Karp, A., Boote, J., and M. Zekauskas, &ldquo;A One-way Active Measurement Protocol (OWAMP),&rdquo; September&nbsp;2006.</span><span>)</span></a> and section 3.1 of <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a>. The new features require two new bit
        positions (and values) to identify the ability of the
        Server/Session-Reflector to reflect specific octets back to the
        Control-Client/Session-Sender, and to support the new Session-Sender
        packet format in TWAMP-Test Protocol. See the IANA section for details
        on the assigned values and bit positions.
</p>
<p>The Server sets one or both of the new bit positions in the Modes
        Field of the Server Greeting message to indicate its capabilities and
        willingness to operate in either of these modes (or both) if
        desired.
</p>
<p>If the Control-Client intends to operate all test sessions invoked
        with this control connection using one or both of the new modes, it
        MUST set the Mode Field bit corresponding to each function in the
        Setup Response message. With this and other extensions, the
        Control-Client MAY set multiple Mode Field bits in the Setup Response
        message.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Reflect Octets: Request-TW-Session Packet Format</h3>

<p>The bits designated for the Reflect Octets feature in the
        Request-TW-Session command are as shown in the packet format
        below.
</p>
<p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      5        |  MBZ  | IPVN  |  Conf-Sender  | Conf-Receiver |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                  Number of Schedule Slots                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
.                                                               .
.           ... Many fields (66 octets) not shown ...           .
.                                                               .
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Padding Length  (4 octets)                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Start Time, (8 octets)                   |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Timeout, (8 octets)                     |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Type-P Descriptor                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Octets to be reflected    |  Length of padding to reflect |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       MBZ (4 octets)                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                       HMAC (16 octets)                        |
|                                                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>
</p>

<p>It is important to note that the "Padding Length" Field continues
        to specify the number of padding octets that the Session-Sender will
        append to ALL TWAMP-Test packets associated with this test session.
        See below for considerations on the minimum length of the padding
        octets, following the definitions of the two new fields that follow
        the Type-P Descriptor.
</p>
<p>Note that the number of padding octets appended to the
        Session-Reflector's test packet depends on support for the truncation
        process that TWAMP section 4.2.1 <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a>
        recommends.
</p>
<p>The "Octets to be reflected" Field SHALL be 2 octets long, as shown
        and contains the octets that the Server MUST reflect in the Accept
        Session message as specified below.
</p>
<p>The "Length of padding to reflect" Field SHALL be 2 octets long,
        and contain an unsigned binary value in units of octets. This field
        communicates the length of the padding in the TWAMP-Test Packet that
        the Session-Sender expects to be reflected, and the length of octets
        that the Session-Reflector SHALL return in its TWAMP-Test packet
        format (see section 4.2). By including this length field in the
        Request-TW-Session message, a Server is able to determine if it can
        comply with a specific request to reflect padding in the TWAMP-Test
        packets, and to arrange for the Session-Reflector processing in
        advance.
</p>
<p>The "Padding Length" SHOULD be &gt;= 27 octets when specifying a
        test session using the Unauthenticated TWAMP-Test mode, to allow for
        the truncation process that TWAMP section 4.2.1 <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a> recommends.
</p>
<p>The "Padding Length" SHOULD be &gt;= 56 octets when specifying a
        test session using the Authenticated or Encrypted TWAMP-Test modes, to
        allow for the truncation process that TWAMP section 4.2.1 <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a> recommends.
</p>
<p>The "Padding Length" SHALL be &gt; the "Length of padding to
        reflect" when specifying a test session using the OPTIONAL Reflect
        Octets mode.
</p>
<p>In Unauthenticated TWAMP-Test mode, the "Padding Length" SHALL be
        &gt;= 27 + "Length of padding to reflect" octets when specifying a
        test session using both the OPTIONAL Reflect Octets mode and the
        truncation process that TWAMP section 4.2.1 <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a> recommends.
</p>
<p>In Authenticated or Encrypted TWAMP-Test modes, the "Padding
        Length" SHALL be &gt;= 56 + "Length of padding to reflect" octets when
        specifying a test session using both the OPTIONAL Reflect Octets mode
        and the truncation process that TWAMP section 4.2.1 <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a> recommends.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Reflect Octets: Accept Session Packet Format</h3>

<p>The bits designated for the Reflect Padding feature in the Accept
        Session command are as shown in the packet format below.
</p>
<p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Accept     |      MBZ      |            Port               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-|
|                                                               |
|                        SID (16 octets)                        |
|                                                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Reflected octets        |         Server octets         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       MBZ (8 octets)                          |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                       HMAC (16 octets)                        |
|                                                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div>
<p>
</p>

<p>The "Reflected octets" field SHALL contain the octets from the
        Request-TW-Session "Octets to be reflected" Field, and be 2 octets
        long, as shown.
</p>
<p>The "Server octets" field SHALL contain information that the Server
        intends to be returned in the TWAMP-Test packet padding
        to-be-reflected Field, OR SHALL be zero, and be 2 octets long, as
        shown. Although the Server determines the SID, this field is very long
        (16 octets) and does not normally appear in TWAMP-Test packets. The
        following items MUST be part of compliant implementations using the
        Reflect Octets feature:
</p>
<p></p>
<ul class="text">
<li>When a Server does not require octets to be returned in
            TWAMP-Test packets, it MUST send all zeros in the Server octets
            field
</li>
<li>When a Server intends octets to be returned in TWAMP-Test
            packets, it MUST send a non-zero value in the Server octets field,
            and the TWAMP-Test Sender MUST include those octets at the
            beginning of the "Packet Padding (to be reflected)" field
</li>
<li>Section 4.1.2 defines how Server octets MUST be included in the
            TWAMP-Test packet padding when this service is desired by the
            Server (indicated in the second of two figures in the section)
</li>
</ul><p>When performing the truncation process that TWAMP section
        4.2.1 <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a> recommends, if calculations on
        the Padding lengths reveal that there are insufficient octets supplied
        to produce equal-length Session-Sender and Session-Reflector test
        packets, then the Accept Field MUST be set to 3 to indicate that some
        aspect of the request is not supported.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Additional considerations</h3>

<p>The value of the Modes Field sent by the Server in the Server
        Greeting message is the bit-wise OR of the mode values that it is
        willing to support during this session.
</p>
<p>With the publication of this memo as an RFC, the last 7 bit
        positions of the Modes 32-bit Field are used. A Control-Client
        conforming to this extension of <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a> MAY
        ignore the values in the higher bits of the Modes Field, or it MAY
        support other features that are communicated in those bit positions.
        The other bits are available for future protocol extensions.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Extended TWAMP Test </h3>

<p>The TWAMP test protocol is similar to the OWAMP <a class='info' href='#RFC4656'>[RFC4656]<span> (</span><span class='info'>Shalunov, S., Teitelbaum, B., Karp, A., Boote, J., and M. Zekauskas, &ldquo;A One-way Active Measurement Protocol (OWAMP),&rdquo; September&nbsp;2006.</span><span>)</span></a> test protocol with the exception that the
      Session-Reflector transmits test packets to the Session-Sender in
      response to each test packet it receives. TWAMP section 4<a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a> defines two additional test packet formats for
      packets transmitted by the Session-Reflector. The appropriate format
      depends on the security mode chosen. The new modes specified here
      utilize some of the padding octets within each test packet format, or
      require truncation of those octets depending on the security mode in
      use.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Sender Behavior</h3>

<p>This section describes extensions to the behavior of the TWAMP
        Session-Sender.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1"></a><h3>4.1.1.&nbsp;
Packet Timings</h3>

<p>The Send Schedule is not utilized in TWAMP, and this is unchanged
          in this memo.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2"></a><h3>4.1.2.&nbsp;
Reflect Octets: Packet Formats and Contents</h3>

<p>The Session-Sender packet format and content follow the same
          procedure and guidelines as defined in section 4.1.2 of <a class='info' href='#RFC4656'>[RFC4656]<span> (</span><span class='info'>Shalunov, S., Teitelbaum, B., Karp, A., Boote, J., and M. Zekauskas, &ldquo;A One-way Active Measurement Protocol (OWAMP),&rdquo; September&nbsp;2006.</span><span>)</span></a> (as indicated in section 4.1.2 of TWAMP
          <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a>).
</p>
<p>The Reflect octets mode re-designates the original TWAMP-Test
          Packet Padding Field (see section 4.1.2 of <a class='info' href='#RFC4656'>[RFC4656]<span> (</span><span class='info'>Shalunov, S., Teitelbaum, B., Karp, A., Boote, J., and M. Zekauskas, &ldquo;A One-way Active Measurement Protocol (OWAMP),&rdquo; September&nbsp;2006.</span><span>)</span></a>), as shown below for unauthenticated
          mode:
</p>
<p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Sequence Number                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          Timestamp                            |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Error Estimate        |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                                                               |
|                  Packet Padding (to be reflected)             |
.               (length in octets specified in command)         .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
.                                                               .
.                  Additional Packet Padding                    .
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div>
<p>
</p>

<p>The "Packet Padding (to be reflected)" Field SHALL correspond to
          the length of octets specified in the Request-TW-Session "Length of
          padding to reflect" Field to this test session. These are the octets
          that the Session-Sender expects will be returned by the
          Session-Reflector.
</p>
<p>The length of the "Additional Packet Padding" Field is the
          difference between two fields in the Request-TW-Session command, as
          follows:
</p>
<p>"Additional Packet Padding", in octets =
</p>
<p>"Padding Length" - "Length of padding to reflect"
</p>
<p>When a Server intends octets to be returned in TWAMP-Test
          packets, it MUST send a non-zero value in the Server octets field,
          and the TWAMP-Test Session-Sender MUST include those octets in the
          first 2 octets of the "Packet Padding (to be reflected)" Field as
          shown below:
</p>
<p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
                                +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                |         Server octets         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|              Remaining Packet Padding (to be reflected)       |
.             (total length in octets specified in command)     .
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div>
<p>
</p>

<p>The "Server octets" field contains the same information that the
          Server returned to the Control-Client in the Accept-Session message
          corresponding to this specific test session (see section 3.3). At
          the Session-Reflector, these octets MUST be reflected the same as
          the rest of the "Packet Padding (to be reflected)" field.
</p>
<p>Note that it is permissible for the Session-Sender to insert the
          same octets used in the "Octets to be reflected" field of the
          Request-TW-Session command elsewhere in the "Packet Padding (to be
          reflected)" field.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.3"></a><h3>4.1.3.&nbsp;
Reflect Octets: Interaction with Padding Truncation</h3>

<p>When the Reflect Octets mode is selected, and the performing
          truncation process that TWAMP section 4.2.1 <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a> recommends, the Session-Sender MUST
          anticipate a minimum padding required to achieve equal size test
          packets in both directions. The amount of padding needed to achieve
          symmetrical packet size depends on both the security mode
          (Unauthenticated/Authenticated/Encrypted) and whether the Reflect
          Octets mode is selected simultaneously.
</p>
<p>When using the truncation process in TWAMP section 4.2.1 <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a> alone, the Session-Sender MUST append
          sufficient Packet Padding octets to allow the same IP packet payload
          lengths to be used in each direction of transmission (this is
          usually desirable). To compensate for the Session-Reflector&rsquo;s
          larger test packet format, the Session-Sender MUST append at least
          27 octets of padding in Unauthenticated mode, and at least 56 octets
          in Authenticated and Encrypted modes. The sizes of TWAMP Test
          protocol packets and the resulting truncated padding to achieve
          equal packet sizes in both directions are shown in the table
          below:
</p><br /><hr class="insert" />

<p style='text-align: center'>
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">Octets in:</th><th align="left">Unauthenticated Mode</th><th align="left">Auth/Encrypted Mode</th></tr>
<tr>
<td align="left">Reflector Header</td>
<td align="left">41</td>
<td align="left">104</td>
</tr>
<tr>
<td align="left">Sender Header</td>
<td align="left">14</td>
<td align="left">48</td>
</tr>
<tr>
<td align="left">Truncated Padding</td>
<td align="left">27</td>
<td align="left">56</td>
</tr>
</table>
<br clear="all" />

<p style='text-align: center'>
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;TWAMP-Test Padding Truncation&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>When using the Reflect Octets mode simultaneously with the
          truncation process that TWAMP recommends in section 4.2.1 <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a>, the Session-Sender MUST append at least 27
          octets of padding plus the "Length of the padding to reflect" octets
          when operating in Unauthenticated mode. The Session-Sender MUST
          append at least 56 octets of padding plus the "Length of the padding
          to reflect" octets when operating in Authenticated and Encrypted
          modes.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.4"></a><h3>4.1.4.&nbsp;
Symmetrical Size: Session-Sender Packet Format</h3>

<p>When the Symmetrical Size mode is selected, the Session-Sender
          SHALL use the following TWAMP-Test Packet Format in Unauthenticated
          mode:
</p>
<p>Unauthenticated Mode
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Sequence Number                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          Timestamp                            |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Error Estimate        |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                                                               |
|                                                               |
|                         MBZ (27 octets)                       |
|                                                               |
|                                                               |
|                                                               |
+               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               |                                               |
+-+-+-+-+-+-+-+-+                                               +
.                                                               .
.                        Packet Padding                         .
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div>
<p>
</p>
<p>This feature REQUIRES only a new Session-Sender test packet
          format, the Session-Reflector test packet format is unchanged.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.5"></a><h3>4.1.5.&nbsp;
Symmetrical Size AND Reflect Octets: Session-Sender Packet Format</h3>

<p>When both the Symmetrical Size mode and the Reflect Octets mode
          are selected, the Session-Sender SHALL use the following TWAMP-Test
          Packet Format in Unauthenticated mode:
</p>
<p>Unauthenticated Mode
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Sequence Number                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          Timestamp                            |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Error Estimate        |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                                                               |
|                                                               |
|                         MBZ (27 octets)                       |
|                                                               |
|                                                               |
|                                                               |
+               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               |                                               |
+-+-+-+-+-+-+-+-+                                               +
|                  Packet Padding (to be reflected)             |
.               (length in octets specified in command)         .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
.                                                               .
.                  Additional Packet Padding                    .
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div>
<p>
</p>
<p>In this combined mode, the Packet Padding to be reflected follows
          the 27 MBZ octets. In Authenticated or Encrypted modes, the Packet
          Padding to be reflected follows the 56 MBZ octets.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Reflector Behavior</h3>

<p>The TWAMP Reflector follows the procedures and guidelines in
        section 4.2 of <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a>, with the following
        additional functions:
</p>
<p></p>
<ul class="text">
<li>Reflect Octets mode: Designated octets in the "Packet Padding
            (to be reflected)" field of the Session-Sender's test packet MUST
            be included in the Session-Reflector's test packet.
</li>
<li>Symmetrical Size mode: The Session-Reflector MUST operate using
            the Session_Reflector Packet Format defined in section 4.1.4,
            where the Padding Octets are separated from the information
            fields.
</li>
</ul>

<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Reflect Octets: Session-Reflector Packet Format and Contents</h3>

<p>The Reflect Padding feature re-designates the packet padding
          field, as shown below. When the Reflect Octets mode is selected, the
          Session-Sender SHALL use the following TWAMP-Test Packet Format in
          Unauthenticated mode:
</p>
<p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                        Sequence Number                        |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                          Timestamp                            |
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |         Error Estimate        |           MBZ                 |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                          Receive Timestamp                    |
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                        Sender Sequence Number                 |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                      Sender Timestamp                         |
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |      Sender Error Estimate    |           MBZ                 |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |  Sender TTL   |         Packet Padding (from Session-Sender)  |
 +-+-+-+-+-+-+-+-+                                               +
 .                                                               .
 +                                               +-+-+-+-+-+-+-+-+
 |          Packet Padding (from Session-Sender) |               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               +
 |                                                               |
 |                                                               |
 .                  Additional Packet Padding                    .
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div>
<p>
</p>The "Packet Padding (from Session-Sender)" field MUST be
          the same octets as the "Packet Padding (to be reflected)" field in
          the Session-Sender's test packet, and therefore MUST conform to the
          length specified in the Request-TW-Session message.

<p>When the Server has returned a non-zero value in the "Server
          octets" field of the Accept Session message (as described in section
          3.3), then the Session-Reflector SHALL reflect these octets the same
          as the rest of the "Packet Padding (to be reflected)" Field.
</p>
<p>Section 4.2.1 of <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a> recommends a
          padding truncation process for use in TWAMP. When using that process
          in conjunction with the Reflect octets mode, the Session-Reflector
          MUST reflect the designated octets from the Session-Sender's test
          packet in the "Packet Padding (from Session-Sender)" Field, and MAY
          re-use additional Packet Padding from the Session-Sender. The
          Session-Reflector MUST truncate the padding such that the highest
          number octets are discarded, and the test packet length equals the
          Session-Sender's packet length. When using the recommended
          truncation process, the Session-Reflector MUST truncate exactly 27
          octets of padding in Unauthenticated mode, and exactly 56 octets in
          Authenticated and Encrypted modes.
</p>
<p>In any case, the Session-Reflector MAY re-use the Sender&rsquo;s
          Packet Padding (since the requirements for padding generation are
          the same for each).
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Symmetrical Size: Session-Reflector Packet Format</h3>

<p>When Symmetrical Size mode is selected, the Session-Reflector
          packet formats for unauthenticated and authenticated/encrypted modes
          are identical to the core TWAMP specification, section 4.2.1 of
          <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a>. Thus, the Session-Reflector test
          packet format is unchanged.
</p>
<p>The Session-Reflector MUST construct its test packet using the
          information in the Session-Sender's test packet. The length of the
          Session-Reflector's test packet SHALL equal the length of the
          Session-Sender's test packet.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.3"></a><h3>4.2.3.&nbsp;
Symmetrical Size AND Reflect Octets: Session-Sender Packet Format</h3>

<p>When both the Symmetrical Size mode and the Reflect Octets mode
          are selected, the Session-Reflector MUST operate using the
          Session-Reflector Packet Format defined in section 4.1.5, where the
          Padding Octets are separated from the information fields, and the
          Padding to be Reflected field precedes the Additional Padding.
</p>
<p>The Session-Reflector SHALL use the same TWAMP-Test Packet Format
          as specified in section 4.2.1 above.
</p>
<p>
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>These extended modes of operation do not appear to permit any new
      attacks on hosts communicating with core TWAMP <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a>.
</p>
<p>The security considerations that apply to any active measurement of
      live networks are relevant here as well. See <a class='info' href='#RFC4656'>[RFC4656]<span> (</span><span class='info'>Shalunov, S., Teitelbaum, B., Karp, A., Boote, J., and M. Zekauskas, &ldquo;A One-way Active Measurement Protocol (OWAMP),&rdquo; September&nbsp;2006.</span><span>)</span></a> and <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a>.
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>This memo adds two modes to the IANA registry for the TWAMP Modes
      Field, and describes behavior when the new modes are used. This field is
      a recognized extension mechanism for TWAMP.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Registry Specification</h3>

<p>IANA has created a TWAMP-Modes registry (as requested in <a class='info' href='#RFC5618'>[RFC5618]<span> (</span><span class='info'>Morton, A. and K. Hedayat, &ldquo;Mixed Security Mode for the Two-Way Active Measurement Protocol (TWAMP),&rdquo; August&nbsp;2009.</span><span>)</span></a>). TWAMP-Modes are specified in TWAMP Server
        Greeting messages and Set-up Response messages, as described in
        section 3.1 of <a class='info' href='#RFC5357'>[RFC5357]<span> (</span><span class='info'>Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;A Two-Way Active Measurement Protocol (TWAMP),&rdquo; October&nbsp;2008.</span><span>)</span></a>, consistent with section
        3.1 of <a class='info' href='#RFC4656'>[RFC4656]<span> (</span><span class='info'>Shalunov, S., Teitelbaum, B., Karp, A., Boote, J., and M. Zekauskas, &ldquo;A One-way Active Measurement Protocol (OWAMP),&rdquo; September&nbsp;2006.</span><span>)</span></a>, and extended by this memo.
        Modes are indicated by setting bits in the 32-bit Modes field that
        correspond to values in the Modes registry. For the TWAMP-Modes
        registry, we expect that new features will be assigned increasing
        registry values that correspond to single bit positions, unless there
        is a good reason to do otherwise (more complex encoding than single
        bit positions may be used in the future, to access the 2^32 value
        space).
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Registry Contents</h3>

<p>TWAMP Modes Registry is recommended to be augmented as
        follows:
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>Value  Description             Semantics Definition
--------------------------------------------------------
xxx    Reflect Octets          this memo, section 3.1
       Capability              new bit position (X)
yyy    Symmetrical Size        this memo, section 3.1
       Sender Test Packet Format new bit position (Y)

</pre></div>
<p>
</p>

<p>&gt;&gt;&gt;IANA: change xxx, yyy, X, Y, and RFC???? to the
        assigned values
</p>
<p>The suggested values are
</p>
<p>X=5, xxx=32
</p>
<p>Y=6, yyy=64 &lt;&lt;&lt;&lt;
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Acknowledgements</h3>

<p>The authors thank Steve Baillargeon, Walt Steverson, and Stina Ross
      for helpful review and comments.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4656">[RFC4656]</a></td>
<td class="author-text">Shalunov, S., Teitelbaum, B., Karp, A., Boote, J., and M. Zekauskas, &ldquo;<a href="http://tools.ietf.org/html/rfc4656">A One-way Active Measurement Protocol (OWAMP)</a>,&rdquo; RFC&nbsp;4656, September&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4656.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5357">[RFC5357]</a></td>
<td class="author-text">Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and J. Babiarz, &ldquo;<a href="http://tools.ietf.org/html/rfc5357">A Two-Way Active Measurement Protocol (TWAMP)</a>,&rdquo; RFC&nbsp;5357, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5357.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5618">[RFC5618]</a></td>
<td class="author-text">Morton, A. and K. Hedayat, &ldquo;<a href="http://tools.ietf.org/html/rfc5618">Mixed Security Mode for the Two-Way Active Measurement Protocol (TWAMP)</a>,&rdquo; RFC&nbsp;5618, August&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5618.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Al Morton</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">AT&amp;T Labs</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">200 Laurel Avenue South</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Middletown,, NJ  07748</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 732 420 1571</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text">+1 732 368 1192</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:acmorton@att.com">acmorton@att.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://home.comcast.net/~acmacm/">http://home.comcast.net/~acmacm/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Len Ciavattone</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">AT&amp;T Labs</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">200 Laurel Avenue South</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Middletown,, NJ  07748</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 732 420 1239</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:lencia@att.com">lencia@att.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href=""></a></td></tr>
</table>
</body></html>
