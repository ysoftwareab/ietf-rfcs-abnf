<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Graceful BGP session shutdown</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Graceful BGP session shutdown">
<meta name="keywords" content="I-D, Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header"> Pierre Francois</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Universite catholique de Louvain</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header"> Bruno Decraene</td></tr>
<tr><td class="header">Expires: April 28, 2011</td><td class="header">France Telecom</td></tr>
<tr><td class="header">&nbsp;</td><td class="header"> Cristel Pelsser</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Internet Initiative Japan</td></tr>
<tr><td class="header">&nbsp;</td><td class="header"> Keyur Patel</td></tr>
<tr><td class="header">&nbsp;</td><td class="header"> Clarence Filsfils</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Cisco Systems</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 25, 2010</td></tr>
</table></td></tr></table>
<h1><br />Graceful BGP session shutdown<br />draft-ietf-grow-bgp-gshut-02</h1>

<h3>Abstract</h3>

<p>This draft describes operational procedures aimed at reducing the
  amount of traffic lost during planned maintenances of routers,
  involving the shutdown of BGP peering sessions.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on April 28, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<a href="#sec.loss">3.</a>&nbsp;
Packet loss upon manual eBGP session shutdown<br />
<a href="#sec.practices">4.</a>&nbsp;
Practices to avoid packet losses<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">4.1.</a>&nbsp;
Improving availability of alternate paths<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">4.2.</a>&nbsp;
Graceful shutdown procedures for eBGP sessions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.outbound">4.2.1.</a>&nbsp;
Outbound traffic<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.inbound">4.2.2.</a>&nbsp;
Inbound traffic<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.2.3.</a>&nbsp;
Summary of operations<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">4.2.4.</a>&nbsp;
BGP implementation support for G-Shut<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">4.3.</a>&nbsp;
Graceful shutdown procedures for iBGP sessions<br />
<a href="#sec.forwarding">5.</a>&nbsp;
Forwarding modes and forwarding loops<br />
<a href="#sec.policies">6.</a>&nbsp;
Dealing with Internet policies<br />
<a href="#anchor14">7.</a>&nbsp;
Link Up cases<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">7.1.</a>&nbsp;
Unreachability local to the ASBR<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">7.2.</a>&nbsp;
iBGP convergence<br />
<a href="#anchor17">8.</a>&nbsp;
IANA considerations<br />
<a href="#anchor18">9.</a>&nbsp;
Security Considerations<br />
<a href="#anchor19">10.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">11.</a>&nbsp;
References<br />
<a href="#anchor21">Appendix&nbsp;A.</a>&nbsp;
Alternative techniques with limited applicability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.loc-pref.infilter">A.1.</a>&nbsp;
In-filter reconfiguration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.med-poison">A.2.</a>&nbsp;
Multi Exit Discriminator tweaking<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.igp-poison">A.3.</a>&nbsp;
IGP distance Poisoning<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> Routing changes in BGP can be caused by planned, manual,
	maintenance operations. This document discusses operational
	procedures to be applied in order to reduce or eliminate
	losses of packets during the maintenance. These losses come
	from the transient lack of reachability during the BGP
	convergence following the shutdown of an eBGP peering session
	between two Autonomous System Border Routers (ASBR).
</p>
<p> This document presents procedures for the cases where the
	forwarding plane is impacted by the maintenance, hence when
	the use of Graceful Restart does not apply.
</p>
<p> The procedures described in this document can be applied
	to reduce or avoid packet loss for outbound and inbound
	traffic flows initially forwarded along the peering link to be
	shut down.  These procedures allow routers to keep using old
	paths until alternate ones are learned, ensuring that routers
	always have a valid route available during the convergence
	process.
</p>
<p> The goal of the document is to meet the requirements
	described in <a class='info' href='#REQS'>[REQS]<span> (</span><span class='info'>Decraene, B., Francois, P., Pelsser, C., Ahmad, Z., Armengol, A., and T. Takeda, &ldquo;Requirements for the graceful shutdown of BGP sessions,&rdquo; October&nbsp;2010.</span><span>)</span></a> at best, without
	changing the BGP protocol or BGP implementations.
</p>
<p> Still, it explains why reserving a community value for the
	purpose of BGP session graceful shutdown would reduce the
	management overhead bound with the solution. It would also
	allow vendors to provide an automatic graceful shutdown
	mechanism that does not require any router reconfiguration at
	maintenance time. 
</p>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
	 "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
	 and "OPTIONAL" in this document are to be interpreted as
	 described in RFC 2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p> g-shut initiator : a router on which the session shutdown
	is performed for the maintenance. 
</p>
<p> g-shut neighbor : a router that peers with the g-shut
	initiator via (one of) the session(s) to be shut down.
</p>
<p> Note that for the link-up case, we will refer to these
	nodes as g-no-shut initiator, and g-no-shut neighbor.
</p>
<p> Initiator AS : the Autonomous System of the g-shut initiator.
</p>
<p> Neighbor AS : the Autonomous System of the g-shut neighbor.
</p>
<p> Affected path / Nominal / pre-convergence path : a BGP
	path via the peering link(s) undergoing the maintenance. This
	path will no longer exist after the shutdown.
</p>
<p> Affected prefix : a prefix initially reached via an affected path.
</p>
<p> Affected router : a router having an affected prefix.
</p>
<p> Backup / alternate / post-convergence path : a path
	towards an affected prefix that will be selected as the best
	path by an affected router, when the link is shut down and the
	BGP convergence is completed.
</p>
<p> Transient alternate path : a path towards an affected
	prefix that may be transiently selected as best by an affected
	router during the convergence process but that is not a
	post-convergence path.  
</p>
<p> Loss of Connectivity (LoC) : the state when a router has
	no path towards an affected prefix.
</p>
<a name="sec.loss"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Packet loss upon manual eBGP session shutdown</h3>

<p>Packets can be lost during a manual shutdown of an eBGP
	session for two reasons. 
</p>
<p>First, routers involved in the convergence process can
	transiently lack of paths towards an affected prefix, and drop
	traffic destined to this prefix. This is because alternate
	paths can be hidden by nodes of an AS. This happens when the
	paths are not selected as best by the ASBR that receive them
	on an eBGP session, or by Route Reflectors that do not
	propagate them further in the iBGP topology because they do
	not select them as best. 
</p>
<p>Second, within the AS, the FIB of routers can be transiently
	inconsistent during the BGP convergence and packets towards
	affected prefixes can loop and be dropped. Note that these
	loops only happen when ASBR-to-ASBR encapsulation is not used
	within the AS.
</p>
<p>This document only addresses the first reason. 
</p>
<a name="sec.practices"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Practices to avoid packet losses</h3>

<p>This section describes means for an ISP to reduce the
	transient loss of packets upon a manual shutdown of a BGP
	session. 
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Improving availability of alternate paths</h3>

<p>All solutions that increase the availability of alternate
	  BGP paths at routers performing packet lookups in BGP tables
	  <a class='info' href='#BestExternal'>[BestExternal]<span> (</span><span class='info'>Marques, P., Fernando, R., Chen, E., and P. Mohapatra, &ldquo;Advertisement of the best-external route to IBGP,&rdquo; May&nbsp;2009.</span><span>)</span></a> <a class='info' href='#AddPath'>[AddPath]<span> (</span><span class='info'>D. Walton, A. Retana, and E. Chen, &ldquo;Advertisement of Multiple Paths in BGP,&rdquo; .</span><span>)</span></a> help
	  in reducing the LoC bound with manual shutdown of eBGP
	  sessions.
</p>
<p>One of such solutions increasing diversity in such a way that, at
	  any single step of the convergence process following the
	  eBGP session shutdown, a BGP router does not receive a
	  message withdrawing the only path it currently knows for a
	  given NLRI, allows for a simplified g-shut procedure.
</p>
<p>Increasing diversity with <a class='info' href='#AddPath'>[AddPath]<span> (</span><span class='info'>D. Walton, A. Retana, and E. Chen, &ldquo;Advertisement of Multiple Paths in BGP,&rdquo; .</span><span>)</span></a> might
	  lead to the respect of this property, depending on the path
	  propagation decision process that add-path compliant routers
	  would use. 
</p>
<p>Using advertise-best-external <a class='info' href='#BestExternal'>[BestExternal]<span> (</span><span class='info'>Marques, P., Fernando, R., Chen, E., and P. Mohapatra, &ldquo;Advertisement of the best-external route to IBGP,&rdquo; May&nbsp;2009.</span><span>)</span></a> on ASBRs and RRs helps in avoiding
	  lack of alternate paths in route reflectors upon a
	  convergence. Hence it reduces the LoC duration for the
	  outbound traffic of the ISP upon an eBGP Session shutdown by
	  reducing the iBGP path hunting.
</p>
<p>Note that the LoC for the inbound traffic of the
	  maintained router, induced by a lack of alternate path
	  propagation within the iBGP topology of a neighboring AS is
	  not under the control of the operator performing the
	  maintenance. The procedure described in <a class='info' href='#sec.inbound'>Section&nbsp;4.2.2<span> (</span><span class='info'>Inbound traffic</span><span>)</span></a> should thus be applied upon the maintenance,
	  even if the procedure described in <a class='info' href='#sec.outbound'>Section&nbsp;4.2.1<span> (</span><span class='info'>Outbound traffic</span><span>)</span></a> is not applied.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Graceful shutdown procedures for eBGP sessions</h3>

<p> This section aims at describing a procedure to be
		applied to reduce the LoC with readily available BGP
		features, and without assuming a particular iBGP design
		in the Initiator and Neighbor ASes.
</p>
<a name="sec.outbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Outbound traffic</h3>

<p>This section discusses a mean to render the
			affected paths less desirable by the BGP
			decision process of affected routers, still
			allowing these to be used during the
			convergence, while alternate paths are
			propagated to the affected routers.
</p>
<p>A decrease of the local-pref value
				of the affected paths can be issued in
				order to render the affected paths
				less preferable, at the highest
				possible level of the BGP Decision
				Process.
</p>
<p>This operation can be performed by
				reconfiguring the out-filters
				associated with the iBGP sessions
				established by the g-shut initiator.
				
</p>
<p> The modification of the filters
				MUST supplant any other rule affecting
				the local-pref value of the old
				paths.
</p>
<p> Compared to using an in-filter of
				the eBGP session to be shut down, the
				modification of the out-filters will
				not let the g-shut initiator switch to
				another path, as the input to the BGP
				decision process of that router does
				not change. As a consequence, the
				g-shut initiator will not modify the
				state of its dataplane, and will not
				withdraw the affected paths over its
				iBGP sessions when it receives
				alternate paths. It will however
				modify the local-pref of the affected
				paths so that upstream routers will
				switch to alternate ones.
</p>
<p> When the actual shutdown of the
				session is performed, the g-shut
				initiator will itself switch to the
				alternate paths.
</p>
<p> In cases some BGP speakers in the
				AS override the local-pref attribute
				of paths received over iBGP sessions,
				the procedure described above will not
				work. In such cases, the recommended
				procedure is to tag the paths sent
				over the iBGP sessions of the g-shut
				initiator with an AS specific
				community. This AS specific community
				should lead to the setting of the
				lowest local-pref value.  To be
				effective, the configuration related
				to this community MUST supplant or be
				applied after the already configured
				local-pref overriding.
				
</p>
<p>An operator may decide to follow a
				simplified procedure and directly
				apply an in-filter reducing the local
				preference of the paths received over
				the eBGP session being brought
				down. While this procedure will be
				effective in many cases, corner cases
				as described in <a class='info' href='#sec.loc-pref.infilter'>Appendix&nbsp;A.1<span> (</span><span class='info'>In-filter reconfiguration</span><span>)</span></a> may happen,
				which may lead to some LoC for some
				affected destinations. The use of this
				simplified procedure does not lead to
				LoC when used in conjunction with
				<a class='info' href='#BestExternal'>[BestExternal]<span> (</span><span class='info'>Marques, P., Fernando, R., Chen, E., and P. Mohapatra, &ldquo;Advertisement of the best-external route to IBGP,&rdquo; May&nbsp;2009.</span><span>)</span></a>.
				
</p>
<a name="sec.inbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Inbound traffic</h3>

<p> The solution described for the outbound traffic
		  can be applied at the neighbor AS. This can be done
		  either "manually" or by using a community value
		  dedicated to this task.
</p>
<a name="sec.phone"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.1"></a><h3>4.2.2.1.&nbsp;
Phone call</h3>

<p> The operator performing the maintenance of the
		    eBGP session can contact the operator at the other
		    side of the peering link, and let him apply the
		    procedure described above for its own outbound
		    traffic.
</p>
<a name="sec.community"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.2"></a><h3>4.2.2.2.&nbsp;
Community tagging</h3>

<p> A community value (referred to as GSHUT
		  community in this document) can be agreed upon by
		  neighboring ASes and used to trigger the g-shut
		  behavior at the g-shut neighbor.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.2.1"></a><h3>4.2.2.2.1.&nbsp;
Pre-Configuration</h3>

<p> A g-shut neighbor is pre-configured to set a
		    low local-pref value for the paths received over
		    eBGP sessions which are tagged with the GSHUT
		    community.
</p>
<p>This rule must supplant any other rule
		    affecting the local-pref value of the paths. 
</p>
<p>This local-pref reconfiguration SHOULD be
		    performed at the out-filters of the iBGP sessions
		    of the g-shut neighbor. That is, the g-shut
		    neighbor does not take into account this low
		    local-pref in its own BGP best path selection. As
		    described in <a class='info' href='#sec.outbound'>Section&nbsp;4.2.1<span> (</span><span class='info'>Outbound traffic</span><span>)</span></a> this
		    approach avoids sending withdraw messages that can
		    lead to LoC in some cases.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.2.2"></a><h3>4.2.2.2.2.&nbsp;
Operational action upon maintenance</h3>

<p>Upon the manual shutdown, the output filter
		    associated with the maintained eBGP session will
		    be modified on the g-shut initiator so as to tag
		    all the paths advertised over the session with the
		    GSHUT community.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.2.3"></a><h3>4.2.2.2.3.&nbsp;
Transitivity of the community</h3>

<p>If the GSHUT community is an extended
		    community, it SHOULD be chosen non-transitive. 		    
		    
</p>
<p>If a regular community is used, this community
		    SHOULD be removed from the path when the path is
		    propagated over eBGP sessions.
</p>
<p>Not propagating the community further in the
		    Internet reduces the amount of BGP churn and
		    avoids rerouting in distant ASes that would also
		    recognize this community value. In other words,
		    from a routing stability perspective, it helps
		    concealing the convergence at the maintenance
		    location. From a policy perspective, it prevents
		    malignant ASes from using the community over paths
		    propagated through intermediate ASes that do not
		    support the feature, in order to perform inbound
		    traffic engineering at the first AS recognizing
		    the community.
</p>
<p>ASes which support the g-shut procedure SHOULD
		    remove the community value(s) that they use for
		    g-shut from the paths received from neighboring
		    ASes that do not support the procedure or to whom
		    the service is not provided.
</p>
<p> There are cases where an interdomain
		    exploration is to be performed to recover the
		    reachability, e.g., in the case of a shutdown in
		    confederations where the alternate paths will be
		    found in another AS of the confederation. In such
		    scenarios, the community value SHOULD be allowed
		    to transit through the confederation but SHOULD be
		    removed from the paths advertised outside of the
		    confederation.
</p>
<p> When the local-pref value of a path is
		    conserved upon its propagation from one AS of the
		    confederation to the other, there is no need to
		    have the GSHUT community be propagated throughout
		    that confederation.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.2.4"></a><h3>4.2.2.2.4.&nbsp;
Easing the configuration for G-SHUT</h3>

<p>From a configuration burden viewpoint, it is
		    much easier to use a single dedicated value for
		    the GSHUT community.
</p>
<p>First, on the g-shut initiator, an operator
		    would have a single configuration rule to be
		    applied at the maintenance time, which would not
		    depend on the identity of its peer. This would
		    make the maintenance operations less error
		    prone.
</p>
<p>Second, on the g-shut neighbor, a simple filter
		    related to g-shut can be applied to all iBGP
		    sessions. Additionnaly, this filter does not need
		    to be updated each time neighboring ASes are added
		    or removed.
</p>
<p>The FCFS community value 0xFFFF0000 has been reserved 
		    for this purpose <a class='info' href='#BGPWKC'>[BGPWKC]<span> (</span><span class='info'>, &ldquo;http://www.iana.org/assignments/bgp-well-known-communities,&rdquo; .</span><span>)</span></a>.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.3"></a><h3>4.2.3.&nbsp;
Summary of operations</h3>

<p>This section summarizes the configurations and actions to
	  be performed to support the g-shut procedure for eBGP
	  peering links. 
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.3.1"></a><h3>4.2.3.1.&nbsp;
Pre-configuration</h3>

<p> On each ASBR supporting the g-shut procedure, set-up
	    an out-filter applied on all iBGP sessions of the ASBR,
	    that :
</p>
<ul class="text">
<li> sets the local-pref of the paths tagged with the
	      g-shut community to a low value
</li>
<li> removes the g-shut community from the paths.
</li>
<li> optionally, adds an AS specific g-shut community on
	      these paths to indicate that these are to be withdrawn
	      soon.  If some ingress ASBRs reset the local preference
	      attribute, this AS specific g-shut community will be
	      used to override other local preference changes.
</li>
</ul>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.3.2"></a><h3>4.2.3.2.&nbsp;
Operations at maintenance time</h3>

<p> On the g-shut initiator : 
</p>
<ul class="text">
<li>Apply an out-filter on the maintained eBGP session to tag
       the paths propagated over the session with the g-shut
       community.
</li>
<li>Apply an in-filter on the maintained eBGP session to tag the
       paths received over the session with the g-shut community. 
</li>
<li>Wait for convergence to happen.
</li>
<li>Perform a BGP session shutdown. 
</li>
</ul>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.4"></a><h3>4.2.4.&nbsp;
BGP implementation support for G-Shut</h3>

<p>A BGP router implementation MAY provide features aimed at
   automating the application of the graceful shutdown procedures
   described above.
</p>
<p>Upon a session shutdown specified as to be graceful by the
   operator, a BGP implementation supporting a g-shut feature would
   
</p>
<p>

     </p>
<ol class="text">
<li>Update all the paths propagated over the corresponding eBGP
       session, tagging the GSHUT community to them. Any subsequent
       update sent to the session being gracefully shut down would be
       tagged with the GSHUT community.
       
</li>
<li>Lower the local preference value of the paths received over
       the eBGP session being shut down, upon their propagation over
       iBGP sessions. Optionally, also tag these paths with an AS
       specific g-shut community. Note that alternatively, the local
       preference of the paths received over the eBGP session can be
       lowered on the g-shut initiator itself, instead of only when
       propagating over its iBGP sessions. This simplified behavior
       can lead to some LoC, as described in <a class='info' href='#sec.loc-pref.infilter'>Appendix&nbsp;A.1<span> (</span><span class='info'>In-filter reconfiguration</span><span>)</span></a>, if not used in conjunction
       with <a class='info' href='#BestExternal'>[BestExternal]<span> (</span><span class='info'>Marques, P., Fernando, R., Chen, E., and P. Mohapatra, &ldquo;Advertisement of the best-external route to IBGP,&rdquo; May&nbsp;2009.</span><span>)</span></a>.
</li>
<li>Optionally shut down the session after a configured
       time.
</li>
<li>Prevent the GSHUT community from being inherited by a path
       that would aggregate some paths tagged with the GSHUT
       community. This behavior avoids the GSHUT procedure to be
       applied to the aggregate upon the graceful shutdown of one of
       its covered prefixes.
</li>
</ol><p>
   
</p>
<p>

   
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Graceful shutdown procedures for iBGP sessions</h3>

<p>If the iBGP topology is viable after the
		maintenance of the session, i.e, if all BGP speakers
		of the AS have an iBGP signaling path for all prefixes
		advertised on this g-shut iBGP session, then the
		shutdown of an iBGP session does not lead to transient
		unreachability. 
</p>
<p>However, in the case of a shutdown of a router, a
		reconfiguration of the out-filters of the g-shut
		initiator MAY be performed to set a low local-pref
		value for the paths originated by the g-shut initiator
		(e.g, BGP aggregates redistributed from other
		protocols, including static routes).
</p>
<p>This behavior is equivalent to the recommended
		behavior for paths "redistributed" from eBGP sessions
		to iBGP sessions in the case of the shutdown of an
		ASBR. 
</p>
<a name="sec.forwarding"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Forwarding modes and forwarding loops</h3>

<p>If the AS applying the solution does not rely on
	encapsulation to forward packets from the Ingress Border
	Router to the Egress Border Router, then transient forwarding
	loops and consequent packet losses can occur during the
	convergence process, even if the procedure described above is
	applied. Hence if zero LoC is required, encapsulation is
	required between ASBRs of the AS.
	
</p>
<p> Using the out-filter reconfiguration avoids the forwarding
	loops between the g-shut initiator and its directly connected
	upstream neighboring routers. Indeed, when this reconfiguration is
	applied, the g-shut initiator keeps using its own external
	path and lets the upstream routers converge to the alternate
	ones. During this phase, no forwarding loops can occur between
	the g-shut initiator and its upstream neighbors as the g-shut
	initiator keeps using the affected paths via its eBGP peering
	links. When all the upstream routers have switched to
	alternate paths, the transition performed by the g-shut
	initiator when the session is actually shut down, will be
	loopfree.  Transient forwarding loops between other routers
	will not be avoided with this procedure. 
</p>
<a name="sec.policies"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Dealing with Internet policies</h3>

<p>A side gain of the maintenance solution is that it can also
	reduce the churn implied by a shutdown of an eBGP session.
</p>
<p>For this, it is recommended to apply the filters modifying
	the local-pref value of the paths to values strictly lower but
	as close as possible to the local-pref values of the
	post-convergence paths.  
</p>
<p> For example, if an eBGP link is shut down between a
	provider and one of its customers, and another link
	with this customer remains active, then the value of the
	local-pref of the old paths SHOULD be decreased to the
	smallest possible value of the 'customer' local_pref range,
	minus 1.  Thus, routers will not transiently switch to paths
	received from shared-cost peers or providers, which could lead
	to the propagation of withdraw messages over eBGP sessions with
	shared-cost peers and providers.
</p>
<p> Proceeding like this reduces both BGP churn and traffic
	shifting as routers will less likely switch to transient
	paths.
</p>
<p> In the above example, it also prevents transient
	unreachabilities in the neighboring AS that are due to the
	sending of "abrupt" withdraw messages to shared-cost peers and
	providers.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Link Up cases</h3>

<p>We identify two potential causes for transient packet losses upon
  an eBGP link up event. The first one is local to the g-no-shut initiator,
  the second one is due to the BGP convergence following the injection of new
  best paths within the iBGP topology. 
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Unreachability local to the ASBR</h3>

<p>An ASBR that selects as best a path received over a newly
    brought up eBGP session may transiently drop traffic. This can
    typically happen when the nexthop attribute differs from the IP
    address of the eBGP peer, and the receiving ASBR has not yet
    resolved the MAC address associated with the IP address of that
    "third party" nexthop. 
</p>
<p>A BGP speaker implementation could avoid such losses by
    ensuring that "third party" nexthops are resolved before
    installing paths using these in the RIB.
</p>
<p>If the link up event corresponds to an eBGP session that is being manually
    brought up, over an already up multi-access link, then the
    operator can ping third party nexthops that are expected to be
    used before actually bringing the session up, or ping directed
    broadcast the subnet IP address of the link. By proceeding like
    this, the MAC addresses associated with these third party nexthops
    will be resolved by the g-no-shut initiator.
    
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
iBGP convergence</h3>

<p> Similar corner cases as described in <a class='info' href='#sec.loc-pref.infilter'>Appendix&nbsp;A.1<span> (</span><span class='info'>In-filter reconfiguration</span><span>)</span></a> for the link down case, can occur
    during an eBGP link up event.
</p>
<p>A typical example for such transient unreachability for a given
    prefix is the following :
</p>
<p></p>
<blockquote class="text">
<p>1. A Route Reflector, RR1, is initially advertising the
	  current best path to the members of its iBGP RR
	  full-mesh. It propagated that path within its RR
	  full-mesh. Another route reflector of the full-mesh, RR2,
	  knows only that path towards the prefix.
	  
</p>
<p>2. A third Route Reflector of the RR full-mesh, RR3
	  receives a new best path orginated by the "g-no-shut"
	  initiator, being one of its RR clients. RR3 selects it as
	  best, and propagates an UPDATE within its RR full-mesh,
	  i.e., to RR1 and RR2.
	  
</p>
<p>3. RR1 receives that path, reruns its decision process,
	  and picks this new path as best. As a result, RR1 withdraws
	  its previously announced best-path on the iBGP sessions of its RR full-mesh.
	  
</p>
<p>4. If, for any reason, RR3 processes the withdraw
	  generated in step 3, before processing the update generated
	  in step 2, RR3 transiently suffers from unreachability for
	  the affected prefix. 
</p>
</blockquote><p>
	
</p>
<p> The use of <a class='info' href='#BestExternal'>[BestExternal]<span> (</span><span class='info'>Marques, P., Fernando, R., Chen, E., and P. Mohapatra, &ldquo;Advertisement of the best-external route to IBGP,&rdquo; May&nbsp;2009.</span><span>)</span></a> among the RR of
	the iBGP full-mesh can solve these corner cases by ensuring
	that within an AS, the advertisement of a new route is not
	translated into the withdraw of a former route.
</p>
<p> Indeed, "best-external" ensures that an ASBR does not
	withdraw a previously advertised (eBGP) path when it receives
	an additional, preferred path over an iBGP session. Also,
	"best-intra-cluster" ensures that a RR does not withdraw a
	previously advertised (iBGP) path to its non clients
	(e.g. other RRs in a mesh of RR) when it receives a new,
	preferred path over an iBGP session.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA considerations</h3>

<p>Applying the g-shut procedure is rendered much easier with a
reserved g-shut community value.  The community value 0xFFFF0000 has been reserved
from the FCFS community pool for this purpose. 
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Security Considerations</h3>

<p> By providing the g-shut service to a neighboring AS, an ISP provides
	means to this neighbor to lower the local-pref value assigned to the paths received
	from this neighbor. 
</p>
<p> The neighbor could abuse the technique and do inbound traffic
	engineering by declaring some prefixes as undergoing a maintenance so as to
	switch traffic to another peering link.
</p>
<p>If this behavior is not tolerated by the ISP, it SHOULD monitor the use
	of the g-shut community by this neighbor.
</p>
<p>ASes which support the g-shut procedure SHOULD remove the
	community value(s) that they use for g-shut from the paths
	received from neighboring ASes that do not support the
	procedure or to whom the service is not provided. Doing so
	prevents malignant ASes from using the community through
	intermediate ASes that do not support the feature, in order to
	perform inbound traffic engineering.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgments</h3>

<p>The authors wish to thank Olivier Bonaventure and Pradosh Mohapatra
for their useful comments on this work.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.&nbsp;References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="AddPath">[AddPath]</a></td>
<td class="author-text">D. Walton, A. Retana, and E. Chen, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-walton-bgp-add-paths-06.txt.txt">Advertisement of Multiple Paths in BGP</a>,&rdquo; draft-walton-bgp-add-paths-06.txt (work in progress).</td></tr>
<tr><td class="author-text" valign="top"><a name="BestExternal">[BestExternal]</a></td>
<td class="author-text">Marques, P., Fernando, R., Chen, E., and P. Mohapatra, &ldquo;Advertisement of the best-external route to IBGP,&rdquo; &nbsp;draft-ietf-idr-best-external-00.txt, May&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="REQS">[REQS]</a></td>
<td class="author-text">Decraene, B., Francois, P., Pelsser, C., Ahmad, Z., Armengol, A., and T. Takeda, &ldquo;Requirements for the graceful shutdown of BGP sessions,&rdquo; &nbsp;draft-ietf-grow-bgp-graceful-shutdown-requirements-06.txt, October&nbsp;2010.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4360">[RFC4360]</a></td>
<td class="author-text">Sangli, S., Tappan, D., and Y. Rekhter, &ldquo;<a href="http://tools.ietf.org/html/rfc4360">BGP Extended Communities Attribute</a>,&rdquo; RFC&nbsp;4360, February&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4360.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="Clarification4360">[Clarification4360]</a></td>
<td class="author-text">Decraene, B., Vanbever, L., and P. Francois, &ldquo;RFC 4360 Clarification Request,&rdquo; &nbsp;draft-decraene-idr-rfc4360-clarification-00, October&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="BGPWKC">[BGPWKC]</a></td>
<td class="author-text">&ldquo;http://www.iana.org/assignments/bgp-well-known-communities.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Alternative techniques with limited applicability</h3>

<p>A few alternative techniques have been considered to provide
  g-shut capabilities but have been rejected due to their limited
  applicability.  This section describe them for possible
  reference.
</p>
<a name="sec.loc-pref.infilter"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
In-filter reconfiguration</h3>

<p>An In-filter reconfiguration on the eBGP session undergoing the
    maintenance could be performed instead of out-filter
    reconfigurations on the iBGP sessions of the g-shut initiator.
</p>
<p>Upon the application of the maintenance procedure, if the
    g-shut initiator has an alternate path in its Adj-Rib-In, it will
    switch to it directly.
</p>
<p>If this new path was advertised by an eBGP neighbor of the
    g-shut initiator, the g-shut initiator will send a BGP Path Update
    message advertising the new path over its iBGP and eBGP sessions.
</p>
<p>If this new path was received over an iBGP session, the g-shut
    initiator will select that path and withdraw the previously
    advertised path over its non-client iBGP sessions. There can be
    iBGP topologies where the iBGP peers of the g-shut initiator do
    not know an alternate path, and hence may drop traffic.
</p>
<p> Also, applying an In-filter reconfiguration on the eBGP
    session undergoing the maintenance may lead to transient LoC, in
    full-mesh iBGP topologies if 
</p>
<p>
		</p>
<blockquote class="text">
<p> a. An ASBR of the
					initiator AS, ASBR1 did not
					initially select its own
					external path as best, and
					
</p>
<p> 
</p>
<p> b. An ASBR of the
					initiator AS, ASBR2 advertises
					a new path along its
					iBGP sessions upon the
					reception of ASBR1's update
					following the in-filter
					reconfiguration on the g-shut
					initiator, and
</p>
<p> 
</p>
<p> c. ASBR1 receives the
					update message, runs its
					Decision Process and hence
					withdraws its
					external path after having
					selected ASBR2's path as best,
					and
</p>
<p> 
</p>
<p> d. An impacted router of the AS processes the
					withdraw of ASBR1 before processing
					the update from ASBR2.
</p>
</blockquote><p>
			
</p>
<p> Applying a reconfiguration of the out-filters prevents
	such transient unreachabilities.
</p>
<p> Indeed, when the g-shut initiator propagates an update of
	the old path first, the withdraw from ASBR2 does not trigger
	unreachability in other nodes, as the old path is still
	available. Indeed, even though it receives alternate paths,
	the g-shut initiator keeps using its old path as best as the
	in-filter of the maintained eBGP session has not been modified
	yet. 
</p>
<p> Applying the out-filter reconfiguration also prevents
	packet loops between the g-shut initiator and its direct
	neighbors when encapsulation is not used between the ASBRs of
	the AS.
</p>
<p>Note that applying this simplified procedure in conjunction
	with <a class='info' href='#BestExternal'>[BestExternal]<span> (</span><span class='info'>Marques, P., Fernando, R., Chen, E., and P. Mohapatra, &ldquo;Advertisement of the best-external route to IBGP,&rdquo; May&nbsp;2009.</span><span>)</span></a> does not lead to LoC.
</p>
<a name="sec.med-poison"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Multi Exit Discriminator tweaking</h3>

<p> The MED attribute of the paths to be avoided can be increased
    so as to force the routers in the neighboring AS to select other
    paths. 
</p>
<p> The solution only works if the alternate paths are as good as
    the initial ones with respect to the Local-Pref value and the AS
    Path Length value.  In the other cases, increasing the MED value
    will not have an impact on the decision process of the routers in
    the neighboring AS.  
</p>
<a name="sec.igp-poison"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
IGP distance Poisoning</h3>

<p> The distance to the BGP nexthop corresponding to the
    maintained session can be increased in the IGP so that the old
    paths will be less preferred during the application of the IGP
    distance tie-break rule. However, this solution only works for the
    paths whose alternates are as good as the old paths with respect
    to their Local-Pref value, their AS Path length, and their MED
    value.
</p>
<p> Also, this poisoning cannot be applied when nexthop self is
    used as there is no nexthop specific to the maintained session to
    poison in the IGP.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Pierre Francois</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Universite catholique de Louvain</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Place Ste Barbe, 2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Louvain-la-Neuve  1348</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">BE</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:pierre.francois@uclouvain.be">pierre.francois@uclouvain.be</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://inl.info.ucl.ac.be/pfr">http://inl.info.ucl.ac.be/pfr</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bruno Decraene</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France Telecom</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">38-40 rue du General Leclerc</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">92794 Issi Moulineaux cedex 9  </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">FR</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:bruno.decraene@orange-ftgroup.com">bruno.decraene@orange-ftgroup.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cristel Pelsser</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Internet Initiative Japan</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jinbocho Mitsui Bldg.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1-105 Kanda Jinbo-cho</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tokyo  101-0051</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">JP</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:pelsser.cristel@iij.ad.jp">pelsser.cristel@iij.ad.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Keyur Patel</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">170 West Tasman Dr</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, CA  95134</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:keyupate@cisco.com">keyupate@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Clarence Filsfils</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">De kleetlaan 6a</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Diegem  1831</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">BE</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:cfilsfil@cisco.com">cfilsfil@cisco.com</a></td></tr>
</table>
</body></html>
