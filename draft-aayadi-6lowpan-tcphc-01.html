<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>TCP header compression for 6LoWPAN</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="TCP header compression for 6LoWPAN">
<meta name="keywords" content="6LoWPAN, TCP, Header Compression">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">A. Ayadi</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">D. Ros</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">L. Toutain</td></tr>
<tr><td class="header">Expires: April 28, 2011</td><td class="header">Telecom Bretagne</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 25, 2010</td></tr>
</table></td></tr></table>
<h1><br />TCP header compression for 6LoWPAN<br />draft-aayadi-6lowpan-tcphc-01</h1>

<h3>Abstract</h3>

<p>
   This document describes LOWPAN_TCPHC, a scheme for compressing the header of Transmission
   Control Protocol (TCP) 
   segments, in order to reduce the overhead on low-power and lossy  networks. It also
   specifies the LOWPAN_TCPHC header fields for the transmission of TCP
   segments over IPv6 for Low-power Wireless Personal Area Networks (6LoWPAN).
   In many cases, the 20 bytes of the mandatory TCP header can be compressed into as little as 6 bytes.

</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on April 28, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Related Work">1.1.</a>&nbsp;
Related Work<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Terminology">1.2.</a>&nbsp;
Terminology<br />
<a href="#Protocol Overview">2.</a>&nbsp;
Protocol Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#TCP Connection Initiation">2.1.</a>&nbsp;
Connection Initiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#The LoWPAN_TCPHC context">2.2.</a>&nbsp;
The LoWPAN_TCPHC context<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#The LoWPAN_TCPHC context structure">2.2.1.</a>&nbsp;
LoWPAN_TCPHC context structure<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#The_CID_Management">2.2.2.</a>&nbsp;
Context management<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Loss_Detection_Retransmissions">2.3.</a>&nbsp;
Loss detection and retransmissions<br />
<a href="#TCP">3.</a>&nbsp;
Transmission Control Protocol<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#TCP header fields">3.1.</a>&nbsp;
TCP headers fields<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Options">3.2.</a>&nbsp;
TCP Header Options<br />
<a href="#tcp_header_compression">4.</a>&nbsp;
TCP header fields compression<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tcp_port_compression">4.1.</a>&nbsp;
TCP ports<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tcp_flags_compression">4.2.</a>&nbsp;
Flags<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#seq_ack_compression">4.3.</a>&nbsp;
Sequence and Acknowledgment numbers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tcp_win_compression">4.4.</a>&nbsp;
Window<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tcp_urgent_compression">4.5.</a>&nbsp;
Urgent Pointer<br />
<a href="#tcp_new_format">5.</a>&nbsp;
LOWPAN_TCPHC Packet Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#TCP segment types">5.1.</a>&nbsp;
TCP segments types<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#LOWPAN_TCPHC Format">5.2.</a>&nbsp;
LOWPAN_TCPHC Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#TCP header ">5.3.</a>&nbsp;
Examples of compressed TCP headers<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Compressed header">5.3.1.</a>&nbsp;
Compressed header<br />
<a href="#anchor1">6.</a>&nbsp;
TCP Option Compression<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">6.1.</a>&nbsp;
Selective Acknowledgment option<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">6.2.</a>&nbsp;
Timestamp option<br />
<a href="#anchor4">7.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
The 6LoWPAN Working Group <a class='info' href='#RFC4919'>[RFC4919]<span> (</span><span class='info'>Kushalnagar, N., Montenegro, G., and C. Schumacher, &ldquo;IPv6 over Low-Power Wireless Personal Area Networks (6LoWPANs): Overview, Assumptions, Problem Statement, and Goals,&rdquo; August&nbsp;2007.</span><span>)</span></a> has proposed
LOWPAN_IPHC <a class='info' href='#I-D.ietf-6lowpan-hc'>[I&#8209;D.ietf&#8209;6lowpan&#8209;hc]<span> (</span><span class='info'>Hui, J. and P. Thubert, &ldquo;Compression Format for IPv6 Datagrams in 6LoWPAN Networks,&rdquo; October&nbsp;2009.</span><span>)</span></a>, a new version of
the LOWPAN_HC1 header compression mechanism <a class='info' href='#RFC4944'>[RFC4944]<span> (</span><span class='info'>Montenegro, G., Kushalnagar, N., Hui, J., and D. Culler, &ldquo;Transmission of IPv6 Packets over IEEE 802.15.4 Networks,&rdquo; September&nbsp;2007.</span><span>)</span></a>
which reduces the IPv6 header to about 3-5 bytes.
In <a class='info' href='#I-D.ietf-6lowpan-hc'>[I&#8209;D.ietf&#8209;6lowpan&#8209;hc]<span> (</span><span class='info'>Hui, J. and P. Thubert, &ldquo;Compression Format for IPv6 Datagrams in 6LoWPAN Networks,&rdquo; October&nbsp;2009.</span><span>)</span></a>, a header-compression
method for the transport layer (LOWPAN_NHC) has also been introduced,
however, only a UDP <a class='info' href='#RFC0768'>[RFC0768]<span> (</span><span class='info'>Postel, J., &ldquo;User Datagram Protocol,&rdquo; August&nbsp;1980.</span><span>)</span></a> datagram compression
mechanism is specified.

</p>
<p>
   UDP header compression is useful for 6LoWPAN because many Low-power
   and Lossy Network (LLN) applications are fault-tolerant and do not
   require 100% reliability. However, other applications and services
   such as SSH and HTTP require a reliable service from the transport
   layer that cannot be offered by UDP. Moreover, some usage scenarios
   of LLNs, such as health, military and security applications, impose
   strong reliability constraints. Also, in some usage cases (e.g.,
   sending a software update to a wireless node, or sending a query
   requesting a specific information from the wireless node) there is
   a need for a reliable data transport.

</p>
<p>
   In this document, we focus on the Transmission Control Protocol (TCP)
   <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>, which carries most of the traffic
   in IP networks.
   TCP is a connection-oriented, end-to-end reliable transport protocol.
   To ensure end-to-end reliability, TCP must recover from
   packet corruption, loss or  out-of-order delivery.
   This is achieved by assigning a sequence number to each transmitted
   byte (done by the TCP source), by requiring a positive acknowledgment
   (ACK) from the TCP destination, and by retransmitting lost or
   corrupted packets.

</p>
<p>
   In the context of 6LoWPAN networks, the size of TCP headers may
   induce a large overhead, especially for link-layer technologies that
   use small frames. For instance, a pure TCP acknowledgment (i.e., a
   TCP ACK carrying no data) without any TCP options represents 25% of
   the payload of an IEEE 802.15.4 typically <a class='info' href='#IEEE 802.15.4'>[IEEE 802.15.4]<span> (</span><span class='info'>IEEE Computer Society, &ldquo;IEEE Std. 802.15.4-2006,&rdquo; October&nbsp;2006.</span><span>)</span></a>
   MAC frame.
   In addition, TCP pure ACKs represent roughly 33% of the total number
   of segments exchanged in a TCP session (this figure may go up to
   roughly 50% if the Delayed ACK mechanism <a class='info' href='#RFC1122'>[RFC1122]<span> (</span><span class='info'>Braden, R., &ldquo;Requirements for Internet Hosts - Communication Layers,&rdquo; October&nbsp;1989.</span><span>)</span></a>
   is not used).
   This suggests that the use of header-compression mechanisms for TCP
   may result in important performance gains, in terms of used bandwidth
   and/or energy spent for frame transmission.

</p>
<p>
   A TCP header compression algorithm for 6LoWPAN should respect some requirements: (a)
   Efficiency (the scheme must provide low overhead in all cases), (b)
   Transparency (the resulting header after a compression and decompression
   should be identical to the original header), (c)
   Reordering tolerance (the scheme should be able to decompress
   compressed segments correctly even when segments arrive with a
   moderate reordering).

</p>
<p>
   The goal of this document is thus to define a TCP header compression
   scheme for 6LoWPAN, called LOWPAN_TCPHC, which
   allows to significantly reduce the TCP overhead.
   The TCP header compression and decompression is performed in the edge router
   between the 6LoWPAN and the external IP network.
   The compression scheme can also be used between two 6LoWPAN nodes for 
   machine-to-machine communications.
   This document defines also an encoding format for LOWPAN_TCPHC header
   compression.
   Such mechanism and packet format aims at making TCP a more viable
   proposition for 6LoWPAN networks.
   Moreover, the LOWPAN_TCPHC mechanism can be used with LOWPAN_IPHC
   <a class='info' href='#I-D.ietf-6lowpan-hc'>[I&#8209;D.ietf&#8209;6lowpan&#8209;hc]<span> (</span><span class='info'>Hui, J. and P. Thubert, &ldquo;Compression Format for IPv6 Datagrams in 6LoWPAN Networks,&rdquo; October&nbsp;2009.</span><span>)</span></a> and thus reduce all header
   overheads to about seven to ten bytes instead of 60 bytes.

</p>
<p>
   The proposed scheme does not compress TCP control messages at
   the connection establishment phase.
   Those TCP segments are used to exchange a context identifier.
   Such context identifier replaces the port numbers in subsequent TCP
   segments, as a means of identifying a given TCP session.

   Some TCP options, such as Timestamp <a class='info' href='#RFC2018'>[RFC2018]<span> (</span><span class='info'>Mathis, M., Mahdavi, J., Floyd, S., and A. Romanow, &ldquo;TCP Selective Acknowledgment Options,&rdquo; October&nbsp;1996.</span><span>)</span></a>
   and SACK <a class='info' href='#RFC1323'>[RFC1323]<span> (</span><span class='info'>Jacobson, V., Braden, B., and D. Borman, &ldquo;TCP Extensions for High Performance,&rdquo; May&nbsp;1992.</span><span>)</span></a> <a class='info' href='#RFC2883'>[RFC2883]<span> (</span><span class='info'>Floyd, S., Mahdavi, J., Mathis, M., and M. Podolsky, &ldquo;An Extension to the Selective Acknowledgment (SACK) Option for TCP,&rdquo; July&nbsp;2000.</span><span>)</span></a>,
   are supported (i.e., compressed) by the mechanism, while other options,
   unlikely to be required/used in 6LoWPANs, are omitted.

</p>
<a name="Related Work"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Related Work</h3>

<p>
   This section presents prior work on TCP/IP header compression.
   In particular, we will briefly describe three existing TCP header
   compression algorithms. A more detailed discussion of these algorithms
   can be found in <a class='info' href='#RFC4996'>[RFC4996]<span> (</span><span class='info'>Pelletier, G., Sandlund, K., Jonsson, L-E., and M. West, &ldquo;RObust Header Compression (ROHC): A Profile for TCP/IP (ROHC-TCP),&rdquo; July&nbsp;2007.</span><span>)</span></a>.



</p>
<p>
   One of the first TCP/IP header compression methods was Compressed TCP
   (CTCP), proposed by Jacobson <a class='info' href='#RFC1144'>[RFC1144]<span> (</span><span class='info'>Jacobson, V., &ldquo;Compressing TCP/IP headers for low-speed serial links,&rdquo; February&nbsp;1990.</span><span>)</span></a>.
   Jacobson's header compression algorithm distinguishes between dynamic
   fields and static fields. The static fields (e.g., source address,
   source port, ...) are sent in two situations: when initiating
   a connection, and when refreshing the context after a loss of
   synchronization.
   CTCP proposes to send the difference between the current and the previous value
   of dynamic fields (e.g., sequence number, acknowledgment number).
   When the synchronization is lost between the compressor and
   the decompressor, the TCP sender sends a segment with a regular
   header to refresh the context.
   Experimental studies <a class='info' href='#Perkins et al.'>[Perkins et al.]<span> (</span><span class='info'>Perkins, S. and M. Multa, &ldquo;Dependency removal for transport protocol header compression over noisy channels,&rdquo; June&nbsp;1997.</span><span>)</span></a>
   <a class='info' href='#Srivastava et al.'>[Srivastava et al.]<span> (</span><span class='info'>Srivastava, A., Friday, R., Ritter, M., and W. San Filippo, &ldquo;A study of TCP performance over wireless data networks,&rdquo; May&nbsp;2001.</span><span>)</span></a> <a class='info' href='#Wang04'>[Wang04]<span> (</span><span class='info'>Wang, R., &ldquo;An experimental study of TCP/IP's Van Jacobson header compression 	   behavior in lossy space environment,&rdquo; September&nbsp;2004.</span><span>)</span></a>
   have shown that the performance of Jacobson's algorithm may degrade
   significantly in noisy/lossy network environments.
   An important disadvantage of CTCP is that it does not support
   TCP options, some of which are ubiquitous nowadays <a class='info' href='#Medina05'>[Medina05]<span> (</span><span class='info'>Medina, A., Allman, M., and S. Floyd, &ldquo;Measuring the Evolution of Transport Protocols in the Internet,&rdquo; April&nbsp;2005.</span><span>)</span></a>.

</p>
<p>
   IPHC <a class='info' href='#RFC2507'>[RFC2507]<span> (</span><span class='info'>Degermark, M., Nordgren, B., and S. Pink, &ldquo;IP Header Compression,&rdquo; February&nbsp;1999.</span><span>)</span></a> enhances Jacobson's TCP header
   compression by introducing a mechanism, called TWICE, to repair
   incorrectly-decompressed headers. TWICE is most efficient when
   applied to data-carrying TCP segments. <a class='info' href='#RFC2507'>[RFC2507]<span> (</span><span class='info'>Degermark, M., Nordgren, B., and S. Pink, &ldquo;IP Header Compression,&rdquo; February&nbsp;1999.</span><span>)</span></a>
   also describes a mechanism for explicitly requesting the transmission
   of less-compressed or uncompressed headers. such mechanism is
   especially suited for pure TCP acknowledgments.
   Note however that IPHC does not actually provide a compression method
   for TCP options; changing option fields are carried in compressed
   headers, but without any compression.
   Also, the header request mechanism may be unsuited for lossy
   6LoWPAN networks, which low bit rates and strong energy constraints
   are at odds with any additional signaling overhead.
   LoWPAN_TCPHC enhances IPHC by defining an adapted header compression
   of TCP for LLNs by sending lest significant bytes instead of sending
   a delta value.
   Moreover, LoWPAN_TCPHC completes IPHC by defining
   header compression schemes for the mostly used TCP options.



</p>
<p>
  ROHC-TCP <a class='info' href='#RFC4996'>[RFC4996]<span> (</span><span class='info'>Pelletier, G., Sandlund, K., Jonsson, L-E., and M. West, &ldquo;RObust Header Compression (ROHC): A Profile for TCP/IP (ROHC-TCP),&rdquo; July&nbsp;2007.</span><span>)</span></a> improves on <a class='info' href='#RFC2507'>[RFC2507]<span> (</span><span class='info'>Degermark, M., Nordgren, B., and S. Pink, &ldquo;IP Header Compression,&rdquo; February&nbsp;1999.</span><span>)</span></a>
  by providing a new method for compressing all TCP header fields,
  including the TCP options. ROHC-TCP proposes also to start compressing
  packets starting from the SYN segments, using parameters from previous
  or simultaneous connections. This may offer noticeable improvements in
  performance when most TCP flows are short-lived, i.e., composed of a
  small number of data segments. Nevertheless, the ROHC-TCP algorithm
  is fairly complex and its memory requirements may not be met by small,
  constrained devices.

</p>
<p>
    The algorithm described in this document, LOWPAN_TCPHC, supports
    features like the compression of TCP options and FIN segments,
    and at the same time it is relatively simple and easy to implement
    in memory- and CPU-constrained devices.


</p>
<a name="Terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.

</p>
<p>
   This section defines general terms related to 
   TCP/IPv6 header compression <a class='info' href='#RFC2507'>[RFC2507]<span> (</span><span class='info'>Degermark, M., Nordgren, B., and S. Pink, &ldquo;IP Header Compression,&rdquo; February&nbsp;1999.</span><span>)</span></a> <a class='info' href='#RFC4995'>[RFC4995]<span> (</span><span class='info'>Jonsson, L-E., Pelletier, G., and K. Sandlund, &ldquo;The RObust Header Compression (ROHC) Framework,&rdquo; July&nbsp;2007.</span><span>)</span></a> and to the
   6LoWPAN architecture <a class='info' href='#RFC4919'>[RFC4919]<span> (</span><span class='info'>Kushalnagar, N., Montenegro, G., and C. Schumacher, &ldquo;IPv6 over Low-Power Wireless Personal Area Networks (6LoWPANs): Overview, Assumptions, Problem Statement, and Goals,&rdquo; August&nbsp;2007.</span><span>)</span></a> used in this specification.

</p>
<p> </p>
<ul class="text">
<li> Subheader: An IPv6 header, a UDP header, or a TCP header.
</li>
<li> Header: A chain of subheaders.
</li>
<li> Compression: The act of reducing the size of a header
      by either removing or reducing the size of  header
      fields.
      This is done in a way such that a decompressor can reconstruct
      the header if its context state is identical to the
      context state used when compressing the header.
</li>
<li> Decompression: The act of reconstructing a compressed header.
</li>
<li> Static fields: These fields are expected to be constant
      throughout the lifetime of the TCP connection. Static information must
      be communicated once in some way.
</li>
<li> Dynamic fields: These fields are expected to vary between
      different TCP segments, either randomly within a limited range or
      in some other manner.
</li>
<li> Context identifier (CID): A small unique number identifying
      the context that should be used to decompress a compressed header.
      Carried in full headers and compressed headers.
</li>
<li> Context: The state used by the compressor to compress a header, and by the
      decompressor  to decompress a header.
	  The context is given by the uncompressed version of
      the last header sent (compressor) or received (decompressor) over the link, except
      for fields in the header that are included "as-is" in compressed headers, or that
	  can be inferred from e.g. the size of the link-layer frame.
</li>
<li> Full header: An uncompressed header that updates or refreshes the context for a
      packet stream. It carries a CID that will be used to identify the context.
</li>
<li> Regular header: A normal, uncompressed header. It does not carry any CID.

      
</li>
<li> Compressed header: A header in which all the static fields are elided, and
	  all the dynamic fields are sent compressed.
</li>
<li> Incorrect decompression: When a decompressed header does not match
	  the corresponding original, uncompressed header.
	  Usually due to mismatching contexts between the compressor and
      decompressor, caused by e.g. bit errors during the transmission of
	  the compressed header, or by packet loss.
</li>
<li> IEEE 802.15.4: A low-power, low-bandwidth link layer protocol.

      
</li>
<li> LoWPAN host: A node that only sources or sinks IPv6 datagrams.
      Referred to as a host in this document.
</li>
<li> LoWPAN router: A node that forwards datagrams between arbitrary
      source-destination pairs using a single 6LoWPAN interface,
      performing IP routing on that interface.
</li>
<li> LoWPAN edge router (ER): An IPv6 router that interconnects the 6LoWPAN to
      another IP network. Referred to as an Edge Router in this document.
</li>
<li> LoWPAN node: A node that composes a 6LoWPAN, referring to both hosts and
      routers. Simply called a Node in this document.
</li>
</ul><p> 
</p>
<a name="Protocol Overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Protocol Overview</h3>

<p>      
   This section gives an overview of the TCP header compression mechanism for
   6LoWPAN (LOWPAN_TCPHC). The  main purpose of LOWPAN_TCPHC is to reduce
   the protocol header overhead, with the intent of reducing both
   bandwidth usage and energy consumption due to packet transmissions.
   
</p>
<p> 
   Indeed, the LOWPAN_TCPHC allows establishing TCP connections between
   an external IP host and a LoWPAN host, and also between two LoWPAN hosts.
   This former type of connection is performed by an Edge Router (ER)
   which links the 6LoWPAN to an external IPv6-based network.
   <a class='info' href='#A 6LoWPAN network'>Figure&nbsp;1<span> (</span><span class='info'>A 6LoWPAN network</span><span>)</span></a> shows a typical 6LoWPAN topology
   with which two edge router create a bridge between the LoWPAN network and
   the external IP network. The path between a LoWPAN node to the external 
   network may change following the movement of the node or the update of 
   routing tables.
   
</p><br /><hr class="insert" />
<a name="A 6LoWPAN network"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                        |                  *  *
                        |                 *  *  *
                        |    +--------+  *  *  *  *
                        |____|  Edge  | *  *  *  *  *
                        |    | Router | *  *  *  *  *
                        |    +--------+  *  *  *  *
                        |                 *  *  *
 External IP Network -- |                  *  *  *
                        |                 *  *  *
                        |    +--------+  *  *  *  *
                        |____|  Edge  | *  *  *  *  *
                        |    | Router | *  *  *  *  *
                        |    +--------+  *  *  *  *
                        |                 *  *  *
                        |                  *  *
 *: LoWPAN Node
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: A 6LoWPAN network&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
   The compression and decompression mechanisms are implemented on
   the edge routers and on the LoWPAN hosts.
   The ERs create and maintain the contexts of all TCP connections.
   <a class='info' href='#Connection initiation by outside host'>Figure&nbsp;2<span> (</span><span class='info'>TCP Connection initiated by an external IP-host</span><span>)</span></a> and
   <a class='info' href='#Connection initiation by inside host'>Figure&nbsp;3<span> (</span><span class='info'>TCP Connection initiated by a LoWPAN host</span><span>)</span></a> show
   sequence diagrams of a connection establishment between a LoWPAN
   host and an external IP host.
   The external IP host sends and receives regular TCP segments,
   whereas the LoWPAN host sends and receives segments with compressed
   headers or full headers.
   
</p>
<p>
   The LOWPAN_TCPHC algorithm does not compress TCP control messages at
   the connection establishment phase.
   These segments are used to exchange the context identifier (CID) and allow the
   ER to create a context using the TCP header fields.
   The LOWPAN_TCPHC algorithm supports usefull TCP option for LLNs.
   Supported TCP options that are negotiated in the two first messages are sent
   in a full header format. Whereas, the remaining supported options are sent
   compressed with in the TCP segments.
   The LOWPAN_TCPHC algorithm defines a compression mechanism for TCP SACK and
   Timestamp options.
   
</p>
<p>
   The TCP connection may also be established between two LoWPAN hosts for
   Machine-to-Machine communications. In this case, the context should
   be shared between the two LoWPAN hosts.

   If a packet is dropped due to loss, then the mechanism refreshes the
   context by retransmitting lost segments using the mostly compressed header format.
   
</p>
<p>
   The compression protocol uses two different header formats.
   For the TCP opening phase and for error management, the TCP segments must
   be sent with a full header.
   These segments contain the Context Identifier (CID) which will be used to identify
   the connection during the transfer phase. The CID replaces
   the two port numbers, hence avoiding to send the port numbers
   in every packet.
   The CID value and its size are set by the LoWPAN host if the TCP connection
   is between a LoWPAN host and an external IP host.
   Otherwise (i.e., a TCP connection between two LoWPAN hosts), the CID
   value and its size are set by the LoWPAN host that has opened the connection.
   For the TCP connection between a LoWPAN host and an external IP host,
   the couple (CID, Ipv6 address) must be unique.
   
</p>
<p>
  

   The second kind of header is the compressed header in which all static
   fields are elided, and all dynamic fields are compressed.
   Depending on how they change with respect to the last sent segment,
   dynamic fields may be compressed fully (i.e., elided) or partially
   (i.e., only a portion of a field is sent, containing the bytes that
   have changed).
   
</p>
<p>
   The last kind of packet is sent when a packet is lost, corruption or
   reordering is detected by the TCP receiver.
   This segment is called mostly compressed header and contains dynamic
   fields with all bytes uncompressed, while its static fields are elided.
   This kind of segment should be sent after a loss of synchronization 
   between the compressor and the decompressor.
   
</p>
<a name="TCP Connection Initiation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Connection Initiation</h3>

<p>
   This section gives an overview of TCP connection initiation with
   LOWPAN_TCPHC.
   
</p><br /><hr class="insert" />
<a name="Connection initiation by outside host"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 External IP host          Edge Router                LoWPAN host
 |                              |                               |
 | --- SYN --&gt;                  |         --- SYN with CID=0--&gt; |
 | The LOWPAN host creates a context for the new TCP connection |
 |                                                              |
 |                              |       &lt;-- SYN/ACK with CID--- |
 | The ER creates a context using the received (CID, LoWPAN IPv6)  |
 |                              |                               |
 | &lt;-- SYN/ACK ---              |                               |
 | --- ACK --&gt;                  |          ---  ACK with CID --&gt;|
 |                              |                               |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: TCP Connection initiated by an external IP-host&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
   <a class='info' href='#Connection initiation by outside host'>Figure&nbsp;2<span> (</span><span class='info'>TCP Connection initiated by an external IP-host</span><span>)</span></a> shows an
   example of a connection initiation scenario started by an external IP
   host.
   In this scenario, an external host sends a SYN segment trying to
   establish a connection with a LoWPAN host.
   The SYN message can include options, some of which may be eliminated
   by the Edge Router (i.e., those options not supported by the
   LOWPAN_TCPHC mechanism).
   The ER sends the SYN segment in a full header message with a CID
   equal to zero.
   Upon the reception of the SYN segment, the LoWPAN node sends
   a SYN/ACK segment including a new CID, set to the smallest available
   CID value. The ER creates a new context with the received information
   from the SYN/ACK segment.
   
</p><br /><hr class="insert" />
<a name="Connection initiation by inside host"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 External IP host          Edge Router                LoWPAN host
 |                              |                               |
 |                              |           &lt;-- SYN with CID--- |
 |  The LOWPAN host creates a context and sends the SYN message |
 |                                                              |
 | &lt;-- SYN ---                  |                               |
 | The ER creates a context for the new TCP connection          |
 |                                                              |
 | --- SYN/ACK --&gt;              |      --- SYN/ACK with CID --&gt; |
 | &lt;-- ACK ---                  |          &lt;-- ACK with CID --- |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: TCP Connection initiated by a LoWPAN host&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
   <a class='info' href='#Connection initiation by inside host'>Figure&nbsp;3<span> (</span><span class='info'>TCP Connection initiated by a LoWPAN host</span><span>)</span></a> gives an
   example of a TCP connection initiated by a LoWPAN host.
   The first SYN segment is sent with the full header with a
   CID value equal to smallest available value of CIDs.

   Contrary to the first case, the ER creates a context upon the
   reception of the SYN message from the LoWPAN host.
   
</p><br /><hr class="insert" />
<a name="TCP/IPv6 connection between two LoWPAN hosts"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   LoWPAN host                                      LoWPAN host
   |                                                           |
   |                &lt;-- SYN with CID---                        |
   | The initiator LOWPAN Host creates a context for the new   |
   | TCP connection and then sends SYN segment                 |
   |                                                           |
   |                   --- SYN/ACK with CID---&gt;                |
   | The receiver creates a context using the initiator IID    |
   |                                                           |
   |                &lt;--  ACK with CID ---                      |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: TCP/IPv6 Connection between two LoWPAN hosts&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
   <a class='info' href='#TCP/IPv6 connection between two LoWPAN hosts'>Figure&nbsp;4<span> (</span><span class='info'>TCP/IPv6 Connection between two LoWPAN hosts</span><span>)</span></a> presents
   a TCP connection initiated by a LoWPAN node to another LoWPAN node.
   The LoWPAN host sends in the TCP SYN segment with a CID
   equals to the smallest available CID value.
   
</p>
<p>
   The CID value is chosen by the first LoWPAN host that is involved in
   establishing the TCP connection.
   This way, it is easy to ensure the unicity of the CID.
   At the same time, this simplifies the context management at the ERs.
   Moreover, if all CID values are used, the initiator should increase the CID
   field length from 8 bits to 16 bits.
   
</p>
<a name="The LoWPAN_TCPHC context"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
The LoWPAN_TCPHC context</h3>

<a name="The LoWPAN_TCPHC context structure"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.1"></a><h3>2.2.1.&nbsp;
LoWPAN_TCPHC context structure</h3>

<p>
   The context includes some TCP header fields that are needed by the compressor
   and the decompressor algorithm.
   <a class='info' href='#struct_context'>Figure&nbsp;5<span> (</span><span class='info'>Structure of a LOWPAN_TCPHC context</span><span>)</span></a> lists the contents of 
   a LOWPAN_TCPHC context.
   
</p><br /><hr class="insert" />
<a name="struct_context"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   +---------+------------------------------------+----------+
  | Field   | Description                        | Length   |
  +---------+------------------------------------+----------+
  | CID     | Context Identifier                 | 16 bits  |
  +---------+------------------------------------+----------+
  | Address | LoWPAN IPv6 address                | 128 bits |
  ---------+------------------------------------+----------+
  | SrcPort | TCP Source Port Number             | 16 bits  |
  +---------+------------------------------------+----------+
  | DstPort | TCP Destination Port Number        | 16 bits  |
  +---------+------------------------------------+----------+
  | seq_rcv | Sequence number in incoming segments | 32 bits  |
  +---------+------------------------------------+----------+
  | ack_rcv | Acknowledgment number in reception | 32 bits  |
  ---------+------------------------------------+----------+
  | wnd_rcv | Window size in reception           | 16 bits  |
  ---------+------------------------------------+----------+
  | seq_snd | Sequence number in reception       | 32 bits  |
  +---------+------------------------------------+----------+
  | ack_snd | Acknowledgment number in reception | 32 bits  |
  ---------+------------------------------------+----------+
  | wnd_snd | Window size in reception           | 16 bits  |
  ---------+------------------------------------+----------+
  | State   | Context state                      | 4 bits   |
  +---------+------------------------------------+----------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: Structure of a LOWPAN_TCPHC context&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
    The address field saves the Ipv6 address of the 6LoWPAN node. If the TCP 
    connection is established between two 6LoWPAN nodes, the Ipv6 address of 
    the initiator is saved in the context.
    
</p>
<p>
    State field indicates in which state a TCP connection is.
    This field is especially needed by the ERs.
    The possible states of a context are: closed, using, closing, fin_1, fin_2,
    fin_3, and shutting.
    
</p>
<p>
    The CID and Ipv6 address are utilized to identify the connection for
    compressed headers. The SrcPort and DstPort, toghether with the Ipv6 adsress,
    are used to identify the connection for full headers.
    
</p>
<p>
    The seq_rcv, ack_rcv, and wnd_rcv are used to store the dynamic fields of
    the last incoming segment (except retransmitted segment).
    While the seq_snd, ack_snd, and wnd_snd are the dynamic
    fields of the last outgoing segment (except retransmitted segment).
    
</p>
<a name="The_CID_Management"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.2"></a><h3>2.2.2.&nbsp;
Context management</h3>

<p>
   This section describes the context management in 6LoWPAN when
   LOWPAN_TCPHC is used.
   The edge router to which a LoWPAN node host is attached may change over time,
   due to route instability or to host mobility 
   However, this change should
   not break the TCP communication. To ensure the TCP communication
   despite the change of ER, the ERs should share the contexts of
   current connections.
   So, even if a 6LoWPAN node changes its attached ER, the new ER should
   continue to compress the segments using the same context.
   Context exchange and management between ERs is out of the scope of
   this document.
   
</p>
<p>
   The edge router should free a context when a TCP connection is
   finished (e.g., reception of FIN control messages).
   The Edge Router can also free a connection after a silent period
   (i.e., when no messages are exchanged after a certain period of time).
   
</p>
<p>
    The ER may remove the context of a TCP connection that is not yet closed.
    In this case, after receiving a new data segment, the ER SHOULD
    reply by sending a RST segment to the sender.
   
</p>
<a name="Loss_Detection_Retransmissions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Loss detection and retransmissions</h3>

<p>
   In this section, we present how the LOWPAN_TCPHC
   mechanism should react when a segment is lost or is assumed to be lost.
   The loss is handled when the TCP ACK segment is not received within
   the RTO.
   The ER handles a retransmission by scanning the sequence numbers.
   The ER should send a mostly compressed header segment when it
   receives an already sent segment.
   This mechanism allows updating the context on both sides after a
   packet loss.
   We assume that the 6LoWPAN has a low bit rate, and
   also that nodes are memory-constrained and thus the TCP window size 
   is probably limited to a few segments.
   In this case, the loss of synchronization will likely not lead to a burst of
   losses.
   For this reason, this document does not present a refresh algorithm
   to update the context between the compressor and the decompressor.
   
</p><br /><hr class="insert" />
<a name="Loss detection in 6LoWPAN"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

External IP Host           Edge Router                  LoWPAN Host
|                              |                                   |
| --- Regular DATA(124) --&gt;    |--- Compressed header DATA(124) --&gt;|
| &lt;-- Regular ACK(188)  ---    | &lt;-- Compressed header ACK(188) ---|
| --- Regular DATA(188) --&gt;    | --- Compressed header DATA(188) -X|
| Data packet (188) is lost in the LoWPAN                          |
|                              |                                   |
| The External node handles the segment loss after an RTO          |
| and retransmits the lost segment                                 |
|                              |                                   |
| --- Regular DATA(188) --&gt;    |       --- Most Comp. DATA(188) --&gt;|
| The ER compresses the retranmitted segment with a mostly         |
| compressed header                                                |
|                              |                                   |
| &lt;-- Regular ACK(252)  ---    | &lt;-- Compressed header ACK(252) ---|
| The receiver decompresses the request data segment,              |
| and finally sends an ACK to request the next segment             |
|                              |                                   |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: Loss detection in 6LoWPAN&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
   <a class='info' href='#Loss detection in 6LoWPAN'>Figure&nbsp;6<span> (</span><span class='info'>Loss detection in 6LoWPAN</span><span>)</span></a> shows a scenario
   where a TCP segment is lost in the 6LoWPAN. After an RTO the enternal 
   IP host retransmits the lost segment.
   Upon the reception of the retransmitted segment, the ER
   produces a mostly compressed header allowing the LoWPAN node to
   decompress the segment.
   
</p>
<a name="TCP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Transmission Control Protocol</h3>

<p>
   This section presents more details on TCP and its header fields.
   As it has been defined in <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>, The TCP is a
   connection-oriented, end-to-end reliable transport protocol
   mostly used in IP-based networks.
   The TCP is able to transfer a continuous stream of bytes in each
   direction between two end-points by packing some number of bytes
   into segments for transmission through IP-based network.


</p>
<p>
   To ensure the end-to-end reliability, the TCP must recover data that
   is damaged, lost or delivered out-of-order. This is achieved by
   assigning a sequence number to each transmitted byte (done by the
   TCP source), and by requiring a positive acknowledgment (ACK) from
   the TCP destination.
   If the ACK is not received within the timeout interval, the data
   segment is assumed to be lost. Then, the source TCP should retransmit it.
   At the receiver, the sequence numbers are used to correctly order
   segments that may be received out of order and eliminate duplicates.
   Damaged segments are handled by adding a checksum to each segment
   transmitted, checking it at the receiver and rejecting damaged segments.

</p>
<a name="TCP header fields"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
TCP headers fields</h3>

<p>
   In this section, we present a short description of TCP header fields and
   how they are handled by the compression mechanism.
   <a class='info' href='#RFC4413'>[RFC4413]<span> (</span><span class='info'>West, M. and S. McCann, &ldquo;TCP/IP Field Behavior,&rdquo; March&nbsp;2006.</span><span>)</span></a> provides a detailed description of TCP
   header and TCP header options.

</p>
<p> </p>
<ul class="text">
<li> Source port (16 bits):
    This field identifies the sending port. This field will be replaced by 
    the CID in compressed headers.
    
</li>
<li> Destination port (16 bits):
    This field identifies the receiving port. This field will be replaced by
    the CID in compressed headers.
    
</li>
<li> Sequence Number (32 bits):
    The sequence number of the first data byte in this segment (except when SYN flag is set).
    If SYN is present the sequence number is the initial sequence number (ISN) and the first
    data byte is ISN+1.

    Only the bytes that change (respect to the previous segment) will be sent.
    If this field does not change, nothing should be sent.
    
</li>
<li> Acknowledgment number (32 bits):
    If the ACK flag is set this field contains the value of the next sequence number
    the sender of the segment is expecting to receive.
    Once a connection is established this is always sent.
    Only changed bytes of this field according to the last sent segment will be sent.
    If this field does not change, nothing should be sent.
    
</li>
<li> Reserved (4 bits):
    Reserved for future use. Must be zero. This field should not be sent in compressed segments.
    
</li>
<li>Flags (8 bits):

    
<blockquote class="text"><dl>
<dt>URG (1 bit):</dt>
<dd> Urgent Pointer field contains a valid value.
</dd>
<dt>ACK (1 bit):</dt>
<dd> Acknowledgment field contains a valid value.
</dd>
<dt>PSH (1 bit):</dt>
<dd> Push.
</dd>
<dt>RST (1 bit):</dt>
<dd> Reset the connection.
</dd>
<dt>SYN (1 bit):</dt>
<dd> Synchronize sequence numbers.
</dd>
<dt>FIN (1 bit):</dt>
<dd> No more data from sender.
</dd>
<dt>CWR (1 bit):</dt>
<dd> Congestion window reduced.
</dd>
<dt>ECE (1 bit):</dt>
<dd> Echo the 'congestion experienced' signal in the IP header.
</dd>
</dl></blockquote>
    
    
</li>
<li>Window (16 bits):
    The number of data bytes, beginning with the one indicated in the acknowledgment field,
    the sender of this segment is willing to accept. This field is compressed
    and only the bytes that have changed are sent.
    
    
</li>
<li> Checksum (16 bits)
    The 16-bit checksum field is used for error-checking of the header and data.
    This field is not compressed by LOWPAN_TCPHC.
    
</li>
<li> Urgent Pointer (16 bits):
    This field communicates the current value of the urgent pointer as a
    positive offset from the sequence number in this segment. The
    urgent pointer points to the sequence number of the byte following
    the urgent data. This field is only interpreted in segments with
    the URG flag set to 1.
    This field is rarely used in TCP communications.
    For this reason, the URG flag and Urgent Pointer are sent if and only if
    they are set. In this case, the segment is sent with a full header.
    
</li>
</ul><p> 
</p>
<a name="Options"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
TCP Header Options</h3>

<p>
    Options may occupy space at the end of the TCP header and are a multiple of
    8 bits in length.
    Options are considered for the checksum calculation.
    The most used TCP options are indicated below:

</p>
<ul class="text">
<li> End of Option List (8 bits): indicates the end of the option list.
</li>
<li> No-Operation (8 bits): may be used between options.
</li>
<li> Maximum Segment Size (32 bits): the maximum segment size at the TCP which sends this segment.
</li>
<li> Window Scale Option (24 bits): indicates that the sending TCP end-host
   is prepared to perform both send and receive window scaling.
</li>
<li> SACK-Permitted (16 bits): ask for using SACK option.
</li>
<li> SACK (80-320 bits): selective acknowledgment.
</li>
<li> Timestamp (80 bits): used to compute RTT.
</li>
</ul><p>

</p>
<p>
   The TCP header padding is used to ensure that the TCP header ends and
   data begins on the 32-bit boundary.
   

</p>
<a name="tcp_header_compression"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
TCP header fields compression</h3>

<p>In this section, we define the LOWPAN_TCPHC specifications for TCP header
   compression for LLNs.
   LOWPAN_TCPHC initiates the compression algorithm by exchanging a context
   identifier at the beginning of the connection.
   The compressor and decompressor store most fields of the first
   full headers as a context.

</p>
<p>
   As described in <a class='info' href='#RFC2507'>[RFC2507]<span> (</span><span class='info'>Degermark, M., Nordgren, B., and S. Pink, &ldquo;IP Header Compression,&rdquo; February&nbsp;1999.</span><span>)</span></a>,
   the context consists of the header fields whose values are constant
   or regularly increasing.
   The dynamic fields should be elided because they are the same 
   with respect to the previous header. In fact,
   it is more efficient to send fewer bits, which are the difference from
   previous value comparing to the sending of the absolute value.
   The LoWPAN_TCPHC mechanism is based on sending
   only those fields or parts of fields that do change
   with respect to the previously sent packet.
   That is why, the TCP receiver should save the last received
   segment fields to decompress the next one.
   For example, the two first bytes of the sequence number field can be
   elided if they are equal to the value of the previous segment.

</p>
<p>
   If a TCP segment is lost and must be retransmitted,
   the retransmitted segment should be sent with a mostly compressed header.
   Then, the TCPHC receiver updates the context.

</p>
<p>The TCP compression format is shown in <a class='info' href='#TCP Header Encoding'>Figure&nbsp;10<span> (</span><span class='info'>TCP Header Encoding</span><span>)</span></a>.
   The three first bits are used to dispatch between different types of segments.
   LOWPAN_TCPHC uses two bytes which contain the uncompressed flags of TCP.

</p>
<p>
    Source and destination port numbers are omitted and replaced by a context 
    identifier. The latter should be sent in connection initiation messages
    and replaces the source and destination port numbers.
    
</p>
<p>
    The checksum is not compressed and is used by the receiver to check if the 
    decompressed TCP segment is received correctly.
    To reduce the TCP header length, only these fields which have been changed between
    two successive segments need to be sent to the receiver. Thus,
    based on the previously received segment,  the
    receiver reconstructs the original TCP header.
    
</p>
<p>
    The urgent pointer field is transmitted only when the urgent bit is set.
    When a receiver sends a duplicated acknowledgment, LOWPAN_TCPHC can 
    compress the TCP header down to six bytes (2 bytes LOWPAN_TCPHC,
    1 byte CID, 1 byte acknowledgment number,
    2 bytes Checksum).

</p>
<a name="tcp_port_compression"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
TCP ports</h3>

<p>These fields are part of the definition of a stream and they must
   be constant for all packets in the stream.
   TCP port numbers can be elided in TCP compressed segments and replaced by a
   context identifier (CID).
   The context identifier should be generated by the
   the first involved LoWPAN node.


</p>
<a name="tcp_flags_compression"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Flags</h3>

<p>
    Some of the TCP flags are omitted because TCP control messages that set such 
    flags (SYN, PUSH) are sent uncompressed.
    The uncompressed flags are : PUSH, FIN, Congestion Window Reduced (CWR) and
    ECN-Echo indication (ECE). These flags are present in the two bytes of the
    LOWPAN_TCPHC header.

</p>
<a name="seq_ack_compression"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Sequence and Acknowledgment numbers</h3>

<p>
   The sequence number specifies the first data byte in the segment
   (except the first segment). The length of the sequence number field is
   four bytes.

</p>
<p>
    In a TCP connection, the sequence number is incremented for each packet
    by a value between 0 and the MSS (Maximum Segment Size).
    Thus, the less significant bytes (LSB) are expected to change mush
    frequently than the most significant bytes (MSB).
    Thus, it is often enough to send the N less-significant bytes if the 4-N
    bytes most significant bytes do not change.  
    The decompressor module can deduce the elided bytes from the previously
    received segments.
    
</p>
<p>
    For example: The MSS value is
    512 bytes and the current sequence number is 0x00f24512. Then, the sequence
    number of the next segment should be less or equal to 0x00f24712.
    The compressed segment can sent with only two bytes instead of sending all 4 bytes.
    The TCP sender can send two bytes 0x4712 and the TCP receives should add the
    remaining static bytes 0x00f2.
    Using this method, we reduce to about 50% the length of sequence number or
    acknowledgment number fields if the MSS value does not exceed 65535 bytes.
    
</p>
<p>
   The sequence number can be elided if a receiver is just acknowledging data
   segments and does not send data to the source (i.e., the receiver sends a 
   pure TCP ACK).
   The same algorithm is used for the compression of the acknowledgment number
   and only bytes which are changed should be carried in-line.
   If the TCP sink does not generate data, the four bytes of the sequence number
   are omitted in all acknowledgment segments and only compressed
   acknowledgment fields should be sent.


</p>
<a name="tcp_win_compression"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Window</h3>

<p>The window field can be omitted if it does not change in time. Moreover,
   only the window field bits that have been changed should be sent. The decompression
   deduces the value of this field from the last received full segment.

</p>
<a name="tcp_urgent_compression"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Urgent Pointer</h3>

<p>
   The urgent pointer field is sent in full header format only
   if the urgent flag is set. Otherwise, this field is elided.

</p>
<a name="tcp_new_format"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
LOWPAN_TCPHC Packet Format</h3>

<a name="TCP segment types"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
TCP segments types</h3>

<p>
   Three types of packets are used in a TCP session with header
   compression:
   
   </p>
<blockquote class="text"><dl>
<dt>Regular header TCP segment:</dt>
<dd>
        A normal, uncompressed header. Does not carry any CID.
        <a class='info' href='#Regular Segment stack'>Figure&nbsp;7<span> (</span><span class='info'>Regular header TCP segment</span><span>)</span></a>
        shows the packet format of a regular TCP segment.
        <br /><hr class="insert" />
<a name="Regular Segment stack"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
               +------------+----------+-------+
               |IPHC (NHC=0)|TCP header|Payload|
               +------------+----------+-------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: Regular header TCP segment&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

        
</dd>
<dt>Full header TCP segment:</dt>
<dd>
        An uncompressed header that updates or refreshes the context for a
        packet stream. It carries a CID that will be used to identify the
        context.
        <a class='info' href='#full header TCP segment'>Figure&nbsp;8<span> (</span><span class='info'>Full header TCP segment</span><span>)</span></a>
        shows the packet format of a full header TCP segment.
        <br /><hr class="insert" />
<a name="full header TCP segment"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        +------------+--------+---+----------+-------+
        |IPHC (NHC=1)|00000001|CID|TCP header|Payload|
        +------------+--------+---+----------+-------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: Full header TCP segment&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

        
</dd>
<dt>Compressed header TCP segment:</dt>
<dd>
        <a class='info' href='#Compressed header TCP segment'>Figure&nbsp;9<span> (</span><span class='info'>Compressed header TCP segment</span><span>)</span></a>
        shows the header stack of a compressed TCP segment.
        <br /><hr class="insert" />
<a name="Compressed header TCP segment"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   +------------+------------+---+-----------------------+-------+
   |IPHC (NHC=1)|LOWPAN_TCPHC|CID|uncompressed TCP fields|Payload|
   +------------+------------+---+-----------------------+-------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;9: Compressed header TCP segment&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

        
</dd>
</dl></blockquote><p>
   
</p>
<a name="LOWPAN_TCPHC Format"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
LOWPAN_TCPHC Format</h3>
<br /><hr class="insert" />
<a name="TCP Header Encoding"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  0   1   2   3   4   5   6   7   8   9   0   1   2   3   4   5
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
| 1 | 1 | 0 |Id |  Seq  |  Ack  |   W   |CWR|ECE| F | P | T | S |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;10: TCP Header Encoding&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
</p>
<blockquote class="text"><dl>
<dt>Id:</dt>
<dd>Context Identifier Size

      
<blockquote class="text"><dl>
<dt>0:</dt>
<dd>
         CID is coded in 8 bits.
         
</dd>
<dt>1:</dt>
<dd>
         CID is coded in 16 bits.
         
</dd>
</dl></blockquote>
   
</dd>
<dt>Seq:</dt>
<dd>Sequence Number:

     
<blockquote class="text"><dl>
<dt>00:</dt>
<dd>
      All 32 bits of Sequence Number are elided.
      
</dd>
<dt>01:</dt>
<dd>
      First 8 less-significant bits of Sequence Number are carried in-line.  The
      remaining 24 bits are elided.
      
</dd>
<dt>10:</dt>
<dd>
      First 16 less-significant bits of Sequence Number are carried in-line.  Last 
      16 bits of Sequence Number are elided.
      
</dd>
<dt>11:</dt>
<dd>
      All 32 bits of Sequence Number are carried in-line.
      
</dd>
</dl></blockquote>
   
</dd>
<dt>Ack:</dt>
<dd>Acknowledgment Number:
      
<blockquote class="text"><dl>
<dt>00:</dt>
<dd>
         All 32 bits of Acknowledgment Number are elided.
         
</dd>
<dt>01:</dt>
<dd>
         First 8 less-significant bits of Acknowledgment Number are carried in-line.  The
         remaining 24 bits are elided.
         
</dd>
<dt>10:</dt>
<dd>
         First 16 less-significant bits of Acknowledgment Number are carried in-line.  Last 
         16 bits of Acknowledgment Number are elided.
         
</dd>
<dt>11:</dt>
<dd>
         All 32 bits of Acknowledgment Number are carried in-line.
         
</dd>
</dl></blockquote>
   
</dd>
<dt>W:</dt>
<dd>Window:

        
<blockquote class="text"><dl>
<dt>00:</dt>
<dd>
            The Window field is elided.
            
</dd>
<dt>01:</dt>
<dd>
            The less-significant byte of Window field is carried in-line.
            The most-significant byte is elided.
            
</dd>
<dt>10:</dt>
<dd>
            The most-significant byte of Window field is carried in-line.
            The less-significant byte is elided.
            
</dd>
<dt>11:</dt>
<dd>
            Full 16 bits for Window field are carried in-line.
            
</dd>
</dl></blockquote>
    
</dd>
<dt>F:</dt>
<dd>FIN flag.
</dd>
<dt>P:</dt>
<dd>PUSH flag.
</dd>
<dt>CWR:</dt>
<dd>Congestion Window Reduced flag.
</dd>
<dt>ECE:</dt>
<dd>ECN-Echo flag.
</dd>
<dt>T:</dt>
<dd>Set if the TCP header contains Timestamp option.
</dd>
<dt>S:</dt>
<dd>Set if the TCP header contains SACK option.
</dd>
</dl></blockquote><p>

</p>
<p>
   Fields carried in-line (in part or in whole) appear in the same order
   as they do in the TCP header format <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>.
   The TCP Length field must always be elided and it is inferred from
   lower layers using the
   6LoWPAN fragmentation header or the MAC layer header.
   
</p>
<a name="TCP header "></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Examples of compressed TCP headers</h3>

<p>   
    In this section, we present some examples of a compressed TCP header
    using LOWPAN_TCPHC. 
</p>
<a name="Compressed header"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.1"></a><h3>5.3.1.&nbsp;
Compressed header</h3>

<p> <a class='info' href='#Compressed header TCP Header Encoding'>Figure&nbsp;11<span> (</span><span class='info'>Compressed header TCP Header Encoding</span><span>)</span></a>
    represents a header of a TCP data segment whose window field has not
    changed from with respect its antecedent, the two
    bytes of the lowest bytes of the sequence number that have been changed.
    The size of this header is seven bytes.
    <br /><hr class="insert" />
<a name="Compressed header TCP Header Encoding"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   3  1  2  2  2 1 1 1 1 1 1 1 8       16         16
+---+-+--+--+--+-+-+-+-+-+-+-+---+----------+----------+
|010|0|01|00|00|0|0|0|0|0|0|0|CID|Seq.Number| Checksum |
+---+-+--+--+--+-+-+-+-+-+-+-+---+----------+----------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;11: Compressed header TCP Header Encoding&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

    
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
TCP Option Compression</h3>

<p>
   This section defines a compression method for the TCP options most likely
   to be used in 6LoWPAN. The "end of option" byte and the "no operatioon" byte
   are elided. Taking into account the caracterisctics of the LLNs, the "window 
   scale" option are not supported because it is especially needed in broadband
   network and the window size in LLNs are limited to few segments.
   The "maximum segment size" option is negociated in the first 
   control segments, thus they are not compressed. SACK option are not 
   negociated and are allowed by default.
   However, the ER can decide to allow or to deny an option sent
   in the SYN segment.
   LOWPAN_TCPHC compresses the mostly used TCP options : SACK and Timestamp.
   We assume that the SACK and Timestamp are not negotiated and used by default.
   LOWPAN_TCPHC specifies two bits for SACK and Timestamp TCP options.
   <a class='info' href='#tcp_header_option_conf'>Figure&nbsp;12<span> (</span><span class='info'>TCP Header Option Configuration</span><span>)</span></a> shows the structure of a TCP
   segment including options compressed using LOWPAN_TCPHC.
   MSS and SACK-Permitted options are sent in a SYN and they are compressed.
   The Window Scale Option (WSO) is useless in 6LoWPAN because it is more
   performance to use small windows than large windows.
   The size of the SACK option is 4 bytes and the size of Timestamp option is
   variable from 2 to 8 bytes.

</p><br /><hr class="insert" />
<a name="tcp_header_option_conf"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+--------------+-----+----------+-------+-----------+---------+
| LOWPAN_TCPHC | CID | Com. TCP | SACK  | Timestamp | Payload |
|   Encoding   |     |  fields  | option|  option   |         |
+--------------+-----+----------+-------+-----------+---------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;12: TCP Header Option Configuration&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Selective Acknowledgment option</h3>

<p>
   The TCP Selective Acknowledgment option (SACK) <a class='info' href='#RFC2018'>[RFC2018]<span> (</span><span class='info'>Mathis, M., Mahdavi, J., Floyd, S., and A. Romanow, &ldquo;TCP Selective Acknowledgment Options,&rdquo; October&nbsp;1996.</span><span>)</span></a>   <a class='info' href='#RFC2883'>[RFC2883]<span> (</span><span class='info'>Floyd, S., Mahdavi, J., Mathis, M., and M. Podolsky, &ldquo;An Extension to the Selective Acknowledgment (SACK) Option for TCP,&rdquo; July&nbsp;2000.</span><span>)</span></a>
   should be negotiated in set-up phase, then the option may
   be used when dropped segments are detected by the receiver.
   This option is to be used to convey extended acknowledgment
   information over an established connection.
   The left edge of the block can be replaced by the offset between
   the first byte of the segment and the right edge by the length of
   the block.
   The Left edge and the right edge will be coded in 16 bits.



<br /><hr class="insert" />
<a name="Compressed SACK option"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
          +---------------------+----------------------+
          | Left Edge (16 bits) | Right Edge (16 bits) |
          +---------------------+----------------------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;13: Compressed SACK option&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Timestamp option</h3>

<p>
   This option carries eight-byte timestamp fields. 
   If timestamp options <a class='info' href='#RFC1323'>[RFC1323]<span> (</span><span class='info'>Jacobson, V., Braden, B., and D. Borman, &ldquo;TCP Extensions for High Performance,&rdquo; May&nbsp;1992.</span><span>)</span></a> are
   exchanged in the connection set-up phase, they are
   expected to appear on all subsequent segments.
   This overhead added by this option can be reduced: a TCP that does not
   sent data is not interested to compute the RTTM. And thus, it can replay
   by sending only Timestamp Echo Reply field (TSecr).
   However, the Timestamp Value field (TSval) is more important for TCP
   that send data.


</p>
<p>
   LOWPAN_TCPHC sends only bytes that have changed since the last segment
   to reduce the size of the Timestamp field. 
   LOWPAN_TCPHC defines a bitmap field which specifies the bytes that are
   elided and the bytes that are carried in-line.
   <a class='info' href='#Compressed Timestamp option'>Figure&nbsp;14<span> (</span><span class='info'>Compressed Timestamp option</span><span>)</span></a> shows the structure of the
   compressed TCP timestamp option fields.
   
<br /><hr class="insert" />
<a name="Compressed Timestamp option"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    +------------------+------------------+------------------+
    | Timestamp bitmap | Compressed TSval | Compressed TSecr |
    +------------------+------------------+------------------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;14: Compressed Timestamp option&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Acknowledgments</h3>

<p>
This work has been funded by the Pole de Recherche Avancée en Communications (PRACom).
The authors would like to thank Patrick Maillé and Tiancong Zheng for their useful
comments on an early version of this document.

</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.&nbsp;References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="Perkins et al.">[Perkins et al.]</a></td>
<td class="author-text">Perkins, S. and M. Multa, &ldquo;Dependency removal for transport protocol header compression over noisy channels,&rdquo; International Conference on Communications&nbsp;1997, June&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="Srivastava et al.">[Srivastava et al.]</a></td>
<td class="author-text">Srivastava, A., Friday, R., Ritter, M., and W. San Filippo, &ldquo;A study of TCP performance over wireless data networks,&rdquo; Vehicular Technology Conference,&nbsp;IEEE VTS 53rd, May&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="Wang04">[Wang04]</a></td>
<td class="author-text">Wang, R., &ldquo;An experimental study of TCP/IP's Van Jacobson header compression
	   behavior in lossy space environment,&rdquo; Vehicular Technology Conference,&nbsp;IEEE VTC 60th, September&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="Medina05">[Medina05]</a></td>
<td class="author-text">Medina, A., Allman, M., and S. Floyd, &ldquo;Measuring the Evolution of Transport Protocols in the Internet,&rdquo; ACM SIGCOMM Computer Communications Review&nbsp; 35(2):37-51, April&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-6lowpan-hc">[I-D.ietf-6lowpan-hc]</a></td>
<td class="author-text">Hui, J. and P. Thubert, &ldquo;Compression Format for IPv6 Datagrams in 6LoWPAN Networks,&rdquo; October&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="IEEE 802.15.4">[IEEE 802.15.4]</a></td>
<td class="author-text">IEEE Computer Society, &ldquo;IEEE Std. 802.15.4-2006,&rdquo; IEEE Standard for Information technology-Telecommunications and information exchange between systems-Local and metropolitan area networks-&nbsp;Specific requirements Part 15.4:
   Wireless Medium Access Control (MAC) and Physical Layer (PHY) Specifications for Low-Rate Wireless Personal Area Networks (WPANs), October&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC0768">[RFC0768]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc768">User Datagram Protocol</a>,&rdquo; STD&nbsp;6, RFC&nbsp;768, August&nbsp;1980 (<a href="ftp://ftp.isi.edu/in-notes/rfc768.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC0793">[RFC0793]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc793">Transmission Control Protocol</a>,&rdquo; STD&nbsp;7, RFC&nbsp;793, September&nbsp;1981 (<a href="ftp://ftp.isi.edu/in-notes/rfc793.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1122">[RFC1122]</a></td>
<td class="author-text"><a href="mailto:Braden@ISI.EDU">Braden, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1122">Requirements for Internet Hosts - Communication Layers</a>,&rdquo; STD&nbsp;3, RFC&nbsp;1122, October&nbsp;1989 (<a href="ftp://ftp.isi.edu/in-notes/rfc1122.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1144">[RFC1144]</a></td>
<td class="author-text"><a href="mailto:van@helios.ee.lbl.gov">Jacobson, V.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1144">Compressing TCP/IP headers for low-speed serial links</a>,&rdquo; RFC&nbsp;1144, February&nbsp;1990 (<a href="ftp://ftp.isi.edu/in-notes/rfc1144.txt">TXT</a>, <a href="ftp://ftp.isi.edu/in-notes/rfc1144.ps">PS</a>, <a href="ftp://ftp.isi.edu/in-notes/rfc1144.pdf">PDF</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1323">[RFC1323]</a></td>
<td class="author-text"><a href="mailto:van@CSAM.LBL.GOV">Jacobson, V.</a>, <a href="mailto:Braden@ISI.EDU">Braden, B.</a>, and <a href="mailto:dab@cray.com">D. Borman</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1323">TCP Extensions for High Performance</a>,&rdquo; RFC&nbsp;1323, May&nbsp;1992 (<a href="ftp://ftp.isi.edu/in-notes/rfc1323.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2018">[RFC2018]</a></td>
<td class="author-text"><a href="mailto:mathis@psc.edu">Mathis, M.</a>, <a href="mailto:mahdavi@psc.edu">Mahdavi, J.</a>, <a href="mailto:floyd@ee.lbl.gov">Floyd, S.</a>, and <a href="mailto:allyn@eng.sun.com">A. Romanow</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2018">TCP Selective Acknowledgment Options</a>,&rdquo; RFC&nbsp;2018, October&nbsp;1996 (<a href="ftp://ftp.isi.edu/in-notes/rfc2018.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2018.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2018.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2507">[RFC2507]</a></td>
<td class="author-text"><a href="mailto:micke@sm.luth.se">Degermark, M.</a>, <a href="mailto:bcn@cdt.luth.se">Nordgren, B.</a>, and <a href="mailto:steve@sm.luth.se">S. Pink</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2507">IP Header Compression</a>,&rdquo; RFC&nbsp;2507, February&nbsp;1999 (<a href="ftp://ftp.isi.edu/in-notes/rfc2507.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2883">[RFC2883]</a></td>
<td class="author-text">Floyd, S., Mahdavi, J., Mathis, M., and M. Podolsky, &ldquo;<a href="http://tools.ietf.org/html/rfc2883">An Extension to the Selective Acknowledgment (SACK) Option for TCP</a>,&rdquo; RFC&nbsp;2883, July&nbsp;2000 (<a href="ftp://ftp.rfc-editor.org/in-notes/rfc2883.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4413">[RFC4413]</a></td>
<td class="author-text">West, M. and S. McCann, &ldquo;<a href="http://tools.ietf.org/html/rfc4413">TCP/IP Field Behavior</a>,&rdquo; RFC&nbsp;4413, March&nbsp;2006 (<a href="ftp://ftp.rfc-editor.org/in-notes/rfc4413.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4919">[RFC4919]</a></td>
<td class="author-text">Kushalnagar, N., Montenegro, G., and C. Schumacher, &ldquo;<a href="http://tools.ietf.org/html/rfc4919">IPv6 over Low-Power Wireless Personal Area Networks (6LoWPANs): Overview, Assumptions, Problem Statement, and Goals</a>,&rdquo; RFC&nbsp;4919, August&nbsp;2007 (<a href="ftp://ftp.rfc-editor.org/in-notes/rfc4919.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4944">[RFC4944]</a></td>
<td class="author-text">Montenegro, G., Kushalnagar, N., Hui, J., and D. Culler, &ldquo;<a href="http://tools.ietf.org/html/rfc4944">Transmission of IPv6 Packets over IEEE 802.15.4 Networks</a>,&rdquo; RFC&nbsp;4944, September&nbsp;2007 (<a href="ftp://ftp.rfc-editor.org/in-notes/rfc4944.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4995">[RFC4995]</a></td>
<td class="author-text">Jonsson, L-E., Pelletier, G., and K. Sandlund, &ldquo;<a href="http://tools.ietf.org/html/rfc4995">The RObust Header Compression (ROHC) Framework</a>,&rdquo; RFC&nbsp;4995, July&nbsp;2007 (<a href="ftp://ftp.rfc-editor.org/in-notes/rfc4995.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4996">[RFC4996]</a></td>
<td class="author-text">Pelletier, G., Sandlund, K., Jonsson, L-E., and M. West, &ldquo;<a href="http://tools.ietf.org/html/rfc4996">RObust Header Compression (ROHC): A Profile for TCP/IP (ROHC-TCP)</a>,&rdquo; RFC&nbsp;4996, July&nbsp;2007 (<a href="ftp://ftp.rfc-editor.org/in-notes/rfc4996.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ahmed Ayadi</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Telecom Bretagne</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rue de la Chataigneraie, CS 17607</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">35576 Cesson Sevigne cedex</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+33 2 99 12 70 52</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ahmed.ayadi@telecom-bretagne.eu">ahmed.ayadi@telecom-bretagne.eu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">David Ros</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Telecom Bretagne</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rue de la Chataigneraie, CS 17607</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">35576 Cesson Sevigne cedex</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+33 2 99 12 70 46</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:david.ros@telecom-bretagne.eu">david.ros@telecom-bretagne.eu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Laurent Toutain</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Telecom Bretagne</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rue de la Chataigneraie, CS 17607</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">35576 Cesson Sevigne cedex</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+33 2 99 12 70 26</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:laurent.toutain@telecom-bretagne.eu">laurent.toutain@telecom-bretagne.eu</a></td></tr>
</table>
</body></html>
