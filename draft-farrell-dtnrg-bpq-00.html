<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Bundle Protocol Query Extension Block</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Bundle Protocol Query Extension Block">
<meta name="keywords" content="DTNRG bundle protocol extension query">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Research Task Force</td><td class="header">S. Farrell</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">A. Lynch</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">Trinity College Dublin</td></tr>
<tr><td class="header">Expires: May 12, 2011</td><td class="header">D. Kutscher</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">NEC</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">A. Lindgren</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Swedish Institute of Computer</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Science</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">November 8, 2010</td></tr>
</table></td></tr></table>
<h1><br />Bundle Protocol Query Extension Block<br />draft-farrell-dtnrg-bpq-00</h1>

<h3>Abstract</h3>

<p>
	The Bundle Protocol (BP) provides store-and-forward networking
	for Delay- and Disruption-Tolerant Networks.  This document
	defines the BP query extension block (BPQ) which allows
	applications to query the stores of nodes on the path along
	which a bundle containing a bundle query extension block is
	routed.
      
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on May 12, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#sec.overview">2.</a>&nbsp;
Protocol Overview<br />
<a href="#sec.format">3.</a>&nbsp;
BPQ Block Format<br />
<a href="#sec.proc">4.</a>&nbsp;
BPQ Processing<br />
<a href="#sec.considerations">5.</a>&nbsp;
Application Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">5.1.</a>&nbsp;
Usage of Endpoint Identifiers in Bundles<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">5.2.</a>&nbsp;
Advanced Processing of Query and Copy-Response Bundles<br />
<a href="#sec.related">6.</a>&nbsp;
Related Work<br />
<a href="#IANA">7.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">8.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#anchor6">Appendix&nbsp;A.</a>&nbsp;
ChangeLog<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
	The Bundle Protocol (BP) specified in <a class='info' href='#RFC5050'>RFC 5050<span> (</span><span class='info'>Scott, K. and S. Burleigh, &ldquo;Bundle Protocol Specification,&rdquo; November&nbsp;2007.</span><span>)</span></a> [RFC5050] provides store-and-forward
	networking for Delay- and Disruption-Tolerant Networks (DTNs).
	<a class='info' href='#RFC4838'>RFC 4838<span> (</span><span class='info'>Cerf, V., Burleigh, S., Hooke, A., Torgerson, L., Durst, R., Scott, K., Fall, K., and H. Weiss, &ldquo;Delay-Tolerant Networking Architecture,&rdquo; April&nbsp;2007.</span><span>)</span></a> [RFC4838] This document defines
	the BP query extension block (BPQ) which allows applications
	to query the stores of nodes on the path along which a bundle
	containing a bundle query extension block is routed.
      
</p>
<p>
	The DTN architecture and the Bundle Protocol can be used for
	different applications and provide a certain degree of
	flexibility for naming sources and destinations, as well for
	deciding how to process and forward bundles at nodes in a DTN
	network.
      
</p>
<p>
	In some applications contexts, the Bundle Protocol is used for
	literally transmitting some payload data from one endpoint to
	another -- potentially leveraging store-and-forward
	capabilities of intermediate nodes to overcome
	disruptions. How intermediate nodes perform their forwarding
	decisions is not specified by either the DTN architecture nor
	the Bundle Protocol specification, but often the destination
	endpoint identifier (EID) would be considered.
      
</p>
<p>
	But EIDs in a DTN network do not necessarily have to represent
	single nodes -- they can be used for representing receiver
	groups or for specifying some requested service in the
	network. This flexibility, together with the option of using
	different approaches for disseminating data to nodes in a
	network, has made DTN an attractive candidate technology in a
	range of content distribution scenarios, for instance for
	publish-subscribe-based content distribution <a class='info' href='#ref.dpsp'>[ref.dpsp]<span> (</span><span class='info'>Greifenberg and Kutscher, &ldquo;Efficient Publish/Subscribe-based Multicast for 	  Opportunistic Networking with Self-Organized Resource 	  Utilization,&rdquo; March&nbsp;2008.</span><span>)</span></a> and for time-aware content
	dissemination through info stations <a class='info' href='#ref.taco-dtn'>[ref.taco&#8209;dtn]<span> (</span><span class='info'>Sollazzo, Musolesi, and Mascolo, &ldquo;TACO-DTN: A Time-Aware COntent-based dissemination system 	    for Delay Tolerant Networks,&rdquo; 2007.</span><span>)</span></a>.
      
</p>
<p>
	In some scenarios, DTN bundles can have query semantics, i.e.,
	a bundle is sent in order to query for some information object
	-- or a copy of it that can be available on some DTN node as
	the result of a specific dissemination/routing strategy.
	Thus, sometimes when you send a query in a DTN, an
	intermediate BP node already has the data you want, and there
	should be a way to get that data, without having to go all the
	way to the "source" of the data which is, of course, the
	destination for a query bundle.
      
</p>
<p>
	The BPQ that is specified in this memo is intended to allow
	such queries that can be answered by intermediate BP nodes,
	where those nodes do not necessarily have to be addressed by
	the destination EID of a corresponding request message.
      
</p>
<p>
	A use case: Alice and Bob both want to get a video. Alice
	first asks for this using the BP. Now Bob, who's nearby Alice
	also wants to see the same video, and as it happens, due to
	the routing scheme in force, the video is still stored at
	Bob's "next hop" DTN router.  Wouldn't it be nice if Bob could
	just query the DTN as a whole and in this case, get the
	response he wants from a nearby node via probably far less
	delayed or disrupted links.  The BPQ extension block defined
	here provides a way to enable this kind of re-use of DTN
	router storage.
      
</p>
<p>
	The BPQ extension block is intended as an enabling mechanism
	for such applications without anticipating a specific behavior
	with respect to EID semantics and routing strategies. Also, it
	is intended as an optional enhancement to DTN node
	implementations and does not require all nodes in a network to
	actually support the extension to be useful. In <a class='info' href='#sec.overview'>Section&nbsp;2<span> (</span><span class='info'>Protocol Overview</span><span>)</span></a> we provide an overview of the
	general protocol operation, <a class='info' href='#sec.format'>Section&nbsp;3<span> (</span><span class='info'>BPQ Block Format</span><span>)</span></a>
	specifies the actual BPQ block format, and <a class='info' href='#sec.proc'>Section&nbsp;4<span> (</span><span class='info'>BPQ Processing</span><span>)</span></a> provides the processing requirements
	for DTN nodes. <a class='info' href='#sec.considerations'>Section&nbsp;5<span> (</span><span class='info'>Application Considerations</span><span>)</span></a>
	describes a few non-normative application considerations for
	BPQ, and <a class='info' href='#sec.related'>Section&nbsp;6<span> (</span><span class='info'>Related Work</span><span>)</span></a> refers to related
	work.
      
</p>
<p>
	The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
	NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
	"OPTIONAL" in this document are to be interpreted as described
	in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
      
</p>
<a name="sec.overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Protocol Overview</h3>

<p>
	The basic idea of the query extension block is that a "query"
	bundle can contain whatever application layer payload is
	required for the query to succeed when that bundle reaches its
	destination. The query bundle however, in addition to the
	application specific payload, also contains a BPQ extension
	block, which (somehow) uniquely identifies the correct
	query-response payload.
      
</p>
<p>
	One, though not the only, possibility is that the
	query-response payload has a name (e.g. a file name or a name
	derived from the query or response payload via hash
	functions). In such cases, the BPQ extension block can simply
	contain the data required (plus ancillary data as described
	below).
      
</p>
<p>
	BP nodes that do not support BPQ simply (store, and) forward
	query bundles and response bundles as normal and are
	unaffected.
      
</p>
<p>
	BP nodes supporting BPQ compare the value of the BPQ in an
	inbound bundle against their bundle store (details below) and
	when a matching bundle is found they then respond to the
	source of the query bundle with a bundle containing the
	payload of the matching bundle, toghether with BPQ data that
	allows other DTN nodes to also successfully match the query
	and response.
      
</p>
<p>
	[question: what, if any, fields of the matching bundle to
	change, other than the destination? changing the source EID
	seems wrong, but so does not changing the source EID.]
      
</p>
<p>Various schemes could be used in order to allow matching the
	query bundle with a bundle stored on a node, but the simplest
	way to handle this is simply for there to be an identical
	unique BPQ value in the response bundle.  (The response bundle
	must also be marked as a response in order not to confuse
	Alice and Bob's separate queries for the same video.)
      
</p>
<p>
	If a node supporting BPQ finds a complete (i.e. not
	fragmentary) matching response bundle, then it can produce a
	copy-response bundle for the requestor with the same payload
	and send that back to the source of the query bundle. In this
	case, (it seems, TBC) the query bundle need not be forwarded
	further and can be deleted.
      
</p>
<p>
	[question: what to do with status reports in this case if the query bundle
	asked for them? they're not a good idea in any case but I suppose we should say]
      
</p>
<p>
	In the event that the matching response bundle is only a fragment,
	then the node discovering that match responds with a copy-response
	bundle containing the fragment.  The node SHOULD forward a modified
	query bundle which reflects the matched fragment, so that other
	fragments may be retrieved from elsewhere on the query bundle's path.
      
</p>
<p>
	Fragments already marked in the
	query as matched SHOULD NOT be resent. A matched fragment
	that is a superset of a previously matched fragment (including a
	complete match) MAY be returned.  If the node finds a set of
	matching fragments that fully cover the payload, then the node SHOULD
	NOT forward the query bundle.
      
</p>
<p>
	[question: should a single copy-response be sent, thus re-assembling
	fragments, or should the just send each fragment as a bundle as it
	itself received? think about PIB in that case.]
      
</p>
<p>
	In order to allow matching, response bundles (and all fragments thereof)
	sent out by the "source" of the response, also include a BPQ. In this way,
	nodes that support BPQ can easily match queries and responses.
      
</p>
<p>
	In principle, there could be many ways to match a query bundle
	with a response bundle. For example, the query bundle could
	contain a SQL-like query and the response bundle BPQ extension
	could contain a database that returns a non-Null response when
	the query is "executed" by a node. This document however, only
	specifies an "exact match" matching rule, where the query and
	response bundles only match if both contain the same set of
	bits.  Other matching rules may be defined in future.
      
</p>
<p>
	Since response bundles containing the BPQ are intended to be
	re-used, it would appear to be sensible to store such bundles
	for as long as possible, regardless of routing
	decisions. (Routing schemes may also call for bundles to be
	stored, even after having been forwarded one or more
	times.)
      
</p>
<a name="sec.format"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
BPQ Block Format</h3>

<p>The BPQ consists of:

</p>
<ul class="text">
<li>Block type code (1 byte) defined as in all bundle protocol blocks except the
primary bundle block (as described in the Bundle Protocol).  The block type
code for the Metadata Block is TBD
</li>
<li> Block processing control flags (SDNV) - defined as in all bundle protocol
blocks except the primary bundle block.  SDNV encoding is described in the
Bundle Protocol.  There are no constraints on the use of the Block Processing
Control Flags.  If a bundle node receives a bundle with a BPQ block and it is
capable of supporting the BPQ block but it is not able to parse and process the
BPQ value itself, either because it does not support the kind or type being
used or because the data is not well-formed, the bundle node MUST process the
bundle as if it cannot process the BPQ block.  That is, it must operate
according to the settings of the Block Processing Control Flags, including the
"Delete bundle if block can't be processed" flag and the "Discard block if it
can't be processed" flag. The "Block must be replicated in every fragment"
bit MUST be set in all BPQ extension blocks.
</li>
<li>Block EID reference count and EID references (optional) - a composite field
defined in the bundle protocol that is present if and only if the BPQ block
references EID elements in the primary block's dictionary.  The presence of
this field is indicated by the setting of the "Block contains an EID-reference
field" bit of the block processing control flags.  If EIDs are referenced in
the BPQ block, then their interpretation is defined below.
</li>
<li>Block data length (SDNV) - defined as in all bundle protocol
      blocks except the primary bundle block.  SDNV encoding is
      described in the bundle protocol.
</li>
</ul><p>

</p>
<p>Block-type-specific data fields as follows:

</p>
<ul class="text">
<li>A BPQ-kind field (1 byte), with 0x00 meaning a query and 0x01 meaning a
response. Other values are reserved.
</li>
<li>A matching rule type (1 byte) that tells routers how to match the BPQ from a
query with the BPQ of a response. Only matching rule type 0x00 is defined here,
which represents the "exact match" rule as further defined below. The matching
rule MUST be the same in both a query and response in order for there to be a
match.
</li>
<li>A BPQ-value-length field (SDNV) the contains the length of the
BPQ-value.
</li>
<li>A BPQ-value field with the length indicated by the BPQ-value-length field,
that identifies the relevant response payload and is interpreted according to
the matching rule field.
</li>
<li>The number of fragments already returned (SDNV)
</li>
<li>Where the number of fragments already returned is non-zero, an ordered list
containing offset, length pairs (encoded as SDNVs) indicating previously
matched fragments. This should be recalculated as new fragments are found and
overlapping (or adjacent) fragment information should be merged.  
</li>
</ul><p>

</p>
<a name="sec.proc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
BPQ Processing</h3>

<p>If no match is found, then the node MUST forward the query bundle as if the
BPQ block were not present.
</p>
<p>The source EID of a response bundle MUST contain an EID for the node that
found the match.
</p>
<p>The payload and all other extension blocks present in the response bundle
MUST be copied into the copy-response bundle.
</p>
<p>Basically, the only difference between a response bundle and a copy-response
bundle is the bundle identifier and source.
</p>
<p>[note: need to check other primary block fields and say what, if anything,
to do for each, e.g. for current custodian etc. - a bit of thought needed.
</p>
<p>When a node is comparing a query bundle against a potential matching bundle
using the exact match matching rule, the bundles match iff the BPQ-value field
of both are identicial.
</p>
<p>If a matching response bundle is not a fragment, then the query bundle
SHOULD NOT be further forwarded by the node in question but SHOULD be deleted
after the response bundle has been queued for transmission, as the query has
been satisfied.
</p>
<p>
	If a matching response bundle is a fragment, then the node
	SHOULD continue searching in case it has other fragments that
	match the query. In that case, each fragment is sent as a
	separate copy-response bundle. That is, the node finding the
	match SHOULD re-assemble the fragments of the entire bundle,
	if the node knows how to combine the different sets of
	extensions blocks of the fragments. If the matching node does
	not know how to combine the extension blocks, it MUST NOT
	re-assemble the fragments. The reason is that each fragment
	could have different sets of extension blocks present and the
	node might not know how to combine those properly.
      
</p>
<p>[Question: once a node has finished searching for matching fragments
within its store, should the node search subsequent incoming traffic
for remaining fragments?]
</p>
<p>If a matching response bundle is a fragment, and the node does not have a
full set of fragments (that together contain the entire payload) then the node
MUST forward the query bundle as would have happened had no match been
found.
</p>
<p>Custody and status report settings for the copy-response bundle bundle
SHOULD be set to the same values are were present in the matching response
bundle unless the node is specifically configured to do otherwise.
</p>
<p>[question: is that right? do we really want all those reports and custody
acks? There may be a wrinkle there with custody.]
</p>
<p>[Lots more tedious but obvious detail TBD.]
</p>
<a name="sec.considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Application Considerations</h3>

<p>
	This section provides some non-normative considerations on how
	BPQ can be used.
      
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Usage of Endpoint Identifiers in Bundles</h3>

<p>
	  DTN EIDs usage for BPQ queries and replies needs to be
	  considered for:
	  </p>
<ul class="text">
<li>source EIDs in query bundles
</li>
<li>destination EIDs in query bundles
</li>
<li>source EIDs in (copy-) response bundles
</li>
<li>destination EIDs in (copy-) response bundles
</li>
</ul><p>
	
</p>
<p>
	  Source EIDs in query bundles should normally be set to the
	  node EID of query originator.
	
</p>
<p>
	  For the destination EID in query bundles, there are three
	  different options:
	  </p>
<ol class="text">
<li>
	      Some destination EID if the source of some content is
	      actually known). This could also be interpreted as a
	      default EID for a node to which the query should be
	      forwarded to.
	    
</li>
<li>
	      Some namespace or application identifier such as "dtn:appX"
	    
</li>
<li>
	      An actual information object ID (perhaps with a namespace prefix) such as "dtn:appX:45a87e5d"
	    
</li>
</ol><p>
	  Ideally, the destination EID for queries should allow
	  non-BPQ-aware DTN nodes to "do the right thing", i.e.,
	  forward the bundle to a node with (a copy of) the requested
	  resource. More concretely, specific DTN routing protocols
	  should still work as intended, and these protocols normally
	  perform decision based on the destination EID.
	
</p>
<p>
	  For the source EID in (copy-) response bundles, there are essentially two options:
	  </p>
<ol class="text">
<li>
	      The EID of the origin DTN node for the requested resource
	    
</li>
<li>
	      The EID of the node that generating the reply, which
	      could be an intermediate BP node that happens to have a
	      matching resource for the request. This option would
	      make the operation of intermediates visible to the
	      actual receivers (normally considered a desirable
	      property) but would end-to-end security (that is based
	      on the source EID).
	    
</li>
</ol><p>
	
</p>
<p>
	  The destination of (copy-) response bundles should normally
	  set to the node EID of the original sender of the request to
	  enable a DTN network to forward the response bundle to this
	  node. However, specific application scenarios may want to
	  leverage DTN multicast capabilities, e.g. when many nodes
	  are interested in a specific resource so that other EID
	  naming strategies become more attractive.
	
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Advanced Processing of Query and Copy-Response Bundles</h3>

<p>
	  In some named-content distribution scenarios, BPQ nodes can
	  perform additional operations compared to either returning
	  matched bundles or forwarding request bundles. An
	  intermediate BPQ node could also keep an interest table for
	  the requested resource and then later, when a matching
	  resource is available, satisfy the pending requests. This
	  mode of operation could be extended to fragments as well: an
	  intermediate BPQ that has received a request for resource A,
	  for which it has only fragments, could decide to send the
	  fragment(s) directly, or -- e.g. in case of a disruption --
	  maintain the pending request and complete the response
	  bundle with received fragments until a (more) complete
	  response bundle is eventually sent.
	
</p>
<p>
	  When an intermediate BPQ node follows the strategy of
	  maintaining a list of pending requests, there might be a
	  number of requests for the same resource, e.g., for popular
	  content. For such scenarios it would be beneficial to not
	  have to create individual response bundles for the same
	  resource to be sent to each interested node on the
	  network. Domain-specific routing protocols and adequate
	  usage of destination EIDs could be employed in these cases.
	
</p>
<a name="sec.related"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Related Work</h3>

<p>
	Using the Bundle Protocol to query the network for near-by
	resources has been explored in different
	approaches. Greifenberg and Kutscher have described a DTN
	Publish-Subscribe Protocol (DPSP) in <a class='info' href='#ref.dpsp'>[ref.dpsp]<span> (</span><span class='info'>Greifenberg and Kutscher, &ldquo;Efficient Publish/Subscribe-based Multicast for 	  Opportunistic Networking with Self-Organized Resource 	  Utilization,&rdquo; March&nbsp;2008.</span><span>)</span></a> that allows interested nodes to
	register interest in some names resource to the network. DPSP
	nodes would aggregate such subscriptions and forward it
	towards the direction of an origin node. Corresponding content
	bundles would be distributed along a tree that has been built
	implicitly by the subscription messages. In DPSP, destination
	EIDs in subscription bundles specify the named resource
	(e.g. content channel), and the subscription information is
	conveyed in an extension block to enable inter-working with
	unmodified DTN nodes and routing protocols.
      
</p>
<p>
	Sollazzo, Musolesi and Mascolo have described a Time-Aware
	COntent-based dissemination system for DTNs (TACO-DTN) in
	<a class='info' href='#ref.taco-dtn'>[ref.taco&#8209;dtn]<span> (</span><span class='info'>Sollazzo, Musolesi, and Mascolo, &ldquo;TACO-DTN: A Time-Aware COntent-based dissemination system 	    for Delay Tolerant Networks,&rdquo; 2007.</span><span>)</span></a> that takes time-based
	information into account to optimize content dissemination in
	a subscription-based approach. Temporal profiles are
	associated to each subscription and allow the construction of
	temporal profiles of info-stations.
      
</p>
<p>
	More general, the idea of accessing named information objects
	in the network, regardless of the actual object location, is a
	key notion in different Information-Centric Networking
	approaches. Ahlgren, D'Ambrosio, Dannewitz et al have
	developed an elaborate information model for such information
	objects in <a class='info' href='#ref.netinf-design'>[ref.netinf&#8209;design]<span> (</span><span class='info'>Ahlgren, D'Ambrosio, Dannewitz, Marchisio, Marsh, Ohlman, Pentikousis, Rembarz, Strandberg, and Vercellone, &ldquo;Design Considerations for a Network of Information,&rdquo; December&nbsp;2008.</span><span>)</span></a>. In the
	Network of Information approach, information objects can be
	accessed by unique names that provide additional properties
	such as self-certification, i.e., provide a cryptographic
	relation between the object and the name. In such an approach,
	interested nodes would query the network for specific named
	objects and the network would perform name-based routing
	and/or resolution to locators to satisfy such requests.
      
</p>
<p>
	A similar approach is the Content-Centric Networking (CCN)
	approach described by Jacobsen, Smetters, Thornton et al in
	<a class='info' href='#ref.ccn'>[ref.ccn]<span> (</span><span class='info'>Jacobsen, K, D, F, H, and L, &ldquo;Networking Named Content,&rdquo; December&nbsp;2009.</span><span>)</span></a>. In CCN, network nodes receive
	so-called Interest Packets for names content from interested
	nodes. Such Interest Packets can be aggregated, and forwarded
	according to name-based routing information. Corresponding
	data packets are forwarded in the reverse direction, based on
	Interest Table state that is maintained at intermediate nodes
	-- quite similar to the DPSP approach described above.
      
</p>
<p>
	The Query Extension Block as described in this memo could be
	used to inter-connect DTNs to such Information-Centric
	Networks and/or to implement Information-Centric Networking
	with the Bundle Protocol.
      
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>We'll want an extension block number and maybe a new registry
for query kinds and matching rule types if we stick with the above.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>The BPQ in principle allows a node to probe the storage of
another node. If BPQ-values are guessable, then this would work.
If this is a concern, the unguessable BPQ-values SHOULD be 
used.
</p>
<p>The BPQ imposes a load on nodes that support it. If 
such a load is considered a potential DoS vector, then nodes
SHOULD implement some controls on the amount of searching
they are willing to carry out. This could be a simple limit,
or could depend on the source (or authentication status) of
the query bundle.
</p>
<p>Since the copy-response comes from the matching node,
the response bundle's authentication information (e.g. PIB)
will not be usable with the copy-response.
</p>
<p>[note: not sure what to do about this as yet.]
</p>
<p>If confidentiality of the query-response payload is
required the PCB block can be used to provide that 
servcice. However, BPQ values could leak information 
about the payload, for example if the BPQ value were
a hash of the payload, then the BPQ value would allow
an attacker to check whether a guess of the payload
value was correct or not. If this is a concern, then 
BPQ values SHOULD be chosen so as not to leak information
about the response payload.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5050">[RFC5050]</a></td>
<td class="author-text">Scott, K. and S. Burleigh, &ldquo;<a href="http://tools.ietf.org/html/rfc5050">Bundle Protocol Specification</a>,&rdquo; RFC&nbsp;5050, November&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc5050.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC4838">[RFC4838]</a></td>
<td class="author-text">Cerf, V., Burleigh, S., Hooke, A., Torgerson, L., Durst, R., Scott, K., Fall, K., and H. Weiss, &ldquo;<a href="http://tools.ietf.org/html/rfc4838">Delay-Tolerant Networking Architecture</a>,&rdquo; RFC&nbsp;4838, April&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4838.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="ref.ccn">[ref.ccn]</a></td>
<td class="author-text">Jacobsen, K, D, F, H, and L, &ldquo;Networking Named Content,&rdquo; CoNEXT 2009&nbsp;, December&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="ref.dpsp">[ref.dpsp]</a></td>
<td class="author-text">Greifenberg and Kutscher, &ldquo;Efficient Publish/Subscribe-based Multicast for
	  Opportunistic Networking with Self-Organized Resource
	  Utilization,&rdquo; The First IEEE International Workshop on Opportunistic Networking&nbsp;(WON-2008), March&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="ref.netinf-design">[ref.netinf-design]</a></td>
<td class="author-text">Ahlgren, D'Ambrosio, Dannewitz, Marchisio, Marsh, Ohlman, Pentikousis, Rembarz, Strandberg, and Vercellone, &ldquo;Design Considerations for a Network of Information,&rdquo; Re-Arch 2008 Workshop&nbsp;, December&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="ref.taco-dtn">[ref.taco-dtn]</a></td>
<td class="author-text">Sollazzo, Musolesi, and Mascolo, &ldquo;TACO-DTN: A Time-Aware COntent-based dissemination system
	    for Delay Tolerant Networks,&rdquo; MobiOpp 2007 Workshop&nbsp;, 2007.</td></tr>
</table>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
ChangeLog</h3>

<p>This section to be deleted later. The most recent changes should be 
added to the end of the list.
</p>
<p>
	</p>
<blockquote class="text">
<p>Stephen: initial version
</p>
<p>Dirk: added some text to the introduction
</p>
<p>Dirk: moved some text from introduction to separate section "protocol overview"
</p>
<p>Dirk: changes processing requirements for fragmented response bundles as discussed
</p>
<p>Dirk: added section on Application Considerations
</p>
<p>Dirk: added text to related work section
</p>
<p>Aidan: Added text about adding already-returned fragments to the query
</p>
<p>Stephen: Added payload confidentiality  sec. cons. note
</p>
</blockquote><p>
      
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Stephen Farrell</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Trinity College Dublin</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dublin,   2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ireland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+353-1-896-2354</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:stephen.farrell@cs.tcd.ie">stephen.farrell@cs.tcd.ie</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Aidan Lynch</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Trinity College Dublin</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dublin,   2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ireland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:lyncha6@scss.tcd.ie">lyncha6@scss.tcd.ie</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dirk Kutscher</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NEC</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kurfuersten-Anlage 36</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Heidelberg,   </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:kutscher@neclab.eu">kutscher@neclab.eu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Anders Lindgren</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Swedish Institute of Computer Science</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Stockholm,   </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sweden</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:andersl@sics.se">andersl@sics.se</a></td></tr>
</table>
</body></html>
