<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>DNS SRV Resource Records for AFS</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="DNS SRV Resource Records for AFS">
<meta name="keywords" content="AFS, DNS, SRV">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">R. Allbery</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Stanford University</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">October 12, 2009</td></tr>
<tr><td class="header">Expires: April 15, 2010</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />DNS SRV Resource Records for AFS<br />draft-allbery-afs-srv-records-01</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 15, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This document specifies how to use DNS (Domain Name Service) SRV
      RRs (Resource Records) to locate services for the AFS distributed
      file system and how the priority and weight values of the SRV RR
      should be interpreted in the server ranking system used by AFS.  It
      deprecates use of the AFSDB RR to locate AFS cell database servers
      and provides guidance for backward compatibility.
</p>
<h3>Internet Draft Comments</h3>

<p>Comments are solicited.  Please include the AFS Standardization
      mailing list at afs3-standardization@openafs.org as a recipient of
      any comments.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Overview and Rationale<br />
<a href="#anchor2">2.</a>&nbsp;
Scope<br />
<a href="#anchor3">3.</a>&nbsp;
Requirements Notation<br />
<a href="#anchor4">4.</a>&nbsp;
DNS SRV RRs for AFS<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ranking">4.1.</a>&nbsp;
Interpretation as AFS Preference Ranks<br />
<a href="#anchor5">5.</a>&nbsp;
Use of AFSDB RRs<br />
<a href="#anchor6">6.</a>&nbsp;
Example<br />
<a href="#anchor7">7.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Overview and Rationale</h3>

<p>AFS (a registered trademark of IBM Corporation) is a distributed
      file system organized administratively into cells.  Each AFS cell
      consists of one or more Volume Location Database (VLDB) servers, one
      or more Protection Service (PTS) servers, and one or more file
      servers and volume servers, plus possibly additional services not
      relevant to this document.  Data stored in AFS is divided into
      collections of files called volumes.  An AFS protocol client, when
      accessing a file within a specific AFS cell, first contacts a VLDB
      server for that cell to determine the file server for the AFS volume
      in which that file is located, and then contacts that file server
      directly to access the file.  A client may also need to contact a
      PTS server for that cell to register before accessing files in that
      cell or to query protection database information.
</p>
<p>An AFS client therefore needs to determine, for a given AFS cell,
      the VLDB and possibly the PTS servers for that cell.
      (Traditionally, the VLDB and PTS servers are provided by the same
      host.)  Once the client is in contact with the VLDB server, it
      locates file and volume servers through AFS protocol queries to the
      VLDB server.  Originally, VLDB server information was configured
      separately on each client in a file called the CellServDB file.
      <a class='info' href='#RFC1183'>[RFC1183]<span> (</span><span class='info'>Everhart, C., Mamakos, L., Ullmann, R., and P. Mockapetris, &ldquo;New DNS RR Definitions,&rdquo; October&nbsp;1990.</span><span>)</span></a> specified the DNS RR (Resource Record)
      AFSDB to locate VLDB servers for AFS.
</p>
<p>Subsequent to <a class='info' href='#RFC1183'>[RFC1183]<span> (</span><span class='info'>Everhart, C., Mamakos, L., Ullmann, R., and P. Mockapetris, &ldquo;New DNS RR Definitions,&rdquo; October&nbsp;1990.</span><span>)</span></a>, a general DNS RR was
      defined by <a class='info' href='#RFC2782'>[RFC2782]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> for service location for any
      service.  This DNS SRV RR has several advantages over the AFSDB RR:
        </p>
<ul class="text">
<li>AFSDB RRs do not support priority or ranking, leaving AFS
          cell administrators without a way to control which VLDB servers
          clients prefer.
</li>
<li>AFSDB RRs do not include protocol or port information,
          implicitly assuming that all VLDB servers will be contacted over
          the standard port and the UDP protocol.  Future changes to the
          AFS protocol may require separate VLDB server lists for UDP and
          TCP traffic, and some uses of AFS, such as providing VLDB
          service for multiple cells from the same systems, require use of
          different ports.
</li>
<li>Clients using AFSDB RRs must assume that VLDB and PTS
          services are provided by the same host, but it may be useful to
          separate VLDB servers from PTS servers.
</li>
<li>DNS SRV RRs are in widespread use, whereas AFSDB RRs are a
          little-known and little-supported corner of the DNS
          protocol.
</li>
</ul><p>
      For those reasons, it is desirable to move AFS service location from
      the AFSDB RR to DNS SRV RRs.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Scope</h3>

<p>This document describes the format and use of DNS SRV RRs for AFS
      service location and deprecates the AFSDB RR.  It also provides
      guidance for transition from the AFSDB RR to DNS SRV RRs and
      recommendations for backward compatibility.
</p>
<p>Documentation of the AFS protocol, the exact purpose and use of
      the VLDB and PTS services, and other information about AFS is
      outside the scope of this document.
</p>
<p>AFSDB RRs may also be used for locating servers for the Open
      Software Foundation's (OSF) Distributed Computing Environment (DCE)
      authenticated naming system, as described in
      <a class='info' href='#RFC1183'>[RFC1183]<span> (</span><span class='info'>Everhart, C., Mamakos, L., Ullmann, R., and P. Mockapetris, &ldquo;New DNS RR Definitions,&rdquo; October&nbsp;1990.</span><span>)</span></a>.  Service location for DCE servers is
      outside the scope of this document and not modified by this
      specification.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Requirements Notation</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
      NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL"
      in this document are to be interpreted as described in
      <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
DNS SRV RRs for AFS</h3>

<p>The label of a DNS SRV RR, as defined in
        <a class='info' href='#RFC2782'>[RFC2782]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a>, is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    _&lt;service&gt;._&lt;proto&gt;.&lt;name&gt;
</pre></div>
<p>The following values for &lt;service&gt; advertise servers
      providing AFS services:
        </p>
<blockquote class="text"><dl>
<dt>afs3-vlserver:</dt>
<dd>servers providing AFS VLDB
          services.
</dd>
<dt>afs3-prserver:</dt>
<dd>servers providing AFS PTS
          services.
</dd>
</dl></blockquote><p>
      Other AFS services, such as file and volume management services, are
      located through the VLDB service and therefore do not use DNS SRV
      RRs.
</p>
<p>&lt;proto&gt; MUST be "udp" for the current AFS protocol, which
      uses Rx over UDP.  Other values may be used for future revisions of
      the AFS protocol supporting other protocols, such as Rx over
      TCP.
</p>
<p>&lt;name&gt; MUST be the AFS cell name for which the identified
      server provides AFS services.  Clients MUST query DNS SRV RRs only
      for a &lt;name&gt; value exactly matching the AFS cell of interest.
      They MUST not remove leading components to search for more general
      DNS SRV RRs.  The AFS cell "prod.example.com" and the AFS cell
      "example.com" are entirely different cells in the AFS protocol and
      VLDB servers for the latter cannot provide information for the
      former.
        </p>
<blockquote class="text">
<p>NOTE: As with AFSDB RRs, this means that DNS SRV RRs can only
          be used to locate AFS services for cells whose naming matches
          the structure of the DNS.  This is not a requirement of the AFS
          protocol, but sites creating new AFS cells SHOULD use names that
          follow the structure of the DNS and which result in DNS SRV RRs
          under their administrative control.  This both permits use of
          DNS SRV RRs instead of client configuration and helps avoid
          naming conflicts between separate AFS cells.
</p>
</blockquote><p>
      
</p>
<p>DNS SRV RRs include a priority and a weight.  As defined in the
      DNS SRV RR specification <a class='info' href='#RFC2782'>[RFC2782]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a>, clients MUST
      attempt to contact the target host with the lowest-numbered priority
      they can reach.  AFS clients which use a ranked algorithm to
      determine which server to contact MUST therefore assign a
      sufficiently distinct ranks to targets with different priorities
      such that targets with a higher-numbered priority are only contacted
      if all targets with a lower-numbered priority are inaccessible.
      See <a class='info' href='#ranking'>Section&nbsp;4.1<span> (</span><span class='info'>Interpretation as AFS Preference Ranks</span><span>)</span></a> for more information.
</p>
<p>If there are multiple targets with an equal priority, the weight
      value of the DNS SRV RR SHOULD be used as input to a weighted
      algorithm for selecting servers.  This server ordering MAY be done
      either per call or for the lifetime of the DNS SRV RR information.
      As specified by <a class='info' href='#RFC2782'>[RFC2782]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a>, larger weights SHOULD be
      given a proportionately higher probability of being selected.  In
      the presence of records containing weights greater than 0, records
      with weight 0 should have a very small chance of being selected.  A
      weight of 0 SHOULD be used if all targets with that priority are
      weighted equally.  AFS clients MAY take into account network
      performance and other protocol metrics along with SRV RR weights
      when selecting servers, thereby possibly selecting different servers
      than a system based purely on the SRV RRs would indicate.  However,
      such information MUST NOT override the priority information in the
      SRV RR.
</p>
<p>AFS clients MAY cache targets known to be inaccessible by that
      client and ignore those targets when determining which server to
      contact first.  Clients which do this SHOULD have a mechanism to
      retry targets which were previously inaccessible and reconsider them
      according to their priority and weight if they become accessible
      again.
</p>
<p>DNS SRV RRs, like all DNS RRs, have a time-to-live (TTL), after
      which the SRV record information is no longer valid.  As specified
      in <a class='info' href='#RFC1034'>[RFC1034]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - concepts and facilities,&rdquo; November&nbsp;1987.</span><span>)</span></a>, DNS RRs MUST be discarded after their
      TTL and the DNS query repeated.  This applies to DNS SRV RRs for AFS
      as to any other DNS RR.  Any information derived from the DNS SRV
      RRs, such as preference ranks, MUST also be regenerated based on new
      DNS query results once the TTL for the original DNS information has
      passed.
</p>
<a name="ranking"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Interpretation as AFS Preference Ranks</h3>

<p>Several AFS implementations use a ranking algorithm that
        assigns numbers representing a preference rank to each server when
        the client first contacts that AFS cell and then prefers the
        server with the lowest rank unless that server goes down.  Clients
        using this algorithm SHOULD assign their ranks as follows:
          </p>
<ol class="text">
<li>Sort targets by priority and assign a base rank value to
            each target based on its priority.  Each base rank value MUST
            be sufficiently different from the base rank assigned to any
            higher-numbered priority that higher-numbered targets will
            only be attempted if lower-numbered targets cannot be reached.
            It MUST, in other words, be farther from the base rank of any
            distinct priority than any possible automatic adjustment in
            the rank.  When calculating base ranks, observe that the
            numeric value of a priority has no meaning.  Only the ordering
            of distinct priority values between multiple SRV RR targets
            needs to be reflected in the base ranks.
</li>
<li>For each group of targets with the same priority, follow
            the algorithm in <a class='info' href='#RFC2782'>[RFC2782]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> to order those
            targets.  Then, assign those targets ranks formed by
            incrementing the base weight for that priority such that the
            first selected target has the lowest rank, the second selected
            target has the next lowest rank, and so on.
</li>
</ol><p>
        
</p>
<p>After assignment of ranks, the AFS client MAY then adjust the
        ranks dynamically based on network performance and other protocol
        metrics, provided that such adjustments are sufficiently small
        compared to the difference between base ranks that they cannot
        cause servers with a higher-numbered priority to be contacted
        instead of a server with a lower-numbered priority.
</p>
<p>The TTL of the DNS SRV RRs MUST be honored by invalidating and
        regenerating the server preference ranks with new DNS information
        once that TTL has expired.  However, accumulated network and
        protocol metrics may be retained and reapplied to the new
        rankings.
</p>
<p>AFS server preference ranks are conventionally numbers between
        1 and 65535.  DNS SRV RR priorities are numbers between 0 and
        65535.  Implementations following this algorithm could therefore
        encounter problems assigning sufficiently distinct base rank
        values in exceptional cases of very large numbers of DNS SRV RR
        targets with different priorities.  However, an AFS cell
        configuration with thousands of DNS SRV RR targets for an AFS VLDB
        or PTS service with meaningfully distinct priorities is highly
        improbable.  AFS client implementations encountering a DNS SRV RR
        containing targets with more distinct priority values than can be
        correctly represented as base ranks SHOULD fall back to generating
        ranks based solely on priorities, ignoring other rank inputs, and
        disabling dynamic adjustment of ranks.  Implementations MUST be
        able to assign distinct base ranks as described above for at least
        ten distinct priority values.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Use of AFSDB RRs</h3>

<p>Since many AFS client implementations currently support AFSDB RRs
      but do not support DNS SRV RRs, AFS cells providing DNS SRV RRs
      SHOULD also provide AFSDB RRs.  However, be aware that AFSDB RRs do
      not provide priority or weighting information; all servers listed in
      ASFDB RRs are treated as equal.  AFSDB RRs also do not provide port
      information.
</p>
<p>An AFS cell using DNS SRV RRs SHOULD therefore also provide an
      AFSDB RR listing all AFS servers for which the following statements
      are all true:
        </p>
<ul class="text">
<li>The server provides both VLDB and PTS service on the standard
          ports (7003 and 7002) respectively.
</li>
<li>The server provides these services over UDP.
</li>
<li>The server either has the lowest-numbered priority of those
          listed in the DNS SRV RRs or the AFS cell administrator believes
          it reasonable for clients using AFSDB RRs to use this server by
          preference.
</li>
</ul><p>
      The above is a default recommendation.  AFS cell administrators MAY
      use different lists of servers in the AFSDB RRs and DNS SRV RRs if
      desired for specific effects based on local knowledge of which
      clients use AFSDB RRs and which clients use DNS SRV RRs.  However,
      AFS servers SHOULD NOT be advertised with AFSDB RRs unless they
      provide VLDB and PTS services via UDP on the standard ports.
</p>
<p>An AFS cell SHOULD have at least one VLDB and at least one PTS
      server providing service on the standard ports of 7003 and 7002,
      respectively, since clients without DNS SRV RR support cannot locate
      servers on non-standard ports.
</p>
<p>Clients SHOULD query DNS SRV RRs by default but SHOULD then fall
      back on AFSDB RRs if no DNS SRV RRs are found.  In the absence of
      DNS SRV RRs, an AFSDB RR of &lt;subtype> 1 SHOULD be treated as
      equivalent to the following pair of DNS SRV RRs:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    _afs3-vlserver._udp.&lt;cell&gt; &lt;ttl&gt; IN SRV 0 0 7003 &lt;hostname&gt;
    _afs3-prserver._udp.&lt;cell&gt; &lt;ttl&gt; IN SRV 0 0 7002 &lt;hostname&gt;
</pre></div>
<p>&lt;cell&gt; is the label of the AFSDB RR, &lt;tt&gt; is its TTL,
      and &lt;hostname&gt; is the &lt;hostname&gt; value of the AFSDB RR
      as specified in <a class='info' href='#RFC1183'>[RFC1183]<span> (</span><span class='info'>Everhart, C., Mamakos, L., Ullmann, R., and P. Mockapetris, &ldquo;New DNS RR Definitions,&rdquo; October&nbsp;1990.</span><span>)</span></a>.  This is the
      fully-qualified domain name of the server.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Example</h3>

<p>The following example includes TCP AFS services,
        separation of a PTS server from a VLDB server, and use of
        non-standard ports, all features that either assume future AFS
        protocol development or are not widely supported by current
        clients.  This example is intended to show the range of
        possibilities for AFS DNS SRV RRs, not as a practical example for
        an existing cell.  This is a part of the zone file for a
        fictional example.com domain with AFS services.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    $ORIGIN example.com.
    @                    SOA   server.example.com. root.example.com.
                                ( 2009100201 3600 3600 604800 86400 )
                         NS    server.example.com.
    _afs3-vlserver._udp  SRV   0 2 7003 afsdb1.example.com.
    _afs3-vlserver._udp  SRV   0 4 7003 afsdb2.example.com.
    _afs3-vlserver._udp  SRV   1 0 7008 afsdb3.example.com.

    _afs3-vlserver._tcp  SRV   0 0 7003 afsdb3.example.com.

    _afs3-prserver._udp  SRV   0 0 7002 afsdb1.example.com.

    _afs3-prserver._tcp  SRV   0 0 7002 afsdb3.example.com.

    @                    AFSDB 1 afsdb1.example.com.

    afsdb1               A     172.30.79.10
    afsdb2               A     172.30.79.11
    afsdb3               A     172.30.79.12
</pre></div>
<p>In this example, the AFS cell name is example.com.
</p>
<p>afsdb1, afsdb2, and afsdb3 all provide VLDB service via UDP.  The
      first two have the same priority but have weights indicating that
      afsdb1 should get about twice as many clients as afsdb2.  afsdb3
      should only be used for UDP VLDB service if afsdb1 and afsdb2 are
      not accessible and provides that service on a non-standard port
      (7008).
</p>
<p>Only one host, afsdb1, provides UDP PTS service.
</p>
<p>afsdb3 provides a theoretical TCP version of AFS VLDB and PTS
      service on the standard ports and is the only server providing these
      services over TCP for this cell.
</p>
<p>An AFSDB RR is provided for backward compatibility with older
      clients.  It lists only afsdb1, since only that host provides both
      VLDB and PTS service over UDP on the standard ports.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>Use of DNS SRV RRs for AFS service location pose the same
      security issues as the existing AFSDB RRs.  Specifically, unless the
      integrity and authenticity of the DNS response is checked, an
      attacker may forge DNS replies and thereby direct clients at a VLDB
      or PTS server under the control of the attacker.  From there, the
      attacker may decieve an AFS client about the volumes and file
      servers in a cell and about the contents of files and directories in
      that cell.  If the client uses cell data in a trusted way, such as
      by executing programs out of that AFS cell or using data from the
      cell as input to other programs, the attacker may be able to further
      compromise the security of the client and trick it into taking
      actions under the attacker's control.
</p>
<p>This attack can be ameliorated if the server is authenticated,
      since the client can then detect a failure to authenticate the
      attacker's servers and thereby detect possible impersonation.
      However, this applies only to authenticated AFS access, and much AFS
      access is unauthenticated.  Furthermore, clients after failure to
      authenticate may fall back to unauthenticated access, which the
      attacker's servers may permit.
</p>
<p>This vulnerability is inherent in the current AFS protocol and
      may be exploited in ways other than DNS spoofing, such as by
      spoofing the results of VLDB queries for an AFS cell.  Addressing it
      properly requires changes to the AFS protocol allowing clients to
      always authenticate AFS services and discard unauthenticated
      data.  Addition of DNS SRV RRs does not make this vulnerability more
      severe, only opens another equivalent point of attack.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.&nbsp;References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC1034">[RFC1034]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1034">Domain names - concepts and facilities</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1034, November&nbsp;1987 (<a href="http://www.rfc-editor.org/rfc/rfc1034.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1183">[RFC1183]</a></td>
<td class="author-text"><a href="mailto:Craig_Everhart@transarc.com">Everhart, C.</a>, <a href="mailto:louie@Sayshell.UMD.EDU">Mamakos, L.</a>, <a href="mailto:Ariel@Relay.Prime.COM">Ullmann, R.</a>, and <a href="mailto:pvm@isi.edu">P. Mockapetris</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1183">New DNS RR Definitions</a>,&rdquo; RFC&nbsp;1183, October&nbsp;1990 (<a href="http://www.rfc-editor.org/rfc/rfc1183.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2782">[RFC2782]</a></td>
<td class="author-text"><a href="mailto:arnt@troll.no">Gulbrandsen, A.</a>, Vixie, P., and <a href="mailto:levone@microsoft.com">L. Esibov</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>,&rdquo; RFC&nbsp;2782, February&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2782.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Russ Allbery</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Stanford University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.O. Box 20066</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Stanford, CA  94309</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:rra@stanford.edu">rra@stanford.edu</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.eyrie.org/~eagle/">http://www.eyrie.org/~eagle/</a></td></tr>
</table>
</body></html>
