<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Traversal Using Relays around NAT (TURN): Relay
    Extensions to Session Traversal Utilities for NAT (STUN)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Traversal Using Relays around NAT (TURN): Relay
    Extensions to Session Traversal Utilities for NAT (STUN)">
<meta name="keywords" content="NAT, TURN, STUN, ICE">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Behave</td><td class="header">J. Rosenberg</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Cisco</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">R. Mahy</td></tr>
<tr><td class="header">Expires: July 25, 2008</td><td class="header">Plantronics</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">P. Matthews</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Avaya</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">January 22, 2008</td></tr>
</table></td></tr></table>
<h1><br />Traversal Using Relays around NAT (TURN): Relay
    Extensions to Session Traversal Utilities for NAT (STUN)<br />draft-ietf-behave-turn-06</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on July 25, 2008.</p>

<h3>Abstract</h3>

<p>If a host is located behind a NAT, then in certain situations it can
      be impossible for that host to communicate directly with other hosts
      (peers) located behind other NATs. In these situations, it is necessary
      for the host to use the services of an intermediate node that acts as a
      communication relay. This specification defines a protocol, called TURN
      (Traversal Using Relays around NAT), that allows the host to control the
      operation of the relay and to exchange packets with its peers using the
      relay.
</p>
<p>The TURN protocol can be used in isolation, but is more properly used
      as part of the ICE (Interactive Connectivity Establishment) approach to
      NAT traversal.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Overview of Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.</a>&nbsp;
Transports<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.2.</a>&nbsp;
Allocations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.3.</a>&nbsp;
Exchanging Data with Peers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.4.</a>&nbsp;
Permissions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.5.</a>&nbsp;
Channels<br />
<a href="#anchor8">3.</a>&nbsp;
Terminology<br />
<a href="#anchor9">4.</a>&nbsp;
General Behavior<br />
<a href="#allocations">5.</a>&nbsp;
Managing Allocations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">5.1.</a>&nbsp;
Client Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-alloc">5.1.1.</a>&nbsp;
Initial Allocate Requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-refresh">5.1.2.</a>&nbsp;
Refresh Requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.2.</a>&nbsp;
Server Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-initial">5.2.1.</a>&nbsp;
Receiving an Allocate Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-subsequent">5.2.2.</a>&nbsp;
Refresh Requests<br />
<a href="#sec-sendanddata">6.</a>&nbsp;
Send and Data Indications<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-forming-indication">6.1.</a>&nbsp;
Forming and Sending an Indication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">6.2.</a>&nbsp;
Receiving an Indication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">6.3.</a>&nbsp;
Relaying<br />
<a href="#sec-channels">7.</a>&nbsp;
Channel Mechanism<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">7.1.</a>&nbsp;
Forming and Sending a ChannelBind Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">7.2.</a>&nbsp;
Receiving a ChannelBind Request and Sending a Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">7.3.</a>&nbsp;
Receiving a ChannelBind Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-channeldata-msg">7.4.</a>&nbsp;
The ChannelData Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-sending-channeldata-msg">7.5.</a>&nbsp;
Forming and Sending a ChannelData Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">7.6.</a>&nbsp;
Receiving a ChannelData Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">7.7.</a>&nbsp;
Relaying<br />
<a href="#sec-stun-methods">8.</a>&nbsp;
New STUN Methods<br />
<a href="#sec-stun-attributes">9.</a>&nbsp;
New STUN Attributes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#channelnums">9.1.</a>&nbsp;
CHANNEL-NUMBER<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">9.2.</a>&nbsp;
LIFETIME<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">9.3.</a>&nbsp;
BANDWIDTH<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">9.4.</a>&nbsp;
PEER-ADDRESS<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">9.5.</a>&nbsp;
DATA<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor30">9.6.</a>&nbsp;
RELAY-ADDRESS<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">9.7.</a>&nbsp;
REQUESTED-PORT-PROPS<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-requested-transport">9.8.</a>&nbsp;
REQUESTED-TRANSPORT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">9.9.</a>&nbsp;
REQUESTED-IP<br />
<a href="#sec-stun-errors">10.</a>&nbsp;
New STUN Error Response Codes<br />
<a href="#anchor33">11.</a>&nbsp;
Client Discovery of TURN Servers<br />
<a href="#sec-security">12.</a>&nbsp;
Security Considerations<br />
<a href="#anchor34">13.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor35">14.</a>&nbsp;
IAB Considerations<br />
<a href="#anchor36">15.</a>&nbsp;
Example<br />
<a href="#anchor37">16.</a>&nbsp;
Changes from Previous Versions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor38">16.1.</a>&nbsp;
Changes from -05 to -06<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor39">16.2.</a>&nbsp;
Changes from -04 to -05<br />
<a href="#sec-issues">17.</a>&nbsp;
Issues<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor40">17.1.</a>&nbsp;
Open Issues<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor41">17.2.</a>&nbsp;
Closed Issues<br />
<a href="#anchor42">18.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">19.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">19.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">19.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>NOTE TO THE READER: This document is a work-in-progress. Please see
      the list of open and closed issues in <a class='info' href='#sec-issues'>Section&nbsp;17<span> (</span><span class='info'>Issues</span><span>)</span></a>.
      With only a few exceptions, if there is an open issue the text has NOT
      been updated in this area pending resolution of this issue - keep this
      in mind when reading the text. In addition, in the interest of getting
      the document out quickly in order to make progress on open issues, the
      authors have elected to release the document is a bit more "raw" state
      than they would prefer, resulting in some rough spots in the
      presentation.
</p>
<p><br />
<br />
<br />
<br />

</p>
<p>Session Traversal Utilities for NAT (STUN) <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a> provides a suite of tools
      for facilitating the traversal of NAT. Specifically, it defines the
      Binding method, which is used by a client to determine its reflexive
      transport address towards the STUN server. The reflexive transport
      address can be used by the client for receiving packets from peers, but
      only when the client is behind "good" NATs. In particular, if a client
      is behind a NAT whose mapping behavior <a class='info' href='#RFC4787'>[RFC4787]<span> (</span><span class='info'>Audet, F. and C. Jennings, &ldquo;Network Address Translation (NAT) Behavioral Requirements for Unicast UDP,&rdquo; January&nbsp;2007.</span><span>)</span></a> is
      address or address and port dependent (sometimes called "bad" NATs), the
      reflexive transport address will not be usable for communicating with a
      peer.
</p>
<p>The only way to obtain a UDP transport address that can be used for
      corresponding with a peer through such a NAT is to make use of a relay.
      The relay sits on the public side of the NAT, and allocates transport
      addresses to clients reaching it from behind the private side of the
      NAT. These allocated transport addresses are from IP addresses belonging
      to the relay. When the relay receives a packet on one of these allocated
      addresses, the relay forwards it toward the client.
</p>
<p>This specification defines an extension to STUN, called TURN, that
      allows a client to request an address on the TURN server, so that the
      TURN server acts as a relay. This extension defines a handful of new
      STUN methods. The Allocate method is the most fundamental component of
      this set of extensions. It is used to provide the client with a
      transport address that is relayed through the TURN server. A transport
      address which relays through an intermediary is called a relayed
      transport address.
</p>
<p>Though a relayed transport address is highly likely to work when
      corresponding with a peer, it comes at high cost to the provider of the
      relay service. As a consequence, relayed transport addresses should only
      be used as a last resort. Protocols using relayed transport addresses
      should make use of mechanisms to dynamically determine whether such an
      address is actually needed. One such mechanism, defined for multimedia
      session establishment protocols based on the offer/answer protocol in
      <a class='info' href='#RFC3264'>RFC 3264<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;An Offer/Answer Model with Session Description Protocol (SDP),&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3264], is Interactive Connectivity
      Establishment (ICE) <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
</p>
<p>Though originally invented for Voice over IP applications, TURN is
      designed to be a general-purpose relay mechanism for NAT traversal.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Overview of Operation</h3>

<p>This section gives an overview of the operation of TURN. It is
      non-normative.
</p>
<p>In a typical configuration, a TURN client is connected to a <a class='info' href='#RFC1918'>private network<span> (</span><span class='info'>Rekhter, Y., Moskowitz, R., Karrenberg, D., Groot, G., and E. Lear, &ldquo;Address Allocation for Private Internets,&rdquo; February&nbsp;1996.</span><span>)</span></a> [RFC1918] and through one or more NATs to
      the public Internet. On the public Internet is a TURN server. Elsewhere
      in the Internet are one or more peers that the TURN client wishes to
      communicate with. These peers may or may not be behind one or more
      NATs.
</p><br /><hr class="insert" />
<a name="fig-turn-model"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                                          +---------+
                                                          |         |
                                                          |         |
                                                        / |  Peer A |
    Client's              TURN                        //  |         |
    Host Transport        Server                     /    |         |
    Address               Address              +-+ //     +---------+
 10.1.1.2:17240       192.0.2.15:3478          |N|/  192.168.100.2:16400
       |                    |                  |A|
       |        +-+         |                 /|T|
       |        | |         |                / +-+
       v        | |         |               /       192.0.2.210:18200
 +---------+    | |         |+---------+   /              +---------+
 |         |    |N|         ||         | //               |         |
 | TURN    |    | |         v|  TURN   |/                 |         |
 | Client  |----|A|----------|  Server |------------------|  Peer B |
 |         |    | |^         |         |^                ^|         |
 |         |    |T||         |         ||                ||         |
 +---------+    | ||         +---------+|                |+---------+
                | ||                    |                |
                | ||                    |                |
                +-+|                    |                |
                   |                    |                |
                   |                    |                |
             Client's                   |            Peer B
             Server-Reflexive    Relayed             Transport
             Transport Address   Transport Address   Address
             192.0.2.1:7000      192.0.2.15:9000     192.0.2.210:18200
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
</p>
<p><a class='info' href='#fig-turn-model'>Figure&nbsp;1</a> shows a typical deployment. In
      this figure, the TURN client and the TURN server are separated by a NAT,
      with the client on the private side and the server on the public side of
      the NAT. This NAT is assumed to be a &ldquo;bad&rdquo; NAT; for example,
      it might have a mapping property of address-and-port-dependent mapping
      (see <a class='info' href='#RFC4787'>[RFC4787]<span> (</span><span class='info'>Audet, F. and C. Jennings, &ldquo;Network Address Translation (NAT) Behavioral Requirements for Unicast UDP,&rdquo; January&nbsp;2007.</span><span>)</span></a>) for a description of what this
      means).
</p>
<p>The client has allocated a local port on one of its addresses for use
      in communicating with the server. The combination of an IP address and a
      port is called a TRANSPORT ADDRESS and since this (IP address, port)
      combination is located on the client and not on the NAT, it is called
      the client&rsquo;s HOST transport address.
</p>
<p>The client sends TURN messages from its host transport address to a
      transport address on the TURN server which is known as the TURN SERVER
      ADDRESS. The client learns the server&rsquo;s address through some
      unspecified means (e.g., configuration), and this address is typically
      used by many clients simultaneously. The TURN server address is used by
      the client to send both commands and data to the server; the commands
      are processed by the TURN server, while the data is relayed on to the
      peers.
</p>
<p>Since the client is behind a NAT, the server sees these packets as
      coming from a transport address on the NAT itself. This address is known
      as the client&rsquo;s SERVER-REFLEXIVE transport address; packets sent
      by the server to the client&rsquo;s server-reflexive transport address
      will be forwarded by the NAT to the client&rsquo;s host transport
      address.
</p>
<p>The client uses TURN commands to allocate a RELAYED transport
      address, which is an transport address located on the server. The server
      ensures that there is a one-to-one relationship between the
      client&rsquo;s server-reflexive transport address and the relayed
      transport address; thus a packet received at the relayed transport
      address can be unambiguously relayed by the server to the client.
</p>
<p>The client will typically communicate this relayed transport address
      to one or more peers through some mechanism not specified here (e.g., an
      ICE offer or answer <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a>). Once
      this is done, peers can send data packets to the relayed transport
      address and the server will forward them to the client. In the reverse
      direction, the client can send data packets to the server (at its TURN
      server address) and these will be forwarded by the server to the
      appropriate peer, and the peer will see them as coming from the relayed
      transport address; in this direction, the client must specify the
      appropriate peer.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Transports</h3>

<p>TURN as defined in this specification only allows the use of UDP
        between the server and the peer. However, this specification allows
        the use of any one of UDP, TCP, or TLS over TCP to carry the TURN
        messages between the client and the server.
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center">
<tr><th align="center">TURN client to TURN server</th><th align="center">TURN server to peer</th></tr>
<tr>
<td align="center">UDP</td>
<td align="center">UDP</td>
</tr>
<tr>
<td align="center">TCP</td>
<td align="center">UDP</td>
</tr>
<tr>
<td align="center">TLS over TCP</td>
<td align="center">UDP</td>
</tr>
</table>
<br clear="all" />

<p>For TURN clients, using TLS over TCP to communicate with the TURN
        server provides two benefits. First, the client can be assured that
        the addresses of its peers are not visible to any attackers between it
        and the server. Second, the client may be able to communicate with
        TURN servers using TLS when it would not be able to communicate with
        the same server using TCP or UDP, due to the policy of a firewall
        between the TURN client and its server. In this second case, TLS
        between the client and TURN server facilitates traversal.
</p>
<p>There is a planned extension to TURN to add support for TCP between
        the server and the peers <a class='info' href='#I-D.ietf-behave-turn-tcp'>[I&#8209;D.ietf&#8209;behave&#8209;turn&#8209;tcp]<span> (</span><span class='info'>Perreault, S. and J. Rosenberg, &ldquo;Traversal Using Relays around NAT (TURN) Extensions for TCP Allocations,&rdquo; March&nbsp;2010.</span><span>)</span></a>. For this reason,
        allocations that use UDP between the server and the peers are known as
        UDP allocations, while allocations that use TCP between the server and
        the peers are known as TCP allocations. This specification describes
        only UDP allocations.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Allocations</h3>

<p>To allocate a relayed transport address, the client uses an
        Allocate transaction. The client sends a Allocate Request to the
        server, and the server replies with an Allocate Response containing
        the allocated relayed transport address. The client can include
        attributes in the Allocate Request that describe the type of
        allocation it desires (e.g., the lifetime of the allocation). And
        since relaying data can require lots of bandwidth, the server may
        require that the client authenticate itself using STUN&rsquo;s
        long-term credential mechanism, to show that it is authorized to use
        the server.
</p>
<p>Once a relayed transport address is allocated, a client must keep
        the allocation alive. This is done by the client periodically doing a
        Refresh transaction with the server, where the client includes the
        allocated relayed transport address in the Refresh Request. TURN
        deliberately uses a different method (Refresh rather than Allocate)
        for refreshes to ensure that the client is informed if the allocation
        vanishes for some reason.
</p>
<p>The frequency of the Refresh transaction is determined by the
        lifetime of the allocation. The client can request a lifetime in the
        Allocate Request and may modify its request in a Refresh Request, and
        the server always indicates the actual lifetime in the response. The
        client must issue a new Refresh transaction within 'lifetime' seconds
        of the previous Allocate or Refresh transaction. If a client no longer
        wishes to use an Allocation, it should do a Refresh transaction with a
        requested lifetime of 0.
</p>
<p>Note that sending or receiving data from a peer DOES NOT refresh
        the allocation.
</p>
<p>The server remembers the 5-tuple used in the Allocate Request.
        Subsequent transactions between the client and the server use this
        same 5-tuple. In this way, the server knows which client owns the
        allocated relayed transport address. If the client wishes to allocate
        a second relayed transport address, it must use a different 5-tuple
        for this allocation (e.g., by using a different client host
        address).
</p>
<p></p>
<blockquote class="text">
<p>While the terminology used in this document refers to 5-tuples,
            the TURN server can store whatever identifier it likes that yields
            identical results. Specifically, many implementations use a
            file-descriptor in place of a 5-tuple to represent a TCP
            connection.
</p>
</blockquote>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Exchanging Data with Peers</h3>

<p>The client can use the relayed transport address to exchange data
        with its peers by using Send and Data indications. A Send Indication
        is sent from a client to the TURN server and contains, in attributes
        inside the message, the transport address of the peer and the data to
        be sent to that peer. When the TURN server receives the Send
        Indication, it extracts the data from the Send Indication and sends it
        in a UDP datagram to the peer, using the allocated relay address as
        the source address. In the reverse direction, UDP datagrams arriving
        at the relay address on the TURN server are converted into Data
        Indications and sent to the client, with the transport address of the
        peer included in an attribute in the Data Indication.
</p>
<p>Note that a client can use a single relayed transport address to
        exchange data with multiple peers at the same time.
</p><br /><hr class="insert" />
<a name="fig-send-data"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>TURN                   TURN          Peer          Peer
client                 server         A             B
  |--- Allocate Req  --&gt;|             |             |
  |&lt;-- Allocate Resp ---|             |             |
  |                     |             |             |
  |--- Send (Peer A)---&gt;|             |             |
  |                     |=== data ===&gt;|             |
  |                     |             |             |
  |                     |&lt;== data ====|             |
  |&lt;-- Data (Peer A)----|             |             |
  |                     |             |             |
  |--- Send (Peer B)---&gt;|             |             |
  |                     |=== data =================&gt;|
  |                     |             |             |
  |                     |&lt;== data ==================|
  |&lt;-- Data (Peer B)----|             |             |
</pre></div>
<p>
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In the figure above, the client first allocates a relayed transport
        address. It then sends data to Peer A using a Send Indication; at the
        server, the data is extracted and forwarded in a UDP datagram to Peer
        A, using the relayed transport address as the source transport
        address. When a UDP datagram from Peer A is received at the relayed
        transport address, the contents are placed into a Data Indication and
        forwarded to the client. A similar exchange happens with Peer B.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Permissions</h3>

<p>To ease concerns amongst enterprise IT administrators that TURN
        could be used to bypass corporate firewall security, TURN includes the
        notion of permissions. TURN permissions mimic the address-restricted
        filtering mechanism of NATs that comply with <a class='info' href='#RFC4787'>[RFC4787]<span> (</span><span class='info'>Audet, F. and C. Jennings, &ldquo;Network Address Translation (NAT) Behavioral Requirements for Unicast UDP,&rdquo; January&nbsp;2007.</span><span>)</span></a>.
</p>
<p>A TURN server will drop a UDP datagram arriving at a relayed
        transport address from a peer unless the client has recently sent data
        to a peer with the same IP address (the port numbers can differ). See
        the normative description for the precise definition of
        &ldquo;recently&rdquo;. 
</p>
<p>A permission will timeout if not refreshed periodically. The client
        refreshes a permission by sending data to the corresponding peer. Data
        received from the peer DOES NOT refresh the permission. 
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Channels</h3>

<p>In some applications, the overhead of using Send and Data
        indications can be substantial. For example, for applications like
        VoIP which utilize small packets, Send and Data Indications, with 36
        bytes of overhead, can have a substantial impact on overall bandwidth
        usage. To remedy this, TURN clients can assign a CHANNEL to a peer.
        Data to and from such a peer can then be sent using an alternate
        packet format that adds only 4 bytes per packet of overhead.
</p>
<p>The alternate packet format is known as the ChannelData message.
        The ChannelData message does not use the STUN header used by other
        TURN messages, but instead has a 4-byte header that includes a number
        known as a channel number.
</p>
<p>To create a channel, the client sends a ChannelBind request to the
        server, and includes an unallocated channel number and the transport
        address of the peer. Once the client receives the response to the
        ChannelBind request, it can send data to that peer using a ChannelData
        message. Similarly, once the server has received the request, it can
        relay data from that peer towards the client using a ChannelData
        message. There is no way to modify channel bindings, so once a channel
        is bound to a peer, it remains bound for the lifetime of the
        allocation.
</p>
<p>When the server receives a ChannelData message from the client, it
        uses the channel number to determine the destination peer and then
        forwards the data inside a UDP datagram to the peer. In the reverse
        direction, when a UDP datagram arives at the relayed transport address
        from that peer, the server inserts it into a ChannelData message
        containing the channel number bound to that peer; in this way the
        client can determine the peer that send the UDP datagram.
</p><br /><hr class="insert" />
<a name="fig-channels"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>TURN                   TURN          Peer          Peer
client                 server         A             B
  |--- Allocate Req  --&gt;|             |             |
  |&lt;-- Allocate Resp ---|             |             |
  |                     |             |             |
  |--- Send (Peer A)---&gt;|             |             |
  |                     |=== data ===&gt;|             |
  |                     |             |             |
  |                     |&lt;== data ====|             |
  |&lt;-- Data (Peer A)----|             |             |
  |                     |             |             |
  |- ChannelBind Req --&gt;|             |             |
  | (Peer A to 0x4001)  |             |             |
  |                     |             |             |
  |&lt;- ChannelBind Resp -|             |             |
  |                     |             |             |
  |-- [0x4001] data ---&gt;|             |             |
  |                     |=== data ===&gt;|             |
  |                     |             |             |
  |                     |&lt;== data ====|             |
  |&lt;- [0x4001] data ---&gt;|             |             |
  |                     |             |             |
  |--- Send (Peer B)---&gt;|             |             |
  |                     |=== data =================&gt;|
  |                     |             |             |
  |                     |&lt;== data ==================|
  |&lt;-- Data (Peer B)----|             |             |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The figure above shows the channel mechanism in use. The client
        begins by allocating a relayed transport address, and then uses that
        address to exchange data with Peer A. After a bit, the client decides
        to bind a channel to Peer A. To do this, it sends a ChannelBind
        Request to the server, specifying the transport address of Peer A and
        a channel number (0x4001). After that, the client can send application
        data encapsulated inside ChannelData messages to Peer A: this is shown
        as "[0x4001] data" where 0x4001 is the channel number.
</p>
<p>Note that ChannelData messages can only be used for peers to which
        the client has bound a channel. In the example above, Peer A has been
        bound to a channel, but Peer B has not, so application data to and
        from Peer B uses Send and Data indications.
</p>
<p>Channel bindings are always initiated by the client.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<p>Readers are expected to be familar with <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a> and the terms defined
      there.
</p>
<p>The following terms are used in this document:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>TURN:</dt>
<dd>A protocol spoken between a TURN client and a
          TURN server. It is an extension to the STUN protocol <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>. The protocol allows a
          client to allocate and use a relayed transport address.
</dd>
<dt>TURN client:</dt>
<dd>A STUN client that implements this
          specification.
</dd>
<dt>TURN server:</dt>
<dd>A STUN server that implements this
          specification. It relays data between a TURN client and its
          peer(s).
</dd>
<dt>Peer:</dt>
<dd>A host with which the TURN client wishes to
          communicate. The TURN server relays traffic between the TURN client
          and its peer(s). The peer does not interact with the TURN server
          using the protocol defined in this document; rather, the peer
          receives data sent by the TURN server and the peer sends data
          towards the TURN server.
</dd>
<dt>Host Transport Address:</dt>
<dd>A transport address allocated
          on a host.
</dd>
<dt>Server-Reflexive Transport Address:</dt>
<dd>A transport
          address on the "public side" of a NAT. This address is allocated by
          the NAT to correspond to a specific host transport address.
</dd>
<dt>Relayed Transport Address:</dt>
<dd>A transport address that
          exists on a TURN server. If a permission exists, packets that arrive
          at this address are relayed towards the TURN client.
</dd>
<dt>Allocation:</dt>
<dd>The transport address granted to a client
          through an Allocate request, along with related state, such as
          permissions and expiration timers. See also Relayed Transport
          Address.
</dd>
<dt>5-tuple:</dt>
<dd>A combination of the source IP address and
          port, destination IP address and port, and transport protocol (UDP
          or TCP). A 5-tuple uniquely identifies a TCP connection or the
          bi-directional flow of UDP datagrams.
</dd>
<dt>Permission:</dt>
<dd>The IP address and transport protocol (but
          not the port) of a peer that is permitted to send traffic to the
          TURN server and have that traffic relayed to the TURN client. The
          TURN server will only forward traffic to its client from peers that
          match an existing permission.
</dd>
</dl></blockquote>

<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
General Behavior</h3>

<p>After the initial Allocate transaction, all subsequent TURN
      transactions need to be sent in the context of a valid allocation. The
      source and destination IP address and ports for these TURN messages MUST
      match the those used in the initial Allocate Request. These are
      processed using the general server procedures in <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a> with a few important
      additions. For requests, if there is no matching allocation, the server
      MUST generate a 437 (Allocation Mismatch) error response. For
      indications, if there is no matching allocation, the indication is
      silently discarded. An Allocate request MUST NOT be sent by a client
      within the context of an existing allocation. Such a request MUST be
      rejected by the server with a 437 (Allocation Mismatch) error
      response.
</p>
<p>A subsequent request MUST be authenticated using the same username,
      password and realm as the one used in the Allocate request that created
      the allocation. If the request was authenticated but not with the
      matching credential, the server MUST reject the request with a 401
      (Unauthorized) error response.
</p>
<p>When a server returns an error response, it MAY include an
      ALTERNATE-SERVER attribute if it has positive knowledge that the problem
      reported in the error response will not be a problem on the alternate
      server. For example, a 443 response (Invalid IP Address) with an
      ALTERNATE-SERVER means that the other server is responsible for that IP
      address. A 442 (Unsupported Transport Protocol) with this attribute
      means that the other server is known to support that transport protocol.
      A 507 (Insufficient Capacity) means that the other server is known to
      have sufficient capacity. Using the ALTERNATE-SERVER mechanism in the
      507 (Insufficient Capacity) response can only be done if the rejecting
      server has definitive knowledge of available capacity on the target.
      This will require some kind of state sharing mechanism between TURN
      servers, which is beyond the scope of this specification. If a TURN
      server attempts to redirect to another server without knowledge of
      available capacity, it is possible that all servers are in a congested
      state, resulting in series of rejections that only serve to further
      increase the load on the system. This can cause congestion collapse.
</p>
<p>If a client sends a request to a server and gets a 500 class error
      response without an ALTERNATE-SERVER, or the STUN transaction times out
      without a response, and the client was utilizing the SRV procedures of
      <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a> to contact the server,
      the client SHOULD try another server based on those procedures. However,
      the client SHOULD cache the fact that the request to this server failed,
      and not retry that server again for a configurable period of time. Five
      minutes is RECOMMENDED.
</p>
<p>TURN clients and servers MUST NOT include the FINGERPRINT attribute
      in any of the methods defined in this document.
</p>
<a name="allocations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Managing Allocations</h3>

<p>Communications between a TURN client and a TURN server begin with an
      Allocate transaction. All subsequent transactions happen in the context
      of that allocation, and happen on the same 5-tuple. The client refreshes
      allocations and deallocates them using a Refresh transaction.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Client Behavior</h3>

<a name="sec-alloc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1"></a><h3>5.1.1.&nbsp;
Initial Allocate Requests</h3>

<p>When a client wishes to obtain a transport address, it sends an
          Allocate request to the server. This request is constructed and sent
          using the general procedures defined in <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>. Clients MUST implement
          the long term credential mechanism defined in <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>, and be prepared for the
          server to demand credentials for requests.
</p>
<p>The client SHOULD include a BANDWIDTH attribute, which indicates
          the maximum bandwidth that will be used with this binding. If the
          maximum is unknown, the attribute is not included in the
          request.
</p>
<p>The client MAY request a particular lifetime for the allocation
          by including it in the LIFETIME attribute in the request.
</p>
<p>The client MUST include a REQUESTED-TRANSPORT attribute. In this
          specification, the REQUESTED-TRANSPORT MUST always be UDP. This
          attribute is included to allow for future extensions to TURN (e.g.,
          <a class='info' href='#I-D.ietf-behave-turn-tcp'>[I&#8209;D.ietf&#8209;behave&#8209;turn&#8209;tcp]<span> (</span><span class='info'>Perreault, S. and J. Rosenberg, &ldquo;Traversal Using Relays around NAT (TURN) Extensions for TCP Allocations,&rdquo; March&nbsp;2010.</span><span>)</span></a>)
</p>
<p>The client MAY include a REQUESTED-PORT-PROPS or REQUESTED-IP
          attribute in the request to obtain specific types of transport
          addresses, if desired.
</p>
<p>Processing of the response follows the general procedures of
          <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>. A successful
          response will include both a RELAY-ADDRESS and an XOR-MAPPED-ADDRESS
          attribute, providing both a relayed transport address and a
          reflexive transport address, respectively, to the client. The value
          of the LIFETIME attribute in the response indicates the amount of
          time after which the server will expire the allocation, if not
          refreshed with a Refresh request. The server will allow the user to
          send and receive at least the amount of data indicated in the
          BANDWIDTH attribute per allocation. (At its discretion the server
          can optionally discard UDP data above this threshold.)
</p>
<p>If the response is an error response and contains a 442, 443 or
          444 error code, the client knows that its requested properties could
          not be met. The client MAY retry with different properties, with the
          same properties (in a hope that something has changed on the
          server), or give up, depending on the needs of the application.
          However, if the client retries, it SHOULD wait 500ms, and if the
          request fails again, wait 1 second, then 2 seconds, and so on,
          exponentially backing off.
</p>
<a name="sec-refresh"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.2"></a><h3>5.1.2.&nbsp;
Refresh Requests</h3>

<p>TURN permissions are kept alive by traffic flowing through them,
          and persist for the lifetime of the allocation. However, The
          allocations themselves have to be kept alive through Refresh
          Requests.
</p>
<p>Before 3/4 of the lifetime of the allocation has passed (the
          lifetime of the allocation is conveyed in the LIFETIME attribute of
          the Allocate Response), the client SHOULD refresh the allocation
          with a Refresh transaction if it wishes to keep the allocation.
</p>
<p>To perform a refresh, the client generates a Refresh Request. The
          client MUST use the same username, realm and password for the
          Refresh request as it used in its initial Allocate Request. The
          Refresh request MAY contain a proposed LIFETIME attribute. The
          client MAY include a BANDWIDTH attribute if it wishes to request
          more or less bandwidth than in the original request (this might also
          be the first time the TURN client indicates bandwidth to the TURN
          server). If the BANDWIDTH attribute is absent, it indicates no
          change in the requested bandwidth from the Allocate request. The
          client MUST NOT include a REQUESTED-IP, REQUESTED-TRANSPORT, or
          REQUESTED-PORT-PROPS attribute in the Refresh request.
</p>
<p>In a successful response, the LIFETIME attribute indicates the
          amount of additional time (the number of seconds after the response
          is received) that the allocation will live without being refreshed.
          A successful response will also contain a BANDWIDTH attribute,
          indicating the bandwidth the server is allowing for this allocation.
          Note that an error response does not imply that the allocation has
          expired, just that the refresh has failed.
</p>
<p>If a client no longer needs an allocation, it SHOULD perform an
          explicit deallocation. If the client wishes to explicitly remove the
          allocation because it no longer needs it, it sends a Refresh
          request, but sets the LIFETIME attribute to zero. This will cause
          the server to remove the allocation, and all associated permissions
          and channel numbers. For connection-oriented transports such as TCP,
          the client can also remove the allocation (and all associated
          bindings) by closing the relevant connection with the TURN
          server.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Server Behavior</h3>

<a name="sec-initial"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
Receiving an Allocate Request</h3>

<p>When the server receives an Allocate request, the server attempts
          to allocate a relayed transport address.
</p>
<p>When the server receives the Allocate Request, it begins by
          processing it according to the base protocol procedures described in
          <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>, plus the
          Long-Term Credential Mechanism procedures if the server is using
          this mechanism.
</p>
<p>It then checks if the 5-tuple used for the Allocate Request
          matches the 5-tuple used for an existing allocation. If there is a
          match, then:</p>
<ul class="text">
<li>If the transport protocol is UDP, and the transaction id in
              the request message matches the transaction id used for the
              original allocation, then the server treats this as a
              retransmission of the original request, and replies with the
              same response as it did to the original request. The server may
              do this by either storing its original response and resending
              it, or by rebuilding its original response from other state
              data.
</li>
<li>If the transport protocol is not UDP, or if the transaction
              id in the request message does not match the transaction id used
              for the original allocation, then the server replies with an
              error response containing the error code 437 Allocation
              Mismatch.
</li>
</ul><p>If the 5-tuple does not match an existing allocation, then
          processing continues as described below.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1.1"></a><h3>5.2.1.1.&nbsp;
BANDWIDTH</h3>

<p>The server checks for the BANDWIDTH attribute in the request.
            If present, the server determines whether or not it has sufficient
            capacity to handle a binding that will generate the requested
            bandwidth.
</p>
<p>If it does, the server attempts to allocate a transport address
            for the client. The Allocate Request can contain several
            additional attributes that allow the client to request specific
            characteristics of the transport address. If it doesn't, it sends
            an error response.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1.2"></a><h3>5.2.1.2.&nbsp;
REQUESTED-TRANSPORT</h3>

<p>The server checks for the REQUESTED-TRANSPORT attribute. This
            indicates the transport protocol requested by the client. This
            specification defines a value for UDP only, but support for TCP
            allocations is planned in <a class='info' href='#I-D.ietf-behave-turn-tcp'>[I&#8209;D.ietf&#8209;behave&#8209;turn&#8209;tcp]<span> (</span><span class='info'>Perreault, S. and J. Rosenberg, &ldquo;Traversal Using Relays around NAT (TURN) Extensions for TCP Allocations,&rdquo; March&nbsp;2010.</span><span>)</span></a>.
</p>
<p></p>
<blockquote class="text">
<p>As a consequence of the REQUESTED-TRANSPORT attribute, it
                is possible for a client to connect to the server over TCP or
                TLS over TCP and request a UDP transport address. In this
                case, the server will relay data between the transports.
</p>
</blockquote>

<p>If the requested transport is supported, the server allocates a
            port using the requested transport protocol. If the
            REQUESTED-TRANSPORT attribute contains a value of the transport
            protocol unknown to the server, or known to the server but not
            supported by the server in the context of this request, the server
            MUST reject the request and include a 442 (Unsupported Transport
            Protocol) in the response. If the request did not contain a
            REQUESTED-TRANSPORT attribute, the server MUST use the same
            transport protocol as the request arrived on.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1.3"></a><h3>5.2.1.3.&nbsp;
REQUESTED-IP</h3>

<p>The server checks for the REQUESTED-IP attribute. If present,
            it indicates a specific IP address from which the client would
            like its transport address allocated. (The client could do this if
            it requesting the second address in a specific port pair). If this
            IP address is not a valid one for allocations on the server, the
            server MUST reject the request and include a 443 (Invalid IP
            Address) error code in the response, or else redirect the request
            to a server that is known to support this IP address. If the IP
            address is one that is valid for allocations (presumably, the
            server is configured to know the set of IP addresses from which it
            performs allocations), the server MUST provide an allocation from
            that IP address. If the attribute is not present, the selection of
            an IP address is at the discretion of the server.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1.4"></a><h3>5.2.1.4.&nbsp;
REQUESTED-PORT-PROPS</h3>

<p>The server checks for the REQUESTED-PORT-PROPS attribute. If
            present, it indicates specific port properties desired by the
            client. This attribute is split into two portions: one portion for
            port behavior and the other for requested port alignment (whether
            the allocated port is odd, even, reserved as a pair, or at the
            discretion of the server).
</p>
<p>If the port behavior requested is for a Specific Port, the
            server MUST attempt to allocate that specific port for the client.
            If the specific port is not available (in use or reserved), the
            server MUST reject the request with a 444 (Invalid Port) response.
            For example, the STUN server could reject a request for a Specific
            Port because the port is temporarily reserved as part of an
            adjacent pair of ports, or because the requested port is a
            well-known port (1-1023).
</p>
<p>If the client requests "even" port alignment, the server MUST
            attempt to allocate an even port for the client. If an even port
            cannot be obtained, the server MUST reject the request with a 444
            (Invalid Port) response or redirect to an alternate server. If the
            client requests odd port alignment, the server MUST attempt to
            allocate an odd port for the client. If an odd port cannot be
            obtained, the server MUST reject the request with a 444 (Invalid
            Port) response or redirect to an alternate server. Finally, the
            "Even port with hold of the next higher port" alignment is similar
            to requesting an even port. It is a request for an even port, and
            MUST be rejected by the server if an even port cannot be provided,
            or redirected to an alternate server. However, it is also a hint
            from the client that the client will request the next higher port
            with a separate Allocate request. As such, it is a request for the
            server to allocate an even port whose next higher port is also
            available, and furthermore, a request for the server to not
            allocate that one higher port to any other request except for one
            that asks for that port explicitly. The server can honor this
            request for adjacency at its discretion. The only constraint is
            that the allocated port number MUST be even.
</p>
<p></p>
<blockquote class="text">
<p>Port alignment requests exist for compatibility with
                implementations of RTP which predate <a class='info' href='#RFC3550'>[RFC3550]<span> (</span><span class='info'>Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson, &ldquo;RTP: A Transport Protocol for Real-Time Applications,&rdquo; July&nbsp;2003.</span><span>)</span></a>. These implementations use the port
                numbering conventions in (now obsolete) <a class='info' href='#RFC1889'>[RFC1889]<span> (</span><span class='info'>Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson, &ldquo;RTP: A Transport Protocol for Real-Time Applications,&rdquo; January&nbsp;1996.</span><span>)</span></a>.
</p>
</blockquote>

<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1.5"></a><h3>5.2.1.5.&nbsp;
Lifetime</h3>

<p>The server checks for a LIFETIME attribute. If present, it
            indicates the lifetime the client would like the server to assign
            to the allocation.
</p>
<p>If the LIFETIME attribute is malformed, or if the requested
            lifetime value is less than 32 seconds, the server replies with an
            error response with an error code of XXX Lifetime Malformed or
            Invalid.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1.6"></a><h3>5.2.1.6.&nbsp;
Creating the Allocation</h3>

<p>If any of the requested or desired constraints cannot be met,
            whether it be bandwidth, transport protocol, IP address or port,
            the server can redirect the client to a different server that may
            be able to fulfill the request. This is accomplished using the 300
            error response and ALTERNATE-SERVER attribute. If the server does
            not redirect and cannot service the request because the server has
            reached capacity, it sends a 507 (Insufficient Capacity) response.
            The server can also reject the request with a 486 (Allocation
            Quota Reached) if the user or client is not authorized to request
            additional allocations.
</p>
<p>The server SHOULD only allocate ports from the range 49152
            &ndash; 65535 (the Dynamic and/or Private Port range <a class='info' href='#Port-Numbers'>[Port&#8209;Numbers]<span> (</span><span class='info'>, &ldquo;IANA Port Numbers Registry,&rdquo; .</span><span>)</span></a>), unless the TURN server application
            knows, through some means not specified here, that other
            applications running on the same host as the TURN server
            application will not be impacted by allocating ports outside this
            range. This condition can often be satisfied by running the TURN
            server application on a dedicated machine and/or by arranging that
            any other applications on the machine allocate ports before the
            TURN server application starts. In any case, the TURN server
            SHOULD NOT allocate ports in the range 0 - 1023 (the Well-Known
            Port range) to discourage clients from using TURN to run standard
            services.
</p>
<p>Once a port is allocated, the server associates the allocation
            with the 5-tuple used to communicate between the client and the
            server. For TCP, this amounts to associating the TCP connection
            from the TURN client with the allocated transport address.
</p>
<p>The new allocation MUST also be associated with the username,
            password and realm used to authenticate the request. These
            credentials are used in all subsequent requests to ensure that
            only the same client can use or modify the allocation it was
            given.
</p>
<p>In addition, the allocation created by the server is associated
            with a set of permissions and a set of channel bindings. Each set
            is initially empty.
</p>
<p>If the LIFETIME attribute was present in the request, and the
            value is larger than the maximum duration the server is willing to
            use for the lifetime of the allocation, the server MAY lower it to
            that maximum. However, the server MUST NOT increase the duration
            requested in the LIFETIME attribute. If there was no LIFETIME
            attribute, the server may choose a duration at its discretion. Ten
            minutes is RECOMMENDED. In either case, the resulting duration is
            added to the current time, and a timer, called the allocation
            expiration timer, is set to expire at or after that time. Note
            that the LIFETIME attribute in an Allocate request can be zero,
            though this is effectively a no-op, since it will create and
            destroy the allocation in one transaction.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1.7"></a><h3>5.2.1.7.&nbsp;
Sending the Allocate Response</h3>

<p>Once the port has been obtained and the allocation expiration
            timer has been started, the server generates an Allocate Response
            using the general procedures defined in <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>, including the ones
            for long term authentication. The transport address allocated to
            the client MUST be included in the RELAY-ADDRESS attribute in the
            response. In addition, this response MUST contain the
            XOR-MAPPED-ADDRESS attribute. This allows the client to determine
            its reflexive transport address in addition to a relayed transport
            address, from the same Allocate request.
</p>
<p>The server MUST add a LIFETIME attribute to the Allocate
            Response. This attribute contains the duration, in seconds, of the
            allocation expiration timer associated with this allocation.
</p>
<p>The server MUST add a BANDWIDTH attribute to the Allocate
            Response. This MUST be equal to the attribute from the request, if
            one was present. Otherwise, it indicates a per-allocation limit
            that the server is placing on the bandwidth usage on each binding.
            Such limits are needed to prevent against denial-of-service
            attacks (see <a class='info' href='#sec-security'>Section&nbsp;12<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>).
</p>
<a name="sec-subsequent"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
Refresh Requests</h3>

<p>A Refresh request is processed using the general server and long
          term authentication procedures in <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>. It is used to refresh
          and extend an allocation, or to cause an immediate deallocation. It
          is processed as follows.
</p>
<p>First, the request MUST be authenticated using the same shared
          secret as the one associated with the allocation. If the request was
          authenticated but not with such a matching credential, the server
          MUST generate a Refresh Error Response with a 401 response.
</p>
<p>If the Refresh request contains a BANDWIDTH attribute, the server
          checks that it can relay the requested volume of traffic.
</p>
<p>Finally, a Refresh Request will set a new allocation expiration
          timer for the allocation, effectively canceling the previous
          allocation expiration timer. As with an Allocate request, the server
          MAY utilize a shorter allocation lifetime, but MUST NOT utilize a
          longer lifetime.
</p>
<p>A success Refresh response MUST contain a LIFETIME attribute. If
          its associated Allocate request contained the BANDWIDTH attribute,
          or this Refresh request contained a new BANDWIDTH attribute, the
          response MUST also contain the BANDWIDTH attribute.
</p>
<a name="sec-sendanddata"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Send and Data Indications</h3>

<p>TURN supports two ways to send and receive data from peers. This
      section describes the use of Send and Data indications, while <a class='info' href='#sec-channels'>Section&nbsp;7<span> (</span><span class='info'>Channel Mechanism</span><span>)</span></a> describes the use of the Channel
      Mechanism.
</p>
<a name="sec-forming-indication"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Forming and Sending an Indication</h3>

<p>When the client has data to send to a peer, it uses a Send
        Indication to pass the data to the server. When the server has data to
        send to the client, it uses a Data Indication to pass the data to the
        client. A client can also use a Send Indication without a DATA
        attribute to install or refresh a permission for the specified IP
        address. Both indications are formed following the general rules
        described in [ref 3489bis] with the extra considerations described
        below.
</p>
<p>A Send Indication MUST contain a PEER-ADDRESS attribute and MAY
        contain a DATA attribute, while a Data Indication MUST contain both
        attributes. The PEER-ADDRESS attribute contains the transport address
        of the peer to which the data is to be sent (in the case of a Send
        Indication) or from which the data was received (in the case of a Data
        Indication). This peer address is the transport address of the peer as
        seen by the server, which may not be the same as the host transport
        address of the peer. The DATA attribute contains the actual
        application data. Note that the application data may need to be padded
        to ensure the DATA attribute length is a multiple of 4.
</p>
<p>No other attributes are included. For example, neither the
        FINGERPRINT attribute nor any authentication attributes are included.
        The latter holds even if the server is using the Long-Term Credential
        Mechanism, since indications cannot be authenticated using this
        mechanism.
</p>
<p>Both the Send and Data indications MUST be sent using the 5-tuple
        of the original allocation. Thus, in the case of the Send Indication,
        the source transport address is the client&rsquo;s host transport
        address, the destination transport address is the TURN server address,
        and the transport protocol is the same as was used for the Allocate
        request. For the Data Indication, the source and destination transport
        addresses are the reverse.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Receiving an Indication</h3>

<p>When a Send Indication is received at the server, or a Data
        Indication is received at the client, the receiver first does the
        basic indication processing described in [3489bis]. Once this is done,
        it does the processing specific to the Send and Data methods described
        below.
</p>
<p>A Send Indication MUST contain a PEER-ADDRESS attribute and MAY
        contain a DATA attribute, while a Data Indication MUST contain both
        attributes. Any other attributes appearing in the message are treated
        as unexpected.
</p>
<p></p>
<blockquote class="text">
<p>TODO: Add check that Send or Data indication arrives with
            appropriate 5-tuple. Since this check applies to all STUN
            messages, not just Send and Data indications, perhaps this goes
            under the general processing section.
</p>
</blockquote>

<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Relaying</h3>

<p>When the server receives a valid Send Indication contains a DATA
        attribute, it forms a UDP datagram as follows:</p>
<ul class="text">
<li>the source transport address is the relayed transport address
            of the allocation, where the allocation is determined by the
            5-tuple on which the Send Indication arrived;
</li>
<li>the destination transport address is taken from the
            PEER-ADDRESS attribute;
</li>
<li>the data following the UDP header is the contents of the value
            field of the DATA attribute;
</li>
<li>the Length field in the UDP header is set to the Length field
            of the DATA attribute;
</li>
<li>the Checksum field in the UDP header is computed as described
            in [RFC 768].
</li>
</ul><p>The resulting UDP datagram is then sent to the peer.
</p>
<p>When the server receives a valid Send Indication (with or without a
        DATA attribute), it also updates the permission associated with the IP
        address contained in the PEER-ADDRESS attribute. For a certain
        interval after the permission is updated, UDP datagrams received from
        peers with source IP address equal to the IP address contained in the
        PEER-ADDRESS attribute can be forwarded to the client. Note that only
        the IP addresses are considered and the port numbers are irrelevent.
        This permission is specific to the allocation and has no affect on any
        other allocation. The recommended length of time is 60 seconds from
        when the Send Indication is received.
</p>
<p>When the server receives a UDP datagram with a destination
        transport address corresponding to an active (i.e., still alive)
        allocation, then it first checks to see if it is permitted to relay
        the datagram. If it is not permitted, the UDP datagram MUST be
        discarded.
</p>
<p>If relaying is permitted, the server forms and send a Data
        Indication as described in <a class='info' href='#sec-forming-indication'>Section&nbsp;6.1<span> (</span><span class='info'>Forming and Sending an Indication</span><span>)</span></a>, using the data following the
        UDP header as the application data.
</p>
<a name="sec-channels"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Channel Mechanism</h3>

<p>As described in the overview, channel mechanism provides a way for a
      client and server to send application data using ChannelData messages,
      which have less overhead than Send and Data indications.
</p>
<p>Channel bindings are always initiated by the client. The client can
      bind a channel to a peer at any time during the lifetime of the
      allocation. The client may bind a channel to a peer before exchanging
      data with it, or after exchanging data with it (using Send and Data
      indications) for some time, or may choose never to bind a channel it.
      The client can also bind channels to some peers while not binding
      channels to other peers.
</p>
<p>Once a channel is bound to a peer, the channel binding cannot be
      changed. There is no way to unbind a channel or bind it to a different
      peer.
</p>
<p>Channel bindings are specific to an allocation, so that a binding in
      one allocation has no relationship to a binding in any other allocation.
      If an allocation expires, all its channel bindings expire with it.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Forming and Sending a ChannelBind Request</h3>

<p>When a client wishes to bind a channel to a peer in an allocation,
        it forms a ChannelBind Request. The Request formed following the
        general rules described in <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a> with the extra
        considerations described below.
</p>
<p>A ChannelBind Request MUST contain both a CHANNEL-NUMBER attribute
        and a PEER-ADDRESS attribute. The CHANNEL-NUMBER attribute specifies
        the number of the channel that the client wishes to bind to the peer.
        The channel number MUST be in the range 0x4000 to 0xFFFE (inclusive)
        and the channel MUST NOT be already bound to a different peer. It is
        acceptable to rebind a channel to the peer it is already bound to. The
        PEER-ADDRESS attribute specifies the peer address to bind the channel
        to.
</p>
<p>Once formed, the ChannelBind Request is sent using the 5-tuple for
        the allocation.
</p>
<p>The client SHOULD be prepared to receive ChannelData messages on
        the channel as soon as it has sent the ChannelBind Request. Over UDP,
        it is possible for the client to receive these before it receives a
        ChannelBind Success Response. 
</p>
<p>Over UDP, the client SHOULD NOT send ChannelData messages on the
        channel until it has received a ChannelBind Success Response for the
        binding attempt. Sending them before the success response is received
        risks having them dropped by the server if he ChannelBind Request was
        lost.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Receiving a ChannelBind Request and Sending a Response</h3>

<p>When the server receives a ChannelBind Request, it first does the
        basic request processing described in <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>. Once this is done, it
        does the processing specific to the ChannelBind method described
        below.
</p>
<p>The server checks that the ChannelBind Request contains both a
        CHANNEL-NUMBER attribute and a PEER-ADDRESS attribute. If the
        PEER-ADDRESS attribute is missing or malformed, then the server
        rejects the request with an Error Response containing the error code
        XXX &ldquo;Peer address missing or invalid&rdquo;. If the
        CHANNEL-NUMBER attribute is missing or malformed, or the channel
        number is not in the range 0x4000 to 0xFFFE (inclusive), or the
        channel is already bound to another peer (already bound to the same
        peer is OK) the server rejects the request with an Error Response
        containing the error code XXX &ldquo;Channel number missing or
        invalid&rdquo;. Otherwise, if no errors are detected, the server
        replies with a ChannelBind Success Response.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Receiving a ChannelBind Response</h3>

<p>When the client receives a ChannelBind response (either success or
        error), it processes it as specified in [3489bis]. Any additional
        processing is implementation specific.
</p>
<a name="sec-channeldata-msg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
The ChannelData Message</h3>

<p>The ChannelData message is used to carry application data between
        the client and the server. It has the following format:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Channel Number        |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                       Application Data                        /
/                                                               /
|                                                               |
|                               +-------------------------------+
|                               |
+-------------------------------+</pre></div>
<p>The Channel Number field specifies the number of the channel on
        which the data is traveling, and thus the address of the peer that is
        sending or is to receive the data. The channel number MUST be in the
        range 0x4000 &ndash; 0xFFFF, with channel number 0xFFFF being reserved
        for possible future extensions.
</p>
<p>Channel numbers 0x0000 &ndash; 0x3FFF cannot be used because bits 0
        and 1 are used to distinguish ChannelData messages from STUN-formatted
        messages (i.e., Allocate, Send, Data, ChannelBind, etc).
        STUN-formatted messages always have bits 0 and 1 as &ldquo;00&rdquo;,
        while ChannelData messages use combinations &ldquo;01&rdquo;,
        &ldquo;10&rdquo;, and &ldquo;11&rdquo;.
</p>
<p>The Length field specifies the length in bytes of the application
        data field (i.e., it does not include the size of the ChannelData
        header). Note that 0 is a valid length.
</p>
<p>The Application Data field carries the data the client is trying to
        send to the peer, or that the peer is sending to the client.
</p>
<a name="sec-sending-channeldata-msg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5"></a><h3>7.5.&nbsp;
Forming and Sending a ChannelData Message</h3>

<p>Once a client has bound a channel to a peer, then when the client
        has data to send to that peer it may use either a ChannelData message
        or a Send Indication; that is, the client is not obligated to use the
        channel when it exists and may freely intermix the two message types
        when sending data to the peer. The server, on the other hand, SHOULD
        use the ChannelData message if a channel has been bound to the
        peer.
</p>
<p>The fields of the ChannelData message are filled in as described in
        <a class='info' href='#sec-channeldata-msg'>Section&nbsp;7.4<span> (</span><span class='info'>The ChannelData Message</span><span>)</span></a>.
</p>
<p>Over stream transports, the ChannelData message MUST be padded to a
        multiple of four bytes in order to ensure the alignment of subsequent
        messages. The padding is not reflected in the length field of the
        ChannelData message, so the actual size of a ChannelData message
        (including padding) is (4 + Length) rounded up to the nearest multiple
        of 4. Over UDP, the padding is not required but MAY be included.
</p>
<p>The ChannelData message is then sent on the 5-tuple associated with
        the allocation.
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.6"></a><h3>7.6.&nbsp;
Receiving a ChannelData Message</h3>

<p>The receiver of the ChannelData message uses bits 0 and 1 to
        distinguish it from STUN-formatted messages, as described in <a class='info' href='#sec-channeldata-msg'>Section&nbsp;7.4<span> (</span><span class='info'>The ChannelData Message</span><span>)</span></a>.
</p>
<p>If the ChannelData message is received in a UDP datagram, and if
        the UDP datagram is too short to contain the claimed length of the
        ChannelData message (i.e., the UDP header length field value is less
        than the ChannelData header length field value + 4 + 8), then the
        message is silently discarded.
</p>
<p>If the ChannelData message is received over TCP or over TLS over
        TCP, then the actual length of the ChannelData message is as described
        in <a class='info' href='#sec-sending-channeldata-msg'>Section&nbsp;7.5<span> (</span><span class='info'>Forming and Sending a ChannelData Message</span><span>)</span></a>.
</p>
<p>If the ChannelData message is received on a channel which is not
        bound to any peer, then the message is silently discarded.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.7"></a><h3>7.7.&nbsp;
Relaying</h3>

<p>When the server receives a valid ChannelData message, it forms a
        UDP datagram as follows: the source transport address is the relayed
        transport address of the allocation, where the allocation is
        determined by the 5-tuple on which the ChannelData message arrived;
        the destination transport address is the peer address to which the
        channel is bound; the data following the UDP header is the contents of
        the data field of the ChannelData message; the Length field in the UDP
        header is set to the Length field of the ChannelData message + 8; and
        the Checksum field in the UDP header is computed as described in [RFC
        768]. The resulting UDP datagram is then sent to the peer.
</p>
<p>The server also updates the permission associated with the IP
        address part of the peer address to which the UDP datagram is
        sent.
</p>
<p>When the server receives a UDP datagram with a destination
        transport address corresponding to an active (i.e., still alive)
        allocation, then it first checks to see if it is permitted to relay
        the datagram. If the allocation contains an active permission for the
        source IP address (from the IP header) of the received UDP datagram,
        then the UDP datagram is permitted. Otherwise, the UDP datagram MUST
        be discarded.
</p>
<p>To relay the UDP datagram, the server forms and send a ChannelData
        message as described in <a class='info' href='#sec-sending-channeldata-msg'>Section&nbsp;7.5<span> (</span><span class='info'>Forming and Sending a ChannelData Message</span><span>)</span></a>
</p>
<a name="sec-stun-methods"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
New STUN Methods</h3>

<p>This section lists the codepoints for the new STUN methods defined in
      this specification. See elsewhere in this document for the semantics of
      these new methods.
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>  Request/Response Transactions
    0x003  :  Allocate
    0x004  :  Refresh

  Indications
    0x006  :  Send
    0x007  :  Data
</pre></div>
<a name="sec-stun-attributes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
New STUN Attributes</h3>

<p>This STUN extension defines the following new
        attributes:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  0x000C: CHANNEL-NUMBER
  0x000D: LIFETIME
  0x0010: BANDWIDTH
  0x0012: PEER-ADDRESS
  0x0013: DATA
  0x0016: RELAY-ADDRESS
  0x0018: REQUESTED-PORT-PROPS
  0x0019: REQUESTED-TRANSPORT
  0x0022: REQUESTED-IP
</pre></div>
<a name="channelnums"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
CHANNEL-NUMBER</h3>

<p>The CHANNEL-NUMBER attribute contains the number of the channel. It
        is a 16-bit unsigned integer, followed by a two-octet RFFU field which
        MUST be set to 0 on transmission and ignored on reception.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |        Channel Number         |         RFFU                  |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
LIFETIME</h3>

<p>The lifetime attribute represents the duration for which the server
        will maintain an allocation in the absence of a refresh. It is a 32
        bit unsigned integral value representing the number of seconds
        remaining until expiration.
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3"></a><h3>9.3.&nbsp;
BANDWIDTH</h3>

<p>The bandwidth attribute represents the peak bandwidth, measured in
        kilobits per second, that the client expects to use on the allocation
        in each direction.
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.4"></a><h3>9.4.&nbsp;
PEER-ADDRESS</h3>

<p>The PEER-ADDRESS specifies the address and port of the peer as seen
        from the TURN server. It is encoded in the same way as
        XOR-MAPPED-ADDRESS.
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.5"></a><h3>9.5.&nbsp;
DATA</h3>

<p>The DATA attribute is present in most Send Indications and Data
        Indications. It contains raw payload data that is to be sent (in the
        case of a Send Request) or was received (in the case of a Data
        Indication).
</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.6"></a><h3>9.6.&nbsp;
RELAY-ADDRESS</h3>

<p>The RELAY-ADDRESS is present in Allocate responses. It specifies
        the address and port that the server allocated to the client. It is
        encoded in the same way as XOR-MAPPED-ADDRESS.
</p>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.7"></a><h3>9.7.&nbsp;
REQUESTED-PORT-PROPS</h3>

<p>This attribute allows the client to request certain properties for
        the port that is allocated by the server. The attribute can be used
        with any transport protocol that has the notion of a 16 bit port space
        (including TCP and UDP). The attribute is 32 bits long. Its format
        is:
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |       Reserved = 0        | A |    Specific Port Number       |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>The two bits labeled A in the diagram above are for requested port
        alignment and have the following meaning:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  00  no specific port alignment
  01  odd port number
  10  even port number
  11  even port number; reserve next higher port
</pre></div>
<p>If the value of the A field is 00 (no specific port alignment),
        then the Specific Port Number field can either be 0 or some non-zero
        port number. If the Specific Port Number field is 0, then the client
        is not putting any restrictions on the port number it would like
        allocated. If the Specific Port Number is some non-zero port number,
        then the client is requesting that the server allocate the specified
        port and the server MUST provide that port.
</p>
<p>If the value of the A field is 01 (odd port number), then the
        Specific Port Number field MUST be zero, and the client is requesting
        the server allocate an odd-numbered port. The server MUST provide an
        odd port number.
</p>
<p>If the value of the A field is 10 (even port number), then the
        Specific Port number field MUST be zero, and the client is requesting
        the server allocate an even-numbered port. The server MUST provide an
        even port number.
</p>
<p>If the value of the A field is 11 (even port number; reserve next
        higher port), then the Specific Port Number field MUST be zero, and
        the client is requesting the server allocate an even-numbered port.
        The server MUST return an even port number. In addition, the client is
        requesting the server reserve the next higher port (i.e., N+1 if the
        server allocates port N). The server SHOULD only allocate the N+1 port
        number if it is explicitly requested (with a subsequent request
        specifying that exact port number by the same TURN client, over a
        different alllocation).
</p>
<p>In all cases, if a port with the requested properties cannot be
        allocated, the server MUST respond with a error response with an error
        code of 444 (Invalid Port).
</p>
<a name="sec-requested-transport"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.8"></a><h3>9.8.&nbsp;
REQUESTED-TRANSPORT</h3>

<p>This attribute is used by the client to request a specific
        transport protocol for the allocated transport address. It has the
        following format:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |    Protocol   |                    RFFU                       |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>The Protocol field specifies the desired protocol. The codepoints
        used in this field are taken from those allowed in the Protocol field
        in the IPv4 header and the NextHeader field in the IPv6 header <a class='info' href='#Protocol-Numbers'>[Protocol&#8209;Numbers]<span> (</span><span class='info'>, &ldquo;IANA Protocol Numbers Registry,&rdquo; 2005.</span><span>)</span></a>. This specification only allows the
        use of codepoint 17 (User Datagram Protocol).
</p>
<p>The RFFU field is set to zero on transmission and ignored on
        receiption. It is reserved for future uses.
</p>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.9"></a><h3>9.9.&nbsp;
REQUESTED-IP</h3>

<p>The REQUESTED-IP attribute is used by the client to request that a
        specific IP address be allocated by the TURN server. This attribute is
        needed since it is anticipated that TURN servers will be multi-homed
        so as to be able to allocate more than 64k transport addresses. As a
        consequence, a client needing a second transport address on the same
        interface as a previous one can use this attribute to request a remote
        address from the same TURN server interface as the TURN client's
        previous remote address.
</p>
<p>The format of this attribute is identical to XOR-MAPPED-ADDRESS.
        However, the port component of the attribute MUST be ignored by the
        server. If a client wishes to request a specific IP address and port,
        it uses both the REQUESTED-IP and REQUESTED-PORT-PROPS attributes.
</p>
<a name="sec-stun-errors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
New STUN Error Response Codes</h3>

<p>This document defines the following new error response codes:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>437</dt>
<dd>(Allocation Mismatch): A request was received by
          the server that requires an allocation to be in place, but there is
          none, or a request was received which requires no allocation, but
          there is one.
</dd>
<dt>442</dt>
<dd>(Unsupported Transport Protocol): The Allocate
          request asked for a transport protocol to be allocated that is not
          supported by the server. If the server is aware of another server
          that supports the requested protocol, it SHOULD include the other
          server's address in an ALTERNATE-SERVER attribute in the error
          response.
</dd>
<dt>443</dt>
<dd>(Invalid IP Address): The Allocate request asked
          for a transport address to be allocated from a specific IP address
          that is not valid on the server.
</dd>
<dt>444</dt>
<dd>(Invalid Port): The Allocate request asked for a
          port to be allocated that is not available on the server.
</dd>
<dt>486</dt>
<dd>(Allocation Quota Reached): The user or client is
          not authorized to request additional allocations.
</dd>
<dt>(tbd)</dt>
<dd>(Channel Number Missing or Invalid): The request
          requires a channel number, but the CHANNEL-NUMBER attribute is
          missing, or the specified channel number is invalid in some way.
</dd>
<dt>(tbd)</dt>
<dd>(Peer Address Missing or Invalid): The request
          requires a peer transport address, but the PEER-ADDRESS attribute is
          missing, or the specified peer transport address is invalid in some
          way.
</dd>
<dt>(tbd)</dt>
<dd>(Lifetime Malformed or Invalid): The LIFETIME
          attribute is malformed or the specified lifetime is invalid in some
          way.
</dd>
<dt>507</dt>
<dd>(Insufficient Capacity): The server cannot
          allocate a new port for this client as it has exhausted its relay
          capacity.
</dd>
</dl></blockquote>

<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Client Discovery of TURN Servers</h3>

<p>The STUN extensions introduced by TURN differ from the binding
      requests defined in <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a> in
      that they are sent with additional framing and demand substantial
      resources from the TURN server. In addition, it seems likely that
      administrators might want to block connections from clients to the TURN
      server for relaying separately from connections for the purposes of
      binding discovery. As a consequence, TURN runs on a separate port from
      STUN. The client discovers the address and port of the TURN server using
      the same DNS procedures defined in <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>, but using an SRV service
      name of "turn" (or "turns" for TURN over TLS) instead of just
      "stun".
</p>
<p>For example, to find TURN servers in the example.com domain, the TURN
      client performs a lookup for '_turn._udp.example.com',
      '_turn._tcp.example.com', and '_turns._tcp.example.com' if the STUN
      client wants to communicate with the TURN server using UDP, TCP, or TLS
      over TCP, respectively.
</p>
<a name="sec-security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Security Considerations</h3>

<p>TURN servers allocate bandwidth and port resources to clients, in
      contrast to the Binding method defined in <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>. Therefore, a TURN server
      requires authentication and authorization of STUN requests. This
      authentication is provided by mechanisms defined in the STUN
      specification itself, in particular digest authentication.
</p>
<p>Because TURN servers allocate resources, they can be susceptible to
      denial-of-service attacks. All Allocate transactions are authenticated,
      so that an unknown attacker cannot launch an attack. An authenticated
      attacker can generate multiple Allocate Requests, however. To prevent a
      single malicious user from allocating all of the resources on the
      server, it is RECOMMENDED that a server implement a modest per user
      limit on the amount of bandwidth that can be allocated. Such a mechanism
      does not prevent a large number of malicious users from each requesting
      a small number of allocations. Attacks such as these are possible using
      botnets, and are difficult to detect and prevent. Implementors of TURN
      should keep up with best practices around detection of anomalous botnet
      attacks.
</p>
<p>A client will use the transport address learned from the
      RELAY-ADDRESS attribute of the Allocate Response to tell other users how
      to reach them. Therefore, a client needs to be certain that this address
      is valid, and will actually route to them. Such validation occurs
      through the message integrity checks provided in the Allocate response.
      They can guarantee the authenticity and integrity of the allocated
      addresses. Note that TURN is not susceptible to the attacks described in
      Section 12.2.3, 12.2.4, 12.2.5 or 12.2.6 of <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a> [[TODO: Update section
      number references to 3489bis]]. These attacks are based on the fact that
      a STUN server mirrors the source IP address, which cannot be
      authenticated. STUN does not use the source address of the Allocate
      Request in providing the RELAY-ADDRESS, and therefore, those attacks do
      not apply.
</p>
<p>TURN cannot be used by clients for subverting firewall policies. TURN
      has fairly limited applicability, requiring a user to explicitly
      authorize permission to receive data from a peer, one IP address at a
      time. Thus, it does not provide a general technique for externalizing
      sockets. Rather, it has similar security properties to the placement of
      an address-restricted NAT in the network, allowing messaging in from a
      peer only if the internal client has sent a packet out towards the IP
      address of that peer. This limitation means that TURN cannot be used to
      run web servers, email servers, SIP servers, or other network servers
      that service a large number of clients. Rather, it facilitates
      rendezvous of NATted clients that use some other protocol, such as SIP,
      to communicate IP addresses and ports for communications.
</p>
<p>Confidentiality of the transport addresses learned through Allocate
      transactions does not appear to be that important. If required, it can
      be provided by running TURN over TLS.
</p>
<p>TURN does not and cannot guarantee that UDP data is delivered in
      sequence or to the correct address. As most TURN clients will only
      communicate with a single peer, the use of a single channel number will
      be very common. Consider an enterprise where Alice and Bob are involved
      in separate calls through the enterprise NAT to their corporate TURN
      server. If the corporate NAT reboots, it is possible that Bob will
      obtain the exact NAT binding originally used by Alice. If Alice and Bob
      were using identical channel numbers, Bob will receive unencapsulated
      data intended for Alice and will send data accidentally to Alice's peer.
      This is not a problem with TURN. This is precisely what would happen if
      there was no TURN server and Bob and Alice instead provided a (STUN)
      reflexive transport address to their peers. If detecting this
      misdelivery is a problem, the client and its peer need to use message
      integrity on their data.
</p>
<p>One TURN-specific DoS attack bears extra discussion. An attacker who
      can corrupt, drop, or cause the loss of a Send or Data indication sent
      over UDP, and then forge a Channel Confirmation indication for the
      corresponding channel number, can cause a TURN client (server) to start
      sending unencapsulated data that the server (client) will discard. Since
      indications are not integrity protected, this attack is not prevented by
      cryptographic means. However, any attacker who can generate this level
      of network disruption could simply prevent a large fraction of the data
      from arriving at its destination, and therefore protecting against this
      attack does not seem important. The ChannelConfirmation forging attack
      is not possible when the client to server communication is over TCP or
      TLS over TCP.
</p>
<p>Relay servers are useful even for users not behind a NAT. They can
      provide a way for truly anonymous communications. A user can cause a
      call to have its media routed through a TURN server, so that the user's
      IP addresses are never revealed.
</p>
<p>Any relay addresses learned through an Allocate request will not
      operate properly with <a class='info' href='#RFC4302'>IPSec Authentication Header
      (AH)<span> (</span><span class='info'>Kent, S., &ldquo;IP Authentication Header,&rdquo; December&nbsp;2005.</span><span>)</span></a> [RFC4302] in transport or tunnel mode. However, tunnel-mode <a class='info' href='#RFC4303'>IPSec ESP<span> (</span><span class='info'>Kent, S., &ldquo;IP Encapsulating Security Payload (ESP),&rdquo; December&nbsp;2005.</span><span>)</span></a> [RFC4303] should still operate.
</p>
<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
IANA Considerations</h3>

<p>Since TURN is an extension to STUN <a class='info' href='#I-D.ietf-behave-rfc3489bis'>[I&#8209;D.ietf&#8209;behave&#8209;rfc3489bis]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for (NAT) (STUN),&rdquo; July&nbsp;2008.</span><span>)</span></a>, the methods, attributes and
      error codes defined in this specification are new method, attributes,
      and error codes for STUN. This section directs IANA to add these new
      protocol elements to the IANA registry of STUN protocol elements.
</p>
<p>The codepoints for the new STUN methods defined in this specification
      are listed in <a class='info' href='#sec-stun-methods'>Section&nbsp;8<span> (</span><span class='info'>New STUN Methods</span><span>)</span></a>.
</p>
<p>The codepoints for the new STUN attributes defined in this
      specification are listed in <a class='info' href='#sec-stun-attributes'>Section&nbsp;9<span> (</span><span class='info'>New STUN Attributes</span><span>)</span></a>.
</p>
<p>The codepoints for the new STUN error codes defined in this
      specification are listed in <a class='info' href='#sec-stun-errors'>Section&nbsp;10<span> (</span><span class='info'>New STUN Error Response Codes</span><span>)</span></a>.
</p>
<p>Extensions to TURN can be made through IETF consensus.
</p>
<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
IAB Considerations</h3>

<p>The IAB has studied the problem of "Unilateral Self Address Fixing",
      which is the general process by which a client attempts to determine its
      address in another realm on the other side of a NAT through a
      collaborative protocol reflection mechanism <a class='info' href='#RFC3424'>[RFC3424]<span> (</span><span class='info'>Daigle, L. and IAB, &ldquo;IAB Considerations for UNilateral Self-Address Fixing (UNSAF) Across Network Address Translation,&rdquo; November&nbsp;2002.</span><span>)</span></a>. The TURN extension is an example of a protocol
      that performs this type of function. The IAB has mandated that any
      protocols developed for this purpose document a specific set of
      considerations.
</p>
<p>TURN is an extension of the STUN protocol. As such, the specific
      usages of STUN that use the TURN extensions need to specifically address
      these considerations. Currently the only STUN usage that uses TURN is
      <a class='info' href='#I-D.ietf-mmusic-ice'>ICE<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> [I&#8209;D.ietf&#8209;mmusic&#8209;ice].
</p>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15"></a><h3>15.&nbsp;
Example</h3>

<p>TBD
</p>
<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16"></a><h3>16.&nbsp;
Changes from Previous Versions</h3>

<p>Note to RFC Editor: Please remove this section prior to publication
      of this document as an RFC.
</p>
<p>This section lists the changes between the various versions of this
      specification.
</p>
<a name="anchor38"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16.1"></a><h3>16.1.&nbsp;
Changes from -05 to -06</h3>

<p></p>
<ul class="text">
<li>Changed the mechanism for allocating channels to the one
            proposed by Eric Rescorla at the Dec 2007 IETF meeting.
</li>
<li>Removed the framing mechanism (which was used to frame all
            messages) and replaced it with the ChannelData message. As part of
            this change, noted that the demux of ChannelData messages from
            TURN messages can be done using the first two bits of the
            message.
</li>
<li>Rewrote the sections on transmitted and receiving data as a
            result of the above to changes, splitting it into a section on
            Send and Data Indications and a separate section on channels.
</li>
<li>Clarified the handling of Allocate Request messages. In
            particular, subsequent Allocate Request messages over UDP with the
            same transaction id are not an error but a retransmission.
</li>
<li>Restricted the range of ports available for allocation to the
            Dynamic and/or Private Port range, and noted when ports outside
            this range can be used.
</li>
<li>Changed the format of the REQUESTED-TRANSPORT attribute. The
            previous version used 00 for UDP and 01 for TCP; the new version
            uses protocol numbers from the IANA protocol number registry. The
            format of the attribute also changed.
</li>
<li>Made a large number of changes to the non-normative portion of
            the document to reflect technical changes and improve the
            presentation.
</li>
<li>Added the Issues section.
</li>
</ul>

<a name="anchor39"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16.2"></a><h3>16.2.&nbsp;
Changes from -04 to -05</h3>

<p></p>
<ul class="text">
<li>Removed the ability to allocate addresses for TCP relaying.
            This is now covered in a separate document. However, communication
            between the client and the server can still run over TCP or
            TLS/TCP. This resulted in the removal of the Connect method and
            the TIMER-VAL and CONNECT-STAT attributes.
</li>
<li>Added the concept of channels. All communication between the
            client and the server flows on a channel. Channels are numbered
            0..65535. Channel 0 is used for TURN messages, while the remaining
            channels are used for sending unencapsulated data to/from a remote
            peer. This concept adds a new Channel Confirmation method and a
            new CHANNEL-NUMBER attribute. The new attribute is also used in
            the Send and Data methods.
</li>
<li>The framing mechanism formally used just for stream-oriented
            transports is now also used for UDP, and the former Type and
            Reserved fields in the header have been replaced by a Channel
            Number field. The length field is zero when running over UDP.
</li>
<li>TURN now runs on its own port, rather than using the STUN port.
            The use of channels requires this.
</li>
<li>Removed the SetActiveDestination concept. This has been
            replaced by the concept of channels.
</li>
<li>Changed the allocation refresh mechanism. The new mechanism
            uses a new Refresh method, rather than repeating the Allocation
            transaction.
</li>
<li>Changed the syntax of SRV requests for secure transport. The
            new syntax is "_turns._tcp" rather than the old "_turn._tls". This
            change mirrors the corresponding change in STUN SRV syntax.
</li>
<li>Renamed the old REMOTE-ADDRESS attribute to PEER-ADDRESS, and
            changed it to use the XOR-MAPPED-ADDRESS format.
</li>
<li>Changed the RELAY-ADDRESS attribute to use the
            XOR-MAPPED-ADDRESS format (instead of the MAPPED-ADDRESS
            format)).
</li>
<li>Renamed the 437 error code from "No Binding" to "Allocation
            Mismatch".
</li>
<li>Added a discussion of what happens if a client's public binding
            on its outermost NAT changes.
</li>
<li>The document now consistently uses the term "peer" as the name
            of a remote endpoint with which the client wishes to
            communicate.
</li>
<li>Rewrote much of the document to describe the new concepts. At
            the same time, tried to make the presentation clearer and less
            repetitive.
</li>
</ul>

<a name="sec-issues"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.17"></a><h3>17.&nbsp;
Issues</h3>

<p>NOTE to RFC Editor: Please remove this section prior to publication
      of this document as an RFC.
</p>
<p>This section lists the open and now closed issues in this document.
      The descriptions here are brief, and the reader should consult the
      corresponding thread on the mailing list for a more in-depth description
      of the issue and the resolutions being considered.
</p>
<a name="anchor40"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.17.1"></a><h3>17.1.&nbsp;
Open Issues</h3>

<p></p>
<ol class="text">
<li>Bandwidth: What should we do with the BANDWIDTH attribute,
            which is currently ill-specified? Should we remove it? Or should
            we try to come up with a good specification, perhaps using ideas
            from RSVP?
</li>
<li>Permission Policy: What should the permission policy be?
            Address-restricted, as is currently specified in the document? Or
            address-and-port-restricted, as many firewalls implement today? Or
            should we leave this open to the implementor, under the assumption
            that the IT administrator will only allow clients to contact those
            servers that implement whatever permission policy the IT
            administrator can accept?
</li>
<li>Port Adjacency: The spec currently allows a client to request
            that the server allocate a port and also reserve the next higher
            port number for a possible future allocation (on a different
            5-tuple). However, the exact behavior of the server in this case
            is ill-specified. For example, must the next-higher-port be
            available for the allocation of the lower port number to succeed?
            How long is the next-higher-port reserved? 30 seconds? For the
            lifetime of the lower-numbered-port's allocation? Or should we
            just ditch this feature, since it is difficult to implement, it is
            at odds with port randomization, and paired port numbers
            applications don't work well with NATs anyway?
</li>
<li>Demuxing ChannelData messages: How does a client or server
            demux STUN-formatted messages from ChannelData messages? Does it
            use the first two bits (as currently specified) or just one bit?
            And how many channels do we need anyway? Some people are
            questioning the need for any more than 200 channels. If we don't
            need many channels, then the demux algorithm might become
            simpler.
</li>
<li>Deallocating Channels: Do we need a mechanism for deallocating
            channels? Some have argued for this feature, because a TURN server
            administrator will want a way to recover resources for channels no
            longer in active use. If yes, then what is the mechanism? For
            example, should a channel binding expire when the corresponding
            permission expires?
</li>
<li>Permissions and Channel Allocations: Should allocating a
            channel for a peer automatically install a permission for that
            peer's IP address?
</li>
<li>Permission and Allocation Lifetimes: What should the default
            permission lifetime be? Should there be a minumum value? Should
            there be a way for the client to modify the permission lifetime?
            Should there be a way for the client to learn the current
            permission lifetime? And what is the relationship of the
            permission lifetime to the allocation lifetime? Does it make sense
            for the allocation lifetime to be less than the permission
            lifetime?
</li>
<li>Preserving bits in the IP header: What bits (if any) should be
            preserved in the IP header when a packet is relayed by the server?
            The bits under consideration are currently the Don't Fragment (DF)
            bit, the Explicit Congestion Notification (ECN) bits, and the
            DiffServ (DS) bits.
</li>
<li>Exceeding the Path MTU Size: TURN adds an overhead of 4 bytes
            (ChannelData msg) or 36 bytes (Send or Data Indication), thus
            potentially exceeding the path MTU between the client and server.
            This could either cause IP fragmentation, or cause the packet to
            be dropped if the DF bit is set. Who handles this problem? Does
            TURN need to handle this, or is this left up to the application to
            handle?
</li>
<li>Allowed PEER-ADDRESS values: Should there be any restrictions
            on the IP address the client can specify in the PEER-ADDRESS
            attribute? Are multicast addresses allowed? What about 0.0.0.0?
            Any other restrictions?
</li>
<li>Discarding UDP datagrams: If the server discards a received UDP
            datagram on the relayed transport address (because there is no
            corresponding permission), then does the server send an ICMP
            response? If so, what error code does it use? (What does RFC 4787
            say about the corresponding situation in NATs? I believe many NATs
            silently discard these packets by default, or have a "stealth
            mode" that enables this behavior.)
</li>
<li>Authentication: Is the use of STUN's Long-Term Authentication
            Mechanism by a TURN server mandatory? The document currently
            implicitly assumes "yes", but what about someone who wants to
            operate a public TURN server?
</li>
<li>Re-using the 5-tuple: If an allocation expires, is there any
            reason a client should not be able to immediately create a new
            allocation using the same 5-tuple?
</li>
<li>Password change: Is it possible to change the password for the
            Long-Term Authentication mechanism during the lifetime of an
            allocation? If so, how is it done?
</li>
<li>IPv6: TURN probably works fine in an all IPv6 environment, but
            there are a number of mixed IPv4/IPv6 cases that are
            ill-specified. As an example, the server needs to check that the
            PEER-ADDRESS in a Send Indication is of the same address family as
            the relayed transport address. Should we carefully work through
            all these cases and make sure we have caught them all, or should
            we just state that this document covers the IPv4 case only, and
            punt the specification of IPv6 and mixed IPv4/IPv6 operation to
            draft-ietf-behave-turn-ipv6? Does the current interest in
            resurecting IPv4-to-IPv6 NATs have any impact on TURN?
</li>
</ol>

<a name="anchor41"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.17.2"></a><h3>17.2.&nbsp;
Closed Issues</h3>

<p></p>
<ol class="text">
<li>Channel Allocation: Should TURN use the mechanism proposed by
            EKR to allocate channels? RESOLUTION: Yes. Document now reflects
            this.
</li>
<li>Stateful Allocations: Does a TURN server need to distinguish
            between the case where the client retransmits the initial Allocate
            Request because the Allocate Response was lost and the case where
            the client sends an Allocate Request because it thinks the
            allocation does not exist? RESOLUTION: Yes. Document now reflects
            this.
</li>
<li>Port Range: From what range of port numbers should a TURN
            server allocate ports? RESOLUTION: The server SHOULD allocate from
            the Dynamic and/or Private Port range unless it is sure it will
            not interfere with other apps on the same machine. Document now
            reflects this.
</li>
<li>Framing Header for STUN-formatted messages: Should TURN use the
            framing mechanism for STUN-formatted messages? RESOLUTION: NO.
            Document now reflects this. However, see related issues.
</li>
<li>Length field in ChannelData header: Over UDP, the length of the
            application data field in the ChannelData message can be
            determined from the length field in the UDP header. So should the
            length field in the ChannelData header be set to zero in this
            case? RESOLUTION: No, the ChannelData length field should have the
            same semantics over both TCP and UDP. Document now reflects
            this.
</li>
</ol>

<a name="anchor42"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.18"></a><h3>18.&nbsp;
Acknowledgements</h3>

<p>The authors would like to thank the various participants in the
      BEHAVE working group for their many comments on this draft. Marc
      Petit-Huguenin, Remi Denis-Courmont, Cullen Jennings, Lars Eggert,
      Magnus Westerlund, and Eric Rescorla have been particularly helpful,
      with Eric also suggesting the channel allocation mechanism. Christian
      Huitema was an early contributor to this document and was a co-author on
      the first few drafts. Finally, the authors would like to thank Dan Wing
      for his huge help in restarting progress on this draft after work had
      stalled.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.19"></a><h3>19.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>19.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-rfc3489bis">[I-D.ietf-behave-rfc3489bis]</a></td>
<td class="author-text">Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-rfc3489bis-18.txt">Session Traversal Utilities for (NAT) (STUN)</a>,&rdquo; draft-ietf-behave-rfc3489bis-18 (work in progress), July&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-rfc3489bis-18.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>19.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3550">[RFC3550]</a></td>
<td class="author-text">Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson, &ldquo;<a href="http://tools.ietf.org/html/rfc3550">RTP: A Transport Protocol for Real-Time Applications</a>,&rdquo; STD&nbsp;64, RFC&nbsp;3550, July&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3550.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc3550.ps">PS</a>, <a href="http://www.rfc-editor.org/rfc/rfc3550.pdf">PDF</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1889">[RFC1889]</a></td>
<td class="author-text"><a href="mailto:schulzrinne@fokus.gmd.de">Schulzrinne, H.</a>, <a href="mailto:casner@precept.com">Casner, S.</a>, <a href="mailto:frederic@parc.xerox.com">Frederick, R.</a>, and <a href="mailto:van@ee.lbl.gov">V. Jacobson</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1889">RTP: A Transport Protocol for Real-Time Applications</a>,&rdquo; RFC&nbsp;1889, January&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc1889.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1918">[RFC1918]</a></td>
<td class="author-text"><a href="mailto:yakov@cisco.com">Rekhter, Y.</a>, <a href="mailto:rgm3@is.chrysler.com">Moskowitz, R.</a>, <a href="mailto:Daniel.Karrenberg@ripe.net">Karrenberg, D.</a>, <a href="mailto:GeertJan.deGroot@ripe.net">Groot, G.</a>, and <a href="mailto:lear@sgi.com">E. Lear</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1918">Address Allocation for Private Internets</a>,&rdquo; BCP&nbsp;5, RFC&nbsp;1918, February&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc1918.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3264">[RFC3264]</a></td>
<td class="author-text">Rosenberg, J. and H. Schulzrinne, &ldquo;<a href="http://tools.ietf.org/html/rfc3264">An Offer/Answer Model with Session Description Protocol (SDP)</a>,&rdquo; RFC&nbsp;3264, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3264.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4302">[RFC4302]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4302">IP Authentication Header</a>,&rdquo; RFC&nbsp;4302, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4302.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4303">[RFC4303]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4303">IP Encapsulating Security Payload (ESP)</a>,&rdquo; RFC&nbsp;4303, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4303.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3424">[RFC3424]</a></td>
<td class="author-text">Daigle, L. and IAB, &ldquo;<a href="http://tools.ietf.org/html/rfc3424">IAB Considerations for UNilateral Self-Address Fixing (UNSAF) Across Network Address Translation</a>,&rdquo; RFC&nbsp;3424, November&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3424.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mmusic-ice">[I-D.ietf-mmusic-ice]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-19.txt">Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols</a>,&rdquo; draft-ietf-mmusic-ice-19 (work in progress), October&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-19.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4787">[RFC4787]</a></td>
<td class="author-text">Audet, F. and C. Jennings, &ldquo;<a href="http://tools.ietf.org/html/rfc4787">Network Address Translation (NAT) Behavioral Requirements for Unicast UDP</a>,&rdquo; BCP&nbsp;127, RFC&nbsp;4787, January&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4787.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-turn-tcp">[I-D.ietf-behave-turn-tcp]</a></td>
<td class="author-text">Perreault, S. and J. Rosenberg, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-turn-tcp-06.txt">Traversal Using Relays around NAT (TURN) Extensions for TCP Allocations</a>,&rdquo; draft-ietf-behave-turn-tcp-06 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-turn-tcp-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="Port-Numbers">[Port-Numbers]</a></td>
<td class="author-text">&ldquo;<a href="http://www.iana.org/assignments/port-numbers">IANA Port Numbers Registry</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="Protocol-Numbers">[Protocol-Numbers]</a></td>
<td class="author-text">&ldquo;<a href="http://www.iana.org/assignments/protocol-numbers">IANA Protocol Numbers Registry</a>,&rdquo; 2005.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jonathan Rosenberg</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Edison, NJ</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jdrosen@cisco.com">jdrosen@cisco.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.jdrosen.net">http://www.jdrosen.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rohan Mahy</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Plantronics, Inc.</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:rohan@ekabal.com">rohan@ekabal.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Philip Matthews</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Avaya, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1135 Innovation Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ottawa, Ontario  K2K 3G7</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Canada</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 613 592-4343 x223</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:philip_matthews@magma.ca">philip_matthews@magma.ca</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href=""></a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
