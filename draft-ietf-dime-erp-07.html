<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Diameter support for EAP Re-authentication Protocol (ERP)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Requirements Language">
<link href="#rfc.section.3" rel="Chapter" title="3 Assumptions">
<link href="#rfc.section.4" rel="Chapter" title="4 Protocol Overview">
<link href="#rfc.section.5" rel="Chapter" title="5 Bootstrapping the ER Server">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Bootstrapping During the Initial EAP authentication ">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Bootstrapping During the First Re-authentication">
<link href="#rfc.section.6" rel="Chapter" title="6 Re-Authentication">
<link href="#rfc.section.7" rel="Chapter" title="7 Application Id">
<link href="#rfc.section.8" rel="Chapter" title="8 AVPs">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 ERP-RK-Request AVP">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 ERP-Realm AVP">
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 Key AVP">
<link href="#rfc.section.8.3.1" rel="Chapter" title="8.3.1 Key-Type AVP">
<link href="#rfc.section.8.3.2" rel="Chapter" title="8.3.2 Keying-Material AVP">
<link href="#rfc.section.8.3.3" rel="Chapter" title="8.3.3 Key-Name AVP">
<link href="#rfc.section.8.3.4" rel="Chapter" title="8.3.4 Key-Lifetime AVP">
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgements">
<link href="#rfc.section.10" rel="Chapter" title="10 IANA Considerations">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 Diameter Application Identifier">
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 New AVPs">
<link href="#rfc.section.11" rel="Chapter" title="11 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="12 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The EAP Re-authentication Protocol (ERP) defines extensions to the Extensible Authentication Protocol (EAP) to support efficient re- authentication between the peer and an EAP Re-authentication (ER) server through a compatible authenticator. This document specifies Diameter support for ERP. It defines a new Diameter ERP application to transport ERP messages between an ER authenticator and the ER server, and a set of new AVPs that can be used to transport the cryptographic material needed by the re-authentication server." />
  <meta name="description" content="The EAP Re-authentication Protocol (ERP) defines extensions to the Extensible Authentication Protocol (EAP) to support efficient re- authentication between the peer and an EAP Re-authentication (ER) server through a compatible authenticator. This document specifies Diameter support for ERP. It defines a new Diameter ERP application to transport ERP messages between an ER authenticator and the ER server, and a set of new AVPs that can be used to transport the cryptographic material needed by the re-authentication server." />
  <meta name="keywords" content="Internet-Draft, EAP, Diameter, Re-authentication, inter-authenticator roaming" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">J. Bournelle</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">L. Morand</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Orange Labs</td>
</tr>
<tr>
<td class="left">Expires: March 09, 2012</td>
<td class="right">S. Decugis</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Free Diameter</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Q. Wu</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Huawei</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">G.W. Zorn</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Network Zen</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">September 06, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Diameter support for EAP Re-authentication Protocol (ERP)<br />
  <span class="filename">draft-ietf-dime-erp-07.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The EAP Re-authentication Protocol (ERP) defines extensions to the Extensible Authentication Protocol (EAP) to support efficient re- authentication between the peer and an EAP Re-authentication (ER) server through a compatible authenticator. This document specifies Diameter support for ERP. It defines a new Diameter ERP application to transport ERP messages between an ER authenticator and the ER server, and a set of new AVPs that can be used to transport the cryptographic material needed by the re-authentication server.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on March 09, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Requirements Language</a>
</li>
<li>3.   <a href="#rfc.section.3">Assumptions</a>
</li>
<li>4.   <a href="#rfc.section.4">Protocol Overview</a>
</li>
<li>5.   <a href="#rfc.section.5">Bootstrapping the ER Server</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Bootstrapping During the Initial EAP authentication </a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Bootstrapping During the First Re-authentication</a>
</li>
<li>6.   <a href="#rfc.section.6">Re-Authentication</a>
</li>
<li>7.   <a href="#rfc.section.7">Application Id</a>
</li>
<li>8.   <a href="#rfc.section.8">AVPs</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">ERP-RK-Request AVP</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">ERP-Realm AVP</a>
</li>
<li>8.3.   <a href="#rfc.section.8.3">Key AVP</a>
</li>
<li>8.3.1.   <a href="#rfc.section.8.3.1">Key-Type AVP</a>
</li>
<li>8.3.2.   <a href="#rfc.section.8.3.2">Keying-Material AVP</a>
</li>
<li>8.3.3.   <a href="#rfc.section.8.3.3">Key-Name AVP</a>
</li>
<li>8.3.4.   <a href="#rfc.section.8.3.4">Key-Lifetime AVP</a>
</li>
<li>9.   <a href="#rfc.section.9">Acknowledgements</a>
</li>
<li>10.   <a href="#rfc.section.10">IANA Considerations</a>
</li>
<li>10.1.   <a href="#rfc.section.10.1">Diameter Application Identifier</a>
</li>
<li>10.2.   <a href="#rfc.section.10.2">New AVPs</a>
</li>
<li>11.   <a href="#rfc.section.11">Security Considerations</a>
</li>
<li>12.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#Introduction" id="Introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">RFC5296 <a href="#RFC5296">[RFC5296]</a> defines the EAP Re-authentication Protocol (ERP). It consists of the following steps:</p>

<dl>
<dt>Bootstrapping</dt>
<dd style="margin-left: 8">
<br><br>A root key for re-authentication is derived from the Extended Master Session Key (EMSK) created during EAP authentication <a href="#RFC5295">[RFC5295]</a>. This root key is transported from the EAP server to the ER server.</dd>
<dt>Re-authentication</dt>
<dd style="margin-left: 8">
<br><br>A one-round-trip exchange between the peer and the ER server, resulting in mutual authentication. To support the EAP reauthentication functionality, ERP defines two new EAP codes - EAP-Initiate and EAP-Finish.</dd>
</dl>
<p id="rfc.section.1.p.2">This document defines how Diameter transports the ERP messages during the re-authentication process. For this purpose, we define a new Application Identifier for ERP, and re-use the Diameter EAP commands (DER/DEA).</p>
<p id="rfc.section.1.p.3">This document also discusses the distribution of the root key during bootstrapping, in conjunction with either the initial EAP authentication (implicit bootstrapping) or the first ERP exchange (explicit bootstrapping). Security considerations for this key distribution are detailed in RFC 5295 <a href="#RFC5295">[RFC5295]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">This document uses terminology defined in RFC3748 <a href="#RFC3748">[RFC3748]</a>, RFC5295 <a href="#RFC5295">[RFC5295]</a>, RFC5296 <a href="#RFC5296">[RFC5296]</a>, and RFC4072 <a href="#RFC4072">[RFC4072]</a>.</p>
<p id="rfc.section.2.p.2">"Root key" (RK) or "bootstrapping material" refer to the rRK or rDSRK derived from an EMSK, depending on the location of the ER server in home or foreign domain.</p>
<p id="rfc.section.2.p.3">We use the notation "ERP/DER" and "ERP/DEA" in this document to refer to Diameter-EAP-Request and Diameter-EAP-Answer commands with the Application Id set to "Diameter ERP Application" Section 11.1; the same commands are denoted "EAP/DER" and "EAP/DEA" when the Application Id in the message is set to "Diameter EAP Application" <a href="#RFC4072">[RFC4072]</a>.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Requirements Language</h1>
<p id="rfc.section.2.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Assumptions</h1>
<p id="rfc.section.3.p.1">This document assumes the existence of at most one logical ER server entity in a domain. If several physical servers are deployed for robustness, a replication mechanism must be deployed to synchronize the ERP states (root keys) between these servers. This replication mechanism is out of the scope of this document. If multiple ER servers are deployed in the domain, we assume that they can be used interchangeably.  If multiple ER servers are deployed across the domains, we assume only one ER server that is near to the peer is getting involved in the ERP.</p>
<p id="rfc.section.3.p.2">Also this document assumes the existence of at most one EAP server entity in the home domain.In case of multiple physical home EAP servers in the same domain, if the ER server wants to reach the same home EAP server, the ER server may cache the Destination-Host AVP corresponding to the home EAP server it requests. </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#Overview" id="Overview">Protocol Overview</a>
</h1>
<p id="rfc.section.4.p.1">The following figure shows the components involved in ERP, and their interactions.</p>
<div id="#rfc.figure.1"></div>
<pre>
                        Diameter                    +--------+
        +-------------+   ERP   +-----------+  (*)  |  Home  |
Peer &lt;-&gt;|Authenticator|&lt;=======&gt;| ER server | &lt;---&gt; |  EAP   |
        +-------------+         +-----------+       | server |
                                                    +--------+
(*) Diameter EAP application,  explicit bootstrapping scenario only.
                         </pre>
<p id="rfc.section.4.p.2">The ER server is located either in the home domain (same as EAP server) or in the visited domain (same as authenticator, when it differs from the home domain). </p>
<p id="rfc.section.4.p.3">When the peer initiates an ERP exchange, the authenticator creates a Diameter-EAP-Request message <a href="#RFC4072">[RFC4072]</a>. The Application Id of the message is set to that of the Diameter ERP application (code: TBD) in the message. The generation of the ERP/DER message is detailed in <a href="#Re-authentication">Section 6</a>.</p>
<p id="rfc.section.4.p.4">If there is an ER server in the same domain as the authenticator (local domain), Diameter routing must be configured so that this ERP/DER message reaches this server, even if the Destination-Realm is not the local domain.</p>
<p id="rfc.section.4.p.5">If there is no local ER server, the message is routed according to its Destination-Realm AVP content, extracted from the realm component of the keyName-NAI attribute. As specified in RFC5296 <a href="#RFC5296">[RFC5296]</a>, this realm is the home domain of the peer in case of bootstrapping exchange ('B' flag is set in ERP message) or the domain of the bootstrapped ER server otherwise </p>
<p id="rfc.section.4.p.6">If no ER server is available in the home domain either, the ERP/DER message cannot be delivered, and an error DIAMETER_UNABLE_TO_DELIVER is generated as specified in <a href="#RFC3588">[RFC3588]</a> and returned to the authenticator. The authenticator may cache this information (with limited duration) to avoid further attempts for ERP with this realm. It may also fallback to full EAP authentication to authenticate the peer.</p>
<p id="rfc.section.4.p.7">When an ER server receives the ERP/DER message, it searches its local database for a root key <a href="#RFC5296">[RFC5296]</a> then creates the ERP/DEA answer as described in <a href="#Re-authentication">Section 6</a>. The rMSK is included in this answer.</p>
<p id="rfc.section.4.p.8">Finally, the authenticator extracts the rMSK from the ERP/DEA as described in RFC5296 <a href="#RFC5296">[RFC5296]</a>, and forwards the content of the EAP-Payload AVP, the EAP-Finish/Re-Auth message, to the peer.</p>
<p id="rfc.section.4.p.9">The ER server may or may not possess the root key in its local database. If the EAP-Initiate/Re-Auth message has its 'B' flag set (Bootstrapping exchange) and the ER server possess the root key,the ER server should respond directly to the peer that initiate ERP exchange otherwise, Otherwise, the ER server should act as a proxy, and forwards the message to the home EAP server after changing its Application Id to Diameter EAP and adding the ERP-RK-Request AVP to request the root key.  See <a href="#Bootstrapping">Section 5</a> for more detail on this process.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#Bootstrapping" id="Bootstrapping">Bootstrapping the ER Server</a>
</h1>
<p id="rfc.section.5.p.1">The bootstrapping process involves the home EAP server and the ER server, but also impacts the peer and the authenticator. In ERP, the peer must derive the same keying material as the ER server. To achieve this, it must learn the domain name of the ER server. How this information is acquired is outside the scope of this specification, but it may involves that the authenticator is configured to advertize this domain name, especially in the case of re-authentication after a handover.</p>
<p id="rfc.section.5.p.2">The bootstrapping of an ER server with a given root key happens either during the initial EAP authentication of the peer when the EMSK -- from which the root key is derived -- is created, during the first re-authentication, or sometime between those events. We only consider the first two possibilities in this specification, in the following sub-sections.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Bootstrapping During the Initial EAP authentication </h1>
<p id="rfc.section.5.1.p.1">Bootstrapping the ER server during the initial EAP authentication (also known as implicit bootstrapping) offers the advantage that the server is immediately available for re-authentication of the peer, thus minimizing the re-authentication delay. On the other hand, it is possible that only a small number of peers will use re-authentication in the visited domain. Deriving and caching key material for all the peers (for example, for the peers that do not support ERP) is a waste of resources and should be avoided.</p>
<p id="rfc.section.5.1.p.2">To achieve implicit bootstrapping, the ER server acts as a Diameter EAP Proxy , and Diameter routing must be configured so that Diameter EAP application messages are routed through this proxy. The figure bellow illustrates this mechanism.</p>
<div id="#rfc.figure.2"></div>
<pre>
                         ER server &amp;
Authenticator             EAP Proxy               Home EAP server
=============            ===========              ===============
     -------------------------&gt;
         Diameter EAP/DER
          (EAP-Response)
                               -------------------------&gt;
                                  Diameter EAP/DER
                                   (EAP-Response)
                                  (ERP-RK-Request)

     &lt;==================================================&gt;
        Multi-round Diameter EAP exchanges, unmodified

                               &lt;-------------------------
                                   Diameter EAP/DEA
                                    (EAP-Success)
                                        (MSK)
                                   (Key AVP (rRK))
     &lt;-------------------------
         Diameter EAP/DEA
           (EAP-Success)
               (MSK)
            [ERP-Realm]
</pre>
<p id="rfc.section.5.1.p.3">The authenticator creates the first DER of the full EAP authentication and send it to the ER server. The ER server proxies the first DER of the full EAP authentication and adds the ERP-RK-Request AVP inside, then forwards the request to the home EAP server. </p>
<p id="rfc.section.5.1.p.4">If the home EAP server does not support the Diameter ERP extensions for ERP-RK-Request AVP, it simply ignores the ERP-RK-Request AVP and continues as specified in RFC 4072 <a href="#RFC4072">[RFC4072]</a>. If the server supports the ERP extensions, it saves the value of the ERP-Realm AVP found inside the ERP-RK-Request AVP, and continues with the EAP authentication. When the authentication completes, if it is successful and the EAP method has generated an EMSK, the server MUST derive the rRK as specified in RFC 5296 <a href="#RFC5296">[RFC5296]</a>, using the saved domain name. It then includes the rRK inside a Key AVP Section 8.3 with the Key-Type AVP set to rRK, before sending the DEA as usual.</p>
<p id="rfc.section.5.1.p.5">When the ER server proxies a Diameter-EAP-Answer message with a Session-Id corresponding to a message to which it added an ERP-RK- Request AVP, and the Result-Code is DIAMETER_SUCCESS, it MUST examine the message and save and remove any Key AVP Section 8.3 with Key-Type AVP set to rRK. If the message does not contain such Key AVP, the ER server may cache the information that ERP is not possible for this session to avoid possible subsequent attempts. In any case, the information stored in ER server concerning a session should not have a lifetime greater than the EMSK for this session. </p>
<p id="rfc.section.5.1.p.6">If the ER server is successfully bootstrapped, it should also add the ERP-Realm AVP after removing the Key AVP with Key-Type of rRK in the EAP/DEA message. This ERP-Realm information can be used by the authenticator to notify the peer that ER server is bootstrapped, and for which domain. How this information can be transmitted to the peer is outside the scope of this document. This information needs to be sent to the peer if both implicit and explicit bootstrapping mechanisms are possible, because the ERP message and the root key used for protecting this message are different in bootstrapping exchanges and non-bootstrapping exchanges. </p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Bootstrapping During the First Re-authentication</h1>
<p id="rfc.section.5.2.p.1">Bootstrapping the ER server during the first re-authentication (also known as explicit bootstrapping) is only needed when there is no local ER server in the visited domain and there is the ER server in the home domain. It is less resource-consuming, since EMSK generated during initial EAP authentication is reused to derive root keys. On the other hand, in that case first re-authentication requires a one-round-trip exchange with the home EAP server, since the EMSK is generated during initial EAP authentication and never leaves the home EAP server, which is less efficient than the implicit bootstrapping scenario. </p>
<p id="rfc.section.5.2.p.2">The EAP-Initiate/Re-auth message is sent to the home ER server.  The home ER server receives the ERP/DER message containing the EAP- Initiate/Re-Auth message with the 'B' flag set. It creates the new EAP/DER message using the received DRP/DER message and performs the following processing: </p>

<ul class="empty">
<li>Set the Application Id in the header of the message as Diameter EAP Application (code 5). </li>
<li>Extract ERP-RK-request from ERP/DER, which contains the name of domain where the ER server is located and add it into newly created ERP/DER message.</li>
</ul>

<p>Then the newly created EAP/DER is sent and routed to the home Diameter EAP server. </p>
<p id="rfc.section.5.2.p.3">If the home EAP server does not support ERP extensions, it replies with an error since the encapsulated ERP-RK-request AVP is not understood. Otherwise, it processes the DSRK request as described in <a href="#RFC5296">[RFC5296]</a>. In particular, it includes the Domain- Name TLV attribute with the content from the ERP-Realm AVP. It creates the EAP/DEA reply message <a href="#RFC4072">[RFC4072]</a>including an instance of the Key AVP Section 8.3 with Key-Type AVP set to rRK. In particular, it includes the Domain- Name TLV attribute with the content from the ERP-Realm AVP. </p>
<p id="rfc.section.5.2.p.4">The ER server receives this EAP/DEA and proxies it as follows, in addition to standard proxy operations: <a href="#RFC5296">[RFC5296]</a>.</p>

<ul class="empty">
<li>Set the Application Id back to Diameter ERP Application Id (code TBD</li>
<li>Extract and cache the content of the Key AVP with Key-Type set to rRK, as described in implicit scenario. </li>
</ul>

<p> The ERP/DEA message is then forwarded to the authenticator, that can use the rMSK as described in RFC 5296 </p>
<p id="rfc.section.5.2.p.5">The figure below captures this proxy behavior:</p>
<div id="#rfc.figure.3"></div>
<pre>
Authenticator            ER server             Home EAP server
=============            =========             ===============
      -----------------------&gt;
          Diameter ERP/DER
           (EAP-Initiate)
                              ------------------------&gt;
                                    Diameter EAP/DER
                                     (EAP-Response)
                                    (ERP-RK-Request)

                              &lt;------------------------
                                    Diameter EAP/DEA
                                      (EAP-Success)
                                     (Key AVP (rRK))
                                     (Key AVP (rMSK))
      &lt;----------------------
          Diameter ERP/DEA
            (EAP-Finish)
          (Key AVP (rMSK))
</pre>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#Re-authentication" id="Re-authentication">Re-Authentication</a>
</h1>
<p id="rfc.section.6.p.1">This section describes in detail a re-authentication exchange with an ER server that was previously bootstrapped. The following figure summarizes the re-authentication exchange.</p>
<div id="#rfc.figure.4"></div>
<pre>
                                                         ER server
    Peer                 Authenticator                (bootstrapped)
    ====                 =============            ======================
    [ &lt;------------------------          ]
    [optional EAP-Initiate/Re-auth-start,]
    [  possibly with ERP domain name     ]

      -----------------------&gt;
        EAP-Initiate/Re-auth
                              ===============================&gt;
                                 Diameter ERP, cmd code DER
                                   User-Name: Keyname-NAI
                              EAP-Payload: EAP-Initiate/Re-auth

                              &lt;===============================
                                 Diameter ERP, cmd code DEA
                               EAP-Payload: EAP-Finish/Re-auth
                                        Key AVP: rMSK
       &lt;----------------------
         EAP-Finish/Re-auth
</pre>
<p id="rfc.section.6.p.2">The peer sends an EAP-Initiate/Re-auth message to the ER server via the authenticator. Alternatively, the authenticator may send an EAP- Initiate/Re-auth-Start message to the peer to trigger the mechanism. In this case, the peer responds with an EAP-Initiate/Re-auth message.</p>
<p id="rfc.section.6.p.3">If the authenticator does not support ERP (pure Diameter EAP <a href="#RFC4072">[RFC4072]</a> support), it discards the EAP packets with an unknown ERP- specific code (EAP-Initiate). The peer should fallback to full EAP authentication in this case.</p>
<p id="rfc.section.6.p.4">When the authenticator receives an EAP-Initiate/Re-auth message from the peer, it process as described in <a href="#RFC5296">[RFC5296]</a> with regards to the EAP state machine. It creates a Diameter ERP/DER message following the general process of <a href="#RFC4072">Diameter EAP</a> <cite title="NONE">[RFC4072]</cite>, with the following differences:<a href="#Overview">Section 4</a>.</p>

<ul class="empty">
<li>The Application Id in the header is set to Diameter ERP (code TBD </li>
<li>The value in Auth-Application-Id AVP is also set to Diameter ERP Application.</li>
<li>The keyName-NAI attribute from ERP message is used to create the content of User-Name AVP and Destination-Realm AVP.</li>
<li>
<li>The Auth-Request-Type AVP content is set to the appropriate value.</li>
<li>The EAP-Payload AVP contains the EAP-Initiate/Re-Auth.</li>
</ul>

<p>Then this ERP/DER message is sent as described in </p>
<p id="rfc.section.6.p.5">The ER server receives and processes this request as described in <a href="#Overview">Section 4</a>. It then creates an ERP/DEA message following the general processing described in RFC4072 <a href="#RFC4072">[RFC4072]</a>, with the following differences:</p>

<ul class="empty">
<li>The Application Id in the header is set to Diameter ERP (code TBD).</li>
<li>The value of the Auth-Application-Id AVP is also set to Diameter ERP Application.</li>
<li>The EAP-Payload AVP contains the EAP-Finish/Re-auth message.</li>
<li>In case of successful authentication, an instance of the Key AVP containing the Re-authentication Master Session Key (rMSK) derived by ERP is included.</li>
</ul>
<p id="rfc.section.6.p.6">When the authenticator receives this ERP/DEA answer, it processes it as described in Diameter EAP <a href="#RFC4072">[RFC4072]</a> and RFC5296 <a href="#RFC5296">[RFC5296]</a>: the content of EAP-Payload AVP content is forwarded to the peer, and the contents of the Keying-Material AVP <a href="#I-D.ietf-dime-local-keytran">[I-D.ietf-dime-local-keytran]</a> is used as a shared secret for Secure Association Protocol.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#ApplicationId" id="ApplicationId">Application Id</a>
</h1>
<p id="rfc.section.7.p.1">We define a new Diameter application in this document, Diameter ERP Application, with an Application Id value of TBD. Diameter nodes conforming to this specification in the role of ER server MUST advertise support by including an Auth-Application-Id AVP with a value of Diameter ERP Application in the of the Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands <a href="#RFC3588">[RFC3588]</a>.</p>
<p id="rfc.section.7.p.2">The primary use of the Diameter ERP Application Id is to ensure proper routing of the messages, and that the nodes that advertise the support for this application do understand the new AVPs defined in <a href="#AVPs">Section 8</a> , although these AVP have the 'M' flag cleared.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#AVPs" id="AVPs">AVPs</a>
</h1>
<p id="rfc.section.8.p.1">This section discusses the AVPs used by the Diameter ERP application.</p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> ERP-RK-Request AVP</h1>
<p id="rfc.section.8.1.p.1">The ERP-RK-Request AVP (AVP Code TBD) is of type grouped AVP. This AVP is used by the ER server to indicate its willingness to act as ER server for a particular session.</p>
<p id="rfc.section.8.1.p.2">This AVP has the M and V bits cleared.</p>
<div id="#rfc.figure.5"></div>
<pre>
      ERP-RK-Request ::= &lt; AVP Header: TBD &gt;
                         { ERP-Realm }
                       * [ AVP ]
</pre>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> ERP-Realm AVP</h1>
<p id="rfc.section.8.2.p.1">The ERP-Realm AVP (AVP Code TBD) is of type DiameterIdentity. It contains the name of the realm in which the ER server is located.</p>
<p id="rfc.section.8.2.p.2">This AVP has the M and V bits cleared.</p>
<h1 id="rfc.section.8.3">
<a href="#rfc.section.8.3">8.3.</a> Key AVP</h1>
<p id="rfc.section.8.3.p.1">The Key AVP <a href="#I-D.ietf-dime-local-keytran">[I-D.ietf-dime-local-keytran]</a> is of type "Grouped" and is used to carry the rRK or rMSK and associated attributes. The usage of the Key AVP and its constituent AVPs in this application is specified in the following sub-sections.</p>
<h1 id="rfc.section.8.3.1">
<a href="#rfc.section.8.3.1">8.3.1.</a> Key-Type AVP</h1>
<p id="rfc.section.8.3.1.p.1">The value of the Key-Type AVP MUST be set to 2 for rRK or 3 for rMSK.</p>
<h1 id="rfc.section.8.3.2">
<a href="#rfc.section.8.3.2">8.3.2.</a> Keying-Material AVP</h1>
<p id="rfc.section.8.3.2.p.1">The Keying-Material AVP contains rRK sent by the home EAP server to the ER server, in answer to a request containing an ERP-RK-Request AVP, or the rMSK sent by ER server to authenticator.  How this material is derived and used is specified in RFC 5296 <a href="#RFC5296">[RFC5296]</a>.</p>
<h1 id="rfc.section.8.3.3">
<a href="#rfc.section.8.3.3">8.3.3.</a> Key-Name AVP</h1>
<p id="rfc.section.8.3.3.p.1">This AVP contains the EMSKname which identifies the keying material. The derivation of this name is specified in RGC 5296 <a href="#RFC5296">[RFC5296]</a>.</p>
<h1 id="rfc.section.8.3.4">
<a href="#rfc.section.8.3.4">8.3.4.</a> Key-Lifetime AVP</h1>
<p id="rfc.section.8.3.4.p.1">The Key-Lifetime AVP contains the lifetime of the keying material in seconds. It MUST NOT be greater than the remaining lifetime of the EMSK from which the material was derived.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.9.p.1">Hannes Tschofenig wrote the initial draft for this document and provided useful reviews.</p>
<p id="rfc.section.9.p.2">Vidya Narayanan reviewed a rough draft version of the document and found some errors.</p>
<p id="rfc.section.9.p.3">Lakshminath Dondeti contributed to the early versions of the document.</p>
<p id="rfc.section.9.p.4">Many thanks to these people!</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.10.p.1">This document requires IANA registration of the following new elements in the <a href="http://www.iana.org/assignments/aaa-parameters/">Authentication, Authorization, and Accounting (AAA) Parameters</a> registries.</p>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> Diameter Application Identifier</h1>
<p id="rfc.section.10.1.p.1">This specification requires IANA to allocate a new value "Diameter ERP" in the "Application IDs" registry using the policy specified in Section 11.3 of RFC 3588 <a href="#RFC3588">[RFC3588]</a>.</p>
<h1 id="rfc.section.10.2">
<a href="#rfc.section.10.2">10.2.</a> New AVPs</h1>
<p id="rfc.section.10.2.p.1">This specification requires IANA to allocate new values from the "AVP Codes" registry according to the policy specified in Section 11.1 of RFC 3588 <a href="#RFC3588">[RFC3588]</a> for the following AVPs: <a href="#AVPs">Section 8</a>.</p>

<ul class="empty">
<li>ERP-RK-Request</li>
<li>ERP-Realm</li>
</ul>

<p>These AVPs are defined in </p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.11.p.1">The security considerations from the following documents apply here: </p>

<ul>
<li>RFC3588 <a href="#RFC3588">[RFC3588]</a>
</li>
<li>RFC4072 <a href="#RFC4072">[RFC4072]</a>
</li>
<li>RFC5296 <a href="#RFC5296">[RFC5296]</a>
</li>
<li>I-D.ietf-dime-local-keytran<a href="#I-D.ietf-dime-local-keytran">[I-D.ietf-dime-local-keytran]</a>
</li>
</ul>
<h1 id="rfc.references">
<a href="#rfc.references">12.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-dime-local-keytran">[I-D.ietf-dime-local-keytran]</b></td>
<td class="top">
<a>Wu, Q.</a>, <a>Zorn, G.</a> and <a>V. Cakulev</a>, "<a href="http://tools.ietf.org/html/draft-ietf-dime-local-keytran-09">Diameter support for local key transport protocol between local server and home AAA server</a>", Internet-Draft draft-ietf-dime-local-keytran-09, April 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3588">[RFC3588]</b></td>
<td class="top">
<a>Calhoun, P.</a>, <a>Loughney, J.</a>, <a>Guttman, E.</a>, <a>Zorn, G.</a> and <a>J. Arkko</a>, "<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>", RFC 3588, September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4072">[RFC4072]</b></td>
<td class="top">
<a>Eronen, P.</a>, <a>Hiller, T.</a> and <a>G. Zorn</a>, "<a href="http://tools.ietf.org/html/rfc4072">Diameter Extensible Authentication Protocol (EAP) Application</a>", RFC 4072, August 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5295">[RFC5295]</b></td>
<td class="top">
<a>Salowey, J.</a>, <a>Dondeti, L.</a>, <a>Narayanan, V.</a> and <a>M. Nakhjiri</a>, "<a href="http://tools.ietf.org/html/rfc5295">Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK)</a>", RFC 5295, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5296">[RFC5296]</b></td>
<td class="top">
<a>Narayanan, V.</a> and <a>L. Dondeti</a>, "<a href="http://tools.ietf.org/html/rfc5296">EAP Extensions for EAP Re-authentication Protocol (ERP)</a>", RFC 5296, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3748">[RFC3748]</b></td>
<td class="top">
<a>Aboba, B.</a>, <a>Blunk, L.</a>, <a>Vollbrecht, J.</a>, <a>Carlson, J.</a> and <a>H. Levkowetz</a>, "<a href="http://tools.ietf.org/html/rfc3748">Extensible Authentication Protocol (EAP)</a>", RFC 3748, June 2004.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Julien Bournelle</span> 
	  <span class="n hidden">
		<span class="family-name">Bournelle</span>
	  </span>
	</span>
	<span class="org vcardline">Orange Labs</span>
	<span class="adr">
	  <span>38-40 rue du general Leclerc</span>

	  <span class="vcardline">
		<span class="locality">Issy-Les-Moulineaux</span>,  
		<span class="region"></span>
		<span class="code">92794</span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:julien.bournelle@orange-ftgroup.com">julien.bournelle@orange-ftgroup.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Lionel Morand</span> 
	  <span class="n hidden">
		<span class="family-name">Morand</span>
	  </span>
	</span>
	<span class="org vcardline">Orange Labs</span>
	<span class="adr">
	  <span>38-40 rue du general Leclerc</span>

	  <span class="vcardline">
		<span class="locality">Issy-Les-Moulineaux</span>,  
		<span class="region"></span>
		<span class="code">92794</span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:lionel.morand@orange-ftgroup.com">lionel.morand@orange-ftgroup.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Sebastien Decugis</span> 
	  <span class="n hidden">
		<span class="family-name">Decugis</span>
	  </span>
	</span>
	<span class="org vcardline">Free Diameter</span>
	<span class="adr">
	  <span>4-2-1 Nukui-Kitamachi</span>

	  <span class="vcardline">
		<span class="locality">Tokyo</span>,  
		<span class="region">Koganei</span> 
		<span class="code">184-8795</span>
	  </span>
	  <span class="country-name vcardline">Japan</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:sdecugis@freediameter.net">sdecugis@freediameter.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Qin Wu</span> 
	  <span class="n hidden">
		<span class="family-name">Wu</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei Technologies Co., Ltd</span>
	<span class="adr">
	  <span>Site B, Floor 12F, Huihong Mansion, No.91 Baixia Rd.</span>

	  <span class="vcardline">
		<span class="locality">Nanjing</span>,  
		<span class="region"></span>
		<span class="code">210001</span>
	  </span>
	  <span class="country-name vcardline">China</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:sunseawq@huawei.com">sunseawq@huawei.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Glen Zorn</span> 
	  <span class="n hidden">
		<span class="family-name">Zorn</span>
	  </span>
	</span>
	<span class="org vcardline">Network Zen</span>
	<span class="adr">
	  <span>227/358 Thanon Sanphawut</span>

	  <span class="vcardline">
		<span class="locality">Bang Na</span>,  
		<span class="region">Bangkok</span> 
		<span class="code">10260</span>
	  </span>
	  <span class="country-name vcardline">Thailand</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:gwz@net-zen.net">gwz@net-zen.net</a></span>

  </address>
</div>

</body>
</html>