<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Mobile DTLS</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Mobile DTLS">
<meta name="keywords" content="dtls, mobile, mobility">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Transport Layer Security</td><td class="header">M. Williams</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">J. Barrett</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Nokia</td></tr>
<tr><td class="header">Expires: September 6, 2009</td><td class="header">March 05, 2009</td></tr>
</table></td></tr></table>
<h1><br />Mobile DTLS<br />draft-barrett-mobile-dtls-00</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 6, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>Mobile DTLS (Mobi-D) is an extension to DTLS that provides host mobility
		support. After obtaining a new IP address or port, a DTLS client mobile host 
		can continue sending to its DTLS server correspondent host. The mobile host 
		continues to use the existing set of security  parameters, from the new address, 
		without re-negotiation. The correspondent host accepts packets from the new IP 
		address or port, also without re-negotiation. After receiving any valid DTLS
		packet from the mobile host's new address or port, the correspondent host uses 
		the new address or port to send to the mobile host.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Requirements Language<br />
<a href="#anchor3">2.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#overview_extension">2.1.</a>&nbsp;
Mobility Extension<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#overview_op_extension">2.2.</a>&nbsp;
OP Extension<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.3.</a>&nbsp;
New Message<br />
<a href="#anchor5">3.</a>&nbsp;
Usage Model<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.1.</a>&nbsp;
System Diagram<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.2.</a>&nbsp;
Example Flow<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.3.</a>&nbsp;
Usage: Single Interface Host<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.4.</a>&nbsp;
Usage: Multi-Interface Host<br />
<a href="#details">4.</a>&nbsp;
Details<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#details_extension">4.1.</a>&nbsp;
Extensions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#details_record">4.2.</a>&nbsp;
Record Layer<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#details_message">4.3.</a>&nbsp;
Message<br />
<a href="#security">5.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">5.1.</a>&nbsp;
Cryptography<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.2.</a>&nbsp;
Connection ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.3.</a>&nbsp;
Denial of Service<br />
<a href="#IANA">6.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor13">7.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">8.</a>&nbsp;
Normative References<br />
<a href="#app-additional">Appendix&nbsp;A.</a>&nbsp;
Additional Stuff<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
			Mobility service for hosts is available at the network layer from Mobile IP 
			and from Proxy Mobile IP. For cases when neither of those mobility solutions 
			are available, Mobi-D provides alternative mobility, at the transport layer.
		
</p>
<p>
            Applications are now carrying audio and video over UDP for the benefits of 
            low latency, help with NAT traversal, and where reliability has to be done 
            at a higher layer. These applications are also being adapted for mobile devices, 
            including multi-access devices such as those with both wired and wireless 
            interfaces, or those with a wireless local area interface and a wireless wide 
            area interface.
		
</p>
<p>
			Mobi-D extends <a class='info' href='#RFC4347'>DTLS<span> (</span><span class='info'>Rescorla, E. and N. Modadugu, &ldquo;Datagram Transport Layer Security,&rdquo; April&nbsp;2006.</span><span>)</span></a> [RFC4347]
			to provide host based mobility for the secure transport provided by DTLS. Mobi-D 
			adds a connection identifier (ID) to the DTLS record layer. The connection ID is 
			used for efficient indexing of the security parameters of a DTLS flow between the 
			hosts. By associating packets to a flow based on security parameters instead of 
			IP address and port, the connection can be maintained across change of the IP 
			address, port, or change of interface.
		
</p>
<p>
            A basic principle of Mobi-D is that no special messages are required to
            inform the correspondent host of a mobile host's move. Receipt of a fully 
            valid Mobi-D record from the new address and port is sufficient. The mobile
            host can move without any re-negotation, and the other end can react 
            immediately upon receipt of the first packet from the new address/port.
            An additional benefit is that applications on the mobile host can choose
            to ignore whether or not they are moving, and just make the assumption
            that the operating system has some address.            
        
</p>
<p>
			In whichever cases DTLS might be useful for securing UDP traffic, Mobi-D extends 
			those cases to support mobile hosts and multi access hosts.
		
</p>
<p>
			The terms "client" and "server" are used as in DTLS. In this document a mobile host 
			may have the role of DTLS client or server, but will typically take the client role.
			In other words, mobility support is not limited to client roles, either role may be 
			mobile.
		
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Overview</h3>

<p>
            Mobi-D extends DTLS in four ways:
            </p>
<ol class="text">
<li>A new DTLS Hello extension (Mobility)
</li>
<li>A new TLS Hello extension (OP)
</li>
<li>An additional field in the Record Layer (connection_id)
</li>
<li>A new type of message (OP)
</li>
</ol><p>
          
        
</p>
<a name="overview_extension"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Mobility Extension</h3>

<p>
				The Mobility extension allows a client and server to negotiate and establish 
				mobility support for a DTLS connection.
			
</p>
<p>
				The client allocates a unique connection_id associated with each DTLS handshake. 
				For each full DTLS handshake, the client includes the connection_id in the 
				Mobility extension, for use by the server when sending to this client. Likewise,
				the server allocates a unique connection_id and responds with a Mobility extension 
				in ServerHello, including the connection_id for use by the client.
			
</p>
<p>
				If the server includes the Mobility extension in its ServerHello, the client MUST 
				include the server's connection_id in the very next record sent in the session, 
				and all subsequent records. Likewise, the server MUST include the client's 
				connection_id in the very next record sent in the session, and all subsequent 
				records.
			
</p>
<p>
                The Mobility extension includes a MobilityType value, which
                allows the server to declare that its address is fixed. If
                the server sends MobilityType fixed, then the client MUST NOT
                adjust its idea of the server's IP or port, even if a datagram
                is received from a different IP or port. This allows us to
                prevent the DoS attack described in the <a class='info' href='#security'>Security Considerations<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> in one direction.
            
</p>
<p>
                Clients which include the Mobility extension SHOULD include the OP extension
                as well, to allow OP messages to be used in the connection. Likewise, a
                server including Mobility SHOULD include OP as well, if the client did so.
            
</p>
<p>
                Because TLS is inherently bound to a single host/port quartet, this extension 
                MUST only be used with DTLS, and not with TLS. Any TLS server which receives 
                this extension MUST ignore it.                
            
</p>
<a name="overview_op_extension"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
OP Extension</h3>

<p>
				The OP extension allows a client and server to negotiate and establish 
				support for the OP message. The client MAY include the OP extension in
				its ClientHello. The extension contains a list of OpTypes supported by
				the client. The server MAY respond with the OP extension in its ServerHello,
				containing the list of OpTypes to be supported in the connection. The
				server's list is the intersection of the set of OpTypes supported by the
				server with the list provided by the client. If the intersection is nil,
				the server MUST NOT include the OP extension in its ServerHello.
			
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
New Message</h3>

<p>
				Mobi-D specifies a new type of TLS message to be used for intra-protocol
				communication. The OP message consists of an OpType and opaque op_data 
				and is encrypted and compressed as per the current connection state (like 
				any other message). The OP message gets a new content type (managed by IANA,
				see <a class='info' href='#IANA'>Section&nbsp;6<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>).
			
</p>
<p>
				The OP message is extensible to allow for future use. Mobi-D specifies
				one OpType, NOP (no-op), which is just an empty message. OP messages MUST
				be consumed by the receiving DTLS implementation, they are not delivered
				to the application.
			
</p>
<p>
				If Mobility has been negotiated for the flow, the recipient
				of a NOP message MUST use the message's source address and port 
				as the destination address and port for all new messages back to
				the sender. The NOP message is then discarded.
			
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Usage Model</h3>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
System Diagram</h3>

<p>TODO: this diagram needs explanation.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      ----------------                -------------------------
      |Mobi-D client |SP(cidS)-------&gt;|Mobi-D server          |
      | mobile host  |&lt;-------SP(cidC)| fixed or mobile server|
      ----------------                | correspondent host    |
                                      -------------------------
</pre></div>
<p>
                The Mobi-D communication is between the DTLS client and server. The 
                server allocates a connection ID (cidS) for use by the client. The client 
                sends that ID in all records it sends to that server. The server receives 
                a record with the connection ID it allocated, and uses that to look up 
                the security parameters (SP) for the DTLS flow from the client, to 
                authenticate and decrypt the record.
            
</p>
<p>
                The client also allocates a connection ID (cidC) for use by the server. 
                The server sends that ID in all records it sends to that client. The client 
                receives a record with the connection ID it allocated, and uses that to 
                look up the security parameters (SP) for the DTLS flow from the server, 
                to authenticate and decrypt the record.
            
</p>
<p>
                The terms server and client are used as in DTLS. However, the server and 
                client may both be mobile devices. Note that the flows are not bound to or 
                dependent on particular interfaces of the hosts.
            
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Example Flow</h3>

<p>
            
</p>
<p>In this example, the client changes IP address and the
                server immediately begins sending traffic to the new address. For
                the sake of simplicity, the "src" and "sport" examples given here
                are the values seen by the server. Quite possibly the client is
                behind a NAT and has a different address on its own interface.
                
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

        Client                                    Server
        ------                                    ------
        Data                   ------&gt;
        (cid=100)
        (src=208.16.24.2)
        (sport=6723)

                               &lt;-----             Data
                                              (cid=200)
                                              (dst=208.16.24.2)
                                              (dport=6723)

        Data                   ------&gt;
        (cid=100)
        (src=208.69.36.132)
        (sport=8901)

                               &lt;-----             Data
                                              (cid=200)
                                              (dst=208.69.36.132)
                                              (dport=8901)

                               &lt;-----             Data
                                              (cid=200)
                                              (dst=208.69.36.132)
                                              (dport=8901)

</pre></div>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Usage: Single Interface Host</h3>

<p>
                For a single-interface mobile host (MH), when the host moves to a new
                network and is assigned a new IP address, the MH can continue the
                secure communication by using the new IP address with the old
                security parameters.  No signaling is needed, and the transport and
                application will continue as soon as the MH is ready to use the new
                IP address.
            
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Usage: Multi-Interface Host</h3>

<p>
                Mobi-D is not intended to allow two interfaces to carry a single DTLS     
                flow simultaneously. If the MH has a Mobi-D connection and needs to 
                continue that connection on a new interface, and has a different IP 
                address on the new interface, the MH can continue the secure connection 
                on the new interface by using the new IP address with the old security 
                parameters.
            
</p>
<p>
                If the MH wants to use two or more interfaces at once, it perform the 
                DTLS handshake multiple times, allocating a unique connection_id for each 
                flow on each interface. This way the MH can create separate Mobi-D 
                connections for each of the flows from each interface.  Mobility that 
                causes only one of the interfaces to need a change of IP address is supported.
                For example, consider a mobile device with a small cell radio such as
                WLAN and a large cell radio such as LTE or WiMAX.  Local mobility
                might cause the Mobi-D connection on the WLAN to move to a new
                network and configure a new IP address, while the larger cell is
                still in range and doesn't create a need to modify the IP address.
                In this case the host can continue to use both Mobi-D connections
                while updating the IP address on one.
            
</p>
<p>
                In another multi-radio use case, the host may have two Mobi-D
                connections on two different interfaces, but may lose coverage on one
                of the radios.  In this case the MH may use the interface that is
                still in range and the IP address already available on that
                interface.  The MH begins sending the Mobi-D connection of the
                failing interface over the working interface.  There is no need to
                get a new IP address, or re-handshake on the new interface to accomodate 
                the second flow.
            
</p>
<p>
                The receiving host of a Mobi-D connection will typically be a server
                of some kind, but may be another MH.  The receiving host accepts
                Mobi-D packets from any IP address.  The connection to which the
                inbound packet belongs is determined by the connection identifier and
                corresponding security parameters.  In the case of a server
                receiving two inbound Mobi-D packets from the same client IP
                address, they will belong to the same connection or to different
                connections depending on the connection identifier and security
                parameters used by the MH when transmitting.            
            
</p>
<p>
                If an MH is behind a NAT, the Mobi-D packets may have NATed IP
                addresses or ports.  These will still be delivered based on them
                having a connection identifier and matching security parameters.            
            
</p>
<p>
                During and after the MH changes IP address, in-bound datagrams may be
                lost, until the MH sends a packet to the receiving server or host to
                cause the receiving host to add or update the new IP address to the
                connection.  This packet can be the next packet in the connection, or
                can be a special Mobi-D NOP packet to optimize the remote host's
                detection of the address change.            
            
</p>
<a name="details"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Details</h3>

<a name="details_extension"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Extensions</h3>

<p>The Mobility and OP extensions follow the TLS Extension format
                as defined in <a class='info' href='#RFC5246'>TLS<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5246]:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    struct {
      ExtensionType extension_type;
      opaque extension_data&lt;0..2^16-1&gt;;
    } Extension;

    enum {
      (65535)
    } ExtensionType;

</pre></div>
<p>The Mobility extension, OP extension, and new ExtensionType are 
                defined as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    enum {
      mobility(), op(), (65535)
    } ExtensionType;

    struct {
        uint32 connection_id;
        MobilityType mobile_type;
    } Mobility;

    enum { mobile(1), fixed(2), (255) } MobilityType;

    struct {
        uint8 length;
        OpType&lt;1..256&gt; op_types;
    } OP;

    enum { nop(1), (255) } OpType;

</pre></div>
<p>The extension_type for Mobi-D is maintained by IANA as described in the 
    <a class='info' href='#IANA'>section on IANA considerations<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>.
</p>
<a name="details_record"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Record Layer</h3>

<p>
                Mobi-D adds a connection identifier to the DTLS record layer
                which each host uses to look up the security parameters for
                the connection. The identifier (connection_id) is a single 32-bit integer,
                placed immediately after the content type.
            
</p>
<p>
                TODO: should this handle collisions with non-Mobi-D DTLS records? For
                example, certain values of the high order byte of connection_id could be
                made illegal. The current placement in the record leaves this possibility 
                open.
            
</p>
<p>The modified DTLS record layer is as follows. connection_id 
                is always the ID provided by the receiving party.
                
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    struct {
        ContentType type;
        uint32 connection_id;                   // New field
        ProtocolVersion version;
        uint16 epoch;
        uint48 sequence_number;
        uint16 length;
        opaque fragment[DTLSPlaintext.length];
    } DTLSPlaintext;

</pre></div>
<p>
                Once established, the connection_id remains in use throughout the life
                of the DTLS session, including in a re-handshake. The client MUST
                include the server's connection_id in every record sent to the server, 
                and likewise, the server MUST include the client's connection_id in every 
                record sent to the client.
            
</p>
<p>
				If a host receives a valid Mobi-D record with a valid connection_id from
				a new IP address or port, the host MUST use the message's source address 
				and port as the destination address and port for all new messages back to
				the sender. A host MUST NOT change the destination address and port for
				the correspondent host until after successfully authenticating and verifying
				the sequence number of the DTLS record according to the connection_id 
				contained within.
            
</p>
<p>
                A new handshake (either for session resumption or a full handshake) MUST NOT
                use connection_ids in ClientHello and ServerHello because the IDs will point 
                to existing security parameters that do not yet apply to the flow. The client 
                and server MAY agree to re-use the same connection_ids via the Mobility 
                extension negotiation in the handshake. Multiple connections between the same 
                client and server MUST use different connection_ids and security parameters.
            
</p>
<p>
                However, a re-handshake during an established session MUST include 
                connection_ids in all records, as the connection_ids are necessary for
                each party to find the current security parameters.
            
</p>
<p>
    			The introduction of the connection identifier creates the possibility for an 
    			attacker with access to the packet flow to forward a packet after modifying the 
    			IP address or port, causing the return packet to be misaddressed. This attack
    			is discussed further in the <a class='info' href='#security'>Security Considerations section<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> below.
            
</p>
<a name="details_message"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Message</h3>

<p>
                Mobi-D adds a new message to TLS: the OP message. OP MUST be consumed 
                by the receiving DTLS implementation and MUST NOT be delivered to the 
                application. OP is an extensible message; other extensions may add OP message 
                types. OP is implemented using a new content type, op, provided by IANA
                (see <a class='info' href='#IANA'>Section&nbsp;6<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>). Like other messages, op messages are encrypted 
                and compressed, as specified by the current connection state. Mobi-D defines 
                the NOP (no-op) OP message type.
            
</p>
<p>
                Only OP message types negotiated in the OP Hello extension may be sent
                in a connection.
            
</p>
<p>The extended ContentType is as follows. The OP content type 
                is maintained by IANA as described in <a class='info' href='#IANA'>Section&nbsp;6<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    enum {
        change_cipher_spec(20), alert(21), handshake(22),
        application_data(23), op(), (255)
    } ContentType;
</pre></div>
<p>The OP message is defined as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    enum { nop(1), (255) } OpType;

    struct {
        OpType op_type;
        opaque op_data&lt;0..2^14-1&gt;;
    } OP;

</pre></div>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Cryptography</h3>

<p>Mobi-D makes no changes to the cryptography of DTLS.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Connection ID</h3>

<p>
                The connection_id has no cryptographic properties. An attacker able
                to capture packets can modify the connection_id. A Mobi-D host that
                receives a DTLS record with an incorrect (but valid) connection_id 
                will be unable to authenticate the record and will reject it. 
                A Mobi-D host that receives a record with an invalid connection_id
                (one it does not recognize) MUST discard the record.
            
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Denial of Service</h3>

<p>Mobi-D introduces new DoS attack. An attacker able to capture datagrams from 
            the client will be able to send a valid datagram to the server from a forged IP 
            address. This will cause the server to transmit packets to the forged address until 
            the server receives a new packet from the real client. The same attack can occur
            in the other direction, but can be mitigated by the use of the fixed MobilityType in
            the server's Mobility extension.
</p>
<p>Such an attack could deny service to the victim(s), but would not
            compromise the integrity of the encrypted data, nor allow the attacker
            to inject data of his own choosing, or to replay datagrams. Further, 
            this attack is not substantially different from other denial of service attacks.
            
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>
            The Mobility extension number, OP extension number, and the OP content type will 
            need to be registered with IANA.
        
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Acknowledgements</h3>

<p>The authors want to thank Pasi Eronen, Hannes Tschofenig, Basaravaj (Raj) Patil, 
      Dan Wing, Teemu Savolainen, Lars Eggert, and Eric Rescorla
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4347">[RFC4347]</a></td>
<td class="author-text">Rescorla, E. and N. Modadugu, &ldquo;<a href="http://tools.ietf.org/html/rfc4347">Datagram Transport Layer Security</a>,&rdquo; RFC&nbsp;4347, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4347.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5246">[RFC5246]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>,&rdquo; RFC&nbsp;5246, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5246.txt">TXT</a>).</td></tr>
</table>

<a name="app-additional"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Additional Stuff</h3>

<p>This becomes an Appendix.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Michael Williams</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:michael.g.williams@nokia.com">michael.g.williams@nokia.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jeremey Barrett</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jeremey.barrett@nokia.com">jeremey.barrett@nokia.com</a></td></tr>
</table>
</body></html>
