<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>EAP Generalized Pre-Shared Key (EAP-GPSK) Method</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="EAP Generalized Pre-Shared Key (EAP-GPSK) Method">
<meta name="keywords" content="EAP, EAP-GPSK, Pre-shared Key">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">EMU Working Group</td><td class="header">T. Clancy</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">LTS</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">H. Tschofenig</td></tr>
<tr><td class="header">Expires: January 30, 2009</td><td class="header">Nokia Siemens Networks</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">July 29, 2008</td></tr>
</table></td></tr></table>
<h1><br />EAP Generalized Pre-Shared Key (EAP-GPSK) Method<br />draft-ietf-emu-eap-gpsk-11</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on January 30, 2009.</p>

<h3>Abstract</h3>

<p>This Internet Draft defines an Extensible Authentication Protocol method called EAP
        Generalized Pre-Shared Key (EAP-GPSK). This method is a lightweight shared-key
        authentication protocol supporting mutual authentication and key derivation.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<br />
<a href="#overview">3.</a>&nbsp;
Overview<br />
<br />
<a href="#keyderivation">4.</a>&nbsp;
Key Derivation<br />
<br />
<a href="#anchor3">5.</a>&nbsp;
Key Management<br />
<br />
<a href="#anchor4">6.</a>&nbsp;
Ciphersuites<br />
<br />
<a href="#gkdf-section">7.</a>&nbsp;
Generalized Key Derivation Function (GKDF)<br />
<br />
<a href="#anchor5">8.</a>&nbsp;
Ciphersuites Processing Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">8.1.</a>&nbsp;
Ciphersuite #1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">8.1.1.</a>&nbsp;
Encryption<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">8.1.2.</a>&nbsp;
Integrity<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">8.2.</a>&nbsp;
Ciphersuite #2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">8.2.1.</a>&nbsp;
Encryption<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">8.2.2.</a>&nbsp;
Integrity<br />
<br />
<a href="#anchor12">9.</a>&nbsp;
Packet Formats<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">9.1.</a>&nbsp;
Header Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">9.2.</a>&nbsp;
Ciphersuite Formatting<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">9.3.</a>&nbsp;
Payload Formatting<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#protected-data">9.4.</a>&nbsp;
Protected Data<br />
<br />
<a href="#anchor16">10.</a>&nbsp;
Packet Processing Rules<br />
<br />
<a href="#anchor17">11.</a>&nbsp;
Example Message Exchanges<br />
<br />
<a href="#seccons">12.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">12.1.</a>&nbsp;
Security Claims<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#mut">12.2.</a>&nbsp;
Mutual Authentication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#protr">12.3.</a>&nbsp;
Protected Result Indications<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#int">12.4.</a>&nbsp;
Integrity Protection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#repl">12.5.</a>&nbsp;
Replay Protection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#refl">12.6.</a>&nbsp;
Reflection attacks<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dic">12.7.</a>&nbsp;
Dictionary Attacks<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#keyder">12.8.</a>&nbsp;
Key Derivation and Key Strength<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dos">12.9.</a>&nbsp;
Denial of Service Resistance<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ssi">12.10.</a>&nbsp;
Session Independence<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#expo">12.11.</a>&nbsp;
Compromise of the PSK<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#frag">12.12.</a>&nbsp;
Fragmentation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cbind">12.13.</a>&nbsp;
Channel Binding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#freco">12.14.</a>&nbsp;
Fast Reconnect<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#idpro">12.15.</a>&nbsp;
Identity Protection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pcn">12.16.</a>&nbsp;
Protected Ciphersuite Negotiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#conf">12.17.</a>&nbsp;
Confidentiality<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cryptobind">12.18.</a>&nbsp;
Cryptographic Binding<br />
<br />
<a href="#anchor19">13.</a>&nbsp;
IANA Considerations<br />
<br />
<a href="#anchor20">14.</a>&nbsp;
Contributors<br />
<br />
<a href="#anchor21">15.</a>&nbsp;
Acknowledgments<br />
<br />
<a href="#rfc.references1">16.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">16.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">16.2.</a>&nbsp;
Informative References<br />
<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>EAP Generalized Pre-Shared Key (EAP-GPSK) is an EAP method defining a generalized
        pre-shared key authentication technique. Mutual authentication is achieved through a
        nonce-based exchange that is secured by a pre-shared key.
</p>
<p>EAP-GPSK addresses a large number of design goals with the intention of being applicable in
        a broad range of usage scenarios.
</p>
<p>The main design goals of EAP-GPSK are 
</p>
<p>
        </p>
<blockquote class="text"><dl>
<dt>Simplicity:</dt>
<dd>
            <br />
 EAP-GPSK should be easy to implement. <br />
<br />

          
</dd>
<dt>Security Model:</dt>
<dd>
            <br />
EAP-GPSK has been designed in a threat model where the attacker
            has full control over the communication channel. This is the EAP threat model that is
            presented in Section 7.1 of <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a>.<br />
<br />

          
</dd>
<dt>Efficiency:</dt>
<dd>
            <br />
EAP-GPSK does not make use of public key cryptography and fully
            relies of symmetric cryptography. The restriction on symmetric cryptographic
            computations allows for low computational overhead. Hence, EAP-GPSK is lightweight and
            well suited for any type of device, especially those with processing power, memory and
            battery constraints. Additionally it seeks to minimize the number of round trips.
              <br />
<br />

          
</dd>
<dt>Flexibility:</dt>
<dd>
            <br />
EAP-GPSK offers cryptographic flexibility. At the beginning, the
            EAP server proposes a list of ciphersuites. The client then selects one. The current
            version of EAP-GPSK comprises two ciphersuites, but additional ones can be easily
              added.<br />
<br />

          
</dd>
<dt>Extensibility:</dt>
<dd>
            <br />
The design of EAP-GPSK allows to securely exchange information
            between the EAP peer and the EAP server using protected data fields. These fields might,
            for example, be used to exchange channel binding information or to provide support for
            identity confidentiality. <br />
<br />

          
</dd>
</dl></blockquote><p>
      
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>In this document, several words are used to signify the requirements of the specification.
        These words are often capitalized. The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
        "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document
        are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>This section describes the various variables and functions used in the EAP-GPSK method.
</p>
<p>Variables:<br />
<br />

        </p>
<blockquote class="text"><dl>
<dt>CSuite_List:</dt>
<dd> An octet array listing available ciphersuites (variable
              length)<br />

          
</dd>
<dt>CSuite_Sel:</dt>
<dd> Ciphersuite selected by the peer (6 octets)<br />

          
</dd>
<dt>ID_Peer:</dt>
<dd> Peer NAI <a class='info' href='#RFC4282'>[RFC4282]<span> (</span><span class='info'>Aboba, B., Beadles, M., Arkko, J., and P. Eronen, &ldquo;The Network Access Identifier,&rdquo; December&nbsp;2005.</span><span>)</span></a>
            <br />

          
</dd>
<dt>ID_Server:</dt>
<dd> Server identity as an opaque blob.<br />

          
</dd>
<dt>KS:</dt>
<dd> Integer representing the input key size in octets of the selected
            ciphersuite CSuite_Sel. The key size is one of the ciphersuite parameters.<br />

          
</dd>
<dt>PD_Payload:</dt>
<dd> Data carried within the protected data payload<br />

</dd>
<dt>PD_Payload_Block:</dt>
<dd> Block of possibly multiple PD_Payloads carried by a GPSK
              packet<br />

</dd>
<dt>PL:</dt>
<dd> Integer representing the length of the PSK in octets (2 octets). 
            PL MUST be larger than or equal to KS. 
            <br />

          
</dd>
<dt>RAND_Peer:</dt>
<dd> Random integer generated by the peer (32 octets)<br />

          
</dd>
<dt>RAND_Server:</dt>
<dd> Random integer generated by the server (32 octets)<br />

          
</dd>
</dl></blockquote><p>
      
</p>
<p>Operations:<br />
<br />

        </p>
<blockquote class="text"><dl>
<dt>A || B:</dt>
<dd> Concatenation of octet strings A and B<br />

          
</dd>
<dt>A**B:</dt>
<dd> Integer exponentiation <br />

          
</dd>
<dt>truncate(A,B):</dt>
<dd> Returns the first B octets of A<br />

</dd>
<dt>ENC_X(Y):</dt>
<dd> Encryption of message Y with a symmetric key X, using a defined
            block cipher<br />

          
</dd>
<dt>KDF_X(Y):</dt>
<dd> Key Derivation Function that generates an arbitrary number of
            octets of output using secret X and seed Y<br />

</dd>
<dt>length(X):</dt>
<dd> Function that returns the length of input X in octets, encoded
            as a 2-octet integer in network byte order<br />

          
</dd>
<dt>MAC_X(Y):</dt>
<dd> Keyed message authentication code computed over Y with symmetric
            key X<br />

          
</dd>
<dt>SEC_X(Y):</dt>
<dd> SEC is a function that provides integrity protection based on the
            chosen ciphersuite. The function SEC uses the algorithm defined by the selected
            ciphersuite and applies it to the message content Y with key X. In short, SEC_X(Y) = Y
            || MAC_X(Y). <br />

          
</dd>
<dt>X[A..B]:</dt>
<dd> Notation representing octets A through B of octet array X<br />

          
</dd>
</dl></blockquote><p>
      
</p>
<p>The following abbreviations are used for the keying material:<br />
<br />

        </p>
<blockquote class="text"><dl>
<dt>EMSK:</dt>
<dd> Extended Master Session Key is exported by the EAP method (64
              octets)<br />

          
</dd>
<dt>MK:</dt>
<dd> Master Key between the peer and EAP server from which all other EAP
            method session keys are derived (KS octets)<br />

          
</dd>
<dt>MSK:</dt>
<dd> Master Session Key exported by the EAP method (64 octets)<br />

          
</dd>
<dt>PK:</dt>
<dd> Session key generated from the MK and used during protocol exchange to
            encrypt protected data (KS octets)<br />

          
</dd>
<dt>PSK:</dt>
<dd> Long-term key shared between the peer and the server (PL
              octets)<br />

          
</dd>
<dt>SK:</dt>
<dd> Session key generated from the MK and used during protocol exchange to
            demonstrate knowledge of the PSK (KS octets)<br />

          
</dd>
</dl></blockquote><p>
      
</p>
<a name="overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Overview</h3>

<p>The EAP framework (see Section 1.3 of <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a>) defines three basic steps
        that occur during the execution of an EAP conversation between the EAP peer, the
        Authenticator and the EAP server.
</p>
<p>
        </p>
<ol class="text">
<li>The first phase, discovery, is handled by the underlying protocol.
</li>
<li>The EAP authentication phase with EAP-GPSK is defined in this document.
</li>
<li>The secure association distribution and secure association phases are handled
            differently depending on the underlying protocol.
</li>
</ol><p>
      
</p>
<p>EAP-GPSK performs mutual authentication between EAP peer ("Peer") and EAP server ("Server")
        based on a pre-shared key (PSK). The protocol consists of the message exchanges (GPSK-1,
        ..., GPSK-4), in which both sides exchange nonces and their identities, compute and exchange
        a Message Authentication Code (MAC) over the previously exchanged values, keyed with the
        pre-shared key. This MAC is considered as proof of possession of the pre-shared key. Two further 
        messages, namely GPSK-Fail and GPSK-Protected-Fail are used to deal with error situations.
      
</p>
<p>A successful protocol exchange is shown in <a class='info' href='#eap-gpsk-success'>Figure&nbsp;1<span> (</span><span class='info'>EAP-GPSK: Successful Exchange</span><span>)</span></a>.
</p>
<p>
        <br /><hr class="insert" />
<a name="eap-gpsk-success"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+--------+                                     +--------+
|        |                EAP-Request/Identity |        |
|  EAP   |&lt;------------------------------------|  EAP   |
|  peer  |                                     | server |
|        | EAP-Response/Identity               |        |
|        |------------------------------------&gt;|        |
|        |                                     |        |
|        |                  EAP-Request/GPSK-1 |        |
|        |&lt;------------------------------------|        |
|        |                                     |        |
|        | EAP-Response/GPSK-2                 |        |
|        |------------------------------------&gt;|        |
|        |                                     |        |
|        |                  EAP-Request/GPSK-3 |        |
|        |&lt;------------------------------------|        |
|        |                                     |        |
|        | EAP-Response/GPSK-4                 |        |
|        |------------------------------------&gt;|        |
|        |                                     |        |
|        |          EAP-Success                |        |
|        |&lt;------------------------------------|        |
+--------+                                     +--------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: EAP-GPSK: Successful Exchange&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>The full EAP-GPSK protocol is as follows: </p>
<blockquote class="text"><dl>
<dt>GPSK-1:</dt>
<dd><br />
 ID_Server, RAND_Server, CSuite_List <br />
<br />

          
</dd>
<dt>GPSK-2:</dt>
<dd><br />
 SEC_SK(ID_Peer, ID_Server, RAND_Peer,
            RAND_Server, CSuite_List, CSuite_Sel, [ ENC_PK(PD_Payload_Block) ] ) <br />
<br />

          
</dd>
<dt>GPSK-3:</dt>
<dd><br />
 SEC_SK(RAND_Peer, RAND_Server, ID_Server,
            CSuite_Sel, [ ENC_PK(PD_Payload_Block) ] ) <br />
<br />

          
</dd>
<dt>GPSK-4:</dt>
<dd><br />
 SEC_SK( [ ENC_PK(PD_Payload_Block) ] )
              <br />
<br />

          
</dd>
</dl></blockquote><p>
      
</p>
<p>The EAP server begins EAP-GPSK by selecting a random number RAND_Server and by encoding the
        supported ciphersuites into CSuite_List. A ciphersuite consists of an encryption algorithm,
        a key derivation function and a message authentication code.
</p>
<p>In GPSK-1, the EAP server sends its identity ID_Server, a random number RAND_Server and a
        list of supported ciphersuites CSuite_List. The decision which ciphersuite to offer and
        which ciphersuite to pick is policy- and implementation-dependent and therefore outside the
        scope of this document.
</p>
<p>In GPSK-2, the peer sends its identity ID_Peer and a random number RAND_Peer. Furthermore,
        it repeats the received parameters of the GPSK-1 message (ID_Server, RAND_Server,
        CSuite_List) and the selected ciphersuite. It computes a Message Authentication Code over
        all the transmitted parameters.
</p>
<p>The EAP server verifies the received Message Authentication Code. In case of successful
        verification, the EAP server computes a Message Authentication Code over the session
        parameter and returns it to the peer (within GPSK-3). Within GPSK-2 and GPSK-3, peer and EAP
        server have the possibility to exchange encrypted protected data parameters.
</p>
<p>The peer verifies the received Message Authentication Code. If the verification is
        successful, GPSK-4 is prepared. This message can optionally contain the peer's protected
        data parameters.
</p>
<p>Upon receipt of GPSK-4, the server processes any included PD_Payload_Block. Then, the EAP
        server sends an EAP Success message to indicate the successful outcome of the
        authentication.
</p>
<a name="keyderivation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Key Derivation</h3>

<p>EAP-GPSK provides key derivation in compliance to the requirements of <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a> and <a class='info' href='#I-D.ietf-eap-keying'>[I&#8209;D.ietf&#8209;eap&#8209;keying]<span> (</span><span class='info'>Aboba, B., Simon, D., and P. Eronen, &ldquo;Extensible Authentication Protocol (EAP) Key Management Framework,&rdquo; November&nbsp;2007.</span><span>)</span></a>. Note that this section
        provides an abstract description for the key derivation procedure that needs to be
        instantiated with a specific ciphersuite. 
</p>
<p>The long-term credential shared between EAP peer and EAP server SHOULD be a strong
        pre-shared key PSK of at least 16 octets, though its length and entropy is variable. While
        it is possible to use a password or passphrase, doing so is NOT RECOMMENDED as it would make
        EAP-GPSK vulnerable to dictionary attacks.
</p>
<p>During an EAP-GPSK authentication, a Master Key MK, a Session Key SK and a Protected Data
        Encryption Key PK (if using an encrypting ciphersuite) are derived using the
        ciphersuite-specified KDF and data exchanged during the execution of the protocol, namely
        'RAND_Peer || ID_Peer || RAND_Server || ID_Server' referred as inputString as its short-hand
        form.
</p>
<p>In case of successful completion, EAP-GPSK derives and exports an MSK and EMSK both in
        length of 64 octets.
</p>
<p>The following notation is used: KDF-X(Y, Z)[A..B], whereby </p>
<blockquote class="text"><dl>
<dt>X</dt>
<dd>is the length, in octets, of the desired output,
</dd>
<dt>Y</dt>
<dd>is a secret key,
</dd>
<dt>Z</dt>
<dd>is the inputString,
</dd>
<dt>[A..B]</dt>
<dd>extracts the string of octets starting with octet A finishing with
            octet B from the output of the KDF function.
</dd>
</dl></blockquote><p>
      
</p>
<p> This keying material is derived using the ciphersuite-specified KDF as follows:
</p>
<p>
        </p>
<ul class="text">
<li>inputString = RAND_Peer || ID_Peer || RAND_Server || ID_Server
</li>
<li>MK = KDF-KS(PSK[0..KS-1], PL || PSK || CSuite_Sel || inputString)[0..KS-1]
</li>
<li>MSK = KDF-{128+2*KS}(MK, inputString)[0..63]
</li>
<li>EMSK = KDF-{128+2*KS}(MK, inputString)[64..127]
</li>
<li>SK = KDF-{128+2*KS}(MK, inputString)[128..127+KS]
</li>
<li>PK = KDF-{128+2*KS}(MK, inputString)[128+KS..127+2*KS] (if using an encrypting
            ciphersuite)
</li>
</ul><p>
      
</p>
<p>From this it should be noted that EAP-GSPK assumes the cipher key input length is equal to
        the MAC output length. This is generally true of many ciphersuites, but would prevent the
        definition of a ciphersuite that used a one input key length and a different output MAC
        length.  The value for PL is encoded as a 2-octet integer in network byte order.
</p>
<p>Additionally, the EAP keying framework <a class='info' href='#I-D.ietf-eap-keying'>[I&#8209;D.ietf&#8209;eap&#8209;keying]<span> (</span><span class='info'>Aboba, B., Simon, D., and P. Eronen, &ldquo;Extensible Authentication Protocol (EAP) Key Management Framework,&rdquo; November&nbsp;2007.</span><span>)</span></a> requires the
        definition of a Method-ID, Session-ID, Peer-ID, and Server-ID. These values are defined as:
</p>
<p>
        </p>
<ul class="text">
<li>zero = 0x00 || 0x00 || ... || 0x00 (KS times)
</li>
<li>Method-ID = KDF-16(zero, "Method ID" || EAP_Method_Type || CSuite_Sel ||
            inputString)[0..15]
</li>
<li>Session-ID = Type_Code || Method_ID
</li>
<li>Peer-ID = ID_Peer
</li>
<li>Server-ID = ID_Server
</li>
</ul><p>
      
</p>
<p>EAP_Method_Type refers to the 1-octet IANA allocated EAP Type code value.
</p>
<p>
        <a class='info' href='#keyderiv'>Figure&nbsp;2<span> (</span><span class='info'>EAP-GPSK Key Derivation</span><span>)</span></a> depicts the key derivation procedure of EAP-GPSK.
</p>
<p>
        <br /><hr class="insert" />
<a name="keyderiv"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+-------------+     +-------------------------------+
|   PL-octet  |     | RAND_Peer || ID_Peer ||       |
|     PSK     |     | RAND_Server || ID_Server      |
+-------------+     +-------------------------------+
       |                            |            |
       |     +------------+         |            |
       |     | CSuite_Sel |         |            |
       |     +------------+         |            |
       |           |                |            |
       v           v                v            |
+--------------------------------------------+   |
|                    KDF                     |   |
+--------------------------------------------+   |
                          |                      |
                          v                      |
                   +-------------+               |
                   |   KS-octet  |               |
                   |     MK      |               |
                   +-------------+               |
                          |                      |
                          v                      v
+---------------------------------------------------+
|                      KDF                          |
+---------------------------------------------------+
     |             |             |            |
     v             v             v            v
+---------+   +---------+  +----------+  +----------+
| 64-octet|   | 64-octet|  | KS-octet |  | KS-octet |
|   MSK   |   |  EMSK   |  |    SK    |  |   PK     |
+---------+   +---------+  +----------+  +----------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: EAP-GPSK Key Derivation&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Key Management</h3>

<p>In order to be interoperable, PSKs must be entered in the same way on both the peer and
        server. The management interface for entering PSKs MUST support entering PSKs up to 64
        octets in length as ASCII strings and in hexadecimal encoding.
</p>
<p>Additionally, the ID_Peer and ID_Server MUST be provisioned
        with the PSK. Validation of these values is by an octet-wise
        comparison. The management interface SHOULD support entering
        non-ASCII octets for the ID_Peer and ID_Server up to 254
        octets in length. For more information the reader is adviced
        to read Section 2.4 of RFC 4282 <a class='info' href='#RFC4282'>[RFC4282]<span> (</span><span class='info'>Aboba, B., Beadles, M., Arkko, J., and P. Eronen, &ldquo;The Network Access Identifier,&rdquo; December&nbsp;2005.</span><span>)</span></a>.
      
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Ciphersuites</h3>

<p>The design of EAP-GPSK allows cryptographic algorithms and key sizes, called ciphersuites,
        to be negotiated during the protocol run. The ability to specify block-based and hash-based
        ciphersuites is offered. Extensibility is provided with the introduction of new
        ciphersuites; this document specifies an initial set. The CSuite/Specifier column in <a class='info' href='#ciphersuites'>Figure&nbsp;3<span> (</span><span class='info'>Ciphersuites</span><span>)</span></a> uniquely identifies a ciphersuite.
</p>
<p>For a vendor-specific ciphersuite the first four octets are the vendor-specific enterprise
        number contains the IANA assigned "SMI Network Management Private Enterprise Codes" value
        (see <a class='info' href='#ENTNUM'>[ENTNUM]<span> (</span><span class='info'>IANA, &ldquo;SMI Network Management Private Enterprise Codes,&rdquo; .</span><span>)</span></a>), encoded in network byte order. The last two octets are vendor
        assigned for the specific ciphersuite. A vendor code of 0x00000000 indicates ciphersuites
        standardized by IETF in an IANA-maintained registry.
</p>
<p>The following ciphersuites are specified in this document: 
</p>
<p>
        <br /><hr class="insert" />
<a name="ciphersuites"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+------------+----+-------------+--------------+----------------+
| CSuite/    | KS | Encryption  | Integrity /  | Key Derivation |
| Specifier  |    |             | KDF MAC      | Function       |
+------------+----+-------------+--------------+----------------+
| 0x00000001 | 16 | AES-CBC-128 | AES-CMAC-128 | GKDF           |
+------------+----+-------------+--------------+----------------+
| 0x00000002 | 32 | NULL        | HMAC-SHA256  | GKDF           |
+------------+----+-------------+--------------+----------------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Ciphersuites&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>Ciphersuite 1, which is based on AES as a cryptographic primitive, MUST be implemented.
        This document specifies also a second ciphersuite, which MAY be implemented. Both
        ciphersuites defined in this document make use of the GKDF, as defined in <a class='info' href='#gkdf-section'>Section&nbsp;7<span> (</span><span class='info'>Generalized Key Derivation Function (GKDF)</span><span>)</span></a>. The following aspects need to be considered to ensure that the
        PSK that is used as input to the GKDF is sufficiently long (in case it is longer it needs to
        be truncated): 
</p>
<p>
        </p>
<ol class="text">
<li> The PSK used with ciphersuite 1 MUST be 128 bits in length or longer. 
</li>
<li>The PSK used with ciphersuite 2 MUST be 256 bits in length or longer. 
</li>
<li> It is RECOMMENDED that 256 bit keys be provisioned in all cases to provide enough
            entropy for all current and many possible future ciphersuites. 
</li>
</ol><p>
      
</p>
<p>Ciphersuites defined in the future that make use of the GKDF need to specify a minimum PSK
        size (as it is done with the ciphersuites listed in this document). 
</p>
<a name="gkdf-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Generalized Key Derivation Function (GKDF)</h3>

<p>Each ciphersuite needs to specify a key derivation function. The ciphersuites defined in
        this document make use of the Generalized Key Derivation Function (GKDF) that utilizes the
        MAC function defined in the ciphersuite. Future ciphersuites can use any other formally
        specified KDF that takes as arguments a key and a seed value, and produces at least 128+2*KS
        octets of output.
</p>
<p>GKDF has the following structure: 
</p>
<p>GKDF-X(Y, Z)
</p>
<p>
        </p>
<blockquote class="text"><dl>
<dt>X</dt>
<dd>length, in octets, of the desired output
</dd>
<dt>Y</dt>
<dd>secret key
</dd>
<dt>Z</dt>
<dd>inputString
</dd>
</dl></blockquote><p>
      
</p>
<p>
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GKDF-X (Y, Z)
{
  n = ceiling integer of ( X / KS );
     /* determine number of output blocks */

  M_0 = "";
  result = "";

  for i = 1 to n {
    M_i = MAC_Y (i || Z);
    result = result || M_i;
  }

  return truncate(result, X)
}
</pre></div><p>

      
</p>
<p>Note that the variable 'i' in M_i is represented as a 2-octet value in network byte
      order.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Ciphersuites Processing Rules</h3>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Ciphersuite #1</h3>

<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.1"></a><h3>8.1.1.&nbsp;
Encryption</h3>

<p>With this ciphersuite all cryptography is built around a single cryptographic
            primitive, AES-128 (<a class='info' href='#AES'>[AES]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;Specification for the Advanced Encryption Standard (AES),&rdquo; November&nbsp;2001.</span><span>)</span></a>). Within the protected data frames, AES-128 is
            used in Cipher Block Chaining (CBC) mode of operation (see <a class='info' href='#CBC'>[CBC]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;Recommendation for Block Cipher Modes of Encryption. Methods and Techniques.,&rdquo; December&nbsp;2001.</span><span>)</span></a>). This
            EAP method uses encryption in a single payload, in the protected data payload (see <a class='info' href='#protected-data'>Section&nbsp;9.4<span> (</span><span class='info'>Protected Data</span><span>)</span></a>). 
</p>
<p>In a nutshell, the CBC mode proceeds as follows. The IV is XORed with the first
            plaintext block before it is encrypted. Then for successive blocks, the previous
            ciphertext block is XORed with the current plaintext, before it is encrypted.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.2"></a><h3>8.1.2.&nbsp;
Integrity</h3>

<p>Ciphersuite 1 uses CMAC as Message Authentication Code. CMAC is recommended by NIST.
            Among its advantages, CMAC is capable to work with messages of arbitrary length. A
            detailed description of CMAC can be found in <a class='info' href='#CMAC'>[CMAC]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;Recommendation for Block Cipher Modes of Operation: The CMAC Mode for             Authentication,&rdquo; May&nbsp;2005.</span><span>)</span></a>.<br />
<br />

          
</p>
<p>The following instantiation is used: AES-CMAC-128(SK, Input) denotes the MAC of Input
            under the key SK where Input refers to the following content:
</p>
<p>
            </p>
<ul class="text">
<li>Parameter within SEC_SK(Parameter) in message GPSK-2
</li>
<li>Parameter within SEC_SK(Parameter) in message GPSK-3
</li>
<li>Parameter within SEC_SK(Parameter) in message GPSK-4
</li>
</ul><p>
          
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Ciphersuite #2</h3>

<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.1"></a><h3>8.2.1.&nbsp;
Encryption</h3>

<p>Ciphersuite 2 does not include an algorithm for encryption. With a NULL encryption
            algorithm, encryption is defined as:
</p>
<p>E_X(Y) = Y 
</p>
<p>When using this ciphersuite, the data exchanged inside the protected data block is not
            encrypted. Therefore this mode MUST NOT be used if confidential information appears
            inside the protected data block.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.2"></a><h3>8.2.2.&nbsp;
Integrity</h3>

<p>Ciphersuite 2 uses the keyed MAC function HMAC, with the SHA256 hash algorithm (see
              <a class='info' href='#RFC4634'>[RFC4634]<span> (</span><span class='info'>Eastlake, D. and T. Hansen, &ldquo;US Secure Hash Algorithms (SHA and HMAC-SHA),&rdquo; July&nbsp;2006.</span><span>)</span></a>).
</p>
<p>For integrity protection the following instantiation is used:
</p>
<p>HMAC-SHA256(SK, Input) denotes the MAC of Input under the key SK where Input refers to
            the following content:
</p>
<p>
            </p>
<ul class="text">
<li>Parameter within SEC_SK(Parameter) in message GPSK-2
</li>
<li>Parameter within SEC_SK(Parameter) in message GPSK-3
</li>
<li>Parameter within SEC_SK(Parameter) in message GPSK-4
</li>
</ul><p>
          
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Packet Formats</h3>

<p>This section defines the packet format of the EAP-GPSK messages.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
Header Format</h3>

<p>The EAP-GPSK header has the following structure:
</p><br /><hr class="insert" />
<a name="gpskpacket"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
--- bit offset ---&gt;
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |    OP-Code    |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                                                               |
...                         Payload                           ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The Code, Identifier, Length, and Type fields are all part of the EAP header, and defined
          in <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a>. The Type field in the EAP header MUST be the value allocated
          by IANA for EAP-GPSK.
</p>
<p>The OP-Code field is one of four values:
</p>
<p>
          </p>
<ul class="text">
<li>0x01 : GPSK-1
</li>
<li>0x02 : GPSK-2
</li>
<li>0x03 : GPSK-3
</li>
<li>0x04 : GPSK-4
</li>
<li>0x05 : GPSK-Fail
</li>
<li>0x06 : GPSK-Protected-Fail
</li>
</ul><p>
        
</p>
<p>All other values of this OP-Code field are available via IANA registration. 
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
Ciphersuite Formatting</h3>

<p>Ciphersuites are encoded as 6-octet arrays. The first four octets indicate the
          CSuite/Vendor field. For vendor-specific ciphersuites, this represents the vendor
          enterprise number and contains the IANA assigned "SMI Network Management Private
          Enterprise Codes" value (see <a class='info' href='#ENTNUM'>[ENTNUM]<span> (</span><span class='info'>IANA, &ldquo;SMI Network Management Private Enterprise Codes,&rdquo; .</span><span>)</span></a>), encoded in network byte order. The
          last two octets indicate the CSuite/Specifier field, which identifies the particular
          ciphersuite. The 4-octet CSuite/Vendor value 0x00000000 indicates ciphersuites allocated
          by the IETF.
</p>
<p>Graphically, they are represented as<br /><hr class="insert" />
<a name="thing"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
--- bit offset ---&gt;
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       CSuite/Vendor = 0x00000000 or enterprise number         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      CSuite/Specifier         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

        
</p>
<p>CSuite_Sel is encoded as a 6-octet ciphersuite CSuite/Vendor and CSuite/Specifier pair.
</p>
<p>CSuite_List is a variable-length octet array of ciphersuites. It is encoded by
          concatenating encoded ciphersuite values. Its length in octets MUST be a multiple of
        6.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3"></a><h3>9.3.&nbsp;
Payload Formatting</h3>

<p>Payload formatting is based on the protocol exchange description in <a class='info' href='#overview'>Section&nbsp;3<span> (</span><span class='info'>Overview</span><span>)</span></a>.
</p>
<p>The GPSK-1 payload format is defined as follows:
</p>
<p>
          <br /><hr class="insert" />
<a name="payload-gpsk-1"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
--- bit offset ---&gt;
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       length(ID_Server)       |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                                                               |
...                         ID_Server                         ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                   32-octet RAND_Server                    ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      length(CSuite_List)      |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                                                               |
...                        CSuite_List                        ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: GPSK-1 Payload&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

        
</p>
<p>The GPSK-2 payload format is defined as follows:
</p>
<p>
          <br /><hr class="insert" />
<a name="payload-gpsk-2"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
--- bit offset ---&gt;
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        length(ID_Peer)        |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                                                               |
...                         ID_Peer                         ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       length(ID_Server)       |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                                                               |
...                         ID_Server                         ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                     32-octet RAND_Peer                    ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                    32-octet RAND_Server                   ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      length(CSuite_List)      |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                                                               |
...                        CSuite_List                        ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           CSuite_Sel                          |
+                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               |   length(PD_Payload_Block)    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                 optional PD_Payload_Block                 ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                   KS-octet payload MAC                    ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: GPSK-2 Payload&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

        
</p>
<p>If the optional protected data payload is not included, then length(PD_Payload_Block)=0
          and the PD payload is excluded. The payload MAC covers the entire packet, 
          from the ID_Peer length, up through the optional PD_Payload_Block.
</p>
<p>The GPSK-3 payload is defined as follows:
</p>
<p>
          <br /><hr class="insert" />
<a name="payload-gpsk-3"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
--- bit offset ---&gt;
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                    32-octet RAND_Peer                   ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                    32-octet RAND_Server                   ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       length(ID_Server)       |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                                                               |
...                         ID_Server                         ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           CSuite_Sel                          |
+                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               |   length(PD_Payload_Block)    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                 optional PD_Payload_Block                 ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                   KS-octet payload MAC                    ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: GPSK-3 Payload&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

        
</p>
<p>If the optional protected data payload is not included, then length(PD_Payload_Block)=0
          and the PD payload is excluded. The payload MAC covers the entire packet, from the
          RAND_Peer, up through the optional PD_Payload_Block.
</p>
<p>The GPSK-4 payload format is defined as follows:
</p>
<p>
          <br /><hr class="insert" />
<a name="payload-gpsk-4"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
--- bit offset ---&gt;
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   length(PD_Payload_Block)    |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                                                               |
...                 optional PD_Payload_Block                 ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                   KS-octet payload MAC                    ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;9: GPSK-4 Payload&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

        
</p>
<p>If the optional protected data payload is not included, then length(PD_Payload_Block)=0
          and the PD payload is excluded. The MAC MUST always be included, regardless of the
          presence of PD_Payload_Block. The payload MAC covers the entire packet, from the
          PD_Payload_Block length up through the optional PD_Payload_Block.
</p>
<p>The GPSK-Fail payload format is defined as follows:
</p>
<p>
          <br /><hr class="insert" />
<a name="payload-gpsk-fail"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
--- bit offset ---&gt;
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Failure-Code                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;10: GPSK-Fail Payload&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

        
</p>
<p>The GPSK-Protected-Fail payload format is defined as follows:
</p>
<p>
          <br /><hr class="insert" />
<a name="payload-gpsk-protected-fail"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
--- bit offset ---&gt;
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Failure-Code                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                   KS-octet payload MAC                    ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;11: GPSK-Protected-Fail Payload&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

        
</p>
<p>The Failure-Code field is one of three values, but can be extended:
</p>
<p>
          </p>
<ul class="text">
<li>0x00000001: PSK Not Found
</li>
<li>0x00000002: Authentication Failure
</li>
<li>0x00000003: Authorization Failure
</li>
</ul><p> All other values of this field are available via IANA registration. 
</p>
<p>"PSK Not Found" indicates a key for a particular user could not be located, making
          authentication impossible. "Authentication Failure" indicates a MAC failure due to a PSK
          mismatch. "Authorization Failure" indicates that while the PSK being used is correct, the
          user is not authorized to connect.
</p>
<a name="protected-data"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.4"></a><h3>9.4.&nbsp;
Protected Data</h3>

<p>The protected data blocks are a generic mechanism for the peer and server to securely
          exchange data. If the specified ciphersuite has a NULL encryption primitive, then this
          channel only offers authenticity, and not confidentiality.
</p>
<p>These payloads are encoded as the concatenation of type-length-value (TLV) triples called
          PD_Payloads.
</p>
<p>Type values are encoded as a 6-octet string and represented by a 4-octet vendor and
          2-octet specifier field. The vendor field indicates the type as either standards-specified
          or vendor-specific. If these four octets are 0x00000000, then the value is
          standards-specified, and any other value represents a vendor-specific enterprise number.
</p>
<p>The specifier field indicates the actual type. For vendor field 0x00000000, the specifier
          field is maintained by IANA. For any other vendor field, the specifier field is maintained
          by the vendor.
</p>
<p>Length fields are specified as 2-octet integers in network byte order, and reflect only
          the length of the value, and do not include the length of the type and length fields.
</p>
<p>Graphically, this can be depicted as follows:
</p>
<p>
          <br /><hr class="insert" />
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
--- bit offset ---&gt;
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                   PData/Vendor                                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
         PData/Specifier        |         PData/Length          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                        PData/Value                        ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Protected Data Payload (PD_Payload) Formatting&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

        
</p>
<p>These PD_Payloads are concatenated together to form a PD_Payload_Block. The If the
          CSuite_Sel includes support for encryption, then the PD_Payload_Block includes fields
          specifying an initialization vector (IV), and the necessary padding. This can be depicted
          as follows:
</p>
<p>
          <br /><hr class="insert" />
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
--- bit offset ---&gt;
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   IV Length   |                                               |
+-+-+-+-+-+-+-+-+      Initialization Vector                    +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                        PD_Payload                         ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                 optional PD_Payload, etc                  ...
|                                                               |
+               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               |             Padding (0-255 octets)            |
+-+-+-+-+-+-+-+-+                               +-+-+-+-+-+-+-+-+
|                                               |  Pad Length   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Protected Data Block (PD_Payload_Block) Formatting if Encryption Supported&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

        
</p>
<p> The Initialization Vector is a randomly chosen value whose length is equal to the
          specified IV Length. The required length is defined by the ciphersuite. Recipients MUST
          accept any value. Senders SHOULD either pick this value pseudo-randomly and independently
          for each message or use the final ciphertext block of the previous message sent. Senders
          MUST NOT use the same value for each message, use a sequence of values with low hamming
          distance (e.g., a sequence number), or use ciphertext from a received message. IVs should
          be selected per the security requirements of the underlying cipher. If the data is not
          being encrypted, then the IV Length MUST be 0. If the ciphersuite does not require an IV,
          or has a self-contained way of communicating the IV, then the IV Length field MUST be 0.
          In these cases the ciphersuite definition defines how the IV is encapsulated in the
          PD_Payload.
</p>
<p>The concatenation of PD_Payloads along with the padding and padding length are all
          encrypted using the negotiated block cipher. If no block cipher is specified, then these
          fields are not encrypted.
</p>
<p>The Padding field MAY contain any value chosen by the sender. For block-based cipher
          modes, the padding MUST have a length that makes the combination of the concatenation of
          PD_Payloads, the Padding, and the Pad Length to be a multiple of the encryption block
          size. If the underlying ciphersuite does not require padding (e.g. a stream-based cipher
          mode) or no encryption is being used, then the padding length MUST still be present and be
          zero.
</p>
<p>The Pad Length field is the length of the Padding field. The sender SHOULD set the Pad
          Length to the minimum value that makes the combination of the PD_Payloads, the Padding,
          and the Pad Length a multiple of the block size (in the case of block-based cipher modes),
          but the recipient MUST accept any length that results in proper alignment. This field is
          encrypted with the negotiated cipher.
</p>
<p>If the negotiated ciphersuite does not support encryption, then the IV field MUST be of
          length zero and padding field MUST be of length zero. The IV length and padding length
          fields MUST still be present, and contain the value zero. The rationale for still
          requiring the length fields is to allow for modular implementations where the crypto
          processing is independent of the payload processing. This is depicted in the following
          figure.
</p>
<p>
          <br /><hr class="insert" />
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
--- bit offset ---&gt;
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      0x00     |                                               |
+-+-+-+-+-+-+-+-+          PD_Payload                         ...
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
...                 optional PD_Payload, etc    +-+-+-+-+-+-+-+-+
|                                               |      0x00     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Protected Data Block (PD_Payload_Block) Formatting Without Encryption&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

        
</p>
<p>For PData/Vendor field 0x00000000, the following PData/Specifier fields are defined: </p>
<ul class="text">
<li>0x0000 : Reserved
</li>
</ul><p> All other values of this field are available via IANA registration.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Packet Processing Rules</h3>

<p>This section defines how the EAP peer and EAP server MUST behave when received packet is
        deemed invalid.
</p>
<p>Any EAP-GPSK packet that cannot be parsed by the EAP peer or the EAP server MUST be
        silently discarded. An EAP peer or EAP server receiving any unexpected packet (e.g., an EAP
        peer receiving GPSK-3 before receiving GPSK-1 or before transmitting GPSK-2) MUST silently
        discard the packet.
</p>
<p>GPSK-1 contains no MAC protection, so provided it properly parses, it MUST be accepted by
        the peer. If the EAP peer has no ciphersuites in common with the server or decides the
        ID_Server is that of a AAA server to which it does not wish to authenticate, the EAP peer
        MUST respond with an EAP-NAK.
</p>
<p>For GPSK-2, if ID_Peer is for an unknown user, the EAP server MUST send either a "PSK Not
        Found" GPSK-Fail message, or an "Authentication Failure" GPSK-Fail, depending on its policy.
        If the MAC validation fails, the server MUST transmit a GPSK-Fail message specifying
        "Authentication Failure". If the RAND_Server or CSuite_List
        field in GPSK-2 does not match the values in GPSK-1, the server MUST silently discard the
        packet. If server policy determines the peer is not authorized and the MAC is correct, the
        server MUST transmit a GPSK-Protected-Fail message indicating "Authorization Failure" and
        discard the received packet.
</p>
<p>A peer receiving a GPSK-Fail / GPSK-Protected-Fail message in response to a GPSK-2 message
        MUST replay the received GPSK-Fail / GPSK-Protected-Fail message. Then, the EAP server
        returns an EAP-Failure after receiving the GPSK-Fail / GPSK-Protected-Fail message to
        correctly finish the EAP conversation. If MAC validation on a GPSK-Protected-Fail packet
        fails, then the received packet MUST be silently discarded.
</p>
<p>For GPSK-3, a peer MUST silently discard messages where the
	RAND_Peer field does match the value transmitted in GPSK-2. An
	EAP peer MUST silently discard any packet whose MAC fails.
</p>
<p>For GPSK-4, a server MUST silently discard any packet whose MAC fails validation.
</p>
<p>If a decryption failure of a protected payload is detected, the recipient MUST silently
        discard the GPSK packet.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Example Message Exchanges</h3>

<p>This section shows a couple of example message flows. 
</p>
<p> A successful EAP-GPSK message exchange is shown in <a class='info' href='#eap-gpsk-success'>Figure&nbsp;1<span> (</span><span class='info'>EAP-GPSK: Successful Exchange</span><span>)</span></a>.
</p>
<p>
        <br /><hr class="insert" />
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+--------+                                     +--------+
|        |                EAP-Request/Identity |        |
|  EAP   |&lt;------------------------------------|  EAP   |
|  peer  |                                     | server |
|        | EAP-Response/Identity               |        |
|        |------------------------------------&gt;|        |
|        |                                     |        |
|        |                  EAP-Request/GPSK-1 |        |
|        |&lt;------------------------------------|        |
|        |                                     |        |
|        | EAP-Response/EAP-NAK                |        |
|        |------------------------------------&gt;|        |
|        |                                     |        |
|        |          EAP-Failure                |        |
|        |&lt;------------------------------------|        |
+--------+                                     +--------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;EAP-GPSK: Unsuccessful Exchange (Unacceptable AAA server identity; ID_Server)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
        <br /><hr class="insert" />
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+--------+                                     +--------+
|        |                EAP-Request/Identity |        |
|  EAP   |&lt;------------------------------------|  EAP   |
|  peer  |                                     | server |
|        | EAP-Response/Identity               |        |
|        |------------------------------------&gt;|        |
|        |                                     |        |
|        |                  EAP-Request/GPSK-1 |        |
|        |&lt;------------------------------------|        |
|        |                                     |        |
|        | EAP-Response/GPSK-2                 |        |
|        |------------------------------------&gt;|        |
|        |                                     |        |
|        | EAP-Request/GPSK-Fail               |        |
|        | (PSK Not Found or Authentication    |        |
|        | Failure)                            |        |
|        |&lt;------------------------------------|        |
|        |                                     |        |
|        | EAP-Response/GPSK-Fail              |        |
|        | (PSK Not Found or Authentication    |        |
|        | Failure)                            |        |
|        |------------------------------------&gt;|        |
|        |                                     |        |
|        |          EAP-Failure                |        |
|        |&lt;------------------------------------|        |
+--------+                                     +--------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;EAP-GPSK: Unsuccessful Exchange (Unknown user)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
        <br /><hr class="insert" />
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+--------+                                     +--------+
|        |                EAP-Request/Identity |        |
|  EAP   |&lt;------------------------------------|  EAP   |
|  peer  |                                     | server |
|        | EAP-Response/Identity               |        |
|        |------------------------------------&gt;|        |
|        |                                     |        |
|        |                  EAP-Request/GPSK-1 |        |
|        |&lt;------------------------------------|        |
|        |                                     |        |
|        | EAP-Response/GPSK-2                 |        |
|        |------------------------------------&gt;|        |
|        |                                     |        |
|        | EAP-Request/GPSK-Fail               |        |
|        | (Authentication Failure)            |        |
|        |&lt;------------------------------------|        |
|        |                                     |        |
|        | EAP-Response/GPSK-Fail              |        |
|        | (Authentication Failure)            |        |
|        |------------------------------------&gt;|        |
|        |                                     |        |
|        |          EAP-Failure                |        |
|        |&lt;------------------------------------|        |
+--------+                                     +--------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;EAP-GPSK: Unsuccessful Exchange (Invalid MAC in GPSK-2)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
        <br /><hr class="insert" />
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+--------+                                     +--------+
|        |                EAP-Request/Identity |        |
|  EAP   |&lt;------------------------------------|  EAP   |
|  peer  |                                     | server |
|        | EAP-Response/Identity               |        |
|        |------------------------------------&gt;|        |
|        |                                     |        |
|        |                  EAP-Request/GPSK-1 |        |
|        |&lt;------------------------------------|        |
|        |                                     |        |
|        | EAP-Response/GPSK-2                 |        |
|        |------------------------------------&gt;|        |
|        |                                     |        |
|        | EAP-Request/                        |        |
|        | GPSK-Protected-Fail                 |        |
|        | (Authorization Failure)             |        |
|        |&lt;------------------------------------|        |
|        |                                     |        |
|        | EAP-Request/                        |        |
|        | GPSK-Protected-Fail                 |        |
|        | (Authorization Failure)             |        |
|        |------------------------------------&gt;|        |
|        |                                     |        |
|        |          EAP-Failure                |        |
|        |&lt;------------------------------------|        |
+--------+                                     +--------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;EAP-GPSK: Unsuccessful Exchange (Authorization failure)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<a name="seccons"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Security Considerations</h3>

<p>
        <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a> highlights several attacks that are possible against EAP since EAP
        itself does not provide any security.
</p>
<p>This section discusses the claimed security properties of EAP-GPSK as well as
        vulnerabilities and security recommendations in the threat model of <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a>.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
Security Claims</h3>

<p>
          </p>
<blockquote class="text"><dl>
<dt>Auth. mechanism:</dt>
<dd>Shared Keys
</dd>
<dt>Ciphersuite negotiation:</dt>
<dd>Yes (<a class='info' href='#pcn'>Section&nbsp;12.16<span> (</span><span class='info'>Protected Ciphersuite Negotiation</span><span>)</span></a>)
</dd>
<dt>Mutual authentication:</dt>
<dd>Yes (<a class='info' href='#mut'>Section&nbsp;12.2<span> (</span><span class='info'>Mutual Authentication</span><span>)</span></a>)
</dd>
<dt>Integrity protection:</dt>
<dd>Yes (<a class='info' href='#int'>Section&nbsp;12.4<span> (</span><span class='info'>Integrity Protection</span><span>)</span></a>)
</dd>
<dt>Replay protection:</dt>
<dd> Yes (<a class='info' href='#repl'>Section&nbsp;12.5<span> (</span><span class='info'>Replay Protection</span><span>)</span></a>)
</dd>
<dt>Confidentiality:</dt>
<dd> No (<a class='info' href='#conf'>Section&nbsp;12.17<span> (</span><span class='info'>Confidentiality</span><span>)</span></a>, <a class='info' href='#idpro'>Section&nbsp;12.15<span> (</span><span class='info'>Identity Protection</span><span>)</span></a>)
</dd>
<dt>Key derivation:</dt>
<dd> Yes (<a class='info' href='#keyder'>Section&nbsp;12.8<span> (</span><span class='info'>Key Derivation and Key Strength</span><span>)</span></a>)
</dd>
<dt>Key strength:</dt>
<dd> Varies (<a class='info' href='#keyder'>Section&nbsp;12.8<span> (</span><span class='info'>Key Derivation and Key Strength</span><span>)</span></a>)
</dd>
<dt>Dictionary attack prot.:</dt>
<dd> No (<a class='info' href='#dic'>Section&nbsp;12.7<span> (</span><span class='info'>Dictionary Attacks</span><span>)</span></a>)
</dd>
<dt>Fast reconnect:</dt>
<dd> No (<a class='info' href='#freco'>Section&nbsp;12.14<span> (</span><span class='info'>Fast Reconnect</span><span>)</span></a>)
</dd>
<dt>Crypt. binding:</dt>
<dd> N/A (<a class='info' href='#cryptobind'>Section&nbsp;12.18<span> (</span><span class='info'>Cryptographic Binding</span><span>)</span></a>)
</dd>
<dt>Session independence:</dt>
<dd> Yes (<a class='info' href='#ssi'>Section&nbsp;12.10<span> (</span><span class='info'>Session Independence</span><span>)</span></a>)
</dd>
<dt>Fragmentation:</dt>
<dd> No (<a class='info' href='#frag'>Section&nbsp;12.12<span> (</span><span class='info'>Fragmentation</span><span>)</span></a>)
</dd>
<dt>Channel binding:</dt>
<dd> Extensible (<a class='info' href='#cbind'>Section&nbsp;12.13<span> (</span><span class='info'>Channel Binding</span><span>)</span></a>)
</dd>
</dl></blockquote><p>
        
</p>
<a name="mut"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
Mutual Authentication</h3>

<p>EAP-GPSK provides mutual authentication.
</p>
<p>The server believes that the peer is authentic when it successfully verifies the MAC in
          the GPSK-2 message and the peer believes that the server is authentic when it successfully
          verifies the MAC it receives with the GPSK-3 message.
</p>
<p>The key used for mutual authentication is derived based on the long-term secret PSK,
          nonces contributed by both parties and other parameters. The long-term secret PSK has to
          provide sufficient entropy and therefore sufficient strength. The nonces (RAND_Peer and
          RAND_Server) need to be fresh and unique for every session. In this way EAP-GPSK is not
          different than other authentication protocols based on pre-shared keys.
</p>
<a name="protr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3"></a><h3>12.3.&nbsp;
Protected Result Indications</h3>

<p>EAP-GPSK supports protected results indication via the GPSK-Protected-Fail message. This
          allows a server to provide additional information to the peer as to why the session
          failed, and do so in an authenticated way (if possible). In particular, the server can
          indicate the lack of PSK (account not present), failed authentication (PSK incorrect), or
          authorization failure (account disabled or unauthorized). Only the third message could be
          integrity protected.
</p>
<p>It should be noted that these options make debugging network and account errors easier,
          but also leak information about accounts to attackers. An attacker can determine if a
          particular ID_Peer is a valid user on the network, or not. Thus implementers should use
          care in enabling this particular option on their servers. If they are in an environment
          where such attacks are of concern, then protected result indication capabilities should be
          disabled.
</p>
<a name="int"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.4"></a><h3>12.4.&nbsp;
Integrity Protection</h3>

<p>EAP-GPSK provides integrity protection based on the ciphersuites suggested in this
          document. Integrity protection is a minimum feature every ciphersuite must provide.
</p>
<a name="repl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.5"></a><h3>12.5.&nbsp;
Replay Protection</h3>

<p>EAP-GPSK provides replay protection of its mutual authentication part thanks to the use
          of random numbers RAND_Server and RAND_Peer. Since RAND_Server is 32 octets long, one
          expects to have to record 2**64 (i.e., approximately 1.84*10**19) EAP-GPSK successful
          authentication before an protocol run can be replayed. Hence, EAP-GPSK provides replay
          protection of its mutual authentication part as long as RAND_Server and RAND_Peer are
          chosen at random, randomness is critical for replay protection. <a class='info' href='#RFC4086'>RFC
            4086<span> (</span><span class='info'>Eastlake, D., Schiller, J., and S. Crocker, &ldquo;Randomness Requirements for Security,&rdquo; June&nbsp;2005.</span><span>)</span></a> [RFC4086] describes techniques for producing random quantities.
</p>
<a name="refl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.6"></a><h3>12.6.&nbsp;
Reflection attacks</h3>

<p>EAP-GPSK provides protection against reflection attacks in case of an extended
          authentication because the messages are constructed in a different fashion.
</p>
<p>Also note that EAP-GPSK does not provide MAC protection of the OP-Code field, but again
          since each message is constructed differently, it would not be possible to change the
          OP-Code of a valid message and still have it be parseable and accepted by the
        recipient.
</p>
<a name="dic"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.7"></a><h3>12.7.&nbsp;
Dictionary Attacks</h3>

<p>EAP-GPSK relies on a long-term shared secret (PSK) that SHOULD be based on at least 16
          octets of entropy to be fully secure. The EAP-GPSK protocol makes no special provisions to
          ensure keys based on passwords are used securely. Users who use passwords as the basis of
          their PSK are not protected against dictionary attacks. Derivation of the long-term shared
          secret from a password is strongly discouraged.
</p>
<p>The success of a dictionary attack against EAP-GPSK depends on the strength of the
          long-term shared secret (PSK) it uses. The PSK used by EAP-GPSK SHOULD be drawn from a
          pool of secrets that is at least 2^128 bits large and whose distribution is uniformly
          random. Note that this does not imply resistance to dictionary attack, only that the
          probability of success in such an attack is acceptably remote.
</p>
<a name="keyder"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.8"></a><h3>12.8.&nbsp;
Key Derivation and Key Strength</h3>

<p>EAP-GPSK supports key derivation as shown in <a class='info' href='#keyderivation'>Section&nbsp;4<span> (</span><span class='info'>Key Derivation</span><span>)</span></a>.
</p>
<p>Keys used within EAP-GPSK are all based on the security of the originating PSK. PSKs
          SHOULD have at least 16 octets of entropy. Independent of the protocol exchange (i.e.
          without knowing RAND_Peer and RAND_Server), the keys have been derived with sufficient
          input entropy to make them as secure as the underlying KDF output key length.
</p>
<a name="dos"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.9"></a><h3>12.9.&nbsp;
Denial of Service Resistance</h3>

<p>There are three forms of denial of service attacks relevant for this document, namely (1)
          attacks that lead to vast amount of state being allocated, (2) attacks that attempt to
          prevent communication between the peer and server, and (3) attacks against computational
          resources.
</p>
<p>In an EAP-GPSK conversation the server has to maintain state, namely the 32-octet
          RAND_Server, when transmitting the GPSK-1 message to the peer. An adversary could
          therefore flood a server with a large number of EAP-GPSK communication attempts. An EAP
          server may therefore ensure that established state times out after a relatively short
          period of time when no further messages are received. This enables a sort of garbage
          collection. 
</p>
<p>The client has to keep state information after receiving the GPSK-1 message. To prevent a
          replay attack, all the client needs to do is to ensure that the value of RAND_Peer is consistent
          between GPSK-2 and GPSK-3. Message GPSK-3 contains all the material required to re-compute
          the keying material. Thus, if a client chooses to implement this client-side DoS protection 
          mechanism it only needs to maintain minimal state (RAND_Peer) between
          GPSK-2 and GPSK-3. Otherwise, storing state information about CSuite_Sel and RAND_Server is necessary 
        in order to determine whether these values correspond to the onces previously sent in GPSK-2.
</p>
<p>Attacks that disrupt communication between the peer and server are mitigated by silently
          discarding messages with invalid MACs. Attacks against computational resources are
          mitigated by having very light-weight cryptographic operations required during each
          protocol round.
</p>
<p>The security considerations of EAP itself, see Section 5.2 and Section 7 of RFC 3748
            <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a>, are also applicable to this specification (e.g., for example
          concerning EAP-based notifications). 
</p>
<a name="ssi"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.10"></a><h3>12.10.&nbsp;
Session Independence</h3>

<p>Thanks to its key derivation mechanisms, EAP-GPSK provides session independence: passive
          attacks (such as capture of the EAP conversation) or active attacks (including compromise
          of the MSK or EMSK) do not enable compromise of subsequent or prior MSKs or EMSKs. The
          assumption that RAND_Peer and RAND_Server are random is central for the security of
          EAP-GPSK in general and session independence in particular.
</p>
<a name="expo"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.11"></a><h3>12.11.&nbsp;
Compromise of the PSK</h3>

<p>EAP-GPSK does not provide perfect forward secrecy. Compromise of the PSK leads to
          compromise of recorded past sessions.
</p>
<p>Compromise of the PSK enables the attacker to impersonate the peer and the server and it
          allows the adversary to compromise future sessions.
</p>
<p>EAP-GPSK provides no protection against a legitimate peer sharing its PSK with a third
          party. Such protection may be provided by appropriate repositories for the PSK, which
          choice is outside the scope of this document. The PSK used by EAP-GPSK must only be shared
          between two parties: the peer and the server. In particular, this PSK must not be shared
          by a group of peers (e.g. those with different ID_Peer values) communicating with the same
          server.
</p>
<p>The PSK used by EAP-GPSK must be cryptographically separated from keys used by other
          protocols, otherwise the security of EAP-GPSK may be compromised.
</p>
<a name="frag"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.12"></a><h3>12.12.&nbsp;
Fragmentation</h3>

<p>EAP-GPSK does not support fragmentation and reassembly since the message size is
          relatively small. However it should be noted that this impacts the length of protected
          data payloads that can be attached to messages. Also if the EAP frame is larger than the
          MTU of the underlying transport, and that transport does not support fragmentation, the
          frame will most likely not be transported. Consequently implementors and deployers should
          take care to ensure EAP-GPSK frames are short enough to work properly on the target
          underlying transport mechanism.
</p>
<a name="cbind"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.13"></a><h3>12.13.&nbsp;
Channel Binding</h3>

<p>This document enables the ability to exchange channel binding information. It does not,
          however, define the encoding of channel binding information in the document.
</p>
<a name="freco"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.14"></a><h3>12.14.&nbsp;
Fast Reconnect</h3>

<p>EAP-GPSK does not provide the fast reconnect capability since this method is already at
          (or close to) the lower limit of the number of roundtrips and the cryptographic
          operations.
</p>
<a name="idpro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.15"></a><h3>12.15.&nbsp;
Identity Protection</h3>

<p>Identity protection is not specified in this document. Extensions can be defined that
          enhance this protocol to provide this feature.
</p>
<a name="pcn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.16"></a><h3>12.16.&nbsp;
Protected Ciphersuite Negotiation</h3>

<p>EAP-GPSK provides protected ciphersuite negotiation via the indication of available
          ciphersuites by the server in the first message and a confirmation by the peer in the
          subsequent message. 
</p>
<p> Note, however, that the GPSK-2 message may optionally contain a payload,
          ENC_PK(PD_Payload_Block), protected with an algorithm based on a selected ciphersuite
          before the ciphersuite list has actually been authenticated. In the classical downgrading
          attack an adversary would chose a ciphersuite that it weak enough to that it could break
          it in real-time or to turn security off. The latter is not possible since any ciphersuite
          defined for EAP-GPSK must at least provide authentication and integrity protection.
          Confidentiality protection is optional. When, some time in the future, a ciphersuite
          contains algorithms that can be broken in real-time then a policy on peers and the server
          needs to indicate that such a ciphersuite must not be selected by any of parties.
</p>
<p>Furthermore, an adversary may modify the selection of the ciphersuite to for the client
          to select a ciphersuite that does not provide confidentiality protection. As a result this
          would cause the content of PD_Payload_Block to be transmitted in cleartext. When protocol
          designers extend EAP-GPSK to carry information in the PD_Payload_Block of the GPSK-2
          message then it must be indicated whether confidentiality protection is mandatory. In case
          such an extension requires a ciphersuite with confidentiality protection then the policy
          at the peer must not transmit information of that extension in the PD_Payload_Block of the
          GPSK-2 message. The peer may, if possible, delay the transmission of this information
          element to the GPSK-4 message where the ciphersuite negotiation has been confirmed
          already. In general, when a ciphersuite is selected that does not provide confidentiality
          protection then information that demands confidentiality protection must not be included
          in any of the PD_Payload_Block objects. 
</p>
<a name="conf"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.17"></a><h3>12.17.&nbsp;
Confidentiality</h3>

<p>Although EAP-GPSK provides confidentiality in its protected data payloads, it cannot
          claim to do so as per Section 7.2.1 of <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a> since it does not support
          identity protection.
</p>
<a name="cryptobind"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.18"></a><h3>12.18.&nbsp;
Cryptographic Binding</h3>

<p>Since EAP-GPSK does not tunnel another EAP method, it does not implement cryptographic
          binding.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
IANA Considerations</h3>

<p>This document requires IANA to allocate a new EAP Type for EAP-GPSK.
</p>
<p>This document requires IANA to create a new registry for ciphersuites, protected data
        types, failure codes and op-codes. IANA is furthermore instructed to add the specified
        ciphersuites, protected data types, failure codes and op-codes to these registries as
        defined below. Values can be added or modified per IETF REVIEW <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>
        defining either block-based or hash-based ciphersuites, protected data payloads, failure
        codes and op-codes. Each ciphersuite needs to provide processing rules and needs to specify
        how the following algorithms are instantiated: encryption, integrity, key derivation and key
        length. 
</p>
<p><a class='info' href='#ciphersuites'>Figure&nbsp;3<span> (</span><span class='info'>Ciphersuites</span><span>)</span></a> represents the initial ciphersuite CSuite/Specifier registry
        setup. The CSuite/Specifier field is 16 bits long. All other values are available via IANA
        registration. This registry should be named "EAP-GPSK Ciphersuites".
</p>
<p>The following is the initial protected data PData/Specifier registry setup, which should be
        named "EAP-GPSK Protected Data Payloads":
</p>
<p>
        </p>
<ul class="text">
<li>0x0000 : Reserved
</li>
</ul><p>
      
</p>
<p>The PData/Specifier field is 16 bits long and all other values are available via IANA
        registration. Each extension needs to indicate whether confidentiality protection for
        transmission between the EAP peer and the EAP server is mandatory.
</p>
<p>The following layout represents the initial Failure-Code registry setup, which should be
        named "EAP-GPSK Failure Codes":
</p>
<p>
        </p>
<ul class="text">
<li>0x00000001: PSK Not Found
</li>
<li>0x00000002: Authentication Failure
</li>
<li>0x00000003: Authorization Failure
</li>
</ul><p>
      
</p>
<p>The Failure-Code field is 32 bits long and all other values are available via IANA
        registration.
</p>
<p>The following layout represents the initial OP-Code registry setup, which should be named
        "EAP-GPSK OP Codes":
</p>
<p>
        </p>
<ul class="text">
<li>0x01 : GPSK-1
</li>
<li>0x02 : GPSK-2
</li>
<li>0x03 : GPSK-3
</li>
<li>0x04 : GPSK-4
</li>
<li>0x05 : GPSK-Fail
</li>
<li>0x06 : GPSK-Protected-Fail
</li>
</ul><p>
      
</p>
<p>The OP-Code field is 8 bits long and all other values are available via IANA registration.
      
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
Contributors</h3>

<p>This work is a joint effort of the EAP Method Update (EMU) design team of the EMU Working
        Group that was created to develop a mechanism based on strong shared secrets that meets RFC
        3748 <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a> and RFC 4017 <a class='info' href='#RFC4017'>[RFC4017]<span> (</span><span class='info'>Stanley, D., Walker, J., and B. Aboba, &ldquo;Extensible Authentication Protocol (EAP) Method Requirements for Wireless LANs,&rdquo; March&nbsp;2005.</span><span>)</span></a> requirements. The design
        team members (in alphabetical order) were:
</p>
<p>
        </p>
<ul class="text">
<li>Jari Arkko
</li>
<li>Mohamad Badra
</li>
<li>Uri Blumenthal
</li>
<li>Charles Clancy
</li>
<li>Lakshminath Dondeti
</li>
<li>David McGrew
</li>
<li>Joe Salowey
</li>
<li>Sharma Suman
</li>
<li>Hannes Tschofenig
</li>
<li>Jesse Walker
</li>
</ul><p>
      
</p>
<p>Finally, we would like to thank Thomas Otto for his draft reviews, feedback and text
        contributions.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15"></a><h3>15.&nbsp;
Acknowledgments</h3>

<p>We would like to thank
</p>
<p>
        </p>
<ul class="text">
<li>Jouni Malinen and Bernard Aboba for their early draft comments in June 2006. Jouni
            Malinen developed the first prototype implementation. It can be found at:
            http://hostap.epitest.fi/releases/snapshots/ 
</li>
<li>Lakshminath Dondeti, David McGrew, Bernard Aboba, Michaela Vanderveen and Ray Bell for
            their input to the ciphersuite discussions between July and August 2006.
</li>
<li>Lakshminath Dondeti for his detailed draft review (sent to the EMU ML on the 12th July
            2006).
</li>
<li>Based on a review requested from NIST Quynh Dang suggested changes to the GKDF function
            (December 2006).
</li>
<li>Jouni Malinen and Victor Fajardo for their review in January 2007.
</li>
<li>Jouni Malinen for his suggestions regarding the examples and the key derivation
            function in February 2007.
</li>
<li>Bernard Aboba and Jouni Malinen for their review in February 2007.
</li>
<li>Vidya Narayanan for her review in March 2007.
</li>
<li>Pasi Eronen for his IESG review in March and July 2008.
</li>
<li>Dan Harkins for his review in June 2008.
</li>
<li>
</li>
<li>Joe Salowey, the EMU working group chair, provided a document review in April 2007.
            Jouni Malinen also reviewed the document during the same month. 
</li>
<li>We would like to thank Paul Rowe, Arnab Roy, Prof. Andre Scedrov and Prof. John C.
            Mitchell for their analysis of EAP-GPSK and for pointing us to a client-side DoS attack,
            a downgrading attack and their input to the key derivation function. Based on their
            input the key derivation function has been modified and the text in the security
            consideration section has been updated.
</li>
<li>Finally, we would like to thank our working group chair, Joe Salowey, for his support
            and for the time he spend on discussing open issues with us.
</li>
</ul><p>
      
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16"></a><h3>16.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>16.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-eap-keying">[I-D.ietf-eap-keying]</a></td>
<td class="author-text">Aboba, B., Simon, D., and P. Eronen, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-eap-keying-22.txt">Extensible Authentication Protocol (EAP) Key Management Framework</a>,&rdquo; draft-ietf-eap-keying-22 (work in progress), November&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-eap-keying-22.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5226">[RFC5226]</a></td>
<td class="author-text">Narten, T. and H. Alvestrand, &ldquo;<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>,&rdquo; BCP&nbsp;26, RFC&nbsp;5226, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5226.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3748">[RFC3748]</a></td>
<td class="author-text">Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;<a href="http://tools.ietf.org/html/rfc3748">Extensible Authentication Protocol (EAP)</a>,&rdquo; RFC&nbsp;3748, June&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3748.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4282">[RFC4282]</a></td>
<td class="author-text">Aboba, B., Beadles, M., Arkko, J., and P. Eronen, &ldquo;<a href="http://tools.ietf.org/html/rfc4282">The Network Access Identifier</a>,&rdquo; RFC&nbsp;4282, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4282.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4634">[RFC4634]</a></td>
<td class="author-text">Eastlake, D. and T. Hansen, &ldquo;<a href="http://tools.ietf.org/html/rfc4634">US Secure Hash Algorithms (SHA and HMAC-SHA)</a>,&rdquo; RFC&nbsp;4634, July&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4634.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="AES">[AES]</a></td>
<td class="author-text">National Institute of Standards and Technology, &ldquo;Specification for the Advanced Encryption Standard (AES),&rdquo; Federal Information Processing Standards (FIPS)&nbsp;197, November&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="CMAC">[CMAC]</a></td>
<td class="author-text">National Institute of Standards and Technology, &ldquo;Recommendation for Block Cipher Modes of Operation: The CMAC Mode for
            Authentication,&rdquo; Special Publication (SP)&nbsp;800-38B, May&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="CBC">[CBC]</a></td>
<td class="author-text">National Institute of Standards and Technology, &ldquo;Recommendation for Block Cipher Modes of Encryption. Methods and Techniques.,&rdquo; Special Publication (SP)&nbsp;800-38A, December&nbsp;2001.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>16.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC4017">[RFC4017]</a></td>
<td class="author-text">Stanley, D., Walker, J., and B. Aboba, &ldquo;<a href="http://tools.ietf.org/html/rfc4017">Extensible Authentication Protocol (EAP) Method Requirements for Wireless LANs</a>,&rdquo; RFC&nbsp;4017, March&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4017.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4086">[RFC4086]</a></td>
<td class="author-text">Eastlake, D., Schiller, J., and S. Crocker, &ldquo;<a href="http://tools.ietf.org/html/rfc4086">Randomness Requirements for Security</a>,&rdquo; BCP&nbsp;106, RFC&nbsp;4086, June&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4086.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="ENTNUM">[ENTNUM]</a></td>
<td class="author-text">IANA, &ldquo;<a href="http://www.iana.org/assignments/enterprise-numbers">SMI Network Management Private Enterprise Codes</a>,&rdquo; IANA Assignments&nbsp;enterprise-numbers.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">T. Charles Clancy</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">DoD Laboratory for Telecommunications Sciences</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">8080 Greenmead Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">College Park, MD  20740</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:clancy@ltsnet.net">clancy@ltsnet.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hannes Tschofenig</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia Siemens Networks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Linnoitustie 6</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Espoo  02600</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+358 (50) 4871445</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Hannes.Tschofenig@gmx.net">Hannes.Tschofenig@gmx.net</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.tschofenig.priv.at">http://www.tschofenig.priv.at</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
