<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Optimizing Notifications for 
         Presence Network Agents</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Optimizing Notifications for 
         Presence Network Agents">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">simple</td><td class="header">B. Rosen</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">NeuStar</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">S. Loreto</td></tr>
<tr><td class="header">Expires: August 21, 2008</td><td class="header">Ericsson</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">K. Kiss</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Nokia</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">February 18, 2008</td></tr>
</table></td></tr></table>
<h1><br />Optimizing Notifications for 
         Presence Network Agents<br />draft-rosen-simple-watcher-count-00</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on August 21, 2008.</p>

<h3>Abstract</h3>

<p>In large presence systems deployed in multiservice networks, presence information is often known by the 
network in addition to, or instead of the presentity's devices (endpoints).  Examples of such information
include location and availability for various kinds of session establishment.  Even if devices know the
information, the network often has more bandwidth and better scale to keep the presence server up to date.
A Presence Network Agent (PNA) can publish presence information to a Presence Server(PS).  When done 
large scale, the basic publish operation can be inefficient.  When the network has millions of subscribers, 
only some of which have watchers, blind Publish operations are unecessary.  WINFO can be used to determine 
watchers, but the efficiency of maintaining WINFO per subscriber, and the size of the messages involved, 
make that solution unattractive.  The PNA would prefer to have the Presence Server simply tell it when 
there was at least one watcher.

</p>
<p>
This document describes an XML document stored on the PS by which the PNA maintains a list of subscribers 
it can provide presence for as a SIP event package that tells the PNA when the number of watchers for a 
presentity on the list (or a specific presence element for a presentity) goes from 0 to at least 1 
or from 1 to 0.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Terminology<br />
<a href="#anchor2">2.</a>&nbsp;
Background<br />
<a href="#anchor3">3.</a>&nbsp;
PNA Presentity List<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
Application Unique ID (AUID)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
XML Schema<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.3.</a>&nbsp;
Default Document Namespace<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.4.</a>&nbsp;
MIME Type<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.5.</a>&nbsp;
Validation Constraints<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.6.</a>&nbsp;
Data Semantics<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.6.1.</a>&nbsp;
Naming Conventions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">3.6.2.</a>&nbsp;
Resource Interdependencies<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">3.6.3.</a>&nbsp;
Authorization Policies<br />
<a href="#anchor13">4.</a>&nbsp;
Watcher-Count Event Package<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">4.1.</a>&nbsp;
Event Package Name<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">4.2.</a>&nbsp;
Event Package Parameters<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">4.3.</a>&nbsp;
SUBSCRIBE Bodies<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">4.4.</a>&nbsp;
Subscription Duration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">4.5.</a>&nbsp;
NOTIFY Bodies<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">4.6.</a>&nbsp;
Notifier Processing of SUBSCRIBE Requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#notify">4.7.</a>&nbsp;
Notifier Generation of NOTIFY Requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#subscriber">4.8.</a>&nbsp;
Subscriber Processing of NOTIFY Requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">4.9.</a>&nbsp;
Handling of Forked Requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">4.10.</a>&nbsp;
Rate of Notifications<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">4.11.</a>&nbsp;
State Agents<br />
<a href="#anchor23">5.</a>&nbsp;
Watcher-count XML Document<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">5.1.</a>&nbsp;
Structure of the watcher-count document<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">5.2.</a>&nbsp;
Computing Watcher Counts from the Document<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">5.3.</a>&nbsp;
Example<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">5.4.</a>&nbsp;
XML Schema<br />
<a href="#IANA">6.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">6.1.</a>&nbsp;
application/watcher-count+xml MIME Registration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">6.2.</a>&nbsp;
URN Sub-Namespace Registration for
     urn:ietf:params:xml:ns:watcher-count<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor30">6.3.</a>&nbsp;
Package Registration<br />
<a href="#security">7.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">7.1.</a>&nbsp;
Denial of Service Attacks<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">7.2.</a>&nbsp;
Divulging Sensitive Information<br />
<a href="#anchor33">8.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">9.</a>&nbsp;
Normative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", 
"MAY", and "OPTIONAL" in this document are to be interpreted as described in 
<a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Background</h3>

<p>Presence systems <a class='info' href='#RFC3856'>[RFC3856]<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Presence Event Package for the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2004.</span><span>)</span></a> are being deployed in networks where the network itself has presence information.  This
information may also be known to the endpoint, but the network is often in a better position to publish 
<a class='info' href='#RFC3903'>[RFC3903]<span> (</span><span class='info'>Niemi, A., &ldquo;Session Initiation Protocol (SIP) Extension for Event State Publication,&rdquo; October&nbsp;2004.</span><span>)</span></a> the
information to the presence server.  Mobile networks are an example of a network where a presence system
can have a very large number of presentities and providers, and where bandwidth from the device to the
presence server is restricted such that volitile presence data would be much more efficient if the network
published some data elements to the presence server rather than the user agent itself.  A "Presence Network 
Agent" (PNA) is a server operated by an entity in the network that has some presence information and publishes
this information to the presence server on behalf of the presentity.  Optimization techniques are available
which make the actual Publish operation reasonably efficient.  However, in large networks, there could be
millions of presentities, and if interconnected with other networks, even more watchers, but at any point
in time, there may not be any watchers for a particular presentity.  If there are no watchers, and presence
information that changes relatively often is published to the presence server anyway, there can be significant
wasted effort and bandwidth in both the presence server and the presence network agent.

</p>
<p>
If the PNA knew which presentities that it had presence information for had active watchers, then it could 
optimize its publishing operations.  The presence server knows that, but the only way for the PNA to get that
information is the WINFO package <a class='info' href='#RFC3857'>[RFC3857]<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Watcher Information Event Template-Package for the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2004.</span><span>)</span></a>.  WINFO provides the requisite data, but inefficiently.  All the PNA wants
to know is when the number of watchers goes from zero (no watchers) to at least 1, or from at least one to zero.
There is no efficient way to get that information.

</p>
<p>
PNAs provide information for a set of presentities, and the set of presentities the PNA serves may not match the
set of presentities a particular PS serves.  The PS has to know which presentities the PNA serves in order
to send it the right watcher state information.  This is simply a list of presentities that changes over time.
The list can be very long, so sending it in its entirety when something changes on the list is not desirable.

</p>
<p>
Editor Note: There is an opportunity for further optimization if the PS knows which elements the PNA can
publish.  Because of filtering and presence rules, just because there is at least one watcher, it doesn't
mean that the elements the PNA publishes are visible to any watchers.  The PS could optimize notification of watcher 
counts to only show when at least on watcher was recieving at least one element the PNA publishes.  This
could further be extended to have the actual watcher count for each element sent by the PS to the PNA.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
PNA Presentity List</h3>

<p>This document defines a Presentity List document intended to be maintained on the PS by the PNS using
XCAP <a class='info' href='#RFC4825'>[RFC4825]<span> (</span><span class='info'>Rosenberg, J., &ldquo;The Extensible Markup Language (XML) Configuration Access Protocol (XCAP),&rdquo; May&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Application Unique ID (AUID)</h3>

<p>This specification defines the "pna-presentity-list" AUID within the IETF tree,
   via the IANA registration in <a class='info' href='#IANA'>Section&nbsp;6<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
XML Schema</h3>

<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;xs:schema targetNamespace="urn:ietf:params:xml:ns:pna-presentity-list"
  xmlns="urn:ietf:params:xml:ns:watcher-count-presentity-list"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  elementFormDefault="qualified" attributeFormDefault="unqualified"&gt;
  &lt;xs:element name="watcher-count-presentity-list"&gt;
   &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;Root element for pna-presentity-list
         &lt;/xs:documentation&gt;
   &lt;/xs:annotation&gt;
   &lt;xs:simpleType name="PNA"&gt;
   &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;PNA&lt;/xs:documentation&gt;
   &lt;/xs:annotation&gt;
   &lt;xs:restriction base="xs:anyURI"/&gt;
  &lt;/xs:simpleType&gt;
  &lt;xs:complexType&gt;
    &lt;xs:sequence&gt;
     &lt;xs:element name="PresentityList"&gt;
      &lt;xs:annotation&gt;
       &lt;xs:documentation&gt;List of Presentities&lt;/xs:documentation&gt;
      &lt;/xs:annotation&gt;
   &lt;xs:simpleType name="Presentity"&gt;
   &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;One Presentity on the list&lt;/xs:documentation&gt;
   &lt;/xs:annotation&gt;
   &lt;xs:restriction base="xs:anyURI"/&gt;
  &lt;/xs:simpleType&gt;
  &lt;/xs:schema&gt;
</pre></div><p>

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Default Document Namespace</h3>

<p>The default document namespace used in evaluating a URI is
   urn:ietf:params:xml:ns:pna-presentity-list.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
MIME Type</h3>

<p>Documents conformant to this schema are known by the MIME type
   "application/pna-presentity-list+xml", registered in <a class='info' href='#IANA'>Section&nbsp;6<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Validation Constraints</h3>

<p>The Presence Network Agent must be authorized to provide presence data for the presentities on
   the list.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6"></a><h3>3.6.&nbsp;
Data Semantics</h3>

<p>The PNA element defines the URI of the PNA maintaining the list.  This URI must match the URI from which
   the PNA subscribes to the watcher-count event package on the PS.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6.1"></a><h3>3.6.1.&nbsp;
Naming Conventions</h3>

<p>The PS must maintain a document with the file name containing the PNA identity.  Provisioning may
   be used to connect the file name to the PNA URI.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6.2"></a><h3>3.6.2.&nbsp;
Resource Interdependencies</h3>

<p>There are no resource interdependencies in this application usage
   beyond those defined by the schema.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6.3"></a><h3>3.6.3.&nbsp;
Authorization Policies</h3>

<p>This application usage does not change the default authorization
   policy defined by XCAP.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Watcher-Count Event Package</h3>

<p>This section fills in the details needed to specify an event package
   as defined in Section 4.4 of <a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Event Package Name</h3>

<p><a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> requires package definitions to specify the name of
   their package or template-package.
</p>
<p>The name of this template-package is "watcher-count".  It cannot be applied to
   any other package.  Recursive template-packaging is
   not allowed.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Event Package Parameters</h3>

<p><a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> requires package and template-package definitions to
   specify any package specific parameters of the Event header field.
</p>
<p>A single parameter "PNA" is defined.  The parameter indicates pna-presentity-list URI.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
SUBSCRIBE Bodies</h3>

<p><a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> requires package or template-package definitions to
   define the usage, if any, of bodies in SUBSCRIBE requests.
</p>
<p>No bodies are defined for the watcher-count package.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Subscription Duration</h3>

<p><a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> requires package definitions to define a default value
   for subscription durations, and to discuss reasonable choices for
   durations when they are explicitly specified.

</p>
<p>
   The PNA typically supports a large number of presentities, which typically have
   watchers come and go.  The PNA wants notifications for any of the presentities on its
   list.  Therefore, the duration of the subscription is typically
   long.  The default value for the subscription duration is one day.
   However, clients SHOULD use an
   Expires header field to specify their preferred duration.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
NOTIFY Bodies</h3>

<p><a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> requires package definitions to describe the allowed set
   of body types in NOTIFY requests, and to specify the default value to
   be used when there is no Accept header field in the SUBSCRIBE
   request.

</p>
<p>
   The body of the watcher-count notification contains a watcher-count document.
   This document contains a list of presentities in the
   pna-presentity list whose watcher count went from 0 to 1 or 1 to 0 and the current
   watcher count (which will always be zero or one).  All watcher-count subscribers 
   and notifiers MUST support the application/watcher-count+xml format described 
   in herein, and MUST list its MIME type, application/watcher-count+xml, in any Accept
   header field present in the SUBSCRIBE request.

</p>
<p>
   Other watcher count formats might be defined in the future.  In
   that case, the watcher-count subscriptions MAY indicate support of
   other formats.  However, they MUST always support and list
   application/watcher-count+xml as an allowed format.

</p>
<p>
   Of course, the watcher-count notifications generated by the server MUST
   be in one of the formats specified in the Accept header field in the
   SUBSCRIBE request.  If no Accept header field was present, the
   notifications MUST use the application/watcher-count+xml format
   described herein.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
Notifier Processing of SUBSCRIBE Requests</h3>

<p><a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> specifies that packages should define any package-
   specific processing of SUBSCRIBE requests at a notifier, specifically
   with regards to authentication and authorization.

</p>
<p>
   Although the number of watchers is less sensitive than identification
   of a watcher, watcher information is personal information.
   Therefore, all watcher-count subscriptions MUST be
   authenticated and then authorized before approval.  Authentication
   MAY be performed using any of the techniques available through SIP,
   including digest, S/MIME, TLS or other transport specific mechanisms
   <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>.  Authorization policy is at the discretion of the administrator.
</p>
<p>Editor Note: There is a timing problem.  When a PS gets a SUBSCRIBE, it should
   reply immediately with the presence state.  However, if this causes watcher-count
   to go from 0 to 1, the PS doesn't have good state.  It has to NOTIFY the PNA
   and wait for a response.  That needs to be described here.  There may be
   further complications with a one time or short subscription.
</p>
<a name="notify"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7"></a><h3>4.7.&nbsp;
Notifier Generation of NOTIFY Requests</h3>

<p>The SIP Event framework requests that packages specify the conditions
   under which notifications are sent for that package, and how such
   notifications are constructed.

</p>
<p>
   Each watcher-count subscription is associated with a set of "inner"
   subscriptions being watched.  This set is defined by the URI in the
   pna-presentity-list.  A watcher-count notifier MUST
   generate a notification any time the count of watchers in any of the watched
   subscriptions goes from zero to at least one, or from one to zero.  To optimize the
   notification, the PS may delay the issuance of the NOTIFY for a 
   provisioned period of time.  5 seconds is the suggested default time.  The
   delay gives the PS an opportunity to gather additional watcher count
   changes and send one NOTIFY with all of them recieved in the delay
   period.  The PS MUST make certain that no watcher count change from zero to
   at least one or one to zero is delayed by more than this period.

</p>
<p>It is RECOMMENDED that a given notification only mention a particular presentity once.
   The PNA MUST NOT depend on this behavior.  When the same presentity URI is encountered
   in more than one wc element's "r" value, the "c" value in the last wc element
   determines the watcher count of the presentity following processing in the PNA.
   That means that the order of wc elements may matter.  The recommended behavior would filter
   multiple watcher changes from growing the size of the NOTIFY body.

</p>
<p>
   Upon a successful SUBSCRIBE where no subscription for a particular
   pna-presentity-list was extant at the time of the subscription, the initial
   NOTIFY from the PS to the PNA MUST have all of the presentities for 
   which there is at least one watcher.  That is, the PNA and PS behave
   as if just before the subscription, all presentities on the list had no
   watchers.  Presentities that actually do have at least one watcher will
   be listed in the initial NOTIFY.  If at any time the PNA is concerned that
   it has lost track of watcher count, it can reSUBSCRIBE, triggering a complete 
   notification of watcher count.  
   Note that the size of this initial NOTIFY can be quite large.
</p>
<a name="subscriber"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.8"></a><h3>4.8.&nbsp;
Subscriber Processing of NOTIFY Requests</h3>

<p><a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> expects packages to specify how a subscriber processes
   NOTIFY requests in any package specific ways, and in particular, how
   it uses the NOTIFY requests to construct a coherent view of the state
   of the subscribed resource.  The watcher-count NOTIFY will
   only contain information about those presentities whose watcher count
   changed from zero to at least one, or from one to zero.  To construct 
   a coherent view of the total state of all presentities on the 
   pna-presentity-list, a watcher-count subscriber will need to combine NOTIFYs
   received over time.  See <a class='info' href='#notify'>Section&nbsp;4.7<span> (</span><span class='info'>Notifier Generation of NOTIFY Requests</span><span>)</span></a> for a discussion of how the PNA can trigger
   a complete state update from the PS.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.9"></a><h3>4.9.&nbsp;
Handling of Forked Requests</h3>

<p>The behavior of forked requests for watcher-count is not defined and 
   implementations MUST NOT fork SUBSCRIBE or NOTIFY requests.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.10"></a><h3>4.10.&nbsp;
Rate of Notifications</h3>

<p><a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> mandates that packages define a maximum rate of
   notifications for their package.

</p>
<p>
   For reasons of congestion control, it is important that the rate of
   notifications not become excessive.  As a result, it is RECOMMENDED
   that the server not generate watcher-count notifications for a single
   presentity at a rate faster than once every 5 seconds.  See <a class='info' href='#subscriber'>Section&nbsp;4.8<span> (</span><span class='info'>Subscriber Processing of NOTIFY Requests</span><span>)</span></a>
   for a discussion of pacing NOTIFY operations for changes to multiple
   presentity's watcher count.  It is RECOMMENDED that such a pacing mechanism
   be used.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.11"></a><h3>4.11.&nbsp;
State Agents</h3>

<p><a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> asks packages to consider the role of state agents in
   their design.

</p>
<p>
   State agents are not required for watcher-count.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Watcher-count XML Document</h3>

<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Structure of the watcher-count document</h3>

<p>Watcher-count is an XML [ref] document that MUST be well-formed
   and SHOULD be valid.  Watcher-count documents MUST be based on
   XML 1.0 and MUST be encoded using UTF-8.  This specification makes
   use of XML namespaces for identifying watcher-count documents and
   document fragments.  The namespace URI for elements defined by this
   specification is a URN <a class='info' href='#RFC2141'>[RFC2141]<span> (</span><span class='info'>Moats, R., &ldquo;URN Syntax,&rdquo; May&nbsp;1997.</span><span>)</span></a>, using the namespace identifier 'ietf'
   defined by <a class='info' href='#RFC2648'>[RFC2648]<span> (</span><span class='info'>Moats, R., &ldquo;A URN Namespace for IETF Documents,&rdquo; August&nbsp;1999.</span><span>)</span></a> and extended by <a class='info' href='#RFC3688'>[RFC3688]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.  This URN is:
      urn:ietf:params:xml:ns:watcher-count

</p>
<p>
   A watcher-count document begins with the root element tag
   "watcher-count-list".  It consists of any number of "wc" (for "watcher-count") sub-
   elements, each of which is a presentity URI and a count of watchers for
   that presentity.  The count is either zero or one, where zero means no
   watchers are presently receiving any form of presence updates for the
   presentity and one means there is at least one active watcher.  
   Other elements from different namespaces MAY be present
   for the purposes of extensibility; elements or attributes from
   unknown namespaces MUST be ignored.  There are two attributes
   associated with the "watcher-count-list" element, both of which MUST be
   present:
</p>
<blockquote class="text"><dl>
<dt>PNA:</dt>
<dd>This element contains the URI of a pna-presence-list maintained on
   the PS.  The presentities in the watcher-count document MUST be on that
   list
</dd>
<dt>version:</dt>
<dd> This attribute allows the recipient of watcher-count documents
      to properly order them.  Versions start at 0, and increment by one
      for each new document sent to a watcher-count subscriber.  Versions
      are scoped within a watcher-count subscription.  Versions MUST be
      representable using a 32 bit integer.  However, versions do not
      wrap.

</dd>
</dl></blockquote>

<p>Each "wc" element contains a list of presentities whose
   count of watchers has changed from zero to at least one or from one to
   zero.  Other
   elements from different namespaces MAY be present for the purposes of
   extensibility; elements or attributes from unknown namespaces MUST be
   ignored.  There are two attributes associated with the "wc"
   element, both of which MUST be present:
</p>
<blockquote class="text"><dl>
<dt>r:</dt>
<dd>This attribute contains a URI for the resource being
      watched. It is mandatory.
</dd>
<dt>c:</dt>
<dd>This attribute contains an integer value of 0 or 1.  Zero means 
   that there are presently no watchers for this resource.  One means there
   is at least one watcher.
</dd>
</dl></blockquote>

<p>The names "wc", "r" and "c" are deliberately short, as the document is expected to be long
   and contain a great many such elements.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Computing Watcher Counts from the Document</h3>

<p>Typically, the watcher-count NOTIFY will only contain information about
   those presentities whose state has changed.  To construct a coherent view
   of the total state of all presentities on the pna-presentity-list, 
   a watcher-count subscriber will
   need to combine NOTIFYs received over time.  The watcher-count
   subscriber conceptually maintains a table for each presentity on the pna-presentity-list. 
   Each pna-presentity-list is uniquely identified by the
   URI in the "PNA" attribute of the "watcher-count-list" element.  Each
   table contains a row for each presentity in that list.  Each row
   is indexed by the URI for that presentity.  It is conveyed in the
   "r" attribute of the "wc" element.  The contents of each row
   contain the count of watchers of that presentity as conveyed in the "wc"
   element.  Other implementations are possible.  For example, the PNA
   could maintain a list of presentities whose watcher-count is >1 and add/delete
   presentities to its list based on notifications it recieves from the PS.

</p>
<p>
The tables are also associated with a version number.  The
   version number MUST be initialized with the value of the "version"
   attribute from the "watcherinfo" element in the first document
   received.  Each time a new document is received, the value of the
   local version number, and the "version" attribute in the new
   document, are compared.  If the value in the new document is one
   higher than the local version number, the local version number is
   increased by one, and the document is processed.  If the value in the
   document is more than one higher than the local version number, the
   local version number is set to the value in the new document, the
   document is processed, and the watcherinfo subscriber SHOULD generate
   a refresh request to trigger a full state notification.  If the value
   in the document is less than the local version, the document is
   discarded without processing.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Example</h3>

<p>The following is an example of watcher-count information.
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version="1.0"?&gt;
&lt;watcher-count-list xmlns="urn:ietf:params:xml:ns:watcher-count"
             pna="http://www.example.com/west-pna-presence-list.xml
                    version="23"&gt;
    &lt;wc r="sip:+12125551212@example.net" c="1"&gt;
    &lt;wc r="sip:+12125553333@example.net" c="0"&gt;
&lt;/watcher-count-list&gt;
</pre></div><p>

</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
XML Schema</h3>

<p>The following is the schema definition of the watcher-count document
   format:
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
       targetNamespace="urn:ietf:params:xml:ns:watcher-count"
       xmlns:tns="urn:ietf:params:xml:ns:watcher-count" &gt;
&lt;!-- This import brings in the XML language attribute xml:lang--&gt;
  &lt;xs:import namespace="http://www.w3.org/XML/1998/namespace"
             schemaLocation="http://www.w3.org/2001/03/xml.xsd" /&gt;
  &lt;xs:element name="watcher-count"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref="tns:watcher-count-list" minOccurs="0"
                    maxOccurs="unbounded"/&gt;
        &lt;xs:any namespace="##other" processContents="lax" minOccurs="0"
                maxOccurs="unbounded"/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name="resource" type="xs:anyURI" use="required"/&gt;
      &lt;xs:attribute name="version" type="xs:nonNegativeInteger"
                    use="required"/&gt;
   &lt;xs:element name="wc"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref="tns:wc" minOccurs="0" maxOccurs=
         "unbounded"/&gt;
          &lt;xs:any namespace="##other" processContents="lax"
                  minOccurs="0" maxOccurs="unbounded"/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name="r" type="xs:anyURI" use="required"/&gt;
      &lt;xs:attribute name="c" type="xs:string" use="required"/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
&lt;/xs:schema&gt;
</pre></div><p>

</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>This document registers a new MIME type, application/watcher-count+xml,
   registers a new XML namespace and registers a new event package.
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
application/watcher-count+xml MIME Registration</h3>

<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>MIME media type name: application

</dd>
<dt></dt>
<dd>
   MIME subtype name: watcher-count+xml

</dd>
<dt></dt>
<dd>
   Mandatory parameters: none

</dd>
<dt></dt>
<dd>
   Optional parameters: Same as charset parameter application/xml
        as specified in <a class='info' href='#RFC3023'>[RFC3023]<span> (</span><span class='info'>Murata, M., St. Laurent, S., and D. Kohn, &ldquo;XML Media Types,&rdquo; January&nbsp;2001.</span><span>)</span></a>.

</dd>
<dt></dt>
<dd>
   Encoding considerations: Same as encoding considerations of
        application/xml as specified in <a class='info' href='#RFC3023'>[RFC3023]<span> (</span><span class='info'>Murata, M., St. Laurent, S., and D. Kohn, &ldquo;XML Media Types,&rdquo; January&nbsp;2001.</span><span>)</span></a>.

</dd>
<dt></dt>
<dd>
   Security considerations: See Section 10 of <a class='info' href='#RFC3023'>[RFC3023]<span> (</span><span class='info'>Murata, M., St. Laurent, S., and D. Kohn, &ldquo;XML Media Types,&rdquo; January&nbsp;2001.</span><span>)</span></a> and
        <a class='info' href='#security'>Section&nbsp;7<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> of this specification.

</dd>
<dt></dt>
<dd>
   Interoperability considerations: none.

</dd>
<dt></dt>
<dd>
   Published specification: This document.

</dd>
<dt></dt>
<dd>
   Applications which use this media type: This document type is used to support optimization of
   publishing operations from a Presence Network Agent to a Presence Server.

</dd>
<dt></dt>
<dd>
   Additional Information:

<blockquote class="text"><dl>
<dt></dt>
<dd>     Magic Number: None

</dd>
<dt></dt>
<dd>
        File Extension: .wif or .xml

</dd>
<dt></dt>
<dd>
        Macintosh file type code: "TEXT"

</dd>
</dl></blockquote>
</dd>
<dt></dt>
<dd>Personal and email address for further information: Brian Rosen &lt;br@brianrosen.net&gt;

</dd>
<dt></dt>
<dd>
   Intended usage: COMMON

</dd>
<dt></dt>
<dd>
   Author/Change controller: The IETF.
</dd>
</dl></blockquote>

<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
URN Sub-Namespace Registration for
     urn:ietf:params:xml:ns:watcher-count</h3>

<p>This section registers a new XML namespace, as per the guidelines in
   [?].
</p>
<blockquote class="text"><dl>
<dt></dt>
<dd>URI: The URI for this namespace is
        urn:ietf:params:xml:ns:watcher-count.

</dd>
<dt></dt>
<dd>
   Registrant Contact: IETF, SIMPLE working group,
         &lt;simple@ietf.org&gt;, Brian Rosen
         &lt;br@brianrosen.net&gt;.

</dd>
<dt></dt>
<dd>
   XML:
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

       BEGIN
       &lt;?xml version="1.0"?&gt;
       &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.0//EN"
                 "http://www.w3.org/TR/xhtml-basic/xhtml-basic10.dtd"&gt;
       &lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
       &lt;head&gt;
         &lt;meta http-equiv="content-type"
            content="text/html;charset=iso-8859-1"/&gt;
         &lt;title&gt;Watcher Count Namespace&lt;/title&gt;
       &lt;/head&gt;
       &lt;body&gt;
         &lt;h1&gt;Namespace for Watcher Count&lt;/h1&gt;
         &lt;h2&gt;urn:ietf:params:xml:ns:watcher-count&lt;/h2&gt;
         &lt;p&gt;See &lt;a href="ftp://ftp.rfc-editor.org/in-notes/rfc3858.txt"&gt;
            RFC3858&lt;/a&gt;.&lt;/p&gt;
       &lt;/body&gt;
       &lt;/html&gt;
       END
</pre></div>
</dd>
</dl></blockquote>

<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Package Registration</h3>

<p>This specification registers an event template package as specified
   in Section 6.2 of <a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a>.
</p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Package Name: watcher-count

</dd>
<dt></dt>
<dd>
   Template Package: yes

</dd>
<dt></dt>
<dd>
   Published Specification: This document

</dd>
<dt></dt>
<dd>
   Person to Contact: Brian Rosen, br@brianrosen.net.
</dd>
</dl></blockquote>

<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Denial of Service Attacks</h3>

<p>Watcher count generates notifications about changes in the
   state of watchers for a particular resource.  A single notification
   could be extremely large, as in the initial state notification.  
   This makes a watcher-count
   subscription a potential tool for denial of service attacks.
   Preventing these can be done through a combination of sensible
   authorization policies and good operating principles.

</p>
<p>
   Watcher-count
   subscriptions to that resource should only be allowed from explicitly
   authorized entities, whose identity has been properly authenticated.
   That prevents a watcher-count NOTIFY stream from being generated from
   subscriptions made by an attacker.
</p>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Divulging Sensitive Information</h3>

<p>Watcher count indicates how many users are interested in a
   particular resource.  Depending on the package and the resource, this
   can be very sensitive information.  
   One way in which this information can be revealed is eavesdropping.
   An attacker can observe watcher-count notifications, and learn this
   information.  To prevent that, watchers MAY use the sips URI scheme
   when subscribing to a watcherinfo resource.  Notifiers for
   watcher-count MUST support TLS and sips as if they were a proxy (see
   Section 26.3.1 of <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>).

</p>
<p>
   SIP encryption, using S/MIME, MAY be used end-to-end for the
   transmission of both SUBSCRIBE and NOTIFY requests.

</p>
<p>
   Another way in which this information can be revealed is through
   spoofed subscriptions.  These attacks can be prevented by
   authenticating and authorizing all watcher-count subscriptions.  In
   order for the notifier to authenticate the subscriber, it MAY use
   HTTP Digest (Section 22 of <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>).  As a result, all watchers MUST
   support HTTP Digest.  This is a redundant requirement, however, since
   all SIP user agents are mandated to support it by <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgements</h3>

<p>Guy Paradis and Fridy Sharon-Fridman of NeuStar contributed to the ideas in this 
document and reviewed the text.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2141">[RFC2141]</a></td>
<td class="author-text"><a href="mailto:jayhawk@ds.internic.net">Moats, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2141">URN Syntax</a>,&rdquo; RFC&nbsp;2141, May&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2141.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2141.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2141.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2648">[RFC2648]</a></td>
<td class="author-text"><a href="mailto:jayhawk@att.com">Moats, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2648">A URN Namespace for IETF Documents</a>,&rdquo; RFC&nbsp;2648, August&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2648.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3023">[RFC3023]</a></td>
<td class="author-text">Murata, M., St. Laurent, S., and D. Kohn, &ldquo;<a href="http://tools.ietf.org/html/rfc3023">XML Media Types</a>,&rdquo; RFC&nbsp;3023, January&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3023.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3256">[RFC3256]</a></td>
<td class="author-text">Jones, D. and R. Woundy, &ldquo;<a href="http://tools.ietf.org/html/rfc3256">The DOCSIS (Data-Over-Cable Service Interface Specifications) Device Class DHCP (Dynamic Host Configuration Protocol) Relay Agent Information Sub-option</a>,&rdquo; RFC&nbsp;3256, April&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3256.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3261">[RFC3261]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3265">[RFC3265]</a></td>
<td class="author-text">Roach, A., &ldquo;<a href="http://tools.ietf.org/html/rfc3265">Session Initiation Protocol (SIP)-Specific Event Notification</a>,&rdquo; RFC&nbsp;3265, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3265.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3688">[RFC3688]</a></td>
<td class="author-text">Mealling, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3688">The IETF XML Registry</a>,&rdquo; BCP&nbsp;81, RFC&nbsp;3688, January&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3688.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3856">[RFC3856]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3856">A Presence Event Package for the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;3856, August&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3856.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3857">[RFC3857]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3857">A Watcher Information Event Template-Package for the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;3857, August&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3857.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3903">[RFC3903]</a></td>
<td class="author-text">Niemi, A., &ldquo;<a href="http://tools.ietf.org/html/rfc3903">Session Initiation Protocol (SIP) Extension for Event State Publication</a>,&rdquo; RFC&nbsp;3903, October&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3903.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4825">[RFC4825]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://tools.ietf.org/html/rfc4825">The Extensible Markup Language (XML) Configuration Access Protocol (XCAP)</a>,&rdquo; RFC&nbsp;4825, May&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4825.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Brian Rosen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NeuStar, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">470 Conrad Dr</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mars, PA  16046</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:br@brianrosen.net">br@brianrosen.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Salvatore Loreto</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ericsson</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hirsalantie 11</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jorvas  02420</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:salvatore.loreto@ericsson.com">salvatore.loreto@ericsson.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Krisztian Kiss</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">313 Fairchild Dr</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mountain View, CA  94043</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:krisztian.kiss@nokia.com">krisztian.kiss@nokia.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
