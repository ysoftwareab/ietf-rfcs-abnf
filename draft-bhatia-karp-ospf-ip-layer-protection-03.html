<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Security Extension for OSPFv2 when using Manual Key Management</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 A Challenge and Response Solution">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Neighbor State Required">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Receiver Behavior">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Nonce Triggers">
<link href="#rfc.section.3" rel="Chapter" title="3 Packet Format">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Extensions to OSPF packets">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Extension of Hello Packet">
<link href="#rfc.section.4" rel="Chapter" title="4 Key Selection in Processing OSPF Packets">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Key Selection in Sending Unicast OSPF Packets">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Key Selection in Sending Multicast OSPF Packets">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Key Selection on Receiving OSPF Packets ">
<link href="#rfc.section.5" rel="Chapter" title="5 Existing Cryptographic Authentication Mechanism">
<link href="#rfc.section.6" rel="Chapter" title="6 Mechanism to secure the IP header">
<link href="#rfc.section.7" rel="Chapter" title="7 Alternative Boot Count Approach">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The current OSPFv2 cryptographic authentication mechanism as defined in the OSPF standards is vulnerable to both inter-session and intra-session replay attacks when its uses manual keying. Additionally, the existing cryptographic authentication schemes do not cover the IP header. This omission can be exploited to carry out various types of attacks." />
  <meta name="description" content="The current OSPFv2 cryptographic authentication mechanism as defined in the OSPF standards is vulnerable to both inter-session and intra-session replay attacks when its uses manual keying. Additionally, the existing cryptographic authentication schemes do not cover the IP header. This omission can be exploited to carry out various types of attacks." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">KARP Working Group</td>
<td class="right">M.B. Bhatia</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Alcatel-Lucent</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">S. Hartman</td>
</tr>
<tr>
<td class="left">Expires: August 19, 2011</td>
<td class="right">Painless Security</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">D. Zhang</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Huawei Technologies co., LTD.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">February 15, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Security Extension for OSPFv2 when using Manual Key Management<br />
  <span class="filename">draft-bhatia-karp-ospf-ip-layer-protection-03</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The current OSPFv2 cryptographic authentication mechanism as defined in the OSPF standards is vulnerable to both inter-session and intra-session replay attacks when its uses manual keying. Additionally, the existing cryptographic authentication schemes do not cover the IP header. This omission can be exploited to carry out various types of attacks.</p>
<p>This draft proposes an authentication scheme based on a challenge-response mechanism that will protect OSPFv2 from both inter and intra replay attacks when its using manual keys for securing its protocol packets. For comparison, an approach based on making sequence numbers unique is presented. Later we also describe some changes in the cryptographic hash computation so that we eliminate most attacks that result because of OSPFv2 not protecting the IP header.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 19, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">A Challenge and Response Solution</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Neighbor State Required</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Receiver Behavior</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">Nonce Triggers</a>
</li>
<li>3.   <a href="#rfc.section.3">Packet Format</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Extensions to OSPF packets</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Extension of Hello Packet</a>
</li>
<li>4.   <a href="#rfc.section.4">Key Selection in Processing OSPF Packets</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Key Selection in Sending Unicast OSPF Packets</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Key Selection in Sending Multicast OSPF Packets</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Key Selection on Receiving OSPF Packets </a>
</li>
<li>5.   <a href="#rfc.section.5">Existing Cryptographic Authentication Mechanism</a>
</li>
<li>6.   <a href="#rfc.section.6">Mechanism to secure the IP header</a>
</li>
<li>7.   <a href="#rfc.section.7">Alternative Boot Count Approach</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">Acknowledgements</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <p id="rfc.section..p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC2119 <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section..p.2">When used in lower case, these words convey their typical use in common language, and are not to be interpreted as described in RFC2119 <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The OSPFv2 cryptographic authentication mechanism as described in [<a href="#RFC2328">[RFC2328]</a>] uses per-packet sequence numbers to provide protection against replay attacks. The sequence numbers increase monotonically so that the attempts to replay the stale packets can be thwarted. The sequence number values are maintained as a part of adjacency states. Therefore, if an adjacency is broken down, the associated sequence numbers get re-initiated and the neighbors start all over again. Additionally, the cryptographic authentication mechanism does not specify how to deal with the rollover of a sequence number when it reaches its maximum limit. These omissions can be taken advantage of by attackers to implement various replay attacks (<a href="#RFC6039">[RFC6039]</a>). In order to address these issues, we propose a challenge/ response mechanism that introduces two additional random numbers to help routers generate distinguishable new states when the sequence numbers need to be re-initiated. Compared with the cryptographic authentication mechanism proposed in <a href="#RFC5709">[RFC5709]</a>, the solution proposed does not impose any more security presumption.</p>
<p id="rfc.section.1.p.2">The cryptographic authentication as described in <a href="#RFC2328">[RFC2328]</a> and later updated in <a href="#RFC5709">[RFC5709]</a> does not include the IP header. This also can be exploited to launch several attacks as the source address in the IP header is no longer protected.  The OSPF specification, in certain cases, requires the implementations to look at the source address carried in the IP header to determine the neighbor the packet was recieved from. Changing the source address of a packet can thus, confuse the reciever which can be exploited to produce a number of denial of service attacks <a href="#RFC6039">[RFC6039]</a>. If the packet is interpreted as coming from a different neighbor, the sequence number received from the neighbor may be updated. This may disrupt communication with the legitimate neighbor. Hello packets may be reflected to cause a neighbor to appear to have one-way communication.  Old Database descriptions may be reflected in cases where the per-packet sequence numbers are sufficiently divergent in order to disrupt an adjacency <a href="#I-D.hartman-ospf-analysis">[I-D.hartman-ospf-analysis]</a>. This is referred to as the IP layer issue in <a href="#I-D.ietf-karp-threats-reqs">[I-D.ietf-karp-threats-reqs]</a>.</p>
<p><a href="#RFC2328">[RFC2328]</a> states that implementations MUST offer keyed MD5 authentication. It is likely that this will be deprecated in favor of the stronger algorithms described in <a href="#RFC5709">[RFC5709]</a> in future deployments <a href="#RFC6094">[RFC6094]</a>.</p>
<p id="rfc.section.1.p.4">This draft proposes a simple change in the cryptographic authentication mechanism, as currently described in <a href="#RFC5709">[RFC5709]</a>, to prevent such IP layer attacks.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> A Challenge and Response Solution</h1>
<p id="rfc.section.2.p.1">In OSPFv2, a non-decreasing sequence member is associated with each OSPF packet sent from a router in order to prevent replay attacks.  However, as illustrated in <a href="#I-D.hartman-ospf-analysis">[I-D.hartman-ospf-analysis]</a> and <a href="#RFC6039">[RFC6039]</a>, in the circumstances where automatic key management mechanisms are unavailable, any re-initiation of sequence numbers can potentially be taken advantage of to perform replay attacks.  In this section, we introduce an extension of the OSPFv2 protocol, which uses challenge/response to benefit the verification of the freshness of OSPF packets when the sequence numbers of routers are re-initiated. This solution eliminates the reliance on automatic key management mechanisms.  However, it is assumed that a traffic key is shared between two communicating routers so that an attacker can play antique packets but lacks the capability to modify packets without being detected.</p>
<p id="rfc.section.2.p.2">In this protocol, two random numbers (Session ID and Nonce) are introduced. The session ID is used to identify the session a packet is within and thus makes inter-session replay attacks difficult. The nonce is used to challenge the liveness of communicating routers so that states need not be maintained with routers that are not currently neighbors. In combination with the sequence number, the session ID can effectively resist intra-session replay attacks. When the sequence space is exhausted, a router simply chooses a new session ID.</p>
<p id="rfc.section.2.p.3">Figure 1 illustrates how two routers A and B, challenge each other's liveness when they are initially connected to a link. First, A selects a new session ID (X1) and a new nonce (N1), and sends them out within a hello packet (see step 1). Particularly, X1and N1 are encapsulated in the OSPF header of the packet. Note that if A is on a multicast LAN, the packet is sent using multicast. Similarly, B sends a hello packet with its new session ID (X2) and Nonce (N2) (step 2). Upon receiving the hello packet from B, A sends a hello packet with X1 and N1. In the neighbor field of the packet, the router ID of B, X2, and N2 is encapsulated (Step 3). Upon receiving the packet sent in step 3, B can ensure the freshness of the packet if the attached session ID and nonce values of both routers are correct.</p>
<p id="rfc.section.2.p.4">In the same way, after receiving the hello packet from A, B sends a hello packet with X2 and N2 in the OSPF header, and in the neighbor field of the packet, the router ID of A, X1, and N1 is listed to identify that A has been discovered. After receiving the packet, A can make sure the packet is fresh if the session IDs and the nonce of both routers contained in the packet are correct. After A and B discover each other, they start exchanging their database information (steps 5 and 6).  During the exchange, every packet from Router A is associated with X1 and N1, while every packet from Router B is associated with X2 and N2.  Each of these packets also contains a sequence number as part of the cryptographic authentication option. The sequence number MUST increase for every packet sent.</p>
<p></p>
<div id="#rfc.figure.1"></div>
<pre>     +---------------+                             +---------------+ 
     |    router A   |                             |   router B    |
     +---------------+                             +---------------+
     ---------------------------------------------------------------  
          
     OSPF Hdr: Session ID = X1; Nonce = N1; OSPF HELLO: Neighbor = 0
 (1)  ------------------------------------&gt;
     
     OSPF Hdr: Session ID = X2; Nonce = N2; OSPF HELLO: Neighbor = 0
 (2)                           &lt;------------------------------------
         
     OSPF Hdr: Session ID = X1; Nonce = N1; OSPF HELLO: Neighbor = B; 
     Session ID = X2; Nonce = N2
 (3) ------------------------------------&gt;
     
     OSPF Hdr: Session ID = X2; Nonce = N2; OSPF HELLO: Neighbor = A;
     Session ID = X1; Nonce = N1
 (4)                           &lt;------------------------------------
     
     OSPF Hdr: Session ID = X1; Nonce = N1; Normal OSPF DD packet
 (5) ------------------------------------&gt;
     
     OSPF Hdr: Session ID = X2; Nonce = N2 Normal OSPF DD packet
 (6)                           &lt;------------------------------------

                                       *
                                       *
                                       *

     OSPF Hdr: Session ID = X1; Nonce = N1; OSPF HELLO: Neighbor = B; 
     Session ID = X2; Nonce = N2
 (7) ------------------------------------&gt;

Figure 1 Scenario: two Routers coming up on a LAN     </pre>
<p></p>
<p id="rfc.section.2.p.7">After A and B have generated a neighbor relationship, assume another router, C, is connected to the link. C finds the existence of A and intends to become a neighbor of A. The packets exchanged during this process are illustrated in Figure 2. Firstly, C selects a new session ID (X3) and a new nonce value (N3), and sends them out within a blank hello packet (see the second step of Figure 2). After receiving this packet, A sends out a hello packet with the information of C (router ID, X3, and N3) in the neighbor field. Because A is challenging the liveness of a new neighbor, A selects a new nonce N1' and encapsulates it in the OSPF header of the hello packet to challenge whether the packet sent in step 2 is really from C. After receiving the packet from A, C can make sure the packet is valid since it consists of its current session ID and nonce (e.g., X3 and N3). Thus, C replies to A with a hello packet including the information of A (e.g., X1 and N1') in the neighbor field.  After receiving this packet and checking the correctness of X1 and N1', A can ensure that the packet is fresh and C is currently online.</p>
<p id="rfc.section.2.p.8">It worthwhile to note that during the challenge and response the hello packets sent immediately amnogst routers. </p>
<p></p>
<div id="#rfc.figure.2"></div>
<pre>     +---------------+                             +---------------+ 
     |    router A   |                             |   router C    |
     +---------------+                             +---------------+
     --------------------------------------------------------------  
          
     OSPF Hdr: Session ID = X1; Nonce = N1; OSPF HELLO: Neighbor = B; 
     Session ID = X2; Nonce = N2
 (1)  ------------------------------------&gt;
     
     OSPF Hdr: Session ID = X3; Nonce = N3; OSPF HELLO: Neighbor = 0
 (2)                           &lt;------------------------------------
         
     OSPF Hdr: Session ID = X1; Nonce = N1'; OSPF HELLO: Neighbor = B; 
     Session ID = X2; Nonce = N2; Neighbor = C;
     Session ID = X3; Nonce = N3
 (3) ------------------------------------&gt;
     
     OSPF Hdr: Session ID = X3; Nonce = N3; OSPF HELLO: Neighbor = A;
     Session ID = X1; Nonce = N1'
 (4)                            &lt;------------------------------------
     
     OSPF Hdr: Session ID = X1; Nonce = N1'; Normal OSPF DD packet
 (5) ------------------------------------&gt;
     
     OSPF Hdr: Session ID = X3; Nonce = N3 Normal OSPF DD packet
 (6)                            &lt;------------------------------------

                                       *
                                       *
                                       *

     OSPF Hdr: Session ID = X1; Nonce = N1'; OSPF HELLO: Neighbor = B; 
     Session ID = X2; Nonce = N2; Neighbor = C;
     Session ID = X3; Nonce = N3
 (7) ------------------------------------&gt;

Figure 2. Scenario: another Router C comes up on that LAN     

</pre>
<p></p>
<p id="rfc.section.2.p.11">Figure 3 illustrates the scenario in which router A is rebooted.  After the reboot, A lost its state and selects a new session ID (X4) and a new nonce value (N4). However, B still maintains the earlier session ID and nonce values of A (X1 and N1). In step 1, A sends a blank hello packet out with its new session ID and nonce value. After receiving the hello packet, B realizes that the session ID and the nonce value of A in the OSPF header are different from the ones maintained in its database.  In order to distinguish a reboot from a replay of an old packet, B selects a new nonce value, N2', and transports it as well as its session ID (X2) in a hello packet to check whether the packet is from A. In the neighbor field of this packet, B continues listing A with the earlier session ID and nonce values (i.e., X1 and N1). Therefore, if an attacker attempts to send an antique packet to masquerade as A, A would update its database with the new nonce of B and send a hello packet with its existing Session ID and nonce values (X1 and N1). In step 3, B receives a new hello packet consisting of B's new nonce value from A. Since this packet lists B with the new nonce value in the neighbors field of the hello and since the nonce is new, this packet cannot be a replay. Now, B can safely assume that A has indeed restarted and can start using the new session ID and the nonce values sent by A in the neighbor field of its hellos.</p>
<div id="#rfc.figure.3"></div>
<pre>     +---------------+                              +---------------+ 
     |    router A   |                              |   router B    |
     +---------------+                              +---------------+
     ---------------------------------------------------------------  
          
     OSPF Hdr: Session ID = X4; Nonce = N4; OSPF HELLO: Neighbor = 0
 (1)  ------------------------------------&gt;
     
     OSPF Hdr: Session ID = X2; Nonce = N2'; OSPF HELLO: Neighbor = A;
     Session ID = X1; Nonce = N1
 (2)                            &lt;------------------------------------
         
     OSPF Hdr: Session ID = X4; Nonce = N4; OSPF HELLO: Neighbor = B; 
     Session ID = X2; Nonce = N2'
 (3) ------------------------------------&gt;
     
     OSPF Hdr: Session ID = X2; Nonce = N2'; OSPF HELLO: Neighbor = A;
     Session ID = X4; Nonce = N4
 (4)                             &lt;------------------------------------
     
     OSPF Hdr: Session ID = X4; Nonce = N4; Normal OSPF DD packet
 (5) ------------------------------------&gt;
     
     OSPF Hdr: Session ID = X2; Nonce = N2' Normal OSPF DD packet
 (6)                             &lt;------------------------------------

                                       *
                                       *
                                       *

     OSPF Hdr: Session ID = X4; Nonce = N4; OSPF HELLO: Neighbor = B; 
     Session ID = X2; Nonce = N2'
 (7) ------------------------------------&gt;

Figure 3. Scenario: Router A Reboot

</pre>
<p></p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Neighbor State Required</h1>
<p id="rfc.section.2.1.p.1">This authentication type requires the following additional fields be stored per neighbor: </p>

<ul>
<li>The session ID most recently received from a neighbor</li>
<li>The nonce most recently received from a neighbor; this only needs to be kept up-to-date when the session ID changes or when establishing an adjacency</li>
<li>A set of sequence numbers for the neighbor; if packets are sometimes processed out of order, then a sequence number MAY be maintained for each type of packet</li>
</ul>

<p> </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Receiver Behavior</h1>
<p id="rfc.section.2.2.p.1">This section describes how OSPF receivers will handle the reception of packets with the nonce and session ID.</p>
<p id="rfc.section.2.2.p.2">If a packet is received for a neighbor in at least the 2-way state, then the session ID is compared to the one stored in the neighbor table. If the session ID does not match the session ID recorded with the neighbor, and the packet is not a hello, the packet is discarded. If the packet is a hello, then rules for hellos in following paragraphs apply. Otherwise, if the session ID matches, then if the sequence number in the cryptographic authentication option is not strictly greater than the sequence number associated with the neighbor for this type of packet, then the packet is discarded. If the cryptographic verification of the checksum fails, the packet is discarded. Otherwise, the packet is accepted by the cryptographic authentication and the sequence number associated with the neighbor for this packet type is updated to be the sequence number in the packet. The router MAY update the nonce associated with the neighbor to a nonce in a received hello packet. Updating the nonce is optional because the adjacency is already established. One case where a router implementationd would want to update nonces is where the router has recently changed session IDs without dropping all adjacencies. Such a session ID change is likely to be rare, either the result of a reboot that preserved adjacencies but might not preserve sequence numbers or running out of sequence number space.</p>
<p id="rfc.section.2.2.p.3">If a hello is received for a neighbor that is not found or that has not reached 2-way state the following steps are performed. If a neighbor structure exists for the neighbor and the session ID match that stored in the neighbor structure, then the packet is processed as follows. The sequence number is checked and MUST be strictly greater than the sequence number in the neighbor structure. The cryptographic authentication is verified. If this router is listed in the set of neighbors in the hello packet, the nonce and session ID MUST match this router's current nonce and session ID. If any of these checks fail, the packet is discarded. Otherwise the packet is accepted past cryptographic processing.</p>
<p id="rfc.section.2.2.p.4">By this point, the router has received a hello packet. Either no neighbor structure exists or the session ID has changed. Before permitting communication with this router, its liveness needs to be challenged. If a neighbor has been deleted (because of a timeout) since the last nonce trigger, then a nonce trigger (see <a href="#NONCE_TRIGGER">Section 2.3</a>is performed and the packet is discarded. If this router is listed in the list of neighbors, it MUST be listed with its current session ID and nonce otherwise the packet is discarded. If verification of the cryptographic checksum fails, the packet is discarded. If the neighbor is already in 2-way state or greater and this router is not listed in the set of neighbors, the packet is discarded. Otherwise, the session ID, nonce and all sequence numbers associated with the neighbor are updated from the packet and the packet is accepted by cryptographic authentication processing. </p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> <a href="#NONCE_TRIGGER" id="NONCE_TRIGGER">Nonce Triggers</a>
</h1>
<p id="rfc.section.2.3.p.1">The router keeps track of whether a nonce trigger has happened since the last time a neighbor is deleted.</p>
<p id="rfc.section.2.3.p.2">In order to test liveness, a router updates its current nonce to a new value. As a side effect, all routers on the link that do not already have an adjacency with this router will update the nonce associated with this router. More importantly, though, the router we are testing liveness with will update the nonce in its hello entry for this router. That will allow this router to confirm that the session ID is correct and corresponds to current replay state.</p>
<p id="rfc.section.2.3.p.3">As part of a nonce trigger, the router updates its current nonce.  If a hello has not been sent too recently, then a hello is sent with the new nonce. The nonce trigger state is updated to indicate that no new neighbors have been deleted since the last nonce trigger.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Packet Format</h1>
<p id="rfc.section.3.p.1">In the challenge/ response mechanism, every OSPFv2 packet MUST carry the current Session ID and the associated Nonce value. This section describes how this information is carried in the OSPFv2 packets.</p>
<p id="rfc.section.3.p.2">The OSPF packet header includes an authentication type field, and 64-bits of data for use by the appropriate authentication scheme (determined by the type field).  Authentication types 0, 1 and 2 are defined in  <a href="#RFC2328">[RFC2328]</a>. This document defines Authentication type 3.  </p>
<p id="rfc.section.3.p.3">When using this authentication scheme the 64 bit Authentication field in the OSPF packet header remains unchanged and is the same as defined in Section D.3 of <a href="#RFC2328">[RFC2328]</a>. NOTE to the WG:  We can also increase the size of the Key ID. Currently it has been kept as, but nothing prevents us from changing this.  </p>
<div id="#rfc.figure.4"></div>
<pre>
        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |              0                |    Key ID     | Auth Data Len |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                 Cryptographic sequence number                 |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Figure 4.Usage of the Authentication field in the OSPF header when this mechanism is employed</pre>
<p id="rfc.section.3.p.4">The Session ID and the Nonce information is placed before the message digest that is appended to the OSPF packet. In this case too, the final Authentication data is not actually considered part of the OSPF protocol packet.  </p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Extensions to OSPF packets</h1>
<p id="rfc.section.3.1.p.1">This section describes the new OSPFv2 packet format when this authentication scheme is being used.  </p>
<div id="#rfc.figure.5"></div>
<pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ -
     |   Version #   |     Type      |         Packet length         | ^
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                          Router ID                            | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                           Area ID                             | |OSPF
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |HEADER
     |           Checksum            |             AuType            | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |              0                |    Key ID     | Auth Data Len | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                 Cryptographic sequence number                 | V
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ -
     |                                                               | ^ 
     |                   OSPF Protocol Packet                        | |
     ~                                                               ~ |BODY
     |                                                               | |
     |                                                               | V
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ -
     |                          Session ID                           | ^
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                         Nonce Value                           | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |AUTH
     |                                                               | |DIGEST
     ~                     Authentication Data                       ~ |
     |                                                               | V
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ -
       

Figure 5.OSPFv2 Packet view</pre>
<p></p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Extension of Hello Packet</h1>
<p id="rfc.section.3.2.p.1">The following figure shows an OSPF HELLO packet when this authentication scheme is being used. The HELLO payload has been modified to include each neighbor's Session ID and the Nonce value. The authentication data, as described above, carries the router's current Session ID and the Nonce value.</p>
<div id="#rfc.figure.6"></div>
<pre>      
      0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ -
     |   Version #   |       1       |         Packet length         | ^
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                          Router ID                            | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |OSPF 
     |                           Area ID                             | |HDR
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |           Checksum            |           AuType = 3          | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |              0                |    Key ID     | Auth Data Len | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                 Cryptographic sequence number                 | V
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ -
     |                        Network Mask                           | ^
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |         HelloInterval         |    Options    |    Rtr Pri    | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                     RouterDeadInterval                        | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                      Designated Router                        | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                   Backup Designated Router                    | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |HELLO
     |                          Neighbor 1                           | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                   Session ID of Neighbor 1                    | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                      Nonce of Neighbor 1                      | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                          Neighbor 2                           | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                   Session ID of Neighbor 2                    | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                      Nonce of Neighbor 2                      | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                               ...                             | V
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ -
     |                          Session ID                           | ^
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
     |                         Nonce Value                           | |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |AUTH
     |                                                               | |DATA
     ~                     Authentication Data                       ~ |
     |                                                               | V
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ -

Figure 6.Extension of Protocol Packet</pre>
<p></p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Key Selection in Processing OSPF Packets</h1>
<p id="rfc.section.4.p.1">This section introduces how the proposed security solution looks up long lived keys from key tables <a href="#I-D.ietf-karp-crypto-key-table">[I-D.ietf-karp-crypto-key-table]</a>. Generally, a proper key selected to process an OSPFv2 packet should satisfy the requirements listed as follows: </p>

<ul class="empty">
<li>the key is in its valid period; and</li>
<li>the key can be used for the desired security algorithm.</li>
</ul>

<p>In the remainder of this section, other requirements that a selected key should particularly satisfy are depicted in different scenarios.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Key Selection in Sending Unicast OSPF Packets</h1>
<p id="rfc.section.4.1.p.1">Assume that a router R1 tries to send a unicast OSPF packet from its interface I1 to the interface R2 of a remote router R2 using security protocol P via interface I at time T. Firstly consider the circumstances where R1 and R2 are not connected with a virtual link.  R1 then needs to select a long long-lived symmetric key from its key table. Because the key should be shared by the by both R1 and R2 to protect the communication between I1 and I2, the key should satisfy the following requirements:</p>

<ul class="empty">
<li>the Peer field includes the router ID of R2;</li>
<li>the PeerKeyID field is not "unknown";</li>
<li>the Interfaces field includes I1; and</li>
<li>the Direction field is either "out" or "both".</li>
</ul>

<p>When R1 and R2 are at the ends of a virtual link, the condition is a little more complex. Because the virtual link can be regarded as an unnumbered point-to-point network, the IP address of the interface actually used to send the packet (i.e., I1) is discovered during the routing table build process. Therefore, when the system operator deploys the keys to protect the virtual link, I1 has not been specified yet. Therefore, the key should be identified by the router IDs rather than by the interface originating the packet, and the third requirement introduced above should be changed to &#8220;the Interface field includes the router ID&#8221;.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Key Selection in Sending Multicast OSPF Packets</h1>
<p id="rfc.section.4.2.p.1">If a router R1 sends an OSPF packet from its interface I1 to a multicast address (e.g., AllSPFRouters, AllDRouters), it needs to select a key according to the following requirements:</p>

<ul class="empty">
<li>the Peer field includes the multicast address;</li>
<li>the PeerKeyID field is "group";</li>
<li>the Interfaces field includes I1; and</li>
<li>the Direction field is either "out" or "both".</li>
</ul>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> Key Selection on Receiving OSPF Packets </h1>
<p id="rfc.section.4.3.p.1">When Cryptographic Authentication is employed, the ID of the adopted key is encapsulated within the authentication field of an OSPF packet header. Using this ID, it is relatively easy for a receiver to locate the key. The requirement is relatively simple:</p>

<ul class="empty">
<li>the Peer field includes the router ID of the sender; and</li>
<li>the PeerKeyID field includes the key ID obtained from the authentication field</li>
</ul>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Existing Cryptographic Authentication Mechanism</h1>
<p id="rfc.section.5.p.1">The overall cryptographic authentication process defined in <a href="#RFC5709">[RFC5709]</a> remains unchanged. To reduce the potential for confusion, this section minimises the repetition of text from RFC 5709 and is incorporated here by reference <a href="#RFC5709">[RFC5709]</a>.</p>
<p id="rfc.section.5.p.2">RFC 5709, Section 3.3, describes how the cryptographic authentication must be computed. It requires OSPFv2 packet's Authentication Trailer (which is the appendage described in RFC 2328, Section D.4.3, Page 233, items (6)(a) and (6)(d)) to be filled with the value Apad where Apad is a hexadecimal constant value 0x878FE1F3 repeated (L/4) times, where L is the length of the hash being used and is measured in octets rather than bits.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Mechanism to secure the IP header</h1>
<p id="rfc.section.6.p.1">This document updates the definition of Apad which is currently a constant defined in <a href="#RFC5709">[RFC5709]</a> to the source address thats carried in the IP header of the OSPFv2 protocol packet. Routers at the sending side must initialize Apad to a value of the source address that would be used when sending out the OSPFv2 packet, repeated L/4 times, where L is the length of the hash, measured in octets. The basic idea is to incorporate the source address from the IP header in the cryptographic authentication computation so that any change there can be detected.</p>
<p id="rfc.section.6.p.2">At the recieving end implementations MUST initialize Apad as the source address that exists in the IP Header of the incoming OSPFv2 protocol packet, repeated L/4 times, instead of the constant that's currently defined in <a href="#RFC5709">[RFC5709]</a>. Besides changing the value of Apad this document does not introduce any other changes to the authentication mechanism described in <a href="#RFC5709">[RFC5709]</a>. </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Alternative Boot Count Approach</h1>
<p id="rfc.section.7.p.1">During discussion of the challenge/response authentication approach, a desire was expressed to have a simpler alternative to consider. This section presents an alternative that obtains most advantages of the challenge/response mechanism. Instead of adding nonces and session IDs, OSPF implementations are required to keep a count of the number of times they have booted in non-volatile storage. This requirement is also placed on agents by the SNMPv3 security architecture; the same boot count can be used both for SNMP and for this OSPF mechanism.</p>
<p id="rfc.section.7.p.2">The OSPF sequence number is extended to be 64-bits rather than 32-bits. The most significant 32-bits are the boot count. The least significant 32-bits is a counter that increases for every packet sent.</p>
<p id="rfc.section.7.p.3">A receiver verifies that the sequence number on a received packet is strictly greater than the sequence number of the previous packet received.</p>
<p id="rfc.section.7.p.4">Requiring that each packet have a strictly greater sequence number is a change from the current OSPF security model. However this change is required for a number of the security guarantees.</p>
<p id="rfc.section.7.p.5">This mechanism requires fewer changes to the OSPF packet than the challenge/response mechanism. Also, the implementation complexity is somewhat less.</p>
<p id="rfc.section.7.p.6">However there are disadvantages. First, this mechanism requires that the boot count be maintained succesfully in nonvolatile storage. If the boot count ever goes backwards without changing the encryption key, then all the attacks against the current OSPF protocol become possible against this protocol until the time that the boot count reaches a value greater than the largest value ever used for this client. This can be particularly problematic if equipment is replaced, using a router ID that has been used previously on a link but with a fresh boot count.</p>
<p id="rfc.section.7.p.7">Another disadvantage is that the boot count mechanism does not protect against a session replayed while a router is down. If a router crashes or is taken out of service, then an attacker can replay packets as soon as the adjacencies with the router time out. The vulnerabilities of this have not been fully analyzed. Potential vulnerabilities include attacks on the designated router election process and replays of complete sessions. So far it looks like it is not likely that an attacker could bring up a replayed session far enough to inject routes from a down router.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.8.p.1">This document attempts to fix the manual key management procedure that currently exists within OSPFv2, as part of the Phase 1 of the KARP Working Group. This therefore, only considers manual key management mechanism to be used for OSPFv2. Any solution that takes advantage of the automatic key management mechanism is beyond the scope of this document.</p>
<p id="rfc.section.8.p.2">This document also provides a solution to prevent certain denial of service attacks that can be launched by changing the source address in the IP header of the OSPFv2 protocol packet.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.9.p.1">This document requests a new Auth Type to be defined for OSPFv2. It currently uses 3 to foster pre-standard deployments.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Acknowledgements</h1>
<p id="rfc.section.10.p.1">The authors would like to thank Acee Lindem for valuable contributions and helping to understand the tradeoffs surrounding various solutions.</p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2328">[RFC2328]</b></td>
<td class="top">
<a href="mailto:jmoy@casc.com" title="Ascend Communications, Inc.">Moy, J.</a>, "<a href="http://tools.ietf.org/html/rfc2328">OSPF Version 2</a>", STD 54, RFC 2328, April 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5709">[RFC5709]</b></td>
<td class="top">
<a>Bhatia, M.</a>, <a>Manral, V.</a>, <a>Fanto, M.</a>, <a>White, R.</a>, <a>Barnes, M.</a>, <a>Li, T.</a> and <a>R. Atkinson</a>, "<a href="http://tools.ietf.org/html/rfc5709">OSPFv2 HMAC-SHA Cryptographic Authentication</a>", RFC 5709, October 2009.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC6039">[RFC6039]</b></td>
<td class="top">
<a>Manral, V.</a>, <a>Bhatia, M.</a>, <a>Jaeggli, J.</a> and <a>R. White</a>, "<a href="http://tools.ietf.org/html/rfc6039">Issues with Existing Cryptographic Protection Methods for Routing Protocols</a>", RFC 6039, October 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.hartman-ospf-analysis">[I-D.hartman-ospf-analysis]</b></td>
<td class="top">
<a>Hartman, S</a> and <a>D Zhang</a>, "<a href="http://tools.ietf.org/html/draft-hartman-ospf-analysis-02">Analysis of OSPF Security According to KARP Design Guide</a>", Internet-Draft draft-hartman-ospf-analysis-02, December 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-karp-threats-reqs">[I-D.ietf-karp-threats-reqs]</b></td>
<td class="top">
<a>Lebovitz, G</a>, <a>Bhatia, M</a> and <a>R White</a>, "<a href="http://tools.ietf.org/html/draft-ietf-karp-threats-reqs-03">The Threat Analysis and Requirements for Cryptographic Authentication of Routing Protocols' Transports</a>", Internet-Draft draft-ietf-karp-threats-reqs-03, June 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-karp-crypto-key-table">[I-D.ietf-karp-crypto-key-table]</b></td>
<td class="top">
<a>Housley, R</a> and <a>T Polk</a>, "<a href="http://tools.ietf.org/html/draft-ietf-karp-crypto-key-table-02">Database of Long-Lived Symmetric Cryptographic Keys</a>", Internet-Draft draft-ietf-karp-crypto-key-table-02, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6094">[RFC6094]</b></td>
<td class="top">
<a>Bhatia, M.</a> and <a>V. Manral</a>, "<a href="http://tools.ietf.org/html/rfc6094">Summary of Cryptographic Authentication Algorithm Implementation Requirements for Routing Protocols</a>", RFC 6094, February 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Manav Bhatia</span> 
	  <span class="n hidden">
		<span class="family-name">Bhatia</span>
	  </span>
	</span>
	<span class="org vcardline">Alcatel-Lucent</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Bangalore</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">India</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:manav.bhatia@alcatel-lucent.com">manav.bhatia@alcatel-lucent.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Sam Hartman</span> 
	  <span class="n hidden">
		<span class="family-name">Hartman</span>
	  </span>
	</span>
	<span class="org vcardline">Painless Security</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:hartmans@painless-security.com">hartmans@painless-security.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Dacheng Zhang</span> 
	  <span class="n hidden">
		<span class="family-name">Zhang</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei Technologies co., LTD.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Beijing</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">China</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:zhangdacheng@huawei.com">zhangdacheng@huawei.com</a></span>

  </address>
</div>

</body>
</html>