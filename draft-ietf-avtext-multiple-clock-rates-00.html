<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Support for multiple clock rates in an RTP session</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Legacy RTP">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Different SSRC">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Same SSRC">
<link href="#rfc.section.2.2.1" rel="Chapter" title="2.2.1 Monotonic timestamps">
<link href="#rfc.section.3" rel="Chapter" title="3 Terminology">
<link href="#rfc.section.4" rel="Chapter" title="4 Recommendations">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 RTP Sender">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 RTP Receiver">
<link href="#rfc.section.5" rel="Chapter" title="5 Interoperability Analysis">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Using a fixed clock rate">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B Release notes">
<link href="#rfc.appendix.Appendix%20B.1" rel="Chapter" title="Appendix B.1 Modifications between draft-ietf-avtext-multiple-clock-rates-00 and draft-petithuguenin-avtext-multiple-clock-rates-01">
<link href="#rfc.appendix.Appendix%20B.2" rel="Chapter" title="Appendix B.2 Modifications between draft-petithuguenin-avtext-multiple-clock-rates-01 and draft-petithuguenin-avtext-multiple-clock-rates-00">
<link href="#rfc.appendix.Appendix%20B.3" rel="Chapter" title="Appendix B.3 Modifications between draft-petithuguenin-avtext-multiple-clock-rates-00 and draft-petithuguenin-avt-multiple-clock-rates-03">
<link href="#rfc.appendix.Appendix%20B.4" rel="Chapter" title="Appendix B.4 Modifications between draft-petithuguenin-avt-multiple-clock-rates-03 and draft-petithuguenin-avt-multiple-clock-rates-02">
<link href="#rfc.appendix.Appendix%20B.5" rel="Chapter" title="Appendix B.5 Modifications between draft-petithuguenin-avt-multiple-clock-rates-02 and draft-petithuguenin-avt-multiple-clock-rates-01">
<link href="#rfc.appendix.Appendix%20B.6" rel="Chapter" title="Appendix B.6 Modifications between draft-petithuguenin-avt-multiple-clock-rates-01 and draft-petithuguenin-avt-multiple-clock-rates-00">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document clarifies the RTP specification when different clock rates are used in an RTP session.  It also provides guidance on how to interoperate with legacy RTP implementations that use multiple clock rates.  " />
  <meta name="description" content="This document clarifies the RTP specification when different clock rates are used in an RTP session.  It also provides guidance on how to interoperate with legacy RTP implementations that use multiple clock rates.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">M.P.H. Petit-Huguenin</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Stonyfish, Inc.</td>
</tr>
<tr>
<td class="left">Updates: 3550 (if approved)</td>
<td class="right">June 01, 2011</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right"></td>
</tr>
<tr>
<td class="left">Expires: December 03, 2011</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Support for multiple clock rates in an RTP session<br />
  <span class="filename">draft-ietf-avtext-multiple-clock-rates-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document clarifies the RTP specification when different clock rates are used in an RTP session.  It also provides guidance on how to interoperate with legacy RTP implementations that use multiple clock rates.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 03, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Legacy RTP</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Different SSRC</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Same SSRC</a>
</li>
<li>2.2.1.   <a href="#rfc.section.2.2.1">Monotonic timestamps</a>
</li>
<li>3.   <a href="#rfc.section.3">Terminology</a>
</li>
<li>4.   <a href="#rfc.section.4">Recommendations</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">RTP Sender</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">RTP Receiver</a>
</li>
<li>5.   <a href="#rfc.section.5">Interoperability Analysis</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Acknowledgements</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Using a fixed clock rate</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">Release notes</a>
</li>
<li>Appendix B.1.   <a href="#rfc.appendix.Appendix%20B.1">Modifications between draft-ietf-avtext-multiple-clock-rates-00 and draft-petithuguenin-avtext-multiple-clock-rates-01</a>
</li>
<li>Appendix B.2.   <a href="#rfc.appendix.Appendix%20B.2">Modifications between draft-petithuguenin-avtext-multiple-clock-rates-01 and draft-petithuguenin-avtext-multiple-clock-rates-00</a>
</li>
<li>Appendix B.3.   <a href="#rfc.appendix.Appendix%20B.3">Modifications between draft-petithuguenin-avtext-multiple-clock-rates-00 and draft-petithuguenin-avt-multiple-clock-rates-03</a>
</li>
<li>Appendix B.4.   <a href="#rfc.appendix.Appendix%20B.4">Modifications between draft-petithuguenin-avt-multiple-clock-rates-03 and draft-petithuguenin-avt-multiple-clock-rates-02</a>
</li>
<li>Appendix B.5.   <a href="#rfc.appendix.Appendix%20B.5">Modifications between draft-petithuguenin-avt-multiple-clock-rates-02 and draft-petithuguenin-avt-multiple-clock-rates-01</a>
</li>
<li>Appendix B.6.   <a href="#rfc.appendix.Appendix%20B.6">Modifications between draft-petithuguenin-avt-multiple-clock-rates-01 and draft-petithuguenin-avt-multiple-clock-rates-00</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The clock rate is a parameter of the payload format.  It is often defined as been the same as the sampling rate but it is not always the case (see e.g. the G722 and MPA audio codecs in <a href="#RFC3551">[RFC3551]</a>).  </p>
<p id="rfc.section.1.p.2">An RTP sender can switch between different payloads during the lifetime of an RTP session and because clock rates are defined by payload types, it is possible that the clock rate also varies during an RTP session.  <a href="#RFC3550">RTP</a> <cite title="NONE">[RFC3550]</cite> lists using multiple clock rates as one of the reasons to not use different payloads on the same SSRC but unfortunately this advice was not always followed and some RTP implementations change the payload in the same SSRC even if the different payloads use different clock rates.  </p>
<p id="rfc.section.1.p.3">This creates three problems: </p>

<ul>
<li>The method used to calculate the RTP timestamp field in an RTP packet is underspecified.</li>
<li>When the same SSRC is used for different clock rates, it is difficult to know what clock rate was used for the RTP timestamp field in an RTCP SR packet.</li>
<li>When the same SSRC is used for different clock rates, it is difficult to know what clock rate was used for the interarrival jitter field in an RTCP RR packet.</li>
</ul>

<p> </p>
<p><a href="#fields">Table 1</a> contains a non-exhaustive list of fields in RTCP packets that uses a clock rate as unit: </p>
<div id="#rfc.table.1"></div>
<div id="#fields"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Field name</th>
<th class="left">RTCP packet type</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">RTP timestamp</td>
<td class="left">SR</td>
<td class="left"><a href="#RFC3550">[RFC3550]</a></td>
</tr>
<tr>
<td class="left">Interarrival jitter</td>
<td class="left">RR</td>
<td class="left"><a href="#RFC3550">[RFC3550]</a></td>
</tr>
<tr>
<td class="left">min_jitter</td>
<td class="left">XR Summary Block</td>
<td class="left"><a href="#RFC3611">[RFC3611]</a></td>
</tr>
<tr>
<td class="left">max_jitter</td>
<td class="left">XR Summary Block</td>
<td class="left"><a href="#RFC3611">[RFC3611]</a></td>
</tr>
<tr>
<td class="left">mean_jitter</td>
<td class="left">XR Summary Block</td>
<td class="left"><a href="#RFC3611">[RFC3611]</a></td>
</tr>
<tr>
<td class="left">dev_jitter</td>
<td class="left">XR Summary Block</td>
<td class="left"><a href="#RFC3611">[RFC3611]</a></td>
</tr>
<tr>
<td class="left">Interarrival jitter</td>
<td class="left">IJ</td>
<td class="left"><a href="#RFC5450">[RFC5450]</a></td>
</tr>
<tr>
<td class="left">RTP timestamp</td>
<td class="left">SMPTETC</td>
<td class="left"><a href="#RFC5484">[RFC5484]</a></td>
</tr>
<tr>
<td class="left">Jitter</td>
<td class="left">RSI Jitter Block</td>
<td class="left"><a href="#RFC5760">[RFC5760]</a></td>
</tr>
<tr>
<td class="left">Median jitter</td>
<td class="left">RSI Stats Block</td>
<td class="left"><a href="#RFC5760">[RFC5760]</a></td>
</tr>
</tbody>
</table>
<p id="rfc.section.1.p.5">This document first tries to list in <a href="#legacy">Section 2</a> and subsections all the various algorithms used by existing RTP implementations.  This sections are not normative.  </p>
<p><a href="#recommendations">Section 4</a> and subsections then recommend a unique algorithm that modifies <a href="#RFC3550">[RFC3550]</a>.  This sections are normative.  </p>
<p><a href="#analysis">Section 5</a> and subsections then analyze what happen when the legacy algorithms listed in <a href="#legacy">Section 2</a> are used with the new algorithm listed in <a href="#recommendations">Section 4</a>.  This sections are not normative.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#legacy" id="legacy">Legacy RTP</a>
</h1>
<p id="rfc.section.2.p.1">The following sections describe the various ways legacy RTP implementations behave when multiple clock rates are used.  Legacy RTP refers to RFC 3550 without the modifications introduced by this document.  </p>
<p id="rfc.section.2.p.2">[[We need to list here all the methods used in the field.  Please send them to the author.  NDA can be arranged if needed]] </p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#method1" id="method1">Different SSRC</a>
</h1>
<p id="rfc.section.2.1.p.1">One way of managing multiple clock rates is to use a different SSRC for each different clock rate, as in this case there is no ambiguity on the clock rate used by fields in the RTCP packets.  This method also seems to be the original intent of RTP as can be deduced from points 2 and 3 of section 5.2 of RFC 3550.  </p>
<p id="rfc.section.2.1.p.2">On the other hand changing the SSRC can be a problem for some implementations designed to work only with unicast IP addresses, where having multiple SSRCs is considered a corner case.  Lip synchronization can also be a problem in the interval between the beginning of the new stream and the first RTCP SR packet.  This is not different than what happen at the beginning of the RTP session but it can be more annoying for the end-user.  </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Same SSRC</h1>
<p id="rfc.section.2.2.p.1">The simplest way of managing multiple clock rates is to use the same SSRC for all the payload types regardless of the clock rates.  </p>
<p id="rfc.section.2.2.p.2">Unfortunately there is no clear definition on how the RTP timestamp should be calculated in this case.  The following subsection presents one algorithm used in the field.  </p>
<h1 id="rfc.section.2.2.1">
<a href="#rfc.section.2.2.1">2.2.1.</a> <a href="#method2" id="method2">Monotonic timestamps</a>
</h1>
<p id="rfc.section.2.2.1.p.1">The most common method of calculating the RTP timestamp ensures that the value increases monotonically.  The formula used by this method is as follow: </p>
<p id="rfc.section.2.2.1.p.2">timestamp = previous_timestamp + (current_capture_time - previous_capture_time) * current_clock_rate </p>
<p id="rfc.section.2.2.1.p.3">The problem with this method is that the jitter calculation on the receiving side gives invalid result during the transition between two clock rates, as shown in <a href="#monotonic">Table 2</a>.  The capture and arrival time are in seconds, starting at the beginning of the capture of the first packet; clock rate is in Hz; the RTP timestamp does not include the random offset; the transit, jitter, and average jitter use the clock rate as unit.  </p>
<div id="#rfc.table.2"></div>
<div id="#monotonic"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Capt. time</th>
<th class="left">Clock rate</th>
<th class="left">RTP timestamp</th>
<th class="left">Arrival time</th>
<th class="left">Transit</th>
<th class="left">Jitter</th>
<th class="left">Average jitter</th>
</tr></thead>
<tbody>
<tr>
<td class="left">0</td>
<td class="left">8000</td>
<td class="left">0</td>
<td class="left">0.1</td>
<td class="left">800</td>
<td class="left"></td>
<td class="left"></td>
</tr>
<tr>
<td class="left">0.02</td>
<td class="left">8000</td>
<td class="left">160</td>
<td class="left">0.12</td>
<td class="left">800</td>
<td class="left">0</td>
<td class="left">0</td>
</tr>
<tr>
<td class="left">0.04</td>
<td class="left">8000</td>
<td class="left">320</td>
<td class="left">0.14</td>
<td class="left">800</td>
<td class="left">0</td>
<td class="left">0</td>
</tr>
<tr>
<td class="left">0.06</td>
<td class="left">8000</td>
<td class="left">480</td>
<td class="left">0.16</td>
<td class="left">800</td>
<td class="left">0</td>
<td class="left">0</td>
</tr>
<tr>
<td class="left">0.08</td>
<td class="left">16000</td>
<td class="left">800</td>
<td class="left">0.18</td>
<td class="left">2080</td>
<td class="left">480</td>
<td class="left">30</td>
</tr>
<tr>
<td class="left">0.1</td>
<td class="left">16000</td>
<td class="left">1120</td>
<td class="left">0.2</td>
<td class="left">2080</td>
<td class="left">0</td>
<td class="left">28</td>
</tr>
<tr>
<td class="left">0.12</td>
<td class="left">16000</td>
<td class="left">1440</td>
<td class="left">0.22</td>
<td class="left">2080</td>
<td class="left">0</td>
<td class="left">26</td>
</tr>
<tr>
<td class="left">0.14</td>
<td class="left">8000</td>
<td class="left">1600</td>
<td class="left">0.24</td>
<td class="left">320</td>
<td class="left">720</td>
<td class="left">70</td>
</tr>
<tr>
<td class="left">0.16</td>
<td class="left">8000</td>
<td class="left">1760</td>
<td class="left">0.26</td>
<td class="left">320</td>
<td class="left">0</td>
<td class="left">65</td>
</tr>
</tbody>
</table>
<p id="rfc.section.2.2.1.p.4">Calculating the correct transit time on the receiving side can be done by using the following formulas: </p>
<p></p>

<dl>
<dt>(1)</dt>
<dd style="margin-left: 8">current_time_capture = current_timestamp - previous_timestamp) / current_clock_rate + previous_time_capture</dd>
<dt>(2)</dt>
<dd style="margin-left: 8">transit = current_clock_rate * (time_arrival - current_time_capture)</dd>
<dt>(3)</dt>
<dd style="margin-left: 8">previous_time_capture = current_time_capture</dd>
</dl>
<p id="rfc.section.2.2.1.p.6">The main problem with this method, in addition to the fact that the jitter calculation described in RFC 3550 cannot be used, is that is it dependent on the previous RTP packets, packets that can be reordered or lost in the network.  But it seems that this is what most implementations are using.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Terminology</h1>
<p id="rfc.section.3.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<p></p>

<dl>
<dt>Clock rate:</dt>
<dd style="margin-left: 8">The multiplier used to convert from a wallclock value in seconds to an equivalent RTP timestamp value (without the fixed random offset).  Note that RFC 3550 uses various terms like "clock frequency", "media clock rate", "timestamp unit", "timestamp frequency", and "RTP timestamp clock rate" as synonymous to clock rate.  </dd>
<dt>RTP Sender:</dt>
<dd style="margin-left: 8">A logical network element that sends RTP packets, sends RTCP SR packets, and receives RTCP RR packets.  </dd>
<dt>RTP Receiver:</dt>
<dd style="margin-left: 8">A logical network element that receives RTP packets, receives RTCP SR packets, and sends RTCP RR packets.  </dd>
</dl>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#recommendations" id="recommendations">Recommendations</a>
</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> RTP Sender</h1>
<p id="rfc.section.4.1.p.1">An RTP Sender with RTCP turned off (i.e. by setting the RS and RR bandwidth modifiers defined in <a href="#RFC3556">[RFC3556]</a> to 0) SHOULD use a different SSRC for each different clock rate but MAY use different clock rates on the same SSRC as long as the RTP timestamp without the random offset is calculated as explained below: </p>
<p id="rfc.section.4.1.p.2">[[This was designed to help VoIP implementations who anyway never cared about RTCP.  Do we want to keep this?]] </p>
<p id="rfc.section.4.1.p.3">Each time the clock rate changes, the start_offset and capture_start values are calculated with the following formulas: </p>
<div id="#rfc.figure.1"></div>
<pre>
start_offset = (capture_time - capture_start) * previous_clock_rate
capture_start = capture_time
					</pre>
<p id="rfc.section.4.1.p.4">For the first RTP packet, the values are initialized with the following formulas: </p>
<div id="#rfc.figure.2"></div>
<pre>
start_offset = 0
capture_start = capture_time
					</pre>
<p id="rfc.section.4.1.p.5">After eventualy updating this values, the RTP timestamp is calculated with the following formula: </p>
<p id="rfc.section.4.1.p.6">timestamp = (capture_time - capture_start) * clock_rate + start_offset </p>
<p id="rfc.section.4.1.p.7">An RTP Sender with RTCP turned on MUST use a different SSRC for each different clock rate.  An RTCP BYE MUST be sent and a new SSRC MUST be used if the clock rate switches back to a value already seen in the RTP stream.  </p>
<p id="rfc.section.4.1.p.8">To accelerate lip synchronization, the next compound RTCP packet sent by the RTP sender MUST contain multiple SR packets, the first one containing the mapping for the current clock rate and the next SR packets containing the mapping for the other clock rates seen during the last period.  </p>
<p id="rfc.section.4.1.p.9">[[Some legacy implementations may dislike receiving multiple SR packets. What should we do?]] </p>
<p id="rfc.section.4.1.p.10">The RTP extension defined in <a href="#RFC6051">[RFC6051]</a> MAY be used to accelerate the synchronization.  </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> RTP Receiver</h1>
<p id="rfc.section.4.2.p.1">An RTP Receiver MUST calculate the jitter using the following formula: </p>
<p id="rfc.section.4.2.p.2">D(i,j) = (arrival_time_j * clock_rate_i - timestamp_j) - (arrival_time_i * clock_rate_i - timestamp_i) </p>
<p id="rfc.section.4.2.p.3">An RTP Receiver MUST be able to handle a compound RTCP packet with multiple SR packets.  </p>
<p id="rfc.section.4.2.p.4">For interoperability with legacy RTP implementations, an RTP receiver MAY use the information in two consecutive SR packets to calculate the clock rate used,  i.e. if Ni is the NTP timestamp for the SR packet i, Ri the RTP timestamp for the SR packet i and Nj and Rj the NTP timestamp and RTP timestamp for the previous SR packet j, then the clock rate can be guessed as the closest to (Ri - Rj) / (Ni - Nj).  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#analysis" id="analysis">Interoperability Analysis</a>
</h1>
<p id="rfc.section.5.p.1">The next subsections analyze the various combinations between legacy RTP implementations and RTP implementations that follow this document specifications.  </p>
<p id="rfc.section.5.p.2">TBD</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Security Considerations</h1>
<p id="rfc.section.6.p.1">TBD</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> IANA Considerations</h1>
<p id="rfc.section.7.p.1">No IANA considerations.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Acknowledgements</h1>
<p id="rfc.section.8.p.1">Thanks to Colin Perkins, Ali C. Begen and Magnus Westerlund for their comments, suggestions and questions that helped to improve this document.</p>
<p id="rfc.section.8.p.2">Thanks to Robert Sparks and the attendees of SIPit 26 for the survey on multiple clock rates interoperability.</p>
<p id="rfc.section.8.p.3">This document was written with the xml2rfc tool described in <a href="#RFC2629">[RFC2629]</a>.</p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3550">[RFC3550]</b></td>
<td class="top">
<a>Schulzrinne, H.</a>, <a>Casner, S.</a>, <a>Frederick, R.</a> and <a>V. Jacobson</a>, "<a href="http://tools.ietf.org/html/rfc3550">RTP: A Transport Protocol for Real-Time Applications</a>", STD 64, RFC 3550, July 2003.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2629">[RFC2629]</b></td>
<td class="top">
<a href="mailto:mrose@not.invisible.net" title="Invisible Worlds, Inc.">Rose, M.T.</a>, "<a href="http://tools.ietf.org/html/rfc2629">Writing I-Ds and RFCs using XML</a>", RFC 2629, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3551">[RFC3551]</b></td>
<td class="top">
<a>Schulzrinne, H.</a> and <a>S. Casner</a>, "<a href="http://tools.ietf.org/html/rfc3551">RTP Profile for Audio and Video Conferences with Minimal Control</a>", STD 65, RFC 3551, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3556">[RFC3556]</b></td>
<td class="top">
<a>Casner, S.</a>, "<a href="http://tools.ietf.org/html/rfc3556">Session Description Protocol (SDP) Bandwidth Modifiers for RTP Control Protocol (RTCP) Bandwidth</a>", RFC 3556, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3611">[RFC3611]</b></td>
<td class="top">
<a>Friedman, T.</a>, <a>Caceres, R.</a> and <a>A. Clark</a>, "<a href="http://tools.ietf.org/html/rfc3611">RTP Control Protocol Extended Reports (RTCP XR)</a>", RFC 3611, November 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5450">[RFC5450]</b></td>
<td class="top">
<a>Singer, D.</a> and <a>H. Desineni</a>, "<a href="http://tools.ietf.org/html/rfc5450">Transmission Time Offsets in RTP Streams</a>", RFC 5450, March 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5484">[RFC5484]</b></td>
<td class="top">
<a>Singer, D.</a>, "<a href="http://tools.ietf.org/html/rfc5484">Associating Time-Codes with RTP Streams</a>", RFC 5484, March 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5760">[RFC5760]</b></td>
<td class="top">
<a>Ott, J.</a>, <a>Chesterfield, J.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc5760">RTP Control Protocol (RTCP) Extensions for Single-Source Multicast Sessions with Unicast Feedback</a>", RFC 5760, February 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6051">[RFC6051]</b></td>
<td class="top">
<a>Perkins, C.</a> and <a>T. Schierl</a>, "<a href="http://tools.ietf.org/html/rfc6051">Rapid Synchronisation of RTP Flows</a>", RFC 6051, November 2010.</td>
</tr>
<tr>
<td class="reference"><b id="uRTR">[uRTR]</b></td>
<td class="top">
<a>Wenger, S</a> and <a>C Perkins</a>, "<a href="http://tools.ietf.org/html/draft-ietf-avt-variable-rate-audio-00">RTP Timestamp Frequency for Variable Rate Audio Codecs</a>", Internet-Draft draft-ietf-avt-variable-rate-audio-00, October 2004.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> Using a fixed clock rate</h1>
<p id="rfc.section.Appendix A.p.1">An alternate way of fixing the multiple clock rates issue was proposed in <a href="#uRTR">[uRTR]</a>.  This document proposed to define a unified clock rate, but the proposal was rejected at IETF 61.  </p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> Release notes</h1>
<p id="rfc.section.Appendix B.p.1">This section must be removed before publication as an RFC.</p>
<h1 id="rfc.appendix.Appendix B.1">
<a href="#rfc.appendix.Appendix%20B.1">Appendix B.1.</a> Modifications between draft-ietf-avtext-multiple-clock-rates-00 and draft-petithuguenin-avtext-multiple-clock-rates-01</h1>
<p></p>

<ul><li>Changed capture_state to capture_start.</li></ul>
<h1 id="rfc.appendix.Appendix B.2">
<a href="#rfc.appendix.Appendix%20B.2">Appendix B.2.</a> Modifications between draft-petithuguenin-avtext-multiple-clock-rates-01 and draft-petithuguenin-avtext-multiple-clock-rates-00</h1>
<p></p>

<ul>
<li>Clarified the goals for this documents</li>
<li>Removed the non-monotonic method (replaced by Magnus formula).</li>
<li>Moved the "RTP Sender and RTP Receiver section inside a new "Recommendations" section.</li>
<li>Inserted the new Sender formula inside the Recommendation section.</li>
<li>Inserted the new jitter formula in the RTP Receiver section.</li>
<li>Emptied the Analysis sections.</li>
</ul>
<h1 id="rfc.appendix.Appendix B.3">
<a href="#rfc.appendix.Appendix%20B.3">Appendix B.3.</a> Modifications between draft-petithuguenin-avtext-multiple-clock-rates-00 and draft-petithuguenin-avt-multiple-clock-rates-03</h1>
<p></p>

<ul><li>Initial release for avtext WG.</li></ul>
<h1 id="rfc.appendix.Appendix B.4">
<a href="#rfc.appendix.Appendix%20B.4">Appendix B.4.</a> Modifications between draft-petithuguenin-avt-multiple-clock-rates-03 and draft-petithuguenin-avt-multiple-clock-rates-02</h1>
<p></p>

<ul><li>Updated RFC reference.</li></ul>
<h1 id="rfc.appendix.Appendix B.5">
<a href="#rfc.appendix.Appendix%20B.5">Appendix B.5.</a> Modifications between draft-petithuguenin-avt-multiple-clock-rates-02 and draft-petithuguenin-avt-multiple-clock-rates-01</h1>
<p></p>

<ul>
<li>Having multiple SRs in a compound RTCP packet is OK.</li>
<li>If RTCP is used, must send a BYE and not reuse the SSRC.</li>
<li>Removed resolved notes.</li>
<li>Acknowledged SIPit 26 survey.</li>
<li>Fixed some nits.</li>
</ul>
<h1 id="rfc.appendix.Appendix B.6">
<a href="#rfc.appendix.Appendix%20B.6">Appendix B.6.</a> Modifications between draft-petithuguenin-avt-multiple-clock-rates-01 and draft-petithuguenin-avt-multiple-clock-rates-00</h1>
<p></p>

<ul><li>Complete rewrite as a Standard Track I-D modifying RFC 3550.</li></ul>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Marc Petit-Huguenin</span> 
	  <span class="n hidden">
		<span class="family-name">Petit-Huguenin</span>
	  </span>
	</span>
	<span class="org vcardline">Stonyfish, Inc.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:petithug@acm.org">petithug@acm.org</a></span>

  </address>
</div>

</body>
</html>