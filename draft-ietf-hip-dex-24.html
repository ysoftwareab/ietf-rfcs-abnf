<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>HIP Diet EXchange (DEX)</title>
<meta content="Robert Moskowitz" name="author">
<meta content="Rene Hummen" name="author">
<meta content="Miika Komu" name="author">
<meta content="
       
    This document specifies the Host Identity Protocol Diet EXchange 
    (HIP DEX), a variant of the Host Identity Protocol Version 2 
    (HIPv2) and specifically developed for use on low end 
    processors. The HIP DEX protocol design aims at reducing the 
    overhead of the employed cryptographic primitives by omitting 
    public-key signatures and cryptographic hash functions.
       
       
    The HIP DEX protocol is primarily designed for computation or 
    memory-constrained sensor/actuator devices. Like HIPv2, it is 
    expected to be used together with a suitable security protocol 
    such as the Encapsulated Security Payload (ESP) for the 
    protection of upper layer protocol data. Unlike HIPv2, HIP DEX 
    does not support Forward Secrecy (FS), and MUST only be used on 
    devices where FS is prohibitively expensive. In addition, HIP 
    DEX can also be used as a keying mechanism for security 
    primitives at the MAC layer, e.g., for IEEE 802.15.4 networks.
       
       
       
    " name="description">
<meta content="xml2rfc 3.5.0" name="generator">
<meta content="RFC" name="keyword">
<meta content="Request for Comments" name="keyword">
<meta content="I-D" name="keyword">
<meta content="Internet-Draft" name="keyword">
<meta content="HIP" name="keyword">
<meta content="draft-ietf-hip-dex-24" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.5.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.2.3
    google-i18n-address 2.4.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.2
    kitchen 1.2.6
    lxml 4.6.2
    pycountry 20.7.3
    pyflakes 2.2.0
    PyYAML 5.3.1
    requests 2.25.1
    setuptools 51.0.0
    six 1.15.0
-->
<link href="/tmp/draft-ietf-hip-dex-1jjeh02l.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">HIP Diet EXchange (DEX)</td>
<td class="right">January 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Moskowitz, et al.</td>
<td class="center">Expires 23 July 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">HIP WG</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-hip-dex-24</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-01-19" class="published">19 January 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-07-23">23 July 2021</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">R. Moskowitz, <span class="editor">Ed.</span>
</div>
<div class="org">HTT Consulting</div>
</div>
<div class="author">
      <div class="author-name">R. Hummen</div>
<div class="org">Hirschmann Automation and Control</div>
</div>
<div class="author">
      <div class="author-name">M. Komu</div>
<div class="org">Ericsson</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">HIP Diet EXchange (DEX)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">
    This document specifies the Host Identity Protocol Diet EXchange 
    (HIP DEX), a variant of the Host Identity Protocol Version 2 
    (HIPv2) and specifically developed for use on low end 
    processors. The HIP DEX protocol design aims at reducing the 
    overhead of the employed cryptographic primitives by omitting 
    public-key signatures and cryptographic hash functions.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">
    The HIP DEX protocol is primarily designed for computation or 
    memory-constrained sensor/actuator devices. Like HIPv2, it is 
    expected to be used together with a suitable security protocol 
    such as the Encapsulated Security Payload (ESP) for the 
    protection of upper layer protocol data. Unlike HIPv2, HIP DEX 
    does not support Forward Secrecy (FS), and MUST only be used on 
    devices where FS is prohibitively expensive. In addition, HIP 
    DEX can also be used as a keying mechanism for security 
    primitives at the MAC layer, e.g., for IEEE 802.15.4 networks.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
<p id="section-abstract-3"></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 23 July 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-the-hip-diet-exchange-dex" class="xref">The HIP Diet EXchange (DEX)</a><a href="#section-toc.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-applicability" class="xref">Applicability</a><a href="#section-toc.1-1.1.2.2.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.1.2.2.2.1">
                    <p id="section-toc.1-1.1.2.2.2.1.1" class="keepWithNext"><a href="#section-1.2.1" class="xref">1.2.1</a>.  <a href="#name-partial-computational-cost-" class="xref">Partial Computational Cost of FS via SIGMA</a><a href="#section-toc.1-1.1.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1"><a href="#section-1.3" class="xref">1.3</a>.  <a href="#name-memo-structure" class="xref">Memo Structure</a><a href="#section-toc.1-1.1.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-terms-notation-and-definiti" class="xref">Terms, Notation and Definitions</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-requirements-terminology" class="xref">Requirements Terminology</a><a href="#section-toc.1-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-notation" class="xref">Notation</a><a href="#section-toc.1-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-definitions" class="xref">Definitions</a><a href="#section-toc.1-1.2.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-host-identity-hi-and-its-st" class="xref">Host Identity (HI) and its Structure</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-host-identity-tag-hit" class="xref">Host Identity Tag (HIT)</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-generating-a-hit-from-an-hi" class="xref">Generating a HIT from an HI</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="xref">3.2.1</a>.  <a href="#name-why-introduce-fold" class="xref">Why Introduce FOLD</a><a href="#section-toc.1-1.3.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-protocol-overview" class="xref">Protocol Overview</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-creating-a-hip-association" class="xref">Creating a HIP Association</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-hip-puzzle-mechanism" class="xref">HIP Puzzle Mechanism</a><a href="#section-toc.1-1.4.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="xref">4.1.2</a>.  <a href="#name-hip-state-machine" class="xref">HIP State Machine</a><a href="#section-toc.1-1.4.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.4.2.1.2.3">
                    <p id="section-toc.1-1.4.2.1.2.3.1"><a href="#section-4.1.3" class="xref">4.1.3</a>.  <a href="#name-hip-dex-security-associatio" class="xref">HIP DEX Security Associations</a><a href="#section-toc.1-1.4.2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.4.2.1.2.4">
                    <p id="section-toc.1-1.4.2.1.2.4.1"><a href="#section-4.1.4" class="xref">4.1.4</a>.  <a href="#name-user-data-considerations" class="xref">User Data Considerations</a><a href="#section-toc.1-1.4.2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-packet-formats" class="xref">Packet Formats</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-payload-format" class="xref">Payload Format</a><a href="#section-toc.1-1.5.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-hip-parameters" class="xref">HIP Parameters</a><a href="#section-toc.1-1.5.2.2.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="xref">5.2.1</a>.  <a href="#name-dh_group_list" class="xref">DH_GROUP_LIST</a><a href="#section-toc.1-1.5.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.5.2.2.2.2">
                    <p id="section-toc.1-1.5.2.2.2.2.1"><a href="#section-5.2.2" class="xref">5.2.2</a>.  <a href="#name-hip_cipher" class="xref">HIP_CIPHER</a><a href="#section-toc.1-1.5.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.5.2.2.2.3">
                    <p id="section-toc.1-1.5.2.2.2.3.1"><a href="#section-5.2.3" class="xref">5.2.3</a>.  <a href="#name-host_id" class="xref">HOST_ID</a><a href="#section-toc.1-1.5.2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.5.2.2.2.4">
                    <p id="section-toc.1-1.5.2.2.2.4.1"><a href="#section-5.2.4" class="xref">5.2.4</a>.  <a href="#name-hit_suite_list" class="xref">HIT_SUITE_LIST</a><a href="#section-toc.1-1.5.2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.5.2.2.2.5">
                    <p id="section-toc.1-1.5.2.2.2.5.1"><a href="#section-5.2.5" class="xref">5.2.5</a>.  <a href="#name-encrypted_key" class="xref">ENCRYPTED_KEY</a><a href="#section-toc.1-1.5.2.2.2.5.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.5.2.2.2.6">
                    <p id="section-toc.1-1.5.2.2.2.6.1"><a href="#section-5.2.6" class="xref">5.2.6</a>.  <a href="#name-i_nonce" class="xref">I_NONCE</a><a href="#section-toc.1-1.5.2.2.2.6.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-hip-packets" class="xref">HIP Packets</a><a href="#section-toc.1-1.5.2.3.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.5.2.3.2.1">
                    <p id="section-toc.1-1.5.2.3.2.1.1"><a href="#section-5.3.1" class="xref">5.3.1</a>.  <a href="#name-i1-the-hip-initiator-packet" class="xref">I1 - the HIP Initiator Packet</a><a href="#section-toc.1-1.5.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.5.2.3.2.2">
                    <p id="section-toc.1-1.5.2.3.2.2.1"><a href="#section-5.3.2" class="xref">5.3.2</a>.  <a href="#name-r1-the-hip-responder-packet" class="xref">R1 - the HIP Responder Packet</a><a href="#section-toc.1-1.5.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.5.2.3.2.3">
                    <p id="section-toc.1-1.5.2.3.2.3.1"><a href="#section-5.3.3" class="xref">5.3.3</a>.  <a href="#name-i2-the-second-hip-initiator" class="xref">I2 - the Second HIP Initiator Packet</a><a href="#section-toc.1-1.5.2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact ulEmpty toc" id="section-toc.1-1.5.2.3.2.4">
                    <p id="section-toc.1-1.5.2.3.2.4.1"><a href="#section-5.3.4" class="xref">5.3.4</a>.  <a href="#name-r2-the-second-hip-responder" class="xref">R2 - the Second HIP Responder Packet</a><a href="#section-toc.1-1.5.2.3.2.4.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-icmp-messages" class="xref">ICMP Messages</a><a href="#section-toc.1-1.5.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-packet-processing" class="xref">Packet Processing</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-solving-the-puzzle" class="xref">Solving the Puzzle</a><a href="#section-toc.1-1.6.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-hip_mac-calculation-and-ver" class="xref">HIP_MAC Calculation and Verification</a><a href="#section-toc.1-1.6.2.2.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="xref">6.2.1</a>.  <a href="#name-cmac-calculation" class="xref">CMAC Calculation</a><a href="#section-toc.1-1.6.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-hip-dex-keymat-generation" class="xref">HIP DEX KEYMAT Generation</a><a href="#section-toc.1-1.6.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-initiation-of-a-hip-diet-ex" class="xref">Initiation of a HIP Diet EXchange</a><a href="#section-toc.1-1.6.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a href="#section-6.5" class="xref">6.5</a>.  <a href="#name-processing-incoming-i1-pack" class="xref">Processing Incoming I1 Packets</a><a href="#section-toc.1-1.6.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.6.2.6">
                <p id="section-toc.1-1.6.2.6.1"><a href="#section-6.6" class="xref">6.6</a>.  <a href="#name-processing-incoming-r1-pack" class="xref">Processing Incoming R1 Packets</a><a href="#section-toc.1-1.6.2.6.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.6.2.7">
                <p id="section-toc.1-1.6.2.7.1"><a href="#section-6.7" class="xref">6.7</a>.  <a href="#name-processing-incoming-i2-pack" class="xref">Processing Incoming I2 Packets</a><a href="#section-toc.1-1.6.2.7.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.6.2.8">
                <p id="section-toc.1-1.6.2.8.1"><a href="#section-6.8" class="xref">6.8</a>.  <a href="#name-processing-incoming-r2-pack" class="xref">Processing Incoming R2 Packets</a><a href="#section-toc.1-1.6.2.8.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.6.2.9">
                <p id="section-toc.1-1.6.2.9.1"><a href="#section-6.9" class="xref">6.9</a>.  <a href="#name-processing-incoming-notify-" class="xref">Processing Incoming NOTIFY Packets</a><a href="#section-toc.1-1.6.2.9.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.6.2.10">
                <p id="section-toc.1-1.6.2.10.1"><a href="#section-6.10" class="xref">6.10</a>. <a href="#name-processing-update-close-and" class="xref">Processing UPDATE, CLOSE, and CLOSE_ACK Packets</a><a href="#section-toc.1-1.6.2.10.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.6.2.11">
                <p id="section-toc.1-1.6.2.11.1"><a href="#section-6.11" class="xref">6.11</a>. <a href="#name-handling-state-loss" class="xref">Handling State Loss</a><a href="#section-toc.1-1.6.2.11.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-hip-policies" class="xref">HIP Policies</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-hit-hi-acl" class="xref">HIT/HI ACL</a><a href="#section-toc.1-1.7.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-interoperability-between-hi" class="xref">Interoperability between HIP DEX and HIPv2</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-caution-on-using-hip-dex-ra" class="xref">Caution on using HIP DEX rather than HIP BEX</a><a href="#section-toc.1-1.9.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-use-of-aes-ctr-for-hip-para" class="xref">Use of AES-CTR for HIP Parameter Encryption</a><a href="#section-toc.1-1.9.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="xref">9.3</a>.  <a href="#name-need-to-validate-public-key" class="xref">Need to Validate Public Keys</a><a href="#section-toc.1-1.9.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-acknowledgements" class="xref">Acknowledgements</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-changelog" class="xref">Changelog</a><a href="#section-toc.1-1.12.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="xref">12.1</a>.  <a href="#name-changes-in-draft-ietf-hip-d" class="xref">Changes in draft-ietf-hip-dex-24</a><a href="#section-toc.1-1.12.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="xref">12.2</a>.  <a href="#name-changes-in-draft-ietf-hip-de" class="xref">Changes in draft-ietf-hip-dex-23</a><a href="#section-toc.1-1.12.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a href="#section-12.3" class="xref">12.3</a>.  <a href="#name-changes-in-draft-ietf-hip-dex" class="xref">Changes in draft-ietf-hip-dex-22</a><a href="#section-toc.1-1.12.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.4">
                <p id="section-toc.1-1.12.2.4.1"><a href="#section-12.4" class="xref">12.4</a>.  <a href="#name-changes-in-draft-ietf-hip-dex-" class="xref">Changes in draft-ietf-hip-dex-21</a><a href="#section-toc.1-1.12.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.5">
                <p id="section-toc.1-1.12.2.5.1"><a href="#section-12.5" class="xref">12.5</a>.  <a href="#name-changes-in-draft-ietf-hip-dex-2" class="xref">Changes in draft-ietf-hip-dex-20</a><a href="#section-toc.1-1.12.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.6">
                <p id="section-toc.1-1.12.2.6.1"><a href="#section-12.6" class="xref">12.6</a>.  <a href="#name-changes-in-draft-ietf-hip-dex-1" class="xref">Changes in draft-ietf-hip-dex-19</a><a href="#section-toc.1-1.12.2.6.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.7">
                <p id="section-toc.1-1.12.2.7.1"><a href="#section-12.7" class="xref">12.7</a>.  <a href="#name-changes-in-draft-ietf-hip-dex-18" class="xref">Changes in draft-ietf-hip-dex-18</a><a href="#section-toc.1-1.12.2.7.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.8">
                <p id="section-toc.1-1.12.2.8.1"><a href="#section-12.8" class="xref">12.8</a>.  <a href="#name-changes-in-draft-ietf-hip-dex-17" class="xref">Changes in draft-ietf-hip-dex-17</a><a href="#section-toc.1-1.12.2.8.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.9">
                <p id="section-toc.1-1.12.2.9.1"><a href="#section-12.9" class="xref">12.9</a>.  <a href="#name-changes-in-draft-ietf-hip-dex-16" class="xref">Changes in draft-ietf-hip-dex-16</a><a href="#section-toc.1-1.12.2.9.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.10">
                <p id="section-toc.1-1.12.2.10.1"><a href="#section-12.10" class="xref">12.10</a>. <a href="#name-changes-in-draft-ietf-hip-dex-15" class="xref">Changes in draft-ietf-hip-dex-15</a><a href="#section-toc.1-1.12.2.10.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.11">
                <p id="section-toc.1-1.12.2.11.1"><a href="#section-12.11" class="xref">12.11</a>. <a href="#name-changes-in-draft-ietf-hip-dex-14" class="xref">Changes in draft-ietf-hip-dex-14</a><a href="#section-toc.1-1.12.2.11.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.12">
                <p id="section-toc.1-1.12.2.12.1"><a href="#section-12.12" class="xref">12.12</a>. <a href="#name-changes-in-draft-ietf-hip-dex-12" class="xref">Changes in draft-ietf-hip-dex-12 and 13</a><a href="#section-toc.1-1.12.2.12.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.13">
                <p id="section-toc.1-1.12.2.13.1"><a href="#section-12.13" class="xref">12.13</a>. <a href="#name-changes-in-draft-ietf-hip-dex-11" class="xref">Changes in draft-ietf-hip-dex-11 and 12</a><a href="#section-toc.1-1.12.2.13.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.14">
                <p id="section-toc.1-1.12.2.14.1"><a href="#section-12.14" class="xref">12.14</a>. <a href="#name-changes-in-draft-ietf-hip-dex-11-2" class="xref">Changes in draft-ietf-hip-dex-11</a><a href="#section-toc.1-1.12.2.14.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.15">
                <p id="section-toc.1-1.12.2.15.1"><a href="#section-12.15" class="xref">12.15</a>. <a href="#name-changes-in-draft-ietf-hip-dex-10" class="xref">Changes in draft-ietf-hip-dex-10</a><a href="#section-toc.1-1.12.2.15.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.16">
                <p id="section-toc.1-1.12.2.16.1"><a href="#section-12.16" class="xref">12.16</a>. <a href="#name-changes-in-draft-ietf-hip-dex-0" class="xref">Changes in draft-ietf-hip-dex-09</a><a href="#section-toc.1-1.12.2.16.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.17">
                <p id="section-toc.1-1.12.2.17.1"><a href="#section-12.17" class="xref">12.17</a>. <a href="#name-changes-in-draft-ietf-hip-dex-05" class="xref">Changes in draft-ietf-hip-dex-05</a><a href="#section-toc.1-1.12.2.17.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.18">
                <p id="section-toc.1-1.12.2.18.1"><a href="#section-12.18" class="xref">12.18</a>. <a href="#name-changes-in-draft-ietf-hip-dex-04" class="xref">Changes in draft-ietf-hip-dex-04</a><a href="#section-toc.1-1.12.2.18.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.19">
                <p id="section-toc.1-1.12.2.19.1"><a href="#section-12.19" class="xref">12.19</a>. <a href="#name-changes-in-draft-ietf-hip-dex-03" class="xref">Changes in draft-ietf-hip-dex-03</a><a href="#section-toc.1-1.12.2.19.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.20">
                <p id="section-toc.1-1.12.2.20.1"><a href="#section-12.20" class="xref">12.20</a>. <a href="#name-changes-in-draft-ietf-hip-dex-02" class="xref">Changes in draft-ietf-hip-dex-02</a><a href="#section-toc.1-1.12.2.20.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.21">
                <p id="section-toc.1-1.12.2.21.1"><a href="#section-12.21" class="xref">12.21</a>. <a href="#name-changes-in-draft-ietf-hip-dex-01" class="xref">Changes in draft-ietf-hip-dex-01</a><a href="#section-toc.1-1.12.2.21.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.22">
                <p id="section-toc.1-1.12.2.22.1"><a href="#section-12.22" class="xref">12.22</a>. <a href="#name-changes-in-draft-ietf-hip-dex-00" class="xref">Changes in draft-ietf-hip-dex-00</a><a href="#section-toc.1-1.12.2.22.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.23">
                <p id="section-toc.1-1.12.2.23.1"><a href="#section-12.23" class="xref">12.23</a>. <a href="#name-changes-in-draft-moskowitz-" class="xref">Changes in draft-moskowitz-hip-rg-dex-06</a><a href="#section-toc.1-1.12.2.23.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.24">
                <p id="section-toc.1-1.12.2.24.1"><a href="#section-12.24" class="xref">12.24</a>. <a href="#name-changes-in-draft-moskowitz-h" class="xref">Changes in draft-moskowitz-hip-dex-00</a><a href="#section-toc.1-1.12.2.24.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.25">
                <p id="section-toc.1-1.12.2.25.1"><a href="#section-12.25" class="xref">12.25</a>. <a href="#name-changes-in-draft-moskowitz-hi" class="xref">Changes in draft-moskowitz-hip-dex-01</a><a href="#section-toc.1-1.12.2.25.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.26">
                <p id="section-toc.1-1.12.2.26.1"><a href="#section-12.26" class="xref">12.26</a>. <a href="#name-changes-in-draft-moskowitz-hip" class="xref">Changes in draft-moskowitz-hip-dex-02</a><a href="#section-toc.1-1.12.2.26.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.27">
                <p id="section-toc.1-1.12.2.27.1"><a href="#section-12.27" class="xref">12.27</a>. <a href="#name-changes-in-draft-moskowitz-hip-" class="xref">Changes in draft-moskowitz-hip-dex-03</a><a href="#section-toc.1-1.12.2.27.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.12.2.28">
                <p id="section-toc.1-1.12.2.28.1"><a href="#section-12.28" class="xref">12.28</a>. <a href="#name-changes-in-draft-moskowitz-hip-d" class="xref">Changes in draft-moskowitz-hip-dex-04</a><a href="#section-toc.1-1.12.2.28.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="xref">13</a>. <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.13.1" class="pilcrow">¶</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="xref">13.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.13.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-13.2" class="xref">13.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.13.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-calculating-collision-proba" class="xref">Calculating Collision Probabilities</a><a href="#section-toc.1-1.14.1" class="pilcrow">¶</a></p>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-appendix.b" class="xref">Appendix B</a>.  <a href="#name-password-based-two-factor-a" class="xref">Password-based two-factor authentication during the HIP DEX handshake</a><a href="#section-toc.1-1.15.1" class="pilcrow">¶</a></p>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#section-appendix.c" class="xref">Appendix C</a>.  <a href="#name-iesg-considerations" class="xref">IESG Considerations</a><a href="#section-toc.1-1.16.1" class="pilcrow">¶</a></p>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#section-appendix.d" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.17.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">
    This document specifies the Host Identity Protocol Diet EXchange 
    (HIP DEX), specifically developed for use on low end processors 
    that cannot support the cryptographic requirements of HIP Base 
    EXchange (HIP BEX).  HIP DEX is derived from HIP BEX, which is 
    defined in the Host Identity Protocol Version 2 (HIPv2) <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>.  HIP DEX preserves the 
    protocol semantics as well as the general packet structure of 
    HIPv2.  Hence, it is recommended that <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> is well-understood before reading this 
    document.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">
       The main differences between HIP BEX and HIP DEX are:<a href="#section-1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-1-3">
<li id="section-1-3.1">
          <p id="section-1-3.1.1">
             HIP DEX uses a different set of cryptographic primitives compared
             to HIP BEX with the goal to reduce the protocol overhead:<a href="#section-1-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-3.1.2.1">Peer authentication and key agreement in HIP DEX are based on
                   static Elliptic Curve Diffie-Hellman (ECDH) key pairs. This
                   replaces the use of public-key signatures and ephemeral
                   Diffie-Hellman key pairs in HIPv2.<a href="#section-1-3.1.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-1-3.1.2.2">HIP DEX uses AES-CTR for symmetric-key encryption 
 of HIP payloads and AES-CMAC as its MACing 
 function. In contrast, HIPv2 currently supports 
 AES-CBC for encryption and HMAC-SHA-1, 
 HMAC-SHA-256, or HMAC-SHA-384 for MACing.<a href="#section-1-3.1.2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-1-3.1.2.3">HIP DEX defines a simple fold function to efficiently
                   generate HITs, whereas the HIT generation of HIPv2 is based
                   on SHA-1, SHA-256, or SHA-384.<a href="#section-1-3.1.2.3" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li id="section-1-3.2">
  HIP DEX forfeits the HIPv2 Forward Secrecy property due to 
  the removal of the ephemeral Diffie-Hellman key agreement. 
  As this weakens the security properties of HIP DEX, it 
  MUST be used only with constrained devices where this is 
  prohibitively expensive as further explained in <a href="#applicability" class="xref">Section 1.2</a>.<a href="#section-1-3.2" class="pilcrow">¶</a>
</li>
        <li id="section-1-3.3">
  HIP DEX forfeits the use of digital signatures with the 
  removal of a hash function. Peer authentication with HIP 
  DEX, therefore, is based on the use of the ECDH derived 
  key in the CMAC-based HIP_MAC parameter.<a href="#section-1-3.3" class="pilcrow">¶</a>
</li>
        <li id="section-1-3.4">
  The forfeiture of the use of digital signatures leaves the 
  R1 packet open to a MITM attack.  Such an attack is 
  managed in the R2 packet validation and is yet another DOS 
  attack mitigated through the HIP state machine.  This 
  state machine mitigation is augmented by HIT,HI ACL 
  controls, <a href="#hit-acl" class="xref">Section 7.1</a>.<a href="#section-1-3.4" class="pilcrow">¶</a>
</li>
        <li id="section-1-3.5">
  The forfeiture of a cryptographic hash leaves the HIT 
  generated by a fold function vulnerable to pre-image 
  attacks.  This MUST be mitigated through a HIT,HI pairing 
  as in an ACL control mechanism <a href="#hit-acl" class="xref">Section 7.1</a>.<a href="#section-1-3.5" class="pilcrow">¶</a>
</li>
        <li id="section-1-3.6">
             With HIP DEX, the ECDH derived key is only used to protect HIP
             packets. Separate session key(s) are used to protect the
             transmission of upper layer protocol data. These session key(s) are
             established via a new secret exchange during the handshake.<a href="#section-1-3.6" class="pilcrow">¶</a>
</li>
        <li id="section-1-3.7">
             HIP DEX introduces a new, optional retransmission strategy that is
             specifically designed to handle potentially extensive processing
             times of the employed cryptographic operations on computationally
             constrained devices.<a href="#section-1-3.7" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-1-4">
    By eliminating the need for public-key signatures and the 
    ephemeral DH key agreement, HIP DEX reduces the computational, 
    energy, transmission, and memory requirements for public-key 
    cryptography (see <span>[<a href="#DOI_10.1109_IPSN.2008.47" class="xref">LN08</a>]</span>) in the HIPv2 protocol design. This makes HIP 
    DEX especially suitable for constrained devices as defined in 
    <span>[<a href="#RFC7228" class="xref">RFC7228</a>]</span>.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">
    Cryptographic hashing was eliminated due to the memory/code 
    space or gate cost for a hash.  This is based on actual 
    implementation efforts on 8-bit CPU sensors with 16KB memory and 
    64KB flash for code.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">
    This document focuses on the protocol specifications related to 
    differences between HIP BEX and HIP DEX. Where differences are 
    not called out explicitly, the protocol specification of HIP DEX 
    is the same as defined in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>.<a href="#section-1-6" class="pilcrow">¶</a></p>
<div id="dex">
<section id="section-1.1">
        <h3 id="name-the-hip-diet-exchange-dex">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-the-hip-diet-exchange-dex" class="section-name selfRef">The HIP Diet EXchange (DEX)</a>
        </h3>
<p id="section-1.1-1">
  The HIP Diet EXchange is a two-party cryptographic protocol 
  used to establish a secure communication context between 
  hosts. The first party is called the Initiator and the second 
  party the Responder. The four-packet exchange helps to make 
  HIP DEX Denial of Service (DoS) resilient. The Initiator and 
  the Responder exchange their static Elliptic Curve 
  Diffie-Hellman (ECDH) keys in the R1 and I2 handshake packet. 
  The parties then authenticate each other in the I2 and R2 
  handshake packets based on the ECDH-derived keying material. 
  The Initiator and the Responder additionally transmit keying 
  material for the session key in these last two handshake 
  packets (I2 and R2). This is to prevent overuse of the static 
  ECDH-derived keying material. Moreover, the Responder starts a 
  puzzle exchange in the R1 packet and the Initiator completes 
  this exchange in the I2 packet before the Responder performs 
  computationally expensive operations or stores any state from 
  the exchange. Given this handshake structure, HIP DEX 
  operationally is very similar to HIP BEX. Moreover, the 
  employed model is also fairly equivalent to 802.11-2016 <span>[<a href="#DOI_10.1109_IEEESTD.2016.7786995" class="xref">IEEE.802-11.2016</a>]</span> 
  Master Key and Pair-wise Transient Key, but handled in a 
  single exchange.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">
         HIP DEX does not have the option to encrypt the Host Identity
         of the Initiator in the I2 packet. The Responder's Host
         Identity also is not protected. Thus, contrary to HIPv2, HIP
         DEX does not provide for end-point anonymity and any
         signaling (i.e., HOST_ID parameter contained with an
         ENCRYPTED parameter) that indicates such anonymity should be
         ignored.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">
  As in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>, data packets 
  start to flow after the R2 packet. The I2 and R2 packets may 
  carry a data payload in the future. The details of this may be 
  defined later.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4">
  An existing HIP association can be updated with the update 
  mechanism defined in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>. Likewise, the association can be torn down 
  with the defined closing mechanism for HIPv2 if it is no 
  longer needed. Standard HIPv2 uses a HIP_SIGNATURE to 
  authenticate the association close operation, but since DEX 
  does not provide for signatures, the usual per-message MAC 
  suffices.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5">
  Finally, HIP DEX is designed as an end-to-end authentication 
  and key establishment protocol. As such, it can be used in 
  combination with Encapsulated Security Payload (ESP) <span>[<a href="#RFC7402" class="xref">RFC7402</a>]</span> as well as with other 
  end-to-end security protocols. In addition, HIP DEX can also 
  be used as a keying mechanism for security primitives at the 
  MAC layer, e.g., for IEEE 802.15.4 networks <span>[<a href="#IEEE.802-15-4.2015" class="xref">IEEE.802-15-4.2015</a>]</span>. It is worth 
  mentioning that the HIP DEX base protocol does not cover all 
  the fine-grained policy control found in Internet Key Exchange 
  Version 2 (IKEv2) <span>[<a href="#RFC7296" class="xref">RFC7296</a>]</span> 
  that allows IKEv2 to support complex gateway policies. Thus, 
  HIP DEX is not a replacement for IKEv2.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="applicability">
<section id="section-1.2">
        <h3 id="name-applicability">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-applicability" class="section-name selfRef">Applicability</a>
        </h3>
<p id="section-1.2-1">
 HIP DEX achieves its lightweight nature in large part due to the 
 intentional removal of Forward Secrecy (FS) from the key exchange.  
 Current mechanisms to achieve FS use an authenticated ephemeral 
 Diffie-Hellman exchange (e.g., SIGn-and-MAc Approach, SIGMA or 
 Password-Authenticated Key Agreement, PAKE).  HIP DEX targets usage 
 on devices where even the most lightweight ECDH exchange is 
 prohibitively expensive for recurring (ephemeral) use.  For 
 example, experience with the 8-bit 8051-based ZWAVE ZW0500 
 microprocessor has shown that EC25519 keypair generation exceeds 10 
 seconds and consumes significant energy (i.e., battery resources). 
 Even the ECDH multiplication for the HIP DEX static-static key 
 exchange takes 8-9 seconds, again with measurable energy 
 consumption.  The ECDH multiplication resource consumption via a 
 static EC25519 keypair is tolerable as a one-time event during 
 provisioning, but would render the protocol unsuitable for use on 
 these devices if it was required to be a recurring part of the 
 protocol.  Further, for devices constrained in this manner, a 
 FS-enabled protocol's cost will likely provide little gain.  Since 
 the resulting "FS" key, likely produced during device deployment, 
 would typically end up being used for the remainder of the device's 
 lifetime.  Since this key (or the information needed to regenerate 
 it) persists for the device's lifetime, the key step of 'throw away 
 old keys' in achieving forward secrecy does not occur, thus the 
 forward secrecy would not be obtained in practice.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">
 With such a usage pattern, the inherent benefit of ephemeral keys 
 is not realized.  The security properties of such usage are very 
 similar to those of using a statically provisioned symmetric 
 pre-shared key, in that there remains a single PSK in static 
 storage that is susceptible to exfiltration/compromise, and 
 compromise of that key in effect compromises the entire protocol 
 for that node.  HIP DEX achieves marginally better security 
 properties by computing the effective long-term PSK from a DH 
 exchange, so that the provisioning service is not required to be 
 part of the risk surface due to also possessing the PSK.<a href="#section-1.2-2" class="pilcrow">¶</a></p>
<p id="section-1.2-3">
 If the device is not able to generate the ECDH keypair, the 
 provisioning service can generate and install the ECDH keypair 
 provided it wipes knowledge of the private key.  Typically, the 
 provisioning service will make the public key (HI) and PSK 
 available for the deployment step.<a href="#section-1.2-3" class="pilcrow">¶</a></p>
<p id="section-1.2-4">
 Due to the substantially reduced security guarantees of HIP DEX 
 compared to HIP BEX, HIP DEX MUST only be used when at least one of 
 the two endpoints is a class 0 or 1 constrained device defined in 
 Section 3 of <span>[<a href="#RFC7228" class="xref">RFC7228</a>]</span>).  HIP DEX 
 MUST NOT be used when both endpoints are class 2 devices or 
 unconstrained.<a href="#section-1.2-4" class="pilcrow">¶</a></p>
<p id="section-1.2-5">
 It is inevitable that both HIP BEX and DEX will be available on 
 some systems, most noticeably sensor gateways.  HIP DEX MUST NOT be 
 used between systems capable of HIP BEX.  This may be controlled by 
 limiting the use of DEX to an "internal" interface, or for such 
 systems to first offer a BEX HIT in an I1 and only if that fails to 
 try a DEX HIT.  Note that such a downgrade (from BEX to DEX) offer 
 approach is open to attack, requiring additional mitigation (e.g. 
 ACL controls).<a href="#section-1.2-5" class="pilcrow">¶</a></p>
<div id="SIGMA_Cost">
<section id="section-1.2.1">
          <h4 id="name-partial-computational-cost-">
<a href="#section-1.2.1" class="section-number selfRef">1.2.1. </a><a href="#name-partial-computational-cost-" class="section-name selfRef">Partial Computational Cost of FS via SIGMA</a>
          </h4>
<p id="section-1.2.1-1">
 From the Initator's process, FS via SIGMA <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span> in HIP BEX comes at a prohibitive cost for 
 constrained, 8-bit devices.  In BEX, the Initator has:<a href="#section-1.2.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="a" class="normal type-a" id="section-1.2.1-2">
 <li id="section-1.2.1-2.1">
              <p id="section-1.2.1-2.1.1">Public key operations<a href="#section-1.2.1-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-1.2.1-2.1.2.1">
 2 Public Key signing verifications,<a href="#section-1.2.1-2.1.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal ulEmpty" id="section-1.2.1-2.1.2.2">
 1 Public Key signing,<a href="#section-1.2.1-2.1.2.2" class="pilcrow">¶</a>
</li>
              </ul>
</li>
          </ol>
<ol start="2" type="a" class="normal type-a" id="section-1.2.1-3">
 <li id="section-1.2.1-3.1">
              <p id="section-1.2.1-3.1.1">Key generation<a href="#section-1.2.1-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-1.2.1-3.1.2.1">
 1 Diffie-Hellman ephemeral keypair generation, and<a href="#section-1.2.1-3.1.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal ulEmpty" id="section-1.2.1-3.1.2.2">
 1 Diffie-Hellman shared secret generation.<a href="#section-1.2.1-3.1.2.2" class="pilcrow">¶</a>
</li>
              </ul>
</li>
          </ol>
<p id="section-1.2.1-4">
 Whereas HIP DEX only has the Diffie-Hellman shared secret 
 generation cost.<a href="#section-1.2.1-4" class="pilcrow">¶</a></p>
<p id="section-1.2.1-5">
 Papers like <span>[<a href="#DOI_10.1007_978-3-319-24126-5_17" class="xref">EfficientECC</a>]</span> show on the ATmega328P <span>[<a href="#ATmega328P" class="xref">ATmega328P</a>]</span> an EdDSA25519 signature generation of 19M cycles 
 and verification of 31M cycles.  Thus the SIGMA Public Key 
 operations come at a cost of 81M cycles. Actual wallclock time and 
 energy consumption are not provided in this paper, nor is the 
 Curve25519 keypair generation time.<a href="#section-1.2.1-5" class="pilcrow">¶</a></p>
<p id="section-1.2.1-6">
 This is just the cost of the Public Key operations, excluding 
 additional BEX over DEX processing.  The added cost of HIP BEX 
 (over HIP DEX) has been a blocking factor to adoption of SIGMA based 
 key establishment on 8-bit processors with limited power.<a href="#section-1.2.1-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-1.3">
        <h3 id="name-memo-structure">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-memo-structure" class="section-name selfRef">Memo Structure</a>
        </h3>
<p id="section-1.3-1">
  The rest of this memo is structured as follows. <a href="#terms" class="xref">Section 2</a> defines the central 
  keywords, notation, and terms used throughout this document. 
  <a href="#HI" class="xref">Section 3</a> defines the structure of 
  the Host Identity and its various representations. <a href="#proto_overview" class="xref">Section 4</a> gives an overview 
  of the HIP Diet EXchange protocol. Sections <a href="#sec-param-tlv" class="xref">5</a> and <a href="#packet_processing" class="xref">6</a> define the 
  detailed packet formats and rules for packet processing. 
  Finally, Sections <a href="#sec-policy" class="xref">7</a>, <a href="#dex-bex-interop" class="xref">8</a>, <a href="#sec-considerations" class="xref">9</a>, and <a href="#iana" class="xref">10</a> 
  discuss policy, interoperability between HIPv2 vs DEX, 
  security, and IANA considerations, respectively. Appendix 
  <a href="#twofactor" class="xref">B</a> defines a two 
  factor authentication scheme and Appendix <a href="#IESG" class="xref">C</a> highlights some discussions with the IESG.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="terms">
<section id="section-2">
      <h2 id="name-terms-notation-and-definiti">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terms-notation-and-definiti" class="section-name selfRef">Terms, Notation and Definitions</a>
      </h2>
<section id="section-2.1">
        <h3 id="name-requirements-terminology">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-requirements-terminology" class="section-name selfRef">Requirements Terminology</a>
        </h3>
<p id="section-2.1-1">
 The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL 
 NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", 
 "MAY", and "OPTIONAL" in this document are to be interpreted as 
 described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span>
          <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, 
 they appear in all capitals, as shown here.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
</section>
<div id="notation">
<section id="section-2.2">
        <h3 id="name-notation">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-notation" class="section-name selfRef">Notation</a>
        </h3>
<span class="break"></span><dl class="dlParallel" id="section-2.2-1">
          <dt id="section-2.2-1.1">[x] </dt>
          <dd style="margin-left: 1.5em" id="section-2.2-1.2">
             indicates that x is optional.<a href="#section-2.2-1.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-1.3">{x} </dt>
          <dd style="margin-left: 1.5em" id="section-2.2-1.4">
             indicates that x is encrypted.<a href="#section-2.2-1.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-1.5">X(y) </dt>
          <dd style="margin-left: 1.5em" id="section-2.2-1.6">
             indicates that y is a parameter of X.<a href="#section-2.2-1.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-1.7">&lt;x&gt;i </dt>
          <dd style="margin-left: 1.5em" id="section-2.2-1.8">
             indicates that x exists i times.<a href="#section-2.2-1.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-1.9">--&gt; </dt>
          <dd style="margin-left: 1.5em" id="section-2.2-1.10">
             signifies "Initiator to Responder" communication (requests).<a href="#section-2.2-1.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-1.11">&lt;-- </dt>
          <dd style="margin-left: 1.5em" id="section-2.2-1.12">
             signifies "Responder to Initiator" communication (replies).<a href="#section-2.2-1.12" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-1.13">| </dt>
          <dd style="margin-left: 1.5em" id="section-2.2-1.14">
             signifies concatenation of information - e.g., X | Y is the
             concatenation of X and Y.<a href="#section-2.2-1.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-1.15">FOLD (X, K) </dt>
          <dd style="margin-left: 1.5em" id="section-2.2-1.16">
             denotes the partitioning of X into n K-bit segments and the
             iterative folding of these segments via XOR. I.e., X = x_1, x_2,
             ..., x_n, where x_i is of length K and the last segment x_n is
             padded to length K by appending 0 bits. FOLD then is computed as
             FOLD(X, K) = t_n, where t_i = t_i-1 XOR x_i and t_1 = x_1.<a href="#section-2.2-1.16" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-1.17">Ltrunc (M(x), K) </dt>
          <dd style="margin-left: 1.5em" id="section-2.2-1.18">
             denotes the lowest order K bits of the result of the MAC function M
             on the input x.<a href="#section-2.2-1.18" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-1.19">sort (HIT-I | HIT-R) </dt>
          <dd style="margin-left: 1.5em" id="section-2.2-1.20">
             is defined as the network byte order
             concatenation of the two HITs, with the smaller HIT preceding the
             larger HIT, resulting from the numeric comparison of the two HITs
             interpreted as positive (unsigned) 128-bit integers in network byte
             order.<a href="#section-2.2-1.20" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<section id="section-2.3">
        <h3 id="name-definitions">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-definitions" class="section-name selfRef">Definitions</a>
        </h3>
<span class="break"></span><dl class="dlParallel" id="section-2.3-1">
          <dt id="section-2.3-1.1">CKDF:</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.2">
             CMAC-based Key Derivation Function.<a href="#section-2.3-1.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.3">CMAC:</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.4">
  The Cipher-based Message Authentication Code with the 
  128-bit Advanced Encryption Standard (AES) defined in 
  <span>[<a href="#DOI_10.6028_NIST.SP.800-38B" class="xref">NIST.SP.800-38B</a>]</span>.<a href="#section-2.3-1.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.5">HIP association:</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.6">
             The shared state between two peers after completion of the HIP
             handshake.<a href="#section-2.3-1.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.7">HIP DEX (Diet EXchange):</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.8">
             The ECDH-based HIP handshake for establishing a new HIP
             association.<a href="#section-2.3-1.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.9">HIT Suite:</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.10">
  A HIT Suite groups all algorithms that are required to 
  generate and use an HI and its HIT. In particular for HIP 
  DEX, these algorithms are: 1) ECDH and 2) FOLD.<a href="#section-2.3-1.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.11">HI (Host Identity):</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.12">
  The static ECDH public key that represents the identity of 
  the host. In HIP DEX, a host proves ownership of the 
  private key belonging to its HI by creating a HIP_MAC with 
  the derived ECDH key (see <a href="#HI" class="xref">Section 3</a>) in the appropriate I2 or R2 packet.<a href="#section-2.3-1.12" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.13">HIT (Host Identity Tag):</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.14">
  A shorthand for the HI in IPv6 format. It is generated by 
  folding the HI (see <a href="#HI" class="xref">Section 3</a>).<a href="#section-2.3-1.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.15">Initiator:</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.16">
             The host that initiates the HIP DEX handshake. This role is
             typically forgotten once the handshake is completed.<a href="#section-2.3-1.16" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.17">KEYMAT:</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.18">
  Keying material.  That is, the bit string(s) used as 
  cryptographic keys.<a href="#section-2.3-1.18" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.19">RHASH_len:</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.20">
             The natural output length of the RHASH Algorithm in bits.<a href="#section-2.3-1.20" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.21">Nonce #I:</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.22">
  Nonce #I refers to the corresponding field in the PUZZLE 
  parameter (see section 5.2.4 in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>. It is also referred to as "random 
  value #I" in this document.<a href="#section-2.3-1.22" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.23">OGA (Orchid Generation Algorithm):</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.24">
             Hash function used in generating the ORCHID.<a href="#section-2.3-1.24" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.25">ORCHID (Overlay Routable Cryptographic Hash Identifiers):</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.26">
  IPv6 addresses intended to be used as endpoint identifiers 
  at applications and Application Programming Interfaces 
  (APIs) and not as identifiers for network location at the 
  IP layer.<a href="#section-2.3-1.26" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.27">Puzzle difficulty K:</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.28">
  The Initiator has to compute a solution for the puzzle. 
  The level of computational difficulty is denoted by the #K 
  field in the puzzle parameter (see section 5.2.4 in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>.<a href="#section-2.3-1.28" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.29">Responder:</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.30">
            The host that responds to the Initiator in the HIP DEX handshake.
            This role is typically forgotten once the handshake is completed.<a href="#section-2.3-1.30" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.31">RHASH (Responder's HIT Hash Algorithm):</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.32">
             In HIP DEX, RHASH is redefined as CMAC. Still, note that CMAC is a
             message authentication code (MAC) and not a cryptographic hash
             function. Thus, a mapping from CMAC(x,y) to RHASH(z) must be
             defined where RHASH is used. Moreover, RHASH has different security
             properties in HIP DEX and is not used for HIT generation.<a href="#section-2.3-1.32" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-1.33">Security Association (SA):</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-1.34">
  An SA is a simplex "connection" that affords security 
  services to the traffic carried by it.  HIP DEX has two 
  forms of SAs, a Master Key SA for the actual HIP traffic, 
  and a Pair-wise Key SA for use by a data transport service.<a href="#section-2.3-1.34" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</section>
</div>
<div id="HI">
<section id="section-3">
      <h2 id="name-host-identity-hi-and-its-st">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-host-identity-hi-and-its-st" class="section-name selfRef">Host Identity (HI) and its Structure</a>
      </h2>
<p id="section-3-1">
    In this section, the properties of the Host Identity and Host 
    Identity Tag are discussed, and the exact format for them is 
    defined. In HIP, the public key of an asymmetric key pair is 
    used as the Host Identity (HI). Correspondingly, the host itself 
    is defined as the entity that holds the private key of the key 
    pair. See the HIP architecture specification <span>[<a href="#I-D.ietf-hip-rfc4423-bis" class="xref">hip-rfc4423-bis</a>]</span> for more 
    details on the difference between an identity and the 
    corresponding identifier.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">
    HIP DEX implementations use Elliptic Curve Diffie-Hellman (ECDH) 
    <span>[<a href="#RFC6090" class="xref">RFC6090</a>]</span> key exchange for 
    generating the HI as defined in <a href="#host_id" class="xref">Section 5.2.3</a>. No alternative algorithms are defined at 
    this time.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">
       A compressed encoding of the HI, the Host Identity Tag (HIT), is used in
       the handshake packets to represent the HI. The DEX Host Identity Tag
       (HIT) is different from the BEX HIT in two ways:<a href="#section-3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-4.1">
  The HIT suite ID MUST only be a DEX HIT ID (see <a href="#hit_suite_list" class="xref">Section 5.2.4</a>).<a href="#section-3-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-4.2">
             The DEX HIT is not generated via a cryptographic hash. Rather,
             it is a compression of the HI.<a href="#section-3-4.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-3-5">
       Due to the latter property, an attacker may be able to find a collision
       with a HIT that is in use. Hence, policy decisions such as access
    control MUST NOT use an unverified HIT as input. The full HI of 
    a host SHOULD be considered, and the HIT MAY be used as a hint 
    for locating the full HI (see <a href="#hit-acl" class="xref">Section 7.1</a>).<a href="#section-3-5" class="pilcrow">¶</a></p>
<p id="section-3-6">
       Carrying HIs or HITs in the header of user data packets would
       increase the overhead of packets. Thus, it is not expected that
       these parameters are carried in every packet, but other methods
       are used to map the data packets to the corresponding HIs. In
       some cases, this allows use of HIP DEX without any additional
       headers in the user data packets. For example, if ESP is used
       to protect data traffic, the Security Parameter Index (SPI)
       carried in the ESP header can be used to map the encrypted data
       packet to the correct HIP DEX association. When other user data
    packet formats are used, the corresponding extensions need to 
    define a replacement for the ESP_TRANSFORM <span>[<a href="#RFC7402" class="xref">RFC7402</a>]</span> parameter along with 
    associated semantics, but this procedure is outside the scope of 
    this document.<a href="#section-3-6" class="pilcrow">¶</a></p>
<div id="HIT">
<section id="section-3.1">
        <h3 id="name-host-identity-tag-hit">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-host-identity-tag-hit" class="section-name selfRef">Host Identity Tag (HIT)</a>
        </h3>
<p id="section-3.1-1">
         With HIP DEX, the HIT is a 128-bit value - a compression of the HI
         prepended with a specific prefix. There are two advantages of using this
         compressed encoding over the actual variable-sized public key in
         protocols. First, the fixed length of the HIT keeps packet sizes
         manageable and eases protocol coding. Second, it presents a consistent
         format for the protocol, independent of the underlying identity
         technology in use.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">
  The structure of the HIT is based on <span><a href="#RFC7343" class="xref">RFC 7343</a> [<a href="#RFC7343" class="xref">RFC7343</a>]</span>, called Overlay Routable 
  Cryptographic Hash Identifiers (ORCHIDs), and consists of 
  three parts: first, an IANA assigned prefix to distinguish it 
  from other IPv6 addresses. Second, a four-bit encoding of the 
  algorithms that were used for generating the HI and the 
  compressed representation of the HI. Third, the 96-bit 
  compressed representation of the HI. In contrast to HIPv2, HIP 
  DEX employs HITs that are NOT generated by means of a 
  cryptographic hash. Instead, the HI is compressed to 96 bits 
  as defined in the following section.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="gener_hit">
<section id="section-3.2">
        <h3 id="name-generating-a-hit-from-an-hi">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-generating-a-hit-from-an-hi" class="section-name selfRef">Generating a HIT from an HI</a>
        </h3>
<p id="section-3.2-1">
 The HIT does not follow the exact semantics of an ORCHID as there 
 is no hash function in HIP DEX. Still, its structure is strongly 
 aligned with the ORCHID design. The same IPv6 prefix used in HIPv2 
 is used for HIP DEX. The HIP DEX HIT suite (see <a href="#iana" class="xref">Section 10</a>) is used for the four bits of the Orchid 
 Generation Algorithm (OGA) field in the ORCHID. The hash 
 representation in an ORCHID is replaced with FOLD((Context ID | 
 HI),96) see <a href="#notation" class="xref">Section 2.2</a> for the FOLD 
 function.  The Context ID is the same as in HIP BEX, sec 3.2 <span><a href="#RFC7401" class="xref">RFC 7401</a> [<a href="#RFC7401" class="xref">RFC7401</a>]</span>.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<div id="foldVcmac">
<section id="section-3.2.1">
          <h4 id="name-why-introduce-fold">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-why-introduce-fold" class="section-name selfRef">Why Introduce FOLD</a>
          </h4>
<p id="section-3.2.1-1">
 HIP DEX by design lacks a cryptographic hash function.  The 
 generation of the HIT is one of the few places in the protocol 
 where this presents a challenge.  CMAC was first considered for 
 this purpose, but to use CMAC for HIT generation would require 
 using a static key, either ZERO or some published value.  NIST does 
 not consider CMAC an approved cryptographic hash as:<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-3.2.1-2.1">
 It is straightforward to demonstrate that CMAC is not 
 collision-resistant for any choice of a published key.<a href="#section-3.2.1-2.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.2.1-3">
 Since collision-resistance is not possible with the tools at hand, 
 any reasonable function (e.g. FOLD) that takes the full value of 
 the HI into generating the HIT can be used, provided that collision 
 detection is part of the HIP-DEX deployment design. This is 
 achieved here through either an ACL, <a href="#hit-acl" class="xref">Section 7.1</a>, or some other lookup process that externally 
 binds the HIT and HI.<a href="#section-3.2.1-3" class="pilcrow">¶</a></p>
<p id="section-3.2.1-4">
 Even without collision-resistance, it is not trivial to create 
 duplicate FOLD generated HITs, as FOLD is starting out with a 
 random input (the HI).  Although there is a set, {N}, of HIs that 
 will have duplicate FOLD HITs, even randomly generating duplicate 
 HITs is unlikely.  Per <a href="#Coll_Prob" class="xref">Appendix A</a>, 
 4T BEX HITs need be generated for a .01% probability of a 
 collision.  The size of set above is not known, but will not be 
 large. In a test of 1M randomly generated FOLD HITs, no duplicates 
 were produced.<a href="#section-3.2.1-4" class="pilcrow">¶</a></p>
<p id="section-3.2.1-5">
 Note that HIT collisions have always been a statistical possibility 
 in BEX and thus the HI has always been a part of the R1 and I2 
 packets for HI validation.<a href="#section-3.2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="proto_overview">
<section id="section-4">
      <h2 id="name-protocol-overview">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-protocol-overview" class="section-name selfRef">Protocol Overview</a>
      </h2>
<p id="section-4-1">
    This section gives a simplified overview of the HIP DEX protocol 
    operation and does not contain all the details of the packet 
    formats or the packet processing steps. <a href="#sec-param-tlv" class="xref">Section 5</a> and <a href="#packet_processing" class="xref">Section 6</a> describe these 
    aspects in more detail and are normative in case of any 
    conflicts with this section. Importantly, the information given 
    in this section focuses on the differences between the HIPv2 and 
    HIP DEX protocol specifications.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="hip-base-exch">
<section id="section-4.1">
        <h3 id="name-creating-a-hip-association">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-creating-a-hip-association" class="section-name selfRef">Creating a HIP Association</a>
        </h3>
<p id="section-4.1-1">
         By definition, the system initiating a HIP Diet EXchange is the
         Initiator, and the peer is the Responder. This distinction is
         typically forgotten once the handshake completes, and either party can
         become the Initiator in future communications.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">
  The HIP Diet EXchange serves to manage the establishment of 
  state between an Initiator and a Responder. The first packet, 
  I1, initiates the exchange, and the last three packets, R1, 
  I2, and R2, constitute an authenticated Diffie-Hellman <span>[<a href="#DOI_10.1109_TIT.1976.1055638" class="xref">DH76</a>]</span> key 
  exchange for the Master Key Security Association (SA) 
  generation. This Master Key SA is used by the Initiator and 
  the Responder to wrap secret keying material in the I2 and R2 
  packets. Based on the exchanged keying material, the peers 
  then derive a Pair-wise Key SA if cryptographic keys are 
  needed, e.g., for ESP-based protection of user data.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">
         The Initiator first sends a trigger packet, I1, to the Responder. This
         packet contains the HIT of the Initiator and the HIT of the Responder,
         if it is known. Moreover, the I1 packet initializes the negotiation of
         the Diffie-Hellman group that is used for generating the Master
         Key SA by including a list of Diffie-Hellman Group IDs supported
         by the Initiator.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">
         The second packet, R1, starts the actual authenticated Diffie-Hellman
         key exchange. It contains a puzzle - a cryptographic challenge that
         the Initiator must solve before continuing the exchange. The level of
         difficulty of the puzzle can be adjusted based on level of knowledge of
         the Initiator, current load, or other factors. In addition, the R1
         contains the Responder's Diffie-Hellman parameter and lists of
         cryptographic algorithms supported by the Responder. Based on these
         lists, the Initiator can continue, abort, or restart the handshake
         with a different selection of cryptographic algorithms.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">
  Unlike in HIP BEX, the R1 packet in DEX is not signed.  Thus 
  the Initiator MUST compare the content of R1 with that it 
  later gets in R2 to ensure there was no MITM attack on R1.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1-6">
  In the I2 packet, the Initiator MUST display the solution to 
  the received puzzle. Without a correct solution, the I2 packet 
  is discarded. The I2 also contains a nonce and key wrap 
  parameter that carries secret keying material of the 
  Initiator. This keying material is only half of the final 
  session (pair-wise) key. The packet is authenticated by the 
  sender (Initiator) via a MAC.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<p id="section-4.1-7">
  The R2 packet acknowledges the receipt of the I2 packet and 
  completes the handshake.  The R2 echos the nonce from I2 and 
  contains a key wrap parameter that carries the rest of the 
  keying material of the Responder. The packet is authenticated 
  by the sender (Responder) via a MAC.  The R2 repeats the lists 
  from R1 for signed validation to defend them against a MITM 
  attack.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1-8">
         The HIP DEX handshake is illustrated below. The terms "ENC(DH,x)" and
         "ENC(DH,y)" refer to the random values x and y that are wrapped based
         on the Master Key SA (indicated by ENC and DH). Note that x and y each
         constitute half of the final session key material. The packets also
         contain other parameters that are not shown in this figure.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
<span id="name-high-level-overview-of-the-"></span><figure id="figure-1">
          <div class="artwork art-text alignLeft" id="section-4.1-9.1">
<pre>

   Initiator                                         Responder

               I1: DH List
              --------------------------------------&gt;

                                                     remain stateless

               R1: puzzle, (DH, Suite, Trans) Lists,
                   HI
              &lt;-------------------------------------

solve puzzle
perform ECDH
encrypt x

               I2: solution, HI, ENC(DH,x), Trans List,
                   I_Nonce, mac
              --------------------------------------&gt;

                                                     check puzzle
                                                     perform ECDH
                                                     check MAC
                                                     decrypt x
                                                     encrypt y

               R2: (DH, Suite, Trans) Lists, ENC(DH,y),
                   I_Nonce, mac
              &lt;--------------------------------------

check MAC
validate lists in R1
decrypt y


</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-high-level-overview-of-the-" class="selfRef">High-level overview of the HIP Diet EXchange</a>
          </figcaption></figure>
<div id="hip-cookie">
<section id="section-4.1.1">
          <h4 id="name-hip-puzzle-mechanism">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-hip-puzzle-mechanism" class="section-name selfRef">HIP Puzzle Mechanism</a>
          </h4>
<p id="section-4.1.1-1">
           The purpose of the HIP puzzle mechanism is to protect the Responder
           from a number of denial-of-service threats. It allows the Responder
           to delay state creation until receiving the I2 packet. Furthermore,
           the puzzle allows the Responder to use a fairly cheap calculation to
           check that the Initiator is "sincere" in the sense that it has
           churned enough CPU cycles in solving the puzzle.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.1-2">
           The puzzle mechanism enables a Responder to immediately reject an I2
           packet if it does not contain a valid puzzle solution. To verify the
           puzzle solution, the Responder only has to compute a single CMAC
           operation. After a successful puzzle verification, the Responder can
           securely create session-specific state and perform CPU-intensive
           operations such as a Diffie-Hellman key generation. By varying the
           difficulty of the puzzle, the Responder can frustrate CPU or memory
           targeted DoS attacks. Under normal network conditions, the puzzle
           difficulty SHOULD be zero, thus effectively reverting the puzzle
           mechanism to a cookie-based DoS protection mechanism. Without
           setting the puzzle difficulty to zero under normal network
           conditions, potentially scarce computation resources at the
           Initiator would be churned unnecessarily.<a href="#section-4.1.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1.1-3">
    Conceptually, the puzzle mechanism in HIP DEX is the same as 
    in HIPv2. Hence, this document refers to Sections 4.1.1 and 
    4.1.2 in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> for more 
    detailed information about the employed mechanism. Notably, 
    the only differences between the puzzle mechanism in HIP DEX 
    and HIPv2 are that HIP DEX does not employ pre-computation 
    of R1 packets and uses CMAC instead of a hash function for 
    solving and verifying a puzzle. The implications of these 
    changes on the puzzle implementation are discussed in <a href="#cmac-puzzle" class="xref">Section 6.1</a>.<a href="#section-4.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="state-machine">
<section id="section-4.1.2">
          <h4 id="name-hip-state-machine">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-hip-state-machine" class="section-name selfRef">HIP State Machine</a>
          </h4>
<p id="section-4.1.2-1">
  The HIP DEX state machine has the same states as the HIPv2 
  state machine (see Section 4.4. in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>); this is for easier comparison between the 
  two Exchanges. However, HIP DEX features a retransmission 
  strategy with an optional reception acknowledgement for the I2 
  packet. The goal of this additional acknowledgement is to 
  reduce premature I2 retransmissions in case of devices with 
  low computation resources <span>[<a href="#DOI_10.1109_ICNP.2013.6733571" class="xref">HWZ13</a>]</span>. As 
  a result, there are minor changes regarding the transitions in 
  the HIP DEX state machine. The following section documents 
  these differences compared to HIPv2.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<div id="retransmissions">
<section id="section-4.1.2.1">
            <h5 id="name-hip-dex-retransmission-mech">
<a href="#section-4.1.2.1" class="section-number selfRef">4.1.2.1. </a><a href="#name-hip-dex-retransmission-mech" class="section-name selfRef">HIP DEX Retransmission Mechanism</a>
            </h5>
<p id="section-4.1.2.1-1">
    For the retransmission of I1 and I2 packets, the Initiator 
    adopts the retransmission strategy of HIPv2 (see Section 
    4.4.3. in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>). This 
    strategy is based on a timeout that is set to a value larger 
    than the worst-case anticipated round-trip time (RTT). For 
    each received I1 or I2 packet, the Responder sends an R1 or 
    R2 packet, respectively. This design trait to always send an 
    R1 after an I1 enables the Responder to remain stateless 
    until the reception and successful processing of the I2 
    packet. The Initiator stops retransmitting I1 or I2 packets 
    after the reception of the corresponding R1 or R2. If the 
    Initiator did not receive an R1 packet after I1_RETRIES_MAX 
    tries, it stops I1 retransmissions. Likewise, it stops 
    retransmitting the I2 packet after I2_RETRIES_MAX 
    unsuccessful tries.<a href="#section-4.1.2.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.2.1-2">
           For repeatedly received I2 packets, the Responder SHOULD NOT perform
           operations related to the Diffie-Hellman key exchange or the keying
           material wrapped in the ENCRYPTED_KEY parameters. Instead, it SHOULD
           re-use the previously established state to re-create the
           corresponding R2 packet in order to prevent unnecessary computation
           overhead.<a href="#section-4.1.2.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1.2.1-3">
    The potentially high processing time of an I2 packet at a 
    (resource-constrained) Responder may cause premature 
    retransmissions if the time required for I2 transmission and 
    processing exceeds the RTT-based retransmission timeout. 
    Thus, the Initiator should also take the processing time of 
    the I2 packet at the Responder into account for 
    retransmission purposes. To this end, the Responder MAY 
    notify the Initiator about the anticipated delay once the 
    puzzle solution was successfully verified that the remaining 
    I2 packet processing will incur a high processing delay. The 
    Responder MAY therefore send a NOTIFY packet (see Section 
    5.3.6. in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>) to the 
    Initiator before the Responder commences the ECDH operation. 
    The NOTIFY packet serves as an acknowledgement for the I2 
    packet and consists of a NOTIFICATION parameter with Notify 
    Message Type I2_ACKNOWLEDGEMENT (see Section 5.2.19. in 
    <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>). The NOTIFICATION 
    parameter contains the anticipated remaining processing time 
    for the I2 packet in milliseconds as two-octet Notification 
    Data. This processing time can, e.g., be estimated by 
    measuring the computation time of the ECDH key derivation 
    operation during the Responder start-up procedure. After the 
    I2 processing has finished, the Responder sends the regular 
    R2 packet.<a href="#section-4.1.2.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1.2.1-4">
           When the Initiator receives the NOTIFY packet, it sets the I2
           retransmission timeout to the I2 processing time indicated in the
           NOTIFICATION parameter plus half the RTT-based timeout value. In
           doing so, the Initiator MUST NOT set the retransmission timeout to a
           higher value than allowed by a local policy. This is to prevent
           unauthenticated NOTIFY packets from maliciously delaying the
           handshake beyond a well-defined upper bound in case of a lost R2
           packet. At the same time, this extended retransmission timeout
           enables the Initiator to defer I2 retransmissions until the point in
           time when the Responder should have completed its I2 packet
           processing and the network should have delivered the R2 packet
           according to the employed worst-case estimates.<a href="#section-4.1.2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-4.1.2.2">
            <h5 id="name-hip-state-processes">
<a href="#section-4.1.2.2" class="section-number selfRef">4.1.2.2. </a><a href="#name-hip-state-processes" class="section-name selfRef">HIP State Processes</a>
            </h5>
<p id="section-4.1.2.2-1">
           HIP DEX clarifies or introduces the following new transitions.<a href="#section-4.1.2.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.2.2-2" class="keepWithNext">System behavior in state I2-SENT, <a href="#table_i2sent" class="xref">Table 1</a>.<a href="#section-4.1.2.2-2" class="pilcrow">¶</a></p>
<span id="name-i2-sent-waiting-to-finish-t"></span><div id="table_i2sent">
<table class="left" id="table-1">
              <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-i2-sent-waiting-to-finish-t" class="selfRef">I2-SENT - Waiting to finish the HIP Diet EXchange</a>
              </caption>
<thead>
                <tr>
                  <th class="text-left" rowspan="1" colspan="1">Trigger</th>
                  <th class="text-left" rowspan="1" colspan="1">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">Receive NOTIFY, process</td>
                  <td class="text-left" rowspan="1" colspan="1">Set I2 retransmission timer to value in I2_ACKNOWLEDGEMENT
           Notification Data plus 1/2 RTT-based timeout value and stay at
           I2-SENT</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1"></td>
                  <td class="text-left" rowspan="1" colspan="1"></td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">Timeout</td>
                  <td class="text-left" rowspan="1" colspan="1">Increment trial counter</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1"></td>
                  <td class="text-left" rowspan="1" colspan="1"></td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1"></td>
                  <td class="text-left" rowspan="1" colspan="1">If counter is less than I2_RETRIES_MAX, send I2, reset timer
           to RTT-based timeout, and stay at I2-SENT</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1"></td>
                  <td class="text-left" rowspan="1" colspan="1"></td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1"></td>
                  <td class="text-left" rowspan="1" colspan="1">If counter is greater than I2_RETRIES_MAX, go to E-FAILED</td>
                </tr>
              </tbody>
            </table>
</div>
</section>
<div id="hipstates">
<section id="section-4.1.2.3">
            <h5 id="name-simplified-hip-state-diagra">
<a href="#section-4.1.2.3" class="section-number selfRef">4.1.2.3. </a><a href="#name-simplified-hip-state-diagra" class="section-name selfRef">Simplified HIP State Diagram</a>
            </h5>
<p id="section-4.1.2.3-1">
           The following diagram shows the major state transitions.
           Transitions based on received packets implicitly assume that
           the packets are successfully authenticated or processed.<a href="#section-4.1.2.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.2.3-2">
<pre>

                            +--+       +----------------------------+
           recv I1, send R1 |  |       |                            |
                            |  v       v                            |
                          +--------------+  recv I2, send R2        |
         +----------------| UNASSOCIATED |----------------+         |
datagram |  +--+          +--------------+                |         |
to send, |  |  | Alg. not supported,                      |         |
 send I1 |  |  | send I1                                  |         |
  .      v  |  v                                          |         |
  .   +---------+  recv I2, send R2                       |         |
+----&gt;| I1-SENT |--------------------------------------+  |         |
|     +---------+            +----------------------+  |  |         |
|          | recv R1,        | recv I2, send R2     |  |  |         |
|          v send I2         |                      v  v  v         |
|       +---------+----------+                    +---------+       |
|  +---&gt;| I2-SENT |&lt;-------------+   +------------| R2-SENT |&lt;---+  |
|  |    +---------+ recv NOTIFY, |   |            +---------+    |  |
|  |          | | | reset timer  |   |      data or|             |  |
|  |recv R1,  | | +--------------+   |   EC timeout|             |  |
|  |send I2   +-|--------------------+             |  receive I2,|  |
|  |          | |         +-------------+          |      send R2|  |
|  |          | +--------&gt;| ESTABLISHED |&lt;---------+             |  |
|  |          |   recv R2 +-------------+                        |  |
|  |          |            |  |  |      receive I2, send R2      |  |
|  |          +------------+  |  +-------------------------------+  |
|  |          |               +-----------+                      |  |
|  |          |    no packet sent/received|    +---+             |  |
|  |          |    for UAL min, send CLOSE|    |   |timeout      |  |
|  |          |                           v    v   |(UAL+MSL)    |  |
|  |          |                        +---------+ |retransmit   |  |
+--|----------|------------------------| CLOSING |-+CLOSE        |  |
   |          |                        +---------+               |  |
   |          |                         | |   | |                |  |
   +----------|-------------------------+ |   | +----------------+  |
   |          |               +-----------+   +------------------|--+
   |          |               |recv CLOSE,      recv CLOSE_ACK   |  |
   |          +-------------+ |send CLOSE_ACK   or timeout       |  |
   |     recv CLOSE,        | |                 (UAL+MSL)        |  |
   |     send CLOSE_ACK     v v                                  |  |
   |                     +--------+  receive I2, send R2         |  |
   +---------------------| CLOSED |------------------------------+  |
                         +--------+                                 |
                          ^ |  |                                    |
recv CLOSE, send CLOSE_ACK| |  |              timeout (UAL+2MSL)    |
                          +-+  +------------------------------------+

</pre><a href="#section-4.1.2.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<section id="section-4.1.3">
          <h4 id="name-hip-dex-security-associatio">
<a href="#section-4.1.3" class="section-number selfRef">4.1.3. </a><a href="#name-hip-dex-security-associatio" class="section-name selfRef">HIP DEX Security Associations</a>
          </h4>
<p id="section-4.1.3-1">
         HIP DEX establishes two Security Associations (SA), one for the
         Diffie-Hellman derived key, or Master Key, and one for the session
         key, or Pair-wise Key.<a href="#section-4.1.3-1" class="pilcrow">¶</a></p>
<section id="section-4.1.3.1">
            <h5 id="name-master-key-sa">
<a href="#section-4.1.3.1" class="section-number selfRef">4.1.3.1. </a><a href="#name-master-key-sa" class="section-name selfRef">Master Key SA</a>
            </h5>
<p id="section-4.1.3.1-1">
 The Master Key SA is used to authenticate HIP packets and 
 to encrypt selected HIP parameters in the HIP DEX packet 
 exchanges. Since only a small amount of data is protected 
 by this SA, it can be long-lived with no need for rekeying. 
 At the latest, the system MUST initiate rekeying when its 
 incoming ESP sequence counter is going to overflow, and the 
 system MUST NOT replace its keying material until the 
 rekeying packet exchange successfully completes as 
 described in Section 6.8 in <span>[<a href="#RFC7402" class="xref">RFC7402</a>]</span>.<a href="#section-4.1.3.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.3.1-2">
            The Master Key SA contains the following elements:<a href="#section-4.1.3.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.3.1-3.1">Source HIT<a href="#section-4.1.3.1-3.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.1.3.1-3.2">Destination HIT<a href="#section-4.1.3.1-3.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.1.3.1-3.3">HIP_Encrypt Key<a href="#section-4.1.3.1-3.3" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.1.3.1-3.4">HIP_MAC Key<a href="#section-4.1.3.1-3.4" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-4.1.3.1-4">
 The HIP_Encrypt and HIP_MAC keys are extracted from the 
 Diffie-Hellman derived key as described in <a href="#keymat" class="xref">Section 6.3</a>. Their length is 
 determined by the HIP_CIPHER.<a href="#section-4.1.3.1-4" class="pilcrow">¶</a></p>
</section>
<section id="section-4.1.3.2">
            <h5 id="name-pair-wise-key-sa">
<a href="#section-4.1.3.2" class="section-number selfRef">4.1.3.2. </a><a href="#name-pair-wise-key-sa" class="section-name selfRef">Pair-wise Key SA</a>
            </h5>
<p id="section-4.1.3.2-1">
            The Pair-wise Key SA is used to authenticate and to encrypt user
            data. It is refreshed (or rekeyed) using an UPDATE packet exchange.
            The Pair-wise Key SA elements are defined by the data transform
            (e.g., ESP_TRANSFORM <span>[<a href="#RFC7402" class="xref">RFC7402</a>]</span>).<a href="#section-4.1.3.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.3.2-2">
 The keys for the Pair-wise Key SA are derived based on the 
 wrapped keying material exchanged in the ENCRYPTED_KEY 
 parameter (see <a href="#encrypted_key" class="xref">Section 5.2.5</a>) of the I2 and R2 packets. Specifically, 
 the exchanged keying material of the two peers is 
 concatenated. This concatenation forms the input to a Key 
 Derivation Function (KDF). If the data transform does not 
 specify its own KDF, the key derivation function defined in 
 <a href="#keymat" class="xref">Section 6.3</a> is used. Even 
 though the concatenated input is randomly distributed, a 
 KDF Extract phase may be needed to get the proper length 
 for the input to the KDF Expand phase.<a href="#section-4.1.3.2-2" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-4.1.4">
          <h4 id="name-user-data-considerations">
<a href="#section-4.1.4" class="section-number selfRef">4.1.4. </a><a href="#name-user-data-considerations" class="section-name selfRef">User Data Considerations</a>
          </h4>
<p id="section-4.1.4-1">
         The User Data Considerations in Section 4.5. of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> also apply to HIP DEX. There is only one difference between HIPv2
         and HIP DEX. Loss of state due to system reboot may be a critical
         performance issue for resource-constrained devices. Thus, implementors
         MAY choose to use non-volatile, secure storage for HIP states in order
         for them to survive a system reboot as discussed in <a href="#loss" class="xref">Section 6.11</a>. Using non-volatile storage will limit state loss during
         reboots to only those situations with an SA timeout.<a href="#section-4.1.4-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
</section>
</div>
<div id="sec-param-tlv">
<section id="section-5">
      <h2 id="name-packet-formats">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-packet-formats" class="section-name selfRef">Packet Formats</a>
      </h2>
<div id="hip_payload">
<section id="section-5.1">
        <h3 id="name-payload-format">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-payload-format" class="section-name selfRef">Payload Format</a>
        </h3>
<p id="section-5.1-1">
  HIP DEX employs the same fixed HIP header and payload 
  structure as HIPv2. As such, the specifications in Section 5.1 
  of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> also apply to HIP 
  DEX.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="hippars">
<section id="section-5.2">
        <h3 id="name-hip-parameters">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-hip-parameters" class="section-name selfRef">HIP Parameters</a>
        </h3>
<p id="section-5.2-1">
         The HIP parameters carry information that is necessary for
         establishing and maintaining a HIP association. For example, the
         peer's public keys as well as the signaling for negotiating ciphers
         and payload handling are encapsulated in HIP parameters. Additional
         information, meaningful for end-hosts or middleboxes, may also be
         included in HIP parameters. The specification of the HIP parameters
         and their mapping to HIP packets and packet types is flexible to allow
         HIP extensions to define new parameters and new protocol behavior.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">
         In HIP packets, HIP parameters are ordered according to their numeric
         type number and encoded in TLV format.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">
  HIP DEX reuses the HIP parameters of HIPv2 defined in Section 
  5.2. of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> where 
  possible. Still, HIP DEX further restricts and/or extends the 
  following existing parameter types:<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-4.1">
             DH_GROUP_LIST and HOST_ID are restricted to ECC-based suites.<a href="#section-5.2-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.2-4.2">
             HIP_CIPHER is restricted to AES-128-CTR.<a href="#section-5.2-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.2-4.3">
             HIT_SUITE_LIST is limited to the HIT suite ECDH/FOLD.<a href="#section-5.2-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.2-4.4">
  PUZZLE, SOLUTION, and HIP_MAC parameter processing is 
  altered to support CMAC in RHASH and RHASH_len (see <a href="#cmac-puzzle" class="xref">Section 6.1</a> and <a href="#cmac-processing" class="xref">Section 6.2</a>).<a href="#section-5.2-4.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.2-5">
         In addition, HIP DEX introduces the following new parameters:<a href="#section-5.2-5" class="pilcrow">¶</a></p>
<table class="center" id="table-2">
          <caption><a href="#table-2" class="selfRef">Table 2</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">TLV</th>
              <th class="text-left" rowspan="1" colspan="1">Type</th>
              <th class="text-left" rowspan="1" colspan="1">Length</th>
              <th class="text-left" rowspan="1" colspan="1">Data</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ENCRYPTED_KEY</td>
              <td class="text-left" rowspan="1" colspan="1">TBD1 (suggested value 643)</td>
              <td class="text-left" rowspan="1" colspan="1">variable</td>
              <td class="text-left" rowspan="1" colspan="1">Encrypted container
         for the session key exchange</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">I_NONCE</td>
              <td class="text-left" rowspan="1" colspan="1">TBD6 (suggested value 644)</td>
              <td class="text-left" rowspan="1" colspan="1">variable</td>
              <td class="text-left" rowspan="1" colspan="1">Nonce from Initator for 
         Master Key</td>
            </tr>
          </tbody>
        </table>
<div id="dh_group_list">
<section id="section-5.2.1">
          <h4 id="name-dh_group_list">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-dh_group_list" class="section-name selfRef">DH_GROUP_LIST</a>
          </h4>
<p id="section-5.2.1-1">
   The DH_GROUP_LIST parameter contains the list of supported DH 
   Group IDs of a host. It is defined in Section 5.2.6 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>. With HIP DEX, the DH Group 
   IDs are restricted to:<a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.2.1-2">
<pre>

Group                        KDF           Value

Curve25519 [RFC7748]         CKDF          TBD7 (suggested value 12)
Curve448   [RFC7748]         CKDF          TBD8 (suggested value 13)


</pre><a href="#section-5.2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-5.2.1-3"></p>
<p id="section-5.2.1-4">
   The ECDH groups with values TBD7 and TBD8 are defined in <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>. These curves have cofactors 
   of 8 and 4 (respectively).<a href="#section-5.2.1-4" class="pilcrow">¶</a></p>
<p id="section-5.2.1-5">
   It is not known if Curve448 Diffie Hellman can meet the 
   performance requirements on 8-bit CPUs.  It is included for
   "completeness".  An implementor should ensure they can get the 
   needed performance for their target platform before committing to 
   support this group.<a href="#section-5.2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="hip_cipher">
<section id="section-5.2.2">
          <h4 id="name-hip_cipher">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-hip_cipher" class="section-name selfRef">HIP_CIPHER</a>
          </h4>
<p id="section-5.2.2-1">
   The HIP_CIPHER parameter contains the list of supported cipher 
   algorithms to be used for encrypting the contents of the 
   ENCRYPTED and ENCRYPTED_KEY parameters. The HIP_CIPHER parameter 
   is defined in Section 5.2.8 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>. With HIP DEX, the Suite IDs are limited to:<a href="#section-5.2.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.2.2-2">
<pre>
Suite ID           Value

RESERVED           0
AES-128-CTR        TBD4 (suggested: 5)     ([RFC3686])

</pre><a href="#section-5.2.2-2" class="pilcrow">¶</a>
</div>
<p id="section-5.2.2-3">
      Mandatory implementation: AES-128-CTR.<a href="#section-5.2.2-3" class="pilcrow">¶</a></p>
<p id="section-5.2.2-4">
   The counter for AES-128-CTR  MUST have a length of 128 bits.  The 
   puzzle value #I and the puzzle solution #J (see Section 4.1.2 in 
   <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>) are used to construct the 
   initialization vector (IV) as FOLD(I | J, 112) which are the 
   high-order bits of the CTR counter.  A 16 bit value as a block 
   counter, which is initialized to zero on first use, is appended 
   to the IV in order to guarantee that a non-repeating nonce is fed 
   to the AES-CTR encryption algorithm.<a href="#section-5.2.2-4" class="pilcrow">¶</a></p>
<p id="section-5.2.2-5">
   This counter is incremented as it is used for all encrypted HIP 
   parameters.  That is a single AES-129-CTR counter associated with 
   the Master Key SA.<a href="#section-5.2.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="host_id">
<section id="section-5.2.3">
          <h4 id="name-host_id">
<a href="#section-5.2.3" class="section-number selfRef">5.2.3. </a><a href="#name-host_id" class="section-name selfRef">HOST_ID</a>
          </h4>
<p id="section-5.2.3-1">
   The HOST_ID parameter conveys the Host Identity (HI) along with 
   optional information about a host. The HOST_ID parameter is 
   defined in Section 5.2.9 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>.<a href="#section-5.2.3-1" class="pilcrow">¶</a></p>
<p id="section-5.2.3-2">
      HIP DEX uses the public portion of a host's static ECDH key-pair as the
      HI. Correspondingly, HIP DEX limits the HI algorithms to the following
      new profile:<a href="#section-5.2.3-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.2.3-3">
<pre>

Algorithm profiles   Value

ECDH                 TBD5 (suggested: 11)    [RFC6090]   (REQUIRED)

</pre><a href="#section-5.2.3-3" class="pilcrow">¶</a>
</div>
<p id="section-5.2.3-4">
    For hosts that implement ECDH as the algorithm, the following 
    curves are required:<a href="#section-5.2.3-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.2.3-5">
<pre>

Group                    Value

Curve25519               5 [RFC7748]
Curve448                 6 [RFC7748]

</pre><a href="#section-5.2.3-5" class="pilcrow">¶</a>
</div>
<p id="section-5.2.3-6">
      HIP DEX HIs are serialized equally to the ECC-based HIs in HIPv2 (see
      Section 5.2.9. of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>). The Group ID of the HIP DEX
      HI is encoded in the "ECC curve" field of the HOST_ID parameter. The
      supported DH Group IDs are defined in <a href="#dh_group_list" class="xref">Section 5.2.1</a>.<a href="#section-5.2.3-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="hit_suite_list">
<section id="section-5.2.4">
          <h4 id="name-hit_suite_list">
<a href="#section-5.2.4" class="section-number selfRef">5.2.4. </a><a href="#name-hit_suite_list" class="section-name selfRef">HIT_SUITE_LIST</a>
          </h4>
<p id="section-5.2.4-1">
       The HIT_SUITE_LIST parameter contains a list of the supported HIT
       suite IDs of the Responder. Based on the HIT_SUITE_LIST, the
       Initiator can determine which source HIT Suite IDs are supported by
       the Responder. The HIT_SUITE_LIST parameter is defined in Section
       5.2.10 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>.<a href="#section-5.2.4-1" class="pilcrow">¶</a></p>
<p id="section-5.2.4-2">
       The following new HIT Suite ID is defined for HIP DEX, and the
       relationship between the four-bit ID value used in the OGA ID field
       and the eight-bit encoding within the HIT_SUITE_LIST ID field is
       clarified:<a href="#section-5.2.4-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.2.4-3">
<pre>

HIT Suite       Four-bit ID            Eight-bit encoding

ECDH/FOLD       TBD2 (suggestion: 4)   TBD3 (suggestion: 0x40)

</pre><a href="#section-5.2.4-3" class="pilcrow">¶</a>
</div>
<p id="section-5.2.4-4">
       Note that the dedicated HIP DEX HIT Suite ID in the OGA ID field allows
       the peers to distinguish a HIP DEX handshake from a HIPv2 handshake. The
       Responder MUST respond with a HIP DEX HIT suite ID when the HIT of the
       Initiator is a HIP DEX HIT.<a href="#section-5.2.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="encrypted_key">
<section id="section-5.2.5">
          <h4 id="name-encrypted_key">
<a href="#section-5.2.5" class="section-number selfRef">5.2.5. </a><a href="#name-encrypted_key" class="section-name selfRef">ENCRYPTED_KEY</a>
          </h4>
<div class="artwork art-text alignLeft" id="section-5.2.5-1">
<pre>

   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |             Type              |             Length            |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  /                        Encrypted value                        /
  /                                                               /
  /                               +-------------------------------+
  /                               |            Padding            |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

  Type           TBD1 (suggested value 643)
  Length         length in octets, excluding Type, Length, and
                 Padding
  Encrypted      The value is encrypted using an encryption algorithm
  value          as defined in the HIP_CIPHER parameter.

</pre><a href="#section-5.2.5-1" class="pilcrow">¶</a>
</div>
<p id="section-5.2.5-2">
   The ENCRYPTED_KEY parameter encapsulates a random value that 
   is later used in the session key creation process (see <a href="#keymat" class="xref">Section 6.3</a>). This random value MUST 
   have a length of at least 64 bits.  The HIP_CIPHER is used 
   for the encryption.<a href="#section-5.2.5-2" class="pilcrow">¶</a></p>
<p id="section-5.2.5-3">
          Once this encryption process is completed, the "encrypted value" data
          field is ready for inclusion in the Parameter. If necessary,
          additional Padding for 8-byte alignment is then added according to
          the rules of TLV Format in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>.<a href="#section-5.2.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="i_nonce">
<section id="section-5.2.6">
          <h4 id="name-i_nonce">
<a href="#section-5.2.6" class="section-number selfRef">5.2.6. </a><a href="#name-i_nonce" class="section-name selfRef">I_NONCE</a>
          </h4>
<div class="artwork art-text alignLeft" id="section-5.2.6-1">
<pre>

   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |             Type              |             Length            |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  /                        Initiator Nonce                        /
  /                                                               /
  /                               +-------------------------------+
  /                               |            Padding            |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

  Type           TBD6 (suggested value 644)
  Length         length in octets, excluding Type, Length, and
                 Padding
  Initiator      Nonce provided by the Initiator for use in the
  Nonce          Master Key

</pre><a href="#section-5.2.6-1" class="pilcrow">¶</a>
</div>
<p id="section-5.2.6-2">
   The I_NONCE parameter encapsulates a random value that is 
   later used in the Master key creation process (see <a href="#keymat" class="xref">Section 6.3</a>). This random value MUST 
   have a length of 2 x RHASH_len.  This parameter is sent to 
   the Responder in I2 which echos it back to the Initiator in 
   R2.<a href="#section-5.2.6-2" class="pilcrow">¶</a></p>
<p id="section-5.2.6-3">
   If necessary, additional Padding for 8-byte alignment is 
   added according to the rules of TLV Format in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>.<a href="#section-5.2.6-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-5.3">
        <h3 id="name-hip-packets">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-hip-packets" class="section-name selfRef">HIP Packets</a>
        </h3>
<p id="section-5.3-1">
  HIP DEX uses the same eight basic HIP packets as HIPv2 (see 
  Section 5.3 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>). 
  Four of them are for the HIP handshake (I1, R1, I2, and R2), 
  one is for updating an association (UPDATE), one is for 
  sending notifications (NOTIFY), and two are for closing the 
  association (CLOSE and CLOSE_ACK). There are some differences 
  regarding the HIP parameters that are included in the 
  handshake packets concerning HIP BEX and HIP DEX. This section 
  covers these differences for the DEX packets. Packets not 
  discussed here, follow the structure defined in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">
         An important difference between packets in HIP BEX and HIP DEX is that
         the DIFFIE_HELLMAN and the HIP_SIGNATURE parameters are not included
         in HIP DEX. Thus, the R1 packet is completely unprotected and can be
         spoofed. As a result, negotiation parameters contained in the R1
         packet have to be re-included in later, protected packets in order to
         detect and prevent potential downgrading attacks. Moreover, the I2,
         R2, UPDATE, NOTIFY, CLOSE, and CLOSE_ACK packets are not covered by a
         signature and purely rely on the HIP_MAC parameter for packet
         authentication. The processing of these packets is changed accordingly.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">
         In the future, an optional upper-layer payload MAY follow the HIP
         header. The Next Header field in the header indicates if there is
         additional data following the HIP header.<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<div id="I1">
<section id="section-5.3.1">
          <h4 id="name-i1-the-hip-initiator-packet">
<a href="#section-5.3.1" class="section-number selfRef">5.3.1. </a><a href="#name-i1-the-hip-initiator-packet" class="section-name selfRef">I1 - the HIP Initiator Packet</a>
          </h4>
<p id="section-5.3.1-1">The HIP header values for the I1 packet:<a href="#section-5.3.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.3.1-2">
<pre>

  Header:
    Packet Type = 1
    SRC HIT = Initiator's HIT
    DST HIT = Responder's HIT, or NULL

  IP ( HIP ( DH_GROUP_LIST ) )

</pre><a href="#section-5.3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-5.3.1-3"></p>
<p id="section-5.3.1-4">Valid control bits: none<a href="#section-5.3.1-4" class="pilcrow">¶</a></p>
<p id="section-5.3.1-5">
           The I1 packet contains the fixed HIP header and the Initiator's
           DH_GROUP_LIST. The Initiator's HIT Suite ID MUST be of a HIP DEX
           type as defined in <a href="#hit_suite_list" class="xref">Section 5.2.4</a>.<a href="#section-5.3.1-5" class="pilcrow">¶</a></p>
<p id="section-5.3.1-6">
    Regarding the Responder's HIT, the Initiator may receive 
    this HIT either from a DNS lookup of the Responder's FQDN 
    (see <span>[<a href="#RFC8005" class="xref">RFC8005</a>]</span>), from some 
    other repository, or from a local table. The Responder's HIT 
    also MUST be of a HIP DEX type. If the Initiator does not 
    know the Responder's HIT, it may attempt to use 
    opportunistic mode by using NULL (all zeros) as the 
    Responder's HIT. See Section 4.1.8 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> for detailed information about the "HIP 
    Opportunistic Mode".<a href="#section-5.3.1-6" class="pilcrow">¶</a></p>
<p id="section-5.3.1-7">
           As the Initiator's and the Responder's HITs are compressions of the
           employed HIs, they determine the DH Group ID that must be used in
           order to successfully conclude the triggered handshake. HITs,
           however, only include the OGA ID identifying the HI algorithm. They
           do not include information about the specific group ID of the HI. To
           inform the Responder about its employed and its otherwise supported
           DH Group IDs, the Initiator therefore includes the DH_GROUP_LIST
           parameter in the I1 packet. This parameter MUST include the DH group
           ID that corresponds to the currently employed Initiator HIT as the
           first list element. With HIP DEX, the DH_GROUP_LIST parameter MUST
           only include ECDH groups defined in <a href="#dh_group_list" class="xref">Section 5.2.1</a>.<a href="#section-5.3.1-7" class="pilcrow">¶</a></p>
<p id="section-5.3.1-8">
           Since this packet is so easy to spoof even if it were protected, no
           attempt is made to add to its generation or processing cost. As a
           result, the DH_GROUP_LIST in the I1 packet is not protected.<a href="#section-5.3.1-8" class="pilcrow">¶</a></p>
<p id="section-5.3.1-9">
           Implementations MUST be able to handle a storm of received I1
           packets, discarding those with common content that arrive within a
           small time delta.<a href="#section-5.3.1-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="R1">
<section id="section-5.3.2">
          <h4 id="name-r1-the-hip-responder-packet">
<a href="#section-5.3.2" class="section-number selfRef">5.3.2. </a><a href="#name-r1-the-hip-responder-packet" class="section-name selfRef">R1 - the HIP Responder Packet</a>
          </h4>
<p id="section-5.3.2-1">The HIP header values for the R1 packet:<a href="#section-5.3.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.3.2-2">
<pre>

  Header:
    Packet Type = 2
    SRC HIT = Responder's HIT
    DST HIT = Initiator's HIT

  IP ( HIP ( [ R1_COUNTER, ]
             PUZZLE,
             DH_GROUP_LIST,
             HIP_CIPHER,
             HOST_ID,
             HIT_SUITE_LIST,
             TRANSPORT_FORMAT_LIST,
             [ &lt;, ECHO_REQUEST_UNSIGNED &gt;i ])

</pre><a href="#section-5.3.2-2" class="pilcrow">¶</a>
</div>
<p id="section-5.3.2-3">
           Valid control bits: none<a href="#section-5.3.2-3" class="pilcrow">¶</a></p>
<p id="section-5.3.2-4">
           The Initiator's HIT MUST match the one received in the I1 packet if
           the R1 is a response to an I1. If the Responder has multiple HIs,
    the Responder's HIT MUST match the Initiator's request. If 
    the Initiator used opportunistic mode, the Responder may 
    select among its HIs as described below. See Section 4.1.8 
    of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> for detailed 
    information about the "HIP Opportunistic Mode".<a href="#section-5.3.2-4" class="pilcrow">¶</a></p>
<p id="section-5.3.2-5">
           The R1 packet generation counter is used to determine the currently
           valid generation of puzzles. The value is increased periodically,
           and it is RECOMMENDED that it is increased at least as often as
           solutions to old puzzles are no longer accepted.<a href="#section-5.3.2-5" class="pilcrow">¶</a></p>
<p id="section-5.3.2-6">
    The Puzzle contains a Random value #I and the puzzle 
    difficulty K. The difficulty K indicates the number of 
    lower-order bits, in the puzzle CMAC result, that MUST be 
    zeros (see <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>). 
    Responders SHOULD set K to zero by default and only increase 
    the puzzle difficulty to protect against a DoS attack 
    targeting the HIP DEX handshake. A puzzle difficulty of zero 
    effectively turns the puzzle mechanism into a 
    return-routability test and is strongly encouraged during 
    normal operation in order to conserve energy resources as 
    well as to prevent unnecessary handshake delay in case of a 
    resource-constrained Initiator. Please also refer to <a href="#sec-policy" class="xref">Section 7</a> for further 
    recommendations on choosing puzzle difficulty.<a href="#section-5.3.2-6" class="pilcrow">¶</a></p>
<p id="section-5.3.2-7">
    The HIP_CIPHER contains the encryption algorithms supported 
    by the Responder to protect the key exchange, in the order 
    of preference. All implementations MUST support the AES-CTR 
    <span>[<a href="#RFC3686" class="xref">RFC3686</a>]</span>.<a href="#section-5.3.2-7" class="pilcrow">¶</a></p>
<p id="section-5.3.2-8">
           The DH_GROUP_LIST parameter contains the Responder's order of
           preference based on the Responder's choice the ECDH key contained in the
           HOST_ID parameter (see below). This allows the Initiator to begin to
           determine whether its own DH_GROUP_LIST in the I1 packet was
           manipulated by an attacker. There is a further risk that the
           Responder's DH_GROUP_LIST was manipulated by an attacker, as the R1
           packet cannot be authenticated in HIP DEX. Thus, this parameter is
           repeated in the R2 packet to allow for a final, cryptographically
           secured validation.<a href="#section-5.3.2-8" class="pilcrow">¶</a></p>
<p id="section-5.3.2-9">
           The HIT_SUITE_LIST parameter is an ordered list of the Responder's
           supported and preferred HIT Suites. It enables a Responder to notify
           the Initiator about other available HIT suites than the one used in
           the current handshake. Based on the received HIT_SUITE_LIST, the
           Initiator MAY decide to abort the current handshake and initiate a
           new handshake with a different mutually supported HIT suite. This
           mechanism can, e.g., be used to move from an initial HIP DEX
           handshake to a HIP BEX handshake for peers supporting both protocol
           variants.<a href="#section-5.3.2-9" class="pilcrow">¶</a></p>
<p id="section-5.3.2-10">
           The HOST_ID parameter depends on the received DH_GROUP_LIST parameter
           and the Responder HIT in the I1 packet. Specifically, if the I1
           contains a Responder HIT, the Responder verifies that this HIT
           matches the preferred DH group based on the received DH_GROUP_LIST
           parameter included in the I1. In case of a positive result, the
           Responder selects the corresponding HOST_ID for inclusion in the R1
           packet. Likewise, if the Responder HIT in the I1 packet is NULL
           (i.e., during an opportunistic handshake), the Responder chooses its
           HOST_ID according to the Initiator's employed DH group as indicated
           in the received DH_GROUP_LIST parameter and sets the source HIT in
           the R1 packet accordingly. If the Responder however does not support
           the DH group required by the Initiator or if the Responder HIT in the
           I1 packet does not match the required DH group, the Responder selects
           the mutually preferred and supported DH group based on the
           DH_GROUP_LIST parameter in the I1 packet. The Responder then includes
           the corresponding ECDH key in the HOST_ID parameter. This parameter
           also indicates the selected DH group. Moreover, the Responder sets
           the source HIT in the R1 packet based on the destination HIT from the
           I1 packet. Based on the deviating DH group ID in the HOST_ID
           parameter, the Initiator then MUST abort the current handshake and
           SHOULD initiate a new handshake with the mutually supported DH group as far
           as local policies (see <a href="#sec-policy" class="xref">Section 7</a>) permit.<a href="#section-5.3.2-10" class="pilcrow">¶</a></p>
<p id="section-5.3.2-11">
    The TRANSPORT_FORMAT_LIST parameter is an ordered list of 
    the Responder's supported and preferred transport format 
    types. The list allows the Initiator and the Responder to 
    agree on a common type for payload protection.  The 
    different format types are DEFAULT, ESP (Mandatory to 
    Implement) and ESP-TCP (Experimental, as explained in 
    Section 3.1 in <span>[<a href="#RFC6261" class="xref">RFC6261</a>]</span>).<a href="#section-5.3.2-11" class="pilcrow">¶</a></p>
<p id="section-5.3.2-12">
           The ECHO_REQUEST_UNSIGNED parameters contain data that the sender
           wants to receive unmodified in the corresponding response packet in
           the ECHO_RESPONSE_UNSIGNED parameter. The R1 packet may contain zero
           or more ECHO_REQUEST_UNSIGNED parameters.<a href="#section-5.3.2-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="I2">
<section id="section-5.3.3">
          <h4 id="name-i2-the-second-hip-initiator">
<a href="#section-5.3.3" class="section-number selfRef">5.3.3. </a><a href="#name-i2-the-second-hip-initiator" class="section-name selfRef">I2 - the Second HIP Initiator Packet</a>
          </h4>
<p id="section-5.3.3-1">The HIP header values for the I2 packet:<a href="#section-5.3.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.3.3-2">
<pre>

  Header:
    Type = 3
    SRC HIT = Initiator's HIT
    DST HIT = Responder's HIT

  IP ( HIP ( [R1_COUNTER,]
             SOLUTION,
             HIP_CIPHER,
             ENCRYPTED_KEY,
             HOST_ID,
             TRANSPORT_FORMAT_LIST,
             I_NONCE,
             HIP_MAC
             [&lt;, ECHO_RESPONSE_UNSIGNED&gt;i )] )

</pre><a href="#section-5.3.3-2" class="pilcrow">¶</a>
</div>
<p id="section-5.3.3-3">
           Valid control bits: none<a href="#section-5.3.3-3" class="pilcrow">¶</a></p>
<p id="section-5.3.3-4">
           The HITs MUST match the ones used in the R1 packet.<a href="#section-5.3.3-4" class="pilcrow">¶</a></p>
<p id="section-5.3.3-5">
           If present in the R1 packet, the Initiator MUST include an
           unmodified copy of the R1_COUNTER parameter into the I2 packet.<a href="#section-5.3.3-5" class="pilcrow">¶</a></p>
<p id="section-5.3.3-6">
           The Solution contains the Random #I from the R1 packet and the
           computed #J value. The low-order #K bits of the RHASH(I | ... | J)
           MUST be zero.<a href="#section-5.3.3-6" class="pilcrow">¶</a></p>
<p id="section-5.3.3-7">
           The HIP_CIPHER contains the single encryption transform selected by
           the Initiator that it uses to encrypt the ENCRYPTED and
           ENCRYPTED_KEY parameters. The chosen cipher MUST correspond to one
    of the ciphers offered by the Responder in the R1. All 
    implementations MUST support the AES-CTR transform <span>[<a href="#RFC3686" class="xref">RFC3686</a>]</span>.<a href="#section-5.3.3-7" class="pilcrow">¶</a></p>
<p id="section-5.3.3-8">
           The HOST_ID parameter contains the Initiator HI corresponding to the
           Initiator HIT.<a href="#section-5.3.3-8" class="pilcrow">¶</a></p>
<p id="section-5.3.3-9">
           The ENCRYPTED_KEY parameter contains an Initiator generated random
           value that MUST be uniformly distributed. This random value is
           encrypted with the Master Key SA using the HIP_CIPHER encryption
           algorithm.<a href="#section-5.3.3-9" class="pilcrow">¶</a></p>
<p id="section-5.3.3-10">
           The ECHO_RESPONSE_UNSIGNED parameter(s) contain the unmodified
           Opaque data copied from the corresponding echo request parameter(s).
           This parameter can also be used for two-factor password
           authentication as shown in <a href="#twofactor" class="xref">Appendix B</a>.<a href="#section-5.3.3-10" class="pilcrow">¶</a></p>
<p id="section-5.3.3-11">
    The TRANSPORT_FORMAT_LIST parameter contains the single 
    transport format type selected by the Initiator. The chosen 
    type MUST correspond to one of the types offered by the 
    Responder in the R1 packet. The different format types are 
    DEFAULT, ESP and ESP-TCP as explained in Section 3.1 in 
    <span>[<a href="#RFC6261" class="xref">RFC6261</a>]</span>.<a href="#section-5.3.3-11" class="pilcrow">¶</a></p>
<p id="section-5.3.3-12">
    The I_NONCE parameter contains the nonce, supplied by the 
    Initiator for the Master Key generation as shown in <a href="#keymat" class="xref">Section 6.3</a>.  This is echoed back to 
    the Initiator in the R2 packet.<a href="#section-5.3.3-12" class="pilcrow">¶</a></p>
<p id="section-5.3.3-13">
    The MAC is calculated over the whole HIP envelope, excluding 
    any parameters after the HIP_MAC parameter as described in 
    <a href="#cmac-processing" class="xref">Section 6.2</a>. The 
    Responder MUST validate the HIP_MAC parameter.<a href="#section-5.3.3-13" class="pilcrow">¶</a></p>
</section>
</div>
<div id="R2">
<section id="section-5.3.4">
          <h4 id="name-r2-the-second-hip-responder">
<a href="#section-5.3.4" class="section-number selfRef">5.3.4. </a><a href="#name-r2-the-second-hip-responder" class="section-name selfRef">R2 - the Second HIP Responder Packet</a>
          </h4>
<p id="section-5.3.4-1">The HIP header values for the R2 packet:<a href="#section-5.3.4-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.3.4-2">
<pre>

  Header:
    Packet Type = 4
    SRC HIT = Responder's HIT
    DST HIT = Initiator's HIT

  IP ( HIP ( DH_GROUP_LIST,
             HIP_CIPHER,
             ENCRYPTED_KEY,
             HIT_SUITE_LIST,
             TRANSPORT_FORMAT_LIST,
             I_NONCE,
             HIP_MAC)

</pre><a href="#section-5.3.4-2" class="pilcrow">¶</a>
</div>
<p id="section-5.3.4-3">Valid control bits: none<a href="#section-5.3.4-3" class="pilcrow">¶</a></p>
<p id="section-5.3.4-4">
           The HITs used MUST match the ones used in the I2 packet.<a href="#section-5.3.4-4" class="pilcrow">¶</a></p>
<p id="section-5.3.4-5">
           The Responder repeats the DH_GROUP_LIST, HIP_CIPHER, HIT_SUITE_LIST,
           and TRANSPORT_FORMAT_LIST parameters in the R2 packet. These
           parameters MUST be the same as included in the R1 packet. The
           parameter are re-included here because the R2 packet is MACed and
           thus cannot be altered by an attacker. For verification purposes,
           the Initiator re-evaluates the selected suites and compares the
           results against the chosen ones. If the re-evaluated suites do not
           match the chosen ones, the Initiator acts based on its local policy.<a href="#section-5.3.4-5" class="pilcrow">¶</a></p>
<p id="section-5.3.4-6">
           The ENCRYPTED_KEY parameter contains an Responder generated random
           value that MUST be uniformly distributed. This random value is
           encrypted with the Master Key SA using the HIP_CIPHER encryption
           algorithm.<a href="#section-5.3.4-6" class="pilcrow">¶</a></p>
<p id="section-5.3.4-7">
    The I_NONCE parameter contains the nonce, supplied by the 
    Initiator for the Master Key generation as shown in <a href="#keymat" class="xref">Section 6.3</a>.  The Responder is 
    echoing the value back to the Initiator to show it used the 
    Initiator provided nonce.<a href="#section-5.3.4-7" class="pilcrow">¶</a></p>
<p id="section-5.3.4-8">
    The MAC is calculated over the whole HIP envelope, excluding 
    any parameters after the HIP_MAC, as described in <a href="#cmac-processing" class="xref">Section 6.2</a>. The Initiator 
    MUST validate the HIP_MAC parameter.<a href="#section-5.3.4-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
<div id="ICMP">
<section id="section-5.4">
        <h3 id="name-icmp-messages">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-icmp-messages" class="section-name selfRef">ICMP Messages</a>
        </h3>
<p id="section-5.4-1">
  When a HIP implementation detects a problem with an incoming 
  packet, and it either cannot determine the identity of the 
  sender of the packet or does not have any existing HIP 
  association with the sender of the packet, it MAY respond with 
  an ICMP packet. Any such reply MUST be rate-limited as 
  described in <span>[<a href="#RFC4443" class="xref">RFC4443</a>]</span>. In 
  most cases, the ICMP packet has the Parameter Problem type (12 
  for ICMPv4, 4 for ICMPv6) and Code of 0.  The Pointer field 
  pointing to the field that caused the ICMP message to be 
  generated, for example to the first 8 bytes of a UDP payload 
  for "SPI is Unknown". The problem cases specified in Section 
  5.4. of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> also apply 
  to HIP DEX.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="packet_processing">
<section id="section-6">
      <h2 id="name-packet-processing">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-packet-processing" class="section-name selfRef">Packet Processing</a>
      </h2>
<p id="section-6-1">
       Due to the adopted protocol semantics and the inherited general packet
       structure, the packet processing in HIP DEX only differs from HIPv2 in
       very few places. Here, we focus on these differences and refer to
       Section 6 in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> otherwise.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">
    The processing of outgoing and incoming application data remains 
    the same as in HIP BEX (see Sections 6.1 and 6.2 in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>).<a href="#section-6-2" class="pilcrow">¶</a></p>
<div id="cmac-puzzle">
<section id="section-6.1">
        <h3 id="name-solving-the-puzzle">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-solving-the-puzzle" class="section-name selfRef">Solving the Puzzle</a>
        </h3>
<p id="section-6.1-1">
         The procedures for solving and verifying a puzzle in HIP DEX are
         strongly based on the corresponding procedures in HIPv2. The only
         exceptions are that HIP DEX does not use pre-computation of R1 packets
         and that RHASH is set to CMAC. As a result, the pre-computation step in
         Section 6.3 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> is skipped in HIP DEX.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-6.1-2">
          <dt id="section-6.1-2.1">Moreover, the Initiator solves a puzzle by computing:</dt>
          <dd style="margin-left: 1.5em" id="section-6.1-2.2">
             Ltrunc( CMAC( I, HIT-I | HIT-R | J ), K ) == 0<a href="#section-6.1-2.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<span class="break"></span><dl class="dlNewline" id="section-6.1-3">
          <dt id="section-6.1-3.1">Similarly, the Responder verifies a puzzle by computing:</dt>
          <dd style="margin-left: 1.5em" id="section-6.1-3.2">
             V := Ltrunc( CMAC( I, HIT-I | HIT-R | J ), K )<a href="#section-6.1-3.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-6.1-4">
         Apart from these modifications, the procedures defined in Section 6.3
         of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> also apply for HIP DEX.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cmac-processing">
<section id="section-6.2">
        <h3 id="name-hip_mac-calculation-and-ver">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-hip_mac-calculation-and-ver" class="section-name selfRef">HIP_MAC Calculation and Verification</a>
        </h3>
<p id="section-6.2-1">
         The following subsections define the actions for processing
         the HIP_MAC parameter.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<section id="section-6.2.1">
          <h4 id="name-cmac-calculation">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-cmac-calculation" class="section-name selfRef">CMAC Calculation</a>
          </h4>
<p id="section-6.2.1-1">
           The HIP_MAC calculation uses RHASH, i.e., CMAC, as the underlying
           cryptographic function. The scope of the calculation for HIP_MAC is:<a href="#section-6.2.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.2.1-2">
<pre>

CMAC: { HIP header | [ Parameters ] }

</pre><a href="#section-6.2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-6.2.1-3">
           where Parameters include all HIP parameters of the packet that is
           being calculated with Type values ranging from 1 to (HIP_MAC's Type
           value - 1) and exclude parameters with Type values greater or equal
           to HIP_MAC's Type value.<a href="#section-6.2.1-3" class="pilcrow">¶</a></p>
<p id="section-6.2.1-4">
           During HIP_MAC calculation, the following applies:<a href="#section-6.2.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2.1-5.1">
               In the HIP header, the Checksum field is set to zero.<a href="#section-6.2.1-5.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.2.1-5.2">
               In the HIP header, the Header Length field value is calculated
               to the beginning of the HIP_MAC parameter.<a href="#section-6.2.1-5.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-6.2.1-6">
           The parameter order is described in Section 5.2.1 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>.<a href="#section-6.2.1-6" class="pilcrow">¶</a></p>
<p id="section-6.2.1-7">
           The CMAC calculation and verification process is as follows:<a href="#section-6.2.1-7" class="pilcrow">¶</a></p>
<p id="section-6.2.1-8">Packet sender:<a href="#section-6.2.1-8" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.2.1-9">
   <li id="section-6.2.1-9.1">
               Create the HIP packet, without the HIP_MAC or any other
               parameter with greater Type value than the HIP_MAC parameter has.<a href="#section-6.2.1-9.1" class="pilcrow">¶</a>
</li>
            <li id="section-6.2.1-9.2">
               Calculate the Header Length field in the HIP header.<a href="#section-6.2.1-9.2" class="pilcrow">¶</a>
</li>
            <li id="section-6.2.1-9.3">
    Compute the CMAC using either HIP-gl or HIP-lg integrity 
    key retrieved from KEYMAT as defined in <a href="#keymat" class="xref">Section 6.3</a>. HIP-gl refers to 
    host with greater HIT value and HIP-lg refers to the 
    host with smaller HIT value.<a href="#section-6.2.1-9.3" class="pilcrow">¶</a>
</li>
            <li id="section-6.2.1-9.4">
               Add the HIP_MAC parameter to the packet and any parameter with
               greater Type value than the HIP_MAC's that may follow.<a href="#section-6.2.1-9.4" class="pilcrow">¶</a>
</li>
            <li id="section-6.2.1-9.5">Recalculate the Length field in the HIP header.<a href="#section-6.2.1-9.5" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-6.2.1-10">Packet receiver:<a href="#section-6.2.1-10" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.2.1-11">
 <li id="section-6.2.1-11.1">Verify the HIP header Length field.<a href="#section-6.2.1-11.1" class="pilcrow">¶</a>
</li>
            <li id="section-6.2.1-11.2">
               Remove the HIP_MAC parameter, as well as all other parameters
               that follow it with greater Type value, saving the contents if
               they will be needed later.<a href="#section-6.2.1-11.2" class="pilcrow">¶</a>
</li>
            <li id="section-6.2.1-11.3">
               Recalculate the HIP packet length in the HIP header and clear
               the Checksum field (set it to all zeros).<a href="#section-6.2.1-11.3" class="pilcrow">¶</a>
</li>
            <li id="section-6.2.1-11.4">
               Compute the CMAC using either HIP-gl or HIP-lg integrity key as
               defined in <a href="#keymat" class="xref">Section 6.3</a> and verify it against the
               received CMAC.<a href="#section-6.2.1-11.4" class="pilcrow">¶</a>
</li>
            <li id="section-6.2.1-11.5">
               Set Checksum and Header Length fields in the HIP header to
               original values. Note that the Checksum and Length fields
               contain incorrect values after this step.<a href="#section-6.2.1-11.5" class="pilcrow">¶</a>
</li>
          </ol>
</section>
</section>
</div>
<div id="keymat">
<section id="section-6.3">
        <h3 id="name-hip-dex-keymat-generation">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-hip-dex-keymat-generation" class="section-name selfRef">HIP DEX KEYMAT Generation</a>
        </h3>
<p id="section-6.3-1">
         The HIP DEX KEYMAT process is used to derive the keys for the Master
         Key SA as well as for the Pair-wise Key SA. The keys for the Master Key
         SA are based on the Diffie-Hellman derived key, Kij, which is produced
         during the HIP DEX handshake. The Initiator generates Kij during the
         creation of the I2 packet and the Responder generates Kij once it
         receives the I2 packet. This is why the I2 packet can already contain
         authenticated and/or encrypted information.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">
         The keys derived for the Pair-wise Key SA are not used during the HIP
         DEX handshake. Instead, these keys are made available as payload
         protection keys (e.g., for IPsec's ESP).<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3">
  The HIP DEX KEYMAT process is similar to the Hash-based Key 
  Derivation Function (HKDF) defined in <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span>, but uses CMAC in place of a cryptographic 
  hash.  DEX KEYMAT follows the CMAC usage guidance for a KDF 
  construct provided in <span>[<a href="#DOI_10.6028_NIST.SP.800-56C" class="xref">NIST.SP.800-56C</a>]</span>, <span>[<a href="#DOI_10.6028_NIST.SP.800-108" class="xref">NIST.SP.800-108</a>]</span> and 
  <span>[<a href="#DOI_10.1007_978-3-540-28628-8_30" class="xref">KeyDerivation</a>]</span>. This CMAC Key Derivation Function (CKDF) 
  consists of two components, CKDF-Extract and CKDF-Expand. The 
  CKDF-Extract function compresses a non-uniformly distributed 
  key, such as the output of a Diffie-Hellman key derivation, to 
  extract the key entropy into a fixed length output. The 
  CKDF-Expand function takes either the output of the Extract 
  function or directly uses a uniformly distributed key and 
  expands the length of the key, repeatedly distributing the key 
  entropy, to produce the keys needed.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
<p id="section-6.3-4">
         The key derivation for the Master Key SA employs always both the
         Extract and Expand phases. The Pair-wise Key SA needs only the Extract
         phase when the key is smaller or equal to 128 bits, but otherwise requires
         also the Expand phase.<a href="#section-6.3-4" class="pilcrow">¶</a></p>
<p id="section-6.3-5">
         The CKDF-Extract function is the following operation:<a href="#section-6.3-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.3-6">
<pre>

  CKDF-Extract(I, IKM, info) -&gt; PRK

  Inputs:
    I         Random #I, provided by the Responder, from the PUZZLE
              parameter
    Kij       Diffie-Hellman derived key
    IKM       IKMm for Master Key SA Input keying material
              or
              IKMp for Pair-wise Key SA Input keying material

    IKMm      Kij | I_NONCE
    IKMp      Kij | I_NONCE | (concatenated random values of the
                  ENCRYPTED_KEY parameters in the same order as
                  the HITs with sort(HIT-I | HIT-R))

    info      sort(HIT-I | HIT-R) | "CKDF-Extract"
               Where the input text: "CKDF-Extract"
               Is the hex string: 0x434b44462d45787472616374

  Output:
    PRK       a pseudorandom key (of RHASH_len/8 octets)


The pseudorandom key PRK is calculated as follows:

    PRK     = CMAC(I, IKM | info)

</pre><a href="#section-6.3-6" class="pilcrow">¶</a>
</div>
<p id="section-6.3-7">
         The CKDF-Expand function is the following operation:<a href="#section-6.3-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.3-8">
<pre>

  CKDF-Expand(PRK, info, L) -&gt; OKM

  Inputs:
    PRK       a pseudorandom key of at least RHASH_len/8 octets
              (either the output from the extract step or the
              concatenation of the random values of the
              ENCRYPTED_KEY parameters in the same order as the
              HITs with sort(HIT-I | HIT-R) in case of no extract)
    info      sort(HIT-I | HIT-R) | "CKDF-Expand"
              Where the input text: "CKDF-Expand"
              Is the hex string: 0x434b44462d457870616e64
    L         length of output keying material in octets
              (&lt;= 255*RHASH_len/8)

  Output:
    OKM        output keying material (of L octets)

The output keying material OKM is calculated as follows:

    N       =  ceil(L/(RHASH_len/8))
    T       =  T(1) | T(2) | T(3) | ... | T(N)
    OKM     =  first L octets of T

where

    T(0) = empty string (zero length)
    T(1) = CMAC(PRK, T(0) | info | 0x01)
    T(2) = CMAC(PRK, T(1) | info | 0x02)
    T(3) = CMAC(PRK, T(2) | info | 0x03)
    ...

(where the constant concatenated to the end of each T(n) is a
single octet.)

</pre><a href="#section-6.3-8" class="pilcrow">¶</a>
</div>
<p id="section-6.3-9">
          sort(HIT-I | HIT-R) is defined as the network byte order
          concatenation of the two HITs, with the smaller HIT preceding the
          larger HIT, resulting from the numeric comparison of the two HITs
          interpreted as positive (unsigned) 128-bit integers in network
          byte order.<a href="#section-6.3-9" class="pilcrow">¶</a></p>
<p id="section-6.3-10">
          The initial keys for the Master Key SA are drawn sequentially in the
          order that is determined by the numeric comparison of the two HITs,
          with the comparison method described in the previous paragraph. HOST_g
          denotes the host with the greater HIT value, and HOST_l the host with
          the lower HIT value.<a href="#section-6.3-10" class="pilcrow">¶</a></p>
<p id="section-6.3-11">
          The drawing order for initial keys:<a href="#section-6.3-11" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.3-12">
   <li id="section-6.3-12.1">HIP-gl encryption key for HOST_g's outgoing HIP packets<a href="#section-6.3-12.1" class="pilcrow">¶</a>
</li>
          <li id="section-6.3-12.2">HIP-gl integrity (CMAC) key for HOST_g's outgoing HIP
              packets<a href="#section-6.3-12.2" class="pilcrow">¶</a>
</li>
          <li id="section-6.3-12.3">HIP-lg encryption key for HOST_l's outgoing HIP packets<a href="#section-6.3-12.3" class="pilcrow">¶</a>
</li>
          <li id="section-6.3-12.4">HIP-lg integrity (CMAC) key for HOST_l's outgoing HIP
              packets<a href="#section-6.3-12.4" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-6.3-13">
          The number of bits drawn for a given algorithm is the "natural" size
          of the keys regarding the algorithm defined in the HIP_CIPHER. For
          the mandatory algorithms, the following size applies:<a href="#section-6.3-13" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.3-14">
          <dt id="section-6.3-14.1">AES</dt>
          <dd style="margin-left: 1.5em" id="section-6.3-14.2">128 bits<a href="#section-6.3-14.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-6.3-15">
          If other key sizes are used, they must be treated as different
          encryption algorithms and defined separately.<a href="#section-6.3-15" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-6.4">
        <h3 id="name-initiation-of-a-hip-diet-ex">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-initiation-of-a-hip-diet-ex" class="section-name selfRef">Initiation of a HIP Diet EXchange</a>
        </h3>
<p id="section-6.4-1">
  The initiation of a HIP DEX handshake proceeds as described in 
  Section 6.6 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>. The 
  I1 packet contents are specified in <a href="#I1" class="xref">Section 5.3.1</a>.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
</section>
<div id="i1process">
<section id="section-6.5">
        <h3 id="name-processing-incoming-i1-pack">
<a href="#section-6.5" class="section-number selfRef">6.5. </a><a href="#name-processing-incoming-i1-pack" class="section-name selfRef">Processing Incoming I1 Packets</a>
        </h3>
<p id="section-6.5-1">
  I1 packets in HIP DEX are handled almost identical to HIPv2 
  (see Section 6.7 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>). The main differences are that the 
  Responder SHOULD select a HIP DEX HIT Suite in the R1 
  response. Moreover, as R1 packets are neither covered by a 
  signature nor incur the overhead of generating an ephemeral 
  Diffie-Hellman key-pair, pre-computation of an R1 is only 
  marginally beneficial, but would incur additional memory 
  resources at the Responder. Hence, the R1 pre-computation 
  SHOULD be omitted in HIP DEX.<a href="#section-6.5-1" class="pilcrow">¶</a></p>
<p id="section-6.5-2">
         Correspondingly, the modified conceptual processing rules for
         responding to an I1 packet are as follows:<a href="#section-6.5-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.5-3">
 <li id="section-6.5-3.1">
             The Responder MUST check that the Responder's HIT in the received
             I1 packet is either one of its own HITs or NULL. Otherwise, it
             MUST drop the packet.<a href="#section-6.5-3.1" class="pilcrow">¶</a>
</li>
          <li id="section-6.5-3.2">
             If the Responder is in ESTABLISHED state, the Responder MAY
             respond to this with an R1 packet, prepare to drop an existing HIP
             security association with the peer, and stay at ESTABLISHED state.<a href="#section-6.5-3.2" class="pilcrow">¶</a>
</li>
          <li id="section-6.5-3.3">
             If the Responder is in I1-SENT state, it MUST make a comparison
             between the sender's HIT and its own (i.e., the receiver's) HIT.
             If the sender's HIT is greater than its own HIT, it should drop
             the I1 packet and stay at I1-SENT. If the sender's HIT is smaller
  than its own HIT, it SHOULD send the R1 packet and stay at 
  I1-SENT. The HIT comparison is performed as defined in 
  <a href="#keymat" class="xref">Section 6.3</a>.<a href="#section-6.5-3.3" class="pilcrow">¶</a>
</li>
          <li id="section-6.5-3.4">
             If the implementation chooses to respond to the I1 packet with an
             R1 packet, it creates a new R1 according to the format described
             in <a href="#R1" class="xref">Section 5.3.2</a>. It chooses the HI based on the
             destination HIT and the DH_GROUP_LIST in the I1 packet. If the
             implementation does not support the DH group required by the
             Initiator or if the destination HIT in the I1 packet does not
             match the required DH group, it selects the mutually preferred and
             supported DH group based on the DH_GROUP_LIST parameter in the I1
             packet. The implementation includes the corresponding ECDH public
             key in the HOST_ID parameter. If no suitable DH Group ID was
             contained in the DH_GROUP_LIST in the I1 packet, it sends an R1
             packet with any suitable ECDH public key.<a href="#section-6.5-3.4" class="pilcrow">¶</a>
</li>
          <li id="section-6.5-3.5">
             If the received Responder's HIT in the I1 packet is not NULL, the
             Responder's HIT in the R1 packet MUST match the destination HIT in
             the I1 packet. Otherwise, the Responder MUST select a HIT with the
             same HIT Suite as the Initiator's HIT. If this HIT Suite is not
             supported by the Responder, it SHOULD select a REQUIRED HIT Suite
             from Section 5.2.10 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>, which is
             currently RSA/DSA/SHA-256. Other than that, selecting the HIT is a
             local policy matter.<a href="#section-6.5-3.5" class="pilcrow">¶</a>
</li>
          <li id="section-6.5-3.6">
  The Responder expresses its supported HIP transport 
  formats in the TRANSPORT_FORMAT_LIST as described in 
  Section 5.2.11 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>. The Responder MUST provide at least 
  one payload transport format type.<a href="#section-6.5-3.6" class="pilcrow">¶</a>
</li>
          <li id="section-6.5-3.7">
             The Responder sends the R1 packet to the source IP address of the
             I1 packet.<a href="#section-6.5-3.7" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-6.5-4">
  Note that only steps 4 and 5 have been changed with regard to 
  the processing rules of HIPv2. The considerations about R1 
  management (except pre-computation) and malformed I1 packets 
  in Sections 6.7.1 and 6.7.2 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> likewise apply to HIP DEX.<a href="#section-6.5-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="inr1">
<section id="section-6.6">
        <h3 id="name-processing-incoming-r1-pack">
<a href="#section-6.6" class="section-number selfRef">6.6. </a><a href="#name-processing-incoming-r1-pack" class="section-name selfRef">Processing Incoming R1 Packets</a>
        </h3>
<p id="section-6.6-1">
  R1 packets in HIP DEX are handled identically to HIPv2 (see 
  Section 6.8 in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>) with 
  the following exceptions: HIP DEX uses ECDH public keys as HIs 
  and does not employ signatures.<a href="#section-6.6-1" class="pilcrow">¶</a></p>
<p id="section-6.6-2">
  As R1 is not signed and no proof is possible in the 
  authenticity of its contents, all processing of the R1 is 
  provisional until verified by the R2 processing.<a href="#section-6.6-2" class="pilcrow">¶</a></p>
<p id="section-6.6-3">
         The modified conceptual processing rules for responding to an R1
         packet are as follows:<a href="#section-6.6-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.6-4">
 <li id="section-6.6-4.1">
  A system receiving an R1 MUST first check to see if it has 
  sent an I1 packet to the originator of the R1 packet 
  (i.e., it has a HIP association that is in state I1-SENT 
  and that is associated with the HITs in the R1). Unless 
  the I1 packet was sent in opportunistic mode (see Section 
  4.1.8 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>), the 
  IP addresses in the received R1 packet SHOULD be ignored 
  by the R1 processing and, when looking up the correct HIP 
  association, the received R1 packet SHOULD be matched 
  against the associations using only the HITs. If a match 
  exists, the system processes the R1 packet as described 
  below.<a href="#section-6.6-4.1" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.2">
             Otherwise, if the system is in any state other than I1-SENT or
             I2-SENT with respect to the HITs included in the R1 packet, it
             SHOULD silently drop the R1 packet and remain in the current state.<a href="#section-6.6-4.2" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.3">
             If the HIP association state is I1-SENT or I2-SENT, the received
             Initiator's HIT MUST correspond to the HIT used in the original I1
             packet. Also, the Responder's HIT MUST correspond to the one used
             in the I1 packet, unless this packet contained a NULL HIT.<a href="#section-6.6-4.3" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.4">
             If the HIP association state is I1-SENT, and multiple valid R1
             packets are present, the system MUST select from among the R1
             packets with the largest R1 generation counter.<a href="#section-6.6-4.4" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.5">
             The system MUST check that the Initiator's HIT Suite is contained
             in the HIT_SUITE_LIST parameter in the R1 packet (i.e., the
             Initiator's HIT Suite is supported by the Responder). If the HIT
             Suite is supported by the Responder, the system proceeds normally.
             Otherwise, the system MAY stay in state I1-SENT and restart the
             HIP DEX handshake by sending a new I1 packet with an Initiator HIT
             that is supported by the Responder and hence is contained in the
             HIT_SUITE_LIST in the R1 packet. The system MAY abort the
             handshake if no suitable source HIT is available. The system
             SHOULD wait for an acceptable time span to allow further R1
             packets with higher R1 generation counters or different HIT and
             HIT Suites to arrive before restarting or aborting the HIP DEX
             handshake.<a href="#section-6.6-4.5" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.6">
             The system MUST check that the DH Group ID in the HOST_ID
             parameter in the R1 matches the first DH Group ID in the
             Responder's DH_GROUP_LIST in the R1 packet, and also that this
             Group ID corresponds to a value that was included in the
             Initiator's DH_GROUP_LIST in the I1 packet. If the DH Group ID of
             the HOST_ID parameter does not express the Responder's best
             choice, the Initiator can conclude that the DH_GROUP_LIST in the
             I1 or R1 packet was adversely modified. In such a case, the
             Initiator MAY send a new I1 packet; however, it SHOULD NOT change
             its preference in the DH_GROUP_LIST in the new I1 packet.
             Alternatively, the Initiator MAY abort the HIP DEX handshake.
             Moreover, if the DH Group ID indicated in the HOST_ID parameter
             does not match the DH Group ID of the HI employed by the
             Initiator, the system SHOULD wait for an acceptable time span to
             allow further R1 packets with different DH Group IDs to arrive
             before restarting or aborting the HIP DEX handshake. When
  restarting the handshake, the Initiator MUST consult local 
  policies (see <a href="#sec-policy" class="xref">Section 7</a>) regarding the use of another, mutually 
  supported DH group for the subsequent handshake with the 
  Responder.<a href="#section-6.6-4.6" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.7">
             If the HIP association state is I2-SENT, the system MAY re-enter
             state I1-SENT and process the received R1 packet if it has a
             larger R1 generation counter than the R1 packet responded to
             previously.<a href="#section-6.6-4.7" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.8">
             The system SHOULD attempt to validate the HIT against the received
             Host Identity by using the received Host Identity to construct a
             HIT and verify that it matches the Sender's HIT.<a href="#section-6.6-4.8" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.9">
             The system MUST store the received R1 generation counter for
             future reference.<a href="#section-6.6-4.9" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.10">
             The system attempts to solve the puzzle in the R1 packet. The
             system MUST terminate the search after exceeding the remaining
             lifetime of the puzzle. If the puzzle is not successfully solved,
             the implementation MAY either resend the I1 packet within the
             retry bounds or abandon the HIP base exchange.<a href="#section-6.6-4.10" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.11">
             The system computes standard Diffie-Hellman keying material
             according to the public value and Group ID provided in the HOST_ID
             parameter. The Diffie-Hellman keying material Kij is used for key
             extraction as specified in <a href="#keymat" class="xref">Section 6.3</a>.<a href="#section-6.6-4.11" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.12">
             The system selects the HIP_CIPHER ID from the choices presented in
             the R1 packet and uses the selected values subsequently when
             generating and using encryption keys, and when sending the I2
             packet. If the proposed alternatives are not acceptable to the
             system, it MAY either resend an I1 packet within the retry bounds
             or abandon the HIP base exchange.<a href="#section-6.6-4.12" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.13">
             The system chooses one suitable transport format from the
             TRANSPORT_FORMAT_LIST and includes the respective transport format
             parameter in the subsequent I2 packet.<a href="#section-6.6-4.13" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.14">
             The system initializes the remaining variables in the associated
             state, including Update ID counters.<a href="#section-6.6-4.14" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.15">
             The system prepares and sends an I2 packet as described in <a href="#I2" class="xref">Section 5.3.3</a>.<a href="#section-6.6-4.15" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.16">
             The system SHOULD start a timer whose timeout value SHOULD be
             larger than the worst-case anticipated RTT, and MUST increment a
             trial counter associated with the I2 packet. The sender SHOULD
             retransmit the I2 packet upon a timeout and restart the timer, up
             to a maximum of I2_RETRIES_MAX tries.<a href="#section-6.6-4.16" class="pilcrow">¶</a>
</li>
          <li id="section-6.6-4.17">
             If the system is in state I1-SENT, it SHALL transition to state
             I2-SENT. If the system is in any other state, it remains in the
             current state.<a href="#section-6.6-4.17" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-6.6-5">
         Note that step 4 from the original processing rules of HIPv2 (signature
         verification) has been removed in the above processing rules for HIP
         DEX. Moreover, step 7 of the original processing rules has been adapted
         in step 6 above to account for the fact that HIP DEX uses ECDH public
         keys as HIs. The considerations about malformed R1 packets in Sections
         6.8.1 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> also apply to HIP DEX.<a href="#section-6.6-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ini2">
<section id="section-6.7">
        <h3 id="name-processing-incoming-i2-pack">
<a href="#section-6.7" class="section-number selfRef">6.7. </a><a href="#name-processing-incoming-i2-pack" class="section-name selfRef">Processing Incoming I2 Packets</a>
        </h3>
<p id="section-6.7-1">
  The processing of I2 packets follows similar rules as HIPv2 
  (see Section 6.9 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>). The main differences to HIPv2 are that 
  HIP DEX introduces a new session key exchange via the 
  ENCRYPTED_KEY parameter as well as an I2 reception 
  acknowledgement for retransmission purposes. Moreover, with 
  HIP DEX the Initiator is responsible for triggering 
  retransmissions, whereas the Responder merely replies to 
  received I2 packets.<a href="#section-6.7-1" class="pilcrow">¶</a></p>
<p id="section-6.7-2">
         The modified HIP DEX conceptual processing rules for responding to an
         I2 packet are:<a href="#section-6.7-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.7-3">
 <li id="section-6.7-3.1">
  The system MAY perform checks to verify that the I2 packet 
  corresponds to a recently sent R1 packet. Such checks are 
  implementation dependent. See Appendix A in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> for a description of 
  an example implementation.<a href="#section-6.7-3.1" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.2">
             The system MUST check that the Responder's HIT corresponds to one
             of its own HITs and MUST drop the packet otherwise.<a href="#section-6.7-3.2" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.3">
             The system MUST further check that the Initiator's HIT Suite is
             supported. The Responder SHOULD silently drop I2 packets with
             unsupported Initiator HITs.<a href="#section-6.7-3.3" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.4">
             The system MUST validate the Initiator's HI per 
             <a href="#PK_Validate" class="xref">Section 9.3</a>.<a href="#section-6.7-3.4" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.5">
             If the system's state machine is in the R2-SENT state, the system
             MUST check to see if the newly received I2 packet is similar to
             the one that triggered moving to R2-SENT. If so, it MUST
             retransmit a previously sent R2 packet and reset the R2-SENT
             timer. The system SHOULD re-use the previously established state
             to re-create the corresponding R2 packet in order to prevent
             unnecessary computation overhead.<a href="#section-6.7-3.5" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.6">
             If the system's state machine is in the I2-SENT state, the system
  MUST make a comparison between its local and sender's HITs 
  (similarly as in <a href="#keymat" class="xref">Section 6.3</a>). If the local HIT is smaller than the 
  sender's HIT, it should drop the I2 packet, use the peer 
  Diffie-Hellman key, ENCRYPTED_KEY keying material and 
  nonce #I from the R1 packet received earlier, and get the 
  local Diffie-Hellman key, ENCRYPTED_KEY keying material, 
  and nonce #J from the I2 packet sent to the peer earlier. 
  Otherwise, the system processes the received I2 packet and 
  drops any previously derived Diffie-Hellman keying 
  material Kij and ENCRYPTED_KEY keying material it might 
  have generated upon sending the I2 packet previously. The 
  peer Diffie-Hellman key, ENCRYPTED_KEY, and the nonce #J 
  are taken from the just arrived I2 packet. The local 
  Diffie-Hellman key, ENCRYPTED_KEY keying material, and the 
  nonce #I are the ones that were sent earlier in the R1 
  packet.<a href="#section-6.7-3.6" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.7">
             If the system's state machine is in the I1-SENT state, and the
             HITs in the I2 packet match those used in the previously sent I1
             packet, the system uses this received I2 packet as the basis for
             the HIP association it was trying to form, and stops
             retransmitting I1 packets (provided that the I2 packet passes the
             additional checks below).<a href="#section-6.7-3.7" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.8">
             If the system's state machine is in any state other than R2-SENT,
             the system SHOULD check that the echoed R1 generation counter in
             the I2 packet is within the acceptable range if the counter is
             included. Implementations MUST accept puzzles from the current
             generation and MAY accept puzzles from earlier generations. If the
             generation counter in the newly received I2 packet is outside the
             accepted range, the I2 packet is stale (and perhaps replayed) and
             SHOULD be dropped.<a href="#section-6.7-3.8" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.9">
             The system MUST validate the solution to the puzzle as described
             in <a href="#cmac-puzzle" class="xref">Section 6.1</a>.<a href="#section-6.7-3.9" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.10">
             The I2 packet MUST have a single value in the HIP_CIPHER
             parameter, which MUST match one of the values offered to the
             Initiator in the R1 packet.<a href="#section-6.7-3.10" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.11">
  The system MUST derive Diffie-Hellman keying material Kij 
  based on the public value and Group ID in the HOST_ID 
  parameter. This keying material is used to derive the keys 
  of the Master Key SA as described in <a href="#keymat" class="xref">Section 6.3</a>. If the Diffie-Hellman Group ID is 
  unsupported, the I2 packet is silently dropped. If the 
  processing time for the derivation of the Diffie-Hellman 
  keying material Kij is likely to cause premature I2 
  retransmissions by the Initiator, the system MAY send a 
  NOTIFY packet before starting the key derivation process. 
  The NOTIFY packet contains a NOTIFICATION parameter with 
  Notify Message Type I2_ACKNOWLEDGEMENT. The NOTIFICATION 
  parameter indicates the anticipated remaining processing 
  time for the I2 packet in milliseconds as two-octet 
  Notification Data.<a href="#section-6.7-3.11" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.12">
             The implementation SHOULD also verify that the Initiator's HIT in
             the I2 packet corresponds to the Host Identity sent in the I2
             packet. (Note: some middleboxes may not be able to make this
             verification.)<a href="#section-6.7-3.12" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.13">
  The system MUST process the TRANSPORT_FORMAT_LIST 
  parameter. Other documents specifying transport formats 
  (e.g., <span>[<a href="#RFC7402" class="xref">RFC7402</a>]</span>) contain 
  specifications for handling any specific transport 
  selected.<a href="#section-6.7-3.13" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.14">
             The system MUST verify the HIP_MAC according to the procedures in
             <a href="#cmac-processing" class="xref">Section 6.2</a>.<a href="#section-6.7-3.14" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.15">
             If the checks above are valid, then the system proceeds with
             further I2 processing; otherwise, it discards the I2 and its state
             machine remains in the same state.<a href="#section-6.7-3.15" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.16">
  The system MUST decrypt the keying material from the 
  ENCRYPTED_KEY parameter. This keying material is a partial 
  input to the key derivation process for the Pair-wise Key 
  SA (see <a href="#keymat" class="xref">Section 6.3</a>).<a href="#section-6.7-3.16" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.17">
             The system initializes the remaining variables in the associated
             state, including Update ID counters.<a href="#section-6.7-3.17" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.18">
  Upon successful processing of an I2 packet when the 
  system's state machine is in state UNASSOCIATED, I1-SENT, 
  I2-SENT, or R2-SENT, an R2 packet is sent as described in 
  <a href="#R2" class="xref">Section 5.3.4</a> and the system's 
  state machine transitions to state R2-SENT.<a href="#section-6.7-3.18" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.19">
  Upon successful processing of an I2 packet when the 
  system's state machine is in state ESTABLISHED, the old 
  HIP association is dropped and a new one is installed, an 
  R2 packet is sent as described in <a href="#R2" class="xref">Section 5.3.4</a>, and the system's state machine 
  transitions to R2-SENT.<a href="#section-6.7-3.19" class="pilcrow">¶</a>
</li>
          <li id="section-6.7-3.20">
             Upon the system's state machine transitioning to R2-SENT, the
             system starts a timer. The state machine transitions to
             ESTABLISHED if some data has been received on the incoming HIP
             association, or an UPDATE packet has been received (or some other
             packet that indicates that the peer system's state machine has
             moved to ESTABLISHED). If the timer expires (allowing for a
             maximal amount of retransmissions of I2 packets), the state
             machine transitions to ESTABLISHED.<a href="#section-6.7-3.20" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-6.7-4">
         Note that steps 11 (encrypted HOST_ID) and 15 (signature verification)
         from the original processing rules of HIPv2 have been removed in the
         above processing rules for HIP DEX. Moreover, step 10 of the HIPv2
         processing rules has been adapted to account for optional extension of
         the retransmission mechanism. Step 16 has been added to the processing
         rules in this document. The considerations about malformed I2 packets
         in Sections 6.9.1 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> also apply to HIP DEX.<a href="#section-6.7-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="inc_r2">
<section id="section-6.8">
        <h3 id="name-processing-incoming-r2-pack">
<a href="#section-6.8" class="section-number selfRef">6.8. </a><a href="#name-processing-incoming-r2-pack" class="section-name selfRef">Processing Incoming R2 Packets</a>
        </h3>
<p id="section-6.8-1">
  R2 packets in HIP DEX are handled identically to HIPv2 (see 
  Section 6.10 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>) 
  with the following exceptions: HIP DEX introduces a new 
  session key exchange via the ENCRYPTED_KEY parameter and does 
  not employ signatures.<a href="#section-6.8-1" class="pilcrow">¶</a></p>
<p id="section-6.8-2">
         The modified conceptual processing rules for responding to an R2
         packet are as follows:<a href="#section-6.8-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.8-3">
 <li id="section-6.8-3.1">
             If the system is in any other state than I2-SENT, the R2 packet is
             silently dropped.<a href="#section-6.8-3.1" class="pilcrow">¶</a>
</li>
          <li id="section-6.8-3.2">
             The system MUST verify that the HITs in use correspond to the
             HITs that were received in the R1 packet that caused the
             transition to the I2-SENT state.<a href="#section-6.8-3.2" class="pilcrow">¶</a>
</li>
          <li id="section-6.8-3.3">
             The system MUST verify the HIP_MAC according to the procedures in
             <a href="#cmac-processing" class="xref">Section 6.2</a>.<a href="#section-6.8-3.3" class="pilcrow">¶</a>
</li>
          <li id="section-6.8-3.4">
             The system MUST re-evaluate the DH_GROUP_LIST, HIP_CIPHER,
             HIT_SUITE_LIST, and TRANSPORT_FORMAT_LIST parameters in the R2
             packet and compare the results against the chosen suites.<a href="#section-6.8-3.4" class="pilcrow">¶</a>
</li>
          <li id="section-6.8-3.5">
             The system MUST validate the Responder's HI per 
             <a href="#PK_Validate" class="xref">Section 9.3</a>.<a href="#section-6.8-3.5" class="pilcrow">¶</a>
</li>
          <li id="section-6.8-3.6">
  If any of the checks above fail, there is a high 
  probability of an ongoing man-in-the-middle or other 
  security attack. The system SHOULD act accordingly (e.g. 
  aborting with logging), based on its local policy.<a href="#section-6.8-3.6" class="pilcrow">¶</a>
</li>
          <li id="section-6.8-3.7">
  The system MUST decrypt the keying material from the 
  ENCRYPTED_KEY parameter. This keying material is a partial 
  input to the key derivation process for the Pair-wise Key 
  SA (see <a href="#keymat" class="xref">Section 6.3</a>).<a href="#section-6.8-3.7" class="pilcrow">¶</a>
</li>
          <li id="section-6.8-3.8">
             Upon successful processing of the R2 packet, the state machine
             transitions to state ESTABLISHED.<a href="#section-6.8-3.8" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-6.8-4">
         Note that step 4 (signature verification) from the original processing
         rules of HIPv2 has been replaced with a negotiation re-evaluation in
         the above processing rules for HIP DEX. Moreover, step 6 has been
         added to the processing rules.<a href="#section-6.8-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="inc_notify">
<section id="section-6.9">
        <h3 id="name-processing-incoming-notify-">
<a href="#section-6.9" class="section-number selfRef">6.9. </a><a href="#name-processing-incoming-notify-" class="section-name selfRef">Processing Incoming NOTIFY Packets</a>
        </h3>
<p id="section-6.9-1">
         Processing of NOTIFY packets is OPTIONAL. If processed, any errors in
         a received NOTIFICATION parameter SHOULD be logged. Received errors
         MUST be considered only as informational, and the receiver SHOULD NOT
         change its HIP state purely based on the received NOTIFY packet.<a href="#section-6.9-1" class="pilcrow">¶</a></p>
<p id="section-6.9-2">
         If a NOTIFY packet is received in state I2-SENT, this packet is an
         I2 reception acknowledgement of the optional retransmission mechanism
         extension and SHOULD be processed. The following steps define the
         conceptual processing rules for such incoming NOTIFY packets in state
         I2-SENT:<a href="#section-6.9-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.9-3">
 <li id="section-6.9-3.1">
             The system MUST verify that the HITs in use correspond to the HITs
             that were received in the R1 packet that caused the transition to
             the I2-SENT state. If this check fails, the NOTIFY packet MUST
             be dropped silently.<a href="#section-6.9-3.1" class="pilcrow">¶</a>
</li>
          <li id="section-6.9-3.2">
             If the NOTIFY packet contains a NOTIFICATION parameter with Notify
             Message Type I2_ACKNOWLEDGEMENT, the system SHOULD set the I2
             retransmission timer to the I2 processing time indicated in the
             NOTIFICATION parameter plus half the RTT-based timeout value. The
             system MUST NOT set the retransmission timeout to a higher value
             than allowed by a local policy. Moreover, the system SHOULD reset
             the I2 retransmission timer to the RTT-based timeout value after
             the next I2 retransmission.<a href="#section-6.9-3.2" class="pilcrow">¶</a>
</li>
        </ol>
</section>
</div>
<section id="section-6.10">
        <h3 id="name-processing-update-close-and">
<a href="#section-6.10" class="section-number selfRef">6.10. </a><a href="#name-processing-update-close-and" class="section-name selfRef">Processing UPDATE, CLOSE, and CLOSE_ACK Packets</a>
        </h3>
<p id="section-6.10-1">
  UPDATE, CLOSE, and CLOSE_ACK packets are handled similarly in 
  HIP DEX as in HIPv2 (see Sections 6.11, 6.12, 6.14, and 6.15 
  of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>). The only 
  difference is the that the HIP_SIGNATURE is never present and, 
  therefore, is not required to be processed by the receiving 
  party.<a href="#section-6.10-1" class="pilcrow">¶</a></p>
<p id="section-6.10-2">
  <span>[<a href="#RFC7402" class="xref">RFC7402</a>]</span> specifies the 
  rekeying of an existing HIP SA using the UPDATE message. This 
  rekeying procedure can also be used with HIP DEX. However, 
  where rekeying involves a new Diffie-Hellman key exchange, HIP 
  DEX peers MUST establish a new HIP association in order to 
  create a new Pair-wise Key SA due to the use of static ECDH 
  key-pairs with HIP DEX.<a href="#section-6.10-2" class="pilcrow">¶</a></p>
</section>
<div id="loss">
<section id="section-6.11">
        <h3 id="name-handling-state-loss">
<a href="#section-6.11" class="section-number selfRef">6.11. </a><a href="#name-handling-state-loss" class="section-name selfRef">Handling State Loss</a>
        </h3>
<p id="section-6.11-1">
         Implementors MAY choose to use non-volatile, secure storage for HIP
         states in order for them to survive a system reboot. If no secure
         storage capabilities are available, the system SHOULD delete the
         corresponding HIP state, including the keying material. If the
         implementation does drop the state (as RECOMMENDED), it MUST also drop
         the peer's R1 generation counter value, unless a local policy
         explicitly defines that the value of that particular host is stored.<a href="#section-6.11-1" class="pilcrow">¶</a></p>
<p id="section-6.11-2">
  Storing of the R1 generation counter values and <span><a href="#encrypted_key" class="xref">ENCRYPTED_KEY 
  counter</a> (<a href="#encrypted_key" class="xref">Section 5.2.5</a>)</span> MUST be configured by explicit HITs.<a href="#section-6.11-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-policy">
<section id="section-7">
      <h2 id="name-hip-policies">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-hip-policies" class="section-name selfRef">HIP Policies</a>
      </h2>
<p id="section-7-1">
       There are a number of variables that will influence the HIP exchanges
       that each host must support. The value of puzzle difficulty K used in the HIP R1 must be
       chosen with care. Values for the K that are too high will exclude clients
       with weak CPUs because these devices cannot solve the puzzle within a
       reasonable amount of time. The K value should only be raised if a Responder is
       under high load, i.e., it cannot process all incoming HIP handshakes any
       more.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">
       If a Responder is not under high load, K SHOULD be 0.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">
       All HIP DEX implementations SHOULD provide for an Access Control List
       (ACL), representing for which hosts they accept HIP diet exchanges, and
       the preferred transport format and local lifetimes. Wildcarding SHOULD be
       supported for such ACLs.<a href="#section-7-3" class="pilcrow">¶</a></p>
<div id="hit-acl">
<section id="section-7.1">
        <h3 id="name-hit-hi-acl">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-hit-hi-acl" class="section-name selfRef">HIT/HI ACL</a>
        </h3>
<p id="section-7.1-1">
    Both the Initiator and Responder SHOULD implement an ACL. 
    Minimally, these ACLs will be a list of trusted HIT/HIs.  They 
    may also contain the password used in the password-based 
    two-factor authentication (<a href="#twofactor" class="xref">Appendix B</a>) and preferred HIT Suite.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">
    ACL processing is applied to all HIP packets.  A HIP peer MAY 
    reject any packet where the Receiver's HIT is not in the ACL. 
    The HI (in the R1, I2, and optionally NOTIFY packets) MUST be 
    validated as well, when present in the ACL.  This is the defense 
    against collision and second-image attacks on the HIT 
    generation.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1-3">
    Devices with no input mechanism (e.g. sensors) SHOULD accept R1 
    packets from unknown HITs.  These R1 packets SHOULD contain the 
    start of the password-based two-factor authentication .  If the 
    R2 for this HIT indicates success, then the device may add this 
    HIT/HI to its ACL for future use.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<p id="section-7.1-4">
    Devices unable to manage an ACL (e.g. sensors) are subject to 
    MITM attacks, even with the use of the password authentication 
    (password theft by attacker).  As long as the other peer (e.g. 
    sensor controller) does use an ACL, the attack can be recognized 
    there and addressed.  This is often seen where the sensor does 
    not appear as properly operating with the controller, as the 
    attacker cannot impersonate information in the ACL.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="dex-bex-interop">
<section id="section-8">
      <h2 id="name-interoperability-between-hi">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-interoperability-between-hi" class="section-name selfRef">Interoperability between HIP DEX and HIPv2</a>
      </h2>
<p id="section-8-1">
       HIP DEX and HIPv2 both use the same protocol number and packet formats.
       Hence, an implementation that either supports HIP DEX or HIPv2 has to be
       able to detect the dialect that the peer is speaking. This section
       outlines how a HIP DEX implementation can achieve such detection for
       the two relevant cases where:<a href="#section-8-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8-2">
 <li id="section-8-2.1">
          the Initiator supports HIP DEX and the Responder supports HIP BEX,<a href="#section-8-2.1" class="pilcrow">¶</a>
</li>
        <li id="section-8-2.2">
          the Initiator supports HIP BEX and the Responder supports HIP DEX.<a href="#section-8-2.2" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-8-3">
       In the first case, the HIP DEX implementation (Initiator) inspects the
       Responder's HIT prior to sending the I1 packet. If the OGA ID field of
       this HIT does not indicate the HIP DEX HIT Suite ID, the HIP DEX
       implementation cancels the handshake. If the Responder is unknown prior
       to sending the I1 packet (i.e., opportunistic mode), the HIP DEX
       implementation performs the above check on reception of the R1 packet and
       cancels the handshake in case of a negative result. In both failure
       scenarios, the implementation should report an error to the user via
       appropriate means.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4">
       In the second case, the HIP DEX implementation (Responder)
       inspects the Initiator's HIT on reception of an I1 packet. If
       the OGA ID field of this HIT does not indicate the HIP DEX HIT
       Suite ID, the HIP DEX implementation cancels the handshake and
       sends an ICMP packet with type Parameter Problem, with the
       Pointer pointing to the source HIT, to the Initiator. As an
    off-path adversary could also send such an ICMP packet with the 
    aim to prevent the HIP DEX handshake from completing, the 
    Initiator SHOULD NOT react to an ICMP message before 
    retransmission counter reaches I1_RETRIES_MAX in its state 
    machine (see Table 3 in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>).<a href="#section-8-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-considerations">
<section id="section-9">
      <h2 id="name-security-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-9-1">
    HIP DEX closely resembles HIPv2. As such, the security 
    considerations discussed in Section 8 of <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span> similarly apply to HIP DEX. HIP DEX, however, 
    replaces the SIGMA-based authenticated Diffie-Hellman key 
    exchange of HIPv2 with an exchange of random keying material 
    that is encrypted with a Diffie-Hellman derived key. Both the 
    Initiator and Responder contribute to this keying material. As a 
    result, the following additional security considerations apply 
    to HIP DEX:<a href="#section-9-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9-2.1">
   The strength of the keys for both the Master and Pair-wise 
   Key SAs is based on the quality of the random keying material 
   generated by the Initiator and the Responder. As either peer 
   may be a sensor or an actuator device, there is a natural 
   concern about the quality of its random number generator.  
   Thus at least a CSPRNG SHOULD be used.<a href="#section-9-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-2.2">
   HIP DEX lacks the Forward Secrecy (FS) property of HIPv2. 
   Consequently, if an HI is compromised, all previous HIP 
   connections protected with that HI are compromised as 
   explained in <a href="#intro" class="xref">Section 1</a>.<a href="#section-9-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-2.3">
   The HIP DEX HIT generation may present new attack 
   opportunities. Hence, HIP DEX HITs MUST NOT be used as the 
   only means to identify a peer in an ACL. Instead, the use of 
   the peer's HI is recommended as explained in <a href="#HI" class="xref">Section 3</a>.<a href="#section-9-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-2.4">
   The R1 packet is unauthenticated and offers an adversary a 
   new attack vector against the Initiator. This is mitigated by 
   only processing a received R1 packet when the Initiator has 
   previously sent a corresponding I1 packet. Moreover, the 
   Responder repeats the DH_GROUP_LIST, HIP_CIPHER, 
   HIT_SUITE_LIST, and TRANSPORT_FORMAT_LIST parameters in the 
   R2 packet in order to enable the Initiator to verify that 
   these parameters have not been modified by an attacker in the 
   unprotected R1 packet as explained in <a href="#inc_r2" class="xref">Section 6.8</a>.<a href="#section-9-2.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-2.5">
   Contrary to HIPv2, HIP DEX does not provide for end-point 
   anonymity for the Initiator or Responder. Thus, any signaling 
   that indicates such anonymity should be ignored as explained 
   in <a href="#dex" class="xref">Section 1.1</a>.<a href="#section-9-2.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-2.6">
   It is critical to properly manage the <span><a href="#encrypted_key" class="xref">ENCRYPTED_KEY 
   counter</a> (<a href="#encrypted_key" class="xref">Section 5.2.5</a>)</span>.  If non-volatile store is used to maintain 
   HIP state across system resets, then this counter MUST be 
   part of the state store.<a href="#section-9-2.6" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-9-3">
       The optional retransmission extension of HIP DEX is based on a NOTIFY
       packet that the Responder can use to inform the Initiator about the
       reception of an I2 packet. The Responder, however, cannot protect the
       authenticity of this packet as it did not yet set up the Master Key SA.
       Hence, an eavesdropping adversary may send spoofed reception
       acknowledgements for an overheard I2 packet and signal an arbitrary I2
       processing time to the Initiator. The adversary can, e.g., indicate a
       lower I2 processing time than actually required by the Responder in
       order to cause premature retransmissions. To protect against this
       attack, the Initiator SHOULD set the NOTIFY-based timeout value to the
       maximum indicated packet processing time in case of conflicting NOTIFY
       packets. This allows the legitimate Responder to extend the
       retransmission timeout to the intended length. The adversary, however,
       can still arbitrarily delay the protocol handshake beyond the
       Responder's actual I2 processing time. To limit the extend of such a
       maliciously induced handshake delay, this specification additionally
       requires the Initiator not to set the NOTIFY-based timeout value higher
       than allowed by a local policy.<a href="#section-9-3" class="pilcrow">¶</a></p>
<p id="section-9-4">
       <a href="#I1" class="xref">Section 5.3.1</a> mentions that implementations need to be
       able to handle storms of I1 packets. Contrary to HIPv2, R1 packets cannot be
       pre-computed in HIP DEX and also the state machine does not include an
       "R1_SENT" state (that would enable caching of R1 packets). Therefore,
       an implementation has to cache information (e.g., at
       least the HITs) from incoming I1 packets and rate control
       the incoming I1 packets to avoid unnecessary packet processing
       during I1 packet storms.<a href="#section-9-4" class="pilcrow">¶</a></p>
<div id="DEX_Caution">
<section id="section-9.1">
        <h3 id="name-caution-on-using-hip-dex-ra">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-caution-on-using-hip-dex-ra" class="section-name selfRef">Caution on using HIP DEX rather than HIP BEX</a>
        </h3>
<p id="section-9.1-1">
 Due to the substantially reduced security guarantees of HIP DEX 
 compared to HIP BEX, HIP DEX MUST only be used when at least one of 
 the two endpoints is a class 0 or 1 constrained device defined in 
 Section 3 of [RFC7228]).  HIP DEX MUST NOT be used when both 
 endpoints are class 2 devices or unconstrained.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="AES-CTR">
<section id="section-9.2">
        <h3 id="name-use-of-aes-ctr-for-hip-para">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-use-of-aes-ctr-for-hip-para" class="section-name selfRef">Use of AES-CTR for HIP Parameter Encryption</a>
        </h3>
<p id="section-9.2-1">
    AES-CTR is a basic cipher mode that does not accept an 
    initialization vector to allow for key re-use.  In essence, it 
    stretches the initial key into a much longer keystream (akin to 
    a stream cipher) that is used like a one-time pad.  Any reuse of 
    that keystream breaks the confidentiality of the protected data, 
    so when using AES-CTR, care must be taken to ensure that within 
    a given keystream the counter value is never reused, and that 
    any given key is only used to generate a single keystream.  The 
    integration of AES-CTR into IPsec ESP (RFC 3686) used by HIP 
    (and, thus, by HIP-DEX) improves on the situation by 
    partitioning the 128-bit counter space into a 32-bit nonce, 
    64-bit IV, and 32-bits of counter.  The counter is incremented 
    to provide a keystream for protecting a given packet, the IV is 
    chosen by the encryptor in a "manner that ensures uniqueness", 
    and the nonce persists for the lifetime of a given SA.  In 
    particular, in this usage the nonce must be unpredictable, not 
    just single-use.  In HIP-DEX, the properties of nonce 
    uniqueness/unpredictability and per-packet IV uniqueness are 
    defined in <a href="#hip_cipher" class="xref">Section 5.2.2</a>.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="PK_Validate">
<section id="section-9.3">
        <h3 id="name-need-to-validate-public-key">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-need-to-validate-public-key" class="section-name selfRef">Need to Validate Public Keys</a>
        </h3>
<p id="section-9.3-1">
    With the curves specified here, there is a straightforward key 
    extraction attack, which is a very serious problem with the use of 
    static keys by HIP-DEX.  Thus it is MANDATORY to validate the 
    peer's Public Key.<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<p id="section-9.3-2">
    For Curve25519 and Curve448, the contents of the public value 
    are the byte string inputs and outputs of the corresponding 
    functions defined in <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>: 32 bytes for 
    EC25519 and 56 bytes for EC448.<a href="#section-9.3-2" class="pilcrow">¶</a></p>
<p id="section-9.3-3">
    The validation is done in <a href="#ini2" class="xref">Section 6.7</a>, step 4 and 
    <a href="#inc_r2" class="xref">Section 6.8</a>, step 5.<a href="#section-9.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-10-1">
      The following changes to the "Host Identity Protocol (HIP) Parameters"
      registries have been made:<a href="#section-10-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-10-2">
        <dt id="section-10-2.1">ENCRYPTED_KEY</dt>
        <dd style="margin-left: 1.5em" id="section-10-2.2">
   "ENCRYPTED_KEY" with type number TBD1 (suggested: 643) (see 
   <a href="#encrypted_key" class="xref">Section 5.2.5</a>) in the "Parameter Types" 
   subregistry of the "Host Identity Protocol (HIP) Parameters" 
   registry.<a href="#section-10-2.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-10-2.3">DH_GROUP_LIST</dt>
        <dd style="margin-left: 1.5em" id="section-10-2.4">
   This document defines the new DH_GROUPS Curve25519 with value 
   TBD7 (suggested: 12) and Curve448 with value TBD8 (suggested: 
   13)  (see <a href="#dh_group_list" class="xref">Section 5.2.1</a>) in 
   the "Group IDs" subregistry of the "Host Identity Protocol 
   (HIP) Parameters" registry.<a href="#section-10-2.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-10-2.5">HIT Suite ID</dt>
        <dd style="margin-left: 1.5em" id="section-10-2.6">
          This document defines the new HIT Suite "ECDH/FOLD" without four-bit ID of TBD2 (suggested: 4) and eight-bit encoding of TBD3 (suggested: 0x40) (see <a href="#hit_suite_list" class="xref">Section 5.2.4</a>) in the "HIT Suite ID" subregistry of the "Host Identity Protocol (HIP) Parameters" registry.<a href="#section-10-2.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-10-2.7">HIP Cipher ID</dt>
        <dd style="margin-left: 1.5em" id="section-10-2.8">
          This document defines the new HIP Cipher ID "AES-128-CTR" with type number TBD4 (suggested: 5) (see <a href="#hip_cipher" class="xref">Section 5.2.2</a>) in the "HIP Cipher ID" subregistry of the "Host Identity Protocol (HIP) Parameters" registry.<a href="#section-10-2.8" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-10-2.9">HI Algorithm</dt>
        <dd style="margin-left: 1.5em" id="section-10-2.10">
          This document defines the new HI Algorithm "ECDH" with type number TBD5 (suggested: 11) (see <a href="#host_id" class="xref">Section 5.2.3</a>) in the "HI Algorithm" subregistry of the "Host Identity Protocol (HIP) Parameters" registry.<a href="#section-10-2.10" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-10-2.11">I_NONCE</dt>
        <dd style="margin-left: 1.5em" id="section-10-2.12">
   "I_NONCE" with type number TBD6 (suggested: 644) (see <a href="#i_nonce" class="xref">Section 5.2.6</a>) in the "Parameter Types" 
   subregistry of the "Host Identity Protocol (HIP) Parameters" 
   registry.<a href="#section-10-2.12" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-10-2.13">ECC Curve Label</dt>
        <dd style="margin-left: 1.5em" id="section-10-2.14">
          This document specifies a new algorithm-specific subregistry named
   "ECDH Curve Label". The values for this subregistry are 
   defined in <a href="#dh_group_list" class="xref">Section 5.2.1</a>. 
   The complete list of algorithms for the DH_GROUP_LIST 
   parameter are listed in the "Group IDs" subregistry of the 
   "Host Identity Protocol (HIP) Parameters" registry.<a href="#section-10-2.14" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<section id="section-11">
      <h2 id="name-acknowledgements">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-11-1">
    The drive to put HIP on a cryptographic 'Diet' came out of a 
    number of discussions with sensor vendors at IEEE 802.15 
    meetings. David McGrew was very helpful in crafting this 
    document. Special thanks to Mohit Sethi in helping with the 
    draft during IESG process.<a href="#section-11-1" class="pilcrow">¶</a></p>
<p id="section-11-2">
    Special thanks to Dr. Hugo Krawczyk for early guidance on the 
    IRTF CFRG list on how to safely use CMAC in a key derivation 
    function.  And Dr. Lily Chen of NIST who spent time discussing 
    CKDF at IEEE 802 and IETF meetings.<a href="#section-11-2" class="pilcrow">¶</a></p>
</section>
<section id="section-12">
      <h2 id="name-changelog">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-changelog" class="section-name selfRef">Changelog</a>
      </h2>
<p id="section-12-1">
        This section summarizes the changes made from
        draft-moskowitz-hip-rg-dex-05, which was the first stable version of
        the draft. Note that the draft was renamed after
        draft-moskowitz-hip-rg-dex-06.<a href="#section-12-1" class="pilcrow">¶</a></p>
<p id="section-12-2">
 The draft was then renamed from draft-moskowitz-hip-dex to draft-ietf-hip-dex.<a href="#section-12-2" class="pilcrow">¶</a></p>
<section id="section-12.1">
        <h3 id="name-changes-in-draft-ietf-hip-d">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-changes-in-draft-ietf-hip-d" class="section-name selfRef">Changes in draft-ietf-hip-dex-24</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.1-1.1">Apply editorial comments from Eric Vyncke in <a href="#applicability" class="xref">Section 1.2</a><a href="#section-12.1-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.1-1.2">Added 
   SIGMA and ATmega328P references<a href="#section-12.1-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.1-1.3">Added non-paywall 
   URL for EfficientECC reference<a href="#section-12.1-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.1-1.4">Added <a href="#DEX_Caution" class="xref">Section 9.1</a> and removed last NIST 
   P-384 text.<a href="#section-12.1-1.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.2">
        <h3 id="name-changes-in-draft-ietf-hip-de">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-changes-in-draft-ietf-hip-de" class="section-name selfRef">Changes in draft-ietf-hip-dex-23</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.2-1.1">Apply editorial comment from Eric Vyncke<a href="#section-12.2-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.2-1.2">Added concatenating Context ID with HI in FOLD to mirror
          HIPv2 ORCHID construction<a href="#section-12.2-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.2-1.3">Added Partial Computational Cost of FS via SIGMA, 
   <a href="#SIGMA_Cost" class="xref">Section 1.2.1</a><a href="#section-12.2-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.2-1.4">Added further text to <a href="#foldVcmac" class="xref">Section 3.2.1</a><a href="#section-12.2-1.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.3">
        <h3 id="name-changes-in-draft-ietf-hip-dex">
<a href="#section-12.3" class="section-number selfRef">12.3. </a><a href="#name-changes-in-draft-ietf-hip-dex" class="section-name selfRef">Changes in draft-ietf-hip-dex-22</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.3-1.1">Apply editorial comment from Roman Danyliw<a href="#section-12.3-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.3-1.2">Clarify IKM content for Master SA and Pairwise SA in 
   <a href="#keymat" class="xref">Section 6.3</a><a href="#section-12.3-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.3-1.3">Add behavior on BEX before DEX to <a href="#applicability" class="xref">Section 1.2</a><a href="#section-12.3-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.3-1.4">
   Added <span>[<a href="#DOI_10.6028_NIST.SP.800-56C" class="xref">NIST.SP.800-56C</a>]</span>, <span>[<a href="#DOI_10.6028_NIST.SP.800-108" class="xref">NIST.SP.800-108</a>]</span>, 
   and <span>[<a href="#DOI_10.1007_978-3-540-28628-8_30" class="xref">KeyDerivation</a>]</span> as source guidance for CKDF to <a href="#keymat" class="xref">Section 6.3</a><a href="#section-12.3-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.3-1.5">
   Removed NIST curves from <a href="#dh_group_list" class="xref">Section 5.2.1</a> and <a href="#host_id" class="xref">Section 5.2.3</a> as too slow for 8-bit CPUs<a href="#section-12.3-1.5" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.4">
        <h3 id="name-changes-in-draft-ietf-hip-dex-">
<a href="#section-12.4" class="section-number selfRef">12.4. </a><a href="#name-changes-in-draft-ietf-hip-dex-" class="section-name selfRef">Changes in draft-ietf-hip-dex-21</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.4-1.1">Clarified on security concerns of using AES-CTR in 
   <a href="#AES-CTR" class="xref">Section 9.2</a><a href="#section-12.4-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.4-1.2">Edits for SECDIR comments<a href="#section-12.4-1.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.5">
        <h3 id="name-changes-in-draft-ietf-hip-dex-2">
<a href="#section-12.5" class="section-number selfRef">12.5. </a><a href="#name-changes-in-draft-ietf-hip-dex-2" class="section-name selfRef">Changes in draft-ietf-hip-dex-20</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.5-1.1">Clarified text on AES-CTR for HIP parameter 
   encryption.  This includes <a href="#AES-CTR" class="xref">Section 9.2</a><a href="#section-12.5-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.5-1.2">Clarified text on R2 processing to validate content of R1.<a href="#section-12.5-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.5-1.3">Clarified Applicability section.<a href="#section-12.5-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.5-1.4">Expanded Fig 1.<a href="#section-12.5-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.5-1.5">Clarified differences between BEX and DEX state machines.<a href="#section-12.5-1.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.5-1.6">ESP transform is MTI and ESP-TCP is Experimental.<a href="#section-12.5-1.6" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.6">
        <h3 id="name-changes-in-draft-ietf-hip-dex-1">
<a href="#section-12.6" class="section-number selfRef">12.6. </a><a href="#name-changes-in-draft-ietf-hip-dex-1" class="section-name selfRef">Changes in draft-ietf-hip-dex-19</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.6-1.1">Replaced reference to RFC4493 for CMAC with NIST SP800-38B.<a href="#section-12.6-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.6-1.2">Remove NIST P-521 from DH_GROUP_LIST.<a href="#section-12.6-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.6-1.3">Remove NULL-ENCRYPT.<a href="#section-12.6-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.6-1.4">Added reference to rfc8005 for HIT lookup in DNS.<a href="#section-12.6-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.6-1.5">Remove setting Control bit: A.<a href="#section-12.6-1.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.6-1.6">Many textual improvements per Benjamin Kaduk comments.<a href="#section-12.6-1.6" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.7">
        <h3 id="name-changes-in-draft-ietf-hip-dex-18">
<a href="#section-12.7" class="section-number selfRef">12.7. </a><a href="#name-changes-in-draft-ietf-hip-dex-18" class="section-name selfRef">Changes in draft-ietf-hip-dex-18</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.7-1.1">Changed Perfect Forward Secrecy to Forward Secrecy.<a href="#section-12.7-1.1" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.8">
        <h3 id="name-changes-in-draft-ietf-hip-dex-17">
<a href="#section-12.8" class="section-number selfRef">12.8. </a><a href="#name-changes-in-draft-ietf-hip-dex-17" class="section-name selfRef">Changes in draft-ietf-hip-dex-17</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.8-1.1">Added hex values for strings CKDF-Extract and CKDF-Expand.<a href="#section-12.8-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.8-1.2">Replace Perfect Forward Secrecy with Forward Secrecy.<a href="#section-12.8-1.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.9">
        <h3 id="name-changes-in-draft-ietf-hip-dex-16">
<a href="#section-12.9" class="section-number selfRef">12.9. </a><a href="#name-changes-in-draft-ietf-hip-dex-16" class="section-name selfRef">Changes in draft-ietf-hip-dex-16</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.9-1.1">Remove old placeholder text.<a href="#section-12.9-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.9-1.2">Remove SECP160R1. Experience has shown EC25519 performance 
   equal enough to not need it.<a href="#section-12.9-1.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.10">
        <h3 id="name-changes-in-draft-ietf-hip-dex-15">
<a href="#section-12.10" class="section-number selfRef">12.10. </a><a href="#name-changes-in-draft-ietf-hip-dex-15" class="section-name selfRef">Changes in draft-ietf-hip-dex-15</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.10-1.1">Added Public Key validation in I2 and R2 processing.<a href="#section-12.10-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.10-1.2">Added ACL processing (<a href="#hit-acl" class="xref">Section 7.1</a>).<a href="#section-12.10-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.10-1.3">Added IANA instructions for DH_GROUP_LIST.<a href="#section-12.10-1.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.11">
        <h3 id="name-changes-in-draft-ietf-hip-dex-14">
<a href="#section-12.11" class="section-number selfRef">12.11. </a><a href="#name-changes-in-draft-ietf-hip-dex-14" class="section-name selfRef">Changes in draft-ietf-hip-dex-14</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.11-1.1">Changes to (<a href="#ICMP" class="xref">Section 5.4</a>) per Jeff Ahrenholz for 
   Suresh Krishnan comment<a href="#section-12.11-1.1" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.12">
        <h3 id="name-changes-in-draft-ietf-hip-dex-12">
<a href="#section-12.12" class="section-number selfRef">12.12. </a><a href="#name-changes-in-draft-ietf-hip-dex-12" class="section-name selfRef">Changes in draft-ietf-hip-dex-12 and 13</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.12-1.1">Nits from Jeff Ahrenholz (including some formatting issues)<a href="#section-12.12-1.1" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.13">
        <h3 id="name-changes-in-draft-ietf-hip-dex-11">
<a href="#section-12.13" class="section-number selfRef">12.13. </a><a href="#name-changes-in-draft-ietf-hip-dex-11" class="section-name selfRef">Changes in draft-ietf-hip-dex-11 and 12</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.13-1.1">Included more precise references to the IANA subregistries<a href="#section-12.13-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.13-1.2">Addressed GEN-ART feedback from Francis Dupont<a href="#section-12.13-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.13-1.3">Added reasoning for FS in a separate section, and it is mentioned also in the abstract and intro.<a href="#section-12.13-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.13-1.4">Donald Eastlake's (secdir) nits addressed<a href="#section-12.13-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.13-1.5">Resolved IANA nits from Amanda Baber.<a href="#section-12.13-1.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.13-1.6">New sections: "Why introduce folding" (<a href="#foldVcmac" class="xref">Section 3.2.1</a>), "SECP160R1 Considered Unsafe" 
   (removed in ver 16), "Need to Validate Public 
   Keys" (<a href="#PK_Validate" class="xref">Section 9.3</a>), and "I_NONCE" 
   (<a href="#i_nonce" class="xref">Section 5.2.6</a>) to address Eric Rescorla's 
   concerns.<a href="#section-12.13-1.6" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.14">
        <h3 id="name-changes-in-draft-ietf-hip-dex-11-2">
<a href="#section-12.14" class="section-number selfRef">12.14. </a><a href="#name-changes-in-draft-ietf-hip-dex-11-2" class="section-name selfRef">Changes in draft-ietf-hip-dex-11</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.14-1.1">Update IANA considerations as requested by Eric Envyncke<a href="#section-12.14-1.1" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.15">
        <h3 id="name-changes-in-draft-ietf-hip-dex-10">
<a href="#section-12.15" class="section-number selfRef">12.15. </a><a href="#name-changes-in-draft-ietf-hip-dex-10" class="section-name selfRef">Changes in draft-ietf-hip-dex-10</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.15-1.1">Explanations on why the document includes so many SHOULDs<a href="#section-12.15-1.1" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.16">
        <h3 id="name-changes-in-draft-ietf-hip-dex-0">
<a href="#section-12.16" class="section-number selfRef">12.16. </a><a href="#name-changes-in-draft-ietf-hip-dex-0" class="section-name selfRef">Changes in draft-ietf-hip-dex-09</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.16-1.1">
            <p id="section-12.16-1.1.1">
                Fixed values for<a href="#section-12.16-1.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-12.16-1.1.2.1">DH_GROUP_LIST<a href="#section-12.16-1.1.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-12.16-1.1.2.2">HIT_SUITE_LIST<a href="#section-12.16-1.1.2.2" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-12.16-1.1.3">
                to match <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>.<a href="#section-12.16-1.1.3" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
<section id="section-12.17">
        <h3 id="name-changes-in-draft-ietf-hip-dex-05">
<a href="#section-12.17" class="section-number selfRef">12.17. </a><a href="#name-changes-in-draft-ietf-hip-dex-05" class="section-name selfRef">Changes in draft-ietf-hip-dex-05</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.17-1.1">
                Clarified main differences between HIP BEX and HIP DEX in
                Section 1.<a href="#section-12.17-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.17-1.2">
                Addressed MitM attack in Section 8.<a href="#section-12.17-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.17-1.3">
                Minor editorial changes.<a href="#section-12.17-1.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.18">
        <h3 id="name-changes-in-draft-ietf-hip-dex-04">
<a href="#section-12.18" class="section-number selfRef">12.18. </a><a href="#name-changes-in-draft-ietf-hip-dex-04" class="section-name selfRef">Changes in draft-ietf-hip-dex-04</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.18-1.1">
                Added new paragraph on rekeying procedure with HIP DEX.<a href="#section-12.18-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.18-1.2">
                Updated references.<a href="#section-12.18-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.18-1.3">
                Editorial changes.<a href="#section-12.18-1.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.19">
        <h3 id="name-changes-in-draft-ietf-hip-dex-03">
<a href="#section-12.19" class="section-number selfRef">12.19. </a><a href="#name-changes-in-draft-ietf-hip-dex-03" class="section-name selfRef">Changes in draft-ietf-hip-dex-03</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.19-1.1">
                Added new section on HIP DEX/HIPv2 interoperability<a href="#section-12.19-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.19-1.2">
                Added reference to RFC4493 for CMAC.<a href="#section-12.19-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.19-1.3">
                Added reference to RFC5869 for CKDF.<a href="#section-12.19-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.19-1.4">
                Added processing of NOTIFY message in I2-SENT of state diagram.<a href="#section-12.19-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.19-1.5">
                Editorial changes.<a href="#section-12.19-1.5" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.20">
        <h3 id="name-changes-in-draft-ietf-hip-dex-02">
<a href="#section-12.20" class="section-number selfRef">12.20. </a><a href="#name-changes-in-draft-ietf-hip-dex-02" class="section-name selfRef">Changes in draft-ietf-hip-dex-02</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.20-1.1">
                Author address change.<a href="#section-12.20-1.1" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.21">
        <h3 id="name-changes-in-draft-ietf-hip-dex-01">
<a href="#section-12.21" class="section-number selfRef">12.21. </a><a href="#name-changes-in-draft-ietf-hip-dex-01" class="section-name selfRef">Changes in draft-ietf-hip-dex-01</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.21-1.1">
                Added the new ECDH groups of Curve25519 and Curve448 from RFC 7748.<a href="#section-12.21-1.1" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.22">
        <h3 id="name-changes-in-draft-ietf-hip-dex-00">
<a href="#section-12.22" class="section-number selfRef">12.22. </a><a href="#name-changes-in-draft-ietf-hip-dex-00" class="section-name selfRef">Changes in draft-ietf-hip-dex-00</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.22-1.1">
                The Internet Draft was adopted by the HIP WG.<a href="#section-12.22-1.1" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.23">
        <h3 id="name-changes-in-draft-moskowitz-">
<a href="#section-12.23" class="section-number selfRef">12.23. </a><a href="#name-changes-in-draft-moskowitz-" class="section-name selfRef">Changes in draft-moskowitz-hip-rg-dex-06</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.23-1.1">
                A major change in the ENCRYPT parameter to use AES-CTR rather
                than AES-CBC.<a href="#section-12.23-1.1" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.24">
        <h3 id="name-changes-in-draft-moskowitz-h">
<a href="#section-12.24" class="section-number selfRef">12.24. </a><a href="#name-changes-in-draft-moskowitz-h" class="section-name selfRef">Changes in draft-moskowitz-hip-dex-00</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.24-1.1">
                Draft name change. HIPRG ended in IRTF, HIP DEX is now
                individual submission.<a href="#section-12.24-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.24-1.2">
                Added the change section.<a href="#section-12.24-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.24-1.3">
                Added a Definitions section.<a href="#section-12.24-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.24-1.4">
                Changed I2 and R2 packets to reflect use of AES-CTR for
                ENCRYPTED_KEY parameter.<a href="#section-12.24-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.24-1.5">
                Cleaned up KEYMAT Generation text.<a href="#section-12.24-1.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.24-1.6">
                Added Appendix with C code for the ECDH shared secret
                generation on an 8 bit processor.<a href="#section-12.24-1.6" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.25">
        <h3 id="name-changes-in-draft-moskowitz-hi">
<a href="#section-12.25" class="section-number selfRef">12.25. </a><a href="#name-changes-in-draft-moskowitz-hi" class="section-name selfRef">Changes in draft-moskowitz-hip-dex-01</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.25-1.1">
                Numerous editorial changes.<a href="#section-12.25-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.25-1.2">
                New retransmission strategy.<a href="#section-12.25-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.25-1.3">
                New HIT generation mechanism.<a href="#section-12.25-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.25-1.4">
                Modified layout of ENCRYPTED_KEY parameter.<a href="#section-12.25-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.25-1.5">
                Clarify use puzzle difficulty of zero under normal network
                conditions.<a href="#section-12.25-1.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.25-1.6">
                Align inclusion directive of R1_COUNTER with HIPv2 (from SHOULD
                to MUST).<a href="#section-12.25-1.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.25-1.7">
                Align inclusion of TRANSPORT_FORMAT_LIST with HIPv2 (added to
                R1 and I2).<a href="#section-12.25-1.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.25-1.8">
                HIP_CIPHER, HIT_SUITE_LIST, and TRANSPORT_FORMAT_LIST must now
                be echoed in R2 packet.<a href="#section-12.25-1.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.25-1.9">
                Added new author.<a href="#section-12.25-1.9" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.26">
        <h3 id="name-changes-in-draft-moskowitz-hip">
<a href="#section-12.26" class="section-number selfRef">12.26. </a><a href="#name-changes-in-draft-moskowitz-hip" class="section-name selfRef">Changes in draft-moskowitz-hip-dex-02</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.26-1.1">
                Introduced formal definition of FOLD function.<a href="#section-12.26-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.26-1.2">
                Clarified use of CMAC for puzzle computation in section
                "Solving the Puzzle".<a href="#section-12.26-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.26-1.3">
                Several editorial changes.<a href="#section-12.26-1.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.27">
        <h3 id="name-changes-in-draft-moskowitz-hip-">
<a href="#section-12.27" class="section-number selfRef">12.27. </a><a href="#name-changes-in-draft-moskowitz-hip-" class="section-name selfRef">Changes in draft-moskowitz-hip-dex-03</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.27-1.1">
                Addressed HI crypto agility.<a href="#section-12.27-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.27-1.2">
                Clarified purpose of secret exchanged via ENCRYPTED_KEY
                parameter.<a href="#section-12.27-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.27-1.3">
                Extended the IV in the ENCRYPTED_KEY parameter.<a href="#section-12.27-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.27-1.4">
                Introduced forward-references to HIP DEX KEYMAT process and
                improved KEYMAT section.<a href="#section-12.27-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.27-1.5">
                Replaced Appendix A on "C code for ECC point multiplication"
                with short discussion in introduction.<a href="#section-12.27-1.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.27-1.6">
                Updated references.<a href="#section-12.27-1.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.27-1.7">
                Further editorial changes.<a href="#section-12.27-1.7" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-12.28">
        <h3 id="name-changes-in-draft-moskowitz-hip-d">
<a href="#section-12.28" class="section-number selfRef">12.28. </a><a href="#name-changes-in-draft-moskowitz-hip-d" class="section-name selfRef">Changes in draft-moskowitz-hip-dex-04</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-12.28-1.1">
                Improved retransmission extension.<a href="#section-12.28-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.28-1.2">
                Updated and strongly revised packet processing rules.<a href="#section-12.28-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.28-1.3">
                Updated security considerations.<a href="#section-12.28-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.28-1.4">
                Updated IANA considerations.<a href="#section-12.28-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.28-1.5">
                Move the HI Algorithm for ECDH to a value of 11.<a href="#section-12.28-1.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.28-1.6">
                Many editorial changes.<a href="#section-12.28-1.6" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</section>
<section id="section-13">
      <h2 id="name-references">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-13.1">
        <h3 id="name-normative-references">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="DOI_10.6028_NIST.SP.800-38B">[NIST.SP.800-38B]</dt>
        <dd>
<span class="refAuthor">Dworkin, M.</span>, <span class="refTitle">"Recommendation for block cipher modes of operation :: the CMAC mode for authentication"</span>, <span class="seriesInfo">National Institute of Standards and Technology report</span>, <span class="seriesInfo">DOI 10.6028/nist.sp.800-38b</span>, <time datetime="2016" class="refDate">2016</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.sp.800-38b">https://doi.org/10.6028/nist.sp.800-38b</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3686">[RFC3686]</dt>
        <dd>
<span class="refAuthor">Housley, R.</span>, <span class="refTitle">"Using Advanced Encryption Standard (AES) Counter Mode With IPsec Encapsulating Security Payload (ESP)"</span>, <span class="seriesInfo">RFC 3686</span>, <span class="seriesInfo">DOI 10.17487/RFC3686</span>, <time datetime="2004-01" class="refDate">January 2004</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3686">https://www.rfc-editor.org/info/rfc3686</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4443">[RFC4443]</dt>
        <dd>
<span class="refAuthor">Conta, A.</span><span class="refAuthor">, Deering, S.</span><span class="refAuthor">, and M. Gupta, Ed.</span>, <span class="refTitle">"Internet Control Message Protocol (ICMPv6) for the Internet Protocol Version 6 (IPv6) Specification"</span>, <span class="seriesInfo">STD 89</span>, <span class="seriesInfo">RFC 4443</span>, <span class="seriesInfo">DOI 10.17487/RFC4443</span>, <time datetime="2006-03" class="refDate">March 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4443">https://www.rfc-editor.org/info/rfc4443</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6261">[RFC6261]</dt>
        <dd>
<span class="refAuthor">Keranen, A.</span>, <span class="refTitle">"Encrypted Signaling Transport Modes for the Host Identity Protocol"</span>, <span class="seriesInfo">RFC 6261</span>, <span class="seriesInfo">DOI 10.17487/RFC6261</span>, <time datetime="2011-05" class="refDate">May 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6261">https://www.rfc-editor.org/info/rfc6261</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7343">[RFC7343]</dt>
        <dd>
<span class="refAuthor">Laganier, J.</span><span class="refAuthor"> and F. Dupont</span>, <span class="refTitle">"An IPv6 Prefix for Overlay Routable Cryptographic Hash Identifiers Version 2 (ORCHIDv2)"</span>, <span class="seriesInfo">RFC 7343</span>, <span class="seriesInfo">DOI 10.17487/RFC7343</span>, <time datetime="2014-09" class="refDate">September 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7343">https://www.rfc-editor.org/info/rfc7343</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7401">[RFC7401]</dt>
        <dd>
<span class="refAuthor">Moskowitz, R., Ed.</span><span class="refAuthor">, Heer, T.</span><span class="refAuthor">, Jokela, P.</span><span class="refAuthor">, and T. Henderson</span>, <span class="refTitle">"Host Identity Protocol Version 2 (HIPv2)"</span>, <span class="seriesInfo">RFC 7401</span>, <span class="seriesInfo">DOI 10.17487/RFC7401</span>, <time datetime="2015-04" class="refDate">April 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7401">https://www.rfc-editor.org/info/rfc7401</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7402">[RFC7402]</dt>
        <dd>
<span class="refAuthor">Jokela, P.</span><span class="refAuthor">, Moskowitz, R.</span><span class="refAuthor">, and J. Melen</span>, <span class="refTitle">"Using the Encapsulating Security Payload (ESP) Transport Format with the Host Identity Protocol (HIP)"</span>, <span class="seriesInfo">RFC 7402</span>, <span class="seriesInfo">DOI 10.17487/RFC7402</span>, <time datetime="2015-04" class="refDate">April 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7402">https://www.rfc-editor.org/info/rfc7402</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-13.2">
        <h3 id="name-informative-references">
<a href="#section-13.2" class="section-number selfRef">13.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="ATmega328P">[ATmega328P]</dt>
        <dd>
<span class="refAuthor">Atmel</span>, <span class="refTitle">"ATmega328P 8-bit AVR Microcontroller with 32K Bytes In-System Programmable Flash"</span>, <span class="seriesInfo">SEC 2 </span>, <time datetime="2015" class="refDate">2015</time>, <span>&lt;<a href="https://ww1.microchip.com/downloads/en/DeviceDoc/Atmel-7810-Automotive-Microcontrollers-ATmega328P_Datasheet.pdf">https://ww1.microchip.com/downloads/en/DeviceDoc/Atmel-7810-Automotive-Microcontrollers-ATmega328P_Datasheet.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="DOI_10.1109_TIT.1976.1055638">[DH76]</dt>
        <dd>
<span class="refAuthor">Diffie, W.</span><span class="refAuthor"> and M. Hellman</span>, <span class="refTitle">"New directions in cryptography"</span>, <span class="seriesInfo">IEEE Transactions on Information Theory Vol. 22, pp. 644-654</span>, <span class="seriesInfo">DOI 10.1109/tit.1976.1055638</span>, <time datetime="1976-11" class="refDate">November 1976</time>, <span>&lt;<a href="https://doi.org/10.1109/tit.1976.1055638">https://doi.org/10.1109/tit.1976.1055638</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="DOI_10.1007_978-3-319-24126-5_17">[EfficientECC]</dt>
        <dd>
<span class="refAuthor">Nascimento, E.</span><span class="refAuthor">, Lopez, J.</span><span class="refAuthor">, and R. Dahab</span>, <span class="refTitle">"Efficient and Secure Elliptic Curve Cryptography for 8-bit AVR Microcontrollers"</span>, <span class="seriesInfo">Security, Privacy, and Applied Cryptography Engineering pp. 289-309</span>, <span class="seriesInfo">DOI 10.1007/978-3-319-24126-5_17</span>, <time datetime="2015" class="refDate">2015</time>, <span>&lt;<a href="https://www.researchgate.net/publication/300253314_Efficient_and_Secure_Elliptic_Curve_Cryptography_for_8-bit_AVR_Microcontrollers">https://www.researchgate.net/publication/300253314_Efficient_and_Secure_Elliptic_Curve_Cryptography_for_8-bit_AVR_Microcontrollers</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-hip-rfc4423-bis">[hip-rfc4423-bis]</dt>
        <dd>
<span class="refAuthor">Moskowitz, R.</span><span class="refAuthor"> and M. Komu</span>, <span class="refTitle">"Host Identity Protocol Architecture"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-hip-rfc4423-bis-20</span>, <time datetime="2019-02-14" class="refDate">14 February 2019</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-hip-rfc4423-bis-20">https://tools.ietf.org/html/draft-ietf-hip-rfc4423-bis-20</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="DOI_10.1109_ICNP.2013.6733571">[HWZ13]</dt>
        <dd>
<span class="refAuthor">Hummen, R.</span><span class="refAuthor">, Wirtz, H.</span><span class="refAuthor">, Ziegeldorf, J.</span><span class="refAuthor">, Hiller, J.</span><span class="refAuthor">, and K. Wehrle</span>, <span class="refTitle">"Tailoring end-to-end IP security protocols to the Internet of Things"</span>, <span class="seriesInfo">2013 21st IEEE International Conference on Network Protocols (ICNP)</span>, <span class="seriesInfo">DOI 10.1109/icnp.2013.6733571</span>, <time datetime="2013-10" class="refDate">October 2013</time>, <span>&lt;<a href="https://doi.org/10.1109/icnp.2013.6733571">https://doi.org/10.1109/icnp.2013.6733571</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="DOI_10.1109_IEEESTD.2016.7786995">[IEEE.802-11.2016]</dt>
        <dd>
<span class="refTitle">"IEEE Standard for Information technology--Telecommunications and information exchange between systems Local and metropolitan area networks--Specific requirements - Part 11: Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY) Specifications"</span>, <span class="seriesInfo">IEEE standard</span>, <span class="seriesInfo">DOI 10.1109/ieeestd.2016.7786995</span>, <span>n.d.</span>, <span>&lt;<a href="https://doi.org/10.1109/ieeestd.2016.7786995">https://doi.org/10.1109/ieeestd.2016.7786995</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IEEE.802-15-4.2015">[IEEE.802-15-4.2015]</dt>
        <dd>
<span class="refAuthor">Engineers, I. O. E. A. E.</span>, <span class="refTitle">"Information technology - Telecommunications and information exchange between systems - Local and metropolitan area networks - Specific requirements - Part 15.4: Wireless Medium Access Control (MAC) and Physical Layer (PHY) Specifications for Low-Rate Wireless Personal Area Networks (WPANs)"</span>, <span class="seriesInfo">IEEE Standard 802.15.4</span>, <time datetime="2015-12" class="refDate">December 2015</time>, <span>&lt;<a href="http://standards.ieee.org/getieee802/download/802.15.4-2015.pdf">http://standards.ieee.org/getieee802/download/802.15.4-2015.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="DOI_10.1007_978-3-540-28628-8_30">[KeyDerivation]</dt>
        <dd>
<span class="refAuthor">Dodis, Y.</span><span class="refAuthor">, Gennaro, R.</span><span class="refAuthor">, Håstad, J.</span><span class="refAuthor">, Krawczyk, H.</span><span class="refAuthor">, and T. Rabin</span>, <span class="refTitle">"Randomness Extraction and Key Derivation Using the CBC, Cascade and HMAC Modes"</span>, <span class="seriesInfo">Advances in Cryptology - CRYPTO 2004 pp. 494-510</span>, <span class="seriesInfo">DOI 10.1007/978-3-540-28628-8_30</span>, <time datetime="2004" class="refDate">2004</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-540-28628-8_30">https://doi.org/10.1007/978-3-540-28628-8_30</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="DOI_10.1109_IPSN.2008.47">[LN08]</dt>
        <dd>
<span class="refAuthor">Liu, A.</span><span class="refAuthor"> and P. Ning</span>, <span class="refTitle">"TinyECC: A Configurable Library for Elliptic Curve Cryptography in Wireless Sensor Networks"</span>, <span class="seriesInfo">2008 International Conference on Information Processing in Sensor Networks (ipsn 2008)</span>, <span class="seriesInfo">DOI 10.1109/ipsn.2008.47</span>, <time datetime="2008-04" class="refDate">April 2008</time>, <span>&lt;<a href="https://doi.org/10.1109/ipsn.2008.47">https://doi.org/10.1109/ipsn.2008.47</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="DOI_10.6028_NIST.SP.800-108">[NIST.SP.800-108]</dt>
        <dd>
<span class="refAuthor">Chen, L.</span>, <span class="refTitle">"Recommendation for key derivation using pseudorandom functions (revised)"</span>, <span class="seriesInfo">National Institute of Standards and Technology report</span>, <span class="seriesInfo">DOI 10.6028/nist.sp.800-108</span>, <time datetime="2009" class="refDate">2009</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.sp.800-108">https://doi.org/10.6028/nist.sp.800-108</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="DOI_10.6028_NIST.SP.800-56C">[NIST.SP.800-56C]</dt>
        <dd>
<span class="refAuthor">Chen, L.</span>, <span class="refTitle">"Recommendation for key derivation through extraction-then-expansion"</span>, <span class="seriesInfo">National Institute of Standards and Technology report</span>, <span class="seriesInfo">DOI 10.6028/nist.sp.800-56c</span>, <time datetime="2011" class="refDate">2011</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.sp.800-56c">https://doi.org/10.6028/nist.sp.800-56c</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span><span class="refAuthor"> and P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5869">https://www.rfc-editor.org/info/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6090">[RFC6090]</dt>
        <dd>
<span class="refAuthor">McGrew, D.</span><span class="refAuthor">, Igoe, K.</span><span class="refAuthor">, and M. Salter</span>, <span class="refTitle">"Fundamental Elliptic Curve Cryptography Algorithms"</span>, <span class="seriesInfo">RFC 6090</span>, <span class="seriesInfo">DOI 10.17487/RFC6090</span>, <time datetime="2011-02" class="refDate">February 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6090">https://www.rfc-editor.org/info/rfc6090</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7228">[RFC7228]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span><span class="refAuthor">, Ersue, M.</span><span class="refAuthor">, and A. Keranen</span>, <span class="refTitle">"Terminology for Constrained-Node Networks"</span>, <span class="seriesInfo">RFC 7228</span>, <span class="seriesInfo">DOI 10.17487/RFC7228</span>, <time datetime="2014-05" class="refDate">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7228">https://www.rfc-editor.org/info/rfc7228</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7296">[RFC7296]</dt>
        <dd>
<span class="refAuthor">Kaufman, C.</span><span class="refAuthor">, Hoffman, P.</span><span class="refAuthor">, Nir, Y.</span><span class="refAuthor">, Eronen, P.</span><span class="refAuthor">, and T. Kivinen</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">STD 79</span>, <span class="seriesInfo">RFC 7296</span>, <span class="seriesInfo">DOI 10.17487/RFC7296</span>, <time datetime="2014-10" class="refDate">October 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7296">https://www.rfc-editor.org/info/rfc7296</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7748">[RFC7748]</dt>
        <dd>
<span class="refAuthor">Langley, A.</span><span class="refAuthor">, Hamburg, M.</span><span class="refAuthor">, and S. Turner</span>, <span class="refTitle">"Elliptic Curves for Security"</span>, <span class="seriesInfo">RFC 7748</span>, <span class="seriesInfo">DOI 10.17487/RFC7748</span>, <time datetime="2016-01" class="refDate">January 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7748">https://www.rfc-editor.org/info/rfc7748</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8005">[RFC8005]</dt>
        <dd>
<span class="refAuthor">Laganier, J.</span>, <span class="refTitle">"Host Identity Protocol (HIP) Domain Name System (DNS) Extension"</span>, <span class="seriesInfo">RFC 8005</span>, <span class="seriesInfo">DOI 10.17487/RFC8005</span>, <time datetime="2016-10" class="refDate">October 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8005">https://www.rfc-editor.org/info/rfc8005</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SIGMA">[SIGMA]</dt>
      <dd>
<span class="refAuthor">Krawczyk, H.</span>, <span class="refTitle">"SIGMA: the ‘SIGn-and-MAc’ Approach to Authenticated Diffie-Hellman and its Use in the IKE Protocols"</span>, <time datetime="2003" class="refDate">2003</time>, <span>&lt;<a href="https://webee.technion.ac.il/~hugo/sigma-pdf.pdf">https://webee.technion.ac.il/~hugo/sigma-pdf.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="Coll_Prob">
<section id="section-appendix.a">
      <h2 id="name-calculating-collision-proba">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-calculating-collision-proba" class="section-name selfRef">Calculating Collision Probabilities</a>
      </h2>
<p id="section-appendix.a-1">
 The accepted formula for calculating the probability of a collision 
 is:<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-appendix.a-2">
<pre>


    p = 1 - e^{-k^2/(2n)}


    P   Collision Probability
    n   Total possible population
    k   Actual population


</pre><a href="#section-appendix.a-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="twofactor">
<section id="section-appendix.b">
      <h2 id="name-password-based-two-factor-a">
<a href="#section-appendix.b" class="section-number selfRef">Appendix B. </a><a href="#name-password-based-two-factor-a" class="section-name selfRef">Password-based two-factor authentication during the HIP DEX handshake</a>
      </h2>
<p id="section-appendix.b-1">
       HIP DEX allows identifying authorized connections based on a two-factor
       authentication mechanism. With two-factor authentication, devices that
       are authorized to communicate with each other are required to be
       pre-provisioned with a shared (group) key. The Initiator uses this
       pre-provisioned key to encrypt the ECHO_RESPONSE_UNSIGNED in the I2
       packet. Upon reception of the I2, the Responder verifies that its
       challenge in the ECHO_REQUEST_UNSIGNED parameter in the R1 packet has
       been encrypted with the correct key. If verified successfully, the
       Responder proceeds with the handshake. Otherwise, it silently drops the
       I2 packet.<a href="#section-appendix.b-1" class="pilcrow">¶</a></p>
<p id="section-appendix.b-2">
       Note that there is no explicit signaling in the HIP DEX handshake for
       this behavior. Thus, knowledge of two-factor authentication must be
       configured externally prior to the handshake.<a href="#section-appendix.b-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IESG">
<section id="section-appendix.c">
      <h2 id="name-iesg-considerations">
<a href="#section-appendix.c" class="section-number selfRef">Appendix C. </a><a href="#name-iesg-considerations" class="section-name selfRef">IESG Considerations</a>
      </h2>
<p id="section-appendix.c-1">
    During IESG review, a concern was raised on the number of 
    SHOULDs in this document.  Here is an analysis of the 57 SHOULDs 
    in HIP DEX.<a href="#section-appendix.c-1" class="pilcrow">¶</a></p>
<p id="section-appendix.c-2">
    46 of SHOULDs are also in <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>.  Here are 
    the sections with SHOULDs that match up with <span>[<a href="#RFC7401" class="xref">RFC7401</a>]</span>:<a href="#section-appendix.c-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-appendix.c-3">
<pre>
5.2.2.    HIP_CIPHER (same as 7401)

6.5.    Processing Incoming I1 Packets
    3.    (same as 7401)
    5.    (same as 7401)

6.6.    Processing Incoming R1 Packets    (same as 7401)

6.7.    Processing Incoming I2 Packets
    3.    (same as 7401)
    7.    (same as 7401)
    11.    (same as 7401)

6.8.    Processing Incoming R2 Packets
    5.    (same as 7401)

6.9.    Processing Incoming NOTIFY Packets
    1st para (same as 7401)

6.11.    Handling State Loss (same as 7401)

7.    HIP Policies (1st and 3rd same as 7401)
</pre><a href="#section-appendix.c-3" class="pilcrow">¶</a>
</div>
<p id="section-appendix.c-4">
    Many of the other 11 SHOULDs are due to the nature of 
    constrained devices and in most cases the text points this out:<a href="#section-appendix.c-4" class="pilcrow">¶</a></p>
<p id="section-appendix.c-5">
    In <a href="#hip-cookie" class="xref">Section 4.1.1</a>, this is clearly adjusting for 
    how the puzzle could actually be an attack against a constrained 
    device.  Same situation in <a href="#R1" class="xref">Section 5.3.2</a>.<a href="#section-appendix.c-5" class="pilcrow">¶</a></p>
<p id="section-appendix.c-6">
    The SHOULD in <a href="#keymat" class="xref">Section 6.3</a>, clearly reflects new 
    work with the new Sponge Function KDFs:<a href="#section-appendix.c-6" class="pilcrow">¶</a></p>
<p id="section-appendix.c-7">
    The keys derived for the Pair-wise Key SA are not used during 
    the HIP DEX handshake. Instead, these keys are made available as 
    payload protection keys (e.g., for IPsec). Some payload 
    protection mechanisms have their own Key Derivation Function, 
    and if so this mechanism SHOULD be used. Otherwise, the HIP DEX 
    KEYMAT process MUST be used to derive the keys of the Pair-wise 
    Key SA based on the concatenation of the random values that are 
    contained in the exchanged ENCRYPTED_KEY parameters.<a href="#section-appendix.c-7" class="pilcrow">¶</a></p>
<p id="section-appendix.c-8">
    In <a href="#i1process" class="xref">Section 6.5</a>, the reason why this is a SHOULD 
    should be clear to any implementer.  That is the HIT Suite list 
    in I1 is a desire on what suite to use.  The Responder may have 
    'different ideas' about the Suite to use (like what it 
    supports).  Thus it is best that the Responder selects a DEX 
    HIT, but there are good reasons, in an implementation not to do 
    so. The implementer should know this and will deal with it 
    appropriately.<a href="#section-appendix.c-8" class="pilcrow">¶</a></p>
<p id="section-appendix.c-9">
    The SHOULDs in <a href="#ini2" class="xref">Section 6.7</a> and <a href="#inc_notify" class="xref">Section 6.9</a> are there for considerations for 
    constrained systems. Some constrained systems need this 
    approach, others may not.<a href="#section-appendix.c-9" class="pilcrow">¶</a></p>
<p id="section-appendix.c-10">
    The 2nd SHOULD in <a href="#sec-policy" class="xref">Section 7</a> follows the same 
    as above.  ACLs and constrained systems tend to go together.<a href="#section-appendix.c-10" class="pilcrow">¶</a></p>
<p id="section-appendix.c-11">
    Similarly in <a href="#dex-bex-interop" class="xref">Section 8</a> the SHOULD is 
    again is highlighting constrained system processing 
    considerations.<a href="#section-appendix.c-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.d">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Robert Moskowitz (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">HTT Consulting</span></div>
<div dir="auto" class="left">
<span class="locality">Oak Park</span>, <span class="region">MI</span> </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rgm@htt-consult.com" class="email">rgm@htt-consult.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Rene Hummen</span></div>
<div dir="auto" class="left"><span class="org">Hirschmann Automation and Control</span></div>
<div dir="auto" class="left"><span class="street-address">Stuttgarter Strasse 45-51</span></div>
<div dir="auto" class="left">
<span class="postal-code">72654</span> <span class="locality">Neckartenzlingen</span>
</div>
<div dir="auto" class="left"><span class="country-name">Germany</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rene.hummen@belden.com" class="email">rene.hummen@belden.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Miika Komu</span></div>
<div dir="auto" class="left"><span class="org">Ericsson Research, Finland</span></div>
<div dir="auto" class="left"><span class="street-address">Hirsalantie 11</span></div>
<div dir="auto" class="left">FI-<span class="postal-code">02420</span> <span class="locality">Jorvas</span>
</div>
<div dir="auto" class="left"><span class="country-name">Finland</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:miika.komu@ericsson.com" class="email">miika.komu@ericsson.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
