<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Carrying next-hop cost information in BGP</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Motivation">
<link href="#rfc.section.2" rel="Chapter" title="2 NEXT-HOP INFORMATION BASE">
<link href="#rfc.section.3" rel="Chapter" title="3 BGP BEST PATH SELECTION MODIFICATION">
<link href="#rfc.section.4" rel="Chapter" title="4 USING BGP TO POPULATE NHIB">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 NEXT-HOP SAFI">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 CAPABILITY ADVERTISEMENT">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 INFORMATION ENCODING">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 SESSION ESTABLISHMENT">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 INFORMATION EXCHANGE">
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 TERMINATION OF NH SAFI SESSION">
<link href="#rfc.section.4.7" rel="Chapter" title="4.7 GRACEFUL RESTART AND ROUTE REFRESH">
<link href="#rfc.section.5" rel="Chapter" title="5 Security considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.references.1" rel="Chapter" title="7.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="7.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A USAGE SCENARIOS">
<link href="#rfc.appendix.Appendix%20A.1" rel="Chapter" title="Appendix A.1 Trivial case">
<link href="#rfc.appendix.Appendix%20A.2" rel="Chapter" title="Appendix A.2 Non-IGP based cost">
<link href="#rfc.appendix.Appendix%20A.3" rel="Chapter" title="Appendix A.3 Multiple route-reflectors">
<link href="#rfc.appendix.Appendix%20A.4" rel="Chapter" title="Appendix A.4 Inter-AS MPLS VPN">
<link href="#rfc.appendix.Appendix%20A.5" rel="Chapter" title="Appendix A.5 Corner case">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document describes new BGP SAFI to exchange cost information to next-hops for the purpose of calculating best path from a peer perspective rather than local BGP speaker own perspective." />
  <meta name="description" content="This document describes new BGP SAFI to exchange cost information to next-hops for the purpose of calculating best path from a peer perspective rather than local BGP speaker own perspective." />
  <meta name="keywords" content="IDR, BGP" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Internet Engineering Task Force</td>
<td class="right">I.V. Varlashkin</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Easynet Global Services</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">R. Raszuk</td>
</tr>
<tr>
<td class="left">Expires: March 19, 2012</td>
<td class="right">NTT MCL Inc.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">September 16, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Carrying next-hop cost information in BGP<br />
  <span class="filename">draft-varlashkin-bgp-nh-cost-02</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes new BGP SAFI to exchange cost information to next-hops for the purpose of calculating best path from a peer perspective rather than local BGP speaker own perspective.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on March 19, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<p>This document may contain material from IETF Documents or IETF Contributions published or made publicly available before November 10, 2008.  The person(s) controlling the copyright in some of this material may not have granted the IETF Trust the right to allow modifications of such material outside the IETF Standards Process. Without obtaining an adequate license from the person(s) controlling the copyright in such materials, this document may not be modified outside the IETF Standards Process, and derivative works of it may not be created outside the IETF Standards Process, except to format it for publication as an RFC or to translate it into languages other than English.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Motivation</a>
</li>
<li>2.   <a href="#rfc.section.2">NEXT-HOP INFORMATION BASE</a>
</li>
<li>3.   <a href="#rfc.section.3">BGP BEST PATH SELECTION MODIFICATION</a>
</li>
<li>4.   <a href="#rfc.section.4">USING BGP TO POPULATE NHIB</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">NEXT-HOP SAFI</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">CAPABILITY ADVERTISEMENT</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">INFORMATION ENCODING</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">SESSION ESTABLISHMENT</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">INFORMATION EXCHANGE</a>
</li>
<li>4.6.   <a href="#rfc.section.4.6">TERMINATION OF NH SAFI SESSION</a>
</li>
<li>4.7.   <a href="#rfc.section.4.7">GRACEFUL RESTART AND ROUTE REFRESH</a>
</li>
<li>5.   <a href="#rfc.section.5">Security considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">IANA Considerations</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<li>7.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>7.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">USAGE SCENARIOS</a>
</li>
<li>Appendix A.1.   <a href="#rfc.appendix.Appendix%20A.1">Trivial case</a>
</li>
<li>Appendix A.2.   <a href="#rfc.appendix.Appendix%20A.2">Non-IGP based cost</a>
</li>
<li>Appendix A.3.   <a href="#rfc.appendix.Appendix%20A.3">Multiple route-reflectors</a>
</li>
<li>Appendix A.4.   <a href="#rfc.appendix.Appendix%20A.4">Inter-AS MPLS VPN</a>
</li>
<li>Appendix A.5.   <a href="#rfc.appendix.Appendix%20A.5">Corner case</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Motivation</h1>
<p id="rfc.section.1.p.1">In certain situation route-reflector clients may not get optimum path to certain destinations. ADDPATH solves this problem by letting route-reflector to advertise multiple paths for given prefix. If number of advertised paths sufficiently big, route-reflector clients can choose same route as they would in case of full-mesh. This approach however places additional burden on the control plane. Solutions proposed by [BGP-ORR] use different approach - instead of calculating best path from local speaker own perspective the calculations are done using cost from the client to the next-hops. Although they eliminate need for transmitting redundant routing information between peers, there are scenarios where cost to the next-hop cannot be obtained accurately using this methods. For example, if next-hop information itself has been learned via BGP then simple SPF run on link-state database won't be sufficient to obtain cost information. To address such scenarios this document proposes a solution where cost information to the next-hops is carried within BGP itself using dedicated SAFI.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> NEXT-HOP INFORMATION BASE</h1>
<p id="rfc.section.2.p.1">To facilitate further description of the proposed solution we introduce new table for all known next hops and costs to it from various routers on the network.</p>
<p id="rfc.section.2.p.2">Next-Hop Information Base (NHIB) stores cost to reach next-hop from arbitrary router on the network. This information is essential for choosing best path from a peer perspective rather than BGP-speaker own perspective. In canonical form NHIB entry is triplet (router, next-hop, cost), however this specification does not impose any restriction on how BGP implementations store that information internally. The cost in NHIB is does not have to be an IGP cost, but all costs in NHIB MUST be comparable with each other.</p>
<p id="rfc.section.2.p.3">NHIB can be populated from various sources both static and dynamic.  This document focuses on populating NHIB using BGP. However it is possible that protocols other than BGP could be also used to populate NHIB.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> BGP BEST PATH SELECTION MODIFICATION</h1>
<p id="rfc.section.3.p.1">This section applies regardless of method used to populate NHIB.</p>
<p id="rfc.section.3.p.2">When BGP speaker conforming to this specification selects routes to be advertised to a peer it SHOULD use cost information from NHIB rather than its own IGP cost to the next-hop after step (d) of 9.1.2.2 in <a href="#RFC4271">[RFC4271]</a>.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> USING BGP TO POPULATE NHIB</h1>
<p id="rfc.section.4.p.1">This section describes extension to base BGP specification that allows BGP to be used for exchanging next-hop information between BGP speakers via new SAFI in order to populate NHIB. Although next-hops costs are exchanged via dedicated SAFI, this information is vital to best path selection process for other AFI/SAFI (e.g. IPv4 and IPv6 unicast). It's therefore recommended that next-hop cost information is exchanged before other AFI/SAFI.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> NEXT-HOP SAFI</h1>
<p id="rfc.section.4.1.p.1">This document introduces Next-Hop SAFI (NH SAFI) with value to be assigned by IANA and purpose of exchanging information about cost to next-hops.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> CAPABILITY ADVERTISEMENT</h1>
<p id="rfc.section.4.2.p.1">A BGP speaker willing to exchange next-hop information MUST advertise this in the OPEN message using BGP Capability Code 1 (Multiprotocol Extensions, see <a href="#RFC4760">[RFC4760]</a>) setting AFI appropriately to indicate IPv4 or IPv6 and SAFI to the value assigned by IANA for NH SAFI. Note that if BGP speaker whishes to exchange cost information for both IPv4 and IPv6, then it MUST advertise two capabilities: one NH SAFI for IPv4 and one NH SAFI for IPv6.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> INFORMATION ENCODING</h1>
<p id="rfc.section.4.3.p.1">To request cost to a next-hop from peer or to inform peer about cost to a next-hop BGP attribute 14 is used as follow:</p>
<p></p>

<ol>
<li>AFI is set to indicate IPv4 or IPv6 (whichever is appropriate)</li>
<li>SAFI is set to NH SAFI</li>
<li>Network Address of Next-Hop field is zeroed out</li>
<li>NLRI field is encoded as shown in the next figure</li>
</ol>
<div id="#rfc.figure.1"></div>
<pre> +-------------+------------+
 |  NEXT_HOP   |     cost   |
 +-------------+------------+</pre>
<p></p>
<p id="rfc.section.4.3.p.4">Where cost is 32-bit unsigned integer (value described below), and NEXT_HOP is AFI-specific address of the next-hop cost to which is being communicated or requested. Size of NEXT_HOP field is inferred from total length of attribute 14.</p>
<p id="rfc.section.4.3.p.5">To request cost to arbitrary next-hop from a peer, BGP speaker sets cost field to zero.</p>
<p id="rfc.section.4.3.p.6">To inform peer about cost to a next-hop BGP speaker sets cost to actual cost value.</p>
<p id="rfc.section.4.3.p.7">To inform peer that a next-hop is not reachable the cost is set to all-ones (0xFFFFFFFF).</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> SESSION ESTABLISHMENT</h1>
<p id="rfc.section.4.4.p.1">BGP speakers willing to exchange next-hop information SHOULD NOT establish more then one session for given AFI and NH SAFI, even using different transport addresses. This can be ensured for example by checking peer&#8217;s Router Id.</p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> INFORMATION EXCHANGE</h1>
<p id="rfc.section.4.5.p.1">Typically NH SAFI sessions will be established between route-reflectors and its internal peers (both clients and non-clients). As soon as the NH SAFI session is ESTABLISHED requests for next-hop cost and information information about next-hop costs MAY be sent independently. That is, route-reflector MAY send multiple requests without waiting for response, and its peers MAY send cost information before or after receiving such request. On the other hand, Router Reflectors SHOULD request cost information from their internal peers as soon as possible (due to reasons stated in section &#8220;BGP best path selection modification&#8221;). BGP speaker does not need to track outstanding requests to the peer.</p>
<p id="rfc.section.4.5.p.2">When a BGP speaker receives request for cost information it MUST reply with actual cost (not necessarily IGP cost, but whatever has been chosen to be carried in NH SAFI) to given next-hop or with cost set to all-ones indicating that next-hop is unreachable.</p>
<p id="rfc.section.4.5.p.3">Note that BGP speaker MUST use longest match rather than exact match for the next-hop.</p>
<p id="rfc.section.4.5.p.4">When a BGP speaker detects change in cost to previously advertised next-hop with delta equal or exceeding configured advertisement threshold, it SHOULD inform peer by advertising new cost or 0xFFFFFFFF.</p>
<p id="rfc.section.4.5.p.5">When a BGP speaker discovers new next-hop among candidate routes it SHOULD request cost information from the peer.</p>
<h1 id="rfc.section.4.6">
<a href="#rfc.section.4.6">4.6.</a> TERMINATION OF NH SAFI SESSION</h1>
<p id="rfc.section.4.6.p.1">When BGP speaker terminates (for whatever reason) NH SAFI session with a peer, it SHOULD remove all cost information received from that peer unless instructed by configuration to do otherwise.</p>
<h1 id="rfc.section.4.7">
<a href="#rfc.section.4.7">4.7.</a> GRACEFUL RESTART AND ROUTE REFRESH</h1>
<p id="rfc.section.4.7.p.1">NH SAFI sessions could use graceful restart and route refresh mechanisms in the same way as it&#8217;s used for IPv4 and IPv6 unicast.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Security considerations</h1>
<p id="rfc.section.5.p.1">No new security issues are introduced to the BGP protocol by this specification.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> IANA Considerations</h1>
<p id="rfc.section.6.p.1">IANA is requested to allocate value for Next-Hop Subsequent Address Family Identifier.</p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">7.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC4760">[RFC4760]</b></td>
<td class="top">
<a>Bates, T.</a>, <a>Chandra, R.</a>, <a>Katz, D.</a> and <a>Y. Rekhter</a>, "<a href="http://tools.ietf.org/html/rfc4760">Multiprotocol Extensions for BGP-4</a>", RFC 4760, January 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4271">[RFC4271]</b></td>
<td class="top">
<a>Rekhter, Y.</a>, <a>Li, T.</a> and <a>S. Hares</a>, "<a href="http://tools.ietf.org/html/rfc4271">A Border Gateway Protocol 4 (BGP-4)</a>", RFC 4271, January 2006.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">7.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2918">[RFC2918]</b></td>
<td class="top">
<a>Chen, E.</a>, "<a href="http://tools.ietf.org/html/rfc2918">Route Refresh Capability for BGP-4</a>", RFC 2918, September 2000.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.raszuk-bgp-optimal-route-reflection">[I-D.raszuk-bgp-optimal-route-reflection]</b></td>
<td class="top">
<a>Raszuk, R</a>, <a>Cassar, C</a>, <a>Aman, E</a> and <a>B Decraene</a>, "<a href="http://tools.ietf.org/html/draft-raszuk-bgp-optimal-route-reflection-01">BGP Optimal Route Reflection (BGP-ORR)</a>", Internet-Draft draft-raszuk-bgp-optimal-route-reflection-01, March 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> USAGE SCENARIOS</h1>
<h1 id="rfc.appendix.Appendix A.1">
<a href="#rfc.appendix.Appendix%20A.1">Appendix A.1.</a> Trivial case</h1>
<div id="#rfc.figure.2"></div>
<pre>
     --+---NetA---+--
       |          |
      r1          r2
       |          |
       R1--RR-----R2
       | \        |
       |  +------R4
       R3        
        </pre>
<p id="rfc.section.Appendix A.1.p.1">In this scenario r1 and r3 along with NetA are part of AS1; and R1-R4 along with RR are in AS2.</p>
<p id="rfc.section.Appendix A.1.p.2">If RR implements non-optimized route-reflection, then it will choose path to NetA via R1 and advertise it to both R3 and R4. Such choice is good from R3 perspective, but it results in suboptimal traffic flow from R4 to NetA.</p>
<p id="rfc.section.Appendix A.1.p.3">Using NH SAFI the route-reflector will learn that cost from R4 to R1 is 8 whereas to R2 it's only 1. RR will announce NetA to R4 with next-hop set to R2, while its announce to R3 will still have R1 as next-hop. Both R3 and R4 now will send traffic to NetA via closest exit, achieving same behaviour as if full iBGP mesh would have been configured.</p>
<h1 id="rfc.appendix.Appendix A.2">
<a href="#rfc.appendix.Appendix%20A.2">Appendix A.2.</a> Non-IGP based cost</h1>
<p id="rfc.section.Appendix A.2.p.1">When it's desirable to direct traffic over an exit other than the one with smallest IGP cost, NH SAFI can be used to convey cost which is not based on IGP. For example, network operator may arrange exit points in order of administrative preference and configure routers to send this instead of IGP cost. Route reflector then will then calculate best path based on administrative preference rather than IGP metrics.</p>
<p id="rfc.section.Appendix A.2.p.2">Network operators should excercise care to ensure that all routers up to and including exit point do not devert packets on to a different path, otherwise routing loops may occur. One way to achieve this is to have consistent administrative preference among all routers. Another option is to use a tunneling mechanism (e.g. MPLS-TE tunnel) between source and the exit point, provided that the router serving as exit point will send packets out of the network rather than diverting them to another exit point.</p>
<h1 id="rfc.appendix.Appendix A.3">
<a href="#rfc.appendix.Appendix%20A.3">Appendix A.3.</a> Multiple route-reflectors</h1>
<p id="rfc.section.Appendix A.3.p.1">This example demonstrates that NH SAFI peerings are necessary only between routers that already exchange other AFI/SAFI.</p>
<div id="#rfc.figure.3"></div>
<pre>
                           |
R1----R3---------R5----R7--+
      |           |        |
     RR1          |       NetA
      |          RR2       |
      |           |        |
R2----R4---------R6----R8--+
			   |
       </pre>
<p id="rfc.section.Appendix A.3.p.2">In the above network the routers R1-R4 are clients of RR1, and R5-R8 are clients of RR2. RR1 and RR2 also peer with each other and use ADDPATH.</p>
<p id="rfc.section.Appendix A.3.p.3">RR2 learns about NetA from R7 and R8. Since it sends not just best-path but all prefixes to RR1, there is no need for RR2 to learn cost information from R1 and R2 towards R7 and R8. On the other hand RR1 does exchange NH SAFI information with R1 and R2 so that each of them can receive routes, which are best from their perspective.</p>
<p id="rfc.section.Appendix A.3.p.4">As addition to ADDPATH a mechanism could be devised that would allow RR2 to learn how many alternative routes does it need to send to RR1. For example, if NetA would also be connected to R9 (not shown) but all clients of RR1 prefer R7 as exit point and R9 as next-best, then there is no need for RR2 to send NetA routes with next-hop R8 to RR1.</p>
<p id="rfc.section.Appendix A.3.p.5">Discussion: authors would like to solicit discussion whether there is sufficient interest in such mechanism.</p>
<h1 id="rfc.appendix.Appendix A.4">
<a href="#rfc.appendix.Appendix%20A.4">Appendix A.4.</a> Inter-AS MPLS VPN</h1>
<p id="rfc.section.Appendix A.4.p.1">Previous example could be transposed to Inter-AS MPLS VPN Option C scenario. In this case route reflectors RR1 and RR2 can be from different autonomous system. Essentially the behaviour of routers remains as already described.</p>
<h1 id="rfc.appendix.Appendix A.5">
<a href="#rfc.appendix.Appendix%20A.5">Appendix A.5.</a> Corner case</h1>
<div id="#rfc.figure.4"></div>
<pre>
   --+---NetA--+--
     |         |
RR---R1        R2
       \      /
        R3---R4       </pre>
<p id="rfc.section.Appendix A.5.p.1">In the above network cost from R3 to R1 is 10, all other costs are 1. If RR advertises NetA to R3 based on cost information received from R3, but uses its own cost when advertising NetA to R4, there will be a loop formed. This is the reason why section &#8220;BGP best path selection modification&#8221; requires RR to have next-hop cost information for every next-hop and every peer.</p>
<p id="rfc.section.Appendix A.5.p.2">Note that the problem is the same as if RR would not use extensions described in this document and R3 would peer directly with R1 and R2, while R4 would peer only with RR.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ilya Varlashkin</span> 
	  <span class="n hidden">
		<span class="family-name">Varlashkin</span>
	  </span>
	</span>
	<span class="org vcardline">Easynet Global Services</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ilya.varlashkin@easynet.com">ilya.varlashkin@easynet.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Robert Raszuk</span> 
	  <span class="n hidden">
		<span class="family-name">Raszuk</span>
	  </span>
	</span>
	<span class="org vcardline">NTT MCL Inc.</span>
	<span class="adr">
	  <span>101 S Ellsworth Avenue Suite 350</span>

	  <span class="vcardline">
		<span class="locality">San Mateo</span>,  
		<span class="region">CA</span> 
		<span class="code">94401</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:robert@raszuk.net">robert@raszuk.net</a></span>

  </address>
</div>

</body>
</html>