<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Membership test for Mapping Information optimization</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Membership test for Mapping Information optimization">
<meta name="keywords" content="LISP, Locator Identifier, Mapping, LISP ALT">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">LISP</td><td class="header">H. Flinck</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Nokia  Siemens Networks</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">March 01, 2010</td></tr>
<tr><td class="header">Expires: September 2, 2010</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Membership test for Mapping Information optimization<br />draft-flinck-lisp-membertest-00</h1>

<h3>Abstract</h3>

<p>This document defines how a membership test can be used to convey all or some of the EID-to-RLOC mappings from an Egress Tunnel Router to requesting Ingress Tunnel Router. This draft proposes that an authoritative ETR MAY return a group membership test in the LISP Map-Reply Message that indicates if a given EID is served by the ETR. The membership test is implemented as a Bloom filter. A Bloom filter is compact data structure to represent a set of elements. The membership test "aggregates" EIDs beyond prefix based aggregation. Membership test decreases the load of the mapping system and distributes the EID-to-RLOC resolution between an ITR and an ETR. 
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 2, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>

<a name="anchor1"></a><br /><hr />
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> LISP [I-D.ietf-lisp] architecture divides the IP address space into two separate name spaces:
   Endpoint IDs (EIDs), used within sites, and Routing Locators (RLOCs), used on the transit network (the Internet) that connect the sites.  Communication across the transit network requires a mapping between these two spaces. To achieve this mapping, LISP architecture assumes the existence of a
   database to store and propagate those mappings globally between gateway devices at the name space boundary. Several of such databases have been proposed, among them: LISP-CONS [CONS],
   LISP-NERD [NERD], and LISP+ALT [I-D.ietf-lisp-alt], together with a network based API called LISP Map-Server [I-D.ietf-lisp-ms].  
      
</p>
<p> As defined currently by the LISP protocol [I-D.ietf-lisp], a host that wants to communicate with an other host in another domain needs to first resolve the FQDN of the destination to a destination EID. The packet is then sent to through an Ingress Tunnel Router (ITR) to the destination. If the Ingress Tunnel Router acting as a gateway between the two name spaces doesn't have a mapping for the destination EID to destination RLOC that is needed for tunnelling across the transit network, the ITR needs to resolve the EID-to-RLOC mapping from a mapping system possibly using a map resolver. The current implementation approach is to drop the first packet of the flow that didn't have a matching map entry. An alternative is to buffer the first packet. However, buffering adds complexity to the design in terms of buffer management and a delay component to the delivery of the first packet. In both cases whether the first packet is dropped or buffered map resolution has a cost in terms of decreased service experience (by causing a longer and varying service start-up time of sessions) or cost of equipment, or both. Map resolution is a costly operation and therefore its gain should be maximized and utilization should be minimized. The default behaviour of an ITR is to resolve a destination EID to a (set of) locator(s) (RLOCs) and cache the mapping in order to improve usability and to avoid the delay impact of the resolution process to session set up times. The resolved mapping of EID-to-RLOC set can be either per host EID or per an EID-prefix if EID aggregates into a prefix served by the Egress Tunnel Router (ETR).     

   
</p>
<p>
 This draft proposes a method to increase the gain of a successful mapping resolution. The idea is to retrieve more mappings by the same Map-Reply message rather than just the missing EID-to-RLOC mapping information. The proposed solution is complementing the caching of mappings where an earlier resolved EID-to-RLOC mapping can be shared with the other flows passing the same ITR. The cost of caching of mapping information has been previously studied in [cost] where it has been found to be beneficial by reducing the mapping resolution signalling. Our approach complements caching by increasing the information that is returned to the ingress tunnel router.

</p>
<p>
The gain of the map resolution can be improved by providing the requestor more mapping information than the very specific mapping that was originally  queried for. The ETR or its proxy that is authoritative for a given EID-to-RLOC mapping could in one extreme case return  all of its mappings, or just the some subset, maybe the most requested ones. The number of the mappings could easily be overwhelming if the EIDs do not aggregate, so a compressed expression is required. For example, if we have EIDs that do not aggregate under a EID-prefix, and ETR is servicing small businesses of size of 100 host, we would need to send 100 * (EID-to-RLOC) mapping information, that is at least 3200 bytes. For an enterprise with 1000 host with unaggregatable EIDs it would be 32 Kbytes. Enterprises larger than 1000 hosts are likely to have their EID-prefixes, but because the number of different prefixes will be so small the use of the membership test is not meaningful.  

</p>
<p>
This draft proposes that the authoritative ETR MAY return a group membership test that indicates if a given EID is served by the ETR in addition to the specific mapping information that is returned in the LISP Map-Reply Message. 

</p>
<p>

</p>
<p>

</p>
<p>

</p>
<a name="anchor2"></a><br /><hr />
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>
      </p>
<blockquote class="text"><dl>
<dt>
   Endpoint ID (EID):</dt>
<dd>
        <br />

        A 32-bit (for IPv4) or 128-bit (for IPv6) value
      used in the source and destination address fields of the first
      (most inner) LISP header of a packet.  The host obtains a
      destination EID the same way it obtains an destination address
      today, for example through a DNS lookup or SIP exchange. Defined in [I-D.ietf-lisp].
      
</dd>
<dt> EID-prefix: </dt>
<dd>
        <br />

  A power-of-2 block of EIDs which are allocated to a
      site by an address allocation authority.  EID-prefixes are
      associated with a set of RLOC addresses which make up a "database
      mapping".  EID-prefix allocations can be broken up into smaller
      blocks when an RLOC set is to be associated with the smaller EID-
      prefix. As in [I-D.ietf-lisp].
      
</dd>
<dt> Ingress Tunnel Router (ITR):</dt>
<dd>
        <br />

   A router which accepts an IP packet
      with a single IP header (more precisely, an IP packet that does
      not contain a LISP header).  The router treats this "inner" IP
      destination address as an EID and performs an EID-to-RLOC mapping
      lookup.  The router then prepends an "outer" IP header with one of
      its globally-routable RLOCs in the source address field and the
      result of the mapping lookup in the destination address field.
      Note that this destination RLOC may be an intermediate, proxy
      device that has better knowledge of the EID-to-RLOC mapping closer
      to the destination EID.  In general, an ITR receives IP packets
      from site end-systems on one side and sends LISP-encapsulated IP
      packets toward the Internet on the other side. Defined in [I-D.ietf-lisp].
      
</dd>
<dt>Egress Tunnel Router (ETR):</dt>
<dd>
        <br />

      A router that accepts an IP packet
      where the destination address in the "outer" IP header is one of
      its own RLOCs.  The router strips the "outer" header and forwards
      the packet based on the next IP header found.  In general, an ETR
      receives LISP-encapsulated IP packets from the Internet on one
      side and sends decapsulated IP packets to site end-systems on the other side.  ETR functionality does not have to be limited to a
      router device.  A server host can be the endpoint of a LISP tunnel
      as well. Defined in [I-D.ietf-lisp].
      
</dd>
<dt>EID-to-RLOC Cache: </dt>
<dd>
        <br />

       A short-lived, on-demand table in an ITR that
      stores, tracks, and is responsible for timing-out and otherwise
      validating EID-to-RLOC mappings.  This cache is distinct from the
      full "database" of EID-to-RLOC mappings, it is dynamic, local to
      the ITR(s), and relatively small while the database is
      distributed, relatively static, and much more global in scope. Defined in [I-D.ietf-lisp].
      
</dd>
<dt>Routing Locator (RLOC):</dt>
<dd>
        <br />

      The IPv4 or IPv6 address of an egress
      tunnel router (ETR).  It is the output of a EID-to-RLOC mapping
      lookup.  An EID maps to one or more RLOCs.  Typically, RLOCs are
      numbered from topologically-aggregatable blocks that are assigned
      to a site at each point to which it attaches to the global
      Internet; where the topology is defined by the connectivity of
      provider networks, RLOCs can be thought of as PA addresses.
      Multiple RLOCs can be assigned to the same ETR device or to
      multiple ETR devices at a site. Defined in [I-D.ietf-lisp].
      
</dd>
<dt>Membership test</dt>
<dd>
        <br />

       Bloom filter based membership test. Bloom filters <a class='info' href='#Bloom'>[Bloom]<span> (</span><span class='info'>, &ldquo;http://en.wikipedia.org/wiki/Bloom_filter,&rdquo; .</span><span>)</span></a> offer a compact method to represent a set of n elements using a vector of m bits. The Bloom filters use k independent hash functions that hash a set of input elements to one of the m array positions.  False positives are possible, but false negatives are not.  
      
</dd>
</dl></blockquote><p>
      
</p>
<a name="anchor3"></a><br /><hr />
<a name="rfc.section.3"></a><h3>3.&nbsp;
Membership test for identifier locator mapping</h3>

<p> The membership test offers means for an authoritative ETR to provide a set of EID to RLOC mappings to a requestor in an efficient way beyond what prefix based aggregation can offer. As explained in the Introduction section the resolution process is expensive in terms of delay, jitter and lost packets so that it would be beneficial to resolve  more mappings with the same transactions if possible. The membership test is a hash of EIDs. The membership test acts as a compressed representation of the end point identifiers that an ETR can serve. An ETR can express with it the most frequently requested mappings, or any other subset or all of the mappings. The use of membership test doesn't require that the EIDs aggregate into prefixes. This makes it optimal for cases where an ETR is serving EIDs from different EID blocks. In the Map-Reply message that the ETR returns to ITR, the ETR MAY provide one or more membership test hashes depending on the size of the mapping base that needs to be compressed to the requesting ITR. Multiple membership tests are useful in cases where there are different sets of hosts such as very frequently used, static hosts or nomadic, etc. 

When an ITR gets a new packet without a matching identifier locator mapping it runs the membership tests before resorting to a new mapping resolution transaction. If a membership test provides a positive match there is no reason to  buffer the first packet longer than what it takes to execute the membership test. Membership test is hash operation that is quick to execute (we use MD5 for this purpose, see next sections of this document). If no membership test provides a positive match, the default mapping resolution is executed as defined in LISP specification. 

</p>
<p>  When a packet arrives from a host to an ITR following steps SHOULD take place:

</p>
<ol class="text">
<li> An EID-to-RLOC mapping cache look up is performed based on the destination EID to find the destination RLOC  as defined in [I-D.ietf-lisp]. 
</li>
<li>If the look up returns a destination RLOC then the packet is encapsulated and forwarded as defined in the default behavior of LISP to the destination RLOC. 
</li>
<li>If the look up doesn't result into a RLOC then a membership test cache is checked and the tests are executed using the destination EID as an input.  
</li>
<li>If any of the membership tests results into a match then the corresponding RLOC is used for  creating a Map-Request  message that is "piggybacked" with the packet from the host and forwarded to ETR. Map-Request is formulated as defined in [I-D.ietf-lisp] for cases of reachability tests, or refreshing a mapping before TTL expiration (see section 6.1.3 in [I-D.ietf-lisp]). That is the destination IP address used for the Map-Request is one of the matching RLOCs. A successful membership test is handled as if there was a cache entry that is becoming stale to that particular EID-to-RLOC mapping. 
</li>
<li> In the case of no matching RLOCs in membership tests, the map resolution is invoked as defined in LISP and a Map-Request Message is sent to the mapping system.
          
</li>
</ol><p>

If an ITR receives an ICMP Network or ICMP Host Unreachable message for an RLOC it is using for an ETR, it MUST also remove the membership test vector associated with the RLOC. If the ITR receives a Negative Map-Reply then a related membership test should be removed from the cache. 

      
</p>
<p>  When a Map-Request Message arrives to the authoritative ETR the message is processed as following:

</p>
<ol class="text">
<li>The router looks up the destination EID in the router's EID-to-RLOC database.  An EID-to-RLOC Map-Reply message with the mapping information complemented with one or more optional membership test information elements is originated by the ETR. If there is no entry for the requested  EID then a Negative Map-Reply is returned as defined in [I-D.ietf-lisp]. 
 
</li>
</ol>
<p>When an ITR receives the Map-Reply message, it parses the message and stores the mapping information from the packet. This information is put in the ITR's EID-to-RLOC mapping cache (this is the on-demand cache referred in [I-D.ietf-lisp] ). The optional membership test(s) and the associated RLOC(s) of the originating ETR are stored ("conceptually") into a separate cache with a time out  value if such exists in the membership test option. The management of the membership test cache can be as simple as removing least frequently used entry from the cache when the cache is running out of space. The membership test entries can also time out if a time out value was provided in the membership test option. Membership tests that result false positives will cause a Negative Map-Reply which removes the related  membership test. A new membership test may be provided with the Map-Reply that replaces a previous one.      
 
</p>
<p>      
     
The ETR SHOULD calculate the membership tests beforehand and just add the membership test option with proper tests to the Map-Reply message. 

 
</p>
<a name="anchor4"></a><br /><hr />
<a name="rfc.section.4"></a><h3>4.&nbsp;
Message Format</h3>

<p>The membership test extends the LISP Map-Reply Message Format by defining a new  Mapping Protocol Data option that carries the membership data. The option is always associated with a record of a locator (RLOC) field in the  Map-Reply Message. 


</p>
<p>

 </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |Type=M |T|         Reserved    |Length of the Membership test  |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                        Membership test vector(0)              |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                        Membership test vector (1 ... 3)       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                          Membership  TTL                      |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


</pre></div><p>



</p>
<p>
</p>
<blockquote class="text"><dl>
<dt>
   Type:</dt>
<dd>
        <br />

        M: ( set to 1) Membership test information element.
        T: Set to 0 if no TTL value is included, Set to 1 if TTL for the test vector is included. 
      
</dd>
<dt>
Length of the Membership test </dt>
<dd>
        <br />

        16-bit unsigned integer.  The length of the option
        (including the type, reserved and length fields) in units of 8 octets. In some cases an RLOC may be associated to multiple Membership test vectors (e.g. frequently used, etc)
      
</dd>
<dt>
Membership test vector </dt>
<dd>
        <br />

        Multiple of 16 octets (128 bits) long Bloom filter.
      
</dd>
<dt>
 Membership  TTL</dt>
<dd>
        <br />

      The time in minutes the recipient of the Map-Reply will
      store the membership test.  If the TTL is 0, the entry should be removed
      from the cache immediately.  If the value is 0xffffffff, the
      recipient can decide locally how long to store the test.
      
</dd>
</dl></blockquote><p>
      
</p>
<p>

Bloom filters <a class='info' href='#Bloom'>[Bloom]<span> (</span><span class='info'>, &ldquo;http://en.wikipedia.org/wiki/Bloom_filter,&rdquo; .</span><span>)</span></a> may result into false positives which in this application context means that an EID is interpreted to belonging incorrectly to an ETR that doesn't host the EID. The error case degenerates into stale mapping information and the ETR should remove the previously sent Membership test from the ITR by setting TTL value = 0, or by providing a new Membership test vector (or vectors). In this case the first packet is lost, and the ITR needs to revert into full map resolution process.


</p>
<p> 


      
</p>
<a name="anchor5"></a><br /><hr />
<a name="rfc.section.5"></a><h3>5.&nbsp;
Calculation of the membership tests</h3>

<p>
The accuracy of the membership test depends on the length of the test vector, number of independent hashes, k,  and the number of elements, n, (that is the number of unique EIDs) that is inserted into the filter <a class='info' href='#Bloom'>[Bloom]<span> (</span><span class='info'>, &ldquo;http://en.wikipedia.org/wiki/Bloom_filter,&rdquo; .</span><span>)</span></a>, <a class='info' href='#Dharma'>[Dharma]<span> (</span><span class='info'>Dharmapurikar S., Krishnamurthy P., and Taylor, D.E., &ldquo;Longest prefix matching using bloom filters,&rdquo; April&nbsp;2006.</span><span>)</span></a>. 
</p>
<p>

We suggest to use fixed sets of the parameters defined for two cases. One is for small businesses, where the unaggregatable EIDs are in the order if 100 hosts and the other one is for larger companies/sites with unaggregatable EIDs of the order of 1000. The reason for this is to minimize the protocol logic, and to avoid any parameter negotiation between ITRs and ETRs. 

For the case of 100 EIDs we fix the number of hash functions to k=20, length of the test vector to 4096 bits (32*128 bits) and require 10exp-6 probability of false positives, the number of EIDs that can be covered is now 140. Compare this to the corresponding full map information (140*256= 35840 bits) the savings are 88%. 

For case of 1000 EIDs we fix the number of hash functions to k=20, length of the test vector to 32768 bits (256*128bits) and require 10exp-6 probability of false positives, the number of EIDs that can be covered is now 1350. 


In any case if the error probability or the covered EID do not meet the accuracy needs, more Membership test vectors with smaller covered EID sets could be added to the Map-Reply. It is a local decision of ETR how many Membership test vectors optimizes its RLOC-to-EID mappings. ETR chooses the size of the Membership test vector based on how many EID-to-RLOC mappings it has. In our scheme only the size changes, number of hash functions and error probability remains the same limiting the trade offs. Therefore two sets of parameters and covered EID sets  (one for less than 140 EIDs and the other for less than 1350 EIDs) is sufficient.  A site with more than 1000s of EIDs is likely to have aggregatable EID space.     

</p>
<p>

If an ETR is hosting EID-prefixes and EIDs, the Membership test SHOULD be used for host EIDs. EID-prefixes should be sent to the requesting ITR as defined in the base protocol [I-D.ietf-lisp] and sent separately. Adding prefix support to the Membership test is possible, but not covered in this draft because it introduces unnecessary complexity. An ETR is unlikely to host such a number of individual EID-prefixes that it would be justifiable to use a Membership test for prefixes.   


</p>
<p>


For the k hash functions we use MD5 algorithm [RFC1321], because of its availability in all platforms and because its output matches 128 length that is the size of IPv6 address and fits therefore well to IPv6 header structure, although the Membership test vector is part of LISP header.  MD5 is a cryptographic message digest algorithm that hashes arbitrary length strings to 128 bits. It has relatively fast implementation. Output of a MD5 hash function is used to set a corresponding bit in the Membership Test vector that is multiple of 128 bits. Notice that the Membership test vectors should be calculated beforehand in the ETR so that the results are ready before any Map-Reply with the Membership test is requested. Membership test vector content can change between ITRs and Map-Replies, they can even be customized per requesting ITR.  


</p>
<p>
Following pseudo code shows how the Membership test vector is calculated. This is just a standard use of Bloom filter code.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

MemberShipTest (array_of_EIDs_n= n elements, hash_function = "MD5",
number_of_hashes = 20, filter_size_m = 4086)
{
membership_test = allocate _tablesize_of (filter_size_m);
                                          // table size for m

        for (i= 0; i &lt; size_number_of_elements_n(array_of_EIDs_n); ++i){
		// for each n elements
         for (k= 0; k &lt; number_of_hashes; ++k) {
		// for each hashes set a bit in the membership test
            (membership_test [hash_function((uint8_t )k+1, EID(i))]= 1);

          }

        }
return membership_test;

}


</pre></div>
<a name="IANA"></a><br /><hr />
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>This document has no requests to IANA.
      
</p>
<a name="Security"></a><br /><hr />
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p> Use of Membership Test between an ITR and an ETR doesn't add to any new security issues between the ITR, mapping system or ETR beyond the current LISP solution. If an ITR can trust an EID-to-RLOC mapping from an ETR, it can trust the Membership test as well. False positives are handled in the same way as the stale mapping cache EID-to-RLOC entries.  
</p>
<a name="anchor6"></a><br /><hr />
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgments</h3>

<p> Acknowledgements belong to Johanna Heinonen, Petteri Pöyhonen, Sreenu Sasubilli, Jarno Rajahalme and for good comments, questions and improvements.  This work was supported by TEKES as part of the Future Internet program of TIVIT
</p>
<a name="rfc.references"></a><br /><hr />
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-lisp">[I-D.ietf-lisp]</a></td>
<td class="author-text">Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-06.txt">Locator/ID Separation Protocol (LISP)</a>,&rdquo; draft-ietf-lisp-06 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-lisp-alt">[I-D.ietf-lisp-alt]</a></td>
<td class="author-text">Fuller, V., Farinacci, D., Meyer, D., and D. Lewis, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-alt-04.txt">LISP Alternative Topology (LISP+ALT)</a>,&rdquo; draft-ietf-lisp-alt-04 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-alt-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-lisp-ms">[I-D.ietf-lisp-ms]</a></td>
<td class="author-text">Fuller, V. and D. Farinacci, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-ms-05.txt">LISP Map Server</a>,&rdquo; draft-ietf-lisp-ms-05 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-ms-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1321">[RFC1321]</a></td>
<td class="author-text"><a href="mailto:rivest@theory.lcs.mit.edu">Rivest, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1321">The MD5 Message-Digest Algorithm</a>,&rdquo; RFC&nbsp;1321, April&nbsp;1992 (<a href="http://www.rfc-editor.org/rfc/rfc1321.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="Bloom">[Bloom]</a></td>
<td class="author-text">&ldquo;<a href=" http://en.wikipedia.org/wiki/Bloom_filter">http://en.wikipedia.org/wiki/Bloom_filter</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="CONS">[CONS]</a></td>
<td class="author-text">Farinacci, D.,, Fuller, V., and Meyer, D., &ldquo;LISP-CONS: A Content distribution Overlay Network  Service for LISP,&rdquo; draft-meyer-lisp-cons-05.txt&nbsp;(work in progress), November&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="Dharma">[Dharma]</a></td>
<td class="author-text">Dharmapurikar S., Krishnamurthy P., and Taylor, D.E., &ldquo;Longest prefix matching using bloom filters,&rdquo; IEEE/ACM Transactions on Networking (TON) &nbsp;Volume 14 Issue 2 , April&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="NERD">[NERD]</a></td>
<td class="author-text">Lear, E., &ldquo;NERD: A Not-so-novel EID to RLOC Database,&rdquo; draft-lear-lisp-nerd-07.txt&nbsp;(work in progress), April&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="cost">[cost]</a></td>
<td class="author-text">Iannone L. and Bonaventure O., &ldquo;On the Cost of Caching Locator/ID mappings,&rdquo; CoNEXT&nbsp;New York, USA, December&nbsp;2007.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hannu Flinck</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia  Siemens Networks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Linnoitustie 6</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Espoo  02600</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hannu.flinck@nsn.com">hannu.flinck@nsn.com</a></td></tr>
</table>
</body></html>
