<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Elliptic-Curve Algorithm Integration in the Secure Shell Transport Layer</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Elliptic-Curve Algorithm Integration in the Secure Shell Transport Layer">
<meta name="keywords" content="I-D, Internet-Draft, Elliptic Curve Cryptography (ECC), SSH">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Secure Shell Working Group</td><td class="header">D. Stebila</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">University of Waterloo</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">J. Green</td></tr>
<tr><td class="header">Expires: April 4, 2009</td><td class="header">October 01, 2008</td></tr>
</table></td></tr></table>
<h1><br />Elliptic-Curve Algorithm Integration in the Secure Shell Transport Layer<br />draft-green-secsh-ecc-03</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 4, 2009.</p>

<h3>Abstract</h3>

<p>This document describes algorithms based on Elliptic Curve Cryptography (ECC) for use within the Secure Shell (SSH) transport protocol.  In particular, it specifies: Elliptic Curve Diffie-Hellman (ECDH) key agreement, Elliptic Curve Menezes-Qu-Vanstone (ECMQV) key agreement and Elliptic Curve Digital Signature Algorithm (ECDSA) for use in the SSH Transport Layer protocol.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#notation">2.</a>&nbsp;
Notation<br />
<a href="#ecc">3.</a>&nbsp;
ECC Public Key Algorithm<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ecc-key-format">3.1.</a>&nbsp;
Key Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ecc-sig-alg">3.1.1.</a>&nbsp;
Signature Algorithm<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ecc-sig-enc">3.1.2.</a>&nbsp;
Signature Encoding<br />
<a href="#ecdh">4.</a>&nbsp;
ECDH Key Exchange<br />
<a href="#ecmqv">5.</a>&nbsp;
ECMQV Key Exchange<br />
<a href="#iana">6.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-curveid">6.1.</a>&nbsp;
Elliptic Curve Domain Parameter Identifiers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-pubkey">6.2.</a>&nbsp;
ECC Public Key Algorithm (ecdsa-sha2)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-ecdsa">6.2.1.</a>&nbsp;
Elliptic Curve Digital Signature Algorithm<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-ecdh">6.3.</a>&nbsp;
ECDH Key Exchange Method Names (ecdh-sha2-*)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-ecmqv">6.4.</a>&nbsp;
ECMQV Key Exchange and Verification Method Name (ecmqv-sha2)<br />
<a href="#msgs">7.</a>&nbsp;
Key Exchange Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msgs-ecdh">7.1.</a>&nbsp;
ECDH Message Numbers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msgs-ecmqv">7.2.</a>&nbsp;
ECMQV Message Numbers<br />
<a href="#security">8.</a>&nbsp;
Security Considerations<br />
<a href="#params">9.</a>&nbsp;
Named Elliptic Curve Domain Parameters<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#params-curves">9.1.</a>&nbsp;
Required and Recommended Curves<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#params-equivs">9.2.</a>&nbsp;
SEC Equivalent NIST Curves and Encoded OIDs<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#ack">Appendix&nbsp;A.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Due to its inclusion in NSA's Suite B and its small key sizes elliptic curve cryptography (ECC) is becoming a widely utilized and attractive public-key cryptosystem.
</p>
<p>In the interest of adding Suite B algorithms to SSH this document adds three ECC Suite B algorithms to the Secure Shell arsenal: Elliptic Curve Menezes-Qu-Vanstone (ECMQV), Elliptic Curve Diffie-Hellman (ECDH), and Elliptic Curve Digital Signature Algorithm (ECDSA), as well as utilizing the SHA2 family of secure hash algorithms.
</p>
<p>Compared to cryptosystems such as RSA, DSA, and DH, ECC variations on these schemes offer equivalent security with smaller key sizes.  This is illustrated in the following table, based on Section 5.6.1 of NIST 800-57 <a class='info' href='#NIST-800-57'>[NIST&#8209;800&#8209;57]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;Recommendation for Key Management - Part 1: General (Revised),&rdquo; March&nbsp;2007.</span><span>)</span></a>, which gives approximate comparable key sizes for symmetric- and asymmetric-key cryptosystems based on the best known algorithms for attacking them.  L is field size and N is sub-field size.
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center"><col align="center"><col align="center">
<tr><th align="center">Symmetric</th><th align="center">Discrete Log (eg.  DSA, DH)</th><th align="center">RSA</th><th align="center">ECC</th></tr>
<tr>
<td align="center">80</td>
<td align="center">L = 1024 N = 160</td>
<td align="center">1024</td>
<td align="center">160-223</td>
</tr>
<tr>
<td align="center">112</td>
<td align="center">L = 2048 N = 256</td>
<td align="center">2048</td>
<td align="center">224-255</td>
</tr>
<tr>
<td align="center">128</td>
<td align="center">L = 3072 N = 256</td>
<td align="center">3072</td>
<td align="center">256-383</td>
</tr>
<tr>
<td align="center">192</td>
<td align="center">L = 7680 N = 384</td>
<td align="center">7680</td>
<td align="center">384-511</td>
</tr>
<tr>
<td align="center">256</td>
<td align="center">L = 15360 N = 512</td>
<td align="center">15360</td>
<td align="center">512+</td>
</tr>
</table>
<br clear="all" />

<p>Implementation of this specification requires familiarity with both SSH <a class='info' href='#RFC4251'>[RFC4251]<span> (</span><span class='info'>Ylonen, T. and C. Lonvick, &ldquo;The Secure Shell (SSH) Protocol Architecture,&rdquo; January&nbsp;2006.</span><span>)</span></a> <a class='info' href='#RFC4253'>[RFC4253]<span> (</span><span class='info'>Ylonen, T. and C. Lonvick, &ldquo;The Secure Shell (SSH) Transport Layer Protocol,&rdquo; January&nbsp;2006.</span><span>)</span></a> <a class='info' href='#RFC4250'>[RFC4250]<span> (</span><span class='info'>Lehtinen, S. and C. Lonvick, &ldquo;The Secure Shell (SSH) Protocol Assigned Numbers,&rdquo; January&nbsp;2006.</span><span>)</span></a> and ECC <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a> <a class='info' href='#IEEE1363'>[IEEE1363]<span> (</span><span class='info'>Institute of Electrical and Electronics Engineers, &ldquo;Standard Specifications for Public Key Cryptography,&rdquo; 2000.</span><span>)</span></a> <a class='info' href='#ANSI-X9.63'>[ANSI&#8209;X9.63]<span> (</span><span class='info'>American National Standards Institute, &ldquo;Public Key Cryptography For The Financial Services Industry: Key Agreement and Key Transport Using Elliptic Curve Cryptography,&rdquo; January&nbsp;1999.</span><span>)</span></a>.
</p>
<p>This document is concerned with SSH implementation details; specification of the underlying cryptographic algorithms is left to other standards documents.
</p>
<p>Comments on this draft are solicited and should be addressed to Douglas Stebila &lt;douglas@stebila.ca&gt;.
</p>
<a name="notation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Notation</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>The data types boolean, uint32, uint64, string, and mpint are to be interpreted in this document as described in <a class='info' href='#RFC4251'>[RFC4251]<span> (</span><span class='info'>Ylonen, T. and C. Lonvick, &ldquo;The Secure Shell (SSH) Protocol Architecture,&rdquo; January&nbsp;2006.</span><span>)</span></a>.
</p>
<p>The size of a set of elliptic curve domain parameters on a prime curve is defined as the number of bits in the binary representation of the field order, commonly denoted p.  Size on a characteristic-2 curve is defined as the number of bits in the binary representation of the field, commonly denoted m.  A set of elliptic curve domain parameters defines a group of order n generated by a base point P.
</p>
<a name="ecc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
ECC Public Key Algorithm</h3>

<p>The ECC public key algorithm is defined by its key format, corresponding signature algorithm ECDSA, signature encoding and algorithm identifiers.
</p>
<p>This section defines the "ecdsa-sha2" public key format and corresponding signature format.
</p>
<a name="ecc-key-format"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Key Format</h3>

<p>The "ecdsa-sha2" key format has the following encoding:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   string    "ecdsa-sha2"
   byte[n]   ecc_key_blob</pre></div>
<p>The ecc_key_blob value has the following specific encoding:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   string     [identifier]
   string     Q</pre></div>
<p>The string [identifier] is the identifier of the elliptic curve domain parameters. The format of this string is specified in <a class='info' href='#iana-curveid'>Section&nbsp;6.1<span> (</span><span class='info'>Elliptic Curve Domain Parameter Identifiers</span><span>)</span></a>. Information on the required and recommended sets of elliptic curve domain parameters for use with this algorithm can be found in <a class='info' href='#params'>Section&nbsp;9<span> (</span><span class='info'>Named Elliptic Curve Domain Parameters</span><span>)</span></a>.
</p>
<p>Q is the public key encoded from an elliptic curve point into an octet string as defined in Section 2.3.3 of <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a>.
</p>
<p>The algorithm for ECC key generation can be found in Section 3.2 of <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a>.  Given some elliptic curve domain parameters, an ECC key pair can be generated containing a private key, an integer d, and a public key, an elliptic curve point Q.
</p>
<a name="ecc-sig-alg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
Signature Algorithm</h3>

<p>Signing and verifying is done using the Elliptic Curve Digital Signature Algorithm (ECDSA).  ECDSA is specified in <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a> and in <a class='info' href='#ANSI-X9.62'>[ANSI&#8209;X9.62]<span> (</span><span class='info'>American National Standards Institute, &ldquo;Public Key Cryptography For The Financial Services Industry: The Elliptic Curve Digital Signature Algorithm (ECDSA),&rdquo; 1998.</span><span>)</span></a>.  The message hashing algorithm must be from the SHA2 family of hash functions <a class='info' href='#RFC4634'>[RFC4634]<span> (</span><span class='info'>Eastlake, D. and T. Hansen, &ldquo;US Secure Hash Algorithms (SHA and HMAC-SHA),&rdquo; July&nbsp;2006.</span><span>)</span></a> and is chosen according to the curve size as specified in <a class='info' href='#iana-ecdsa'>Section&nbsp;6.2.1<span> (</span><span class='info'>Elliptic Curve Digital Signature Algorithm</span><span>)</span></a>.
</p>
<a name="ecc-sig-enc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2"></a><h3>3.1.2.&nbsp;
Signature Encoding</h3>

<p>Signatures are encoded as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   string     "ecdsa-sha2"
   string     ecdsa_signature_blob</pre></div>
<p>The ecdsa_signature_blob value has the following specific encoding:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   mpint      r
   mpint      s</pre></div>
<p>The integers r and s are the output of the ECDSA algorithm.
</p>
<p>The width of the integer fields is determined by the curve being used.  Note that the integers r and s are integers modulo the order of the curve, which is may be larger than the size of the finite field.  Thus, the integers r and s are encoding as octet strings each of length ciel(log[2](n)/8) using Section 2.3.7 of <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a>, where n is the order of the elliptic curve group.
</p>
<a name="ecdh"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
ECDH Key Exchange</h3>

<p>The Elliptic Curve Diffie-Hellman (ECDH) key exchange method generates a shared secret from an ephemeral elliptic curve local private key and remote public key.  This key exchange method provides explicit server authentication as defined in <a class='info' href='#RFC4253'>[RFC4253]<span> (</span><span class='info'>Ylonen, T. and C. Lonvick, &ldquo;The Secure Shell (SSH) Transport Layer Protocol,&rdquo; January&nbsp;2006.</span><span>)</span></a> using a signature on the exchange hash.
</p>
<p>The primitive used for shared key generation is ECDH with cofactor multiplication, the full specification of which can be found in Section 3.3.2 of <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a>.  The algorithm for key pair generation can be found in Section 3.2 of <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a>.
</p>
<p>The family of key exchange method names defined for use with this key exchange can be found in <a class='info' href='#iana-ecdh'>Section&nbsp;6.3<span> (</span><span class='info'>ECDH Key Exchange Method Names (ecdh-sha2-*)</span><span>)</span></a>.  Algorithm negotiation chooses the public key algorithm to be used for signing and the method name of the key exchange.  The method name of the key exchange chosen determines the elliptic curve domain parameters and hash function to be used in the remainder of this section.
</p>
<p>Information on the required and recommended elliptic curve domain parameters for use with this method can be found in <a class='info' href='#params'>Section&nbsp;9<span> (</span><span class='info'>Named Elliptic Curve Domain Parameters</span><span>)</span></a>.
</p>
<p>All elliptic curve public keys MUST be validated after they are received.  An example of a validation algorithm can be found in A.16.10 of <a class='info' href='#IEEE1363'>[IEEE1363]<span> (</span><span class='info'>Institute of Electrical and Electronics Engineers, &ldquo;Standard Specifications for Public Key Cryptography,&rdquo; 2000.</span><span>)</span></a>.  If a key fails validation the key exchange MUST fail.
</p>
<p>The elliptic curve public keys (points) that must be transmitted are encoded into octet strings before they are transmitted.  The transformation between elliptic curve points and octet strings is specified in Section 2.3 of <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a>.  The output of shared key generation is a field element xp.  The ssh framework requires that the shared key be an integer.  The conversion between a field element and an integer is specified in Section 2.3.9 of <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a>.
</p>
<p>Specification of the message numbers SSH_MSG_KEX_ECDH_INIT and SSH_MSG_KEX_ECDH_REPLY are found in <a class='info' href='#msgs'>Section&nbsp;7<span> (</span><span class='info'>Key Exchange Messages</span><span>)</span></a>.
</p>
<p>The following is an overview of the key exchange process:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   Client                                                Server
   ------                                                ------
   Generate ephemeral key pair.
   SSH_MSG_KEX_ECDH_INIT  --------------&gt;

                                   Verify received key is valid.
                                    Generate ephemeral key pair.
                                          Compute shared secret.
                                Generate and sign exchange hash.
                          &lt;------------- SSH_MSG_KEX_ECDH_REPLY

   Verify received key is valid.
   *Verify host key belongs to server.
   Compute shared secret.
   Generate exchange hash.
   Verify server's signature.</pre></div>
<p>*It is recommended that the client verify that the host key sent is the server's host key (Using certificates or a local database).  The client is allowed to accept the host key without verification, but doing so will render the protocol insecure against active attacks.
</p>
<p>This is implemented using the following messages.
</p>
<p>The client sends:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   byte       SSH_MSG_KEX_ECDH_INIT
   string     client's ephemeral public key octet string</pre></div>
<p>The server responds with:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   byte       SSH_MSG_KEX_ECDH_REPLY
   string     server's public host key and/or certificates
   string     server's ephemeral public key octet string
   string     the signature on the exchange hash</pre></div>
<p>The exchange hash H is computed as the hash of the concatenation of the following.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   string     client's version string (CR and NL excluded)
   string     server's version string (CR and NL excluded)
   string     payload of the client's SSH_MSG_KEXINIT
   string     payload of the server's SSH_MSG_KEXINIT
   string     server's public host key
   string     client's ephemeral public key octet string
   string     server's ephemeral public key octet string
   mpint      shared secret</pre></div>
<a name="ecmqv"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
ECMQV Key Exchange</h3>

<p>The Elliptic Curve Menezes-Qu-Vanstone (ECMQV) key exchange algorithm generates a shared secret from two local elliptic curve key pairs and two remote public keys.  This key exchange method provides implicit server authentication as defined in <a class='info' href='#RFC4253'>[RFC4253]<span> (</span><span class='info'>Ylonen, T. and C. Lonvick, &ldquo;The Secure Shell (SSH) Transport Layer Protocol,&rdquo; January&nbsp;2006.</span><span>)</span></a>.
</p>
<p>The key exchange method name defined for use with this key exchange is "ecmqv-sha2".  This method name gives a hashing algorithm that is to be used for the HMAC below.  Future RFCs may define new method names specifying new hash algorithms for use with ECMQV.  More information about the method name and HMAC can be found in <a class='info' href='#iana-ecmqv'>Section&nbsp;6.4<span> (</span><span class='info'>ECMQV Key Exchange and Verification Method Name (ecmqv-sha2)</span><span>)</span></a>.
</p>
<p>In general the ECMQV key exchange is performed using the ephemeral and long term key pair of both the client and server, a total of 4 keys.  Within the framework of SSH the client does not have a long term key pair that needs to be authenticated.  Therefore we generate an ephemeral key and use that as both the clients keys.  This is more efficient than using two different ephemeral keys and does not adversely affect security (it is analogous to the one-pass protocol in Section 6.1 of <a class='info' href='#LMQSV98'>[LMQSV98]<span> (</span><span class='info'>Law, L., Menezes, A., Qu, M., Solinas, J., and S. Vanstone, &ldquo;An Efficient Protocol for Authenticated Key Agreement,&rdquo; August&nbsp;1998.</span><span>)</span></a>).
</p>
<p>A full description of the ECMQV primitive can be found in Section 3.4 of <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a>.  The algorithm for key pair generation can be found in Section 3.2 of <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a>.
</p>
<p>During algorithm negotiation with the SSH_MSG_KEXINIT messages the ECMQV key exchange method can only be chosen if a Public Key Algorithm supporting ECC host keys can also be chosen.  This is due to the use of implicit server authentication in this key exchange method.  This case is handled the same way that key exchange methods requiring encryption/signature capable public key algorithms are handled in Section 7.1 of <a class='info' href='#RFC4253'>[RFC4253]<span> (</span><span class='info'>Ylonen, T. and C. Lonvick, &ldquo;The Secure Shell (SSH) Transport Layer Protocol,&rdquo; January&nbsp;2006.</span><span>)</span></a>.  If ECMQV key exchange is chosen then the Public Key Algorithm supporting ECC host keys MUST also be chosen.
</p>
<p>ECMQV requires that all the keys used to generate a shared secret are generated over the same elliptic curve domain parameters.  Since the host key is used in the generation of the shared secret, allowing for implicit server authentication, the domain parameters associated with the host key are used throughout this section.
</p>
<p>All elliptic curve public keys MUST be validated after they are received.  An example of a validation algorithm can be found in A.16.10 of <a class='info' href='#IEEE1363'>[IEEE1363]<span> (</span><span class='info'>Institute of Electrical and Electronics Engineers, &ldquo;Standard Specifications for Public Key Cryptography,&rdquo; 2000.</span><span>)</span></a>.  If a key fails validation the key exchange MUST fail.
</p>
<p>The elliptic curve public keys (points) that must be transmitted are encoded into octet strings before they are transmitted.  The transformation between elliptic curve points and octet strings is specified in Section 2.3 of <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a>.  The output of shared key generation is a field element xp.  The ssh framework requires that the shared key be an integer.  The conversion between a field element and an integer is specified in Section 2.3.9 of <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a>.
</p>
<p>The following is an overview of the key exchange process:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   Client                                                Server
   ------                                                ------
   Generate ephemeral key pair.
   SSH_MSG_KEX_ECMQV_INIT -------------&gt;

                                   Verify received key is valid.
                                    Generate ephemeral key pair.
                                          Compute shared secret.
                             Generate exchange hash and compute
                           HMAC over it using the shared secret.
                          &lt;------------- SSH_MSG_KEX_ECDH_REPLY

   Verify received keys are valid.
   *Verify host key belongs to server.
   Compute shared secret.
   Verify HMAC.</pre></div>
<p>*It is recommended that the client verify that the host key sent is the server's host key (Using certificates or a local database).  The client is allowed to accept the host key without verification, but doing so will render the protocol insecure against active attacks.
</p>
<p>The specification of the message numbers SSH_MSG_ECMQV_INIT and SSH_MSG_ECMQV_REPLY can be found in <a class='info' href='#msgs'>Section&nbsp;7<span> (</span><span class='info'>Key Exchange Messages</span><span>)</span></a>.
</p>
<p>This key exchange algorithm is implemented with the following messages.
</p>
<p>The client sends:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   byte       SSH_MSG_ECMQV_INIT
   string     client's ephemeral public key octet string</pre></div>
<p>The server sends:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   byte       SSH_MSG_ECMQV_REPLY
   string     server's public host key octet string
   string     server's ephemeral public key octet string
   string     HMAC tag computed on H using the shared secret</pre></div>
<p>The hash H is formed by applying the algorithm HASH on a concatenation of the following:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   string     client's version string (CR and NL excluded)
   string     server's version string (CR and NL excluded)
   string     payload of the client's SSH_MSG_KEXINIT
   string     payload of the server's SSH_MSG_KEXINIT
   string     client's ephemeral public key octet
   string     server's public host key octet
   string     server's ephemeral public key octet
   mpint      shared secret</pre></div>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>This document defines a new family of key exchange method names, a new key exchange method name, and a new public key algorithm name in the SSH name registry.  These additions to the SSH name space will have to be approved the IANA.
</p>
<a name="iana-curveid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Elliptic Curve Domain Parameter Identifiers</h3>

<p>This section specifies identifiers encoding named elliptic curve domain parameters.  These identifiers are used in this document to identify the curve used in the ECC public key format, the ECDSA signature blob, and the ECDH method name.
</p>
<p>An elliptic curve domain parameter identifier is the Base64 encoding of the MD5 hash <a class='info' href='#RFC1321'>[RFC1321]<span> (</span><span class='info'>Rivest, R., &ldquo;The MD5 Message-Digest Algorithm,&rdquo; April&nbsp;1992.</span><span>)</span></a> of the ASN.1 Distinguished Encoding Rules (DER) encoding <a class='info' href='#ASN1'>[ASN1]<span> (</span><span class='info'>International Telecommunications Union, &ldquo;Abstract Syntax Notation One (ASN.1): Specification of basic notation,&rdquo; July&nbsp;2002.</span><span>)</span></a> of the ASN.1 Object Identifier (OID) of the named curve domain parameters that are associated with the server's ECC host keys.  Every identifier is precisely 24 characters in length.  Base64 encoding is described in Section 6.8 of <a class='info' href='#RFC2045'>[RFC2045]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a>.  A list of the required and recommended curves, their OIDs, and the encoding of their identifiers can be found in <a class='info' href='#params'>Section&nbsp;9<span> (</span><span class='info'>Named Elliptic Curve Domain Parameters</span><span>)</span></a>.
</p>
<p>For example: the identifier for the sect163k1 elliptic curve domain parameters would be "4MHB+NBt3AlaSRQ7MnB4cg==".
</p>
<a name="iana-pubkey"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
ECC Public Key Algorithm (ecdsa-sha2)</h3>

<p>The ECC Public Key Algorithm is specified by the public key format identifier "ecdsa-sha2".
</p>
<a name="iana-ecdsa"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.1"></a><h3>6.2.1.&nbsp;
Elliptic Curve Digital Signature Algorithm</h3>

<p>The Elliptic Curve Digital Signature Algorithm (ECDSA) is specified for use with the ECC Public Key Algorithm.
</p>
<p>The hashing algorithm defined by this family of method names is the SHA2 family of hashing algorithms <a class='info' href='#RFC4634'>[RFC4634]<span> (</span><span class='info'>Eastlake, D. and T. Hansen, &ldquo;US Secure Hash Algorithms (SHA and HMAC-SHA),&rdquo; July&nbsp;2006.</span><span>)</span></a>.  The algorithm from the SHA2 family that will be used is chosen based on the size of the named curve specified in the public key:
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center">
<tr><th align="center">Curve Size</th><th align="center">Hash Algorithm</th></tr>
<tr>
<td align="center">b &lt;= 256</td>
<td align="center">SHA-256</td>
</tr>
<tr>
<td align="center">256 &lt; b &lt;= 384</td>
<td align="center">SHA-384</td>
</tr>
<tr>
<td align="center">384 &lt; b</td>
<td align="center">SHA-512</td>
</tr>
</table>
<br clear="all" />

<a name="iana-ecdh"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
ECDH Key Exchange Method Names (ecdh-sha2-*)</h3>

<p>The Elliptic Curve Diffie-Hellman key exchange is defined by a family of method names.  Each method name is the concatenation of the string "ecdh-sha2" with the elliptic curve domain parameter identifier as defined in Section <a class='info' href='#iana-curveid'>Section&nbsp;6.1<span> (</span><span class='info'>Elliptic Curve Domain Parameter Identifiers</span><span>)</span></a>. A list of the required and recommended curves and their OIDs can be found in <a class='info' href='#params'>Section&nbsp;9<span> (</span><span class='info'>Named Elliptic Curve Domain Parameters</span><span>)</span></a>.
</p>
<p>For example: The method name for ECDH key exchange with ephemeral keys generated on the sect409k1 curve would be "ecdh-sha2-m/FtSAmrV4j/Wy6RVUaK7A==".
</p>
<p>The hashing algorithm defined by this family of method names is the SHA2 family of hashing algorithms <a class='info' href='#RFC4634'>[RFC4634]<span> (</span><span class='info'>Eastlake, D. and T. Hansen, &ldquo;US Secure Hash Algorithms (SHA and HMAC-SHA),&rdquo; July&nbsp;2006.</span><span>)</span></a>.  The hashing algorithm is defined in the method name to allow room for other algorithms to be defined in future documents.  The algorithm from the SHA2 family that will be used is chosen based on the size of the named curve specified in the method name according to the table in Section <a class='info' href='#iana-ecdsa'>Section&nbsp;6.2.1<span> (</span><span class='info'>Elliptic Curve Digital Signature Algorithm</span><span>)</span></a>.
</p>
<p>The concatenation of any so encoded ASN.1 OID specifying a set of elliptic curve domain parameters with "ecdh-sha2-" is implicitly registered under this specification.
</p>
<a name="iana-ecmqv"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
ECMQV Key Exchange and Verification Method Name (ecmqv-sha2)</h3>

<p>The Elliptic Curve Menezes-Qu-Vanstone key exchange is defined by the method name "ecmqv-sha2".  Unlike the ECDH key exchange method, ECMQV relies on a public key algorithm that uses ECC keys: it does not need a family of method names because the curve information can be gained from the public key algorithm.
</p>
<p>The hashing and message authentication code algorithms are defined by the method name to allow room for other algorithms to be defined for use with ECMQV in future documents.
</p>
<p>The hashing algorithm defined by this method name is the SHA2 family of hashing algorithms <a class='info' href='#RFC4634'>[RFC4634]<span> (</span><span class='info'>Eastlake, D. and T. Hansen, &ldquo;US Secure Hash Algorithms (SHA and HMAC-SHA),&rdquo; July&nbsp;2006.</span><span>)</span></a>.  The algorithm from the SHA2 family that will be used is chosen based on the size of the named curve specified for use with ECMQV by the chosen public key algorithm according to the table in Section <a class='info' href='#iana-ecdsa'>Section&nbsp;6.2.1<span> (</span><span class='info'>Elliptic Curve Digital Signature Algorithm</span><span>)</span></a>.
</p>
<p>The keyed-hash message authentication code that is used to identify the server and verify communications is based on the hash chosen above.  The information on implementing the HMAC based on the chosen hash algorithm can be found in <a class='info' href='#RFC4634'>[RFC4634]<span> (</span><span class='info'>Eastlake, D. and T. Hansen, &ldquo;US Secure Hash Algorithms (SHA and HMAC-SHA),&rdquo; July&nbsp;2006.</span><span>)</span></a>.
</p>
<a name="msgs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Key Exchange Messages</h3>

<p>The message numbers 30-49 are key exchange-specific and in a private namespace defined in <a class='info' href='#RFC4250'>[RFC4250]<span> (</span><span class='info'>Lehtinen, S. and C. Lonvick, &ldquo;The Secure Shell (SSH) Protocol Assigned Numbers,&rdquo; January&nbsp;2006.</span><span>)</span></a> that may be redefined by any key exchange method <a class='info' href='#RFC4253'>[RFC4253]<span> (</span><span class='info'>Ylonen, T. and C. Lonvick, &ldquo;The Secure Shell (SSH) Transport Layer Protocol,&rdquo; January&nbsp;2006.</span><span>)</span></a> without being granted IANA permission.
</p>
<p>The following message numbers have been defined in this document:
</p>
<a name="msgs-ecdh"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
ECDH Message Numbers</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   #define SSH_MSG_KEX_ECDH_INIT                30
   #define SSH_MSG_KEX_ECDH_REPLY               31</pre></div>
<a name="msgs-ecmqv"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
ECMQV Message Numbers</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   #define SSH_MSG_ECMQV_INIT                   30
   #define SSH_MSG_ECMQV_REPLY                  31</pre></div>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>The Elliptic Curve Diffie-Hellman key agreement algorithm is defined in <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a>, <a class='info' href='#IEEE1363'>[IEEE1363]<span> (</span><span class='info'>Institute of Electrical and Electronics Engineers, &ldquo;Standard Specifications for Public Key Cryptography,&rdquo; 2000.</span><span>)</span></a> and <a class='info' href='#ANSI-X9.63'>[ANSI&#8209;X9.63]<span> (</span><span class='info'>American National Standards Institute, &ldquo;Public Key Cryptography For The Financial Services Industry: Key Agreement and Key Transport Using Elliptic Curve Cryptography,&rdquo; January&nbsp;1999.</span><span>)</span></a>.  The appropriate security considerations of those documents apply.
</p>
<p>The Elliptic Curve Menezes-Qu-Vanstone key agreement algorithm is defined in <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a>.  The security considerations raised in that document also apply.  A more detailed discussion of security considerations can be found in Section 4.7 of the Guide to Elliptic Curve Cryptography <a class='info' href='#HMV04'>[HMV04]<span> (</span><span class='info'>Hankerson, D., Menezes, A., and S. Vanstone, &ldquo;Guide to Elliptic Curve Cryptography,&rdquo; 2004.</span><span>)</span></a>.
</p>
<p>The server's host key is used in the ECMQV key exchange algorithm.  This means that the strength of the server's ECC host key determines the strength of the ECMQV key exchange algorithm.  This should be taken into consideration when generating ECC keys for a server.
</p>
<p>The methods defined in Section <a class='info' href='#iana'>Section&nbsp;6<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a> rely on the SHA2 family of hashing functions as defined in <a class='info' href='#FIPS-180-2'>[FIPS&#8209;180&#8209;2]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;Secure Hash Standard,&rdquo; August&nbsp;2002.</span><span>)</span></a>.  The appropriate security considerations of that document apply.
</p>
<p>The hashing algorithms defined for use with ECDH and ECMQV are defined by their method names so that if security problems are found with the SHA2 family of hashing algorithms or more secure hashing algorithms become the standard then future documents can extend this document to include new hashing algorithms by defining new method names.
</p>
<p>Additionally a good general discussion of the security considerations that must be taken into account when creating an ECC implementation can be found in Section 5 of the Guide to Elliptic Curve Cryptography <a class='info' href='#HMV04'>[HMV04]<span> (</span><span class='info'>Hankerson, D., Menezes, A., and S. Vanstone, &ldquo;Guide to Elliptic Curve Cryptography,&rdquo; 2004.</span><span>)</span></a>.
</p>
<p>Since ECDH and ECMQV allow for elliptic curves of arbitrary sizes and thus arbitrary security strength, it is important that the size of elliptic curve be chosen to match the security strength of other elements of the SSH handshake.  In particular, host key sizes, hashing algorithms and bulk encryption algorithms must be chosen appropriately.  Information regarding estimated equivalence of key sizes is available in <a class='info' href='#NIST-800-57'>[NIST&#8209;800&#8209;57]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;Recommendation for Key Management - Part 1: General (Revised),&rdquo; March&nbsp;2007.</span><span>)</span></a>. We note in particular that when ECDSA is used as the signature algorithm and ECDH is used as the key exchange method, if curves of different sizes are used, then it is possible that different hash functions from the SHA2 family could be used.
</p>
<a name="params"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Named Elliptic Curve Domain Parameters</h3>

<p>Implementations may support any ASN.1 object identifier (OID) in the ASN.1 object tree that defines a set of elliptic curve domain parameters <a class='info' href='#ASN1'>[ASN1]<span> (</span><span class='info'>International Telecommunications Union, &ldquo;Abstract Syntax Notation One (ASN.1): Specification of basic notation,&rdquo; July&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="params-curves"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
Required and Recommended Curves</h3>

<p>Every SSH ECC implementation MUST support the named curves below, these curves are defined in <a class='info' href='#SEC2'>[SEC2]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;Recommended Elliptic Curve Domain Parameters,&rdquo; September&nbsp;2000.</span><span>)</span></a>.  These curves should always be enabled unless specifically disabled by local security policy.
</p>
<p>
			</p>
<ul class="text">
<li>secp256r1
</li>
<li>secp384r1
</li>
<li>secp521r1
</li>
</ul><p>
			
</p>
<p>It is RECOMMENDED that SSH ECC implementations also support the following curves.
</p>
<p>
			</p>
<ul class="text">
<li>sect163k1
</li>
<li>sect233k1
</li>
<li>sect233r1
</li>
<li>sect283k1
</li>
<li>sect409k1
</li>
<li>sect409r1
</li>
<li>sect571k1
</li>
<li>secp192r1
</li>
<li>secp224r1
</li>
</ul><p>
			
</p>
<a name="params-equivs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
SEC Equivalent NIST Curves and Encoded OIDs</h3>

<p>The following table lists common curves by their equivalent SEC and NIST names.  The named NIST curves are specified in <a class='info' href='#NIST-CURVES'>[NIST&#8209;CURVES]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;Recommended Elliptic Curves for Federal Government Use,&rdquo; August&nbsp;1999.</span><span>)</span></a>.
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center">
<tr><th align="center">SEC</th><th align="center">NIST</th></tr>
<tr>
<td align="center">sect163k1</td>
<td align="center">nistk163</td>
</tr>
<tr>
<td align="center">secp192r1</td>
<td align="center">nistp192</td>
</tr>
<tr>
<td align="center">secp224r1</td>
<td align="center">nistp224</td>
</tr>
<tr>
<td align="center">sect233k1</td>
<td align="center">nistk233</td>
</tr>
<tr>
<td align="center">sect233r1</td>
<td align="center">nistb233</td>
</tr>
<tr>
<td align="center">secp256r1</td>
<td align="center">nistp256</td>
</tr>
<tr>
<td align="center">sect283k1</td>
<td align="center">nistk283</td>
</tr>
<tr>
<td align="center">secp384r1</td>
<td align="center">nistp384</td>
</tr>
<tr>
<td align="center">sect409k1</td>
<td align="center">nistk409</td>
</tr>
<tr>
<td align="center">sect409r1</td>
<td align="center">nistb409</td>
</tr>
<tr>
<td align="center">secp521r1</td>
<td align="center">nistp521</td>
</tr>
<tr>
<td align="center">sect571k1</td>
<td align="center">nistk571</td>
</tr>
</table>
<br clear="all" />

<p>The following table lists the above SEC curves, their OID, and the encoding of their OID as appropriate for the identifiers and method names defined in Section <a class='info' href='#iana'>Section&nbsp;6<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>.  The encoding is the Base64 encoding of the MD5 hash <a class='info' href='#RFC1321'>[RFC1321]<span> (</span><span class='info'>Rivest, R., &ldquo;The MD5 Message-Digest Algorithm,&rdquo; April&nbsp;1992.</span><span>)</span></a> of the ASN.1 Distinguished Encoding Rules (DER) encoding <a class='info' href='#ASN1'>[ASN1]<span> (</span><span class='info'>International Telecommunications Union, &ldquo;Abstract Syntax Notation One (ASN.1): Specification of basic notation,&rdquo; July&nbsp;2002.</span><span>)</span></a> of the ASN.1 Object Identifier (OID) of the named curve domain parameters that are associated with the ephemeral keys.  Base64 encoding is described in Section 6.8 of <a class='info' href='#RFC2045'>[RFC2045]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a>.
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center"><col align="center">
<tr><th align="center">SEC</th><th align="center">OID</th><th align="center">Base64(MD5(DER(OID)))</th></tr>
<tr>
<td align="center">sect163k1</td>
<td align="center">1.3.132.0.1</td>
<td align="center">4MHB+NBt3AlaSRQ7MnB4cg==</td>
</tr>
<tr>
<td align="center">secp192r1</td>
<td align="center">1.2.840.10045.3.1.1</td>
<td align="center">5pPrSUQtIaTjUSt5VZNBjg==</td>
</tr>
<tr>
<td align="center">secp224r1</td>
<td align="center">1.3.132.0.33</td>
<td align="center">VqBg4QRPjxx1EXZdV0GdWQ==</td>
</tr>
<tr>
<td align="center">sect233k1</td>
<td align="center">1.3.132.0.26</td>
<td align="center">zD/b3hu/71952ArpUG4OjQ==</td>
</tr>
<tr>
<td align="center">sect233r1</td>
<td align="center">1.3.132.0.27</td>
<td align="center">qCbG5Cn/jjsZ7nBeR7EnOA==</td>
</tr>
<tr>
<td align="center">secp256r1</td>
<td align="center">1.2.840.10045.3.1.7</td>
<td align="center">9UzNcgwTlEnSCECZa7V1mw==</td>
</tr>
<tr>
<td align="center">sect283k1</td>
<td align="center">1.3.132.0.16</td>
<td align="center">wiRIU8TKjMZ418sMqlqtvQ==</td>
</tr>
<tr>
<td align="center">secp384r1</td>
<td align="center">1.3.132.0.34</td>
<td align="center">qcFQaMAMGhTziMT0z+Tuzw==</td>
</tr>
<tr>
<td align="center">sect409k1</td>
<td align="center">1.3.132.0.36</td>
<td align="center">m/FtSAmrV4j/Wy6RVUaK7A==</td>
</tr>
<tr>
<td align="center">sect409r1</td>
<td align="center">1.3.132.0.37</td>
<td align="center">D3FefCjYoJ/kfXgAyLddYA==</td>
</tr>
<tr>
<td align="center">secp521r1</td>
<td align="center">1.3.132.0.35</td>
<td align="center">h/SsxnLCtRBh7I9ATyeB3A==</td>
</tr>
<tr>
<td align="center">sect571k1</td>
<td align="center">1.3.132.0.38</td>
<td align="center">mNVwCXAoS1HGmHpLvBC94w==</td>
</tr>
</table>
<br clear="all" />

<p>The following sequence of commands can be used on many Unix-type systems to generated the encoding of the OID as above.  The command oid below is an OID converter such as <a class='info' href='#OID.C'>[OID.C]<span> (</span><span class='info'>Gartner, M., &ldquo;OID Converter,&rdquo; 2006.</span><span>)</span></a>.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   echo -n ${i} &gt; tmp.oid
   echo -n 0000: &gt; tmp.hex
   oid -i tmp.oid &gt;&gt; tmp.hex
   xxd -r tmp.hex tmp.der
   openssl md5 -binary &lt; tmp.der &gt; tmp.md5
   openssl base64 &lt; tmp.md5 &gt; tmp.b64
   cat tmp.b64</pre></div>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ASN1">[ASN1]</a></td>
<td class="author-text">International Telecommunications Union, &ldquo;Abstract Syntax Notation One (ASN.1): Specification of basic notation,&rdquo; &nbsp;X.680, July&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1321">[RFC1321]</a></td>
<td class="author-text"><a href="mailto:rivest@theory.lcs.mit.edu">Rivest, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1321">The MD5 Message-Digest Algorithm</a>,&rdquo; RFC&nbsp;1321, April&nbsp;1992 (<a href="http://www.rfc-editor.org/rfc/rfc1321.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2045">[RFC2045]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2045">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>,&rdquo; RFC&nbsp;2045, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2045.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4250">[RFC4250]</a></td>
<td class="author-text">Lehtinen, S. and C. Lonvick, &ldquo;<a href="http://tools.ietf.org/html/rfc4250">The Secure Shell (SSH) Protocol Assigned Numbers</a>,&rdquo; RFC&nbsp;4250, January&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4250.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4251">[RFC4251]</a></td>
<td class="author-text">Ylonen, T. and C. Lonvick, &ldquo;<a href="http://tools.ietf.org/html/rfc4251">The Secure Shell (SSH) Protocol Architecture</a>,&rdquo; RFC&nbsp;4251, January&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4251.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4253">[RFC4253]</a></td>
<td class="author-text">Ylonen, T. and C. Lonvick, &ldquo;<a href="http://tools.ietf.org/html/rfc4253">The Secure Shell (SSH) Transport Layer Protocol</a>,&rdquo; RFC&nbsp;4253, January&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4253.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4634">[RFC4634]</a></td>
<td class="author-text">Eastlake, D. and T. Hansen, &ldquo;<a href="http://tools.ietf.org/html/rfc4634">US Secure Hash Algorithms (SHA and HMAC-SHA)</a>,&rdquo; RFC&nbsp;4634, July&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4634.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SEC1">[SEC1]</a></td>
<td class="author-text">Standards for Efficient Cryptography Group, &ldquo;<a href="http://www.secg.org/">Elliptic Curve Cryptography</a>,&rdquo; SEC&nbsp;1, September&nbsp;2000 (<a href="http://www.secg.org/download/aid-385/sec1_final.pdf">PDF</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SEC2">[SEC2]</a></td>
<td class="author-text">Standards for Efficient Cryptography Group, &ldquo;<a href="http://www.secg.org/">Recommended Elliptic Curve Domain Parameters</a>,&rdquo; SEC&nbsp;2, September&nbsp;2000 (<a href="http://www.secg.org/download/aid-386/sec2_final.pdf">PDF</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ANSI-X9.62">[ANSI-X9.62]</a></td>
<td class="author-text">American National Standards Institute, &ldquo;Public Key Cryptography For The Financial Services Industry: The Elliptic Curve Digital Signature Algorithm (ECDSA),&rdquo; ANSI&nbsp;X9.62, 1998.</td></tr>
<tr><td class="author-text" valign="top"><a name="ANSI-X9.63">[ANSI-X9.63]</a></td>
<td class="author-text">American National Standards Institute, &ldquo;Public Key Cryptography For The Financial Services Industry: Key Agreement and Key Transport Using Elliptic Curve Cryptography,&rdquo; ANSI&nbsp;X9.63, January&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="FIPS-180-2">[FIPS-180-2]</a></td>
<td class="author-text">National Institute of Standards and Technology, &ldquo;<a href="http://csrc.nist.gov/publications/fips/fips180-2/fips180-2.pdf">Secure Hash Standard</a>,&rdquo; FIPS&nbsp;180-2, August&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="HMV04">[HMV04]</a></td>
<td class="author-text">Hankerson, D., Menezes, A., and S. Vanstone, &ldquo;Guide to Elliptic Curve Cryptography,&rdquo; 2004.<p>
Springer, ISBN 038795273X
</p>
</td></tr>
<tr><td class="author-text" valign="top"><a name="IEEE1363">[IEEE1363]</a></td>
<td class="author-text">Institute of Electrical and Electronics Engineers, &ldquo;Standard Specifications for Public Key Cryptography,&rdquo; IEEE&nbsp;1363, 2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="LMQSV98">[LMQSV98]</a></td>
<td class="author-text">Law, L., Menezes, A., Qu, M., Solinas, J., and S. Vanstone, &ldquo;<a href="http://www.cacr.math.uwaterloo.ca/techreports/1998/corr98-05.pdf">An Efficient Protocol for Authenticated Key Agreement</a>,&rdquo; University of Waterloo Technical Report CORR&nbsp;98-05, August&nbsp;1998 (<a href="http://www.cacr.math.uwaterloo.ca/techreports/1998/corr98-05.pdf">PDF</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="NIST-800-57">[NIST-800-57]</a></td>
<td class="author-text">National Institute of Standards and Technology, &ldquo;<a href="http://csrc.nist.gov/publications/nistpubs/800-57/sp800-57-Part1-revised2_Mar08-2007.pdf">Recommendation for Key Management - Part 1: General (Revised)</a>,&rdquo; NIST Special Publication&nbsp;800-57, March&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="NIST-CURVES">[NIST-CURVES]</a></td>
<td class="author-text">National Institute of Standards and Technology, &ldquo;<a href="http://csrc.nist.gov/encryption/dss/ecdsa/NISTReCur.pdf">Recommended Elliptic Curves for Federal Government Use</a>,&rdquo; August&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="OID.C">[OID.C]</a></td>
<td class="author-text">Gartner, M., &ldquo;<a href="http://rtner.de/software/oid.html">OID Converter</a>,&rdquo; 2006.</td></tr>
</table>

<a name="ack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Acknowledgements</h3>

<p>The authors acknowledge helpful comments from Alfred Hines, Russ Housley, Jeffrey Hutzelman, and Rob Lambert.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Douglas Stebila</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">University of Waterloo</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Department of Combinatorics and Optimization</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Waterloo, Ontario  N2L 3G1</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Canada</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:douglas@stebila.ca">douglas@stebila.ca</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jon Green</td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
