
Network Working Group                                  Malleswar Kalla
INTERNET-DRAFT                                        Selvam Rengasami
                                                Telcordia Technologies
                                                         Ken Morneault
                                                         Cisco Systems
                                                       Greg Sidebottom
                                                       Nortel Networks


Expires in six months                                       March 2000




                  ISDN Q.921-User Adaptation Layer
                  <draft-ietf-sigtran-iua-02.txt>


Status of This Memo

This document is an Internet-Draft and is in full conformance with all
provisions of Section 10 of RFC 2026. Internet-Drafts are working
documents of the Internet Engineering Task Force (IETF), its areas,
and its working groups.  Note that other groups may also distribute
working documents as Internet-Drafts.

Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any
time.  It is inappropriate to use Internet-Drafts as reference
material or to cite them other than as 'work in progress.'

The list of current Internet-Drafts can be accessed at
http//www.ietf.org/ietf/1id-abstracts.txt

The list of Internet-Draft Shadow Directories can be accessed at
http//www.ietf.org/shadow.html.

To learn the current status of any Internet-Draft, please check the
'1id-abstracts.txt' listing contained in the Internet- Drafts Shadow
Directories on ftp.is.co.za (Africa), nic.nordu.net (Europe),
munnari.oz.au (Pacific Rim), ftp.ietf.org (US East Coast), or
ftp.isi.edu (US West Coast).



Abstract

This Internet Draft defines a protocol for backhauling of ISDN Q.921
User messages over IP using the Simple Control Transmission Protocol
(SCTP). This protocol would be used between a Signaling Gateway (SG)
and Media Gateway Controller (MGC). It is assumed that the SG receives
ISDN signaling over a standard ISDN interface.


Kalla, Rengasami, Morneault, & Sidebottom                     [Page 1]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


                        TABLE OF CONTENTS

1.  Introduction.....................................................3
  1.1  Scope.........................................................3
  1.2  Terminology...................................................3
  1.3  Signaling Transport Architecture..............................4
  1.4  Services Provided by the IUA Layer............................8
  1.5  Functions Implemented by the IUA Layer.......................10
  1.6  Definition of IUA Boundaries.................................11
2.  Protocol Elements...............................................12
  2.1  Common Message Header........................................12
  2.2  IUA Message Header...........................................13
  2.3  Description of Messages......................................14
3.  Procedures......................................................24
  3.1  Procedures to Support Service in Section 1.4.1...............24
  3.2  Procedures to Support Service in Section 1.4.2...............24
  3.3  Procedures to Support Service in Section 1.4.3...............25
4. Examples.........................................................32
  4.1 Establishment of associations between SG and MGC examples.....32
  4.2 ASP Traffic Fail-over Examples................................34
  4.3 Q.921/Q.931 primitives backhaul Examples......................36
  4.4 Layer Management Communication Examples.......................37
5.  Security........................................................37
  5.1 Threats.......................................................37
  5.2 Protecting Confidentiality ...................................38
6.  IANA Considerations.............................................38
7.  Acknowledgements................................................38
8.  References......................................................39
9.  Author's Addresses..............................................39






















Kalla, Rengasami, Morneault, & Sidebottom                     [Page 2]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


1.  Introduction

In this document, the term Q.921 user refers to an upper layer which
uses the services of Q.921, not the user side of ISDN interface. 
Examples of the upper layer would be Q.931 and QSIG.

This section describes the need for ISDN Q.921 User Adaptation (IUA)
layer protocol as well as how this protocol shall be implemented.

1.1 Scope

There is a need for Switched Circuit Network (SCN) signaling protocol
delivery from an ISDN Signaling Gateway (SG) to a Media Gateway
Controller (MGC).  The delivery mechanism should meet the following
criteria

*  Support for transport of the Q.921 / Q.931 boundary primitives
*  Support for communication between Layer Management modules on SG
   and MGC
*  Support for management of active associations between SG and MGC

This draft supports both ISDN Primary Rate Access (PRA) as well as
Basic Rate Access (BRA) including the support for both point-to-point
mode and point-to-multipoint modes of communication.  QSIG adaptation
layer requirements do not differ from Q.931 adaptation layer, hence
the procedures described in this draft are also applicable to QSIG
adaptation layer.  For simplicity, only Q.931 will be mentioned in the
rest of this document.

1.2 Terminology

Interface - For the purposes of this document an interface supports the
relevant ISDN signalling channel. This signalling channel may be a
16 kbps D channel for an ISDN BRA as well as 64 kbps primary or backup
D channel for an ISDN PRA.  For QSIG, the signalling channel is a Qc
channel.

Q.921-User - Any protocol normally using the services of the ISDN
Q.921 (e.g., Q.931, QSIG, etc.).

Backhaul - A SG terminates the lower layers of an SCN protocol and 
backhauls the other layer to MGC for call processing. For the purposes 
of this draft the SG terminates Q.921 and backhauls Q.931 to MGC.

Association - An association refers to a SCTP association.  The
association will provide the transport for the delivery of Q.921-User
protocol data units and IUA adaptation layer peer messages.




Kalla, Rengasami, Morneault, & Sidebottom                     [Page 3]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000



Stream - A stream refers to a SCTP stream.  For the purposes of this
document, a stream will be mapped to an ISDN signalling channel. 

Application Server (AS) - A logical entity serving a specific 
application instance.  An example of an Application Server is a MGC 
handling the Q.931 and call processing for D channels terminated by 
the Signaling Gateways.  Practically speaking, an AS is modeled at 
the SG as an ordered list of one or more related Application Server 
Processes (e.g., primary, secondary, tertiary). 

Application Server Process (ASP) - A process instance of an Application 
Server.  Examples of Application Server Processes are primary or backup 
MGC instances.

Application Server Process Path (ASP Path or just Path) - A Path to a 
remote Application Server Process instance.  A Path maps 1:1 to an SCTP 
association.

Fail-over - The capability to re-route signalling traffic as required
between related ASPs in the event of failure or unavailability of the
currently used ASP (e.g. from primary MGC to back-up MGC). Fail-over
also applies upon the return to service of a previously unavailable
process.

Network Byte Order: Most significant byte first, a.k.a Big Endian.

Host - The computing platform that the ASP process is running on.

Stream - A stream refers to an SCTP stream.

1.3 Signaling Transport Architecture

The architecture that has been defined [5] for SCN signaling transport
over IP uses multiple components, including an IP transport
protocol, a signaling common transport protocol and an adaptation
module to support the functions expected by a particular SCN signaling
protocol from its underlying protocol layer.

This document defines an adaptation module that is suitable for the
transport of ISDN Q.921 User (Q.931).










Kalla, Rengasami, Morneault, & Sidebottom                     [Page 4]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


1.3.1  Example - SG to MGC

In a Signaling Gateway, it is expected that the ISDN signaling is
received over a standard ISDN network termination. The SG then
provides interworking of transport functions with IP Signaling
Transport, in order to transport the Q.931 signaling messages to the
MGC where the peer Q.931 protocol layer exists, as shown below


******   ISDN        ******      IP      *******
* EP *---------------* SG *--------------* MGC *
******               ******              *******

+-----+                                  +-----+
|Q.931|              (NIF)               |Q.931|
+-----+           +----------+           +-----+
|     |           |     | IUA|           | IUA |
|     |           |     +----+           +-----+
|Q.921|           |Q.921|SCTP|           |SCTP |
|     |           |     +----+           +-----+
|     |           |     |UDP |           | UDP |
|     |           |     +----+           +-----+
|     |           |     | IP +           | IP  |
+-----+           +-----+----+           +-----+

NIF  - Nodal Interworking Function
EP   - ISDN End Point
SCTP - Simple Control Transmission Protocol (Refer to [3])
IUA  - ISDN User Adaptation Layer Protocol

1.3.2 Signaling Network Architecture

A Signaling Gateway is used to support the transport of Q.921-User
signaling traffic to one or more distributed ASPs (e.g., MGCs).
Clearly, the IUA protocol description cannot in itself meet any
performance and reliability requirements for such transport.  A
physical network architecture is required, with data on the
availability and transfer performance of the physical nodes involved
in any particular exchange of information.  However, the IUA protocol
must be flexible enough allow its operation and management in a
variety of physical configurations that will enable Network Operators
to meet their performance and reliability requirements.

To meet the stringent ISDN signaling reliability and performance
requirements for carrier grade networks, these Network Operators
should ensure that there is no single point of failure provisioned
in the end-to-end network architecture between an ISDN node and an IP
ASP.



Kalla, Rengasami, Morneault, & Sidebottom                     [Page 5]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


Depending of course on the reliability of the SG and ASP functional
elements, this can typically be met by the provision of redundant
QOS-bounded IP network paths for SCTP Associations between SCTP End
Points, and redundant Hosts, and redundant SGs. The distribution of
ASPs within the available Hosts is also important. For a particular
Application Server, the related ASPs should be distributed over at
least two Hosts.

An example physical network architecture relevant to carrier-grade
operation in the IP network domain is shown in Figure 1 below:

                                                       Host1
  ********                                         **************
  *      *_________________________________________*  ********  *
  *      *                                _________*  * ASP1 *  *
  *  SG1 *   SCTP Associations           |         *  ********  *
  *      *_______________________        |         *            *
  ********                       |       |         **************
                                 |       |   
  ********                       |       |        
  *      *_______________________________|       
  *      *                       |                
  *  SG2 *    SCTP Associations  |                
  *      *____________           |                
  *      *            |          |                     Host2
  ********            |          |                 **************  
                      |          |_________________*  ********  *
                      |____________________________*  * ASP1 *  *
                                                   *  ********  *
                                                   *            *
                                                   **************
                                                           .
                                                           .
                                                           .

                    Figure 2 - Physical Model Example


For carrier grade networks, Operators should ensure that under failure
or isolation of a particular ASP, stable calls are not lost. This
implies that ASPs need, in some cases, to share the call state or be
able to pass the call state between each other. However, this sharing
or communication is outside the scope of this document.

1.3.3 ASP Fail-over Model and Terminology

The IUA supports ASP fail-over functions in order to support a high
availability of call processing capability.  All Q.921-User messages
incoming to an SG are assigned to a unique Application Server, based
on the Interface Identifier of the message.

Kalla, Rengasami, Morneault, & Sidebottom                     [Page 6]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


The Application Server is in practical terms a list of all ASPs
currently registered to process Q.921-User messages from certain
Interface Identifiers. One or more ASPs in the list are normally
active (i.e., handling traffic) while any others may be unavailable
or inactive, to be possibly used in the event of failure or
unavailability of the active ASP(s). 

The fail-over model supports an n+k redundancy model, where n ASPs
is the minimum number of redundant ASPs required to handle traffic
and k ASPs are available to take over for a failed or unavailable
ASP. Note that 1+1 active/standby redundancy is a subset of this
model. A simplex 1+0 model is also supported as a subset, with no
ASP redundancy.

To avoid a single point of failure, it is recommended that a minimum
of two ASPs be in the list, resident in separate hosts  and therefore
available over different SCTP Associations.  For example, in the
network shown in Figure 1, all messages from a particular D Channel
could be sent to ASP1 in Host1 or ASP1 in Host2.  The AS list at SG1
might look like this:

    Interface Identifiers - Application Server #1
        ASP1/Host1  - State Up, Active
        ASP1/Host2  - State Up, Inactive

In this 1+1 redundancy case, ASP1 in Host1 would be sent any incoming
message for the Interface Identifiers registered.  ASP1 in Host2
would normally be brought to the active state upon failure of, or
loss of connectivity to, ASP1/Host1.  In this example, both ASPs are
Up, meaning that the related SCTP association and far-end IUA peer
is ready.

The AS List at SG1 might also be set up in loadshare mode:

    Interface Identifier {x) - Application Server #1
        ASP1/Host1 - State Up, Active
        ASP1/Host2 - State Up, Active

In this case, both the ASPs would be sent a portion of the traffic. 

In the process of fail-over or fail-back, it is recommended that in
the case of ASPs supporting call processing, stable calls do not
fail. It is possible that calls in transition may fail, although
measures of communication between the ASPs involved can be used to
mitigate this. 
For example, the two ASPs may share call state via shared memory,
or may use an ASP to ASP protocol to pass call state information.




Kalla, Rengasami, Morneault, & Sidebottom                     [Page 7]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


1.3.4 Client/Server Model

The SG takes on the role of server while the ASP is the client.
ASPs must initiate the SCTP association to the SG.

The SCTP (and UDP/TCP) Registered User Port Number Assignment for
IUA is 9900.

1.4 Services Provided by the IUA Layer

1.4.1  Support for transport of Q.921/Q.931 boundary primitives

In the backhaul scenario, the Q.921/Q.931 boundary primitives are
exposed.  IUA layer needs to support all of the primitives of this
boundary to successfully backhaul Q.931.

This includes the following primitives [1]

DL-ESTABLISH

The DL-ESTABLISH primitives are used to request, indicate and confirm
the outcome of the procedures for establishing multiple frame
operation.

DL-RELEASE

DL-RELEASE primitives are used to request, indicate, and confirm the
outcome of the procedures for terminating a previously established
multiple frame operation, or for reporting an unsuccessful
establishment attempt.

DL-DATA

The DL-DATA primitives are used to request and indicate SDUs
containing Q.931 PDUs which are to be transmitted, or have been
received, by the Q.921 layer using the acknowledged information
transfer service.

DL-UNIT DATA

The DL-UNIT DATA primitives are used to request and indicate SDUs
containing Q.931 PDUs which are to be transmitted, by the Q.921 layer
using the unacknowledged information transfer service.








Kalla, Rengasami, Morneault, & Sidebottom                     [Page 8]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


1.4.2  Support for communication between Layer Management modules
       on SG and MGC

It is envisioned that the IUA layer needs to provide some services
that will facilitate communication between Layer Management modules on
the SG and MGC. These primitives are pointed out in [2], which are
shown below

MIUA-TEI STATUS

The MIUA-TEI STATUS primitives are used to request, confirm and
indicate the status (in service/out of service) of a TEI.

To facilitate reporting of errors that arise because of backhauling
Q.931 scenario, the following primitive is defined

M-ERROR

The M-ERROR primitive is used to indicate an error with a received
IUA message (e.g., interface identifier value is not known to the SG).

1.4.3 Support for management of active associations between SG and MGC

The IUA layer on the SG keeps the state of various ASPs it is
associated with. A set of primitives between IUA layer and the Layer
Management are defined below to help the Layer Management manage the
association(s) between SG and MGC.

The IUA layer can be instructed by the Layer Management to establish
SCTP association to a peer IUA node. This can be achieved using the
following primitive

M-SCTP ESTABLISH

The M-SCTP ESTABLISH primitives are used to request, indicate, and
confirm the establishment of SCTP association to a peer IUA node.

The IUA layer may also need to inform the status of the SCTP
associations to the Layer Management. This can be achieved using the
following primitive

M-SCTP STATUS

The M-SCTP STATUS primitives are used to request and indicate the
status of the underlying SCTP association(s).






Kalla, Rengasami, Morneault, & Sidebottom                     [Page 9]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


The Layer Management may need to inform the IUA layer of a user status
(i.e., failure, active, etc.), so that messages can be exchanged
between IUA layer peers to stop traffic to the local IUA user.  This
can be achieved using the following primitive.

M-ASP STATUS

The M-ASP STATUS primitives are used to request and indicate the
status of the Application Server Process.

1.5 Functions Implemented by the IUA Layer

1.5.1 Mapping

The IUA layer must maintain a map of the Interface ID to a physical
interface on the Signaling Gateway.  A physical interface would
be a T1 line, E1 line, etc. In addition, for a given interface the SG
must be able to identify the associated signalling channel. IUA
layers on both SG and MGC need to maintain the status of TEIs, SAPIs.

1.5.2 Status of ASPs

The IUA layer on the SG must maintain the state of various ASPs it is
associated with. The state of an ASP changes because of reception of
peer-to-peer messages or reception of indications from the local SCTP
association. ASP state transition procedures are described in
section 3.3.1.

1.5.3 SCTP Stream Management

SCTP allows a user specified number of streams to be opened during the
initialization. It is the responsibility of the IUA layer to ensure
proper management of these streams. Because of the unidirectional
nature of streams, IUA layers are not aware of the stream information
from the peer IUA layers. For the purposes of this draft, it is
assumed that a separate stream will be used for each D channel.

1.5.4 Seamless Network Management Interworking

The IUA layer on the SG should pass an indication of unavailability of
the IUA-User (Q.931) to the local Layer Management, if the currently
active ASP moves from the ACTIVE state. The Layer Management could
instruct Q.921 to take some action, if it deems appropriate.








Kalla, Rengasami, Morneault, & Sidebottom                    [Page 10]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


1.5.5 Management Inhibit/Uninhibit

Local Management may wish to stop traffic across an SCTP association
in order to temporarily remove the association from service or to
perform testing and maintenance activity.  The function could
optionally be used to manage the start of traffic on to a newly
available SCTP association.

1.5.6  Active Association Control

At an SG, an Application Server list may contain active and inactive
ASPs to support ASP loads-haring and fail-over procedures. When, for
example, both a primary and a back-up ASP are available, IUA peer
protocol is required to control which ASP is currently active. The
ordered list of ASPs within a logical Application Server is kept
updated in the SG to reflect the active Application Server
Process(es).

1.6 Definition of IUA Boundaries

1.6.1 Definition of IUA/Q.921 boundary

DL-ESTABLISH
DL-RELEASE
DL-DATA
DL-UNIT DATA

1.6.2 Definition of IUA/Q.931 boundary

DL-ESTABLISH
DL-RELEASE
DL-DATA
DL-UNIT DATA

1.6.3 Definition of SCTP/IUA Boundary

The upper layer primitives provided by SCTP are available in
Reference [3] section 9.

1.6.4 Definition of IUA/Layer-Management Boundary

M-ERROR
M-NOTIFY
M-SCTP ESTABLISH
M-SCTP STATUS
M-ASP STATUS
MIUA-TEI STATUS




Kalla, Rengasami, Morneault, & Sidebottom                    [Page 11]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


2. Protocol Elements

This section describes the format of various messages used in this 
protocol.

2.1 Common Message Header

The protocol messages for Q.921 User Adaptation require a message
header which contains the adaptation layer version, the message type,
and message length. All types of messages contain this header. This
message header is common among all SCN signaling protocol adaptation
layers.


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Version    |     Spare     |         Message Type          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Message Length                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

     Figure 1 Common Header Format

All fields in an IUA message MUST be transmitted in the network byte
order, unless otherwise stated.

2.1.1 Version

The version field (vers) contains the version of the IUA adaptation
layer.  The supported versions are:

      0000 0001   Release 1.0 protocol

2.1.2  Message Types

The valid message types are defined in Section 2.2.2 and the message
contents are described in Section 2.3.  Each message can contain
parameters.

The following list contains the message names for the defined
messages.









Kalla, Rengasami, Morneault, & Sidebottom                    [Page 12]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


     Q.921/Q.931 Boundary Primitives Transport (QAUP) Messages

        Data Request Message                       0501
        Data Indication Message                    0502
        Unit Data Request Message                  0503
        Unit Data Indication Message               0504
        Establish Request                          0505
        Establish Confirm                          0506
        Establish Indication                       0507
        Release Request                            0508
        Release Confirm                            0509
        Release Indication                         0510

      Application Server Process Maintenance (ASPM) messages

        ASP Up                                     0301
        ASP Down                                   0302
        ASP Active                                 0401
        ASP Inactive                               0402

     Management (MGMT) Messages

        Error Indication                           0000
        Notify                                     0001
        TEI Status Request                         0101
        TEI Status Confirm                         0102
        TEI Status Indication                      0103


2.1.3 Message Length

The Message length defines the length of the message in octets, not
including the common Message header.

2.2 IUA Message Header

In addition to the common message header, there will be a specific
message header for QAUP and TEI related MGMT messages.  The IUA
message header will immediately follow the common message header in
these messages.

This message header will contain the Interface Identifier and Data
Link Connection Identifier(DLCI).  The Interface Identifier identifies
the physical interface terminating the signalling channel at the SG
for which the signaling messages are sent/received.  The format of the 
Interface Identifier parameter is an integer, the values of which are 
assigned according to network operator policy.  The values used are of 
local significance only, coordinated between the SG and ASP.


Kalla, Rengasami, Morneault, & Sidebottom                    [Page 13]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x1)           |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Interface Identifier                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            DLCI               |              Spare            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     
                  Figure 2 IUA Message Header

The Tag value for Interface Identifier is 0x1.  The length is always
set to a value of 4.

The DLCI format is shown below in Figure 3.

      0     1     2     3     4     5     6     7
   +-----+-----+-----+-----+-----+-----+-----+-----+
   |  0  | SPR |      SAPI                         |
   +-----------------------------------------------+
   |  1  |            TEI                          |
   +-----------------------------------------------+
     
              Figure 3 DLCI Format

SPR  Spare, 2nd bit in octet 1
SAPI Service Access Point Identifier, 3rd thru 8th bits in octet 1
TEI  Terminal Endpoint Identifier, 2nd thru 8th bits in octet 2

The DLCI field (including the SAPI and TEI) is coded in accordance
with Q.921.

2.3 IUA  Messages

The following section defines the messages and parameter contents.
The IUA messages will use the common message header (Figure 2) and
the IUA message header (Figure 3).

2.3.1 Q.921-User Backhauled Messages







Kalla, Rengasami, Morneault, & Sidebottom                    [Page 14]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


2.3.1.1  Establish Messages (Request, Confirm, Indication)

The Establish Messages are used to establish a data link on the
signalling channel or to confirm that a data link on the signalling
channel has been established.

The Establish messages contain the common message header followed by
IUA message header. It does not contain any additional parameters.

2.3.1.2  Release Messages (Request, Indication, Confirmation)

The Release Request message is used to release the data link on the
signalling channel. The Release Confirm and Indication messages are
used to indicate that the data link on the signaling channel has
been released.

The Release messages contain the common message header followed by
IUA message header. The Release confirm message is in response to
a Release Request message and it does not contain any additional
parameters. The Release Request and Indication messages contain the
following parameters

     REASON

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              Reason                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

The valid values for Reason are shown in the following table.

      Define     Value           Description
   RELEASE_MGMT   0x0     Management layer generated release.
   RELEASE_PHYS   0x1     Physical layer alarm generated release.
   RELEASE_DM     0x2     Specific to a request. Indicates Layer 2
                          should release and deny all requests from
                          far end to establish a data link on the
                          signalling channel (i.e. if SABME is
                          received send a DM)
   RELEASE_OTHER  0x3     Other reasons

Note Only RELEASE_MGMT, RELEASE_DM and RELEASE_OTHER are valid
reason codes for a Release Request message.

2.3.1.3 Data Messages (Request, Indication)

The Data message contains an ISDN Q.921-User Protocol Data Unit (PDU)
corresponding to acknowledged information transfer service.


Kalla, Rengasami, Morneault, & Sidebottom                    [Page 15]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


The Data messages contain the common message header followed by IUA
message header. The Data message contains the following parameters

     PROTOCOL DATA           

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                          Protocol Data                        |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

The protocol data contains upper layer signalling message e.g.
Q.931, QSIG.

2.3.1.4 Unit Data Messages (Request, Indication)

The Unit Data message contains an ISDN Q.921-User Protocol Data Unit
(PDU) corresponding to unacknowledged information transfer service.

The Unit Data messages contain the common message header followed by
IUA message header. The Unit Data message contains the following
parameters

     PROTOCOL DATA           

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                          Protocol Data                        |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

2.3.2  Application Server Process Maintenance (ASPM) Messages

The ASPM messages will only use the common message header.

2.3.2.1  ASP UP (ASPUP)

The ASP UP (ASPUP) message is used to indicate to a remote IUA peer
that the Adaptation layer is ready to receive traffic or maintenance
messages.

The ASPUP message contains the following parameters:

     Adaptation Layer Identifier (optional)
     Info String (optional)
     

Kalla, Rengasami, Morneault, & Sidebottom                    [Page 16]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


The format for ASPUP Message parameters is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x2)           |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   
   |                 Adaptation Layer Identifier*                  |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x4)           |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   
   |                          INFO String*                         |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

The Adaptation Layer Identifier (ALI) is a string that identifies the
adaptation layer. This string must be set to "IUA". The ALI would
normally only be used in the initial ASP Up message across a new SCTP
association to ensure both peers are assuming the same adaptation
layer protocol.

The optional INFO String parameter can carry any meaningful 8-BIT
ASCII character string along with the message.  Length of the INFO
String parameter is from 0 to 255 characters.  No procedures are
presently identified for its use but the INFO String may be used
for debugging purposes.

Note: Strings are padded to 32-bit boundaries.  The length field
indicates the end of the string.

2.3.2.2  ASP Down (ASPDN)

The ASP Down (ASPDN) message is used to indicate to a remote IUA peer
that the adaptation layer is not ready to receive traffic or
maintenance messages.

The ASPDN message contains the following parameters:

     Reason
     INFO String (Optional)








Kalla, Rengasami, Morneault, & Sidebottom                    [Page 17]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


The format for the ASPDN message parameters is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              Reason                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x4)           |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                         INFO String*                          |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

The format and description of the optional Info String parameter is
the same as for the ASP Up message (See Section 2.3.2.1.)

The Reason parameter indicates the reason that the remote IUA
adaptation layer is unavailable. The valid values for Reason are
shown in the following table.

     Value         Description
     0x1        Management Inhibit



2.3.2.3  ASP Active (ASPAC)

The ASPAC message is sent by an ASP to indicate to an SG that it is
Active and ready to be used.

The ASPAC message contains the following parameters:

     Type
     Interface Identifier (Optional)
     INFO String (Optional)

The format for the ASPAC message is as follows:













Kalla, Rengasami, Morneault, & Sidebottom                    [Page 18]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             Type                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0xx)           |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                     Interface Identifiers*                    |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Tag (0x4)             |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                          INFO String*                         |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


The Type parameter identifies the traffic mode of operation of the ASP
within an AS. The valid values for Type are shown in the following
table.

    Value          Description
     0x1            Over-ride
     0x2            Load-share
     0x3            New traffic

Within a particular Interface Identifier, only one Type can be used.
The Over-ride value indicates that the ASP is operating in Over-ride
mode, where the ASP takes over all traffic in an Application Server
(i.e., primary/back-up operation), over-riding any currently active
ASPs in the AS.  In loadshare mode, the ASP will share in the
traffic distribution with any other currently active ASPs. In New
traffic mode the ASP wishes to take on traffic in the AS but does
not expect to receive messages related to calls that are pending
completion in another ASP

The optional Interface Identifiers parameter contains a list of
Interface Identifier integers indexing the Application Server traffic
that the sending ASP is configured/registered to receive.  There is
one-to-one relationship between an Interface Identifier and an AS
Name. 

An SG that receives an ASPAC with an incorrect type for a particular
Interface Identifier will respond with an Error Message.

The format and description of the optional Info String parameter is the
same as for the ASP Up message (See Section 2.3.2.1.)


Kalla, Rengasami, Morneault, & Sidebottom                    [Page 19]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


2.3.2.4  ASP Inactive (ASPIA)

The ASPIA message is sent by an ASP to indicate to an SG that it is no
longer an active ASP to be used from within a list of ASPs.  The SG will
respond with an ASPIA message and either discard incoming messages or
buffer for a timed period and then discard.

The ASPIA message contains the following parameters:

     Type
     Interface Identifiers (Optional)
     INFO String (Optional)

The format for the ASPIA message parameters is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             Type                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0xx)           |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                     Interface Identifiers*                    |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x4)           |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                          INFO String*                         |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


The Type parameter identifies the traffic mode of operation of the ASP
within an AS. The valid values for Type are shown in the following table.

    Value          Description
     0x1            Over-ride
     0x2            Load-share
     0x3            Graceful Withdrawal

The format and description of the optional Interface Identifiers and
Info String parameters is the same as for the ASP Active message (See
Section 2.3.2.3.)


2.3.3  Layer Management (MGMT) Messages



Kalla, Rengasami, Morneault, & Sidebottom                    [Page 20]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


2.3.3.1  Error (ERR)

The ERR message is sent when an invalid value is found in an incoming
message. 

The ERR message contains the following parameters:

     Error Code
     Diagnostic Information (optional)

The format for the ERR message is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Error Code                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0xx)           |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                     Diagnostic Information*                   |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

The Error Code parameter indicates the reason for the Error Message. 
The Error parameter value can be one of the following values:

     Invalid Version                        0x1
     Invalid Interface Identifier           0x2
     Invalid Adaptation Layer Identifier    0x3
     Invalid Message Type                   0x4
     Invalid Stream Identifier              0x5
     Invalid TEI                            0x6

The optional Diagnostic information can be any information germane to
the error condition, to assist in identification of the error
condition. In the case of an Invalid Version Error Code the
Diagnostic information includes the supported Version parameter. In
the other cases, the Diagnostic information may be the first 40 bytes
of the offending message.

2.3.3.2  Notify (NTFY)

The Notify message used to provide autonomous notification of IUA
events. 






Kalla, Rengasami, Morneault, & Sidebottom                    [Page 21]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


The NTFY message contains the following parameters:

     Status Type
     Status Identification
     Interface Identifiers (Optional)
     INFO String (Optional)

The format for the NTFY message is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        Status Type            |    Status Identification      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Tag (0xx)             |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                      Interface Identifiers*                   |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Tag (0x4)             |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                          INFO String*                         |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


The Status Type parameter identifies the type of the Notify message.
Following are the valid Status Type values:

    Value          Description
      0x1   Application Server state change (AS_State_Change)
      0x2   Application Server Process state change (ASP_State_Change)
      0x3   Other

The Status Information parameter contains more detailed information
for the notification, based on the value of the Status Type. If
the Status Type is AS_State_Change the following Status Information
values are used:

      Value          Description    
       0x1	 Application Server Down (AS_Down)
       0x2	 Application Server Up (AS_Up)
       0x3	 Application Server Active (AS_Active)
       0x4	 Application Server Pending (AS_Pending)





Kalla, Rengasami, Morneault, & Sidebottom                    [Page 22]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


These notifications are sent from an SG to an ASP upon a change in
status of a particular Application Server.  The value reflects the
new state of the Application Server.

If the Status type is ASP_State_Change, the Status Information
values are:

      Value          Description    
       0x1	 Application Server Process (ASP) Down
       0x2	 Application Server Process (ASP) Up
       0x3	 Application Server Process (ASP) Active

These notifications are sent from an SG to an ASP upon a change in
status of a particular Application Server process within the ASP
list of a particular Application Server. The value reflects the new
state of the Application Server Process. 

If the Status Type is Other, then the following Status Information
values are defined:

      Value          Description    
       0x1    Insufficient ASP resources active in AS

This notification is not based on the SG reporting the state change
of an ASP or AS.  For the value defined the SG is indicating to an
ASP(s) in the AS that another ASP is required in order to handle
the load of the AS.

The format and description of the optional Interface Identifiers and
Info String parameters is the same as for the ASP Active message
(See Section 2.3.2.3.)

2.3.3.3 TEI Status Messages (Request, Confirm and Indication)

The TEI Status messages are exchanged between IUA layer peers to
request, confirm and indicate the status of a particular TEI.

The TEI Status messages contain the common message header followed by
IUA message header. The TEI Status Request message does not contain
any additional parameters.

The TEI Status Indication, and Confirm messages contain the following
parameters

     STATUS






Kalla, Rengasami, Morneault, & Sidebottom                    [Page 23]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              Status                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

The valid values for Status are shown in the following table.

      Define     Value           Description
   IN_SERVICE     0x0     TEI is in service
   OUT_OF_SERVICE 0x1     TEI is out of service

3.0 Procedures

The IUA layers needs to respond to various primitives it receives from
other layers as well as messages it receives from the peer-to-peer
messages. This section describes various procedures involved in
response to these events.

3.1 Procedures to support service in section 1.4.1

These procedures achieve the IUA layer's "Transport of Q.921/Q.931
boundary" service.

3.1.1 Q.921 or Q.931 primitives procedures

On receiving these primitives from the local layer, the IUA layer will
send the corresponding QAUP message (Data, Unit Data, Establish,
Release) to its peer. While doing so, the IUA layer needs to fill
various fields of the common and specific headers correctly. In
addition the message needs to be sent on the SCTP stream that
corresponds to the D channel.

3.1.2 QAUP message procedures

On receiving QAUP messages from a peer IUA layer, the IUA layer on an
SG or MGC needs to invoke the corresponding layer primitives
(DL-ESTABLISH, DL-DATA, DL-UNIT DATA, DL-RELEASE) to the local Q.921
or Q.931 layer.

3.2 Procedures to support service in section 1.4.2

These procedures achieve the IUA layer's "Support for Communication
between Layer Managements" service.







Kalla, Rengasami, Morneault, & Sidebottom                    [Page 24]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


3.2.1 Layer Management primitives procedures

On receiving these primitives from the local layer, the IUA layer will
send the corresponding MGMT message (TEI Status, Error) to its peer.
While doing so, the IUA layer needs to fill various fields of the
common and specific headers correctly.

3.2.2 MGMT message procedures

On receiving MGMT messages the IUA layer needs to invoke the
corresponding Layer Management primitives (MIUA-TEI STATUS, M-ERROR)
to the local layer management.

3.3 Procedures to support service in section 1.4.3

These procedures achieve the IUA layer's "Support for management of
active associations between SG and MGC" service.

3.3.1 State Maintenance

The IUA layer on the SG needs to maintain the states of each ASP as
well as the state of the AS.

3.3.1.1  ASP States

The state of the each ASP, in each AS that it is configured, is
maintained in the IUA layer on the SG. The state of an ASP changes
due to events. The events include

    * Reception of messages from peer IUA layer at that ASP
    * Reception of some messages from the peer IUA layer at other
      ASPs in the AS
    * Reception of indications from SCTP layer
    * Switch-over Time triggers

The ASP state transition diagram is shown in Figure 4.  The possible 
states of an ASP are:

ASP-DOWN: Application Server Process is unavailable and/or the SCTP
association is down. Initially all ASPs will be in this state.

ASP-UP: The remote IUA peer at the ASP is available (and the SCTP
association is up) but application traffic is stopped.

ASP-ACTIVE: The remote IUA peer at the ASP is available and
application traffic is active.





Kalla, Rengasami, Morneault, & Sidebottom                    [Page 25]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


ASP-ACT-OLD: The remote IUA peer at the ASP is available and
application traffic is active, but for draining of current
calls only (i.e., no new calls)

ASP-ACT-NEW: The remote IUA peer at the ASP is available and
application traffic is active, but for new calls only (i.e., not for
traffic related to completing calls in another ASP).


                 Figure 4: ASP State Transition Diagram

                                  +-------------+
           |----------------------|             |      
           |    ASPIA (GW)/   ____|  ASP-ACTIVE |<--------\
           |    Some other   /    +-------------+         |
           |    ASPAC (NT) /          ^     |             | Ts
           |             /     ASPAC  |     | ASPIA       |
           |           /      (LS,OR) |     | (LS,OR)     | 
           |         V                |     v             |
           | +-------------+      +-------------+       +-------------+
           | |             |      |             |       |             |
           | | ASP-ACT-OLD |----->|  ASP-UP     |------>| ASP-ACT-NEW |
           | +-------------+ Ts / +-------------+ ASPAC +-------------+
           |    |            ASPIA ^    |         (NT)      |
           |<---|                  |    |                   |
           |                       |    |                   |
 ASPDN/    |                 ASPUP |    | ASPDN/            |
 SCTP CDI  |                       |    | SCTP CDI          | ASPDN/
           |                       |    v                   | SCTP
           |                   +-------------+              | CDI
           |                   |             |              |
           |------------------>|             |<-------------|
                               |  ASP-DOWN   |
                               +-------------+


SCTP CDI: The local SCTP layer's Communication Down Indication to the  
Upper Layer Protocol (IUA) on an SG. The local SCTP will send this 
indication when it detects the loss of connectivity to the ASP's peer 
SCTP layer.

Ts: Switch-over Time Triggers.  This timer is configurable by the 
Operator on a per AS basis.

LS : Value of Type parameter in ASPIA and ASPAC messages is
equal to Load-share.

OR : Value of Type parameter in ASPIA and ASPAC messages is
equal to Over-ride.


Kalla, Rengasami, Morneault, & Sidebottom                    [Page 26]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


NT : Value of Type parameter in ASPAC message is equal to
New traffic.

GW : Value of Type parameter in ASPIA message is equal to
Graceful withdrawal.

3.3.1.2  AS States

The state of the AS is maintained in the IUA layer on the SG.

The state of an AS changes due to events. These events include:

   * ASP state transitions
   * Recovery timer triggers

The possible states of an AS are:

AS-DOWN: The Application Server is unavailable.  This state implies 
that all related ASPs are in the ASP-DOWN state for this AS.
Initially the AS will be in this state.

AS-UP: The Application Server is available but no application traffic
is active (i.e., one or more related ASPs are in the ASP-UP state,
but none in the ASP-Active state). 

AS-ACTIVE: The Application Server is available and application traffic 
is active. This state implies that one ASP is in the ASP-ACTIVE state.

AS-PENDING: An active ASP has transitioned from active to inactive or
down and it was the last remaining active ASP in the AS. A recovery 
timer T(r) will be started and all incoming SCN messages will be
queued by the SG. If an ASP becomes active before T(r) expires, the
AS will move to AS-ACTIVE state and all the queued messages will be
sent to the active ASP. 

If T(r) expires before an ASP becomes active, the SG stops queuing 
messages and  discards all previously queued messages. The AS will move 
to AS-UP if at least one ASP is in ASP-UP state, otherwise it will move 
to AS-DOWN state.












Kalla, Rengasami, Morneault, & Sidebottom                    [Page 27]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


                 Figure 5: AS State Transition Diagram

      +----------+  one ASP trans ACTIVE   +-------------+
      |          |------------------------>|             |      
      |  AS-UP   |                         |  AS-ACTIVE  |
      |          |                         |             |
      |          |<                       -|             |
      +----------+ \                     / +-------------+
         ^   |      \ Tr Trigger        /       ^    |
         |   |       \ at least one    /        |    |
         |   |        \ ASP in UP     /         |    |
         |   |         \             /          |    |
         |   |          \           /           |    |
         |   |           \     /---/            |    |
 one ASP |   |            \   /        one ASP  |    | Last ACTIVE ASP
 trans   |   | all ASP     \-/----\    trans to |    | trans to UP or
 to UP   |   | trans to     /      \   ACTIVE   |    | DOWN
         |   | DOWN        /        \           |    | 
         |   |            /          \          |    |
         |   |           /            \         |    |
         |   |          /all ASP       \        |    |
         |   v         / trans to       \       |    v         
      +----------+    /  DOWN            \ +-------------+
      |          |<--/                    -|             |      
      | AS-DOWN  |                         | AS-PENDING  |
      |          |                         |  (queueing) |
      |          |<------------------------|             |
      +----------+    Tr Trigger no ASP    +-------------+
                       in UP state

    Tr = Recovery Timer

3.3.2 ASPM procedures for primitives

Before the establishment of an SCTP association the ASP state at both 
the SG and ASP is assumed to be "Down".  

As the ASP is responsible for initiating the setup of an SCTP 
association to an SG, the IUA layer at an ASP receives an M-SCTP 
ESTABLISH request primitive from the Layer Management, the IUA layer
will try to establish an SCTP association with the remote IUA peer at 
an SG.  Upon reception of an eventual SCTP-Communication Up confirm 
primitive from the SCTP, the IUA layer will invoke the primitive
M-SCTP ESTABLISH confirm to the Layer Management.

At the SG, the IUA layer will receive an SCTP Communication Up 
indication primitive from the SCTP. The IUA layer will then invoke
the primitive M-SCTP ESTABLISH indication to the Layer Management. 



Kalla, Rengasami, Morneault, & Sidebottom                    [Page 28]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


Once the SCTP association is established, The IUA layer at an ASP
will then find out the state of its local IUA-user from the Layer 
Management using the primitive M-ASP STATUS.  Based on the status of
the local IUA-User, the local ASP IUA Application Server Process 
Maintenance (ASPM) function will initiate the ASPM procedures, using
the ASP-Up/-Down/-Active/-Inactive messages to convey the ASP-state
to the SG - see Section 3.3.3. 

If the IUA layer subsequently receives an SCTP-Communication Down 
indication from the underlying SCTP layer, it will inform the Layer 
Management by invoking the M-SCTP STATUS indication primitive. The 
state of the ASP will be moved to "Down" at both the SG and ASP.

At an ASP, the Layer Management may try to reestablish the SCTP 
association using M-SCTP ESTABLISH request primitive. 

3.3.3 ASPM procedures for peer-to-peer messages

All ASPM messages are sent on a sequenced stream to ensure ordering.  
SCTP stream 0 is used.

3.3.3.1 ASP-Up

After an ASP has successfully established an SCTP association to an SG, 
the SG waits for the ASP to send an ASP-Up message, indicating that the 
ASP IUA peer is available.  The ASP is always the initiator of the 
ASP-Up exchange.  

When an ASP-Up message is received at an SG and internally the ASP is 
not locked-out for local management reasons, the SG marks the remote 
ASP as Up.  The SG responds with an Notify (ASP-Up) message to the 
ASP in acknowledgement.  The SG sends a Notify (ASP-Up) message in 
response to a received ASP-Up message from the ASP even if the ASP is 
already marked as Up at the SG.  

If for any local reason the SG cannot respond with an ASP-Up, the SG 
responds to a ASP-Up with a ASP-Down message.  

At the ASP, the Notify (ASP-Up) message received from the SG is not 
acknowledged by the ASP.  If the ASP does not receive a response from 
the SG, or an ASP-Down is received, the ASP may resend ASP-Up messages 
every 2 seconds until it receives a Notify (ASP-Up) message from the 
SG.  The ASP may decide to reduce the frequency (say to every 5 
seconds) if a Notify (ASP-Up) is not received after a few tries.

The ASP must wait for the Notify (ASP-Up) message from the SG before 
sending any ASP traffic control messages (ASPAC or ASPIA) or Data 
messages or it will risk message loss.  If the SG receives Data 
messages before an ASP Up is received, the SG should discard.


Kalla, Rengasami, Morneault, & Sidebottom                    [Page 29]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


3.3.3.1.1 IUA Version Control

If a ASP-Up message with an unsupported version is received, the 
receiving end responds with an Error message, indicating the version 
the receiving node supports.

This is useful when protocol version upgrades are being performed in a 
network.  A node upgraded to a newer version should support the older 
versions used on other nodes it is communicating with.  Because ASPs 
initiate the ASP-Up procedure it is assumed that the Error message 
would normally come from the SG.

3.3.3.2 ASP-Down

The ASP will send an ASP-Down to an SG when the ASP is to be removed 
from the list of ASPs in all Application Servers that it is a member.

The SG marks the ASP as Down and returns an Notify (ASP-Down) message 
to the ASP if one of the following events occur:

    - an ASP-Down message is received from the ASP,
    - another ASPM message is received from the ASP and the SG has 
      locked out the ASP for management reasons.

The SG sends a Notify (ASP-Down) message in response to a received
ASP-Down message from the ASP even if the ASP is already marked as
Down at the SG.  

If the ASP does not receive a response from the SG, the ASP may send
ASP-Down messages every 2 seconds until it receives a ASP-Down message 
from the SG or the SCTP association goes down.  The ASP may decide to 
reduce the frequency (say to every 5 seconds) if an ASP-Down is not 
received after a few tries.

3.3.3.3 ASP-Active

Any time after the ASP has received a Notify (ASP-Up) acknowledgement 
from the SG, the ASP sends an ASP-Active (ASPAC) to the SG indicating 
that the ASP is ready to start processing traffic.  In the case where 
an ASP is configured/registered to process the traffic for more than 
one Application Server across an SCTP association, the ASPAC contains 
one or more Interface Identifiers to indicate for which Application
Servers the ASPAC applies. 

When an ASP Active (ASPAC) message is received, the SG responds to the 
ASP with a Notify message acknowledging that the ASPAC was received
and starts sending traffic for the associated Application Server(s)
to that ASP.



Kalla, Rengasami, Morneault, & Sidebottom                    [Page 30]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


There are three modes of Application Server traffic handling in the SG 
IUA - Over-ride, Load-balancing and New Traffic.  The Type parameter 
in the ASPAC messge indicates the mode used in a particular
Application Server. If the SG determines that the mode indicates in an
ASPAC is incompatible with the traffic handling mode currently used
in the AS, the SG responds with an Error message indicating Invalid
Traffic Handling Mode.

In the case of an Over-ride mode AS, reception of an ASPAC message at 
an SG causes the redirection of all traffic for the AS to the ASP
which sent the ASPAC.  Any previously active ASP in the AS is now
considered Inactive and will no longer receive traffic within the AS.
The SG responds to the ASPAC with a Notify (ASP-Active) message to
the ASP. The SG sends a Notify (ASP-Inactive) to any previously
active ASP in the AS.

In the case of a Loadshare mode AS, reception of an ASPAC message at
an SG causes the direction of traffic to the ASP sending the ASPAC,
in addition to all the other ASPs that are currently active in the AS.  
The algorithm at the SG for loadsharing traffic within an AS to all
the active ASPs is application and network dependent. The algorithm
could, for example be round-robin or based on information in the Data
message, such as Interface ID, depending on the requirements of the
application and the call state handling assumptions of the collection
of ASPs in the AS. The SG responds to the ASPAC with a Notify
(ASP-Active) message to the ASP.

In the case of a New Traffic mode AS, reception of an ASPAC message
at an SG causes the direction of traffic to the ASP sending the ASPAC.  
However, traffic related to completing calls in another ASP is not
sent to the new ASP (i.e., new calls only). How an SG accomplishes
the differentiation of old and new calls and any loadsharing of
traffic is application and implementation dependent. The SG responds
to the ASPAC with a Notify (ASP-Active_New) message to the ASP. After
a configurable time Ts, the ASP is moved to the ASP-Active state and
a Notify (ASP-Active) is sent to the ASP.

3.3.3.4 ASP Inactive

When an ASP wishes to withdraw from receiving traffic the ASP sends
an ASP Inactive (ASPIA) to the SG.  In the case where an ASP is 
configured/registered to process the traffic for more than one 
Application Server across an SCTP association, the ASPIA contains one 
or more Interface Ids to indicate for which Application Servers the 
ASPIA applies.






Kalla, Rengasami, Morneault, & Sidebottom                    [Page 31]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


There are three modes of Application Server traffic handling in the SG
IUA when withdrawing an ASP from service - Over-ride, Load-balancing 
and Graceful Withdrawal.  The Type parameter in the ASPIA messge 
indicates the mode used in a particular Application Server. If the SG 
determines that the mode indicates in an ASPAC is incompatible with
the traffic handling mode currently used in the AS, the SG responds
with an Error message indicating Invalid Traffic Handling Mode.

In the case of an Over-ride mode AS, where normally another ASP has 
already taken over the traffic within the AS with an Over-ride ASPAC, 
the ASP which sent the ASPIA is already considered by the SG to be 
Inactive.  A Notify (ASP_Up) message is resent to the ASP.  

In the case of a Loadshare mode AS, the SG moves the ASP to the 
Inactive state and the AS traffic is re-allocated across the 
remaining active ASPs per the loadsharing algorithm currently used 
within the AS.  A Notify (ASP-Up) message is sent to the ASP after the 
traffic is halted to the ASP.

In the case of Graceful Withdrawal, the SG diverts all traffic related 
to new calls to other active ASPs and therafter sends only traffic
related to incomplete calls to the ASP. A Notify (ASP-Act_Old) is
sent to the ASP and the ASP is moved to the Active_Old state.  When
the outstanding calls are drained, or after a configurable time Ts,
the SG moves the ASP to the Up state and sends a Notify (ASP-Up)
message to the ASP.

If no other ASPs are Active in the Application Server, the SG either 
discards all incoming messages (except messages related to an 
Active_Old ASP) for the AS or starts buffering the incoming messages
for T(r)seconds after which messages will be discarded.  T(r) is 
configurable by the network operator.  If the SG receives an ASPAC
from an ASP in the AS before expiry of T(r), the buffered traffic is
directed to the ASP and the timer is cancelled.

4. Examples

4.1 Establishment of Association and Traffic between SGs and ASPs

4.1.1 Single ASP in an Application Server (1+0 sparing)

This scenario shows the example IUA message flows for the 
establishment of traffic between an SG and an ASP, where only one ASP 
is configured within an AS (no backup).  It is assumed that the SCTP 
association is already set-up.






Kalla, Rengasami, Morneault, & Sidebottom                    [Page 32]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


             SG                       ASP1
              |
              |<---------ASP Up----------|
              |------NTFY (ASP-Up)------>|
              |                      -   |
              |<-------ASP Active--------|
              |----NTFY (ASP_Active)---->|
              |                          |

4.1.2 Two ASPs in Application Server (1+1 sparing)

This scenario shows the example IUA message flows for the
establishment of traffic between an SG and two ASPs in the same
Application Server, where ASP1 is configured to be Active and ASP2 a
standby in the event of communication failure or the withdrawal from
service of ASP1.  ASP2 may act as a hot, warm, or cold standby
depending on the extent to which ASP1 and ASP2 share call state or
can communicate call state under failure/withdrawal events.
The example message flow is the same whether the ASP-Active messages
are Over-ride or Load-share mode although typically this example would
use an Over-ride mode.

       SG                        ASP1                        ASP2
        |                         |                          |
        |<--------ASP Up----------|                          |
        |------NTFY (ASP-Up)----->|                          |
        |                         |                          |
        |<-----------------------------ASP Up----------------|
        |----------------------------NTFY (ASP-Up)---------->|
        |                         |                          |
        |                         |                          |
        |<-------ASP Active-------|                          |
        |----NTFY(ASP-Active)---->|                          |
        |                         |                          |


4.1.3 Two ASPs in an Application Server (1+1 sparing, load-sharing 
case)

This scenario shows a similar case to Section 4.1.2 but where the two 
ASPs are brought to active and loadshare the traffic load. In this
case, one ASP is sufficient to handle the total traffic load.









Kalla, Rengasami, Morneault, & Sidebottom                    [Page 33]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


       SG                       ASP1                       ASP2
        |                         |                          |
        |<---------ASP Up---------|                          |
        |-------NTFY(ASP-Up)----->|                          |
        |                         |                          |
        |<------------------------------ASP Up---------------|
        |-----------------------------NTFY(ASP Up)---------->|
        |                         |                          |
        |                         |                          |
        |<--ASP Active (Ldshr)----|                          |
        |----NTFY(ASP-Active)---->|                          |
        |                         |                          |
        |<----------------------------ASP Active (Ldshr)-----|
        |-----------------------------NTFY(ASP-Active)------>|
        |                         |                          |


4.1.4 Three ASPs in an Application Server (n+k sparing, load-sharing 
case) 

This scenario shows the example IUA message flows for the 
establishment of traffic between an SG and three ASPs in the same 
Application Server, where two of the ASPs are brought to active and 
share the load. In this case, a minimum of two ASPs are required to 
handle the total traffic load (2+1 sparing).

   SG                  ASP1                ASP2                ASP3
    |                    |                   |                   |
    |<------ASP Up-------|                   |                   |
    |----NTFY(ASP-Up)--->|                   |                   |
    |                    |                   |                   |
    |<--------------------------ASP Up-------|                   |
    |------------------------NTFY(ASP-Up)--->|                   |
    |                    |                   |                   |
    |<---------------------------------------------ASP Up--------|
    |--------------------------------------------NTFY(ASP-Up)--->|
    |                    |                   |                   |
    |                    |                   |                   |
    |<-ASP Act. (Ldshr)--|                   |                   |
    |---NTFY(ASP-Act.)-->|                   |                   |
    |                    |                   |                   |
    |<--------------------ASP Act. (Ldshr)---|                   |
    |----------------------NTFY(ASP-Act.)--->|                   |
    |                    |                   |                   |


4.2 ASP Traffic Fail-over Examples




Kalla, Rengasami, Morneault, & Sidebottom                    [Page 34]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


4.2.1 (1+1 Sparing, withdrawal of ASP, Back-up Over-ride) 

Following on from the example in Section 4.1.2, and ASP withdraws from 
service:

       SG                       ASP1                       ASP2
        |                         |                          |
        |<-----ASP Inactive-------|                          |
        |---NTFY(ASP Inactive)--->|                          |
        |--------------------NTFY(ASP-Inactive) (Optional)-->|
        |                         |                          |
        |<------------------------------ ASP Active----------|
        |-----------------------------NTFY(ASP-Active)------>|
        |                                                    |

Note: If the SG detects loss of the IUA peer (IUA heartbeat loss or 
detection of SCTP failure), the initial SG-ASP1 ASP Inactive message
exchange would not occur.

4.2.2 (1+1 Sparing, Back-up Over-ride)

Following on from the example in Section 4.1.2, and ASP2 wishes to 
over-ride ASP1 and take over the traffic:

       SG                       ASP1                       ASP2
        |                         |                          |
        |<------------------------------ ASP Active----------|
        |-----------------------------NTFY(ASP-Active)------>|
        |----NTFY(ASP-Inactive)-->|
        |                         |                          |


4.2.3 (n+k Sparing, Load-sharing case, withdrawal of ASP)

Following on from the example in Section 4.1.4, and ASP1 withdraws from 
service:

   SG                  ASP1                 ASP2                 ASP3
    |                    |                   |                   |
    |<----ASP Inact.-----|                   |                   |
    |--NTFY(ASP-Inact.)->|                   |                   |
    |                    |                   |                   |
    |---------------------------------NTFY(Ins. ASPs)(Optional)->|
    |                    |                   |                   |
    |<-----------------------------------------ASP Act. (Ldshr)--|
    |-------------------------------------------ASP Act. (Ack)-->|
    |                    |                   |                   |




Kalla, Rengasami, Morneault, & Sidebottom                    [Page 35]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


The Notify message to ASP3 is optional, as well as the ASP-Active
from ASP3.  The optional Notify can only occur if the SG maintains
knowledge of the minimum ASP resources required  for example if the
SG knows that n+k = 2+1 for a loadshare AS and n currently equals 1. 

Note: If the SG detects loss of the ASP1 IUA peer (IUA heartbeat loss 
or detection of SCTP failure), the first SG-ASP1 ASP Inactive message 
exchange would not occur.

4.3 Q.921/Q.931 primitives backhaul Examples

An example of the message flows for establishing a data link on a
signalling channel, passing PDUs and releasing a data link on a
signalling channel is shown below. An active association between MGC
and SG is established (section 4.1) prior to the following message
flows.

            SG                             MGC

                        <----------- Establish Request
      Establish Response ---------->

                        <----------- Data Request
         Data Indication ----------->
                        <----------- Data Request
         Data Indication ----------->
                        <----------- Data Request
                        <----------- Data Request
         Data Indication ----------->

                        <----------- Release Request (RELEASE_MGMT)
        Release Confirm  ---------->


An example of the message flows for a failed attempt to establish a
data link on the signalling channel is shown below.  In this case, the
gateway has a problem with its physical connection (e.g. Red Alarm),
so it cannot establish a data link on the signalling channel.



Kalla, Rengasami, Morneault, & Sidebottom                    [Page 36]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


            SG                             MGC
        
                        <----------- Establish Request (ESTABLISH_START)
      Release Indication ---------->
      (RELEASE_PHYS)

4.4 Layer Management Communication Examples

An example of the message flows for communication between Layer
Management modules between SG and MGC is shown below. An active
association between MGC and SG is established (section 4.1) prior to
the following message flows.

                  SG                       MGC
        
                        <----------- Data Request
                   Error ---------->
                   (INVALID_TEI)

                        <----------- TEI Status 
              TEI Status ---------->


5.0 Security

IUA is designed to carry signaling messages for telephony services.
As such, IUA must involve the security needs of several parties: the
end users of the services; the network providers and the applications
involved.  Additional requirements may come from local regulation.
While having some overlapping security needs, any security solution
should fulfill all of the different parties' needs. 

5.1 Threats

There is no quick fix, one-size-fits-all solution for security. As a
transport protocol, IUA has the following security objectives:

 * Availability of reliable and timely user data transport.
 * Integrity of user data transport.
 * Confidentiality of user data.

IUA runs on top of SCTP.  SCTP [3] provides certain transport related
security features, such as:

 * Blind Denial of Service Attacks
 * Flooding
 * Masquerade
 * Improper Monopolization of Services



Kalla, Rengasami, Morneault, & Sidebottom                    [Page 37]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


When IUA is running in professionally managed corporate or service
provider network, it is reasonable to expect that this network
includes an appropriate security policy framework. The "Site Security
Handbook" [6] should be consulted for guidance.

When the network in which IUA runs in involves more than one party,
it may not be reasonable to expect that all parties have implemented
security in a sufficient manner.  In such a case, it is recommended
that IPSEC is used to ensure confidentiality of user payload.
Consult [7] for more information on configuring IPSEC services.

5.2 Protecting Confidentiality 

Particularly for mobile users, the requirement for confidentiality
may include the masking of IP addresses and ports.  In this case
application level encryption is not sufficient; IPSEC ESP should be
used instead. Regardless of which level performs the encryption,
the IPSEC ISAKMP service should be used for key management.


6.0 IANA Considerations

A request will be made to IANA to assign an IUA value for the Payload
Protocol Identifier in SCTP Payload Data chunk. The following SCTP
Payload Protocol Identifier will be registered:

        IUA    tbd

The SCTP Payload Protocol Identifier is included in each SCTP Data
chunk, to indicate which protocol the SCTP is carrying. This Payload
Protocol Identifier is not directly used by SCTP but may be used by
certain network entities to identify the type of information being
carried in a Data chunk.

The User Adaptation peer may use the Payload Protocol Identifier as
a way of determining additional information about the data being
presented to it by SCTP.

7.0 Acknowledgements

The authors would like to thank Ming-te Chao, Keith Drage, Stephen
Lorusso, John Loughney, Neil Olson, Norm Glaude, Michael Tuexen,
Nikhil Jain, Dan Brendes and Heinz Prantner for their valuable
comments and suggestions.







Kalla, Rengasami, Morneault, & Sidebottom                    [Page 38]


Internet Draft        ISDN Q.921 User Adaptation Layer        Mar 2000


8.0  References

[1] ITU-T Recommendation Q.920, 'Digital Subscriber Signalling System
    No. 1 (DSS1) - ISDN User-Network Interface Data Link Layer -
    General Aspects'

[2] T1S1.7/99-220 Contribution, 'Back-hauling of DSS1 protocol in a
    Voice over Packet Network'

[3] Simple Control Transmission Protocol,
    draft-ietf-sigtran-sctp-07.txt, March 2000

[4] Media Gateway Control Protocol (MGCP),
    draft-huitema-megaco-mgcp-v1-03.txt, August 1999

[5] Architectural Framework for Signaling Transport,
    RFC 2719 , October 1999

[6] Site Security Handbook, RFC 2196, September 1997

[7] Security Architecture for the Internet Protocol, RFC 2401

9.0 Author's Addresses

Malleswar Kalla                                   Tel +1-973-829-5212
Telcordia Technologies             EMail kalla@research.telcordia.com
MCC 1J211R
445 South Street
Morristown, NJ 07960
USA

Selvam Rengasami                                  Tel +1-732-758-5260
Telcordia Technologies                   EMail srengasa@telcordia.com
NVC-2Z439
331 Newman Springs Rd
Red Bank, NJ 07701
USA

Ken Morneault                                     Tel +1-703-484-3323
Cisco Systems Inc.                           EMail kmorneau@cisco.com
13615 Dulles Technology Drive
Herndon, VA. 20171
USA

Greg Sidebottom                                   Tel +1-613-763-7305
Nortel Networks                     EMail gregside@nortelnetworks.com
3685 Richmond Rd,
Nepean, Ontario 
Canada  K2H5B7


Kalla, Rengasami, Morneault, & Sidebottom                    [Page 39]


