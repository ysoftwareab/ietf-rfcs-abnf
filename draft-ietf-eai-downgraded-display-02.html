<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Displaying Downgraded Messages for Email Address Internationalization</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Displaying Downgraded Messages for Email Address Internationalization">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Email Address Internationalization</td><td class="header">K. Fujiwara</td></tr>
<tr><td class="header">(EAI)</td><td class="header">JPRS</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">September 09, 2009</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: March 13, 2010</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Displaying Downgraded Messages for Email Address Internationalization<br />draft-ietf-eai-downgraded-display-02.txt</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on March 13, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
This document describes a method for displaying downgraded messages
which originally contained internationalized E-mail addresses or
internationalized header fields.
    
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#anchor1">2.</a>&nbsp;
Terminology<br />
<a href="#consieration">3.</a>&nbsp;
Consideration of displaying downgraded message<br />
<a href="#DecodingTechnique">4.</a>&nbsp;
Displaying downgraded message<br />
<a href="#security">5.</a>&nbsp;
Security considerations<br />
<a href="#anchor2">6.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor3">7.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor4">8.</a>&nbsp;
Change History<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">8.1.</a>&nbsp;
draft-fujiwara-eai-downgraded-display: Version 00<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">8.2.</a>&nbsp;
draft-ietf-eai-downgraded-display: Version 00<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">8.3.</a>&nbsp;
draft-ietf-eai-downgraded-display: Version 01<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">8.4.</a>&nbsp;
draft-ietf-eai-downgraded-display: Version 02<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#anchor11">Appendix&nbsp;A.</a>&nbsp;
Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">A.1.</a>&nbsp;
Displaying example<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
	The Email Address Internationalization (UTF8SMTP) extension document set
	<a class='info' href='#RFC4952'>[RFC4952]<span> (</span><span class='info'>Klensin, J. and Y. Ko, &ldquo;Overview and Framework for Internationalized Email,&rdquo; July&nbsp;2007.</span><span>)</span></a>
	<a class='info' href='#RFC5336'>[RFC5336]<span> (</span><span class='info'>Yao, J. and W. Mao, &ldquo;SMTP Extension for Internationalized Email Addresses,&rdquo; September&nbsp;2008.</span><span>)</span></a>
	<a class='info' href='#RFC5335'>[RFC5335]<span> (</span><span class='info'>Abel, Y., &ldquo;Internationalized Email Headers,&rdquo; September&nbsp;2008.</span><span>)</span></a>
	<a class='info' href='#RFC5337'>[RFC5337]<span> (</span><span class='info'>Newman, C. and A. Melnikov, &ldquo;Internationalized Delivery Status and Disposition Notifications,&rdquo; September&nbsp;2008.</span><span>)</span></a>
	expands Email address structure, syntax and Email header format.
	To avoid rejection of internationalized Email messages,
	the downgrading mechanism <a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a>
	converts an internationalized message to a traditional Email message
	when a server in the delivery path does not support the UTF8SMTP extension.
	The downgraded message is a traditional Email message,
	except the message has "Downgraded-" header fields.
	
</p>
<p>
	A perfect reverse-function of the downgrading does not exist
	because the encoding defined in <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> is not exactly reversible
	and Received header field downgrading may remove FOR clause information.
	The restoration of the downgrading should be done once at the final
	destination of the downgraded message such as MUAs or IMAP servers.
	This document describes the restoration methods as displaying downgraded messages
	in MUAs.
	
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>
      The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", 
	"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL"
      in this document are to be interpreted as described in RFC
      2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
    
</p>
<p>
   Specialized terms used in this specification are defined in the
   EAI overview <a class='info' href='#RFC4952'>[RFC4952]<span> (</span><span class='info'>Klensin, J. and Y. Ko, &ldquo;Overview and Framework for Internationalized Email,&rdquo; July&nbsp;2007.</span><span>)</span></a> or in
	<a class='info' href='#RFC5321'>[RFC5321]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a><a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a>,
	MIME documents
		<a class='info' href='#RFC2045'>[RFC2045]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a>
		<a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a>
		<a class='info' href='#RFC2183'>[RFC2183]<span> (</span><span class='info'>Troost, R., Dorner, S., and K. Moore, &ldquo;Communicating Presentation Information in Internet Messages: The Content-Disposition Header Field,&rdquo; August&nbsp;1997.</span><span>)</span></a>
		<a class='info' href='#RFC2231'>[RFC2231]<span> (</span><span class='info'>Freed, N. and K. Moore, &ldquo;MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations,&rdquo; November&nbsp;1997.</span><span>)</span></a>.
    
</p>
<p>
	This document depends on
	<a class='info' href='#RFC5335'>[RFC5335]<span> (</span><span class='info'>Abel, Y., &ldquo;Internationalized Email Headers,&rdquo; September&nbsp;2008.</span><span>)</span></a> and
	<a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a>.
	Key words used in these document are used in this document, too.
    
</p>
<p>
	The term "non-ASCII" is an UTF-8 string which contains at least
	one non-ASCII character. 
    
</p>
<p>
	The term "address header field" is used for a header field which
	contains &lt;mailbox&gt; elements which is defined in <a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a>.
	"Address header fields" contain
	"From", "Sender", "Reply-To", "To", "Cc", "Bcc", "Resent-From",
      	"Resent-Sender", "Resent-To", "Resent-Cc", "Return-Path" header fields.
    
</p>
<p>
	An "UTF8SMTP message" is an Email messages expanded by
	<a class='info' href='#RFC5335'>[RFC5335]<span> (</span><span class='info'>Abel, Y., &ldquo;Internationalized Email Headers,&rdquo; September&nbsp;2008.</span><span>)</span></a>.
    
</p>
<p>
	The term "MIME decode" is used for both "encoded-word" decoding defined by <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> and
	MIME parameter value decoding defined by <a class='info' href='#RFC2231'>[RFC2231]<span> (</span><span class='info'>Freed, N. and K. Moore, &ldquo;MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations,&rdquo; November&nbsp;1997.</span><span>)</span></a>.
    
</p>
<a name="consieration"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Consideration of displaying downgraded message</h3>

<p>
	Displaying downgraded message is mostly performed by MIME decoding
	according to <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> and <a class='info' href='#RFC2231'>[RFC2231]<span> (</span><span class='info'>Freed, N. and K. Moore, &ldquo;MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations,&rdquo; November&nbsp;1997.</span><span>)</span></a>.
	As a result of MIME decoding,
	 the header of the message still contains "Downgraded-" header fields,
	but the header field bodies are MIME decoded.
	These decoded "Downgraded-" header fields contain
	the original header field name and the original header field values.
	The recipient can read them.
	But the recipient's MUA cannot use the original header fields automatically.
    
</p>
<p>
	Additionally, A MUA can process "Downgraded-" header fields.
    
</p>
<p>
	The easiest way to process "Downgraded-" header fields is to remove "Downgraded-" from the decoded "Downgraded-" header fields' names.
	  Then, the "address header fields" may be displayed twice,
          one is from downgraded header field
          and the other is from decoded "Downgraded-" header field.
	Although it is very easy, it MUST NOT be used because of the following reasons.
	</p>
<ul class="text">
<li>
	  <a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a> section 3.6 defines number of times each field may occur in the header section of a message and the maximum number for "From", "Sender", "To", "Cc", "Bcc" header fields is 1.
	  It violates <a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a>.
	
</li>
<li>
	  Users cannot distinguish which is the original downgraded header field and which is the generated header field.
	
</li>
<li>
	  The "Downgraded-" header field and corresponding header field may not have relations.
	
</li>
</ul><p>
    
</p>
<a name="DecodingTechnique"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Displaying downgraded message</h3>

<p>
	A MUA MAY decode and re-generate the original header fields of the message.
	This procedure can be used to reverse the Downgrade process
	but
	will not construct exactly the original header fields in all cases.
	
</p>
<p>
	   Displaying downgraded message is implemented by the following steps.
<br />
<br />

		</p>
<blockquote class="text"><dl>
<dt>Input: </dt>
<dd>

		 The input to this procedure is
		 the header of the message as received.
		 Copy the entire header into an edit space.
<br />
<br />

		
</dd>
<dt>Step 1: </dt>
<dd>

		 Select the "Address Header Fields' Preservation Header Fields" described in Section 3.2 of <a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a> in the edit space.
		 These header fields are
		 "Downgraded-From", "Downgraded-Sender",
		 "Downgraded-To", "Downgraded-Cc", "Downgraded-Bcc",
		 "Downgraded-Reply-To",
		 "Downgraded-Resent-From", "Downgraded-Resent-Sender",
		 "Downgraded-Resent-To", "Downgraded-Resent-Cc",
		 "Downgraded-Resent-Bcc", "Downgraded-Resent-Reply-To",
		 "Downgraded-Return-Path" and "Downgraded-Disposition-Notification-To" header fields.
<br />
<br />

		
</dd>
<dt>Step 2: </dt>
<dd>

			For each header field from the output of Step 1, generate a new header field where the field name is the original header field name
			and the field value is the result of MIME decoding header field value.
<br />
<br />

		
</dd>
<dt>Step 3: </dt>
<dd>

		 Apply "Email Header Fields Downgrading" defined in
		     section 5 of <a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a> 
		     to the output of Step 2
		     without re-generating "Downgraded-" header fields
		 and copy the output into a new space (hereafter, call it as a "comparison space").
<br />
<br />

		
</dd>
<dt>Step 4: </dt>
<dd>

		 Compare the header fields in the comparison space with the header
		 fields of the same name in the edit space.
		 Before this comparison, canonicalize each header field described below.
<br />
<br />

		 
<ol class="text">
<li>Unfold all header field continuation lines as described in <a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a>.
</li>
<li>Insert a space character before and after &lt;mailbox-list&gt; separator ","
		    if there is no space character.
</li>
<li>Insert a space character before and after &lt;comment&gt; 
		    if there is no space character.
</li>
<li>Decode each &lt;encoded-word&gt; whose charset is 'UTF-8'.
</li>
<li>Convert all sequences of one or more WSP characters to a single space
      	character.  WSP characters here include those before and after a
      line folding boundary.
</li>
<li>Delete all WSP characters at the end of each unfolded header field value.
</li>
<li>Delete any WSP characters remaining before and after the colon
      separating the header field name from the header field value.  The
      colon separator MUST be retained.
</li>
</ol>
<br />
<br />

	  For each header field,
		 if the same header fields exist in the comparison space and in the edit space,
		  remove the original header field in the edit space and 
			the generated header field in the comparison space.
<br />
<br />

	  Remaining header fields in the comparison space may be
	  bogus or broken "Address Header Fields' Preservation Header Fields" origin.
<br />
<br />

		
</dd>
<dt>Step 5: </dt>
<dd>

	   	 Decode all MIME encoded header fields
	    	 according to <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> and <a class='info' href='#RFC2231'>[RFC2231]<span> (</span><span class='info'>Freed, N. and K. Moore, &ldquo;MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations,&rdquo; November&nbsp;1997.</span><span>)</span></a>
			in the edit space.
<br />
<br />

		
</dd>
<dt>Step 6:</dt>
<dd>

	   	 For each "Unknown Header Fields' Preservation Header Fields" described in section 3.3 of <a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a>
		 and "Address Header Fields' Preservation Header Fields",
	   	 generate a new header field where the field name is the original header field name
		 and the field value is the result of MIME decoding header field value,
	     then replace the original "Downgraded-" header field by the generated header field in the edit space.
		 "Envelope Information Preservation Header Fields" are not targets of this step.
		 <br />
<br />

		
</dd>
</dl></blockquote><p>
	
</p>
<p>
	 The output of this procedure is an UTF8SMTP header in the edit space.
	 It will closely resemble the original header.
	
</p>
<p>
	After this procedure, the MUA may decode MIME body part header fields 
	according to <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> and <a class='info' href='#RFC2231'>[RFC2231]<span> (</span><span class='info'>Freed, N. and K. Moore, &ldquo;MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations,&rdquo; November&nbsp;1997.</span><span>)</span></a>.
	
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security considerations</h3>

<p>
   While information in any email header should usually treated with
   some suspicion, current email systems commonly employ various
   mechanisms and protocols to make the information more trustworthy.
   For example, an organization's boundary MTA can modify "From:" lines
   so that messages arriving from outside the organization are easily
   distinguishable from internal emails. As a result of rewriting,
   the "Downgraded-From" header field may not be decoded.
	
</p>
<p>
A MUA may emphasize bogus or broken "Downgraded-" header fields in step 4 of <a class='info' href='#DecodingTechnique'>Section&nbsp;4<span> (</span><span class='info'>Displaying downgraded message</span><span>)</span></a>.
    
</p>
<p>
   Hiding the information from the actual header fields when using the
   "Downgraded-" header fields does not cause loss of information if
   the comparison done in step 4 of <a class='info' href='#DecodingTechnique'>Section&nbsp;4<span> (</span><span class='info'>Displaying downgraded message</span><span>)</span></a>
   is successful.  To ensure that no information is lost, a MUA
   SHOULD have a function that uses the actual message that was
   received (with/without MIME decoding) to render the message.
    
</p>
<p>
See "Security considerations" section in <a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a> and <a class='info' href='#RFC4952'>[RFC4952]<span> (</span><span class='info'>Klensin, J. and Y. Ko, &ldquo;Overview and Framework for Internationalized Email,&rdquo; July&nbsp;2007.</span><span>)</span></a> for more discussion.
    
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>
This document makes no requests for IANA action. This section can be
removed by the RFC Editor before publication.
    
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Acknowledgements</h3>

<p>
	This document was separated from <a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a>.
	Both documents were developed in the EAI WG.  Significant
	comments and suggestions were received from John
	Klensin, Harald Alvestrand, Chris Newman, Randall Gellens,
	Charles Lindsey, Marcos Sanz, Alexey Melnikov, Frank
	Ellermann, Edward Lewis, S. Moonesamy and JET members.
    
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Change History</h3>

<p>
	This section is used for tracking the update of this document.  Will be
	removed after finalize.
    
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
draft-fujiwara-eai-downgraded-display: Version 00</h3>

<p>
	</p>
<ul class="text">
<li>Initial version
</li>
<li>It is separated from Appendix A of draft-ietf-eai-downgrade-05.txt
</li>
</ul><p>
	
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
draft-ietf-eai-downgraded-display: Version 00</h3>

<p>
	</p>
<ul class="text">
<li>Submitted as a working group draft
</li>
</ul><p>
	
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
draft-ietf-eai-downgraded-display: Version 01</h3>

<p>
	</p>
<ul class="text">
<li>Prohibited and removed Displaying Technique 1
</li>
<li>Added new texts to Security Considerations
</li>
</ul><p>
	
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
draft-ietf-eai-downgraded-display: Version 02</h3>

<p>
	</p>
<ul class="text">
<li>updated by comments from Chair's review and AD's review
</li>
<li>Fixed references
</li>
<li>Rewrote section 4 to be more comprehensible
</li>
<li>Added bogus or broken "Downgraded-" header fields
</li>
<li>Added sentences in Security considerations
</li>
</ul><p>
	
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2045">[RFC2045]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2045">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>,&rdquo; RFC&nbsp;2045, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2045.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2047">[RFC2047]</a></td>
<td class="author-text"><a href="mailto:moore@cs.utk.edu">Moore, K.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2047">MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text</a>,&rdquo; RFC&nbsp;2047, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2047.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2047.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2047.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2183">[RFC2183]</a></td>
<td class="author-text"><a href="mailto:rens@century.com">Troost, R.</a>, <a href="mailto:sdorner@qualcomm.com">Dorner, S.</a>, and <a href="mailto:moore@cs.utk.edu">K. Moore</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2183">Communicating Presentation Information in Internet Messages: The Content-Disposition Header Field</a>,&rdquo; RFC&nbsp;2183, August&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2183.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2183.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2183.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2231">[RFC2231]</a></td>
<td class="author-text"><a href="mailto:ned.freed@innosoft.com">Freed, N.</a> and <a href="mailto:moore@cs.utk.edu">K. Moore</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2231">MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations</a>,&rdquo; RFC&nbsp;2231, November&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2231.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2231.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2231.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4952">[RFC4952]</a></td>
<td class="author-text">Klensin, J. and Y. Ko, &ldquo;<a href="http://tools.ietf.org/html/rfc4952">Overview and Framework for Internationalized Email</a>,&rdquo; RFC&nbsp;4952, July&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4952.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5322">[RFC5322]</a></td>
<td class="author-text"><a href="mailto:presnick@qualcomm.com">Resnick, P., Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc5322">Internet Message Format</a>,&rdquo; RFC&nbsp;5322, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5322.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc5322.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc5322.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5335">[RFC5335]</a></td>
<td class="author-text">Abel, Y., &ldquo;<a href="http://tools.ietf.org/html/rfc5335">Internationalized Email Headers</a>,&rdquo; RFC&nbsp;5335, September&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5335.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5504">[RFC5504]</a></td>
<td class="author-text">Fujiwara, K. and Y. Yoneya, &ldquo;<a href="http://tools.ietf.org/html/rfc5504">Downgrading Mechanism for Email Address Internationalization</a>,&rdquo; RFC&nbsp;5504, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5504.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC5321">[RFC5321]</a></td>
<td class="author-text">Klensin, J., &ldquo;<a href="http://tools.ietf.org/html/rfc5321">Simple Mail Transfer Protocol</a>,&rdquo; RFC&nbsp;5321, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5321.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5336">[RFC5336]</a></td>
<td class="author-text">Yao, J. and W. Mao, &ldquo;<a href="http://tools.ietf.org/html/rfc5336">SMTP Extension for Internationalized Email Addresses</a>,&rdquo; RFC&nbsp;5336, September&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5336.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5337">[RFC5337]</a></td>
<td class="author-text">Newman, C. and A. Melnikov, &ldquo;<a href="http://tools.ietf.org/html/rfc5337">Internationalized Delivery Status and Disposition Notifications</a>,&rdquo; RFC&nbsp;5337, September&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5337.txt">TXT</a>).</td></tr>
</table>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Examples</h3>

<p>
	This section shows a example of displaying downgraded message.
	First, an example of the original UTF8SMTP message and its downgraded message are
	shown. They are the same as 
	"Example 1" of <a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a>.
	The example UTF8SMTP message is shown in <a class='info' href='#example-originaleaismtpsession'>Figure&nbsp;1<span> (</span><span class='info'>Original message</span><span>)</span></a>.
	
</p>
<p>
	<br /><hr class="insert" />
<a name="example-originaleaismtpsession"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: NON-ASCII-SUBJECT
From: DISPLAY-local &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
To: DISPLAY-remote1 &lt;NON-ASCII-remote1@example.net
 &lt;ASCII-remote1@example.net&gt;&gt;
Cc: DISPLAY-remote2 &lt;NON-ASCII-remote2@example.org&gt;
Date: DATE

MAIL_BODY

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Original message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

	
</p>
<p>
	Delivered downgraded message is shown in <a class='info' href='#example-headerconversiondowngrading'>Figure&nbsp;2<span> (</span><span class='info'>Downgraded message</span><span>)</span></a>.
	Return-Path header will be added by the final destination MTA.
	<br /><hr class="insert" />
<a name="example-headerconversiondowngrading"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Return-Path: &lt;ASCII-local@example.com&gt;
Downgraded-Mail-From: =?UTF-8?Q?&lt;NON-ASCII-local@example.com_?=
 =?UTF-8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
Downgraded-Rcpt-To: =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_?=
 =?UTF-8?Q?&lt;ASCII-remote1@example.net&gt;&gt;?=
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: =?UTF-8?Q?NON-ASCII-SUBJECT?=
From: =?UTF-8?Q?DISPLAY-local?= &lt;ASCII-local@example.com&gt;
Downgraded-From: =?UTF-8?Q?DISPLAY-local_&lt;NON-ASCII-local@example.com_?=
 =?UTF-8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
To: =?UTF-8?Q?DISPLAY-remote1?= &lt;ASCII-remote1@example.net&gt;
Downgraded-To: =?UTF-8?Q?DISPLAY-remote1_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_&lt;ASCII-remote1@example.net&gt;&gt;?=
Cc: =?UTF-8?Q?DISPLAY-remote2?= Internationalized address
 =?UTF-8?Q?NON-ASCII-remote2@example.org?= removed:;
Downgraded-Cc: =?UTF-8?Q?DISPLAY-remote2_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote2@example.org&gt;?=
Date: DATE

MAIL_BODY

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Downgraded message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
	<a class='info' href='#example-mimedecoded'>Figure&nbsp;3<span> (</span><span class='info'>MIME decoded message</span><span>)</span></a> shows MIME decoded message of
	<a class='info' href='#example-headerconversiondowngrading'>Figure&nbsp;2<span> (</span><span class='info'>Downgraded message</span><span>)</span></a>.
	The recipient can read the original From, To, Cc header fields as
	Downgraded-From, Downgraded-To, Downgraded-Cc header fields.
	<br /><hr class="insert" />
<a name="example-mimedecoded"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Return-Path: &lt;ASCII-local@example.com&gt;
Downgraded-Mail-From: &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
Downgraded-Rcpt-To: &lt;NON-ASCII-remote1@example.net
 &lt;ASCII-remote1@example.net&gt;&gt;
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: NON-ASCII-SUBJECT
From: DISPLAY-local &lt;ASCII-local@example.com&gt;
Downgraded-From: DISPLAY-local &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
To: DISPLAY-remote1 &lt;ASCII-remote1@example.net&gt;
Downgraded-To: DISPLAY-remote1 &lt;NON-ASCII-remote1@example.net
 &lt;ASCII-remote1@example.net&gt;&gt;
Cc: DISPLAY-remote2 Internationalized address
 NON-ASCII-remote2@example.org removed:;
Downgraded-Cc: DISPLAY-remote2 &lt;NON-ASCII-remote2@example.org&gt;
Date: DATE

MAIL_BODY

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: MIME decoded message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


      
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Displaying example</h3>

<p>
	This example shows processes of
	'Displaying downgraded message' for
	<a class='info' href='#example-headerconversiondowngrading'>Figure&nbsp;2<span> (</span><span class='info'>Downgraded message</span><span>)</span></a>.
      
</p>
<p>
	First, perform Step 1.
      
</p>
<p>
	<br /><hr class="insert" />
<a name="example-step1"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Downgraded-From: =?UTF-8?Q?DISPLAY-local_&lt;NON-ASCII-local@example.com_?=
 =?UTF-8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
Downgraded-To: =?UTF-8?Q?DISPLAY-remote1_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_&lt;ASCII-remote1@example.net&gt;&gt;?=
Downgraded-Cc: =?UTF-8?Q?DISPLAY-remote2_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote2@example.org&gt;?=

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Displaying: Output of Step 1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
	Then, perform Step 2.
      
</p>
<p>
	<br /><hr class="insert" />
<a name="example-step2"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

From: DISPLAY-local &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
To: DISPLAY-remote1 &lt;NON-ASCII-remote1@example.net
 &lt;ASCII-remote1@example.net&gt;&gt;
Cc: DISPLAY-remote2 &lt;NON-ASCII-remote2@example.org&gt;

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: Displaying: Output of Step 2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
	Perform Step 3.
	
</p>
<p>
	<br /><hr class="insert" />
<a name="example-step3"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

From: =?UTF-8?Q?DISPLAY-local?= &lt;ASCII-local@example.com&gt;
To: =?UTF-8?Q?DISPLAY-remote1?= &lt;ASCII-remote1@example.net&gt;
Cc: =?UTF-8?Q?DISPLAY-remote2?= Internationalized address
 =?UTF-8?Q?NON-ASCII-remote2@example.org?= removed:;

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: Displaying: Output of Step 3&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
	  Perform Step 4. "From", "To", "Cc" header fields are removed in <a class='info' href='#example-step4'>Figure&nbsp;7<span> (</span><span class='info'>Displaying: Output of Step 4</span><span>)</span></a>.
	
</p>
<p>
	<br /><hr class="insert" />
<a name="example-step4"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Return-Path: &lt;ASCII-local@example.com&gt;
Downgraded-Mail-From: =?UTF-8?Q?&lt;NON-ASCII-local@example.com_?=
 =?UTF-8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
Downgraded-Rcpt-To: =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_?=
 =?UTF-8?Q?&lt;ASCII-remote1@example.net&gt;&gt;?=
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: =?UTF-8?Q?NON-ASCII-SUBJECT?=
Downgraded-From: =?UTF-8?Q?DISPLAY-local_&lt;NON-ASCII-local@example.com_?=
 =?UTF-8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
Downgraded-To: =?UTF-8?Q?DISPLAY-remote1?_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_&lt;ASCII-remote1@example.net&gt;&gt;?=
Downgraded-Cc: =?UTF-8?Q?DISPLAY-remote2_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote2@example.org&gt;?=
Date: DATE

MAIL_BODY

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: Displaying: Output of Step 4&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
	    Perform Step 5 and 6.
	  
</p>
<p>
	<br /><hr class="insert" />
<a name="displaytechnique2"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Return-Path: &lt;ASCII-local@example.com&gt;
Downgraded-Mail-From: &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
Downgraded-Rcpt-To: &lt;NON-ASCII-remote1@example.net&gt;
 &lt;ASCII-remote1@example.net&gt;
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: NON-ASCII-SUBJECT
From: DISPLAY-local &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
To: DISPLAY-remote1 &lt;NON-ASCII-remote1@example.net
 &lt;ASCII-remote1@example.net&gt;&gt;
Cc: DISPLAY-remote2 &lt;NON-ASCII-remote2@example.org&gt;
Date: DATE

MAIL_BODY

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: Decoded message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
	As a result, in this simple example, all original header fields are displayed in the original form.
	Differences between <a class='info' href='#example-originaleaismtpsession'>Figure&nbsp;1<span> (</span><span class='info'>Original message</span><span>)</span></a> and <a class='info' href='#displaytechnique2'>Figure&nbsp;8<span> (</span><span class='info'>Decoded message</span><span>)</span></a> are Return-Path, Downgraded-Mail-From, Downgraded-Rcpt-To header fields only.
      
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kazunori Fujiwara</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan Registry Services Co., Ltd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chiyoda First Bldg. East 13F, 3-8-1 Nishi-Kanda</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chiyoda-ku, Tokyo  101-0065</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81-3-5215-8451</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:fujiwara@jprs.co.jp">fujiwara@jprs.co.jp</a></td></tr>
</table>
</body></html>
