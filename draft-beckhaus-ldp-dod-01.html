<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>LDP Downstream-on-Demand in Seamless MPLS</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Reference Topologies">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Access Topologies with Static Routing">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Access Topologies with Access IGP">
<link href="#rfc.section.3" rel="Chapter" title="3 LDP DoD Use Cases">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Initial Network Setup">
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 AN with Static Routing">
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 AN with Access IGP">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Service Provisioning and Activation">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Service Changes and Decommissioning">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Service Failure">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Network Transport Failure">
<link href="#rfc.section.3.5.1" rel="Chapter" title="3.5.1 General Notes">
<link href="#rfc.section.3.5.2" rel="Chapter" title="3.5.2 AN Node Failure">
<link href="#rfc.section.3.5.3" rel="Chapter" title="3.5.3 AN/AGN Link Failure">
<link href="#rfc.section.3.5.4" rel="Chapter" title="3.5.4 AGN Node Failure">
<link href="#rfc.section.3.5.5" rel="Chapter" title="3.5.5 AGN Network-side Reachability Failure">
<link href="#rfc.section.4" rel="Chapter" title="4 LDP DoD Procedures">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 LDP Label Distribution Control and Retention Modes">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 IPv6 Support">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 LDP DoD Session Negotiation">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Label Request Procedures">
<link href="#rfc.section.4.4.1" rel="Chapter" title="4.4.1 Access LSR/ABR Label Request">
<link href="#rfc.section.4.4.2" rel="Chapter" title="4.4.2 Label Request Retry">
<link href="#rfc.section.4.4.3" rel="Chapter" title="4.4.3 Label Request with Fast-Up Convergence">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Label Withdraw">
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 Label Release">
<link href="#rfc.section.4.7" rel="Chapter" title="4.7 Local Repair">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 LDP TLV TYPE">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="Seamless MPLS design enables a single IP/MPLS network to scale over core, metro and access parts of a large packet network infrastructure using standardized IP/MPLS protocols. One of the key goals of Seamless MPLS is to meet requirements specific to access, including high number of devices, their position in network topology and their compute and memory constraints that limit the amount of state access devices can hold.This can be achieved with LDP Downstream-on-Demand (LDP DoD) label advertisement. This document describes LDP DoD use cases and lists required LDP DoD procedures in the context of Seamless MPLS design." />
  <meta name="description" content="Seamless MPLS design enables a single IP/MPLS network to scale over core, metro and access parts of a large packet network infrastructure using standardized IP/MPLS protocols. One of the key goals of Seamless MPLS is to meet requirements specific to access, including high number of devices, their position in network topology and their compute and memory constraints that limit the amount of state access devices can hold.This can be achieved with LDP Downstream-on-Demand (LDP DoD) label advertisement. This document describes LDP DoD use cases and lists required LDP DoD procedures in the context of Seamless MPLS design." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">T. Beckhaus</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Deutsche Telekom AG</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">B. Decraene</td>
</tr>
<tr>
<td class="left">Expires: May 03, 2012</td>
<td class="right">France Telecom</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">K. Tiruveedhula</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">M. Konstantynowicz</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Juniper Networks</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">L. Martini</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Cisco Systems, Inc.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 31, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">LDP Downstream-on-Demand in Seamless MPLS<br />
  <span class="filename">draft-beckhaus-ldp-dod-01</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Seamless MPLS design enables a single IP/MPLS network to scale over core, metro and access parts of a large packet network infrastructure using standardized IP/MPLS protocols. One of the key goals of Seamless MPLS is to meet requirements specific to access, including high number of devices, their position in network topology and their compute and memory constraints that limit the amount of state access devices can hold.This can be achieved with LDP Downstream-on-Demand (LDP DoD) label advertisement. This document describes LDP DoD use cases and lists required LDP DoD procedures in the context of Seamless MPLS design.</p>
<p>In addition, a new optional TLV type in the LDP label request message is defined for fast-up convergence.</p>
<h1><a>Requirements Language</a></h1>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 03, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Reference Topologies</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Access Topologies with Static Routing</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Access Topologies with Access IGP</a>
</li>
<li>3.   <a href="#rfc.section.3">LDP DoD Use Cases</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Initial Network Setup</a>
</li>
<li>3.1.1.   <a href="#rfc.section.3.1.1">AN with Static Routing</a>
</li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">AN with Access IGP</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Service Provisioning and Activation</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Service Changes and Decommissioning</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Service Failure</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">Network Transport Failure</a>
</li>
<li>3.5.1.   <a href="#rfc.section.3.5.1">General Notes</a>
</li>
<li>3.5.2.   <a href="#rfc.section.3.5.2">AN Node Failure</a>
</li>
<li>3.5.3.   <a href="#rfc.section.3.5.3">AN/AGN Link Failure</a>
</li>
<li>3.5.4.   <a href="#rfc.section.3.5.4">AGN Node Failure</a>
</li>
<li>3.5.5.   <a href="#rfc.section.3.5.5">AGN Network-side Reachability Failure</a>
</li>
<li>4.   <a href="#rfc.section.4">LDP DoD Procedures</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">LDP Label Distribution Control and Retention Modes</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">IPv6 Support</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">LDP DoD Session Negotiation</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Label Request Procedures</a>
</li>
<li>4.4.1.   <a href="#rfc.section.4.4.1">Access LSR/ABR Label Request</a>
</li>
<li>4.4.2.   <a href="#rfc.section.4.4.2">Label Request Retry</a>
</li>
<li>4.4.3.   <a href="#rfc.section.4.4.3">Label Request with Fast-Up Convergence</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Label Withdraw</a>
</li>
<li>4.6.   <a href="#rfc.section.4.6">Label Release</a>
</li>
<li>4.7.   <a href="#rfc.section.4.7">Local Repair</a>
</li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">LDP TLV TYPE</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Acknowledgements</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p><a href="#I-D.ietf-mpls-seamless-mpls">Seamless MPLS design</a> <cite title="NONE">[I-D.ietf-mpls-seamless-mpls]</cite> enables a single IP/MPLS network to scale over core, metro and access parts of a large packet network infrastructure using standardized IP/MPLS protocols. One of the key goals of Seamless MPLS is to meet requirements specific to access, including high number of devices, their position in network topology and their compute and memory constraints that limit the amount of state access devices can hold.</p>
<p id="rfc.section.1.p.2">In general MPLS routers implement either LDP or RSVP for MPLS label distribution. The focus of this document is on LDP, as Seamless MPLS design does not include a requirement for general purpose explicit traffic engineering and bandwidth reservation. This document is focusing on the unicast connectivity only. Multicast connectivity is subject for further study.</p>
<p id="rfc.section.1.p.3">In <a href="#I-D.ietf-mpls-seamless-mpls">Seamless MPLS design </a> <cite title="NONE">[I-D.ietf-mpls-seamless-mpls]</cite>, IP/MPLS protocol optimization is possible due to a relatively simple access network topologies. Examples of such topologies involving access nodes (AN) and aggregation nodes (AGN) include:</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>A single AN homed to a single AGN.</li>
<li>A single AN dual-homed to two AGNs.</li>
<li>Multiple ANs daisy-chained via a hub-AN to a single AGN.</li>
<li>Multiple ANs daisy-chained via a hub-AN to two AGNs.</li>
<li>Two ANs dual-homed to two AGNs.</li>
<li>Multiple ANs chained in a ring and dual-homed to two AGNs.</li>
</ol>
<p id="rfc.section.1.p.5">The amount of IP RIB and FIB state on ANs can be easily controlled in the listed access topologies by using simple IP routing configuration with either static routes or dedicated access IGP. Note that in all of the above topologies AGNs act as the access border routers (access ABRs) connecting the access topology to the rest of the network. Hence in many cases it is sufficient for ANs to have a default route pointing towards AGNs in order to achieve complete network connectivity from ANs to the network.</p>
<p id="rfc.section.1.p.6">The amount of MPLS forwarding state however requires additional consideration. In general MPLS routers implement LDP Downstream Unsolicited (LDP DU) label advertisement <a href="#RFC5036">[RFC5036]</a> and advertise MPLS labels for all valid routes in their RIB. This is seen as a very insufficient approach for ANs, as they only require a small subset of the total routes (and associated labels) based on the required connectivity for the provisioned services. And although filters can be applied to those LDP DU labels advertisements, it is not seen as a suitable tool to facilitate any-to-any AN-driven connectivity between access and the rest of the MPLS network.</p>
<p id="rfc.section.1.p.7">This document describes an access node driven "subscription model" for label distribution in the access. The approach relies on the standard LDP Downstream-on-Demand (LDP DoD) label advertisements as specified in <a href="#RFC5036">[RFC5036]</a>. LDP DoD enables on-demand label distribution ensuring that only required labels are requested, provided and installed.</p>
<p id="rfc.section.1.p.8">Note that LDP DoD implementation is not widely available in today&#8217;s IP/MPLS devices despite the fact that it has been described in the LDP specification <a href="#RFC5036">[RFC5036]</a>. This is due to the fact that the originally LDP DoD advertisement mode was aimed mainly at ATM and Frame Relay MPLS implementations, where conserving label space used on the links was essential for compatibility with ATM and Frame Relay LSRs.</p>
<p id="rfc.section.1.p.9">The following sections describe a set of reference access topologies considered for LDP DoD usage and their associated IP routing configurations, followed by LDP DoD use cases and LDP DoD procedures in the context of Seamless MPLS design.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#sec_reference_topologies" id="sec_reference_topologies">Reference Topologies</a>
</h1>
<p id="rfc.section.2.p.1">LDP DoD use cases are described in the context of a generic reference end-to-end network topology based on <a href="#I-D.ietf-mpls-seamless-mpls">Seamless MPLS design </a> <cite title="NONE">[I-D.ietf-mpls-seamless-mpls]</cite> shown in <a href="#fig_seamless_mpls_e2e_ref_network_topology">Figure 1</a></p>
<div id="#rfc.figure.1"></div>
<div id="#fig_seamless_mpls_e2e_ref_network_topology"></div>
<pre>               +-------+  +-------+  +------+  +------+
            ---+ AGN11 +--+ AGN21 +--+ ABR1 +--+ LSR1 +--&gt; to LSR/AGN
 +--------+/   +-------+  +-------+  +------+  +------+
 | Access |             \/                   \/
 | Network|             /\                   /\
 +--------+    +-------+  +-------+  +------+  +------+
           \---+ AGN12 +--+ AGN22 +--+ ABR2 +--+ LSR2 +--&gt; to LSR/AGN
               +-------+  +-------+  +------+  +------+

    static routes
    or access IGP        ISIS L1               ISIS L2
   &lt;----Access----&gt;&lt;--Aggregation Domain--&gt;&lt;----Core-----&gt;
   &lt;------------------------- MPLS ----------------------&gt;
</pre>
<p></p>

<p></p>
<p id="rfc.section.2.p.3">The access network is either single or dual homed to AGN1x, with either a single or multiple parallel links to AGN1x.</p>
<p id="rfc.section.2.p.4">Seamless MPLS access network topologies can range from a single- or dual-homed access node to a chain or ring of access nodes, and use either static routing or access IGP. The following sections describe reference access topologies in more detail.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Access Topologies with Static Routing</h1>
<p id="rfc.section.2.1.p.1">In most cases access nodes connect to the rest of the network using very simple topologies. Here static routing is sufficient to provide the required IP connectivity. The following topologies are considered for use with static routing and LDP DoD:</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>[I1] topology - a single AN homed to a single AGN.</li>
<li>[I] topology - multiple ANs daisy-chained to a single AGN.</li>
<li>[V] topology - a single AN dual-homed to two AGNs.</li>
<li>[U2] topology - two ANs dual-homed to two AGNs.</li>
<li>[Y] topology - multiple ANs daisy-chained to two AGNs.</li>
</ol>
<p id="rfc.section.2.1.p.3">The reference static routing and LDP configuration for [V] access topology is shown in <a href="#fig_v_access_topology_with_static_routes">Figure 2</a>. The same static routing and LDP configuration also applies to [I1] topology.</p>
<div id="#rfc.figure.2"></div>
<div id="#fig_v_access_topology_with_static_routes"></div>
<pre>     +----+                        +-------+
     |AN1 +------------------------+ AGN11 +-------
     |    +-------\    /-----------+       +-\    /
     +----+        \  /            +-------+  \  /
                    \/                         \/
                    /\                         /\
     +----+        /  \            +-------+  /  \
     |AN2 +-------/    \-----------+ AGN12 +-/    \
     |    +------------------------+       +-------
     +----+                        +-------+
  
     --(u)-&gt;                        &lt;-(d)--
  
        &lt;----- static routing -------&gt; &lt;--- ISIS ---&gt;
                                       &lt;-- LDP DU --&gt;
        &lt;--------- LDP DoD ----------&gt; &lt;-- BGP LU --&gt;

 (u) static routes: 0/0 default, (optional) /32 or /128 destinations
 (d) static routes: /32 or /128 AN loopbacks
</pre>
<p></p>

<p></p>
<p id="rfc.section.2.1.p.5">In line with the Seamless MPLS design, static routes configured on AGN1x and pointing towards the access network are redistributed in either ISIS or <a href="#RFC3107">BGP labeled unicast (BGP-LU)</a> <cite title="NONE">[RFC3107]</cite>.</p>
<p id="rfc.section.2.1.p.6">The reference static routing and LDP configuration for [U2] access topology is shown in <a href="#fig_u2_access_topology_with_static_routes">Figure 3</a>.</p>
<div id="#rfc.figure.3"></div>
<div id="#fig_u2_access_topology_with_static_routes"></div>
<pre>             +----+                        +-------+
       (d1)  |AN1 +------------------------+ AGN11 +-------
        |    |    +                        +       +-\    /
        v    +-+--+                        +-------+  \  /
               |                                       \/
               |                                       /\
        ^    +-+--+                        +-------+  /  \
        |    |AN2 +                        + AGN12 +-/    \
       (d2)  |    +------------------------+       +-------
             +----+                        +-------+

             --(u)-&gt;                        &lt;-(d)--

             &lt;------- static routing --------&gt; &lt;--- ISIS ---&gt;
                                               &lt;-- LDP DU --&gt;
             &lt;----------- LDP DoD -----------&gt; &lt;-- BGP LU --&gt;

 (u) static route 0/0 default (/32 or /128 destinations optional)
 (d) static route for /32 or /128 AN loopbacks
 (d1) static route for /32 or /128 AN2 loopback and 0/0 default with lower preference
 (d2) static route for /32 or /128 AN1 loopback and 0/0 default with lower preference
</pre>
<p></p>

<p></p>
<p id="rfc.section.2.1.p.8">The reference static routing and LDP configuration for [Y] access topology is shown in <a href="#fig_y_access_topology_with_static_routes">Figure 4</a>. The same static routing and LDP configuration also applies to [I] topology.</p>
<div id="#rfc.figure.4"></div>
<div id="#fig_y_access_topology_with_static_routes"></div>
<pre>                                     +-------+
                                     |       |---/
                                /----+ AGN11 |
  +----+   +----+   +----+     /     |       |---\
  |    |   |    |   |    +----/      +-------+
  |ANn +...|AN2 +---+AN1 |                    
  |    |   |    |   |    +----\      +-------+
  +----+   +----+   +----+     \     |       |---/
                                \----+ AGN12 |
         &lt;-(d2)--  &lt;-(d1)--          |       |---\
  --(u)-&gt; --(u)-&gt;   --(u)-&gt;          +-------+
                                     &lt;-(d)--

        &lt;------- static routing -------&gt; &lt;--- ISIS ---&gt;
                                         &lt;-- LDP DU --&gt;
        &lt;---------- LDP DoD -----------&gt; &lt;-- BGP LU --&gt;
  
 (u) static routes: 0/0 default, (optional) /32 or /128 destinations
 (d) static routes: /32 or /128 AN loopbacks [1..n]
 (d1) static routes: /32 or /128 AN loopbacks [2..n]
 (d2) static routes: /32 or /128 AN loopbacks [3..n]
</pre>
<p></p>

<p></p>
<p id="rfc.section.2.1.p.10">Note that in all of the above topologies parallel ECMP (or L2 LAG) links can be used between the nodes.</p>
<p id="rfc.section.2.1.p.11">ANs support <a href="#RFC5283">Inter-area LDP</a> <cite title="NONE">[RFC5283]</cite> in order to use the IP default route to match the LDP FEC advertised by AGN1x and other ANs.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Access Topologies with Access IGP</h1>
<p id="rfc.section.2.2.p.1">A dedicated access IGP instance is used in the access network to perform the internal routing between AGN1x and connected AN devices.  Example of such IGP could be ISIS, OSPFv2&amp;v3, RIPv2&amp;RIPng.  This access IGP instance is distinct from the IGP of the aggegation domain.</p>
<p id="rfc.section.2.2.p.2">The following topologies are considered for use with access IGP routing and LDP DoD:</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>[U] topology - multiple ANs chained in an open ring and dual-homed to two AGNs.</li>
<li>[Y] topology - multiple ANs daisy-chained via a hub-AN to two AGNs.</li>
</ol>
<p id="rfc.section.2.2.p.4">The reference access IGP and LDP configuration for [U] access topology is shown in <a href="#fig_u_access_topology_with_access_igp">Figure 5</a>.</p>
<div id="#rfc.figure.5"></div>
<div id="#fig_u_access_topology_with_access_igp"></div>
<pre>                                +-------+
 +-----+   +-----+   +----+     |       +---/
 | AN3 |---| AN2 |---|AN1 +-----+ AGN11 |
 +-----+   +-----+   +----+     |       +---\
    .                           +-------+
    .                                    
    .                           +-------+
 +-----+   +-----+   +----+     |       +---/
 |ANn-2|---|ANn-1|---|ANn +-----+ AGN12 |
 +-----+   +-----+   +----+     |       +---\
                                +-------+
                                 
 &lt;---------- access IGP ------------&gt; &lt;--- ISIS ---&gt;
                                      &lt;-- LDP DU --&gt;
 &lt;------------ LDP DoD -------------&gt; &lt;-- BGP LU --&gt;
</pre>
<p></p>

<p></p>
<p id="rfc.section.2.2.p.6">The reference access IGP and LDP configuration for [Y] access topology is shown in <a href="#fig_y_access_topology_with_access_igp">Figure 6</a>.</p>
<div id="#rfc.figure.6"></div>
<div id="#fig_y_access_topology_with_access_igp"></div>
<pre>                                    +-------+
                                    |       |---/
                               /----+ AGN11 |2 
 +----+   +----+   +----+     /     |       |---\
 |    |   |    |   |    +----/      +-------+
 |ANn +...|AN2 +---+AN1 |                    
 |    |   |    |   |    +----\      +-------+
 +----+   +----+   +----+     \     |       |---/
                               \----+ AGN12 |
                                    |       |---\
                                    +-------+
                                    
  &lt;---------- access IGP ------------&gt; &lt;--- ISIS ---&gt;
                                       &lt;-- LDP DU --&gt;
  &lt;------------ LDP DoD -------------&gt; &lt;-- BGP LU --&gt;
</pre>
<p></p>

<p></p>
<p id="rfc.section.2.2.p.8">Note that in all of the above topologies parallel ECMP (or L2 LAG) links can be used between the nodes.</p>
<p id="rfc.section.2.2.p.9">In both of the above topologies, ANs (ANn ... AN1) and AGN1x share the access IGP and advertise their IPv4 and IPv6 loopbacks and link addresses. AGN1x advertise a default route into the access IGP.</p>
<p id="rfc.section.2.2.p.10">ANs support <a href="#RFC5283">Inter-area LDP</a> <cite title="NONE">[RFC5283]</cite> in order to use the IP default route for matching the LDP FECs advertised by AGN1x or other ANs.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> LDP DoD Use Cases</h1>
<p id="rfc.section.3.p.1">LDP DoD operation is driven by Seamless MPLS use cases. This section illustrates these use cases focusing on services provisioned on the access nodes and clarifies expected LDP DoD operation on the AN and AGN1x devices. Two representative service types are used to illustrate the service use cases: MPLS PWE3 <a href="#RFC4447">[RFC4447]</a> and BGP/MPLS IPVPN <a href="#RFC4364">[RFC4364]</a>.</p>
<p id="rfc.section.3.p.2">Described LDP DoD operations apply equally to all reference access topologies described in <a href="#sec_reference_topologies">Section 2</a>.  Operations that are specific to certain access topologies are called out explicitly.</p>
<p id="rfc.section.3.p.3">References to upstream and downstream nodes are made in line with the definition of upstream and downstream LSR <a href="#RFC3031">[RFC3031]</a>.</p>
<p id="rfc.section.3.p.4">This document is focusing on IPv4 LDP DoD procedures. Similar procedures are required for IPv6 LDP DoD, however some extension specific to IPv6 are likely to apply including LSP mapping, peer discovery, transport connection establishment. These will be added in this document once LDP IPv6 standardization is advanced as per <a href="#I-D.ietf-mpls-ldp-ipv6">[I-D.ietf-mpls-ldp-ipv6]</a>.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#sec_initial_network_setup" id="sec_initial_network_setup">Initial Network Setup</a>
</h1>
<p id="rfc.section.3.1.p.1">An access node is commissioned without any services provisioned on it. The AN may request labels for loopback addresses of any AN, AGN or other nodes within Seamless MPLS network for operational and management purposes. It is assumed that AGN1x has required IP/MPLS configuration for network-side connectivity in line with <a href="#I-D.ietf-mpls-seamless-mpls">Seamless MPLS design</a> <cite title="NONE">[I-D.ietf-mpls-seamless-mpls]</cite>.</p>
<p id="rfc.section.3.1.p.2">LDP sessions are configured between adjacent ANs and AGN1x using their respective loopback addresses.</p>
<h1 id="rfc.section.3.1.1">
<a href="#rfc.section.3.1.1">3.1.1.</a> AN with Static Routing</h1>
<p id="rfc.section.3.1.1.p.1">If access static routing is used, ANs are provisioned with the following static IP routing entries (topology references from <a href="#sec_reference_topologies">Section 2</a> are listed in square brackets):</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>[I1, V, U2] - Static default route 0/0 pointing to links connected to AGN1x. Requires support for <a href="#RFC5283">Inter-area LDP</a> <cite title="NONE">[RFC5283]</cite>.</li>
<li>[U2] - Static /32 or /128 routes pointing to the other AN.  Lower preference static default route 0/0 pointing to links connected to the other AN. Requires support for <a href="#RFC5283">Inter-area LDP</a> <cite title="NONE">[RFC5283]</cite>.</li>
<li>[I, Y] - Static default route 0/0 pointing to links leading towards AGN1x. Requires support for <a href="#RFC5283">Inter-area LDP</a> <cite title="NONE">[RFC5283]</cite>.</li>
<li>[I, Y] - Static /32 or /128 routes to all ANs in the daisy-chain pointing to links towards those ANs.</li>
<li>[I1, V, U2] - Optional - Static /32 or /128 routes for specific nodes within Seamless MPLS network, pointing to links connected to AGN1x.</li>
<li>[I, Y] - Optional - Static /32 or /128 routes for specific nodes within the Seamless MPLS network, pointing to links leading towards AGN1x.</li>
</ol>
<p id="rfc.section.3.1.1.p.3">Upstream AN/AGN1x should request labels over LDP DoD session(s) from downstream AN/AGN1x for configured static routes if those static routes are configured with LDP DoD request policy and if they are pointing to a next-hop selected by routing. It is expected that all configured /32 and /128 static routes to be used for LDP DoD are configured with such policy on AN/AGN1x.</p>
<p id="rfc.section.3.1.1.p.4">Downstream AN/AGN1x should respond to the label request from the upstream AN/AGN1x with a label mapping (if requested route is present in its RIB, and there is a valid label binding from its downstream), and must install the advertised label as an incoming label in its label table (LIB) and its forwarding table (LFIB).  Upstream AN/AGN1x must also install the received label as an outgoing label in their LIB and LFIB. If the downstream AN/AGN1x does have the route present in its RIB, but does not have a valid label binding from its downstream, it should forward the request to its downstream.</p>
<p id="rfc.section.3.1.1.p.5">In order to facilitate ECMP and IPFRR LFA local-repair, the upstream AN/AGN1x must also send LDP DoD label requests to alternate next-hops per its RIB, and install received labels as alternate entries in its LIB and LFIB.</p>
<p id="rfc.section.3.1.1.p.6">AGN1x node on the network side may use <a href="#RFC3107">BGP labeled unicast</a> <cite title="NONE">[RFC3107]</cite> in line with <a href="#I-D.ietf-mpls-seamless-mpls">the Seamless MPLS design</a> <cite title="NONE">[I-D.ietf-mpls-seamless-mpls]</cite>. In such a case AGN1x will be redistributing its static routes pointing to local ANs into BGP labeled unicast to facilitate network-to-access traffic flows. Likewise, to facilitate access-to-network traffic flows, AGN1x will be responding to access-originated LDP DoD label requests with label mappings based on its BGP labeled unicast reachability for requested FECs.</p>
<h1 id="rfc.section.3.1.2">
<a href="#rfc.section.3.1.2">3.1.2.</a> <a href="#sec_an_with_access_igp" id="sec_an_with_access_igp">AN with Access IGP</a>
</h1>
<p id="rfc.section.3.1.2.p.1">If access IGP is used, AN(s) advertise their loopbacks over the access IGP with configured metrics. AGN1x advertise a default route over the access IGP.</p>
<p id="rfc.section.3.1.2.p.2">Similarly to the static route case, upstream AN/AGN1x should request labels over LDP DoD session(s) from downstream AN/AGN1x for all /32 or /128 routes received over the access IGP.</p>
<p id="rfc.section.3.1.2.p.3">Identically to the static route case, downstream AN/AGN1x should respond to the label request from the upstream AN/AGN1x with a label mapping (if the requested route is present in its RIB, and there is a valid label binding from its downstream), and must install the advertised label as an incoming label in its LIB and LFIB. Upstream AN/AGN1x must also install the received label as an outgoing label in their LIB and LFIB.</p>
<p id="rfc.section.3.1.2.p.4">Identically to the static route case, in order to facilitate ECMP and IPFRR LFA local-repair, upstream AN/AGN1x must also send LDP DoD label requests to alternate next-hops per its RIB, and install received labels as alternate entries in its LIB and LFIB.</p>
<p id="rfc.section.3.1.2.p.5">AGN1x node on the network side may use <a href="#RFC3107">BGP labeled unicast</a> <cite title="NONE">[RFC3107]</cite> in line with <a href="#I-D.ietf-mpls-seamless-mpls">Seamless MPLS design</a> <cite title="NONE">[I-D.ietf-mpls-seamless-mpls]</cite>. In such case AGN1x will be redistributing routes received over the access IGP (and pointing to local ANs), into BGP labeled unicast to facilitate network-to-access traffic flows. Likewise, to facilitate access-to-network traffic flows AGN1x will be responding to access originated LDP DoD label requests with label mappings based on its BGP labeled unicast reachability for requested FECs.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#sec_service_provisioning_and_activation" id="sec_service_provisioning_and_activation">Service Provisioning and Activation</a>
</h1>
<p id="rfc.section.3.2.p.1">Following the initial setup phase described in <a href="#sec_initial_network_setup">Section 3.1</a>, a specific access node, referred to as AN*, is provisioned with a network service. AN* relies on LDP DoD to request the required MPLS LSP(s) label(s) from downstream AN/AGN1x node(s). Note that LDP DoD operations are service agnostic, that is, they are the same independently of the services provisioned on the AN*.</p>
<p id="rfc.section.3.2.p.2">For illustration purposes two service types are described: MPLS PWE3 <a href="#RFC4447">[RFC4447]</a> service and BGP/MPLS IPVPN <a href="#RFC4364">[RFC4364]</a>.</p>
<p id="rfc.section.3.2.p.3">MPLS PWE3 service - for description simplicity it is assumed that a single segment pseudowire is signaled using targeted LDP FEC128 (0x80), and it is provisioned with the pseudowire ID and the loopback IPv4 address of the destination node. The following IP/MPLS operations need to be completed on the AN* to successfully establish such PWE3 service:</p>

<ol style="list-style-type: lower-alpha">
<li>LSP labels for destination /32 FEC (outgoing label) and the local /32 loopback (incoming label) need to be signaled using LDP DoD.</li>
<li>Targeted LDP session over an associated TCP/IP connection needs to be established to the PWE3 destination PE. This is triggered by either an explicit targeted LDP session configuration on the AN* or automatically at the time of provisioning the PWE3 instance.</li>
<li>Local and remote PWE3 labels for specific FEC128 PW ID need to be signaled using targeted LDP and PWE3 signaling procedures <a href="#RFC4447">[RFC4447]</a>.</li>
<li>Upon successful completion of the above operations, AN* programs its RIB/LIB and LFIB tables, and activates the MPLS PWE3 service.</li>
</ol>
<p id="rfc.section.3.2.p.4">Note - only minimum operations applicable to service connectivity have been listed. Other non IP/MPLS connectivity operations that may be required for successful service provisioning and activation are out of scope in this document.</p>
<p id="rfc.section.3.2.p.5">BGP/MPLS IPVPN service - for description simplicity it is assumed that AN* is provisioned with a unicast IPv4 IPVPN service (VPNv4 for short) <a href="#RFC4364">[RFC4364]</a>. The following IP/MPLS operations need to be completed on the AN* to successfully establish VPNv4 service:</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>BGP peering sessions with associated TCP/IP connections need to be established with the remote destination VPNv4 PEs or Route Reflectors.</li>
<li>Based on configured BGP policies, VPNv4 BGP NLRIs need to be exchanged between AN* and its BGP peers.</li>
<li>Based on configured BGP policies, VPNv4 routes need to be installed in the AN* VRF RIB and FIB, with corresponding BGP next-hops.</li>
<li>LSP labels for destination BGP next-hop /32 FEC (outgoing label) and the local /32 loopback (incoming label) need to be signaled using LDP DoD.</li>
<li>Upon successful completion of above operations, AN* programs its RIB/LIB and LFIB tables, and activates the BGP/MPLS IPVPN service.</li>
</ol>
<p id="rfc.section.3.2.p.7">Note - only minimum operations applicable to service connectivity have been listed. Other non IP/MPLS connectivity operations that may be required for successful service provisioning are out of scope in this document.</p>
<p id="rfc.section.3.2.p.8">To establish an LSP for destination /32 FEC for any of the above services, AN* looks up its local routing table for a matching route, selects the best next-hop(s) and associated outgoing link(s).</p>
<p id="rfc.section.3.2.p.9">If a label for this /32 FEC is not already installed based on the configured static route with LDP DoD request policy or access IGP RIB entry, AN* must send an LDP DoD label mapping request. Downstream AN/AGN1x LSR(s) checks its RIB for presence of the requested /32 and associated valid outgoing label binding, and if both are present, replies with its label for this FEC and installs this label as incoming in its LIB and LFIB. Upon receiving the label mapping the AN* must accept this label based on the exact route match of advertised FEC and route entry in its RIB or based on the longest match in line with <a href="#RFC5283">Inter-area LDP</a> <cite title="NONE">[RFC5283]</cite>. If the AN* accepts the label it must install it as an outgoing label in its LIB and LFIB.</p>
<p id="rfc.section.3.2.p.10">In access topologies [V] and [Y], if AN* is dual homed to two AGN1x and routing entries for these AGN1x are configured as equal cost paths, AN* must send LDP DoD label requests to both AGN1x devices and install all received labels in its LIB and LFIB.</p>
<p id="rfc.section.3.2.p.11">In order for AN* to implement IPFRR LFA local-repair, AN* must also send LDP DoD label requests to alternate next-hops per its RIB, and install received labels as alternate entries in its LIB and LFIB.</p>
<p id="rfc.section.3.2.p.12">When forwarding PWE3 or VPNv4 packets AN* chooses the LSP label based on the locally configured static /32 or default route, or default route signaled via access IGP. If a route is reachable via multiple interfaces to AGN1x nodes and the route has multiple equal cost paths, AN* must implement Equal Cost Multi-Path (ECMP) functionality. This involves AN* using hash-based load-balancing mechanism and sending the PWE3 or VPNv4 packets in a flow-aware manner with appropriate LSP labels via all equal cost links.</p>
<p id="rfc.section.3.2.p.13">ECMP mechanism is applicable in an equal manner to parallel links between two network elements and multiple paths towards the destination. The traffic demand is distributed over the available paths.</p>
<p id="rfc.section.3.2.p.14">AGN1x node on the network side may use <a href="#RFC3107">BGP labeled unicast</a> <cite title="NONE">[RFC3107]</cite> in line with <a href="#I-D.ietf-mpls-seamless-mpls">Seamless MPLS design </a> <cite title="NONE">[I-D.ietf-mpls-seamless-mpls]</cite>. In such case AGN1x will be redistributing its static routes (or routes received from the access IGP) pointing to local ANs into BGP labeled unicast to facilitate network-to-access traffic flows. Likewise, to facilitate access-to-network traffic flows AGN1x will be responding to access originated LDP DoD label requests with label mappings based on its BGP labeled unicast reachability for requested FECs.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#sec_service_changes_and_decommissioning" id="sec_service_changes_and_decommissioning">Service Changes and Decommissioning</a>
</h1>
<p id="rfc.section.3.3.p.1">Whenever AN* service gets decommissioned or changed and connectivity to specific destination is not longer required, the associated MPLS LSP label resources should be released on AN*.</p>
<p id="rfc.section.3.3.p.2">MPLS PWE3 service - if the PWE3 service gets decommissioned and it is the last PWE3 to a specific destination node, the targeted LDP session is not longer needed and should be terminated (automatically or by configuration). The MPLS LSP(s) to that destination is no longer needed either.</p>
<p id="rfc.section.3.3.p.3">BGP/MPLS IPVPN service - deletion of a specific VPNv4 (VRF) instance, local or remote re-configuration may result in specific BGP next-hop(s) being no longer needed. The MPLS LSP(s) to that destination is no longer needed either.</p>
<p id="rfc.section.3.3.p.4">In all of the above cases the following LDP DoD related operations apply:</p>
<p></p>

<ul>
<li>If the /32 FEC label for the aforementioned destination node was originally requested based on either tLDP session configuration and default route or required BGP next-hop and default route, AN* should delete the label from its LIB and LFIB, and release it from downstream AN/AGN1x by using LDP DoD procedures.</li>
<li>If the /32 FEC label was originally requested based on the static /32 route configuration with LDP DoD request policy, the label must be retained by AN*.</li>
</ul>
<p></p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#sec_service_failure" id="sec_service_failure">Service Failure</a>
</h1>
<p id="rfc.section.3.4.p.1">A service instance may stop being operational due to a local or remote service failure event.</p>
<p id="rfc.section.3.4.p.2">In general, unless the service failure event modifies required MPLS connectivity, there should be no impact on the LDP DoD operation.</p>
<p id="rfc.section.3.4.p.3">If the service failure event does modify the required MPLS connectivity, LDP DoD operations apply as described in <a href="#sec_service_provisioning_and_activation">Section 3.2</a> and <a href="#sec_service_changes_and_decommissioning">Section 3.3</a>.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> <a href="#sec_network_transport_failure" id="sec_network_transport_failure">Network Transport Failure</a>
</h1>
<p id="rfc.section.3.5.p.1">A number of different network events can impact services on AN*.  The following sections describe network event types that impact LDP DoD operation on AN and AGN1x nodes.</p>
<h1 id="rfc.section.3.5.1">
<a href="#rfc.section.3.5.1">3.5.1.</a> General Notes</h1>
<p id="rfc.section.3.5.1.p.1">If service on any of the ANs is affected by any network failure and there is no network redundancy, the service must go into a failure state. When the network failure is recovered from, the service must be re-established automatically.</p>
<p id="rfc.section.3.5.1.p.2">The following additional LDP-related functions should be supported to comply with <a href="#I-D.ietf-mpls-seamless-mpls">Seamless MPLS </a> <cite title="NONE">[I-D.ietf-mpls-seamless-mpls]</cite> fast service restoration requirements as follows:</p>

<ol style="list-style-type: lower-alpha">
<li>Local-repair - AN and AGN1x should support local-repair for adjacent link or node failure for access-to-network, network-to-access and access-to-access traffic flows.  Local-repair should be implemented by using either IPFRR LDP LFA, simple ECMP or primary/backup switchover upon failure detection.</li>
<li>LDP session protection - LDP sessions should be configured with LDP session protection to avoid delay upon the recovery from link failure. LDP session protection ensures that FEC label binding is maintained in the control plane as long as LDP session stays up.</li>
<li>IGP-LDP synchronization - If access IGP is used, LDP sessions between ANs, and between ANs and AGN1x, should be configured with IGP-LDP synchronization to avoid unnecessary traffic loss in case the access IGP converged before LDP and there is no LDP label binding to the downstream best next-hop.</li>
</ol>
<p></p>
<h1 id="rfc.section.3.5.2">
<a href="#rfc.section.3.5.2">3.5.2.</a> AN Node Failure</h1>
<p id="rfc.section.3.5.2.p.1">AN node fails and all links to adjacent nodes go down.</p>
<p id="rfc.section.3.5.2.p.2">Adjacent AN/AGN1x nodes remove all routes pointing to the failed link(s) from their RIB tables (including /32 loopback belonging to the failed AN and any other routes reachable via the failed AN).  This in turn triggers the removal of associated outgoing /32 FEC labels from their LIB and LFIB tables.</p>
<p id="rfc.section.3.5.2.p.3">If access IGP is used, the AN node failure will be propagated via IGP link updates across the access topology.</p>
<p id="rfc.section.3.5.2.p.4">If a specific /32 FEC(s) is not reachable anymore from those AN/AGN1x, they must also send LDP label withdraw to their upstream LSRs to notify about the failure, and remove the associated incoming label(s) from their LIB and LFIB tables. Upstream LSRs upon receiving label withdraw should remove the signaled labels from their LIB/LFIB tables, and propagate LDP label withdraw across their upstream LDP DoD sessions.</p>
<p id="rfc.section.3.5.2.p.5">In [U] topology there may be an alternative path to routes previously reachable via the failed AN node. In this case adjacent AN/AGN1x should invoke local-repair (IPFRR LFA, ECMP) and switchover to alternate next-hop to reach those routes.</p>
<p id="rfc.section.3.5.2.p.6">AGN1x gets notified about the AN failure via either access IGP (if used) and/or cascaded LDP DoD label withdraw(s). AGN1x must implement all relevant global-repair IP/MPLS procedures to propagate the AN failure towards the core network. This should involve removing associated routes (in access IGP case) and labels from its LIB and LFIB tables, and propagating the failure on the network side using BGP-LU and/or core IGP/LDP-DU procedures.</p>
<p id="rfc.section.3.5.2.p.7">Upon AN coming back up, adjacent AN/AGN1x nodes automatically add routes pointing to recovered links based on the configured static routes or access IGP adjacency and link state updates. This should be then followed by LDP DoD label signaling and subsequent binding and installation of labels in LIB and LFIB tables.</p>
<h1 id="rfc.section.3.5.3">
<a href="#rfc.section.3.5.3">3.5.3.</a> AN/AGN Link Failure</h1>
<p id="rfc.section.3.5.3.p.1">Depending on the access topology and the failed link location different cases apply to the network operation after AN link failure (topology references from <a href="#sec_reference_topologies">Section 2</a> in square brackets):</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>[all] - link failed, but at least one ECMP parallel link remains - nodes on both sides of the failed link must stop using the failed link immediately (local-repair), and keep using the remaining ECMP parallel links.</li>
<li>[I1, I, Y] - link failed, and there are no ECMP or alternative links and paths - nodes on both sides of the failed link must remove routes pointing to the failed link immediately from the RIB, remove associated labels from their LIB and LFIB tabels, and must send LDP label withdraw(s) to their upstream LSRs.</li>
<li>[U2, U, V, Y] - link failed, but at least one ECMP or alternate path remains - AN/AGN1x node must stop using the failed link and immediately switchover (local-repair) to the remaining ECMP path or alternate path. AN/AGN1x must remove affected next-hops and labels from its tables and invoke LDP label withdraw as per point (a) above. If there is an AGN1x node terminating the failed link, it must remove routes pointing to the failed link immediately from the RIB, remove associated labels from their LIB and LFIB tabels, and must propagate the failure on the network side using BGP-LU and/or core IGP procedures.</li>
</ol>
<p id="rfc.section.3.5.3.p.3">If access IGP is used AN/AGN1x link failure will be propagated via IGP link updates across the access topology.</p>
<p id="rfc.section.3.5.3.p.4">LDP DoD will also propagate the link failure by sending label withdraws to upstream AN/AGN1x nodes, and label release messages downstream AN/AGN1x nodes.</p>
<h1 id="rfc.section.3.5.4">
<a href="#rfc.section.3.5.4">3.5.4.</a> AGN Node Failure</h1>
<p id="rfc.section.3.5.4.p.1">AGN1x fails and all links to adjacent access nodes go down.</p>
<p id="rfc.section.3.5.4.p.2">Depending on the access topology, following cases apply to the network operation after AGN1x node failure (topology references from <a href="#sec_reference_topologies">Section 2</a> in square brackets):</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>[I1, I] - ANs are isolated from the network - AN adjacent to the failure must remove routes pointing to the failed AGN1x node immediately from the RIB, remove associated labels from their LIB and LFIB tabels, and must send LDP label withdraw(s) to their upstream LSRs. If access IGP is used, an IGP link update should be sent.</li>
<li>[U2, U, V, Y] - at least one ECMP or alternate path remains - AN adjacent to failed AGN1x must stop using the failed link and immediately switchover (local-repair) to the remaining ECMP path or alternate path. AN must remove affected routes and labels from its tables and invoke LDP label withdraw as per point (a) above.</li>
</ol>
<p id="rfc.section.3.5.4.p.4">Network side procedures for handling AGN1x node failure have been described in <a href="#I-D.ietf-mpls-seamless-mpls">Seamless MPLS</a> <cite title="NONE">[I-D.ietf-mpls-seamless-mpls]</cite>.</p>
<h1 id="rfc.section.3.5.5">
<a href="#rfc.section.3.5.5">3.5.5.</a> AGN Network-side Reachability Failure</h1>
<p id="rfc.section.3.5.5.p.1">AGN1x loses network reachability to a specific destination or set of network-side destinations.</p>
<p id="rfc.section.3.5.5.p.2">In such event AGN1x must send LDP Label Withdraw messages to its upstream ANs, withdrawing labels for all affected /32 FECs. Upon receiving those messages ANs must remove those labels from their LIB and LFIB tables, and use alternative LSPs instead if available as part of global-repair. In turn ANs should also sent Label Withdraw messages for affected /32 FECs to their upstream ANs.</p>
<p id="rfc.section.3.5.5.p.3">If access IGP is used, and AGN1x gets completely isolated from the core network, it should stop advertising the default route 0/0 into the access IGP.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> LDP DoD Procedures</h1>
<p id="rfc.section.4.p.1">Label Distribution Protocol is specified in <a href="#RFC5036">[RFC5036]</a>, and all LDP Downstream-on-Demand implementations MUST follow this specification.</p>
<p id="rfc.section.4.p.2">In <a href="#RFC3031">the MPLS architecture</a> <cite title="NONE">[RFC3031]</cite>, network traffic flows from upstream to downstream LSR. The use cases in this document rely on the downstream assignment of labels, where labels are assigned by the downstream LSR and signaled to the upstream LSR as shown in <a href="#ldp_label_assignment_direction">Figure 7</a>.</p>
<div id="#rfc.figure.7"></div>
<div id="#ldp_label_assignment_direction"></div>
<pre>           +----------+      +------------+
           | upstream |      | downstream |
     ------+   LSR    +------+    LSR     +----
 traffic   |          |      |            |  address 
 source    +----------+      +------------+  (/32 for IPv4)
                                             traffic
          label distribution for IPv4 FEC    destination
            &lt;-------------------------      
                                            
                   traffic flow             
            -------------------------&gt;
</pre>
<p></p>

<p></p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> LDP Label Distribution Control and Retention Modes</h1>
<p><a href="#RFC5036">LDP protocol specification</a> <cite title="NONE">[RFC5036]</cite> defines two modes for label distribution control, following the definitions in <a href="#RFC3031">MPLS architecture</a> <cite title="NONE">[RFC3031]</cite>:</p>

<ul>
<li>Independent mode &#8211; an LSR recognizes a particular FEC and makes a decision to bind a label to the FEC independently from distributing that label binding to its label distribution peers. A new FEC is recognized whenever a new route becomes valid on the LSR.</li>
<li>Ordered mode &#8211; an LSR binds a label to a particular FEC if it is the egress router for that FEC or if it has already received a label binding for that FEC from its next-hop LSR for that FEC.</li>
</ul>
<p id="rfc.section.4.1.p.2">Using independent label distribution control with LDP DoD and access static routing will prevent the access LSRs from propagating label binding failure along the access topology, making it impossible to switchover to an alternate path, even if such a path exists.</p>
<p><a href="#RFC5036">LDP protocol specification</a> <cite title="NONE">[RFC5036]</cite> defines two modes for label retention, following the definitions in <a href="#RFC3031">MPLS architecture</a> <cite title="NONE">[RFC3031]</cite>:</p>

<ul>
<li>Liberal mode - LSR retains every label mappings received from a peer LSR, regardless of whether the peer LSR is the next-hop for the advertised mapping. This mode allows for quicker adaptation to routing changes.</li>
<li>Conservative mode - LSR retains advertised label mappings only if they will be used to forward packets, that is only if they are received from a valid next-hop LSR according to routing. This mode allows LSR to maintain fewer labels, but slows down LSR adaptation to routing changes.</li>
</ul>
<p id="rfc.section.4.1.p.4">Using conservative label retention mode with LDP DoD will prevent the access LSRs (AN and AGN1x nodes) from implementing IPFRR LFA alternate based local-repair, as label mapping request can not be sent to alternate next-hops.</p>
<p id="rfc.section.4.1.p.5">Adhering to the overall design goals of <a href="#I-D.ietf-mpls-seamless-mpls">Seamless MPLS</a> <cite title="NONE">[I-D.ietf-mpls-seamless-mpls]</cite>, specifically achieving a large network scale without compromising fast service restoration, all access LSRs (AN and AGN1x nodes) MUST use LDP DoD advertisement mode with:</p>
<p></p>

<ul>
<li>Ordered label distribution control - enables propagation of label binding failure within the access topology.</li>
<li>Liberal label retention - enables pre-programming of alternate next-hops with associated FEC labels.</li>
</ul>
<p id="rfc.section.4.1.p.7">In <a href="#I-D.ietf-mpls-seamless-mpls">Seamless MPLS</a> <cite title="NONE">[I-D.ietf-mpls-seamless-mpls]</cite> AGN1x node acts as an access ABR connecting access and metro domains.  To enable failure propagation between those domains, access ABR MUST implement ordered label distribution control when redistributing access static routes and/or access IGP routes into the network-side <a href="#RFC3107">BGP labeled unicast</a> <cite title="NONE">[RFC3107]</cite> or core IGP with LDP Downstream Unsolicited label advertisement.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> IPv6 Support</h1>
<p id="rfc.section.4.2.p.1">Current <a href="#RFC5036">LDP protocol specification</a> <cite title="NONE">[RFC5036]</cite> defines procedures and messages for exchanging FEC-label bindings over IPv4 and/or IPv6 networks. However number of IPv6 usage areas are not clearly specified including: packet to LSP mapping for IPv6 destination router, no IPv6 specific LSP identifier, no LDP discovery using IPv6 multicast address, separate LSPs for IPv4 and IPv6, and others.</p>
<p id="rfc.section.4.2.p.2">All of these issues and more are being addressed by <a href="#I-D.ietf-mpls-ldp-ipv6">[I-D.ietf-mpls-ldp-ipv6]</a> that will update <a href="#RFC5036">LDP protocol specification</a> <cite title="NONE">[RFC5036]</cite> in respect to the IPv6 usage. For the future deployment, LDP DoD use case and procedures described in this document SHOULD also support IPv6 for transport and services.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#sec_ldp_dod_session_negotiation" id="sec_ldp_dod_session_negotiation">LDP DoD Session Negotiation</a>
</h1>
<p id="rfc.section.4.3.p.1">Access LSR/ABR should propose the Downstream-on-Demand label advertisement by setting "A" value to 1 in the Common Session Parameters TLV of the Initialization message. The rules for negotiating the label advertisement mode are specified in <a href="#RFC5036">LDP protocol specification</a> <cite title="NONE">[RFC5036]</cite>.</p>
<p id="rfc.section.4.3.p.2">To establish a Downstream-on-Demand session between the two access LSR/ABRs, both should propose the Downstream-on-Demand label advertisement mode in the Initialization message. If the access LSR only supports LDP DoD and the access ABR proposes Downstream Unsolicited mode, the access LSR SHOULD send a Notification message with status "Session Rejected/Parameters Advertisement Mode&#8221; and then close the LDP session as specified in <a href="#RFC5036">LDP protocol specification</a> <cite title="NONE">[RFC5036]</cite>.</p>
<p id="rfc.section.4.3.p.3">If an access LSR is acting in an active role, it should re-attempt the LDP session immediately. If the access LSR receives the same Downstream Unsolicited mode again, it should follow the exponential backoff algorithm as defined in the <a href="#RFC5036">LDP protocol specification</a> <cite title="NONE">[RFC5036]</cite> with delay of 15 seconds and subsequent delays growing to a maximum delay of 2 minutes.</p>
<p id="rfc.section.4.3.p.4">In case a PWE3 service is required between the adjacent access LSR/ABR, and LDP DoD has been negotiated for IPv4 and IPv6 FECs, the same LDP session should be used for PWE3 FECs. Even if LDP DoD label advertisement has been negotiated for IPv4 and IPv6 LDP FECs as described earlier, LDP session should use Downstream Unsolicited label advertisement for PWE3 FECs as specified in <a href="#RFC4447">PWE3 LDP</a> <cite title="NONE">[RFC4447]</cite>.</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#sec_label_request" id="sec_label_request">Label Request Procedures</a>
</h1>
<p></p>
<h1 id="rfc.section.4.4.1">
<a href="#rfc.section.4.4.1">4.4.1.</a> Access LSR/ABR Label Request</h1>
<p id="rfc.section.4.4.1.p.1">Upstream access LSR/ABR will request label bindings from adjacent downstream access LSR/ABR based on the following trigger events: </p>

<ol style="list-style-type: lower-alpha">
<li>Access LSR/ABR is configured with /32 static route with LDP DoD label request policy in line with intitial network setup use case described in <a href="#sec_initial_network_setup">Section 3.1</a>.</li>
<li>Access LSR/ABR is configured with a service in line with service use cases described in <a href="#sec_service_provisioning_and_activation">Section 3.2</a> and <a href="#sec_service_changes_and_decommissioning">Section 3.3</a>.</li>
<li>Access LSR/ABR link to adjacent node comes up and LDP DoD session is established. In this case access LSR should send label request messages for all /32 static routes configured with LDP DoD policy and all /32 routes related to provisioned services that are not covered by default route. In line with use cases described in <a href="#sec_network_transport_failure">Section 3.5</a>.</li>
<li>In all above cases requests MUST be sent to next-hop LSR(s) and alternate LSR(s).</li>
</ol>
<p id="rfc.section.4.4.1.p.2">Downstream access LSR/ABR will respond with label mapping message with a non-null label if any of the below conditions are met: </p>

<ol style="list-style-type: lower-alpha">
<li>Downstream access LSR/ABR - requested FEC is an IGP or static route and there is an LDP label already learnt from the next-next-hop downstream LSR (by LDP DoD or LDP DU). If there is no label for the requested FEC and there is an LDP DoD session to the next-next-hop downstream LSR, downstream LSR MUST send a label request message for the same FEC to the next-next-hop downstream LSR. In such case downstream LSR will respond back to the requesting upstream access LSR only after getting a label from the next-next-hop downstream LSR peer.</li>
<li>Downstream access ABR only - requested FEC is a BGP labelled unicast route <a href="#RFC3107">[RFC3107]</a> and this BGP route is the best selected for this FEC.</li>
</ol>
<p id="rfc.section.4.4.1.p.3">Downstream access LSR/ABR may respond with a label mapping with explicit-null or implicit-null label if it is acting as an egress for the requested FEC, or it may respond with &#8220;No Route&#8220; notification if no route exists.</p>
<h1 id="rfc.section.4.4.2">
<a href="#rfc.section.4.4.2">4.4.2.</a> <a href="#sec_label_request_retry" id="sec_label_request_retry">Label Request Retry</a>
</h1>
<p id="rfc.section.4.4.2.p.1">If an access LSR/ABR receives a &#8220;No route&#8221; Notification in response to its label request message, it should retry using an exponential backoff algorithm similar to the backoff algoritm mentioned in the LDP session negotiation described in <a href="#sec_ldp_dod_session_negotiation">Section 4.3</a>.</p>
<p id="rfc.section.4.4.2.p.2">If there is no response to the sent label request message, the <a href="#RFC5036">LDP specification</a> <cite title="NONE">[RFC5036]</cite> (section A.1.1, page# 100) states that the LSR should not send another request for the same label to the peer and mandates that a duplicate label request is considered a protocol error and should be dropped by the receiving LSR by sending a Notification message.</p>
<p id="rfc.section.4.4.2.p.3">Thus, if there is no response from the downstream peer, the access LSR/ABR should not send a duplicate label request message again.</p>
<p id="rfc.section.4.4.2.p.4">If the static route corresponding to the FEC gets deleted or if the DoD request policy is modified to reject the FEC before receiving the label mapping message, then the access LSR/ABR should send a Label Abort message to the downstream LSR.</p>
<h1 id="rfc.section.4.4.3">
<a href="#rfc.section.4.4.3">4.4.3.</a> <a href="#sec_label_request_with_fast_up_convergence" id="sec_label_request_with_fast_up_convergence">Label Request with Fast-Up Convergence</a>
</h1>
<p id="rfc.section.4.4.3.p.1">In some conditions, the exponential backoff algorithm usage described in <a href="#sec_label_request_retry">Section 4.4.2</a> may result in a longer than desired wait time to get a successful LDP label to route mapping. An example is when a specific route is unavailable on the downstream LSR when the label mapping request from the upstream is received, but later comes back. In such case using the exponential backoff algorithm may result in a max delay wait time before the upstream LSR sends another LDP label request.</p>
<p id="rfc.section.4.4.3.p.2">Fast-up convergence can be addressed with a minor extension to the LDP DoD procedure, as described in this section. The downstream and upstream LSRs SHOULD implement this extension if up convergence improvement is desired.</p>
<p id="rfc.section.4.4.3.p.3">The extension consists of the upstream LSR indicating to the downstream LSR that the label request should be queued on the downstream LSR until the requested route is available.</p>
<p id="rfc.section.4.4.3.p.4">To implement this behavior, a new Optional Parameter is defined for use in the Label Request message:</p>
<div id="#rfc.figure.8"></div>
<pre> Optional Parameter      Length     Value
 Queue Request TLV         0      see below
</pre>
<p></p>

<p></p>
<div id="#rfc.figure.9"></div>
<pre>  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |1|0|  Queue Request (0x????)   |         Length (0x00)         |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

 U-bit = 1
    Unknown TLV bit is set to 1. If this optional TLV is unknown, 
    it should be ignored without sending "no route" notification. 
    Ensures backward compatibility.
    
 F-bit = 0
    Forward unknown TLV bit is set to 0. The unknown TLV is not 
    forwarded. 
          
 Type
    Queue Request Type value to be allocated by IANA.

 Length = 0x00
    Specifies the length of the Value field in octets.
</pre>
<p></p>

<p></p>
<p id="rfc.section.4.4.3.p.7">The operation is as follows.</p>
<p id="rfc.section.4.4.3.p.8">To benefit from the fast-up convergence improvement, the upstream LSR sends a Label Request message with a Queue Request TLV.</p>
<p id="rfc.section.4.4.3.p.9">If the downstream LSR supports the Queue Request TLV, it verifies if route is available and if so it replies with label mapping as per existing LDP procedures.</p>
<p id="rfc.section.4.4.3.p.10">If the route is not available, the downstream LSR queues the request and replies as soon as the route becomes available. In the meantime, it does not send a "no route" notification back. When sending a label request with the Queue Request TLV, the upstream LSR does not retry the Label Request message if it does not receive a reply from its downstream peer</p>
<p id="rfc.section.4.4.3.p.11">If the upstream LSR wants to abort an outstanding label request while the Label Request is queued in the downstream LSR, the upstream LSR sends a Label Abort Request message, making the downstream LSR to remove the original request from the queue and send back a notification Label Request Aborted <a href="#RFC5036">[RFC5036]</a>.</p>
<p id="rfc.section.4.4.3.p.12">If the downstream LSR does not support the Queue Request TLV, it will silently ignores it, and sends a "no route" notification back.  In this case the upstream LSR invokes the exponential backoff algorithm described in <a href="#sec_label_request_retry">Section 4.4.2</a>.</p>
<p id="rfc.section.4.4.3.p.13">This described procedure ensures backward compatitibility.</p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> Label Withdraw</h1>
<p id="rfc.section.4.5.p.1">If an MPLS label on the downstream access LSR/ABR is no longer valid, the downstream access LSR/ABR withdraws this FEC/label binding from the upstream access LSR/ABR with the Label Withdraw Message <a href="#RFC5036">[RFC5036]</a> with a specified label TLV or with an empty label TLV.</p>
<p id="rfc.section.4.5.p.2">Downstream access LSR/ABR SHOULD withdraw a label for specific FEC in the following cases: </p>

<ol style="list-style-type: lower-alpha">
<li>If LDP DoD ingress label is associated with an outgoing label assigned by BGP labelled unicast route, and this route is withdrawn.</li>
<li>If LDP DoD ingress label is associated with an outgoing label assigned by LDP (DoD or DU) and the IGP route is withdrawn from the RIB or downstream LDP session is lost.</li>
<li>If LDP DoD ingress label is associated with an outgoing label assigned by LDP (DoD or DU) and the outgoing label is withdrawn by the downstream LSR.</li>
<li>If LDP DoD ingress label is associated with an outgoing label assigned by LDP (DoD or DU), route next-hop changed and <ul>
<li>there is no LDP session to the new next-hop. To minimize probability of this, the access LSR/ABR should implement LDP-IGP synchronization procedures as specified in <a href="#RFC5443">[RFC5443]</a>.</li>
<li>there is an LDP session but no label from downstream LSR.  See note below.</li>
</ul>
</li>
<li>If access LSR/ABR is configured with a policy to reject exporting label mappings to upstream LSR.</li>
</ol>
<p id="rfc.section.4.5.p.3">The upstream access LSR/ABR responds to the Label Withdraw Message with the Label Release Message <a href="#RFC5036">[RFC5036]</a>.</p>
<p id="rfc.section.4.5.p.4">After sending label release message to downstream access LSR/ABR, the upstream access LSR/ABR should resend label request message, assuming upstream access LSR/ABR still requires the label.</p>
<p id="rfc.section.4.5.p.5">Downstream access LSR/ABR should withdraw a label if the local route configuration (e.g. /32 loopback) is deleted.</p>
<p id="rfc.section.4.5.p.6">Note: For any events inducing next hop change, downstream access LSR/ABR should attempt to converge the LSP locally before withdrawing the label from an upstream access LSR/ABR. For example if the next-hop changes for a particular FEC and if the new next-hop allocates labels by LDP DoD session, then the downstream access LSR/ABR must send a label request on the new next-hop session. If downstream access LSR/ABR doesn&#8216;t get label mapping for some duration, then and only then downstream access LSR/ABR must withdraw the upstream label.</p>
<h1 id="rfc.section.4.6">
<a href="#rfc.section.4.6">4.6.</a> Label Release</h1>
<p id="rfc.section.4.6.p.1">If an access LSR/ABR does not need any longer a label for a FEC, it sends a Label Release Message <a href="#RFC5036">[RFC5036]</a> to the downstream access LSR/ABR with or without the label TLV.</p>
<p id="rfc.section.4.6.p.2">If upstream access LSR/ABR receives an unsolicited label mapping on DoD session, they should release the label by sending label release message.</p>
<p id="rfc.section.4.6.p.3">Access LSR/ABR should send a label release message to the downstream LSR in the following cases: </p>

<ol style="list-style-type: lower-alpha">
<li>If it receives a label withdraw from the downstream access LSR/ABR.</li>
<li>If the /32 static route with LDP DoD label request policy is deleted.</li>
<li>If the service gets decommissioned and there is no corresponding /32 static route with LDP DoD label request policy configured.</li>
<li>If the route next-hop changed, and the label does not point to the best or alternate next-hop.</li>
<li>If it receives a label withdraw from a downstream DoD session.</li>
</ol>
<p></p>
<h1 id="rfc.section.4.7">
<a href="#rfc.section.4.7">4.7.</a> Local Repair</h1>
<p id="rfc.section.4.7.p.1">To support local-repair with ECMP and IPFRR LFA, access LSR/ABR MUST request labels on both best next-hop and alternate next-hop LDP DoD sessions as specified in the label request procedures in <a href="#sec_label_request">Section 4.4</a>. This will enable access LSR/ABR to pre-program the alternate forwarding path with the alternate label(s), and invoke IPFRR LFA switch-over procedure if the primary next-hop link fails.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p></p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> LDP TLV TYPE</h1>
<p id="rfc.section.5.1.p.1">This document uses a new a new Optional Parameter Queue Request TLV in the Label Request message defined in <a href="#sec_label_request_with_fast_up_convergence">Section 4.4.3</a>. IANA already maintains a registry of name LDP "TLV TYPE NAME SPACE" defined by RFC5036. The following value is suggested for assignment:</p>
<div id="#rfc.figure.10"></div>
<pre> TLV type  Description
 0x0971    Queue Request TLV
</pre>
<p></p>

<p></p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p></p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.7.p.1">The authors would like to thank Nischal Sheth, Nitin Bahadur, Nicolai Leymann and Ina Minei for their suggestions and review.</p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5036">[RFC5036]</b></td>
<td class="top">
<a>Andersson, L.</a>, <a>Minei, I.</a> and <a>B. Thomas</a>, "<a href="http://tools.ietf.org/html/rfc5036">LDP Specification</a>", RFC 5036, October 2007.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC4447">[RFC4447]</b></td>
<td class="top">
<a>Martini, L.</a>, <a>Rosen, E.</a>, <a>El-Aawar, N.</a>, <a>Smith, T.</a> and <a>G. Heron</a>, "<a href="http://tools.ietf.org/html/rfc4447">Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)</a>", RFC 4447, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4446">[RFC4446]</b></td>
<td class="top">
<a>Martini, L.</a>, "<a href="http://tools.ietf.org/html/rfc4446">IANA Allocations for Pseudowire Edge to Edge Emulation (PWE3)</a>", BCP 116, RFC 4446, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5283">[RFC5283]</b></td>
<td class="top">
<a>Decraene, B.</a>, <a>Le Roux, JL.</a> and <a>I. Minei</a>, "<a href="http://tools.ietf.org/html/rfc5283">LDP Extension for Inter-Area Label Switched Paths (LSPs)</a>", RFC 5283, July 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3031">[RFC3031]</b></td>
<td class="top">
<a>Rosen, E.</a>, <a>Viswanathan, A.</a> and <a>R. Callon</a>, "<a href="http://tools.ietf.org/html/rfc3031">Multiprotocol Label Switching Architecture</a>", RFC 3031, January 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3107">[RFC3107]</b></td>
<td class="top">
<a>Rekhter, Y.</a> and <a>E. Rosen</a>, "<a href="http://tools.ietf.org/html/rfc3107">Carrying Label Information in BGP-4</a>", RFC 3107, May 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5443">[RFC5443]</b></td>
<td class="top">
<a>Jork, M.</a>, <a>Atlas, A.</a> and <a>L. Fang</a>, "<a href="http://tools.ietf.org/html/rfc5443">LDP IGP Synchronization</a>", RFC 5443, March 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4364">[RFC4364]</b></td>
<td class="top">
<a>Rosen, E.</a> and <a>Y. Rekhter</a>, "<a href="http://tools.ietf.org/html/rfc4364">BGP/MPLS IP Virtual Private Networks (VPNs)</a>", RFC 4364, February 2006.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-mpls-seamless-mpls">[I-D.ietf-mpls-seamless-mpls]</b></td>
<td class="top">
<a>Leymann, N</a>, <a>Decraene, B</a>, <a>Filsfils, C</a>, <a>Konstantynowicz, M</a> and <a>D Steinberg</a>, "<a href="http://tools.ietf.org/html/draft-ietf-mpls-seamless-mpls-00">Seamless MPLS Architecture</a>", Internet-Draft draft-ietf-mpls-seamless-mpls-00, May 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-mpls-ldp-ipv6">[I-D.ietf-mpls-ldp-ipv6]</b></td>
<td class="top">
<a>Asati, R</a>, <a>Manral, V</a>, <a>Papneja, R</a> and <a>C Pignataro</a>, "<a href="http://tools.ietf.org/html/draft-ietf-mpls-ldp-ipv6-05">Updates to LDP for IPv6</a>", Internet-Draft draft-ietf-mpls-ldp-ipv6-05, August 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Thomas Beckhaus</span> 
	  <span class="n hidden">
		<span class="family-name">Beckhaus</span>
	  </span>
	</span>
	<span class="org vcardline">Deutsche Telekom AG</span>
	<span class="adr">
	  <span>Heinrich-Hertz-Strasse 3-7</span>

	  <span class="vcardline">
		<span class="locality">Darmstadt</span>,  
		<span class="region"></span>
		<span class="code">64307</span>
	  </span>
	  <span class="country-name vcardline">Germany</span>
	</span>
	<span class="vcardline">Phone: +49 6151 58 12825</span>

<span class="vcardline">EMail: <a href="mailto:thomas.beckhaus@telekom.de">thomas.beckhaus@telekom.de</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Bruno Decraene</span> 
	  <span class="n hidden">
		<span class="family-name">Decraene</span>
	  </span>
	</span>
	<span class="org vcardline">France Telecom</span>
	<span class="adr">
	  <span>38-40 rue du General Leclerc</span>

	  <span class="vcardline">
		<span class="locality">Issy Moulineaux cedex 9</span>,  
		<span class="region"></span>
		<span class="code">92794</span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:bruno.decraene@orange.com">bruno.decraene@orange.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Kishore Tiruveedhula</span> 
	  <span class="n hidden">
		<span class="family-name">Tiruveedhula</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks</span>
	<span class="adr">
	  <span>10 Technology Park Drive</span>

	  <span class="vcardline">
		<span class="locality">Westford</span>,  
		<span class="region">Massachusetts</span> 
		<span class="code">01886</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: 1-(978)-589-8861</span>

<span class="vcardline">EMail: <a href="mailto:kishoret@juniper.net">kishoret@juniper.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Maciek Konstantynowicz</span> 
	  <span class="n hidden">
		<span class="family-name">Konstantynowicz</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:maciek@juniper.net">maciek@juniper.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Luca Martini</span> 
	  <span class="n hidden">
		<span class="family-name">Martini</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems, Inc.</span>
	<span class="adr">
	  <span>9155 East Nichols Avenue, Suite 400</span>

	  <span class="vcardline">
		<span class="locality">Englewood</span>,  
		<span class="region">CO</span> 
		<span class="code">80112</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:lmartini@cisco.com">lmartini@cisco.com</a></span>

  </address>
</div>

</body>
</html>