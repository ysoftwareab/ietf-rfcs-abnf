<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Session Initiation Protocol Service Example -- Music on Hold</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Session Initiation Protocol Service Example -- Music on Hold">
<meta name="keywords" content="Music on hold">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Dispatch</td><td class="header">D. Worley</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Avaya</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">December 29, 2010</td></tr>
<tr><td class="header">Expires: July 2, 2011</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Session Initiation Protocol Service Example -- Music on Hold<br />draft-worley-service-example-06</h1>

<h3>Abstract</h3>

<p>
The "music on hold" feature is one of the most desired features of
telephone systems in the business environment.
"Music on hold" is where, when one party to a call
has the call "on hold", that party's telephone provides an audio
stream (often music) to be heard by the other party.
Architectural features of SIP make it
difficult to implement music-on-hold in a way that is fully compliant
with the standards.
The implementation of music-on-hold described in this document is
fully effective and standards-compliant, and has a number of
advantages over the methods previously documented.
In particular, it is less likely to produce peculiar user interface
effects and more likely to work in systems which perform
authentication than the method of RFC 5359.

</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on July 2, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#status">1.1.</a>&nbsp;
Intended Status<br />
<a href="#impl">2.</a>&nbsp;
Technique<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">2.1.</a>&nbsp;
Placing a Call on Hold and Establishing an External Media Stream<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">2.2.</a>&nbsp;
Taking a Call off Hold and Terminating the External Media Stream<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#message-flow">2.3.</a>&nbsp;
Example Message Flow<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#IU-remote">2.4.</a>&nbsp;
Re-INVITE and UPDATE from the Remote UA<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#invite-replaces">2.5.</a>&nbsp;
INVITE with Replaces<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#IU-MOH">2.6.</a>&nbsp;
Re-INVITE and UPDATE from the Music-On-Hold Source<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#payload">2.7.</a>&nbsp;
Handling Payload Type Numbers<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.7.1.</a>&nbsp;
Analysis<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.7.2.</a>&nbsp;
Solution to the Problem<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.7.3.</a>&nbsp;
Example of the Solution<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#timers-section">2.8.</a>&nbsp;
Dialog/Session Timers<br />
<a href="#advantages">3.</a>&nbsp;
Advantages<br />
<a href="#caveats">4.</a>&nbsp;
Caveats<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#codec-mgmt">4.1.</a>&nbsp;
Offering All Available Media Formats<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#reinvite">4.2.</a>&nbsp;
Handling re-INVITES in a B2BUA<br />
<a href="#security">5.</a>&nbsp;
Security Considerations<br />
<a href="#ack">6.</a>&nbsp;
Acknowledgments<br />
<a href="#revision">7.</a>&nbsp;
Revision History<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#00-01">7.1.</a>&nbsp;
Changes from draft-worley-service-example-00 to draft-worley-service-example-01<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#01-02">7.2.</a>&nbsp;
Changes from draft-worley-service-example-01 to draft-worley-service-example-02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#02-03">7.3.</a>&nbsp;
Changes from draft-worley-service-example-02 to draft-worley-service-example-03<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#03-04">7.4.</a>&nbsp;
Changes from draft-worley-service-example-03 to draft-worley-service-example-04<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#04-05">7.5.</a>&nbsp;
Changes from draft-worley-service-example-04 to draft-worley-service-example-05<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#05-06">7.6.</a>&nbsp;
Changes from draft-worley-service-example-05 to draft-worley-service-example-06<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
Within SIP<a class='info' href='#sip'>[sip]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>-based systems, it is desirable to be
able to provide
features that are similar to those provided by traditional telephony
systems. 
A frequently requested feature is "music on hold":
The music-on-hold feature is where, when one party to a call
has the call "on hold", that party's telephone provides an audio
stream (often music) to be heard by the other party.


</p>
<p>
Architectural features of SIP make it
difficult to implement music-on-hold in a way that is fully compliant
with the standards.  The purpose of this document is to describe a
method that is reasonably simple yet fully effective and standards-compliant.

</p>
<a name="status"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Intended Status</h3>

<p>
The "intended status" of this document is "Informational".
The reason that it is not "Best Current Practice" is that this method is
not specified as "best", nor is this specification intended
to supersede all other methods for implementing music-on-hold.
Indeed, the two user agents in a call can use  different methods for
implementing music-on-hold, as can different user agents within a
telephone system.

</p>
<a name="impl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Technique</h3>

<p>
The essence of the technique is that when the executing UA (the user's
UA) performs
a re-INVITE of the remote UA (the other user's UA) to establish the
hold state, it provides no SDP<a class='info' href='#sdp'>[sdp]<span> (</span><span class='info'>Handley, M., Jacobson, V., and C. Perkins, &ldquo;SDP: Session Description Protocol,&rdquo; July&nbsp;2006.</span><span>)</span></a>
offer<a class='info' href='#offer-answer'>[offer&#8209;answer]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;An Offer/Answer Model with the Session Description Protocol (SDP),&rdquo; June&nbsp;2002.</span><span>)</span></a><a class='info' href='#offer-answer-bis'>[offer&#8209;answer&#8209;bis]<span> (</span><span class='info'>Okumura, S. and P. Kyzivat, &ldquo;SIP (Session Initiation Protocol) Usage of the Offer/Answer Model,&rdquo; May&nbsp;2010.</span><span>)</span></a>,
thus compelling the remote UA to provide an SDP offer.
The executing UA then extracts
the offer SDP from the remote UA's 2xx response,
and uses that as the offer SDP in a new INVITE to
the external media source.  The external media source is thus directed
to provide media directly to the remote UA.
The media source's answer SDP is returned to the remote UA in the ACK
to the re-INVITE.

</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Placing a Call on Hold and Establishing an External Media Stream</h3>

<p>

</p>
<ol class="text">
<li>The executing user instructs the executing UA to put the dialog
on-hold.
</li>
<li>The executing UA sends a re-INVITE without SDP to the remote UA,
which forces the remote UA to provide an SDP
offer in its 2xx response.
The Contact header of the re-INVITE includes the '+sip.rendering="no"'
field parameter to indicate that it is putting the call on
hold.  (<a class='info' href='#dialog-event'>[dialog&#8209;event]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and R. Mahy, &ldquo;An INVITE-Initiated Dialog Event Package for the                Session Initiation Protocol (SIP),&rdquo; November&nbsp;2005.</span><span>)</span></a> section 5.2)

</li>
<li>The remote UA sends a 2xx to the re-INVITE, and includes an SDP offer
giving its own listening address/port.
If the remote UA understands the sip.rendering feature parameter, the
offer may indicate that it will not send media by specifying the media
directionalities as "recvonly" (the reverse of "on-hold") or "inactive".
But the remote UA may offer to send media.

</li>
<li>The executing UA uses this offer to derive the offer SDP of an initial
INVITE that it
sends to the configured music-on-hold (MOH) source.
The SDP in this request is largely copied
from the SDP returned by the remote UA in the previous step,
particularly regarding the
provided listening address/port and payload type numbers.

But the media
directionalities are restricted to "recvonly" or "inactive" as appropriate.
The executing UA may want or need to change the o= line.
In addition, some a=rtpmap lines may need to be added to control the
assignment of RTP payload type numbers.[<a class='info' href='#payload'>Section&nbsp;2.7<span> (</span><span class='info'>Handling Payload Type Numbers</span><span>)</span></a>]

</li>
<li>
The MOH source sends a 2xx response to the INVITE, which contains an SDP
answer that should include
its media source address as its listening address/port.
This SDP must necessarily<a class='info' href='#offer-answer'>[offer&#8209;answer]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;An Offer/Answer Model with the Session Description Protocol (SDP),&rdquo; June&nbsp;2002.</span><span>)</span></a> specify "sendonly" or "inactive" as the
directionality for all media streams.
<br />
<br />

Although this address/port should receive no RTP, the specified port
determines the port for receiving RTCP (and conventionally, for sending
RTCP).
<br />
<br />

By convention, UAs
use their declared RTP listening ports as their RTP source ports as well.
The answer SDP will reach the remote UA, thus informing it of the
address/port from which the MOH media will come, and presumably
preventing the remote UA from ignoring the MOH media if the remote UA
filters media packets based on the source address.
This functionality requires the SDP answer to contain the sending
address in the c= line, even though the MOH source does not
receive RTP.)

</li>
<li>The executing UA sends this SDP answer as its SDP answer in the ACK for the
re-INVITE to the remote UA.  The o= line in the answer must be modified
to be within the sequence of o= lines previously generated by the executing
UA in the dialog.  Any dynamic payload type number assignments that
have been created in the answer must be recorded in the state of the
original dialog.
</li>
<li>Due to the sip.rendering feature parameter in the Contact of the
re-INVITE and the media directionality in the SDP answer contained in
the ACK, the on-hold state of the dialog is
established (at the executing end).
</li>
<li>After this point, the MOH source generates RTP containing the
music-on-hold media, and sends it directly to the listening address/port of the
remote UA. The executing UA maintains two dialogs (one to
the remote UA, one to the MOH source), but does not see or handle the MOH
RTP.
</li>
</ol><p>


</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Taking a Call off Hold and Terminating the External Media Stream</h3>

<p>

</p>
<ol class="text">
<li>The executing user instructs the executing UA to take the dialog off-hold.
</li>
<li>The executing UA sends a re-INVITE to the remote UA with SDP that
requests to receive media.
The Contact header of the re-INVITE does not include the '+sip.rendering="no"'
field parameter.
(It may contain a sip.rendering field parameter with value "yes" or
"unknown", or it may omit the field parameter.)
Thus this INVITE removes the on-hold state of the
dialog (at the executing end).
(Note that the version in o= line of the offered SDP must account for
the SDP versions that were passed through from the MOH source.
Also note that
any payload type numbers that were assigned in SDP provided by 
the MOH source must be respected.)
</li>
<li>When the remote UA sends a 2xx response to the re-INVITE, the executing UA
sends a BYE request in the dialog to the MOH source.
</li>
<li>After this point, the MOH source does not generate RTP and ordinary
RTP flow is reestablished in the original dialog.
</li>
</ol><p>


</p>
<a name="message-flow"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Example Message Flow</h3>

<p>
This section shows a message flow which is an example of this
technique.  The scenario is: Alice establishes a call with Bob. Bob
then places the call on hold, with music-on-hold provided from an
external source.  Bob then takes the call off hold.
Note that this is just one possible message flow that illustrates this
technique; numerous variations on these operations are allowed by the
applicable standards.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Alice             Bob       Music Source

Alice establishes the call:

  |                |              |
  |    INVITE F1   |              |
  |---------------&gt;|              |
  | 180 Ringing F2 |              |
  |&lt;---------------|              |
  |    200 OK F3   |              |
  |&lt;---------------|              |
  |     ACK F4     |              |
  |---------------&gt;|              |
  |       RTP      |              |
  |&lt;==============&gt;|              |
  |                |              |

Bob places Alice on hold, compelling Alice's UA to provide SDP:

  |                |              |
  |   INVITE F5    |              |
  |   (no SDP)     |              |
  |&lt;---------------|              |
  |   200 OK F6    |              |
  |   (SDP offer)  |              |
  |---------------&gt;|              |
  |                |              |

Bob's UA initiates music-on-hold:

  |                |              |
  |                |  INVITE F7   |
  |                |  (SDP offer, |
  |                |   rev. hold) |
  |                |-------------&gt;|
  |                | 200 OK F8    |
  |                | (SDP answer, |
  |                |  hold)       |
  |                |&lt;-------------|
  |                |    ACK F9    |
  |                |-------------&gt;|
  |                |              |

Bob's UA provides an SDP answer containing the address/port
of the Music Source:

  |                |              |
  | ACK F10        |              |
  | (SDP answer,   |              |
  |  hold          |              |
  |&lt;---------------|              |
  |    no RTP      |              |
  |&lt;..............&gt;|              |
  |     Music-on-hold RTP         |
  |&lt;==============================|
  |                |              |

The music on hold is active.

Bob takes Alice off hold:

  |                |              |
  |  INVITE F11    |              |
  |  (SDP offer)   |              |
  |&lt;---------------|              |
  |   200 OK F12   |              |
  |   (SDP answer) |              |
  |---------------&gt;|              |
  |     ACK F13    |              |
  |&lt;---------------|              |
  |                |    BYE F14   |
  |                |-------------&gt;|
  |                |    200 F15   |
  |                |&lt;-------------|
  |       RTP      |              |
  |&lt;==============&gt;|              |
  |                |              |

The normal media session between Alice and Bob is resumed.
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 /* Alice calls Bob. */

 F1 INVITE Alice -&gt; Bob

 INVITE sips:bob@biloxi.example.com SIP/2.0
 Via: SIP/2.0/TLS atlanta.example.com:5061
  ;branch=z9hG4bK74bf9
 Max-Forwards: 70
 From: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=1234567
 To: Bob &lt;sips:bob@biloxi.example.com&gt;
 Call-ID: 12345600@atlanta.example.com
 CSeq: 1 INVITE
 Contact: &lt;sips:a8342043f@atlanta.example.com;gr&gt;
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces, gruu
 Content-Type: application/sdp
 Content-Length: [omitted]

 v=0
 o=alice 2890844526 2890844526 IN IP4 atlanta.example.com
 s=
 c=IN IP4 atlanta.example.com
 t=0 0
 m=audio 49170 RTP/AVP 0
 a=rtpmap:0 PCMU/8000


 F2 180 Ringing Bob -&gt; Alice

 SIP/2.0 180 Ringing
 Via: SIP/2.0/TLS atlanta.example.com:5061
  ;branch=z9hG4bK74bf9
  ;received=192.0.2.103
 From: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=1234567
 To: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=23431
 Call-ID: 12345600@atlanta.example.com
 CSeq: 1 INVITE
 Contact: &lt;sips:bob@biloxi.example.com&gt;
 Content-Length: 0


 F3 200 OK Bob -&gt; Alice

 SIP/2.0 200 OK
 Via: SIP/2.0/TLS atlanta.example.com:5061
  ;branch=z9hG4bK74bf9
  ;received=192.0.2.103
 From: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=1234567
 To: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=23431
 Call-ID: 12345600@atlanta.example.com
 CSeq: 1 INVITE
 Contact: &lt;sips:bob@biloxi.example.com&gt;
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces
 Content-Type: application/sdp
 Content-Length: [omitted]

 v=0
 o=bob 2890844527 2890844527 IN IP4 biloxi.example.com
 s=
 c=IN IP4 biloxi.example.com
 t=0 0
 m=audio 3456 RTP/AVP 0
 a=rtpmap:0 PCMU/8000


 F4 ACK Alice -&gt; Bob

 ACK sips:bob@biloxi.example.com SIP/2.0
 Via: SIP/2.0/TLS atlanta.example.com:5061
  ;branch=z9hG4bK74bfd
 Max-Forwards: 70
 From: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=1234567
 To: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=23431
 Call-ID: 12345600@atlanta.example.com
 CSeq: 1 ACK
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces
 Content-Length: 0


 /* Bob places Alice on hold. */

 /* The re-INVITE contains no SDP, thus compelling Alice's UA
    to provide an offer. */

 F5 INVITE Bob -&gt; Alice

 INVITE sips:a8342043f@atlanta.example.com;gr SIP/2.0
 Via: SIP/2.0/TLS biloxi.example.com:5061
  ;branch=z9hG4bK874bk
 To: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=1234567
 From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=23431
 Call-ID: 12345600@atlanta.example.com
 CSeq: 712 INVITE
 Contact: &lt;sips:bob@biloxi.example.com&gt;;+sip.rendering="no"
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces
 Content-Length: 0

 /* Alice's UA provides an SDP offer.
    Since it does not know that it is being put on hold,
    the offer is the same as the original offer and describes
    bidirectional media. */

 F6 200 OK Alice -&gt; Bob

 SIP/2.0 200 OK
 Via: SIP/2.0/TLS biloxi.example.com:5061
  ;branch=z9hG4bK874bk
  ;received=192.0.2.105
 To: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=1234567
 From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=23431
 Call-ID: 12345600@atlanta.example.com
 CSeq: 712 INVITE
 Contact: &lt;sips:a8342043f@atlanta.example.com;gr&gt;
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces, gruu
 Content-Type: application/sdp
 Content-Length: [omitted]

 v=0
 o=alice 2890844526 2890844526 IN IP4 atlanta.example.com
 s=
 c=IN IP4 atlanta.example.com
 t=0 0
 m=audio 49170 RTP/AVP 0
 a=rtpmap:0 PCMU/8000
 a=active


 /* Bob's UA initiates music-on-hold. */

 /* This INVITE contains Alice's offer, but with the media
    direction set to "reverse hold", receive-only. */

 F7 INVITE Bob -&gt; Music Source

 INVITE sips:music@source.example.com SIP/2.0
 Via: SIP/2.0/TLS biloxi.example.com:5061
  ;branch=z9hG4bKnashds9
 Max-Forwards: 70
 From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=02134
 To: Music Source &lt;sips:music@source.example.com&gt;
 Call-ID: 4802029847@biloxi.example.com
 CSeq: 1 INVITE
 Contact: &lt;sips:bob@biloxi.example.com&gt;
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces, gruu
 Content-Type: application/sdp
 Content-Length: [omitted]

 v=0
 o=bob 2890844534 2890844534 IN IP4 atlanta.example.com
 s=
 c=IN IP4 atlanta.example.com
 t=0 0
 m=audio 49170 RTP/AVP 0
 a=rtpmap:0 PCMU/8000
 a=recvonly


 F8 200 OK Music Source -&gt; Bob

 SIP/2.0 200 OK
 Via: SIP/2.0/TLS biloxi.example.com:5061
  ;branch=z9hG4bKnashds9
  ;received=192.0.2.105
 From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=02134
 To: Music Source &lt;sips:music@source.example.com&gt;;tag=56323
 Call-ID: 4802029847@biloxi.example.com
 Contact: &lt;sips:music@source.example.com&gt;;automaton
      ;+sip.byeless;+sip.rendering="no"
 CSeq: 1 INVITE
 Content-Length: [omitted]

 v=0
 o=MusicSource 2890844576 2890844576 IN IP4 source.example.com
 s=
 c=IN IP4 source.example.com
 t=0 0
 m=audio 49170 RTP/AVP 0
 a=rtpmap:0 PCMU/8000
 a=sendonly


 F9 ACK Bob -&gt; Music Source

 ACK sips:music@source.example.com SIP/2.0
 Via: SIP/2.0/TLS source.example.com:5061
  ;branch=z9hG4bK74bT6
 From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=02134
 To: Music Source &lt;sips:music@source.example.com&gt;;tag=56323
 Max-Forwards: 70
 Call-ID: 4802029847@biloxi.example.com
 CSeq: 1 ACK
 Content-Length: 0


 /* Bob's UA now sends the ACK that completes the re-INVITE
    to Alice and completes the SDP offer/answer.
    The ACK contains the SDP received from the Music Source,
    and thus contains the address/port from which the Music Source
    will send media, and implies the address/port which the Music
    Source will use to send/receive RTCP. */

 F10 ACK Bob -&gt; Alice

 ACK sips:a8342043f@atlanta.example.com;gr SIP/2.0
 Via: SIP/2.0/TLS biloxi.example.com:5061
  ;branch=z9hG4bKq874b
 To: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=1234567
 From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=23431
 Call-ID: 12345600@atlanta.example.com
 CSeq: 712 ACK
 Contact: &lt;sips:bob@biloxi.example.com&gt;;+sip.rendering="no"
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces
 Content-Length: [omitted]

 v=0
 o=bob 2890844527 2890844528 IN IP4 biloxi.example.com
 s=
 c=IN IP4 source.example.com
 t=0 0
 m=audio 49170 RTP/AVP 0
 a=rtpmap:0 PCMU/8000
 a=sendonly

 /* Bob picks up the call by sending a re-INVITE to Alice. */

 F11 INVITE Bob -&gt; Alice

 INVITE sips:a8342043f@atlanta.example.com;gr SIP/2.0
 Via: SIP/2.0/TLS biloxi.example.com:5061
  ;branch=z9hG4bK874bk
 To: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=1234567
 From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=23431
 Call-ID: 12345600@atlanta.example.com
 CSeq: 713 INVITE
 Contact: &lt;sips:bob@biloxi.example.com&gt;
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces
 Content-Type: application/sdp
 Content-Length: [omitted]

 v=0
 o=bob 2890844527 2890844529 IN IP4 biloxi.example.com
 s=
 c=IN IP4 biloxi.example.com
 t=0 0
 m=audio 3456 RTP/AVP 0
 a=rtpmap:0 PCMU/8000


 F12 200 OK Alice -&gt; Bob

 SIP/2.0 200 OK
 Via: SIP/2.0/TLS biloxi.example.com:5061
  ;branch=z9hG4bK874bk
  ;received=192.0.2.105
 To: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=1234567
 From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=23431
 Call-ID: 12345600@atlanta.example.com
 CSeq: 713 INVITE
 Contact: &lt;sips:a8342043f@atlanta.example.com;gr&gt;
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces, gruu
 Content-Type: application/sdp
 Content-Length: [omitted]

 v=0
 o=alice 2890844526 2890844527 IN IP4 atlanta.example.com
 s=
 c=IN IP4 atlanta.example.com
 t=0 0
 m=audio 49170 RTP/AVP 0
 a=rtpmap:0 PCMU/8000


 F13 ACK Bob -&gt; Alice

 ACK sips:a8342043f@atlanta.example.com;gr SIP/2.0
 Via: SIP/2.0/TLS biloxi.example.com:5061
  ;branch=z9hG4bKq874b
 To: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=1234567
 From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=23431
 Call-ID: 12345600@atlanta.example.com
 CSeq: 713 ACK
 Contact: &lt;sips:bob@biloxi.example.com&gt;
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces
 Content-Length: 0


 F14 BYE Bob -&gt; Music Source

 BYE sips:music@source.example.com SIP/2.0
 Via: SIP/2.0/TLS biloxi.example.com:5061
  ;branch=z9hG4bK74rf
 Max-Forwards: 70
 From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=02134
 To: Music Source &lt;sips:music@source.example.com&gt;;tag=56323
 Call-ID: 4802029847@biloxi.example.com
 CSeq: 2 BYE
 Contact: &lt;sips:bob@biloxi.example.com&gt;
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces, gruu
 Content-Length: [omitted]


 F15 200 OK Music Source -&gt; Bob

 SIP/2.0 200 OK
 Via: SIP/2.0/TLS atlanta.example.com:5061
  ;branch=z9hG4bK74rf
  ;received=192.0.2.103
 From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=02134
 To: Music Source &lt;sips:music@source.example.com&gt;;tag=56323
 Call-ID: 4802029847@biloxi.example.com
 Contact: &lt;sips:music@source.example.com&gt;;automaton
      ;+sip.byeless;+sip.rendering="no"
 CSeq: 2 BYE
 Content-Length: 0


 /* Normal media session between Alice and Bob is resumed */
</pre></div>
<a name="IU-remote"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Re-INVITE and UPDATE from the Remote UA</h3>

<p>While the call is on-hold, the remote UA can send a request to
modify the SDP or the feature parameters of its Contact header.  This
can be done with either an INVITE or UPDATE method, both of which have
much the same effect in regard to MOH.
</p>
<p>A common reason for a re-INVITE is when the remote UA
desires to put the dialog on hold on its end. And because of the need
to support this case, an implementation must process
INVITEs and UPDATEs during the on-hold state as described below.
</p>
<p>The executing UA handles these requests by echoing requests and
responses: an incoming request from the remote UA causes the executing
UA to send a similar request to the MOH source and an incoming response from the
MOH source causes the executing UA to send a similar response to the
remote UA.  In all cases, SDP offers or
answers that are received are added as bodies to the stimulated
request or response to the other UA.
</p>
<p>The passed-through SDP will usually need its o= line modified.
The directionality attributes may need to be restricted.
In regard to payload type numbers, since the mapping has already been
established within the MOH dialog, a=rtpmap lines need not be added.

</p>
<a name="invite-replaces"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
INVITE with Replaces</h3>

<p>The executing UA must be prepared to receive INVITE requests with
Replaces headers that replace the original dialog, and similarly it
must be prepared to receive REFER requests within the dialog.
The SDP within the new dialog is negotiated by being passed through to
the MOH source within a new dialog with the MOH source.
The SDP
offer or answer can be passed to the MOH source with only
modification to the o= line and directionality attributes.
</p>
<p>In some cases, the previous dialog with the MOH source can be reused,
but only if the executing UA presents the first offer within the new
dialog, as otherwise
there is no way to force the RTP payload types that have been used
previously in the MOH dialog to be mapped to the correct codecs in the
new dialog.
</p>
<a name="IU-MOH"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6"></a><h3>2.6.&nbsp;
Re-INVITE and UPDATE from the Music-On-Hold Source</h3>

<p>It is possible for the MOH source to send an INVITE or
UPDATE request, and the executing UA can support doing so in similar
manner as requests from the remote UA.
However, if the MOH source is within the same
administrative domain as the executing UA, the executing UA may have
knowledge that the MOH
source will not (or need not) make such requests, and so can respond
to any such request with a failure response, avoiding the need to pass
the request through.
</p>
<p>However, in an environment in which ICE<a class='info' href='#ice'>[ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network                Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; April&nbsp;2010.</span><span>)</span></a>
is supported, the MOH
source may need to send requests as part of ICE negotiation with the remote UA.
Hence, in environments that support ICE, the executing UA must be able to
pass through requests from the MOH source as well as requests from
the remote UA.
</p>
<p>Again, as SDP is passed through, its o= line will need to be
modified.
In some cases, the directionality attributes will need to be
restricted.

</p>
<a name="payload"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.7"></a><h3>2.7.&nbsp;
Handling Payload Type Numbers</h3>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.7.1"></a><h3>2.7.1.&nbsp;
Analysis</h3>

<p>In this technique, the MOH source generates an SDP answer that
the executing UA presents to the remote UA as an answer within the
original dialog.
In basic functionality, this presents no problem, because
<a class='info' href='#offer-answer'>[offer&#8209;answer]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;An Offer/Answer Model with the Session Description Protocol (SDP),&rdquo; June&nbsp;2002.</span><span>)</span></a> (section 6.1, at the very end) specifies that the
payload type numbers used in either direction of RTP are the ones
specified in the SDP sent by the recipient of the RTP.
Thus, the MOH source will send RTP to the remote UA using the payload type numbers
specified in the offer SDP it received (ultimately) from the remote UA.
</p>
<p>But strict compliance to <a class='info' href='#offer-answer'>[offer&#8209;answer]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;An Offer/Answer Model with the Session Description Protocol (SDP),&rdquo; June&nbsp;2002.</span><span>)</span></a> (section 8.3.2)
requires that payload type
numbers used in SDP may only duplicate the payload type numbers used in
any previous SDP sent in the same direction
if the payload type numbers represent the same media format (codec) as
they did previously.
However, the MOH source has no knowledge of the payload type numbers
previously used in the original dialog, and it may accidentally
specify a different media format for a previously used payload type number in its
answer (or in a subsequently generated INVITE or UPDATE).
This would cause no problem with media decoding, as it cannot send any
format that was not in the remote UA's offer, but it would violate
<a class='info' href='#offer-answer'>[offer&#8209;answer]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;An Offer/Answer Model with the Session Description Protocol (SDP),&rdquo; June&nbsp;2002.</span><span>)</span></a>.
</p>
<p>Strictly speaking, it is impossible to avoid this problem because
the generator of a first answer in its dialog can
choose the payload numbers independently of the payload numbers in the
offer, and the MOH server believes that its answer is first in the dialog.
Thus the only absolute solution is to have the executing UA rewrite
the SDP that passes through it to
reassign payload type numbers, which would also require it to rewrite
the payload type numbers in the RTP packets -- a very undesirable solution.

</p>
<p>The difficulty solving this problem (and similar problems in other situations)
argues that strict adherence should not be required to the rule that
payload type numbers not be reused for different codecs.
</p>
<p>The remainder of this section is devoted to describing a technique to
eliminate this problem, in case it is of practical significance in
some application.
We do not expect that user agents would need to implement it in most
applications.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.7.2"></a><h3>2.7.2.&nbsp;
Solution to the Problem</h3>

<p>
However, we can construct a technique that will strictly adhere to the
payload type rule 
by exploiting a SHOULD-level requirement in <a class='info' href='#offer-answer'>[offer&#8209;answer]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;An Offer/Answer Model with the Session Description Protocol (SDP),&rdquo; June&nbsp;2002.</span><span>)</span></a>
(section 6.1):  "In the case of RTP, if a particular codec was referenced with a
specific payload type number in the offer, that same payload type
number SHOULD be used for that codec in the answer."
Or rather, we exploit the "implied requirement" that if a specific payload number
in the offer is used for a particular codec, then the answer should not use that
payload number for a different codec.
If the MOH source obeys this restriction, the executing UA can modify
the offer SDP to "reserve" all payload type numbers that have ever
been offered by the executing UA to prevent the MOH source from
using them for different media formats.

</p>
<p>
When the executing UA is composing the INVITE to the MOH source, it
compiles a list of all the (dynamically-assigned) payload type numbers
and associated media formats
which have been used by it (or by MOH sources on its behalf) in the
original dialog.
(The executing UA must be maintaining a list of all previously used
payload type numbers anyway, in order to comply with
<a class='info' href='#offer-answer'>[offer&#8209;answer]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;An Offer/Answer Model with the Session Description Protocol (SDP),&rdquo; June&nbsp;2002.</span><span>)</span></a>.)

</p>
<p>
Any payload type number that is present in the offer but has been used
previously by the executing UA in the original dialog for a different
media format is
rewritten to describe a dummy media format.
A payload type number is added to describe the deleted media format,
the number being either previously unused or previously used by the
executing UA for that media format.

</p>
<p>Any further payload type numbers
which have been used by the executing UA in the
original dialog but which are not mapped to a media format in the
current offer are then mapped to a dummy media format.

</p>
<p>
The result is that the modified offer SDP:

</p>
<ol class="text">
<li>offers the same set of
media formats (ignoring dummies) as the original offer SDP (though possibly with
different payload type numbers),

</li>
<li>associates every payload type number
either with a dummy media format or with the media format that the
executing UA has previously used it for, and

</li>
<li>provides a (real or
dummy) media format for every payload type number that the executing
UA has previously used.

</li>
</ol><p>

These properties are sufficient to force an MOH server that obeys the
implied requirement to generate an answer that is a correct answer to the
original offer and is also compatible with previous SDP
from the executing UA.

</p>
<p>Note that any re-INVITEs from the remote UA that the executing UA
passes through to the MOH server require similar modification, as
payload type numbers that the MOH server receives in past offers are not
absolutely reserved against its use (as they have not been sent in
SDP by the MOH server) nor is there a SHOULD-level proscription
against using them in the current answer (as they do not appear in
the current offer).

</p>
<p>This should provide an adequate solution to the problems with
payload type numbers, as it will fail only if (1) the remote UA is
particular that other UAs follow the rule about not redefining
payload type numbers, and (2) the MOH server does not follow the
implied requirement of <a class='info' href='#offer-answer'>[offer&#8209;answer]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;An Offer/Answer Model with the Session Description Protocol (SDP),&rdquo; June&nbsp;2002.</span><span>)</span></a> section 6.1.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.7.3"></a><h3>2.7.3.&nbsp;
Example of the Solution</h3>

<p>Let us show how this process works by modifying the example of <a class='info' href='#message-flow'>Section&nbsp;2.3<span> (</span><span class='info'>Example Message Flow</span><span>)</span></a> with this specific assignment of supported
codecs:

</p>
<blockquote class="text">
<p>Alice supports formats X and Y
</p>
<p>Bob supports formats X and Z
</p>
<p>Music Source supports formats Y and Z
</p>
</blockquote><p>

In this case, the SDP exchanges are:

</p>
<blockquote class="text">
<p>F1 offers X and Y, F3 answers X and Z (which cannot be used)
</p>
<p>F6 offers X and Y, but F7 offers X, Y, and a place-holder to block use of type 92
</p>
<p>F8/F10 answers Y
</p>
</blockquote><p>

The messages that are changed from <a class='info' href='#message-flow'>Section&nbsp;2.3<span> (</span><span class='info'>Example Message Flow</span><span>)</span></a> are:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 F1 INVITE Alice -&gt; Bob

 INVITE sips:bob@biloxi.example.com SIP/2.0
 Via: SIP/2.0/TLS atlanta.example.com:5061
  ;branch=z9hG4bK74bf9
 Max-Forwards: 70
 From: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=1234567
 To: Bob &lt;sips:bob@biloxi.example.com&gt;
 Call-ID: 12345600@atlanta.example.com
 CSeq: 1 INVITE
 Contact: &lt;sips:a8342043f@atlanta.example.com;gr&gt;
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces, gruu
 Content-Type: application/sdp
 Content-Length: [omitted]

 v=0
 o=alice 2890844526 2890844526 IN IP4 atlanta.example.com
 s=
 c=IN IP4 atlanta.example.com
 t=0 0
 m=audio 49170 RTP/AVP 90 91
 a=rtpmap:90 X/8000
 a=rtpmap:91 Y/8000


 F3 200 OK Bob -&gt; Alice

 SIP/2.0 200 OK
 Via: SIP/2.0/TLS atlanta.example.com:5061
  ;branch=z9hG4bK74bf9
  ;received=192.0.2.103
 From: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=1234567
 To: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=23431
 Call-ID: 12345600@atlanta.example.com
 CSeq: 1 INVITE
 Contact: &lt;sips:bob@biloxi.example.com&gt;
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces
 Content-Type: application/sdp
 Content-Length: [omitted]

 v=0
 o=bob 2890844527 2890844527 IN IP4 biloxi.example.com
 s=
 c=IN IP4 biloxi.example.com
 t=0 0
 m=audio 3456 RTP/AVP 90 92
 a=rtpmap:90 X/8000
 a=rtpmap:92 Z/8000


 F6 200 OK Alice -&gt; Bob

 SIP/2.0 200 OK
 Via: SIP/2.0/TLS biloxi.example.com:5061
  ;branch=z9hG4bK874bk
  ;received=192.0.2.105
 To: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=1234567
 From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=23431
 Call-ID: 12345600@atlanta.example.com
 CSeq: 712 INVITE
 Contact: &lt;sips:a8342043f@atlanta.example.com;gr&gt;
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces, gruu
 Content-Type: application/sdp
 Content-Length: [omitted]

 v=0
 o=alice 2890844526 2890844526 IN IP4 atlanta.example.com
 s=
 c=IN IP4 atlanta.example.com
 t=0 0
 m=audio 49170 RTP/AVP 90 91
 a=rtpmap:90 X/8000
 a=rtpmap:91 Y/8000
 a=active


 F7 INVITE Bob -&gt; Music Source

 INVITE sips:music@source.example.com SIP/2.0
 Via: SIP/2.0/TLS biloxi.example.com:5061
  ;branch=z9hG4bKnashds9
 Max-Forwards: 70
 From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=02134
 To: Music Source &lt;sips:music@source.example.com&gt;
 Call-ID: 4802029847@biloxi.example.com
 CSeq: 1 INVITE
 Contact: &lt;sips:bob@biloxi.example.com&gt;
 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
 Supported: replaces, gruu
 Content-Type: application/sdp
 Content-Length: [omitted]

 v=0
 o=bob 2890844534 2890844534 IN IP4 atlanta.example.com
 s=
 c=IN IP4 atlanta.example.com
 t=0 0
 m=audio 49170 RTP/AVP 90 91 92
 a=rtpmap:90 X/8000
 a=rtpmap:91 Y/8000
 a=rtpmap:92 x-reserved/8000
 a=recvonly


 F8 200 OK Music Source -&gt; Bob

 SIP/2.0 200 OK
 Via: SIP/2.0/TLS biloxi.example.com:5061
  ;branch=z9hG4bKnashds9
  ;received=192.0.2.105
 From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=02134
 To: Music Source &lt;sips:music@source.example.com&gt;;tag=56323
 Call-ID: 4802029847@biloxi.example.com
 Contact: &lt;sips:music@source.example.com&gt;;automaton
      ;+sip.byeless;+sip.rendering="no"
 CSeq: 1 INVITE
 Content-Length: [omitted]

 v=0
 o=MusicSource 2890844576 2890844576 IN IP4 source.example.com
 s=
 c=IN IP4 source.example.com
 t=0 0
 m=audio 49170 RTP/AVP 91
 a=rtpmap:91 Y/8000
 a=sendonly
</pre></div>
<a name="timers-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.8"></a><h3>2.8.&nbsp;
Dialog/Session Timers</h3>

<p>
The executing UA may discover that either the remote UA or the MOH
source wishes to use dialog/session liveness
timers.<a class='info' href='#timers'>[timers]<span> (</span><span class='info'>Donovan, S. and J. Rosenberg, &ldquo;Session Timers in the Session Initiation Protocol (SIP),&rdquo; April&nbsp;2005.</span><span>)</span></a>
Since the timers verify the liveness of dialogs, not
sessions (despite the terminology of <a class='info' href='#timers'>[timers]<span> (</span><span class='info'>Donovan, S. and J. Rosenberg, &ldquo;Session Timers in the Session Initiation Protocol (SIP),&rdquo; April&nbsp;2005.</span><span>)</span></a>), the
executing UA can support the timers on each dialog (to the remote UA
and to the MOH source) independently.
(If the executing UA becomes obliged to initiate a refresh
transaction, it must send an offerless UPDATE or re-INVITE, as if it sends an
offer, the remote element has the opportunity to provide an answer
which is different from its previous SDP, which could not easily be
conveyed to the other remote element.)

</p>
<a name="advantages"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Advantages</h3>

<p>
This technique for providing music-on-hold has advantages over other
methods now in use:

</p>
<ol class="text">
<li>
The original dialog is not transferred to another UA, so the "remote
endpoint URI" displayed by the remote endpoint's user interface and
dialog event package<a class='info' href='#dialog-event'>[dialog&#8209;event]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and R. Mahy, &ldquo;An INVITE-Initiated Dialog Event Package for the                Session Initiation Protocol (SIP),&rdquo; November&nbsp;2005.</span><span>)</span></a> does not change during
the call, as contrasted to the method in
<a class='info' href='#service-examples'>[service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; October&nbsp;200.</span><span>)</span></a> section 2.3.
This URI is usually displayed to the user as the the name and number
of the other party on the call, and it is desirable for it not to change
to that of the MOH server.

</li>
<li>
Compared to <a class='info' href='#service-examples'>[service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; October&nbsp;200.</span><span>)</span></a>, this method does not
require use of an out-of-dialog REFER, which is not otherwise used
much in SIP.
Out-of-dialog REFERs may not be routed correctly, since neither the
From nor Contact URI of the original dialog may route correctly to the remote UA.
Also, out-of-dialog requests to UA URIs may not be handled correctly
by authorization mechanisms.

</li>
<li>
The music-on-hold media are sent directly from the music-on-hold source
to the remote UA, rather than being relayed through the executing UA.
This reduces the computational load on the executing UA and can reduce the load on
the network (by eliminating "hairpinning" of the media through the link serving
the executing UA).

</li>
<li>
The remote UA sees, in the incoming SDP, the address/port that the MOH
source will send MOH media from (assuming that the MOH source follows
the convention of sending its media from its advertised media listening
address/port).
Thus the remote UA will render the MOH media
even if is filtering incoming media based on originating
address as a media security measure.

</li>
<li>
The technique requires relatively simple manipulation of SDP, and
in particular: (1) does not require a SIP element to modify unrelated SDP to be
acceptable to be sent within an already established sequence of SDP (a
problem with <a class='info' href='#service-examples-11'>[service&#8209;examples&#8209;11]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; October&nbsp;2006.</span><span>)</span></a> section 2.3), and
(2) does not require converting an SDP answer into an SDP offer
(which was a problem with the -00 version of this document, as well as
with  <a class='info' href='#service-examples-11'>[service&#8209;examples&#8209;11]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; October&nbsp;2006.</span><span>)</span></a>).

</li>
</ol><p>


</p>
<a name="caveats"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Caveats</h3>

<a name="codec-mgmt"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Offering All Available Media Formats</h3>

<p>
Unnecessary failures can happen if SDP offerers do not always offer all media
formats that they support.
Doing so is considered best practice
(<a class='info' href='#offer-answer-bis'>[offer&#8209;answer&#8209;bis]<span> (</span><span class='info'>Okumura, S. and P. Kyzivat, &ldquo;SIP (Session Initiation Protocol) Usage of the Offer/Answer Model,&rdquo; May&nbsp;2010.</span><span>)</span></a> section 5.1 and 5.3), but some
elements offer only formats that have already been in use in the dialog.

</p>
<p>
An example of how omitting media formats in an offer can lead to
failure is as follows:
Suppose that the UAs in <a class='info' href='#message-flow'>Section&nbsp;2.3<span> (</span><span class='info'>Example Message Flow</span><span>)</span></a> each support the
following media formats:

</p>
<blockquote class="text">
<p>Alice supports formats X and Y
</p>
<p>Bob supports formats X and Z
</p>
<p>Music Source supports formats Y and Z
</p>
</blockquote><p>

In this case, the SDP exchanges are:

</p>
<ol class="text">
<li>Alice calls Bob:<br />

Alice offers X and Y (message F1)<br />

Bob answers X (F3)

</li>
<li>Bob puts Alice on hold:<br />

Alice (via Bob) offers X and Y (F6 and F7)<br />

Music Source (via Bob) answers Y (F8 and F10)

</li>
<li>Bob takes Alice off hold:<br />

Bob offers X and Z (F11)<br />

Alice answers X (F12)

</li>
</ol><p>

Note that in exchange 2, if Alice assumes that because only format X
is in use that she should offer only X, the exchange fails.
In exchange 3, Bob offers formats X and Z, even though neither is
in use at the time (because Bob is not involved in the media streams).

</p>
<a name="reinvite"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Handling re-INVITES in a B2BUA</h3>

<p>
Many UAs provide MOH in the interval during which it is processing a
blind transfer, between receiving the REFER and receiving the final
response to the stimulated INVITE.
This process involves switching the user's interface between three
media sources: 
(1) the session of the original dialog,
(2) the session with the MOH server,
and (3) the session of the new dialog,
and involves a number of race conditions that must be handled
correctly.
If the UA is a B2BUA whose "other side" is maintaining a single dialog
with another UA, each switching of media sources potentially causes a
re-INVITE transaction within the other-side dialog.
Since re-INVITEs take time and must be sequenced correctly
(<a class='info' href='#sip'>[sip]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> section 14), such a B2BUA must allow the events
on each side to be non-synchronous and must coordinate them
correctly.
Failing to do so will lead to "glare" errors (491 or 500), leaving the
other-side UA not rendering the correct session.

</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>
Some UAs filter incoming media based on the address of origin
as a media security measure.
The technique described in this document ensures that any UA that
should render MOH media will
be informed of the source address of the media via the SDP that it
receives.
This should allow such UAs to filter without interfering with MOH
operation.
</p>
<a name="ack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Acknowledgments</h3>

<p>
The original version of this proposal was derived from
<a class='info' href='#service-examples-11'>[service&#8209;examples&#8209;11]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; October&nbsp;2006.</span><span>)</span></a> section 2.3
and the similar implementation of MOH in the Snom UA.
Significant improvements to the sequence of operations, allowing
improvements to the SDP handling, were suggested by
Venkatesh<a class='info' href='#venkatesh'>[venkatesh]<span> (</span><span class='info'>Venkatesh, &ldquo;Subject: Re: [Sipping] I-D ACTION:draft-ietf-sipping-service-examples-11.txt,&rdquo; October&nbsp;2006.</span><span>)</span></a>.

</p>
<p>
John Elwell<a class='info' href='#elwell'>[elwell]<span> (</span><span class='info'>Elwell, J., &ldquo;Subject: [Sipping] RE: I-D Action:draft-worley-service-example-00.txt,&rdquo; November&nbsp;2007.</span><span>)</span></a> pointed out the need for the executing
UA to pass through re-INVITEs/UPDATEs in order to allow ICE
negotiation.

</p>
<p>
Paul Kyzivat<a class='info' href='#kyzivat-1'>[kyzivat&#8209;1]<span> (</span><span class='info'>Kyzivat, P., &ldquo;Subject: Re: [Sipping] I-D ACTION:draft-ietf-sipping-service-examples-11.txt,&rdquo; October&nbsp;2006.</span><span>)</span></a><a class='info' href='#kyzivat-2'>[kyzivat&#8209;2]<span> (</span><span class='info'>Kyzivat, P., &ldquo;[Sip-implementors] draft-worley-service-example-02,&rdquo; September&nbsp;2008.</span><span>)</span></a> pointed
out the difficulties regarding reuse of payload type numbers
and considerations that could be used to avoid those difficulties,
leading to the writing of <a class='info' href='#payload'>Section&nbsp;2.7<span> (</span><span class='info'>Handling Payload Type Numbers</span><span>)</span></a>.

</p>
<p>
Paul Kyzivat suggested adding <a class='info' href='#codec-mgmt'>Section&nbsp;4.1<span> (</span><span class='info'>Offering All Available Media Formats</span><span>)</span></a>
showing why offerers should always include all supported formats.

</p>
<p>
M. Ranganathan pointed out the difficulties experienced by a B2BUA
(<a class='info' href='#reinvite'>Section&nbsp;4.2<span> (</span><span class='info'>Handling re-INVITES in a B2BUA</span><span>)</span></a>) due to the multiple changes of media source.

</p>
<p>
<a class='info' href='#codec-mgmt'>Section&nbsp;4.1<span> (</span><span class='info'>Offering All Available Media Formats</span><span>)</span></a> was significantly clarified based on
advice from Attila Sipos<a class='info' href='#sipos'>[sipos]<span> (</span><span class='info'>Attila Sipos, &ldquo;RE: [Sip-implementors] draft-worley-service-example-02,&rdquo; March&nbsp;2009.</span><span>)</span></a>.

</p>
<p>
The need to discuss dialog/session
timers[<a class='info' href='#timers-section'>Section&nbsp;2.8<span> (</span><span class='info'>Dialog/Session Timers</span><span>)</span></a>] was pointed out by Rifaat
Shekh-Yusef<a class='info' href='#shekh-yusef'>[shekh&#8209;yusef]<span> (</span><span class='info'>Rifaat Shekh-Yusef, &ldquo;[sipcore]  draft-worley-service-example-03,&rdquo; July&nbsp;2009.</span><span>)</span></a>.

</p>
<p>
Robert Sparks clarified the purpose of the "Best Common Practice" status,
leading to revising the intended status of this document to
"Informational".<a class='info' href='#status'>Section&nbsp;1.1<span> (</span><span class='info'>Intended Status</span><span>)</span></a>

</p>
<a name="revision"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Revision History</h3>

<p>(Note to RFC Editor:  Please remove this entire section upon
publication as an RFC.
</p>
<a name="00-01"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Changes from draft-worley-service-example-00 to draft-worley-service-example-01</h3>

<p>
Removed the original "Example Message Flow" and promoted the
"Alternative Example Message Flow" to replace it because of a number
of flaws that were found during the discussion of -00 on the SIPPING
mailing list.

</p>
<p>
Described the use of the sip.rendering feature parameter to indicate
on-hold status.

</p>
<a name="01-02"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Changes from draft-worley-service-example-01 to draft-worley-service-example-02</h3>

<p>
Added discussion of passing though re-INVITEs and UPDATEs.

</p>
<p>
Added discussion of payload type numbers.

</p>
<p>
Added Acknowledgments section.

</p>
<a name="02-03"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Changes from draft-worley-service-example-02 to draft-worley-service-example-03</h3>

<p>
Added <a class='info' href='#codec-mgmt'>Section&nbsp;4.1<span> (</span><span class='info'>Offering All Available Media Formats</span><span>)</span></a> showing the importance of the
offerer always including all supported media formats.

</p>
<p>
Updated references.

</p>
<p>
Revised handling of payload type numbers when passing offer to MOH
server <a class='info' href='#payload'>Section&nbsp;2.7<span> (</span><span class='info'>Handling Payload Type Numbers</span><span>)</span></a>, based on observations by Paul Kyzivat.

</p>
<a name="03-04"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
Changes from draft-worley-service-example-03 to draft-worley-service-example-04</h3>

<p>
Added <a class='info' href='#reinvite'>Section&nbsp;4.2<span> (</span><span class='info'>Handling re-INVITES in a B2BUA</span><span>)</span></a> discussing handling of re-INVITEs by
B2BUAs when using this method.

</p>
<p>
Added "avoidance of out-of-dialog REFER" as an advantage.<a class='info' href='#advantages'>Section&nbsp;3<span> (</span><span class='info'>Advantages</span><span>)</span></a>

</p>
<p>
Added "automaton", "sip.rendering", and "sip.byeless" feature tags to
the Contact URI of the Music Server in the examples.<a class='info' href='#dialog-event'>[dialog&#8209;event]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and R. Mahy, &ldquo;An INVITE-Initiated Dialog Event Package for the                Session Initiation Protocol (SIP),&rdquo; November&nbsp;2005.</span><span>)</span></a><a class='info' href='#ua-capabilities'>[ua&#8209;capabilities]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and P. Kyzivat, &ldquo;Indicating User Agent Capabilities in the Session Initiation 	       Protocol (SIP),&rdquo; August&nbsp;2004.</span><span>)</span></a>

</p>
<p>
Added initial discussion of dialog/session timer support.<a class='info' href='#timers-section'>Section&nbsp;2.8<span> (</span><span class='info'>Dialog/Session Timers</span><span>)</span></a>

</p>
<p>
Revised handling of payload type numbers based on further observations
by Paul Kyzivat<a class='info' href='#kyzivat-2'>[kyzivat&#8209;2]<span> (</span><span class='info'>Kyzivat, P., &ldquo;[Sip-implementors] draft-worley-service-example-02,&rdquo; September&nbsp;2008.</span><span>)</span></a>.

</p>
<a name="04-05"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5"></a><h3>7.5.&nbsp;
Changes from draft-worley-service-example-04 to draft-worley-service-example-05</h3>

<p>
Changed references to "SPIT" to refer to "media security", per
suggestion by Scott Lawrence.

</p>
<p>
Removed reference to the idea of having the executing UA not maintain
session timers itself, but rather, passing through session timer
negotiation and updates.
Examination showed this idea to be much more complex to implement than
having the executing UA terminate session timers itself for both
dialogs.
(Suggested by Rifaat Shekh-Yusef.)

</p>
<p>
On advice from Robert Sparks, changed the "intended status" from "BCP"
to "Informational", and added a section to explain the change.

</p>
<p>
Noted that the rule on not reusing payload type numbers is undesirable because
it complicates third-party operations (as noted by
Paul Kyzivat<a class='info' href='#kyzivat-3'>[kyzivat&#8209;3]<span> (</span><span class='info'>Kyzivat, P., &ldquo;[Sip-implementors] draft-worley-service-example-02,&rdquo; September&nbsp;2008.</span><span>)</span></a>).

</p>
<a name="05-06"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.6"></a><h3>7.6.&nbsp;
Changes from draft-worley-service-example-05 to draft-worley-service-example-06</h3>

<p>Updated author's contact information.
</p>
<p>On suggestion from John Elwell, added mention that the Music
Source's SDP address/port implies its RTCP address/port, which will
be used to receive RTCP.
</p>
<p>Updated references to <a class='info' href='#service-examples'>[service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; October&nbsp;200.</span><span>)</span></a> and
<a class='info' href='#service-examples-11'>[service&#8209;examples&#8209;11]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; October&nbsp;2006.</span><span>)</span></a> to specify the sections of
documents, which are the ones that discuss music on hold.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="offer-answer">[offer-answer]</a></td>
<td class="author-text">Rosenberg, J. and H. Schulzrinne, &ldquo;<a href="http://tools.ietf.org/html/rfc3264">An Offer/Answer Model with the Session Description Protocol (SDP)</a>,&rdquo; RFC&nbsp;3264, June&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3264.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="sdp">[sdp]</a></td>
<td class="author-text">Handley, M., Jacobson, V., and C. Perkins, &ldquo;<a href="http://tools.ietf.org/html/rfc4566">SDP: Session Description Protocol</a>,&rdquo; RFC&nbsp;4566, July&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4566.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="sip">[sip]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="timers">[timers]</a></td>
<td class="author-text">Donovan, S. and J. Rosenberg, &ldquo;<a href="http://tools.ietf.org/html/rfc4028">Session Timers in the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;4028, April&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc4028.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="dialog-event">[dialog-event]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., and R. Mahy, &ldquo;<a href="http://tools.ietf.org/html/rfc4235">An INVITE-Initiated Dialog Event Package for the
               Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;4235, November&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc4235.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="elwell">[elwell]</a></td>
<td class="author-text">Elwell, J., &ldquo;<a href="http://www1.ietf.org/mail-archive/web/sipping/current/msg14678.html">Subject: [Sipping] RE: I-D Action:draft-worley-service-example-00.txt</a>,&rdquo; IETF Sipping mailing list&nbsp;msg14678, November&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="ice">[ice]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://tools.ietf.org/html/rfc5245">Interactive Connectivity Establishment (ICE): A Protocol for Network
               Address Translator (NAT) Traversal for Offer/Answer Protocols</a>,&rdquo; RFC&nbsp;5245, April&nbsp;2010 (<a href="ftp://ftp.isi.edu/in-notes/rfc5245.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="kyzivat-1">[kyzivat-1]</a></td>
<td class="author-text">Kyzivat, P., &ldquo;<a href="http://www1.ietf.org/mail-archive/web/sipping/current/msg12181.html">Subject: Re: [Sipping] I-D ACTION:draft-ietf-sipping-service-examples-11.txt</a>,&rdquo; IETF Sipping mailing list&nbsp;msg12181, October&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="kyzivat-2">[kyzivat-2]</a></td>
<td class="author-text">Kyzivat, P., &ldquo;<a href="https://lists.cs.columbia.edu/pipermail/sip-implementors/2008-September/020426.html">[Sip-implementors] draft-worley-service-example-02</a>,&rdquo; sip-implementors mailing list&nbsp;020426, September&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="kyzivat-3">[kyzivat-3]</a></td>
<td class="author-text">Kyzivat, P., &ldquo;<a href="https://lists.cs.columbia.edu/pipermail/sip-implementors/2008-September/020387.html">[Sip-implementors] draft-worley-service-example-02</a>,&rdquo; sip-implementors mailing list&nbsp;020387, September&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="offer-answer-bis">[offer-answer-bis]</a></td>
<td class="author-text">Okumura, S. and P. Kyzivat, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sipping-sip-offeranswer-13.txt">SIP (Session Initiation Protocol) Usage of the Offer/Answer Model</a>,&rdquo; I-D&nbsp;draft-ietf-sipping-sip-offeranswer-13, May&nbsp;2010.</td></tr>
<tr><td class="author-text" valign="top"><a name="service-examples">[service-examples]</a></td>
<td class="author-text">Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;<a href="http://tools.ietf.org/html/rfc5359">Session Initiation Protocol Service Examples</a>,&rdquo; RFC&nbsp;5359, October&nbsp;200 (<a href="ftp://ftp.isi.edu/in-notes/rfc5359.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="service-examples-11">[service-examples-11]</a></td>
<td class="author-text">Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sipping-service-examples-11.txt">Session Initiation Protocol Service Examples</a>,&rdquo; I-D&nbsp;draft-ietf-sipping-service-examples-11, October&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="shekh-yusef">[shekh-yusef]</a></td>
<td class="author-text">Rifaat Shekh-Yusef, &ldquo;<a href="http://www.ietf.org/mail-archive/web/sipcore/current/msg00580.html">[sipcore]  draft-worley-service-example-03</a>,&rdquo; IETF Sipcore mailing list&nbsp;msg00580, July&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="sipos">[sipos]</a></td>
<td class="author-text">Attila Sipos, &ldquo;<a href="https://lists.cs.columbia.edu/pipermail/sip-implementors/2009-March/022002.html">RE: [Sip-implementors] draft-worley-service-example-02</a>,&rdquo; sip-implementors mailing list&nbsp;022002, March&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="ua-capabilities">[ua-capabilities]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., and P. Kyzivat, &ldquo;<a href="http://tools.ietf.org/html/rfc3840">Indicating User Agent Capabilities in the Session Initiation
	       Protocol (SIP)</a>,&rdquo; RFC&nbsp;3840, August&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3840.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="venkatesh">[venkatesh]</a></td>
<td class="author-text">Venkatesh, &ldquo;<a href="http://www1.ietf.org/mail-archive/web/sipping/current/msg12180.html">Subject: Re: [Sipping] I-D ACTION:draft-ietf-sipping-service-examples-11.txt</a>,&rdquo; IETF Sipping mailing list&nbsp;msg12180, October&nbsp;2006.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dale R. Worley</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Avaya Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">600 Technology Park Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Billerica, MA  01821</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:dworley@avaya.com">dworley@avaya.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.avaya.com">http://www.avaya.com</a></td></tr>
</table>
</body></html>
