<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Domain Path (D-PATH) for Ethernet VPN (EVPN) Interconnect Networks</title>
<meta content="J. Rabadan" name="author">
<meta content="S. Sathappan" name="author">
<meta content="M. Gautam" name="author">
<meta content="P. Brissette" name="author">
<meta content="W. Lin" name="author">
<meta content="
       The BGP Domain PATH (D-PATH) attribute is defined for Inter-Subnet
      Forwarding (ISF) BGP Sub-Address Families that advertise IP prefixes.
      When used along with EVPN IP Prefix routes or IP-VPN routes, it
      identifies the domain(s) through which the routes have passed and that
      information can be used by the receiver BGP speakers to detect routing
      loops or influence the BGP best path selection. This document extends
      the use of D-PATH so that it can also be used along with other EVPN
      route types. 
    " name="description">
<meta content="xml2rfc 3.12.3" name="generator">
<meta content="draft-sr-bess-evpn-dpath-01" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.3
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.8.0
    MarkupSafe 2.0.1
    pycountry 22.1.10
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.27.1
    setuptools 59.6.0
    six 1.16.0
    WeasyPrint 52.5
-->
<link href="/tmp/draft-sr-bess-evpn-dpath-01-d4tlzm14.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">D-PATH for Layer2 EVPN</td>
<td class="right">March 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Rabadan, et al.</td>
<td class="center">Expires 8 September 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">BESS Workgroup</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-sr-bess-evpn-dpath-01</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-03-07" class="published">7 March 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-09-08">8 September 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">J. Rabadan, <span class="editor">Ed.</span>
</div>
<div class="org">Nokia</div>
</div>
<div class="author">
      <div class="author-name">S. Sathappan</div>
<div class="org">Nokia</div>
</div>
<div class="author">
      <div class="author-name">M. Gautam</div>
<div class="org">Nokia</div>
</div>
<div class="author">
      <div class="author-name">P. Brissette</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">W. Lin</div>
<div class="org">Juniper</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Domain Path (D-PATH) for Ethernet VPN (EVPN) Interconnect Networks</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The BGP Domain PATH (D-PATH) attribute is defined for Inter-Subnet
      Forwarding (ISF) BGP Sub-Address Families that advertise IP prefixes.
      When used along with EVPN IP Prefix routes or IP-VPN routes, it
      identifies the domain(s) through which the routes have passed and that
      information can be used by the receiver BGP speakers to detect routing
      loops or influence the BGP best path selection. This document extends
      the use of D-PATH so that it can also be used along with other EVPN
      route types.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo-6">
<a href="#name-status-of-this-memo-6" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 8 September 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice-6">
<a href="#name-copyright-notice-6" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents-6">
<a href="#name-table-of-contents-6" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction-6" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-d-path-to-prevent-loops-for" class="xref">D-PATH to Prevent Loops for EVPN Routes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-add-path-visibility-and-inf" class="xref">Add Path Visibility and Influence Best Path Selection for EVPN Routes</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-conventions-used-in-this-doc" class="xref">Conventions used in this document</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-terminology-4" class="xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-use-of-domain-path-attribut" class="xref">Use of Domain Path Attribute (D-PATH) with EVPN routes</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-d-path-and-best-path-select" class="xref">D-PATH and Best Path Selection for MAC/IP Advertisement routes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-d-path-and-best-path-selecti" class="xref">D-PATH and Best Path Selection for Ethernet A-D per EVI routes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-d-path-and-best-path-selectio" class="xref">D-PATH and Best Path Selection for Inclusive Multicast Ethernet Tag routes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-loop-detection" class="xref">Loop Detection</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-error-handling" class="xref">Error Handling</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-use-case-examples" class="xref">Use-Case Examples</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-security-considerations-6" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-iana-considerations-6" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-acknowledgments-2" class="xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-contributors-2" class="xref">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-references-4" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-normative-references-5" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-informative-references-4" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses-5" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="sect-1">
<section id="section-1">
      <h2 id="name-introduction-6">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction-6" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The BGP Domain PATH (D-PATH) attribute <span>[<a href="#I-D.ietf-bess-evpn-ipvpn-interworking" class="xref">I-D.ietf-bess-evpn-ipvpn-interworking</a>]</span> is defined for
      Inter-Subnet Forwarding (ISF) BGP Sub-Address Families that advertise IP
      prefixes. When used along with EVPN IP Prefix routes or IP-VPN routes,
      it identifies the domain(s) through which the routes have passed and
      that information can be used by the receiver BGP speakers to detect
      routing loops or influence the BGP best path selection. This document
      extends the use of D-PATH so that it can also be used along with other
      EVPN route types.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The D-PATH attribute can be used to prevent control plane loops for
      EVPN routes, or to provide full path visibility of all the EVPN
      Interconnect Gateways through which a route has gone and modify the best
      path selection based on it. Some use cases in which D-PATH can be used
      along with (non-IP Prefix) EVPN routes follow, but the use cases are not
      limited to the ones described in this section.<a href="#section-1-2" class="pilcrow">¶</a></p>
<div id="sect-1.1">
<section id="section-1.1">
        <h3 id="name-d-path-to-prevent-loops-for">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-d-path-to-prevent-loops-for" class="section-name selfRef">D-PATH to Prevent Loops for EVPN Routes</a>
        </h3>
<p id="section-1.1-1"><a href="#loop" class="xref">Figure 1</a> illustrates an EVPN Interconnect case where
        EVPN MAC/IP Advertisement routes can be looped indefinitely. The three
        Gateways (GW1, GW2 and GW3) and PE1 in the diagram are attached to the
        same EVPN Broadcast Domain (BD1). However, BD1 is extended throughout
        three different domains that are interconnected by the Gateways, which
        follow <span>[<a href="#RFC9014" class="xref">RFC9014</a>]</span> procedures. Suppose a host with MAC
        address M1 is learned on GW1 and GW1 advertises an EVPN MAC/IP
        Advertisement route for M1 into Domain-1 and Domain-2. When the route
        gets imported by GW2 and GW3 and later exported into Domain-3, GW2 and
        GW3 may redistribute each other's route for M1 back into Domain-1 and
        Domain-2, respectively, creating a loop. D-PATH can be used by the
        Gateways when redistributing the route between Domains, to identify
        the Domains through which the route for M1 has gone. When GW1 receives
        an EVPN MAC/IP Advertisement route for M1 that contains a D-PATH with
        a domain-id locally assigned, GW1 identifies the route as "looped".<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<span id="name-loops-for-evpn-routes"></span><div id="loop">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-1.1-2.1">
<pre>          +----------------+ GW2
          |   EVPN        +-------+
          |   Domain-1    | +---+ |
          |               | |BD1| |---------------+
          |               | +---+ |               |
     GW1  |               +-------+               |    PE1
   +-------+               |     |    EVPN       +-------+
   | +---+ |---------------+     |    Domain-3   | +---+ |
   | |BD1| |                     |               | |BD1| |
   | +---+ |---------------+     |               | +---+ |
   +---|---+               | GW3 |               +---|---+
       |  |   EVPN        +-------+               |  |
   M1--+  |   Domain-2    | +---+ |               |  +--M2
          |               | |BD1| |---------------+
          |               | +---+ |
          |               +-------+
          +----------------+</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-loops-for-evpn-routes" class="selfRef">Loops for EVPN routes</a>
          </figcaption></figure>
</div>
<p id="section-1.1-3">Similar examples are possible with EVPN VPWS services on
        the Gateways and PEs, where loop prevention for the redistributed A-D
        per EVI routes is needed. D-PATH provides the end to end path
        visibility that is required to prevent the loop.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-1.2">
<section id="section-1.2">
        <h3 id="name-add-path-visibility-and-inf">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-add-path-visibility-and-inf" class="section-name selfRef">Add Path Visibility and Influence Best Path Selection for EVPN Routes</a>
        </h3>
<p id="section-1.2-1"><a href="#best-path" class="xref">Figure 2</a> illustrates another <span>[<a href="#RFC9014" class="xref">RFC9014</a>]</span> EVPN Interconnect case where, in addition to using
        D-PATH to prevent EVPN MAC/IP Advertisement route loops when
        redistributing routes between domains, the D-PATH attribute can also
        influence the best path selection for the routes. For example, if all
        the Gateways in the diagram are attached to the same BD1, an EVPN
        MAC/IP Advertisement route for MAC address M1 advertised by GW1 is
        advertised into Domain-1 and Domain-4. Two routes for M1 will arrive
        at GW3 with different Route Distinguishers and BGP Next Hops. If
        D-PATH is used by all the Gateways, the two routes arriving at GW3
        will have a different sequence of domain-ids in the D-PATH attribute.
        GW3 can use the length of the D-PATH as a way of influencing the
        selection (i.e., the shortest D-PATH route is selected). D-PATH
        improves the path visibility of the route since it provides
        information about all the Domains through which the route has
        passed.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<span id="name-influence-best-path-selecti"></span><div id="best-path">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-1.2-2.1">
<pre>        +----------+ GW11  +----------+  GW2  +----------+
        | EVPN     +-------+ EVPN     +-------+ EVPN     |
        | Domain-1 | +---+ | Domain-2 | +---+ | Domain-3 |
        |          | |BD1| |          | |BD1| |          |
        |          | +---+ |          | +---+ |          |
   GW1  |          +-------+          +-------+          |  GW3
 +-------+         |       |          |       |         +-------+
 | +---+ |---------+       +----------+       +---------| +---+ |
 | |BD1| |                                              | |BD1| |
 | +---+ |---------+       +----------------------------| +---+ |
 +---|---+         | GW12  |                            +---|---+
     |  | EVPN     +-------+      EVPN                   |  |
 M1--+  | Domain-4 | +---+ |      Domain-5               |  +--M2
        |          | |BD1| |                             |
        |          | +---+ |                             |
        |          +-------+                             |
        +----------+       +-----------------------------+</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-influence-best-path-selecti" class="selfRef">Influence Best Path Selection for EVPN routes</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="sect-2">
<section id="section-2">
      <h2 id="name-conventions-used-in-this-doc">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-used-in-this-doc" class="section-name selfRef">Conventions used in this document</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
      "OPTIONAL" in this document are to be interpreted as described in BCP 14
      <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when,
      they appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-3">
<section id="section-3">
      <h2 id="name-terminology-4">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-terminology-4" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-3-1">This section summarizes the terminology that is used throughout the
      rest of the document.<a href="#section-3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.1">AC: Attachment Circuit or logical interface associated to a given
          BT. To determine the AC on which a packet arrived, the PE examines
          the combination of a physical port and VLAN tags (where the VLAN
          tags can be individual c-tags, s-tags or ranges of both).<a href="#section-3-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.2">BD and BT: a Broadcast Domain and Bridge Table, as defined in
          <span>[<a href="#I-D.ietf-bess-rfc7432bis" class="xref">I-D.ietf-bess-rfc7432bis</a>]</span>. A BD is a group of PEs
          attached to the same EVPN layer-2 multipoint service. A BT is the
          instantiation of a Broadcast Domain in a PE. When there is a single
          Broadcast Domain in a given EVI, the MAC-VRF in each PE contains a
          single BT. When there are multiple BTs within the same MAC-VRF, each
          BT is associated to a different Ethernet Tag. The EVPN routes
          specific to a BT indicate which Ethernet Tag the route corresponds
          to.<a href="#section-3-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.3">ES and ESI: Ethernet Segment and Ethernet Segment Identifier, as
          defined in <span>[<a href="#I-D.ietf-bess-rfc7432bis" class="xref">I-D.ietf-bess-rfc7432bis</a>]</span>.<a href="#section-3-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.4">
          <p id="section-3-2.4.1">EVPN Domain: two PEs are in the same EVPN Domain if they are
          attached to the same service and the packets between them do not
          require a data path lookup of the inner frame (e.g., in the BT of a
          MAC-VRF) in any intermediate router. An EVPN Domain Gateway PE is
          always configured with multiple Domain identifiers (EVPN Domain-ID)
          in the MAC-VRF or VPWS that connects those EVPN Domains, each EVPN
          Domain-ID representing an EVPN Domain.<a href="#section-3-2.4.1" class="pilcrow">¶</a></p>
<p id="section-3-2.4.2">Example: <a href="#ure-interworking-composite-pe-example" class="xref">Figure 3</a> illustrates an
          example where PE1 and PE2 belong to different EVPN Domains since
          packets between them (for flows between hosts with MAC addresses M1
          and M2) require a MAC lookup in two of the gateways that are
          connecting the three EVPN Domains. E.g., if frames from M1 to M2 go
          through PE1, GW1, GW3 and PE2, a MAC lookup is performed at GW1 and
          GW3.<a href="#section-3-2.4.2" class="pilcrow">¶</a></p>
<span id="name-evpn-domain-interconnect-ex"></span><div id="ure-interworking-composite-pe-example">
<figure id="figure-3">
            <div class="alignLeft art-text artwork" id="section-3-2.4.3.1">
<pre>
                        GW1------------GW3
                      +------+       +------+
        +-------------| BD1  |       | BD1  |-------------+
       PE1            +------+       +------+            PE2
     +------+            |              |             +------+
  M1-| BD1  |   EVPN     |     EVPN     |     EVPN    |  BD1 |-M2
     +------+           GW2            GW4            +---+--+
        |             +------+       +------+             |
        +-------------| BD1  |       | BD1  |-------------+
                      +------+       +------+
                         +--------------+
         EVPN Domain 1     EVPN Domain 2  EVPN Domain 3
        &lt;---------------&gt; &lt;------------&gt; &lt;----------------&gt;</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-evpn-domain-interconnect-ex" class="selfRef">EVPN Domain Interconnect Example</a>
            </figcaption></figure>
</div>
</li>
      </ul>
<ul class="normal">
<li class="normal" id="section-3-3.1">EVPN Domain Gateway: a PE where a service (BD or VPWS instance)
          is instantiated and is attached to two or more EVPN Domains. An
          example of EVPN Domain Gateway is a PE following the procedures in
          section 4.4 or section 4.6 of <span>[<a href="#RFC9014" class="xref">RFC9014</a>]</span>. In the
          example in <a href="#ure-interworking-composite-pe-example" class="xref">Figure 3</a>,
          GW1 and GW2 connect EVPN Domains 1 and 2, whereas GW3 and GW4
          connect EVPN Domains 2 and 3. GW1 and GW2 import the MAC/IP
          Advertisement route for M1 coming from the EVPN Domain 1 into the
          MAC-VRF for BD1, and redistribute it into EVPN Domain 2. Likewise,
          GW3 and GW4 import the route into their MAC-VRF and re-advertise it
          into EVPN Domain 3.<a href="#section-3-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-3.2">MAC-VRF: a MAC Virtual Routing and Forwarding table, as defined
          in <span>[<a href="#I-D.ietf-bess-rfc7432bis" class="xref">I-D.ietf-bess-rfc7432bis</a>]</span>. It is also the
          instantiation of an EVI (EVPN Instance) in a PE.<a href="#section-3-3.2" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="sect-4">
<section id="section-4">
      <h2 id="name-use-of-domain-path-attribut">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-use-of-domain-path-attribut" class="section-name selfRef">Use of Domain Path Attribute (D-PATH) with EVPN routes</a>
      </h2>
<p id="section-4-1">This document extends the use of the D-PATH attribute specified in
      <span>[<a href="#I-D.ietf-bess-evpn-ipvpn-interworking" class="xref">I-D.ietf-bess-evpn-ipvpn-interworking</a>]</span> so that D-PATH
      can be advertised and processed along with the following EVPN route
      types:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1">EVPN MAC/IP Advertisement routes that are not used for
          Inter-Subnet Forwarding (ISF). Note that if the EVPN MAC/IP
          Advertisement route is used for Inter-Subnet Forwarding as in <span>[<a href="#RFC9135" class="xref">RFC9135</a>]</span>, the procedures for the D-PATH advertisement and
          processing are described in <span>[<a href="#I-D.ietf-bess-evpn-ipvpn-interworking" class="xref">I-D.ietf-bess-evpn-ipvpn-interworking</a>]</span>.<a href="#section-4-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-2.2">EVPN A-D per EVI routes that are used for EVPN VPWS <span>[<a href="#RFC8214" class="xref">RFC8214</a>]</span>. Advertised A-D per EVI routes not used for EVPN
          VPWS SHOULD NOT contain D-PATH.<a href="#section-4-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-2.3">EVPN Inclusive Multicast Ethernet Tag routes <span>[<a href="#I-D.ietf-bess-rfc7432bis" class="xref">I-D.ietf-bess-rfc7432bis</a>]</span>.<a href="#section-4-2.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-4-3">As discussed, the use of D-PATH with EVPN IP Prefix routes is
      specified in <span>[<a href="#I-D.ietf-bess-evpn-ipvpn-interworking" class="xref">I-D.ietf-bess-evpn-ipvpn-interworking</a>]</span>.
      When used along with EVPN routes other than IP Prefix routes, the D-PATH
      attribute is characterized as follows:<a href="#section-4-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4-4">
<li id="section-4-4.1">D-PATH is composed of a sequence of Domain segments following the
          format specified in <span>[<a href="#I-D.ietf-bess-evpn-ipvpn-interworking" class="xref">I-D.ietf-bess-evpn-ipvpn-interworking</a>]</span> where each Domain
          is represented as &lt;DOMAIN-ID:ISF_SAFI_TYPE&gt;. In this
          specification, DOMAIN-ID is an EVPN Domain identifier configured in
          an EVPN Domain Gateway and ISF_SAFI_TYPE is set to either 70 (EVPN)
          or 0 (local route). To simplify the explanation, this document
          represents the domains for EVPN routes as
          &lt;Domain-ID:TYPE&gt;.<a href="#section-4-4.1" class="pilcrow">¶</a>
</li>
        <li id="section-4-4.2">D-PATH identifies the sequence of EVPN Domains the route has gone
          through, with the last &lt;Domain-ID:TYPE&gt; entry (rightmost)
          identifying the first PE or EVPN Domain Gateway that added the
          D-PATH attribute.<a href="#section-4-4.2" class="pilcrow">¶</a>
</li>
        <li id="section-4-4.3">
          <p id="section-4-4.3.1">For non-ISF MAC/IP Advertisement routes or A-D per EVI routes,
          D-PATH SHOULD be added/modified by a EVPN Domain Gateway that
          redistributes the route between EVPN Domains and MAY be added by a
          PE or EVPN Domain Gateway that originates the route, as
          follows:<a href="#section-4-4.3.1" class="pilcrow">¶</a></p>
<ol start="1" type="a" class="normal type-a" id="section-4-4.3.2">
<li id="section-4-4.3.2.1">An EVPN Domain Gateway that connects two EVPN Domains "X" and
              "Y", and receives a route on a EVPN Domain identified by a
              Domain-ID "X" SHOULD append a domain &lt;X:EVPN&gt; to the
              existing (or newly added) D-PATH attribute when redistributing
              the route to EVPN Domain "Y". The route is redistributed if it
              is first imported in a MAC-VRF (or VPWS instance), the MAC (or
              Ethernet Tag) is active, and policy allows the re-export of the
              route to a BGP neighbor.<a href="#section-4-4.3.2.1" class="pilcrow">¶</a>
</li>
            <li id="section-4-4.3.2.2">An EVPN Domain Gateway MAY also add the D-PATH attribute for
              locally learned MACs or MAC/IP pairs. In this case, the domain
              added would be &lt;A:0&gt;, where "A" is the Domain-ID
              configured on the Gateway's MAC-VRF that is specific to local
              routes (MAC/IP learned via local AC), and "0" is the TYPE of the
              EVPN Domain and indicates that the route is locally originated
              and not redistributed after receiving it from a BGP-EVPN
              neighbor. The EVPN Domain-ID for local routes MAY be shared by
              all the EVPN Domain Gateways of the same redundancy group for
              local routes, or each EVPN Domain Gateway of the redundancy
              group can use its own Domain-ID.<a href="#section-4-4.3.2.2" class="pilcrow">¶</a>
</li>
            <li id="section-4-4.3.2.3">A PE that is connected to a single EVPN Domain (therefore the
              PE is not an EVPN Domain Gateway) MAY add the D-PATH with a
              domain &lt;B:0&gt;, where "B" is the Domain-ID configured on the
              PE's MAC-VRF (or VPWS) for locally learned MAC/IPs (or Ethernet
              Tag IDs for VPWS). "0" is the TYPE that indicates the route is
              not re-advertised, but originated in the PE.<a href="#section-4-4.3.2.3" class="pilcrow">¶</a>
</li>
          </ol>
</li>
        <li id="section-4-4.4">For EVPN Inclusive Multicast Ethernet Tag routes, an EVPN Domain
          Gateway must not redistribute routes between Domains as specified in
          <span>[<a href="#RFC9014" class="xref">RFC9014</a>]</span>. An EVPN Domain Gateway originates an EVPN
          Inclusive Multicast Ethernet Tag route per Domain to which the
          Gateway is attached, so that BUM traffic can be attracted from one
          Domain to the rest. Therefore, only the above point 3.b. applies to
          EVPN Domain Gateways. That is, an EVPN Domain Gateway MAY add a
          &lt;A:0&gt; D-PATH attribute for the Inclusive Multicast Ethernet
          Tag routes generated for the EVPN Domains, where "A" is the
          configured local Domain-ID, and "0" is the TYPE that indicates the
          route is locally originated and not redistributed across EVPN
          Domains. When two EVPN Domain Gateways of the same redundancy group
          connect two EVPN Domains "X" and "Y" and D-PATH is used for EVPN
          Inclusive Multicast Ethernet Tag routes, it is RECOMMENDED to add
          the D-PATH attribute with the same local Domain-ID and only on "X"
          or "Y" but not on both Domains.<a href="#section-4-4.4" class="pilcrow">¶</a>
</li>
        <li id="section-4-4.5"> On received EVPN routes, D-PATH is processed and used for loop
          detection (<a href="#sect-4.4" class="xref">Section 4.4</a>) as well as to influence the
          best path selection (<a href="#sect-4.1" class="xref">Section 4.1</a>, <a href="#sect-4.2" class="xref">Section 4.2</a> and <a href="#sect-4.3" class="xref">Section 4.3</a>).<a href="#section-4-4.5" class="pilcrow">¶</a>
</li>
      </ol>
<div id="sect-4.1">
<section id="section-4.1">
        <h3 id="name-d-path-and-best-path-select">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-d-path-and-best-path-select" class="section-name selfRef">D-PATH and Best Path Selection for MAC/IP Advertisement routes</a>
        </h3>
<p id="section-4.1-1">When two (or more) MAC/IP Advertisement routes with the same route
        key (and same or different RDs) are received, a best path selection
        algorithm is used to select and install only one route. This section
        summarizes the best path selection for MAC/IP Advertisement routes,
        which extends the rules in <span>[<a href="#I-D.ietf-bess-rfc7432bis" class="xref">I-D.ietf-bess-rfc7432bis</a>]</span>
        by including D-PATH in the tie-breaking algorithm. While the algorithm
        may be implemented in different ways, the selection result SHOULD be
        the same as the result of the rules that follow.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">The tie-breaking algorithm begins by considering all EVPN MAC/IP
        Advertisement routes equally preferable routes to the same
        destination, and then selects routes to be removed from consideration.
        The process terminates as soon as only one route remains in
        consideration.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.1-3">
<li id="section-4.1-3.1">When the Default Gateway extended community is present in some
            of the routes, the MAC/IP Advertisement routes without the Default
            Gateway indication are removed from consideration, as defined in
            <span>[<a href="#I-D.ietf-bess-rfc7432bis" class="xref">I-D.ietf-bess-rfc7432bis</a>]</span>.<a href="#section-4.1-3.1" class="pilcrow">¶</a>
</li>
          <li id="section-4.1-3.2">Then the routes with the Static bit set in the MAC Mobility
            extended community are preferred, and the routes without the
            Static bit set are removed from consideration, as defined in <span>[<a href="#I-D.ietf-bess-rfc7432bis" class="xref">I-D.ietf-bess-rfc7432bis</a>]</span>. Note that this rule does not
            apply to routes with the Default Gateway extended community, since
            these routes SHALL NOT convey the MAC Mobility extended community
            <span>[<a href="#I-D.ietf-bess-rfc7432bis" class="xref">I-D.ietf-bess-rfc7432bis</a>]</span>. Therefore if two or
            more routes with the Default Gateway extended community remain in
            consideration, the selection process skips this step.<a href="#section-4.1-3.2" class="pilcrow">¶</a>
</li>
          <li id="section-4.1-3.3">Then the routes with the highest MAC Mobility Sequence number
            are preferred, hence the routes that are not tied for having the
            highest Sequence number are removed from consideration, as defined
            in <span>[<a href="#I-D.ietf-bess-rfc7432bis" class="xref">I-D.ietf-bess-rfc7432bis</a>]</span>. If two or more
            routes with the Default Gateway extended community remain in
            consideration, the selection process skips this step (for the same
            reason as in step 2).<a href="#section-4.1-3.3" class="pilcrow">¶</a>
</li>
          <li id="section-4.1-3.4">Then routes with the highest Local Preference are preferred,
            hence routes that are not tied for having the highest Local
            Preference are removed from consideration, as defined in <span>[<a href="#RFC4271" class="xref">RFC4271</a>]</span>.<a href="#section-4.1-3.4" class="pilcrow">¶</a>
</li>
          <li id="section-4.1-3.5">Then routes with the shortest D-PATH are preferred, hence
            routes not tied for the shortest D-PATH are removed. Routes
            without D-PATH are considered zero-length D-PATH.<a href="#section-4.1-3.5" class="pilcrow">¶</a>
</li>
          <li id="section-4.1-3.6">Then routes with the numerically lowest left-most Domain-ID are
            preferred, hence routes not tied for the numerically lowest
            left-most Domain-ID are removed from consideration.<a href="#section-4.1-3.6" class="pilcrow">¶</a>
</li>
          <li id="section-4.1-3.7">If the steps above do not produce a single route, the rest of
            the rules after the highest Local Preference in <span>[<a href="#RFC4271" class="xref">RFC4271</a>]</span> apply after step 6.<a href="#section-4.1-3.7" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-4.1-4">The above selection criteria is followed irrespective of the
        ESI value in the routes. EVPN Multi-Homing procedures for Aliasing or
        Backup paths in <span>[<a href="#I-D.ietf-bess-rfc7432bis" class="xref">I-D.ietf-bess-rfc7432bis</a>]</span> are applied
        to the selected MAC/IP Advertisement route.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-4.2">
<section id="section-4.2">
        <h3 id="name-d-path-and-best-path-selecti">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-d-path-and-best-path-selecti" class="section-name selfRef">D-PATH and Best Path Selection for Ethernet A-D per EVI routes</a>
        </h3>
<p id="section-4.2-1">When two (or more) EVPN A-D per EVI routes with the same route key
        (and same or different RDs) are received for a VPWS, a best path
        selection algorithm is used. The selection algorithm follows the same
        steps as in <a href="#sect-4.1" class="xref">Section 4.1</a> except for steps 1-3 which do
        not apply since the Default Gateway and MAC Mobility extended
        community are irrelevant to the EVPN A-D per EVI routes.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">The above selection is followed for A-D per EVI routes with ESI=0.
        For non-zero ESI routes, the EVPN Multi-Homing procedures in <span>[<a href="#RFC8214" class="xref">RFC8214</a>]</span> for Aliasing and Backup path are followed to select
        the routes (P and B flags are considered for the selection of the
        routes when sending traffic to a remote Ethernet Segment). If the
        mentioned Multi-Homing procedures do not produce a single route to
        each of the remote PEs attached to the same ES, steps 4-7 in <a href="#sect-4.1" class="xref">Section 4.1</a> are followed.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-4.3">
<section id="section-4.3">
        <h3 id="name-d-path-and-best-path-selectio">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-d-path-and-best-path-selectio" class="section-name selfRef">D-PATH and Best Path Selection for Inclusive Multicast Ethernet Tag routes</a>
        </h3>
<p id="section-4.3-1">When two (or more) EVPN Inclusive Multicast Ethernet Tag routes
        with the same route key (and same or different RDs) are received for a
        MAC-VRF, a best path selection algorithm is used. The selection
        algorithm follows the same steps as in <a href="#sect-4.1" class="xref">Section 4.1</a>
        except for steps 1-3 which do not apply.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-4.4">
<section id="section-4.4">
        <h3 id="name-loop-detection">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-loop-detection" class="section-name selfRef">Loop Detection</a>
        </h3>
<p id="section-4.4-1">An EVPN route received by a PE with a D-PATH attribute that
        contains one or more of its locally associated Domain-IDs for the
        MAC-VRF or VPWS instance is considered to be a looped route. A looped
        route MUST NOT be redistributed to a different domain and SHOULD be
        flagged as "looped".<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">EVPN A-D per EVI looped routes and Inclusive Multicast Ethernet Tag
        looped routes MUST NOT be installed, where "install" means "create
        forwarding state" in this document. An EVPN MAC/IP Advertisement
        looped route MAY be installed if selected as the best route.<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<p id="section-4.4-3">For instance, in the example of <a href="#ure-interworking-composite-pe-example" class="xref">Figure 3</a>, assuming PE1
        advertises M1's MAC/IP and does not add the D-PATH attribute, the EVPN
        Domain Gateway GW1 receives two MAC/IP Advertisement routes for M1's
        MAC/IP:<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-4.1">A MAC/IP Advertisement route with next-hop PE1 and no
            D-PATH.<a href="#section-4.4-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-4.2">A MAC/IP Advertisement route with next-hop GW2 and
            D-PATH={length=1,&lt;6500:1:EVPN&gt;}, assuming that the Domain-ID
            for EVPN Domain 1 is 6500:1.<a href="#section-4.4-4.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.4-5">In this case, EVPN Domain Gateway GW1 flags the MAC/IP
        Advertisement route with D-PATH as "looped", and does not install the
        MAC in the BT of the MAC-VRF and does not redistribute the route back
        to EVPN Domain 1 (since the route includes one of GW1's Domain-IDs).
        In case the MAC/IP Advertisement route with next-hop PE1 is withdrawn,
        GW1 may install the route with next-hop GW2 and D-PATH
        &lt;6500:1:EVPN&gt;; this may help speed up convergence in case of
        failures.<a href="#section-4.4-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-4.5">
<section id="section-4.5">
        <h3 id="name-error-handling">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-error-handling" class="section-name selfRef">Error Handling</a>
        </h3>
<p id="section-4.5-1">The error handling for the D-PATH attribute is described in <span>[<a href="#I-D.ietf-bess-evpn-ipvpn-interworking" class="xref">I-D.ietf-bess-evpn-ipvpn-interworking</a>]</span>. This document
        extends the use of D-PATH to non-ISF EVPN routes.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-5">
<section id="section-5">
      <h2 id="name-use-case-examples">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-use-case-examples" class="section-name selfRef">Use-Case Examples</a>
      </h2>
<p id="section-5-1">This section illustrates the use of D-PATH in EVPN routes with
      examples.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2"><a href="#use-case-1" class="xref">Figure 4</a> and <a href="#use-case-2" class="xref">Figure 5</a>
      illustrate an integrated interconnect solution for an EVPN BD, as
      described in section 4.4 and section 4.6 of <span>[<a href="#RFC9014" class="xref">RFC9014</a>]</span>.
      GW1 and GW2 are EVPN Domain Gateways connecting two EVPN Domains
      identified by D-PATH domain {1:1:EVPN} and {1:2:EVPN}, respectively.
      Received Ethernet A-D routes, ES routes, and Inclusive Multicast routes
      from the routers in one EVPN Domain are consumed and processed by GW1
      and GW2, but not redistributed to the other EVPN Domain. However, MAC/IP
      Advertisement routes received by GW1 and GW2 in one EVPN Domain are
      processed and, if installed, redistributed into the other EVPN
      Domain.<a href="#section-5-2" class="pilcrow">¶</a></p>
<span id="name-evpn-interconnect"></span><div id="use-case-1">
<figure id="figure-4">
        <div class="alignLeft art-text artwork" id="section-5-3.1">
<pre>         +----EVPN Domain-1---+      +----EVPN Domain-2--+
         |     1:1:EVPN       | GW1  |    1:2:EVPN       |
         |                   +---------+                 |
         |                   | +-----+ |                 |
         |                   | | BD1 | X &lt;-+             |
        PE1                  | +-----+ |   |            PE2
     +---------+             +---------+   |         +---------+
     | +-----+ |              |      |     |         | +-----+ |
M1-----| BD1 | |              |      |     |         | | BD1 |-----M2
     | +-----+ |  -------&gt;    |      |     |         | +-----+ |
     +---------+ (RT2)M1/IP1  |      |     |         +---------+
         |                   +---------+   |             |
         |                   | +-----+ |   |(RT2)M1/IP1  |
         |                   | | BD1 | | --+ &lt;1:1:EVPN&gt;  |
         |                   | +-----+ |                 |
         |                   +---------+                 |
         |                     | GW2 |                   |
         +---------------------+     +-------------------+</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-evpn-interconnect" class="selfRef">EVPN Interconnect</a>
        </figcaption></figure>
</div>
<p id="section-5-4">Consider the example of <a href="#use-case-1" class="xref">Figure 4</a>, where PE1
      advertises a MAC/IP Advertisement route for M1/IP1. The route is
      processed and installed by GW1 and GW2 in BD1, and both redistribute the
      routes into the EVPN Domain-2. By using D-PATH in GW1 and GW2, when the
      route is received on PE2, PE2 has the visibility of the EVPN Domains
      through which the route has gone, and can also use the D-PATH for best
      path selection. In addition, GW1 and GW2 can compare the D-PATH of the
      incoming routes with their local list of EVPN Domain-IDs, and detect
      looped routes if any of the local EVPN Domain-IDs matches a domain in
      the received D-PATH. This procedure prevents the redistribution of the
      route back into EVPN Domain-1. For example, when GW1 receives the MAC/IP
      Advertisement route for M1/IP1 with D-PATH &lt;1:1:EVPN&gt;, GW1
      identifies the route as looped and it does not redistribute it back to
      Domain-1. The M1/IP1 route with Next Hop PE1 is installed. If M1/IP1
      with Next Hop PE1 is withdrawn, GW1 MAY install the route M1/IP1 with
      Next Hop GW2, as specified in <a href="#sect-4.4" class="xref">Section 4.4</a>.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">The example of <a href="#use-case-2" class="xref">Figure 5</a> illustrates how GW1 and
      GW2 can also have local ACs in BD1 and learn local MAC (or MAC/IP)
      addresses from devices connected to the ACs.<a href="#section-5-5" class="pilcrow">¶</a></p>
<span id="name-evpn-interconnect-local-ac"></span><div id="use-case-2">
<figure id="figure-5">
        <div class="alignLeft art-text artwork" id="section-5-6.1">
<pre>         +----EVPN Domain-1---+      +----EVPN Domain-2--+
         |     1:1:EVPN       | GW1  |    1:2:EVPN       |
         |                   +---------+                 |
         |                   | +-----+ |                 |
         |              +--&gt;X| | BD1 | |X&lt;--+            |
        PE1             |    | +-----+ |    |           PE2
     +---------+        |    +---------+    |        +---------+
     | +-----+ |        |     |      |      |        | +-----+ |
M1-----| BD1 | |        |     |      |      +---&gt;    | | BD1 |-----M2
     | +-----+ |        |     |      |      |        | +-----+ |
     +---------+        |     |      |      |        +---------+
         |              |     | GW2  |      |            |
         |          &lt;---+--  +---------+ (RT2)M3/IP3     |
         |       (RT2)M3/IP3 | +-----+ |  {1:3:0}        |
         |        {1:3:0}    | | BD1 | |    |            |
         |                   | +-----+ | ---+            |
         |                   +----|----+                 |
         |                     |  |  |                   |
         +---------------------+  |  +-------------------+
                                  +
                                  M3</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-evpn-interconnect-local-ac" class="selfRef">EVPN Interconnect local AC</a>
        </figcaption></figure>
</div>
<p id="section-5-7">Assuming GW2 learns M3/IP3 via local AC, GW2 advertises a MAC/IP
      Advertisement route for M3/IP3 into each of the EVPN Domains that GW2 is
      connected to. As described in <a href="#sect-4" class="xref">Section 4</a>, GW2 can advertise
      these two MAC/IP Advertisement routes with a configured EVPN Domain-ID
      for local MAC/IPs routes that can be shared with GW1. Consider this EVPN
      Domain-ID is 1:3 and it is configured on both, GW1 and GW2. When GW2
      advertises the route into each EVPN Domain, it adds the D-PATH attribute
      with a domain {1:3:0}. These routes are flagged by GW1 as "looped" since
      1:3 is configured as a local EVPN Domain-ID in GW1. In addition, PE1 and
      PE2 receive the routes with the D-PATH and they have the visibility of
      the origin of the routes, in this case local EVPN Domain Gateway routes.
      This information can be used to influence the best path selection in
      case of multiple routes for M3/IP3 are received on PE1 or PE2 for
      BD1.<a href="#section-5-7" class="pilcrow">¶</a></p>
<p id="section-5-8">As an alternative solution to configuring the same EVPN Domain-ID for
      local routes on both EVPN Domain Gateways, GW2 can be configured with
      EVPN Domain-ID 1:3 for local routes, and GW1 can use a different EVPN
      Domain-ID, e.g., 1:4. In this case, GW2 advertises the route for M3/IP3
      into each EVPN Domain as before, but now GW1 does not flag the route as
      "looped" since 1:3 is not on the list of GW1's local EVPN Domain-IDs.
      GW1 receives the routes from both EVPN Domains, and GW1 selects the
      route from e.g., EVPN Domain-1. GW1 then installs the route in its BT
      and redistributes the route into EVPN Domain-2 with D-PATH {1:1:EVPN,
      1:3:0}. When PE2 receives two routes for M3/IP3, one from GW2 with
      D-PATH {1:3:0} and another from GW1 with D-PATH {1:1:EVPN, 1:3:0}, PE2
      uses best path selection and choose to send its traffic to GW2. Also GW2
      receives the route for M3/IP3 from GW1 and mark it as "looped" since
      that route conveys its own EVPN Domain-IDs 1:1 and 1:3.<a href="#section-5-8" class="pilcrow">¶</a></p>
<p id="section-5-9">In a nutshell, the use of D-PATH in MAC/IP Advertisement routes helps
      prevent loops and influences the best path selection so that PEs choose
      the shortest paths to the destination PEs.<a href="#section-5-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-11">
<section id="section-6">
      <h2 id="name-security-considerations-6">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations-6" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-6-1">Most of the considerations included in <span>[<a href="#I-D.ietf-bess-evpn-ipvpn-interworking" class="xref">I-D.ietf-bess-evpn-ipvpn-interworking</a>]</span> apply to this document.<a href="#section-6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-12">
<section id="section-7">
      <h2 id="name-iana-considerations-6">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations-6" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-7-1">None.<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-13">
<section id="section-8">
      <h2 id="name-acknowledgments-2">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-acknowledgments-2" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-8-1"></p>
</section>
</div>
<div id="sect-14">
<section id="section-9">
      <h2 id="name-contributors-2">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-contributors-2" class="section-name selfRef">Contributors</a>
    </h2>
</section>
</div>
<section id="section-10">
      <h2 id="name-references-4">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references-4" class="section-name selfRef">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references-5">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references-5" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC4271">[RFC4271]</dt>
        <dd>
<span class="refAuthor">Rekhter, Y., Ed.</span>, <span class="refAuthor">Li, T., Ed.</span>, and <span class="refAuthor">S. Hares, Ed.</span>, <span class="refTitle">"A Border Gateway Protocol 4 (BGP-4)"</span>, <span class="seriesInfo">RFC 4271</span>, <span class="seriesInfo">DOI 10.17487/RFC4271</span>, <time datetime="2006-01" class="refDate">January 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4271">https://www.rfc-editor.org/info/rfc4271</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-bess-evpn-ipvpn-interworking">[I-D.ietf-bess-evpn-ipvpn-interworking]</dt>
        <dd>
<span class="refAuthor">Rabadan, J.</span>, <span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Rosen, E.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Lin, W.</span>, <span class="refAuthor">Uttaro, J.</span>, and <span class="refAuthor">A. Simpson</span>, <span class="refTitle">"EVPN Interworking with IPVPN"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-evpn-ipvpn-interworking-06</span>, <time datetime="2021-09-22" class="refDate">22 September 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-bess-evpn-ipvpn-interworking-06.txt">https://www.ietf.org/archive/id/draft-ietf-bess-evpn-ipvpn-interworking-06.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-bess-rfc7432bis">[I-D.ietf-bess-rfc7432bis]</dt>
        <dd>
<span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Burdet, L. A.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">J. Rabadan</span>, <span class="refTitle">"BGP MPLS-Based Ethernet VPN"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-rfc7432bis-03</span>, <time datetime="2022-02-28" class="refDate">28 February 2022</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-bess-rfc7432bis-03.txt">https://www.ietf.org/archive/id/draft-ietf-bess-rfc7432bis-03.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9014">[RFC9014]</dt>
        <dd>
<span class="refAuthor">Rabadan, J., Ed.</span>, <span class="refAuthor">Sathappan, S.</span>, <span class="refAuthor">Henderickx, W.</span>, <span class="refAuthor">Sajassi, A.</span>, and <span class="refAuthor">J. Drake</span>, <span class="refTitle">"Interconnect Solution for Ethernet VPN (EVPN) Overlay Networks"</span>, <span class="seriesInfo">RFC 9014</span>, <span class="seriesInfo">DOI 10.17487/RFC9014</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9014">https://www.rfc-editor.org/info/rfc9014</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8214">[RFC8214]</dt>
      <dd>
<span class="refAuthor">Boutros, S.</span>, <span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Salam, S.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">J. Rabadan</span>, <span class="refTitle">"Virtual Private Wire Service Support in Ethernet VPN"</span>, <span class="seriesInfo">RFC 8214</span>, <span class="seriesInfo">DOI 10.17487/RFC8214</span>, <time datetime="2017-08" class="refDate">August 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8214">https://www.rfc-editor.org/info/rfc8214</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references-4">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references-4" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC9135">[RFC9135]</dt>
      <dd>
<span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Salam, S.</span>, <span class="refAuthor">Thoria, S.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">J. Rabadan</span>, <span class="refTitle">"Integrated Routing and Bridging in Ethernet VPN (EVPN)"</span>, <span class="seriesInfo">RFC 9135</span>, <span class="seriesInfo">DOI 10.17487/RFC9135</span>, <time datetime="2021-10" class="refDate">October 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9135">https://www.rfc-editor.org/info/rfc9135</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses-5">
<a href="#name-authors-addresses-5" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">J. Rabadan (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Nokia</span></div>
<div dir="auto" class="left"><span class="street-address">520 Almanor Avenue</span></div>
<div dir="auto" class="left">
<span class="locality">Sunnyvale</span>, <span class="region">CA</span> <span class="postal-code">94085</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jorge.rabadan@nokia.com" class="email">jorge.rabadan@nokia.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">S. Sathappan</span></div>
<div dir="auto" class="left"><span class="org">Nokia</span></div>
<div dir="auto" class="left"><span class="street-address">520 Almanor Avenue</span></div>
<div dir="auto" class="left">
<span class="locality">Sunnyvale</span>, <span class="region">CA</span> <span class="postal-code">94085</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:senthil.sathappan@nokia.com" class="email">senthil.sathappan@nokia.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">M. Gautam</span></div>
<div dir="auto" class="left"><span class="org">Nokia</span></div>
<div dir="auto" class="left"><span class="street-address">520 Almanor Avenue</span></div>
<div dir="auto" class="left">
<span class="locality">Sunnyvale</span>, <span class="region">CA</span> <span class="postal-code">94085</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mallika.gautam@nokia.com" class="email">mallika.gautam@nokia.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">P. Brissette</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div dir="auto" class="left"><span class="country-name">Canada</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:pbrisset@cisco.com" class="email">pbrisset@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">W. Lin</span></div>
<div dir="auto" class="left"><span class="org">Juniper</span></div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:wlin@juniper.net" class="email">wlin@juniper.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
