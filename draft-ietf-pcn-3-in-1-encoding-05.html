<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Encoding 3 PCN-States in the IP header using a single DSCP</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Changes in This Version (to be removed by RFC Editor)">
<link href="#rfc.section.2" rel="Chapter" title="2 Requirements Language">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Requirements for and Applicability of 3-in-1 PCN Encoding">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 PCN Requirements">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Requirements Imposed by Baseline Encoding">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Applicability of 3-in-1 PCN Encoding">
<link href="#rfc.section.4" rel="Chapter" title="4 Definition of 3-in-1 PCN Encoding">
<link href="#rfc.section.5" rel="Chapter" title="5 Behaviour of a PCN Node Compliant with the 3-in-1 PCN Encoding">
<link href="#rfc.section.6" rel="Chapter" title="6 Backward Compatibility">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Backward Compatibility with Pre-existing PCN Implementations">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Recommendations for the Use of PCN Encoding Schemes">
<link href="#rfc.section.6.2.1" rel="Chapter" title="6.2.1 Use of Both Excess-Traffic-Marking and Threshold-Marking">
<link href="#rfc.section.6.2.2" rel="Chapter" title="6.2.2 Unique Use of Excess-Traffic-Marking">
<link href="#rfc.section.6.2.3" rel="Chapter" title="6.2.3 Unique Use of Threshold-Marking">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Conclusions">
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgements">
<link href="#rfc.section.11" rel="Chapter" title="11 Comments Solicited">
<link href="#rfc.references" rel="Chapter" title="12 References">
<link href="#rfc.references.1" rel="Chapter" title="12.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="12.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Co-existence of ECN and PCN (informative)">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The objective of Pre-Congestion Notification (PCN) is to protect the quality of service (QoS) of inelastic flows within a Diffserv domain.  On every link in the PCN domain, the overall rate of the PCN-traffic is metered, and PCN-packets are appropriately marked when certain configured rates are exceeded. Egress nodes provide decision points with information about the PCN-marks of PCN-packets which allows them to take decisions about whether to admit or block a new flow request, and to terminate some already admitted  flows during serious pre-congestion.  " />
  <meta name="description" content="The objective of Pre-Congestion Notification (PCN) is to protect the quality of service (QoS) of inelastic flows within a Diffserv domain.  On every link in the PCN domain, the overall rate of the PCN-traffic is metered, and PCN-packets are appropriately marked when certain configured rates are exceeded. Egress nodes provide decision points with information about the PCN-marks of PCN-packets which allows them to take decisions about whether to admit or block a new flow request, and to terminate some already admitted  flows during serious pre-congestion.  " />
  <meta name="keywords" content="Quality of Service, QoS, Congestion Control, Congestion Notification, Tunnelling, Encapsulation & Decapsulation, Differentiated Services, Integrated Services, Signalling, Protocol, Flow Admission Control, Flow Termination" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Congestion and Pre-Congestion Notification</td>
<td class="right">B. Briscoe</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">BT</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">T. Moncaster</td>
</tr>
<tr>
<td class="left">Expires: November 22, 2011</td>
<td class="right">Moncaster Internet Consulting</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">M. Menth</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">University of Tuebingen</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">May 21, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Encoding 3 PCN-States in the IP header using a single DSCP<br />
  <span class="filename">draft-ietf-pcn-3-in-1-encoding-05</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The objective of Pre-Congestion Notification (PCN) is to protect the quality of service (QoS) of inelastic flows within a Diffserv domain.  On every link in the PCN domain, the overall rate of the PCN-traffic is metered, and PCN-packets are appropriately marked when certain configured rates are exceeded. Egress nodes provide decision points with information about the PCN-marks of PCN-packets which allows them to take decisions about whether to admit or block a new flow request, and to terminate some already admitted  flows during serious pre-congestion.  </p>
<p>This document specifies how PCN-marks are to be encoded into the IP header by re-using the Explicit Congestion Notification (ECN) codepoints within a PCN-domain.  This encoding builds on the baseline encoding of RFC5696 and provides for three different PCN marking states using a single DSCP: not-marked (NM), threshold-marked (ThM) and excess-traffic-marked (ETM).  Hence, it is called the 3-in-1 PCN encoding.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on November 22, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Changes in This Version (to be removed by RFC Editor)</a>
</li>
<li>2.   <a href="#rfc.section.2">Requirements Language</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Requirements for and Applicability of 3-in-1 PCN Encoding</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">PCN Requirements</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Requirements Imposed by Baseline Encoding</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Applicability of 3-in-1 PCN Encoding</a>
</li>
<li>4.   <a href="#rfc.section.4">Definition of 3-in-1 PCN Encoding</a>
</li>
<li>5.   <a href="#rfc.section.5">Behaviour of a PCN Node Compliant with the 3-in-1 PCN Encoding</a>
</li>
<li>6.   <a href="#rfc.section.6">Backward Compatibility</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Backward Compatibility with Pre-existing PCN Implementations</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Recommendations for the Use of PCN Encoding Schemes</a>
</li>
<li>6.2.1.   <a href="#rfc.section.6.2.1">Use of Both Excess-Traffic-Marking and Threshold-Marking</a>
</li>
<li>6.2.2.   <a href="#rfc.section.6.2.2">Unique Use of Excess-Traffic-Marking</a>
</li>
<li>6.2.3.   <a href="#rfc.section.6.2.3">Unique Use of Threshold-Marking</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Conclusions</a>
</li>
<li>10.   <a href="#rfc.section.10">Acknowledgements</a>
</li>
<li>11.   <a href="#rfc.section.11">Comments Solicited</a>
</li>
<li>12.   <a href="#rfc.references">References</a>
</li>
<li>12.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>12.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Co-existence of ECN and PCN (informative)</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#pcn3in1_Introduction" id="pcn3in1_Introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">The objective of Pre-Congestion Notification (PCN) <a href="#RFC5559">[RFC5559]</a> is to protect the quality of service (QoS) of inelastic flows within a Diffserv domain, in a simple, scalable, and robust fashion. Two mechanisms are used: admission control, to decide whether to admit or block a new flow request, and flow termination to terminate some existing flows during serious pre-congestion. To achieve this, the overall rate of PCN-traffic is metered on every link in the domain, and PCN-packets are appropriately marked when certain configured rates are exceeded. These configured rates are below the rate of the link thus providing notification to boundary nodes about overloads before any real congestion occurs (hence "pre-congestion notification").  </p>
<p><a href="#RFC5670">[RFC5670]</a> provides for two metering and marking functions that are configured with reference rates. Threshold-marking marks all PCN packets once their traffic rate on a link exceeds  the configured reference rate (PCN-threshold-rate). Excess-traffic-marking marks only those PCN packets that exceed the configured reference rate (PCN-excess-rate). The PCN-excess-rate is typically larger than the PCN-threshold-rate <a href="#RFC5559">[RFC5559]</a>. Egress nodes monitor the PCN-marks of received PCN-packets and provide information about the PCN-marks to decision points which take decisions about flow admission and termination on this basis <a href="#I-D.ietf-pcn-cl-edge-behaviour">[I-D.ietf-pcn-cl-edge-behaviour]</a>, <a href="#I-D.ietf-pcn-sm-edge-behaviour">[I-D.ietf-pcn-sm-edge-behaviour]</a>.  </p>
<p id="rfc.section.1.p.3">The baseline encoding defined in <a href="#RFC5696">[RFC5696]</a> describes how two PCN marking states (Not-marked and PCN-Marked) can be encoded using a single Diffserv codepoint. It also provides an experimental codepoint (EXP), along with guidelines for use of that codepoint.  To support the application of two different marking algorithms in a PCN-domain, for example as required in <a href="#I-D.ietf-pcn-cl-edge-behaviour">[I-D.ietf-pcn-cl-edge-behaviour]</a>, three PCN marking states are needed. This document describes an extension to the baseline encoding that uses the EXP codepoint to provide a third PCN marking state in the IP header, still using a single Diffserv codepoint. This encoding scheme is called "3-in-1 PCN encoding".  </p>
<p id="rfc.section.1.p.4">This document only concerns the PCN wire protocol encoding for all IP headers, whether IPv4 or IPv6. It makes no changes or recommendations concerning algorithms for congestion marking or congestion response. Other documents define the PCN wire protocol for other header types. For example, the MPLS encoding is defined in <a href="#RFC5129">[RFC5129]</a> and Appendix A of that document provides an informative example for a mapping between the encodings in IP and in MPLS.  </p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#pcn3in1_Changes" id="pcn3in1_Changes">Changes in This Version (to be removed by RFC Editor)</a>
</h1>
<p></p>

<dl>
<dt>From draft-ietf-pcn-3-in-1-encoding-04 to -05:</dt>
<dd style="margin-left: 8"><ul>
<li>Draft moved to standards track as per working group discussions.</li>
<li>Added <a href="#pcn3in1_Appendix">Appendix Appendix A</a> discussing ECN handling in the PCN-domain.</li>
<li>Clarified that this document modifies <a href="#RFC5696">[RFC5696]</a>.</li>
<li>.......</li>
</ul></dd>
<dt>From draft-ietf-pcn-3-in-1-encoding-03 to -04:</dt>
<dd style="margin-left: 8">
<ul>
<li>Updated document to reflect RFC6040.</li>
<li>Re-wrote introduction.</li>
<li>Re-wrote section on applicability.</li>
<li>Re-wrote section on choosing encoding scheme.</li>
<li>Updated author details.</li>
</ul>
<p> </p>
</dd>
<dt>From draft-ietf-pcn-3-in-1-encoding-02 to -03:</dt>
<dd style="margin-left: 8">
<ul>
<li>Corrected mistakes in introduction and improved overall readability.</li>
<li>Added new terminology.</li>
<li>Rewrote a good part of Section 4 and 5 to achieve more clarity.</li>
<li>Added appendix explaining when to use which encoding scheme and how to encode them in MPLS shim headers.</li>
<li>Added new co-author.</li>
</ul>
<p> </p>
</dd>
<dt>From draft-ietf-pcn-3-in-1-encoding-01 to -02:</dt>
<dd style="margin-left: 8"><ul>
<li>Corrected mistake in introduction, which wrongly stated that the threshold-traffic rate is higher than the excess-traffic rate. Other minor corrections.</li>
<li>Updated acks &amp; refs.</li>
</ul></dd>
<dt>From draft-ietf-pcn-3-in-1-encoding-00 to -01:</dt>
<dd style="margin-left: 8"><ul>
<li>Altered the wording to make sense if draft-ietf-tsvwg-ecn-tunnel moves to proposed standard.</li>
<li>References updated</li>
</ul></dd>
<dt>From draft-briscoe-pcn-3-in-1-encoding-00 to draft-ietf-pcn-3-in-1-encoding-00:</dt>
<dd style="margin-left: 8"><ul>
<li>Filename changed to draft-ietf-pcn-3-in-1-encoding.</li>
<li>Introduction altered to include new template description of PCN.</li>
<li>References updated.</li>
<li>Terminology brought into line with <a href="#RFC5670">[RFC5670]</a>.</li>
<li>Minor corrections.</li>
</ul></dd>
</dl>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#pcn3in1_Reqs_Lang" id="pcn3in1_Reqs_Lang">Requirements Language</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.  </p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#pcn3in1_Terminology" id="pcn3in1_Terminology">Terminology</a>
</h1>
<p id="rfc.section.2.1.p.1">General PCN-related terminology is defined in the PCN architecture <a href="#RFC5559">[RFC5559]</a>, and terminology specific to packet encoding is defined in the PCN baseline encoding [RFC5696]. Additional terminology is defined below.  </p>
<p></p>

<dl>
<dt>PCN encoding:</dt>
<dd style="margin-left: 8">mapping of PCN marking states to specific codepoints in the packet header.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#pcn3in1_Requirement_head" id="pcn3in1_Requirement_head">Requirements for and Applicability of 3-in-1 PCN Encoding</a>
</h1>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#pcn3in1_Requirement" id="pcn3in1_Requirement">PCN Requirements</a>
</h1>
<p id="rfc.section.3.1.p.1">In accordance with the PCN architecture <a href="#RFC5559">[RFC5559]</a>, PCN-ingress-nodes control packets entering a PCN-domain. Packets belonging to PCN-controlled flows are subject to PCN-metering and -marking, and PCN-ingress-nodes mark them as Not-marked (PCN-colouring). Any node in the PCN-domain may perform PCN-metering and -marking and mark PCN-packets if needed.  There are two different metering and marking schemes: threshold-marking and excess-traffic-marking <a href="#RFC5670">[RFC5670]</a>. Some edge behaviors require only a single marking scheme <a href="#I-D.ietf-pcn-sm-edge-behaviour">[I-D.ietf-pcn-sm-edge-behaviour]</a>, others require both <a href="#I-D.ietf-pcn-cl-edge-behaviour">[I-D.ietf-pcn-cl-edge-behaviour]</a>. In the latter case, three PCN marking states are needed: not-marked (NM) to indicate not-marked packets, threshold-marked (ThM) to indicate packets marked by the threshold-marker, and excess-traffic-marked (ETM) to indicate packets marked by the excess-traffic-marker <a href="#RFC5670">[RFC5670]</a>.  Threshold-marking and excess-traffic-marking are configured to start marking packets at different load conditions, so one marking scheme indicates more severe pre-congestion than the other. Therefore, a fourth PCN marking state indicating that a packet is marked by both markers is not needed. However a fourth codepoint is required to indicate packets that are not PCN-capable (the not-PCN codepoint).  </p>
<p id="rfc.section.3.1.p.2">In all current PCN edge behaviors that use two marking schemes <a href="#RFC5559">[RFC5559]</a>, <a href="#I-D.ietf-pcn-cl-edge-behaviour">[I-D.ietf-pcn-cl-edge-behaviour]</a>, excess-traffic-marking is configured with a larger reference rate than threshold-marking. We take this as a rule and define excess-traffic-marked as a more severe PCN-mark than threshold-marked.  </p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#pcn3in1_Requirements_Baseline_Encoding" id="pcn3in1_Requirements_Baseline_Encoding">Requirements Imposed by Baseline Encoding</a>
</h1>
<p id="rfc.section.3.2.p.1">The baseline encoding scheme <a href="#RFC5696">[RFC5696]</a> was defined so that it could be extended to accommodate an additional marking state. It provides rules to embed the encoding of two PCN states in the IP header.  <a href="#pcn3in1_Fig_DS_IP">Figure 1</a> shows the structure of the former type-of-service field.  It contains the 6-bit Differentiated Services (DS) field that holds the DS codepoint (DSCP) <a href="#RFC2474">[RFC2474]</a> and the 2-bit ECN field <a href="#RFC3168">[RFC3168]</a>.  </p>
<div id="#rfc.figure.1"></div>
<div id="#pcn3in1_Fig_DS_IP"></div>
<pre>
         0     1     2     3     4     5     6     7
      +-----+-----+-----+-----+-----+-----+-----+-----+
      |              DS FIELD             | ECN FIELD |
      +-----+-----+-----+-----+-----+-----+-----+-----+
</pre>
<p id="rfc.section.3.2.p.2">Baseline encoding defines that the DSCP must be set to a PCN-compatible DSCP n and the ECN-field <a href="#RFC3168">[RFC3168]</a> indicates the specific PCN-mark.  Baseline encoding offers four possible encoding states within a single DSCP with the following restrictions.  </p>

<ul>
<li>Codepoint `00&#180; (not-ECT) is used to indicate non-PCN traffic as "not-PCN".  This allows  both PCN and non-PCN traffic to use the same DSCP.</li>
<li>Codepoint `10&#180; (ECT(0)) is used to indicate Not-marked PCN traffic.</li>
<li>Codepoint `11&#180; (CE) is used to indicate the most severe PCN-mark.</li>
<li>Codepoint `01&#180; (ECT(1)) is available for experimental use and may be re-used by other PCN encodings such as the presently defined 3-in-1 PCN encoding (subject to the rules defined in <a href="#RFC5696">[RFC5696]</a>).</li>
</ul>

<p> </p>
<p><a href="#RFC6040">[RFC6040]</a> defines rules for the encapsulation and decapsulation of ECN markings within IP-in-IP tunnels. This RFC removes some of the constraints that existed when <a href="#RFC5696">[RFC5696]</a> was written. Happily the rules for use of the EXP codepoint are fully compatible with <a href="#RFC6040">[RFC6040]</a>. In particular, the relative severity of each marking is the same: CE (PM) is more severe than ECT(1) (EXP) is more severe than ECT(0) (NM). This is discussed in more detail in both the baseline encoding document <a href="#RFC5696">[RFC5696]</a> and in <a href="#I-D.ietf-pcn-encoding-comparison">[I-D.ietf-pcn-encoding-comparison]</a>.  </p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#pcn3in1_Requirements_Applicability" id="pcn3in1_Requirements_Applicability">Applicability of 3-in-1 PCN Encoding</a>
</h1>
<p id="rfc.section.3.3.p.1">The 3-in-1 encoding is applicable in situations where two marking schemes are being used in the PCN-domain.  In some circumstances it can also be used in PCN-domains with only a single marking scheme in use. Further guidance on choosing an encoding scheme can be found in <a href="#pcn3in1_Recommendation_PCN_Encoding_Schemes">Section 6.2</a>.  All nodes within the PCN-domain MUST be fully compliant with the ECN encapsulation rules set out in <a href="#RFC6040">[RFC6040]</a>. As such the encoding is not applicable in situations where legacy tunnels might exist.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#pcn3in1_Encoding" id="pcn3in1_Encoding">Definition of 3-in-1 PCN Encoding</a>
</h1>
<p id="rfc.section.4.p.1">The 3-in-1 PCN encoding scheme is an extension of  the baseline encoding scheme defined in <a href="#RFC5696">[RFC5696]</a>. The PCN requirements and the extension rules for baseline encoding presented in the previous section determine how PCN encoding states are carried in the IP headers. This is shown in <a href="#pcn3in1_Fig_Encoding">Figure 2</a>.  </p>
<div id="#rfc.figure.2"></div>
<div id="#pcn3in1_Fig_Encoding"></div>
<pre>
      +--------+----------------------------------------------------+
      |        |           Codepoint in ECN field of IP header      |
      |  DSCP  |               &lt;RFC3168 codepoint name&gt;             |
      |        +--------------+-------------+-------------+---------+
      |        | 00 &lt;Not-ECT&gt; | 10 &lt;ECT(0)&gt; | 01 &lt;ECT(1)&gt; | 11 &lt;CE&gt; |
      +--------+--------------+-------------+-------------+---------+
      | DSCP n |    Not-PCN   |      NM     |     ThM     |   ETM   |
      +--------+--------------+-------------+-------------+---------+
</pre>
<p id="rfc.section.4.p.2">Like baseline encoding, 3-in-1 PCN encoding also uses a PCN compatible DSCP n and the ECN field for the encoding of PCN-marks. The PCN-marks have the following meaning.  </p>

<dl>
<dt>Not-PCN:</dt>
<dd style="margin-left: 8">indicates a non-PCN-packet, i.e., a packet that is not subject to PCN metering and marking.</dd>
<dt>NM:</dt>
<dd style="margin-left: 8">Not-marked.  Indicates a PCN-packet that has not yet been marked by any PCN marker.</dd>
<dt>ThM:</dt>
<dd style="margin-left: 8">Threshold-marked.  Indicates a PCN-packet that has been marked by a threshold-marker <a href="#RFC5670">[RFC5670]</a>.</dd>
<dt>ETM:</dt>
<dd style="margin-left: 8">Excess-traffic-marked.  Indicates a PCN-packet that has been marked by an excess-traffic-marker <a href="#RFC5670">[RFC5670]</a>.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#pcn3in1_Compliant_Node_Behaviour" id="pcn3in1_Compliant_Node_Behaviour">Behaviour of a PCN Node Compliant with the 3-in-1 PCN Encoding</a>
</h1>
<p id="rfc.section.5.p.1">To be compliant with the 3-in-1 PCN Encoding, an PCN interior node behaves as follows: </p>

<ul>
<li>It MUST change NM to ThM if the threshold-meter function indicates a need to mark the packet;</li>
<li>It MUST change NM or ThM to ETM if the excess-traffic-meter function indicates a need to mark the packet;</li>
<li>It MUST NOT change not-PCN to NM, ThM, or ETM;</li>
<li>It MUST NOT change a NM, ThM, or ETM to not-PCN;</li>
<li>It MUST NOT change ThM to NM;</li>
<li>It MUST NOT change ETM to ThM or to NM;</li>
</ul>

<p> </p>
<p id="rfc.section.5.p.2">In other words, a PCN interior node MUST NOT mark PCN-packets into non-PCN packets and vice-versa, and it may increase the severity of the PCN-mark of a PCN-packet, but it MUST NOT decrease it.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#pcn3in1_Backward_Compatibility" id="pcn3in1_Backward_Compatibility">Backward Compatibility</a>
</h1>
<p id="rfc.section.6.p.1">Discussion of backward compatibility between PCN encoding schemes and previous uses of the ECN field is given in Section 6 of <a href="#RFC5696">[RFC5696]</a>.  </p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#pcn3in1_Backward_Compatibility_pre-PCN" id="pcn3in1_Backward_Compatibility_pre-PCN">Backward Compatibility with Pre-existing PCN Implementations</a>
</h1>
<p id="rfc.section.6.1.p.1">This encoding complies with the rules for extending the baseline PCN encoding schemes in Section 5 of <a href="#RFC5696">[RFC5696]</a>.  </p>
<p id="rfc.section.6.1.p.2">The term "compatibility" is meant in the following sense. It is possible to operate nodes with baseline encoding <a href="#RFC5696">[RFC5696]</a> and 3-in-1 encoding in the same PCN domain. The nodes with baseline encoding MUST perform excess-traffic-marking because the 11 codepoint of 3-in-1 encoding also means excess-traffic-marked.  PCN-boundary-nodes of such domains are required to interpret the full 3-in-1 encoding and not just baseline encoding, otherwise they cannot interpret the 01 codepoint.  </p>
<p id="rfc.section.6.1.p.3">Using nodes that perform only excess-traffic-marking may make sense in networks using the CL edge behavior <a href="#I-D.ietf-pcn-cl-edge-behaviour">[I-D.ietf-pcn-cl-edge-behaviour]</a>. Such nodes are able to notify the egress only about severe pre-congestion when traffic needs to be terminated. This seems reasonable for locations that are not expected to see any pre-congestion, but excess-traffic-marking gives them a means to terminate traffic if unexpected overload occurs.  </p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#pcn3in1_Recommendation_PCN_Encoding_Schemes" id="pcn3in1_Recommendation_PCN_Encoding_Schemes">Recommendations for the Use of PCN Encoding Schemes</a>
</h1>
<p id="rfc.section.6.2.p.1">NOTE: This sub-section is informative not normative.</p>
<p id="rfc.section.6.2.p.2">When deciding which PCN encoding is suitable an operator needs to take account of how many PCN states need to be encoded. The following table gives guidelines on which encoding to use with either threshold-marking, excess-traffic marking or both.</p>
<div id="#rfc.figure.3"></div>
<div id="#pcn3in1_Fig_Encoding_Schemes"></div>
<pre>      
      +------------------------+--------------------------------+
      | Marking schemes in use |  Recommended encoding scheme   |
      +------------------------+--------------------------------+
      | Only threshold-marking |   Baseline encoding [RFC5696]  |
      +------------------------+--------------------------------+
      | Only excess-traffic-   |   Baseline encoding [RFC5696]  |
      |       marking          |     or 3-in-1 PCN encoding     |
      +------------------------+--------------------------------+
      | Threshold-marking and  |     3-in-1 PCN encoding        |
      | excess-traffic-marking |                                |
      +------------------------+--------------------------------+
</pre>
<h1 id="rfc.section.6.2.1">
<a href="#rfc.section.6.2.1">6.2.1.</a> <a href="#pcn3in1_Recommendation_PCN_Encoding_Schemes_ETM_TM" id="pcn3in1_Recommendation_PCN_Encoding_Schemes_ETM_TM">Use of Both Excess-Traffic-Marking and Threshold-Marking</a>
</h1>
<p id="rfc.section.6.2.1.p.1">If both excess-traffic-marking and threshold-marking are enabled in a PCN-domain, 3-in-1 encoding should be used as described in this document.  </p>
<h1 id="rfc.section.6.2.2">
<a href="#rfc.section.6.2.2">6.2.2.</a> <a href="#pcn3in1_Recommendation_PCN_Encoding_Schemes_ETM" id="pcn3in1_Recommendation_PCN_Encoding_Schemes_ETM">Unique Use of Excess-Traffic-Marking</a>
</h1>
<p id="rfc.section.6.2.2.p.1">If only excess-traffic-marking is enabled in a PCN-domain, baseline encoding or 3-in-1 encoding may be used. They lead to the same encoding because PCN-boundary nodes will interpret baseline "PCN-marked (PM)" as "excess-traffic-marked (ETM)".  </p>
<h1 id="rfc.section.6.2.3">
<a href="#rfc.section.6.2.3">6.2.3.</a> <a href="#pcn3in1_Recommendation_PCN_Encoding_Schemes_TM" id="pcn3in1_Recommendation_PCN_Encoding_Schemes_TM">Unique Use of Threshold-Marking</a>
</h1>
<p id="rfc.section.6.2.3.p.1">No scheme is currently proposed that solely uses threshold-marking. If such a scheme is proposed, the choice of encoding scheme will depend on whether nodes are compliant with <a href="#RFC6040">[RFC6040]</a> or not. Where it is certain that all nodes in the PCN-domain are compliant then either 3-in-1 encoding or baseline encoding are suitable. If legacy tunnel decapsulators exist within the PCN-domain then baseline encoding SHOULD be used.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#pcn3in1_IANA" id="pcn3in1_IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.7.p.1">This memo includes no request to IANA.</p>
<p id="rfc.section.7.p.2">Note to RFC Editor: this section may be removed on publication as an RFC.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#pcn3in1_Sec_Consider" id="pcn3in1_Sec_Consider">Security Considerations</a>
</h1>
<p id="rfc.section.8.p.1">The security concerns relating to this extended PCN encoding are the same as those in <a href="#RFC5696">[RFC5696]</a>. In summary, PCN-boundary nodes are responsible for ensuring inappropriate PCN markings do not leak into or out of a PCN domain, and the current phase of the PCN architecture assumes that all the nodes of a PCN-domain are entirely under the control of a single operator, or a set of operators who trust each other.  </p>
<p id="rfc.section.8.p.2">Given the only difference between the baseline encoding and the present 3-in-1 encoding is the use of the 01 codepoint, no new security issues are raised, as this codepoint was already available for experimental use in the baseline encoding.  </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#pcn3in1_Conclusions" id="pcn3in1_Conclusions">Conclusions</a>
</h1>
<p id="rfc.section.9.p.1">The 3-in-1 PCN encoding uses a PCN-compatible DSCP and the ECN field to encode PCN-marks. One codepoint allows non-PCN traffic to be carried with the same PCN-compatible DSCP and three other codepoints support three PCN marking states with different levels of severity.  The use of this PCN encoding scheme presupposes that any tunnels in the PCN region have been updated to comply with <a href="#RFC6040">[RFC6040]</a>.  </p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#pcn3in1_Acknowledgements" id="pcn3in1_Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.10.p.1">Thanks to Phil Eardley, Teco Boot, Kwok Ho Chan and Georgios Karaginannis for reviewing this document.  </p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#pcn3in1_Comments_Solicited" id="pcn3in1_Comments_Solicited">Comments Solicited</a>
</h1>
<p id="rfc.section.11.p.1">To be removed by RFC Editor: Comments and questions are encouraged and very welcome. They can be addressed to the IETF Congestion and Pre-Congestion working group mailing list &lt;pcn@ietf.org&gt;, and/or to the authors.</p>
<h1 id="rfc.references">
<a href="#rfc.references">12.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">12.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2474">[RFC2474]</b></td>
<td class="top">
<a href="mailto:kmn@cisco.com" title="Cisco Systems">Nichols, K.</a>, <a href="mailto:slblake@torrentnet.com" title="Torrent Networking Technologies">Blake, S.</a>, <a href="mailto:fred@cisco.com" title="Cisco Systems">Baker, F.</a> and <a href="mailto:black_david@emc.com" title="EMC Corporation">D.L. Black</a>, "<a href="http://tools.ietf.org/html/rfc2474">Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers</a>", RFC 2474, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3168">[RFC3168]</b></td>
<td class="top">
<a>Ramakrishnan, K.</a>, <a>Floyd, S.</a> and <a>D. Black</a>, "<a href="http://tools.ietf.org/html/rfc3168">The Addition of Explicit Congestion Notification (ECN) to IP</a>", RFC 3168, September 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3540">[RFC3540]</b></td>
<td class="top">
<a>Spring, N.</a>, <a>Wetherall, D.</a> and <a>D. Ely</a>, "<a href="http://tools.ietf.org/html/rfc3540">Robust Explicit Congestion Notification (ECN) Signaling with Nonces</a>", RFC 3540, June 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4301">[RFC4301]</b></td>
<td class="top">
<a>Kent, S.</a> and <a>K. Seo</a>, "<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>", RFC 4301, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4594">[RFC4594]</b></td>
<td class="top">
<a>Babiarz, J.</a>, <a>Chan, K.</a> and <a>F. Baker</a>, "<a href="http://tools.ietf.org/html/rfc4594">Configuration Guidelines for DiffServ Service Classes</a>", RFC 4594, August 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5129">[RFC5129]</b></td>
<td class="top">
<a>Davie, B.</a>, <a>Briscoe, B.</a> and <a>J. Tay</a>, "<a href="http://tools.ietf.org/html/rfc5129">Explicit Congestion Marking in MPLS</a>", RFC 5129, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5559">[RFC5559]</b></td>
<td class="top">
<a>Eardley, P.</a>, "<a href="http://tools.ietf.org/html/rfc5559">Pre-Congestion Notification (PCN) Architecture</a>", RFC 5559, June 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5670">[RFC5670]</b></td>
<td class="top">
<a>Eardley, P.</a>, "<a href="http://tools.ietf.org/html/rfc5670">Metering and Marking Behaviour of PCN-Nodes</a>", RFC 5670, November 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5865">[RFC5865]</b></td>
<td class="top">
<a>Baker, F.</a>, <a>Polk, J.</a> and <a>M. Dolly</a>, "<a href="http://tools.ietf.org/html/rfc5865">A Differentiated Services Code Point (DSCP) for Capacity-Admitted Traffic</a>", RFC 5865, May 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5696">[RFC5696]</b></td>
<td class="top">
<a>Moncaster, T.</a>, <a>Briscoe, B.</a> and <a>M. Menth</a>, "<a href="http://tools.ietf.org/html/rfc5696">Baseline Encoding and Transport of Pre-Congestion Information</a>", RFC 5696, November 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6040">[RFC6040]</b></td>
<td class="top">
<a>Briscoe, B.</a>, "<a href="http://tools.ietf.org/html/rfc6040">Tunnelling of Explicit Congestion Notification</a>", RFC 6040, November 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">12.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-pcn-cl-edge-behaviour">[I-D.ietf-pcn-cl-edge-behaviour]</b></td>
<td class="top">
<a>Charny, A</a>, <a>Huang, F</a>, <a>Karagiannis, G</a>, <a>Menth, M</a> and <a>T Taylor</a>, "<a href="http://tools.ietf.org/html/draft-ietf-pcn-cl-edge-behaviour-10">PCN Boundary Node Behaviour for the Controlled Load (CL) Mode of Operation</a>", Internet-Draft draft-ietf-pcn-cl-edge-behaviour-10, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-pcn-sm-edge-behaviour">[I-D.ietf-pcn-sm-edge-behaviour]</b></td>
<td class="top">
<a>Charny, A</a>, <a>Karagiannis, G</a>, <a>Menth, M</a> and <a>T Taylor</a>, "<a href="http://tools.ietf.org/html/draft-ietf-pcn-sm-edge-behaviour-06">PCN Boundary Node Behaviour for the Single Marking (SM) Mode of Operation</a>", Internet-Draft draft-ietf-pcn-sm-edge-behaviour-06, June 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-pcn-encoding-comparison">[I-D.ietf-pcn-encoding-comparison]</b></td>
<td class="top">
<a>Karagiannis, G</a>, <a>Chan, K</a>, <a>Moncaster, T</a>, <a>Menth, M</a>, <a>Eardley, P</a> and <a>B Briscoe</a>, "<a href="http://tools.ietf.org/html/draft-ietf-pcn-encoding-comparison-06">Overview of Pre-Congestion Notification Encoding</a>", Internet-Draft draft-ietf-pcn-encoding-comparison-06, June 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#pcn3in1_Appendix" id="pcn3in1_Appendix">Co-existence of ECN and PCN (informative)</a>
</h1>
<p id="rfc.section.Appendix A.p.1">The PCN encoding described in this document re-uses the bits of the ECN field in the IP header. Consequently, this disables ECN within the PCN domain.  Appendix B of <a href="#RFC5696">[RFC5696]</a> included advice on handling ECN traffic within a PCN-domain. This appendix clarifies that advice.</p>
<p id="rfc.section.Appendix A.p.2">For the purposes of this appendix we define two forms of traffic that might arrive at a PCN-ingress node. These are Admission-controlled traffic and Non-admission-controlled traffic.</p>
<p id="rfc.section.Appendix A.p.3">Admission-controlled traffic will be remarked to the PCN-compatible DSCP by the PCN-ingress node. Two mechanisms can be used to identify such traffic: </p>

<ol style="list-style-type: lower-alpha">
<li>flow signalling associates a filterspec with a need for admission control (e.g. through RSVP or some equivalent message down from a SIP server to the ingress), and the PCN-ingress remarks traffic matching that filterspec to a PCN-compatible DSCP, as its chosen admission control mechanism.</li>
<li>Traffic arrives with a DSCP that implies it requires admission control such as VOICE-ADMIT <a href="#RFC5865">[RFC5865]</a> or Interactive Real-Time, Broadcast TV when used for video on demand, and Multimedia Conferencing <a href="#RFC4594">[RFC4594]</a><a href="#RFC5865">[RFC5865]</a>.</li>
</ol>

<p> </p>
<p id="rfc.section.Appendix A.p.4">All other traffic can be thought of as Non-admission-controlled. However such traffic may still need to share the same DSCP as the Admission-controlled traffic. This may be due to policy (for instance if it is high priority voice traffic), or may be because there is a shortage of local DSCPs.</p>
<p id="rfc.section.Appendix A.p.5">ECN <a href="#RFC3168">[RFC3168]</a> is an end-to-end congestion notification mechanism. As such it is possible that some traffic entering the PCN-domain may also be ECN capable The following lists the four cases for how e2e ECN traffic may wish to be treated while crossing a PCN domain: </p>

<dl>
<dt>ECN capable traffic that does not require admission control and does     not carry a DSCP that the PCN-ingress is using for PCN-capable traffic.</dt>
<dd style="margin-left: 8">This requires no action.</dd>
<dt>ECN capable traffic that does not require admission control but carries a DSCP that the     PCN-ingress is using for PCN-capable traffic.</dt>
<dd style="margin-left: 8">There are two options.</dd>
<dt></dt>
<dd style="margin-left: 8">
<ul>
<li>The ingress maps the DSCP to a local DSCP with the same scheduling PHB as the original DSCP, and the egress re-maps it to the original PCN-compatible DSCP.</li>
<li>The ingress tunnels the traffic, setting not-PCN in the outer header; note that this turns off ECN  for this traffic within the PCN domain.</li>
</ul>
<p> The first option is recommended unless the operator is short of local DSCPs.  </p>
</dd>
<dt>ECN-capable Admission-controlled traffic:</dt>
<dd style="margin-left: 8">There are two options.</dd>
<dt></dt>
<dd style="margin-left: 8">
<ul>
<li>The PCN-ingress places this traffic in a tunnel with a PCN-compatible DSCP in the outer header. The PCN-egress zeroes the ECN-field before decapsulation.</li>
<li>The PCN-ingress drops CE-marked packets and the PCN-egress zeros the ECN field of all PCN packets.</li>
</ul>
<p> The second option is not recommended unless tunnelling is not possible for some reason..  </p>
</dd>
<dt>ECN-capable Admission-controlled where the e2e transport somehow indicates that it wants to see PCN marks:</dt>
<dd style="margin-left: 8">NOTE this is currently experimental only.</dd>
<dt></dt>
<dd style="margin-left: 8">Schemes have been suggested where PCN marks may be leaked out of the PCN-domain and used by the end hosts to modify realtime data rates. Currently all such schemes are experimental and the following is for guidance only.</dd>
<dt></dt>
<dd style="margin-left: 8">The PCN-ingress needs to tunnel the traffic using <a href="#RFC6040">[RFC6040]</a>.  The PCN-egress should not zero the ECN field, and the tunnel egress should use <a href="#RFC6040">[RFC6040]</a> normal mode (preserving any PCN-marking). Note that this may turn ECT(0) into ECT(1) and so is not compatible with the experimental ECN nonce <a href="#RFC3540">[RFC3540]</a>.  </dd>
</dl>

<p> </p>
<div id="#rfc.figure.4"></div>
<div id="#pcn3in1_Fig_Tunnel"></div>
<pre>

               ,  .  .  .  .  .  PCN-domain  .  .  .  .  .  .
              .   ,--------.                   ,--------.    .
             .   _|  PCN-   |___________________|  PCN-  |_   .
             .  / | ingress |                   | egress | \  .
              .|  '---------'                   '--------'  |.
               | .  .  .  .  .  .  .  .  .  .  .  .  .  .  .|
          ,--------.                                     ,--------.     
    _____| Tunnel  |                                     | Tunnel |____
         | Ingress | - - ECN preserved inside tunnel - - | Egress |
         '---------'                                     '--------'  
  
</pre>
<p id="rfc.section.Appendix A.p.6">In the list above any form of IP-in-IP tunnel can be used unless specified otherwise.  NB, We assume a logical separation of tunneling and PCN actions in both PCN-ingress and PCN-egress nodes. That is, any tunneling action happens wholly outside the PCN-domain as illustrated in the following figure: </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Bob Briscoe</span> 
	  <span class="n hidden">
		<span class="family-name">Briscoe</span>
	  </span>
	</span>
	<span class="org vcardline">BT</span>
	<span class="adr">
	  <span>B54/77, Adastral Park</span>
<span>Martlesham Heath</span>

	  <span class="vcardline">
		<span class="locality">Ipswich</span>,  
		<span class="region"></span>
		<span class="code">IP5 3RE</span>
	  </span>
	  <span class="country-name vcardline">UK</span>
	</span>
	<span class="vcardline">Phone: +44 1473 645196</span>

<span class="vcardline">EMail: <a href="mailto:bob.briscoe@bt.com">bob.briscoe@bt.com</a></span>

<span class="vcardline">URI: <a href="http://bobbriscoe.net/">http://bobbriscoe.net/</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Toby Moncaster</span> 
	  <span class="n hidden">
		<span class="family-name">Moncaster</span>
	  </span>
	</span>
	<span class="org vcardline">Moncaster Internet Consulting</span>
	<span class="adr">
	  <span>Dukes</span>
<span>Layer Marney</span>

	  <span class="vcardline">
		<span class="locality">Colchester</span>,  
		<span class="region"></span>
		<span class="code">CO5 9UZ</span>
	  </span>
	  <span class="country-name vcardline">UK</span>
	</span>
	<span class="vcardline">Phone: +44 7764 185416</span>

<span class="vcardline">EMail: <a href="mailto:toby@moncaster.com">toby@moncaster.com</a></span>

<span class="vcardline">URI: <a href="http://www.moncaster.com/">http://www.moncaster.com/</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Michael Menth</span> 
	  <span class="n hidden">
		<span class="family-name">Menth</span>
	  </span>
	</span>
	<span class="org vcardline">University of Tuebingen</span>
	<span class="adr">
	  <span>Sand 13</span>

	  <span class="vcardline">
		<span class="locality">Tuebingen</span>,  
		<span class="region"></span>
		<span class="code">72076</span>
	  </span>
	  <span class="country-name vcardline">Germany</span>
	</span>
	<span class="vcardline">Phone: +49 7071 2970505</span>

<span class="vcardline">EMail: <a href="mailto:menth@informatik.uni-tuebingen.de">menth@informatik.uni-tuebingen.de</a></span>

  </address>
</div>

</body>
</html>