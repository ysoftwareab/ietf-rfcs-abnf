<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Integration of Header Compression over IPsec Security Associations</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Integration of Header Compression over IPsec Security Associations">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">E. Ertekin</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">C. Christou</td></tr>
<tr><td class="header">Expires: April 29, 2007</td><td class="header">R. Jasani</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Booz Allen Hamilton</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 26, 2006</td></tr>
</table></td></tr></table>
<h1><br />Integration of Header Compression over IPsec Security Associations<br />draft-ietf-rohc-hcoipsec-03</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 29, 2007.</p>

<h3>Abstract</h3>

<p>IP Security (IPsec) [IPSEC] provides various security services for IP traffic.  However, the benefits of IPsec come at the cost of increased overhead.  This document outlines a framework for integrating Header Compression (HC) over IPsec (HCoIPsec).  By compressing the inner headers of IP packets, HCoIPsec proposes to reduce the amount of overhead associated with the transmission of traffic over IPsec Security Associations (SAs).
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Audience<br />
<a href="#anchor3">3.</a>&nbsp;
Terminology<br />
<a href="#anchor4">4.</a>&nbsp;
Problem Statement: IPsec Packet Overhead<br />
<a href="#anchor5">5.</a>&nbsp;
Overview of the HCoIPsec Framework<br />
<a href="#anchor6">5.1.</a>&nbsp;
HCoIPsec Assumptions<br />
<a href="#anchor7">5.2.</a>&nbsp;
HCoIPsec Summary<br />
<a href="#anchor8">6.</a>&nbsp;
Details of the HCoIPsec Framework<br />
<a href="#anchor9">6.1.</a>&nbsp;
HC and IPsec Integration<br />
<a href="#anchor10">6.1.1.</a>&nbsp;
Header Compression Protocol Considerations<br />
<a href="#anchor11">6.1.2.</a>&nbsp;
Initialization and Negotiation of HC Channel<br />
<a href="#anchor12">6.1.3.</a>&nbsp;
Encapsulation and Identification of Header Compressed Packets<br />
<a href="#anchor13">6.2.</a>&nbsp;
HCoIPsec Framework Summary<br />
<a href="#anchor14">7.</a>&nbsp;
Security Considerations<br />
<a href="#anchor15">8.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor16">9.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>This document outlines a framework for integrating HC over IPsec (HCoIPsec).  The goal of HCoIPsec is to reduce the protocol overhead  associated with packets traversing between IPsec SA endpoints.  This can be achieved by compressing the transport layer header (e.g., UDP, TCP, etc.) and inner IP header of packets at the ingress of the IPsec tunnel, and decompressing these headers at the egress.
</p>
<p>For HCoIPsec, this document assumes traditional HC protocols, Internet Protocol Header Compression [IPHC], Compressed Real Time Protocol [CRTP], Enhanced Compressed Real Time Protocol [ECRTP], and Robust Header Compression [ROHC], will be used to compress the inner headers of IP packets traversing an IPsec tunnel.  Since these traditional HC protocols are designed to operate on a hop-by-hop basis, they may require extensions to enable their operation over IPsec SAs.  This document outlines a framework for extending the usage of these traditional hop-by-hop HC protocols to operate at IPsec SA endpoints.
</p>
<p>HCoIPsec targets the application of HC to tunnel mode SAs.  Transport mode SAs only encrypt/authenticate the payload of an IP packet, leaving the IP header untouched.  Intermediate routers subsequently use the IP header to route the packet to a decryption device.   Therefore, if traditional HC protocols were to operate over IPsec transport-mode SAs, (de)compression functionality can only be applied to the transport layer headers, and not to the IP header.   Since compression of transport layer headers alone does not provide substantial efficiency gains, the HCoIPsec framework outlined by this document only concerns the application of HC to tunnel mode SAs.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Audience</h3>

<p>The target audience includes those who are involved with the development of HC protocols, and IPsec implementations. Since traditional HC protocols have been designed to operate on a hop-by-hop basis, they may need to be modified or extended to be operational over IPsec SAs.  Therefore, the authors target various HC and IPsec communities who may consider extending existing HC and IPsec protocols to meet the requirements put forth in this document. Finally, this document is directed towards vendors developing IPsec devices that will be deployed in bandwidth-constrained IP networks.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Terminology</h3>

<p>Terminology specific to HCoIPsec is introduced in this section.
</p>
<p>Compressed Traffic
</p>
<p>
				</p>
<blockquote class="text">
<p>Traffic that is processed by the compressor.  Packet headers are compressed using a specific header compression protocol. 
</p>
</blockquote><p>
			
</p>
<p>Uncompressed Traffic
</p>
<p>
				</p>
<blockquote class="text">
<p>Traffic that is not processed by the compressor. Instead, this type of traffic bypasses the HC process.
</p>
</blockquote><p>
			
</p>
<p>HC Process
</p>
<p>
				</p>
<blockquote class="text">
<p>Generic reference to either the compressor, decompressor, or any supporting header compression (HC) components.
</p>
</blockquote><p>
			
</p>
<p>IPsec Process
</p>
<p>
				</p>
<blockquote class="text">
<p>Generic reference to the Internet Protocol Security (IPsec) process [IPSEC].
</p>
</blockquote><p>
			
</p>
<p>Next Header
</p>
<p>
				</p>
<blockquote class="text">
<p>Refers to the Protocol (IPv4) or Next Header (IPv6, Extension) field (see IANA web page at http://www.iana.org/assignments/protocol-numbers).
</p>
</blockquote><p>
			
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Problem Statement: IPsec Packet Overhead</h3>

<p>IPsec mechanisms provide various security services for IP networks.  However, the benefits of IPsec come at the cost of increased per-packet overhead.  For example, traffic flow confidentiality (generally leveraged at security gateways) requires the tunneling of IP packets between IPsec implementations.  Although these IPsec tunnels will effectively mask the source-destination patterns that an intruder can ascertain, IPsec tunnels come at the cost of increased per-packet overhead.  Specifically, an ESP tunnel mode SA applied to an IPv6 flow results in at least 50 bytes of additional overhead per packet.  This additional overhead may be undesirable for many bandwidth-constrained wireless and/or satellite communications networks, as these types of infrastructure are not overprovisioned.  HC applied on a per-hop basis over bandwidth-constrained link technologies will also suffer from reduced performance when encryption is used on the tunneled header, since encrypted headers can not be compressed.  Consequently, the additional overhead incurred by an IPsec tunnel may result in the inefficient utilization of bandwidth.
</p>
<p>Packet overhead is particularly significant for traffic profiles characterized by small packet payloads.  Some applications that emanate small packet payloads include various voice codecs.  In addition, if these small packets are afforded the security services of an IPsec tunnel mode SA, the amount of per-packet overhead is magnified.  Thus, a mechanism is needed to reduce the overhead associated with such flows.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Overview of the HCoIPsec Framework</h3>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
HCoIPsec Assumptions</h3>

<p>The goal for HCoIPsec is to provide efficient transport of IP packets between source and destination IPsec devices, without compromising the security services offered by IPsec. As such, the HCoIPsec framework was developed based on the following assumptions:
</p>
<ul class="text">
<li>Existing HC protocols (e.g., IPHC, CRTP, ECRTP, ROHC) will be leveraged to reduce the amount of overhead associated with packets traversing an IPsec SA
</li>
<li>HC algorithms will be instantiated at the IPsec SA endpoints, and HC is applied on a per-SA basis
</li>
</ul>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
HCoIPsec Summary</h3>

<p>HC protocols reduce packet overhead in a network by exploiting intra- and inter-packet redundancies of network and transport-layer header fields of a flow.
</p>
<p>Existing HC protocols compress packet headers on a hop-by-hop basis.  However, IPsec SAs are instantiated between two IPsec implementations, with multiple hops between the IPsec implementations.  Therefore, to fully integrate HC with IPsec SAs, traditional hop-by-hop protocols may need to be extended to operate at IPsec SA endpoints.
</p>
<p>The migration of traditional hop-by-hop HC protocols over IPsec SAs is straightforward, since SA endpoints provide source/destination pairs where (de)compression operations can take place.  Compression in such a manner offers a reduction of per-packet protocol overhead between the two SA endpoints, and does not require compression and decompression cycles at the intermediate hops between IPsec implementations.  Since traditional HC protocols will now essentially operate over multiple hops, it is imperative that their performance is not severely impacted due to increased packet reordering and/or packet loss between the compressor and decompressor.
</p>
<p>In addition, since HC protocols will operate at IPsec SA endpoints, HC protocols can no longer rely on the underlying link layer for HC parameter configuration and packet identification.  Traditional HC protocols use the underlying link layer to establish a set of configuration parameters at each end of the link, and some HC protocols (e.g., IPHC, CRTP, ECRTP) are also dependent on the link layer framing for identifying different types of header-compressed packets.  The HCoIPsec framework proposes that HC channel parameter configuration is accomplished by the SA management protocol (e.g., IKEv2), while identification of compressed header packets (in contrast to uncompressed packets) is provided through the Next Header field of the security protocol (e.g., AH, ESP).  In addition, HC protocols that require the identification of different types of header-compressed packets will have to be extended with such a mechanism.
</p>
<p></p>
<blockquote class="text">
</blockquote>

<p>Using the HCoIPsec framework proposed below, outbound IP traffic processing at an IPsec device is augmented to compress appropriate packet headers, and subsequently encrypt and/or integrity-protect the packet. For tunnel mode SAs, compression may be applied to the transport layer protocol and the inner IP header.
</p>
<p>Inbound IP traffic processing at an IPsec device is modified in a similar fashion.  For inbound packets, an IPsec device must first decrypt and/or integrity-check the packet.  Then, the IPsec device determines if the packet was received on an HC-enabled SA (see section 6.1) and if the packet maintains compressed headers.  If both of these conditions are met, decompression of the inner packet headers is performed.  After decompression, the packet is checked against the access controls imposed on all inbound traffic associated with the SA (as specified in RFC 4301).
</p>
<p></p>
<blockquote class="text">
<p>Note: Compression of inner headers is independent from compression of the security protocol (e.g., ESP) and outer IP headers.  HC protocols such as ROHC are capable of compressing the security protocol and outer IP headers on a hop-by-hop basis.  Further discussion on the compression of outer headers is outside the scope of this document.
</p>
</blockquote>

<p>If IPsec NULL encryption is applied to packets, HC protocols may still be applied to the inner headers at the IPsec SA endpoints.  Inbound and outbound packets are still processed as was previously described.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Details of the HCoIPsec Framework</h3>

<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
HC and IPsec Integration</h3>

<p>Based on these assumptions, Figure 1 illustrates the components required to integrate HC with the IPsec process, i.e., HCoIPsec.
</p>
<p>
				    </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
               +-------------------------------+
               | HC Module                     |
               |                               |
               |                               |
     +-----+   |     +-----+     +---------+   |
     |     |   |     |     |     |    HC   |   |
   --|  A  |---------|  B  |-----| Process |------&gt; Path 1
     |     |   |     |     |     |         |   |   (HC-enabled SA)
     +-----+   |     +-----+     +---------+   |
        |      |        |                      |
        |      |        |-------------------------&gt; Path 2
        |      |                               |   (HC-enabled SA)
        |      +-------------------------------+
        |
        |
        |
        |
        +-----------------------------------------&gt; Path 3
                                                   (HC-disabled SA)
</pre></div><p>

<p>Figure 1: Integration of HC with IPsec.
</p>
			    

<p>The process illustrated in Figure 1 augments the IPsec processing model for outbound IP traffic(protected-to-unprotected).  Initial IPsec processing is consistent with RFC 4301 (Steps 1-2, Section 5.1).  The HC data item (part of the SA state information) retrieved from the "relevant SAD entry" (RFC4301, Section 5.1, Step3a) determines if the traffic traversing the SA is handed to the HC module (Figure 1, decision block A).  Packets selected to an HC-disabled SA must follow normal IPsec processing and must not be sent to the HC module (Figure 1, Path 3).  Conversely, packets selected to an HC-enabled SA must be sent to the HC module.  The decision at block B then determines if the packet can be compressed.  If it is determined that the packet will be compressed, the Next Header field of the security protocol header (e.g., ESP, AH) is populated with a "compressed headers" value, and packet headers are compressed based on the compression protocol (Figure 1, Path 1).  However, if it is determined that the packet will not be compressed (e.g., due to one the reasons described in Section 6.1.3), the Next Header field is populated with the appropriate value indicating the next level protocol (Figure 1, Path 2).  After the HC process completes,  IPsec processing resumes, as described in Section 5.1, Step3a, of RFC4301 (specifically, "IPsec processing is as previously defined...").
</p>
<p>   The process illustrated in Figure 1 also augments the IPsec processing model for inbound IP traffic (unprotected-to-protected).   For inbound packets, IPsec processing is performed (RFC4301, Section 5.2, Steps 1-3) followed by AH or ESP processing (RFC4301, Section 5.2, Step 4) .  After AH or ESP processing, the HC data item retrieved from the SAD entry will indicate if traffic traversing the SA is handed to the HC module (RFC4301, Section 5.2, Step 3a).  Packets traversing an HC-disabled SA must follow normal IPsec processing and must not be sent to the HC module.  Conversely, packets traversing an HC-enabled SA must be sent to the HC module.  The decision at block B is determined by the value of the Next Header field.  If "compressed headers" is indicated, decompression is applied using the appropriate HC protocol (Figure 1, Path 1).  However, if the Next Header field does not contain the "compressed headers" value, the decompressor must not attempt decompression (Figure 1, Path 2).  IPsec processing resumes once the HC module completes processing, as described in Section 5.2, Step 4 of RFC 4301(specifically "Then match the packet against the inbound selectors identified by the SAD ...").
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.1"></a><h3>6.1.1.&nbsp;
Header Compression Protocol Considerations</h3>

<p>Traditional hop-by-hop HC protocols must be extended to operate efficiently over IPsec SAs.  Compressor and decompressor implementation considerations therefore must account for increased tolerance to packet reordering and packet loss between the compressor and decompressor, and minimizing the amount of feedback sent from the decompressor to the compressor.
</p>
<p>The ability to tolerate increased packet reordering between the compressor and decompressor is a necessity for any HC protocol that is extended to operate over an IPsec SA.  The following provides a summary of the candidate HC solutions, and their tolerance to packet loss and reordering between the compressor and decompressor: 
</p>
<ul class="text">
<li>IPHC has been identified as a HC protocol that performs poorly over long round trip time (RTT), high BER links [ROHC].  Extensions to IPHC to compress TCP/IP headers over an IPsec SA should take into consideration longer RTTs, increased potential for packet reordering and packet loss between the compressor and decompressor.
</li>
<li>CRTP has also been identified as a HC protocol that performs poorly over long RTT, high BER links [CRTPE].  Recent modifications to the CRTP protocol, such as ECRTP, enable the CRTP HC protocol to tolerate long RTTs and packet loss between the compressor and decompressor.  However, the reordering tolerance of ECRTP still needs to be evaluated, as detailed in [ECRTPE].  Such implementation aspects should be taken into consideration when extending ECRTP to operate over IPsec SAs.
</li>
<li>ROHC is a protocol that is designed for high BER, long RTT links.  ROHC can be used to compress not only RTP/UDP/IP headers, but also other traffic profiles such as TCP/IP, as defined in [ROHCTCP].  Similar to CRTP and IPHC, ROHC has been identified as vulnerable to packet reordering events between the compressor and decompressor[ROHCE].  Recent work [ROHCWEXT] suggests that the implementation aspects of ROHC can be modified to achieve tolerance to packet reordering events.  Such implementation aspects should be taken into consideration when extending ROHC to operate over IPsec SAs.
</li>
</ul>
<p>Note that additional techniques may be used to augment a traditional HC protocol's tolerance to packet reordering.  For example, various security protocols are equipped with a sequence number; this value may be used by the decompressor to identify a packet as "sequentially late".  This knowledge can increase the likelihood of successful decompression of a reordered packet.
</p>
<p>In addition, HC protocols should minimize the amount of feedback between decompressor and compressor. If a feedback channel from the decompressor to the compressor is not used sparingly, the overall gains from HCoIPsec can be significantly reduced.  For example, assume that ROHC is operating in bi-directional reliable mode, and is instantiated over an IPsec tunnel mode SA.  In this scenario, any feedback sent from the decompressor to the compressor must be tunneled.  As such, the additional overhead incurred by tunneling feedback will reduce the overall benefits of HC.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.2"></a><h3>6.1.2.&nbsp;
Initialization and Negotiation of HC Channel</h3>

<p>Hop-by-hop HC protocols use the underlying link layer (e.g., PPP) to negotiate HC channel parameters.  To remove HC protocol dependencies on the underlying link layer, an additional mechanism is needed to initialize a HC channel and its associated parameters prior to HC protocol operation.
</p>
<p>Initialization of the HC channel will either be achieved manually (i.e., administratively configured for manual SAs), or be performed by IPsec SA establishment protocols, e.g.  IKEv2.  During SA initialization, the SA establishment protocol will be extended to negotiate the HC protocol's channel parameters.  The specifics for this proposal are detailed in [IKE-HC].
</p>
<p>If the HC protocol requires bi-directional communications, two SAs must be instantiated between the IPsec implementations.  One of the two SAs is used for carrying traffic from the compressor to the decompressor, while the other is used to communicate feedback from the decompressor to the compressor.  Note that this requirement for two SAs aligns with the operation of IKE, which is capable of creating SA pairs.  However, IPsec implementations will dictate how decompressor feedback received on one SA is associated with a compressor on the other SA.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.3"></a><h3>6.1.3.&nbsp;
Encapsulation and Identification of Header Compressed Packets</h3>

<p>As indicated in section 6.1, new state information (i.e., a new HC data item) is defined for each SA.  The HC data item is used by the IPsec process to determine whether it sends all traffic traversing a given SA to the HC module (HC-enabled) or bypasses the HC module and sends the traffic through regular IPsec processing (HC-disabled).
</p>
<p>In addition, the Next Header field of the IPsec security protocol (e.g., AH or ESP) header is used to demultiplex header-compressed traffic from uncompressed traffic traversing an HC-enabled SA.  This functionality is needed in situations where packets traversing an HC-enabled SA are not compressed by the compressor.  Such situations may occur when, for example, a compressor supports strictly n compressed flows and can not compress the n+1 flow that arrives.  Another example is when traffic (e.g., TCP/IP) is selected (by IPsec) to an HC-enabled SA, but cannot be compressed by the HC process (e.g., because the compressor does not support TCP/IP compression).  In these situations, the compressor must indicate that the packet contains uncompressed headers.  Similarly, the decompressor must be able to identify packets with uncompressed headers and not attempt to decompress them.  As such, the Next Header field is used to demultiplex these header-compressed versus uncompressed packets, as a "compressed header" value will indicate the packet contains compressed headers.
</p>
<blockquote class="text">
<p>Note: As indicated in the description of HCoIPsec inbound and outbound processing, the Next Header field is used to identify compressed packets on an HC-enabled SA.  Because the Next Header field value is only leveraged at the IPsec implementations, an official IANA allocation from the ProtocolID registry may not be required.  Future discussions of HCoIPsec will determine the appropriate path forward.
</p>
</blockquote>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
HCoIPsec Framework Summary</h3>

<p>To summarize, the following items are needed to achieve HCoIPsec:
</p>
<ul class="text">
<li>Extensions to traditional HC protocols which enable their operation at IPsec SA enpoints 
</li>
<li>Extensions to IKEv2 to Support Header Compression over IPsec (HCoIPsec)
</li>
<li>Allocation of one value for "compressed headers" from the IANA "Protocol Numbers" registry (This specification may not be necessary, as indicated in Section 6.1.3)
</li>
</ul>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>A malfunctioning header compressor (i.e., the compressor located at the ingress of the IPsec tunnel) has the ability to send packets to the decompressor (i.e., the decompressor located at the egress of the IPsec tunnel) that do not match the original packets emitted from the end-hosts.  Such a scenario will result in a decreased efficiency between compressor and decompressor.  Furthermore, this may result in Denial of Service, as the decompression of a significant number of invalid packets may drain the resources of an IPsec device.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>None.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Acknowledgments</h3>

<p>The authors would like to thank Mr. Sean O'Keeffe, Mr. James Kohler, and Ms. Linda Noone of the Department of Defense, and well as Mr. Rich Espy of OPnet for their contributions and support in the development of this document.  In addition, the authors would like to thank the following for their numerous reviews and comments to this document:
</p>
<p></p>
<ul class="text">
<li>Dr. Stephen Kent 
</li>
<li>Dr. Carsten Bormann
</li>
<li>Mr. Tero Kivinen
</li>
<li>Mr. Lars-Erik Jonsson
</li>
<li>Mr. Jan Vilhuber
</li>
<li>Mr. Dan Wing
</li>
<li>Mr. Kristopher Sandlund
</li>
<li>Mr. Ghyslain Pelletier
</li>
</ul>

<p>Finally, the authors would also like to thank Mr. Tom Conkle, Ms. Renee Esposito, Mr. Etzel Brower, and Mr. Jonah Pezeshki of Booz Allen Hamilton for their assistance in completing this work.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="IPSEC">[IPSEC]</a></td>
<td class="author-text">Kent, S. and K. Seo, &ldquo;<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>,&rdquo; RFC&nbsp;4301, December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="IPHC">[IPHC]</a></td>
<td class="author-text">Nordgren, M., Pink, B., and S. Pink, &ldquo;<a href="http://tools.ietf.org/html/rfc2507">IP Header Compression</a>,&rdquo; RFC&nbsp;2507, February&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="CRTP">[CRTP]</a></td>
<td class="author-text">Casner, S. and V. Jacobson, &ldquo;<a href="http://tools.ietf.org/html/rfc2508">Compressing IP/UDP/RTP Headers for Low-Speed Serial Links</a>,&rdquo; RFC&nbsp;2508, February&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="ECRTP">[ECRTP]</a></td>
<td class="author-text">Koren, et al., &ldquo;<a href="http://tools.ietf.org/html/rfc3545">Compressing IP/UDP/RTP Headers on Links with High Delay, Packet Loss, and Reordering</a>,&rdquo; RFC&nbsp;3545, July&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="ROHC">[ROHC]</a></td>
<td class="author-text">Bormann, C., Burmeister, C., Degermark, M., Fukushima, H., Hannu, H., Jonsson, L., Hakenberg, R., Koren, T., Le, K., Liu, Z., Martensson, A., Miyazaki, A., Svanbro, K., Wiebke, T., Yoshimura, T., and H. Zheng, &ldquo;<a href="http://tools.ietf.org/html/rfc3095">RObust Header Compression (ROHC): Framework and four profiles: RTP, UDP, ESP, and uncompressed</a>,&rdquo; RFC&nbsp;3095, July&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="ECRTPE">[ECRTPE]</a></td>
<td class="author-text">Knutsson, C., &ldquo;Evaluation and Implemenation[sic] of Header Compression Algorithm ECRTP,&rdquo; November&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="ROHCTCP">[ROHCTCP]</a></td>
<td class="author-text">Pelletier, et al., &ldquo;Robust Header Compression: A Profile For TCP/IP (ROHC-TCP),&rdquo; work in progress&nbsp;, January&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="ROHCWEXT">[ROHCWEXT]</a></td>
<td class="author-text">Pelletier, et al., &ldquo;<a href="http://tools.ietf.org/html/rfc4224">ROHC over Channels That Can Reorder Packets</a>,&rdquo; RFC&nbsp;4224, January&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="IKE-HC">[IKE-HC]</a></td>
<td class="author-text">Jasani, et al., &ldquo;Extensions to IKEv2 to Support HCoIPsec,&rdquo; work in progress&nbsp;, September&nbsp;2006.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ESP">[ESP]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4303">IP Encapsulating Security Payload</a>,&rdquo; RFC&nbsp;4303, December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="HCOMPLS">[HCOMPLS]</a></td>
<td class="author-text">Ash, J. and et. al, &ldquo;Protocol Extensions for Header Compression over MPLS,&rdquo; April&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="CRTPE">[CRTPE]</a></td>
<td class="author-text">Degermark, M., Hannu, H., Jonsson, L., and K. Svanbro, &ldquo;Evaluation of CRTP Performance over Cellular Radio Networks,&rdquo; IEEE Personal Communication Magazine&nbsp;, Volume 7, number 4, pp. 20-25, August&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="ROHCE">[ROHCE]</a></td>
<td class="author-text">Ash, J. and et. al, &ldquo;<a href="http://tools.ietf.org/html/rfc4247">Requirements for ECRTP over MPLS</a>,&rdquo; RFC&nbsp;4247, November&nbsp;2005.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Emre Ertekin</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Booz Allen Hamilton</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">13200 Woodland Park Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Herndon, VA  20171</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ertekin_emre@bah.com">ertekin_emre@bah.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chris Christou</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Booz Allen Hamilton</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">13200 Woodland Park Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Herndon, VA  20171</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:christou_chris@bah.com">christou_chris@bah.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rohan Jasani</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Booz Allen Hamilton</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">13200 Woodland Park Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Herndon, VA  20171</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jasani_rohan@bah.com">jasani_rohan@bah.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2006).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
