<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>A WebDAV Search Grammar for XML Properties</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="A WebDAV Search Grammar for XML Properties">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">R J. Godoy</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">H. Minni</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">Universidad Nacional del Litoral</td></tr>
<tr><td class="header">Expires: July 28, 2008</td><td class="header">January 25, 2008</td></tr>
</table></td></tr></table>
<h1><br />A WebDAV Search Grammar for XML Properties<br />draft-godoy-webdav-xmlsearch-01</h1>

<h3>Status of This Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on July 28, 2008.</p>

<h3>Abstract</h3>

<p>This document specifies xml-search, a search grammar 
        for use with the Web Distributed Authoring and Versioning (WebDAV) SEARCH protocol.
        It extends the DAV:basicsearch grammar with XPath expressions 
        that are evaluated on resources' properties whose values are XML fragments.
</p>
<p>
        The full expression power of XPath may exceed the requirement in simple use cases, therefore
        some provisions are made in order to reduce the computational cost of evaluating allowed queries.         
        
</p>
<p>Discussion about this draft should be addressed via www-webdav-dasl@w3.org.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Notational conventions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.</a>&nbsp;
Terms<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">1.3.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#propfind">1.4.</a>&nbsp;
WXS:xml-search and the PROPFIND response<br />
<a href="#XPath">2.</a>&nbsp;
XPath<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#XPath-contexts">2.1.</a>&nbsp;
Static and Dynamic Contexts<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#XPath-errors">2.2.</a>&nbsp;
Error and warnings<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.2.1.</a>&nbsp;
Warnings<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#errors-SAP">2.2.2.</a>&nbsp;
Errors (in SAP)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.2.3.</a>&nbsp;
Errors (in DEP)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#XPath-predicate">2.3.</a>&nbsp;
Numeric Predicates<br />
<a href="#discovery">3.</a>&nbsp;
Discovery of the Query Grammar<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DASL-header">3.1.</a>&nbsp;
The DASL Response Header<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DAV:sqgs">3.2.</a>&nbsp;
DAV:supported-query-grammar-set<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#QSD-intro">3.3.</a>&nbsp;
Discovery of the WXS:xml-search Query Schema<br />
<a href="#grammar">4.</a>&nbsp;
The WXS:xml-search Grammar<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.1.</a>&nbsp;
Accepted Role Precondition<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DAV:select">4.2.</a>&nbsp;
Selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DAV:where">4.3.</a>&nbsp;
Query criteria<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.3.1.</a>&nbsp;
DAV:prop operand<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.3.2.</a>&nbsp;
Literal Operands<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">4.3.3.</a>&nbsp;
Relational operators<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">4.3.4.</a>&nbsp;
The WXS:filter operator<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">4.3.5.</a>&nbsp;
The WXS:is-well-formed operator<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DAV:orderby">4.4.</a>&nbsp;
Ordering<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#status_code">4.5.</a>&nbsp;
SEARCH Status Codes for responses to WXS:xml-search queries<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#status_code_response">4.6.</a>&nbsp;
Status Codes for Use in 'response' Elements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#status_code_propstat">4.7.</a>&nbsp;
Status Codes for Use in 'propstat' Elements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#preconditions">4.8.</a>&nbsp;
Precondition and postcondition Codes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">4.8.1.</a>&nbsp;
WXS:property-must-be-well-formed-xml<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">4.8.2.</a>&nbsp;
WXS:acceptable-role<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">4.8.3.</a>&nbsp;
WXS:XPath-error<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">4.8.4.</a>&nbsp;
DAV:search-scope-valid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">4.8.5.</a>&nbsp;
WXS:known-literal-type<br />
<a href="#QSD">5.</a>&nbsp;
Query Schema for WXS:xml-search<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#QSD-prop">5.1.</a>&nbsp;
Property descriptions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#QSD-op">5.2.</a>&nbsp;
Operator descriptions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DAV:opdesc">5.2.1.</a>&nbsp;
WXS:opdesc-rule and WXS:operator<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">5.2.2.</a>&nbsp;
WXS:repetition<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">5.2.3.</a>&nbsp;
WXS:alternative<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#query-schema">5.2.4.</a>&nbsp;
Implied operator description<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">5.2.5.</a>&nbsp;
Extended operator description for DAV:typed-literal Operand<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">5.2.6.</a>&nbsp;
Description of DAV:like Operator<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#QSD-function">5.3.</a>&nbsp;
Supporting Optional Functions<br />
<a href="#extensibility">6.</a>&nbsp;
XML Extensibility<br />
<a href="#anchor22">7.</a>&nbsp;
Security Considerations<br />
<a href="#anchor23">8.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#anchor26">Appendix&nbsp;A.</a>&nbsp;
Example WXS:xml-search query<br />
<a href="#anchor27">Appendix&nbsp;B.</a>&nbsp;
Reported Issues<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">B.1.</a>&nbsp;
Editorial Issues<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">B.2.</a>&nbsp;
Technical Issues<br />
<a href="#anchor30">Appendix&nbsp;C.</a>&nbsp;
Change log (To be removed by RFC Editor before publication)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">C.1.</a>&nbsp;
changes in draft-godoy-webdav-xmlsearch-01<br />
<a href="#rfc.index">&#167;</a>&nbsp;
Index<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> 
This document specifies xml-search, an OPTIONAL search grammar for use with the Web Distributed Authoring and Versioning (WebDAV) SEARCH protocol. 
The search grammar defined by this document is a superset of DAV:basicsearch <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>. 

</p>
<p>The intent of this document is to extend the DAV:basicsearch grammar for dealing with properties whose values are XML fragments.
Since the WebDAV property namespace is flat, and resources may have at most one value for a property of a given name (Section 9.1 of <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>),
XML documents allowing repeatable elements cannot be expressed as a set of independent WebDAV properties (e.g., by mapping some elements to properties),
and the DAV:basicsearch schema cannot be applied to such XML content because it deals with property values as a whole.
<a class='info' href='#comment.note-intent'>[note-intent]<span> (</span><span class='info'>The authors' motivation for writing this document is allowing metadata to be searchable when presented as a WebDAV property.  Since it may be encoded as specified by a third-party schema,  it should not be modified in order to conform WebDAV.</span><span>)</span></a><a name='note-intent'></a>

</p>
<p>WXS:xml-search is proposed as a different search grammar because it defines
a new element (namely WXS:filter) that modify the query semantics. 
Had this been an extension of DAV:basicsearch, a server would have ignored 
the WXS:filter elements (according to Section 17 of <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>) 
yielding results different from those requested by the client.
<a class='info' href='#comment.note-RFC4918-sect17'>[note-RFC4918-sect17]<span> (</span><span class='info'>RFC4918: &quot;(...) servers MUST process received XML  documents as if unexpected elements and attributes (and all children of unrecognized  elements) were not there&quot;</span><span>)</span></a><a name='note-RFC4918-sect17'></a>

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Notational conventions</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
"SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
and "OPTIONAL" in this document are to be interpreted as
described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>This specification defines elements in the urn:ietf:params:xml:ns:webdav-xml-search XML namespace.
(hereinafter referred to as the "WXS namespace", though the prefix binding "WXS:" is not normative).
In natural language, an element like "xml-search" in this namespace is sometimes referred to as
"WXS:xml-search" (without quotes).
<a class='info' href='#comment.note-namespace'>[note-namespace]<span> (</span><span class='info'>Since this protocol is experimental, the authors do not suggest new elements in order to not pollute the &quot;DAV:&quot; namespace. Thus, an experimental implementation of this protocol will not conflict with the following requirement from RFC 4918: &quot;(...) an XML element in the &quot;DAV:&quot; namespace SHOULD NOT be used in the request or response body unless that XML element is explicitly defined in an IETF RFC reviewed by a WebDAV working group&quot;.</span><span>)</span></a><a name='note-namespace'></a>

</p>
<p>In element definitions, an element name prefixed with "WXS:" refers to an element in the WXS namespace, 
and un-prefixed element names refers to elements in the "DAV:" namespace.
</p>
<p>
The DTD fragments are normative up to extensibility rules defined in <a class='info' href='#extensibility'>Section&nbsp;6<span> (</span><span class='info'>XML Extensibility</span><span>)</span></a>.
Unless noted otherwise, ordering of declared content is not significative.

</p>
<p>
Note: when an error condition is described, it is said that "the server MUST return" some indication of that error.
Unless stated otherwise, if several errors occurs at the same time, any of them MAY be reported and any of them MAY be omitted
as long as one of them is reported.

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Terms</h3>

<p>This document uses the terms defined in 
<a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>, <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>
and this section. Some definitions of frequently used terms from <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a> are 
informatively included here.
</p>
<p><a name='anchor32'></a>
Dynamic Context: (of an XPath expression) "the dynamic context of an expression is defined as information 
that is available at the time the expression is evaluated"
(Section 2.1.2, <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>).

</p>
<p><a name='anchor33'></a>
Dynamic Evaluation Phase (DEP): "The dynamic evaluation phase is the phase during which the value of an expression is computed.
It occurs after completion of the static analysis phase" 
(Section 2.3.3.2, <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>).

</p>
<p><a name='anchor34'></a>
Dynamic Error: "A dynamic error is an error that must be detected during the dynamic evaluation 
phase and may be detected during the static analysis phase. Numeric overflow is an example of a dynamic error"
(Section 2.3.1, <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>).

</p>
<p><a name='anchor35'></a>
Implementation-defined: "indicates an aspect that MAY differ between implementations, 
but MUST be specified by the implementor for each particular implementation"
(Section 1, <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>).

</p>
<p><a name='anchor36'></a>
Implementation-dependent: "indicates an aspect that MAY differ between implementations, 
is not specified by [this or any other] specification, and is not required to be specified 
by the implementor for any particular implementation"
(Section 1, <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>).

</p>
<p><a name='anchor37'></a>valuation of an expression t:xml-search where the DAV:prop element is expected. 
A role is "plain" if the DAV:prop element occurs as a direct child of DAV:select, DAV:where, or DAV:order,
and it is "filtered" (also referred as XPath-enabled) if the DAV:prop element occurs as a direct child of WXS:XPath.

</p>
<p><a name='anchor38'></a>
Static Analysis Phase (SAP): "The static analysis phase depends on the expression itself and on the static context. 
The static analysis phase does not depend on input data (other than schemas)"
(Section 2.3.3.1, <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>).

</p>
<p><a name='anchor39'></a>
Static Context: (of an XPath expression) "the static context of an expression is the information 
that is available during static analysis of the expression, prior to its evaluation"
(Section 2.1.1, <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>).

</p>
<p><a name='anchor40'></a>
Static Error: "A static error is an error that MUST be detected during the static 
analysis phase. A syntax error is an example of a static error"
(Section 2.3.1, <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>).

</p>
<p><a name='anchor41'></a>
Type Error: "A type error may be raised during the static analysis phase or the dynamic 
evaluation phase. During the static analysis phase, a type error occurs when the static 
type of an expression does not match the expected type of the context in which the expression 
occurs. During the dynamic evaluation phase, a type error occurs when the dynamic type of a value 
does not match the expected type of the context in which the value occurs"
(Section 2.3.1, <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>).

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Overview</h3>

<p><a class='info' href='#propfind'>Section&nbsp;1.4<span> (</span><span class='info'>WXS:xml-search and the PROPFIND response</span><span>)</span></a> summarizes how this query grammar matches the PROPFIND response, 
according to the requirement imposed by Section 2.3.2 of <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>.

</p>
<p>
<a class='info' href='#XPath'>Section&nbsp;2<span> (</span><span class='info'>XPath</span><span>)</span></a> describes WXS:xml-search as an XPath host language, i.e., a language where XPath expressions 
are embedded.
Some items from the XPath specification are defined in that section, 
while other are left to the criteria of the implementors.
This section also includes design decisions in order to reduce the computational cost of evaluating allowed queries.

</p>
<p>
<a class='info' href='#discovery'>Section&nbsp;3<span> (</span><span class='info'>Discovery of the Query Grammar</span><span>)</span></a> describes how this grammar is advertised, 
according to the mechanisms for discovery of supported query grammars,
defined in Section 3 of <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>.
This include the Allow and DASL headers in OPTIONS responses (<a class='info' href='#DASL-header'>Section&nbsp;3.1<span> (</span><span class='info'>The DASL Response Header</span><span>)</span></a>),
the DAV:supported-query-grammar-set property (<a class='info' href='#DAV:sqgs'>Section&nbsp;3.2<span> (</span><span class='info'>DAV:supported-query-grammar-set</span><span>)</span></a>) 
and Query Schema Discovery (<a class='info' href='#QSD-intro'>Section&nbsp;3.3<span> (</span><span class='info'>Discovery of the WXS:xml-search Query Schema</span><span>)</span></a> and <a class='info' href='#QSD'>Section&nbsp;5<span> (</span><span class='info'>Query Schema for WXS:xml-search</span><span>)</span></a>). 

</p>
<p>
<a class='info' href='#grammar'>Section&nbsp;4<span> (</span><span class='info'>The WXS:xml-search Grammar</span><span>)</span></a> describes the grammar of a WXS:xml-search query.
This includes extending the specification of selection (<a class='info' href='#DAV:select'>Section&nbsp;4.2<span> (</span><span class='info'>Selection</span><span>)</span></a>)
query criteria (<a class='info' href='#DAV:where'>Section&nbsp;4.3<span> (</span><span class='info'>Query criteria</span><span>)</span></a>)
and ordering (<a class='info' href='#DAV:orderby'>Section&nbsp;4.4<span> (</span><span class='info'>Ordering</span><span>)</span></a>) with respect to DAV:basicsearch. 
Additionally, some status (<a class='info' href='#status_code'>Section&nbsp;4.5<span> (</span><span class='info'>SEARCH Status Codes for responses to WXS:xml-search queries</span><span>)</span></a> to <a class='info' href='#status_code_propstat'>Section&nbsp;4.7<span> (</span><span class='info'>Status Codes for Use in 'propstat' Elements</span><span>)</span></a>) and precondition/postcondition codes
(<a class='info' href='#preconditions'>Section&nbsp;4.8<span> (</span><span class='info'>Precondition and postcondition Codes</span><span>)</span></a>) are defined.

</p>
<p>
<a class='info' href='#QSD'>Section&nbsp;5<span> (</span><span class='info'>Query Schema for WXS:xml-search</span><span>)</span></a> describes the Query Schema for advertising supported features about properties (<a class='info' href='#QSD-prop'>Section&nbsp;5.1<span> (</span><span class='info'>Property descriptions</span><span>)</span></a>)
and operators (<a class='info' href='#QSD-op'>Section&nbsp;5.2<span> (</span><span class='info'>Operator descriptions</span><span>)</span></a>), and optional XPath functions available in a WXS:xml-search query (<a class='info' href='#QSD-function'>Section&nbsp;5.3<span> (</span><span class='info'>Supporting Optional Functions</span><span>)</span></a>).

</p>
<p>
<a class='info' href='#extensibility'>Section&nbsp;6<span> (</span><span class='info'>XML Extensibility</span><span>)</span></a> describes the specified behaviour when unexpected elements are found,
providing a common ground for allowing clients that implement arbitrary extensions
to interoperate with other implementations that does not include it.

</p>
<a name="propfind"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
WXS:xml-search and the PROPFIND response</h3>

<p>A WXS:xml-search response contains a subset of the elements that are 
 returned by a PROPFIND response listing the same properties on the same scope and with the same depth. 
 If a server supports specifying several scopes in a single query, and these scopes exist, 
 then the WXS:xml-search response will  describe a subset of the elements in several PROPFIND responses (one PROPFIND for each scope).
</p>
<p>The properties included in a WXS:xml-search response are those specified within the DAV:select element of the request.
In that context, DAV:allprop and DAV:prop are understood as in PROPFIND, hence both methods returns the same properties.
In addition, WXS:xml-search introduce a new way for selecting properties: 
WXS:filter, which "filters" elements from some property value according to an XPath expression. If WXS:filter is used, the WXS:xml-search response will contain a subset
of elements from the filtered property, while the PROPFIND response will contain the complete value.
</p>
<p>Queries may impose conditions about which or how many resources will be included in the response, 
 and servers may truncate the response at their choice. Thus, a SEARCH response
 may not include some resources from the specified scope, while all of them have to be included when using PROPFIND. 
 
</p>
<p>Furthermore, WXS:xml-search defines additional preconditions and postconditions codes that are not used with a PROPFIND response.
</p>
<a name="XPath"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
XPath</h3>

<p>There are several items in XPath that are implementation-defined. 
Some of them are defined in this section (as this protocol specifies an XPath host language) 
while other are left to the criteria of the implementors.
</p>
<p>* Some components of the static and dynamic contexts are constrained (<a class='info' href='#XPath-contexts'>Section&nbsp;2.1<span> (</span><span class='info'>Static and Dynamic Contexts</span><span>)</span></a>).
</p>
<p>* A way for reporting errors and warnings is specified (<a class='info' href='#XPath-errors'>Section&nbsp;2.2<span> (</span><span class='info'>Error and warnings</span><span>)</span></a>).
</p>
<p>* In some expressions, supporting numeric predicates is OPTIONAL (section <a class='info' href='#XPath-predicate'>Section&nbsp;2.3<span> (</span><span class='info'>Numeric Predicates</span><span>)</span></a>).
</p>
<p>* Implementations of this protocol MUST be based on the rules of 
<a class='info' href='#W3C.REC-xml11-20060816'>[W3C.REC&#8209;xml11&#8209;20060816]<span> (</span><span class='info'>Maler, E., Sperberg-McQueen, C., Cowan, J., Paoli, J., Bray, T., and F. Yergeau, &ldquo;Extensible Markup Language (XML) 1.1 (Second Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a> and 
<a class='info' href='#W3C.REC-xml-names11-20060816'>[W3C.REC&#8209;xml&#8209;names11&#8209;20060816]<span> (</span><span class='info'>Hollander, D., Layman, A., Tobin, R., and T. Bray, &ldquo;Namespaces in XML 1.1 (Second Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>, and apply them consistently.
</p>
<p>* The self, child, descendant, descendant-or-self, parent and attribute axes MUST be supported. 
An implementation MAY support other axes, as described in the query schema. 
(This requirement is aligned with the mandatory axes from <a class='info' href='#W3C.REC-xquery-20070123'>[W3C.REC&#8209;xquery&#8209;20070123]<span> (</span><span class='info'>Boag, S., Robie, J., Chamberlin, D., Fernández, M., Florescu, D., and J. Siméon, &ldquo;XQuery 1.0: An XML Query Language,&rdquo; January&nbsp;2007.</span><span>)</span></a>.)

</p>
<p>* Support for the "Static Typing Feature" and "Static Typing Extensions" (Appendix F.1 of <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>) is implementation-defined.
</p>
<a name="XPath-contexts"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Static and Dynamic Contexts</h3>

<p>This specification defines REQUIRED values for some components of the XPath static and dynamic context. 
Unless specified otherwise, the constant values specified below MUST NOT be overwritten.
Components not listed here are "implementation-dependent".
</p>
<p>ke precedenof an expression that relies on one or more "unassigned" components raises the static error err:XPST0001 (if the component is static)
or the dynamic error err:XPDY0002 (if the component is dynamic).
</p>
<p>Definition of functions in the "Function signatures" set is given in <a class='info' href='#W3C.REC-xpath-functions-20070123'>[W3C.REC&#8209;xpath&#8209;functions&#8209;20070123]<span> (</span><span class='info'>Walsh, N., Malhotra, A., and J. Melton, &ldquo;XQuery 1.0 and XPath 2.0 Functions and Operators,&rdquo; January&nbsp;2007.</span><span>)</span></a>.
</p>
<p style='text-align: center'>REQUIRED static values
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left" width="30%"><col align="left">
<tr><th align="left">Component</th><th align="left">Specified Value</th></tr>
<tr>
<td align="left">XPath 1.0 compatibility mode</td>
<td align="left">"false".</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Statically known namespaces</td>
<td align="left">All the namespace bindings in scope at the WXS:XPath element where the expression occurs plus
                                                     ("fn:", "http://www.w3.org/2005/XPath-functions") unless overwritten.</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Default element/type namespace</td>
<td align="left">The default namespace of the WXS:XPath element where the expression occurs 
                                                     ("none" if there is no default namespace).</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Default function namespace</td>
<td align="left">"http://www.w3.org/2005/XPath-functions".</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Function signatures</td>
<td align="left">fn:root($arg as node()?) as node()?</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left">                                 fn:not($arg as item()*) as xs:boolean</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left">                                 fn:count ($arg as item()*) as xs:integer</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left">                                 fn:exists($arg as item()*) as xs:boolean </td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left">                                 fn:empty ($arg as item()*) as xs:boolean</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left">                                 (may be overwritten).</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Statically known collations</td>
<td align="left">At least "http://www.iana.org/assignments/collation/ default"
                                        and applicable wildcard collations (Sections 3.1 and 3.2 of <a class='info' href='#RFC4790'>[RFC4790]<span> (</span><span class='info'>Newman, C., Duerst, M., and A. Gulbrandsen, &ldquo;Internet Application Protocol Collation Registry,&rdquo; March&nbsp;2007.</span><span>)</span></a>).
                                        MAY be augmented with an implementation-defined set of collations.</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Default collation</td>
<td align="left">The collation matched by "http://www.iana.org/assignments/collation/ default" 
                                        (the actual collation is implementation-defined)</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Base URI</td>
<td align="left">Unassigned.</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Statically known documents</td>
<td align="left">Initially unassigned. Overwriteable with an implementation-defined value.</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Statically known collections</td>
<td align="left">Initially unassigned. Overwriteable with an implementation-defined value.</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Statically known default collection type</td>
<td align="left">node()*</td>
</tr>
</table>
<br clear="all" />

<p style='text-align: center'>REQUIRED dynamic values
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Component</th><th align="left">Specified Value</th></tr>
<tr>
<td align="left">Function implementations</td>
<td align="left">Implementation-defined, MUST be consistent with function signatures.</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Current dateTime</td>
<td align="left">REQUIRED implementation-dependent value.</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Implicit timezone</td>
<td align="left">REQUIRED implementation-defined value.</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Available documents</td>
<td align="left">Initially unassigned. Overwriteable with an implementation-defined value.</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Available collections</td>
<td align="left">Initially unassigned. Overwriteable with an implementation-defined value.</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">Default collection</td>
<td align="left">Initially unassigned. Overwriteable with an implementation-defined value.</td>
</tr>
</table>
<br clear="all" />

<a name="XPath-errors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Error and warnings</h3>

<p>
This section describes the method by which XPath errors and warnings are reported.
Error conditions are defined in <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>, 
and warning conditions are OPTIONAL and implementation-defined.
</p>
<p>For conformance with <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>, implementations MAY report any non-empty subset of errors.
Additionally, if there is an error (other than a XPath error) that causes the request to be rejected, implementations MAY report the latter,
with no mention to the XPath errors.

</p>
<p>
The idref attributes of WXS:xpath-error and WXS:warning MAY be used to refer to the id attribute of the WXS:xpath element 
whose content raised the error or warning. 

The mechanism that implementations use to return additional information is implementation-defined. 

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.1"></a><h3>2.2.1.&nbsp;
Warnings</h3>

<p>The WXS:warning element contains at least one XML element, and MUST NOT contain text or mixed content. 
Children of the WXS:warning element represent warnings signaled during the analysis of the expression.

</p>
<p>
<a name='anchor42'></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;!ELEMENT WXS:warning ANY&gt;
&lt;!ATTLIST WXS:warning idref NAME #IMPLIED&gt;
</pre></div><p>


</p>
<p>The DAV:multistatus and DAV:response elements, when used in response to WXS:xml-search queries, 
are modified to include an OPTIONAL WXS:warning element. 

Warnings raised during SAP apply to the whole query and 
are reported within the WXS:warning element contained by DAV:multistatus.

Warnings raised during DEP only apply to a particular resource
and are reported within the DAV:response for that resource.

</p><a name='anchor43'></a><a name='anchor44'></a>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;!ELEMENT multistatus (response*, responsedescription?,
                       WXS:warning?) &gt;

&lt;!ELEMENT response (href, ((href*, status)|(propstat+)),
                    error?, WXS:warning?,
                    responsedescription?, score?)
</pre></div><p>


</p>
<a name="errors-SAP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.2"></a><h3>2.2.2.&nbsp;
Errors (in SAP)</h3>

<p>
Errors (either static, dynamic or type errors) detected during SAP
invalidates the request. These kind of errors are reported through a WXS:xpath-error element 
included in a response whose root element is DAV:error. The response status code is 400 (Bad Request).

<a name='anchor45'></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;!ELEMENT WXS:xpath-error ANY&gt;
&lt;!ATTLIST WXS:xpath-error idref NAME #IMPLIED&gt;
</pre></div><p>


The WXS:xpath-error element MUST contain one or more elements describing the error. For instance, 
if an err:XPST0003 were raised (i.e. the XPath static error 0003: "a XPath expression is not a valid instance of the grammar") the response would be:

<a name='anchor46'></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 400 Bad Request
Content-Type: text/xml; charset="utf-8"
Content-Length: xxx

&lt;error xmlns="DAV:"&gt;
  &lt;WXS:XPath-error
      xmlns:WXS="urn:ietf:params:xml:ns:webdav-xml-search"&gt;
    &lt;err:XPST0003 xmlns:err="http://www.w3.org/2005/xqt-errors"/&gt;
  &lt;/WXS:XPath-error&gt;
&lt;/error&gt;
</pre></div><p>

</p>
<p>(Note: the use of the "err:" prefix follows the convention of <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a> but it is not normative.)
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.3"></a><h3>2.2.3.&nbsp;
Errors (in DEP)</h3>

<p>
An expression may be statically valid and raise an error under some dynamic conditions.
Dynamic and type errors detected during DEP only invalidates the expression which raises them, 
when evaluated with the actual values of some resource property.

</p>
<p>
A server MAY ignore errors detected in DEP if:
<br />
   -The error occurs within DAV:order, 
but that ordering criteria is not used (because other orders take precedence, or because the query matches one or no resource).
<br />
   -The error occurs within DAV:where part, and it does not affect the result.
For instance, the error in (FALSE AND ERROR) may be omitted because the result would have been FALSE anyway, 
and the error in (TRUE OR ERROR) may be omitted because the result would have been TRUE anyway. 

</p>
<p>If the error is not ignored, and the XPath expression was specified within the DAV:select part,
it MAY be reported in the DAV:propstat element for the current property and resource. 
Otherwise it MAY be reported in the DAV:response element for the current resource. In both cases 
the status code 409 (Conflict) MUST be used.

</p>
<p>
Although errors in DEP depend on the value of the property,
an error that is too frequent might have been caused by mistakes in the client's request.
Therefore, instead of returning a sequence of DAV:response elements, all of which represent failures because of the same error, 
a server MAY report an error in DEP as a general failure invalidating the query itself, 
even if it is possible to evaluate other resources and properties.
<a class='info' href='#comment.error-DEP'>[error-DEP]<span> (</span><span class='info'>Besides, handling dynamic errors on a separate basis imposes an additional requirement, then supporting this feature is left to the criteria of implementors.</span><span>)</span></a><a name='error-DEP'></a>

</p>
<p>
 When an error raised in DEP is reported as a general failure, 
 the response will be marshaled as in <a class='info' href='#errors-SAP'>Section&nbsp;2.2.2<span> (</span><span class='info'>Errors (in SAP)</span><span>)</span></a>,
 but the response status code MUST be 409 (Conflict) instead of 400 (Bad Request). 

</p>
<p>
For instance, if err:XPTY0004 were raised during DEP ("the dynamic type of a value does not match a required type"),
the response would be:

<a name='anchor47'></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 409 Conflict
Content-Type: text/xml; charset="utf-8"
Content-Length: xxx

&lt;error xmlns="DAV:"&gt;
  &lt;WXS:XPath-error
      xmlns:WXS="urn:ietf:params:xml:ns:webdav-xml-search"&gt;
    &lt;err:XPTY0004 xmlns:err="http://www.w3.org/2005/xqt-errors"/&gt;
  &lt;/WXS:XPath-error&gt;
&lt;/error&gt;
</pre></div><p>

</p>
<p>the dynamic type of a value does not match a required type
</p>
<a name="XPath-predicate"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Numeric Predicates</h3>

<p>
"A step is a part of a path expression that generates a sequence of items and then filters the sequence 
by zero or more predicates" (Section 3.2.1 of <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>).
A step expression may be either a FilterExpr or an AxisExpr.

</p>
<p>
"A predicate consists of an expression, called a predicate expression, enclosed in square brackets. 
A predicate serves to filter a sequence, retaining some items and discarding others".
(Section 3.2.2 of <a class='info' href='#W3C.REC-xpath20-20070123'>[W3C.REC&#8209;xpath20&#8209;20070123]<span> (</span><span class='info'>Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;XML Path Language (XPath) 2.0,&rdquo; January&nbsp;2007.</span><span>)</span></a>)

</p>
<p>
Support for numeric predicates and other references to the context position 
-e.g. by evaluating the fn:position() function- depends on the sequence where the predicate applies.

</p>
<p>
Supporting numeric predicates in FilterExpr is OPTIONAL. 
If the step expression is an AxisStep, the requirement level depends on the specified axis. It is:
</p>
<p>
* NOT RECOMMENDED for the namespace and attribute axes, 
  because the relative order of elements within these axes is implementation-dependent. 
  <br />

* Always REQUIRED for the parent, self, and ancestor axes.
  <br />

* For the child, preceding-sibling and following-sibling axes: 
  RECOMMENDED if the sequence order is semantically meaningful, OPTIONAL otherwise.
  <br />

* Always OPTIONAL for the descendant, descendant-or-self, ancestor-or-self, preceding, and following axes.
  <br />
  
<a class='info' href='#comment.note-context-position'>[note-context-position]<span> (</span><span class='info'>When supporting numeric predicates and context position references there is a trade-off between expressive power and implementation costs.</span><span>)</span></a><a name='note-context-position'></a>

</p>
<p>The way this feature is supported when it is not REQUIRED is implementation-dependent.
</p>
<a name="discovery"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Discovery of the Query Grammar</h3>

<p>
If a resource supports the SEARCH method, then the server MUST list SEARCH in the Allow header,
as described in Section 3.1 of <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>.

</p>
<a name="DASL-header"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
The DASL Response Header</h3>

<p>The DASL response header indicates server support for a query grammar in the OPTIONS method. 
(Section 3.2 of <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>)
The value of this header is a URI that indicates the type of grammar supported. 

Servers MUST return the following header when the 
OPTIONS method is invoked on any arbiter that supports the WXS:xml-search grammar:
</p><a name='anchor48'></a>
<p>   DASL:&lt;urn:ietf:params:xml:ns:webdav-xml-search&gt;
</p>
<a name="DAV:sqgs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
DAV:supported-query-grammar-set</h3>

<p>The WebDAV property DAV:supported-query-grammar-set is REQUIRED for any server supporting either 
<a class='info' href='#RFC3253'>[RFC3253]<span> (</span><span class='info'>Clemm, G., Amsden, J., Ellison, T., Kaler, C., and J. Whitehead, &ldquo;Versioning Extensions to WebDAV (Web Distributed Authoring and Versioning),&rdquo; March&nbsp;2002.</span><span>)</span></a> and/or <a class='info' href='#RFC3744'>[RFC3744]<span> (</span><span class='info'>Clemm, G., Reschke, J., Sedlar, E., and J. Whitehead, &ldquo;Web Distributed Authoring and Versioning (WebDAV) Access Control Protocol,&rdquo; May&nbsp;2004.</span><span>)</span></a> and identifies the XML based query grammars that 
are supported by the search arbiter resource (Section 3.3 of <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>). 

Servers implementing DAV:supported-query-grammar-set MUST report the following grammar
for each arbiter resource supporting WXS:xml-search:<br />
 

<a name='anchor49'></a> 
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;DAV:grammar xmlns:DAV="DAV:"&gt;
  &lt;WXS:xml-search
    xmlns:WXS="urn:ietf:params:xml:ns:webdav-xml-search"/&gt;
&lt;/DAV:grammar&gt;</pre></div><p>


</p>
<a name="QSD-intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Discovery of the WXS:xml-search Query Schema</h3>

<p>
Query Schema Discovery (QSD) is requested by means of the SEARCH method, including an entity with a DAV:query-schema-discovery root element.
As specified in Section 4.1 of <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>,
the response body takes the form of a DAV:multistatus element (Section 13 of <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>), 
where DAV:response is extended to hold the returned query grammar inside a DAV:query-schema container element. 

</p>
<p>
If the DAV:query-schema-discovery element contains WXS:xml-search, then the response marshaling MUST be performed as described in this section
and <a class='info' href='#QSD'>Section&nbsp;5<span> (</span><span class='info'>Query Schema for WXS:xml-search</span><span>)</span></a>.

</p>
<p>
Since the supported query grammars may depend on the scope,
the WXS:xml-search element (when used for QSD) MAY contain a DAV:from element. 
Other content is unexpected in this context.

</p>
<p>If several scopes are specified and the server supports multiple scopes,
then the response MUST only contain those descriptions that are common to each scope. 

</p>
<p><a name='anchor50'></a> 
Request:
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
SEARCH / HTTP/1.1
Host: host.example
Content-Type: application/xml
Content-Length: xxx

&lt;query-schema-discovery xmlns="DAV:"&gt;
  &lt;WXS:xml-search
    xmlns:WXS="urn:ietf:params:xml:ns:webdav-xml-search"/&gt;
&lt;/query-schema-discovery&gt;
</pre></div><p>


</p>
<p><a name='anchor51'></a> 
Response:
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 207 Multistatus
Content-Type: application/xml
Content-Length: xxx

&lt;multistatus xmlns="DAV:"&gt;
  &lt;response&gt;
    &lt;href&gt;http://host.example&lt;/href&gt;
    &lt;status&gt;HTTP/1.1 200 OK&lt;/status&gt;
    &lt;query-schema&gt;
      &lt;WXS:xml-search-schema
        xmlns:WXS="urn:ietf:params:xml:ns:webdav-xml-search"/&gt;
        &lt;!-- (See Section 5 for the actual contents) --&gt;
      &lt;/WXS:xml-search-schema&gt;
    &lt;/query-schema&gt;
  &lt;/response&gt;
&lt;/multistatus&gt;
</pre></div><p>


</p>
<a name="grammar"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
The WXS:xml-search Grammar</h3>

<p> 
The elements used in WXS:xml-search conform the semantics given in <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>
for the DAV:basicsearch grammar, and all the operators defined in Section 5 of <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a> 
(i.e. %all_ops;) are valid in the context of a WXS:xml-search query. 
Additionally, some elements in the "DAV:" namespace are allowed to contain 
specific elements from the WXS:xml-search grammar.

</p>
<p>Therefore, the semantics of a DAV:basicsearch valid query is preserved when the 
DAV:basicsearch content is submitted as a WXS:xml-search query.

</p>
<p> This grammar also allows the additional element WXS:filter as well as optional implementation-defined operators.
The WXS:filter element specifies an XPath expression (rooted on a single property, i.e. the root element is the property 
whose name is included in the DAV:prop element). It is both a query-operator and a special construct valid within 
DAV:select and DAV:order elements.

</p>
<p>
<a name='anchor52'></a>
<a name='anchor53'></a>
<a name='anchor54'></a>
<a name='anchor55'></a>
<a name='anchor56'></a>
<a name='anchor57'></a>
<a name='anchor58'></a>
<a name='anchor59'></a>
<a name='anchor60'></a>
<a name='anchor61'></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;!-- "WXS:xml-search" element --&gt;
&lt;!ELEMENT WXS:xml-search (select?, from, where?, orderby?, limit?) &gt;

&lt;!-- "DAV:select" element --&gt;
&lt;!ELEMENT select     ( (allprop | prop | WXS:filter)+ )&gt;
&lt;!ELEMENT WXS:filter  (prop, WXS:XPath)&gt;
&lt;!ELEMENT WXS:XPath    #PCDATA &gt;

&lt;!-- "DAV:where" element --&gt;
&lt;!ENTITY % ext_ops "WXS:filter | WXS:is-well-formed" &gt;
&lt;!ELEMENT where       (  %all_ops;|%ext_ops;)      &gt;

&lt;!ELEMENT not         (  %all_ops;|%ext_ops;   )   &gt;
&lt;!ELEMENT and         ( (%all_ops;|%ext_ops;)+ )   &gt;
&lt;!ELEMENT or          ( (%all_ops;|%ext_ops;)+ )   &gt;

&lt;!ELEMENT WXS:is-well-formed ( prop )               &gt;

&lt;!-- "DAV:order" element for WXS:xml-search--&gt;

&lt;!ELEMENT order      ((prop | score | WXS:filter),
                      (ascending | descending)?)

</pre></div><p>

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Accepted Role Precondition</h3>

<p>
If the WXS:xml-search request includes a property with a role which is not acceptable (e.g. 
the request specifies a filtered selection of a property which is not XPath-enabled
or it specifies ordering by a non-sortable property), the server MUST reply with a 422 
(Unprocessable Entity) status code.

The response's DAV:error element MUST contain at least one WXS:acceptable-role preconditions 
(<a class='info' href='#preconditions'>Section&nbsp;4.8<span> (</span><span class='info'>Precondition and postcondition Codes</span><span>)</span></a>) describing the failure for each rejected property.
</p>
<p>If the request is not accepted because of a WXS:acceptable-role precondition, 
the server SHOULD report all the failures, so that if the client removes the conflicting 
properties then the modified query will succeed this test.
</p>
<p>If a property violates the preconditions for a role in both plain and filtered forms, 
then the filtered form MAY be omitted in the error response. (This rule does not applies for DAV:selectable 
since a property may not be specified for both plain and filtered selection in the same request).
</p>
<p>Rejections because of several reasons (e.g. because a property is neither DAV:searchable nor DAV:selectable) 
MAY be reported by means of a single WXS:acceptable-role element.
The DAV:prop element within WXS:acceptable-role must contain a single property element.
</p>
<p>
If QSD is supported, a property used in a role described in the QSD response for the search scopes
MUST NOT be rejected.

</p>
<p>When a WXS:filter element refers to a live property that is known not to be well-formed XML 
(because the XML syntax is not enforced for that property), the server SHOULD reject the request 
as described in this section, instead of accepting the query and reporting a 409 (Conflict) for each occurrence.
(This implies that, if such property is mentioned in the QSD, its description SHOULD NOT include any XPath-enabled role.)

</p>
<a name="DAV:select"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Selection</h3>

<p>
DAV:select defines the result record, which is a set of properties and values (Section 5.3 of <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>). 
The allowed children are DAV:allprop and DAV:prop (defined in Section 14 of <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>) and WXS:filter (defined in this document).

</p>
<p>
If the DAV:select element is omitted, the successful response MUST only contain the URIs of matched resources 
in one or more DAV:response elements with status code 204 (No content). The response root element is DAV:multistatus.

If an error occurs, it MUST be reported as described for the non-empty case.

</p>
<p>The rest of this section describes the handling of non-empty DAV:select elements
</p>
<p>
For each resource matching the query criteria and scope, the results from all the WXS:filter selection-elements 
(i.e all the WXS:filter elements included within a DAV:select element) referred to the same property MUST be returned 
into a single property of the DAV:response. 
Because of filtering, the response is not required to be valid even if the selected property contains an XML document 
that is valid according to some DTD or XML schema.
</p>
<p>For each resource matching the query criteria and scope, and for each property selected through WXS:filter:
</p>
<p>- When the actual property value does not contain a well-formed XML fragment, a DAV:propstat with 409 
(Conflict) code and postcondition code WXS:property-must-be-well-formed-xml MUST be returned for that resource and property 
(since the query semantics is not appropriate for the actual property value).

</p>
<p>- If the actual property value contains a well-formed XML fragment, the matched elements are aggregated into the XML fragment 
for that property and resource.
</p>
<p>- If no elements are matched for that property and resource, it will be reported as an empty element. 

</p>
<p>If a property does not exist, the server MUST either omit the selected property from that resource record-set
or return it within a 404 (Not Found) status code DAV:propstat.<a class='info' href='#comment.note-OPTIONAL-404'>[note-OPTIONAL-404]<span> (</span><span class='info'>The 404 status code for missing properties is OPTIONAL in order to avoid an extensive response if the client selects several properties that are seldom defined.  Note this behaviour is different from the PROPFIND case, where the 404 status code is REQUIRED for missing properties (Section 9.1 of [RFC 4918], page 35).</span><span>)</span></a><a name='note-OPTIONAL-404'></a>

</p>
<p>rop, a DAV:score or a WXS:filter elements.&lt;/t&gt;&lt;t&gt;&#13;
When DAV:order contains a DAV:prop element, guous (or, in the best case, redundant) 
<a class='info' href='#comment.note-select-prop-filter'>[note-select-prop-filter]<span> (</span><span class='info'>If the property value is not well-formed XML specifying both DAV:prop and WXS:filter is ambiguous because a 409 (Conflict) status code must be returned per WXS:filter and the complete property value must be returned per DAV:prop.  On the other hand, if the property value were well-formed XML, one of those elements would have to be ignored.</span><span>)</span></a><a name='note-select-prop-filter'></a>.

Hence, if DAV:select contains one or more WXS:filter elements 
referring a property that is also selected via a plain DAV:prop element, 
the server MUST return a 400 (Bad Request) response. 
</p>
<p>For instance, the following DAV:select element causes a 400 response:
</p><a name='anchor62'></a>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;select xmlns="DAV:"&gt;
   &lt;filter&gt;
    &lt;prop xmlns:A="http://a.example/"/&gt;
      &lt;A:property/&gt;
    &lt;/prop&gt;
    &lt;XPath&gt;//foo&lt;/XPath&gt;
  &lt;/filter&gt;
  &lt;prop xmlns:A="http://a.example/"/&gt;
      &lt;A:property/&gt;
  &lt;/prop&gt;
&lt;/select&gt;
</pre></div><p>

</p>
<p>
If DAV:allprop is specified, it is understood as in a PROPFIND request <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>:
(i.e., properties defined in RFC 4918, at a minimum, plus dead properties MUST be returned).
Hence, the set of properties selected by allprop vary from resource to resource.
</p>
<p>
If the request includes not only DAV:allprop but also one or more DAV:prop elements specifying properties which 
are already returned per DAV:allprop, or the request includes a property twice in DAV:prop elements, 
then the redundant properties MUST be ignored (i.e. a single property value will be returned). 
This behaviour is similar to that of the DAV:include element in a PROPFIND request (but DAV:include is not defined
for WXS:xml-search requests).

</p>
<p>
There is no error when a property that would be returned per DAV:allprop is also specified within a WXS:filter element
(since the client may not be aware of the properties that will be returned when DAV:allprop is specified).
This combination MUST be addressed as follows:<br />

    - The WXS:filter elements are processed as usual. This result in properties contained in DAV:propstat; 
elements with status code 200, 4xx or 5xx (as appropriate).<br />

    - Each property that would have been returned per DAV:allprop in a PROPFIND request
and was not included within a WXS:filter element, is selected.<br />


</p>
<a name="DAV:where"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Query criteria</h3>

<p>The DAV:where element specifies optional query criteria.
Only those resources that verify the query criteria
are included in the result set.

</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1"></a><h3>4.3.1.&nbsp;
DAV:prop operand</h3>

<p>
The result of the DAV:prop operand is the value of the specified property of the resource being evaluated.
If the property is a live one, the result datatype SHOULD be the actual property datatype.
If the property is dead, or the server chooses to ignore the live property datatype, the result MUST be
of type xs:string.

</p>
<p>
Note: "A property name is a universally unique identifier that is associated with a schema that provides information about the syntax and
semantics of the property" (Section 4.4 of <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>). Therefore, each property name SHOULD be permanently associated 
with at most one datatype.

</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.2"></a><h3>4.3.2.&nbsp;
Literal Operands</h3>

<p>DAV:literal and DAV:typed-literal allow literal values to be placed in an expression.
</p>
<p>
When used with the operators defined in <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>:<br />

   - The type of a DAV:literal value MUST be the type of the other operand in the expression.<br />

   - The type of a DAV:typed-literal value MUST be the type specified in the xsi:type attribute, or 
xs:string if no type was specified. The value of the other operand MUST be casted to this type.

</p>
<p>
A request with a DAV:typed-literal specifying an unknown type MUST be rejected
 by returning a response with status code 422 (Unprocessable Entity) 
 and precondition code WXS:known-literal-type.
 The xs:string type MUST NOT be unknown.

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.3"></a><h3>4.3.3.&nbsp;
Relational operators</h3>

<p>
The relational operators take a property and literal operand.
WXS:xml-search inherits the five relational operators defined in <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>:
DAV:eq, DAV:lt, DAV:gt, DAV:lte and DAV:gte.

</p>
<p>For each property and pair of values being compared:<br />

   - per Section 4.2.1 of <a class='info' href='#W3C.REC-xmlschema-2-20041028'>[W3C.REC&#8209;xmlschema&#8209;2&#8209;20041028]<span> (</span><span class='info'>Malhotra, A. and P. Biron, &ldquo;XML Schema Part 2: Datatypes Second Edition,&rdquo; October&nbsp;2004.</span><span>)</span></a> the result of 
DAV:eq; is always defined, then DAV:eq; MUST NOT return NULL.<br />

   - all of DAV:lt, DAV:gt, DAV:lte and DAV:gte MUST be either undefined or consistently defined.
If they are defined, they MUST also conform the result of DAV:eq (i.e., A == B iff A&lt;=B and A&gt;=B).

</p>
<p>
If the property type is known and it is a complex type, the result of these operations SHOULD be undefined.
<a class='info' href='#comment.note-comparison-complex-type'>[note-comparison-complex-type]<span> (</span><span class='info'>This seems to be a MUST in [draft-reschke-webdav-search-14] Section 5.5.4, but is relaxed here since the property would be treated as xs:string if the type were ignored.</span><span>)</span></a><a name='note-comparison-complex-type'></a>
(Values within such properties may be compared by means of XPath predicates.)

</p>
<p> 
If the property type is known and it is a simple built-in ordered type, the order relation used in the comparison 
SHOULD be that defined in <a class='info' href='#W3C.REC-xmlschema-2-20041028'>[W3C.REC&#8209;xmlschema&#8209;2&#8209;20041028]<span> (</span><span class='info'>Malhotra, A. and P. Biron, &ldquo;XML Schema Part 2: Datatypes Second Edition,&rdquo; October&nbsp;2004.</span><span>)</span></a>.     

</p>
<p>If the property type is known and it is a simple type, 
an implementation-dependent order relation MAY be used.
If a partial order is used, then trying to compare two values which are not comparable yields an undefined result.

</p>
<p>
In any case, the collation algorithm is implementation-dependent.

</p>
<p>
 Other operators and operands retain the behaviours defined in <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>.

</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.4"></a><h3>4.3.4.&nbsp;
The WXS:filter operator</h3>

<p>When used inside a DAV:where element (or a sub-element thereof) WXS:filter evaluates as:<br />

   - TRUE if (and only if)  the XPath expression matches at least one element,<br />

   - FALSE if (and only if) no element within the property is matched,<br />

   - NULL if (and only if)  the property does not exist or its value is not a well-formed XML fragment. 

</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.5"></a><h3>4.3.5.&nbsp;
The WXS:is-well-formed operator</h3>

<p>The WXS:is-well-formed operator takes a DAV:prop operand
and returns:<br />

   - TRUE if (and only if)  the property value is a well formed XML fragment.<br />

   - FALSE if (and only if) the property value is not a well formed XML fragment.<br />

   - NULL if (and only if)  the property does not exist. 

</p>
<p>Supporting this operator is REQUIRED for properties which are WXS:searchable, and OPTIONAL 
for properties which are only DAV:searchable.

</p>
<a name="DAV:orderby"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Ordering</h3>

<p>
DAV:orderby specifies a lexicographical order on the set of DAV:response to be returned.
Comparisons are applied as they occur in the DAV:orderby element, earlier comparisons being more significant
(Section 5.6 of <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>).

</p>
<p>When used within WXS:xml-search, a DAV:orderby element MUST contain one or more DAV:order elements, 
which are allowed to contain a DAV:prop, a DAV:score or a WXS:filter elements.
</p>
<p>ption rules (WX contains a DAV:prop element, the ascending (alternatively, descending) order MUST be consistent with the comparison 
performed by DAV:lte (alternatively, DAV:gte):<br />

 - If A&lt;=B (alternatively, A&gt;=B) according to DAV:lte, then A collates before B.<br />

 - If A&lt;=B (alternatively, A&gt;=B) is undefined, then the collation order is implementation-dependent.<br />


</p>
<p>When DAV:order contains a DAV:score element, an integer comparison is performed on each DAV:score value 
computed for the DAV:contains operation.

</p>
<p>When DAV:order contains a WXS:filter element, result-sets will be 
logically partitioned in three equivalence classes, based on the evaluation of WXS:filter 
(as defined in <a class='info' href='#DAV:where'>Section&nbsp;4.3<span> (</span><span class='info'>Query criteria</span><span>)</span></a>). The equivalence classes are totally ordered (in ascending order) as: 
NULL &lt; false &lt; true.

</p>
<p>Ordering within each equivalence class (i.e. ordering among all the responses for which the WXS:filter element evaluates to the same value)
is implementation-dependent. (The order specified for the item-type in the sequence returned by the xpath expression 
MAY be used.)
</p>
<a name="status_code"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
SEARCH Status Codes for responses to WXS:xml-search queries</h3>

<p>
   - 207 (Multistatus) The server accepted the request. The result set are returned within a 
DAV:multistatus; element. <br />

   - 400 (Bad Request) Error in SAP, or the query includes both a plain DAV:prop and a WXS:filter specifying the same property name.<br />

   - 403 (Forbidden)   The server rejected the request because the user has no privileges for performing queries under the specified arbiter resource.<br />

   - 404 (Not found)   The arbiter resource does not exist.<br />

   - 409 (Conflict)    Error in DEP (general failure) or invalid scope.<br />

   - 422 (Unprocessable Entity) <br />

       A property was specified in a role which is rejected for that property. <br />

       An unknown type was specified in DAV:typed-literal.<br />

       A required extension is not supported.<br />


</p>
<p>Other status codes may be returned (redirections, client errors, server errors), with the meaning defined in <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>.
</p>
<p>The 207 status code MUST be used if and only if a result set is included in the response 
(an empty result set is allowed if the query does not match any resource).
</p>
<p>If the query could not be performed because of several errors, 
the error which is reported is implementation-dependent.
</p>
<p>If the client has no privileges for testing whether the arbiter exists 
then 403 (Forbidden) SHOULD be used instead of 404 (Not found).
If the client has no privileges for accessing the specified scope then 409 (Conflict) MUST be returned

</p>
<a name="status_code_response"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
Status Codes for Use in 'response' Elements</h3>

<p>
   - 204 (No Content) if the resource exists and no selection list was specified 
(i.e. the DAV:select element is empty).<br />

   - 209 (Conflict) Error in DEP. The search was invalidated for 
resources identified by DAV:href elements in the response.
</p>
<p>If a selection list was specified, the response MUST NOT contain a DAV:status element, 
but a DAV:propstat listing the selected properties.
</p>
<p>If the client has no privileges for testing whether a resource exists, 
that resource MUST be silently omitted from the response.
</p>
<p>5xx status codes MAY be used if a error occurs when accessing the resource.
</p>
<a name="status_code_propstat"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7"></a><h3>4.7.&nbsp;
Status Codes for Use in 'propstat' Elements</h3>

<p>
   - 200 (OK) for each selected property, if the property exists.<br />

   - 403 (Forbidden) if the client has no privileges for accessing the selected property.<br />

   - 404 (Not Found) for each property selected through DAV:allprop, DAV:prop or WXS:filter if the property does not exist (OPTIONAL).<br />

   - 409 (Conflict) if a property specified in a selection WXS:filter element does not contains well-formed XML.
The associated postcondition MUST be WXS:property-must-be-well-formed-xml.

</p>
<p>If the client has no privileges for testing whether the property exists, the server SHOULD either omit the property or return a 404 (Not found) status code (instead of 403).
</p>
<p>5xx status codes MAY be used if a error occurs when accessing the property value.
</p>
<a name="preconditions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.8"></a><h3>4.8.&nbsp;
Precondition and postcondition Codes</h3>

<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.8.1"></a><h3>4.8.1.&nbsp;
WXS:property-must-be-well-formed-xml</h3>
<a name='anchor63'></a>
<p><br />

</p>
<p>Type: postcondition
</p>
<p>Use with: /multistatus/response/propstat/error, 409 Conflict
</p>
<p>Purpose: the actual property value does not contain a well-formed XML fragment, 
and the property was specified in a WXS:filter element.
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;!ELEMENT WXS:property-must-be-well-formed-xml EMPTY&gt;
</pre></div><p>

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.8.2"></a><h3>4.8.2.&nbsp;
WXS:acceptable-role</h3>
<a name='anchor64'></a>
<p><br />

</p>
<p>Type: precondition
</p>
<p>Use with: /error, 422 Unprocessable Entity
</p>
<p>Purpose: the WXS:xml-search request includes a property for a role where it is not acceptable.
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;!ELEMENT WXS:acceptable-role (prop, searchable?,
                              selectable?, sortable?)&gt;
</pre></div><p>

</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.8.3"></a><h3>4.8.3.&nbsp;
WXS:XPath-error</h3>
<a name='anchor65'></a>
<p><br />

</p>
<p>Type:  precondition/postcondition
</p>
<p>Use with:<br />

   /error, 400 Bad Request (precondition)<br />

   /error, 409 Conflict (precondition)<br />

   /multistatus/response/error, 409 Conflict (postcondition)<br />

   /multistatus/response/propstat/error, 409 Conflict (postcondition)
</p>
<p>Purpose: The query includes an XPath expression that raises an error.
</p>
<p>(see <a class='info' href='#XPath-errors'>Section&nbsp;2.2<span> (</span><span class='info'>Error and warnings</span><span>)</span></a>.)
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.8.4"></a><h3>4.8.4.&nbsp;
DAV:search-scope-valid</h3>
<a name='anchor66'></a>
<p><br />

</p>
<p>Type:  precondition
</p>
<p>Use with: /error, 409 Conflict
</p>
<p>Defined in <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.8.5"></a><h3>4.8.5.&nbsp;
WXS:known-literal-type</h3>
<a name='anchor67'></a>
<p><br />

</p>
<p>Type:  precondition
</p>
<p>Use with: /error, 422 Unprocessable Entity
</p>
<p>Purpose: The query includes a DAV:typed-literal which specifies an unknown data-type. 
The data-type name is included into the element content.
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;!ELEMENT WXS:known-literal-type #PCDATA&gt;
</pre></div><p>

</p>
<a name="QSD"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Query Schema for WXS:xml-search</h3>

<p>The query schema provides information about the set of available properties and implemented operators.
</p>
<p>The query schema is marshaled within a WXS:xml-search-schema element. This element contains an unordered set of
property descriptions (DAV:propdesc), operator description rules (WXS:opdesc-rule) and supported optional functions (WXS:function-set).
</p><a name='anchor68'></a><a name='anchor69'></a><a name='anchor70'></a><a name='anchor71'></a><a name='anchor72'></a>
<p> 
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;!ELEMENT WXS:xml-search-schema  (propdesc|WXS:opdesc-rule
                                 |WXS:function-set)* ) &gt;
</pre></div><p>

</p>
<a name="QSD-prop"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Property descriptions</h3>

<p>The semantics of DAV:propdesc, when used within a WXS:xml-search-schema is extended for describing 
whether a property may be used as root element of a XPath expression within a WXS:filter element.
</p>
<p>
Since WXS:filter may appear in three different places (the record-set definition, the query criteria and the ordering criteria), 
the server may allow or disallow it on a separate basis. If WXS:selectable, WXS:searchable or WXS:sortable is present, then the server MUST allow 
this property to be used within a WXS:filter element in the applicable context (role)

</p><a name='anchor73'></a><a name='anchor74'></a><a name='anchor75'></a><a name='anchor76'></a><a name='anchor77'></a>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;!ELEMENT propdesc           (prop|any-other-property), datatype?,
                             (searchable | WXS:searchable)?,
                             (selectable | WXS:selectable)?,
                             (sortable   | WXS:sortable?),
                              caseless?,
                              WXS:axis*, WXS:function-set* &gt;


&lt;!ELEMENT WXS:selectable       EMPTY &gt;
&lt;!ELEMENT WXS:searchable       EMPTY &gt;
&lt;!ELEMENT WXS:sortable         EMPTY &gt;

&lt;!ELEMENT WXS:axis EMPTY&gt;
&lt;!ATTLIST WXS:axis name (namespace |
                  | ancestor | ancestor-or-self
                  | following  | following-sibling
                  | preceding | preceding-sibling) #REQUIRED&gt;
</pre></div><p>

</p>
<p>Properties which are WXS:selectable or WXS:searchable are also DAV:selectable or DAV:searchable respectively.
For instance, if a property may be selected through a XPath expression then it is plainly selectable,
and if a property may be used within a WXS:filter query criterion then it may be used as an operand of DAV:is-defined, DAV:is-well-formed. 

</p>
<p>
Properties which are WXS:sortable are not DAV:sortable, because comparison of complex types is undefined.
Properties MUST NOT be DAV:sortable and WXS:sortable at the same time. 
</p>
<p>
The server MUST allow described properties to be used in the role for which they were advertised.
This hint does not assert whether the property is defined on every resource in the scope,
and does not assert whether the property value is well-formed XML.

</p>
<p>There SHOULD be one description for DAV:any-other-property. There MUST NOT be
more than one description for each property, and one description for DAV:any-other-property.

</p>
<p>The "name" attribute of the WXS:axis element specifies the name of an optional axis,
and the WXS:function-set element (Section <a class='info' href='#QSD-function'>Section&nbsp;5.3<span> (</span><span class='info'>Supporting Optional Functions</span><span>)</span></a>)
specifies optional functions, which the server supports for the property being described.

</p>
<a name="QSD-op"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Operator descriptions</h3>

<p>
Operators are described in a way that borrows some elements from ABNF <a class='info' href='#RFC4234'>[RFC4234]<span> (</span><span class='info'>Crocker, D., Ed. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; October&nbsp;2005.</span><span>)</span></a> (namely repetitions and alternatives).
This approach allows a flexible and compact description of operators.

<a class='info' href='#comment.note-opdesc'>[note-opdesc]<span> (</span><span class='info'>The operator description is only intended for discovering whether the server implements an extension operator. The DAV:operators element from [I-D.reschke-webdav-search] is not adopted here,  because it cannot describe the mandatory operators. On the other hand, while XML Schemas would have sufficed for this purpose,  this approach would have required WXS:xml-search clients to be in conformance to the XML Representation of Schemas, which is much more than necessary for achieving the above mentioned goal (given that the operators are not too complex). The chosen approach is compared to ABNF, in order to avoid further relation with features that are available in XML schemas.</span><span>)</span></a><a name='note-opdesc'></a>

</p><a name='anchor78'></a><a name='anchor79'></a><a name='anchor80'></a><a name='anchor81'></a><a name='anchor82'></a><a name='anchor83'></a>
<p>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;!-- "WXS:operator" element --&gt;
&lt;!ELEMENT WXS:operator             EMPTY               &gt;
&lt;!ATTLIST WXS:operator name        NAME   #REQUIRED    &gt;
&lt;!ATTLIST WXS:operator namespace   CDATA
   "urn:ietf:params:xml:ns:webdav-xml-search"         &gt;


&lt;!-- terminal elements --&gt;
&lt;!ENTITY  % WXS:terminal       (operand-literal|
                               operand-typed-literal|
                               operand-property|
                               WXS:operand-XPath|
                               WXS:operand-nested-op) &gt;

&lt;!ELEMENT WXS:operand-XPath       EMPTY&gt;
&lt;!ELEMENT WXS:operand-nested-op   EMPTY&gt;

&lt;!-- content model description--&gt;
&lt;!ELEMENT WXS:opdesc-rule (WXS:operator+,
                          (WXS:alternative|WXS:repetition|
                           %terminal;)*
)&gt;

&lt;!ELEMENT WXS:alternative (WXS:repetition|%terminal;)&gt;

&lt;!ELEMENT WXS:repetition  (WXS:alternative|WXS:repetition|
                           %terminal;)* &gt;
&lt;!ATTLIST WXS:repetition   atleast    CDATA "0" &gt;
&lt;!ATTLIST WXS:repetition   atmost     CDATA "infinity" &gt;
</pre></div><p>

</p>
<a name="DAV:opdesc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
WXS:opdesc-rule and WXS:operator</h3>

<p>WXS:operator references the name of an operator. Several operators may be defined by the same WXS:opdesc-rule, and 
several WXS:opdesc-rule may define incremental alternatives (that is, an initial rule may match one or more
alternatives, with later rule definitions adding to the set of alternatives, as in the ABNF construction Rule1 =/ Rule2 defined in
section 3.3 of <a class='info' href='#RFC4234'>[RFC4234]<span> (</span><span class='info'>Crocker, D., Ed. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; October&nbsp;2005.</span><span>)</span></a>).

</p>
<p>

For instance,

<a name='anchor84'></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;opdesc-rule&gt;
    &lt;operator name="lt" namespace="DAV:"/&gt;
    &lt;operator name="gt" namespace="DAV:"/&gt;
    &lt;operand-property/&gt;
    &lt;alternative&gt;
      &lt;operand-literal/&gt;
      &lt;operand-typed-literal/&gt;
    &lt;/alternative&gt;
  &lt;/opdesc-rule&gt;
</pre></div><p>
 

is equivalent to

<a name='anchor85'></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;opdesc-rule&gt;
    &lt;operator name="lt" namespace="DAV:"/&gt;
    &lt;operand-property/&gt;
    &lt;operand-literal/&gt;
  &lt;Eledesc-rule&gt;

  &lt;opdesc-rule&gt;
    &lt;operator name="lt" namespace="DAV:"/&gt;
    &lt;operand-property/&gt;
    &lt;operand-typed-literal/&gt;
  &lt;/opdesc-rule&gt;

  &lt;opdesc-rule&gt;
    &lt;operator name="gt" namespace="DAV:"/&gt;
    &lt;operand-property/&gt;
    &lt;operand-literal/&gt;
  &lt;/opdesc-rule&gt;

  &lt;opdesc-rule&gt;
    &lt;operator name="gt" namespace="DAV:"/&gt;
    &lt;operand-property/&gt;
    &lt;operand-typed-literal/&gt;
  &lt;/opdesc-rule&gt;
</pre></div><p>


</p>
<p>
Mandatory operators SHOULD be omitted from the actual schema returned by a server (since their grammar is implied).
If an operator is defined or enhanced by an extension of this protocol, the server MUST return rules 
(i.e. one or more WXS:opdesc-rule elements) for them. If the enhanced operator is a mandatory one, then the alternative rule applies. Hence, if
the response includes 

<a name='anchor86'></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;opdesc-rule&gt;
    &lt;operator name="eq" namespace="DAV:"/&gt;
    &lt;operand-property/&gt;
    &lt;FOO:operand-bar xmlns:FOO="http://foo.example/"/&gt;
  &lt;/opdesc-rule&gt;
</pre></div><p>


it means that the DAV:eq operator accepts a pair of (property, foo:bar) operands, 
as well as it accepts the above-defined (property, literal) and (property, typed-literal) alternatives (from the implicit grammar).

</p>
<p>The order in which operands are described is significant, 
because the ordering of operands within a expression is significant.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
WXS:repetition</h3>

<p>The semantics of element WXS:repetition is similar to the ABNF Variable Repetition (e.g: *Rule) defined in Section 3.6 of <a class='info' href='#RFC4234'>[RFC4234]<span> (</span><span class='info'>Crocker, D., Ed. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; October&nbsp;2005.</span><span>)</span></a>.
</p>
<p>The optional attributes "atleast" and "atmost" indicates minimum and maximum allowed occurrences of the described content.
</p>
<p>Default values are atleast="0" and atmost="infinity" so that 
&lt;WXS:repetition&gt; allows any number of occurrences, including zero;
&lt;WXS:repetition atleast="1"&gt; requires at least one, with no upper limit;
&lt;WXS:repetition atleast="3" atmost="3"&gt; allows exactly 3 and 
&lt;WXS:repetition atleast="1" atmost="2"&gt; allows one or two.

</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.3"></a><h3>5.2.3.&nbsp;
WXS:alternative</h3>

<p>The semantics of element WXS:alternative is similar to the ABNF Alternatives (e.g: Rule1 / Rule2) defined in Section 3.2 of <a class='info' href='#RFC4234'>[RFC4234]<span> (</span><span class='info'>Crocker, D., Ed. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; October&nbsp;2005.</span><span>)</span></a>.
</p>
<p>For instance, &lt;WXS:alternative&gt; &lt;WXS:operand-literal/&gt; &lt;WXS:operand-typed-literal/&gt; &lt;/WXS:alternative&gt; will accept either 
an operand-typed-literal or an operand-literal but not both.

</p>
<a name="query-schema"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.4"></a><h3>5.2.4.&nbsp;
Implied operator description</h3>

<p>The following query schema describes the operators specified in this document, 
as well as the operators from <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>,
as they would be reported in a QSD response.
</p>
<p>
This description is implied, i.e. servers SHOULD NOT include it in the response 
because these operators with these signatures are mandatory. 

</p>
<p><a name='anchor87'></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;search-schema xmlns="DAV:"

  &lt;WXS:opdesc-rule&gt;
    &lt;WXS:operator name="eq"  namespace="DAV:"/&gt;
    &lt;WXS:operator name="gt"  namespace="DAV:"/&gt;
    &lt;WXS:operator name="lt"  namespace="DAV:"/&gt;
    &lt;WXS:operator name="lte" namespace="DAV:"/&gt;
    &lt;WXS:operator name="gte" namespace="DAV:"/&gt;
    &lt;operand-property/&gt;
    &lt;operand-literal/&gt;
  &lt;/WXS:opdesc-rule&gt;

  &lt;WXS:opdesc-rule&gt;
    &lt;WXS:operator name="not" namespace="DAV:"/&gt;
    &lt;WXS:operand-nested-op/&gt;
  &lt;/WXS:opdesc-rule&gt;

  &lt;WXS:opdesc-rule&gt;
    &lt;WXS:operator name="and" namespace="DAV:"/&gt;
    &lt;WXS:operator name="or"  namespace="DAV:"/&gt;
    &lt;WXS:repetition atleast="1"&gt;
      &lt;WXS:operand-nested-op/&gt;
    &lt;/WXS:repetition&gt;
  &lt;/WXS:opdesc-rule&gt;

  &lt;WXS:opdesc-rule&gt;
    &lt;WXS:operator name="filter"/&gt;
    &lt;operand-property/&gt;
    &lt;WXS:operand-XPath/&gt;
  &lt;/WXS:opdesc-rule&gt;

  &lt;WXS:opdesc-rule&gt;
    &lt;WXS:operator name="is-defined" namespace="DAV:"/&gt;
    &lt;WXS:operator name="is-well-formed"/&gt;
    &lt;operand-property/&gt;
  &lt;/WXS:opdesc-rule&gt;

  &lt;WXS:opdesc-rule&gt;
    &lt;WXS:operator name="is-collection" namespace="DAV:"/&gt;
  &lt;/WXS:opdesc-rule&gt;

&lt;/search-schema&gt;
</pre></div><p>


</p>
<p>The DAV:is-collection operator is supported because WXS:xml-search extends DAV:basicsearch grammar. 
It can be expressed  by using WXS:filter as:
</p>
<p>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 &lt;WXS:filter&gt;
  &lt;prop&gt;&lt;resourcetype/&gt;&lt;/prop&gt;
  &lt;WXS:xpath&gt;/collection&lt;/WXS:xpath&gt;
 &lt;/WXS:filter&gt;
</pre></div><p>


</p>
<p>Tests for other resource types, as well as test for no resource type 
may be expressed by the WXS:filter operator (provided that DAV:resourcetype is WXS:searchable).
For instance, testing whether a resource has no resource type may be expressed as:

</p>
<p>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 &lt;WXS:filter&gt;
  &lt;prop&gt;&lt;resourcetype/&gt;&lt;/prop&gt;
  &lt;WXS:xpath&gt;count(/*)==0&lt;/WXS:xpath&gt;
 &lt;/WXS:filter&gt;
</pre></div><p>


</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.5"></a><h3>5.2.5.&nbsp;
Extended operator description for DAV:typed-literal Operand</h3>

<p>The DAV:eq, DAV:gt, DAV:lt, DAV:lte, and DAV:gte operators 
MAY accept a DAV:typed-literal operand, instead of DAV:literal. 
This alternative is not implied (i.e. if supported, it MUST be included in the QSD response). 
If  DAV:typed-literal were supported (as defined in <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>),
the QSD response would include the following rule:

</p>
<p><a name='anchor88'></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;WXS:opdesc-rule&gt;
    &lt;WXS:operator name="eq"  namespace="DAV:"/&gt;
    &lt;WXS:operator name="gt"  namespace="DAV:"/&gt;
    &lt;WXS:operator name="lt"  namespace="DAV:"/&gt;
    &lt;WXS:operator name="lte" namespace="DAV:"/&gt;
    &lt;WXS:operator name="gte" namespace="DAV:"/&gt;
    &lt;operand-property/&gt;
    &lt;operand-typed-literal/&gt;
  &lt;/WXS:opdesc-rule&gt;
</pre></div><p>


</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.6"></a><h3>5.2.6.&nbsp;
Description of DAV:like Operator</h3>

<p>If the DAV:like operator is supported (as described in Section 5.2.2 of <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>, 
the following rule MUST be included in the QSD:
</p>
<p><a name='anchor89'></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;WXS:opdesc-rule&gt;
    &lt;WXS:operator name="like"  namespace="DAV:"/&gt;
    &lt;operand-property/&gt;
    &lt;operand-literal/&gt;
  &lt;/WXS:opdesc-rule&gt;
</pre></div><p>


</p>
<a name="QSD-function"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Supporting Optional Functions</h3>
<a name='anchor90'></a><a name='anchor91'></a><a name='anchor92'></a><a name='anchor93'></a>
<p>Optional XPath functions supported by the server are described by means of one or more WXS:function-set elements.
The WXS:function-set element may occur:
</p>
<p> - As a child of WXS:xml-search-schema (with the "id" attribute setted) defining a set of functions (WXS:function elements) that may be referred from several properties.
</p>
<p> - As a child of DAV:propdesc, with the "id" and "idref" attributes implied, defining a set of functions (WXS:function elements) which is specific for the property being described.
</p>
<p> - As a child of DAV:propdesc, with the "idref" attribute pointing to a "global" WXS:xml-search-schema element.
</p>
<p>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;!ELEMENT WXS:function-set    (WXS:function*)&gt;

&lt;!ELEMENT WXS:function        (WXS:function-param*,
                               WXS:function-result?)&gt;
&lt;!ELEMENT WXS:function-param   EMPTY &gt;
&lt;!ELEMENT WXS:function-result  EMPTY &gt;

&lt;!ATTLIST WXS:function-set    id    ID      #IMPLIED&gt;
&lt;!ATTLIST WXS:function-set    idref IDREF   #IMPLIED&gt;
&lt;!ATTLIST WXS:function        name  NMTOKEN #REQUIRED&gt;

&lt;!ATTLIST WXS:function-param  type        CDATA #REQUIRED
                              cardinality CDATA #IMPLIED
                              repeatable (true|false) false&gt;

&lt;!ATTLIST WXS:function-result type        CDATA #REQUIRED
                              cardinality CDATA #IMPLIED&gt;
&gt;

</pre></div><p>

</p>
<p>
Each WXS:function element contains zero or more WXS:function-param elements, and zero or one WXS:function-result element,
describing the data type of function's parameters and result.

</p>
<p>
The "name" attribute of WXS:function represents the name of the function being described.

</p>
<p>
The "type" attribute of WXS:function-param and WXS:function-result 
specifies the data type of one function parameter, or the data type of the function result, respectively.

</p>
<p>
The "cardinality" attribute is used for specifying the cardinality of the sequence accepted as parameter or returned as a result.
Its allowed values are "?" (zero or one), "*" (zero or more) and "+" (one or more), as specified in
Section 1.4 of <a class='info' href='#W3C.REC-xpath-functions-20070123'>[W3C.REC&#8209;xpath&#8209;functions&#8209;20070123]<span> (</span><span class='info'>Walsh, N., Malhotra, A., and J. Melton, &ldquo;XQuery 1.0 and XPath 2.0 Functions and Operators,&rdquo; January&nbsp;2007.</span><span>)</span></a>. 

</p>
<p>
The "repeatable" attribute is used for specifying whether a parameter may be specified several times.
It allows the values "true" and "false", defaulting to "false" when not present. 
(Note: cardinality="*" states that the actual parameter value may be a sequence containing several instances of the specified type,
thus it is different from repeatable="true".)

</p>
<p>
Function name prefixes and type name prefixes are interpreted according to the namespaces in scope.
For this purpose, the item type, the node types -e.g. node, element- <a class='info' href='#W3C.REC-xpath-datamodel-20070123'>[W3C.REC&#8209;xpath&#8209;datamodel&#8209;20070123]<span> (</span><span class='info'>Fernández, M., Malhotra, A., Nagy, M., Walsh, N., and J. Marsh, &ldquo;XQuery 1.0 and XPath 2.0 Data Model (XDM),&rdquo; January&nbsp;2007.</span><span>)</span></a> 
and the pseudo-type "numeric" (a shorthand for xs:integer, xs:decimal, xs:float and xs:double, defined in Section 1.4 of <a class='info' href='#W3C.REC-xpath-functions-20070123'>[W3C.REC&#8209;xpath&#8209;functions&#8209;20070123]<span> (</span><span class='info'>Walsh, N., Malhotra, A., and J. Melton, &ldquo;XQuery 1.0 and XPath 2.0 Functions and Operators,&rdquo; January&nbsp;2007.</span><span>)</span></a>) 
are unprefixed, and overrides any homonym name in the current default namespace. 

</p>
<p>For instance, the following function-set describes: the two-parameters version of fn:starts-with,
the fn:concat function, and the fn:trace function (defined in Section 4, 7.4.1 and 7.5.2 of 
<a class='info' href='#W3C.REC-xpath-functions-20070123'>[W3C.REC&#8209;xpath&#8209;functions&#8209;20070123]<span> (</span><span class='info'>Walsh, N., Malhotra, A., and J. Melton, &ldquo;XQuery 1.0 and XPath 2.0 Functions and Operators,&rdquo; January&nbsp;2007.</span><span>)</span></a>, respectively).
</p><a name='anchor94'></a>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;WXS:function-set
    xmlns:fn="http://www.w3.org/2005/XPath-functions"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;

    &lt;WXS:function name="fn:starts-with"&gt;
      &lt;WXS:function-param  type="xs:string"/&gt;
      &lt;WXS:function-param  type="xs:string"/&gt;
      &lt;WXS:function-result type="xs:boolean"/&gt;
    &lt;/WXS:function&gt;

    &lt;WXS:function name="fn:concat"&gt;
      &lt;WXS:function-param  type="xs:anyAtomicType"
                           repeatable="true"/&gt;
      &lt;WXS:function-result type="xs:string"/&gt;
    &lt;/WXS:function&gt;

    &lt;WXS:function name="fn:trace"&gt;
      &lt;WXS:function-param  type="item" cardinality="*"/&gt;
      &lt;WXS:function-param  type="xs:string"/&gt;
      &lt;WXS:function-result type="item" cardinality="*"/&gt;
    &lt;/WXS:function&gt;

 &lt;/WXS:function-set&gt;
</pre></div><p>

</p>
<a name="extensibility"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
XML Extensibility</h3>

<p>
The extensibility mechanism from Section 17 of <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a> 
(i.e., to process received XML documents as if unexpected elements and attributes, 
and all children of unrecognized elements, were not present)
may be inappropriate when dealing with queries 
because they would not be evaluated as specified by the client 
(e.g. the query criteria may be loosen or the result record or may be incomplete).
The omission of unexpected content might not be realized by the client.

</p>
<p>The extension attribute provides a mean for distinguishing whether the extension was recognized or ignored,
raising a precondition error in the latter case. The attribute value MUST be either "required" or "optional". 
For conformance with <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a> and Section 5.2.2 of <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>, 
when this attribute is not specified its value defaults to "required" when the element occurs as a descendant of DAV:where, 
and "optional" anywhere else.  

</p>
<p>
Any element allows the following attributes (where "..." represents the element type name):
<a name='anchor95'></a>
<a name='anchor96'></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;!ATTLIST ... extension (required|optional) #IMPLIED&gt;
&lt;!ATTLIST ... id         ID                 #IMPLIED&gt;
</pre></div><p>


</p>
<p>
When an unexpected or unknown element is present in the request, the server MUST:<br />
 
   - Ignore it (and its descendants), 
if the value of the "extension" attribute for that element is "optional" (or the 
"extension" attribute is missing and the element is not a descendant of DAV:where). 
The request is then processed as if the element were not there.<br />
 
   - Fail with status code 422 (Unprocessable Entity) and precondition code WXS:unexpected-content,
if the value of the "extension" attribute for that element is "required" 
(or if there is no "extension" attribute and the element is a descendant of DAV:where).
In this case, the attrname attribute of WXS:unexpected-content MUST NOT be specified.
If the element has an "id" attribute, the idref attribute of the WXS:unexpected-content precondition 
MUST be the element id, otherwise the "idref" attribute MUST NOT be specified.

</p>
<p>
When an unexpected or unknown attribute occurs within an expected element, 
the server MUST proceed as if the element itself were unexpected or unknown. 
In addition, if the element is required (as explained above), 
the attrname attribute of the WXS:unexpected-content precondition 
MUST be assigned with the name of the offending attribute.

</p>
<p>
<a name='anchor97'></a>
<a name='anchor98'></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

&lt;!ELEMENT WXS:unexpected-content EMPTY&gt;
&lt;!ATTLIST WXS:unexpected-content idref    NMTOKEN #IMPLIED&gt;
&lt;!ATTLIST WXS:unexpected-content attrname NMTOKEN #IMPLIED&gt;
</pre></div><p>

<a name='anchor99'></a>
If present, the idref attribute MUST match the value of some ID attribute in the request.

</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>The security considerations of WebDAV SEARCH <a class='info' href='#I-D.reschke-webdav-search'>[I&#8209;D.reschke&#8209;webdav&#8209;search]<span> (</span><span class='info'>Reschke, J., &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2007.</span><span>)</span></a>, 
and WebDAV <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>, as well as those of HTTP/1.1 <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>
and XML <a class='info' href='#RFC3023'>[RFC3023]<span> (</span><span class='info'>Murata, M., St. Laurent, S., and D. Kohn, &ldquo;XML Media Types,&rdquo; January&nbsp;2001.</span><span>)</span></a> are applicable to the WebDAV extension described in this document.

</p>
<p>The risk of denial of service attacks is greater than in the DAV:basicsearch case, 
because evaluating some XPath expressions may be computationally expensive.

Implementors must be aware there are many valid (and required, even after
subsetting optional XPath features) expressions which are computationally expensive to evaluate. 
Implementantions should deal with this expressions as a possible denial of service attack (DOS),
which may be commited either by intention or by a good faith client submitting an overwhelming query.

</p>
<p>Some examples of this queries include: visiting repeatedly the parent an child axes,
visiting several nodes with no apparent purpose (e.g. a predicate which is evaluated on some other node, unrelated to the focus),
and requesting a result-set with redundant information (e.g. nodes and information derived from those nodes by applying some function).

</p>
<p>
There are no universally valid rules for determining whether an expression is part of a DOS attack.
Indeed, a server may accept an expression which deemed to be useful by the server implementors or administrators,
while other may rejected it because of security concerns. 

It may also accept or reject an expression because of other variables, 
such as credentials presented by the user when authenticating (i.e. some users may be allowed to perform certain kind of queries that would have been considered DOS if submitted by other user).

</p>
<p>For protecting from false negatives when detecting DOS, servers should timeout when queries take too much time before completion.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>This document defines XML elements in a XML namespace described by a URN 
conforming the registry mechanism described in <a class='info' href='#RFC3688'>[RFC3688]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.
The following URI assignment is requested

</p>
<p>URI: urn:ietf:params:xml:ns:webdav-xml-search
</p>
<p>Registrant Contact: See the "Author's Address" section of this document.
</p>
<p>XML: None.  Namespace URIs do not represent an XML specification.
</p>
<p>Reference: The last version of this document. 
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.reschke-webdav-search">[I-D.reschke-webdav-search]</a></td>
<td class="author-text">Reschke, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-reschke-webdav-search-14.txt">Web Distributed Authoring and Versioning (WebDAV) SEARCH</a>,&rdquo; draft-reschke-webdav-search-14 (work in progress), November&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-reschke-webdav-search-14.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999 (<a href="ftp://ftp.isi.edu/in-notes/rfc2616.txt">TXT</a>, <a href="ftp://ftp.isi.edu/in-notes/rfc2616.ps">PS</a>, <a href="ftp://ftp.isi.edu/in-notes/rfc2616.pdf">PDF</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3023">[RFC3023]</a></td>
<td class="author-text">Murata, M., St. Laurent, S., and D. Kohn, &ldquo;<a href="http://tools.ietf.org/html/rfc3023">XML Media Types</a>,&rdquo; RFC&nbsp;3023, January&nbsp;2001 (<a href="ftp://ftp.isi.edu/in-notes/rfc3023.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3253">[RFC3253]</a></td>
<td class="author-text"><a href="mailto:geoffrey.clemm@rational.com">Clemm, G.</a>, <a href="mailto:jamsden@us.ibm.com">Amsden, J.</a>, <a href="mailto:tim_ellison@uk.ibm.com">Ellison, T.</a>, <a href="mailto:ckaler@microsoft.com">Kaler, C.</a>, and <a href="mailto:ejw@cse.ucsc.edu">J. Whitehead</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3253">Versioning Extensions to WebDAV (Web Distributed Authoring and Versioning)</a>,&rdquo; RFC&nbsp;3253, March&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3253.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3253.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3253.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3688">[RFC3688]</a></td>
<td class="author-text">Mealling, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3688">The IETF XML Registry</a>,&rdquo; BCP&nbsp;81, RFC&nbsp;3688, January&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3688.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3744">[RFC3744]</a></td>
<td class="author-text"><a href="mailto:geoffrey.clemm@us.ibm.com">Clemm, G.</a>, <a href="mailto:julian.reschke@greenbytes.de">Reschke, J.</a>, <a href="mailto:eric.sedlar@oracle.com">Sedlar, E.</a>, and <a href="mailto:ejw@cse.ucsc.edu">J. Whitehead</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3744">Web Distributed Authoring and Versioning (WebDAV) Access Control Protocol</a>,&rdquo; RFC&nbsp;3744, May&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3744.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3744.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3744.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4790">[RFC4790]</a></td>
<td class="author-text">Newman, C., Duerst, M., and A. Gulbrandsen, &ldquo;<a href="http://tools.ietf.org/html/rfc4790">Internet Application Protocol Collation Registry</a>,&rdquo; RFC&nbsp;4790, March&nbsp;2007 (<a href="ftp://ftp.isi.edu/in-notes/rfc4790.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4918">[RFC4918]</a></td>
<td class="author-text">Dusseault, L., &ldquo;<a href="http://tools.ietf.org/html/rfc4918">HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV)</a>,&rdquo; RFC&nbsp;4918, June&nbsp;2007 (<a href="ftp://ftp.isi.edu/in-notes/rfc4918.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="W3C.REC-xml-names11-20060816">[W3C.REC-xml-names11-20060816]</a></td>
<td class="author-text">Hollander, D., Layman, A., Tobin, R., and T. Bray, &ldquo;<a href="http://www.w3.org/TR/2006/REC-xml-names11-20060816">Namespaces in XML 1.1 (Second Edition)</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xml-names11-20060816, August&nbsp;2006 (<a href="http://www.w3.org/TR/2006/REC-xml-names11-20060816">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="W3C.REC-xml11-20060816">[W3C.REC-xml11-20060816]</a></td>
<td class="author-text">Maler, E., Sperberg-McQueen, C., Cowan, J., Paoli, J., Bray, T., and F. Yergeau, &ldquo;<a href="http://www.w3.org/TR/2006/REC-xml11-20060816">Extensible Markup Language (XML) 1.1 (Second Edition)</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xml11-20060816, August&nbsp;2006 (<a href="http://www.w3.org/TR/2006/REC-xml11-20060816">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="W3C.REC-xmlschema-2-20041028">[W3C.REC-xmlschema-2-20041028]</a></td>
<td class="author-text">Malhotra, A. and P. Biron, &ldquo;<a href="http://www.w3.org/TR/2004/REC-xmlschema-2-20041028">XML Schema Part 2: Datatypes Second Edition</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xmlschema-2-20041028, October&nbsp;2004 (<a href="http://www.w3.org/TR/2004/REC-xmlschema-2-20041028">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="W3C.REC-xpath-datamodel-20070123">[W3C.REC-xpath-datamodel-20070123]</a></td>
<td class="author-text">Fernández, M., Malhotra, A., Nagy, M., Walsh, N., and J. Marsh, &ldquo;<a href="http://www.w3.org/TR/2007/REC-xpath-datamodel-20070123">XQuery 1.0 and XPath 2.0 Data Model (XDM)</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xpath-datamodel-20070123, January&nbsp;2007 (<a href="http://www.w3.org/TR/2007/REC-xpath-datamodel-20070123">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="W3C.REC-xpath-functions-20070123">[W3C.REC-xpath-functions-20070123]</a></td>
<td class="author-text">Walsh, N., Malhotra, A., and J. Melton, &ldquo;<a href="http://www.w3.org/TR/2007/REC-xpath-functions-20070123">XQuery 1.0 and XPath 2.0 Functions and Operators</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xpath-functions-20070123, January&nbsp;2007 (<a href="http://www.w3.org/TR/2007/REC-xpath-functions-20070123">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="W3C.REC-xpath20-20070123">[W3C.REC-xpath20-20070123]</a></td>
<td class="author-text">Berglund, A., Boag, S., Chamberlin, D., Kay, M., Robie, J., Fernández, M., and J. Siméon, &ldquo;<a href="http://www.w3.org/TR/2007/REC-xpath20-20070123">XML Path Language (XPath) 2.0</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xpath20-20070123, January&nbsp;2007 (<a href="http://www.w3.org/TR/2007/REC-xpath20-20070123">HTML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC4234">[RFC4234]</a></td>
<td class="author-text"><a href="mailto:dcrocker@bbiw.net">Crocker, D., Ed.</a> and <a href="mailto:paul.overell@thus.net">P. Overell</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc4234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; RFC&nbsp;4234, October&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc4234.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc4234.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc4234.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="W3C.REC-xquery-20070123">[W3C.REC-xquery-20070123]</a></td>
<td class="author-text">Boag, S., Robie, J., Chamberlin, D., Fernández, M., Florescu, D., and J. Siméon, &ldquo;<a href="http://www.w3.org/TR/2007/REC-xquery-20070123">XQuery 1.0: An XML Query Language</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xquery-20070123, January&nbsp;2007 (<a href="http://www.w3.org/TR/2007/REC-xquery-20070123">HTML</a>).</td></tr>
</table>

<a name="rfc.comments"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Editorial Comments</h3>
<table border="0">
<tr><td class="author-text" valign="top">
<a class="info" href="#error-DEP">
error-DEP</a><a name="comment.error-DEP"></a>:
</td><td class="author-text">
Besides, handling dynamic errors on a separate basis imposes an additional requirement, then supporting this feature is left to the criteria of implementors.</td></tr>
<tr><td class="author-text" valign="top">
<a class="info" href="#note-comparison-complex-type">
note-comparison-complex-type</a><a name="comment.note-comparison-complex-type"></a>:
</td><td class="author-text">
This seems to be a MUST in [draft-reschke-webdav-search-14] Section 5.5.4, but is relaxed here since the property would be treated as xs:string if the type were ignored.</td></tr>
<tr><td class="author-text" valign="top">
<a class="info" href="#note-context-position">
note-context-position</a><a name="comment.note-context-position"></a>:
</td><td class="author-text">
When supporting numeric predicates and context position references there is a trade-off between expressive power and implementation costs.</td></tr>
<tr><td class="author-text" valign="top">
<a class="info" href="#note-intent">
note-intent</a><a name="comment.note-intent"></a>:
</td><td class="author-text">
The authors' motivation for writing this document is allowing metadata to be searchable when presented as a WebDAV property.  Since it may be encoded as specified by a third-party schema,  it should not be modified in order to conform WebDAV.</td></tr>
<tr><td class="author-text" valign="top">
<a class="info" href="#note-namespace">
note-namespace</a><a name="comment.note-namespace"></a>:
</td><td class="author-text">
Since this protocol is experimental, the authors do not suggest new elements in order to not pollute the "DAV:" namespace. Thus, an experimental implementation of this protocol will not conflict with the following requirement from RFC 4918: "(...) an XML element in the "DAV:" namespace SHOULD NOT be used in the request or response body unless that XML element is explicitly defined in an IETF RFC reviewed by a WebDAV working group".</td></tr>
<tr><td class="author-text" valign="top">
<a class="info" href="#note-opdesc">
note-opdesc</a><a name="comment.note-opdesc"></a>:
</td><td class="author-text">
The operator description is only intended for discovering whether the server implements an extension operator. The DAV:operators element from [I-D.reschke-webdav-search] is not adopted here,  because it cannot describe the mandatory operators. On the other hand, while XML Schemas would have sufficed for this purpose,  this approach would have required WXS:xml-search clients to be in conformance to the XML Representation of Schemas, which is much more than necessary for achieving the above mentioned goal (given that the operators are not too complex). The chosen approach is compared to ABNF, in order to avoid further relation with features that are available in XML schemas.</td></tr>
<tr><td class="author-text" valign="top">
<a class="info" href="#note-OPTIONAL-404">
note-OPTIONAL-404</a><a name="comment.note-OPTIONAL-404"></a>:
</td><td class="author-text">
The 404 status code for missing properties is OPTIONAL in order to avoid an extensive response if the client selects several properties that are seldom defined.  Note this behaviour is different from the PROPFIND case, where the 404 status code is REQUIRED for missing properties (Section 9.1 of [RFC 4918], page 35).</td></tr>
<tr><td class="author-text" valign="top">
<a class="info" href="#note-RFC4918-sect17">
note-RFC4918-sect17</a><a name="comment.note-RFC4918-sect17"></a>:
</td><td class="author-text">
RFC4918: "(...) servers MUST process received XML  documents as if unexpected elements and attributes (and all children of unrecognized  elements) were not there"</td></tr>
<tr><td class="author-text" valign="top">
<a class="info" href="#note-select-prop-filter">
note-select-prop-filter</a><a name="comment.note-select-prop-filter"></a>:
</td><td class="author-text">
If the property value is not well-formed XML specifying both DAV:prop and WXS:filter is ambiguous because a 409 (Conflict) status code must be returned per WXS:filter and the complete property value must be returned per DAV:prop.  On the other hand, if the property value were well-formed XML, one of those elements would have to be ignored.</td></tr>
</table>

<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Example WXS:xml-search query</h3>

<p>
This example shows a request/response exchange 
for selecting the DAV:getcontentlength property 
and the &lt;M:title&gt; and first &lt;M:author&gt; elements of the &lt;M:metadata&gt; property,
from resources which are directly contained in the http://host.example.com/ collection,
such that the title (as described by a M:title element within the M:metadata property)
starts with letter "S". The first results will have at least one M:author element present.

</p>
<p>
The response describes two resources:<br />
 
   - foo.pdf, with DAV:getcontentlength = 65536, author = "John Doe" and title = "Sample Title"<br />

   - bar.txt, with DAV:getcontentlength = 1024, title = "Sample Anonymous Resource" and no author.<br />


</p>
<p>
<a name='anchor100'></a>
Request: 
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
SEARCH / HTTP/1.1
Host: host.example.com
Content-Type: application/xml
Content-Length: xxx

&lt;WXS:xml-search xmlns="DAV:"
   xmlns:WXS="urn:ietf:params:xml:ns:webdav-xml-search"
   xmlns:M ="http://example.org/metadata"&gt;
  &lt;select&gt;
    &lt;WXS:filter&gt;
      &lt;prop&gt;&lt;M:metadata/&gt;&lt;/prop&gt;
      &lt;WXS:xpath&gt;/M:author[1]|/M:title&lt;/WXS:xpath&gt;
    &lt;/WXS:filter&gt;
    &lt;prop&gt;&lt;getcontentlength/&gt;&lt;/prop&gt;
  &lt;/select&gt;
  &lt;from&gt;
    &lt;scope&gt;
      &lt;href&gt;http://host.example.com/&lt;/href&gt;
      &lt;depth&gt;1&lt;depth&gt;
    &lt;/scope&gt;
  &lt;/from&gt;
  &lt;where&gt;
    &lt;WXS:filter&gt;
      &lt;prop&gt;&lt;M:metadata/&gt;&lt;/prop&gt;
      &lt;WXS:xpath&gt;starts-with(/M:title,'S')&lt;/WXS:xpath&gt;
    &lt;/WXS:filter&gt;
  &lt;/where&gt;
  &lt;orderby&gt;
    &lt;order&gt;
      &lt;WXS:filter&gt;
        &lt;prop&gt;&lt;M:metadata/&gt;&lt;/prop&gt;
        &lt;WXS:xpath&gt;/M:author&lt;/WXS:xpath&gt;
      &lt;/WXS:filter&gt;
      &lt;descending&gt;
    &lt;/order&gt;
  &lt;/orderby&gt;
&lt;/WXS:xml-search&gt;
</pre></div><p>


</p>
<p>
<a name='anchor101'></a>
Response:
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 207 Multi-Status
Content-Type: text/xml; charset="utf-8"
Content-Length: xxx

&lt;multistatus xmlns="DAV:"
   xmlns:WXS="urn:ietf:params:xml:ns:webdav-xml-search"
   xmlns:M ="http://example.org/metadata" &gt;
  &lt;response&gt;
    &lt;href&gt;http://host.example.com/foo.pdf&lt;/href&gt;
    &lt;propstat&gt;
      &lt;prop&gt;
        &lt;getcontentlength&gt;65536&lt;/getcontentlength&gt;
        &lt;M:metadata&gt;
          &lt;M:author&gt;John Doe&lt;/M:author&gt;
          &lt;M:title&gt;Sample title&lt;/M:title&gt;
        &lt;/M:metadata&gt;
      &lt;/prop&gt;
      &lt;status&gt;HTTP/1.1 200 OK&lt;status&gt;
    &lt;/propstat&gt;
  &lt;/response&gt;
  &lt;response&gt;
    &lt;href&gt;http://host.example.com/bar.txt&lt;/href&gt;
    &lt;propstat&gt;
      &lt;prop&gt;
        &lt;getcontentlength&gt;1024&lt;/getcontentlength&gt;
        &lt;M:metadata&gt;
          &lt;M:title&gt;Sample Anonymous Resource&lt;/M:title&gt;
        &lt;/M:metadata&gt;
      &lt;/prop&gt;
      &lt;status&gt;HTTP/1.1 200 OK&lt;status&gt;
    &lt;/propstat&gt;
  &lt;/response&gt;
&lt;/multistatus&gt;
</pre></div><p>


</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Reported Issues</h3>

<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1"></a><h3>B.1.&nbsp;
Editorial Issues</h3>

<p>Issue #E1, reported by Michael Kay on 2008-01-21.<br />

http://lists.w3.org/Archives/Public/www-xpath-comments/2008JanMar/0001.html, item (a).<br />

http://lists.w3.org/Archives/Public/public-qt-comments/2008Jan/0096.html, item (a).<br />

Reference to XPath 2.0 Proposed Recommendation of 2006-11-21 should be modified to refer Recommendation of 2007-01-23 2007. Suggest avoid referring to a specifically dated version, so that readers are referred to the latest edition at any given time, which may incorporate errata.<br />
Resolution: Refer XPath 2.0 Recommendation of 2007-01-23 
(in turn, it already suggests readers to check the latest version and errata). Revisit this issue later with the RFC editor. 

</p>
<p>Issue #E2, reported by Michael Kay on 2008-01-21.<br />

http://lists.w3.org/Archives/Public/www-xpath-comments/2008JanMar/0001.html, item (c).<br />

http://lists.w3.org/Archives/Public/public-qt-comments/2008Jan/0096.html, item (c).<br />

Since the namespace prefix "xs" is often used to refer to the XML Schema namespace, it might be clearer to readers if a prefix other than "XS" is used (perhaps "WXS"?).<br />
Resolution: replace XS prefix with WXS.

</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.2"></a><h3>B.2.&nbsp;
Technical Issues</h3>

<p>Issue #T1, reported by Michael Kay on 2008-01-21.<br />

http://lists.w3.org/Archives/Public/www-xpath-comments/2008JanMar/0001.html, item (e).<br />

http://lists.w3.org/Archives/Public/public-qt-comments/2008Jan/0096.html, item (e).<br />

Suggest requiring the same subset of axes as XQuery chose.<br />
Resolution: include descendant, descendant-or-self and parent as REQUIRED axes (thus aligning with XQuery required axis).
The namespace axis is deprecated in XQuery, such deprecation is not inherited by xmlsearch but the namespace axis is made OPTIONAL.

</p>
<p>Issue #T2, reported by Michael Kay on 2008-01-21.<br />

http://lists.w3.org/Archives/Public/www-xpath-comments/2008JanMar/0001.html, item (f).
<br />
The minimum set of functions that an implementation must supply is defined as being empty (no functions). There are some functions such as not() and count() that would be absolutely indispensable.<br />
Resolution: 
Include fn:not(item,item,...), fn:count(item,item,...), fn:exists(item,item,...), fn:empty(item,item,...), fn:root(node).
fn:root(node) is supported because of the expansion for "/" and "//". The default function namespace is set to "fn". 
The QSD is extended for describing other functions that MAY be optionally supported.

</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
Change log (To be removed by RFC Editor before publication)</h3>

<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.1"></a><h3>C.1.&nbsp;
changes in draft-godoy-webdav-xmlsearch-01</h3>

<p>- Include appendix B (reported issues) and C (change log).
</p>
<p>- Removed typo about "DAV:xsl-search-schema", which does not exist.
</p>
<p>- New issues in this version: #E1, #E2, #T1, #T2.
</p>
<p>- Issues addressed in this version: #E1, #E2, #T1, #T2
</p>
<p>- Some Security Considerations.
</p>
<p>- Minor editorial changes.
</p><a name="rfc.index"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Index</h3>
<table>
<tr><td><strong>A</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td>Attribute</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor99">attrname (WXS:unexpected-content element)</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor95">extension</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor96">id</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor98">idref (WXS:unexpected-content element)</a></td></tr>
<tr><td><strong>D</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor32">Dynamic Context</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor34">Dynamic Error</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor33">Dynamic Evaluation Phase (DEP)</a></td></tr>
<tr><td><strong>E</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td>Element</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor58">DAV:and</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor43">DAV:multistatus</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor57">DAV:not</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor59">DAV:or</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor61">DAV:order</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;DAV:propdesc  <a href="#anchor69">1</a>, <a href="#anchor73">2</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor44">DAV:response</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor66">DAV:search-scope-valid</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor53">DAV:select</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor56">DAV:where</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor64">WXS:acceptable-role</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor82">WXS:alternative</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor77">WXS:axis</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor54">WXS:filter</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor91">WXS:function</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor92">WXS:function-param</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor93">WXS:function-result</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor90">WXS:function-set</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor60">WXS:is-well-formed</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor67">WXS:known-literal-type</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor81">WXS:opdesc-rule</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor80">WXS:operand-nested-op</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor79">WXS:operand-XPath</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor78">WXS:operator</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor63">WXS:property-must-be-well-formed-xml</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor83">WXS:repetition</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;WXS:searchable  <a href="#anchor71">1</a>, <a href="#anchor75">2</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;WXS:selectable  <a href="#anchor70">1</a>, <a href="#anchor74">2</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;WXS:sortable  <a href="#anchor72">1</a>, <a href="#anchor76">2</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor97">WXS:unexpected-content</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor42">WXS:warning</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor52">WXS:xml-search</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor68">WXS:xml-search-schema</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor55">WXS:XPath</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor65">WXS:XPath-error</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor45">WXS:xpath-error</a></td></tr>
<tr><td>&nbsp;</td><td>Example</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor62">Bad Request, DAV:select</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor48">DASL Response Header</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor49">DAV:supported-query-grammar-set</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor89">Description of DAV:like Operator</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor88">Extended operator description for DAV:typed-literal operand</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor87">Implied operator description</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor50">QSD request</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor51">QSD response</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor94">WXS:function-set</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;WXS:opdesc-rule  <a href="#anchor84">1</a>, <a href="#anchor85">2</a>, <a href="#anchor86">3</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor47">WXS:XPath-error (in DEP)</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor46">WXS:XPath-error (in SAP)</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor100">xml-search request</a></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;&nbsp;<a href="#anchor101">xml-search response</a></td></tr>
<tr><td><strong>I</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor35">Implementation-defined</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor36">Implementation-dependent</a></td></tr>
<tr><td><strong>R</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor37">Role</a></td></tr>
<tr><td><strong>S</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor38">Static Analysis Phase (SAP)</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor39">Static Context</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor40">Static Error</a></td></tr>
<tr><td><strong>T</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor41">Type Error</a></td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Roberto Javier Godoy</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UNL - Facultad de Ingenieria y Ciencias Hidricas</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ciudad Universitaria, Ruta Nac. 168</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">S3001XAI  Paraje "El Pozo"</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Argentina</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:rjgodoy@fich.unl.edu.ar">rjgodoy@fich.unl.edu.ar</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://purl.oclc.org/NET/rjgodoy">http://purl.oclc.org/NET/rjgodoy</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hugo Minni</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UNL - Facultad de Ingenieria y Ciencias Hidricas</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ciudad Universitaria, Ruta Nac. 168</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">S3001XAI  Paraje "El Pozo"</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Argentina</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:hminni@fich.unl.edu.ar">hminni@fich.unl.edu.ar</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78
and at <a href='http://www.rfc-editor.org/copyright.html'>http://www.rfc-editor.org/copyright.html</a>, and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
