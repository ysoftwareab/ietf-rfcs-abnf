<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Problem Statement of Default Address Selection in Multi-prefix Environment: Operational Issues of RFC3484 Default Rules</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Problem Statement of Default Address Selection in Multi-prefix Environment: Operational Issues of RFC3484 Default Rules">
<meta name="keywords" content="Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">IPv6 Operations Working Group</td><td class="header">A. Matsumoto</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">T. Fujisaki</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">NTT</td></tr>
<tr><td class="header">Expires: July 31, 2008</td><td class="header">R. Hiromi</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">K. Kanayama</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Intec Netcore</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">January 28, 2008</td></tr>
</table></td></tr></table>
<h1><br />Problem Statement of Default Address Selection in Multi-prefix Environment: Operational Issues of RFC3484 Default Rules<br />draft-ietf-v6ops-addr-select-ps-03.txt</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on July 31, 2008.</p>

<h3>Abstract</h3>

<p>One physical network can carry multiple logical networks. Moreover,
   we can use multiple physical networks at the same time in a host.
   In that environment, end hosts might have multiple IP addresses and
   be required to use them selectively.  Without an appropriate
source/destination
   address selection mechanism, the host will experience some trouble in
   communication.
   RFC 3484 defines both the source and destination address selection
algorithms,
   but the multi-prefix environment considered here needs additional rules
   beyond those of the default operation.
   This document describes the possible problems that end hosts could
encounter
   in an environment with multiple logical networks.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Scope of this document<br />
<a href="#anchor3">2.</a>&nbsp;
Problem Statement<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.1.</a>&nbsp;
Source Address Selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.1.1.</a>&nbsp;
Multiple Routers on Single Interface<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.1.2.</a>&nbsp;
Ingress Filtering Problem<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.1.3.</a>&nbsp;
Half-Closed Network Problem<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">2.1.4.</a>&nbsp;
Combined Use of Global and ULA<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">2.1.5.</a>&nbsp;
Site Renumbering<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">2.1.6.</a>&nbsp;
Multicast Source Address Selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">2.1.7.</a>&nbsp;
Temporary Address Selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">2.2.</a>&nbsp;
Destination Address Selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">2.2.1.</a>&nbsp;
IPv4 or IPv6 prioritization<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">2.2.2.</a>&nbsp;
ULA and IPv4 dual-stack environment<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">2.2.3.</a>&nbsp;
ULA or Global Prioritization<br />
<a href="#anchor16">3.</a>&nbsp;
Conclusion<br />
<a href="#anchor17">4.</a>&nbsp;
Security Considerations<br />
<a href="#anchor18">5.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">6.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">6.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">6.2.</a>&nbsp;
Informative References<br />
<a href="#anchor21">Appendix&nbsp;A.</a>&nbsp;
Appendix. Revision History<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>One physical network can carry multiple logical networks.  In that case,
   an end-host has multiple IP addresses. In the IPv4-IPv6 dual stack
   environment or in a site connected to both a <a class='info' href='#RFC4193'>ULA<span> (</span><span class='info'>Hinden, R. and B. Haberman, &ldquo;Unique Local IPv6 Unicast Addresses,&rdquo; October&nbsp;2005.</span><span>)</span></a> [RFC4193] and Global scope networks, an end-host has multiple IP addresses.
   These are examples of networks that we focus on in this document.
	In such an environment, an end-host will encounter some communication
	trouble.
</p>
<p>
   Inappropriate source address selection at the end-host causes unexpected
   asymmetric routing, filtering by a router or discarding of packets
   bacause there is no route to the host.
	
</p>
<p>
   Considering a multi-prefix environment, destination address
   selection is also important for correct or better communication establishment.
   
	
</p>
<p>
   <a class='info' href='#RFC3484'>RFC 3484<span> (</span><span class='info'>Draves, R., &ldquo;Default Address Selection for Internet Protocol version 6 (IPv6),&rdquo; February&nbsp;2003.</span><span>)</span></a> [RFC3484] defines both source and destination address selection algorithms.
   In most cases, the host will be able to communicate with the targeted
host using the
   algorithms.  However, there are still problematic cases such as when
   multiple default routes are supplied.
   This document describes such possibilities of incorrect address selection,
   which leads to dropping packets and communication failure.
	
</p>
<p>
   In addition, the provision of an address policy table is an important
   matter. RFC 3484 describes all the algorithms for setting the address
   policy table but address policy provisions are not mentioned.
   RFC 3484 only defines how to configure the address policy table
   manually.
	
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Scope of this document</h3>

<p>
   There has been a lot of discussion about "multiple
addresses/prefixes" but
   the multi-homing techniques for achieving redundancy are out of our scope.
   Cooperation with a mechanism like shim6 is rather desirable.
   We focus on an end-site network environment.
   The scope of this document is to sort out problematic cases of false
   dropping of the address selection within a multi-prefix environment.
	
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Problem Statement</h3>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Source Address Selection</h3>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.1"></a><h3>2.1.1.&nbsp;
Multiple Routers on Single Interface</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                       ==================
                       |    Internet    |
                       ==================
                          |          |
       2001:db8:1000::/36 |          | 2001:db8:8000::/36
                     +----+-+      +-+----+
                     | ISP1 |      | ISP2 |
                     +----+-+      +-+----+
                          |          |
      2001:db8:1000:::/48 |          | 2001:db8:8000::/48
                   +------+---+ +----+-----+
                   | Gateway1 | | Gateway2 |
                   +--------+-+ +-+--------+
                            |     |
       2001:db8:1000:1::/64 |     | 2001:db8:8000:1::/64
                            |     |
                     -----+-+-----+------
                          |
                        +-+----+ 2001:db8:1000:1::EUI64
                        | Host | 2001:db8:8000:1::EUI64
                        +------+

                             [Fig. 1]
</pre></div>
<p>
  Generally speaking, there is no interaction between next-hop determination
  and address selection. In this example, when a Host sends a packet via
  Gateway1, the Host does not necessarily choose address 2001:db8:1000:1::EUI64
  given by Gateway1 as the source address. This causes the same problem
  as described in the next section 'Ingress Filtering Problem'.
				
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.2"></a><h3>2.1.2.&nbsp;
Ingress Filtering Problem</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                     ==================
                     |    Internet    |
                     ==================
                          |       |
       2001:db8:1000::/36 |       | 2001:db8:8000::/36
                     +----+-+   +-+----+
                     | ISP1 |   | ISP2 |
                     +----+-+   +-+----+
                          |       |
      2001:db8:1000:::/48 |       | 2001:db8:8000::/48
                         ++-------++
                         | Gateway |
                         +----+----+
                              |  2001:db8:1000:1::/64
                              |  2001:db8:8000:1::/64
                    ------+---+----------
                          |
                        +-+----+ 2001:db8:1000:1::EUI64
                        | Host | 2001:db8:8000:1::EUI64
                        +------+

                             [Fig. 2]
</pre></div>
<p>
   When a relatively small site, which we call a "customer network", is
   attached to two upstream ISPs, each ISP delegates a network address
   block, which is usually /48, and a host has multiple IPv6 addresses.
   				
</p>
<p>
   When the source address of an outgoing packet is not the one that is
   delegated by an upstream ISP, there is a possibility that the packet
   will be dropped at the ISP by its Ingress Filter.
   Ingress filtering(uRPF: unicast Reverse Path Forwarding)
   is becoming more popular among ISPs to mitigate
   the damage of DoS attacks.
   				
</p>
<p>
   In this example, when the Gateway chooses the default route to ISP2
   and the Host chooses 2001:db8:1000:1::EUI64 as the source address for
   packets sent to a host (2001:db8:2000::1) somewhere on the Internet,
   the packets may be dropped at ISP2 because of Ingress Filtering.
   				
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.3"></a><h3>2.1.3.&nbsp;
Half-Closed Network Problem</h3>

<p>
   You can see a second typical source address selection problem in a
   multihome site with global-closed mixed connectivity like in the figure
   below.  In this case, Host-A is in a multihomed network and has two
   IPv6 addresses, one delegated from each of the upstream ISPs.
   Note that ISP2
   is a closed network and does not have connectivity to the Internet.
   				
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                        +--------+
                        | Host-C | 2001:db8:a000::1
                        +-----+--+
                              |
                     ==============  +--------+
                     |  Internet  |  | Host-B | 2001:db8:8000::1
                     ==============  +--------+
                          |           |
        2001:db8:1000:/36 |           | 2001:db8:8000::/36
                     +----+-+   +-+---++
                     | ISP1 |   | ISP2 | (Closed Network/VPN tunnel)
                     +----+-+   +-+----+
                          |       |
        2001:db8:1000:/48 |       | 2001:db8:8000::/48
                         ++-------++
                         | Gateway |
                         +----+----+
                              |  2001:db8:1000:1::/64
                              |  2001:db8:8000:1::/64
                    ------+---+----------
                          |
                       +--+-----+ 2001:db8:1000:1::EUI64
                       | Host-A | 2001:db8:8000:1::EUI64
                       +--------+

                             [Fig. 3]
</pre></div>
<p>
	You do not need two physical network connections here.
	The connection from the Gateway to ISP2 can be a logical link over ISP1
	and the Internet.
				
</p>
<p>
   When Host-A starts the connection to Host-B in ISP2, the source address
   of a packet that has been sent will be the one delegated from ISP2, that is
   2001:db8:8000:1::EUI64, because of rule 8 (longest matching prefix) in
   RFC 3484.
				
</p>
<p>
   Host-C is located somewhere on the Internet and has IPv6 address
   2001:db8:a000::1.  When Host-A sends a packet to Host-C, the longest
   matching algorithm chooses 2001:db8:8000:1::EUI64 for the source
   address.  In this case, the packet goes through ISP1 and may be
   filtered by ISP1's ingress filter.  Even if the packet is 
   not filtered by ISP1, a return packet from Host-C cannot possibly be
   delivered to Host-A because the return packet is destined for
   2001:db8:8000:1::EUI64, which is closed from the Internet.
				
</p>
<p>
   The important point is
   that each host chooses a correct source address for a given
   destination address as long as NAT does not exist in the IPv6 world.
				
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.4"></a><h3>2.1.4.&nbsp;
Combined Use of Global and ULA</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                     ============
                     | Internet |
                     ============
                           |
                           |
                      +----+----+
                      |   ISP   |
                      +----+----+
                           |
           2001:db8:a::/48 |
                      +----+----+
                      | Gateway |
                      +-+-----+-+
                        |     | 2001:db8:a:100::/64
       fd01:2:3:200:/64 |     | fd01:2:3:100:/64
                -----+--+-   -+--+----
                     |           |
 fd01:2:3:200::EUI64 |           |      2001:db8:a:100::EUI64
                +----+----+    +-+----+ fd01:2:3:100::EUI64
                | Printer |    | Host |
                +---------+    +------+

                             [Fig. 4]
</pre></div>
<p>
	As <a class='info' href='#I-D.ietf-v6ops-nap'>NAP<span> (</span><span class='info'>Velde, G., &ldquo;Local Network Protection for IPv6,&rdquo; January&nbsp;2007.</span><span>)</span></a> [I&#8209;D.ietf&#8209;v6ops&#8209;nap] describes,
	using a ULA may be beneficial in some scenarios.
	If the ULA is used for internal communication,
	packets with ULA need to be filtered at the Gateway.
				
</p>
<p>
   There is no serious problem related to address selection in this case,
   because of the dissimilarity between the ULA and the Global Unicast Address.
   The longest matching rule of RFC 3484 chooses the correct address for both
   intra-site and extra-site communication.
				
</p>
<p>
   In a few years, however, the longest matching rule will not be able to
   choose the correct address anymore. That is the moment when the assignment of
   those Global Unicast Addresses starts, where the first bit is 1.
   In <a class='info' href='#RFC4291'>RFC 4291<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;IP Version 6 Addressing Architecture,&rdquo; February&nbsp;2006.</span><span>)</span></a> [RFC4291], almost all address spaces of IPv6,
   including those
   whose first bit is 1, are assigned as Global Unicast Addresses.
				
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.5"></a><h3>2.1.5.&nbsp;
Site Renumbering</h3>

<p>
   <a class='info' href='#RFC4192'>RFC 4192<span> (</span><span class='info'>Baker, F., Lear, E., and R. Droms, &ldquo;Procedures for Renumbering an IPv6 Network without a Flag Day,&rdquo; September&nbsp;2005.</span><span>)</span></a> [RFC4192] describes a recommended procedure
   for renumbering a
   network from one prefix to another.  An autoconfigured address has a
   lifetime, so by stopping advertisement of the old prefix, the
   autoconfigured address is eventually invalidated.
				
</p>
<p>
	However, invalidating the old prefix takes a long time.
	You cannot stop routing to the old prefix as long as the old prefix
	is not removed from the host. This can be a tough issue for ISP
	network administrators.
				
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                           +-----+---+
                           | Gateway |
                           +----+----+
                                |  2001:db8:b::/64  (new)
                                |  2001:db8:a::/64 (old)
                      ------+---+----------
                            |
                         +--+-----+ 2001:db8:b::EUI64  (new)
                         | Host-A | 2001:db8:a::EUI64 (old)
                         +--------+

                             [Fig. 5]
</pre></div>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.6"></a><h3>2.1.6.&nbsp;
Multicast Source Address Selection</h3>

<p>
   This case is an example of Site-local or Global prioritization.  When
   you send a multicast packet across site-borders, the source address
   of the multicast packet must be a global scope address.  The
   longest matching algorithm, however, selects a ULA if the
   sending host has both a ULA and a global address.
				
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.7"></a><h3>2.1.7.&nbsp;
Temporary Address Selection</h3>

<p>
   <a class='info' href='#RFC3041'>RFC 3041<span> (</span><span class='info'>Narten, T. and R. Draves, &ldquo;Privacy Extensions for Stateless Address Autoconfiguration in IPv6,&rdquo; January&nbsp;2001.</span><span>)</span></a> [RFC3041] defines a Temporary Address.
   The usage of a Temporary Address has both pros and cons.
   That is good for viewing web pages or communicating with the
   general public, but that is bad for a service that uses address-based
   authentication and for logging purposes.
				
</p>
<p>
	If you could turn the temporary address on and off, that would be
	better.
	If you could switch its usage per service(destination address),
	that would also be better.
   The same situation can be found when using HA and CoA in a MobileIP network.
				
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Destination Address Selection</h3>

<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.1"></a><h3>2.2.1.&nbsp;
IPv4 or IPv6 prioritization</h3>

<p>
   The default policy table gives IPv6 addresses higher
   precedence than IPv4 addresses. There seem to be many cases,
   however, where network administrators want to control the
   address selection policy of end-hosts the other way around.
				
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                         +---------+
                         | Tunnel  |
                         | Service |
                         +--+---++-+
                            |   ||
                            |   ||
                     ===========||==
                     | Internet || |
                     ===========||==
                          |     ||
             192.0.2.0/24 |     ||
                     +----+-+   ||
                     | ISP  |   ||
                     +----+-+   ||
                          |     ||
            IPv4 (Native) |     || IPv6 (Tunnel)
             192.0.2.0/26 |     ||
                         ++-----++-+
                         | Gateway |
                         +----+----+
                              |  2001:db8:a:1::/64
                              |  192.0.2.0/28
                              |
                    ------+---+----------
                          |
                        +-+----+ 2001:db8:a:1:EUI64
                        | Host | 192.0.2.2
                        +------+

                             [Fig. 6]
</pre></div>
<p>
   In the figure above, a site has native IPv4 and tunneled-IPv6
   connectivity.  Therefore, the administrator may want to set
   a higher priority for using IPv4 than using IPv6 because the quality
   of the tunnel network seems to be worse than that of the native
	transport.
				
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.2"></a><h3>2.2.2.&nbsp;
ULA and IPv4 dual-stack environment</h3>

<p>
   This is a special form of IPv4 and IPv6 prioritization.
   When an enterprise has IPv4 Internet connectivity but does not yet have IPv6
   Internet connectivity, and the enterprise wants to provide site-local
   IPv6 connectivity, a ULA is the best choice for
   site-local IPv6 connectivity. Each employee host will have both
   an IPv4 global or private address and a ULA. Here, when this
   host tries to connect to Host-C that has registered both A and AAAA
   records in the DNS, the host will choose AAAA as the destination
   address and the ULA for the source address. This will clearly result
   in a connection failure.
				
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                        +--------+
                        | Host-C | AAAA = 2001:db8::80
                        +-----+--+ A    = 192.0.2.1
                              |
                     ============
                     | Internet |
                     ============
                          |  no IPv6 connectivity
                     +----+----+
                     | Gateway |
                     +----+----+
                          |
                          | fd01:2:3::/48 (ULA)
                          | 192.0.2.128/25
                         ++--------+
                         | Router  |
                         +----+----+
                              |  fd01:2:3:4::/64 (ULA)
                              |  192.0.2.240/28
                    ------+---+----------
                          |
                        +-+----+ fd01:2:3:4::100 (ULA)
                        | Host | 192.0.2.245
                        +------+

                             [Fig. 7]
</pre></div>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.3"></a><h3>2.2.3.&nbsp;
ULA or Global Prioritization</h3>

<p>
	Differentiating services by the client's source address is very common.
	IP-address-based authentication is
   an typical example of this. Another typical example
   is a web service that has pages for the public and internal
   pages for employees or involved parties. Yet another example
   is DNS zone splitting.
				
</p>
<p>
   However, a ULA and IPv6 global address both have global scope,
   and RFC3484 default rules do not specify which address should be
   given priority. This point makes IPv6 implementation of
   address-based service differentiation a bit harder.
				
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                         +------+
                         | Host |
                         +-+--|-+
                           |  |
                   ===========|==
                   | Internet | |
                   ===========|==
                         |    |
                         |    |
                    +----+-+  +--&gt;+------+
                    | ISP  +------+  DNS | 2001:db8:a::80
                    +----+-+  +--&gt;+------+ fc12:3456:789a::80
                         |    |
         2001:db8:a::/48 |    |
     fc12:3456:789a::/48 |    |
                    +----+----|+
                    | Gateway ||
                    +---+-----|+
                        |     |    2001:db8:a:100::/64
                        |     |    fc12:3456:789a:100::/64
                      --+-+---|-----
                          |   |
                        +-+---|+ 2001:db8:a:100::EUI64
                        | Host | fc12:3456:789a:100::EUI64
                        +------+

                             [Fig. 7]
</pre></div>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Conclusion</h3>

<p>
We have covered problems related to destination or source
address selection. These problems have their roots in the situation
where end-hosts have multiple IP addresses. In this situation,
every end-host must choose an appropriate
destination and source address, which cannot be achieved only by
routers.
		
</p>
<p>
It should be noted that end-hosts must be informed about
routing policies of their upstream networks for appropriate
address selection. A site administrator must consider every
possible address false-selection problem and take countermeasures
beforehand.
		
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security Considerations</h3>

<p>
When an intermediate router performs policy routing (e.g. source address based routing), inappropriate address selection causes unexpected routing.
  For example, in the network described in 2.1.3, when Host-A uses a default
  address selection policy and chooses an inappropriate address,
  a packet sent to VPN
  can be delivered to a location via the Internet. This issue can lead to
  packet eavesdropping or session hijack.
		
</p>
<p>
  As documented in the security consideration section in RFC 3484,
  address selection algorithms expose a potential
  privacy concern. When a malicious host can make a target host perform address
  selection, the malicious host can know multiple addresses attached to the
  target host. In a case like 2.1.4, if an attacker can make Host to send a
  multicast packet and the Host performs the default address selection algorithm,
  the attacker may be able to determine the ULAs attached to the Host.
		
</p>
<p>
  These security risks have roots in inappropriate address selection. Therefore,
  if a countermeasure is taken, and hosts always select an appropriate address that
  is suitable to a site's network structure and routing, these risks can be avoided.
		
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>
			This document has no actions for IANA.
		
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3484">[RFC3484]</a></td>
<td class="author-text">Draves, R., &ldquo;<a href="http://tools.ietf.org/html/rfc3484">Default Address Selection for Internet Protocol version 6 (IPv6)</a>,&rdquo; RFC&nbsp;3484, February&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3484.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4193">[RFC4193]</a></td>
<td class="author-text">Hinden, R. and B. Haberman, &ldquo;<a href="http://tools.ietf.org/html/rfc4193">Unique Local IPv6 Unicast Addresses</a>,&rdquo; RFC&nbsp;4193, October&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4193.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-v6ops-nap">[I-D.ietf-v6ops-nap]</a></td>
<td class="author-text">Velde, G., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-v6ops-nap-06.txt">Local Network Protection for IPv6</a>,&rdquo; draft-ietf-v6ops-nap-06 (work in progress), January&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-v6ops-nap-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3041">[RFC3041]</a></td>
<td class="author-text">Narten, T. and R. Draves, &ldquo;<a href="http://tools.ietf.org/html/rfc3041">Privacy Extensions for Stateless Address Autoconfiguration in IPv6</a>,&rdquo; RFC&nbsp;3041, January&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3041.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4192">[RFC4192]</a></td>
<td class="author-text">Baker, F., Lear, E., and R. Droms, &ldquo;<a href="http://tools.ietf.org/html/rfc4192">Procedures for Renumbering an IPv6 Network without a Flag Day</a>,&rdquo; RFC&nbsp;4192, September&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4192.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4291">[RFC4291]</a></td>
<td class="author-text">Hinden, R. and S. Deering, &ldquo;<a href="http://tools.ietf.org/html/rfc4291">IP Version 6 Addressing Architecture</a>,&rdquo; RFC&nbsp;4291, February&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4291.txt">TXT</a>).</td></tr>
</table>

<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Appendix. Revision History</h3>

<p>01:
		</p>
<blockquote class="text"><dl>
<dt></dt>
<dd>IP addresse notations changed to docmentation address.
</dd>
<dt></dt>
<dd>Descriptoin of solutions deleted.
</dd>
</dl></blockquote><p>
		02:
		</p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Security considerations section rewritten according to comments from SECDIR.
</dd>
</dl></blockquote><p>
		03:
		</p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Intended status changed to Informational.
</dd>
</dl></blockquote><p>
		
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Arifumi Matsumoto</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NTT PF Lab</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Midori-Cho 3-9-11</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Musashino-shi, Tokyo  180-8585</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81 422 59 3334</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:arifumi@nttv6.net">arifumi@nttv6.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tomohiro Fujisaki</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NTT PF Lab</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Midori-Cho 3-9-11</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Musashino-shi, Tokyo  180-8585</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81 422 59 7351</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:fujisaki@nttv6.net">fujisaki@nttv6.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ruri Hiromi</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Intec Netcore, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Shinsuna 1-3-3</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Koto-ku, Tokyo  136-0075</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81 3 5665 5069</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hiromi@inetcore.com">hiromi@inetcore.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ken-ichi Kanayama</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Intec Netcore, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Shinsuna 1-3-3</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Koto-ku, Tokyo  136-0075</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81 3 5665 5069</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:kanayama@inetcore.com">kanayama@inetcore.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
