

Personal                                                       T. Melsen
Internet-Draft                                                  S. Blake
Expires: August 2004                                            Ericsson
                                                           February 2004


    MAC Forced Forwarding: An ARP proxy method for ensuring traffic
      separation between hosts sharing an Ethernet access network
                   draft-melsen-mac-forced-fwd-01.txt

Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups. Note that other
   groups may also distribute working documents as Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time. It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at http://
   www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on August 13, 2004.

Copyright Notice

   Copyright (C) The Internet Society (2004). All Rights Reserved.

Abstract

   This document describes a mechanism to ensure layer-2 separation of
   LAN stations accessing an IPv4 gateway over a shared Ethernet
   segment.

   The mechanism - called "MAC Forced Forwarding" - implements an ARP
   proxy function that prohibits MAC address resolution between hosts
   located within the same IP subnet but at different customer premises,
   and in effect directs all upstream traffic to the IP gateway.  The IP
   gateway provides IP-layer connectivity between these same hosts.





Melsen & Blake          Expires August 13, 2004                 [Page 1]

Internet-Draft           MAC Forced Forwarding             February 2004


Table of Contents

   1.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  3
   1.1 Using Ethernet as an Access Network Technology . . . . . . . .  4
   1.2 Solution Characteristics . . . . . . . . . . . . . . . . . . .  5
   2.  Conventions used in this document  . . . . . . . . . . . . . .  5
   3.  Terminology  . . . . . . . . . . . . . . . . . . . . . . . . .  5
   4.  Solution Aspects . . . . . . . . . . . . . . . . . . . . . . .  6
   4.1 Obtaining the IP and MAC addresses of the Access Router  . . .  6
   4.2 Responding to ARP Requests . . . . . . . . . . . . . . . . . .  6
   4.3 Filtering Upstream Traffic . . . . . . . . . . . . . . . . . .  7
   5.  Access Router Considerations . . . . . . . . . . . . . . . . .  7
   6.  Resiliency Considerations  . . . . . . . . . . . . . . . . . .  7
   7.  Multicast Considerations . . . . . . . . . . . . . . . . . . .  8
   8.  IPv6 Considerations  . . . . . . . . . . . . . . . . . . . . .  8
   9.  Security Considerations  . . . . . . . . . . . . . . . . . . .  9
   10. Acknowledgements . . . . . . . . . . . . . . . . . . . . . . .  9
       References . . . . . . . . . . . . . . . . . . . . . . . . . .  9
       Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . 10
       Intellectual Property and Copyright Statements . . . . . . . . 11































Melsen & Blake          Expires August 13, 2004                 [Page 2]

Internet-Draft           MAC Forced Forwarding             February 2004


1. Introduction

   The main purpose of a remote access network is to provide
   connectivity between customer hosts and service provider access
   routers (AR), typically offering access to the Internet and other IP
   networks and/or IP-based applications.

   A remote access network may be decomposed into a subscriber line part
   and an aggregation network part. The subscriber line - often referred
   to as "the first mile" - is characterized by an individual physical
   connection to each customer premise. The aggregation network - "the
   second mile" - performs aggregation and concentration of customer
   traffic.

   The subscriber line and the aggregation network are interconnected by
   an Access Node (AN). Thus, the AN constitutes the border between
   individual subscriber lines and the common aggregation network.  This
   is illustrated in the following figure.


        Access       Aggregation  Access    Subscriber   Customer
        Routers      Network      Nodes     Lines        Premise
                                                         Networks
        +----+           |
      --+ AR +-----------|        +----+
        +----+           |        |    +-----------------[]
                         |--------+ AN |
                         |        |    +-----------------[]
                         |        +----+
                         |
                         |        +----+
                         |        |    +-----------------[]
                         |--------+ AN |
                         |        |    +-----------------[]
                         |        +----+
                         |
                         |        +----+
                         |        |    +-----------------[]
                         |--------+ AN |
        +----+           |        |    +-----------------[]
      --+ AR +-----------|        +----+
        +----+           |


   It is often strongly desired that all traffic to and from customer
   hosts located at different premises (i.e., accessed via different
   subscriber lines, or via different access networks) be forwarded via
   an AR.  This enables the access network service provider to use the



Melsen & Blake          Expires August 13, 2004                 [Page 3]

Internet-Draft           MAC Forced Forwarding             February 2004


   AR(s) to perform security filtering, policing, and accounting of all
   customer traffic.  This implies that within the access network,
   layer-2 traffic paths should not exist that circumvent an AR.

   In ATM-based access networks, the separation of individual customer
   hosts' traffic is an intrinsic feature achieved by the use of ATM
   permanent virtual connections (PVCs) between the customers' access
   device (e.g., DSL modem) and the AR (typically co-located/integrated
   with access control functionality in a broadband access server
   (BRAS)). In this case, the Access Node is an ATM-based DSLAM.

   This document, however, targets traffic separation for Ethernet-based
   access networks, i.e., where techniques other than ATM PVCs are
   deployed to ensure the desired separation of traffic belonging to
   individual customer hosts.

1.1 Using Ethernet as an Access Network Technology

   A major aspect of using Ethernet as an access technology is that
   traffic pertaining to different customer hosts is conveyed over a
   shared broadcast network. To avoid IP routing in the access network,
   the Ethernet aggregation network is bridged via Access Nodes to
   individual Ethernet networks at the customers' premises. In this
   architecture there is direct visibility between Ethernet stations
   (hosts) located at different customers' premises due to the nature of
   Ethernet. Specifically, hosts located within the same IP subnet will
   have this functionality. This not only violates the requirement to
   send all traffic via the AR, it also introduces security issues, as
   malicious end-users can attack hosts at other customers' premises
   directly at the Ethernet layer.

   Existing standardized solutions may be deployed to prevent layer-2
   visibility between stations:
   o  PPP over Ethernet. The use of PPPoE creates individual tunnels
      between hosts and one or more Access Concentrators (AC) over a
      bridged Ethernet topology. Traffic always flows between an AC and
      hosts, never between hosts. The Access Node can enforce that
      upstream traffic will only go to the AC initially selected by the
      host.
   o  VLAN per customer. Individual traffic streams can be separated in
      different VLANs between the AN and the AR.

   Both solutions provide layer-2 isolation between customer hosts, but
   still they are not considered optimal for broadband remote access
   networks, because:
   o  PPPoE does not support efficient multicast, one of the major
      advantages of using Ethernet as an access technology (instead of
      ATM).



Melsen & Blake          Expires August 13, 2004                 [Page 4]

Internet-Draft           MAC Forced Forwarding             February 2004


   o  Using VLANs to separate individual customer hosts is not
      appealing, since that is regarded as requiring cumbersome
      provisioning. Furthermore, the basic limit of a maximum of 4096
      VLANs per-Ethernet network does not present a scalable solution.
      This limit is removed by deploying VLAN stacking techniques within
      the access network, but this solution only adds to the
      provisioning complexity.

1.2 Solution Characteristics

   The solution proposed in this document has the following main
   characteristics:
   1.  Traffic between individual customer hosts is isolated over the
       Ethernet access network. Traffic always flows between customer
       hosts and the AR, and never directly between customer hosts at
       different premises.
   2.  IP addresses are assigned to customer hosts in an efficient
       manner. Specifically, allocating individual IP subnets to each
       customer network is NOT a requirement for this solution to
       function. See RFC 3069 [3] for a discussion on why this
       requirement is relevant.
   3.  IP over Ethernet is used as the access protocol to ensure
       efficient multicast support (see Section 7).
   4.  VLANs are NOT used to separate traffic pertaining to individual
       customer hosts, due to scalability and provisioning issues.
   5.  The solution works for both dynamically assigned IP addresses
       (via DHCP) and statically assigned IP addresses.

2. Conventions used in this document

   In this document, the key words "MUST", "MUST NOT", "REQUIRED",
   "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT
   RECOMMENDED", "MAY", and "OPTIONAL" are to be interpreted as
   described in BCP 14, RFC 2119 [2] and indicate requirement levels for
   compliant implementations.

3. Terminology

   Ethernet Access Node (EAN)
      The entity interconnecting individual subscriber lines and the
      shared aggregation network. e.g., for xDSL access, the EAN is an
      Ethernet-centric DSLAM (Digital Subscriber Line Access
      Multiplexer). The EAN is a special type of filtering bridge that
      does not forward Ethernet broadcast and multicast frames
      originating on a subscriber line to other subscriber lines, but
      either discards them or forwards them to an AR.  The EAN also
      discards unicast Ethernet frames originating on a subscriber line
      and not addressed to an AR.



Melsen & Blake          Expires August 13, 2004                 [Page 5]

Internet-Draft           MAC Forced Forwarding             February 2004


4. Solution Aspects

   The basic property of the solution is that the EAN ensures that
   upstream traffic is always sent to the designated AR, even if the IP
   traffic goes between customer hosts located in the same IP subnet.

   The solution has three major aspects:
   1.  Initially, the EAN obtains the IP and MAC address of the target
       AR.
   2.  The EAN replies with this MAC address to any upstream ARP request
       from customer hosts.
   3.  The EAN filters out any upstream traffic to MAC addresses other
       than the target AR.

   These aspects are discussed in the following sections.

4.1 Obtaining the IP and MAC addresses of the Access Router

   The AR is typically the default gateway of the host.

   The EAN may learn the IP address of the AR in one of two ways,
   depending on the host IP address assignment method. If each host uses
   DHCP, the AR IP address is dynamically learned by snooping the DHCP
   reply to a host. Otherwise, the AR IP address is pre-provisioned by
   the network operator. In both cases, the EAN will need to determine
   the corresponding MAC address, using ARP. This can be done
   immediately after the IP address is learned, or when the MAC address
   is first required.

   An access network may contain multiple ARs, and different hosts may
   be assigned different ARs. This implies that the EAN MUST register
   the assigned AR address on a per-host basis.

4.2 Responding to ARP Requests

   If all customer networks were assigned individual IP subnets, all
   upstream traffic would normally go to an AR (typically the default
   gateway), and the EAN could validate all upstream traffic by checking
   that the destination MAC address matched the AR.

   However, to comply with requirement 2 of Section 1.2, residential
   customer networks are not assigned individual IP subnets. In other
   words, several hosts located at different premises are within the
   same IP subnet. Consequently, if a host wishes to communicate with a
   host at another premise, an ARP is issued to obtain that host's
   corresponding MAC address. This ARP request is intercepted by the
   EAN's ARP proxy, and responded to with an ARP reply, indicating the
   AR MAC address as the requested layer-2 destination. In this way, the



Melsen & Blake          Expires August 13, 2004                 [Page 6]

Internet-Draft           MAC Forced Forwarding             February 2004


   ARP table of the requesting host will register the AR MAC address as
   the layer-2 destination for any host within that IP subnet.

   An exception is made when a host is ARPing for another host located
   within the same premise. If this ARP request reaches the EAN, it is
   discarded, because it is assumed to be answered directly by a host
   locally within the premise.

4.3 Filtering Upstream Traffic

   Since the EAN's ARP proxy will always reply with the MAC address of
   the AR, the requesting host will never learn MAC addresses of hosts
   located at other premises. However, malicious customers or
   malfunctioning hosts may still try to send traffic using other
   destination MAC addresses. This traffic MUST be discarded by the EAN.

5. Access Router Considerations

   Traffic between hosts that belong to the same IP subnet but are
   located at different premises will always be forwarded via an AR. In
   this case, the AR will forward the traffic to the originating
   network, i.e., on the same interface from where it was received. This
   normally results in an ICMP redirect message, RFC 792 [4], being sent
   to the originating host. To prevent this behavior, the ICMP redirect
   function for aggregation network interfaces MUST be disabled in the
   AR.

6. Resiliency Considerations

   The operation of MAC Forced Forwarding does not interfere with or
   delay IP connectivity recovery in the event of a sustained AR failure
   when DHCP is used as the IP address allocation mechanism, or when two
   or more ARs implement VRRP [5].

   MAC Forced Forwarding is a stateful protocol.  If static IP address
   assignment is used in the access network, then the EAN state database
   can be quickly recovered in the event of a transient EAN failure.
   Otherwise, transient failure of an EAN can lead to sustained loss of
   connectivity, since the DHCP and ARP messages that are snooped to
   construct the EAN state database are usually infrequent, and a
   transient failure may not be detected by either the AR(s) or the
   customer premise hosts.  EANs used in access networks using dynamic
   IP address assignment MUST employ resilient storage of their state
   database to permit timely restoration of connectivity in the event of
   a transient EAN failure.






Melsen & Blake          Expires August 13, 2004                 [Page 7]

Internet-Draft           MAC Forced Forwarding             February 2004


7. Multicast Considerations

   Multicast traffic delivery for streams originating upstream from the
   access network and delivered to one or more customer premise hosts in
   an access network is supported in a scalable manner by virtue of
   Ethernet's native multicast capability.  Efficiency can be enhanced
   if the EAN behaves as an IGMP snooping bridge; e.g., if it snoops on
   IGMP Membership Report and Leave Group messages originating on
   subscriber lines, to prune the set of subscriber lines on which to
   forward multicast packets.

   Support for customer-originated multicast streams is more
   complicated.  The access network must avoid reflecting a multicast
   packet received on a subscriber line back out onto that line (to
   suppress duplicate packet reception on hosts at that customer
   premise).  The EAN could bridge multicast frames onto (listening)
   subscriber lines excluding the originating one, but this would
   violate the requirement that all customer-originated traffic be
   forwarded via an AR.  Alternatively, the multicast packets could be
   sent upstream to the appropriate AR, which would forward them back
   out onto the same subnet.  This would require non-standard behavior
   on the part of the AR, and would require the EAN to filter downstream
   multicast traffic based on source IP address (not delivering
   multicast packets to the subscriber line serving the originating
   host).

8. IPv6 Considerations

   MAC Forced Forwarding is not directly applicable for IPv6 access
   networks, for the following reasons:
   1.  IPv6 access networks do not require the same efficiency of
       address allocation as IPv4 access networks.  It is expected that
       customer premise networks will be allocated unique network
       prefixes (e.g., /48) accommodating large numbers of customer
       subnets and hosts.
   2.  IPv6 nodes do not use ARP, but instead use the Neighbor Discovery
       protocol [6] for layer-2 address resolution.
   3.  IPv6 nodes do not necessarily use DHCP to obtain IP addresses and
       IP gateway information, but may instead use the Stateless Address
       Autoconfiguration protocol [7].
   Furthermore, there is no practical deployment experience using a MAC
   Forced Forwarding-type approach in an IPv6 access network.

   Some principles of MAC Address Forwarding may be applicable in an
   IPv6 access network design and merit further study.






Melsen & Blake          Expires August 13, 2004                 [Page 8]

Internet-Draft           MAC Forced Forwarding             February 2004


9. Security Considerations

   MAC Forced Forwarding is by its nature a security function, ensuring
   layer-2 isolation of customer hosts sharing a broadcast access
   medium. In that sense it provides security equivalent to alternative
   PVC-based solutions.

   A MAC Forced Forwarding implementation MUST ensure that only
   authentic DHCP replies are used in the dynamic discovery of AR
   addresses. One way to accomplish this is to reject any upstream DHCP
   replies, i.e., replies originated on a subscriber line.

10. Acknowledgements

   The authors would like to thank Ulf Jonsson, Thomas Narten, James
   Carlson, Rolf Engstrand, and Johan Kolhi for their helpful comments.

References

   [1]  Bradner, S., "The Internet Standards Process -- Revision 3", BCP
        9, RFC 2026, October 1996.

   [2]  Bradner, S., "Key words for use in RFCs to Indicate Requirement
        Levels", BCP 14, RFC 2119, March 1997.

   [3]  McPherson, D. and B. Dykes, "VLAN Aggregation for Efficient IP
        Address Allocation", RFC 3069, February 2001.

   [4]  Postel, J., "Internet Control Message Protocol", STD 5, RFC 792,
        September 1981.

   [5]  Knight, S., Weaver, D., Whipple, D., Hinden, R., Mitzel, D.,
        Hunt, P., Higginson, P., Shand, M. and A. Lindem, "Virtual
        Router Redundancy Protocol", RFC 2338, April 1998.

   [6]  Narten, T., Nordmark, E. and W. Simpson, "Neighbor Discovery for
        IP Version 6 (IPv6)", RFC 2461, December 1998.

   [7]  Thomson, S. and T. Narten, "IPv6 Stateless Address
        Autoconfiguration", RFC 2462, December 1998.











Melsen & Blake          Expires August 13, 2004                 [Page 9]

Internet-Draft           MAC Forced Forwarding             February 2004


Authors' Addresses

   Torben Melsen
   Ericsson
   Faelledvej
   Struer  DK-7600
   Denmark

   EMail: Torben.Melsen@ericsson.com


   Steven Blake
   Ericsson
   IP Infrastructure
   920 Main Campus Drive
   Suite 500
   Raleigh, NC  27606
   USA

   Phone: +1 919 472-9913
   EMail: steven.blake@ericsson.com






























Melsen & Blake          Expires August 13, 2004                [Page 10]

Internet-Draft           MAC Forced Forwarding             February 2004


Intellectual Property Statement

   The IETF takes no position regarding the validity or scope of any
   intellectual property or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; neither does it represent that it
   has made any effort to identify any such rights. Information on the
   IETF's procedures with respect to rights in standards-track and
   standards-related documentation can be found in BCP-11. Copies of
   claims of rights made available for publication and any assurances of
   licenses to be made available, or the result of an attempt made to
   obtain a general license or permission for the use of such
   proprietary rights by implementors or users of this specification can
   be obtained from the IETF Secretariat.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights which may cover technology that may be required to practice
   this standard. Please address the information to the IETF Executive
   Director.


Full Copyright Statement

   Copyright (C) The Internet Society (2004). All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works. However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assignees.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION



Melsen & Blake          Expires August 13, 2004                [Page 11]

Internet-Draft           MAC Forced Forwarding             February 2004


   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Acknowledgment

   Funding for the RFC Editor function is currently provided by the
   Internet Society.











































Melsen & Blake          Expires August 13, 2004                [Page 12]
