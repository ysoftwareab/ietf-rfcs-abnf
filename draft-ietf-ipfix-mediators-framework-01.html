<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IPFIX Mediation: Framework</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IPFIX Mediation: Framework">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">IPFIX Working Group</td><td class="header">A. Kobayashi</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">H. Nishida</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">NTT PF Lab.</td></tr>
<tr><td class="header">Expires: May 7, 2009</td><td class="header">B. Claise</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Cisco Systems</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">November 03, 2008</td></tr>
</table></td></tr></table>
<h1><br />IPFIX Mediation: Framework<br />draft-ietf-ipfix-mediators-framework-01</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 7, 2009.</p>

<h3>Abstract</h3>

<p>
This document describes a framework for an IPFIX Mediation. This framework details an IPFIX Mediation reference model and the components of the IPFIX Mediation device (IPFIX Mediator). 

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<a href="#anchor3">3.</a>&nbsp;
IPFIX Mediation Reference Model<br />
<a href="#anchor4">4.</a>&nbsp;
IPFIX Mediation Functional and Logical Blocks<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.1.</a>&nbsp;
Collecting Process<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.2.</a>&nbsp;
Exporting Process<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.3.</a>&nbsp;
Intermediate Process<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.3.1.</a>&nbsp;
Flow Selection Function<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.3.2.</a>&nbsp;
Flow-based Collector Selection Function<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">4.3.3.</a>&nbsp;
Aggregation Function<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">4.3.4.</a>&nbsp;
Correlation Function<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">4.3.5.</a>&nbsp;
Modification Function<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">4.4.</a>&nbsp;
IPFIX File Writer/Reader<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">4.5.</a>&nbsp;
Flow Expiration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">4.6.</a>&nbsp;
Information Model<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">4.7.</a>&nbsp;
Examples<br />
<a href="#anchor17">5.</a>&nbsp;
Security Considerations<br />
<a href="#anchor18">6.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">7.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">7.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">7.2.</a>&nbsp;
Informative References<br />
<a href="#anchor21">Appendix&nbsp;A.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
IPFIX Mediation reroutes, replicates, filters, aggregates, correlates, or modifies Flow Records/Packet Reports or changes a transport protocol. This document describes the framework for IPFIX Mediation. The motivation for the IPFIX Mediation standard comes from the need for flow-based measurement system support for large-scale networks, interdomain networks, and coexistence with traditional Exporters as described in detail in <a class='info' href='#I-D.ietf-ipfix-mediator-ps'>[I&#8209;D.ietf&#8209;ipfix&#8209;mediator&#8209;ps]<span> (</span><span class='info'>Kobayashi, A., Nishida, H., Sommer, C., Dressler, F., Stephan, E., and B. Claise, &ldquo;IPFIX Mediation: Problem Statement,&rdquo; September&nbsp;2008.</span><span>)</span></a>. The standard specification requires a definition of IPFIX Mediation and IPFIX Mediation device (IPFIX Mediator).

</p>
<p>
This document is organized as follows. Section 2 describes terminology related to IPFIX Mediation. Section 3 describes a high level reference model. Section 4 details the components of the IPFIX Mediator. 

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>
The terms in this section are in line with those in the IPFIX specification document <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a> and the PSAMP specification document <a class='info' href='#I-D.ietf-psamp-protocol'>[I&#8209;D.ietf&#8209;psamp&#8209;protocol]<span> (</span><span class='info'>Claise, B., Quittek, J., and A. Johnson, &ldquo;Packet Sampling (PSAMP) Protocol Specifications,&rdquo; December&nbsp;2007.</span><span>)</span></a>. Additional terms required for the IPFIX Mediation are also defined with those in the IPFIX Mediator problem statement <a class='info' href='#I-D.ietf-ipfix-mediator-ps'>[I&#8209;D.ietf&#8209;ipfix&#8209;mediator&#8209;ps]<span> (</span><span class='info'>Kobayashi, A., Nishida, H., Sommer, C., Dressler, F., Stephan, E., and B. Claise, &ldquo;IPFIX Mediation: Problem Statement,&rdquo; September&nbsp;2008.</span><span>)</span></a>. All these terms are capitalized in this document.

</p>
<blockquote class="text"><dl>
<dt>Observation Point</dt>
<dd> <br />

An Observation Point is a location in the network where IP packets can be observed.  Examples include: a line to which a probe is attached, a shared medium, such as an Ethernet-based LAN, a single port of a router, or a set of interfaces (physical or logical) of a router.<br />
<br />

Note that every Observation Point is associated with an Observation Domain (defined below), and that one Observation Point may be a superset of several other Observation Points.  For example, one Observation Point can be an entire line card. That would be the superset of the individual Observation Points at the line card's interfaces.

</dd>
<dt>Observation Domain</dt>
<dd> <br />

An Observation Domain is the largest set of Observation Points for which Flow information can be aggregated by a Metering Process. For example, a router line card may be an Observation Domain if it is composed of several interfaces, each of which is an Observation Point. In the IPFIX Message it generates, the Observation Domain includes its Observation Domain ID, which is unique per Exporting Process. That way, the Collecting Process can identify the specific Observation Domain from the Exporter that sends the IPFIX Messages.  Every Observation Point is associated with an Observation Domain.  It is RECOMMENDED that Observation Domain IDs also be unique per IPFIX Device.

</dd>
<dt>Flow Key</dt>
<dd> <br />

Each of the fields that:<br />
<br />

1.  belong to the packet header (e.g., destination IP address),<br />
<br />

2.  are a property of the packet itself (e.g., packet length),<br />
<br />

3.  are derived from packet treatment (e.g., Autonomous System (AS) number),<br />
<br />

and that are used to define a Flow are termed Flow Keys.

</dd>
<dt>Flow Record</dt>
<dd> <br />

A Flow Record contains information about a specific Flow that was observed at an Observation Point.  A Flow Record contains measured properties of the Flow (e.g., the total number of bytes for all the Flow's packets) and usually characteristic properties of the Flow (e.g., source IP address).

</dd>
<dt>Packet Reports</dt>
<dd> <br />

Packet Reports comprise a configurable subset of a packet's input to the Selection Process, including the Packet Content, information relating to its treatment (for example, the output interface), and its associated selection state (for example, a hash of the Packet Content).  

</dd>
<dt>Exporting Process</dt>
<dd> <br />

The Exporting Process sends Flow Records to one or more Collecting Processes.  The Flow Records are generated by one or more Metering Processes.

</dd>
<dt>Exporter</dt>
<dd> <br />

A device that hosts one or more Exporting Processes is termed an Exporter.

</dd>
<dt>IPFIX Device</dt>
<dd> <br />

An IPFIX Device hosts at least one Exporting Process. It may host further Exporting Processes and arbitrary numbers of Observation Points and Metering Processes.

</dd>
<dt>Collecting Process</dt>
<dd> <br />

A Collecting Process receives Flow Records from one or more Exporting Processes. The Collecting Process might process or store received Flow Records, but such actions are out of the scope of this document.

</dd>
<dt>Collector</dt>
<dd> <br />

A device that hosts one or more Collecting Processes is termed a Collector.

</dd>
<dt>IPFIX Message</dt>
<dd> <br />

An IPFIX Message is a message originating at the Exporting Process that carries the IPFIX records of this Exporting Process and whose destination is a Collecting Process. An IPFIX Message is encapsulated at the transport layer.

</dd>
<dt>Information Element</dt>
<dd> <br />

An Information Element is a protocol and encoding-independent description of an attribute that may appear in an IPFIX Record. The IPFIX information model <a class='info' href='#RFC5102'>[RFC5102]<span> (</span><span class='info'>Quittek, J., Bryant, S., Claise, B., Aitken, P., and J. Meyer, &ldquo;Information Model for IP Flow Information Export,&rdquo; January&nbsp;2008.</span><span>)</span></a> defines the base set of Information Elements for IPFIX.  The type associated with an Information Element indicates constraints on what it may contain and also determines the valid encoding mechanisms for use in IPFIX.

</dd>
<dt>IPFIX Mediation</dt>
<dd> <br />

An IPFIX Mediation is a generic term for functions doing something for Flow Records, Packet Reports, and IPFIX Messages. IPFIX Mediation is located in between components: Metering Processes, Exporting Processes, Collecting Processes, and other applications. IPFIX Mediation can be included in any IPFIX Devices. IPFIX Mediation consists of a set of some of the following functions:

<ul class="text">
<li>
rerouting input Flow Records/Packet Reports to an appropriate Collecting Process

</li>
<li>
replicating input Flow Records/Packet Reports

</li>
<li>
filtering and selecting input Flow Records/Packet Reports

</li>
<li>
aggregating input Flow Records/Packet Reports based on new Flow Keys

</li>
<li>
correlating a set of Flow Records/Packet Reports for creating new Flow Records/Packet Reports with new metrics

</li>
<li>
modifying input Flow Records/Packet Reports

</li>
<li>
changing transport protocols that carry IPFIX Messages

</li>
</ul>
The modification of Flow Records/Packet Reports includes these processes: 


<ul class="text">
<li>
changing the value of specified Information Elements

</li>
<li>
adding new Information Elements by deriving further Flow or packet properties from existing fields or calculating new metrics

</li>
<li>
deleting specified Information Elements.

</li>
</ul>
IPFIX Mediation can be included in any device, such as routers, switches, NMS (Network Management Systems), or stand-alone devices.

</dd>
<dt>Flow-Based Collector Selection</dt>
<dd><br />

The Flow-Based Collector Selection evaluates an input Flow Record/Packet Report based on the value of the specified Information Element and then selects a Collector for each input Flow Record/Packet Report. 

</dd>
<dt>IPFIX Mediator</dt>
<dd><br />

An IPFIX Mediator contains one or more functions defined in IPFIX Mediation. The IPFIX Mediator can be a stand-alone or a virtual device. It also contains one or more Collecting Processes and one or more Exporting Processes.

</dd>
<dt>Original Exporter</dt>
<dd><br />

An Original Exporter is an IPFIX Device that hosts Observation Points where IP packets can be directly observed.

</dd>
<dt>IPFIX Proxy</dt>
<dd><br />

An IPFIX Proxy is an IPFIX Mediator that receives IPFIX Messages from an Original Exporter and sends IPFIX Messages to one or more Collectors. It may alter part of an IPFIX Message to comply with IPFIX Protocol specifications. It may also change the type of transport protocol, such as UDP, TCP, SCTP, and PR-SCTP, and  convert a legacy protocol message to an IPFIX Message, if necessary.

</dd>
<dt>IPFIX Concentrator</dt>
<dd><br />

An IPFIX Concentrator is an IPFIX Mediator that receives Flow Records/Packet Reports, aggregates them, then exports the aggregated Flow Records.

</dd>
<dt>IPFIX Distributor</dt>
<dd> <br />

An IPFIX Distributor is an IPFIX Mediator that reroutes input Flow Records/Packet Reports based on the result of Flow-Based Collector Selection. It may filter or replicate input Flow Records/Packet Reports, if necessary.

</dd>
<dt>IPFIX Masquerading Proxy</dt>
<dd><br />

An IPFIX Masquerading Proxy is an IPFIX Mediator that screens out a part of the data of input Flow Records/Packet Reports according to configured policies. It can thus, for example, hide the network topology information or customers' IP addresses.

</dd>
<dt>Intermediate Process</dt>
<dd><br />

An Intermediate Process in IPFIX Mediators can be considered as a partial Metering Process taken from the Metering Process in Original Exporters as described in <a class='info' href='#RFC3917'>[RFC3917]<span> (</span><span class='info'>Quittek, J., Zseby, T., Claise, B., and S. Zander, &ldquo;Requirements for IP Flow Information Export(IPFIX),&rdquo; October&nbsp;2004.</span><span>)</span></a>.<br />
<br />

The Intermediate Process generates new sets of Data Records/Packet Reports from input Data Records/Packet Reports.

</dd>
<dt>Mediator Observation Domain</dt>
<dd><br />

An IPFIX Mediator does not host the Observation Points and Observation Domain. The Observation Domain ID in the IPFIX header sent by the IPFIX Mediator also indicates the largest set of Observation Points from the viewpoint of a Collector. However, this value does not indicate the physical entity of an Original Exporter.

</dd>
<dt>Transport Session Information</dt>
<dd><br />

The Transport Session is specified in <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>. In SCTP, the Transport Session Information is the SCTP association. In TCP and UDP, the Transport Session Information corresponds to a 5-tuple {Exporter IP address, Collector IP address, Exporter transport port, Collector transport port, and transport protocol}. 

</dd>
</dl></blockquote><p>

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
IPFIX Mediation Reference Model</h3>

<p>
The figure below shows the high-level reference model for IPFIX Mediation based on <a class='info' href='#I-D.ietf-ipfix-architecture'>[I&#8209;D.ietf&#8209;ipfix&#8209;architecture]<span> (</span><span class='info'>Sadasivan, G., Brownlee, N., Claise, B., and J. Quittek, &ldquo;Architecture for IP Flow Information Export,&rdquo; September&nbsp;2006.</span><span>)</span></a>. This figure covers the various possible scenarios that can exist in an IPFIX measurement system.

</p>
<p>

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+---------------------------+    +---------------------------+
| Collector {l}             |    | Collector {k}             |
|[*Application(s)]          |    |[*Application(s)]          |
|[IPFIX File Reader/Writer] |    |[IPFIX File Reader/Writer] |
|[Collecting Process(es)]   |....|[Collecting Process(es)]   |
+---------------------------+    +---------------------------+
                 ^    ^              ^  ^
                 |    |              |  |
                 |    +------....----+  |
                 |    |                 |
          IPFIX (Flow Records / Packet Reports)
                 |    |                 |
+----------------+----+-----+    +-------+-------------------+
|IPFIX Mediator {j}         |    |IPFIX Mediator {n}         |
|[*Applications(s)]         |    |[*Applications(s)]         |
|[Exporting Process(es)]    |    |[Exporting Process(es)]    |
|[Intermediate Process(es)] |....|[Intermediate Process(es)] |
|[Collecting Process(es)]   |    |[Collecting Process(es)]   |
+---------------------------+    +---------------------------+
                 ^    ^               ^
                 |    |               |
                 |    +------....-----+
                 |                    |
          IPFIX (Flow Records / Packet Reports)
                 |                    |
+----------------+----------+    +----+----------------------+
|IPFIX Original Exporter {i}|    |IPFIX Original Exporter {m}|
|[Exporting Process(es)]    |    |[Exporting Process(es)]    |
|[Metering Process(es)]     |....|[Metering Process(es)]     |
|[Observation Point(s)]     |    |[Observation Point(s)]     |
+---------------------------+    +---------------------------+
            ^ ^                        ^ ^
            | |                        | |
         Packets coming in to Observation Points
</pre></div>
<p>
Figure A: Reference Model for IPFIX Mediation.

</p>
<p>
The various functional components are indicated within brackets []. The functional components within [*] are not part of <a class='info' href='#I-D.ietf-ipfix-architecture'>[I&#8209;D.ietf&#8209;ipfix&#8209;architecture]<span> (</span><span class='info'>Sadasivan, G., Brownlee, N., Claise, B., and J. Quittek, &ldquo;Architecture for IP Flow Information Export,&rdquo; September&nbsp;2006.</span><span>)</span></a>.<br />
<br />


</p>
<p>
The figure below shows the basic IPFIX Mediator component model. The IPFIX Mediator is formally defined to consist of one or more Collecting Processes, zero or more Intermediate Processes, and one or more Exporting Processes. Basically, IPFIX Mediator devices, i.e., IPFIX Proxy, IPFIX Masquerading Proxy, IPFIX Distributor, and IPFIX Concentrator, described in <a class='info' href='#I-D.ietf-ipfix-mediator-ps'>[I&#8209;D.ietf&#8209;ipfix&#8209;mediator&#8209;ps]<span> (</span><span class='info'>Kobayashi, A., Nishida, H., Sommer, C., Dressler, F., Stephan, E., and B. Claise, &ldquo;IPFIX Mediation: Problem Statement,&rdquo; September&nbsp;2008.</span><span>)</span></a>, are composed of these components.

</p>
<p>

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
         IPFIX(Flow Records/Packet Reports)
                           ^
                         ^ |
+------------------------|-|---------------------+
| IPFIX Mediator         | |                     |
|                        | |                     |
|  .---------------------|-+-------------------. |
| .----------------------+--------------------.| |
| |          Exporting Process (es)           |' |
| '----------------------^--------------------'  |
|                        | |                     |
|  .---------------------|-+-------------------. |
| .----------------------+--------------------.| |
| |    Intermediate Process (es) (optional)   |' |
| '----------------------^--------------------'  |
|                        | |                     |
|  .---------------------|-+-------------------. |
| .----------------------+--------------------.| |
| |          Collecting Process (es)          |' |
| '----------------------^--------------------'  |
+------------------------|-|---------------------+
                         |
         IPFIX(Flow Records/Packet Reports)
</pre></div>
<p>
Figure B: IPFIX Mediator Basic Component Model.

</p>
<p>
An Original Exporter with a Mediation function is modeled as follows.

</p>
<p>

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
            IPFIX (Flow Records/Packet Reports)
                            ^ ^
+---------------------------|-|------------------------+
| Original Exporter         | |                        |
|                           | |                        |
|     .---------------------|-+-------------------.    |
|    .----------------------+--------------------.|    |
|    |           Exporting Process(es)           |'    |
|    '----------------------^--------------------'     |
|                           | |                        |
|     .---------------------|-+-------------------.    |
|    .----------------------+--------------------.|    |
|    |          Intermediate Process(es)         |'    |
|    '---------^-----------------------^---------'     |
|              |Flow Record or         |               |
|              |        Packet Reports |               |
| .------------+----------.  .---------+-------------. |
| | Metering Process {i}  |..| Metering Process {n}  | |
| '------------^----------'  '---------^-------------' |
|              |                       |               |
| .------------+----------.  .---------+-------------. |
| | Observation Point {i} |..| Observation Point {n} | |
| '------------^----------'  '---------^-------------' |
+--------------|-----------------------|---------------+
               |                       |
         Packets coming in to Observation Points
</pre></div>
<p>
Figure C: Component Model for Original Exporter with Mediation.

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
IPFIX Mediation Functional and Logical Blocks</h3>

<p>
The section describes the details of each component and examples applicable to that component for IPFIX Mediation and IPFIX Mediator.

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Collecting Process</h3>

<p>
The Collecting Processes described in <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a> receive Flow Records/Packet Reports with information relating to their treatment in the Metering Process and Exporting Process in the Original Exporter, such as sampling rate, IPFIX header information, and Transport Session Information. The Collecting Processes forward the set of data to multiple components: Intermediate Processes and Exporting Processes. In other words, the processes may duplicate received Flow Records/Packet Reports and forward them to multiple components in sequence or in parallel.

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Exporting Process</h3>

<p>
The Exporting Processes described in <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a> forward Flow Records/Packet Reports to one or multiple Collectors. The processes manage the reporting Template and make IPFIX Messages.

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Intermediate Process</h3>

<p>
Intermediate Processes generate new sets of Flow Records/Packet Reports from input Flow Records/Packet Reports with IPFIX header information "Export Time" and "Observation Domain ID". The processes host one of several functions defined below or a combination of them, in any sequence or in any set. In the case of a combination, the output of each function can be the input of other functions. The following subsections show the details of each function.

</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1"></a><h3>4.3.1.&nbsp;
Flow Selection Function</h3>

<p>
The Flow Selection function determines which input Flow Records/Packet Reports are selected by matching under a filtering policy and then forwards them to the next processes or functions. The function is similar to the Selection Process described in <a class='info' href='#I-D.ietf-psamp-framework'>[I&#8209;D.ietf&#8209;psamp&#8209;framework]<span> (</span><span class='info'>Duffield, N., &ldquo;A Framework for Packet Selection and Reporting,&rdquo; June&nbsp;2008.</span><span>)</span></a>. The function covers several selection techniques, such as property match filtering and Flow selection, which are described in <a class='info' href='#I-D.ietf-psamp-framework'>[I&#8209;D.ietf&#8209;psamp&#8209;framework]<span> (</span><span class='info'>Duffield, N., &ldquo;A Framework for Packet Selection and Reporting,&rdquo; June&nbsp;2008.</span><span>)</span></a> and <a class='info' href='#I-D.peluso-flowselection'>[I&#8209;D.peluso&#8209;flowselection]<span> (</span><span class='info'>Peluso, L., Zseby, T., D'Antonio, S., and M. Molina, &ldquo;Flow selection Techniques,&rdquo; November&nbsp;2007.</span><span>)</span></a>, respectively. In property match filtering, if the value of a specified Information Element equals a configured value, the function selects Flow Records/Packet Reports to forward.

</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.2"></a><h3>4.3.2.&nbsp;
Flow-based Collector Selection Function</h3>

<p>
The Flow-based Collector Selection function determines to which Collector input Flow Records/Packet Reports are exported. The function may also determine the type of Transport Session. The function evaluates the value of a specified Information Element in input Flow Records/Packet Reports and then selects the Collector. These selection criteria are similar to the property match filtering in Mediator Selection Function.

</p>
<p>
Applicable examples include exporting Flow Records/Packet Reports to a dedicated Collector on the basis of customers or organizations peering. The function classifies Flow Records/Packet Reports on the basis of a peering AS number, as shown in the following figure. The set of classified Flow Records/Packet Reports is exported to a dedicated Collector on the basis of the peering AS number.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        .----------------------------.
        | Intermediate Process       |
        |   .----------------------. |
        |   | Flow-Based Collector | |
        |   | Selection Function   | |
        |   |                      | |
        |   |     Peering AS #10   | |
        |   |  +-------------------+-+---&gt; Collector #1
        |   |  |  Peering AS #20   | |
Flow  --+---+--+-------------------+-+---&gt; Collector #2
Records |   |  |  Peering AS #30   | |
        |   |  +-------------------+-+---&gt; Collector #3
        |   '----------------------' |
        '----------------------------'
</pre></div>
<p>
Figure D: Exporting classified Flow Records to dedicated Collector.

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.3"></a><h3>4.3.3.&nbsp;
Aggregation Function</h3>

<p>
The Aggregation function creates aggregated Flow Records from input Flow Records/Packet Reports. The aggregation method is divided into three types:

</p>
<blockquote class="text"><dl>
<dt>Choosing Shorter Flow Key</dt>
<dd><br />

Choosing a shorter Flow Key than the Flow Key of input Flow Records, such as three, two, or a single Flow Key, can create more aggregated Flow Records. The function gathers Flow Records/Packet Reports within a given interval time and then distinguishes Flow Records/Packet Reports that have common properties. If values of a given key field are the same, that means those Flow Records/Packet Reports have common properties, and the function merges them in accordance with aggregation rules described in <a class='info' href='#I-D.dressler-ipfix-aggregation'>[I&#8209;D.dressler&#8209;ipfix&#8209;aggregation]<span> (</span><span class='info'>Dressler, F., Sommer, C., Munz, G., and A. Kobayashi, &ldquo;IPFIX Aggregation,&rdquo; July&nbsp;2008.</span><span>)</span></a>.<br />
<br />

In addition, the function can create statistical data and subsidiary information related to the aggregated Flow Records. Examples include the number of input Flow Records/Packet Reports, the given interval time, and a set of a new Flow Key.

</dd>
<dt>Time Composition</dt>
<dd><br />

Time composition is defined as aggregation with the same Flow Key for long-running Flows. The function may also compute Flow Records statistics, such as average, maximum, and minimum value of each counter. The statistics help to visualize the behavior of traffic volume over a long time period.<br />
<br />

As another approach, the function collects Flow Records/Packet Reports of a shorter time period from an Original Exporter, and then computes these statistics. Even if output Flow Records of the function indicate a general time period, the accuracy of the minimum, maximum, and average value can be improved.

</dd>
<dt>Space Composition</dt>
<dd><br />

Space composition is defined as aggregation on a larger Observation Domain or on a set of Observation Points. In that case, a Flow key can be applied to other properties, such as Exporter IP address and Observation Domain ID.<br />
<br />

In addition, a group identifier indicating a spatial Observation Domain can also become a new Flow Key. For example, a group can indicate an area on an ISP network, or a link aggregation interface composd of physical interfaces. The group can also make a relation to a set of values of specified Information Elements in Flow Records by the configuring rule. After converting from the values of specified Information Elements to the group identifier, the function can create aggregated Flow Records by a general aggregation process.

</dd>
</dl></blockquote><p>

</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.4"></a><h3>4.3.4.&nbsp;
Correlation Function</h3>

<p>
The Correlation function creates new metrics from by evaluating the correlation among sets of Flow Records/Packets Records. These sets can be Flow Records gathered during a certain period, a pair of consecutive Packet Reports, or Packet Reports exported by different Exporters indicating the same packet. After offering new metrics, the function outputs Flow Records with the new metrics field. Applicable examples are as follows.


</p>
<ul class="text">
<li>
One way delay follows from correlating Packet Reports exported from different Exporters on the path.

</li>
<li>
Packet interval time, or jitter, follows from correlating consecutive Packet Reports exported from the same Exporter.

</li>
<li>
Difference values follow from correlating Flow Records observed at ingress or egress interfaces. The values help to confirm the result of a queueing or rate-limiting function.

</li>
<li>
Average/maximum/minimum values follow from correlating each in a set of Flow Records.

</li>
</ul><p>



</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.5"></a><h3>4.3.5.&nbsp;
Modification Function</h3>

<p>
The Modification function modifies input Flow Records/Packet Reports without changing their granularity. The function can add new Information Elements, delete existing Information Elements, or modify the value of specified Information Elements. If the function modifies the data structure of an original Template, it also needs to modify the value of the "flowKeyIndicator".
</p>
<blockquote class="text"><dl>
<dt>Adding specified Information Elements</dt>
<dd><br />

The function obtains the value of a specified Information Element and then adds it into Flow Records/Packet Reports. There are several methods to obtain the value: retrieving the value from a database or calculating the value based on the value of other Information Elements and received traffic data.

</dd>
<dt></dt>
<dd>
Applicable examples include adding derived packet property parameters instead of Original Exporters. Doing that can compensate for traditional Exporters or probes unable to add packet property parameters. Therefore, Collectors do not need to recognize the difference among implementations of routers from several vendors or among Exporter types, such as router, switch, or probe. Typical derived packet property parameters include the following.

<ul class="text">
<li>
The "bgpNextHop{IPv4|IPv6}Address" described in <a class='info' href='#RFC5102'>[RFC5102]<span> (</span><span class='info'>Quittek, J., Bryant, S., Claise, B., Aitken, P., and J. Meyer, &ldquo;Information Model for IP Flow Information Export,&rdquo; January&nbsp;2008.</span><span>)</span></a> indicates the egress router of a network domain. That is useful for making a traffic matrix that covers the whole network domain.

</li>
<li>
The BGP Community value indicates the same group of destination or source IP addresses.

</li>
<li>
The "mplsVpnRouteDistinguisher" described in <a class='info' href='#RFC5102'>[RFC5102]<span> (</span><span class='info'>Quittek, J., Bryant, S., Claise, B., Aitken, P., and J. Meyer, &ldquo;Information Model for IP Flow Information Export,&rdquo; January&nbsp;2008.</span><span>)</span></a>, which cannot be extracted from the core router in MPLS networks, indicates the VPN customer's identification. Network operators can monitor the traffic behavior of each customer by adding "mplsVpnRouteDistinguisher" to Flow Records/Packet Reports.

</li>
</ul>

</dd>
<dt>Deleting specified Information Elements</dt>
<dd><br />
 
This function deletes existing Information Elements according to instruction rules, which indicate whether an Information Element should be removed.

</dd>
<dt></dt>
<dd>
Applicable examples include hiding network topology information and private information. In the case of IPFIX exporting across domains, the function can avoid making a vulnerability by deleting unnecessary Information Elements. Examples of network topology information include "ipNextHopIP{v4|v6}Address", "bgpNextHopIP{v4|v6}Address", and "bgp{Next|Prev}AdjacentAsNumber", described in <a class='info' href='#RFC5102'>[RFC5102]<span> (</span><span class='info'>Quittek, J., Bryant, S., Claise, B., Aitken, P., and J. Meyer, &ldquo;Information Model for IP Flow Information Export,&rdquo; January&nbsp;2008.</span><span>)</span></a>. In addition, MPLS-related Information Elements, such as "mplsLabelStackSection", are useless for customers in the case of feeding Flow Records/Packet Reports to VPN customers.

</dd>
<dt>Modifying the value of specified Information Elements</dt>
<dd><br />

This function modifies the value of specified Information Elements.

</dd>
<dt></dt>
<dd>
Applicable examples include anonymizing customers' private information, such as IP address and port number, according to a privacy protection policy. Several annonymization techniques are described in <a class='info' href='#I-D.boschi-ipfix-anon'>[I&#8209;D.boschi&#8209;ipfix&#8209;anon]<span> (</span><span class='info'>Boschi, E. and B. Trammell, &ldquo;IP Flow Anonymisation Support,&rdquo; July&nbsp;2008.</span><span>)</span></a>. The function also reports anonymization methods and part of anonymized data as subsidiary information.

</dd>
</dl></blockquote><p>

</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
IPFIX File Writer/Reader</h3>

<p>
The IPFIX File Writer stores input Flow Records/Packet Reports from any process in a storage system. If received Flow Records/Packet Reports include uninteresting Information Elements, the Modification Function can delete these elements before the IPFIX File Writer handles them. Therefore, IPFIX File Writers can accept input from any process. In either case, input needs to include the IPFIX header information and the Transport Session Information along with Flow Records/Packet Reports.

</p>
<p>
In contrast, the IPFIX File Reader retrieves stored Flow Records/Packet Reports when operators want to retrieve past Flow Records/Packet Reports on the basis of a given time period. If the data structure of output Flow Records/Packet Reports from the IPFIX File Reader is different from what operators want, the Modification function can modify the data structure. Therefore, the output of IPFIX File Readers can be input to any components. The IPFIX File Writer/Reader are described in <a class='info' href='#I-D.ietf-ipfix-file'>[I&#8209;D.ietf&#8209;ipfix&#8209;file]<span> (</span><span class='info'>Trammell, B., Boschi, E., Mark, L., Zseby, T., and A. Wagner, &ldquo;An IPFIX-Based File Format,&rdquo; October&nbsp;2008.</span><span>)</span></a> in detail.

</p>
<p>
The figure shows the IPFIX component model with IPFIX File Writer/Reader. IPFIX File Writer/Reader are located in the same position of Exporting Process/Collecting Process, respectively.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        IPFIX (Flow Records/Packet Reports)
                          ^
                        ^ |
 .----------------------|-+--------------------.
.-----------------------+---------------------.|
| Exporting Process (es) / IPFIX File Writer  |'
'----^------------------^---------------------'
     |                  | |
     |    .-------------|-+--------------------.
     |   .--------------+---------------------.|
     |   |     Intermediate Process (es)      |'
     |   '--------------^-^-------------------'
     |                  | |
 .---+------------------|-+--------------------.
.-----------------------+---------------------.|
| Collecting Process (es) / IPFIX File Reader |'
'-----------------------^---------------------'
                        |
         IPFIX (Flow Records/Packet Reports)

</pre></div>
<p>
Figure E: IPFIX Mediator Component Model with IPFIX File Writer/Reader.

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Flow Expiration</h3>

<p>
The Aggregation function needs expiration conditions to export cached Flow Records. These conditions are described in <a class='info' href='#I-D.ietf-ipfix-architecture'>[I&#8209;D.ietf&#8209;ipfix&#8209;architecture]<span> (</span><span class='info'>Sadasivan, G., Brownlee, N., Claise, B., and J. Quittek, &ldquo;Architecture for IP Flow Information Export,&rdquo; September&nbsp;2006.</span><span>)</span></a>. In the case of IPFIX Mediation, these conditions are as follows:
</p>
<ul class="text">
<li>
If there are no input/received Flow Records/Packet Reports belonging to a cached Flow for a certain time period, aggregated Flow Records will expire. This time period should be configurable at the Intermediate Process.
</li>
<li>
If the IPFIX Mediator experiences resource constraints, aggregated Flow Records may prematurely expire (e.g., lack of memory to store Flow Records).

</li>
<li>
For long-running Flows, the Intermediate Process should expire the Flow on a regular basis or based on some expiration policy. This periodicity or expiration policy should be configurable at the Intermediate Process.  

</li>
</ul><p>
The Correlation function also needs similar expiration conditions. However, when cached Flow Records/Packet Reports prematurely expire and the function can not compute the correlation among them, cached Flow Records/Packet reports may be discarded.

</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
Information Model</h3>

<p>
IPFIX Mediation reuse the general information model from <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a> and from <a class='info' href='#I-D.ietf-psamp-info'>[I&#8209;D.ietf&#8209;psamp&#8209;info]<span> (</span><span class='info'>Dietz, T., Claise, B., Aitken, P., Dressler, F., and G. Carle, &ldquo;Information Model for Packet Sampling Exports,&rdquo; October&nbsp;2008.</span><span>)</span></a>. The following new Information Elements for IPFIX Mediation are also needed.
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+-----+---------------------------+-----+---------------------------+
|  ID | Name                      |  ID | Name                      |
+-----+---------------------------+-----+---------------------------+
| XXX | averageBitRate            | XXX | averagePacketsRate        |
| XXX | minimumBitRate            | XXX | minimumPacketsRate        |
| XXX | maximumBitRate            | XXX | maximumPacketsRate        |
+-----+---------------------------+-----+---------------------------+
</pre></div><p>


</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7"></a><h3>4.7.&nbsp;
Examples</h3>

<p>
As example, in case of Intermediate Processes having different functions, a Collecting Process/IPFIX File Reader replicates Flow Records/Packet Reports, if necessary, and forwards them to a suitable Intermediate Process/Exporting Process. Example figure is shown below.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                     IPFIX           IPFIX               IPFIX
                       ^               ^                   ^
                       |               |                   |
 .------------.  .-----+-------. .-----+-------.    .------+------.
 | IPFIX File |  | Exporting   | | Exporting   |    | Exporting   |
 |  Writer    |  |  Process {i}| |  Process {j}|....|  Process {n}|
 '-----^-^----'  '-----^-------' '-----^-------'    '------^------'
       | |             |               |                   |
       | +-------------+               |             Flow Records
       |          Flow Records / Packet Reports            |
       |        .------+-------. .-----+--------.   .------+-------.
       |        | Intermediate | | Intermediate |   | Intermediate |
       |        |  Process {l} | |  Process {m} |   |  Process {p} |
       |        |              | |              |...|              |
       |        |  Flow-based  | |  Flow-based  |   |              |
       |        |   Collector  | |   Collector  |   |              |
       |        |   Selection  | |   Selection  |   |              |
  Flow Records  |      ^       | |      ^       |   |              |
       |        |      |       | |      |       |   |              |
       |        |  Correlation | |  Modification|   |  Modification|
       |        |      ^       | |      ^       |   |      ^       |
       |        |      |       | |      |       |   |      |       |
       |        |  Selection   | |  Aggregation |...|  Selection   |
       |        |      ^       | |     ^ ^      |   |      ^       |
       |        '------|-------' '-----|-|------'   '------|-------'
       |               |               | |                 |
       |               +---------------+ |           Flow Records
       |               |                 |                 |
       |          Flow Records / Packet Reports            |
.------+------. .------+------.   .------+------.    .-----+------.
| Collecting  | | Collecting  |   | Collecting  |    | IPFIX File |
|  Process {i}| |  Process {j}|...|  Process {n}|    |  Reader    |
'------^------' '------^------'   '------^------'    '------------'
       |               |                 |
     IPFIX           IPFIX             IPFIX
</pre></div>
<p>
Figure F: Functional Block Examples for IPFIX Mediator.

</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>IPFIX Mediators use the IPFIX protocol. Security considerations about Flow Records are described in <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>.

</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>This document has no actions for IANA.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-ipfix-architecture">[I-D.ietf-ipfix-architecture]</a></td>
<td class="author-text">Sadasivan, G., Brownlee, N., Claise, B., and J. Quittek, &ldquo;Architecture for IP Flow Information Export,&rdquo; draft-ietf-I-D.ietf-ipfix-architectureitecture-12.txt(work in progress)&nbsp;, September&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-psamp-framework">[I-D.ietf-psamp-framework]</a></td>
<td class="author-text">Duffield, N., &ldquo;A Framework for Packet Selection and Reporting,&rdquo; draft-ietf-psamp-framework-13.txt&nbsp;, June&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-psamp-info">[I-D.ietf-psamp-info]</a></td>
<td class="author-text">Dietz, T., Claise, B., Aitken, P., Dressler, F., and G. Carle, &ldquo;Information Model for Packet Sampling Exports,&rdquo; draft-ietf-psamp-info-11.txt (work in progress)&nbsp;, October&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-psamp-protocol">[I-D.ietf-psamp-protocol]</a></td>
<td class="author-text">Claise, B., Quittek, J., and A. Johnson, &ldquo;Packet Sampling (PSAMP) Protocol Specifications,&rdquo; draft-ietf-psamp-protocol-09.txt&nbsp;, December&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3917">[RFC3917]</a></td>
<td class="author-text">Quittek, J., Zseby, T., Claise, B., and S. Zander, &ldquo;Requirements for IP Flow Information Export(IPFIX),&rdquo; October&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5101">[RFC5101]</a></td>
<td class="author-text">Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5102">[RFC5102]</a></td>
<td class="author-text">Quittek, J., Bryant, S., Claise, B., Aitken, P., and J. Meyer, &ldquo;Information Model for IP Flow Information Export,&rdquo; January&nbsp;2008.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.boschi-ipfix-anon">[I-D.boschi-ipfix-anon]</a></td>
<td class="author-text">Boschi, E. and B. Trammell, &ldquo;IP Flow Anonymisation Support,&rdquo; draft-boschi-ipfix-anon-01.txt (work in progress)&nbsp;, July&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.dressler-ipfix-aggregation">[I-D.dressler-ipfix-aggregation]</a></td>
<td class="author-text">Dressler, F., Sommer, C., Munz, G., and A. Kobayashi, &ldquo;IPFIX Aggregation,&rdquo; draft-dressler-ipfix-aggregation-05.txt (work in progress)&nbsp;, July&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-ipfix-file">[I-D.ietf-ipfix-file]</a></td>
<td class="author-text">Trammell, B., Boschi, E., Mark, L., Zseby, T., and A. Wagner, &ldquo;An IPFIX-Based File Format,&rdquo; draft-ietf-ipfix-file-03.txt(work in progress)&nbsp;, October&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-ipfix-mediator-ps">[I-D.ietf-ipfix-mediator-ps]</a></td>
<td class="author-text">Kobayashi, A., Nishida, H., Sommer, C., Dressler, F., Stephan, E., and B. Claise, &ldquo;IPFIX Mediation: Problem Statement,&rdquo; draft-ietf-ipfix-mediation-problem-statement-01.txt(work in progress)&nbsp;, September&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.peluso-flowselection">[I-D.peluso-flowselection]</a></td>
<td class="author-text">Peluso, L., Zseby, T., D'Antonio, S., and M. Molina, &ldquo;Flow selection Techniques,&rdquo; draft-peluso-flowselection-tech-01.txt(work in progress)&nbsp;, November&nbsp;2007.</td></tr>
</table>

<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Acknowledgements</h3>

<p>
The authors gratefully acknowledge the contributions of<br />
<br />

Keisuke Ishibashi,<br />

Tsuyoshi Kondoh, and<br />

Daisuke Matsubara.<br />


</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Atsushi Kobayashi</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NTT Information Sharing Platform Laboratories</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">3-9-11 Midori-cho</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Musashino-shi, Tokyo  180-8585</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81-422-59-3978</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:akoba@nttv6.net">akoba@nttv6.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Haruhiko Nishida</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NTT Information Sharing Platform Laboratories</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">3-9-11 Midori-cho</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Musashino-shi, Tokyo  180-8585</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81-422-59-3978</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:nishida.haruhiko@lab.ntt.co.jp">nishida.haruhiko@lab.ntt.co.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Benoit Claise</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">De Kleetlaan 6a b1</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Diegem  1831</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Belgium</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+32 2 704 5622</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:bclaise@cisco.com">bclaise@cisco.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
