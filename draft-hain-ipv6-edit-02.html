<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IPv6 Edge Domain Implicit Tunnel (EDIT)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IPv6 Edge Domain Implicit Tunnel (EDIT)">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">T. Hain</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Cisco Systems</td></tr>
<tr><td class="header">Intended status:  Standards Track</td><td class="header">July 10, 2010</td></tr>
<tr><td class="header">Expires:  January 11, 2011</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />IPv6 Edge Domain Implicit Tunnel (EDIT)<br />draft-hain-ipv6-edit-02</h1>

<h3>Abstract</h3>

<p>There will be IPv4-only applications that remain in use as network managers begin deploying IPv6-only networks, or turning off IPv4 in the exiting dual-stack networks. These applications require a dual-stack capable host operating system, but that OS may find that the local network has not provided on-link IPv4 provisioning or routing support for the resulting packets. Skepticism that this situation will exist is widespread; because it is easy to ignore the costs someone else will incur and focus on the local situation. Taking the system level viewpoint, that skepticism makes no sense when it is widely acknowledged that people will resist replacing something that is working, particularly when the reason it might artificially stop is due to 'someone else's problem'. The reality of IPv4-only applications persisting in an IPv6-only provisioned network is specifically ignored by RFC 4038. This document deals with the situation by defining a new tunneling type for use within the edge or leaf network to the border where it interconnects with an IPv4 routing domain.
</p>
<p>The draft is being discussed on the ipv6@ietf.org list. 
</p>
<h3>Legal</h3>

<p>This documents and the information contained therein are provided on
      an "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
      OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
      THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR
      IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
      INFORMATION THEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
      WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on January 11, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#acks">1.1.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<a href="#anchor3">3.</a>&nbsp;
Mechanism<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
Logical Perspective<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.3.</a>&nbsp;
DHCP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.4.</a>&nbsp;
DNS Issues<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.5.</a>&nbsp;
Fragmentation<br />
<a href="#anchor9">4.</a>&nbsp;
Domain of applicability and network diagram <br />
<a href="#anchor10">5.</a>&nbsp;
Sequence <br />
<a href="#anchor11">6.</a>&nbsp;
Open Issues<br />
<a href="#anchor12">7.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor13">8.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>******* This document needs to become a compressed version of ds-lite *********   As network managers begin considering deployment of IPv6-only networks, they stumble across the problem of IPv4-only applications that would continue to work as long as there is a way to transport the IPv4 across their IPv6-only network. The proposed approach known as DSTM <a class='info' href='#DSTM'>[DSTM]<span> (</span><span class='info'>Bound, J., &ldquo;Dual Stack IPv6 Dominant Transition Mechanism (DSTM),&rdquo; October&nbsp;2005.</span><span>)</span></a>was an earlier attempt at solving this problem, which failed to gain traction, likely due to its complexity, but also simply being too far ahead of the timeframe when many people were giving serious consideration to the existence of IPv6-only networks.
</p>
<p>As the reality of the IPv4 free pool exhaustion<a class='info' href='#potaroo'>[potaroo]<span> (</span><span class='info'>, &ldquo;IPv4 pool study - Huston,&rdquo; .</span><span>)</span></a><a class='info' href='#tndh'>[tndh]<span> (</span><span class='info'>, &ldquo;IPv4 pool study - Hain,&rdquo; .</span><span>)</span></a>becomes accepted by network managers, the desire to move straight to IPv6-only is becoming a common theme. While this might seem counter intuitive to some, but is a natural follow-on to the long running industry hype about 'convergence'. At a minimum, adding a second protocol to run dual-stack would appear to contradict every justification used to get rid of other protocols in favor of IPv4, so there is a strong, possibly unconscious, self-preservation based bias to do a hard cutover. While the goal of running an IPv6-only network is within reach from an infrastructure perspective, the number of IPv4-only applications, that will continue to exist for some time, makes that difficult to achieve in practice. Most people immediately look for an IPv6 to IPv4 address family translator such as IVI <a class='info' href='#IVI'>[IVI]<span> (</span><span class='info'>Li, X., Bao, C., Chen, M., Zhang, H., and J. Wu, &ldquo;The CERNET IVI Translation Design and Deployment for the IPv4/IPv6,&rdquo; June&nbsp;2009.</span><span>)</span></a>, but the translation approach is designed to deal with the case where one end of the application has switched while the other one has not. There are proposals to translate from IPv4 to IPv6 then back to IPv4 before delivery, yet these are generally dismissed due to complexity. To support an IPv4 api on the endpoint, tunneling of IPv4 over IPv6 to a point that has native IPv4 routing makes more sense than translation, and is less prone to application failure than any 464 translation sequence with the complimentary set of application gateway services.
</p>
<p>DS-lite <a class='info' href='#DS-lite'>[DS&#8209;lite]<span> (</span><span class='info'>Durand, S., &ldquo;Dual-stack lite broadband deployments post IPv4 exhaustion,&rdquo; December&nbsp;1998.</span><span>)</span></a>is a technology which does tunnel IPv4 over IPv6, and is being targeted for environments where the local area network continues to support IPv4 while a portion of the transit network is IPv6-only. It is also targeted at deployment in wired environments where the overhead bits of encapsulation are effectively free.
</p>
<p>The radio spectrum limitations of Wireless networks make the bits-per-packet more expensive than wired environments, so removing any unnecessary overhead is a high priority task. Another characteristic of the Wireless network environment is typically the devices are battery powered, so minimizing the number of instructions to prepare a packet for transmission becomes important. Taken together, these important issues lead one to conclude that the simple IPv4-in-IPv6 encapsulation of DS-lite (or DSTM), and header compression requiring extra battery consumption are not acceptable engineering approaches to meet those specific cost constraints of the wireless environment. 
</p>
<p>This document details an approach which effectively completely compresses out the inner IPv4 header, without the extra computation of something like VJ header compression [6]. As there are concerns about the system impact of integrating IPv4 routing with IPv6 routing, this approach is limited to the edge or leaf network, where the degree of integration is under local control, and the total amount of detailed routing knowledge will be limited.
</p>
<p>This is not a means to route entire IPv4 networks over IPv6 (as DS-lite would be when replacing an IPv4 nat), rather it is a way for an operating system to present a working set of IPv4 api's to the applications, despite the lack of IPv4 routing on the local network segment. There is no relationship between this mechanism and any IPv6 address that might be used for communicating with other IPv6 endpoints, as the IPv6 address and functionality here is limited to the tunnel interface for transiting IPv4 packets. This adds a function specific IPv6 address; it does not replace the one used by IPv6 applications.
</p>
<a name="acks"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Acknowledgements</h3>

<p>Comments provided by Dan Wing, Fred Baker, and Wojciech Dec 
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in 

<a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>
.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Mechanism</h3>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Format</h3>

<p>The mechanism defined here is a means to provision and transport IPv4-only applications over IPv6-only network as a tunnel. To minimize transport overhead, the IPv4 header is implicit and completely compressed out when transiting the IPv6-only network, then the IPv6 header is stripped off and replaced by the implied IPv4 one when transiting the IPv4 enabled part of the network. At the boundary between the IPv6-only leaf network, and the IPv4 transit domain, the packet header is replaced by the opposing version before forwarding onward. As this is not a complete version translation, and the end-to-end perceives this is a functional transparent IPv4 path between the api's, no application layer gateways (ALGs) are required (beyond whatever might have been required when the endpoints actually had IPv4 routing available). 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   |                80 bits               | 16 |      32 bits        |
   +--------------------------------------+--------------------------+
   |0000..............................0000|FFFF|    IPv4 address     |
   +--------------------------------------+----+---------------------+

</pre></div>
<p>The IPv4-mapped address discussed in section 2.5.5.2 of the IP Version 6 Addressing Architecture<a class='info' href='#ADDARCH'>[ADDARCH]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;Internet Protocol Version 6 (IPv6) Addressing Architecture,&rdquo; April&nbsp;2003.</span><span>)</span></a>is used to provision the tunnel interface for IPv6, then the IPv4 address is extracted to provision the IPv4 side of the tunnel interface. Routing of the ::ffff:0:0/96 prefix is limited to the edge network, and that prefix or anything longer than /96 that might be used for local traffic engineering, does not impact any other IPv6 routing domain. While the simple thing to do would be to just route the /96 to the border router, that would cause all IPv4 traffic within the edge network to bounce off the border which may be sub-optimal. The more logical thing to do would be to route the /120 (if IPv4 would have been a /24), or /96+ what would have been the case if IPv4 routing were provided within the edge network.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Logical Perspective</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                            ,,======``
                            ||       ``
           +--------------------+    ||    +------------------------+
           |        IPv6        |    ||    |          IPv4          |
           +--------------------+    ||    +------------------------+
                     ||              ||                ||
           +--------------------+    ||    +------------------------+
           | Physical interface |    ||    |  EDIT tunnel interface |
           |                    |    ``    |     (DHCPv4 client)    |
           +--------------------+     ``   +------------------------+
                                       ``              ||
                                        ``=============�
</pre></div>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
DHCP</h3>

<p>The goal of the approach is to maintain maximum compatibility for IPv4-only applications, so the existing IPv4 DHCP service will be used. This will mean all IPv4 DHCP options continue to be available. Reaching the DHCP service will require a relay function to exist at the remote border router EDIT tunnel interface, while the local EDIT tunnel interface will need to intercept all IPv4 DHCP messages and forward them to the border router relay function. The IPv6 address of the DHCP relay function to the IPv4 DHCP service will be the IPv6 anycast address ::ffff:0:3 ; (ff02::1:2 is the link-scope multicast for all DHCPv6 agents &amp; ff05::1:3 is the site-scope multicast for all DHCPv6 servers ff05::1:4 is the site-scope multicast for all DHCPv6 relays; an RFC 3306 interpretation of those could be ff02::ffff:1:2, ff05::ffff:1:3, &amp; ff05::ffff:1:4, but assuming that the border router is not on the same link as the EDIT enabled device, the link scope one would not work;  multicast makes no sense in this context, as the goal is to reach the nearest instance of the relay, not to reach all the members of the group; ::ffff:1:4 would be in the HP/DEC 16/8 block).  The DHCP provided lifetime for public IPv4 addresses will be 5 minutes by default in this environment, and the EDIT interface will be tasked with renewing as long as there are active connections, then releasing it when the timer expires after all connections are closed. 
</p>
<p>The source IPv4 address used during initial conversation with the IPv4 DHCP server would normally be the unspecified address, which using this mechanism would result in an IPv6 source address of ::ffff:0:0. As there is no way for the DHCP relay to route the responses to that address, a functional equivalent of the IPv6 solicited-node multicast group with site-scope will be used ... 224.0.0.1 is the IPv4 group for 'all hosts', so ff05::ffff:e0:1 would be the site-scope multicast for all IPv4 endpoints. Therefore every endpoint EDIT interface needs to join that group.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
DNS Issues</h3>

<p>The IPv4 side of the stack uses IPv4 to communicate with DNS and retrieve A records (or other RRs) as if there were no IPv6 in the system. There is no translation or synthesis of record types between versions, so dnssec will not be impacted.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Fragmentation</h3>

<p>The MTU on the IPv4 side of the EDIT tunnel interface is the MTU provided to the IPv6 stack minus 20. (Could be set to 1280 just to make sure there is no outbound fragmentation for the local EDIT interface to deal with, as this is intended to be support for legacy apps as the ability to route IPv4 is being withdrawn.)  
</p>
<p>At the Border Router, fragmentation may be required in either direction, but this is no different than any other mid-network fragmentation that occurs in IPv4.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Domain of applicability and network diagram </h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  ----------------------------------------------
 | Edge or Leaf network                         |     ---------------
 |                           IPv6-only        --^---&gt;| App / Service |
 |          End system           routing     /  |     ---------------
 |    -----------------------               /   |
 |   | IPv4-only application |             /    |        IPv4
 |   |-----------------------|  (logical) /     |          routing
 |   |      IPv4 stack       | &lt;---------/      |
 |   |-----------------------|               ----------------
 |   | EDIT tunnel interface |              |   Dual-stack   |
 |   |-----------------------|              | Border Router  |
 |   |      IPv6 stack       |              | ---------------|
 |   |-----------------------|/------------\| (DHCPv4 relay) |
 |   |  Physical interface   | IPv4 in IPv6 | EDIT interface |
 |    ----------------------- \------------/ ----------------
 |                                              |
  ----------------------------------------------

</pre></div>
<p>There can be many border routers, and since the mapping operation is a stateless transform the packets don't have to follow a symmetric path. 
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Sequence </h3>

<p>Step 1) the application on the originating node calls the IPv4 stack API to initiate communication.
</p>
<p>Step 2) the OS stack recognizes that the EDIT tunnel interface is not provisioned with an address, and that it is operating in an IPv6-only provisioning environment, so it requests an address from the DHCPv4 service. (This will require a DHCPv4 relay defined to exist at a well-known IPv6 address.)
</p>
<p>Step 3) the DHCPv4 service acquires an IPv4 address from the IPv4 pool that this endpoint is assigned to, and the EDIT interface will use the IPv4 address to construct an IPv4-mapped format IPv6 address.
</p>
<p>Step 4) the EDIT interface provisions the IPv6 side tunnel interface with the IPv4-mapped address, then the IPv4 side of its stack, and the OS responds to the api call. 
</p>
<p>Step 5) the application continues the connection attempt, resulting in a packet to the remote endpoint, which is routed internally via the IPv4 side of the stack, until the EDIT tunnel device driver picks it up and continues processing on the IPv6 side of the stack. The actual packet transmitted by the physical interface is in IPv6 format, using IPv4-mapped addresses.
</p>
<p>Step 6) the leaf network routing system forwards the IPv6 packet to the border, where the EDIT tunnel endpoint uses a stateless transform to extract the contents and construct an IPv4 packet based on the embedded IPv4 addresses and forwards that into the IPv4 routing domain.
</p>
<p>Step 7) the return packet from the other end system is routed over the IPv4 routing domain to the border based on standard routing of the IPv4 prefix used, where the EDIT tunnel endpoint uses a stateless transform to extract the contents and construct an IPv6 packet based using IPv4-mapped addresses based on the IPv4 addresses in the received packet, then forwards that into the IPv6-only leaf network routing system. 
</p>
<p>Step 8) the OS stack IPv6 side receives the packet and passes it to the EDIT tunnel device driver which extracts the embedded IPv4 address from the IPv4-mapped format IPv6 address, as well as the contents, then constructs an IPv4 packet and passes the packet to the IPv4 side of the OS stack.
</p>
<p>Step 9) once the connection or application is closed, the OS stack sends a message to the DHCPv4 service to explicitly release the reservation on the IPv4 address. (need to change this because ajax would cause constant churn)
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Open Issues</h3>

<p>Detecting when a border router is available on one side but not the other :: blackhole. Routing announcements on each side need to be keyed off the fact that both sides are up.
</p>
<p>Tcp options mapping between headers...  tunneling -- not translation : is this an IPv6 option that just carries the IPv4 option set intact?
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>There are no IANA issues at this time.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>The use of an implicit tunnel as described here has the same security concerns that any tunneling mechanism wouuld have, in that the agents of packet transformation must be trusted.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ADDARCH">[ADDARCH]</a></td>
<td class="author-text">Hinden, R. and S. Deering, &ldquo;<a href="http://tools.ietf.org/html/rfc3513">Internet Protocol Version 6 (IPv6) Addressing Architecture</a>,&rdquo; RFC&nbsp;3513, April&nbsp;2003 (<a href="ftp://ftp.isi.edu/in-notes/rfc3513.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="DS-lite">[DS-lite]</a></td>
<td class="author-text"><a href="mailto:alain_durand@cable.comcast.com">Durand, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2460">Dual-stack lite broadband deployments post IPv4 exhaustion</a>,&rdquo; RFC&nbsp;2460, December&nbsp;1998 (<a href="draft-ietf-softwire-dual-stack-lite-01">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="DSTM">[DSTM]</a></td>
<td class="author-text">Bound, J., &ldquo;<a href="http://www.dstm.info/doc/draft-bound-dstm-exp-04.txt">Dual Stack IPv6 Dominant Transition Mechanism (DSTM)</a>,&rdquo; DSTM&nbsp;, October&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="IVI">[IVI]</a></td>
<td class="author-text"><a href="mailto:xing@cernet.edu.cn">Li, X.</a>, <a href="mailto:congxiao@cernet.edu.cn">Bao, C.</a>, <a href="mailto:mk@cernet.edu.cn">Chen, M.</a>, <a href="mailto:neilzh@gmail.com">Zhang, H.</a>, and <a href="mailto:jianping@cernet.edu.cn">J. Wu</a>, &ldquo;<a href="draft-xli-behave-ivi-02">The CERNET IVI Translation Design and Deployment for the IPv4/IPv6</a>,&rdquo; June&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="NUMBERS">[NUMBERS]</a></td>
<td class="author-text">&ldquo;<a href="http://www.iana.org/numbers/">IANA Numbers Authority</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="potaroo">[potaroo]</a></td>
<td class="author-text">&ldquo;<a href="www.potaroo.net/tools/ipv4 ">IPv4 pool study - Huston</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="tndh">[tndh]</a></td>
<td class="author-text">&ldquo;<a href="http://tndh.net/~tony/ietf">IPv4 pool study - Hain</a>.&rdquo;</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tony Hain</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">500 108th Ave NE</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bellevue, WA  98004</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 425 468-1061</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:alh-ietf@tndh.net">alh-ietf@tndh.net</a></td></tr>
</table>
</body></html>
