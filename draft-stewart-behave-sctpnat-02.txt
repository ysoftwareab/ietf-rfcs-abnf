



Network Working Group                                         R. Stewart
Internet-Draft                                       Cisco Systems, Inc.
Expires: December 1, 2006                                      M. Tuexen
                                      Muenster Univ. of Applied Sciences
                                                            May 30, 2006


Stream Control Transmission Protocol (SCTP) Network Address Translation
                  draft-stewart-behave-sctpnat-02.txt

Status of this Memo

   By submitting this Internet-Draft, each author represents that any
   applicable patent or other IPR claims of which he or she is aware
   have been or will be disclosed, and any of which he or she becomes
   aware will be disclosed, in accordance with Section 6 of BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on December 1, 2006.

Copyright Notice

   Copyright (C) The Internet Society (2006).

Abstract

   Stream Control Transmission Protocol RFC2960 [6] provides a reliable
   communications channel between two end-hosts in many ways similar to
   TCP RFC793 [2].  With the widespread deployment of Network Address
   Translators (NAT), specialized code has been added to NAT for TCP
   that allows multiple hosts to reside behind a NAT and yet use only a
   single globally unique IPv4 address, even when two hosts (behind the
   NAT) choose the same port numbers for their connection.  This



Stewart & Tuexen        Expires December 1, 2006                [Page 1]

Internet-Draft      SCTP Network Address Translation            May 2006


   additional code is sometimes classified as Network Address and Port
   Translation or NAPT.  To date, specialized code for SCTP has NOT yet
   been added to most NAT's so that only pure NAT is available.  The end
   result of this is that only one SCTP capable host can be behind a
   NAT.

   This document describes an SCTP specific variant of NAT which
   provides similar features of NAPT in the single point traversal
   scenario described in NATCONS [1].  Furthermore both algorithms are
   compared.


Table of Contents

   1.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  3
   2.  Terminology  . . . . . . . . . . . . . . . . . . . . . . . . .  3
   3.  The SCTP specific variant of NAT . . . . . . . . . . . . . . .  4
   4.  Discussion of the SCTP specific variant of NAT . . . . . . . .  7
   5.  Security considerations  . . . . . . . . . . . . . . . . . . .  7
   6.  References . . . . . . . . . . . . . . . . . . . . . . . . . .  8
   Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . . .  9
   Intellectual Property and Copyright Statements . . . . . . . . . . 10





























Stewart & Tuexen        Expires December 1, 2006                [Page 2]

Internet-Draft      SCTP Network Address Translation            May 2006


1.  Introduction

   Stream Control Transmission Protocol RFC2960 [6] provides a reliable
   communications channel between two end-hosts in many ways similar to
   TCP RFC793 [2].  With the widespread deployment of Network Address
   Translators (NAT), specialized code has been added to NAT for TCP
   that allows multiple hosts to reside behind a NAT and yet use only a
   single globally unique IPv4 address, even when both hosts (behind the
   NAT) choose the same port numbers for their connection.  This
   additional code is sometimes classified as Network Address and Port
   Translation or NAPT.  To date, specialized code for SCTP has NOT yet
   been added to most NAT's so that only true NAT is available.  The end
   result of this is that only one SCTP capable host can be behind a
   NAT.

   This document proposes an SCTP specific variant NAT that provides the
   NAPT functionality without changing SCTP port numbers.  The authors
   feel it is possible and desirable to make these changes for a number
   of reasons.

   o  It is desirable for SCTP end-hosts on multiple platforms to be
      able to share a global IP address behind a NAT, much as TCP does
      today.

   o  If a NAT does not need to change any data within an SCTP packet it
      will reduce the processing burden of NAT'ing SCTP by NOT needing
      to execute the CRC32c checksum required by SCTP.

   o  Not having to touch the IP payload makes the processing of ICMP
      messages in NATs easier.


2.  Terminology

   For this discussion we will use several terms.  For clarity we will
   first define these terms.

   o  Global-Address - That address that a host behind a NAT is
      attempting to contact.

   o  Global-Port - The port number of the peer process at the Global-
      Address.

   o  Local-Address - The local address that is known to the host behind
      the NAT, aka a private address RFC1918 [3].

   o  Local-Port - The port number that is in use by the host holding
      the Local-Address.  Normally this is the port that will be



Stewart & Tuexen        Expires December 1, 2006                [Page 3]

Internet-Draft      SCTP Network Address Translation            May 2006


      translated by the NAPT to a different port number.

   o  Nat-Global-Address - The global address assigned to the NAT box
      which it uses as a source address when sending packets towards the
      Global-Address.

   o  Natted-Port - The port number that the NAT is using to represent
      the Local-Port when send data packets toward the Global-Address
      and Global-Port.

   o  Local-Vtag - The Verification Tag that the host inside the natted
      address space has chosen for its communication.  The V-Tag is a
      unique 32 bit tag that must accompany any incoming SCTP packet for
      this association to the Local-Address.

   o  Remote-Vtag - The Verification Tag that the host holding the
      Global-Address has chosen for its communication.  The V-Tag is a
      unique 32 bit tag that must accompany any incoming SCTP packet for
      this association to the Global-Address.


3.  The SCTP specific variant of NAT

   In this section we assume that we have multiple SCTP capable hosts
   behind a NAT which has one Nat-Global address.  Furthermore we are
   considering only the single point traversal scenario described in
   NATCONS [1].

   The modification of SCTP packets sent to the public Internet is easy.
   The source address of the packet has to be replaced with the Nat-
   Global-Address.  It may also be necessary to establish some state in
   the NAT box to handle incoming packets, which is discussed later.

   For SCTP packets coming from the public Internet the destination
   address of the packets has to be replaced with the Local-Address of
   the host the packet has to be delivered to.  The lookup of the Local-
   Address is based on the Global-VTag, Global-Port, Global-Address,
   Local-Vtag and the Local-Port.

   For the SCTP NAT processing the NAT box has to maintain a table of
   Global-VTag, Global-Port, Global-Address, Local-VTag, Local-Port and
   Local-Address.  An entry in that table is called a NAT state control
   block.

   The processing of outgoing SCTP packets containing an INIT-chunk is
   described in the following figure.





Stewart & Tuexen        Expires December 1, 2006                [Page 4]

Internet-Draft      SCTP Network Address Translation            May 2006


   Local-Network                               Global-Internet

       [From(Local-Address,Local-Port),
          To(Global-Address:Global-Port)
        INIT(Initiate-Tag)]------->

              Create(Global-Port,Global-Address,Initiate-Tag,Local-Port,Local-Address)
                 <---Returns(NAT-State control block)

              Translate To:

                    [From(Nat-Global-Address:Local-Port),
                     To(Global-Address:Global-Port)
                     INIT(Initiate-Tag)]------->

   It should be noted that normally no NAT control block will be
   created.  However it is possible that that there is already a NAT
   control block with the same Global-Port, Global-Address, Initiate-
   Tag, Local-VTag but different Local-Address.  In this case the INIT
   SHOULD be dropped and an ABORT MAY be sent back.

   The processing of outgoing SCTP packets containing no INIT-chunk is
   described in the following figure.

   Local-Network                               Global-Internet

       [From(Local-Address,Local-Port),
          To(Global-Address:Global-Port)]------->


              Translate To:

                    [From(Nat-Global-Address:Local-Port),
                     To(Global-Address:Global-Port)]------->

   The processing of incoming SCTP packets containing INIT-ACK chunks is
   described in the following figure.














Stewart & Tuexen        Expires December 1, 2006                [Page 5]

Internet-Draft      SCTP Network Address Translation            May 2006


   Local-Network                               Global-Internet


                      <-----[From(Global-Address,Global-Port),
                             To(Nat-Global-Address,Local-Port),
                             SCTP(Local-VTag),
                             INIT-ACK(Initiate-Tag)]

              Lookup(0,Global-Port,Global-Address,Local-VTag,Local-Port)
              Update(Initiate-Tag,Global-Port,Global-Address,Local-VTag,Local-Port)
              <---Returns(NAT-State control block containing Local-Address)

       <-----[From(Global-Address:Global-Port),
              To(Local-Address,Local-Port)
              SCTP(Local-VTag)]


   In the case Lookup fails, the SCTP packet is dropped.  The Update
   routine inserts the Global-VTag in the NAT state control block.

   The processing of incoming SCTP packets containing and ABORT or
   SHUTDOWN-COMLETE chunk with the T-Bit set is described in the
   following figure.

   Local-Network                               Global-Internet


                      <-----[From(Global-Address,Global-Port),
                             To(Nat-Global-Address,Local-Port),
                             SCTP(Global-VTag)]

              Lookup(Global-VTag,Global-Port,Global-Address,0,Local-Port)
              <---Returns(NAT-State control block containing Local-Address)

       <-----[From(Global-Address:Global-Port),
              To(Local-Address,Local-Port)
              SCTP(Global-VTag)]


   The processing of other incoming SCTP packets is described in the
   following figure.










Stewart & Tuexen        Expires December 1, 2006                [Page 6]

Internet-Draft      SCTP Network Address Translation            May 2006


   Local-Network                               Global-Internet


                      <-----[From(Global-Address,Global-Port),
                             To(Nat-Global-Address,Local-Port),
                             SCTP(Local-VTag)]

              Lookup(0,Global-Port,Global-Address,Local-VTag,Local-Port)
              <---Returns(NAT-State control block contaning Local-Address)

       <-----[From(Global-Address:Global-Port),
              To(Local-Address,Local-Port)
              SCTP(Local-VTag)]



4.  Discussion of the SCTP specific variant of NAT

   There is one drawback of the SCTP specific variant of NAT compared to
   a NAPT solution like the ones available for TCP.  Consider the case
   where two host in the Local-Address space want to setup an SCTP
   association with the same server running on the same host in the
   Internet.  This means that the Global-Port and the Global-Address are
   the same.  If they both chose the same Local-Port and Local-VTag, the
   NAT box can not distinguish incoming packets anymore.  But this is
   very unlikely.  The Local-Vtags are chosen by random and if the
   Local-Ports are also chosen ephemeral an random this gives a 46 bit
   random number which has to match.  In the TCP like NAPT case the NAT
   box can control the 16 bit Natted Port.

   The advantages of using the SCTP specific variant of NAT is that the
   NAT engines do not have to modify the SCTP packet at all.  This is
   important because modifying the packets requires a recalculation of
   the checksum over the complete packet.  There is no way of just
   computing the different like it is possible for the IP, UDP and TCP
   checksum.  It should also be noted that the processing of ICMP
   packets is easier.


5.  Security considerations

   State maintenance within a NAT is always a subject of possible Denial
   Of Service attack.  This document recommends that at a minimum a NAT
   run a timer on any SCTP state so that old association state can be
   cleaned up.






Stewart & Tuexen        Expires December 1, 2006                [Page 7]

Internet-Draft      SCTP Network Address Translation            May 2006


6.  References

   [1]  Xie, Q., "SCTP NAT Traversal Considerations",
        draft-xie-behave-sctp-nat-cons-01 (work in progress),
        October 2005.

   [2]  Postel, J., "Transmission Control Protocol", STD 7, RFC 793,
        September 1981.

   [3]  Rekhter, Y., Moskowitz, R., Karrenberg, D., Groot, G., and E.
        Lear, "Address Allocation for Private Internets", BCP 5,
        RFC 1918, February 1996.

   [4]  Bradner, S., "The Internet Standards Process -- Revision 3",
        BCP 9, RFC 2026, October 1996.

   [5]  Bradner, S., "Key words for use in RFCs to Indicate Requirement
        Levels", BCP 14, RFC 2119, March 1997.

   [6]  Stewart, R., Xie, Q., Morneault, K., Sharp, C., Schwarzbauer,
        H., Taylor, T., Rytina, I., Kalla, M., Zhang, L., and V. Paxson,
        "Stream Control Transmission Protocol", RFC 2960, October 2000.





























Stewart & Tuexen        Expires December 1, 2006                [Page 8]

Internet-Draft      SCTP Network Address Translation            May 2006


Authors' Addresses

   Randall R. Stewart
   Cisco Systems, Inc.
   4875 Forest Drive
   Suite 200
   Columbia, SC  29206
   USA

   Phone:
   Email: rrs@cisco.com


   Michael Tuexen
   Muenster Univ. of Applied Sciences
   Stegerwaldstr. 39
   48565 Steinfurt
   Germany

   Email: tuexen@fh-muenster.de































Stewart & Tuexen        Expires December 1, 2006                [Page 9]

Internet-Draft      SCTP Network Address Translation            May 2006


Intellectual Property Statement

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.


Disclaimer of Validity

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
   ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
   INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
   INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Copyright Statement

   Copyright (C) The Internet Society (2006).  This document is subject
   to the rights, licenses and restrictions contained in BCP 78, and
   except as set forth therein, the authors retain all their rights.


Acknowledgment

   Funding for the RFC Editor function is currently provided by the
   Internet Society.




Stewart & Tuexen        Expires December 1, 2006               [Page 10]


