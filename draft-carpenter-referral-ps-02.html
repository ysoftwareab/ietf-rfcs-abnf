<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Problem Statement for Referral</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Goals of Referral">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Reachability">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Path Selection">
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 An Example: Triangle Path Optimization">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Interface Selection">
<link href="#rfc.section.4" rel="Chapter" title="4 Problem Statement">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 IP Addresses are not sufficient">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 FQDNs are not sufficient">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Relevant Information is lacking">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Extra complexity from ID-Locator Split Mechanisms">
<link href="#rfc.section.5" rel="Chapter" title="5 A Generic Referral Mechanism is needed">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgements">
<link href="#rfc.section.9" rel="Chapter" title="9 Change log">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The purpose of a referral is to enable a given entity in a multiparty Internet application to pass information to another party. It enables a communication initiator to be aware of relevant information of its destination entity before launching the communication. This memo discusses the problems involved in referral scenarios." />
  <meta name="description" content="The purpose of a referral is to enable a given entity in a multiparty Internet application to pass information to another party. It enables a communication initiator to be aware of relevant information of its destination entity before launching the communication. This memo discusses the problems involved in referral scenarios." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">B. E. Carpenter</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Univ. of Auckland</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">S.J. Jiang</td>
</tr>
<tr>
<td class="left">Expires: August 27, 2011</td>
<td class="right">Huawei Technologies Co., Ltd</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Z. Cao</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">ChinaMobile</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">February 23, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Problem Statement for Referral<br />
  <span class="filename">draft-carpenter-referral-ps-02</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The purpose of a referral is to enable a given entity in a multiparty Internet application to pass information to another party. It enables a communication initiator to be aware of relevant information of its destination entity before launching the communication. This memo discusses the problems involved in referral scenarios.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 27, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Goals of Referral</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Reachability</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Path Selection</a>
</li>
<li>3.2.1.   <a href="#rfc.section.3.2.1">An Example: Triangle Path Optimization</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Interface Selection</a>
</li>
<li>4.   <a href="#rfc.section.4">Problem Statement</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">IP Addresses are not sufficient</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">FQDNs are not sufficient</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Relevant Information is lacking</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Extra complexity from ID-Locator Split Mechanisms</a>
</li>
<li>5.   <a href="#rfc.section.5">A Generic Referral Mechanism is needed</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Acknowledgements</a>
</li>
<li>9.   <a href="#rfc.section.9">Change log</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">A frequently occurring situation is that one entity A connected to the Internet (or to some private network using the Internet protocol suite) needs to be aware of the information of another entity B in order to reach it. The information can be obtained from B itself or some third-party entity C. This is known as a referral.</p>
<p id="rfc.section.1.p.2">Referral is the act whereby one entity informs another entity how to contact a specific entity. It enables a communication initiator to be aware of relevant information of its destination entity in order to launch a communication channel. This referral information can be obtained through an existing communication channel between these two entities or from thrid-party entities.</p>
<p id="rfc.section.1.p.3">In the original design of the Internet, IP addresses were global, unique, and quasi-permanent. Also any differentiation beyond that provided by an IP address was done by protocol and port numbers.  Referrals were therefore performed simply by passing an IP address and possibly protocol and port numbers. In fact simple referrals (the first case above, sometimes called first-party referrals) were never needed since A could simply use B's address. Third-party referrals were trivial: C would tell A about B's address. Thus, it became common practice to pass raw addresses between entities. A classical example is the FTP PORT command <a href="#RFC0959">[RFC0959]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">This document makes use of the following terms:</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Goals of Referral</h1>
<p id="rfc.section.3.p.1">The principal purpose of referral is to enable one entity in a multi-party application to pass information to another party involved in the same application. This document makes no assumptions about whether the entities are acting as clients, servers, peers, super-nodes, relays, proxies, etc., as far as the application is concerned. Neither does it take a position as to how the various entities become aware of the need to send a referral; this depends entirely on the structure of the application.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Reachability</h1>
<p id="rfc.section.3.1.p.1">The primary goals of referral is to enable a communication initiator to reach its destination entity. Referral is a best effort mechanism. It does not guarantee actual reachability, since the referring entity has no general way of knowing which paths exist between the receiving entity and the referenced entity. Even if a reference is theoretically in scope, and within its defined lifetime, it may have become unreachable since it was sent. A receiving entity should always be prepared for reachability failures and associated retry and failover mechanisms, which are out of scope for the referral mechanism itself.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Path Selection</h1>
<p id="rfc.section.3.2.p.1">A reference might carry multiple references for the same target.  These may lead to multiple possible paths from the receiving entity to the referenced entity. This scenario is particularly generic when the destination or/and source entity has multiple interfaces or is multi-homed.</p>
<p id="rfc.section.3.2.p.2">The referring entity is not likely to know which path is best. The receiving entity will need to make a choice, possibly by local policy (e.g. <a href="#RFC3484">[RFC3484]</a>) or possibly by trial and error (e.g. <a href="#RFC4038">[RFC4038]</a>, <a href="#RFC5534">[RFC5534]</a>).  This choice is also out of scope for the referral mechanism itself.</p>
<h1 id="rfc.section.3.2.1">
<a href="#rfc.section.3.2.1">3.2.1.</a> An Example: Triangle Path Optimization</h1>
<p id="rfc.section.3.2.1.p.1">In application scenarios, the triangular path shown below is common. Both Host A and Host B connect to an application server and the application server forwards traffic as a relay agent. A slightly more complicated scenario is when the two hosts connect to different application servers individually and application servers talk to each other's relay agents. In SIP, this is often called the "SIP trapezoid".</p>
<p></p>
<p id="rfc.section.3.2.1.p.3">By passing A's reference to B, B can try to communicate directly with A, using the communication line at the bottom. If the direct communication is established successfully, the triangle path gets optimized. Both the application server and network bandwidth can be benefit from this operation.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> Interface Selection</h1>
<p id="rfc.section.3.3.p.1">We also encounter multi-interfaced hosts whose reachability is bound to a particular (logical/physical) interface. More information is required to indicate which interface may be used under different circumstances. The multi-interface problem is defined and studied by the IETF MIF WG.  Here referral can provide host A's multi-interface information to host B; accordingly, host B can select one of the interfaces to establish a connection.</p>
<p></p>
<p id="rfc.section.3.3.p.3">For example, as shown in the above figure, Host A has connected to Host B through Path 1. They can exchange references through Path 1.  They may disciver that Path 2, using different interfaces, is better than Path 1, maybe cheaper, faster or more stable. Then, they can switch to Path 2. For example, Host A has interface A1 as broadband access, almost free; and interface A2 is 3G access, which costs 0.1 $ per MB. Both of them are avaible for incoming connections. If this information is passed to host B, through referral, then host B should choose the A1 interface to reach host A. Such information is useful to express a host's status or preference.</p>
<p id="rfc.section.3.3.p.4">In order to choose between different interfaces, not only the connectivity information of these interfaces, but also some additonal information may be helpful, such as bandwidth, financial cost, latency, etc. This additional information may also be provided through referral. However, this additional information, even if accurate when sent by the referring entity, may nevertheless be invalid at the location of the receiving entity.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#ps" id="ps">Problem Statement</a>
</h1>
<p id="rfc.section.4.p.1">Unfortunately, the simple approach to referrals, passing an IP address, often fails in today's Internet. As has been known for some time <a href="#RFC2101">[RFC2101]</a>, hosts' IP addresses no longer all have global scope. They often have limited reachability, and may have limited lifetime. They are not sufficient to establish communication in many cases of dynamic referrals, for a variety of reasons. FQDNs may be used instead in some scenarios. However, FQDNs also have their own limitations and may fail in some scenarios.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#ip" id="ip">IP Addresses are not sufficient</a>
</h1>
<p id="rfc.section.4.1.p.1">It is no longer reasonable to assume that a host with a fixed location has a fixed IP address, or even a stable IP address.</p>
<p id="rfc.section.4.1.p.2">Furthermore, in the context of IPv4 address exhaustion, several solutions have emerged to share a single public IPv4 address between several customers simultaneously. Consequently, a public IPv4 address often no longer identifies a single customer/user/host, while a private IPv4 address is meaningless out of the private network scope. Other information (e.g., port range) is required to identify unambiguously a given customer/user/host. Both IP addresses and port numbers may be different on either side of a NAT or some other middlebox <a href="#RFC3234">[RFC3234]</a>, and firewalls may block them. It is no longer reasonable to assume that an IP address for a host, which allows a given peer to reach that host in one location, also works from a different location - even if that host is reachable from the second location.</p>
<p id="rfc.section.4.1.p.3">Also, the Internet now has two co-existing address formats for IPv4 and IPv6. Direct communication can only be established when both peers use the same IP version. Having the address of the source and destination in the same IP version does not necessarily mean that the path will be using that IP version. Simple approaches may cause unnecessary double translation <a href="#I-D.boucadair-softwire-cgn-bypass">[I-D.boucadair-softwire-cgn-bypass]</a>. Some addresses may even be the result of translation between IPv4 and IPv6, with severe limitations on their scope and lifetime. Sending an out-of-scope or expired address, or one of the wrong format, as a referral will fail.</p>
<p id="rfc.section.4.1.p.4">A specific problem of this kind may be caused by NAT64 <a href="#I-D.ietf-behave-v6v4-xlate-stateful">[I-D.ietf-behave-v6v4-xlate-stateful]</a>. If an IPv6-only host behind a NAT64 obtains a synthetic IPv6 address for an IPv4-only host, it can communicate successfully via the NAT64. However, if the synthetic address is referred to another IPv6 host, it may or may not work correctly. We can consider four cases: </p>
<p></p>

<ol>
<li>If the receiving entity is behind the same NAT64 as the referring entity, all should be well. </li>
<li>If the referring entity and the receiving entity are behind different NAT64 devices, both using the defined Well Known Prefix <a href="#RFC6052">[RFC6052]</a>, all should be well, because the same synthetic address will work in both cases. </li>
<li>If the receiving entity is behind a different NAT64 that uses a Network Specific Prefix <a href="#RFC6052">[RFC6052]</a>, the synthetic address will be meaningless and communication will fail. The only way to avoid this failure is for the original NAT64's Network Specific Prefix to be globally reachable, which seems highly unlikely for operational and security reasons. </li>
<li>If the receiving entity is a dual stack node that is not behind a NAT64, the synthetic address will be meaningless. Although there is an IPv4 path to the target host, the receiving entity will not know how to find it. Again, the only way to avoid this failure is for the original NAT64's prefix to be globally reachable. </li>
</ol>
<p id="rfc.section.4.1.p.6">In the last two cases, even if connectivity failure is avoided, the path taken by the packets will be far from optimal, traversing the original NAT64. </p>
<p id="rfc.section.4.1.p.7">IP addresses today may have an implied "context" (VPN, VoIP VC, IP TV, etc.): the reachability of such an address depends on that context.</p>
<p id="rfc.section.4.1.p.8">An implication of these issues is that there is no clean definition of the scope of an address (especially an IPv4 address, due to the prevalence of NAT). It is impossible to determine algorithmically, by inspecting the bits of an address, what its scope of reachability is.  Resolving this problem would greatly clarify the general problem of referrals.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#fqdn" id="fqdn">FQDNs are not sufficient</a>
</h1>
<p id="rfc.section.4.2.p.1">In some cases, this problem may be readily solved by passing a Fully Qualified Domain Name (FQDN) instead of an IP address. Indeed, that is an architecturally preferred solution <a href="#RFC1958">[RFC1958]</a>. However, it is not sufficient in many cases of dynamic referrals. Experience shows that an application cannot use a domain name in order to reliably find usable address(es) of an arbitrary peer. Domain names work fairly well to find the addresses of public servers, as in web servers or SMTP servers, because operators of such servers take pains to make sure that their domain names work.  But DNS records are not as reliably maintained for arbitrary hosts such as might need to be contacted in peer-to-peer applications, or for servers within corporate networks. Many small networks do not even maintain DNS entries for their hosts, and for some networks that do list local hosts in DNS, the listings may well be unusable from a remote location, because of two-faced DNS, or because the A record contains a private address. These cases may even be intentional as part of a security ring-fence, where w3.example.com only resolves within the corporate boundary, and/or resolves to IP addresses which are only reachable within the corporate administrative boundaries. In such contexts, incoming connections are usually filtered by the corporate firewall.</p>
<p id="rfc.section.4.2.p.2">An additional issue with FQDNs is the very common situation where multiple hosts are hidden behind a NAT, but they share one FQDN which is in fact a dummy name, created automatically by the ISP so that reverse DNS lookup will succeed for the NAT's public IPv4 address.  Such FQDNs are useless for identifying specific hosts.</p>
<p id="rfc.section.4.2.p.3">Furthermore, an FQDN may not be sufficient to establish successful communications involving heterogeneous peers (i.e., IPv4 and IPv6) since A and AAAA records may not be consistently provisioned. There are known cases where a server has one name that produces an A record (e.g., www.example.com) and another name that produces an AAAA record (e.g., ipv6.example.com). An additional complication is that some answers from DNS may be synthetic IP addresses, e.g., AAAA records sent by DNS64. The host may have no means to detect that such an address represents an IPv4 host. These addresses should not be interpreted as native IPv6 address.</p>
<p id="rfc.section.4.2.p.4">In such cases, an IP address either cannot be derived from an FQDN, or if so derived, cannot be accessed from an arbitrary location in the Internet.</p>
<p id="rfc.section.4.2.p.5">A related problem is that an application does not have a reliable way of knowing its own domain name - or to be more precise, a way of knowing a domain name that will allow the application to be reached from another location.</p>
<p id="rfc.section.4.2.p.6">There are wider systemic problems with the DNS as a reliable way to find a usable address, which are somewhat out of scope here, but can be summarised:</p>
<p id="rfc.section.4.2.p.7">For all the above reasons, the problem of address referrals cannot be solved simply by recommending the use of FQDNs instead. The guideline in <a href="#RFC1958">[RFC1958]</a> is in fact too simple for today's network. Something more elaborate than an IP address or an FQDN appears to be needed in the general case of application referrals.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#Information" id="Information">Relevant Information is lacking</a>
</h1>
<p id="rfc.section.4.3.p.1">Neither an IP address nor an FQDN gives complete information about the referenced entity. For example, IP addresses normally have associated lifetimes (derived from DHCP, SLAAC or the relevant DNS TTL), so they should be treated as invalid after their lifetimes expire. A referral that does not convey the lifetime associated with an address is problematic. As mentioned above, the scope of a reference also affects its usefulness. These are examples of additional information that is necessary to correctly interpret a referral; therefore part of the problem is conveying such information along with the reference.</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#IDLocator" id="IDLocator">Extra complexity from ID-Locator Split Mechanisms</a>
</h1>
<p id="rfc.section.4.4.p.1">Additional complexity for referrals would come from the deployment of any technology that separates locators from identifiers, rather than combining the two as an IP address. Since a very wide range of such solutions have been proposed (e.g. HIP, LISP, ILNP and Name-based Sockets) <a href="#I-D.ubillos-name-based-sockets">[I-D.ubillos-name-based-sockets]</a>, it is difficult to define the resulting problems precisely.</p>
<p id="rfc.section.4.4.p.2">However, to consider the example of Name-based Sockets, if a referral was made based on the IP address being used at a given instant for a Name-based Socket, that address might be useless by the time the referral was completed, because the socket suddenly migrated to a different IP address.</p>
<p id="rfc.section.4.4.p.3">The SHIM6 protocol <a href="#RFC5533">[RFC5533]</a> and the Multiple Interfaces (MIF) Working Group may produce similar difficulties, since they also consider scenarios where the IP address in use for some purpose may change unexpectedly.</p>
<p id="rfc.section.4.4.p.4">Any referral mechanism must be able to deal with situations where the locator corresponding to a given identifier is subject to change.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#motivation" id="motivation">A Generic Referral Mechanism is needed</a>
</h1>
<p id="rfc.section.5.p.1">The first motivation is the observation that unless the parties involved have reached an understanding about the scope, lifetime, and format of the elements in a referral through some other means, that information must be passed with the referral. This is required so that the receiving entity can determine whether or not the referral is useful. The referral therefore needs to consist of a fully-fledged data structure, or to be made using a mutually agreed referral protocol.</p>
<p id="rfc.section.5.p.2">When an attempt to establish a communication channel based on certain referral information fails, good design suggests that the receiving entity should attempt to correct the situation. For example, if communication fails to be established using an IP address, it would often be appropriate to attempt a DNS lookup, despite the difficulties mentioned above. The second motivating problem is that it may be helpful to the entity receiving a reference to also receive information about the source of the reference, such as an FQDN, if that is known to the sender of the reference. The receiving entity can then attempt to recover a valid address (and possibly port number) for the referred entity.</p>
<p id="rfc.section.5.p.3">The third motivating problem is to allow a reference to contain alternatives to an IP address or an FQDN, when any such alternatives exist.</p>
<p id="rfc.section.5.p.4">Additional arguments for a generic referral mechanism include:</p>
<p id="rfc.section.5.p.5">We observe that we have identified two general requirements: the need to define address scope more precisely, and the need to communicate references in a generic way.</p>
<p id="rfc.section.5.p.6">It should be noted that partial or application-specific solutions to these problems abound, because any multi-party distributed application must solve them. The best documented example is ICE <a href="#RFC5245">[RFC5245]</a>, which is an active protocol specific to applications mediated by SDP <a href="#RFC4566">[RFC4566]</a>. ICE "works by including a multiplicity of IP addresses and ports in SDP offers and answers, which are then tested for connectivity by peer-to-peer connectivity checks." The question raised here is whether we can define requirements for a generic solution that can be used by future applications, and possibly be retro-fitted to existing applications.</p>
<p id="rfc.section.5.p.7">One approach could be a "SuperICE" designed to be completely general and not tied to the SDP model. Another approach is the idea of a generic referral object. Such an object could be passed between the entities of a multi-party application, but without defining a specific protocol for that purpose. Some applications might choose to send it in-band as a raw binary object, others might use a simple ASCII encoding, and still others might prefer to encode it in XML, for example. Finally, it might also be used as part of SuperICE.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#security" id="security">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">It should be noted that referral should not function as a way to nullify the effect of a firewall or any other security mechanism. If the receiving entity chooses a particular reference and attempts to send packets to the corresponding IP address, whether they are delivered or not will depend on the existing security mechanisms, whatever they may be.</p>
<p id="rfc.section.6.p.2">Nevertheless, if a site security policy requires it, certain references may be excluded from referral information sent to certain destinations. This would require a security policy mechanism to be added to the process of generating referral information.</p>
<p id="rfc.section.6.p.3">Forged or intercepted referral information would enable a wide variety of attacks. Although not fundamentally different from attacks based on forged or observed IP addresses or FQDNs, no doubt referral would allow such attacks to be more ingenious, simply because they provide more information than an address or FQDN alone. Referral information should be transmitted through authenticated and encrypted channels. It is not further elaborated here.</p>
<p id="rfc.section.6.p.4">Referral may raise potential privacy issues, which are not explored in this document. For example, in the SIP context, mechanisms such as <a href="#RFC3323">[RFC3323]</a> and <a href="#RFC5767">[RFC5767]</a> are available to hide information that might identify end-points. Referral usage scenarios must ensure that they do not unintentionally defeat privacy solutions.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<p id="rfc.section.7.p.1">This document requests no action by IANA.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#ack" id="ack">Acknowledgements</a>
</h1>
<p id="rfc.section.8.p.1">Bo Zhou, formerly with China Mobile, was an original author of this document.  His contributions are gratefully acknowledged. </p>
<p id="rfc.section.8.p.2">Valuable comments and contributions were made by Mohamed Boucadair, Dan Wing, Keith Moore and others.</p>
<p id="rfc.section.8.p.3">This document was produced using the xml2rfc tool <a href="#RFC2629">[RFC2629]</a>.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#changes" id="changes">Change log</a>
</h1>
<p id="rfc.section.9.p.1">draft-carpenter-referral-ps-00: original version, 2010-06-21.</p>
<p id="rfc.section.9.p.2">draft-carpenter-referral-ps-01: add content regarding to ID-Locator Split Mechanisms, 2010-08-30.</p>
<p id="rfc.section.9.p.3">draft-carpenter-referral-ps-02: add content regarding NAT64, 2011-02-23.</p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC5245">[RFC5245]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, "<a href="http://tools.ietf.org/html/rfc5245">Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols</a>", RFC 5245, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5534">[RFC5534]</b></td>
<td class="top">
<a>Arkko, J.</a> and <a>I. van Beijnum</a>, "<a href="http://tools.ietf.org/html/rfc5534">Failure Detection and Locator Pair Exploration Protocol for IPv6 Multihoming</a>", RFC 5534, June 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5533">[RFC5533]</b></td>
<td class="top">
<a>Nordmark, E.</a> and <a>M. Bagnulo</a>, "<a href="http://tools.ietf.org/html/rfc5533">Shim6: Level 3 Multihoming Shim Protocol for IPv6</a>", RFC 5533, June 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3323">[RFC3323]</b></td>
<td class="top">
<a>Peterson, J.</a>, "<a href="http://tools.ietf.org/html/rfc3323">A Privacy Mechanism for the Session Initiation Protocol (SIP)</a>", RFC 3323, November 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4566">[RFC4566]</b></td>
<td class="top">
<a>Handley, M.</a>, <a>Jacobson, V.</a> and <a>C. Perkins</a>, "<a href="http://tools.ietf.org/html/rfc4566">SDP: Session Description Protocol</a>", RFC 4566, July 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3484">[RFC3484]</b></td>
<td class="top">
<a>Draves, R.</a>, "<a href="http://tools.ietf.org/html/rfc3484">Default Address Selection for Internet Protocol version 6 (IPv6)</a>", RFC 3484, February 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC0959">[RFC0959]</b></td>
<td class="top">
<a title="Information Sciences Institute (ISI)">Postel, J.</a> and <a>J. Reynolds</a>, "<a href="http://tools.ietf.org/html/rfc959">File Transfer Protocol</a>", STD 9, RFC 959, October 1985.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2629">[RFC2629]</b></td>
<td class="top">
<a href="mailto:mrose@not.invisible.net" title="Invisible Worlds, Inc.">Rose, M.T.</a>, "<a href="http://tools.ietf.org/html/rfc2629">Writing I-Ds and RFCs using XML</a>", RFC 2629, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2101">[RFC2101]</b></td>
<td class="top">
<a href="mailto:brian@dxcoms.cern.ch" title="Computing and Networks Division">Carpenter, B.E.</a>, <a href="mailto:j.crowcroft@cs.ucl.ac.uk" title="Dept. of Computer Science">Crowcroft, J.</a> and <a href="mailto:yakov@cisco.com" title="Cisco systems">Y. Rekhter</a>, "<a href="http://tools.ietf.org/html/rfc2101">IPv4 Address Behaviour Today</a>", RFC 2101, February 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2775">[RFC2775]</b></td>
<td class="top">
<a href="mailto:brian@icair.org" title="IBM c/o iCAIR">Carpenter, B.E.</a>, "<a href="http://tools.ietf.org/html/rfc2775">Internet Transparency</a>", RFC 2775, February 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1958">[RFC1958]</b></td>
<td class="top">
<a href="mailto:brian@dxcoms.cern.ch" title="CERN, European Laboratory for Particle Physics">Carpenter, B.</a>, "<a href="http://tools.ietf.org/html/rfc1958">Architectural Principles of the Internet</a>", RFC 1958, June 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3234">[RFC3234]</b></td>
<td class="top">
<a>Carpenter, B.</a> and <a>S. Brim</a>, "<a href="http://tools.ietf.org/html/rfc3234">Middleboxes: Taxonomy and Issues</a>", RFC 3234, February 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4038">[RFC4038]</b></td>
<td class="top">
<a>Shin, M-K.</a>, <a>Hong, Y-G.</a>, <a>Hagino, J.</a>, <a>Savola, P.</a> and <a>E.M. Castro</a>, "<a href="http://tools.ietf.org/html/rfc4038">Application Aspects of IPv6 Transition</a>", RFC 4038, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5767">[RFC5767]</b></td>
<td class="top">
<a>Munakata, M.</a>, <a>Schubert, S.</a> and <a>T. Ohba</a>, "<a href="http://tools.ietf.org/html/rfc5767">User-Agent-Driven Privacy Mechanism for SIP</a>", RFC 5767, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6052">[RFC6052]</b></td>
<td class="top">
<a>Bao, C.</a>, <a>Huitema, C.</a>, <a>Bagnulo, M.</a>, <a>Boucadair, M.</a> and <a>X. Li</a>, "<a href="http://tools.ietf.org/html/rfc6052">IPv6 Addressing of IPv4/IPv6 Translators</a>", RFC 6052, October 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.boucadair-softwire-cgn-bypass">[I-D.boucadair-softwire-cgn-bypass]</b></td>
<td class="top">
<a>Boucadair, M</a>, <a>Jacquenet, C</a>, <a>Song, J</a> and <a>Q Niu</a>, "<a href="http://tools.ietf.org/html/draft-boucadair-softwire-cgn-bypass-03">Procedure to bypass DS-Lite AFTR</a>", Internet-Draft draft-boucadair-softwire-cgn-bypass-03, October 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ubillos-name-based-sockets">[I-D.ubillos-name-based-sockets]</b></td>
<td class="top">
<a>Ubillos, J</a>, <a>Xu, M</a>, <a>Ming, Z</a> and <a>C Vogt</a>, "<a href="http://tools.ietf.org/html/draft-ubillos-name-based-sockets-03">Name-Based Sockets Architecture</a>", Internet-Draft draft-ubillos-name-based-sockets-03, September 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-behave-v6v4-xlate-stateful">[I-D.ietf-behave-v6v4-xlate-stateful]</b></td>
<td class="top">
<a>Bagnulo, M</a>, <a>Matthews, P</a> and <a>I Beijnum</a>, "<a href="http://tools.ietf.org/html/draft-ietf-behave-v6v4-xlate-stateful-12">Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers</a>", Internet-Draft draft-ietf-behave-v6v4-xlate-stateful-12, July 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Brian Carpenter</span> 
	  <span class="n hidden">
		<span class="family-name">Carpenter</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  <span>Department of Computer Science</span>
<span>University of Auckland</span>
<span>PB 92019</span>

	  <span class="vcardline">
		<span class="locality">Auckland</span>,  
		<span class="region"></span>
		<span class="code">1142</span>
	  </span>
	  <span class="country-name vcardline">New Zealand</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:brian.e.carpenter@gmail.com">brian.e.carpenter@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Sheng Jiang</span> 
	  <span class="n hidden">
		<span class="family-name">Jiang</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei Technologies Co., Ltd</span>
	<span class="adr">
	  <span>Huawei Building, No.3 Xinxi Rd.,</span>

	  <span class="vcardline">
		<span class="locality">Shang-Di Information Industry Base, Hai-Dian District, Beijing</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">P.R. China</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jiangsheng@huawei.com">jiangsheng@huawei.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Zhen Cao</span> 
	  <span class="n hidden">
		<span class="family-name">Cao</span>
	  </span>
	</span>
	<span class="org vcardline">China Mobile</span>
	<span class="adr">
	  <span>Unit2, 28 Xuanwumenxi Ave,Xuanwu District</span>

	  <span class="vcardline">
		<span class="locality">Beijing</span>,  
		<span class="region"></span>
		<span class="code">100053</span>
	  </span>
	  <span class="country-name vcardline">P.R. China</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:caozhenpku@gmail.com">caozhenpku@gmail.com</a></span>

  </address>
</div>

</body>
</html>