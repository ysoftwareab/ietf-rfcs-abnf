<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Simplified Multicast Forwarding</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Simplified Multicast Forwarding">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">J. Macker, editor</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">NRL</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header"> SMF Design Team</td></tr>
<tr><td class="header">Expires: January 14, 2010</td><td class="header">IETF MANET WG</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">July 13, 2009</td></tr>
</table></td></tr></table>
<h1><br />Simplified Multicast Forwarding<br />draft-ietf-manet-smf-09</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on January 14, 2010.</p>

<h3>Abstract</h3>

<p>This document describes a Simplified Multicast Forwarding (SMF)
      mechanism that provides basic IP multicast forwarding suitable for
      wireless mesh and mobile ad hoc network (MANET) use. SMF defines
      techniques for multicast duplicate packet detection (DPD) to be applied
      in the forwarding process and includes maintenance and checking
      operations for both IPv4 and IPv6 protocol use. SMF also specifies
      mechanisms for applying reduced relay sets to achieve more efficient
      multicast data distribution within a mesh topology versus simple
      flooding. The document describes interactions with other protocols and
      multiple deployment approaches. Distributed algorithms for selecting
      reduced relay sets and related discussion are provided in the
      Appendices. Basic issues relating to the operation of multicast MANET
      border routers are discussed but ongoing work remains in this area
      beyond the scope of this document.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Requirements Notation<br />
<a href="#anchor2">2.</a>&nbsp;
Introduction and Scope<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.</a>&nbsp;
Abbreviations<br />
<a href="#anchor4">3.</a>&nbsp;
SMF Applicability<br />
<a href="#Forwarding">4.</a>&nbsp;
SMF Packet Processing and Forwarding<br />
<a href="#DPD">5.</a>&nbsp;
SMF Duplicate Packet Detection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DPDv6">5.1.</a>&nbsp;
IPv6 Duplicate Packet Detection<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Opt-DPD">5.1.1.</a>&nbsp;
IPv6 SMF-DPD Header Option<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#I-DPDv6">5.1.2.</a>&nbsp;
IPv6 Identification-based DPD<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#H-DPDv6">5.1.3.</a>&nbsp;
IPv6 Hash-based DPD<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DPDv4">5.2.</a>&nbsp;
IPv4 Duplicate Packet Detection<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">5.2.1.</a>&nbsp;
IPv4 Identification-based DPD<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">5.2.2.</a>&nbsp;
IPv4 Hash-based DPD<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#I-HASH">5.3.</a>&nbsp;
Internal Hash Computation Considerations<br />
<a href="#Relays">6.</a>&nbsp;
Reduced Relay Set Forwarding and Relay Selection Capability<br />
<a href="#Neighborhood">7.</a>&nbsp;
SMF Neighborhood Discovery Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#SMFTLVs">7.1.</a>&nbsp;
SMF Relay Algorithm TLV Types<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">7.1.1.</a>&nbsp;
SMF Message TLV Type<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">7.1.2.</a>&nbsp;
SMF Address Block TLV Type<br />
<a href="#Gateways">8.</a>&nbsp;
SMF Border Gateway Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ForwardedGroups">8.1.</a>&nbsp;
Forwarded Multicast Groups<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">8.2.</a>&nbsp;
Multicast Group Scoping<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">8.3.</a>&nbsp;
Interface with Exterior Multicast Routing Protocols<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#MultipleGateways">8.4.</a>&nbsp;
Multiple Border Routers<br />
<a href="#anchor11">9.</a>&nbsp;
Non-SMF MANET Node Interaction<br />
<a href="#Security">10.</a>&nbsp;
Security Considerations<br />
<a href="#anchor12">11.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">11.1.</a>&nbsp;
IPv6 SMF_DPD Header Extension<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">11.2.</a>&nbsp;
SMF Type-Length-Value<br />
<a href="#anchor15">12.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">13.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">13.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">13.2.</a>&nbsp;
Informative References<br />
<a href="#ecdsAppendix">Appendix&nbsp;A.</a>&nbsp;
Essential Connecting Dominating Set (E-CDS) Algorithm<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">A.1.</a>&nbsp;
E-CDS Relay Set Selection Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">A.2.</a>&nbsp;
E-CDS Forwarding Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">A.3.</a>&nbsp;
E-CDS Neighborhood Discovery Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">A.4.</a>&nbsp;
E-CDS Selection Algorithm<br />
<a href="#smprAppendix">Appendix&nbsp;B.</a>&nbsp;
Source-based Multipoint Relay (S-MPR)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">B.1.</a>&nbsp;
S-MPR Relay Set Selection Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#smprForwarding">B.2.</a>&nbsp;
S-MPR Forwarding Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">B.3.</a>&nbsp;
S-MPR Neighborhood Discovery Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#smprAlgorithm">B.4.</a>&nbsp;
S-MPR Selection Algorithm<br />
<a href="#mprcdsAppendix">Appendix&nbsp;C.</a>&nbsp;
Multipoint Relay Connected Dominating Set (MPR-CDS) Algorithm<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">C.1.</a>&nbsp;
MPR-CDS Relay Set Selection Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">C.2.</a>&nbsp;
MPR-CDS Forwarding Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">C.3.</a>&nbsp;
MPR-CDS Neighborhood Discovery Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">C.4.</a>&nbsp;
MPR-CDS Selection Algorithm<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Requirements Notation</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate           Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction and Scope</h3>

<p>Unicast routing protocol designs for MANET and wireless mesh use have
      demonstrated efficient mechanisms to flood routing control plane
      messages within a wireless routing area. For example, algorithms
      specified within <a class='info' href='#RFC3626'>[RFC3626]<span> (</span><span class='info'>Clausen, T. and P. Jacquet, &ldquo;Optimized Link State Routing Protocol,&rdquo; 2003.</span><span>)</span></a> and <a class='info' href='#RFC3684'>[RFC3684]<span> (</span><span class='info'>Ogier, R., Templin, F., and M. Lewis, &ldquo;Topology Dissemination Based on Reverse-Path           Forwarding,&rdquo; 2003.</span><span>)</span></a> provide distributed methods of dynamically
      electing reduced relay sets that attempt to optimize flooding of routing
      control messages while maintaining a connected set. In one sense,
      Simplified Multicast Forwarding (SMF) extends the efficient flooding
      concept to the data forwarding plane. Therefore, SMF provides an
      appropriate multicast forwarding capability for use cases where
      localized, efficient flooding is deemed effective. The baseline design
      is intended to provide a basic, best effort multicast forwarding
      capability that is constrained to operate within a MANET or wireless
      mesh routing region. The main design goals of this SMF specification are
      to adapt efficient relay sets in MANET type environments <a class='info' href='#RFC2901'>[RFC2901]<span> (</span><span class='info'>Macker, JP. and MS. Corson, &ldquo;Mobile Ad hoc Networking (MANET): Routing Protocol           Performance Issues and Evaluation Considerations,&rdquo; 1999.</span><span>)</span></a> and to define the needed IPv4 and IPv6
      multicast duplicate packet detection (DPD) mechanisms to support
      multi-hop, packet forwarding. Figure 1 provides an overview of the
      logical SMF node architecture, consisting of "Neighborhood Discovery",
      "Relay Set Selection" and "Forwarding Process" components. Typically,
      relay set selection (or self-election) will occur based on input from a
      neighborhood discovery process, and the forwarding process will often be
      determined by dynamic relay set selection. Note the neighborhood
      discovery and/or relay set selection information MAY be obtained from a
      coexistent process (e.g., a lower layer mechanism or a unicast routing
      protocol using relay sets). In some cases, the forwarding decision for a
      packet can also depend on previous hop or incoming interface
      information. The asterisks (*) in <a class='info' href='#smfNodeArchitecture'>Figure&nbsp;1<span> (</span><span class='info'>SMF Node Architecture</span><span>)</span></a> mark the primitives and
      relationships needed by relay set algorithms requiring previous-hop
      packet forwarding knowledge.
</p><br /><hr class="insert" />
<a name="smfNodeArchitecture"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>    ______________                _____________
   |              |              |             |
   | Neighborhood |              |  Relay Set  |
   |  Discovery   |-------------&gt;|  Selection  |
   |   Protocol   |   neighbor   |  Algorithm  |
   |______________|     info     |_____________|
          \                              /
           \                            /
    neighbor\                          /forwarding
      info*  \      ____________      /  status
              \    |            |    /
               `--&gt;| Forwarding |&lt;--'
                   |  Process   |
 ~~~~~~~~~~~~~~~~~&gt;|____________|~~~~~~~~~~~~~~~~~&gt;
 incoming packet,                 forwarded packets
 interface id*, and
 previous hop*</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: SMF Node Architecture&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
</p>
<p>Interoperable SMF implementations MUST use a common DPD approach and
      be able to process the header options defined in this document for IPv6
      operation. We define Classical Flooding (CF), as the simplest case of
      SMF multicast forwarding. With CF, each SMF router forwards each
      received forwardable multicast packet exactly once. In this case, the
      need for any relay set selection or neighborhood topology information is
      eliminated but DPD functionality is still required. While SMF supports a
      CF mode of operation the use of more efficient relay set modes is
      RECOMMENDED to reduce contention and congestion caused by unnecessary
      packet retransmissions <a class='info' href='#NTSC99'>[NTSC99]<span> (</span><span class='info'>Ni, S., Tseng, Y., Chen, Y., and J. Sheu, &ldquo;The Broadcast Storm Problem in Mobile Ad hoc Networks,&rdquo; 1999.</span><span>)</span></a>. An efficient,
      reduced relay set is realized by selecting and maintaining a
      <em>subset</em> of all possible SMF routers in a MANET routing
      region. Known relay set selection algorithms have already demonstrated
      the ability to provide and maintain a dynamic connected set for
      forwarding user multicast data <a class='info' href='#MDC04'>[MDC04]<span> (</span><span class='info'>Macker, J., Dean, J., and W. Chao, &ldquo;Simplified Multicast Forwarding in Mobile Ad hoc           Networks,&rdquo; 2004.</span><span>)</span></a>. A few such
      relay set selection algorithms are described in the Appendices of this
      document and the basic designs borrow directly from previously
      documented IETF work. SMF relay set configuration is extensible and
      additional relay set algorithms beyond those specified here can be
      accommodated in future work.
</p>
<p>Determining and maintaining an optimized set of forwarding nodes
      generally requires dynamic neighborhood topology information.
      Neighborhood topology discovery functions MAY be externally provided by
      a MANET unicast routing protocol or by using the MANET NeighborHood
      Discovery Protocol (NHDP) <a class='info' href='#NHDP'>[NHDP]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;MANET Neighborhood Discovery Protocol,&rdquo; July&nbsp;2009.</span><span>)</span></a> running in
      concurrence with SMF. Additionally, this specification allows
      alternative processes that may be deemed more effective (e.g., lower
      layer wireless interface) to provide the necessary neighborhood
      information to support relay set election. Fundamentally, an SMF
      implementation SHOULD provide the ability for multicast forwarding state
      to be dynamically managed per operating network interface. Some of the
      relay state maintenance options and interactions are outlined later in
      <a class='info' href='#Relays'>Section&nbsp;6<span> (</span><span class='info'>Reduced Relay Set Forwarding and Relay Selection Capability</span><span>)</span></a>. This document states specific
      requirements for neighborhood discovery with respect to the forwarding
      process and the relay set selection algorithms described herein. For
      determining dynamic relay sets in the absence of an existing MANET
      unicast protocol or lower layer interface, SMF relies on the MANET NHDP
      specification to assist in IP layer 2-hop neighborhood state discovery
      and maintenance for relay set election. A "SMF_RELAY_ALG" Message TLV
      type (per <a class='info' href='#RFC5444'>[RFC5444]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;Generalized MANET Packet/Message Format,&rdquo; February&nbsp;2009.</span><span>)</span></a>) is defined for use with the
      NHDP protocol. It is RECOMMENDED that all nodes performing SMF operation
      include this TLV type in their NHDP_HELLO messages when operating with
      NHDP. This capability allows for nodes participating in SMF to be
      explicitly identified along with their respective dynamic relay set
      algorithm.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Abbreviations</h3>

<p>The following abbreviations are used throughout this document:
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Abbreviation</th><th align="left">Definition</th></tr>
<tr>
<td align="left">MANET</td>
<td align="left">Mobile Ad hoc Network</td>
</tr>
<tr>
<td align="left">SMF</td>
<td align="left">Simplified Multicast Forwarding</td>
</tr>
<tr>
<td align="left">CF</td>
<td align="left">Classical Flooding</td>
</tr>
<tr>
<td align="left">CDS</td>
<td align="left">Connected Dominating Set</td>
</tr>
<tr>
<td align="left">MPR</td>
<td align="left">Multi-Point Relay</td>
</tr>
<tr>
<td align="left">S-MPR</td>
<td align="left">Source-based MPR</td>
</tr>
<tr>
<td align="left">MPR-CDS</td>
<td align="left">MPR-based CDS</td>
</tr>
<tr>
<td align="left">E-CDS</td>
<td align="left">Essential CDS</td>
</tr>
<tr>
<td align="left">NHDP</td>
<td align="left">Neighborhood Discovery Protocol</td>
</tr>
<tr>
<td align="left">DPD</td>
<td align="left">Duplicate Packet Detection</td>
</tr>
<tr>
<td align="left">I-DPD</td>
<td align="left">Identification-based DPD</td>
</tr>
<tr>
<td align="left">H-DPD</td>
<td align="left">Hash-based DPD</td>
</tr>
<tr>
<td align="left">HAV</td>
<td align="left">Hash-assist Value</td>
</tr>
<tr>
<td align="left">FIB</td>
<td align="left">Forwarding Information Base</td>
</tr>
<tr>
<td align="left">TLV</td>
<td align="left">type-length-value encoding</td>
</tr>
<tr>
<td align="left">DoS</td>
<td align="left">Denial of Service</td>
</tr>
</table>
<br clear="all" />

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
SMF Applicability</h3>

<p>Within dynamic wireless routing topologies, maintaining traditional
      forwarding trees to support a multicast routing protocol is often not as
      effective as in wired networks due to the reduced reliability and
      increased dynamics of mesh topologies <a class='info' href='#MGL04'>[MGL04]<span> (</span><span class='info'>Mohapatra, P., Gui, C., and J. Li, &ldquo;Group Communications in Mobile Ad hoc Networks,&rdquo; February&nbsp;2004.</span><span>)</span></a> <a class='info' href='#GM99'>[GM99]<span> (</span><span class='info'>Garcia-Luna-Aceves, JJ. and E. Madruga, &ldquo;The core-assisted mesh protocol,&rdquo; August&nbsp;1999.</span><span>)</span></a>. A basic packet forwarding service reaching all
      connected MANET SMF routers participating within a localized routing
      region may provide a useful group communication paradigm for various
      classes of applications. Applications that could take advantage of a
      simple multicast forwarding service within a MANET routing region
      include multimedia streaming, interactive group-based messaging and
      applications, peer-to-peer middleware multicasting, and multi-hop mobile
      discovery or registration services. SMF is appropriate for deployment in
      limited dynamic wireless routing areas so that the flooding process can
      be contained.
</p>
<p>Note again that Figure 1 provides a notional architecture for typical
      SMF-capable nodes. However, a goal is that simple end-system
      (non-forwarding) wireless nodes may also participate in multicast
      traffic transmission and reception with standard IP network layer
      semantics (e.g., special or unnecessary encapsulation of IP packets
      should be avoided in this case). It is important that SMF deployments in
      localized edge network settings are able to connect and interoperate
      with existing standard multicast protocols operating within more
      conventional Internet infrastructures. A multicast border router or
      proxy mechanism MUST be used when deployed alongside more
      fixed-infrastructure IP multicast routing such Protocol Independent
      Multicast (PIM) variants <a class='info' href='#RFC3973'>[RFC3973]<span> (</span><span class='info'>Adams, A., Nicholas, J., and W. Siadak, &ldquo;Protocol Independent Multicast - Dense Mode (PIM-DM):           Protocol Specification (Revised),&rdquo; January&nbsp;2005.</span><span>)</span></a> and <a class='info' href='#RFC4601'>[RFC4601]<span> (</span><span class='info'>Fenner, B., Handley, M., Holbrook, H., and I. Kouvelas, &ldquo;Protocol Independent Multicast - Sparse Mode (PIM-SM):           Protocol Specification (Revised),&rdquo; August&nbsp;2006.</span><span>)</span></a>. With present experimental SMF implementations,
      proxy methods have demonstrated gateway functionality at MANET border
      routers operating with existing external IP multicast routing protocols.
      SMF may be extended or combined with other mechanisms to provide
      increased reliability and group specific filtering, but the details for
      this are not discussed here.
</p>
<a name="Forwarding"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
SMF Packet Processing and Forwarding</h3>

<p>The SMF Packet Processing and Forwarding actions are conducted with
      the following packet handling activities:
</p>
<p></p>
<ol class="text">
<li>Processing of outbound, locally-generated multicast packets.
</li>
<li>Reception and processing of inbound packets on a specific network
          interface(s).
</li>
</ol>

<p>The purpose of intercepting outbound, locally-generated multicast
      packets is to apply any added packet marking needed to satisfy the DPD
      requirements so that proper forwarding may be conducted. Note that for
      some system configurations the interception of outbound packets for this
      purpose is not necessary.
</p>
<p>Inbound multicast packets are received by the SMF implementation and
      processed for possible forwarding. This document does not presently
      support forwarding of directed broadcast addresses <a class='info' href='#RFC2644'>[RFC2644]<span> (</span><span class='info'>Senie, D., &ldquo;Changing the           Default for Directed Broadcasts in Routers,&rdquo; August&nbsp;1999.</span><span>)</span></a>. SMF implementations MUST be capable of
      forwarding "global scope" multicast packets to support generic multicast
      application needs or to distribute designated multicast traffic
      ingressing the MANET routing region via border routers. The multicast
      addresses to be forwarded will be maintained by an a priori list or a
      dynamic forwarding information base (FIB) that MAY interact with future
      MANET dynamic group membership extensions or management functions. There
      will also be a well-known multicast group for flooding to all SMF
      forwarders. This multicast group is specified to contain all MANET SMF
      routers of a connected MANET routing region, so that packets transmitted
      to the multicast address associated with the group will be delivered to
      all connected SMF routers. For IPv6, the multicast address is specified
      to be "site-local". The name of the multicast group is
      "SL-MANET-ROUTERS". Minimally SMF SHALL forward, as instructed by the
      relay set selection algorithm, unique (non-duplicate) packets received
      for this well-known group address when the TTL or hop count value in the
      IP header is greater than 1. SMF SHALL forward all additional global
      scope addresses specified within the dynamic FIB or configured list as
      well. In all cases, the following rules SHALL be observed for SMF
      multicast forwarding:
</p>
<p></p>
<ol class="text">
<li>Multicast packets with TTL &lt;= 1 MUST NOT be forwarded.
</li>
<li>Link local multicast packets MUST NOT be forwarded.
</li>
<li>Incoming multicast packets with an IP source address matching one
          of those of the local SMF router interface(s) MUST NOT be
          forwarded.
</li>
<li>Received packet frames with the MAC source address matching the
          local SMF router interface(s) MUST NOT be forwarded.
</li>
<li>Received packets for which SMF cannot reasonably ensure temporal
          DPD uniqueness MUST NOT be forwarded.
</li>
<li>When packets are forwarded, TTL or hop limit SHALL be decremented
          by one.
</li>
</ol>

<p>Note that rule #3 is important because in wireless networks, the
      local SMF router may receive re-transmissions of its own packets when
      they are forwarded by neighboring nodes. This rule avoids unnecessary
      retransmission of locally-generated packets even when other forwarding
      decision rules would apply.
</p>
<p>An additional processing rule also needs to be considered based upon
      a potential security threat. As discussed further in <a class='info' href='#Security'>Section&nbsp;10<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>, there may be concern in some SMF deployments
      that malicious nodes may conduct a denial-of-service attack by remotely
      "previewing" (e.g., via a directional receive antenna) packets that an
      SMF node would be forwarding and conduct a "pre-play" attack by
      transmitting the packet before the SMF node would otherwise receive it
      but with a reduced TTL (or Hop Limit) field value. This form of attack
      could cause an SMF node to create a DPD entry that would block the
      proper forwarding of the valid packet (with correct TTL) through the SMF
      area. A RECOMMENDED approach to prevent this attack, when it is a
      concern, would be to cache temporal packet TTL values along with the DPD
      state (hash value(s) and/or identifier). Then, if a subsequent matching
      packet (with respect to DPD) arrives with a larger TTL value than the
      packet that was previously forwarded, SMF should forward the new packet
      and update the TTL cached with corresponding DPD state to the new,
      larger TTL value. There may be temporal cases where SMF would
      unnecessarily forward some duplicate packets using this approach, but
      those cases are expected to be minimal and acceptable when compared with
      the potential threat of denied service.
</p>
<p>Once these criteria have been met, an SMF implementation MUST make a
      forwarding decision dependent upon the relay set selection algorithm in
      use. If the SMF implementation is using Classical Flooding (CF), the
      forwarding decision is implicit once DPD uniqueness is determined.
      Otherwise, a forwarding decision depends upon the current
      interface-specific relay set state. The descriptions of the relay set
      selection algorithms in the Appendices to this document specify the
      respective heuristics for multicast packet forwarding and specific DPD
      or other processing required to achieve correct SMF behavior. For
      example, one class of forwarding is based upon relay set election status
      and the packet's previous hop forwarder, while other classes designate
      the local SMF router as a forwarder for all neighboring nodes.
</p>
<a name="DPD"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
SMF Duplicate Packet Detection</h3>

<p>Duplicate packet detection (DPD) is a common requirement in MANET or
      wireless mesh packet forwarding because packets may be transmitted out
      the same physical interface upon which they arrived and nodes may also
      receive copies of previously-transmitted packets from other forwarding
      neighbors. SMF implementations MUST detect and avoid forwarding
      duplicate multicast packets using temporal packet identification. It is
      RECOMMENDED this be implemented by keeping a history of
      recently-processed multicast packets for comparison to incoming packets.
      For both IPv4 and IPv6, this document describes two basic multicast
      duplicate packet detection mechanisms: header content
      identification-based (I-DPD) and hash-based (H-DPD) duplicate detection.
      The two approaches are described for experimental purposes. Trade-offs
      of the two approaches to DPD merit different consideration dependent
      upon the specific SMF deployment scenario. Because of the potential
      addition of a hop-by-hop option header with IPv6, SMF deployments MUST
      be configured to use a common mechanism and DPD algorithm. The main
      difference between IPv4 and IPv6 SMF DPD specification is the avoidance
      of any additional header options in the IPv4 case.
</p>
<p>For each network interface, SMF implementations MUST maintain DPD
      packet state as needed to support the forwarding heuristics of the relay
      set algorithm used. The specific requirements of several relay set
      selection algorithms and their forwarding rules are described in the
      Appendices of this document. In general this involves keeping track of
      previously forwarded packets so that duplicates are not forwarded, but
      some relay techniques may have additional considerations.
</p>
<p>For I-DPD, packets are identified using explicit identifiers from the
      IP header. The specific identifier to use depends upon the IP protocol
      version and the type of packet. For example, IPv4 <a class='info' href='#RFC0791'>[RFC0791]<span> (</span><span class='info'>Postel, J., &ldquo;Internet Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> provides an "Identification" field that may
      assist a DPD mechanism, and packets that contain IPSec protocol headers
      also provide suitable packet identifiers. Fragmented packets also
      provide additional identifiers that need to be considered. These
      identifier fields are unique within the context of source address,
      destination address, protocol type, and/or other header fields depending
      upon the type of identifier used for DPD. Similarly, for H-DPD, it is
      expected that packet hash values will be kept with respect to at least
      the source address to help ensure hash collision avoidance. SMF
      implementations MUST maintain DPD history per the applicable packet flow
      context (e.g., &lt;protocol:srcAddr:dstAddr&gt; for DPD based upon IPv4
      ID). The details for I-DPD and H-DPD for different types of packets are
      described in the sections below. In either case, this history SHOULD be
      kept long enough to span the maximum network traversal lifetime,
      MAX_PACKET_LIFETIME, of multicast packets being forwarded within an SMF
      operating area. The required size of the DPD cache is governed by this
      timeout value and is also a function of the packet forwarding rates. The
      DPD mechanism SHOULD avoid keeping unnecessary state for packet flows
      such as those that are locally-generated or link-local destinations that
      would not be considered for forwarding.
</p>
<a name="DPDv6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
IPv6 Duplicate Packet Detection</h3>

<p>This section describes the mechanisms and options for SMF IPv6 DPD.
        The core IPv6 packet header does not provide any explicit
        identification header field that can be exploited for I-DPD. The
        following areas are described to support IPv6 DPD:</p>
<ol class="text">
<li>a hop-by-hop SMF-DPD option header (with supporting identifier
            or hash assistance value),
</li>
<li>the use of IPv6 fragment header fields for I-DPD when they
            exist,
</li>
<li>the use of IPSec sequencing for I-DPD when a non-fragmented,
            IPSec header is detected, and
</li>
<li>an H-DPD approach assisted, as needed, by the SMF-DPD option
            header.
</li>
</ol>

<p>SMF MUST provide a DPD marking module that can insert the
        hop-by-hop IPv6 header option defined in this section. This process
        MUST come after any source-based fragmentation that may occur with
        IPv6. As with IPv4, SMF IPv6 DPD is presently specified to allow
        either a packet hash or header identification method for DPD. An SMF
        implementation MUST be configured to operate either in H-DPD or I-DPD
        mode and perform the appropriate routines outlined in the following
        sections.
</p>
<a name="Opt-DPD"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1"></a><h3>5.1.1.&nbsp;
IPv6 SMF-DPD Header Option</h3>

<p>As previously mentioned, the base IPv6 packet header does not
          contain a unique identifier suitable for DPD. This section defines
          an IPv6 Hop-by-Hop Option to serve this purpose for IPv6 I-DPD.
          Additionally, the header option provides a mechanism to guarantee
          non-collision of hash values for different packets when H-DPD is
          used. The value of the IPv6 SMF DPD Hop-by-Hop Option Type is
          TBD.
</p>
<p>The first bit of the data field of the SMF-DPD option is the
          "H-bit" that determines the format of the Option Data content. Two
          different formats are supported. When the "H-bit" is cleared (zero
          value), the SMF-DPD format to support I-DPD operation is specified
          as shown in <a class='info' href='#idpdHeaderOption'>Figure&nbsp;2<span> (</span><span class='info'>IPv6 SMF-DPD Header Option in I-DPD mode</span><span>)</span></a> and defines the
          extension header in accordance with <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6           (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="idpdHeaderOption"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                  ...              |0|0|0| OptType | Opt. Data Len |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|TidTyp|TidLen|             TaggerId (optional) ...           |
   +-+-+-+-+-+-+-+-+               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |            Identifier  ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: IPv6 SMF-DPD Header Option in I-DPD mode&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The "TidType" is a 3-bit field indicating the presence and type
          of the optional "TaggerId" field. The optional "TaggerId" is used to
          differentiate multiple ingressing border gateways that may commonly
          apply the SMF-DPD option header to packets from a particular source.
          This is provided for experimental purposes. The following table
          lists the valid TaggerId types:
</p><br /><hr class="insert" />
<a name="taggerId"></a>

<p style='text-align: center'>
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">Name</th><th align="left">Value</th><th align="left">Purpose</th></tr>
<tr>
<td align="left">NULL</td>
<td align="left">0</td>
<td align="left">Indicates no "taggerId" field is present. "TidLen" MUST also be
            set to ZERO.</td>
</tr>
<tr>
<td align="left">DEFAULT</td>
<td align="left">1</td>
<td align="left">A "TaggerId" of non-specific context is present. "TidLen + 1"
            defines the length of the TaggerId field in bytes.</td>
</tr>
<tr>
<td align="left">IPv4</td>
<td align="left">2</td>
<td align="left">A "TaggerId" representing an IPv4 address is present. The
            "TidLen" MUST be set to 3.</td>
</tr>
<tr>
<td align="left">IPv6</td>
<td align="left">3</td>
<td align="left">A "TaggerId" representing an IPv6 address is present. The
            "TidLen" MUST be set to 15.</td>
</tr>
<tr>
<td align="left">ExtId</td>
<td align="left">7</td>
<td align="left">RESERVED FOR FUTURE USE (possible extended ID)</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 1: TaggerId Types&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>This format allows a quick check of the "TidType" field to
          determine if a "TaggerId" field is present. If the &lt;TidType&gt;
          is NULL, then the length of the DPD packet &lt;Identifier&gt; field
          corresponds to the (&lt;Opt. Data Len&gt; - 1). If the
          &lt;TidType&gt; is non-NULL, then the length of the "TaggerId" field
          is equal to (&lt;TidLen&gt; - 1) and the remainder of the option
          data comprises the DPD packet &lt;Identifier&gt; field. When the
          "TaggerId" field is present, the &lt;Identifier&gt; field can be
          considered a unique packet identifier in the context of the
          &lt;taggerId:srcAddr:dstAddr&gt; tuple. When the "TaggerId" field is
          not present, then it is assumed the source host applied the SMF-DPD
          option and the &lt;Identifier&gt; can be considered unique in the
          context of the IPv6 packet header &lt;srcAddr:dstAddr&gt; tuple.
          IPV6 I-DPD operation details are described in <a class='info' href='#I-DPDv6'>Section&nbsp;5.1.2<span> (</span><span class='info'>IPv6 Identification-based DPD</span><span>)</span></a>.
</p>
<p>When the "H-bit" in the SMF-DPD option data is set, the data
          content value is interpreted as a Hash-Assist Value (HAV) used to
          facilitate H-DPD operation. In this case, source hosts or ingressing
          gateways apply the SMF-DPD with a HAV only when required to
          differentiate the hash value of a new packet with respect to older
          packets in the current DPD history cache. This helps to guarantee
          the uniqueness of generated hash values when H-DPD is used.
          Additionally, this also avoids the added overhead of applying the
          SMF-DPD option header to every packet. For many hash algorithms, it
          is expected that only sparse use of the SMF-DPD option may be
          required. The format of the SMF-DPD header option for H-DPD
          operation is given in <a class='info' href='#hdpdHeader'>Figure&nbsp;3<span> (</span><span class='info'>IPv6 SMF_DPD Header Option in H-DPD Mode</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="hdpdHeader"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                  ...              |0|0|0| OptType | Opt. Data Len |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|    Hash Assist Value (HAV) ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: IPv6 SMF_DPD Header Option in H-DPD Mode&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The SMF-DPD option should be applied with a HAV to produce a
          unique hash digest for packets within the context of the IPv6 packet
          header &lt;srcAddr&gt;. The size of the HAV field is implied by the
          "Opt. Data Len". The appropriate size of the field depends upon the
          collision properties of the specific hash algorithm used. More
          details on IPv6 H-DPD operation are provided in <a class='info' href='#H-DPDv6'>Section&nbsp;5.1.3<span> (</span><span class='info'>IPv6 Hash-based DPD</span><span>)</span></a>.
</p>
<a name="I-DPDv6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.2"></a><h3>5.1.2.&nbsp;
IPv6 Identification-based DPD</h3>

<p>The following table summarizes the IPv6 I-DPD processing
          approach. Within the table '*' indicates a don't care condition.
</p><br /><hr class="insert" />
<a name="IPv6IDPDProcess"></a>

<p style='text-align: center'>
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left"><col align="left">
<tr><th align="left">IPv6 Fragment Header</th><th align="left">IPv6 IPSec Header</th><th align="left">IPv6 I-DPD Header</th><th align="left">SMF IPv6 I-DPD Mode Action</th></tr>
<tr>
<td align="left">Present</td>
<td align="left">*</td>
<td align="left">*</td>
<td align="left">Use Fragment Header I-DPD Check and Process for Forwarding</td>
</tr>
<tr>
<td align="left">Not Present</td>
<td align="left">Present</td>
<td align="left">*</td>
<td align="left">Use IPSec Header I-DPD Check and Process for Forwarding</td>
</tr>
<tr>
<td align="left">Present</td>
<td align="left">*</td>
<td align="left">Present</td>
<td align="left">Invalid, do not Forward</td>
</tr>
<tr>
<td align="left">Not Present</td>
<td align="left">Present</td>
<td align="left">Present</td>
<td align="left">Invalid, do not Forward</td>
</tr>
<tr>
<td align="left">Not Present</td>
<td align="left">Not Present</td>
<td align="left">Not Present</td>
<td align="left">Add I-DPD Header,and Process for Forwarding</td>
</tr>
<tr>
<td align="left">Not Present</td>
<td align="left">Not Present</td>
<td align="left">Present</td>
<td align="left">Use I-DPD Header Check and Process for Forwarding</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 2: IPv6 I-DPD Processing Rules&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>If the IPv6 multicast packet is an IPv6 fragment, SMF MUST use
          the fragment extension header fields for packet identification. This
          identifier can be considered unique in the context of the
          &lt;srcAddr:dstAddr&gt; of the IP packet. If the packet is an
          unfragmented IPv6 IPSec packet, SMF MUST use IPSec fields for packet
          identification. The IPSec header &lt;sequence&gt; field can be
          considered a unique identifier in the context of the
          &lt;IPSecType:srcAddr:dstAddr:SPI&gt; where the "IPSecType" is
          either AH or ESP. For unfragmented, non-IPSec, IPv6 packets, the use
          of the SMF DPD header option is necessary to support I-DPD
          operation. The SMF DPD header option is applied in the context of
          the &lt;srcAddr&gt; of the IP packet. End systems or ingressing SMF
          gateways are responsible for applying this option to support DPD.
          The following table summarizes these packet identification
          types:
</p><br /><hr class="insert" />
<a name="IPv6IDPDId"></a>

<p style='text-align: center'>
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">IPv6 Packet Type</th><th align="left">Packet DPD ID Context</th><th align="left">Packet DPD ID</th></tr>
<tr>
<td align="left">Fragment</td>
<td align="left">&lt;srcAddr:dstAddr&gt;</td>
<td align="left">&lt;fragmentOffset:id&gt;</td>
</tr>
<tr>
<td align="left">IPSec Packet</td>
<td align="left">&lt;IPSecType:srcAddr:dstAddr:SPI&gt;</td>
<td align="left">&lt;sequence&gt;</td>
</tr>
<tr>
<td align="left">Regular Packet</td>
<td align="left">&lt;[taggerId:]srcAddr:dstAddr&gt;</td>
<td align="left">&lt;SMF-DPD option header id&gt;</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 3: IPv6 I-DPD Packet Identification Types&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>"IPSecType" is either Authentication Header (AH) or Encapsulating
          Security Payload (ESP).
</p>
<p>The "taggerId" is an optional feature of the IPv6 SMF-DPD header
          option.
</p>
<a name="H-DPDv6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.3"></a><h3>5.1.3.&nbsp;
IPv6 Hash-based DPD</h3>

<p>A default hash-based DPD approach (H-DPD) for use by SMF is
          specified as follows. An MD5 <a class='info' href='#RFC1321'>[RFC1321]<span> (</span><span class='info'>Rivest, R., &ldquo;The MD5 Message-Digest           Algorithm,&rdquo; April&nbsp;1992.</span><span>)</span></a> hash of
          the non-mutable header fields, options fields, and data content of
          the IPv6 multicast packet is used to produce a 128-bit digest. The
          lower 64 bits of this digest (MD5_64) is used for SMF packet
          identification. The approach for calculating this hash value SHOULD
          follow the same guidelines described for calculating the Integrity
          Check Value (ICV) described in <a class='info' href='#RFC4302'>[RFC4302]<span> (</span><span class='info'>Kent, S., &ldquo;IP Authentication Header,&rdquo; December&nbsp;2005.</span><span>)</span></a> with
          respect to non-mutable fields. This approach should have a
          reasonably low probability of digest collision when packet headers
          and content are varying. MD5 is being applied in SMF only to provide
          a low probability of collision and is not being used for
          cryptographic or authentication purposes. A history of the packet
          hash values SHOULD be maintained within the context of the IPv6
          packet header &lt;srcAddr&gt;. This history is used by forwarding
          SMF nodes (non-ingress points) to avoid forwarding duplicates. SMF
          ingress points (i.e., source hosts or gateways) use this history to
          confirm that new packets are unique with respect to their hash
          value. The Hash-assist Value (HAV) field described in <a class='info' href='#Opt-DPD'>Section&nbsp;5.1.1<span> (</span><span class='info'>IPv6 SMF-DPD Header Option</span><span>)</span></a> is provided as a differentiating field when
          a digest collision would otherwise occur. Note that the HAV is an
          immutable option field and SMF MUST use any included H-DPD hash
          assist value (HAV) option header (see <a class='info' href='#Opt-DPD'>Section&nbsp;5.1.1<span> (</span><span class='info'>IPv6 SMF-DPD Header Option</span><span>)</span></a>) in its hash calculation.
</p>
<p>If a packet results in a digest collision (i.e., by checking the
          H-DPD digest history) within the limited history kept by SMF
          forwarders, the packet should be silently dropped. If a digest
          collision is detected at an SMF ingress point (i.e., including
          SMF-aware sources), the H-DPD option header is applied with a HAV.
          The packet is retested for collision and the HAV is re-applied as
          needed to produce a non-colliding hash value. The multicast packet
          is then forwarded with the added IPv6 SMF-DPD header option.
</p>
<p>The MD5 indexing and IPv6 HAV approaches are specified at present
          for consistency and robustness to suit experimental uses. Future
          approaches and experimentation may discover designs tradeoffs in
          hash robustness and efficiency worth considering. This MAY include
          reducing the maximum payload length that is processed, determining
          shorter indexes, or applying more efficient hashing algorithms. Use
          of the HAV functionality may allow for application of
          "lighter-weight" hashing techniques that might not have been
          initially considered due to poor collision properties otherwise.
          Such techniques could reduce packet processing overhead and memory
          requirements.
</p>
<a name="DPDv4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
IPv4 Duplicate Packet Detection</h3>

<p>This section describes the mechanisms and options for IPv4 DPD. The
        IPv4 packet header 16-bit "Identification" field MAY be used for DPD
        assistance, but practical limitations may require alternative
        approaches in some situations. The following areas are described to
        support IPv4 DPD::</p>
<ol class="text">
<li>the use of IPv4 fragment header fields for I-DPD when they
            exist,
</li>
<li>the use of IPSec sequencing for I-DPD when a non-fragmented
            IPv4 IPSec packet is detected, and
</li>
<li>a H-DPD approach.
</li>
</ol><p>A specific SMF-DPD marking option is not specified for IPv4
        since header options are not as tractable for end systems as for IPv6.
        IPv4 packets from a particular source are assumed to be marked with a
        temporally unique value in the "Identification" field of the packet
        header <a class='info' href='#RFC0791'>[RFC0791]<span> (</span><span class='info'>Postel, J., &ldquo;Internet Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> that can serve
        for SMF DPD purposes. However, in present operating system networking
        kernels, the IPv4 header "Identification" value is not always
        generated properly, especially when the "don't fragment" (DF) bit is
        set. The IPv4 I-DPD mode of this specification requires that IPv4
        "Identification" fields are managed reasonably by source hosts and
        that temporally unique values are set within the context of the packet
        header &lt;protocol:srcAddr:dstAddr&gt; tuple. If this is not expected
        during an SMF deployment, then it is RECOMMENDED that the H-DPD method
        be used as a more reliable approach.
</p>
<p>Since IPv4 SMF does not specify an options header, the
        interoperability constraints are looser than the IPv6 version and
        forwarders may be operate with mixed H-DPD and I-DPD modes as long as
        they consistently perform the appropriate DPD routines outlined in the
        following sections. However, it is RECOMMENDED that a deployment be
        configured with a common mode for operational consistency.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
IPv4 Identification-based DPD</h3>

<p>The following table summarizes the IPv4 I-DPD processing approach
          once a packet has passed the basic forwardable criteria described in
          earlier SMF sections. Within the table '*' indicates a don't care
          condition.
</p><br /><hr class="insert" />
<a name="IPv4IDPDProcess"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left"><col align="left"><col align="left">
<tr><th align="left">df</th><th align="left">mf</th><th align="left">fragment offset</th><th align="left">IPSec</th><th align="left">IPv4 I-DPD Action</th></tr>
<tr>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">*</td>
<td align="left">*</td>
<td align="left">Invalid, Do Not Forward</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">nonzero</td>
<td align="left">*</td>
<td align="left">Invalid, Do Not Forward</td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">0</td>
<td align="left">zero</td>
<td align="left">not Present</td>
<td align="left">Tuple I-DPD Check and Process for Forwarding</td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">0</td>
<td align="left">zero</td>
<td align="left">Present</td>
<td align="left">IPSec enhanced Tuple I-DPD Check and Process for Forwarding</td>
</tr>
<tr>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">nonzero</td>
<td align="left">*</td>
<td align="left">Extended Fragment Offset Tuple I-DPD Check and Process for
            Forwarding</td>
</tr>
<tr>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">zero or nonzero</td>
<td align="left">*</td>
<td align="left">Extended Fragment Offset Tuple I-DPD Check and Process for
            Forwarding</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 4: IPv4 I-DPD Processing Rules&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>For performance reasons, IPv4 network fragmentation and
          reassembly of multicast packets within wireless MANET networks
          should be minimized, yet SMF provides the forwarding of fragments
          when they occur. If the IPv4 multicast packet is a fragment, SMF
          MUST use the fragmentation header fields for packet identification.
          This identification can be considered temporally unique in the
          context of the &lt;protocol:srcAddr:dstAddr&gt; of the IPv4 packet.
          If the packet is an unfragmented IPv4 IPSec packet, SMF MUST use
          IPSec fields for packet identification. The IPSec header
          &lt;sequence&gt; field can be considered a unique identifier in the
          context of the &lt;IPSecType:srcAddr:dstAddr:SPI&gt; where the
          "IPSecType" is either AH or ESP. Finally, for unfragmented,
          non-IPSec, IPv4 packets, the "Identification" field can be used for
          I-DPD purposes. The "Identification" field can be considered unique
          in the context of the IPv4 &lt;protocol:scrAddr:dstAddr&gt; tuple.
          The following table summarizes these packet identification
          types:
</p><br /><hr class="insert" />
<a name="IPv4IDPDId"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">IPv4 Packet Type</th><th align="left">Packet Identification Context</th><th align="left">Packet Identifier</th></tr>
<tr>
<td align="left">Fragment</td>
<td align="left">&lt;protocol:srcAddr:dstAddr&gt;</td>
<td align="left">&lt;fragmentOffset:id&gt;</td>
</tr>
<tr>
<td align="left">IPSec Packet</td>
<td align="left">&lt;IPSecType:srcAddr:dstAddr:SPI&gt;</td>
<td align="left">&lt;sequence&gt;</td>
</tr>
<tr>
<td align="left">Regular Packet</td>
<td align="left">&lt;protocol:srcAddr:dstAddr&gt;</td>
<td align="left">&lt;id&gt;</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 5: IPv4 I-DPD Packet Identification Types&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>"IPSecType" is either Authentication Header (AH) or Encapsulating
          Security Payload (ESP).
</p>
<p>The limited size (16 bits) of the IPv4 header "Identification"
          field may result in more frequent value field wrapping, particularly
          if a common sequence space is used by a source for multiple
          destinations. If I-DPD operation is required, the use of the
          "internal hashing" technique described in <a class='info' href='#I-HASH'>Section&nbsp;5.3<span> (</span><span class='info'>Internal Hash Computation Considerations</span><span>)</span></a> may mitigate this limitation of the IPv4
          "Identification" field for SMF DPD. In this case the "internal hash"
          value would be concatenated with the "Identification" value for
          I-DPD operation.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
IPv4 Hash-based DPD</h3>

<p>To ensure consistent IPv4 H-DPD operation among SMF nodes, a
          default hashing approach is specified. This is similar to that
          specified for IPv6, but the H-DPD header option with HAV is not
          considered. SMF MUST perform an MD5 <a class='info' href='#RFC1321'>[RFC1321]<span> (</span><span class='info'>Rivest, R., &ldquo;The MD5 Message-Digest           Algorithm,&rdquo; April&nbsp;1992.</span><span>)</span></a>
          hash of the immutable header fields, option fields and data content
          of the IPv4 multicast packet resulting in a 128-bit digest. The
          lower 64 bits of this digest (MD5_64) is used for SMF packet
          identification. The approach for calculating the hash value SHOULD
          follow the same guidelines described for calculating the Integrity
          Check Value (ICV) described in <a class='info' href='#RFC4302'>[RFC4302]<span> (</span><span class='info'>Kent, S., &ldquo;IP Authentication Header,&rdquo; December&nbsp;2005.</span><span>)</span></a> with
          respect to non-mutable fields. A history of the packet hash values
          SHOULD be maintained in the context of
          &lt;protocol:srcAddr:dstAddr&gt;. The context for IPv4 is more
          specific than that of IPv6 since the SMF-DPD HAV cannot be employed
          to mitigate hash collisions.
</p>
<p>The MD5 hash is specified at present for consistency and
          robustness. Future approaches and experimentation may discover
          design tradeoffs in hash robustness and efficiency worth considering
          for future revisions of SMF. This MAY include reducing the packet
          payload length that is processed, determining shorter indexes, or
          applying a more efficient hashing algorithm.
</p>
<a name="I-HASH"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Internal Hash Computation Considerations</h3>

<p>Forwarding protocols that use DPD techniques, such as SMF, may be
        vulnerable to denial-of-service (DoS) attacks based on spoofing
        packets with apparently valid packet identifier fields. Such a
        consideration is pointed out in <a class='info' href='#Security'>Section&nbsp;10<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>. In
        wireless environments, where SMF will most likely be used, the
        opportunity for such attacks is more prevalent than in wired networks.
        In the case of IPv4 packets, fragmented IP packets or packets with
        IPSec headers applied, the DPD "identifier portions" of potential
        future packets that might be forwarded is highly predictable and
        easily subject to denial-of-service attacks against forwarding. A
        RECOMMENDED technique to counter this concern is for SMF
        implementations to generate an "internal" hash value that is
        concatenated with the explicit I-DPD packet identifier to form a
        unique identifier that is a function of the packet content as well as
        the visible identifier. SMF implementations could seed their hash
        generation with a random value to make it unlikely that an external
        observer could guess how to spoof packets used in a denial-of-service
        attack against forwarding. Since the hash computation and state is
        kept completely internal to SMF nodes, the cryptographic properties of
        this hashing would not need to be extensive and thus possibly of low
        complexity. Experimental implementations may determine that a
        lightweight hash of even only portions of packets may suffice to serve
        this purpose.
</p>
<p>For IPv4 I-DPD based on the limited 16-bit IP header
        "Identification" field, it is possible that use of this "internal
        hash" technique may also enhance I-DPD performance in cases where the
        IPv4 "Identification" field may frequently wrap due to sources
        supporting high data rate flows.
</p>
<p>While H-DPD is not as readily susceptible to this form of DoS
        attack, it is possible that a sophisticated adversary could use side
        information to construct spoofing packets to mislead forwarders using
        a well-known hash algorithm. Thus, similarly, a separate "internal"
        hash value could be concatenated with the well-known hash value to
        alleviate this security concern.
</p>
<a name="Relays"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Reduced Relay Set Forwarding and Relay Selection Capability</h3>

<p>SMF implementations MUST support CF as a basic forwarding mechanism
      when reduced relay set information is not available or not selected for
      operation. In CF mode, each node transmits a locally generated or newly
      received forwardable packet exactly once. The DPD techniques described
      in <a class='info' href='#DPD'>Section&nbsp;5<span> (</span><span class='info'>SMF Duplicate Packet Detection</span><span>)</span></a> are critical to proper operation and
      prevent duplicate packet retransmissions by the same forwarding
      node.
</p>
<p>A goal of SMF is to apply reduced relay sets for more efficient
      multicast dissemination within dynamic topologies. To accomplish this
      SMF MUST support the ability to modify its multicast packet forwarding
      rules based upon relay set state received dynamically during operation.
      In this way, SMF forwarding operates effectively as neighbor adjacencies
      or multicast forwarding policies within the topology change.
</p>
<p>In early SMF experimental deployments, the relay set information has
      been derived from coexistent unicast routing control plane traffic
      flooding processes. From this experience, extra pruning considerations
      were sometimes required when utilizing a relay set from a separate
      routing protocol process. As an example, relay sets formed for the
      unicast control plane flooding MAY include additional redundancy that
      may not be desired for multicast forwarding use (e.g., biconnected CDS
      mesh for control plane purposes).
</p>
<p>Here is a recommended criteria list for SMF relay set selection
      algorithm candidates:
</p>
<p></p>
<ol class="text">
<li>Robustness to topological dynamics and mobility
</li>
<li>Localized election or coordination of any relay sets
</li>
<li>Reasonable minimization of CDS relay set size given above
          constraints
</li>
<li>Heuristic support for preference or election metrics (Better
          enables scenario-specific management of relay set)
</li>
</ol>

<p>Some relay set algorithms meeting these criteria are described in the
      Appendices of this document. Additional relay set selection algorithms
      may be specified in separate specifications in the future. The
      Appendices in this document can serve as a template for the content of
      such potential future specifications.
</p>
<p><a class='info' href='#smfControlOptions'>Figure&nbsp;4<span> (</span><span class='info'>SMF Relay Set Control Options</span><span>)</span></a> depicts a state information
      diagram of possible relay set control options.
</p><br /><hr class="insert" />
<a name="smfControlOptions"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
                    Possible L2 Trigger/Information
                                   |
                                   |
 ______________              ______v_____         __________________
|    MANET     |            |            |       |                  |
| Neighborhood |            | Relay Set  |       | Other Heuristics |
|  Discovery   |-----------&gt;| Selection  |&lt;------| (Preference,etc) |
|   Protocol   | neighbor   | Algorithm  |       |                  |
|______________|   info     |____________|       |__________________|
       \                              /
        \                            /
 neighbor\                          / Dynamic Relay
   info*  \      ____________      /    Set Status
           \    |    SMF     |    / (State, {neighbor info})
            `--&gt;| Relay Set  |&lt;--'
                |   State    |
             --&gt;|____________|
            /
           /
 ______________
|  Coexistent  |
|    MANET     |
|   Unicast    |
|   Process    |
|______________|

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: SMF Relay Set Control Options&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>There are basically three styles of SMF operation with reduced relay
      sets:
</p>
<p></p>
<ol class="text">
<li>Independent operation: In this case, SMF performs its own relay
          set selection using information from an associated MANET NHDP
          process. In this case, NHDP messaging SHOULD be appended with
          additional <a class='info' href='#RFC5444'>[RFC5444]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;Generalized MANET Packet/Message Format,&rdquo; February&nbsp;2009.</span><span>)</span></a> type-length-value (TLV)
          content to support SMF-specific requirements as discussed in <a class='info' href='#Neighborhood'>Section&nbsp;7<span> (</span><span class='info'>SMF Neighborhood Discovery Requirements</span><span>)</span></a> and for the applicable relay set
          algorithm described in the Appendices of this document or future
          specifications.
</li>
<li>Operation with CDS-aware unicast routing protocol: In this case,
          a coexistent unicast routing protocol provides dynamic relay set
          state based upon its own control plane CDS or neighborhood discovery
          information. If it is desired that the SMF data plane forwarding use
          a different relay set selection algorithm than used for the routing
          protocol control plane, then the routing protocol NHDP instance (if
          applicable) SHOULD append its messages with the appropriate
          SMF-specific TLV content (see <a class='info' href='#Neighborhood'>Section&nbsp;7<span> (</span><span class='info'>SMF Neighborhood Discovery Requirements</span><span>)</span></a>
          and the relay set algorithm Appendices).
</li>
<li>Cross-layer Operation: In this case, SMF operates using
          neighborhood status and triggers from a cross-layer information base
          for dynamic relay set selection and maintenance (e.g., lower link
          layer) .
</li>
</ol>

<a name="Neighborhood"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
SMF Neighborhood Discovery Requirements</h3>

<p>This section defines the requirements for use of the <a class='info' href='#NHDP'>MANET Neighborhood Discovery Protocol (NHDP)<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;MANET Neighborhood Discovery Protocol,&rdquo; July&nbsp;2009.</span><span>)</span></a> [NHDP] to
      support SMF operation. Note that basic CF forwarding requires no
      neighborhood topology knowledge since every SMF node relays all traffic.
      To support more efficient SMF relay set operation requires the discovery
      and maintenance of dynamic neighborhood topology information. The MANET
      NHDP protocol can provide this necessary information, but in some
      circumstances there are SMF-specific requirements for related NHDP use.
      This can be the case for both "independent" SMF operation where NHDP is
      being used specifically to support SMF or when one NHDP instance is used
      for both for SMF and a coexistent MANET unicast routing protocol.
</p>
<p>Core NHDP messages and the resultant neighborhood information base
      are described separately within the NHDP specification. To summarize,
      the NHDP protocol provides the following basic functions:
</p>
<p></p>
<ol class="text">
<li>1-hop neighbor link sensing and bidirectionality checks of
          neighbor links,
</li>
<li>2-hop neighborhood discovery including collection of 2-hop
          neighbors and connectivity information,
</li>
<li>Collection and maintenance of the above information across
          multiple interfaces, and
</li>
<li>A method for signaling SMF information throughout the 2-hop
          neighborhood such as the existence of an SMF instance and any
          related relay set selection information.
</li>
</ol>

<p>The Appendices of this document describe a set of CDS-based relay set
      selection algorithms that can be used to achieve efficient SMF
      operation, even in dynamic, mobile networks<a class='info' href='#MDDA07'>[MDDA07]<span> (</span><span class='info'>Macker, J., Downard, I., Dean, J., and R. Adamson, &ldquo;Evaluation of distributed cover set algorithms in mobile ad           hoc network for simplified multicast forwarding,&rdquo; July&nbsp;2007.</span><span>)</span></a>. For some of these algorithms, the core NHDP specification can
      provide all the necessary information to conduct relay set selection.
      For others, NHDP messaging needs to be extended to support SMF
      discovery, relay set selection, and maintenance. For example, the <a class='info' href='#OLSRv2'>[OLSRv2]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;Optimized Link State Routing Protocol version 2,&rdquo; July&nbsp;2009.</span><span>)</span></a> specification specifies TLV constructs for NHDP
      messages to support its use of the S-MPR algorithm.
</p>
<p>The following sub-sections specify some SMF-specific TLV types
      supporting general SMF operation or supporting the algorithms described
      in the Appendices. The Appendices describing several relay set
      algorithms also specify any additional requirements for use wit NHDP and
      reference the applicable TLV types as needed.
</p>
<a name="SMFTLVs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
SMF Relay Algorithm TLV Types</h3>

<p>This section specifies TLV types to be used within NHDP messages to
        identify the CDS relay set selection algorithm(s) in use. Two TLV
        types are defined, one message TLV type and one address TLV type.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.1"></a><h3>7.1.1.&nbsp;
SMF Message TLV Type</h3>

<p>The SMF message TLV type denoted SMF_TYPE is used to identify the
          existence of an SMF instance operating in conjunction with NHDP.
          This message type makes use of the extended type field as defined by
          <a class='info' href='#RFC5444'>[RFC5444]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;Generalized MANET Packet/Message Format,&rdquo; February&nbsp;2009.</span><span>)</span></a> to convey the CDS relay set selection
          algorithm currently in use by the SMF message originator. When NHDP
          is used to support SMF operation, the SMF_TYPE TLV, containing the
          extended type field with the appropriate value, SHOULD be included
          in NHDP_HELLO messages generated. This allows SMF nodes to learn
          when neighbors are configured to use NHDP for information exchange
          including algorithm type and related algorithm information. This
          information can be used to take action, such as ignoring neighbor
          information using incompatible algorithms. It is possible that SMF
          neighbors MAY be configured differently and still operate
          cooperatively, but these cases will vary dependent upon the
          algorithm types designated.
</p>
<p>This document defines the following Message TLV type<a class='info' href='#smfType_Message'>Table&nbsp;6<span> (</span><span class='info'>SMF Type Message TLV</span><span>)</span></a> conforming to <a class='info' href='#RFC5444'>[RFC5444]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;Generalized MANET Packet/Message Format,&rdquo; February&nbsp;2009.</span><span>)</span></a>. Extended type field values communicate
          "Relay Algorithm Type" to other 1-hop SMF neighbors and value fields
          may contain algorithm specific information.
</p><br /><hr class="insert" />
<a name="smfType_Message"></a>

<p style='text-align: center'>
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left"></th><th align="left">packetBB TLV syntax</th><th align="left">Field Values</th></tr>
<tr>
<td align="left">type</td>
<td align="left">&lt;tlv-type&gt;</td>
<td align="left">SMF_TYPE</td>
</tr>
<tr>
<td align="left">extended type</td>
<td align="left">&lt;tlv-type-ext&gt;</td>
<td align="left">&lt;relayAlgorithmid&gt;</td>
</tr>
<tr>
<td align="left">length</td>
<td align="left">&lt;length&gt;</td>
<td align="left">variable</td>
</tr>
<tr>
<td align="left">value</td>
<td align="left">&lt;value&gt;</td>
<td align="left">variable</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 6: SMF Type Message TLV&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In <a class='info' href='#smfType_Message'>Table&nbsp;6<span> (</span><span class='info'>SMF Type Message TLV</span><span>)</span></a>
          &lt;relayAlgorithmId&gt; is an 8-bit field containing a number 0-255
          representing the "Relay Algorithm Type" of the originator address of
          the corresponding NHDP message.
</p>
<p>Possible values for the &lt;relayAlgorithmId&gt; are defined in
          <a class='info' href='#IdTLVValues'>Table&nbsp;7<span> (</span><span class='info'>SMF Relay Algorithm Type Values</span><span>)</span></a>. The table provides value
          assignments, future IANA assignment spaces, and an experimental
          space. The experimental space use MUST NOT assume uniqueness and
          thus should not be used for general interoperable deployment prior
          to official IANA assignment.
</p><br /><hr class="insert" />
<a name="IdTLVValues"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center" width="30%"><col align="center" width="60%">
<tr><th align="center">Extended Type Value</th><th align="center">Algorithm</th></tr>
<tr>
<td align="center">0</td>
<td align="center">CF</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">S-MPR</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">E-CDS</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">MPR-CDS</td>
</tr>
<tr>
<td align="center">4-127</td>
<td align="center">Future Assignment with STD action</td>
</tr>
<tr>
<td align="center">128-239</td>
<td align="center">No STD action required</td>
</tr>
<tr>
<td align="center">240-255</td>
<td align="center">Experimental Space</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 7: SMF Relay Algorithm Type Values&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Acceptable &lt;length&gt; and &lt;value&gt; fields of an SMF_TYPE
          TLV are extended type dependent. The appropriate algorithm type, as
          conveyed in the &lt;tlv-type-ext&gt; field, defines the meaning and
          format of its TLV &lt;value&gt; field. For algorithms defined by
          this document see the appropriate appendix for the &lt;value&gt;
          field format.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.2"></a><h3>7.1.2.&nbsp;
SMF Address Block TLV Type</h3>

<p>An address block TLV type, denoted SMF_NBR_TYPE (i.e., SMF
          neighbor relay algorithm) <a class='info' href='#smfType_Addr'>Table&nbsp;8<span> (</span><span class='info'>SMF Type Address Block TLV</span><span>)</span></a>, is
          specified so that CDS relay algorithm operation and configuration
          can be shared among 2-hop neighborhoods This is useful for the case
          when mixed relay algorithm operation is possible.
</p>
<p>The message SMF_TYPE TLV and address block SMF_NBR_TYPE TLV types
          share a common format.
</p><br /><hr class="insert" />
<a name="smfType_Addr"></a>

<p style='text-align: center'>
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left"></th><th align="left">packetBB TLV syntax</th><th align="left">Field Values</th></tr>
<tr>
<td align="left">type</td>
<td align="left">&lt;tlv-type&gt;</td>
<td align="left">SMF_NBR_RELAY_ALG</td>
</tr>
<tr>
<td align="left">extended type</td>
<td align="left">&lt;tlv-type-ext&gt;</td>
<td align="left">&lt;relayAlgorithmid&gt;</td>
</tr>
<tr>
<td align="left">length</td>
<td align="left">&lt;length&gt;</td>
<td align="left">variable</td>
</tr>
<tr>
<td align="left">value</td>
<td align="left">&lt;value&gt;</td>
<td align="left">variable</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 8: SMF Type Address Block TLV&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>&lt;relayAlgorithmId&gt; in <a class='info' href='#IdTLVValues'>Table&nbsp;7<span> (</span><span class='info'>SMF Relay Algorithm Type Values</span><span>)</span></a> is
          an 8-bit field containing a number 0-255 representing the "Relay
          Algorithm Type" value that corresponds to any indicated address in
          the address block. Note that "Relay Algorithm Type" values for 2-hop
          neighbors can be conveyed in a single TLV or multiple value TLVs as
          described in <a class='info' href='#RFC5444'>[RFC5444]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;Generalized MANET Packet/Message Format,&rdquo; February&nbsp;2009.</span><span>)</span></a>. It is expected that SMF
          nodes using NHDP construct address blocks with SMF_NBR_TYPE TLVs to
          advertise "Relay Algorithm Type" and to advertise neighbor algorithm
          values received in SMF_TYPE TLVs from those neighbors.
</p>
<p>Again values for the &lt;relayAlgorithmId&gt; are defined in
          <a class='info' href='#IdTLVValues'>Table&nbsp;7<span> (</span><span class='info'>SMF Relay Algorithm Type Values</span><span>)</span></a>.
</p>
<p>Value length and value content of an SMF_NBR_TYPE TLV is defined
          by the appropriate algorithm type contained in the extended type
          field. See appropriate the appendix for definitions of value fields
          for algorithms defined by this document.
</p>
<a name="Gateways"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
SMF Border Gateway Considerations</h3>

<p>It is expected that SMF will be used to provide simple forwarding of
      multicast traffic within a MANET or mesh routing topology. A border
      router approach should be used to allow interconnection of SMF areas
      with networks using other multicast routing protocols (e.g., PIM). It is
      important to note that there are many scenario-specific issues that
      should be addressed when discussing border routers. At the present time,
      experimental deployments of SMF and PIM border router approaches have
      been demonstrated. Some of the functionality border routers may need to
      address includes the following:
</p>
<p></p>
<ol class="text">
<li>Determining which multicast group traffic transits the border
          router whether entering or exiting the attached MANET routing
          region(s).
</li>
<li>Enforcement of TTL threshold or other scoping policies.
</li>
<li>Any marking or labeling to enable DPD on ingressing packets.
</li>
<li>Interface with exterior multicast routing protocols.
</li>
<li>Possible operation with multiple border routers (presently beyond
          scope of this document).
</li>
<li>Provisions for participating non-SMF nodes.
</li>
</ol>

<p>Note the behavior of SMF border routers is the same as that of
      non-border SMF nodes when forwarding packets on interfaces within the
      MANET routing region. Packets that are passed outbound to interfaces
      operating fixed-infrastructure multicast routing protocols SHOULD be
      evaluated for duplicate packet status since present standard multicast
      forwarding mechanisms do not usually perform this function.
</p>
<a name="ForwardedGroups"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Forwarded Multicast Groups</h3>

<p>Mechanisms for dynamically determining groups for forwarding into a
        MANET SMF routing region is an evolving technology area. Ideally, only
        groups for which there is active group membership should be injected
        into the SMF domain. This can be accomplished by providing an IPv4
        Internet Group Membership Protocol (IGMP) or IPV6 Multicast Listener
        Discovery (MLD) proxy protocol so that MANET SMF nodes can inform
        attached border routers (and hence multicast networks) of their
        current group membership status. For specific systems and services it
        may be possible to statically configure group membership joins in
        border routers, but it is RECOMMENDED that some form of IGMP/MLD proxy
        or other explicit, dynamic control of membership be provided.
        Specification of such an IGMP/MLD proxy protocol is beyond the scope
        of this document.
</p>
<p>Outbound traffic is less problematic. SMF border routers can
        perform duplicate packet detection and forward non-duplicate traffic
        that meets TTL/hop limit and scoping criteria to other interfaces.
        Appropriate IP multicast routing (PIM, etc) on those interfaces can
        then make further forwarding decisions with respect to the given
        traffic destination and potentially its source addresses. Note that
        the presence of multiple border routers associated with a MANET
        routing region raises additional issues. This is further discussed in
        <a class='info' href='#MultipleGateways'>Section&nbsp;8.4<span> (</span><span class='info'>Multiple Border Routers</span><span>)</span></a> but further work is expected
        to be needed here.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Multicast Group Scoping</h3>

<p>Multicast scoping is used by network administrators to control the
        network routing regions reachable by multicast packets. This is
        usually done by configuring external interfaces of border routers in
        the border of an routing region to not forward multicast packets which
        must be kept within the routing region. This is commonly done based on
        TTL of messages or the basis of group addresses. These schemes are
        known respectively as:
</p>
<p></p>
<ol class="text">
<li>TTL scoping.
</li>
<li>Administrative scoping.
</li>
</ol>

<p>For IPv4, network administrators can configure border routers with
        the appropriate TTL thresholds or administratively scoped multicast
        groups for the router interfaces as with any traditional multicast
        router. However, for the case of TTL scoping it SHOULD be taken into
        account that the packet could traverse multiple hops within the MANET
        SMF routing region before reaching the border router. Thus, TTL
        thresholds SHOULD be selected carefully.
</p>
<p>For IPv6, multicast address spaces include information about the
        scope of the group. Thus, border routers of an SMF routing region know
        if they must forward a packet based on the IPv6 multicast group
        address. For the case of IPv6, it is RECOMMENDED that a MANET SMF
        routing region be designated a site. Thus, all IPv6 multicast packets
        in the range FF05::/16 SHOULD be kept within the MANET SMF routing
        region by border routers. IPv6 packets in any other wider range scopes
        (i.e. FF08::/16, FF0B::/16 and FF0E::16) MAY traverse border routers
        unless other restrictions different from the scope applies.
</p>
<p>Given that scoping of multicast packets is performed at the border
        routers, and given that existing scoping mechanisms are not designed
        to work with mobile routers, it is assumed that non-border SMF routers
        will not stop forwarding multicast data packets of an appropriate site
        scoping. That is, it is assumed that an SMF routing region is a site
        scoped area.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
Interface with Exterior Multicast Routing Protocols</h3>

<p>The traditional operation of multicast routing protocols is tightly
        integrated with the group membership function. Leaf routers are
        configured to periodically gather group membership information, while
        intermediate routers conspire to create multicast trees connecting
        routers with directly-connected multicast sources and routers with
        active multicast receivers. In the concrete case of SMF, border
        routers can be considered leaf routers. Mechanisms for multicast
        sources and receivers to interoperate with border routers over the
        multihop MANET SMF routing region as if they were directly connected
        to the router need to be defined. The following issues need to be
        addressed:
</p>
<p></p>
<ol class="text">
<li>A mechanism by which border routers gather membership
            information
</li>
<li>A mechanism by which multicast sources are known by the border
            router
</li>
<li>A mechanism for exchange of exterior routing protocol messages
            across the MANET routing region if the MANET routing region is to
            provide transit connectivity for multicast traffic.
</li>
</ol>

<p>It is beyond the scope of this document to address implementation
        solutions to these issues. As described in <a class='info' href='#ForwardedGroups'>Section&nbsp;8.1<span> (</span><span class='info'>Forwarded Multicast Groups</span><span>)</span></a>, IGMP/MLD proxy mechanisms can be
        deployed to address some of these issues. Similarly, exterior routing
        protocol messages could be tunneled or conveyed across the MANET
        routing region. But, because MANET routing regions are multi-hop and
        potentially unreliable, as opposed to the single-hop LAN
        interconnection that neighboring IP Multicast routers might typically
        enjoy, additional provisions may be required to achieve successful
        operation.
</p>
<p>The need for the border router to receive traffic from recognized
        multicast sources within the MANET SMF routing region is important to
        achieve a smooth interworking with existing routing protocols. For
        instance, PIM-S requires routers with locally attached multicast
        sources to register them to the Rendezvous Point (RP) so that nodes
        can join the multicast tree. In addition, if those sources are not
        advertised to other autonomous systems (AS) using MSDP, receivers in
        those external networks are not able to join the multicast tree for
        that source.
</p>
<a name="MultipleGateways"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
Multiple Border Routers</h3>

<p>A MANET might be deployed with multiple participating nodes having
        connectivity to external (to the MANET), fixed-infrastructure
        networks. Allowing multiple nodes to forward multicast traffic to/from
        the MANET routing region can be beneficial since it can increase
        reliability, and provide better service. For example, if the MANET
        routing region were to fragment with different MANET nodes maintaining
        connectivity to different border routers, multicast service could
        still continue successfully. But, the case of multiple border routers
        connecting a MANET routing region to external networks presents
        several challenges for SMF:
</p>
<p></p>
<ol class="text">
<li>Detection/hash collision/sequencing of duplicate unmarked IPv4
            or IPv6 (without IPSec encapsulation or DPD option) packets
            possibly injected by multiple border routers.
</li>
<li>Source-based relay algorithms handling of duplicate traffic
            injected by multiple border routers.
</li>
<li>Determination of which border router(s) will forward outbound
            multicast traffic.
</li>
<li>Additional challenges with interfaces to exterior multicast
            routing protocols.
</li>
</ol>

<p>One of the most obvious issues is when multiple border routers are
        present and may be alternatively (due to route changes) or
        simultaneously injecting common traffic into the MANET routing region
        that has not been previously marked for SMF DPD. Different border
        routers would not be able to implicitly synchronize sequencing of
        injected traffic since they may not receive exactly the same messages
        due to packet losses. For IPv6 I-DPD operation, the optional
        "TaggerId" field described for the SMF-DPD header option can be used
        to mitigate this issue. When multiple border routers are injecting a
        flow into a MANET routing region, there are two forwarding policies
        that SMF I-DPD nodes may implement:
</p>
<p></p>
<ol class="text">
<li>Redundantly forward the multicast flows (identified by
            &lt;sourceAddress:destinationAddress&gt;) from each border router,
            performing DPD processing on a &lt;taggerID:destinationAddress&gt;
            or &lt;taggerID:sourceAddress:destinationAddress&gt; basis, or
</li>
<li>Use some basis to select the flow of one tagger (border router)
            over the others and forward packets for applicable flows
            (identified by &lt;sourceAddress:destinationAddress&gt;) only for
            that "Tagger ID" until timeout or some other criteria to favor
            another tagger occurs.
</li>
</ol><p>It is RECOMMENDED that the first approach be used in the case
        of I-DPD operation unless the SMF system is specifically designed to
        implement the second option. Additional specification may be required
        to describe an interoperable forwarding policy based on this second
        option. Note that the implementation of the second option requires
        that per-flow (i.e., &lt;sourceAddress::destinationAddress&gt;) state
        be maintained for the selected "Tagger ID".
</p>
<p>The deployment of a H-DPD operational mode may alleviate DPD
        resolution when ingressing traffic comes from multiple border routers.
        Non-colliding hash indexes (those not requiring the H-DPD options
        header in IPv6) should be resolved effectively.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Non-SMF MANET Node Interaction</h3>

<p>There may be scenarios in which some neighboring wireless MANET node
      are not running SMF and/or not forwarding, but are interested in
      receiving multicast data. For example, a MANET service might be deployed
      that is accessible to wireless edge devices that do not participate in
      MANET routing, NHDP, and/or SMF forwarding operation. These devices
      include:
</p>
<p></p>
<ol class="text">
<li>Devices that opportunistically receive multicast traffic due to
          proximity with SMF relays (possibly with asymmetric IP connectivity
          e.g., sensor network device).
</li>
<li>Devices that participate in NHDP (directly or via routing
          protocol signaling) but do not forward traffic.
</li>
</ol>

<p>Note there is no guarantee of traffic delivery with category 1 above,
      but the election heuristics shown in <a class='info' href='#smfControlOptions'>Figure&nbsp;4<span> (</span><span class='info'>SMF Relay Set Control Options</span><span>)</span></a> MAY be adjusted via management to
      better support such devices. However, it is RECOMMENDED that nodes
      participate in NHDP when possible. Such devices may also transmit
      multicast traffic, but it is important to note that SMF routing regions
      using source-specific relay set algorithms such as (S-MPR) may not
      forward such traffic. These devices SHOULD also listen for any IGMP/MLD
      Queries that are provided and transmit IGMP/MLD Reports for groups they
      have joined per usual IP Multicast operation. While it is not in the
      scope of this document, IGMP/MLD proxy mechanisms may be in place to
      convey group membership information to any border routers or
      intermediate systems providing IP Multicast routing functions.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security Considerations</h3>

<p>Gratuitous use of option headers can cause problems in routers.
      Routers outside of MANET routing regions should ignore SMF-specific
      header options if encountered. The header options types are encoded
      appropriately to allow for this behavior.
</p>
<p>Several SMF DoS scenarios have been described throughout the document
      and recommended mitigation strategies have been presented. Here we
      summarize a few of these areas for reference.
</p>
<p>Sequence-based packet identifiers are predictable and thus provide an
      opportunity for a denial-of-service attack against forwarding. The use
      of the "internal hashing" as described in <a class='info' href='#I-HASH'>Section&nbsp;5.3<span> (</span><span class='info'>Internal Hash Computation Considerations</span><span>)</span></a>
      for the I-DPD operation helps to mitigate denial-of-service attacks on
      predictable packet identifiers. In this case, spoofed packets MAY be
      forwarded but the additional internal history identifier will protect
      against false collision events that may result from a predictive
      denial-of-service attack strategy.
</p>
<p>Another potential denial-of-service attack against SMF forwarding is
      possible when a malicious node has a form of "wormhole" access (via a
      directional antenna, etc) to preview packets before a particular SMF
      node would receive them. The malicious node could reduce the TTL or Hop
      Limit of the packet and transmit it to the SMF node causing it to
      forward the packet with a limited TTL (or even drop it) and make a DPD
      entry that would block forwarding of the subsequently-arriving valid
      packet with appropriate TTL value. This would be a relatively low-cost,
      high-payoff attack that would be hard to detect and thus attractive to
      potential attackers. An approach of caching TTL information with DPD
      state and taking appropriate forwarding actions is identified in <a class='info' href='#Forwarding'>Section&nbsp;4<span> (</span><span class='info'>SMF Packet Processing and Forwarding</span><span>)</span></a> to mitigate this form of attack.
</p>
<p>The support of forwarding IPSec datagrams without further
      modification for both IPv4 and IPv6 is supported by this
      specification.
</p>
<p>Authentication mechanisms to identify the source of IPv6 option
      headers should be considered to reduce vulnerability to a variety of
      attacks.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
IANA Considerations</h3>

<p>This document raises multiple IANA Considerations. These include the
      IPv6 SMF_DPD hop-by-hop Header Extension defined and multiple
      Type-Length-Value (TLV) constructs (see <a class='info' href='#RFC5444'>[RFC5444]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;Generalized MANET Packet/Message Format,&rdquo; February&nbsp;2009.</span><span>)</span></a>)
      used to extend NHDP operation as needed to support different forms of
      SMF operation.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1"></a><h3>11.1.&nbsp;
IPv6 SMF_DPD Header Extension</h3>

<p>This document requests IANA assignment of the "SMF_DPD" hop-by-hop
        option type from the IANA "IPv6 Hop-by-Hop Options Option Type"
        registry (see Section 5.5 of <a class='info' href='#RFC2780'>[RFC2780]<span> (</span><span class='info'>Bradner, S., &ldquo;IANA Allocation Guidelines For Values In the Internet           Protocol and Related Headers,&rdquo; March&nbsp;2000.</span><span>)</span></a>).
</p>
<p>The format of this new option type is described in <a class='info' href='#Opt-DPD'>Section&nbsp;5.1.1<span> (</span><span class='info'>IPv6 SMF-DPD Header Option</span><span>)</span></a>. A portion of the option data content is the
        "taggerIdType" that provides a context for the "taggerId" that is
        optionally included to identify the intermediate system that added the
        SMF_DPD option to the packet. This document defines a name-space for
        IPv6 SMF_DPD Tagger Identifier Types:
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>ietf:manet:smf:taggerIdTypes</pre></div>
<p>The values that can be assigned within the
        "ietf:manet:smf:taggerIdTypes" name-space are numeric indexes in the
        range [0, 7], boundaries included. All assignment requests are granted
        on a "IETF Consensus" basis as defined in <a class='info' href='#RFC2434'>[RFC2434]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for           Writing an IANA Considerations Section in RFCs,&rdquo; October&nbsp;1998.</span><span>)</span></a>.
</p>
<p>This specification registers Tagger Identification Type values from
        <a class='info' href='#taggerIdTypes'>Table&nbsp;9<span> (</span><span class='info'>TaggerId Types</span><span>)</span></a> in the registry
        "ietf:manet:smf:taggerIdTypes":
</p><br /><hr class="insert" />
<a name="taggerIdTypes"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center"><col align="left">
<tr><th align="center">Mnemonic</th><th align="center">Value</th><th align="left">Reference</th></tr>
<tr>
<td align="center">NULL</td>
<td align="center">0</td>
<td align="left">This document</td>
</tr>
<tr>
<td align="center">DEFAULT</td>
<td align="center">1</td>
<td align="left">This document</td>
</tr>
<tr>
<td align="center">IPv4</td>
<td align="center">2</td>
<td align="left">This document</td>
</tr>
<tr>
<td align="center">IPv6</td>
<td align="center">3</td>
<td align="left">This document</td>
</tr>
<tr>
<td align="center">ExtId</td>
<td align="center">7</td>
<td align="left">This document</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 9: TaggerId Types&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2"></a><h3>11.2.&nbsp;
SMF Type-Length-Value</h3>

<p>This document requests an IANA assignment one message "SMF_TYPE"
        TLV value and one address block "SMF_NBR_TYPE" TLV value from the
        <a class='info' href='#NHDP'>[NHDP]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;MANET Neighborhood Discovery Protocol,&rdquo; July&nbsp;2009.</span><span>)</span></a> specific registry space.
</p>
<p>The format of this new TLV type is described in <a class='info' href='#smfType_Message'>Table&nbsp;6<span> (</span><span class='info'>SMF Type Message TLV</span><span>)</span></a> and <a class='info' href='#smfType_Addr'>Table&nbsp;8<span> (</span><span class='info'>SMF Type Address Block TLV</span><span>)</span></a>. Furthermore this document defines a
        namespace for algorithm ID types using the extended type TLV value
        field defined by <a class='info' href='#RFC5444'>[RFC5444]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;Generalized MANET Packet/Message Format,&rdquo; February&nbsp;2009.</span><span>)</span></a>. Both SMF_TYPE and
        SMF_NBR_TYPE TLVs use this namespace.
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>ietf:manet:packetbb:nhdp:smf:relayAlgorithmID</pre></div>
<p>The values that can be assigned within the
        "ietf:manet:packetbb:nhdp:smf:relayAlgorithmID" name-space are numeric
        indexes in the range [0, 239], boundaries included. Assignment
        requests for the [0-127] are granted on a "IETF Consensus" basis as
        defined in <a class='info' href='#RFC2434'>[RFC2434]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for           Writing an IANA Considerations Section in RFCs,&rdquo; October&nbsp;1998.</span><span>)</span></a>. Standards action is not
        required for assignment requests of the range [128-239]. Documents
        requesting relayAlgorithmId values SHOULD define value field uses
        contained by the SMF_TYPE:&lt;relayAlgorithmID&gt; and
        SMF_NBR_TYPE:&lt;relayAlgorithmID&gt; full type TLVs.
</p>
<p>This specification registers the following Relay Algorithm ID Type
        values shown in <a class='info' href='#RelaySetTypes'>Table&nbsp;10<span> (</span><span class='info'>Relay Set Algorithm Type Values</span><span>)</span></a> in the registry
        "ietf:manet:packetbb:nhdp:smf:relayAlgorithmID
</p><br /><hr class="insert" />
<a name="RelaySetTypes"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">Mnemonic</th><th align="left">Value</th><th align="left">Reference</th></tr>
<tr>
<td align="left">CF</td>
<td align="left">0</td>
<td align="left">This document</td>
</tr>
<tr>
<td align="left">S-MPR</td>
<td align="left">1</td>
<td align="left"><a class='info' href='#smprAppendix'>Appendix&nbsp;B<span> (</span><span class='info'>Source-based Multipoint Relay (S-MPR)</span><span>)</span></a></td>
</tr>
<tr>
<td align="left">E-CDS</td>
<td align="left">2</td>
<td align="left"><a class='info' href='#ecdsAppendix'>Appendix&nbsp;A<span> (</span><span class='info'>Essential Connecting Dominating Set (E-CDS) Algorithm</span><span>)</span></a></td>
</tr>
<tr>
<td align="left">MPR-CDS</td>
<td align="left">3</td>
<td align="left"><a class='info' href='#mprcdsAppendix'>Appendix&nbsp;C<span> (</span><span class='info'>Multipoint Relay Connected Dominating Set (MPR-CDS) Algorithm</span><span>)</span></a></td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 10: Relay Set Algorithm Type Values&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Acknowledgments</h3>

<p>Many of the concepts and mechanisms used and adopted by SMF resulted
      from many years of discussion and related work within the MANET WG since
      the late 1990s. There are obviously many contributors to past
      discussions and related draft documents within the WG that have
      influenced the development of SMF concepts that deserve acknowledgment.
      In particular, the document is largely a direct product of the earlier
      SMF design team within the IETF MANET WG and borrows text and
      implementation ideas from the related individuals and activities. Some
      of the driect contributors who have been involved in design, content
      editing, prototype implementation, and core discussions are listed below
      in alphabetical order. We appreciate all the input and feedback from the
      many community members and early implementation users we have heard from
      that are not on this list as well.
</p>
<p></p>
<blockquote class="text">
<p>Key contributors/authors in alphabetical order:
</p>
<p>Brian Adamson
</p>
<p>Teco Boot
</p>
<p>Ian Chakeres
</p>
<p>Thomas Clausen
</p>
<p>Justin Dean
</p>
<p>Brian Haberman
</p>
<p>Charles Perkins
</p>
<p>Pedro Ruiz
</p>
<p>Fred Templin
</p>
<p>Maoyu Wang
</p>
</blockquote>

<p>The RFC text was produced using Marshall Rose's xml2rfc tool and Bill
      Fenner's XMLmind add-ons.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="E-CDS">[E-CDS]</a></td>
<td class="author-text">Ogier, R., &ldquo;MANET Extension of OSPF Using CDS Flooding,&rdquo; Proceedings of the 62nd IETF&nbsp;, March&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="MPR-CDS">[MPR-CDS]</a></td>
<td class="author-text">Adjih, C., Jacquet, P., and L. Viennot, &ldquo;Computing Connected Dominating Sets with Multipoint
          Relays,&rdquo; Ad Hoc and Sensor Wireless Networks&nbsp;, January&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="NHDP">[NHDP]</a></td>
<td class="author-text">Clausen, T. and et al, &ldquo;MANET Neighborhood Discovery Protocol,&rdquo; draft-ietf-manet-nhdp-10, Work in progress&nbsp;, July&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="OLSRv2">[OLSRv2]</a></td>
<td class="author-text">Clausen, T. and et al, &ldquo;Optimized Link State Routing Protocol version 2,&rdquo; draft-ietf-manet-olsrv2-09, Work in progress&nbsp;, July&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC0791">[RFC0791]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc791">Internet Protocol</a>,&rdquo; STD&nbsp;5, RFC&nbsp;791, September&nbsp;1981 (<a href="ftp://ftp.isi.edu/in-notes/rfc791.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1321">[RFC1321]</a></td>
<td class="author-text"><a href="mailto:rivest@theory.lcs.mit.edu">Rivest, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1321">The MD5 Message-Digest
          Algorithm</a>,&rdquo; RFC&nbsp;1321, April&nbsp;1992 (<a href="ftp://ftp.isi.edu/in-notes/rfc1321.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate
          Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2434">[RFC2434]</a></td>
<td class="author-text"><a href="mailto:narten@raleigh.ibm.com">Narten, T.</a> and <a href="mailto:Harald@Alvestrand.no">H. Alvestrand</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2434">Guidelines for
          Writing an IANA Considerations Section in RFCs</a>,&rdquo; BCP&nbsp;26, RFC&nbsp;2434, October&nbsp;1998 (<a href="ftp://ftp.isi.edu/in-notes/rfc2434.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2434.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2434.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2460">[RFC2460]</a></td>
<td class="author-text"><a href="mailto:deering@cisco.com">Deering, S.</a> and <a href="mailto:hinden@iprg.nokia.com">R. Hinden</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6
          (IPv6) Specification</a>,&rdquo; RFC&nbsp;2460, December&nbsp;1998 (<a href="ftp://ftp.isi.edu/in-notes/rfc2460.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2460.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2460.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2644">[RFC2644]</a></td>
<td class="author-text"><a href="mailto:dts@senie.com">Senie, D.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2644">Changing the
          Default for Directed Broadcasts in Routers</a>,&rdquo; BCP&nbsp;34, RFC&nbsp;2644, August&nbsp;1999 (<a href="ftp://ftp.isi.edu/in-notes/rfc2644.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2780">[RFC2780]</a></td>
<td class="author-text">Bradner, S., &ldquo;IANA Allocation Guidelines For Values In the Internet
          Protocol and Related Headers,&rdquo; March&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3626">[RFC3626]</a></td>
<td class="author-text">Clausen, T. and P. Jacquet, &ldquo;Optimized Link State Routing Protocol,&rdquo; 2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4302">[RFC4302]</a></td>
<td class="author-text">Kent, S., &ldquo;IP Authentication Header,&rdquo; December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5444">[RFC5444]</a></td>
<td class="author-text">Clausen, T. and et al, &ldquo;<a href="http://tools.ietf.org/html/rfc5444">Generalized MANET Packet/Message Format</a>,&rdquo; RFC&nbsp;5444, February&nbsp;2009.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="GM99">[GM99]</a></td>
<td class="author-text">Garcia-Luna-Aceves, JJ. and E. Madruga, &ldquo;The core-assisted mesh protocol,&rdquo; Selected Areas in Communications, IEEE Journal on &nbsp;Volume 17, Issue 8, August&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="JLMV02">[JLMV02]</a></td>
<td class="author-text">Jacquet, P., Laouiti, V., Minet, P., and L. Viennot, &ldquo;Performance of multipoint relaying in ad hoc mobile routing
          protocols,&rdquo; Networking&nbsp;, 2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="MDC04">[MDC04]</a></td>
<td class="author-text">Macker, J., Dean, J., and W. Chao, &ldquo;Simplified Multicast Forwarding in Mobile Ad hoc
          Networks,&rdquo; IEEE MILCOM 2004 Proceedings&nbsp;, 2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="MDDA07">[MDDA07]</a></td>
<td class="author-text">Macker, J., Downard, I., Dean, J., and R. Adamson, &ldquo;Evaluation of distributed cover set algorithms in mobile ad
          hoc network for simplified multicast forwarding,&rdquo; ACM SIGMOBILE Mobile Computing and Communications Review &nbsp;Volume 11 ,  Issue 3  (July 2007), July&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="MGL04">[MGL04]</a></td>
<td class="author-text">Mohapatra, P., Gui, C., and J. Li, &ldquo;Group Communications in Mobile Ad hoc Networks,&rdquo; IEEE Computer&nbsp;Vol. 37, No. 2, February&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="NTSC99">[NTSC99]</a></td>
<td class="author-text">Ni, S., Tseng, Y., Chen, Y., and J. Sheu, &ldquo;The Broadcast Storm Problem in Mobile Ad hoc Networks,&rdquo; Proceedings Of ACM Mobicom 99&nbsp;, 1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2901">[RFC2901]</a></td>
<td class="author-text">Macker, JP. and MS. Corson, &ldquo;Mobile Ad hoc Networking (MANET): Routing Protocol
          Performance Issues and Evaluation Considerations,&rdquo; 1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3684">[RFC3684]</a></td>
<td class="author-text">Ogier, R., Templin, F., and M. Lewis, &ldquo;Topology Dissemination Based on Reverse-Path
          Forwarding,&rdquo; 2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3973">[RFC3973]</a></td>
<td class="author-text">Adams, A., Nicholas, J., and W. Siadak, &ldquo;<a href="http://tools.ietf.org/html/rfc3973">Protocol Independent Multicast - Dense Mode (PIM-DM):
          Protocol Specification (Revised)</a>,&rdquo; RFC&nbsp;3973, January&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc3973.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4601">[RFC4601]</a></td>
<td class="author-text">Fenner, B., Handley, M., Holbrook, H., and I. Kouvelas, &ldquo;<a href="http://tools.ietf.org/html/rfc4601">Protocol Independent Multicast - Sparse Mode (PIM-SM):
          Protocol Specification (Revised)</a>,&rdquo; RFC&nbsp;4601, August&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4601.txt">TXT</a>, <a href="ftp://ftp.isi.edu/in-notes/rfc4601.pdf">PDF</a>).</td></tr>
</table>

<a name="ecdsAppendix"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Essential Connecting Dominating Set (E-CDS) Algorithm</h3>

<p>The "Essential Connected Dominating Set" (E-CDS) algorithm <a class='info' href='#E-CDS'>[E&#8209;CDS]<span> (</span><span class='info'>Ogier, R., &ldquo;MANET Extension of OSPF Using CDS Flooding,&rdquo; March&nbsp;2005.</span><span>)</span></a> allows nodes to use 2-hop neighborhood topology
      information to dynamically perform relay self election to form a CDS.
      Its packet forwarding rules are not dependent upon previous hop
      knowledge. Additionally, E-CDS SMF forwarders can be easily mixed
      without problems with CF SMF forwarders, even those not participating in
      NHDP. Another benefit is that packets opportunistically received from
      non-symmetric neighbors may be forwarded without compromising flooding
      efficiency or correctness. Furthermore, multicast sources not
      participating in NHDP may freely inject their traffic and any
      neighboring E-CDS relays will properly forward the traffic. The E-CDS
      based relay set selection algorithm is based upon the summary within
      <a class='info' href='#E-CDS'>[E&#8209;CDS]<span> (</span><span class='info'>Ogier, R., &ldquo;MANET Extension of OSPF Using CDS Flooding,&rdquo; March&nbsp;2005.</span><span>)</span></a>. E-CDS was originally discussed in the
      context of forming partial adjacencies and efficient flooding for MANET
      OSPF extensions work and the core algorithm is applied here for SMF.
</p>
<p>It is RECOMMENDED that the SMF_TYPE:E-CDS message TLV be included in
      NHDP_HELLO messages that are generated by nodes conducting E-CDS SMF
      operation. It is also RECOMMENDED that the SMF_NBR_TYPE:E-CDS address
      block TLV be used to advertise neighbor nodes that are also conducting
      E-CDS SMF operation.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
E-CDS Relay Set Selection Overview</h3>

<p>The E-CDS relay set selection requires 2-hop neighborhood
        information collected through NHDP or another process. Relay nodes, in
        E-CDS SMF selection, are "self-elected" using a router identifier
        (Router ID) and an optional nodal metric, referred to here as "Router
        Priority" for all 1-hop and 2-hop neighbors. To ensure proper relay
        set self-election, the Router ID and Router Priority MUST be
        consistent among nodes participating and it is RECOMMENDED that NHDP
        be used to share this information. The Router ID is a logical
        identification that MUST be consistent across interoperating SMF
        neighborhoods and it is RECOMMENDED to be chosen as the largest
        interface address advertised by NHDP. The E-CDS self-election process
        can be summarized as follows:
</p>
<p></p>
<ol class="text">
<li>If an SMF node has a higher ordinal (Router Priority, Router
            ID) than all of its symmetric neighbors, it elects itself to act
            as a forwarder for all received multicast packets,
</li>
<li>Else, if there does not exist a path from neighbor "j" with
            largest (Router Priority, Router ID) to any other neighbor, <em>via</em> neighbors with larger values of (Router
            Priority, Router ID), then it elects itself to the relay set.
</li>
</ol>

<p>The basic form of E-CDS described and applied within this
        specification does not provide for redundant relay set election (e.g.,
        bi-connected) but such capability is supported by the basic E-CDS
        design.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
E-CDS Forwarding Rules</h3>

<p>With E-CDS, any SMF node that has selected itself as a relay
        performs DPD and forwards all non-duplicative multicast traffic
        allowed by the present forwarding policy. Packet previous hop
        knowledge is not needed for forwarding decisions when using E-CDS.
</p>
<p></p>
<ol class="text">
<li>Upon packet reception, DPD is performed. Note E-CDS requires a
            single duplicate table for the set of interfaces associated with
            the relay set selection.
</li>
<li>If the packet is a duplicate, no further action is taken.
</li>
<li>If the packet is non-duplicative:
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>A DPD entry is made for the packet identifier
</dd>
<dt>B.</dt>
<dd>The packet is forwarded out all interfaces associated with
                the relay set selection
</dd>
</dl></blockquote>
</li>
</ol>

<p>As previously mentioned, even packets sourced (or relayed) by nodes
        not participating in NHDP and/or the E-CDS relay set selection may be
        forwarded by E-CDS forwarders without problem. A particular deployment
        MAY choose to not forward packets from sources or relays that have
        been not explicitly identified via NHDP or other means as operating as
        part of a different relay set algorithm (e.g. S-MPR) to allow
        coexistent deployments to operate correctly. Also, E-CDS relay set
        selection may be configured to be influenced by statically-configured
        CF relays that are identified via NHDP or other means.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
E-CDS Neighborhood Discovery Requirements</h3>

<p>It is possible to perform E-CDS relay set selection without
        modification of NHDP, basing the self-election process exclusively on
        the Router IDs (interface addresses) of participating SMF nodes.
        However steps MUST be taken to insure that all NHDP instances not
        using SMF_TYPE:E-CDS full type message TLVs are in fact running SMF
        E-CDS, otherwise incorrect forwarding may occur. Furthermore, it has
        been shown that use of a "Router Priority" metric as part of the
        selection process can result in improved performance in certain cases.
        Note that SMF nodes with higher "Router Priority" values will tend to
        be favored as relays over other nodes. Thus, preferred relays MAY be
        administratively configured to be selected when possible.
        Additionally, other metrics (e.g. nodal degree, energy capacity, etc)
        may also be taken into account in constructing a "Router Priority"
        value. When using &ldquo;Router Priority&rdquo; with multiple
        interfaces all interfaces on a node MUST use and advertise a common
        "Router Priority" value.
</p>
<p>To share a node's "Router Priority" with its 1-hop neighbors the
        SMF_TYPE:E-CDS message TLV's &lt;value&gt; field is defined as shown
        in <a class='info' href='#ecdsMsgTLVValueDef'>Table&nbsp;11<span> (</span><span class='info'>E-CDS Message TLV Values</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="ecdsMsgTLVValueDef"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">Length(bytes)</th><th align="left">Value</th><th align="left">Router Priority</th></tr>
<tr>
<td align="left">0</td>
<td align="left">N/A</td>
<td align="left">64</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">&lt;value&gt;</td>
<td align="left">0-127</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 11: E-CDS Message TLV Values&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Where &lt;value&gt; is a one byte bit field which is defined
        as:
</p>
<p>bit 0: is reserved and SHOULD be set to 0.
</p>
<p>bit 1-7: contain the priority value, 0-127, which is associated
        with the originator address.
</p>
<p>Combinations of value field lengths and values other than specified
        here are NOT permitted and SHOULD be ignored. Below is an example
        SMF_TYPE:E-CDS message TLV
</p>
<p><br /><hr class="insert" />
<a name="ecdsMsgTLVExample"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                  ...              |   SMF_TYPE    |1|0|0|1|0|0|   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     E-CDS     |0|0|0|0|0|0|0|1|R|  priority   |     ...       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: E-CDS Message TLV Example&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
To convey "Router Priority" values among 2-hop
        neighborhoods the SMF_NBR_TYPE:E-CDS address block TLV's &lt;value&gt;
        field is defined thus:
</p><br /><hr class="insert" />
<a name="ecdsAddrTLVValueDef"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left"><col align="left">
<tr><th align="left">Length(bytes)</th><th align="left"># Addr</th><th align="left">Value</th><th align="left">Router Priority</th></tr>
<tr>
<td align="left">0</td>
<td align="left">Any</td>
<td align="left">N/A</td>
<td align="left">64</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">Any</td>
<td align="left">&lt;value&gt;</td>
<td align="left">&lt;value&gt; is for all addresses</td>
</tr>
<tr>
<td align="left">N</td>
<td align="left">N</td>
<td align="left">&lt;value&gt;*</td>
<td align="left">Each address gets its own &lt;value&gt;</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 12: E-CDS Address Block TLV Values&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Where &lt;value&gt; is a one byte bit field which is defined
        as:
</p>
<p>bit 0: is reserved and SHOULD be set to 0.
</p>
<p>bit 1-7: contain a priority value, 0-127, which is associated with
        the appropriate address.
</p>
<p>Combinations of value field lengths and # of addresses other than
        specified here are NOT permitted and SHOULD be ignored. A default
        technique of using nodal degree (i.e. count of 1-hop neighbors) is
        RECOMMENDED for the value field of these TLV types. Below are two
        example SMF_NBR_TYPE:E-CDS address block TLVs.
</p>
<p><br /><hr class="insert" />
<a name="ecdsAddrTLVExample1"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                  ...              | SMF_NBR_TYPE  |1|0|0|1|0|0|   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     E-CDS     |0|0|0|0|0|0|0|1|R|  priority   |     ...       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: E-CDS Address Block TLV Example 1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
This single value example TLV specifies that all
        address(es) contained in the address block are running SMF using the
        E-CDS algorithm and all address(es) share the value field and
        therefore the same priority value.<br /><hr class="insert" />
<a name="ecdsAddrTLVExample2"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                  ...              | SMF_NBR_TYPE  |1|0|1|1|0|1|   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     E-CDS     |  index-start  |   index-end   |    length     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |R|  priority0  |R|  priority1  |      ...      |R|  priorityn  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: E-CDS Address Block TLV Example 2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
This example multivalue TLV specifies that address(es)
        contained in the address block from index-start to index-end inclusive
        are running SMF using the E-CDS algorithm. Each address is associated
        with its own value byte and therefore their own priority value.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.4"></a><h3>A.4.&nbsp;
E-CDS Selection Algorithm</h3>

<p>This section describes an algorithm for E-CDS relay selection
        (self-election). The algorithm described uses 2-hop information. Note
        it is possible to extend this algorithm to use k-hop information with
        added computational complexity and mechanisms for sharing k-hop
        topology information that are not described in this document or wihtin
        the NHDP specification. It should also be noted that this algorithm
        does not impose the "hop limit" bound described in <a class='info' href='#E-CDS'>[E&#8209;CDS]<span> (</span><span class='info'>Ogier, R., &ldquo;MANET Extension of OSPF Using CDS Flooding,&rdquo; March&nbsp;2005.</span><span>)</span></a> when performing the path search that is used
        for relay selection. However, the algorithm below could be easily
        augmented to accommodate this additional criteria. In normal
        operation, it is not expected that the "hop limit" bound will provide
        significant benefit.
</p>
<p>The tuple of "Router Priority" and "Router ID" is used in E-CDS
        relay set selection. Precedence is given to the "Router Priority"
        portion and the "Router ID" value is used as a tie-breaker. The
        evaluation of this tuple is referred to as "RtrPri(n)" in the
        description below where "n" references a specific node. Note it is
        possible that the "Router Priority" portion may be optional and the
        evaluation of "RtrPri()" be solely based upon the unique "Router ID".
        Since there MUST NOT be any duplicate "Router ID" values among SMF
        nodes, a comparison of RtrPri(n) between any two nodes will always be
        an inequality. The use of nodal degree for calculating "Router
        Priority" is RECOMMENDED as default and the largest IP address
        associated across interfaces advertised by NHDP MUST be used as the
        "Router ID". NHDP provides all interface address throughout the 2-hop
        neighborhood so explicity conveying a "Router ID" is not necessary.
        The following steps describe a basic algorithm for conducting E-CDS
        relay selection for a node "n0": </p>
<ol class="text">
<li>Initialize the set "N1" to include all 1-hop neighbors of
            "n0".
</li>
<li>If "N1" has less than 2 members, then "n0" does not elect
            itself as a relay and no further steps are taken.
</li>
<li>Initialize the set "N2" to include all 2-hop neighbors,
            excluding "n0" and any nodes in "N1".
</li>
<li>If "RtrPri(n0)" is greater than that of all nodes in the union
            of "N1" and "N2", then "n0" selects itself as a relay and no
            further steps are taken.
</li>
<li>Initialize all nodes in the union of "N1" and "N2" as
            "unvisited".
</li>
<li>Find the node "n1_Max" that has the largest "RtrPri()" of all
            nodes in "N1"
</li>
<li>Initialize queue "Q" to contain "n1_Max", marking "n1_Max" as
            "visited"
</li>
<li>While node queue "Q" is not empty, remove node "x" from the
            head of "Q", and for each 1-hop neighbor "n" of node "x"
            (excluding "n0") that is not marked "visited"
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>Mark node "n" as "visited"
</dd>
<dt>B.</dt>
<dd>If "RtrPri(n)" is greater than "RtrPri(n0), append "n" to
                "Q"
</dd>
</dl></blockquote>
</li>
<li>If any node in "N1" remains "unvisited", then "n0" selects
            itself as a relay. Otherwise "n0" does not act as an relay.
</li>
</ol><p>Note these steps are re-evaluated upon neighborhood status
        changes. Steps 5 through 8 of this procedure describe an approach to a
        path search. The purpose of this path search is to determine if paths
        exist from the 1-hop neighbor with maximum "RtrPri()" to all other
        1-hop neighbors without traversing an intermediate node with a
        ""RtrPri()" value less than "RtrPri(n0)". These steps comprise a
        breadth-first traversal that evaluates only paths that meet that
        criteria. If all 1-hop neighbors of "n0" are "visited" during this
        traversal, then the path search has succeeded and node "n0" does not
        need to provide relay. It can be assumed that other nodes will provide
        relay operation to ensure SMF connectivity.
</p>
<p>It is possible to extend this algorithm to consider neighboring SMF
        nodes that are known to be statically configured for CF (always
        relaying). The modification to the above algorithm is to process such
        nodes as having a maximum possible "Router Priority" value. It is
        expected that nodes configured for CF and participating in NHDP would
        indicate this with use of the SMF_TYPE:CF and SMF_NBR_TYPE:CF TLV
        types in their NHDP_HELLO message and address blocks,
        respectively.
</p>
<a name="smprAppendix"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Source-based Multipoint Relay (S-MPR)</h3>

<p>The source-based multipoint relay (S-MPR) set selection algorithm
      enables individual nodes, using two-hop topology information, to select
      relays from their set of neighboring nodes. Relays are selected so that
      forwarding to the node's complete two-hop neighbor set is covered. This
      distributed relay set selection technique has been shown to approximate
      a minimal connected dominating set (MCDS) in <a class='info' href='#JLMV02'>[JLMV02]<span> (</span><span class='info'>Jacquet, P., Laouiti, V., Minet, P., and L. Viennot, &ldquo;Performance of multipoint relaying in ad hoc mobile routing           protocols,&rdquo; 2002.</span><span>)</span></a>. Individual nodes must collect two-hop
      neighborhood information from neighbors, determine an appropriate
      current relay set, and inform selected neighbors of their relay status.
      Note that since each node picks its neighboring relays independently,
      S-MPR forwarders depend upon previous hop information (e.g, source MAC
      address) to operate correctly. The Optimized Link State Routing (OLSR)
      protocol has used this algorithm and protocol for relay of link state
      updates and other control information <a class='info' href='#RFC3626'>[RFC3626]<span> (</span><span class='info'>Clausen, T. and P. Jacquet, &ldquo;Optimized Link State Routing Protocol,&rdquo; 2003.</span><span>)</span></a> and
      it has been demonstrated operationally in dynamic network
      environments.
</p>
<p>It is RECOMMENDED that the SMF_TYPE:S-MPR message TLV be included in
      NHDP_HELLO messages that are generated by nodes conducting S-MPR SMF
      operation. It is also RECOMMENDED that the SMF_NBR_TYPE:S-MPR address
      block TLV be used to specifiy which neighbor nodes are conducting S-MPR
      SMF operation.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1"></a><h3>B.1.&nbsp;
S-MPR Relay Set Selection Overview</h3>

<p>A RECOMMENDED algorithm for S-MPR set selection is described in the
        <a class='info' href='#OLSRv2'>[OLSRv2]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;Optimized Link State Routing Protocol version 2,&rdquo; July&nbsp;2009.</span><span>)</span></a> specification. As this algorithm has had
        considerable use to support the OLSR control plane, it is expected to
        perform adequately to support data plane multicast traffic. To
        summarize, the S-MPR algorithm uses bi-directional 1-hop and 2-hop
        neighborhood information collected via NHDP to select, from a node's
        1-hop neighbors, a set of relays that will cover the node's entire
        2-hop neighbor set upon forwarding. The algorithm described uses a
        "greedy" heuristic of first picking the 1-hop neighbor who will cover
        the most 2-hop neighbors. Then, excluding those 2-hop neighbors that
        have been covered, additional relays from its 1-hop neighbor set are
        iteratively selected until the entire 2-hop neighborhood is covered.
        Note that 1-hop neighbors also identified as 2-hop neighbors are
        considered as 1-hop neighbors only. This is only a partial description
        of the S-MPR algorithm. The <a class='info' href='#RFC3626'>[RFC3626]<span> (</span><span class='info'>Clausen, T. and P. Jacquet, &ldquo;Optimized Link State Routing Protocol,&rdquo; 2003.</span><span>)</span></a>
        specification provides a complete description including the use of a
        "WILLINGNESS" metric, termed here "Router Priority", that can be used
        to influence S-MPR forwarder selection.
</p>
<p>NHDP_HELLO messages supporting S-MPR forwarding operation SHOULD
        use the TLVs defined in <a class='info' href='#SMFTLVs'>Section&nbsp;7.1<span> (</span><span class='info'>SMF Relay Algorithm TLV Types</span><span>)</span></a> using the S-MPR
        extended type. The value field of an address block TLV which has a
        full type value of SMF_NBR_TYPE:S-MPR is defined in <a class='info' href='#smprAddrTLVValueDef'>Table&nbsp;14<span> (</span><span class='info'>E-CDS Address Block TLV Values</span><span>)</span></a> such that signaling of multi
        point relay (MPR) selections to 1-hop neighbors is possible. The value
        field of a message block TLV which has a full type value of
        SMF_TYPE:S-MPR is defined in <a class='info' href='#smprMsgTLVValueDef'>Table&nbsp;13<span> (</span><span class='info'>S-MPR Message TLV Values</span><span>)</span></a>
        such that signaling of "Router Priority" (described as "WILLINGNESS"
        in <a class='info' href='#OLSRv2'>[OLSRv2]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;Optimized Link State Routing Protocol version 2,&rdquo; July&nbsp;2009.</span><span>)</span></a>) to 1-hop neighbors is possible. In
        some cases "MPR" address block TLV specified in <a class='info' href='#RFC3626'>[RFC3626]<span> (</span><span class='info'>Clausen, T. and P. Jacquet, &ldquo;Optimized Link State Routing Protocol,&rdquo; 2003.</span><span>)</span></a> MAY be used in place of the SMF_NBR_TYPE:SMPR
        TLV to mark the addresses of selected neighbor relays in the
        NHDP_HELLO message address block(s), however in this case steps must
        be taken to insure SMF operation of neighbor nodes otherwise improper
        forwarding selection can occur. It is important to note that S-MPR
        forwarding is dependent upon the previous hop of an incoming packet. A
        S-MPR node MUST forward packets only for neighbors which have
        explicitly selected it as a relay (i.e., its "selectors"). There are
        also some additional requirements for duplicate packet detection to
        support S-MPR SMF operation that are described below.
</p>
<p>For multiple interface operation, MPR selection SHOULD be conducted
        on a per-interface basis. However, it is possible to economize MPR
        selection among multiple interfaces by selecting common MPRs to the
        extent possible. It is important to note that the S-MPR forwarding
        rules described in <a class='info' href='#OLSRv2'>[OLSRv2]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;Optimized Link State Routing Protocol version 2,&rdquo; July&nbsp;2009.</span><span>)</span></a> assume per-interface
        MPR selection (i.e. MPRs are <em>not</em> selected
        in the context of all interfaces). This is consistent with the MPR
        selection heuristics described in <a class='info' href='#RFC3626'>[RFC3626]<span> (</span><span class='info'>Clausen, T. and P. Jacquet, &ldquo;Optimized Link State Routing Protocol,&rdquo; 2003.</span><span>)</span></a>.
        Other source-based approaches may be possible, but would require
        alternative selection and forwarding rules to be specified.
</p>
<a name="smprForwarding"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.2"></a><h3>B.2.&nbsp;
S-MPR Forwarding Rules</h3>

<p>An S-MPR relay MUST only forward packets for neighbors that have
        explicitly selected it as a forwarder. The source-based forwarding
        technique also stipulates some additional duplicate packet detection
        operations. For multiple network interfaces, independent DPD state
        MUST be maintained for each separate interface. The following table
        provides the procedure for S-MPR packet forwarding given the arrival
        of a packet on a given interface, denoted &lt;srcIface&gt;. There are
        three possible actions, depending upon the previous-hop
        transmitter:
</p>
<p></p>
<ol class="text">
<li>If the previous-hop transmitter has selected the current node
            as a relay,
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>The packet identifier is checked against the DPD state for
                each possible outbound interface, including the
                &lt;srcIface&gt;.
</dd>
<dt>B.</dt>
<dd>If the packet is not a duplicate for an outbound interface,
                the packet is forwarded via that interface and a DPD entry is
                made for the given packet identifier for the interface.
</dd>
<dt>C.</dt>
<dd>If the packet is a duplicate, no action is taken for that
                interface.
</dd>
</dl></blockquote>
</li>
<li>Else, if the previous-hop transmitter is a 1-hop symmetric
            neighbor,
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>A DPD entry is made for that packet for the
                &lt;srcIface&gt;, but the packet is not forwarded.
</dd>
</dl></blockquote>
</li>
<li>Otherwise, no action is taken.
</li>
</ol>

<p>Case number two in the above table is non-intuitive, but important
        to ensure correctness of S-MPR SMF operation. The selection of
        source-based relays does not result in a common set among neighboring
        nodes, so relays MUST mark in their DPD state, packets received from
        non-selector, symmetric, one-hop neighbors (for a given interface) and
        not forward subsequent duplicates of that packet if received on that
        interface. Deviation here can result in unnecessary, repeated packet
        forwarding throughout the network, or incomplete flooding.
</p>
<p>Nodes not participating in neighborhood discovery and relay set
        selection will not be able to source multicast packets into the area
        and have SMF forward them, unlike E-CDS or MPR-CDS where forwarding
        may occur dependent on topology. Correct S-MPR relay behavior will
        occur with the introduction of repeaters (non-NHDP/SMF participants
        that relay multicast packets using duplicate detection and CF) but the
        repeaters will not efficiently contribute to S-MPR forwarding as these
        nodes will not be identified as neighbors (symmetric or otherwise) in
        the S-MPR forwarding process. NHDP/SMF participants MUST NOT provide
        extra forwarding, forwarding packets which are not selected by the
        algorithm, as this can disrupt network-wide S-MPR flooding, resulting
        in incomplete or inefficient flooding.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.3"></a><h3>B.3.&nbsp;
S-MPR Neighborhood Discovery Requirements</h3>

<p>Nodes may optionally signal "Router Priority" or "WILLINGNESS" to
        become MPR nodes for their one hop neighbors by using the
        SMF_TYPE:S-MPR message block TLV value field defined as such:
</p><br /><hr class="insert" />
<a name="smprMsgTLVValueDef"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">Length(bytes)</th><th align="left">Value</th><th align="left">Router Priority</th></tr>
<tr>
<td align="left">0</td>
<td align="left">N/A</td>
<td align="left">64</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">&lt;value&gt;</td>
<td align="left">0-127</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 13: S-MPR Message TLV Values&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Where &lt;value&gt; is a one byte bit field which is defined
        as:
</p>
<p>bit 0: is reserved and SHOULD be set to 0.
</p>
<p>bit 1-7: contain the priority value, 0-127, which is associated
        with the originator address.
</p>
<p>Router priority values for S-MPR work similarly to "WILLINGNESS"
        values as described in <a class='info' href='#OLSRv2'>[OLSRv2]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;Optimized Link State Routing Protocol version 2,&rdquo; July&nbsp;2009.</span><span>)</span></a> with value 0
        indicating a node will NEVER forward and value 127 indicating a node
        will ALWAYS forward. Combinations of value field lengths and values
        other than specified here are NOT permitted and SHOULD be ignored.
        Below is an example SMF_TYPE:S-MPR message TLV.
</p>
<p><br /><hr class="insert" />
<a name="smprMsgTLVExample"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                  ...              | SMF_NBR_TYPE  |1|0|0|1|0|0|   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     S-MPR     |0|0|0|0|0|0|0|1|R|  priority   |     ...       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: S-MPR Message TLV Example&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p>S-MPR election operation requires 2-hop neighbor knowledge as
        provided by the NHDP protocol <a class='info' href='#NHDP'>[NHDP]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;MANET Neighborhood Discovery Protocol,&rdquo; July&nbsp;2009.</span><span>)</span></a> or from
        external sources. MPRs are dynamically selected by each node and
        selections MUST be advertised and dynamically updated within NHDP or
        an equivalent protocol or mechanism. For NHDP use, the
        SMF_NBR_TYPE:S-MPR address block TLV value field is defined as
        such:
</p><br /><hr class="insert" />
<a name="smprAddrTLVValueDef"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left"><col align="left">
<tr><th align="left">Length(bytes)</th><th align="left"># Addr</th><th align="left">Value</th><th align="left">Meaning</th></tr>
<tr>
<td align="left">0</td>
<td align="left">Any</td>
<td align="left">N/A</td>
<td align="left">Addresses are NOT MPRs</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">Any</td>
<td align="left">&lt;value&gt;</td>
<td align="left">&lt;value&gt; is for all addresses</td>
</tr>
<tr>
<td align="left">N</td>
<td align="left">N</td>
<td align="left">&lt;value&gt;*</td>
<td align="left">Each address gets its own &lt;value&gt;</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 14: E-CDS Address Block TLV Values&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Where &lt;value&gt; is a one byte field whcih is defined as:
</p>
<p>bit 0: Is the M bit which when set indicates MPR selection of
        associated address(es) by the originator node of the NHDP HELLO
        message. When unset indicates the originator of the NHDP HELLO message
        has not selected the relevant address as an MPR.
</p>
<p>bit 1-7: are reserved and SHOULD be set to 0.
</p>
<p>Combinations of value field lengths and # of addresses other than
        specified here are NOT permitted and SHOULD be ignored. All bits,
        excepting the leftmost bit, are RESERVED and SHOULD be set to 0.
</p><br /><hr class="insert" />
<a name="smprAddrTLVExample1"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                  ...              | SMF_NBR_TYPE  |1|1|0|1|0|0|   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     S-MPR     |  start-index  |0|0|0|0|0|0|0|1|M|  reserved   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;9: S-MPR Address Block TLV Example 1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>This single index example TLV indicates that the address specified
        by the &lt;start-index&gt; field is running SMF using S-MPR and has
        been selected by the originator of the NHDP HELLO message as an MPR
        forwarder if the M bit is set. Multivalue TLVs may also be used to
        specify MPR selection status of multiple addresses using only one TLV.
        See <a class='info' href='#ecdsAddrTLVExample2'>Figure&nbsp;7<span> (</span><span class='info'>E-CDS Address Block TLV Example 2</span><span>)</span></a> for an example on how
        this may be done.
</p>
<a name="smprAlgorithm"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.4"></a><h3>B.4.&nbsp;
S-MPR Selection Algorithm</h3>

<p>This section describes a basic algorithm for the S-MPR selection
        process. Note that the selection is with respect to a specific
        interface of the node performing selection and other node interfaces
        referenced are reachable from this reference node interface. This is
        consistent with the S-MPR forwarding rules described above. When
        multiple interfaces per node are used, it is possible to enhance the
        overall selection process across multiple interfaces such that common
        nodes are selected as MPRs for each interface to avoid unnecessary
        inefficiencies in flooding. This is described further in <a class='info' href='#OLSRv2'>[OLSRv2]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;Optimized Link State Routing Protocol version 2,&rdquo; July&nbsp;2009.</span><span>)</span></a>. The following steps describe a basic
        algorithm for conducting S-MPR selection for a node interface
        "n0":
</p>
<p></p>
<ol class="text">
<li>Initialize the set "MPR" to empty.
</li>
<li>Initialize the set "N1" to include all 1-hop neighbors of
            "n0".
</li>
<li>Initialize the set "N2" to include all 2-hop neighbors,
            excluding "n0" and any nodes in "N1". Nodes which are only
            reachable via "N1" nodes with router priority values of NEVER are
            also excluded.
</li>
<li>For each interface "y" in "N1", initialize a set "N2(y)" to
            include any interfaces in "N2" that are 1-hop neighbors of
            "y".
</li>
<li>For each interface "x" in "N1" with a router priority value of
            "ALWAYS" (or using CF relay algorithm), select "x" as a MPR:
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>Add "x" to the set "MPR" and remove "x" from "N1".
</dd>
<dt>B.</dt>
<dd>For each interface "z" in "N2(x)", remove "z" from "N2"
</dd>
<dt>C.</dt>
<dd>For each interface "y" in "N1", remove any interfaces in
                "N2(x)" from "N2(y)"
</dd>
</dl></blockquote>
</li>
<li>For each interface "z" in "N2", initialize the set "N1(z)" to
            include any interfaces in "N1" that are 1-hop neighbors of
            "z".
</li>
<li>For each interface "x" in "N2" where "N1(x)" has only one
            member, select "x" as a MPR:
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>Add "x" to the set "MPR" and remove "x" from "N1".
</dd>
<dt>B.</dt>
<dd>For each interface "z" in "N2(x)", remove "z" from "N2" and
                delete "N1(z)"
</dd>
<dt>C.</dt>
<dd>For each interface "y" in "N1", remove any interfaces in
                "N2(x)" from "N2(y)"
</dd>
</dl></blockquote>
</li>
<li>While "N2" is not empty, select the interface "x" in "N1" with
            the largest router priority which has the number of members in
            "N_2(x)" as a MPR:
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>Add "x" to the set "MPR" and remove "x" from "N1".
</dd>
<dt>B.</dt>
<dd>For each interface "z" in "N2(x)", remove "z" from "N2"
</dd>
<dt>C.</dt>
<dd>For each interface "y" in "N1", remove any interfaces in
                "N2(x)" from "N2(y)"
</dd>
</dl></blockquote>
</li>
</ol>

<p>After the set of nodes "MPR" is selected, node "n_0" must signal
        its selections to its neighbors. With NHDP, this is done by using the
        MPR address block TLV to mark selected neighbor addresses in
        NHDP_HELLO messages. Neighbors MUST record their MPR selection status
        and the previous hop address (e.g., link or MAC layer) of the
        selector. Note these steps are re-evaluated upon neighborhood status
        changes.
</p>
<a name="mprcdsAppendix"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
Multipoint Relay Connected Dominating Set (MPR-CDS) Algorithm</h3>

<p>The MPR-CDS algorithm is an extension to the basic S-MPR election
      algorithm that results in a shared (non source-specific) SMF CDS. Thus
      its forwarding rules are not dependent upon previous hop information
      similar to E-CDS. An overview of the MPR-CDS selection algorithm is
      provided in <a class='info' href='#MPR-CDS'>[MPR&#8209;CDS]<span> (</span><span class='info'>Adjih, C., Jacquet, P., and L. Viennot, &ldquo;Computing Connected Dominating Sets with Multipoint           Relays,&rdquo; January&nbsp;2005.</span><span>)</span></a>.
</p>
<p>It is RECOMMENDED that the SMF_RELAY_ALG message TLV be included in
      NHDP_HELLO messages that are generated by nodes conducting MPR-CDS SMF
      operation.
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.1"></a><h3>C.1.&nbsp;
MPR-CDS Relay Set Selection Overview</h3>

<p>The MPR-CDS relay set selection process is based upon the MPR
        selection process of the S-MPR algorithm with the added refinement of
        a distributed technique for subsequently down-selecting to a common
        reduced, shared relay set. A node ordering (or "prioritization")
        metric is used as part of this down-selection process Like the E-CDS
        algorithm, this metric can be based upon node address or some other
        unique router identifier ("Router ID") as well as an additional
        "Router Priority" measure, if desired. The process for MPR-CDS relay
        selection is as follows:</p>
<ol class="text">
<li>First, MPR selection per the S-MPR algorithm is conducted, with
            selectors informing their MPRs (via NHDP) of their selection.
</li>
<li>Then, the following rules are used on a distributed basis by
            selected nodes to possibly unselect themselves and thus jointly
            establish a common set of shared SMF relays:
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>If a selected node has a larger "RtrPri()" than all of its
                1-hop symmetric neighbors, then it acts as a relay for all
                multicast traffic, regardless of the previous hop
</dd>
<dt>B.</dt>
<dd>Else, if the 1-hop symmetric neighbor with the largest
                "RtrPri()" value has selected the node, then it also acts as a
                relay for all multicast traffic, regardless of the previous
                hop.
</dd>
<dt>C.</dt>
<dd>Otherwise, it unselects itself as a relay and does not
                forward any traffic unless changes occur that require
                re-evaluation of the above steps.
</dd>
</dl></blockquote>
</li>
</ol>

<p>This technique shares many of the desirable properties of the E-CDS
        technique with regards to compatibility with multicast sources not
        participating in NHDP and the opportunity for statically-configure CF
        nodes to be present, regardless of their participation in NHDP.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.2"></a><h3>C.2.&nbsp;
MPR-CDS Forwarding Rules</h3>

<p>The forwarding rules for MPR-CDS are common with those of E-CDS.
        Any SMF node that has selected itself as a relay performs DPD and
        forward all non-duplicative multicast traffic allowed by the present
        forwarding policy. Packet previous hop knowledge is not needed for
        forwarding decisions when using MPR-CDS.
</p>
<p></p>
<ol class="text">
<li>Upon packet reception, DPD is performed. Note MPR-CDS require
            one duplicate table for the set of interfaces associated with the
            relay set selection.
</li>
<li>If the packet is a duplicate, no further action is taken.
</li>
<li>If the packet is non-duplicative:
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>A DPD entry is made for the packet identifier
</dd>
<dt>B.</dt>
<dd>The packet is forwarded out all interfaces associated with
                the relay set selection
</dd>
</dl></blockquote>
</li>
</ol>

<p>As previously mentioned, even packets sourced (or relayed) by nodes
        not participating in NHDP and/or the MPR-CDS relay set selection may
        be forwarded by E-CDS forwarders without problem. A particular
        deployment MAY choose to not forward packets from sources or relays
        that have been explicitly identified via NHDP or other means as
        operating as part of a different relay set algorithm (e.g. S-MPR) to
        allow coexistent deployments to operate correctly. Also, MPR-CDS relay
        set selection may be configured to be influenced by
        statically-configured CF relays that are identified via NHDP or other
        means.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.3"></a><h3>C.3.&nbsp;
MPR-CDS Neighborhood Discovery Requirements</h3>

<p>The neighborhood discovery requirements for MPR-CDS have
        commonality with both the S-MPR and E-CDS algorithms. MPR-CDS
        selection operation requires 2-hop neighbor knowledge as provided by
        the NHDP protocol <a class='info' href='#NHDP'>[NHDP]<span> (</span><span class='info'>Clausen, T. and et al, &ldquo;MANET Neighborhood Discovery Protocol,&rdquo; July&nbsp;2009.</span><span>)</span></a> or from external
        sources. Unlike S-MPR operation, there is no need for associating
        link-layer address information with 1-hop neighbors since MPR-CDS
        forwarding is independent of the previous hop similar to E-CDS
        forwarding.
</p>
<p>To advertise an optional "Router Priority" value or "WILLINGNESS"
        an originating node may use the message TLV of type SMF_TYPE:MPR-CDS
        which shares a common &lt;value&gt; format with both SMF_TYPE:E-CDS
        <a class='info' href='#ecdsMsgTLVValueDef'>Table&nbsp;11<span> (</span><span class='info'>E-CDS Message TLV Values</span><span>)</span></a> and SMF_TYPE:S-MPR <a class='info' href='#smprMsgTLVValueDef'>Table&nbsp;13<span> (</span><span class='info'>S-MPR Message TLV Values</span><span>)</span></a>.
</p>
<p>MPR-CDS only requires 1-hop knowledge of "Router Priority" for
        correct operation. In the S-MPR phase of MPR-CDS selection, MPRs are
        dynamically determined by each node and selections MUST be advertised
        and dynamically updated using NHDP or an equivalent protocol or
        mechanism. Therefore the &lt;value&gt; field of the
        SMF_NBR_TYPE:MPR-CDS type TLV shares a common format with
        SMF_NBR_TYPE:S-MPR <a class='info' href='#smprAddrTLVValueDef'>Table&nbsp;14<span> (</span><span class='info'>E-CDS Address Block TLV Values</span><span>)</span></a> to
        convey MPR selection.
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.4"></a><h3>C.4.&nbsp;
MPR-CDS Selection Algorithm</h3>

<p>This section describes an algorithm for the MPR-CDS selection
        process. Note that the selection described is with respect to a
        specific interface of the node performing selection and other node
        interfaces referenced are reachable from this reference node
        interface. An ordered tuple of "Router Priority" and "Router ID" is
        used in MPR-CDS relay set selection. The "Router ID" value should be
        set to the largest advertised address of a given node, this
        information is provided to one hop neighbors via NHDP by default.
        Precedence is given to the "Router Priority" portion and the "Router
        ID" value is used as a tie-breaker. The evaluation of this tuple is
        referred to as "RtrPri(n)" in the description below where "n"
        references a specific node. Note it is possible that the "Router
        Priority" portion may be optional and the evaluation of "RtrPri()" be
        solely based upon the unique "Router ID". Since there MUST NOT be any
        duplicate address values among SMF nodes, a comparison of RtrPri(n)
        between any two nodes will always be an inequality. The following
        steps, repeated upon any changes detected within the 1-hop and 2-hop
        neighborhood, describe a basic algorithm for conducting MPR-CDS
        selection for a node interface "n0":
</p>
<p></p>
<ol class="text">
<li>Perform steps 1-8 of <a class='info' href='#smprAlgorithm'>Appendix&nbsp;B.4<span> (</span><span class='info'>S-MPR Selection Algorithm</span><span>)</span></a> to
            select MPRs from the set of 1-hop neighbors of "n0" and
            notify/update neighbors of selections.
</li>
<li>Upon being selected as an MPR (or any change in the set of
            nodes selecting "n0" as an MPR):
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>If no neighbors have selected "n0" as an MPR, "n0" does not
                act as a relay and no further steps are taken until a change
                in neighborhood topology or selection status occurs.
</dd>
<dt>B.</dt>
<dd>Determine the node "n1_max" that has the maximum "RtrPri()"
                of all 1-hop neighbors.
</dd>
<dt>C.</dt>
<dd>If "RtrPri(n0)" is greater than "RtrPri(n1_max)", then "n0"
                selects itself as a relay for all multicast packets,
</dd>
<dt>D.</dt>
<dd>Else, if "n1_max" has selected "n0" as an MPR, then "0"
                selects itself as a relay for all multicast packets.
</dd>
<dt>E.</dt>
<dd>Otherwise, "n0" does not act as a relay.
</dd>
</dl></blockquote>
</li>
</ol>

<p>It is possible to extend this algorithm to consider neighboring SMF
        nodes that are known to be statically configured for CF (always
        relaying). The modification to the above algorithm is to process such
        nodes as having a maximum possible "Router Priority" value. This is
        the same as the case for participating nodes that have been configured
        with a S-MPR "WILLINGNESS" value of "WILL_ALWAYS". It is expected that
        nodes configured for CF and participating in NHDP would indicate their
        status with use of the SMF_RELAY_ALG TLV type in their NHDP_HELLO
        message TLV block. It is important to note however that CF nodes will
        not select MPR nodes and therefore cannot guarantee connectedness.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Joseph Macker</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NRL</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Washington, DC  20375</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:macker@itd.nrl.navy.mil">macker@itd.nrl.navy.mil</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">SMF Design Team</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">IETF MANET WG</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:manet@ietf.org">manet@ietf.org</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2009).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
