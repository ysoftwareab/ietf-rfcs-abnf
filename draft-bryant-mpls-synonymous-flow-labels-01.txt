



MPLS                                                           S. Bryant
Internet-Draft                                                G. Swallow
Intended status: Standards Track                            S. Sivabalan
Expires: January 4, 2016                                   Cisco Systems
                                                               G. Mirsky
                                                                Ericsson
                                                                 M. Chen
                                                                   Z. Li
                                                                  Huawei
                                                            July 3, 2015


                     RFC6374 Synonymous Flow Labels
              draft-bryant-mpls-synonymous-flow-labels-01

Abstract

   [Editor's note - there was a comment that synonymous was not the
   right term because synonymous implied a greater degree of
   interchangeability than is actually the case (there is only one way
   interchangeability).  I have looked for other terms, and so far I
   have only come up with enhanced and multi-purpose, but they are not
   quite right either.  I plan to continue with the term unless anyone
   has a better idea.]

   This document describes a method of providing flow identification
   information when making RFC6374 performance measurements.  This
   allows RFC6374 measurements to be made on multi-point to point LSPs
   and allows the measurement of flows within an MPLS construct using
   RFC6374.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on January 4, 2016.




Bryant, et al.           Expires January 4, 2016                [Page 1]

Internet-Draft              Synonymous Labels                  July 2015


Copyright Notice

   Copyright (c) 2015 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Requirements Language . . . . . . . . . . . . . . . . . . . .   3
   3.  Synonymous Flow Labels  . . . . . . . . . . . . . . . . . . .   4
   4.  User Service Traffic in the Data Plane  . . . . . . . . . . .   5
     4.1.  Applications Label Present  . . . . . . . . . . . . . . .   5
       4.1.1.  Setting TTL and the Traffic Class Bits  . . . . . . .   6
     4.2.  Single Label Stack  . . . . . . . . . . . . . . . . . . .   6
       4.2.1.  Setting TTL and the Traffic Class Bits  . . . . . . .   7
     4.3.  Aggregation of SFL Actions  . . . . . . . . . . . . . . .   7
   5.  Equal Cost Multipath Considerations . . . . . . . . . . . . .   8
   6.  RFC6374 Packet Loss Measurement with SFL  . . . . . . . . . .   9
     6.1.  RFC6374 SFL TLV . . . . . . . . . . . . . . . . . . . . .  10
   7.  The Application of SFL to other PM Types  . . . . . . . . . .  12
   8.  Privacy Considerations  . . . . . . . . . . . . . . . . . . .  12
   9.  Security Considerations . . . . . . . . . . . . . . . . . . .  12
   10. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  12
   11. Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  12
   12. References  . . . . . . . . . . . . . . . . . . . . . . . . .  12
     12.1.  Normative References . . . . . . . . . . . . . . . . . .  13
     12.2.  Informative References . . . . . . . . . . . . . . . . .  13
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  13

1.  Introduction

   [I-D.bryant-mpls-flow-ident] describes the requirement for
   introducing flow identities when using RFC6374 [RFC6374] packet Loss
   Measurements (LM).  In summary RFC6374 uses the LM packet as the
   packet accounting demarcation point.  Unfortunately this gives rise
   to a number of problems that may lead to significant packet
   accounting errors in certain situations.  For example:




Bryant, et al.           Expires January 4, 2016                [Page 2]

Internet-Draft              Synonymous Labels                  July 2015


   1.  Where a flow is subjected to Equal Cost Multi-Path (ECMP)
       treatment packets can arrive out of order with respect to the LM
       packet.

   2.  Where a flow is subjected to ECMP treatment, packets can arrive
       at different hardware interfaces, thus requiring reception of an
       LM packet on one interface to trigger a packet accounting action
       on a different interface which may not be co-located with it.
       This is a difficult technical problem to address with the
       required degree of accuracy.

   3.  Even where there is no ECMP (for example on RSVP-TE, MPLS-TP LSPs
       and PWs) local processing may be distributed over a number of
       processor cores, leading to synchronization problems.

   4.  Link aggregation techniques may also lead to synchronization
       issues.

   5.  Some forwarder implementations have a long pipeline between
       processing a packet and incrementing the associated counter again
       leading to synchronization difficulties.

   An approach to mitigating these synchronization issue is described in
   [I-D.tempia-ippm-p3m] and
   [I-D.chen-ippm-coloring-based-ipfpm-framework] in which packets are
   batched by the sender and each batch is marked in some way such that
   adjacent batches can be easily recognized by the receiver.

   An additional problem arises where the LSP is a multi-point to point
   LSP, since MPLS does not include a source address in the packet.
   Network management operations require the measurement of packet loss
   between a source and destination.  It is thus necessary to introduce
   some source specific information into the packet to identify packet
   batches from a specific source.

   This document describes a method of accomplishing this by using a
   technique called Synonymous Flow Labels (SFL) (see (Section 3)) in
   which labels which mimic the behaviour of other labels provide the
   packet batch identifiers and enable the per batch packet accounting.

2.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   [RFC2119].





Bryant, et al.           Expires January 4, 2016                [Page 3]

Internet-Draft              Synonymous Labels                  July 2015


3.  Synonymous Flow Labels

   An SFL is defined to be a label that causes exactly the same
   behaviour at the egress Label Switching Router (LSR) as the label it
   replaces, except that it also causes an additional agreed action to
   take place on the packet.  There are many possible additional actions
   such as the measurement of the number of received packets in a flow,
   triggering IPFIX inspection, triggering other types of Deep Packet
   Inspection, or identification of the packet source.  In, for example,
   a Performance Monitoring (PM) application, the agreed action would be
   the recording of the receipt of the packet by incrementing a packet
   counter.  This is a natural action in many MPLS implementations, and
   where supported this permits the implementation of high quality
   packet loss measurement without any change to the packet forwarding
   system.

   Consider an MPLS application such as a pseudowire (PW), and consider
   that it is desired to use the approach specified in this document to
   make a packet loss measurement.  By some method outside the scope of
   this text, two labels, synonymous with the PW labels are obtained
   from the egress terminating provider edge (T-PE).  By alternating
   between these SLs and using them in place of the PW label, the PW
   packets may be batched for counting without any impact on the PW
   forwarding behaviour (note that strictly only one SL is needed in
   this application, but that is an optimization that is a matter for
   the implementor).

   Now consider an MPLS application that is multi-point to point such as
   a VPN.  Here it is necessary to identify a packet batch from a
   specific source.  This is achieved by making the SLs source specific,
   so that batches from one source are marked differently from batches
   from another source.  The sources all operate independently and
   asynchronously from each other, independently co-ordinating with the
   destination.  Each ingress is thus able to establish its own SFL to
   identify the sub-flow and thus enable PM per flow.

   Finally we need to consider the case where there is no MPLS
   application label such as occurs when sending IP over an LSP.  In
   this case introducing an SL that was synonymous with the LSP label
   would introduce network wide forwarding state.  This would not be
   acceptable for scaling reasons.  We therefore have no choice but to
   introduce an additional label.  Where penultimate hop popping (PHP)
   is in use, the semantics of this additional label can be similar to
   the LSP label.  Where PHP is not in use, the semantics are similar to
   an MPLS explicit NULL.  In both of these cases the label has the
   additional semantics of the SL.





Bryant, et al.           Expires January 4, 2016                [Page 4]

Internet-Draft              Synonymous Labels                  July 2015


   Note that to achieve the goals set out in Section 1 SLs need to be
   allocated from the platform label table.

4.  User Service Traffic in the Data Plane

   As noted in Section 3 it is necessary to consider two cases:

   1.  Applications label present

   2.  Single label stack

4.1.  Applications Label Present

   Figure 1 shows the case in which both an LSP label and an application
   label is present in the MPLS label stack.  Uninstrumented traffic
   runs over the "normal" stack, and instrumented flows run over the SFL
   stack with the SFL used to indicate the packet batch.

     +-----------------+          +-----------------+
     |                 |          |                 |
     |      LSP        |          |      LSP        | <May be PHPed
     |     Label       |          |     Label       |
     +-----------------+          +-----------------+
     |                 |          |                 |
     |  Application    |          | Synonymous Flow |
     |     Label       |          |     Label       |
     +-----------------+          +-----------------+ <= Bottom of stack
     |                 |          |                 |
     |   Payload       |          |   Payload       |
     |                 |          |                 |
     +-----------------+          +-----------------+


    "Normal" Label Stack         Label Stack with SFL



    Figure 1: Use of Synonymous Labels In A Two Label MPLS Label Stack

   At the egress LSR the LSP label is popped (if present).  Then the SFL
   is processed in exactly the same way as the corresponding application
   label would have been processed.  Where the SFL is being used to
   support RFC6374 packet loss measurements, as an additional operation,
   the total number of packets received with this particular SFL is
   recorded.

   Where the number of labels used by a single application is large, and
   the increase in the number of allocated labels needed to support the



Bryant, et al.           Expires January 4, 2016                [Page 5]

Internet-Draft              Synonymous Labels                  July 2015


   SFL actions consequently becomes too large to be viable, it may be
   necessary to introduce an additional label in the stack to act as an
   aggregate instruction.  This situation will be considered in a future
   version of this document.

4.1.1.  Setting TTL and the Traffic Class Bits

   To be provided in a future version of this draft.

4.2.  Single Label Stack

   Figure 2 shows the case in which only an LSP label is present in the
   MPLS label stack.  Uninstrumented traffic runs over the "normal"
   stack and instrumented flows run over the SFL stack with the SFL used
   to indicate the packet batch.  However in this case it is necessary
   for the ingress LSR to first push the SFL and then to push the LSP
   label.

                                  +-----------------+
                                  |                 |
                                  |      LSP        | <= May be PHPed
                                  |     Label       |
     +-----------------+          +-----------------+
     |                 |          |                 | <= Synonymous with
     |      LSP        |          | Synonymous Flow |    Explicit NULL
     |     Label       |          |     Label       |
     +-----------------+          +-----------------+ <= Bottom of stack
     |                 |          |                 |
     |   Payload       |          |   Payload       |
     |                 |          |                 |
     +-----------------+          +-----------------+


    "Normal" Label Stack         Label Stack with SFL



   Figure 2: Use of Synonymous Labels In A Single Label MPLS Label Stack

   At the receiving LSR it is necessary to consider two cases:

   1.  Where the LSP label is still present

   2.  Where the LSP label is penultimate hop popped

   If the LSP label is present, it processed exactly as it would
   normally processed and then it is popped.  This reveals the SFL which
   in the case of RFC6374 measurements is simply counted and then



Bryant, et al.           Expires January 4, 2016                [Page 6]

Internet-Draft              Synonymous Labels                  July 2015


   discarded.  In this respect the processing of the SFL is synonymous
   with an Explicit NULL.  As the SFL is the bottom of stack, the IP
   packet that follows is processed as normal.

   If the LSP label is not present due to PHP action in the upstream
   LSR, two almost equivalent processing actions can take place.  Either
   the SFL can be treated as an LSP label that was not PHPed and the
   additional associated SFL action is taken when the label is
   processed.  Alternatively, it can be treated as an explicit NULL with
   associated SFL actions.  From the perspective of the measurement
   system described in this document the behaviour of two approaches are
   indistinguishable and thus either may be implemented.

4.2.1.  Setting TTL and the Traffic Class Bits

   To be provided in a future version of this draft.

4.3.  Aggregation of SFL Actions

   There are cases where it is desirable to agregate an SFL action
   against a number of labels.  For example where it is desirable to
   have one counter record the number of packets received over a group
   of application labels, or where the number of labels used by a single
   application is large, and consequently the increase in the number of
   allocated labels needed to support the SFL actions consequently
   becomes too large to be viable, In these circumstances it would be
   necessary to introduce an additional label in the stack to act as an
   aggregate instruction.  This is not strictly a synonymous action in
   that the SFL is not replacing a existing label, but is somewhat
   similar to the single label case shown in Section 4.2, and the same
   signalling, management and configuration tools would be applicable.




















Bryant, et al.           Expires January 4, 2016                [Page 7]

Internet-Draft              Synonymous Labels                  July 2015


                                  +-----------------+
                                  |                 |
                                  |      LSP        | < May be PHPed
                                  |     Lable       |
     +-----------------+          +-----------------+
     |                 |          |                 |
     |      LSP        |          |   Agregate      |
     |     Label       |          |      SFL        |
     +-----------------+          +-----------------+
     |                 |          |                 |
     |  Application    |          |  Application    |
     |     Label       |          |     Label       |
     +-----------------+          +-----------------+ <= Bottom of stack
     |                 |          |                 |
     |   Payload       |          |   Payload       |
     |                 |          |                 |
     +-----------------+          +-----------------+


    "Normal" Label Stack         Label Stack with SFL



                      Figure 3: Aggregate SFL Actions

   The Aggregate SFL is shown in the label stack depicted in Figure 3 as
   preceeding the application label, however the choice of position
   before, or after, the application label will be application specific.
   In the case described in Section 4.1, by definition the SFL has the
   full application context.  In this case the positioning will depend
   on whether the SFL action needs the full context of the application
   to perform its action and whether the complexity of the application
   will be increased by finding an SFL following the application label.

   This third SFL case requires further though by the authors and this
   section will be updated in a future version of this draft to reflect
   those thoughts.

5.  Equal Cost Multipath Considerations

   The introduction to an SFL to and existing may cause that flow to
   take a different path through the network under conditions of Equal
   Cost Multipath (ECMP).  This is turn may invalidate the certain uses
   of the SFL such as PM.  Where this is a problem there are two
   solutions worthy of consideration:

   1.  The operator can elect to always run with the SFL in place in the
       MPLS label stack.



Bryant, et al.           Expires January 4, 2016                [Page 8]

Internet-Draft              Synonymous Labels                  July 2015


   2.  The operator can elect to use [RFC6790] Entropy Labels which, in
       a network that fully supports this type of ECMP, results in the
       ECMP decision being independent of the value of the other labels
       in the label stack.

6.  RFC6374 Packet Loss Measurement with SFL

   The packet format of an RFC6374 Query message using SFLs is shown in
   Figure 4.

     +-------------------------------+
     |                               |
     |             LSP               |
     |            Label              |
     +-------------------------------+
     |                               |
     |        Synonymous Flow        |
     |            Label              |
     +-------------------------------+
     |                               |
     |                               |
     |  RFC6374 Measurement Message  |
     |                               |
     |  +-------------------------+  |
     |  |                         |  |
     |  |     RFC6374 Fixed       |  |
     |  |     Header              |  |
     |  |                         |  |
     |  +-------------------------+  |
     |  |                         |  |
     |  |      Optional SFL TLV   |  |
     |  |                         |  |
     |  +-------------------------+  |
     |  |                         |  |
     |  |      Optional Return    |  |
     |  |      Information        |  |
     |  |                         |  |
     |  +-------------------------+  |
     |                               |
     +-------------------------------+

                  Figure 4: RFC6734 Query Packet with SFL

   The MPLS label stack is exactly the same as that used for the user
   data service packets being instrumented (see Section 4).  The RFC6374
   measurement message consists of the three components, the RFC6374
   fixed header as specified in [RFC6374] carried over the ACH channel




Bryant, et al.           Expires January 4, 2016                [Page 9]

Internet-Draft              Synonymous Labels                  July 2015


   type specified the type of measurement being made (currently: loss,
   delay or loss and delay) as specified in RFC6374.

   Two optional TLVs MAY also be carried if needed.  The first is the
   SFL TLV specified in Section 6.1.  This is used to provide the
   implementation with a reminder of the SFL that was used to carry the
   RFC6374 message.  This is needed because a number of MPLS
   implementations do not provide the MPLS label stack to the MPLS OAM
   handler.  This TLV is required if RFC6374 messages are sent over UDP
   (draft-bryant-mpls-RFC6374-over-udp).  This TLV MUST be included
   unless, by some method outside the scope of this document, it is
   known that this information is not needed by the RFC6374 Responder.

   The second set of information that may be needed is the return
   information that allows the responder send the RFC6374 response to
   the Querier.  This is not needed if the response is requested in-band
   and the MPLS construct being measured is a point to point LSP, but
   otherwise MUST be carried.  The return address TLV is defined in
   RFC6378 and the optional UDP Return Object is defined in
   [I-D.ietf-mpls-rfc6374-udp-return-path].

6.1.  RFC6374 SFL TLV

   [Editor's Note we need to review the following in the light of
   further thoughts on the associated signaling protocol(s).  I am
   fairly confident that we need all the fields other than SFL Batch and
   SFL Index.  The Index is useful in order to map between the label and
   information associated with the FEC.  The batch is part of the
   lifetime management process]

   The required RFC6374 SFL TLV is shown in Figure 5.  This contains the
   SFL that was carried in the label stack, the FEC that was used to
   allocate the SFL and the index into the batch of SLs that were
   allocated for the FEC that corresponds to this SFL.

















Bryant, et al.           Expires January 4, 2016               [Page 10]

Internet-Draft              Synonymous Labels                  July 2015


        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |    Type       |    Length     |MBZ| SFL Batch |    SFL Index  |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                 SFL                   |        Reserved       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                 FEC                                           |
       .                                                               .
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+



                             Figure 5: SFL TLV

   Where:

   Type           Type is set to Synonymous Flow Label (SFL-TLV).

   Length         The length of the TLV as specified in [RFC6374].

   MBZ            MUST be sent as zero and ignored on receive.

   SFL Batch      The SFL batch that this SFL was allocated as part of
                  (see draft-bryant-mpls-sfl-control)

   SPL Index      The index into the list of SFLs that were assigned
                  against the FEC that corresponds to the SFL.

   SFL            The SFL used to deliver this packet.  This is an MPLS
                  label which is a component of a label stack entry as
                  defined in Section 2.1 of [RFC3032].

   Reserved       MUST be sent as zero and ignored on receive.

   FEC            The Forwarding Equivalence Class that was used to
                  request this SFL.  This is encoded as per
                  Section 3.4.1 of

   This information is needed to allow for operation with hardware that
   discards the MPLS label stack before passing the remainder of the
   stack to the OAM handler.  By providing both the SFL and the FEC plus
   index into the array of allocated SFLs a number of implementation
   types are supported.







Bryant, et al.           Expires January 4, 2016               [Page 11]

Internet-Draft              Synonymous Labels                  July 2015


7.  The Application of SFL to other PM Types

   SFL can be used to enable other types of PM in addition to loss.
   Delay, Delay Variation and Throughput may be calculated based on
   measurement results collected through Loss and Delay Measurement test
   sessions.  Further details will be provided in a future version of
   this draft.

8.  Privacy Considerations

   The inclusion of originating and/or flow information in a packet
   provides more identity information and hence potentially degrades the
   privacy of the communication.  Whilst the inclusion of the additional
   granularity does allow greater insight into the flow characteristics
   it does not specifically identify which node originated the packet
   other than by inspection of the network at the point of ingress, or
   inspection of the control protocol packets.  This privacy threat may
   be mitigated by encrypting the control protocol packets, regularly
   changing the synonymous labels and by concurrently using a number of
   such labels.

9.  Security Considerations

   The issue noted in Section 8 is a security consideration.  There are
   no other new security issues associated with the MPLS dataplane.  Any
   control protocol used to request SFLs will need to ensure the
   legitimacy of the request.

10.  IANA Considerations

   IANA is request to allocate a new TLV from the 0-127 range on the
   MPLS Loss/Delay Measurement TLV Object Registry:

      Type Description                       Reference
      ---- --------------------------------- ---------
      TBD  Synonymous Flow Label             This

   A value of 4 is recommended.

11.  Acknowledgements

   TBD

12.  References







Bryant, et al.           Expires January 4, 2016               [Page 12]

Internet-Draft              Synonymous Labels                  July 2015


12.1.  Normative References

   [I-D.ietf-mpls-rfc6374-udp-return-path]
              Bryant, S., Sivabalan, S., and S. Soni, "RFC6374 UDP
              Return Path", draft-ietf-mpls-rfc6374-udp-return-path-03
              (work in progress), April 2015.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC3032]  Rosen, E., Tappan, D., Fedorkow, G., Rekhter, Y.,
              Farinacci, D., Li, T., and A. Conta, "MPLS Label Stack
              Encoding", RFC 3032, January 2001.

12.2.  Informative References

   [I-D.bryant-mpls-flow-ident]
              Bryant, S., Pignataro, C., Chen, M., Li, Z., and G.
              Mirsky, "MPLS Flow Identification", draft-bryant-mpls-
              flow-ident-01 (work in progress), March 2015.

   [I-D.chen-ippm-coloring-based-ipfpm-framework]
              Chen, M., Zheng, L., Mirsky, G., and G. Fioccola, "IP Flow
              Performance Measurement Framework", draft-chen-ippm-
              coloring-based-ipfpm-framework-03 (work in progress),
              February 2015.

   [I-D.tempia-ippm-p3m]
              Capello, A., Cociglio, M., Fioccola, G., Castaldelli, L.,
              and A. Bonda, "A packet based method for passive
              performance monitoring", draft-tempia-ippm-p3m-00 (work in
              progress), March 2015.

   [RFC6374]  Frost, D. and S. Bryant, "Packet Loss and Delay
              Measurement for MPLS Networks", RFC 6374, September 2011.

   [RFC6790]  Kompella, K., Drake, J., Amante, S., Henderickx, W., and
              L. Yong, "The Use of Entropy Labels in MPLS Forwarding",
              RFC 6790, November 2012.

Authors' Addresses

   Stewart Bryant
   Cisco Systems

   Email: stbryant@cisco.com





Bryant, et al.           Expires January 4, 2016               [Page 13]

Internet-Draft              Synonymous Labels                  July 2015


   George Swallow
   Cisco Systems

   Email: swallow@cisco.com


   Siva Sivabalan
   Cisco Systems

   Email: msiva@cisco.com


   Greg Mirsky
   Ericsson

   Email: gregory.mirsky@ericsson.com


   Mach(Guoyi) Chen
   Huawei

   Email: mach.chen@huawei.com


   Zhenbin(Robin)  Li
   Huawei

   Email: lizhenbin@huawei.com























Bryant, et al.           Expires January 4, 2016               [Page 14]
