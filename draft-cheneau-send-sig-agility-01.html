<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Signature Algorithm Agility in the Secure Neighbor Discovery (SEND) Protocol</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Signature Algorithm Agility in the Secure Neighbor Discovery (SEND) Protocol">
<meta name="keywords" content="CGA, RSA, ECDSA">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">CGA &amp; SEND maintenance</td><td class="header">T. Cheneau</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">M. Maknavicius</td></tr>
<tr><td class="header">Updates: <a href='http://tools.ietf.org/html/rfcRFC3971'>RFC3971</a></td><td class="header">TMSP</td></tr>
<tr><td class="header">(if&nbsp;approved)</td><td class="header">S. Shen</td></tr>
<tr><td class="header">Expires: December 7, 2009</td><td class="header">Huawei</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">M. Vanderveen</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Qualcomm</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">June 05, 2009</td></tr>
</table></td></tr></table>
<h1><br />Signature Algorithm Agility in the Secure Neighbor Discovery (SEND) Protocol<br />draft-cheneau-send-sig-agility-01</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on December 7, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This draft describes a mechanism to enable the Secure Neighbor Discovery (SEND) protocol to select
				between different signature algorithms to use with Cryptographically Generated Addresses (CGA). 
				It also provides optional support for interoperability between nodes that do not share any 
				common signature algorithms.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#sec-intro">1.</a>&nbsp;
Introduction<br />
<a href="#sec-problem-overview">2.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">2.1.</a>&nbsp;
Compatibility with existing specifications<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">2.1.1.</a>&nbsp;
Classification of SEND nodes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.2.</a>&nbsp;
Principal Scenarios<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.2.</a>&nbsp;
Agility Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.3.</a>&nbsp;
Mechanism for Agility Support of CGA and SEND<br />
<a href="#sec-pki_opt">3.</a>&nbsp;
Supported Signature Algorithm Option<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.1.</a>&nbsp;
Neighbor Cache interactions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.2.</a>&nbsp;
Processing Rules for Senders<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.3.</a>&nbsp;
Processing Rules for Receivers<br />
<a href="#Univ-Sig-Option">4.</a>&nbsp;
SEND Universal Signature Option<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.1.</a>&nbsp;
Processing Rules for Senders<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">4.2.</a>&nbsp;
Processing Rules for Receivers<br />
<a href="#anchor11">5.</a>&nbsp;
Basic negotiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-nego-overview">5.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.2.</a>&nbsp;
Sending Unsolicited Messages<br />
<a href="#notary">6.</a>&nbsp;
Router-as-a-notary function<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">6.1.</a>&nbsp;
Signature Check Request Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">6.2.</a>&nbsp;
Signature Status Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">6.3.</a>&nbsp;
Using notary for DAD procedure<br />
<a href="#secc">7.</a>&nbsp;
Security Considerations<br />
<a href="#sec-iana">8.</a>&nbsp;
IANA Considerations<br />
<a href="#ack">9.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#key_sizes">Appendix&nbsp;A.</a>&nbsp;
On the number of Public Keys supported per CGA<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="sec-intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> The usage scenarios associated with neighbor discovery have recently been
				extended to include environments with mobile or nomadic nodes. 
				Many of these nodes have limited battery power and computing resources. Therefore, heavy public key signing
				algorithms like RSA are not feasible to support on such constrained nodes.  Fortunately, more lightweight
				yet secure signing algorithms do exist and have been standardized, e.g. Elliptic Curve based algorithms.
</p>
<p>It is then a worthwhile goal to extend secure neighbor discovery to support signing and corresponding hashing 
				algorithm agility. Besides 
				accommodating power-constrained nodes, signing and hashing algorithm agility is also desired as a safety measure
				over time, to offer alternatives when cryptanalysis of one type of algorithm makes significant progress.
			  
			
</p>
<p>The aim of this memo is to outline options for allowing public key signing algorithm and hashing algorithm 
				agility for nodes configured to perform secure neighbor discovery operations.
				The extent to which these options impact existing specifications <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a> and
				<a class='info' href='#RFC3972'>[RFC3972]<span> (</span><span class='info'>Aura, T., &ldquo;Cryptographically Generated Addresses (CGA),&rdquo; March&nbsp;2005.</span><span>)</span></a> is also addressed.
</p>
<a name="sec-problem-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Overview</h3>

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Compatibility with existing specifications</h3>

<p>	The current SEND protocol specification, <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a>, mandates the use of the RSA signature algorithm. 
				Since the time of its writing, different signature algorithms have been shown to be secure and have been 
				adopted by other protocols in an effort to reduce key length, signature generation and verification time, and 
				increase security level.

				This shift in signature algorithm adoption particularly benefits  lightweight devices, which are 
				power and memory-limited but in need of secure signing algorithms support. For these reasons, we feel that 
				the restriction on the signature algorithm for SEND is no longer warranted.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.1"></a><h3>2.1.1.&nbsp;
Classification of SEND nodes</h3>

<p>At the time of this writing, there are no known large-scale or even small-scale deployments of <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a>-compatible devices.
				However, in the interest of caution, we assume that there exist nodes that support only the RSA algorithm and that are configured
				to perform secure neighbor discovery. Such nodes may not be updated in the near term or for the foreseeable future.
				On the other hand, it appears that there will be deployments of nodes that support only Elliptic Curve Cryptography as their
				public key algorithm, i.e. ECDSA as a signature algorithm, rather than traditional RSA. 
</p>
<p> To ensure that all possible network/link configurations are considered when designing a signature agility solution, 
				we categorize nodes (hosts and routers) according to their support for different signature algorithms, as follows: 
				</p>
<blockquote class="text"><dl>
<dt>Type H1 host:</dt>
<dd> <br />
 A host that only supports one type of  signature algorithm and has a CGA generated 
										with the public key of this algorithm.  
</dd>
<dt></dt>
<dd>Examples of this type of hosts: an old host that does not support signature agility, 
											 i.e. only supports RSA signature algorithm; or, a host that only supports ECDSA signature.
</dd>
<dt>Type H2 host:</dt>
<dd> <br />
 A host that supports multiple signature algorithms and has a CGA generated with 
						only one key selected from among its supported algorithms.
</dd>
<dt></dt>
<dd>Examples of this type of hosts: (1) a host that supports RSA and ECDSA signature algorithms, 
										but only has a CGA derived with an RSA public key; (2) a host that supports RSA and ECDSA signature algorithms, 
										but only has a CGA derived with an ECC public key. 
</dd>
<dt>Type H3 host:</dt>
<dd> <br />
A host that supports multiple signature algorithms and has a CGA generated with 
										multiple keys of different supported algorithms.
</dd>
<dt></dt>
<dd>Such CGA generation is made possible by the introduction of a new  CGA extension (see companion
											draft <a class='info' href='#cheneau-cga-pk-agility'>[cheneau&#8209;cga&#8209;pk&#8209;agility]<span> (</span><span class='info'>Cheneau, T., Laurent-Maknavicius, M., Shen, S., and M. Vanderveen, &ldquo;Support for Multiple Signature Algorithms in Cryptographically Generated  						Addresses (CGAs),&rdquo; June&nbsp;2009.</span><span>)</span></a>). Such hosts can be compatible with hosts of other types  for
										secure neighbor discovery.
</dd>
<dt>Type H4 host:</dt>
<dd> <br />
 A host that supports multiple signature algorithms and has multiple CGAs, each of which is  
										 associated with a single key of one supported algorithm.  For simplicity,
										we do not consider hosts that have multiple CGAs, one or more of which are generated from multiple public
										keys. 
</dd>
<dt></dt>
<dd> A node MUST select and settle on one CGA when building a trust relationship with another device via SeND (more 
											below). In such cases, a destination node may be reached at a CGA associated with a signature algorithm 
											that the originating node cannot verify.  The destination node will need to securely redirect the originating node 
											to one of its other CGA(s) (presumably with a common signature algorithm). The need for a method to secure 
											the binding between the two CGAs of the destination node  is still an open problem.
</dd>
<dt></dt>
<dd>Based on this reasoning, consideration of H4 type nodes is left for future work. 
</dd>
</dl></blockquote>

<p>Routers are more likely to possess 
					the resources necessary to support multiple signature and hashing algorithms. It is also more feasible
					that routers employ certificates. However, for a basic signature agility solution, we do not mandate that 
					routers support multiple signature and hashing algorithms. 
</p>
<p>Possible router devices with different signature algorithm support ability are: 
				</p>
<blockquote class="text"><dl>
<dt>Type R1 router:</dt>
<dd> <br />
A router that only supports one type of signature algorithm and has a CGA and Certificate with 
						a public key of this algorithm.  
</dd>
<dt></dt>
<dd>Such routers are expected to be commonplace, as compliance with <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a> suffices for them. 
</dd>
<dt>Type R2 router:</dt>
<dd> <br />
 A router that supports multiple types of signature algorithms and has one CGA and Certificate with 
										a public key of one of the algorithm types.  
</dd>
<dt></dt>
<dd>This type of router can sign and verify signatures of the type of certificate it owns, and additionally, 
										 it can verify signatures of other algorithm types. 
</dd>
<dt>Type R3 router:</dt>
<dd><br />
A router that supports multiple types of signature algorithms
						and has one CGA composed of multiple Publics Keys and multiple certificates containing each a Public Key.
</dd>
<dt>Type R4 router:</dt>
<dd> <br />
A router that supports multiple types of signature algorithms and has multiple CGAs 
										and Certificates with public key of several different algorithm types.  
</dd>
<dt></dt>
<dd>This type of router can sign and verify signatures of multiple types. Such routers may not be attractive to 
											build and deploy due to increased requirements on its resources. Moreover using multiple CGAs (with no bindings) 
											may make that routers appear as having multiple identities.
</dd>
</dl></blockquote><p>
				
</p>
<p>Note that all types of router presented above can be configured to use SEND over multiple interfaces or to have multiple addresses on the same interface. In this case, the router will use separate CGAs. Such configuration is treated in this draft as if the different addresses refer to separate entities.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.2"></a><h3>2.1.2.&nbsp;
Principal Scenarios</h3>

<p>Based on the discussion above, a SEND agility solution should at least properly deal with the communication between devices of type H1, H2, H3, R1, R2 and R3.
</p>
<p> </p>
<blockquote class="text">
<p>An H1 or R1 node interacting with an H2 or R2 node: i.e., a node supporting only RSA (for example, 
					an old non-agility node which only supports RFC3971) and a node supporting 
					both RSA and ECDSA (or other new algorithms). These two nodes may  be able to perform secure neighbor discovery.
</p>
<p>An H1 or R1 node interacting with another H1 or R1 node, but their algorithms differ: e.g., a node supporting only 
					RSA (for example, an old non-agility node which only supports RFC3971) and a node supporting only 
					ECDSA (or other new algorithms). In this case, implementations supporting SEND signature agility solution 
					may likely realize the incompatibility, while older implementations may not. 
</p>
<p>A node of any type (H1, H2, H3, R1, R2, R3) interacting with another node, their algorithms differ but there is a 3rd party willing/able to help: 
					this is an optional solution applicable to the previous scenario, where two nodes that support SEND but do not have any 
					signature algorithms in common can talk through a third party (router). In this case they should be able to 
					perform facilitated secure neighbor discovery.
</p>
<p>An H2, H3 or R2 node interacting with another H2, H3, or R2 node: e.g., two nodes that support at least one signature algorithms 
					in common will be able to perform secure neighbor discovery.
</p>
<p>An additional rule for  H2, H3 or R2, R3 node interacting with another H2, H3, or R2, R3 node applies: two nodes that support two or more signature algorithms 
					in common (one of which is likely preferred over the other), will be able to perform secure neighbor discovery with any of these signature algorithms.
</p>
</blockquote>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Agility Requirements</h3>

<p>We hold the following to be requirements on a signing algorithm agility solution for SEND: 
</p>
<p> </p>
<ul class="text">
<li>A Signature-Algorithm-Agility-Node should be able to communicate with a Non-Signature-Algorithm-Agility-Node, 
					but not necessarily employ SEND. Traditional ND should suffice, to accommodate nodes that only support 
					one type of Signature Algorithm, which may not be RSA. Local policy MAY disable this behavior, namely
					the use of unsecured ND messages when communicating with a node that does not share any common signature
					algorithm.
</li>
<li>Two Signature-Algorithm-Agility nodes that support a common Signature Algorithm and hashing algorithm 
					should be able to communicate 
					using  SEND and sign messages using the common Signature Algorithm and hash algorithm.
</li>
<li>The current SEND/CGA specifications should incur as few changes as possible.
</li>
</ul><p> 
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Mechanism for Agility Support of CGA and SEND</h3>

<p>To achieve signature agility for SEND, it must be possible for a CGA to be generated from and to be securely associated with 
				multiple public keys corresponding to different signature algorithms. This capability is described in the companion 
				draft <a class='info' href='#cheneau-cga-pk-agility'>[cheneau&#8209;cga&#8209;pk&#8209;agility]<span> (</span><span class='info'>Cheneau, T., Laurent-Maknavicius, M., Shen, S., and M. Vanderveen, &ldquo;Support for Multiple Signature Algorithms in Cryptographically Generated  						Addresses (CGAs),&rdquo; June&nbsp;2009.</span><span>)</span></a>. 
</p>
<p>This document  proposes an update to  <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a>  to allow two SEND nodes to choose an appropriate signature algorithm. 
			This solution encompasses the following:
			</p>
<ul class="text">
<li>A "Supported Signature Algorithm" Neighbor Discovery Protocol option which contains a list of
   					signing and hashing algorithms that the sender node supports for SEND purposes and its interaction with the Neighbor Cache; 
</li>
<li>A modification of the "RSA Signature" option defined in the SEND specification;
</li>
<li>An optional solution to support secure communication through a router acting as a third party when nodes 
					don't share any common Signature Algorithm.
</li>
</ul>

<p> We define the aforementioned options format and provide processing rules for both senders 
				and receivers of SEND messages employing the new options, as well as example negotiation message flows.
</p>
<a name="sec-pki_opt"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Supported Signature Algorithm Option</h3>

<p> The Supported Signature Algorithm NDP option contains a list of signing and hashing algorithm pairs
				that the sender node supports.  The format of this option is described in
				<a class='info' href='#fig-supp_PKI'>Figure&nbsp;1<span> (</span><span class='info'>Supported Signature Algorithm option</span><span>)</span></a>:
</p><br /><hr class="insert" />
<a name="fig-supp_PKI"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |    Length     |           Reserved            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Sig. Alg. 1   | Sig. Alg. 2   |  Sig. Alg 3.  | Sig. Alg 4.   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                                                               ~
|                          ...                                  |
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     ...      | Sig. Alg. N  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Supported Signature Algorithm option&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
				</p>
<blockquote class="text"><dl>
<dt>Type</dt>
<dd> <br />
 NDP option type, TBA. See <a class='info' href='#sec-iana'>Section&nbsp;8<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>.
</dd>
<dt>Length</dt>
<dd><br />
 The length of the option 
						
						(including the Type, Length fields), in octets.  8-bit unsigned integer,  the values lower that 2 are invalid.
</dd>
<dt>Reserved</dt>
<dd><br />
 Reserved for future use. This 16-bit field  MUST be set 
						to zero by the sender, and MUST be ignored by the receiver.
</dd>
<dt>Signature Algorithm</dt>
<dd><br />

						A one-octet long field indicating a signature algorithm and the corresponding hash algorithm that 
						this node supports; this support implies at least ability to verify signatures of this PK algorithm.
						
						<br />
<br />

						The first leftmost bit, bit 0, if set to 0, indicates that the emitter is able to perform signature checks only (i.e. no signature 
						generation with this type of signature algorithm).
						If this bit is set to 1, it indicates that the emitter has a public key of this type and can generate signatures.
						Bit 1 and 2 are reserved.
						Bit 3 to 7 are named  Signature Type Identifier subfield and encode an identifier for the signature algorithm and corresponding hash algorithm.
						Default values for the Signature Type Identifier subfield defined in this document are taken in part from the IANA-defined numbers
						for the IKEv2 protocol, i.e. IANA registry named "IKEv2 Authentication Method":
						


						
<ul class="text">
<li>Value 0 is RSA/SHA-1
</li>
<li>Value 1 is RSA/SHA-256
</li>
<li>Value 9 is ECDSA with SHA-256 on the P-256 curve
</li>
<li>Value 10 is ECDSA with SHA-384 on the P-384 curve
</li>
<li>Value 11 is ECDSA with SHA-512 on the P-521 curve
</li>
</ul>
						The Signature/hash Algorithm combinations SHOULD be included in order of preference.
					
</dd>
<dt></dt>
<dd>
						A SSA option MAY be built to respect a Local Policy. 
						However, the SSA option MUST not indicate Signature Algorithm(s) that the emitting node's CGA does not support
						and MUST contain at least one Signature Algorithm with the first bit on (i.e. this Signature Algorithm is available for signature generation).
					
</dd>
</dl></blockquote><p>
			
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Neighbor Cache interactions</h3>

<p>
					Neighbor Cache MUST have the ability to store Supported Signature Algorithm information for each entry (i.e. IPv6 address).
					Supported Signature Algorithm information for an entry MAY be empty (e.g. entry created by a RFC 3971 node or an unverifiable message).
				
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Processing Rules for Senders</h3>

<p>If a node has been configured to use SEND, then all Neighbor Solicitation,
					Neighbor Advertisement, Router Solicitation, Router Advertisement, and Redirect messages
					it sends MUST contain the Supported Signature Algorithm option.  
					This option MUST contain in the Signing Algorithm field all the
					signature algorithms it is willing to use in signature generation and verification. 
				
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Processing Rules for Receivers</h3>

<p>Upon receiving a SEND packet with a Supported Signature Algorithm Option, a receiver performs the following operations:
					</p>
<ul class="text">
<li>
							when the message is a  Neighbor Solicitation or a Router Solicitation, the receiving node  
							computes the intersection between the set of Supported Signature Algorithm indicated 
							by the option and its own. If the set is empty, this means the node will not be able to use a 
							Signature Algorithm that the initiating node can check. Given the local policy, 
							a receiver node MAY still respond to the received message using its "preferred" Signature 
							Algorithm (even if the node knows the receiver will not be able to verify the Signature Algorithm). 
							If the set is not empty, the receiving node will choose among the set one of the algorithms 
							in order to generate a Universal Signature Option. 
						
</li>
<li>
							If the message pass the SEND verifications (CGA verification, Timestamp, Nonce, Universal Signature Option verification) and contains a Supported Signature Algorithm Option, 
							the information of the Supported Signature Algorithm in the Neighbor Cache is updated by the information contained in the 
							Supported Signature Option attached to the message.
						
</li>
<li>
							If the message does not pass the SEND verifications because of a unverifiable RSA Signature Option or Universal Signature Option, if it contains a Supported Signature Algorithm Option,
							and the Neighbor Cache entry associated to that node does not contain any information about the Supported Signature Algorithm, the Neighbor Cache
							entry SHOULD be updated with the information contained in the Supported Signature Algorithm Option.
						
</li>
</ul><p>
				
</p>
<a name="Univ-Sig-Option"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
SEND Universal Signature Option</h3>

<p>We propose replacing the RSA Signature Option by a new algorithm-independent signature option. 
				The "Universal Signature Option" is an updated version of the RSA Signature Option, that allows a node to 
				specify which of its potential multiple keys it is using. 
				To achieve this, we use the 16-bit reserved field of the RSA Signature Option, and define a new 8-bit
				 field that contains the position of the Public Key associated with the signature and a new 5-bit Signature 
				Type Identifier field that details the type of algorithms used to generate the Digital Signature.
			
</p><br /><hr class="insert" />
<a name="sig-opt-format"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |    Length     | Key Position  | Res.|  Sig ID |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                          Key Hash                             |
   |                                                               |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   .                                                               .
   .                       Digital Signature                       .
   .                                                               .
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   .                                                               .
   .                           Padding                             .
   .                                                               .
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Universal Signature Option format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
			</p>
<blockquote class="text"><dl>
<dt>Type</dt>
<dd><br />

					Same value as in <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a>: 12.
				
</dd>
<dt>Length</dt>
<dd><br />

					The length of the option (including the Type, Length, Reserved,
					Key Hash, Digital Signature, and Padding fields) in units of 8
					octets.
				
</dd>
<dt>Key Position</dt>
<dd><br />

					An 8-bit field indicating which Public Key in the CGA parameter structure (carried in the 
					CGA option) has been used to compute the Digital Signature. The index starts at 0, meaning
					the key is the one in the	Public Key field. Values greater than 1 refer to Public Key found in the CGA Extension field 
					(as defined in the companion document <a class='info' href='#cheneau-cga-pk-agility'>[cheneau&#8209;cga&#8209;pk&#8209;agility]<span> (</span><span class='info'>Cheneau, T., Laurent-Maknavicius, M., Shen, S., and M. Vanderveen, &ldquo;Support for Multiple Signature Algorithms in Cryptographically Generated  						Addresses (CGAs),&rdquo; June&nbsp;2009.</span><span>)</span></a>]).
					
					Value 255 is a reserved value that indicates no CGA option in the message contains the Public Key.
					
				
</dd>
<dt>Reserved</dt>
<dd><br />

					A 3-bit field reserved for future use.  The value MUST be
					set to zero by the sender and MUST be ignored by the
					receiver.
				
</dd>
<dt>Signature Type Identifier</dt>
<dd><br />

					Signature Type Identifier is a 5-bit field. It corresponds to the Signature Type Identifier subfield (bits 3 to 7 of the Signature Algorithm field)
					in the Supported Signature Algorithm option . It indicates the type of signature contained in the Digital Signature field.
				
</dd>
<dt>Key Hash</dt>
<dd><br />

					
					
					A 128-bit field containing the most significant (leftmost) 128 bits of a hash of the public key used for constructing the signature.
					It is computed using the same hash function as used in generating digital signature 
					(indicated in Signature Type Identifier). 
					
					The hash value is computed over the presentation used in the Public Key field of the CGA Parameters
					data structure carried in the CGA option. Its purpose is to
					associate the signature with a particular key known by the
					receiver.  Such a key can either be stored in the certificate
					cache of the receiver or be received in the CGA option in the same
					message.
 


				
</dd>
<dt>Digital Signature</dt>
<dd><br />

					A variable-length field containing a signature constructed by using the sender's private key associated to 
					the public key pointed by the Key Position field. The signature type is determined from the value of the Signature Type Identifier field.

					If the value of the Signature Type Identifier field is 0, then the Key Position field must be set to 0 and this Digital 
					Signature field is computed the same way as
					the Digital Signature field of the RSA Signature Option described in <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a>.

					
					If the value of the Signature Type Identifier field is 1, then this Digital Signature field is computed the same way 
					as the Digital Signature field of the RSA Signature Option described in <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a> except that the 
					signature is computed with the RSASSA-PKCS1-v1_5 algorithm as defined in <a class='info' href='#PKCS1'>[PKCS1]<span> (</span><span class='info'>RSA Laboratories, &ldquo;RSA Encryption Standard, Version 2.1,&rdquo; November&nbsp;2002.</span><span>)</span></a> and hash function is SHA-256.
					

					
					If the value of the Signature Type Identifier field is 9, 10 or 11, then this Digital Signature field is computed using the 
					ECDSA signature algorithm (as defined on <a class='info' href='#SEC1'>[SEC1]<span> (</span><span class='info'>Standards for Efficient Cryptography Group, &ldquo;SEC 1: Elliptic Curve Cryptography,&rdquo; September&nbsp;2000.</span><span>)</span></a>) and hash function defined in Signature Type Identifier
					 
					on the following data:
					
<ol class="text">
<li>The 128-bit CGA Message Type tag <a class='info' href='#RFC3972'>[RFC3972]<span> (</span><span class='info'>Aura, T., &ldquo;Cryptographically Generated Addresses (CGA),&rdquo; March&nbsp;2005.</span><span>)</span></a> value for SEND, 0x086F
						CA5E 10B2 00C9 9C8C E001 6427 7C08.  (The tag value has been
						generated randomly by the editor of the <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a> specification.).
</li>
<li>The 128-bit Source Address field from the IP header.
</li>
<li>The 128-bit Destination Address field from the IP header.
</li>
<li>The 8-bit Type, 8-bit Code, and 16-bit Checksum fields from the
						ICMP header.
</li>
<li>The NDP message header, starting from the octet after the ICMP
						Checksum field and continuing up to but not including NDP
						options.
</li>
<li>All NDP options preceding, but not including, any of the Universal Signature options.
</li>
</ol>
					This field starts after the Key Hash field.  The length of the
					Digital Signature field is determined by the length of the Universal
					Signature option minus the length of the other fields (including
					the variable length Pad field).

					
				
</dd>
<dt>Padding</dt>
<dd>
					This variable-length field contains padding, as many bytes long as
					remain after the end of the signature.
				
</dd>
</dl></blockquote><p>
		
</p>
<p>
			A Neighbor Solicitation/Advertisement, 	Router Solicitation/Advertisement and Redirect message 
			MAY contain more than one Universal Signature Option, as long as it does not  exceed the MTU.
			This is particularly useful for routers operating in  heterogeneous networks,
			where hosts have a disjoint set of supported signature algorithms. For information on how to compute the message size, see <a class='info' href='#key_sizes'>Appendix&nbsp;A<span> (</span><span class='info'>On the number of Public Keys supported per CGA</span><span>)</span></a>.
		
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Processing Rules for Senders</h3>

<p>When sending a SEND message spontaneously, an emitter node CAN choose a signature algorithm of its 
				preference (defined by its local policy) among the corresponding Public Keys carried in the CGA option. Using this signature 
				algorithm, the node  computes the Digital Signature and fills the Key Position field with the position
				 of the key in the CGA parameter data structure.
</p>
<p>If the node has been configured to use SEND, then all Neighbor Solicitation,
			Neighbor Advertisement, Router Advertisement, and Redirect messages
			MUST contain at least one Universal Signature option.  Router Solicitation messages
			not sent with the unspecified source address MUST contain the Universal
			Signature option.
</p>
<p>A node sending a message with one or more Universal Signature option(s) MUST construct
			the message as follows:

				</p>
<ul class="text">
<li> If the node has previously received hints (e.g. a NDP message with a Supported Signature Algorithm 
					option or an entry in the Neighbor Cache) on the type of Signature Algorithm it should use, it MUST restrict
					 its choice on those Signature Algorithms.
					
</li>
<li>The message is then constructed in its entirety, without any of the Universal
						Signature options.
</li>
<li>The Universal Signature option(s) is (are) added as the last option in the
						message.
</li>
<li>The data to be signed is constructed as explained in <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a>,
						under the description of the Digital Signature field.
</li>
<li>The message, in the form defined above, is signed by using the
						configured private key associated to the selected Signature Algorithm, and the result
						  signature is
						is encapsulated into the Digital Signature field.
						
						
						

					
</li>
</ul><p>
			
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Processing Rules for Receivers</h3>

<p>Neighbor Solicitation, Neighbor Advertisement, Router Advertisement,
				and Redirect messages without any Universal Signature option or
				with an unverifiable Universal Signature option MUST be
				treated as unsecured (i.e., processed in the same way as NDP messages
				sent by a non-SEND node). See Section 8 of <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a>.
</p>
<p>Router Solicitation messages without any Universal Signature option MUST
				also be treated as unsecured, unless the source address of the
				message is the unspecified address.
</p>
<p>Redirect, Neighbor Solicitation, Neighbor Advertisement, Router
				Solicitation, and Router Advertisement messages containing one or more Universal
				Signature option MUST be checked as follows:
				</p>
<ul class="text">
<li>The receiver MUST ignore any options that come after the first Universal
						Signature option.  (The options are ignored for both signature
						verification and NDP processing purposes.)
</li>
<li>The Key Hash field MUST correspond to a known public key,
						either one learned from the CGA option in the same message by the position indicated in the Key Position field
						message, or one known by other means.
</li>
<li>The Digital Signature field MUST have correct encoding and MUST
						not exceed the length of the Universal Signature option minus the
						Padding.
</li>
<li>The Digital Signature verification MUST show that the signature
						has been calculated as specified in the previous section.
</li>
<li>If the use of a trust anchor has been configured, a valid
						certification path (see Section 6.3 of <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a>) between the receiver's trust
						anchor and the sender's public key MUST be known.
</li>
</ul><p>
			
</p>
<p>Messages that do not pass all the above tests MUST be silently
			discarded if the host has been configured to accept only secured ND
			messages.  The messages MAY be accepted if the host has been
			configured to accept both secured and unsecured messages but MUST be
			treated as unsecured messages.  The receiver MAY also otherwise
			silently discard packets (e.g., as a response to an apparent CPU
			exhausting DoS attack).
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Basic negotiation</h3>

<a name="sec-nego-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Overview</h3>

<p>This section describes different configuration of SEND-enabled nodes with varying signing capabilities and their interaction during the negotiation phase.
</p>
<p>Case 1: when both nodes support the same two Signature Algorithms, they can pick the Signature Algorithm they prefer for signing and are able to verify each others signature. <a class='info' href='#fig-neg1'>Figure&nbsp;3<span> (</span><span class='info'>Basic negotiation - Case 1</span><span>)</span></a> is an example of such a message flow.
</p><br /><hr class="insert" />
<a name="fig-neg1"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Node A                                    Node B

NS
{CGA option,
RSA Signature option.
Supported-Signature-Algo option
(RSA sign &amp; verif, ECC sign &amp; verif)}
                     --------&gt;
                                NA
                                {CGA option,
                                ECC Signature option
                                Supported-Signature-Algo option
                                (ECC sign &amp; verif, RSA sign &amp; verif)}
                     &lt;--------

IPv6 traffic         &lt;-------&gt;  IPv6 traffic</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Basic negotiation - Case 1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
				Case 2: two nodes sharing at least one common Signing Algorithm must be able to securely communicate.
				<a class='info' href='#fig-neg2'>Figure&nbsp;4<span> (</span><span class='info'>Basic negotiation - Case 2</span><span>)</span></a> is an example of such a message flow.
			
</p><br /><hr class="insert" />
<a name="fig-neg2"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Node A                                      Node B

NS
{CGA option,
RSA Signature option.
Supported-Signature-Algo option
(RSA sign &amp; verif, ECC sign &amp; verif)}
                       --------&gt;
                                   NA
                                   {CGA option,
                                   ECC Signature option
                                   Supported-Signature-Algo option
                                   (ECC sign &amp; verif)}
                       &lt;--------
                                   (At this point, Node B could not
                                   authenticate Node A's Neighbor
                                   Solicitation)

                       --------&gt; (unidirectionnal) IPv6 traffic

                                   NS
                                   {CGA option,
                                   ECC Signature option
                                   Supported-Signature-Algo option
                                   (ECC sign &amp; verif)}
                       &lt;--------
NA
{CGA option,
ECC Signature option.
Supported-Signature-Algo option
(RSA sign &amp; verif, ECC sign &amp; verif)}
                       --------&gt;

IPv6 traffic           &lt;-------&gt;  IPv6 traffic</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Basic negotiation - Case 2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
				Case 3: when two nodes have a disjoint set of Signature Algorithm support for signing, but the two nodes are able to verify each others, a full negotiation is possible.
				<a class='info' href='#fig-neg3'>Figure&nbsp;5<span> (</span><span class='info'>Basic negotiation - Case 3</span><span>)</span></a> is an example of such a message flow.
			
</p><br /><hr class="insert" />
<a name="fig-neg3"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Node A                                    Node B

NS
{CGA option,
RSA Signature option.
Supported-Signature-Algo option
(RSA sign &amp; verif, ECC verif only)}
                      --------&gt;
                               NA
                               {CGA option,
                               ECC Signature option
                               Supported-Signature-Algo option
                               (ECC sign &amp; verif, RSA verif only)}
                     &lt;--------

IPv6 traffic         &lt;-------&gt;  IPv6 traffic</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: Basic negotiation - Case 3&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
				Case 4: when two nodes have a disjoint set of Signature Algorithm support for signing, but one node is able to verify, a partial negotiation is possible.
				<a class='info' href='#fig-neg4'>Figure&nbsp;6<span> (</span><span class='info'>Basic negotiation - Case 4</span><span>)</span></a> is an example of such a message flow.
			
</p><br /><hr class="insert" />
<a name="fig-neg4"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Node A                                    Node B

NS
{CGA option,
RSA Signature option.
Supported-Signature-Algo option
(RSA sign &amp; verif)}
                     --------&gt;
                                NA
                                {CGA option,
                                ECC Signature option
                                Supported-Signature-Algo option
                                (ECC sign &amp; verif, RSA verif only)}
                    &lt;--------

          (...depending on local policies...)
IPv6 traffic        &lt;-------&gt;  IPv6 traffic</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: Basic negotiation - Case 4&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p> 
				<a class='info' href='#notary'>Section&nbsp;6<span> (</span><span class='info'>Router-as-a-notary function</span><span>)</span></a> describes an optional functionality that allow nodes in Case 4 to perform a trustful complete negotiation.
			
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Sending Unsolicited Messages</h3>

<p>
				When sending unsolicited message, a node MAY have to rely on the entries of its Neighbor Cache.
				The Neighbor Cache will provide hints concerning the Signature Algorithm supported by the neighbors.
				Neighbor Cache can assist the node in the Signature Algorithm selection process when:
				</p>
<ul class="text">
<li>
						A router advertises unsolicited Router Advertisement message to the All-Nodes multicast address
						(e.g. to indicate a prefix lifetime is going down to 0).
						The router needs to know which signature algorithm(s) to use in order to send verifiable messages to hosts.
						To do so, the router MAY rely on the Neighbor Cache and compute an intersection of the set of all Supported Signature Algorithms.
						The router will then be able to advertise a Router Advertisement signed multiple times 
						with the resulting subset of Supported Signature Algorithms or
						advertise multiple Router Advertisements, each signed with a single Signature Algorithm part of the intersection.
					
</li>
<li>
						A node sends unsolicited Neighbor Advertisement (e.g. when changing its Link-Layer address). This is similar to the previous
						problem and can also be solved using the Neighbor Cache the same way.
					
</li>
<li>
						A router sends a Redirect message to a host. Choosing a supported signature algorithm  
						without probing the node can be difficult. However, Neighbor Cache will most likely contain
						an entry for the host, prior to the decision to send a Redirect message, because of the Address
						Resolution process. 
						
						This entry should contain information on the Supported Signature Algorithm(s) 
						and thus provide hints concerning the Signature Algorithm to choose to sign the Redirect messages.
					
</li>
</ul><p>
			
</p>
<p>
				Note that the information on the neighbors with which a communication has occurred recently or is ongoing are in the Neighbor Cache and are maintained up to date through the Neighbor Unreachability Detection procedure.
			
</p>
<a name="notary"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Router-as-a-notary function</h3>

<p>This optional functionality enhances backward compatibility by introducing a new entity. This new entity, named "notary", certifies
			the authenticity of a node's message. This improves communication when, for example, two nodes have a disjoint set of supported
			Signature Algorithm types and still require secure neighbor discovery.
</p>
<p>In this specification, the notary function is offered by routers, although other nodes may offer this capability
			in the future specification. Authorization for the router to act as a notary is shown through router's certificate
			in a KeyPurposeID as defined in <a class='info' href='#krishnan-cgaext-send-cert-eku'>[krishnan&#8209;cgaext&#8209;send&#8209;cert&#8209;eku]<span> (</span><span class='info'>Krishnan, S., Kukec, A., and K. Ahmed, &ldquo;Certificate profile and certificate management for 						SEND,&rdquo; March&nbsp;2009.</span><span>)</span></a> and provided by the trust anchor.
</p>
<p> The notary function requires the two specific ICMP messages: signature check request message and signature status message.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Signature Check Request Message</h3>
<br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |     Code      |      Packet Length            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Checksum                |        Reserved               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Request ID.                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
+                                                               +
|                    SEND secured packet                        |
~          (NDP packets should fit completely)                  ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Options  ...
+-+-+-+-+-+-+-+-+-+-
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Signature Check Request Message format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
				</p>
<blockquote class="text"><dl>
<dt>Type</dt>
<dd><br />
TBA.
</dd>
<dt>Code</dt>
<dd><br />
TBA.
</dd>
<dt>Packet Length</dt>
<dd><br />

						Packet length is the size of the SEND secured packet
					
</dd>
<dt>Checksum</dt>
<dd><br />

						Checksum is a CRC-16 of the whole packet. During the CRC-16 computation, this field is set to 0. The purpose of
						this field is to quickly invalidate transmission errors.	
					
</dd>
<dt>Reserved</dt>
<dd><br />

						This 16-bit field is reserved. MUST be set to 0 by senders and ignored by receivers.
					
</dd>
<dt>Request Identifier</dt>
<dd><br />

						Request Identifier helps matching a signature check request and the signature status (response) messages.
						Request Identifier field is randomly generated.
					
</dd>
<dt>SEND secured packet</dt>
<dd><br />

						SEND secured packet is the packet that the node was not able to verify on his own, subject of the verification.
						Note that the encapsulated packet MUST not make the whole Signature Check Request message exceed the MTU (as no
						fragmentation support is available).
					
</dd>
<dt>Options</dt>
<dd><br />

						This field contains one or more NDP options. Currently, only one option is mandatory in this field. It is the
						Supported Signature Algorithm option, that allows the notary to choose a correct signature algorithm to sign the
						Signature Status message.
					
</dd>
</dl></blockquote><p>
			
</p>
<p>Note that this message MAY be protected by usual SEND NDP options (CGA option, Timestamp, Nonce, Universal Signature Option).  In
				this case, the Universal Signature Option contains the whole packet that the node wants to be checked on the router (so packet
				may not be tampered with).
</p>
<p>
				A router acting as a notary processes the packet as follows:
				</p>
<blockquote class="text">
<p>
						if the packet is protected with SEND options, the notary:
						</p>
<ul class="text">
<li>Verifies the CGA of the emitter
</li>
<li>Verifies the Universal Signature Option of the message (linked to CGA of the source address). If more
							than one Universal Signature Options are in the message, the notary can decide to check any of them.
</li>
<li>Verifies the CGA and signature of the SEND secured packet (inner packet).
</li>
<li>Responds with a Signature status message (defined in the following section) indicating the status of
							the SEND secured packet Universal Signature Option.
</li>
</ul>
					

<p>
						if the packet is not protected, the notary:
						</p>
<ul class="text">
<li>verifies the CGA and signature of the SEND secured packet (inner packet). If more than one Universal Signature
							Option are in the message, the notary can decide to check any of them.
</li>
<li>Responds with a Signature status message (defined in the following section) indicating the status of
							the SEND secured packet Universal Signature Option.
</li>
</ul>
					

</blockquote><p>

			
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Signature Status Message</h3>
<br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |     Code      |          Status               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Request ID.                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          Hash                                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Options  ...
+-+-+-+-+-+-+-+-+-+-
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Signature Status Message format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
				</p>
<blockquote class="text"><dl>
<dt>Type</dt>
<dd><br />
TBA.
</dd>
<dt>Code</dt>
<dd><br />
TBA.
</dd>
<dt>Status</dt>
<dd><br />

						The 16-bit status field can be set to any of the following values: 
						
<blockquote class="text"><dl>
<dt></dt>
<dd>0: all validation checks passed
</dd>
<dt></dt>
<dd>1: Signature Check Request message checksum failed
</dd>
<dt></dt>
<dd>2: inner packet CGA verification check failed
</dd>
<dt></dt>
<dd>3: inner packet signature verification check failed
</dd>
<dt></dt>
<dd>4: unsupported hash algorithm (to compute Hash1/Hash2)
</dd>
<dt></dt>
<dd>5: unsupported Public Key algorithm
</dd>
<dt></dt>
<dd>6: ask later (router is busy)
</dd>
</dl></blockquote>
					
</dd>
<dt>Request Identifier</dt>
<dd><br />

						The Request Identifier helps matching a signature check request and the signature status (response) message.
						The Request Identifier is copied from the Signature Check Request message.
					
</dd>
<dt>Hash</dt>
<dd><br />

						The Hash field contains the result of a hash function applied on the Request ID field and on the Send Secured Packet field of the Signature Check Request message. The hash function is the same as the one in the Key Hash field of the Universal Signature Option that will protect this message.
					
</dd>
<dt>Options</dt>
<dd><br />

						This field contains one or more NDP options. Mandatory options are CGA Option, Timestamp Option and Universal Signature Option. Universal Signature Option MUST be the last option.
					
</dd>
</dl></blockquote><p>
				
			
</p>
<p>
				This message is a response to a Signature Check Request message and is protected
				by SEND options generated using a public key contained in a certificate of the router 
				authorized to act as notary. If the Signature Check Request message is protected by the Nonce option, this option MUST be
				copied in the Signature Status message.

			
</p>
<p>
				On reception of this message, a requesting node performs CGA verification, Nonce (if included in the initial request) and
				Timestamp checks, and Universal Signature Option check. If any of those test fails, the packet is dropped and an error MAY be
				logged. Then, if the status message is 0, that node can treat the original packet that created the need for a Notary
				Signature Check Request message as a secured packet.   On a status value different from 0, the packet will be considered as unsecure and be treated
				as such. Status value MAY be loged for further diagnosis.
				
			
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Using notary for DAD procedure</h3>

<p>
				When performing the DAD procedure, a node can receive Neighbor Solicitation or Neighbor Advertisement that are protected by a
				Universal Signature Option the node can not check. In this specific case, the node can ask the notary to check the signature for
				him.
			
</p>
<p>
				However, the node, while performing DAD, MUST send the Signature Check Request message using the unspecified address as
				source address. The notary MUST respond with a Signature Status message directed to the All-Node multicast address.
			
</p>
<a name="secc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>
<br /><hr class="insert" />
<a name="tab_sec_equiv"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center">
<tr><th align="center">RSA key length (bits)</th><th align="center">ECC key length (bits)</th></tr>
<tr>
<td align="center">3072 </td>
<td align="center">256</td>
</tr>
<tr>
<td align="center">7680</td>
<td align="center">384</td>
</tr>
<tr>
<td align="center">15380</td>
<td align="center">512</td>
</tr>
</table>
<br clear="all" />

<p style='text-align: center'>Equivalence between Elliptic Curves and RSA security levels
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 1: Security level equivalence between ECC and RSA&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
			<a class='info' href='#Univ-Sig-Option'>Section&nbsp;4<span> (</span><span class='info'>SEND Universal Signature Option</span><span>)</span></a> presents a new Universal Signature Option. A recommended use of this option is to allow signatures of equivalent security level (i.e. Public Keys with equivalent key lengths) as shown in <a class='info' href='#tab_sec_equiv'>Table&nbsp;1<span> (</span><span class='info'>Security level equivalence between ECC and RSA</span><span>)</span></a>. See also section 4 of the companion draft <a class='info' href='#cheneau-cga-pk-agility'>[cheneau&#8209;cga&#8209;pk&#8209;agility]<span> (</span><span class='info'>Cheneau, T., Laurent-Maknavicius, M., Shen, S., and M. Vanderveen, &ldquo;Support for Multiple Signature Algorithms in Cryptographically Generated  						Addresses (CGAs),&rdquo; June&nbsp;2009.</span><span>)</span></a>. 
</p>
<p>
			Usage of SHA-1 for signature is strongly NOT RECOMMENDED, and when available should be preferred by the usage of SHA-256. SHA-1 security is
			been proved to be flawed in the light of recent attacks <a class='info' href='#Recent SHA-1 Attack'>[Recent SHA&#8209;1 Attack]<span> (</span><span class='info'>McDonald, C., Haukes, P., and J. Pieprzyk, &ldquo;SHA-1 collisions now 2^52,&rdquo; May&nbsp;2009.</span><span>)</span></a> <a class='info' href='#NIST-st'>[NIST&#8209;st]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;NIST Comments on Cryptanalytic Attacks on SHA-1,&rdquo; .</span><span>)</span></a>.
		
</p>
<p>
			The Universal Signature Option is vulnerable to downgrade attacks. That is, given that a node can employ multiple signature types, an attacker may choose to use a flawed one. To mitigate this issue, nodes are allowed, on a local policy, to refuse to check certain types of signature (i.e. those which are know to be flawed) and will treat the associated messages as unsecured. When trying to completely mitigate downgrade attacks, an administrator MAY deploy SEND-secured nodes only authorizing a single signature algorithm scheme. This comes at a price of a reduced interoperability.
		
</p>
<p>
			<a class='info' href='#notary'>Section&nbsp;6<span> (</span><span class='info'>Router-as-a-notary function</span><span>)</span></a> introduces an optional notary functionality that offers to nodes to check messages on their behalf, involving
			heavy cryptographic computation. This can lead to flooding attacks and Denial of Services. However, Neighbor Discovery Protocol <a class='info' href='#RFC4861'>[RFC4861]<span> (</span><span class='info'>Narten, T., Nordmark, E., Simpson, W., and H. Soliman, &ldquo;Neighbor Discovery for IP version 6 (IPv6),&rdquo; September&nbsp;2007.</span><span>)</span></a> and Secure Neighbor
			Discovery Protocol <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a> are already prone to flooding attacks. One possible solution is to use rate limiting on Signature Check Request
			messages.
		
</p>
<p>
			Notary functionality is also vulnerable to "Good Router Goes Bad" attacks (as described in <a class='info' href='#RFC3756'>[RFC3756]<span> (</span><span class='info'>Nikander, P., Kempf, J., and E. Nordmark, &ldquo;IPv6 Neighbor Discovery (ND) Trust Models and Threats,&rdquo; May&nbsp;2004.</span><span>)</span></a>). Notary can make
			node trust unsecured packets and drop valid ones.
			This issue can be mitigated when multiple notaries are present on a link. The node can use a round-robin algorithm to load-balance the
			Signature Check Request message, thus reducing the risk of cache poisoning by a compromised notary.
		
</p>
<a name="sec-iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>This document requests IANA to allocate types for the two new notary ICMP messages.
</p>
<p><a class='info' href='#sec-pki_opt'>Section&nbsp;3<span> (</span><span class='info'>Supported Signature Algorithm Option</span><span>)</span></a> defines a Signature Type Identifier subfield containing new values corresponding to different Signature Algorithm. This document requests creation of a new registry to the IANA.
</p>
<a name="ack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Acknowledgments</h3>

<p> The authors gratefully acknowledge the contributions of Marcelo Bagnulo, Gabriel Montenegro, 
			Greg Daley, Dave Thaler, Steve Kent, Jari Arko, and Francis Dupont for their helpful feedback.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3972">[RFC3972]</a></td>
<td class="author-text">Aura, T., &ldquo;<a href="http://tools.ietf.org/html/rfc3972">Cryptographically Generated Addresses (CGA)</a>,&rdquo; RFC&nbsp;3972, March&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3972.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3971">[RFC3971]</a></td>
<td class="author-text">Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;<a href="http://tools.ietf.org/html/rfc3971">SEcure Neighbor Discovery (SEND)</a>,&rdquo; RFC&nbsp;3971, March&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3971.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4982">[RFC4982]</a></td>
<td class="author-text">Bagnulo, M. and J. Arkko, &ldquo;<a href="http://tools.ietf.org/html/rfc4982">Support for Multiple Hash Algorithms in Cryptographically Generated Addresses (CGAs)</a>,&rdquo; RFC&nbsp;4982, July&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4982.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="cheneau-cga-pk-agility">[cheneau-cga-pk-agility]</a></td>
<td class="author-text">Cheneau, T., Laurent-Maknavicius, M., Shen, S., and M. Vanderveen, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-cheneau-cga-pk-agility-01.txt">Support for Multiple Signature Algorithms in Cryptographically Generated 
						Addresses (CGAs)</a>,&rdquo; draft-cheneau-cga-pk-agility-01 (work in progress), June&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-cheneau-cga-pk-agility-01.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2460">[RFC2460]</a></td>
<td class="author-text"><a href="mailto:deering@cisco.com">Deering, S.</a> and <a href="mailto:hinden@iprg.nokia.com">R. Hinden</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>,&rdquo; RFC&nbsp;2460, December&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2460.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2460.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2460.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3756">[RFC3756]</a></td>
<td class="author-text">Nikander, P., Kempf, J., and E. Nordmark, &ldquo;<a href="http://tools.ietf.org/html/rfc3756">IPv6 Neighbor Discovery (ND) Trust Models and Threats</a>,&rdquo; RFC&nbsp;3756, May&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3756.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4581">[RFC4581]</a></td>
<td class="author-text">Bagnulo, M. and J. Arkko, &ldquo;<a href="http://tools.ietf.org/html/rfc4581">Cryptographically Generated Addresses (CGA) Extension Field Format</a>,&rdquo; RFC&nbsp;4581, October&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4581.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4861">[RFC4861]</a></td>
<td class="author-text">Narten, T., Nordmark, E., Simpson, W., and H. Soliman, &ldquo;<a href="http://tools.ietf.org/html/rfc4861">Neighbor Discovery for IP version 6 (IPv6)</a>,&rdquo; RFC&nbsp;4861, September&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4861.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="NIST-st">[NIST-st]</a></td>
<td class="author-text">National Institute of Standards and Technology, &ldquo;<a href="http://csrc.nist.gov/groups/ST/hash/statement.html">NIST Comments on Cryptanalytic Attacks on SHA-1</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="krishnan-cgaext-send-cert-eku">[krishnan-cgaext-send-cert-eku]</a></td>
<td class="author-text">Krishnan, S., Kukec, A., and K. Ahmed, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-krishnan-cgaext-send-cert-eku-03.txt">Certificate profile and certificate management for
						SEND</a>,&rdquo; draft-krishnan-cgaext-send-cert-eku-03 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-krishnan-cgaext-send-cert-eku-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="FIPS-186-3">[FIPS-186-3]</a></td>
<td class="author-text">National Institute of Standards and Technology, &ldquo;Draft Digital Signature Standard,&rdquo; FIPS&nbsp;PUB 186-3, March&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="PKCS1">[PKCS1]</a></td>
<td class="author-text">RSA Laboratories, &ldquo;RSA Encryption Standard, Version 2.1,&rdquo; PKCS&nbsp;1, November&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="FIPS.180-2">[FIPS.180-2]</a></td>
<td class="author-text">National Institute of Standards and Technology, &ldquo;<a href="http://csrc.nist.gov/publications/fips/fips180-2/fips180-2.pdf">Secure Hash Standard</a>,&rdquo; FIPS&nbsp;PUB 180-2, August&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="SEC1">[SEC1]</a></td>
<td class="author-text">Standards for Efficient Cryptography Group, &ldquo;<a href="http://secg.org">SEC 1: Elliptic Curve Cryptography</a>,&rdquo; September&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="Recent SHA-1 Attack">[Recent SHA-1 Attack]</a></td>
<td class="author-text">McDonald, C., Haukes, P., and J. Pieprzyk, &ldquo;<a href="http://eurocrypt2009rump.cr.yp.to/837a0a8086fa6ca714249409ddfae43d.pdf">SHA-1 collisions now 2^52</a>,&rdquo; May&nbsp;2009.</td></tr>
</table>

<a name="key_sizes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
On the number of Public Keys supported per CGA</h3>
<br /><hr class="insert" />
<a name="table_RSA_PK"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center"><col align="center">
<tr><th align="center">RSA key length (bits)</th><th align="center">Public exponent</th><th align="center">Size of the DER-encoded Public Key (bytes)</th></tr>
<tr>
<td align="center">384</td>
<td align="center">3 or 17</td>
<td align="center">76</td>
</tr>
<tr>
<td align="center">384</td>
<td align="center">65537</td>
<td align="center">78</td>
</tr>
<tr>
<td align="center">512</td>
<td align="center">3 or 17</td>
<td align="center">92</td>
</tr>
<tr>
<td align="center">512</td>
<td align="center">65537</td>
<td align="center">94</td>
</tr>
<tr>
<td align="center">1024</td>
<td align="center">3 or 17</td>
<td align="center">160</td>
</tr>
<tr>
<td align="center">1024</td>
<td align="center">65537</td>
<td align="center">162</td>
</tr>
<tr>
<td align="center">2048</td>
<td align="center">3 or 17</td>
<td align="center">292</td>
</tr>
<tr>
<td align="center">2048</td>
<td align="center">65537</td>
<td align="center">294</td>
</tr>
<tr>
<td align="center">3072</td>
<td align="center">3 or 17</td>
<td align="center">420</td>
</tr>
<tr>
<td align="center">3072</td>
<td align="center">65537</td>
<td align="center">422</td>
</tr>
<tr>
<td align="center">7680</td>
<td align="center">3 or 17</td>
<td align="center">996</td>
</tr>
<tr>
<td align="center">7680</td>
<td align="center">65537</td>
<td align="center">998</td>
</tr>
<tr>
<td align="center">15360</td>
<td align="center">3 or 17</td>
<td align="center">1956</td>
</tr>
<tr>
<td align="center">15360</td>
<td align="center">65537</td>
<td align="center">1958</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 2: Common sizes for DER-encoded RSA Public Key&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="table_RSA_sig"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center">
<tr><th align="center">RSA Key Length (in bits)</th><th align="center">Size of the Digital Signature field without padding</th></tr>
<tr>
<td align="center">384</td>
<td align="center">48</td>
</tr>
<tr>
<td align="center">512</td>
<td align="center">64</td>
</tr>
<tr>
<td align="center">1024</td>
<td align="center">128</td>
</tr>
<tr>
<td align="center">2048</td>
<td align="center">256</td>
</tr>
<tr>
<td align="center">3072</td>
<td align="center">384</td>
</tr>
<tr>
<td align="center">7680</td>
<td align="center">960</td>
</tr>
<tr>
<td align="center">15360</td>
<td align="center">1920</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 3: Common sizes of the Digital Signature field when using RSA&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="table_ECC_PK"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center">
<tr><th align="center">Name of the elliptic curve</th><th align="center">Size of the DER-encoded Public Key (bytes)</th></tr>
<tr>
<td align="center">P-256</td>
<td align="center">88</td>
</tr>
<tr>
<td align="center">P-384</td>
<td align="center">120</td>
</tr>
<tr>
<td align="center">P-521</td>
<td align="center">158</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 4: Common sizes for DER-encoded ECC Public Key&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="table_ECDSA_sig"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center">
<tr><th align="center">Name of the elliptic curve</th><th align="center">Size of the Digital Signature field (without padding)</th></tr>
<tr>
<td align="center">P-256</td>
<td align="center">71</td>
</tr>
<tr>
<td align="center">P-384</td>
<td align="center">104</td>
</tr>
<tr>
<td align="center">P-521</td>
<td align="center">139</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 5: Common sizes of the Digital Signature field when using ECDSA (+ DER encoding)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
				When using multiple public keys to form a CGA, one may reach the maximum number 
				of possible public keys  before each Neighbor 
				Discovery Message exceed the Maximum Transfer Unit (which must be at least 1280 octets according to 
				<a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a>). This section aims to approximate this limit.
			
</p>
<p>
				Numerous factors (presence and number of option, size of public keys, etc)  influence the size of the Neighbor 
				Discovery message. For example, when sending a SEND-secured Router Advertisement message:
				</p>
<ul class="text">
<li>The IPv6 header is 40 bytes long. Described in <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a>.
</li>
<li>The bare Router Advertisement message (without any option) is 16 bytes long. Described in <a class='info' href='#RFC4861'>[RFC4861]<span> (</span><span class='info'>Narten, T., Nordmark, E., Simpson, W., and H. Soliman, &ldquo;Neighbor Discovery for IP version 6 (IPv6),&rdquo; September&nbsp;2007.</span><span>)</span></a>.
</li>
<li>A Prefix Information Option (can appear more than once) is 32 bytes long. Described in <a class='info' href='#RFC4861'>[RFC4861]<span> (</span><span class='info'>Narten, T., Nordmark, E., Simpson, W., and H. Soliman, &ldquo;Neighbor Discovery for IP version 6 (IPv6),&rdquo; September&nbsp;2007.</span><span>)</span></a>.
</li>
<li>A Source Link-Layer Option, when a IEEE 802 address is used, is 8 bytes long. Described in <a class='info' href='#RFC4861'>[RFC4861]<span> (</span><span class='info'>Narten, T., Nordmark, E., Simpson, W., and H. Soliman, &ldquo;Neighbor Discovery for IP version 6 (IPv6),&rdquo; September&nbsp;2007.</span><span>)</span></a>.
</li>
<li>A MTU Option is 8 bytes long. Described in <a class='info' href='#RFC4861'>[RFC4861]<span> (</span><span class='info'>Narten, T., Nordmark, E., Simpson, W., and H. Soliman, &ldquo;Neighbor Discovery for IP version 6 (IPv6),&rdquo; September&nbsp;2007.</span><span>)</span></a>.
</li>
<li>The CGA Option is the size of the CGA Parameter Data Structure plus 4 bytes rounded up to the closest multiple of 8 value. This option is defined in <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a>.
						The CGA Parameter Data Structure (defined in <a class='info' href='#RFC3972'>[RFC3972]<span> (</span><span class='info'>Aura, T., &ldquo;Cryptographically Generated Addresses (CGA),&rdquo; March&nbsp;2005.</span><span>)</span></a> size depends on the following fields:
						
<ul class="text">
<li>Modifier: 16 bytes long.
</li>
<li>Subnet Prefix: 8 bytes long.
</li>
<li>Collision Count: 1 byte long.
</li>
<li>Public Key:  variable size. <a class='info' href='#table_RSA_PK'>Table&nbsp;2<span> (</span><span class='info'>Common sizes for DER-encoded RSA Public Key</span><span>)</span></a> provides size of the commonly used DER-encoded RSA Public Keys. 
								<a class='info' href='#table_ECC_PK'>Table&nbsp;4<span> (</span><span class='info'>Common sizes for DER-encoded ECC Public Key</span><span>)</span></a> provides size for the commonly used DER-encoded ECC Public Keys.
</li>
<li>Extension(s): variable size. Public Key Extension field defined in <a class='info' href='#cheneau-cga-pk-agility'>[cheneau&#8209;cga&#8209;pk&#8209;agility]<span> (</span><span class='info'>Cheneau, T., Laurent-Maknavicius, M., Shen, S., and M. Vanderveen, &ldquo;Support for Multiple Signature Algorithms in Cryptographically Generated  						Addresses (CGAs),&rdquo; June&nbsp;2009.</span><span>)</span></a> is 4 bytes plus the 
								size of the Public Key long. Public Key size are defined in <a class='info' href='#table_RSA_PK'>Table&nbsp;2<span> (</span><span class='info'>Common sizes for DER-encoded RSA Public Key</span><span>)</span></a> and <a class='info' href='#table_ECC_PK'>Table&nbsp;4<span> (</span><span class='info'>Common sizes for DER-encoded ECC Public Key</span><span>)</span></a>.
</li>
</ul>
					
</li>
<li>The Timestamp Option is 16 bytes long. Defined in <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a>.
</li>
<li>The Nonce Option minimum size is 8 bytes long. Defined in <a class='info' href='#RFC3971'>[RFC3971]<span> (</span><span class='info'>Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;SEcure Neighbor Discovery (SEND),&rdquo; March&nbsp;2005.</span><span>)</span></a>.
</li>
<li>The Universal Signature Option depends on the size of the Digital Signature. The fixed part of the option is 20 bytes long. 
						This option is updated in this document. <a class='info' href='#table_RSA_sig'>Table&nbsp;3<span> (</span><span class='info'>Common sizes of the Digital Signature field when using RSA</span><span>)</span></a> presents common sizes for usual Digital Signature field when using RSA. 
						<a class='info' href='#table_ECDSA_sig'>Table&nbsp;5<span> (</span><span class='info'>Common sizes of the Digital Signature field when using ECDSA (+ DER encoding)</span><span>)</span></a> presents common sizes for Digital Signature field when using ECDSA. This option size must be a multiple of 8 bytes.
</li>
</ul><p>
			
</p>
<p>
			A Router Advertisement message, carrying a Prefix Information Option and a Source Link-Layer Option, without Nonce, with one 1024-bits long RSA Public Key and a 
				Public Exponent of 3 in the CGA Option is 456 bytes long. Using the same RSA Public Key, adding one ECC P-521 key to CGA Option, the same message, signed with a 
				Universal Signature option generated by RSA and a Universal Signature Option signed by ECDSA, is 768 bytes long.  Note that EC P-521 and 1024-bits RSA keys 
				should not be used together  
				because they do not present the same security level (see <a class='info' href='#secc'>Section&nbsp;7<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>) and are shown here to indicate sizes of messages with "big" keys.
			
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tony Cheneau</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Institut TELECOM, TELECOM SudParis, CNRS SAMOVAR UMR 5157</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">9 rue Charles Fourier</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Evry  91011</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:tony.cheneau@it-sudparis.eu">tony.cheneau@it-sudparis.eu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Maryline Laurent-Maknavicius</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Institut TELECOM, TELECOM SudParis, CNRS SAMOVAR UMR 5157</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">9 rue Charles Fourier</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Evry  91011</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:maryline.maknavicius@it-sudparis.eu">maryline.maknavicius@it-sudparis.eu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sean Shen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">No. 9  Xinxi Road</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing  100085</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:sshen@huawei.com">sshen@huawei.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Michaela Vanderveen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Qualcomm</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mvandervn@gmail.com">mvandervn@gmail.com</a></td></tr>
</table>
</body></html>
