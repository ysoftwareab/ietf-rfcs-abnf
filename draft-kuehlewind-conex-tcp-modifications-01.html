<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>TCP modifications for Congestion Exposure</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Language">
<link href="#rfc.section.2" rel="Chapter" title="2 Sender-side Modifications">
<link href="#rfc.section.3" rel="Chapter" title="3 Accounting congestion">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 ECN">
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 Accurate ECN feedback">
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 Classic ECN support">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Loss Detection with/without SACK">
<link href="#rfc.section.4" rel="Chapter" title="4 Setting the ConEx IPv6 Bits">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Setting the E and the L Bit">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Credit Bits">
<link href="#rfc.section.5" rel="Chapter" title="5 Timeliness of the ConEx Signals">
<link href="#rfc.section.6" rel="Chapter" title="6 Acknowledgements">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="Congestion Exposure (ConEx) is a mechanism by which senders inform the network about the congestion encountered by previous packets on the same flow.  This document describes the necessary modifications to use ConEx with the Transmission Control Protocol (TCP).  " />
  <meta name="description" content="Congestion Exposure (ConEx) is a mechanism by which senders inform the network about the congestion encountered by previous packets on the same flow.  This document describes the necessary modifications to use ConEx with the Transmission Control Protocol (TCP).  " />
  <meta name="keywords" content="Internet-Draft, I-D" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Congestion Exposure (ConEx)</td>
<td class="right">M. Kuehlewind, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">University of Stuttgart</td>
</tr>
<tr>
<td class="left">Intended status: Experimental Protocol</td>
<td class="right">R. Scheffenegger</td>
</tr>
<tr>
<td class="left">Expires: May 03, 2012</td>
<td class="right">NetApp, Inc.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 31, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">TCP modifications for Congestion Exposure<br />
  <span class="filename">draft-kuehlewind-conex-tcp-modifications-01</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Congestion Exposure (ConEx) is a mechanism by which senders inform the network about the congestion encountered by previous packets on the same flow.  This document describes the necessary modifications to use ConEx with the Transmission Control Protocol (TCP).  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 03, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Requirements Language</a>
</li>
<li>2.   <a href="#rfc.section.2">Sender-side Modifications</a>
</li>
<li>3.   <a href="#rfc.section.3">Accounting congestion</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">ECN</a>
</li>
<li>3.1.1.   <a href="#rfc.section.3.1.1">Accurate ECN feedback</a>
</li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">Classic ECN support</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Loss Detection with/without SACK</a>
</li>
<li>4.   <a href="#rfc.section.4">Setting the ConEx IPv6 Bits</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Setting the E and the L Bit</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Credit Bits</a>
</li>
<li>5.   <a href="#rfc.section.5">Timeliness of the ConEx Signals</a>
</li>
<li>6.   <a href="#rfc.section.6">Acknowledgements</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">Congestion Exposure (ConEx) is a mechanism by which senders inform the network about the congestion encountered by previous packets on the same flow.  This document describes the necessary modifications to use ConEx with the Transmission Control Protocol (TCP). The ConEx signal is based on loss or ECN marks <a href="#RFC3168">[RFC3168]</a> as a congestion indication.  </p>
<p id="rfc.section.1.p.2">With standard TCP without Selective Acknowledgments (SACK) <a href="#RFC2018">[RFC2018]</a> the actual number of losses is hard to detect, thus we recommend to enable SACK when using ConEx.  However, we discuss both cases, with and without SACK support, later on.  </p>
<p id="rfc.section.1.p.3">Explicit Congestion Notification (ECN) is defined in such a way that only a single congestion signal is guaranteed to be delivered per Round-trip Time (RTT). For ConEx a more accurate  feedback signal would be beneficial. Such an extension to ECN is defined in a seperate document <a href="#draft-kuehlewind-conex-accurate-ecn">[draft-kuehlewind-conex-accurate-ecn]</a>, as it can also be useful for other mechanisms, as e.g. <a href="#DCTCP">[DCTCP]</a> or whenever the congestion control reaction should be proportional to the expirienced congestion.  </p>
<p id="rfc.section.1.p.4">ConEx is currently/will be defined as an destination option for IPv6.  The use of four bits have been defined, namely the X (ConEx-capable), the L (loss experienced), the E (ECN experienced) and C (credit) bit.  </p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Requirements Language</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Sender-side Modifications</h1>
<p id="rfc.section.2.p.1">A ConEx sender MUST negotitate for both SACK and the more accurate ECN feedback in the TCP handshake if these TCP extension are available at the sender.  Depending on the capability of the receiver, the following operation modes exist: </p>

<ul>
<li>Full-ConEx (SACK and accurate ECN feedback) </li>
<li>accECN-ConEx (no SACK but accurate ECN feedback)</li>
<li>ECN-ConEx (no SACK and no accurate ECN feedback but 'classic' ECN)</li>
<li>SACK-ECN-ConEx (SACK and 'classic' instead of accurate ECN)</li>
<li>SACK-ConEx (SACK but no ECN at all)</li>
<li>Basic-ConEx (neither SACK nor ECN) </li>
</ul>

<p> </p>
<p id="rfc.section.2.p.2">A ConEx sender MUST expose congestion to the network according to the congestion information received by ECN or based on loss provided by the TCP feedback loop. A TCP sender MUST account congestion byte-wise (and not packet-wise) and MUST mark the respective number of payload bytes in subsequent packets (after the congestion notification) with the respective ConEx bit in the IP header.  The congestion accounting based on different operation modes is described in the next section and the handling of the IPv6 bits itself in the subsequent section afterwards.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Accounting congestion</h1>
<p id="rfc.section.3.p.1">A TCP sender MUST account congestion byte-wise (and not packet-wise) based the congestion information received by ECN or loss detection provided by TCP.  For this purpose a TCP sender will maintain two different counters for number outstanding bytes that need to be ConEx marked either with the E bit or the L Bit.  </p>
<p id="rfc.section.3.p.2">The outstanding bytes accounted based on ECN feedback information are maintained in the congestion exposure gauge (CEG). The accounting of these bytes from the ECN feedback is explained in more detail next.  </p>
<p id="rfc.section.3.p.3">The outstanding bytes for congestion indications based on loss are maintained in the loss exposure gauge (LEG) and the accounting is explained in subsequent to the CEG accounting.  </p>
<p id="rfc.section.3.p.4">The subtraction of bytes which have been ConEx marked from both counters is explained in the next section.  </p>
<p id="rfc.section.3.p.5">Usually all byte of an IP packet must be accounted. If we assume equal sized packets or at least equally distributed packet sizes the sender MAY only account the TCP payload bytes, as the ConEx marked packets as well as the original packets causing the congestion will both contain about the same number of headers.  Otherwise the sender MUST take the headers into account.  A sender which sends different sized packets with unequally distributed packet sizes should know about reason to do so and thus may be able to reconstruct the exact number of headers based on this information.  Otherwise if no additional information is available the worse case number of headers SHOULD be estimated in a conservative way based on a minimum packet size (of all packets sent in the last RTT).  </p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> ECN</h1>
<p id="rfc.section.3.1.p.1">A receiver can support the accurate ECN feedback scheme, the 'classic' ECN or neither. In the case ECN is not supported at all, the transport is not ECN-capable and no ECN marks will occur, thus the E bit will never be set. In the other cases a ConEx sender MUST maintain a gauge for the number of outstanding bytes that has to be ConEx marked with the E bit, the congestion exposure gauge (CEG).  </p>
<p id="rfc.section.3.1.p.2">The CEG is increased when ECN information is received from an ECN-capable receiver supporting the 'classic' ECN scheme or the accurate ECN feedback scheme. When the ConEx sender receives an ACK indicating one or more segments were received with a CE mark, CEG is increased by the appropriate number of bytes.  The two cases, depending on the receiver capability, are discussed in the following sections.  </p>
<h1 id="rfc.section.3.1.1">
<a href="#rfc.section.3.1.1">3.1.1.</a> Accurate ECN feedback</h1>
<p id="rfc.section.3.1.1.p.1">With an more accurate ECN feedback scheme either the number of marked packets/received CE marks is know or the number of marked bytes directly. In the later case the CEG can directly be increased by the number of marked bytes. Otherwise when the accurate ECN feedback scheme is supported by the receiver, the receiver will maintain an echo congestion counter (ECC). The ECC will hold the number of CE marks received. A sender that is understanding the accurate ECN feedback will be able to reconstruct this ECC value on the sender side by maintaining a counter ECC.r.  </p>
<p id="rfc.section.3.1.1.p.2">On the arrival of every ACK, the sender calculates the difference D between the local ECC.r counter, and the signaled value of the receiver side ECC counter. The value of ECC.r is increased by D, and D is assumed to be the number of CE marked packets that arrived at the receiver since it sent the previously received ACK.  </p>
<p id="rfc.section.3.1.1.p.3">Whenever the counter ECC.r is increased,	the gauge CEG has to be increased by the amount of bytes sent which were marked:</p>
<p id="rfc.section.3.1.1.p.4">CEG += min( SMSS*D, acked_bytes )</p>
<h1 id="rfc.section.3.1.2">
<a href="#rfc.section.3.1.2">3.1.2.</a> Classic ECN support</h1>
<p id="rfc.section.3.1.2.p.1">A ConEx sender that communicates with a classic ECN receiver (conforming to <a href="#RFC3168">[RFC3168]</a> or <a href="#RFC5562">[RFC5562]</a>) MAY run in one of these modes: </p>

<ul>
<li>Full compliance mode:<br><br> The ConEx sender fully conforms to all the semantics of the ECN signaling as defined by <a href="#RFC5562">[RFC5562]</a>. In this mode, only a single congestion indication can be signaled by the receiver per RTT. Whenever the ECE flag toggles from "0" to "1", the gauge CEG is increased by the SMSS: <br><br> CEG += SMSS <br><br> Note that under severe congestion, a session adhering to these semantics may not provide enough ConEx marks.  This may cause appropriate sanctions by an audit device in a ConEx enabled network.</li>
<li>Simple compatibility mode:<br><br> The sender will set the CWR permanently to force the receiver to signal only one ECE per CE mark. Unfortunately, in a high congestion situation where all packets are CE marled over a certain period of time, the use of delayed ACKs, as it is usually done today, will prevent a feedback of every CE mark.  With an ACK rate of m, about m-1/m CE indications will not be signaled back by the receiver (e.g. 50% with M=2). Thus, in this mode the ConEx sender MUST increase CEG by a count of M*SMSS for each received ECE signal: <br><br> CEG += M*SMSS <br><br> In case of a congestion event with low congestion (that means when only a very smaller number of packets get marked), the sender might miss the whole congestion event.  In average the sender will sent sufficient ConEx marks due to the scheme proposed above but these ConEx marks might be timely shifted.  Regarding congestion control it is not a general problem to miss a congestion event as by chance a marking scheme in the network node might also miss a certain flow.  Even if then no other flow is reacting, the congestion level will increase and it will get more likely that the congestion feedback is delivered.  But to provide a fair share over time, a TCP sender could react more strong when receiving a ECN feedback signal. This of course depends on the congestion control used. A TCP sender using this scheme MUST take the impact on congestion control into account.</li>
<li>Advanced compatibility mode:<br><br> More sophisticated heuristics, such as a phase locked loop, to set CWR only on those data segments, that will actually trigger an (delayed) ACK, could extract congestion notifications more timely. A ConEx sender MAY choose to implement such a heuristic. In addition, further heuristics SHOULD be implemented, to determine the value of each ECE notification. E.g. for each consecutive ACK received with the ECE flag set, CEG should be increased by min( M*SSMS, acked_bytes).  Else if the predecessor ACK was received with the ECE flag cleared, CEG need only be increase by one SMSS: <br><br> if previous_marked: CEG += min( M*SSMS, acked_bytes) <br> else: CEG += SMSS <br><br> This heuristic is conservative during more serious congestion, and more relaxed at low congestion levels.</li>
</ul>

<p> </p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Loss Detection with/without SACK</h1>
<p id="rfc.section.3.2.p.1">For all the data segments that are determined by a ConEx sender as lost, an identical number of IP bytes MUST be be sent with the ConEx L bit set.  Loss detection typically happens by use of duplicate ACKs, or the firing of the retransmission timer.  A ConEx sender MUST maintain a loss exposure gauge (LEG), indicating the number of outstanding bytes that must be sent with the ConEx L bit.  When a data segment is retransmitted, LEG will be increased by the size of the TCP payload packet containing the retransmission, assuming equal sized segments such that the retransmitted packet will have the same number of header as the original ones.  When sending subsequent segments (including TCP control segments), the ConEx L bit is set as long as LEG is positive, and LEG is decreased by the size of the sent TCP payload with the ConEx L bit set.  </p>
<p id="rfc.section.3.2.p.2">Any retransmission may be spurious.  To accommodate that, a ConEx sender SHOULD make use of heuristics to detect such spurious retransmissions (e.g. F-RTO <a href="#RFC5682">[RFC5682]</a>, DSACK <a href="#RFC3708">[RFC3708]</a>, and Eifel <a href="#RFC3522">[RFC3522]</a>, <a href="#RFC4015">[RFC4015]</a>).  When such a heuristic has determined, that a certain number of packets were retransmitted erroneously, the ConEx sender should subtract the payload size of these TCP packets from LEG.  </p>
<p id="rfc.section.3.2.p.3">Note that the above heuristics delays the ConEx signal by one segment, and also decouples them from the retransmissions themselves, as some control packets (e.g. pure ACKs, window probes, or window updates) may be sent in between data segment retransmissions.  A simpler approach would be to set the ConEx signal for each retransmitted data segment.  However, it is important to remember, that a ConEx signal and TCP segments do not natively belong together.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Setting the ConEx IPv6 Bits</h1>
<p id="rfc.section.4.p.1">ConEx is currently/will be defined as an destination option for IPv6.  The use of four bits have been defined, namely the X (ConEx-capable), the L (loss experienced), the E (ECN experienced) and C (credit) bit.  </p>
<p id="rfc.section.4.p.2">By setting the X bit a packet is marked as ConEx-capable.  All packets carrying payload MUST be marked with the X bit set including retransmissions.  About control packets as pure ACKs which are not carrying any payload no congestion feedback information are available thus these packet should not be take into account when determining ConEx information. These packet MUST carry a ConEx Destination Option with the X bit unset.  </p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Setting the E and the L Bit</h1>
<p id="rfc.section.4.1.p.1">As long as the CEG/LEG is positive, ConEx-capable packets MUST be marked with E or respective L and the CEG/LEG is decreased by the TCP payload bytes carried in this packet. If the CEG/LEG is negative, the CEG/LEG is drained by one byte with every packet sent out, as ConEX information are only meaningful for a certain time: <br><br> if CEG &gt; 0: CEG -= TCPpayload.length else: CEG--<br> if LEG &gt; 0: LEG -= TCPpayload.length else: LEG-- </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Credit Bits</h1>
<p id="rfc.section.4.2.p.1">The ConEx abstract mechanism requires that the transport SHOULD signal sufficient credit in advance to cover any reasonably expected congestion during its feedback delay. To be very conservative the number of credits would need to equal the number of packets in flight, as every packet could get lost or congestion marked.  With a more moderate view, only an increase in the sending rate should cause congestion.  </p>
<p id="rfc.section.4.2.p.2">For TCP sender using the <a href="#RFC5681">[RFC5681]</a> congestion control algorithm, we recommend to only send credit in Slow Start, as in Congestion Avoidance an increase of one segment per RTT should only cause a minor amount of congestion marks (usually at max one). If a more aggressive congestion control is used, a sufficient amount of credits need to be set.  </p>
<p id="rfc.section.4.2.p.3">In TCP Slow Start the sending rate will increase exponentially and that means double every RTT.  Thus the number of credits should equal half the number of packets in flight in every RTT. Under the assumption that all marks will not get invalid for the whole Slow Start phase, marks of a previous RTT have to be summed up. Thus the marking of every fourth packet will allow sufficient credits in Slow Start.  </p>
<div id="#rfc.figure.1"></div>
<div id="#SS_credit"></div>
<pre>
RTT1	|------XC------&gt;|
	|------X-------&gt;|
	|------X-------&gt;|   credit=1  in_flight=3
	|		|
RTT2	|------X-------&gt;|
	|------XC------&gt;|
	|------X-------&gt;|
	|------X-------&gt;|
	|------X-------&gt;|
	|------XC------&gt;|   credit=3  in_flight=6
	|		|
RTT3	|------X-------&gt;|
	|------X-------&gt;|
	|------X-------&gt;|
	|------XC------&gt;|
	|------X-------&gt;|
	|------X-------&gt;|
	|------X-------&gt;|
	|------XC------&gt;|
	|------X-------&gt;|
	|------X-------&gt;|
	|------X-------&gt;|
	|------XC------&gt;|   credit=6  in_flight=12
	|	.	|
	|	:	|
			</pre>
<p></p>
<p id="rfc.section.4.2.p.5">If a ConEx sender detects an increasing number of losses even though the sender reduced the sending rate, the sender SHOULD assume that those losses are incorporated by an audit device and thus should send further credits. Up to now its not clear if the credits say valid as long as the connection is established or if an expiration of the credits need to be assumed by the sender.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Timeliness of the ConEx Signals</h1>
<p id="rfc.section.5.p.1">ConEx signals will anyway be evaluated with a slight time delay of about one RTT by a network node.  Therefore, it would not be absolutely necessary to immediately signal ConEx bits when they become known (e.g.  L and E bits), but a sender SHOULD sent the ConEx signaling with the next available packet. If cases are available where it is preferable to slight delay the ConEx signal, the sender MUST NOT delay the ConEx signal more than one RTT.  </p>
<p id="rfc.section.5.p.2">Multiple ConEx bits may become available for signaling at the same time, for example when an ACK is received by the sender, that indicates that at least one segment has been lost, and that one or more ECN marks were received at the same time.  This may happen during excessive congestion, where buffer queues overflow and some packets are marked, while others have to be dropped nevertheless.  Another possibility when this may happen are lost ACKs, so that a subsequent ACK carries summary information not previously available to the sender.  </p>
<p id="rfc.section.5.p.3">It is important to remember, that ConEx bits and TCP retransmissions do not interact with each other.  However, a retransmission should be accompanied by one ConEx L bit in close proximity nevertheless. This does not mean, that TCP retransmissions may never contain ConEx marks. In a typical scenario using SACK, the first retransmission would not carry a ConEx L bit, while subsequent retransmissions in the same recovery episode, would be marked with the ConEx L bit.  Spreading the ConEx bits over a small number of segments increases the likelihood that most devices along the path will see some ConEx marks even during heavy congestion.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p></p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p></p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p></p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3168">[RFC3168]</b></td>
<td class="top">
<a>Ramakrishnan, K.</a>, <a>Floyd, S.</a> and <a>D. Black</a>, "<a href="http://tools.ietf.org/html/rfc3168">The Addition of Explicit Congestion Notification (ECN) to IP</a>", RFC 3168, September 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2018">[RFC2018]</b></td>
<td class="top">
<a href="mailto:mathis@psc.edu" title="Pittsburgh Supercomputing Center">Mathis, M.</a>, <a href="mailto:mahdavi@psc.edu" title="Pittsburgh Supercomputing Center">Mahdavi, J.</a>, <a href="mailto:floyd@ee.lbl.gov" title="Lawrence Berkeley National Laboratory">Floyd, S.</a> and <a href="mailto:allyn@eng.sun.com" title="Sun Microsystems, Inc.">A. Romanow</a>, "<a href="http://tools.ietf.org/html/rfc2018">TCP Selective Acknowledgment Options</a>", RFC 2018, October 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5562">[RFC5562]</b></td>
<td class="top">
<a>Kuzmanovic, A.</a>, <a>Mondal, A.</a>, <a>Floyd, S.</a> and <a>K. Ramakrishnan</a>, "<a href="http://tools.ietf.org/html/rfc5562">Adding Explicit Congestion Notification (ECN) Capability to TCP's SYN/ACK Packets</a>", RFC 5562, June 2009.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC3522">[RFC3522]</b></td>
<td class="top">
<a>Ludwig, R.</a> and <a>M. Meyer</a>, "<a href="http://tools.ietf.org/html/rfc3522">The Eifel Detection Algorithm for TCP</a>", RFC 3522, April 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3708">[RFC3708]</b></td>
<td class="top">
<a>Blanton, E.</a> and <a>M. Allman</a>, "<a href="http://tools.ietf.org/html/rfc3708">Using TCP Duplicate Selective Acknowledgement (DSACKs) and Stream Control Transmission Protocol (SCTP) Duplicate Transmission Sequence Numbers (TSNs) to Detect Spurious Retransmissions</a>", RFC 3708, February 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4015">[RFC4015]</b></td>
<td class="top">
<a>Ludwig, R.</a> and <a>A. Gurtov</a>, "<a href="http://tools.ietf.org/html/rfc4015">The Eifel Response Algorithm for TCP</a>", RFC 4015, February 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5681">[RFC5681]</b></td>
<td class="top">
<a>Allman, M.</a>, <a>Paxson, V.</a> and <a>E. Blanton</a>, "<a href="http://tools.ietf.org/html/rfc5681">TCP Congestion Control</a>", RFC 5681, September 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5682">[RFC5682]</b></td>
<td class="top">
<a>Sarolahti, P.</a>, <a>Kojo, M.</a>, <a>Yamamoto, K.</a> and <a>M. Hata</a>, "<a href="http://tools.ietf.org/html/rfc5682">Forward RTO-Recovery (F-RTO): An Algorithm for Detecting Spurious Retransmission Timeouts with TCP</a>", RFC 5682, September 2009.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.briscoe-tsvwg-re-ecn-tcp">[I-D.briscoe-tsvwg-re-ecn-tcp]</b></td>
<td class="top">
<a>Briscoe, B</a>, <a>Jacquet, A</a>, <a>Moncaster, T</a> and <a>A Smith</a>, "<a href="http://tools.ietf.org/html/draft-briscoe-tsvwg-re-ecn-tcp-09">Re-ECN: Adding Accountability for Causing Congestion to TCP/IP</a>", Internet-Draft draft-briscoe-tsvwg-re-ecn-tcp-09, October 2010.</td>
</tr>
<tr>
<td class="reference"><b id="draft-kuehlewind-conex-accurate-ecn">[draft-kuehlewind-conex-accurate-ecn]</b></td>
<td class="top">
<a>Kuehlewind, M</a> and <a>R Scheffenegger</a>, "<a href="http://tools.ietf.org/html/draft-kuehlewind-conex-accurate-ecn-00">Accurate ECN Feedback in TCP</a>", Internet-Draft draft-kuehlewind-conex-accurate-ecn-00, Jun 2011.</td>
</tr>
<tr>
<td class="reference"><b id="DCTCP">[DCTCP]</b></td>
<td class="top">
<a>Alizadeh, M</a>, <a>Greenberg, A</a>, <a>Maltz, D</a>, <a>Padhye, J</a>, <a>Patel, P</a>, <a>Prabhakar, B</a>, <a>Sengupta, S</a> and <a>M Sridharan</a>, "<a>DCTCP: Efficient Packet Transport for the Commoditized Data Center</a>", Jan 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mirja Kuehlewind</span> editor
	  <span class="n hidden">
		<span class="family-name">Kuehlewind</span>
	  </span>
	</span>
	<span class="org vcardline">University of Stuttgart</span>
	<span class="adr">
	  <span>Pfaffenwaldring 47</span>

	  <span class="vcardline">
		<span class="locality">Stuttgart</span>,  
		<span class="region"></span>
		<span class="code">70569</span>
	  </span>
	  <span class="country-name vcardline">Germany</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mirja.kuehlewind@ikr.uni-stuttgart.de">mirja.kuehlewind@ikr.uni-stuttgart.de</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Richard Scheffenegger</span> 
	  <span class="n hidden">
		<span class="family-name">Scheffenegger</span>
	  </span>
	</span>
	<span class="org vcardline">NetApp, Inc.</span>
	<span class="adr">
	  <span>Am Euro Platz 2</span>

	  <span class="vcardline">
		<span class="locality">Vienna</span>,  
		<span class="region"></span>
		<span class="code">1120</span>
	  </span>
	  <span class="country-name vcardline">Austria</span>
	</span>
	<span class="vcardline">Phone: +43 1 3676811 3146</span>

<span class="vcardline">EMail: <a href="mailto:rs@netapp.com">rs@netapp.com</a></span>

  </address>
</div>

</body>
</html>