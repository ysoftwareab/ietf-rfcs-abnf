<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Authentication Name Mapping extension for AFS-3 Protection Service</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Conventions Used in this Document">
<link href="#rfc.section.3" rel="Chapter" title="3 Background information on operation of AFS">
<link href="#rfc.section.4" rel="Chapter" title="4 Error Codes">
<link href="#rfc.section.5" rel="Chapter" title="5 Existing Protocol Constants">
<link href="#rfc.section.6" rel="Chapter" title="6 Existing Per-Identity Permission Flags">
<link href="#rfc.section.7" rel="Chapter" title="7 RPC Interface">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 New Data Types">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Authentication Name Types">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 GetCapabilities RPC">
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 Authentication name mapping RPCs">
<link href="#rfc.section.7.4.1" rel="Chapter" title="7.4.1 AuthNameToID">
<link href="#rfc.section.7.4.2" rel="Chapter" title="7.4.2 AuthNameToIDFallback">
<link href="#rfc.section.7.4.3" rel="Chapter" title="7.4.3 ListAuthNames">
<link href="#rfc.section.7.4.4" rel="Chapter" title="7.4.4 WhoAmI">
<link href="#rfc.section.7.4.5" rel="Chapter" title="7.4.5 AddAuthName">
<link href="#rfc.section.7.4.6" rel="Chapter" title="7.4.6 RemoveAuthName">
<link href="#rfc.section.8" rel="Chapter" title="8 Recommended Usage">
<link href="#rfc.section.9" rel="Chapter" title="9 Compatibility">
<link href="#rfc.section.10" rel="Chapter" title="10 Authentication Name Types">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 Kerberos V4">
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 GSSAPI Export Names">
<link href="#rfc.section.10.3" rel="Chapter" title="10.3 Authentication Name Type Rewriting">
<link href="#rfc.section.10.3.1" rel="Chapter" title="10.3.1 Kerberos 4 Name Rewriting">
<link href="#rfc.section.10.3.2" rel="Chapter" title="10.3.2 Kerberos 5 Name Rewriting">
<link href="#rfc.section.11" rel="Chapter" title="11 Security Considerations">
<link href="#rfc.section.12" rel="Chapter" title="12 IANA Considerations">
<link href="#rfc.section.13" rel="Chapter" title="13 AFS-3 Registry Considerations">
<link href="#rfc.section.14" rel="Chapter" title="14 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="15 References">
<link href="#rfc.references.1" rel="Chapter" title="15.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="15.2 Informational References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document describes the extension of the format, use and communication of authentication names in the AFS-3 protocol to allow for additional authentication mechanisms to be represented and mapped to AFS IDs, independent of the AFS usernames currently used for management of PRDB entries.  The new interface provides mechanisms for adding, removing, and listing mappings, and to allow the fileserver to map an authentication name to a PTS identity." />
  <meta name="description" content="This document describes the extension of the format, use and communication of authentication names in the AFS-3 protocol to allow for additional authentication mechanisms to be represented and mapped to AFS IDs, independent of the AFS usernames currently used for management of PRDB entries.  The new interface provides mechanisms for adding, removing, and listing mappings, and to allow the fileserver to map an authentication name to a PTS identity." />
  <meta name="keywords" content="I-D, Internet-Draft, AFS3, AFS-3, PTS, authentication, GSSAPI, Kerberos" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">N/A</td>
<td class="right">D. Brashear</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">OpenAFS Project</td>
</tr>
<tr>
<td class="left">Intended status: Experimental Protocol</td>
<td class="right">March 07, 2011</td>
</tr>
<tr>
<td class="left">Expires: September 08, 2011</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Authentication Name Mapping extension for AFS-3 Protection Service<br />
  <span class="filename">draft-brashear-afs3-pts-extended-names-08</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes the extension of the format, use and communication of authentication names in the AFS-3 protocol to allow for additional authentication mechanisms to be represented and mapped to AFS IDs, independent of the AFS usernames currently used for management of PRDB entries.  The new interface provides mechanisms for adding, removing, and listing mappings, and to allow the fileserver to map an authentication name to a PTS identity.</p>
<p>The IETF has been notified of intellectual property rights claimed in regard to some or all of the specification contained in this document.  For more information consult the online list of claimed rights.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 08, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Conventions Used in this Document</a>
</li>
<li>3.   <a href="#rfc.section.3">Background information on operation of AFS</a>
</li>
<li>4.   <a href="#rfc.section.4">Error Codes</a>
</li>
<li>5.   <a href="#rfc.section.5">Existing Protocol Constants</a>
</li>
<li>6.   <a href="#rfc.section.6">Existing Per-Identity Permission Flags</a>
</li>
<li>7.   <a href="#rfc.section.7">RPC Interface</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">New Data Types</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">Authentication Name Types</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">GetCapabilities RPC</a>
</li>
<li>7.4.   <a href="#rfc.section.7.4">Authentication name mapping RPCs</a>
</li>
<li>7.4.1.   <a href="#rfc.section.7.4.1">AuthNameToID</a>
</li>
<li>7.4.2.   <a href="#rfc.section.7.4.2">AuthNameToIDFallback</a>
</li>
<li>7.4.3.   <a href="#rfc.section.7.4.3">ListAuthNames</a>
</li>
<li>7.4.4.   <a href="#rfc.section.7.4.4">WhoAmI</a>
</li>
<li>7.4.5.   <a href="#rfc.section.7.4.5">AddAuthName</a>
</li>
<li>7.4.6.   <a href="#rfc.section.7.4.6">RemoveAuthName</a>
</li>
<li>8.   <a href="#rfc.section.8">Recommended Usage</a>
</li>
<li>9.   <a href="#rfc.section.9">Compatibility</a>
</li>
<li>10.   <a href="#rfc.section.10">Authentication Name Types</a>
</li>
<li>10.1.   <a href="#rfc.section.10.1">Kerberos V4</a>
</li>
<li>10.2.   <a href="#rfc.section.10.2">GSSAPI Export Names</a>
</li>
<li>10.3.   <a href="#rfc.section.10.3">Authentication Name Type Rewriting</a>
</li>
<li>10.3.1.   <a href="#rfc.section.10.3.1">Kerberos 4 Name Rewriting</a>
</li>
<li>10.3.2.   <a href="#rfc.section.10.3.2">Kerberos 5 Name Rewriting</a>
</li>
<li>11.   <a href="#rfc.section.11">Security Considerations</a>
</li>
<li>12.   <a href="#rfc.section.12">IANA Considerations</a>
</li>
<li>13.   <a href="#rfc.section.13">AFS-3 Registry Considerations</a>
</li>
<li>14.   <a href="#rfc.section.14">Acknowledgments</a>
</li>
<li>15.   <a href="#rfc.references">References</a>
</li>
<li>15.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>15.2.   <a href="#rfc.references.2">Informational References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">AFS-3 provides an authentication ID mapping service to map authentication system names in Kerberos Version 4 format to AFS-3 numeric identifiers. An augmented Kerberos 4 server was historically part of the AFS-3 protocol and service suite.</p>
<p id="rfc.section.1.p.2">Security issues with Kerberos 4 as well as additional development in the space of authentication systems has created the need to map authentication names from other deployed systems to AFS identifiers. Some deployments provide several mechanisms to obtain AFS authentication. While mappings between Kerberos 4 and <a href="#RFC4120">Kerberos 5</a> <cite title="NONE">[RFC4120]</cite> authentication names allow use of most Kerberos 5 deployments with AFS, supporting more than a single realm requires matching usernames in all realms.  Additionally, support for other systems is not provided at all.</p>
<p id="rfc.section.1.p.3">An administrator or a user may know which authentication identities belong to the same individual, service, or role. However, not all deployments need to support interactive remapping; one use case could involve re-exporting another naming service via the AFS-3 PTS protocol, in which case only the name to identifier and identifier to name services would be provided.</p>
<p id="rfc.section.1.p.4">The deployment implications for a mapping service are described below in <a href="#recommended_usage">Section 8</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Conventions Used in this Document</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Background information on operation of AFS</h1>
<p id="rfc.section.3.p.1">AFS is a distributed file system organized administratively into cells.  In current practice, each AFS cell consists of one or more Volume Location Database (VLDB) servers, one or more Protection Service (PTS) servers, and one or more pairs of file servers and volume servers, plus possibly additional services not relevant to this document. Data stored in AFS is divided into collections of files called volumes. An AFS protocol client, when accessing a file within a specific AFS cell, first contacts a VLDB server for that cell to determine the file server for the AFS volume in which that file is located, and then contacts that file server directly to access the file. A client may also need to contact a PTS server for that cell to register before accessing files in that cell. All communication is via remote procedure calls ('RPCs'), both between component servers and between clients and servers.</p>
<p id="rfc.section.3.p.2">Because AFS provides for authenticated access to data, it is necessary to map authentication entities, generally corresponding to users of the AFS file service ('users') or services requiring access to data via the AFS file service ('services'), collectively clients of the AFS file service ('clients'), to AFS authentication identifiers ('AFS IDs'). The PTS service is used to provide this service to the file server when required, typically when a client first contacts a file server with a new authentication context, including unauthenticated. AFS originally included a Kerberos authentication (KA) server implementing the Kerberos 4 protocol as well as the AFS-3 KA protocol for obtaining authentication information. Because of this, PTS authentication names take the format typically used to represent a Kerberos 4 authentication identity as a string, namely, principal name, followed by a dot and instance if there is an instance, followed by an at-sign and the cell name if the cell is not the local cell.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Error Codes</h1>
<p id="rfc.section.4.p.1">AFS uses a library (com_err) and a tool from the MIT Project Athena suite (compile_et) to generate unique error codes protocol-wide. Codes are generated from a base value computed using a 4 or fewer character string known as an error table, identifying the subset of functionality which generated the error. All error codes are represented as signed 32 bit integers.  The base value for PTS errors is 267264, generated from the error table name 'PT'. All RPCs when implemented are expected to return PTS errors. It is also possible for an implementation to support only part of this proposal. As such, any unimplemented RPCs should return error -455 (RXGEN_OPCODE), the error indicating an RPC is unsupported. No new errors are defined as part of this draft.</p>
<p id="rfc.section.4.p.2">The existing error code PRPERM shall be used for permission errors due to insufficient privilege when attempting any of the described RPCs.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Existing Protocol Constants</h1>
<p id="rfc.section.5.p.1">When it is necessary to represent an identity which has provided either no authentication information, or information which does not include a corresponding AFS ID, an anonymous ID is defined and used.</p>
<div id="#rfc.figure.1"></div>
<pre>
      #define      ANONYMOUSID     32766
      </pre>
<p id="rfc.section.5.p.2">The AFS ID 32766 shall be returned when an authentication name is unknown.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Existing Per-Identity Permission Flags</h1>
<p id="rfc.section.6.p.1">The PTS service includes a basic security model based around defined access flags. The flags are represented as 5 fields, each of which can have 3 values. One of these fields, the "s" field, is used to control who can get information about the entity. Valid values are 'S', which maps to PRP_STATUS_ANY, meaning anyone can get the information; 's', which maps to PRP_STATUS_MEM, meaning only members, the entity owner, and administrators can get the information; and '-' (or unset), meaning only the entity owner and administrators can get the information.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#rpcs_defined" id="rpcs_defined">RPC Interface</a>
</h1>
<p id="rfc.section.7.p.1">Six new RPCs are defined for the AFS PTS service. Five of these are used to manipulate data related to authentication names, while the sixth is a general-purpose RPC to be used for capabilities indication. Additionally, several new data types are defined to allow representation of authentication names and identifiers in these new RPCs.</p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> New Data Types</h1>
<p id="rfc.section.7.1.p.1">In order to represent a set of AFS IDs, the nidlist type is defined. AFS IDs are expected to be enhanced to allow a larger set of IDs concurrently with this advancement of this proposal.</p>
<div id="#rfc.figure.2"></div>
<pre>
      typedef afs_int64 nidlist&lt;&gt;;
      </pre>
<p id="rfc.section.7.1.p.2">A list of AFS IDs, represented as 64 bit integers.</p>
<p id="rfc.section.7.1.p.3">Authentication names are expected to be mechanism-specific.  Thus an authentication-type agnostic data structure must be provided to represent these names. An implementing server MUST be able to use a bitwise comparison operation on the data portion of a PrAuthName. Support for all available name types is not expected.</p>
<div id="#rfc.figure.3"></div>
<pre>
      #define AUTHDATAMAX 2048 
      #define AUTHPRINTABLEMAX 2048 
      struct PrAuthName { 
        afs_int32 kind; 
        opaque data&lt;AUTHDATAMAX&gt;; 
        opaque display&lt;AUTHPRINTABLEMAX&gt;; };
      </pre>
<p id="rfc.section.7.1.p.4">It is expected that some mechanisms will provide name data which is not human-readable, or is any single format is sufficient to represent all possible mechanism authentication names. Therefore the PrAuthName data structure includes an integer tag denoting type, and an opaque data object representing the mechanism-specific authentication name data.  The display portion is to be used for display to end-users, and MUST NOT be used for comparison purposes. If a display portion is not provided, the data portion MUST NOT be used directly for user display purposes. A client with knowledge of the particular name type used MAY use the data portion to derive a suitable display name, if none is provided.</p>
<div id="#rfc.figure.4"></div>
<pre>
      typedef struct PrAuthName authnamelist&lt;&gt;;
      </pre>
<p id="rfc.section.7.1.p.5">Each AFS ID is expected to have more than one name mapped to it, possibly with more than one name of each type assigned to each.  It is therefore necessary to support a list of PrAuthNames.</p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> Authentication Name Types</h1>
<p id="rfc.section.7.2.p.1">The PrAuthName data type includes a 32 bit integer field to represent the kind of authentication being mapped. It is proposed that in addition to mappings for legacy Kerberos 4 based AFS names, that the first version of this additionally include mappings for Kerberos 5-based and GSSAPI-based authentication names.</p>
<div id="#rfc.figure.5"></div>
<pre>
      #define PRAUTHTYPE_KRB4 1
      #define PRAUTHTYPE_GSS 2
      </pre>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> GetCapabilities RPC</h1>
<p id="rfc.section.7.3.p.1">As with other AFS services, the PTS service could be enhanced with the ability to represent new abilities to file servers and clients. We propose a new general-purpose RPC of the type implemented by other AFS services, namely, a bit stream.  It is proposed that the first 32 bits be allocated to capabilities flags, while the remainder be reserved for future standardisation.</p>
<p id="rfc.section.7.3.p.2">A complying server MUST implement GetCapabilities.</p>
<div id="#rfc.figure.6"></div>
<pre>
      const PTSCAPABILITIESMAX = 196;
      typedef afs_uint32 PrCapabilities&lt;PTSCAPABILITIESMAX&gt;;

      const PTS_CAPABILITY_AUTHNAMEMAPPING       = 1;

      GetCapabilities(
      PrCapabilities *prcapabilities
      ) multi = 65536;
      </pre>
<p id="rfc.section.7.3.p.3">An implementing server should return any capabilities data it wishes to advertise. A server may choose to not advertise the same capabilities to all callers; For instance, the set of capabilities advertised to an authenticated caller may be different than the set advertised to an anonymous caller. In addition to the bitstream, return value is 0 for success, or a PTS error in the event of error.</p>
<h1 id="rfc.section.7.4">
<a href="#rfc.section.7.4">7.4.</a> Authentication name mapping RPCs</h1>
<p id="rfc.section.7.4.p.1">In addition to the general-purpose (GetCapabilities) RPC needed to represent this extended functionality, a complying server will include RPCs to represent the mapping of extended names to AFS IDs.</p>
<h1 id="rfc.section.7.4.1">
<a href="#rfc.section.7.4.1">7.4.1.</a> AuthNameToID</h1>
<p id="rfc.section.7.4.1.p.1">A complying server MUST implement the AuthNameToID RPC.  This RPC is used to convert one or more authentication names, obtained by a file server or client in a mechanism-specific manner, to AFS IDs.</p>
<div id="#rfc.figure.7"></div>
<pre>
      AuthNameToID(IN authnamelist *alist,
                   OUT nidlist *ilist) = 65537;
      </pre>
<p id="rfc.section.7.4.1.p.2">For each authname provided in alist, an AFS ID will be provided in ilist at the corresponding position. Where an authentication name cannot be looked up, the AFS ID in list will be ANONYMOUSID.</p>
<p id="rfc.section.7.4.1.p.3">On success of the call, 0 shall be returned. Success includes calls where none of the identities provided in authnamelist can be mapped to AFS IDs.</p>
<p id="rfc.section.7.4.1.p.4">A client being used to manipulate mappings SHOULD use this RPC to discover the existing mapping, if any, for a given authentication name.  A caller using the mapping service for service operation SHOULD instead call AuthNameToIDFallback.  </p>
<h1 id="rfc.section.7.4.2">
<a href="#rfc.section.7.4.2">7.4.2.</a> AuthNameToIDFallback</h1>
<p id="rfc.section.7.4.2.p.1">A complying server MUST implement the AuthNameToIDFallback RPC.  This RPC is used to convert one or more authentication names, obtained by a file server or client in a mechanism-specific manner, to AFS IDs to be used in making authorization decisions related to the named authentication identities.</p>
<div id="#rfc.figure.8"></div>
<pre>
      AuthNameToIDFallback(IN authnamelist *alist,
                   OUT nidlist *ilist) = 65538;
      </pre>
<p id="rfc.section.7.4.2.p.2">For each authname provided in alist, an AFS ID will be provided in ilist at the corresponding position. Implicit fallback mappings will be used to map identities where no explicit mapping is provided. Where neither an explicit nor implicit mapping is available, the AFS ID in ilist will be ANONYMOUSID.</p>
<p id="rfc.section.7.4.2.p.3">An explicit mapping is one that can be configured, represented, and returned by the protocol defined in this document. An implicit mapping is site- or implementation-specific. Examples of implicit mapping would be translation of a client authenticating as Kerberos 5 principal user@REALM to a PTS name of user, and of a client authenticating as Kerberos 5 principal</p>
<p id="rfc.section.7.4.2.p.4">On success of the call, 0 shall be returned. Success includes calls where none of the identities provided in authnamelist can be mapped to AFS IDs.</p>
<p id="rfc.section.7.4.2.p.5">A caller using the mapping service for service operation SHOULD use this RPC. A client being used to manipulate mappings SHOULD use AuthNameToID instead.</p>
<h1 id="rfc.section.7.4.3">
<a href="#rfc.section.7.4.3">7.4.3.</a> ListAuthNames</h1>
<p id="rfc.section.7.4.3.p.1">A complying server SHOULD implement the ListAuthNames RPC.  This RPC is used to list all authentication names attached to the provided AFS ID.</p>
<div id="#rfc.figure.9"></div>
<pre>
      ListAuthNames(IN afs_int64 id, OUT authnamelist *alist)
                   = 65539;
      </pre>
<p id="rfc.section.7.4.3.p.2">On success, 0 shall be returned, along with the list of authentication names in alist corresponding to the AFS ID provided in id.</p>
<h1 id="rfc.section.7.4.4">
<a href="#rfc.section.7.4.4">7.4.4.</a> WhoAmI</h1>
<p id="rfc.section.7.4.4.p.1">A complying server SHOULD implement the WhoAmI RPC.  This RPC is used to return the current authentication name and AFS ID for a caller to the caller.</p>
<div id="#rfc.figure.10"></div>
<pre>
      WhoAmI(OUT afs_int64 id, OUT struct PrAuthName *alist) = 65540;
      </pre>
<p id="rfc.section.7.4.4.p.2">On success, 0 shall be returned, along with the identity and authentication name corresponding to the caller of the RPC.</p>
<h1 id="rfc.section.7.4.5">
<a href="#rfc.section.7.4.5">7.4.5.</a> AddAuthName</h1>
<p id="rfc.section.7.4.5.p.1">A complying server MAY implement the AddAuthName RPC.  This RPC is used to add an authentication name to an existing AFS ID.</p>
<div id="#rfc.figure.11"></div>
<pre>
      AddAuthName(IN afs_int64 id, IN PrAuthName *aname) = 65541;
      </pre>
<p id="rfc.section.7.4.5.p.2">On success, 0 shall be returned. If the authentication name provided is already mapped to another AFS ID, PREXIST shall be returned. If the AFS ID specified does not exist, PRNOENT shall be returned.</p>
<h1 id="rfc.section.7.4.6">
<a href="#rfc.section.7.4.6">7.4.6.</a> RemoveAuthName</h1>
<p id="rfc.section.7.4.6.p.1">A complying server MAY implement the RemoveAuthName RPC.  This RPC is used to remove an authentication name from an existing AFS ID.</p>
<div id="#rfc.figure.12"></div>
<pre>
      RemoveAuthName(IN PrAuthName *aname) = 65542;
      </pre>
<p id="rfc.section.7.4.6.p.2">On success, 0 shall be returned. If the authentication name provided is not mapped, PRNOENT shall be returned.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#recommended_usage" id="recommended_usage">Recommended Usage</a>
</h1>
<p id="rfc.section.8.p.1">Two classes of service providers are possible. In one, where data is provided in a read-only fashion from an alternate authorization service, only the AuthNameToID and ListAuthNames RPCs are required. In the other, all RPCs are needed, such that mappings can be constructed and maintained.</p>
<p id="rfc.section.8.p.2">The ListAuthNames operation should be permitted for administrators as well as for the owner of the entry to be listed. If the 'S' (PRP_STATUS_ANY) bit is set on the entry, then other users may also perform this operation.</p>
<p id="rfc.section.8.p.3">The AddAuthName and RemoveAuthName operations should always be permitted for administrators, and should normally also be permitted for the owner of the entry to be updated. For RemoveAuthName, the entry being updated is always the one to which the specified name currently maps, and should be an identity which is not the one being removed. Regardless, any given authentication name can map only to one ID; attempting to add (via AddAuthName) a second mapping for the same authentication name MUST fail.</p>
<p id="rfc.section.8.p.4">The AuthNameToID operation is analogous to the existing NameToID operation, and like that, should be able to be used by anyone.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Compatibility</h1>
<p id="rfc.section.9.p.1">An implementation of the AFS protection service protocol implementing these extensions shall indicate this by including in the response to a GetCapabilities PTS RPC the capability flag PTS_CAPABILITY_AUTHNAMEMAPPING.  </p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Authentication Name Types</h1>
<p id="rfc.section.10.p.1">While the authentication name is an opaque type with respect to the AFS-3 protocol, it is recommended that the following definitions be used for the proposed types described herein.</p>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> Kerberos V4</h1>
<p id="rfc.section.10.1.p.1">The format of the Kerberos V4 name type is either name@REALM or name.inst@REALM, depending on whether a non-null instance is present. In both cases the trailing NUL character is *not* part of the authentication name data.</p>
<h1 id="rfc.section.10.2">
<a href="#rfc.section.10.2">10.2.</a> GSSAPI Export Names</h1>
<p id="rfc.section.10.2.p.1">The format of the GSSAPI name type is that described in section 3.2 of <a href="#RFC2743">[RFC2743]</a>.  The data opaque object will contain the GSSAPI canonical name as generated by GSS_Export_name after GSS_Canonicalize_name.  The display opaque object will contain the GSSAPI display name type and name string as generated by GSS_Display_name. The display name MUST only be used for printing; the canonical name MUST NOT be used for printing.</p>
<h1 id="rfc.section.10.3">
<a href="#rfc.section.10.3">10.3.</a> Authentication Name Type Rewriting</h1>
<h1 id="rfc.section.10.3.1">
<a href="#rfc.section.10.3.1">10.3.1.</a> Kerberos 4 Name Rewriting</h1>
<p id="rfc.section.10.3.1.p.1">When Kerberos 4 is used, the Kerberos name type must be used.  In particular, Kerberos 4 principal names MUST NOT be represented as Kerberos 5 names or vice versa.  </p>
<h1 id="rfc.section.10.3.2">
<a href="#rfc.section.10.3.2">10.3.2.</a> Kerberos 5 Name Rewriting</h1>
<div id="#rfc.figure.13"></div>
<pre>
       04 01 00 0B 06 09 2A 86 48 86 F7 12 01 02 02 HX XX XX XL
       </pre>
<div id="#rfc.figure.14"></div>
<pre>
       HX XX XX XL
       </pre>
<p id="rfc.section.10.3.2.p.1">When Kerberos 5 is used, with or without the GSSAPI, Kerberos 5 principal names MUST be represented using the GSSAPI export name type with the Kerberos mechanism OID.  Servers accepting Kerberos 5 without GSSAPI MUST convert to a GSSAPI Kerberos 5 export name using the Kerberos mechanism OID before calling AuthNameToID. This is intended to allow all users of Kerberos 5 as an authentication mechanism, regardless of bindings, to use the same authentication name.  Implementations which do not support GSSAPI can support this by preparing a name as specified in section 2.1.1 of <a href="#RFC1964">[RFC1964]</a>, subject to the constraints in section 2.1.3. This string, when prefixed with the sequence of octets </p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> Security Considerations</h1>
<p id="rfc.section.11.p.1">Allowing AuthNameToID to be used by any caller exposes information about whether an authentication name is mapped at all, or, indeed, exists. In some environments, this information may be considered privileged.</p>
<p id="rfc.section.11.p.2">Allowing a user to add arbitrary mappings to their identity via AddAuthName may allow unintended permissions to be granted if the user makes a mistake when mapping identities to the AFS identity in question.</p>
<p id="rfc.section.11.p.3">Because a server is not required to know about all available name types, display names are provided by the caller to AddAuthName. It is possible to provide an erroneous display name whether for malicious or benign reasons. In either case, making a decision based on the display name may result in problems.</p>
<h1 id="rfc.section.12">
<a href="#rfc.section.12">12.</a> IANA Considerations</h1>
<p id="rfc.section.12.p.1">This document doesn't require any IANA registrations.</p>
<h1 id="rfc.section.13">
<a href="#rfc.section.13">13.</a> AFS-3 Registry Considerations</h1>
<p id="rfc.section.13.p.1">This document requires the registration of the new RPCs as provided in the section <a href="#rpcs_defined">Section 7</a> above, as well as new registries for PTS capabilities and for name types, also as above.</p>
<h1 id="rfc.section.14">
<a href="#rfc.section.14">14.</a> Acknowledgments</h1>
<p id="rfc.section.14.p.1">The author thanks Magnus Ahltorp, Love H&#246;rnquist &#197;strand, and Jeffrey T. Hutzelman for their work on the scope of this enhancement, the attendees of the 2009 AFS hackathon in Edinburgh, notably Marcus Watts and Simon Wilkinson, for their assistance in defining the name object for GSSAPI, and Jeffrey T.  Hutzelman and Simon Wilkinson discussion of an acceptable means for representing Kerberos 5 names consistently regardless of mechanism.</p>
<h1 id="rfc.references">
<a href="#rfc.references">15.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">15.1.</a> Normative References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr></tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">15.2.</a> Informational References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC1964">[RFC1964]</b></td>
<td class="top">
<a href="mailto:John.Linn@ov.com" title="OpenVision Technologies">Linn, J.</a>, "<a href="http://tools.ietf.org/html/rfc1964">The Kerberos Version 5 GSS-API Mechanism</a>", RFC 1964, June 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2743">[RFC2743]</b></td>
<td class="top">
<a href="mailto:jlinn@rsasecurity.com" title="RSA Laboratories">Linn, J.</a>, "<a href="http://tools.ietf.org/html/rfc2743">Generic Security Service Application Program Interface Version 2, Update 1</a>", RFC 2743, January 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4120">[RFC4120]</b></td>
<td class="top">
<a>Neuman, C.</a>, <a>Yu, T.</a>, <a>Hartman, S.</a> and <a>K. Raeburn</a>, "<a href="http://tools.ietf.org/html/rfc4120">The Kerberos Network Authentication Service (V5)</a>", RFC 4120, July 2005.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Derrick J. Brashear</span> 
	  <span class="n hidden">
		<span class="family-name">Brashear</span>
	  </span>
	</span>
	<span class="org vcardline">OpenAFS Project</span>
	<span class="adr">
	  <span>2829 Larkins Way</span>

	  <span class="vcardline">
		<span class="locality">Pittsburgh</span>,  
		<span class="region">PA</span> 
		<span class="code">15203</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:shadow@openafs.org">shadow@openafs.org</a></span>

  </address>
</div>

</body>
</html>