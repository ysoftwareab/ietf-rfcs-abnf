<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>ForCES Protocol Specification</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="ForCES Protocol Specification">
<meta name="keywords" content="RFC, Request for Comments, I-D, Internet-Draft, ForCES, Routing, Protocol, ">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">L. Dong</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Zhejiang Gongshang University</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">A. Doria (Ed.)</td></tr>
<tr><td class="header">Expires: May 22, 2009</td><td class="header">Lulea University of Technology</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">R. Gopal</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Nokia</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">R. Haas (Ed.)</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">IBM</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">J. Hadi Salim (Ed.)</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Znyx</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">H. Khosravi (Ed.)</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Intel</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">W. M. Wang (Ed.)</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Zhejiang Gongshang University</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">November 18, 2008</td></tr>
</table></td></tr></table>
<h1><br />ForCES Protocol Specification<br />draft-ietf-forces-protocol-19.txt</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 22, 2009.</p>

<h3>Abstract</h3>

<p>This document specifies the Forwarding and Control Element Separation
      (ForCES) protocol. ForCES protocol is used for communications between
      Control Elements(CEs) and Forwarding Elements (FEs) in a ForCES Network
      Element (ForCES NE). This specification is intended to meet the ForCES
      protocol requirements defined in RFC3654. Besides the ForCES protocol,
      this specification also defines the requirements for 
      the Transport Mapping Layer (TML).
      
</p>
<h3>Authors</h3>

<p>The participants in the ForCES Protocol Team, primary co-authors and
      co-editors, of this protocol specification, are:
      
</p>
<p>Ligang Dong (Zhejiang Gongshang University), Avri Doria (Lulea
      University of Technology), Ram Gopal (Nokia), Robert Haas (IBM), Jamal
      Hadi Salim (Znyx), Hormuzd M Khosravi (Intel), and Weiming Wang
      (Zhejiang Gongshang University). Special acknowledgement goes to Joel Halpern
      who has done extensive editing in support of congruence between the model 
      and
      this protocol specification.  Without his participation and persistence, 
      this specification might
      never have been completed.
      
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Terminology and Conventions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Requirements Language<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.</a>&nbsp;
Other Notation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">1.3.</a>&nbsp;
Integers<br />
<a href="#anchor5">2.</a>&nbsp;
Introduction<br />
<a href="#Definitions">3.</a>&nbsp;
Definitions<br />
<a href="#Overview">4.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.1.</a>&nbsp;
Protocol Framework<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.1.1.</a>&nbsp;
The PL <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.1.2.</a>&nbsp;
The TML <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">4.1.3.</a>&nbsp;
The FEM/CEM Interface<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#FPP">4.2.</a>&nbsp;
ForCES Protocol Phases<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Pre_Association">4.2.1.</a>&nbsp;
Pre-association<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">4.2.2.</a>&nbsp;
Post-association<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#protmech">4.3.</a>&nbsp;
Protocol Mechanisms<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#taer">4.3.1.</a>&nbsp;
Transactions, Atomicity, Execution and Responses<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">4.3.2.</a>&nbsp;
Scalability<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#HB_appr">4.3.3.</a>&nbsp;
Heartbeat Mechanism<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#FE_Object">4.3.4.</a>&nbsp;
FE Object and FE Protocol LFBs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Proto_Scene">4.4.</a>&nbsp;
Protocol Scenarios<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">4.4.1.</a>&nbsp;
Association Setup State<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">4.4.2.</a>&nbsp;
Association Established state or Steady State<br />
<a href="#TML_Req">5.</a>&nbsp;
TML Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">5.1.</a>&nbsp;
TML Parameterization<br />
<a href="#msg_encap">6.</a>&nbsp;
Message Encapsulation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Common_Header">6.1.</a>&nbsp;
Common Header<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tlv_ref">6.2.</a>&nbsp;
Type Length Value (TLV) Structuring <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ntlv_ref">6.2.1.</a>&nbsp;
Nested TLVs <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stlv_ref">6.2.2.</a>&nbsp;
Scope of the T in TLV <br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ilv_ref">6.3.</a>&nbsp;
ILV <br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Proto_cons">6.4.</a>&nbsp;
Important Protocol encapsulations<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#paths">6.4.1.</a>&nbsp;
Paths<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Keys">6.4.2.</a>&nbsp;
Keys<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pdata1">6.4.3.</a>&nbsp;
DATA TLVs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#addressing">6.4.4.</a>&nbsp;
Addressing LFB entities<br />
<a href="#Proto_Msg">7.</a>&nbsp;
Protocol Construction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#gd_def">7.1.</a>&nbsp;
Discussion on encoding<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pack_def">7.1.1.</a>&nbsp;
Data Packing Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pat_flags">7.1.2.</a>&nbsp;
Path Flags<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ret_flags">7.1.3.</a>&nbsp;
Relation of operational flags with global message flags<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#keys">7.1.4.</a>&nbsp;
Content Path Selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#LFBselectTLV">7.1.5.</a>&nbsp;
LFBselect-TLV<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#OTLV">7.1.6.</a>&nbsp;
OPER-TLV<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#RTLV">7.1.7.</a>&nbsp;
RESULT TLV<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DTLV">7.1.8.</a>&nbsp;
DATA TLV<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#SGR">7.1.9.</a>&nbsp;
SET and GET Relationship<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#vis_def">7.2.</a>&nbsp;
Protocol Encoding Visualization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#LFB_def">7.3.</a>&nbsp;
Core ForCES LFBs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#FPL_sum">7.3.1.</a>&nbsp;
FE Protocol LFB<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#FEO">7.3.2.</a>&nbsp;
FE Object LFB<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor37">7.4.</a>&nbsp;
Semantics of Message Direction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor38">7.5.</a>&nbsp;
Association Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Asso_Setup">7.5.1.</a>&nbsp;
Association Setup Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Assoc_Setup_Resp">7.5.2.</a>&nbsp;
Association Setup Response Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Assoc_Tear_Resp">7.5.3.</a>&nbsp;
Association Teardown Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor40">7.6.</a>&nbsp;
Configuration Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#CfgMsg">7.6.1.</a>&nbsp;
Config Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Config_Response">7.6.2.</a>&nbsp;
Config Response Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#QueryMsg">7.7.</a>&nbsp;
Query Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Query">7.7.1.</a>&nbsp;
Query Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#QueryResponse">7.7.2.</a>&nbsp;
Query Response Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#EventMsg">7.8.</a>&nbsp;
Event Notification Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#RedirectMsg">7.9.</a>&nbsp;
Packet Redirect Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#HBMsg">7.10.</a>&nbsp;
Heartbeat Message<br />
<a href="#HA">8.</a>&nbsp;
High Availability Support<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#FEPOHA">8.1.</a>&nbsp;
Relation with the FE Protocol <br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor41">8.2.</a>&nbsp;
Responsibilities for HA<br />
<a href="#Security">9.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor42">9.1.</a>&nbsp;
No Security<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#NS-Endpoint-auth">9.1.1.</a>&nbsp;
Endpoint Authentication<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#NS-Msg-Auth">9.1.2.</a>&nbsp;
Message Authentication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#PL-TML-sec-svc">9.2.</a>&nbsp;
ForCES PL and TML security service<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor43">9.2.1.</a>&nbsp;
Endpoint authentication service<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor44">9.2.2.</a>&nbsp;
Message authentication service<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor45">9.2.3.</a>&nbsp;
Confidentiality service<br />
<a href="#anchor46">10.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">11.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">11.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">11.2.</a>&nbsp;
Informational References<br />
<a href="#anchor49">Appendix&nbsp;A.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#MSGt_Def">A.1.</a>&nbsp;
Message Type Name Space<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#OPERt_Def">A.2.</a>&nbsp;
Operation Selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor50">A.3.</a>&nbsp;
Header Flags<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor51">A.4.</a>&nbsp;
TLV Type Name Space<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor52">A.5.</a>&nbsp;
Result-TLV Result Values<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor53">A.6.</a>&nbsp;
Association Setup Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor54">A.7.</a>&nbsp;
Association Teardown Message<br />
<a href="#FPL_def">Appendix&nbsp;B.</a>&nbsp;
ForCES Protocol LFB schema<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor55">B.1.</a>&nbsp;
Capabilities<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor56">B.2.</a>&nbsp;
Components<br />
<a href="#DataencExam">Appendix&nbsp;C.</a>&nbsp;
Data Encoding Examples<br />
<a href="#use_cases">Appendix&nbsp;D.</a>&nbsp;
Use Cases<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Terminology and Conventions</h3>

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Other Notation</h3>

<p>In <a class='info' href='#PMsgt'>Table&nbsp;1</a> and 
         <a class='info' href='#FSt'>Table&nbsp;2</a> the following notation is used to
         indicate multiplicity:
</p>
<p>
      </p>
<blockquote class="text">
<p> (value)+ .... means "1 or more instance of value"
</p>
<p> (value)* .... means "0 or more instance of value"
</p>
</blockquote><p>
      
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Integers</h3>

<p>
	All integers are to be coded as unsigned binary integers of appropriate length.
      
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction</h3>

<p>Forwarding and Control Element Separation (ForCES) defines an
      architectural framework and associated protocols to standardize
      information exchange between the control plane and the forwarding plane
      in a ForCES Network Element (ForCES NE). RFC 3654 has defined the ForCES
      requirements, and RFC 3746 has defined the ForCES framework. While there
      may be multiple protocols used within the overall ForCES architecture,
      the term "ForCES protocol" and "protocol" as used in this document
      refers to the protocol used to standardize the information exchange
      between Control Elements (CEs) and Forwarding Elements (FEs) only. 
</p>
<p>The ForCES FE model <a class='info' href='#FE-MODEL'>[FE&#8209;MODEL]<span> (</span><span class='info'>Yang, L., Halpern, J., Gopal, R., DeKok, A., Haraszti, Z., and S. Blake, &ldquo;ForCES Forwarding Element Model,&rdquo; Feb.&nbsp;2005.</span><span>)</span></a> presents 
      a formal way to define FE Logical Function Blocks (LFBs) using XML.
      LFB configuration components, capabilities, and associated events are
      defined when the LFB is formally created. The LFBs within the FE are
      accordingly controlled in a standardized way by the ForCES protocol.
</p>
<p>This document defines the ForCES protocol specifications. The ForCES
      protocol works in a master-slave mode in which FEs are slaves and CEs 
      are masters.  The protocol includes commands for transport of Logical 
      Function Block (LFB) configuration information, association setup, 
      status, and event notifications, etc.
</p>
<p><a class='info' href='#Definitions'>Section&nbsp;3<span> (</span><span class='info'>Definitions</span><span>)</span></a> provides a glossary of terminology
      used in the specification.
</p>
<p><a class='info' href='#Overview'>Section&nbsp;4<span> (</span><span class='info'>Overview</span><span>)</span></a> provides an overview of the protocol,
      including a discussion on the protocol framework, descriptions of the
      Protocol Layer (PL) and a Transport Mapping Layer (TML), as well as of
      the ForCES protocol mechanisms.
      <a class='info' href='#Proto_Scene'>Section&nbsp;4.4<span> (</span><span class='info'>Protocol Scenarios</span><span>)</span></a> describes several Protocol
      scenarios and includes message exchange descriptions.
</p>
<p>While this document does not define the TML, <a class='info' href='#TML_Req'>Section&nbsp;5<span> (</span><span class='info'>TML Requirements</span><span>)</span></a> details the services that a TML must provide
      (TML requirements).
</p>
<p>The ForCES protocol defines a common header for all protocol
      messages. The header is defined in <a class='info' href='#Common_Header'>Section&nbsp;6.1<span> (</span><span class='info'>Common Header</span><span>)</span></a>,
      while the protocol messages are defined in <a class='info' href='#Proto_Msg'>Section&nbsp;7<span> (</span><span class='info'>Protocol Construction</span><span>)</span></a>.
</p>
<p><a class='info' href='#HA'>Section&nbsp;8<span> (</span><span class='info'>High Availability Support</span><span>)</span></a> describes the protocol support for
      high availability mechanisms including redundancy and fail over.
      
</p>
<p>
      <a class='info' href='#Security'>Section&nbsp;9<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> defines the security mechanisms provided
      by the PL and TML.
</p>
<a name="Definitions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Definitions</h3>

<p>This document follows the terminology defined by the ForCES
      Requirements in <a class='info' href='#RFC3654'>[RFC3654]<span> (</span><span class='info'>Khosravi, H. and T. Anderson, &ldquo;Requirements for Separation of IP Control and Forwarding,&rdquo; November&nbsp;2003.</span><span>)</span></a> and by the ForCES
      framework in <a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a>.  The definitions below are repeated below for clarity.
</p>
<p>Addressable Entity (AE) - A physical device that is directly
      addressable given some interconnect technology. For example, on IP
      networks, it is a device which can be reached using an IP address; and
      on a switch fabric, it is a device which can be reached using a switch
      fabric port number.
</p>
<p>Control Element (CE) - A logical entity that implements the ForCES
      protocol and uses it to instruct one or more FEs on how to process
      packets. CEs handle functionality such as the execution of control and
      signaling protocols.
</p>
<p>CE Manager (CEM) - A logical entity responsible for generic CE
      management tasks. It is particularly used during the pre-association
      phase to determine with which FE(s) a CE should communicate. This
      process is called FE discovery and may involve the CE manager learning
      the capabilities of available FEs. 
</p>
<p>Datapath - A conceptual path taken by packets within the forwarding
      plane inside an FE.
</p>
<p>Forwarding Element (FE) - A logical entity that implements the ForCES
      protocol. FEs use the underlying hardware to provide per-packet
      processing and handling as directed/controlled by one or
      more CEs via the ForCES
      protocol.
</p>
<p>FE Model - A model that describes the logical processing functions of
      an FE. The FE model is defined using Logical Function Blocks (LFBs). 
</p>
<p>FE Manager (FEM) - A logical entity responsible for generic FE
      management tasks. It is used during pre-association phase to determine
      with which CE(s) an FE should communicate. This process is called CE
      discovery and may involve the FE manager learning the capabilities of
      available CEs. An FE manager may use anything from a static
      configuration to a pre-association phase protocol (see below) to
      determine which CE(s) to use. Being a logical entity, an FE manager
      might be physically combined with any of the other logical entities such
      as FEs.
</p>
<p>ForCES Network Element (NE) - An entity composed of one or more CEs
      and one or more FEs. To entities outside an NE, the NE represents a
      single point of management. Similarly, an NE usually hides its internal
      organization from external entities.
</p>
<p>High Touch Capability - This term will be used to apply to the
      capabilities found in some forwarders to take action on the contents or
      headers of a packet based on content other than what is found in the IP
      header. Examples of these capabilities include 
      quality of service policies, virtual private networks, firewall, and L7
      content recognition.
</p>
<p>Inter-FE Topology - See FE Topology.
</p>
<p>Intra-FE Topology - See LFB Topology.
</p>
<p>LFB (Logical Function Block) - The basic building block that is
      operated on by the ForCES protocol. The LFB is a well defined, logically
      separable functional block that resides in an FE and is controlled by
      the CE via ForCES protocol. The LFB may reside at the FE's datapath and
      process packets or may be purely an FE control or configuration entity
      that is operated on by the CE. Note that the LFB is a functionally
      accurate abstraction of the FE's processing capabilities, but not a
      hardware-accurate representation of the FE implementation.
</p>
<p>FE Topology - A representation of how the multiple FEs within a
      single NE are interconnected. Sometimes this is called inter-FE
      topology, to be distinguished from intra-FE topology (i.e., LFB
      topology).
</p>
<p>LFB Class and LFB Instance - LFBs are categorized
      by LFB Classes. An LFB Instance represents an LFB Class (or
      Type) existence. There may be multiple instances of the same LFB Class
      (or Type) in an FE. An LFB Class is represented by an LFB Class ID, and
      an LFB Instance is represented by an LFB Instance ID. As a result, an
      LFB Class ID associated with an LFB Instance ID uniquely specifies an LFB
      existence.
</p>
<p>LFB Metadata - Metadata is used to communicate per-packet state from
      one LFB to another, but is not sent across the network. The FE model
      defines how such metadata is identified, produced and consumed by the
      LFBs. It defines the functionality but not how metadata is encoded
      within an implementation.
</p>
<p>LFB Attribute - Operational parameters of the LFBs that must be
      visible to the CEs are conceptualized in the FE model as the LFB
      attributes. The LFB attributes include, for example, flags, single
      parameter arguments, complex arguments, and tables that the CE can read
      and/or write via the ForCES protocol (see below).
</p>
<p>LFB Topology - Representation of how the LFB instances are logically
      interconnected and placed along the datapath within one FE. Sometimes it
      is also called intra-FE topology, to be distinguished from inter-FE
      topology.
</p>
<p>Pre-association Phase - The period of time during which an FE Manager
      and a CE Manager are determining which FE(s) and
      CE(s) should be part of the same network element.
</p>
<p>Post-association Phase - The period of time during which an FE knows
      which CE is to control it and vice versa. This includes the time during
      which the CE and FE are establishing communication with one another.
</p>
<p>ForCES Protocol - While there may be multiple protocols used within
      the overall ForCES architecture, the term "ForCES protocol" and
      "protocol" refer to the Fp reference points in the ForCES Framework in
      <a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a>. This protocol does not apply to CE-to-CE
      communication, FE-to-FE communication, or to communication between FE
      and CE managers. Basically, the ForCES protocol works in a master-slave
      mode in which FEs are slaves and CEs are masters. This document defines
      the specifications for this ForCES protocol.
</p>
<p>ForCES Protocol Layer (ForCES PL) - A layer in the ForCES protocol
      architecture that defines the ForCES protocol messages, the protocol
      state transfer scheme, as well as the ForCES protocol architecture
      itself (including requirements of ForCES TML as shown below).
      Specifications of ForCES PL are defined by this document.
</p>
<p>ForCES Protocol Transport Mapping Layer (ForCES TML) - A layer in
      ForCES protocol architecture that uses the capabilities of existing
      transport protocols to specifically address protocol message
      transportation issues, such as how the protocol messages are mapped to
      different transport media (like TCP, IP, ATM, Ethernet, etc), and how to
      achieve and implement reliability, multicast, ordering, etc. The ForCES
      TML specifications are detailed in separate ForCES documents, one for
      each TML.
</p>
<a name="Overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Overview</h3>

<p>The reader is referred to the Framework document <a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a>, and in particular sections 3 and 4, for an
      architectural overview and an explanation of how the ForCES protocol
      fits in. There may be some content overlap between the framework
      document and this section in order to provide clarity. This 
      document is authoritative on the protocol whereas <a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a> is authoritative on the architecture.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Protocol Framework</h3>
<br /><hr class="insert" />
<a name="ne_arch"></a>

<p><a class='info' href='#ne_arch'>Figure&nbsp;1<span> (</span><span class='info'>ForCES Architectural Diagram</span><span>)</span></a> below is reproduced from
          the Framework document for clarity. It shows a NE with two CEs and
          two FEs.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                         ---------------------------------------
                         | ForCES Network Element              |
  --------------   Fc    | --------------      --------------  |
  | CE Manager |---------+-|     CE 1   |------|    CE 2    |  |
  --------------         | |            |  Fr  |            |  |
        |                | --------------      --------------  |
        | Fl             |         |  |    Fp       /          |
        |                |       Fp|  |----------| /           |
        |                |         |             |/            |
        |                |         |             |             |
        |                |         |     Fp     /|----|        |
        |                |         |  /--------/      |        |
  --------------     Ff  | --------------      --------------  |
  | FE Manager |---------+-|     FE 1   |  Fi  |     FE 2   |  |
  --------------         | |            |------|            |  |
                         | --------------      --------------  |
                         |   |  |  |  |          |  |  |  |    |
                         ----+--+--+--+----------+--+--+--+-----
                             |  |  |  |          |  |  |  |
                             |  |  |  |          |  |  |  |
                               Fi/f                   Fi/f

       Fp: CE-FE interface
       Fi: FE-FE interface
       Fr: CE-CE interface
       Fc: Interface between the CE Manager and a CE
       Ff: Interface between the FE Manager and an FE
       Fl: Interface between the CE Manager and the FE Manager
       Fi/f: FE external interface
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: ForCES Architectural Diagram&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The ForCES protocol domain is found in the Fp Reference Points. The
        Protocol Element configuration reference points, Fc and Ff also play a
        role in the booting up of the ForCES Protocol. The protocol element
	configuration (indicated by reference points Fc, Ff, and Fl in
	 <a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a> ) is out of
        scope of the ForCES protocol but is touched on in this document in
        discussion of FEM and CEM since it is an integral part of the protocol
        pre-association phase.
</p><br /><hr class="insert" />
<a name="Fp_if"></a>

<p><a class='info' href='#Fp_if'>Figure&nbsp;2<span> (</span><span class='info'>Examples of CE and FE functions</span><span>)</span></a> below shows further breakdown
	 of the Fp interfaces by means of the example of an MPLS QoS
	  enabled Network Element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      -------------------------------------------------
      |       |       |       |       |       |       |
      |OSPF   |RIP    |BGP    |RSVP   |LDP    |. . .  |
      |       |       |       |       |       |       |
      -------------------------------------------------    CE
      |               ForCES Interface                |
      -------------------------------------------------
                              ^   ^
                              |   |
                      ForCES  |   |data
                      control |   |packets
                      messages|   |(e.g., routing packets)
                              |   |
                              v   v
      -------------------------------------------------
      |               ForCES Interface                |
      -------------------------------------------------    FE
      |       |       |       |       |       |       |
      |LPM Fwd|Meter  |Shaper |MPLS   |Classi-|. . .  |
      |       |       |       |       |fier   |       |
      -------------------------------------------------
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Examples of CE and FE functions&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The ForCES Interface shown in <a class='info' href='#Fp_if'>Figure&nbsp;2<span> (</span><span class='info'>Examples of CE and FE functions</span><span>)</span></a>
        constitutes two pieces: the PL and the TML.
</p><br /><hr class="insert" />
<a name="PL_TML_if"></a>

<p>This is depicted in <a class='info' href='#PL_TML_if'>Figure&nbsp;3<span> (</span><span class='info'>ForCES Interface</span><span>)</span></a>
          below.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      +------------------------------------------------
      |               CE PL                           |
      +------------------------------------------------
      |              CE TML                           |
      +------------------------------------------------
                                ^
                                |
                   ForCES       |   (i.e  ForCES data + control
                   PL           |    packets )
                   messages     |
                   over         |
                   specific     |
                   TML          |
                   encaps       |
                   and          |
                   transport    |
                                |
                                v
      +------------------------------------------------
      |              FE TML                           |
      +------------------------------------------------
      |               FE PL                           |
      +------------------------------------------------
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: ForCES Interface&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The PL is in fact the ForCES protocol. Its semantics and
        message layout are defined in this document. The TML Layer is
        necessary to connect two ForCES PLs as shown in <a class='info' href='#PL_TML_if'>Figure&nbsp;3<span> (</span><span class='info'>ForCES Interface</span><span>)</span></a> above. The TML is out of scope for this
        document but is within scope of ForCES. This document defines
        requirements the PL needs the TML to meet.
</p>
<p>Both the PL and the TML are standardized by the IETF. While
        only one PL is defined, different TMLs are expected to be
        standardized. To interoperate the TML at the CE and FE are
        expected to conform to the same definition.
</p>
<p>On transmit, the PL delivers its messages to the TML.
        The local TML delivers the message to the destination TML. On
        receive, the TML delivers the message to its destination PL.
        
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1"></a><h3>4.1.1.&nbsp;
The PL </h3>

<p>The PL is common to all implementations of ForCES and is
          standardized by the IETF as defined in this document. The PL 
          is responsible for associating an FE or CE to an NE. 
          It is also responsible for tearing down such associations. An FE
          uses the PL to transmit various subscribed-to events to the CE
          PL as well as to respond to various status requests issued
          from the CE PL. The CE configures both the FE and associated LFBs'
          operational parameters using the PL. In addition the CE may
          send various requests to the FE to activate or deactivate it,
          reconfigure its HA parameterization, subscribe to specific events
          etc. More details can be found in <a class='info' href='#Proto_Msg'>Section&nbsp;7<span> (</span><span class='info'>Protocol Construction</span><span>)</span></a>.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2"></a><h3>4.1.2.&nbsp;
The TML </h3>

<p>The TML transports the PL messages. The TML is where
          the issues of how to achieve transport level reliability, congestion
	  control, multicast, ordering, etc. are handled. It is expected that
	  more than one TML will be standardized. The various possible 
	  TMLs could
          vary their implementations based on the capabilities of underlying
          media and transport. However, since each TML is standardized,
          interoperability is guaranteed as long as both endpoints support the
          same TML. All ForCES Protocol Layer implementations MUST be portable
          across all TMLs, because all TMLs MUST have the top edge semantics
          defined in this document.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.3"></a><h3>4.1.3.&nbsp;
The FEM/CEM Interface</h3>

<p>The FEM and CEM components, although valuable in the setup and
          configurations of both the PL and TML, are out of scope of
          the ForCES protocol. The best way to think of them is as
          configurations/parameterizations for the PL and TML before they
          become active (or even at runtime based on implementation). In the
          simplest case, the FE or CE reads a static configuration file. RFC
          3746 has a more detailed description on how the FEM and CEM could
          be used. The pre-association phase, where the CEM and FEM can be
          used, are described briefly in <a class='info' href='#Pre_Association'>Section&nbsp;4.2.1<span> (</span><span class='info'>Pre-association</span><span>)</span></a>.
</p>
<p>An example of typical things the FEM/CEM could configure would
          be TML specific parameterizations such as:
</p>
<p>
          </p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>How the TML connection should happen (for example what IP
            addresses to use, transport modes etc);
</dd>
<dt>b.</dt>
<dd>The ID for the FE (FEID) or CE (CEID) (which would 
   also be issued during the pre-association phase).
</dd>
<dt>c.</dt>
<dd>Security parameterization such as keys etc.
</dd>
<dt>d.</dt>
<dd>Connection association parameters
</dd>
</dl></blockquote><p>

</p>
<p>Example of connection association parameters this might be: 
    </p>
<ul class="text">
<li>simple parameters: send up to 3 association messages every 1
              second
</li>
<li>complex parameters: send up to 4 association messages
              with increasing exponential timeout
</li>
</ul><p>
    
</p>
<a name="FPP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
ForCES Protocol Phases</h3>

<p>ForCES, in relation to NEs, involves two phases: the
	pre-association phase, where configuration/initialization/bootup 
	of the
	TML and PL layer happens, and the post-association phase where 
	the ForCES protocol operates to manipulate the parameters of the 
	FEs.
</p><br /><hr class="insert" />
<a name="FE_SM"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

                     CE sends Association Setup
         +----&gt;---&gt;------------&gt;----&gt;----&gt;----&gt;-------&gt;----+
         |                                                 Y
         ^                                                 |
         |                                                 Y
     +---+-------+                                     +-------------+
     |FE Pre-    |                                     | FE Post-    |
     |Association|    CE sends Association Teardown    | Association |
     |Phase      |&lt;------- &lt;------&lt;-----&lt;------&lt;-------+ Phase       |
     |           |                                     |             |
     +-----------+                                     +-------------+
           ^                                               Y
           |                                               |
           +-&lt;---&lt;------&lt;-----&lt;------&lt;----&lt;---------&lt;------+
                         FE loses association

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: The FE Protocol Phases&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In the mandated case, once associated, 
	the FE may forward packets 
	depending on the configuration of its specific LFBs. An 
        FE which is associated to a CE 
        will continue sending packets until it receives an 
        Association teardown message or until it loses association.  
	An unassociated FE MAY continue sending packets when it has a
	high availability capability. The extra details are
	explained in <a class='info' href='#HA'>Section&nbsp;8<span> (</span><span class='info'>High Availability Support</span><span>)</span></a> and not discussed here
        to allow for a clear explanation of the basics.
        
</p>
<p>The FE state transitions are controlled by means of the
	   FE Object LFB FEState component, which is defined in 
	   <a class='info' href='#FE-MODEL'>[FE&#8209;MODEL]<span> (</span><span class='info'>Yang, L., Halpern, J., Gopal, R., DeKok, A., Haraszti, Z., and S. Blake, &ldquo;ForCES Forwarding Element Model,&rdquo; Feb.&nbsp;2005.</span><span>)</span></a> section 5.1 and also 
	   explained in <a class='info' href='#FEO'>Section&nbsp;7.3.2<span> (</span><span class='info'>FE Object LFB</span><span>)</span></a>. 
	   
</p>
<p>The FE initializes in the FEState OperDisable. When the
         FE is ready to process packets in the data path it transitions
	 itself to the OperEnable state. 
</p>
<p>The CE may decide to pause the FE after it already came up
	as OperEnable. It does this by setting the FEState to AdminDisable.
	The FE stays in the AdminDisable state until it is explicitly
        configured by the CE to transition to the OperEnable state.
</p>
<p>
	When the FE loses its association with the CE it may go into
	the pre-association phase depending on the programmed
	policy. For the FE to properly complete the transition to the
        AdminDisable state, it MUST stop Packet forwarding and this may impact
        multiple LFBS. How this is achieved is outside the scope of this
        specification.
</p>
<a name="Pre_Association"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Pre-association</h3>

<p>The ForCES interface is configured during the pre-association
	 phase. In a simple setup, the configuration is static and is 
	  typically read
          from a saved configuration file. All the parameters for the
          association phase are well known after the pre-association phase is
          complete. A protocol such as DHCP may be used to retrieve the
          configuration parameters instead of reading them from a static
          configuration file. Note, this will still be considered static
          pre-association. Dynamic configuration may also happen using the Fc,
	  Ff and Fl reference points (refer to  <a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a>). 
	  Vendors may use their own proprietary
          service discovery protocol to pass the parameters. Essentially, only
          guidelines are provided here and the details are left to the
          implementation.
</p><br /><hr class="insert" />
<a name="Ex_PreAssoc"></a>

<p>The following are scenarios reproduced from the
            Framework Document to show a pre-association example.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   &lt;----Ff ref pt---&gt;              &lt;--Fc ref pt-------&gt;
   FE Manager      FE                CE Manager    CE
    |              |                 |             |
    |              |                 |             |
 (security exchange)               (security exchange)
   1|&lt;------------&gt;| authentication 1|&lt;-----------&gt;|authentication
    |              |                 |             |
  (FE ID, components)              (CE ID, components)
   2|&lt;-------------| request        2|&lt;------------|request
    |              |                 |             |
   3|-------------&gt;| response       3|------------&gt;|response
   (corresponding CE ID)          (corresponding FE ID)
    |              |                 |             |
    |              |                 |             |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: Examples of a message exchange over the Ff and Fc reference points&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="Ex_F1_msg"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   &lt;-----------Fl ref pt--------------&gt;            |

   FE Manager      FE               CE Manager     CE
    |              |                 |             |
    |              |                 |             |
   (security exchange)               |             |
   1|&lt;------------------------------&gt;|             |
    |              |                 |             |
   (a list of CEs and their components)            |
   2|&lt;-------------------------------|             |
    |              |                 |             |
   (a list of FEs and their components)            |
   3|-------------------------------&gt;|             |
    |              |                 |             |
    |              |                 |             |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: An example of a message exchange over the Fl reference point&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Before the transition to the association phase, the FEM will have
          established contact with a CEM component. Initialization of the
          ForCES interface will have completed, and authentication as well as
          capability discovery may be complete. Both the FE and CE would have
          the necessary information for connecting to each other for
          configuration, accounting, identification, and authentication
          purposes. To summarize, at the completion of this stage both sides
          have all the necessary protocol parameters such as timers, etc. The
          Fl reference point may continue to operate during the association
          phase and may be used to force a disassociation of an FE or CE.
	  The specific interactions of the CEM and the FEM that
	  are part of the pre-association phase are out of scope; for this
	  reason these details are
          not discussed any further in this specification. The reader is
          referred to the framework document <a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a> for a
          slightly more detailed discussion.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Post-association</h3>

<p>In this phase, the FE and CE components communicate with each
          other using the ForCES protocol (PL over TML) as defined in this
          document. There are three sub-phases: </p>
<ul class="text">
<li>Association Setup Stage
</li>
<li>Established Stage
</li>
<li>Association Lost Stage
</li>
</ul>

<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.1"></a><h3>4.2.2.1.&nbsp;
Association Setup Stage</h3>

<p>The FE attempts to join the NE. The FE may be rejected or
            accepted. Once granted access into the NE, capabilities exchange
            happens with the CE querying the FE. Once the CE has the FE
            capability information, the CE can offer an initial configuration
            (possibly to restore state) and can query certain components
            within either an LFB or the FE itself.
</p>
<p>More details are provided in <a class='info' href='#Proto_Scene'>Section&nbsp;4.4<span> (</span><span class='info'>Protocol Scenarios</span><span>)</span></a>.
</p>
<p>On successful completion of this stage, the FE joins the NE and
            is moved to the Established Stage.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.2"></a><h3>4.2.2.2.&nbsp;
Established Stage</h3>

<p>In this stage, the FE is continuously updated or queried. The FE
            may also send asynchronous event notifications to the CE or
            synchronous heartbeat notifications if programmed to do so. This
	    stage continues until a termination occurs, either due to loss of
	    connectivity or due to a termination initiated by either 
	    the CE or the FE.
</p>
<p>Refer to the section on protocol scenarios, <a class='info' href='#Proto_Scene'>Section&nbsp;4.4<span> (</span><span class='info'>Protocol Scenarios</span><span>)</span></a>, for more details.
</p>
<a name="ALS"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.3"></a><h3>4.2.2.3.&nbsp;
Association Lost Stage</h3>

<p>In this state, both or either the CE or FE declare the other
            side is no longer associated. The disconnection could be
            initiated by either party for administrative purposes
            but may also be driven by operational reasons such as loss of
            connectivity.
</p>
<p>A core LFB known as FE Protocol Object (FEPO) is defined 
	    (refer to <a class='info' href='#FPL_def'>Appendix&nbsp;B<span> (</span><span class='info'>ForCES Protocol LFB schema</span><span>)</span></a> and 
	    <a class='info' href='#FPL_sum'>Section&nbsp;7.3.1<span> (</span><span class='info'>FE Protocol LFB</span><span>)</span></a>). FEPO defines various timers
	    which can be used in conjunction with traffic sensitive
	    heartbeat mechanism (<a class='info' href='#HB_appr'>Section&nbsp;4.3.3<span> (</span><span class='info'>Heartbeat Mechanism</span><span>)</span></a>) to detect 
	    loss of connectivity.  
</p>
<p>
	    The loss of connectivity between TMLs does not indicate a 
	    loss of association between respective PL layers.  If the 
	    TML cannot repair the transport loss before the programmed 
	    FEPO timer thresholds associated with the FE is exceeded, 
	    then the association between the respective PL layers will 
	    be lost.
            
</p>
<p>FEPO defines several policies that can be programmed
	    to define behavior upon a detected loss of association.    
	    The FEPO's programmed CE failover policy (refer to 
	    <a class='info' href='#HA'>Section&nbsp;8<span> (</span><span class='info'>High Availability Support</span><span>)</span></a>, <a class='info' href='#FPL_sum'>Section&nbsp;7.3.1<span> (</span><span class='info'>FE Protocol LFB</span><span>)</span></a>,
	    <a class='info' href='#HB_appr'>Section&nbsp;4.3.3<span> (</span><span class='info'>Heartbeat Mechanism</span><span>)</span></a> and <a class='info' href='#FPL_def'>Appendix&nbsp;B<span> (</span><span class='info'>ForCES Protocol LFB schema</span><span>)</span></a>)
	    defines what takes place upon loss of association. 
	    
</p>
<p>For this version of the protocol (as defined in this document),
            the FE, upon re-association, MUST discard any state it has as
            invalid and retrieve new state. This approach is motivated by a
	    desire for simplicity (as opposed to efficiency).
            
</p>
<a name="protmech"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Protocol Mechanisms</h3>

<p>Various semantics are exposed to the protocol users via the PL
        header including: transaction capabilities, atomicity of transactions,
        two phase commits, batching/parallelization, high availability and
        failover as well as command pipelines.
</p>
<p>The EM (Execute Mode) flag, AT (Atomic Transaction) flag, and TP
		(Transaction Phase) flag as defined in the Common Header 
		(<a class='info' href='#Common_Header'>Section&nbsp;6.1<span> (</span><span class='info'>Common Header</span><span>)</span></a>)
		 are relevant to these mechanisms.
</p>
<a name="taer"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1"></a><h3>4.3.1.&nbsp;
Transactions, Atomicity, Execution and Responses</h3>

<p>In the master-slave relationship the CE instructs one or more FEs
          on how to execute operations and how to report the results.
</p>
<p>This section details the different modes of execution that a CE
          can order the FE(s) to perform, as defined in <a class='info' href='#exec_def'>Section&nbsp;4.3.1.1<span> (</span><span class='info'>Execution</span><span>)</span></a>. It also describes the different modes a
          CE can ask the FE(s) to use for formatting the responses after
          processing the operations as requested. These modes relate to the
          transactional two phase commitment operations. 
</p>
<a name="exec_def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1.1"></a><h3>4.3.1.1.&nbsp;
Execution</h3>

<p>There are 3 execution modes that can be requested for a batch
	    of operations spanning one or more LFB selectors 
	    (refer to <a class='info' href='#LFBselectTLV'>Section&nbsp;7.1.5<span> (</span><span class='info'>LFBselect-TLV</span><span>)</span></a>)
	    in one protocol
	    message. The EM flag defined in the Common Header 
	    <a class='info' href='#Common_Header'>Section&nbsp;6.1<span> (</span><span class='info'>Common Header</span><span>)</span></a>
            selects  the execution mode for a
            protocol message, as below:
</p>
<p>
            </p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>execute-all-or-none
</dd>
<dt>b.</dt>
<dd>continue-execute-on-failure
</dd>
<dt>c.</dt>
<dd>execute-until-failure
</dd>
</dl></blockquote><p>

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1.1.1"></a><h3>4.3.1.1.1.&nbsp;
execute-all-or-none</h3>

<p>When set to this mode of execution, independent operations 
	      in a message MAY be targeted at one or more LFB selectors 
	      within an FE. All these operations are executed serially
	      and the FE MUST have no execution failure for any of the 
	      operations. If any operation fails to execute,
	      then all the previous ones that have been executed
	      prior to the failure will need to be undone.  
	      I.e., there is rollback for this mode of operation.
</p>
<p>Refer to <a class='info' href='#tp_def'>Section&nbsp;4.3.1.2.2<span> (</span><span class='info'>Transaction Protocol</span><span>)</span></a> for how this mode is used 
	      in cases of transactions. In such a case, no operation is
	      executed unless a commit is issued by the CE.
</p>
<p>Care should be taken on how this mode is used because
	      a mis-configuration could result in traffic losses. To 
	      add certainty to the success of an operation, one should
              use this mode in a transactional operation as described in
              <a class='info' href='#tp_def'>Section&nbsp;4.3.1.2.2<span> (</span><span class='info'>Transaction Protocol</span><span>)</span></a> 
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1.1.2"></a><h3>4.3.1.1.2.&nbsp;
continue-execute-on-failure</h3>

<p>If several independent operations are targeted at one or more
              LFB selectors, execution continues for all operations at the FE
              even if one or more operations fail.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1.1.3"></a><h3>4.3.1.1.3.&nbsp;
execute-until-failure</h3>

<p>In this mode all operations are executed on the FE
              sequentially until the first failure. The rest of the operations
              are not executed but operations already completed are not
              undone. I.e., there is no rollback in this mode of
              operation.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1.2"></a><h3>4.3.1.2.&nbsp;
Transaction and Atomicity</h3>

<a name="aorn_def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1.2.1"></a><h3>4.3.1.2.1.&nbsp;
Transaction Definition</h3>

<p>A transaction is defined as a collection of one or more
              ForCES operations within one or more PL messages that MUST meet
              the ACIDity properties <a class='info' href='#ACID'>[ACID]<span> (</span><span class='info'>Haerder, T. and A. Reuter, &ldquo;Principles of Transaction-Orientated Database           Recovery,&rdquo; 1983.</span><span>)</span></a>, defined as:
</p>
<p>
              </p>
<blockquote class="text"><dl>
<dt>Atomicity: </dt>
<dd>In a transaction involving two or
                more discrete pieces of information, either all of the pieces
                are committed or none are.
</dd>
<dt>Consistency: </dt>
<dd>A transaction either creates a new
                and valid state of data, or, if any failure occurs, returns
                all data to the state it was in before the transaction was
                started.
</dd>
<dt>Isolation: </dt>
<dd>A transaction in process and not yet
                committed must remain isolated from any other transaction.
</dd>
<dt>Durability: </dt>
<dd>Committed data is saved by the
                system such that, even in the event of a failure and a system
                restart, the data is available in its correct state.
</dd>
</dl></blockquote><p>
              
</p>
<p>There are cases where the CE knows exact memory and
              implementation details of the FE such as in the case of an FE-CE
              pair from the same vendor where the FE-CE pair is tightly
              coupled. In such a case, the transactional operations may be
              simplified further by extra computation at the CE. This view is
              not discussed further other than to mention that it is not
              disallowed.
</p>
<p>As defined above, a transaction is always atomic and MAY be
              </p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>Within an FE alone Example: updating multiple
                  tables that are dependent on each other. If updating one
                  fails, then any that were already updated must be
                  undone.
</dd>
<dt>b.</dt>
<dd>Distributed across the NE Example: updating
                  table(s) that are inter-dependent across several FEs (such
                  as L3 forwarding related tables).
</dd>
</dl></blockquote>

<a name="tp_def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1.2.2"></a><h3>4.3.1.2.2.&nbsp;
Transaction Protocol</h3>

<p>By use of the execute mode, as defined in <a class='info' href='#exec_def'>Section&nbsp;4.3.1.1<span> (</span><span class='info'>Execution</span><span>)</span></a>, the protocol has provided a mechanism
              for transactional operations within one stand-alone message. The
              'execute-all-or-none' mode can meet the ACID requirements.
</p>
<p>For transactional operations of multiple messages within one
              FE or across FEs, a classical transactional protocol known as
              Two Phase Commit (2PC) <a class='info' href='#2PCREF'>[2PCREF]<span> (</span><span class='info'>Gray, J., &ldquo;Notes on database operating systems. In Operating Systems: An           Advanced Course. Lecture Notes in Computer Science, Vol. 60, pp.           394-481, Springer-Verlag,&rdquo; 1978.</span><span>)</span></a> 
              is supported by the protocol to achieve the transactional
	      operations utilizing Config messages 
	      (<a class='info' href='#CfgMsg'>Section&nbsp;7.6.1<span> (</span><span class='info'>Config Message</span><span>)</span></a>).
</p>
<p>The COMMIT and TRCOMP operations
	      in conjunction with the AT and the TP flags in 
	      <a class='info' href='#Common_Header'>Common Header<span> (</span><span class='info'>Common Header</span><span>)</span></a> are 
	      provided for 2PC-based 
	      transactional operations spanning multiple messages.
</p>
<p>The AT flag, when set, indicates this message belongs to an
              Atomic Transaction. All messages for a transaction operation
              must have the AT flag set. If not set, it means the message is a
              stand-alone message and does not participate in any transaction
              operation that spans multiple messages.
</p>
<p>The TP flag indicates the Transaction Phase this message
              belongs to. There are four (4) possible phases for an
              transactional operation known as: </p>
<blockquote class="text">
<p>SOT (Start of Transaction)
</p>
<p>MOT (Middle of Transaction)
</p>
<p>EOT (End of Transaction)
</p>
<p>ABT (Abort)
</p>
</blockquote>

<p>The COMMIT operation is used by the CE to signal to the
	     FE(s) to commit a transaction. When used with an ABT TP flag,
	     the COMMIT operation signals the FE(s) to rollback (i.e 
	     un-COMMIT) a previously committed transaction.
</p>
<p>The TRCOMP operation is a small addition to the classical
	     2PC approach. TRCOMP is sent by the CE to signal the FE(s) 
	     that the transaction they have COMMITed is now over. This
	     allows the FE(s) an opportunity to clear state they may
	     have kept around to perform a rollback (if it became necessary).
	     
</p>
<p>A transaction operation is started with a message in which
		     the TP flag
              is set to Start of Transaction (SOT). Multi-part messages, after
              the first one, are indicated by the Middle of Transaction flag
	      (MOT). All messages from the CE MUST set the AlwaysACK flag
	      (<a class='info' href='#msg_encap'>Section&nbsp;6<span> (</span><span class='info'>Message Encapsulation</span><span>)</span></a>) to solicit responses 
	      from the FE(s).
	       
</p>
<p>Before the CE issues a commit (described further below)
	         the FE MUST only validate that the operation can be executed
		 but not execute it.
	      </p>
<blockquote class="text">
<p>Any failure notified by an FE causes the CE to abort
                  the transaction on all FEs involved in the
		  transaction. This is achieved by sending a Config message
		  with an ABT flag and a COMMIT operation.
		  
</p>
<p>If there are no failures by any participating FE,
		  the transaction commitment phase is signaled from the CE
                  to the FE by an End of Transaction (EOT) configuration
		  message with a COMMIT operation. 
	          
</p>
</blockquote><p>
	       
</p>
<p>
	     The FE MUST respond to the CE's EOT message. There are
	     two possible failure scenarios in which the CE MUST
	     abort the transaction (as described above):
	     </p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>
	       If any participating FE responds with a failure message
	       in relation to the transaction.
               
</dd>
<dt>b.</dt>
<dd>
		If no response is received from a participating FE within a 
		specified timeout.
               
</dd>
</dl></blockquote><p>
	      If all participating FE(s) respond with a success indicator
	      within the expected time, then
	      the CE MUST issue a TRCOMP operation to all participating FEs.
	      An FE MUST NOT respond to a TRCOMP.
	     
</p>
<p>Note that a transactional operation is generically atomic,
              therefore it requires that the execute modes of all messages in
              a transaction operation should always be kept the same and be
              set to 'execute-all-or-none'. If the EM flag is set to other
              execute modes, it will result in a transaction failure.
</p>
<p>As noted above, a transaction may span multiple messages. It
              is up to the CE to keep track of the different outstanding
              messages making up a transaction. As an example, the correlator
              field could be used to mark transactions and a sequence field to
              label the different messages within the same atomic transaction,
              but this is out of scope and up to implementations.
</p>
<a name="roll_def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1.2.3"></a><h3>4.3.1.2.3.&nbsp;
Recovery</h3>

<p>Any of the participating FEs, or the CE, or the associations
          between them, may fail after the EOT response message has been
          sent by the FE but before the CE has received all the responses,
          e.g. if the EOT response never reaches the CE.
</p>
<p>In this protocol revision, as indicated in 
	 <a class='info' href='#ALS'>Section&nbsp;4.2.2.3<span> (</span><span class='info'>Association Lost Stage</span><span>)</span></a>, an FE losing an association 
	 would be required to get entirely new state from the
	 newly associated CE upon a re-association. Although this 
	 approach is simplistic and provides likeliness of loosing datapath
	 traffic, it is a design choice to avoid the additional complexity of
	 managing graceful restarts. The HA mechanisms 
	 (<a class='info' href='#HA'>Section&nbsp;8<span> (</span><span class='info'>High Availability Support</span><span>)</span></a>) are provided to allow for a 
	 continuous operation in case of FE failures.
         
</p>
<p>
	 Flexibility is provided on how to react when an
         FE looses association. This is dictated by the CE
         Failover policy (refer to <a class='info' href='#HA'>Section&nbsp;8<span> (</span><span class='info'>High Availability Support</span><span>)</span></a> and <a class='info' href='#LFB_def'>Section&nbsp;7.3<span> (</span><span class='info'>Core ForCES LFBs</span><span>)</span></a>).
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1.2.4"></a><h3>4.3.1.2.4.&nbsp;
Transaction Messaging Example</h3>

<p> This section illustrates an example of how
	      a successful two phase commit between a CE and an FE would 
	      look like in the simple case.
	      
              
</p><br /><hr class="insert" />
<a name="twopc"></a>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

      FE PL                                                  CE PL

        |                                                      |
        | (1) Config, SOT,AT, EM=All-or-None, OP= SET/DEL,etc  |
        |&lt;-----------------------------------------------------|
        |                                                      |
        | (2) ACKnowledge                                      |
        |-----------------------------------------------------&gt;|
        |                                                      |
        | (3) Config, MOT,AT, EM=All-or-None, OP= SET/DEL,etc  |
        |&lt;-----------------------------------------------------|
        |                                                      |
        | (4) ACKnowledge                                      |
        |-----------------------------------------------------&gt;|
        |                                                      |
        | (5) Config, MOT,AT, EM=All-or-None, OP= SET/DEL,etc  |
        |&lt;-----------------------------------------------------|
        |                                                      |
        | (6) ACKnowledge                                      |
        |-----------------------------------------------------&gt;|
        .                                                      .
        .                                                      .
        .                                                      .
        .                                                      .
        |                                                      |
        | (N) Config, EOT,AT, EM=All-or-None, OP= COMMIT       |
        |&lt;-----------------------------------------------------|
        |                                                      |
        | (N+1)Config-response, ACKnowledge, OP=COMMIT-RESPONSE|
        |-----------------------------------------------------&gt;|
        |                                                      |
        | (N+2) Config, OP=TRCOMP                              |
        |&lt;-----------------------------------------------------|
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: Example of a two phase commit&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
		For the scenario illustrated above:
          </p>
<ul class="text">
<li>
		   In step #1, the CE issues a Config message with an 
		   operation of choice like a DEL or SET. The transactional
		   flag are set to indicate a Start of Transaction (SOT),
		   Atomic Transaction (AT), execute-all-or-none.
           
</li>
<li>
		   The FE validates that it can execute the request
		   successfully and then issues an acknowledgment
		   back to the the CE in step #2.
	   
</li>
<li>
		   In step #3, the same sort of construct as in 
		   step #1 is repeated
		   by the CE with the transaction flag changed to
		   Middle of Transaction(MOT).
           
</li>
<li>
		   The FE validates that it can execute the request
		   successfully and then issues an acknowledgment
		   back to the the CE in step #4.
           
</li>
<li>
		   The CE-FE exchange continues in the same manner
		   until all the operations and their parameters are
		   transferred to the FE. This happens in step #(N-1).
           
</li>
<li>
		   In step #N, the CE issues a commit.
		   A commit is a config message with an 
		   operation of type COMMIT. The transactional
		   flags are set to End of Transaction (EOT). Essentially,
		   this is an "empty" message asking the FE to execute
		   all the operations it has gathered since the
		   beginning of the transaction (message #1).
           
</li>
<li>
		   The FE at this point executes
		   the full transaction. It then issues an acknowledgment
		   back to the the CE in step #(N+1) which contains
		   a COMMIT-RESPONSE.
	   
</li>
<li>
		   The CE in this case has the simple task of issuing
		   a TRCOMP operation the the FE in step #(N+2) 
	   
</li>
</ul><p>
        
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.2"></a><h3>4.3.2.&nbsp;
Scalability</h3>

<p>It is desirable that the PL not become the bottleneck when
          larger bandwidth pipes become available. To pick a hypothetical
          example in today's terms, if a 100Gbps pipe is available and there
          is sufficient work then the PL should be able to take
          advantage of this and use all of the 100Gbps pipe. Two mechanisms
          have been provided to achieve this. The first one is batching and
          the second one is a command pipeline.
</p>
<p>Batching is the ability to send multiple commands (such as
          Config) in one Protocol Data Unit (PDU). The size of the batch will
          be affected by, amongst other things, the path MTU. The commands may
          be part of the same transaction or may be part of unrelated
          transactions that are independent of each other.
</p>
<p>Command pipelining allows for pipelining of independent
          transactions which do not affect each other. Each independent
          transaction could consist of one or more batches.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.2.1"></a><h3>4.3.2.1.&nbsp;
Batching</h3>

<p>There are several batching levels at different protocol
            hierarchies. </p>
<ul class="text">
<li>multiple PL PDUs can be aggregated under one TML
                message
</li>
<li>multiple LFB classes and instances (as indicated in the LFB
                selector) can be addressed within one PL PDU
</li>
<li>Multiple operations can be addressed to a single LFB class
                and instance
</li>
</ul>

<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.2.2"></a><h3>4.3.2.2.&nbsp;
Command Pipelining</h3>

<p>The protocol allows any number of messages to be issued by the
            CE before the corresponding acknowledgments (if requested) have
            been returned by the FE. Hence pipelining is inherently supported
            by the protocol. Matching responses with requests messages can be
            done using the correlator field in the message header.
</p>
<a name="HB_appr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.3"></a><h3>4.3.3.&nbsp;
Heartbeat Mechanism</h3>

<p>Heartbeats (HB) between FEs and CEs are traffic sensitive. An HB
          is sent only if no PL traffic is sent between the CE and FE within a
          configured interval. This has the effect of reducing the amount of
          HB traffic in the case of busy PL periods.
</p>
<p>An HB can be sourced by either the CE or FE. When sourced by the
          CE, a response can be requested (similar to the ICMP ping protocol).
          The FE can only generate HBs in the case of being configured to do
          so by the CE. Refer to <a class='info' href='#FPL_sum'>Section&nbsp;7.3.1<span> (</span><span class='info'>FE Protocol LFB</span><span>)</span></a> and <a class='info' href='#HBMsg'>Section&nbsp;7.10<span> (</span><span class='info'>Heartbeat Message</span><span>)</span></a> for details.
</p>
<a name="FE_Object"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.4"></a><h3>4.3.4.&nbsp;
FE Object and FE Protocol LFBs</h3>

<p>All PL messages operate on LFB constructs, as this provides more
          flexibility for future enhancements. This means that maintenance and
          configurability of FEs, NE, as well as the ForCES protocol itself
          must be expressed in terms of this LFB architecture. For this reason
          special LFBs are created to accommodate this need.
</p>
<p>In addition, this shows how the ForCES protocol itself can be
          controlled by the very same type of structures (LFBs) it uses to
          control functions such as IP forwarding, filtering, etc.
</p>
<p>To achieve this, the following specialized LFBs are introduced:
          </p>
<ul class="text">
<li>FE Protocol LFB which is used to control the ForCES
              protocol.
</li>
<li>FE Object LFB which is used to control attributes relative
              to the FE itself. Such attributes include FEState <a class='info' href='#FE-MODEL'>[FE&#8209;MODEL]<span> (</span><span class='info'>Yang, L., Halpern, J., Gopal, R., DeKok, A., Haraszti, Z., and S. Blake, &ldquo;ForCES Forwarding Element Model,&rdquo; Feb.&nbsp;2005.</span><span>)</span></a>, vendor, etc.
</li>
</ul><p> These LFBs are detailed in <a class='info' href='#LFB_def'>Section&nbsp;7.3<span> (</span><span class='info'>Core ForCES LFBs</span><span>)</span></a>.
</p>
<a name="Proto_Scene"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Protocol Scenarios</h3>

<p>
      This section provides a very high level description
      of sample message sequences between a CE and FE.
      For protocol message encoding refer to 
      <a class='info' href='#Common_Header'>Section&nbsp;6.1<span> (</span><span class='info'>Common Header</span><span>)</span></a> and for the semantics of
      the protocol refer to <a class='info' href='#protmech'>Section&nbsp;4.3<span> (</span><span class='info'>Protocol Mechanisms</span><span>)</span></a>.

      
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.1"></a><h3>4.4.1.&nbsp;
Association Setup State</h3>

<p>The associations among CEs and FEs are initiated via Association
        setup message from the FE. If a setup request is granted by the CE, a
        successful setup response message is sent to the FE. If CEs and FEs
        are operating in an insecure environment then the security
        associations have to be established between them before any
        association messages can be exchanged. The TML MUST take care of
        establishing any security associations.
</p>
<p>This is typically followed by capability query, topology query,
        etc. 

	When the FE is ready to start processing the data path, it sets
	the FEO FEState component to OperEnable 
	(Refer to <a class='info' href='#FE-MODEL'>[FE&#8209;MODEL]<span> (</span><span class='info'>Yang, L., Halpern, J., Gopal, R., DeKok, A., Haraszti, Z., and S. Blake, &ldquo;ForCES Forwarding Element Model,&rdquo; Feb.&nbsp;2005.</span><span>)</span></a> for details)
	and reports it 
	to the CE as such when it is first queried. 
	Typically the FE is expected to be ready to process the data path 
	before it associates, but there maybe rare cases
	where it needs time do some pre-processing - in such a case the FE
	will start in the OperDisable state and when it is ready will 
	transition
	to OperEnable state. An example of an FE starting in the OperDisable
	then transitioning to OperEnable is illustrated in 
	<a class='info' href='#seq_Assoc_Setup'>Figure&nbsp;8<span> (</span><span class='info'>Message exchange between CE and FE to establish an NE association</span><span>)</span></a>.
	The CE could at any time also disable the FEs datapath operations by
	setting the FEState to AdminDisable. The FE MUST NOT process packets
	during this state unless the CE sets the state back to OperEnable.
        These sequences of messages are illustrated
	in <a class='info' href='#seq_Assoc_Setup'>Figure&nbsp;8<span> (</span><span class='info'>Message exchange between CE and FE to establish an NE association</span><span>)</span></a> below.
</p><br /><hr class="insert" />
<a name="seq_Assoc_Setup"></a>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        FE PL                  CE PL

          |                       |
          |   Asso Setup Req      |
          |----------------------&gt;|
          |                       |
          |   Asso Setup Resp     |
          |&lt;----------------------|
          |                       |
          | LFBx Query capability |
          |&lt;----------------------|
          |                       |
          | LFBx Query Resp       |
          |----------------------&gt;|
          |                       |
          | FEO Query (Topology)  |
          |&lt;----------------------|
          |                       |
          | FEO Query Resp        |
          |----------------------&gt;|
          |                       |
          | FEO OperEnable Event  |
          |----------------------&gt;|
          |                       |
          |  Config FEO Adminup   |
          |&lt;----------------------|
          |                       |
          | FEO Config-Resp       |
          |----------------------&gt;|
          |                       |

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: Message exchange between CE and FE to establish an NE association&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>On successful completion of this state, the FE joins the NE.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.2"></a><h3>4.4.2.&nbsp;
Association Established state or Steady State</h3>

<p>In this state, the FE is continuously updated or queried. The FE may
        also send asynchronous event notifications to the CE, synchronous
	heartbeat messages, or packet redirect message to the CE. 
	This continues until a termination (or
	deactivation) is initiated by either the CE or FE. 
	<a class='info' href='#seq_Assoc_Estab'>Figure&nbsp;9<span> (</span><span class='info'>Message exchange between CE and FE during steady-state communication</span><span>)</span></a> below,
        helps illustrate this state.
</p><br /><hr class="insert" />
<a name="seq_Assoc_Estab"></a>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

        FE PL                          CE PL

          |                              |
          |    Heart Beat                |
          |&lt;----------------------------&gt;|
          |                              |
          |   Heart Beat                 |
          |-----------------------------&gt;|
          |                              |
          | Config-set LFBy (Event sub.) |
          |&lt;-----------------------------|
          |                              |
          |     Config Resp LFBy         |
          |-----------------------------&gt;|
          |                              |
          |  Config-set LFBx Attr        |
          |&lt;-----------------------------|
          |                              |
          |     Config Resp  LFBx        |
          |-----------------------------&gt;|
          |                              |
          |Config-Query LFBz (Stats)     |
          |&lt;--------------------------- -|
          |                              |
          |    Query Resp LFBz           |
          |-----------------------------&gt;|
          |                              |
          |    FE Event Report           |
          |-----------------------------&gt;|
          |                              |
          |  Config-Del LFBx Attr        |
          |&lt;-----------------------------|
          |                              |
          |     Config Resp LFBx         |
          |-----------------------------&gt;|
          |                              |
          |    Packet Redirect LFBx      |
          |-----------------------------&gt;|
          |                              |
          |    Heart Beat                |
          |&lt;-----------------------------|
          .                              .
          .                              .
          |                              |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;9: Message exchange between CE and FE during steady-state communication&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Note that the sequence of messages shown in the figure serve only
        as examples and the message exchange sequences could be different
        from what is shown in the figure. Also, note that the protocol
        scenarios described in this section do not include all the different
        message exchanges that would take place during failover. That is
	described in the HA section (<a class='info' href='#HA'>Section&nbsp;8<span> (</span><span class='info'>High Availability Support</span><span>)</span></a>) .
</p>
<a name="TML_Req"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
TML Requirements</h3>

<p>The requirements below are expected to be delivered by the TML. This
      text does not define how such mechanisms are delivered. As an example
      they could be defined to be delivered via hardware or between 2 or more
      TML processes on different CEs or FEs in protocol level schemes.
</p>
<p>Each TML must describe how it contributes to achieving the listed
      ForCES requirements. If for any reason a TML does not provide a service
      listed below a justification needs to be provided.
</p>
<p>
      </p>
<ol class="text">
<li>Reliability<br />
 As defined by RFC 3654, section 6 #6.
</li>
<li>Security<br />
 TML provides security services to the ForCES PL.
        A TML layer SHOULD support
        the following security services and describe how they are
        achieved.
        
<ul class="text">
<li>Endpoint authentication of FE and CE
</li>
<li>Message authentication
</li>
<li>Confidentiality service<br />

</li>
</ul>
        The TML SHOULD provide these services by employing TLS or IPSEC.

</li>
<li>Congestion control <br />
 The congestion control scheme used
        needs to be defined. The congestion control mechanism defined by the
        TML should prevent the FE from being overloaded by the CE or the CE
        from being overwhelmed by traffic from the FE. Additionally, the
        circumstances under which notification is sent to the PL to notify it
        of congestion must be defined.
</li>
<li>Uni/multi/broadcast addressing/delivery, if any <br />
 If there
        is any mapping between PL and TML level uni/multi/broadcast addressing
        it needs to be defined.
</li>
<li>HA decisions <br />
 It is expected that availability of
	transport links is the TML's responsibility. However, based upon
	its configuration, the PL may wish to participate in link 
	failover schemes and therefore the TML must support this 
	capability. <br />
 Please
        refer to <a class='info' href='#HA'>Section&nbsp;8<span> (</span><span class='info'>High Availability Support</span><span>)</span></a> for details.
</li>
<li>Encapsulations used <br />
 Different types of TMLs will
        encapsulate the PL messages on different types of headers. The TML
        needs to specify the encapsulation used. <br />

</li>
<li>Prioritization<br />
 It is expected that the TML will be able
        to handle up to 8 priority levels needed by the PL and will
        provide preferential treatment. <br />
<br />
 While the TML
        needs to define how this is achieved, it should be noted that the
        requirement for supporting up to 8 priority levels does not mean that
        the underlying TML MUST be capable of providing up to 8 actual
        priority levels. In the event that the underlying TML layer does not
        have support for 8 priority levels, the supported priority levels
        should be divided between the available TML priority levels. For
        example, if the TML only supports 2 priority levels, the 0-3 could go
	in one TML priority level, while 4-7 could go in the other.
	<br />
<br />
<br />

        The TML MUST NOT reorder config packets with the 
	same priority.
        
</li>
<li>Protection against DoS attacks <br />
 As described in 
        RFC 3654, section 6
</li>
</ol><p>

</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
TML Parameterization</h3>

<p>It is expected that it should be possible to use a configuration
        reference point, such as the FEM or the CEM, to configure the TML.
</p>
<p>Some of the configured parameters may include:
</p>
<p>
        </p>
<ul class="text">
<li>PL ID
</li>
<li>Connection Type and associated data. For example if a TML uses
	  IP/TCP/UDP, then parameters such as TCP and UDP port and IP 
	  addresses need to be configured.
</li>
<li>Number of transport connections
</li>
<li>Connection capability, such as bandwidth, etc.
</li>
<li>Allowed/supported connection QoS policy (or congestion control
          policy)
</li>
</ul><p>

</p>
<a name="msg_encap"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Message Encapsulation</h3>

<p>All PL PDUs start with a common header 
         [<a class='info' href='#Common_Header'>Section&nbsp;6.1<span> (</span><span class='info'>Common Header</span><span>)</span></a>] 
         followed by a one or more TLVs 
         [<a class='info' href='#tlv_ref'>Section&nbsp;6.2<span> (</span><span class='info'>Type Length Value (TLV) Structuring </span><span>)</span></a>] which may nest other TLVs 
         [<a class='info' href='#ntlv_ref'>Section&nbsp;6.2.1<span> (</span><span class='info'>Nested TLVs </span><span>)</span></a>]. 
         All fields are in network byte order.
      
</p>
<a name="Common_Header"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Common Header</h3>
<br /><hr class="insert" />
<a name="Com_Hdr"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|version| rsvd  | Message Type  |             Length            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          Source ID                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Destination ID                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Correlator[63:32]                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Correlator[31:0]                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             Flags                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;10: Common Header&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The message is 32 bit aligned.

        <br />
<br />

</p>
<p>
        </p>
<blockquote class="text"><dl>
<dt>Version (4 bit): </dt>
<dd> Version number. Current
          version is 1.
</dd>
<dt>rsvd (4 bit): </dt>
<dd> Unused at this point. A
          receiver should not interpret this field. Senders MUST set it to
          zero and receivers MUST ignore this field.
</dd>
<dt>Message Type (8 bits): </dt>
<dd> Commands are
		  defined in <a class='info' href='#Proto_Msg'>Section&nbsp;7<span> (</span><span class='info'>Protocol Construction</span><span>)</span></a>.


	  
</dd>
<dt>Length (16 bits): </dt>
<dd> length of header + the
          rest of the message in DWORDS (4 byte increments).
</dd>
<dt>Source ID  (32 bit): </dt>
<dd>
</dd>
<dt>Dest ID (32 bit): </dt>
<dd>

           
</dd>
<dt></dt>
<dd>
          
<ul class="text">
<li>Each of the source and destination IDs 
	  are 32 bit IDs which are unique
            NE-wide and which identify the termination points of a ForCES PL
            message.
</li>
<li>IDs allow multi/broad/unicast addressing with the following
            approach:
            
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>A split address space is used to distinguish FEs from CEs.
              Even though in a large NE there are typically two or more orders
              of magnitude more FEs than CEs, the address space is split
              uniformly for simplicity.
</dd>
<dt>b.</dt>
<dd>The address space allows up to 2^30 (over a billion) CEs and
              the same amount of FEs.
</dd><br /><hr class="insert" />
<a name="sub-ID"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|TS |                           sub-ID                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;11: ForCES ID Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<dt>c.</dt>
<dd>The 2 most significant bits called Type Switch (TS) are used
              to split the ID space as follows:
</dd><br /><hr class="insert" />
<a name="TS_ID"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
TS        Corresponding ID range       Assignment
--        ----------------------       ----------
0b00      0x00000000 to 0x3FFFFFFF     FE IDs (2^30)
0b01      0x40000000 to 0x7FFFFFFF     CE IDs (2^30)
0b10      0x80000000 to 0xBFFFFFFF     reserved
0b11      0xC0000000 to 0xFFFFFFEF     multicast IDs (2^30 - 16)
0b11      0xFFFFFFF0 to 0xFFFFFFFC     reserved
0b11      0xFFFFFFFD                   all CEs broadcast
0b11      0xFFFFFFFE                   all FEs broadcast
0b11      0xFFFFFFFF                   all FEs and CEs (NE) broadcast
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;12: Type Switch ID Space&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</dl></blockquote>

            <br />
<br />

</li>
<li>Multicast or broadcast IDs are used to group endpoints (such as
            CEs and FES). As an example one could group FEs in some functional
            group, by assigning a multicast ID. Likewise, subgroups of CEs
            that act, for instance, in a back-up mode may be assigned a
	    multicast ID to hide them from the FE.
	     
<ul class="text">
<li>
		       Multicast IDs can be used for both source or 
		       destination IDs.
               
</li>
<li>
		       Broadcast IDs can be used only for destination
		       IDs.
               
</li>
</ul>
           
</li>
<li>This document does not discuss how a particular multicast ID is
            associated to a given group though it could be done via
            configuration process. The list of IDs an FE owns or is part of
            are listed on the FE Object LFB.
</li>
</ul>

</dd>
<dt>Correlator (64 bits) </dt>
<dd> This field is set by
          the CE to correlate ForCES Request Messages with the corresponding
          Response messages from the FE. Essentially it is a cookie. The
	  correlator is handled transparently by the FE, i.e., for a 
	  particular Request message the FE MUST assign the same 
	  correlator value in the corresponding Response message. In 
	  the case where the message from the CE does not elicit a 
	  response, this field may not be useful.
</dd>
<dt></dt>
<dd>The correlator field could be used in many implementations
          specific ways by the CE. For example, the CE could split the
          correlator into a 32-bit transactional identifier and 32-bit message
          sequence identifier. Another example is a 64-bit pointer to a context
          block. All such implementation specific use of the correlator is
          outside the scope of this specification.
</dd>
<dt></dt>
<dd>
           It should be noted that the correlator is transmitted on the network 
           as if it were a 64 bit unsigned integer with the leftmost or most 
           significant octet (bits 63-56) transmitted first.
	  
</dd>
<dt></dt>
<dd> Whenever the correlator field is not relevant, because no
	  message is expected, the correlator field is set to 0.
</dd>
<dt>Flags(32 bits): </dt>
<dd> Identified so far: <br /><hr class="insert" />
<a name="Hdr_Flg"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   |     |     |   | |   |                                     |
|ACK| Pri |Rsr  |EM |A|TP |     Reserved                        |
|   |     | vd. |   |T|   |                                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;13: Header Flags&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</dd>
<dt></dt>
<dd>
          
<blockquote class="text"><dl>
<dt>- ACK: ACK indicator (2 bit)</dt>
<dd> The ACK
            indicator flag is only used by the CE when sending a Config
            Message (<a class='info' href='#CfgMsg'>Section&nbsp;7.6.1<span> (</span><span class='info'>Config Message</span><span>)</span></a>) or a HB message (<a class='info' href='#HBMsg'>Section&nbsp;7.10<span> (</span><span class='info'>Heartbeat Message</span><span>)</span></a>) to indicate to the message receiver whether or
            not a response is required by the sender. Note that for all other
            messages than the Config Message or the HB Message this flag MUST
            be ignored.
</dd>
<dt></dt>
<dd>The flag values are defined as below: 

<blockquote class="text"><dl>
<dt></dt>
<dd>'NoACK' (0b00) - to indicate that the message receiver MUST
                NOT send any response message back to this message
                sender.
</dd>
<dt></dt>
<dd>'SuccessACK'(0b01) - to indicate the message receiver MUST
                send a response message back only when the message has been
                successfully processed by the receiver.
</dd>
<dt></dt>
<dd>'FailureACK'(0b10) - to indicate the message receiver MUST
                send a response message back only when there is failure by
                the receiver in processing (executing) the message. In other
                words, if the message can be processed successfully, the
                sender will not expect any response from the receiver.
</dd>
<dt></dt>
<dd>'AlwaysACK' (0b11) - to indicate the message receiver MUST
                send a response message.
</dd>
</dl></blockquote> 
	    
</dd>
<dt></dt>
<dd> Note that in above definitions, the term success
            implies a complete execution without any failure of the message.
            Anything else than a complete successful execution is defined as a
            failure for the message processing. As a result, for the execution
            modes (defined in <a class='info' href='#exec_def'>Section&nbsp;4.3.1.1<span> (</span><span class='info'>Execution</span><span>)</span></a>) like
            execute-all-or-none, execute-until-failure, and
            continue-execute-on-failure, if any single operation among several
            operations in the same message fails, it will be treated as a
            failure and result in a response if the ACK indicator has been set
            to 'FailureACK' or 'AlwaysACK'. 
</dd>
<dt></dt>
<dd> Also note that, other
            than in Config and HB Messages, requirements for responses of
            messages are all given in a default way rather than by ACK flags.
            The default requirements of these messages and the expected
            responses are summarized below. Detailed descriptions can be found
            in the individual message definitions: 
</dd>
<dt></dt>
<dd>
    
<ul class="text">
<li>Association Setup Message always expects a response.
</li>
<li>Association Teardown Message, and Packet Redirect Message,
                never expect responses.
</li>
<li>Query Message always expects a response.
</li>
<li>Response message never expects further responses.
</li>
</ul>

</dd>
<dt>- Pri: Priority (3 bits) </dt>
<dd> ForCES protocol
            defines 8 different levels of priority (0-7). The priority level
            can be used to distinguish between different protocol message
	    types as well as between the same message type. The higher
	    the priority value, the more important the PDU is.
	    For example, the
            REDIRECT packet message could have different priorities to
            distinguish between routing protocols packets and ARP packets
            being redirected from FE to CE. The Normal priority level is
	    1. The different priorities imply messages could be re-ordered;
            however, re-ordering is undesirable when it comes to a set of
            messages within a transaction and caution should be exercised
            to avoid this from happening.
</dd>
<dt>- EM: Execution Mode (2 bits) </dt>
<dd> There are
            3 execution modes refer to <a class='info' href='#exec_def'>Section&nbsp;4.3.1.1<span> (</span><span class='info'>Execution</span><span>)</span></a> for details.
            
<blockquote class="text"><dl>
<dt></dt>
<dd>Reserved..................... (0b00)
</dd>
<dt></dt>
<dd>`execute-all-or-none` ....... (0b01)
</dd>
<dt></dt>
<dd>`execute-until-failure` ..... (0b10)
</dd>
<dt></dt>
<dd>`continue-execute-on-failure` (0b11)
</dd>
</dl></blockquote>

</dd>
<dt>- AT:  Atomic Transaction (1 bit) </dt>
<dd> This
            flag indicates if the message is stand-alone message or one of
            multiple messages that belongs to 2PC transaction operations. See
            <a class='info' href='#tp_def'>Section&nbsp;4.3.1.2.2<span> (</span><span class='info'>Transaction Protocol</span><span>)</span></a> for details. 

<blockquote class="text"><dl>
<dt></dt>
<dd>Stand-alone message ......... (0b0)
</dd>
<dt></dt>
<dd>2PC transaction message ..... (0b1)
</dd>
</dl></blockquote>
</dd>
<dt>- TP: Transaction Phase (2 bits) </dt>
<dd> A
            message from the CE to the FE within a transaction could be
            indicative of the different phases the transaction is in. Refer to
            <a class='info' href='#tp_def'>Section&nbsp;4.3.1.2.2<span> (</span><span class='info'>Transaction Protocol</span><span>)</span></a> for details. 
<blockquote class="text"><dl>
<dt></dt>
<dd>SOT (start of transaction) ..... (0b00)
</dd>
<dt></dt>
<dd>MOT (Middle of transaction) .... (0b01)
</dd>
<dt></dt>
<dd>EOT (end of transaction) ........(0b10)
</dd>
<dt></dt>
<dd>ABT (abort) .....................(0b11)
</dd>
</dl></blockquote>
           
</dd>
</dl></blockquote>
	
</dd>
</dl></blockquote><p>
    
</p><br />
<br />
<br />

<a name="tlv_ref"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Type Length Value (TLV) Structuring </h3>

<p>
	      TLVs are extensively used by the ForCES protocol. 
	      TLVs have some very nice properties which make them a good
	      candidate for encoding the XML definitions of
	      the LFB class model. These are:
	      </p>
<ul class="text">
<li> Providing for binary type-value encoding 
	             that is close to the XML string tag-value scheme.
	         
</li>
<li>Allowing for fast generalized binary-parsing functions.
</li>
<li>Allowing for forward and backward tag compatibility. 
		 This is equivalent to the XML approach i.e old applications
		    can ignore new TLVs and newer applications can
		    ignore older TLVs.
		  
</li>
</ul><p>
      
</p>
<p>
</p><br /><hr class="insert" />
<a name="tlv_fig"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| TLV Type                    | TLV Length                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Value (Essentially the TLV Data)                   |
~                                                               ~
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;14: TLV Representation&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
        </p>
<blockquote class="text"><dl>
<dt>TLV Type (16):</dt>
<dd> The TLV type field is two
	  octets, and semantically
	  indicates the type of data encapsulated within the
          TLV.
</dd>
<dt>TLV Length (16):</dt>
<dd> The TLV length field is
	  two octets, and includes the length of the TLV type (2 octets), 
	  TLV Length (2 octets), and the length of the TLV data found
	  in the value field, in octets.
	  Note that this length is the actual 
	  length of the value, before any padding for alignment is added.
          
</dd>
<dt>TLV Value (variable):</dt>
<dd> The TLV value field
          carries the data. For extensibility, the TLV value may in fact be a
	  TLV. Padding is required when the length is not a multiple of 
	  32 bits, and is the minimum 
	  number of octets required  to bring the TLV to a multiple of 32 
	  bits.  The length of the value before padding is indicated by the TLV 
	  Length field.
	  Note: The value field could be empty
          which implies the minimal length a TLV could be is 4 (length of
	  "T" field and length of "L" field). 
          
</dd>
</dl></blockquote><p>

</p>
<a name="ntlv_ref"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.1"></a><h3>6.2.1.&nbsp;
Nested TLVs </h3>

<p>TLV values can be other TLVs. This provides the benefits of
          protocol flexibility (being able to add new extensions by
          introducing new TLVs when needed). The nesting feature also allows
          for a conceptual optimization with the XML LFB definitions to
          binary PL representation (represented by nested TLVs).
</p>
<a name="stlv_ref"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.2"></a><h3>6.2.2.&nbsp;
Scope of the T in TLV </h3>

<p>The "Type" values in the TLV are global in scope. This means that
          wherever TLVs occur in the PDU, a specific Type value refers to the
          same Type of TLV. This is a design choice that was made to ease
          debugging of the protocol.
</p>
<a name="ilv_ref"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
ILV </h3>

<p>A slight variation of the TLV known as the ILV. This sets the type
        ("T") to be a 32-bit local index that refers to a ForCES component ID.
	(refer to <a class='info' href='#paths'>Section&nbsp;6.4.1<span> (</span><span class='info'>Paths</span><span>)</span></a>).  
</p>
<p>ILV length field is
	  4 octets, and includes the length of the ILV type (4 octets), 
	  ILV Length (4 octets), and the length of the ILV data found
	  in the value field, in octets.
	  Note that, as in the case of the TLV, this length is the actual 
	  length of the value, before any padding for alignment is added.
          
</p><br /><hr class="insert" />
<a name="ilv_ref_pic"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Identifier                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Length                                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Value                                  |
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;15: ILV Representation&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>It should be noted that the "I" values are of local scope and are
        defined by the data declarations from the LFB definition. Refer to
        <a class='info' href='#DTLV'>Section&nbsp;7.1.8<span> (</span><span class='info'>DATA TLV</span><span>)</span></a> for discussions on usage of ILVs.
</p>
<a name="Proto_cons"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
Important Protocol encapsulations</h3>

<p>
	    In this section, we review a few encapsulation concepts
	    that are used by the ForCES protocol for its operations.
	    
</p>
<p>
	    We briefly re-introduce two concepts, Paths and
	    Keys, from the model draft 
	    <a class='info' href='#FE-MODEL'>[FE&#8209;MODEL]<span> (</span><span class='info'>Yang, L., Halpern, J., Gopal, R., DeKok, A., Haraszti, Z., and S. Blake, &ldquo;ForCES Forwarding Element Model,&rdquo; Feb.&nbsp;2005.</span><span>)</span></a> in order to
	    provide context. The reader is referred to 
	    <a class='info' href='#FE-MODEL'>[FE&#8209;MODEL]<span> (</span><span class='info'>Yang, L., Halpern, J., Gopal, R., DeKok, A., Haraszti, Z., and S. Blake, &ldquo;ForCES Forwarding Element Model,&rdquo; Feb.&nbsp;2005.</span><span>)</span></a> for a lot of the finer
	    details.
	    
</p>
<p>
	    For readability reasons, we introduce the encapsulation
	    schemes that are used to carry content in a protocol
	    message, namely FULLDATA-TLV, SPARSEDATA-TLV,
	    and RESULT-TLV. 
	    
</p>
<a name="paths"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4.1"></a><h3>6.4.1.&nbsp;
Paths</h3>

<p>
	    The model draft <a class='info' href='#FE-MODEL'>[FE&#8209;MODEL]<span> (</span><span class='info'>Yang, L., Halpern, J., Gopal, R., DeKok, A., Haraszti, Z., and S. Blake, &ldquo;ForCES Forwarding Element Model,&rdquo; Feb.&nbsp;2005.</span><span>)</span></a> defines
	    an XML-based language that allows for a  formal definition
	    of LFBs. This is similar to the relationship between ASN.1
	    and SNMP MIB definition (MIB being analogous to the LFB
	    and ASN.1 being analogous to the XML model language). 
	    Any entity that the CE configures on an FE MUST be 
	    formally defined in an LFB. These entities
	    could be scalars (e.g., a 32-bit IPv4 address) or vectors
	    (such as a nexthop table). Each entity within the LFB 
	    is given a numeric 32-bit identifier known as an "component id". 
	    This scheme allows the attribute
	    to be "addressed" in a protocol construct. 
            
</p>
<p>These addressable
	    entities could be hierarchical (e.g., a table column or a cell
	    within a table row). In order to address hierarchical
	    data, the concept of a path is introduced by the 
	    model <a class='info' href='#FE-MODEL'>[FE&#8209;MODEL]<span> (</span><span class='info'>Yang, L., Halpern, J., Gopal, R., DeKok, A., Haraszti, Z., and S. Blake, &ldquo;ForCES Forwarding Element Model,&rdquo; Feb.&nbsp;2005.</span><span>)</span></a>. A path is a series of
            32-bit component IDs which are typically presented in a 
	    dot-notation (e.g., 1.2.3.4). Section
	    (<a class='info' href='#Proto_Msg'>Section&nbsp;7<span> (</span><span class='info'>Protocol Construction</span><span>)</span></a>) formally defines how paths
	    are used to reference data that is being encapsulated 
	    within a protocol message.
	    
</p>
<a name="Keys"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4.2"></a><h3>6.4.2.&nbsp;
Keys</h3>

<p>
             The model draft <a class='info' href='#FE-MODEL'>[FE&#8209;MODEL]<span> (</span><span class='info'>Yang, L., Halpern, J., Gopal, R., DeKok, A., Haraszti, Z., and S. Blake, &ldquo;ForCES Forwarding Element Model,&rdquo; Feb.&nbsp;2005.</span><span>)</span></a> defines
	     two ways to address table rows. The standard/common mechanism
	     is to allow table rows to be referenced by a 32-bit index.
	     The secondary mechanism is via Keys which allow for 
	     content addressing. An example key is a multi-field 
	     content key that uses the IP address and prefix length 
	     to uniquely reference an IPv4 routing table row. In essence,
	     while the common scheme to address a table row is via
	     its table index, a table row's path could be derived
	     from a key. The KEYINFO-TLV (<a class='info' href='#Proto_Msg'>Section&nbsp;7<span> (</span><span class='info'>Protocol Construction</span><span>)</span></a>)
	     is used to carry the data that is used to do the lookup.
	    
</p>
<a name="pdata1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4.3"></a><h3>6.4.3.&nbsp;
DATA TLVs</h3>

<p>
	    Data from or to the FE is carried in two types of TLVs:
	    FULLDATA-TLV and SPARSEDATA-TLV. Responses to operations
	    executed by the FE are carried in RESULT-TLVs.
	    
</p>
<p>In FULLDATA-TLV, the data is encoded in such a way
	    that a receiver of such data, by virtue of being armed 
	    with knowledge of the path and the LFB definition, can
	    infer or correlate the TLV "Value" contents.
	    This is essentially an optimization that helps reduce the 
	    amount of description required for the transported data in 
	    the protocol grammar. Refer to 
	    <a class='info' href='#DataencExam'>Appendix&nbsp;C<span> (</span><span class='info'>Data Encoding Examples</span><span>)</span></a> for an example of 
	    FULLDATA-TLVs.
	    
</p>
<p>A number of operations in ForCES will need to 
	    reference optional data within larger structures. The 
	    SPARSEDATA-TLV encoding is provided to make it easier 
	    to encapsulate optionally appearing data
	    components. Refer to <a class='info' href='#DataencExam'>Appendix&nbsp;C<span> (</span><span class='info'>Data Encoding Examples</span><span>)</span></a> for
	    an example of SPARSEDATA-TLV.
</p>
<p>
	    RESULT-TLVs carry responses back from the FE 
	    based on a config issued by the CE.
	    Refer to <a class='info' href='#DataencExam'>Appendix&nbsp;C<span> (</span><span class='info'>Data Encoding Examples</span><span>)</span></a> for examples
	    of RESULT-TLVs and <a class='info' href='#RTLV'>Section&nbsp;7.1.7<span> (</span><span class='info'>RESULT TLV</span><span>)</span></a>
	    for layout.
    
</p>
<a name="addressing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4.4"></a><h3>6.4.4.&nbsp;
Addressing LFB entities</h3>

<p>
	    <a class='info' href='#paths'>Section&nbsp;6.4.1<span> (</span><span class='info'>Paths</span><span>)</span></a> and <a class='info' href='#Keys'>Section&nbsp;6.4.2<span> (</span><span class='info'>Keys</span><span>)</span></a>
	    discuss how to target an entity within an LFB. However,
	    the addressing mechanism used requires that an LFB type
	    and instance is selected first. The LFB Selector is used
	    to select an LFB type and instance being targeted.
	    Section (<a class='info' href='#Proto_Msg'>Section&nbsp;7<span> (</span><span class='info'>Protocol Construction</span><span>)</span></a>) 
	    goes into more details; for our purpose, we illustrate this
	    concept using <a class='info' href='#entadd'>Figure&nbsp;16<span> (</span><span class='info'>Entity Addressing </span><span>)</span></a> below. 
	    More examples of layouts can be found reading further
	    into the text (Example: <a class='info' href='#Pathd_lay'>Figure&nbsp;21<span> (</span><span class='info'>Sample operation layout</span><span>)</span></a>).

<br /><hr class="insert" />
<a name="entadd"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

    main hdr (Message type: example "config")
     |
     |
     |
     +- T = LFBselect
            |
            +-- LFBCLASSID (unique per LFB defined)
            |
            |
            +-- LFBInstance  (runtime configuration)
            |
            +-- T = An operation TLV describes what we do to an entity
                |   //Refer to the OPER-TLV values enumerated below
                |   //the TLVs that can be used for operations
                |
                |
                +--+-- one or more path encodings to target an entity
                   | // Refer to the discussion on keys and paths
                   |
                   |
                   +-- The associated data, if any, for the entity
                      // Refer to discussion on FULL/SPARSE DATA TLVs

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;16: Entity Addressing &nbsp;</b></font><br /></td></tr></table><hr class="insert" />


    
</p>
<a name="Proto_Msg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Protocol Construction</h3>

<p>
      A protocol layer PDU consists of a Common Header (defined in Section
      <a class='info' href='#Common_Header'>Section&nbsp;6.1<span> (</span><span class='info'>Common Header</span><span>)</span></a> ) and
      a message body.  The Common Header is followed by a 
      message-type-specific message 
      body. Each message body is formed from one or more top-level TLVs.  
      A top-level
      TLV may contain one or more sub-TLVs; these sub-TLVs are described in
      this document as OPER-TLVs, because they describe an operation to be
      done.

      
</p>
<p>
        <br /><hr class="insert" />
<a name="PMsgt"></a>

<p style='text-align: center'>
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center"><col align="center"><col align="center">
<tr><th align="center">Message Name</th><th align="center">Top-Level TLV</th><th align="center">OPER-TLV(s)</th><th align="center">Reference</th></tr>
<tr>
<td align="center">Association Setup</td>
<td align="center">(LFBselect)*</td>
<td align="center">REPORT</td>
<td align="center"><a class='info' href='#Assoc_Setup_Resp'>Section&nbsp;7.5.2<span> (</span><span class='info'>Association Setup Response Message</span><span>)</span></a></td>
</tr>
<tr>
<td align="center">Association Setup Response</td>
<td align="center">ASRresult-TLV</td>
<td align="center">none</td>
<td align="center"><a class='info' href='#Assoc_Setup_Resp'>Section&nbsp;7.5.2<span> (</span><span class='info'>Association Setup Response Message</span><span>)</span></a></td>
</tr>
<tr>
<td align="center">Association Teardown</td>
<td align="center">ASTreason-TLV</td>
<td align="center">none</td>
<td align="center"><a class='info' href='#Assoc_Tear_Resp'>Section&nbsp;7.5.3<span> (</span><span class='info'>Association Teardown Message</span><span>)</span></a></td>
</tr>
<tr>
<td align="center">Config</td>
<td align="center">(LFBselect)+</td>
<td align="center">(SET |
              SET-PROP | 
              DEL |    
              COMMIT |
              TRCOMP)+</td>
<td align="center"><a class='info' href='#CfgMsg'>Section&nbsp;7.6.1<span> (</span><span class='info'>Config Message</span><span>)</span></a></td>
</tr>
<tr>
<td align="center">Config Response</td>
<td align="center">(LFBselect)+</td>
<td align="center">(SET-RESPONSE |
              SET-PROP-RESPONSE | 
              DEL-RESPONSE |
              COMMIT-RESPONSE)+</td>
<td align="center"><a class='info' href='#Config_Response'>Section&nbsp;7.6.2<span> (</span><span class='info'>Config Response Message</span><span>)</span></a></td>
</tr>
<tr>
<td align="center">Query</td>
<td align="center">(LFBselect)+</td>
<td align="center">(GET | 
             GET-PROP)+</td>
<td align="center"><a class='info' href='#Query'>Section&nbsp;7.7.1<span> (</span><span class='info'>Query Message</span><span>)</span></a></td>
</tr>
<tr>
<td align="center">Query Response</td>
<td align="center">(LFBselect)+</td>
<td align="center">(GET-RESPONSE |
              GET-PROP-RESPONSE)+</td>
<td align="center"><a class='info' href='#QueryResponse'>Section&nbsp;7.7.2<span> (</span><span class='info'>Query Response Message</span><span>)</span></a></td>
</tr>
<tr>
<td align="center">Event Notifi- cation</td>
<td align="center">LFBselect</td>
<td align="center">REPORT</td>
<td align="center"><a class='info' href='#EventMsg'>Section&nbsp;7.8<span> (</span><span class='info'>Event Notification Message</span><span>)</span></a></td>
</tr>
<tr>
<td align="center">Packet Redirect</td>
<td align="center">REDIRECT-TLV</td>
<td align="center">none</td>
<td align="center"><a class='info' href='#RedirectMsg'>Section&nbsp;7.9<span> (</span><span class='info'>Packet Redirect Message</span><span>)</span></a></td>
</tr>
<tr>
<td align="center">Heartbeat</td>
<td align="center">none</td>
<td align="center">none</td>
<td align="center"><a class='info' href='#HBMsg'>Section&nbsp;7.10<span> (</span><span class='info'>Heartbeat Message</span><span>)</span></a></td>
</tr>
</table>
<br clear="all" />

<p style='text-align: center'>
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

  The different messages are illustrated in
  <a class='info' href='#PMsgt'>Table&nbsp;1</a>.
      The different message type numerical values are defined in
      <a class='info' href='#MSGt_Def'>Appendix&nbsp;A.1<span> (</span><span class='info'>Message Type Name Space</span><span>)</span></a>. All the TLVs values
      are defined in <a class='info' href='#OPERt_Def'>Appendix&nbsp;A.2<span> (</span><span class='info'>Operation Selection</span><span>)</span></a>.
  

<p>
	An LFBselect TLV (refer to <a class='info' href='#LFBselectTLV'>Section&nbsp;7.1.5<span> (</span><span class='info'>LFBselect-TLV</span><span>)</span></a>)
	contains the LFB Classid and LFB Instance being referenced
	as well as the OPER-TLV(s) being applied to that reference.

</p>
<p>
		Each type of OPER-TLV is constrained as to how it describes
		the paths and selectors of interest. The following BNF 
		describes the basic structure of an OPER-TLV and 
		<a class='info' href='#FSt'>Table&nbsp;2</a> gives the details for each type

        <br /><hr class="insert" />
<a name="OPER_BNF"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    OPER-TLV := 1*PATH-DATA-TLV
    PATH-DATA-TLV := PATH  [DATA]
    PATH := flags IDcount IDs [SELECTOR]
    SELECTOR :=  KEYINFO-TLV
    DATA := FULLDATA-TLV / SPARSEDATA-TLV / RESULT-TLV /
            1*PATH-DATA-TLV
    KEYINFO-TLV := KeyID FULLDATA-TLV
    FULLDATA-TLV := encoded data component which may nest
                   further FULLDATA-TLVs
    SPARSEDATA-TLV := encoded data that may have optionally
                     appearing components
    RESULT-TLV := Holds result code and optional FULLDATA-TLV

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;17: BNF of OPER-TLV&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


</p>
<ul class="text">
<li>PATH-DATA-TLV identifies the exact component targeted and may
    have zero or more paths associated with it. The last PATH-DATA-TLV
    in the case of nesting of paths via the DATA construct in the case
    of SET, SET-PROP requests and GET-RESPONSE/GET-PROP-RESPONSE
    is terminated 
    by encoded data or response in the form of either 
    FULLDATA-TLV or SPARSEDATA-TLV or RESULT-TLV.
    
</li>
<li>PATH provides the path to the data being referenced.
    
<ul class="text">
<li>flags (16 bits) are used to further refine the operation to
      be applied on the Path. More on these later.
</li>
<li>IDcount(16 bit): count of 32 bit IDs
</li>
<li>IDs: zero or more 32bit IDs (whose count is given by IDcount)
      defining the main path. Depending on the flags, IDs could be
      field IDs only or a mix of field and dynamic IDs. Zero is used
      for the special case of using the entirety of the containing
      context as the result of the path.
</li>
</ul>
    
</li>
<li>SELECTOR is an optional construct that further defines the
    PATH. Currently, the only defined selector is the KEYINFO-TLV,
    used for selecting an array entry by the value of a key field. The
    presence of a SELECTOR is correct only when the flags also
    indicate its presence. A mismatch is a protocol format error.
</li>
<li>A KEYINFO-TLV contains information used in content keying.
    
<ul class="text">
<li>A KeyID is used in a KEYINFO-TLV. It indicates which key
	for the current array is being used as the content key for
	array entry selection.
</li>
<li>The key's data is the data to look for in the array, in the
	fields identified by the key field. The information is encoded
	according to the rules for the contents of a FULLDATA-TLV, and
	represent the field or fields which make up the key identified
	by the KeyID.
</li>
</ul> 
</li>
<li>DATA may contain a FULLDATA-TLV, SPARSEDATA-TLV, a RESULT-TLV
       or 1 or more further PATH-DATA selection. FULLDATA-TLV and 
    SPARSEDATA-TLV are only allowed on SET or SET-PROP requests, or on 
    responses which return
    content information (GET-RESPONSE  for example). PATH-DATA may be
    included to extend the path on any request. 
<ul class="text">
<li>Note: Nested PATH-DATA TLVs are supported as an efficiency
	measure to permit common subexpression extraction.
</li>
<li>FULLDATA-TLV and SPARSEDATA-TLV contain "the data" whose path 
has been selected by the PATH. Refer to <a class='info' href='#gd_def'>Section&nbsp;7.1<span> (</span><span class='info'>Discussion on encoding</span><span>)</span></a>
	for details.
</li>
<li>
      The following table summarizes the applicability and
      restrictions of the FULL/SPARSEDATA-TLVs and the RESULT-TLV 
      to the OPER-TLVs.

        <br /><hr class="insert" />
<a name="FSt"></a>

<p style='text-align: center'>
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center"><col align="center">
<tr><th align="center">OPER-TLV</th><th align="center">DATA TLV</th><th align="center">RESULT-TLV</th></tr>
<tr>
<td align="center">SET</td>
<td align="center">(FULLDATA-TLV |
		      SPARSEDATA-TLV)+</td>
<td align="center">none</td>
</tr>
<tr>
<td align="center">SET-PROP</td>
<td align="center">(FULLDATA-TLV |
		      SPARSEDATA-TLV)+</td>
<td align="center">none</td>
</tr>
<tr>
<td align="center">SET-RESPONSE</td>
<td align="center">none</td>
<td align="center">(RESULT-TLV)+</td>
</tr>
<tr>
<td align="center">SET-PROP-RESPONSE</td>
<td align="center">none</td>
<td align="center">(RESULT-TLV)+</td>
</tr>
<tr>
<td align="center">DEL</td>
<td align="center">(FULLDATA-TLV |
		      SPARSEDATA-TLV)+</td>
<td align="center">none</td>
</tr>
<tr>
<td align="center">DEL-RESPONSE</td>
<td align="center">none</td>
<td align="center">(RESULT-TLV)+</td>
</tr>
<tr>
<td align="center">GET</td>
<td align="center">none</td>
<td align="center">none</td>
</tr>
<tr>
<td align="center">GET-PROP</td>
<td align="center">none</td>
<td align="center">none</td>
</tr>
<tr>
<td align="center">GET-RESPONSE</td>
<td align="center">(FULLDATA-TLV)+</td>
<td align="center">(RESULT-TLV)*</td>
</tr>
<tr>
<td align="center">GET-PROP-RESPONSE</td>
<td align="center">(FULLDATA-TLV)+</td>
<td align="center">(RESULT-TLV)*</td>
</tr>
<tr>
<td align="center">REPORT</td>
<td align="center">(FULLDATA-TLV)+</td>
<td align="center">none</td>
</tr>
<tr>
<td align="center">COMMIT</td>
<td align="center">none</td>
<td align="center">none</td>
</tr>
<tr>
<td align="center">COMMIT-RESPONSE</td>
<td align="center">none</td>
<td align="center">(RESULT-TLV)+</td>
</tr>
<tr>
<td align="center">TRCOMP</td>
<td align="center">none</td>
<td align="center">none</td>
</tr>
</table>
<br clear="all" />

<p style='text-align: center'>
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

	    
	       
</li>
</ul> 
	    
</li>
<li>RESULT-TLV contains the indication of whether the individual
	   SET or SET-PROP succeeded.  RESULT-TLV is included on the 
	    assumption that
	    individual parts of a SET request can succeed or fail separately.
	    
</li>
</ul>
<p>In summary this approach has the following characteristic:
</p>
<p>
	  </p>
<ul class="text">
<li>There can be one or more LFB class ID and  instance ID 
	  combination targeted in a message (batch)
</li>
<li>There can one or more operations on an addressed LFB
	    class ID/instance ID combination (batch)
</li>
<li>There can be one or more path targets per operation (batch)
</li>
<li>Paths may have zero or more data values associated (flexibility
	    and operation specific)
</li>
</ul><p>
	
</p>
<p>It should be noted that the above is optimized for the case of a
	  single LFB class ID and instance ID targeting. To target multiple 
	  instances
	  within the same class, multiple LFBselects are needed.
</p>
<a name="gd_def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Discussion on encoding</h3>

<p>
	  <a class='info' href='#pdata1'>Section&nbsp;6.4.3<span> (</span><span class='info'>DATA TLVs</span><span>)</span></a> discusses the two types
	  of DATA encodings (FULLDATA-TLV and SPARSEDATA-TLV)
	  and the justifications for their existence. In this 
	  section we explain how they are encoded.
          
</p>
<a name="pack_def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.1"></a><h3>7.1.1.&nbsp;
Data Packing Rules</h3>

<p>The scheme for encoding data used in this doc adheres to the
       following rules: 
       </p>
<ul class="text">
<li>The Value ("V" of TLV) of FULLDATA-TLV will contain the
	  data being transported. This data will be as was described
	  in the LFB definition.
</li>
<li>Variable sized data within a FULLDATA-TLV will be
	  encapsulated inside another FULLDATA-TLV inside the V of the
	  outer TLV. For example of such a setup refer to 
	  <a class='info' href='#DataencExam'>Appendix&nbsp;C<span> (</span><span class='info'>Data Encoding Examples</span><span>)</span></a> and 
          <a class='info' href='#use_cases'>Appendix&nbsp;D<span> (</span><span class='info'>Use Cases</span><span>)</span></a> 
</li>
<li>In the case of FULLDATA-TLVs:
</li>
<ul class="text">
<li>When a table is referred to in the PATH (IDs) of a
	    PATH-DATA-TLV, then the FULLDATA-TLV's "V" will contain that
	    table's row content prefixed by its 32 bit
	    index/subscript. On the other hand, when PATH flags are 00, 
	    the PATH may contain an index pointing to a row in table; 
	    in such a case, the FULLDATA-TLV's "V" will only contain the content
	    with the index in order to avoid ambiguity.
</li>
</ul>
</ul>

<a name="pat_flags"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.2"></a><h3>7.1.2.&nbsp;
Path Flags</h3>

<p>The following flags are currently defined: </p>
<ul class="text">
<li>SELECTOR Bit: F_SELKEY indicates that a KEY Selector is
	  present following this path information, and should be
	  considered in evaluating the path.
</li>
</ul>

<a name="ret_flags"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.3"></a><h3>7.1.3.&nbsp;
Relation of operational flags with global message flags</h3>

<p>Global flags, such as the execution mode and the atomicity
           indicators defined in the header, apply to all operations in a
           message. Global flags provide semantics that are orthogonal to
           those provided by the operational flags, such as the flags
           defined in Path Data. The scope of operational flags is
           restricted to the operation.
</p>
<a name="keys"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.4"></a><h3>7.1.4.&nbsp;
Content Path Selection</h3>

<p>The KEYINFO-TLV describes the KEY as well as associated KEY
              data. KEYs, used for content searches, are restricted and
              described in the LFB definition.
</p>
<a name="LFBselectTLV"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.5"></a><h3>7.1.5.&nbsp;
LFBselect-TLV</h3>

<p>The LFBselect TLV is an instance of a TLV as defined in <a class='info' href='#tlv_ref'>Section&nbsp;6.2<span> (</span><span class='info'>Type Length Value (TLV) Structuring </span><span>)</span></a>. The definition is as below:
</p><br /><hr class="insert" />
<a name="LFB select TLV"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |        Type = LFBselect       |               Length          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                          LFB Class ID                         |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                        LFB Instance ID                        |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                        OPER-TLV                               |
 .                                                               .
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 ~                           ...                                 ~
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                        OPER-TLV                               |
 .                                                               .
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;18: PL PDU layout&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<blockquote class="text"><dl>
<dt>Type: </dt>
<dd> The type of the TLV is
           "LFBselect"
</dd>
<dt>Length: </dt>
<dd> Length of the TLV including
                the T and L fields, in octets.
</dd>
<dt>LFB Class ID: </dt>
<dd> This field uniquely
                recognizes the LFB class/type.
</dd>
<dt>LFB Instance ID: </dt>
<dd> This field uniquely
                identifies the LFB instance.
</dd>
<dt>OPER-TLV: </dt>
<dd> It describes an
                operation nested in the LFBselect TLV. Note that usually
                there SHOULD be at least one OPER-TLV present for an LFB
		select TLV, but for the Association Setup Message defined 
		in <a class='info' href='#Asso_Setup'>Section&nbsp;7.5.1<span> (</span><span class='info'>Association Setup Message</span><span>)</span></a> where the OPER-TLV is 
		optional.
	        
</dd>
</dl></blockquote>
<a name="OTLV"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.6"></a><h3>7.1.6.&nbsp;
OPER-TLV</h3>

<p>The OPER-TLV is a place holder in the grammar for 
    TLVs that define operations. The different types are
    defined in <a class='info' href='#TLVt'>Table&nbsp;3</a>, below. 
        <br /><hr class="insert" />
<a name="TLVt"></a>

<p style='text-align: center'>
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center"><col align="center">
<tr><th align="center">OPER-TLV</th><th align="center">TLV "Type"</th><th align="center">Comments</th></tr>
<tr>
<td align="center">SET</td>
<td align="center">0x0001</td>
<td align="center">From CE to FE. Used to create or add or update attributes</td>
</tr>
<tr>
<td align="center">SET-PROP</td>
<td align="center">0x0002</td>
<td align="center">From CE to FE. Used to create or add or update attribute 
             properties</td>
</tr>
<tr>
<td align="center">SET-RESPONSE</td>
<td align="center">0x0003</td>
<td align="center">From FE to CE. Used to carry response of a SET</td>
</tr>
<tr>
<td align="center">SET-PROP-RESPONSE</td>
<td align="center">0x0004</td>
<td align="center">From FE to CE. Used to carry response of a SET-PROP</td>
</tr>
<tr>
<td align="center">DEL</td>
<td align="center">0x0005</td>
<td align="center">From CE to FE. Used to delete or remove an attribute</td>
</tr>
<tr>
<td align="center">DEL-RESPONSE</td>
<td align="center">0x0006</td>
<td align="center">From FE to CE. Used to carry response of a DEL</td>
</tr>
<tr>
<td align="center">GET</td>
<td align="center">0x0007</td>
<td align="center">From CE to FE. Used to retrieve an attribute</td>
</tr>
<tr>
<td align="center">GET-PROP</td>
<td align="center">0x0008</td>
<td align="center">From CE to FE. Used to retrieve an attribute property</td>
</tr>
<tr>
<td align="center">GET-RESPONSE</td>
<td align="center">0x0009</td>
<td align="center">From FE to CE. Used to carry response of a GET</td>
</tr>
<tr>
<td align="center">GET-PROP-RESPONSE</td>
<td align="center">0x000A</td>
<td align="center">From FE to CE. Used to carry response of a GET-PROP</td>
</tr>
<tr>
<td align="center">REPORT</td>
<td align="center">0x000B</td>
<td align="center">From FE to CE. Used to carry an asynchronous event</td>
</tr>
<tr>
<td align="center">COMMIT</td>
<td align="center">0x000C</td>
<td align="center">From CE to FE. Used to issue a commit in a 2PC transaction</td>
</tr>
<tr>
<td align="center">COMMIT-RESPONSE</td>
<td align="center">0x000D</td>
<td align="center">From an FE to CE. Used to confirm a commit in a 2PC transaction</td>
</tr>
<tr>
<td align="center">TRCOMP</td>
<td align="center">0x000E</td>
<td align="center">From CE to FE. Used to indicate NE-wide success of 2PC transaction</td>
</tr>
</table>
<br clear="all" />

<p style='text-align: center'>
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 3&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

    Different messages define OPER-TLV are valid and how they are
    used (refer to <a class='info' href='#PMsgt'>Table&nbsp;1</a> and <a class='info' href='#FSt'>Table&nbsp;2</a>). 
    

<p>SET, SET-PROP, and GET/GET-PROP requests are issued 
    by the CE and 
    do not carry RESULT-TLVs. On the other hand, SET-RESPONSE,
    SET-PROP-RESPONSE and GET-RESPONSE/GET-PROP-RESPONSE 
    carry RESULT-TLVs.
    
</p>
<p>A GET-RESPONSE in response to a successful GET  will have
     FULLDATA-TLVs added to the leaf paths to carry the requested
     data. For GET operations that fail, instead of the FULLDATA-TLV
     there will be a RESULT-TLV.
</p>
<p>For a SET-RESPONSE/SET-PROP-RESPONSE, each FULLDATA-TLV
     or SPARSEDATA-TLV in the
     original request will be replaced with a RESULT-TLV in the
     response. If the request set the FailureACK flag, then only those items
     which failed will appear in the response. If the request was for
     AlwaysACK, then all components of the request will appear in the
     response with RESULT-TLVs.
</p>
<p>Note that if a SET/SET-PROP request with a structure 
     in a FULLDATA-TLV is
     issued, and some field in the structure is invalid, the FE will
     not attempt to indicate which field was invalid, but rather will
     indicate that the operation failed. Note further that if there
     are multiple errors in a single leaf PATH-DATA/FULLDATA-TLB, the
     FE can select which error it chooses to return. So if a 
     FULLDATA-TLV
     for a SET/SET-PROP of a structure attempts to write one 
     field which is
     read only, and attempts to set another field to an invalid
     value, the FE can return indication of either error.
</p>
<p>A SET/SET-PROP operation on a variable length 
     component with a length of
     0 for the item is not the same as deleting it. If the CE wishes
     to delete then the DEL operation should be used whether the 
     path refers to an array component or an optional structure 
     component.
</p>
<a name="RTLV"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.7"></a><h3>7.1.7.&nbsp;
RESULT TLV</h3>

<p>The RESULT-TLV is an instance of TLV defined in <a class='info' href='#tlv_ref'>Section&nbsp;6.2<span> (</span><span class='info'>Type Length Value (TLV) Structuring </span><span>)</span></a>. The definition is as below:
</p><br /><hr class="insert" />
<a name="Result_TLV"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Type = RESULT-TLV          |               Length          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | Result Value  |                  Reserved                     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;19: RESULT TLV&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="ErrorTbl"></a>

<p style='text-align: center'>Defined Result Values
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center"><col align="center">
<tr><th align="center">Result Value</th><th align="center">Value</th><th align="center">Definition</th></tr>
<tr>
<td align="center">E_SUCCESS</td>
<td align="center">0x00</td>
<td align="center">Success</td>
</tr>
<tr>
<td align="center">E_INVALID_HEADER</td>
<td align="center">0x01</td>
<td align="center">Unspecified error with header.</td>
</tr>
<tr>
<td align="center">E_LENGTH_MISMATCH</td>
<td align="center">0x02</td>
<td align="center">Header length field does not match
                actual packet length.</td>
</tr>
<tr>
<td align="center">E_VERSION_MISMATCH </td>
<td align="center">0x03</td>
<td align="center">Unresolvable mismatch in versions.</td>
</tr>
<tr>
<td align="center">E_INVALID_DESTINATION_PID</td>
<td align="center">0x04</td>
<td align="center">Destination PID is invalid for the
                message receiver.</td>
</tr>
<tr>
<td align="center">E_LFB_UNKNOWN</td>
<td align="center">0x05</td>
<td align="center">LFB Class ID is not known by
                receiver.</td>
</tr>
<tr>
<td align="center">E_LFB_NOT_FOUND</td>
<td align="center">0x06</td>
<td align="center">LFB Class ID is known by receiver but
                not currently in use.</td>
</tr>
<tr>
<td align="center">E_LFB_INSTANCE_ID_NOT_FOUND</td>
<td align="center">0x07</td>
<td align="center">LFB Class ID is known but the specified
                instance of that class does not exist.</td>
</tr>
<tr>
<td align="center">E_INVALID_PATH</td>
<td align="center">0x08</td>
<td align="center">The specified path is impossible.</td>
</tr>
<tr>
<td align="center">E_COMPONENT_DOES_NOT_EXIST</td>
<td align="center">0x09</td>
<td align="center">The specified path is possible but the
                component does not exist (e.g., attempt to modify a table row
                that has not been created).</td>
</tr>
<tr>
<td align="center">E_EXISTS</td>
<td align="center">0x0A</td>
<td align="center">The specified object exists but it
                cannot exist for the operation to succeed (e.g., attempt to
                add an existing LFB instance or array subscript).</td>
</tr>
<tr>
<td align="center">E_NOT_FOUND </td>
<td align="center">0x0B</td>
<td align="center">The specified object does not exist but
		it must exist for the operation to succeed (e.g., 
		attempt to delete a non-existing LFB instance or 
		array subscript).</td>
</tr>
<tr>
<td align="center">E_READ_ONLY</td>
<td align="center">0x0C</td>
<td align="center">Attempt to modify a read-only value.</td>
</tr>
<tr>
<td align="center">E_INVALID_ARRAY_CREATION </td>
<td align="center">0x0D</td>
<td align="center">Attempt to create an array with an
                unallowed subscript.</td>
</tr>
<tr>
<td align="center">E_VALUE_OUT_OF_RANGE</td>
<td align="center">0x0E</td>
<td align="center">Attempt to set a parameter to a value
                outside of its allowable range.</td>
</tr>
<tr>
<td align="center">E_CONTENTS_TOO_LONG</td>
<td align="center">0x0D</td>
<td align="center">Attempt to write contents larger than
                the target object space (i.e., exceeding a buffer).</td>
</tr>
<tr>
<td align="center">E_INVALID_PARAMETERS</td>
<td align="center">0x10</td>
<td align="center">Any other error with data parameters.</td>
</tr>
<tr>
<td align="center">E_INVALID_MESSAGE_TYPE</td>
<td align="center">0x11</td>
<td align="center">Message type is not acceptable.</td>
</tr>
<tr>
<td align="center">E_INVALID_FLAGS</td>
<td align="center">0x12</td>
<td align="center">Message flags are not acceptable for the
                given message type.</td>
</tr>
<tr>
<td align="center">E_INVALID_TLV</td>
<td align="center">0x13</td>
<td align="center">A TLV is not acceptable for the given
                message type.</td>
</tr>
<tr>
<td align="center">E_EVENT_ERROR</td>
<td align="center">0x14</td>
<td align="center">Unspecified error while handling an
                event.</td>
</tr>
<tr>
<td align="center">E_NOT_SUPPORTED</td>
<td align="center">0x15</td>
<td align="center">Attempt to perform a valid ForCES
   operation that is unsupported by the message receiver.</td>
</tr>
<tr>
<td align="center">E_MEMORY_ERROR</td>
<td align="center">0x16</td>
<td align="center">A memory error occurred while processing
   a message (no error detected in the message itself)</td>
</tr>
<tr>
<td align="center">E_INTERNAL_ERROR</td>
<td align="center">0x17</td>
<td align="center">An unspecified error occurred while
    processing a message (no error detected in the message
    itself)</td>
</tr>
<tr>
<td align="center">-</td>
<td align="center"> 0x18-0xFE</td>
<td align="center">Reserved</td>
</tr>
<tr>
<td align="center">E_UNSPECIFIED_ERROR</td>
<td align="center">0xFF</td>
<td align="center">Unspecified error (for when the FE can
   not decide what went wrong)</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 4&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="DTLV"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.8"></a><h3>7.1.8.&nbsp;
DATA TLV</h3>

<p>A FULLDATA-TLV has "T"= FULLDATA-TLV and a 16-bit Length 
	    followed by the data value/contents. Likewise, a SPARSEDATA-TLV 
	    has "T" = SPARSEDATA-TLV, a 16-bit Length, followed by the 
	    data value/contents.
	    In the case of the SPARSEDATA-TLV, each component in the 
	    Value part of the TLV will be further encapsulated in an ILV.
</p>
<p> Below are the encoding rules for the FULLDATA-TLV and 
	    SPARSEDATA-TLVs.
	    <a class='info' href='#DataencExam'>Appendix&nbsp;C<span> (</span><span class='info'>Data Encoding Examples</span><span>)</span></a> is very useful in illustrating
	      these rules: 
	      </p>
<ol class="text">
<li>Both ILVs and TLVs MUST be 32 bit aligned. Any padding bits
                  used for the alignment MUST be zero on transmission and MUST
                  be ignored upon reception.
</li>
<li>FULLDATA-TLVs may be used at a particular path only if
		  every component at that path level is present. In example
		  1(c) of <a class='info' href='#DataencExam'>Appendix&nbsp;C<span> (</span><span class='info'>Data Encoding Examples</span><span>)</span></a> this concept
		  is illustrated by
		  the presence of all components of the structure S in the
		  FULLDATA-TLV encoding.  This requirement holds regardless 
		  of whether the fields are fixed or variable
                  length, mandatory or optional.
</li>
<ul class="text">
<li>If a FULLDATA-TLV is used, the encoder MUST lay
		  out data for each component in the same order in which 
		  the data was defined in the LFB specification. 
		  This ensures the decoder is able to retrieve the data. 
		  To use the example 1
	            again in <a class='info' href='#DataencExam'>Appendix&nbsp;C<span> (</span><span class='info'>Data Encoding Examples</span><span>)</span></a>, this implies
		    the encoder/decoder is assumed to have knowledge of how 
		    structure S is laid out in the definition.
</li>
<li>In the case of a SPARSEDATA-TLV, it does not need to
		  be ordered since the "I" in the ILV uniquely identifies
		  the component. Examples 1(a) and 1(b) in 
		  <a class='info' href='#DataencExam'>Appendix&nbsp;C<span> (</span><span class='info'>Data Encoding Examples</span><span>)</span></a> illustrate the power
	           of SPARSEDATA-TLV encoding.
</li>
</ul>
<li>Inside a FULLDATA-TLV 
<ul class="text">
<li>The values for atomic, fixed-length fields are given
                      without any TLV or ILV encapsulation.
</li>
<li>The values for atomic, variable-length fields are
                      given inside FULLDATA-TLVs.
</li>
</ul>
</li>
<li>Inside a SPARSEDATA-TLV 
<ul class="text">
<li>The values for atomic fields may be given with ILVs
                      (32-bit index, 32-bit length)
</li>
</ul>
</li>
<li>Any of the FULLDATA-TLVs can contain an ILV but an ILV
		  cannot contain a FULLDATA-TLV. This is because it is hard 
		  to disambiguate the ILV since an I is 32 bits and a
		  T is 16 bits.
</li>
<li>A FULLDATA-TLV can also contain a FULLDATA-TLV for 
		  variable sized components. The decoding disambiguation is 
		  assumed from rule
                  #3 above.
</li>
</ol>

<a name="SGR"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.9"></a><h3>7.1.9.&nbsp;
SET and GET Relationship</h3>

<p>It is expected that a GET-RESPONSE would satisfy the
              following: </p>
<ul class="text">
<li>It would have exactly the same path definitions as those
                  sent in the GET. The only difference being a GET-RESPONSE
                  will contain FULLDATA-TLVs.
</li>
<li>It should be possible to take the same GET-RESPONSE and
                  convert it to a SET successfully by merely changing
                  the T in the operational TLV.
</li>
<li>There are exceptions to this rule: 
<ol class="text">
<li>When a KEY selector is used with a path in a GET
                      operation, that selector is not returned in the
                      GET-RESPONSE; instead the cooked result is returned.
                      Refer to the examples using KEYS to see this.
</li>
<li>When dumping a whole table in a GET, the GET-RESPONSE
                      that merely edits the T to be SET will end up
                      overwriting the table.
</li>
</ol>
</li>
</ul>

<a name="vis_def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Protocol Encoding Visualization</h3>

<p>The figure below shows a general layout of the PL PDU. A main
          header is followed by one or more LFB selections each of which may
          contain one or more operation.
</p><br /><hr class="insert" />
<a name="PDU_lay"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>


main hdr (Config in this case)
     |
     |
     +--- T = LFBselect
     |        |
     |        +-- LFBCLASSID
     |        |
     |        |
     |        +-- LFBInstance
     |        |
     |        +-- T = SET
     |        |   |
     |        |   +--  // one or more path targets
     |        |        // with their data here to be added
     |        |
     |        +-- T  = DEL
     |        .   |
     |        .   +--  // one or more path targets to be deleted
     |
     |
     +--- T = LFBselect
     |        |
     |        +-- LFBCLASSID
     |        |
     |        |
     |        +-- LFBInstance
     |        |
     |        + -- T= SET
     |        |    .
     |        |    .
     |        + -- T= DEL
     |        |    .
     |        |    .
     |        |
     |        + -- T= SET
     |        |    .
     |        |    .
     |
     |
     +--- T = LFBselect
             |
             +-- LFBCLASSID
             |
             +-- LFBInstance
             .
             .
             .


</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;20: PL PDU logical layout&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The figure below shows a more detailed example of the
	  general layout 
	  of the operation within a targeted LFB selection. The idea is to 
	  show the different nesting levels a path could take to get to the 
	  target path.
</p><br /><hr class="insert" />
<a name="Pathd_lay"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>


     T = SET
     |  |
     |  +- T = Path-data
     |       |
     |       + -- flags
     |       + -- IDCount
     |       + -- IDs
     |       |
     |       +- T = Path-data
     |          |
     |          + -- flags
     |          + -- IDCount
     |          + -- IDs
     |          |
     |          +- T = Path-data
     |             |
     |             + -- flags
     |             + -- IDCount
     |             + -- IDs
     |             + -- T = KEYINFO-TLV
     |             |    + -- KEY_ID
     |             |    + -- KEY_DATA
     |             |
     |             + -- T = FULLDATA-TLV
     |                  + -- data
     |
     |
     T = SET
     |  |
     |  +- T = Path-data
     |  |  |
     |  |  + -- flags
     |  |  + -- IDCount
     |  |  + -- IDs
     |  |  |
     |  |  + -- T = FULLDATA-TLV
     |  |          + -- data
     |  +- T = Path-data
     |     |
     |     + -- flags
     |     + -- IDCount
     |     + -- IDs
     |     |
     |     + -- T = FULLDATA-TLV
     |             + -- data
     T = DEL
        |
        +- T = Path-data
             |
             + -- flags
             + -- IDCount
             + -- IDs
             |
             +- T = Path-data
                |
                + -- flags
                + -- IDCount
                + -- IDs
                |
                +- T = Path-data
                   |
                   + -- flags
                   + -- IDCount
                   + -- IDs
                   + -- T = KEYINFO-TLV
                   |    + -- KEY_ID
                   |    + -- KEY_DATA
                   +- T = Path-data
                        |
                        + -- flags
                        + -- IDCount
                        + -- IDs

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;21: Sample operation layout&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p> <a class='info' href='#use_cases'>Appendix&nbsp;D<span> (</span><span class='info'>Use Cases</span><span>)</span></a> shows  a more concise set of use-cases
		  on how the data encoding is done.
	  
</p>
<a name="LFB_def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Core ForCES LFBs</h3>

<p>There are two LFBs that are used to control the operation of the
	ForCES protocol and to interact with FEs and CEs: 
	</p>
<ul class="text">
<li>FE Protocol LFB
</li>
<li>FE Object LFB
</li>
</ul>

<p>Although these LFBs have the same form and interface as other LFBs,
        they are special in many respects. They have fixed well-known LFB
        Class and Instance IDs. They are statically defined (no dynamic
        instantiation allowed) and their status cannot be changed by the
        protocol: any operation to change the state of such LFBs (for
        instance, in order to disable the LFB) must result in an error.
        Moreover, these LFBs must exist before the first ForCES message can be
        sent or received. All attributes in these LFBs must have pre-defined
        default values. Finally, these LFBs do not have input or output ports
        and do not integrate into the intra-FE LFB topology.

        <br />
<br />

</p>
<a name="FPL_sum"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1"></a><h3>7.3.1.&nbsp;
FE Protocol LFB</h3>

<p>The FE Protocol LFB is a logical entity in each FE that is used
          to control the ForCES protocol. The FE Protocol LFB Class ID is
          assigned the value 0x2. The FE Protocol LFB Instance ID is assigned
          the value 0x1. There MUST be one and only one instance of the FE
          Protocol LFB in an FE. The values of the attributes in the FE
          Protocol LFB have pre-defined default values that are specified
          here. Unless explicit changes are made to these values using Config
          messages from the CE, these default values MUST be used for correct
          operation of the protocol.
</p>
<p>The formal definition of the FE Protocol Object LFB can be 
	  found in <a class='info' href='#FPL_def'>Appendix&nbsp;B<span> (</span><span class='info'>ForCES Protocol LFB schema</span><span>)</span></a>.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1"></a><h3>7.3.1.1.&nbsp;
FE Protocol capabilities</h3>

<p>FE Protocol capabilities are read-only.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.1"></a><h3>7.3.1.1.1.&nbsp;
SupportableVersions</h3>

<p> ForCES protocol version(s) supported by the FE
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.2"></a><h3>7.3.1.1.2.&nbsp;
FE Protocol Attributes </h3>

<p>FE Protocol attributes (can be read and set).
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.2.1"></a><h3>7.3.1.1.2.1.&nbsp;
CurrentRunningVersion</h3>

<p>Current running  version of the ForCES protocol
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.2.2"></a><h3>7.3.1.1.2.2.&nbsp;
FEID</h3>

<p>FE unicast ID
</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.2.3"></a><h3>7.3.1.1.2.3.&nbsp;
MulticastFEIDs</h3>

<p>FE multicast ID(s) list - this is a list of multicast IDs
              that the FE belongs to. These IDs are configured by the CE.
</p>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.2.4"></a><h3>7.3.1.1.2.4.&nbsp;
CEHBPolicy</h3>

<p>CE heartbeat policy - This policy, along with the parameter
              'CE Heartbeat Dead Interval (CE HDI)' as described below defines
              the operating parameters for the FE to check the CE liveness.
              The policy values with meanings are listed as below:
</p>
<ul class="text">
<li>0 (default) - This policy specifies that the CE will send a
                Heartbeat Message to the FE(s) whenever the CE reaches a time
                interval within which no other PL messages were sent from the
		CE to the FE(s); refer to <a class='info' href='#HB_appr'>Section&nbsp;4.3.3<span> (</span><span class='info'>Heartbeat Mechanism</span><span>)</span></a> and
		<a class='info' href='#HBMsg'>Section&nbsp;7.10<span> (</span><span class='info'>Heartbeat Message</span><span>)</span></a> for details. The CE HDI attribute 
		as described below is tied to this policy. 
	        
</li>
<li>1 - The CE will not generate any HB messages. This actually
                means CE does not want the FE to check the CE liveness.
</li>
<li>Others - reserved.
</li>
</ul>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.2.5"></a><h3>7.3.1.1.2.5.&nbsp;
CEHDI</h3>

<p>CE Heartbeat Dead Interval (CE HDI) - The time interval the
              FE uses to check the CE liveness. If FE has not received any
              messages from CE within this time interval, FE deduces lost
              connectivity which implies that the CE is dead or the
              association to the CE is lost. Default value 30 s.
</p>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.2.6"></a><h3>7.3.1.1.2.6.&nbsp;
FEHBPolicy</h3>

<p>FE heartbeat policy - This policy, along with the parameter
              'FE Heartbeat Interval (FE HI)', defines the operating
              parameters for how the FE should behave so that the CE can
              deduce its liveness. The policy values and the meanings are:
</p>
<ul class="text">
<li>0 (default) - The FE should not generate any Heartbeat
                messages. In this scenario, the CE is responsible for checking
                FE liveness by setting the PL header ACK flag of the message
                it sends to AlwaysACK. The FE responds to CE whenever CE sends
                such Heartbeat Request Message. Refer to <a class='info' href='#HBMsg'>Section&nbsp;7.10<span> (</span><span class='info'>Heartbeat Message</span><span>)</span></a> and <a class='info' href='#HB_appr'>Section&nbsp;4.3.3<span> (</span><span class='info'>Heartbeat Mechanism</span><span>)</span></a> for
                details.
</li>
<li>1 - This policy specifies that FE must actively send a
                Heartbeat Message if it reaches the time interval assigned by
                the FE HI as long as no other messages were sent from FE to CE
                during that interval as described in <a class='info' href='#HB_appr'>Section&nbsp;4.3.3<span> (</span><span class='info'>Heartbeat Mechanism</span><span>)</span></a>.
</li>
<li>Others - Reserved.
</li>
</ul>
<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.2.7"></a><h3>7.3.1.1.2.7.&nbsp;
FEHI</h3>

<p>FE Heartbeat Interval (FE HI) - The time interval the FE
              should use to send HB as long as no other messages were sent
              from FE to CE during that interval as described in <a class='info' href='#HB_appr'>Section&nbsp;4.3.3<span> (</span><span class='info'>Heartbeat Mechanism</span><span>)</span></a>. The default value for an FE HI is
              500ms.
</p>
<a name="PCE"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.2.8"></a><h3>7.3.1.1.2.8.&nbsp;
CEID</h3>

<p>Primary CEID - The CEID that the FE is associated with.
</p>
<a name="LPCE"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.2.9"></a><h3>7.3.1.1.2.9.&nbsp;
LastCEID</h3>

<p>Last Primary CEID - The CEID of the last CE that
	      that the FE associated with. This CE ID is reported
	      to the new Primary CEID.
</p>
<a name="BCE"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.2.10"></a><h3>7.3.1.1.2.10.&nbsp;
BackupCEs</h3>

<p>The list of backup CEs an FE can use as backups.
              Refer to <a class='info' href='#HA'>Section&nbsp;8<span> (</span><span class='info'>High Availability Support</span><span>)</span></a> for details.
</p>
<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.2.11"></a><h3>7.3.1.1.2.11.&nbsp;
CEFailoverPolicy</h3>

<p>CE failover policy - This specifies the behavior of the FE
	      when the association with the CE is lost.
	      There is a very tight relation between CE failover policy 
	      and <a class='info' href='#PCE'>Section&nbsp;7.3.1.1.2.8<span> (</span><span class='info'>CEID</span><span>)</span></a>, <a class='info' href='#BCE'>Section&nbsp;7.3.1.1.2.10<span> (</span><span class='info'>BackupCEs</span><span>)</span></a>, 
	      <a class='info' href='#CEFTI'>Section&nbsp;7.3.1.1.2.12<span> (</span><span class='info'>CEFTI</span><span>)</span></a>, and <a class='info' href='#HA'>Section&nbsp;8<span> (</span><span class='info'>High Availability Support</span><span>)</span></a>.
	      When an association is lost, depending on configuration,
	      one of the policies listed below is activated. 
</p>
<ul class="text">
<li>0 (default) - FE should stop functioning immediately 
		and transition to FE OperDisable.
		
</li>
<li>1 - The FE should continue running and do what it
                can even without an associated CE. This basically requires
		that the FE support CE Graceful restart (and defines
		such support in its capabilities).
		If the CEFTI expires before the FE re-associates with either
		the primary (<a class='info' href='#PCE'>Section&nbsp;7.3.1.1.2.8<span> (</span><span class='info'>CEID</span><span>)</span></a>) or one of possibly
		several backup CEs (<a class='info' href='#BCE'>Section&nbsp;7.3.1.1.2.10<span> (</span><span class='info'>BackupCEs</span><span>)</span></a>), the FE will go
                operationally down.
</li>
<li>Others - Reserved
</li>
</ul>
<a name="CEFTI"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.2.12"></a><h3>7.3.1.1.2.12.&nbsp;
CEFTI</h3>

<p>CE Failover Timeout Interval (CEFTI) - The time interval 
	      associated with the CE failover policy case '0' and '2'. 
	      The default value is set to 300 seconds. Note that it is 
	      advisable to set the CEFTI value much higher than the 
	      CE Heartbeat Dead Interval (CE HDI) since the effect of 
	      expiring this parameter is devastating
              to the operation of the FE.
</p>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1.1.2.13"></a><h3>7.3.1.1.2.13.&nbsp;
FERestartPolicy</h3>

<p>FE restart policy - This specifies the behavior of the FE
              during an FE restart. The restart may be from an FE failure or
              other reasons that have made FE down and then need to restart.
              The values are defined as below:
</p>
<ul class="text">
<li>0(default)- Restart the FE from scratch. In this case,
                the FE should start from the pre-association phase.
</li>
<li>others - Reserved for future use.
</li>
</ul>
<a name="FEO"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.2"></a><h3>7.3.2.&nbsp;
FE Object LFB</h3>

<p>The FE Object LFB is a logical entity in each FE and contains
          attributes relative to the FE itself, and not to the operation of
          the ForCES protocol.
</p>
<p>The formal definition of the FE Object LFB can be found in <a class='info' href='#FE-MODEL'>[FE&#8209;MODEL]<span> (</span><span class='info'>Yang, L., Halpern, J., Gopal, R., DeKok, A., Haraszti, Z., and S. Blake, &ldquo;ForCES Forwarding Element Model,&rdquo; Feb.&nbsp;2005.</span><span>)</span></a>. The model captures the high level properties
          of the FE that the CE needs to know to begin working with the FE.
          The class ID for this LFB Class is also assigned in <a class='info' href='#FE-MODEL'>[FE&#8209;MODEL]<span> (</span><span class='info'>Yang, L., Halpern, J., Gopal, R., DeKok, A., Haraszti, Z., and S. Blake, &ldquo;ForCES Forwarding Element Model,&rdquo; Feb.&nbsp;2005.</span><span>)</span></a>. The singular instance of this class will
          always exist, and will always have instance ID 0x1 within its class.
          It is common, although not mandatory, for a CE to fetch much of the
          component and capability information from this LFB instance when the
          CE begins controlling the operation of the FE.
</p>
<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
Semantics of Message Direction</h3>

<p>Recall: The PL provides a master(CE)-Slave(FE)
        relationship. The LFBs reside at the FE and are controlled by CE.
</p>
<p>When messages go from the CE, the LFB Selector (Class and instance)
        refers to the destination LFB selection which resides in the FE.
</p>
<p>When messages go from the FE to the CE, the LFB Selector (Class and
        instance) refers to the source LFB selection which resides in the
        FE.
</p>
<a name="anchor38"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5"></a><h3>7.5.&nbsp;
Association Messages</h3>

<p>The ForCES Association messages are used to establish and teardown
        associations between FEs and CEs.
</p>
<a name="Asso_Setup"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5.1"></a><h3>7.5.1.&nbsp;
Association Setup Message</h3>

<p>This message is sent by the FE to the CE to setup a ForCES
          association between them. 

          <br />
<br />

</p>
<blockquote class="text"><dl>
<dt>Message transfer direction: </dt>
<dd> FE to CE
</dd>
<dt>Message header: </dt>
<dd> The Message Type in the
            header is set MessageType= 'AssociationSetup'. The ACK flag in the
            header MUST be ignored, and the association setup message always
            expects to get a response from the message receiver (CE), whether
            the setup is successful or not. The correlator field in the header
	    is set, so that FE can correlate the response coming back from 
	    the CE correctly. 
	    The FE may set the source ID to 0 in the header to request that 
            the CE should assign an FE ID for the FE
            in the setup response message.
</dd>
<dt>Message body: </dt>
<dd> The association setup
	    message body optionally consists of zero, one or two LFBselect 
	    TLVs, as described in <a class='info' href='#LFBselectTLV'>Section&nbsp;7.1.5<span> (</span><span class='info'>LFBselect-TLV</span><span>)</span></a>. The 
	    Association Setup
            message only operates on the FE Object and FE Protocol LFBs,
            therefore, the LFB class ID in the LFBselect TLV only points to
            these two kinds of LFBs. 
</dd>
<dt></dt>
<dd>The OPER-TLV in the LFBselect TLV is defined as a
            'REPORT' operation. More than one component may be announced in
            this message using REPORT operation to let the FE declare its
            configuration parameters in an unsolicited manner. These may
	    contain components suggesting values such as the FE HB Interval,
	    or the FEID.
            The OPER-TLV used is defined below.
</dd>
<dt>OPER-TLV for Association Setup: </dt>
<dd>
              
            
</dd><br /><hr class="insert" />
<a name="Oper_TLV"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |    Type = REPORT              |               Length          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                    PATH-DATA-TLV for REPORT                   |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;22: OPER-TLV&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<dt>Type:</dt>
<dd> Only one operation type is defined
            for the association setup message: 
<blockquote class="text"><dl>
<dt></dt>
<dd>Type = "REPORT" - this type of operation is for FE to
                report something to CE.
</dd>
</dl></blockquote>
</dd>
<dt>PATH-DATA-TLV for REPORT: </dt>
<dd> This is
            generically a PATH-DATA-TLV format that has been defined in
            section (<a class='info' href='#Proto_Msg'>Section&nbsp;7<span> (</span><span class='info'>Protocol Construction</span><span>)</span></a>) in the
            PATH-DATA BNF definition. The PATH-DATA-TLV for REPORT operation
            MAY contain FULLDATA-TLV(s) but SHALL NOT contain any RESULT-TLV
            in the data format. The RESULT-TLV is defined in <a class='info' href='#RTLV'>Section&nbsp;7.1.7<span> (</span><span class='info'>RESULT TLV</span><span>)</span></a> and the FULLDATA-TLV is defined in <a class='info' href='#DTLV'>Section&nbsp;7.1.8<span> (</span><span class='info'>DATA TLV</span><span>)</span></a>.
</dd>
</dl></blockquote>
<p>To better illustrate the above PDU format, a tree structure for
          the format is shown below:
</p><br /><hr class="insert" />
<a name="Msg_Assoc"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
main hdr (type =  Association Setup)
     |
     |
     +--- T = LFBselect
     |        |
     |        +-- LFBCLASSID = FE object
     |        |
     |        |
     |        +-- LFBInstance = 0x1
     |
     +--- T = LFBselect
              |
              +-- LFBCLASSID = FE Protocol object
                    |
                    |
                    +-- LFBInstance = 0x1
                          |
                          +---OPER-TLV = REPORT
                              |
                              +-- Path-data to one or more components
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;23: PDU Format For Association Setup Message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="Assoc_Setup_Resp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5.2"></a><h3>7.5.2.&nbsp;
Association Setup Response Message</h3>

<p>This message is sent by the CE to the FE in response to the Setup
          message. It indicates to the FE whether the setup is successful or
          not, i.e., whether an association is established.

          <br />
<br />

</p>
<blockquote class="text"><dl>
<dt>Message transfer direction: </dt>
<dd> CE to FE
</dd>
<dt>Message Header: </dt>
<dd> The Message Type in the
            header is set MessageType= 'AssociationSetupResponse'. The ACK
            flag in the header MUST be ignored, and the setup response message
            never expects to get any more responses from the message receiver
	    (FE). 
	    The destination ID in the header will be set to the source ID 
	    in the corresponding association setup message, unless that 
	    source ID was 0.  If the corresponding source ID was 0, then 
	    the CE will assign an FE ID value and use that value for the 
	    destination ID.
	    
</dd><br /><hr class="insert" />
<a name="ASR"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |        Type = ASRresult       |               Length          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                  Association Setup Result                     |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;24: ASResult OPER-TLV&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<dt>Type (16 bits): </dt>
<dd> The type of the TLV is
            "ASResult".
</dd>
<dt>Length (16 bits): </dt>
<dd> Length of the TLV
            including the T and L fields, in octets.
</dd>
<dt>Association Setup Result (32 bits): </dt>
<dd> This
            indicates whether the setup msg was successful or whether the FE
            request was rejected by the CE. the defined values are: 
<blockquote class="text"><dl>
<dt></dt>
<dd>0 = success
</dd>
<dt></dt>
<dd>1 = FE ID invalid
</dd>
<dt></dt>
<dd>2 = permission denied
</dd>
</dl></blockquote>
</dd>
</dl></blockquote>
<p>To better illustrate the above PDU format, a tree structure for
          the format is shown below:
</p><br /><hr class="insert" />
<a name="AssocSetupResp_tree"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
main hdr (type =  Association Setup Response)
 |
 |
 +--- T = ASResult-TLV
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;25: PDU Format for Association Setup Repsonse Message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="Assoc_Tear_Resp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5.3"></a><h3>7.5.3.&nbsp;
Association Teardown Message</h3>

<p>This message can be sent by the FE or CE to any ForCES element to
          end its ForCES association with that element.

          <br />
<br />

</p>
<blockquote class="text"><dl>
<dt>Message transfer direction: </dt>
<dd> CE to FE, or
            FE to CE (or CE to CE)
</dd>
<dt>Message Header: </dt>
<dd> The Message Type in the
            header is set MessageType= "AssociationTeardown". The ACK flag
            MUST be ignored. The correlator field in the header MUST be set to
            zero and MUST be ignored by the receiver.
</dd><br /><hr class="insert" />
<a name="ASTreason_TLV"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |        Type = ASTreason       |               Length          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                      Teardown Reason                          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;26: ASTreason-TLV&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<dt>Type (16 bits): </dt>
<dd> The type of the TLV is
            "ASTreason".
</dd>
<dt>Length (16 bits): </dt>
<dd> Length of the TLV
            including the T and L fields, in octets.
</dd>
<dt>Teardown Reason (32 bits): </dt>
<dd> This
            indicates the reason why the association is being terminated.
            Several reason codes are defined as follows. 
<blockquote class="text"><dl>
<dt></dt>
<dd>0 - normal teardown by administrator
</dd>
<dt></dt>
<dd>1 - error - loss of heartbeats
</dd>
<dt></dt>
<dd>2 - error - out of bandwidth
</dd>
<dt></dt>
<dd>3 - error - out of memory
</dd>
<dt></dt>
<dd>4 - error - application crash
</dd>
<dt></dt>
<dd>255 - error - other or unspecified
</dd>
</dl></blockquote>
</dd>
</dl></blockquote>
<p>To better illustrate the above PDU format, a tree structure for
          the format is shown below:
</p><br /><hr class="insert" />
<a name="AssocTeardown_tree"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
main hdr (type =  Association Teardown)
 |
 |
 +--- T = ASTreason-TLV
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;27: PDU Format for Association Teardown Message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor40"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.6"></a><h3>7.6.&nbsp;
Configuration Messages</h3>

<p>The ForCES Configuration messages are used by CE to configure the
        FEs in a ForCES NE and report the results back to the CE.
</p>
<a name="CfgMsg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.6.1"></a><h3>7.6.1.&nbsp;
Config Message</h3>

<p>This message is sent by the CE to the FE to configure LFB
          components in the FE. This message is also used by the CE to
          subscribe/unsubscribe to LFB events.
</p>
<p>As usual, a config message is composed of a common header
          followed by a message body that consists of one or more TLV data
          format. Detailed description of the message is as below.

          <br />
<br />

</p>
<blockquote class="text"><dl>
<dt>Message transfer direction: </dt>
<dd> CE to FE
</dd>
<dt>Message Header: </dt>
<dd> The Message Type in the
            header is set MessageType= 'Config'. The ACK flag in the header
            can be set to any value defined in <a class='info' href='#Common_Header'>Section&nbsp;6.1<span> (</span><span class='info'>Common Header</span><span>)</span></a>, to indicate whether or not a response
	    from FE is expected by the message.
	    
</dd>
<dt>OPER-TLV for Config: </dt>
<dd>
              
            
</dd><br /><hr class="insert" />
<a name="Op_TLV-Config"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |          Type                 |               Length          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                        PATH-DATA-TLV                          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;28: OPER-TLV for Config&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<dt>Type:</dt>
<dd> The operation type for config
            message. two types of operations for the config message are
            defined: 
<blockquote class="text"><dl>
<dt></dt>
<dd>Type = "SET" - this operation is to set LFB
                components
</dd>
<dt></dt>
<dd>Type = "SET-PROP" - this operation is to set LFB
                component properties
</dd>
<dt></dt>
<dd>Type = "DEL" - this operation to delete some LFB
                components
</dd>
<dt></dt>
<dd>Type = "COMMIT" - this operation is sent to the 
		FE to commit in a 2pc transaction. A COMMIT TLV is
		an empty TLV i.e it has no "V"alue. In other words,
		There is a Length of 4 (which is for the header only).
		
</dd>
<dt></dt>
<dd>Type = "TRCOMP" - this operation is sent to the 
		FE to mark the success from an NE perspective of
		a 2pc transaction. A TRCOMP TLV is
		an empty TLV i.e it has no "V"alue. In other words,
		There is a Length of 4 (which is for the header only).
		
</dd>
</dl></blockquote>
</dd>
<dt>PATH-DATA-TLV:</dt>
<dd> This is generically a
	    PATH-DATA-TLV format that has been defined in section 
	    (<a class='info' href='#Proto_Msg'>Section&nbsp;7<span> (</span><span class='info'>Protocol Construction</span><span>)</span></a>) in the PATH-DATA-TLV BNF definition.
	    The restriction on the use of PATH-DATA-TLV for SET/SET-PROP
	    operation is that
	    it MUST contain either a FULLDATA-TLV or SPARSEDATA-TLV(s), but 
	    MUST NOT contain any RESULT-TLV. The restriction on the use of
            PATH-DATA-TLV for DEL operation is it MAY contain FULLDATA-TLV or
            SPARSEDATA-TLV(s), but MUST NOT contain any RESULT-TLV. The
	    RESULT-TLV is defined in <a class='info' href='#RTLV'>Section&nbsp;7.1.7<span> (</span><span class='info'>RESULT TLV</span><span>)</span></a> and FULLDATA-TLV
	    and SPARSEDATA-TLVs is defined in <a class='info' href='#DTLV'>Section&nbsp;7.1.8<span> (</span><span class='info'>DATA TLV</span><span>)</span></a>.
</dd>
<blockquote class="text"><dl>
<dt>*Note:</dt>
<dd>For Event subscription, the events will be
              defined by the individual LFBs.
</dd>
</dl></blockquote>
</dl></blockquote>
<p>To better illustrate the above PDU format, a tree structure for
          the format is shown below:
</p><br /><hr class="insert" />
<a name="PDU_format"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
main hdr (type = Config)
 |
 |
 +--- T = LFBselect
 .        |
 .        +-- LFBCLASSID = target LFB class
 .        |
          |
          +-- LFBInstance = target LFB instance
          |
          |
          +-- T = operation { SET }
          |   |
          |   +--  // one or more path targets
          |        // associated with FULLDATA-TLV or SPARSEDATA-TLV(s)
          |
          +-- T = operation { DEL }
          |   |
          |   +--  // one or more path targets
          |
          +-- T = operation { COMMIT } //A COMMIT TLV is an empty TLV
                   .
                   .
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;29: PDU Format for Configuration Message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="Config_Response"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.6.2"></a><h3>7.6.2.&nbsp;
Config Response Message</h3>

<p>This message is sent by the FE to the CE in response to the
          Config message. It indicates whether the Config was successful or
          not on the FE and also gives a detailed response regarding the
          configuration result of each component.

          <br />
<br />

</p>
<blockquote class="text"><dl>
<dt>Message transfer direction:  </dt>
<dd> FE to
            CE
</dd>
<dt>Message Header:  </dt>
<dd> The Message Type in the
            header is set MessageType= 'Config Response'. The ACK flag in the
            header is always ignored, and the Config Response message never
            expects to get any further response from the message receiver
	    (CE).
</dd>
<dt>OPER-TLV for Config Response: </dt>
<dd>
              
            
</dd><br /><hr class="insert" />
<a name="Op_TLV_Config_Resp"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |          Type                 |               Length          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                        PATH-DATA-TLV                          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;30: OPER-TLV for Config Response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<dt>Type:</dt>
<dd> The operation type for Config
            Response message. Two types of operations for the Config Response
            message are defined: 
<blockquote class="text"><dl>
<dt></dt>
<dd>Type = "SET-RESPONSE" - this operation is for the
                response of SET operation of LFB components
</dd>
<dt></dt>
<dd>Type = "SET-PROP-RESPONSE" - this operation is 
		for the response of SET-PROP operation of LFB 
		component properties
</dd>
<dt></dt>
<dd>Type = "DEL-RESPONSE" - this operation is for the
                response of the DELETE operation of LFB components
</dd>
<dt></dt>
<dd>Type = "COMMIT-RESPONSE" - this operation is sent to the 
		CE to confirm a commit success in a 2pc transaction. 
		A COMMIT-RESPONSE TLV MUST contain a RESULT-TLV indicating
		success or failure.
		
</dd>
</dl></blockquote>
</dd>
<dt>PATH-DATA-TLV:</dt>
<dd> This is generically a
	    PATH-DATA-TLV format that has been defined in section 
	    (<a class='info' href='#Proto_Msg'>Section&nbsp;7<span> (</span><span class='info'>Protocol Construction</span><span>)</span></a>) in the PATH-DATA-TLV BNF definition.
            The restriction on the use of PATH-DATA-TLV for SET-RESPONSE
	    operation is that it MUST contain RESULT-TLV(s). 
	    The restriction on the
            use of PATH-DATA-TLV for DEL-RESPONSE operation is it also MUST
            contain RESULT-TLV(s). The RESULT-TLV is defined in <a class='info' href='#RTLV'>Section&nbsp;7.1.7<span> (</span><span class='info'>RESULT TLV</span><span>)</span></a>.
</dd>
</dl></blockquote>
<p>To better illustrate the above PDU format, a tree structure for
          the format is shown below:
</p><br /><hr class="insert" />
<a name="ConfigResponse_tree"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 main hdr (type = ConfigResponse)
  |
  |
  +--- T = LFBselect
  .        |
  .        +-- LFBCLASSID = target LFB class
  .        |
           |
           +-- LFBInstance = target LFB instance
           |
           |
           +-- T = operation { SET-RESPONSE }
           |   |
           |   +--  // one or more path targets
           |        // associated with FULL or SPARSEDATA-TLV(s)
           |
           +-- T = operation { DEL-RESPONSE }
           |   |
           |   +--  // one or more path targets
           |
           +-- T = operation { COMMIT-RESPONSE }
           |           |
           |           +--  RESULT-TLV
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;31: PDU Format for Configuration Response message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="QueryMsg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.7"></a><h3>7.7.&nbsp;
Query Messages</h3>

<p>The ForCES query messages are used by the CE to query LFBs in the
        FE for information like LFB components, capabilities, statistics,
        etc. Query Messages include the Query Message and the Query Response
        Message.
</p>
<a name="Query"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.7.1"></a><h3>7.7.1.&nbsp;
Query Message</h3>

<p>A Query message is composed of a common header and a message body
          that consists of one or more TLV data format. Detailed description
          of the message is as below.
            <br />
<br />

</p>
<blockquote class="text"><dl>
<dt>Message transfer direction:</dt>
<dd> from CE to
            FE
</dd>
<dt>Message Header:</dt>
<dd> The Message Type in the
            header is set to MessageType= 'Query'. The ACK flag in the header
            is always ignored, and a full response for a query message is
            always expected. The Correlator field in the header is set, so
            that the CE can locate the response back from FE correctly.
            <br />
<br />

</dd>
<dt>OPER-TLV for Query: </dt>
<dd>
              
            
</dd><br /><hr class="insert" />
<a name="tlv_Query"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |    Type = GET/GET-PROP        |               Length          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                    PATH-DATA-TLV for GET/GET-PROP             |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;32: TLV for Query&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<dt>Type:</dt>
<dd> The operation type for query. Two
            operation types are defined: 
<blockquote class="text"><dl>
<dt></dt>
<dd>Type = "GET" - this operation is to request to get LFB
                components.
</dd>
<dt></dt>
<dd>Type = "GET-PROP" - this operation is to 
		request to get LFB components.
</dd>
</dl></blockquote>
</dd>
<dt>PATH-DATA-TLV for GET/GET-PROP: </dt>
<dd> 
	      This is
            generically a PATH-DATA-TLV format that has been defined in
            section (<a class='info' href='#Proto_Msg'>Section&nbsp;7<span> (</span><span class='info'>Protocol Construction</span><span>)</span></a>) in the
            PATH-DATA-TLV BNF definition. The restriction on the use of
	    PATH-DATA-TLV for GET/GET-PROP operation is it MUST 
	    NOT contain any
	    SPARSEDATA-TLV or FULLDATA-TLV and RESULT-TLV in the data
	    format.
</dd>
</dl></blockquote>
<p>To better illustrate the above PDU format, a tree structure for
          the format is shown below:
</p><br /><hr class="insert" />
<a name="query_tree"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
main hdr (type = Query)
 |
 |
 +--- T = LFBselect
 .        |
 .        +-- LFBCLASSID = target LFB class
 .        |
          |
          +-- LFBInstance = target LFB instance
          |
          |
          +-- T = operation { GET }
          |   |
          |   +--  // one or more path targets
          |
          +-- T = operation { GET }
          .   |
          .   +--  // one or more path targets
          .
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;33: PDU Format for Query Message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="QueryResponse"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.7.2"></a><h3>7.7.2.&nbsp;
Query Response Message</h3>

<p>When receiving a Query message, the receiver should process the
          message and come up with a query result. The receiver sends the
          query result back to the message sender by use of the Query Response
          Message. The query result can be the information being queried if
          the query operation is successful, or can also be error codes if the
          query operation fails, indicating the reasons for the failure.
</p>
<p>A Query Response message is also composed of a common header and
          a message body consisting of one or more TLVs describing the query
          result. Detailed description of the message is as below.

          <br />
<br />

</p>
<blockquote class="text"><dl>
<dt>Message transfer direction: </dt>
<dd> from FE to
            CE
</dd>
<dt>Message Header:  </dt>
<dd> The Message Type in the
            header is set to MessageType= 'QueryResponse'. The ACK flag in the
            header is ignored. As a response itself, the message does not
	    expect a further response.
</dd>
<dt>OPER-TLV for Query Response: </dt>
<dd>
              
            
</dd><br /><hr class="insert" />
<a name="msg_Query_Response"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |Type = GET-RESPONSE/GET-PROP-RESPONSE|    Length               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |        PATH-DATA-TLV for GET-RESPONSE/GET-PROP-RESPONSE       |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;34: TLV for Query Response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<dt>Type:</dt>
<dd> The operation type for query
            response. One operation type is defined: 
<blockquote class="text"><dl>
<dt></dt>
<dd>Type = "GET-RESPONSE" - this operation is to response to
                get operation of LFB components.
</dd>
<dt></dt>
<dd>Type = "GET-PROP-RESPONSE" - this 
		operation is to response to GET-PROP operation 
		of LFB components.
</dd>
</dl></blockquote>
</dd>
<dt>PATH-DATA-TLV for GET-RESPONSE/GET-PROP-RESPONSE: </dt>
<dd>
               This is
            generically a PATH-DATA-TLV format that has been defined in
            section (<a class='info' href='#Proto_Msg'>Section&nbsp;7<span> (</span><span class='info'>Protocol Construction</span><span>)</span></a>) in the
            PATH-DATA-TLV BNF definition. The PATH-DATA-TLV for GET-RESPONSE
            operation MAY contain SPARSEDATA-TLV, FULLDATA-TLV and/or
            RESULT-TLV(s) in the data encoding. The RESULT-TLV is defined in
	    <a class='info' href='#RTLV'>Section&nbsp;7.1.7<span> (</span><span class='info'>RESULT TLV</span><span>)</span></a> and the SPARSEDATA-TLVs and FULLDATA-TLVs 
	    are defined in <a class='info' href='#DTLV'>Section&nbsp;7.1.8<span> (</span><span class='info'>DATA TLV</span><span>)</span></a>.
</dd>
</dl></blockquote>
<p>To better illustrate the above PDU format, a tree structure for
          the format is shown below:
</p><br /><hr class="insert" />
<a name="QueryResp_tree"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
main hdr (type = QueryResponse)
  |
  |
  +--- T = LFBselect
  .        |
  .        +-- LFBCLASSID = target LFB class
  .        |
           |
           +-- LFBInstance = target LFB instance
           |
           |
           +-- T = operation { GET-RESPONSE }
           |   |
           |   +--  // one or more path targets
           |
           +-- T = operation { GET-PROP-RESPONSE }
           .   |
           .   +--  // one or more path targets
           .
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;35: PDU Format for Query Response Message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="EventMsg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.8"></a><h3>7.8.&nbsp;
Event Notification Message</h3>

<p>Event Notification Message is used by FE to asynchronously notify
        CE of events that happen in the FE.
</p>
<p>All events that can be generated in an FE are subscribable by the CE. 
	The CE can subscribe to an event via a Config message with
	SET-PROP operation, where the
	included path specifies the event, as defined by the LFB Library 
	and described by the FE Model.


</p>
<p>As usual, an Event Notification Message is composed of a common
        header and a message body that consists of one or more TLV data
        format. Detailed description of the message is as below.
</p>
<blockquote class="text"><dl>
<dt>Message Transfer Direction:  </dt>
<dd> FE to CE
</dd>
<dt>Message Header:  </dt>
<dd> The Message Type in the
          message header is set to <br />
 MessageType =
          'EventNotification'. The ACK flag in the header MUST be ignored by
          the CE, and the event notification message does not expect any
	  response from the receiver.
</dd>
<dt>OPER-TLV for Event Notification: </dt>
<dd>
            
          
</dd><br /><hr class="insert" />
<a name="TLV_Event_Notif"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Type = REPORT              |               Length          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    PATH-DATA-TLV for REPORT                   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;36: TLV for Event Notification&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<dt>Type:</dt>
<dd> Only one operation type is defined
          for the event notification message: 
<blockquote class="text"><dl>
<dt></dt>
<dd>Type = "REPORT" - this type of operation is for FE to
              report something to CE.
</dd>
</dl></blockquote>
</dd>
<dt>PATH-DATA-TLV for REPORT: </dt>
<dd> This is
          generically a PATH-DATA-TLV format that has been defined in
          section (<a class='info' href='#Proto_Msg'>Section&nbsp;7<span> (</span><span class='info'>Protocol Construction</span><span>)</span></a>) in the PATH-DATA-TLV
          BNF definition. The PATH-DATA-TLV for REPORT operation MAY contain
	  FULLDATA-TLV or SPARSEDATA-TLV(s)
	  but MUST NOT contain any RESULT-TLV in the data format.
</dd>
</dl></blockquote>
<p>To better illustrate the above PDU format, a tree structure for the
        format is shown below:
</p><br /><hr class="insert" />
<a name="event_tree"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
main hdr (type = Event Notification)
  |
  |
  +--- T = LFBselect
             |
             +-- LFBCLASSID = target LFB class
             |
             |
             +-- LFBInstance = target LFB instance
             |
             |
             +-- T = operation { REPORT }
             |   |
             |   +--  // one or more path targets
             |        // associated with FULL/SPARSE DATA TLV(s)
             +-- T = operation { REPORT }
             .   |
             .   +--  // one or more path targets
             .        // associated with FULL/SPARSE DATA TLV(s)
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;37: PDU Format for Event Notification Message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="RedirectMsg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.9"></a><h3>7.9.&nbsp;
Packet Redirect Message</h3>

<p>A packet Redirect message is used to transfer data packets between CE
	and FE. Usually these data packets are control packets but they
	may be just data-path packets which need further (exception or
	high-touch) processing. It is also feasible that this message 
	carries no data packets and rather just metadata.
        
</p>
<p>The Packet Redirect message data format is formatted as follows:
</p>
<blockquote class="text"><dl>
<dt>Message Direction:  </dt>
<dd> CE to FE or FE to
          CE
</dd>
<dt>Message Header:  </dt>
<dd> The Message Type in the
	  header is set to MessageType= 'PacketRedirect'.
	  
</dd>
<dt>Message Body: </dt>
<dd> This consists of one
	  or more TLVs that contain or describe  the
	  packet being redirected. The TLV is
          specifically a Redirect TLV (with the TLV Type="Redirect"). Detailed
          data format of a Redirect TLV for packet redirect message is as
          below:
</dd><br /><hr class="insert" />
<a name="tlv_Redirect_Data"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        Type = Redirect        |               Length          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Meta Data TLV                          |
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Redirect Data TLV                      |
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;38: Redirect_Data TLV&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<dt>Meta Data TLV: </dt>
<dd> This is a TLV that
          specifies meta-data associated with followed redirected data. The
          TLV is as follows:
</dd><br /><hr class="insert" />
<a name="Meta_Data"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Type = METADATA-TLV        |               Length          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Meta Data ILV                          |
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                           ...                                 ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Meta Data ILV                          |
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;39: METADATA-TLV&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<dt>Meta Data ILV: </dt>
<dd> This is an
          Identifier-Length-Value format that is used to describe one meta
          data. The ILV has the format as: <br /><hr class="insert" />
<a name="Meta_Data_ILV"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Meta Data ID                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Length                                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Meta Data Value                        |
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;40: Meta Data ILV&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
 <br />
 Where, Meta Data ID is an
          identifier for the meta data, which is statically assigned by the
	  LFB definition. 
  
</dd>
<dt>Redirect Data TLV</dt>
<dd> This is a TLV describing
          one packet of data to be directed via the redirect operation. The
          TLV format is as follows: <br /><hr class="insert" />
<a name="Refirect_Data_TLV"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Type = REDIRECTDATA-TLV    |               Length          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Redirected Data                        |
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;41: Redirect Data TLV&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</dd>
<dt>Redirected Data: </dt>
<dd> This field contains
	    the packet that is to be redirected in network byte order. 
	    The packet should be 32-bits aligned as is the data for all TLVs.
	    The metadata infers what kind of packet is carried in value
	    field and therefore allows for easy decoding of data
	    encapsulated 
</dd>
</dl></blockquote>
<p>To better illustrate the above PDU format, a tree structure for
          the format is shown below:
</p><br /><hr class="insert" />
<a name="redirect_tree"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
main hdr (type = PacketRedirect)
        |
        |
        +--- T = Redirect
        .        |
        .        +-- T = METADATA-TLV
                 |          |
                 |          +--  Meta Data ILV
                 |          |
                 |          +--  Meta Data ILV
                 |          .
                 |          .
                 |
                 +-- T = REDIRECTDATA-TLV
                     |
                     +--  // Redirected Data


</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;42: PDU Format for Packet Redirect Message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="HBMsg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.10"></a><h3>7.10.&nbsp;
Heartbeat Message</h3>

<p>The Heartbeat (HB) Message is used for one ForCES element (FE or
        CE) to asynchronously notify one or more other ForCES elements in the
	same ForCES NE on its liveness.
	<a class='info' href='#HB_appr'>Section&nbsp;4.3.3<span> (</span><span class='info'>Heartbeat Mechanism</span><span>)</span></a> describes the traffic-sensitive
	approach used.
        
</p>
<p>A Heartbeat Message is sent by a ForCES element periodically. The
        parameterization and policy definition for heartbeats for an FE is
	managed as components of the FE Protocol Object LFB, and 
	can be set by CE via a Config message. The Heartbeat message 
	is a little different from
        other protocol messages in that it is only composed of a common
        header, with the message body left empty. A detailed description of the
        message is as below.
</p>
<blockquote class="text"><dl>
<dt>Message Transfer Direction: </dt>
<dd> FE to CE or
          CE to FE
</dd>
<dt>Message Header: </dt>
<dd> The Message Type in the
          message header is set to MessageType = 'Heartbeat'. <a class='info' href='#HB_appr'>Section&nbsp;4.3.3<span> (</span><span class='info'>Heartbeat Mechanism</span><span>)</span></a> describes the HB mechanisms used. The ACK flag
          in the header MUST be set to either 'NoACK' or 'AlwaysACK' when the
          HB is sent.
</dd>
<ul class="text">
<li>When set to 'NoACK', the HB is not soliciting for a
            response.
</li>
<li>When set to 'AlwaysACK', the HB Message sender is always
            expecting a response from its receiver. According the HB policies
            defined in <a class='info' href='#FPL_sum'>Section&nbsp;7.3.1<span> (</span><span class='info'>FE Protocol LFB</span><span>)</span></a>, only the CE can send such an
            HB message to query FE liveness. For simplicity and because of the
            minimal nature of the HB message, the response to a HB message is
            another HB message, i.e., no specific HB response message is
            defined. Whenever an FE receives a HB message marked with
            'AlwaysACK' from the CE, the FE MUST send a HB message back
            immediately. The HB message sent by the FE in response to the
            'AlwasyACK' MUST modify the source and destination IDs so that the
            ID of the FE is the source ID and the CE ID of the sender is the
            destination ID, and MUST change the ACK information to 'NoACK'. A
            CE MUST NOT respond to an HB message with 'AlwasyACK' set.
</li>
<li> When set to anything else other than 'NoACK' or
	   'AlwaysACK', the HB Message is treated as if it was a 'NoACK'.
</li>
</ul>
<dt></dt>
<dd>The correlator field in the HB message header SHOULD be set
          accordingly when a response is expected so that a receiver can
          correlate the response correctly. The correlator field MAY be
          ignored if no response is expected.
</dd>
<dt>Message Body: </dt>
<dd> The message body is empty
          for the Heartbeat Message.
</dd>
</dl></blockquote>
<a name="HA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
High Availability Support</h3>

<p><br />
<br />

      The ForCES protocol provides mechanisms for CE redundancy and
      failover, in order to support High Availability as defined in <a class='info' href='#RFC3654'>[RFC3654]<span> (</span><span class='info'>Khosravi, H. and T. Anderson, &ldquo;Requirements for Separation of IP Control and Forwarding,&rdquo; November&nbsp;2003.</span><span>)</span></a>. FE redundancy and FE to FE interaction is currently
      out of scope of this document. There can be multiple redundant CEs and FEs
      in a ForCES NE. However, at any one time only one primary CE can control
      the FEs though there can be multiple secondary CEs. The FE and the CE PL
      are aware of the primary and secondary CEs. This information (primary,
      secondary CEs) is configured in the FE and in the CE PLs during
      pre-association by the FEM and the CEM respectively. Only the primary CE
      sends control messages to the FEs.
</p>
<a name="FEPOHA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Relation with the FE Protocol </h3>

<p>High Availability parameterization in an FE is 
	    driven by configuring the FE Protocol Object LFB (refer to 
	    <a class='info' href='#FPL_def'>Appendix&nbsp;B<span> (</span><span class='info'>ForCES Protocol LFB schema</span><span>)</span></a> and <a class='info' href='#FPL_sum'>Section&nbsp;7.3.1<span> (</span><span class='info'>FE Protocol LFB</span><span>)</span></a>). The
	    FE Heartbeat Interval, CE Heartbeat Dead Interval,
	    and CE Heartbeat policy help in detecting connectivity
	    problems between an FE and CE. The CE Failover policy defines
	    the reaction on a detected failure.
            
</p>
<p>
		    <a class='info' href='#FESM'>Figure&nbsp;43<span> (</span><span class='info'>FE State Machine considering HA</span><span>)</span></a>  extends the state
		    machine illustrated in <a class='info' href='#FE_SM'>Figure&nbsp;4<span> (</span><span class='info'>The FE Protocol Phases</span><span>)</span></a> 
		    to allow for new states that facilitate connection
		    recovery.


      <br /><hr class="insert" />
<a name="FESM"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

    (CE issues Teardown ||    +-----------------+
       Lost association) &amp;&amp;   | Pre-Association |
      CE failover policy = 0  | (Association    |
          +------------&gt;--&gt;--&gt;|   in            +&lt;----+
          |                   | progress)       |     |
          |     CE Issues     +--------+--------+     |
          |     Association        |                  | CFTI
          |       Setup            V                  | timer
          |     ___________________+                  | expires
          |     |                                     |
          |     V                                     ^
        +-+-----------+                          +-------+-----+
        |             |                          |  Not        |
        |             |  (CE issues Teardown ||  |  Associated |
        |             |    Lost association) &amp;&amp;  |             |
        | Associated  |  CE Failover Policy = 1  | (May        |
        |             |                          | Continue    |
        |             |----------&gt;-------&gt;------&gt;|  Forwarding)|
        |             |                          |             |
        +-------------+                          +-------------+
             ^                                         V
             |                                         |
             |            CE Issues                    |
             |            Association                  |
             |            Setup                        |
             +_________________________________________+

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;43: FE State Machine considering HA&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


      <a class='info' href='#FPP'>Section&nbsp;4.2<span> (</span><span class='info'>ForCES Protocol Phases</span><span>)</span></a> describes transitions between the
      Pre-association, associated and not associated
      states.
      
</p>
<p>When communication fails between the FE and CE (which can be caused
      by either the CE or link failure but not FE related), either the TML on the
      FE will trigger the FE PL regarding this failure or it will be detected
      using the HB messages between FEs and CEs. The communication failure,
      regardless of how it is detected, MUST be considered as a loss of
      association between the CE and corresponding FE.
      
</p>
<p>If the FE's FEPO CE Failover Policy is configured to mode 0 
      (the default), it will immediately transition to the pre-association
      phase. This means that if association is again established, 
      all FE
      state will need to be re-established.
      
</p>
<p>If the FE's FEPO CE Failover Policy is configured to mode 1, 
      it indicates that the FE is capable of HA 
      restart recovery.
      In such a case, the FE transitions to the not associated state and
      the CEFTI timer is started. The FE MAY continue to forward
      packets during this state. It MAY also recycle through any configured
      secondary CEs in a round-robin fashion. It first adds its
      primary CE to the tail of backup CEs and sets its primary CE to be
      the first secondary. It then attempts to associate with
      the CE designated as the new primary CE. 
      If it fails to re-associate with any CE and the
      CEFTI expires, the FE then transitions to the pre-association state.
      
</p>
<p>
      If the FE, while in the not associated state, manages to reconnect
      to a new primary CE before CEFTI expires it transitions to the
      Associated state. Once re-associated, the FE tries to recover any
      state that may have been lost during the not associated state.  
      How the FE achieves re-synchronizes it state is out of scope for
      this document.
      
<p>
	      <a class='info' href='#seq_HA_Report_Primary'>Figure&nbsp;44<span> (</span><span class='info'>CE Failover for Report Primary Mode</span><span>)</span></a> below 
	      illustrates the Forces message sequences that the FE
	      uses to recover the connection.

      <br /><hr class="insert" />
<a name="seq_HA_Report_Primary"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>


      FE                   CE Primary        CE Secondary
      |                       |                    |
      |  Asso Estb,Caps exchg |                    |
    1 |&lt;---------------------&gt;|                    |
      |                       |                    |
      |       All msgs        |                    |
    2 |&lt;---------------------&gt;|                    |
      |                       |                    |
      |                       |                    |
      |                   FAILURE                  |
      |                                            |
      |         Asso Estb,Caps exchange            |
    3 |&lt;------------------------------------------&gt;|
      |                                            |
      |              Event Report (pri CE down)    |
    4 |-------------------------------------------&gt;|
      |                                            |
      |                   All Msgs                 |
    5 |&lt;------------------------------------------&gt;|

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;44: CE Failover for Report Primary Mode&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>

      A CE-to-CE
      synchronization protocol would be needed to support fast failover as
      well as to address some of the corner cases, however this will not be
      defined by the ForCES protocol as it is out of scope for this
      specification.

<p>An explicit message (a Config message setting Primary CE component in
      ForCES Protocol object) from the primary CE, can also be used to change
      the Primary CE for an FE during normal protocol operation.
</p>
<p>Also note that the FEs in a ForCES NE could also use a multicast
      CE ID, i.e., they could be associated with a group of CEs (this 
      assumes the use of a CE-CE synchronization protocol, which is 
      out of scope for this specification). In this case, the loss of 
      association would mean that
      communication with the entire multicast group of CEs has been lost. The
      mechanisms described above will apply for this case as well during the
      loss of association. If, however, the secondary CE was also using the
      multicast CE ID that was lost, then the FE will need to form a new
      association using a different CE ID. If the capability exists, the FE MAY
      first attempt to form a new association with original primary CE using a
      different non multicast CE ID.
</p>
<a name="anchor41"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Responsibilities for HA</h3>

<p>TML Level:
</p>
<ol class="text">
<li>The TML controls logical connection availability and
          failover.
</li>
<li>The TML also controls peer HA management.
</li>
</ol>
<p>At this level, control of all lower layers, for example transport
        level (such as IP addresses, MAC addresses etc) and associated links
        going down are the role of the TML.
</p>
<p>PL Level: <br />
 All other functionality, including
        configuring the HA behavior during setup, the CE IDs used to
        identify primary and secondary CEs, protocol messages used to report CE
        failure (Event Report), Heartbeat messages used to detect association
        failure, messages to change the primary CE (Config), and other HA
        related operations described before, are the PL responsibility.
</p>
<p>To put the two together, if a path to a primary CE is down, the TML
        would take care of failing over to a backup path, if one is available.
        If the CE is totally unreachable then the PL would be informed and it
        would take the appropriate actions described before.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Security Considerations</h3>

<p>
      ForCES Framework document <a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a>, section 8 goes into extensive 
      detail on a variety of security threats, the possible effects of those 
      threats on the protocol and responses to those threats. This
      document does not repeat that discussion, the reader is referred
      to the  ForCES Framework document <a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a> for those details and
      how the ForCES architecture addresses them.
    
</p>
<p>
      ForCES PL uses security services provided by the ForCES
      TML.  The TML provides security services such as endpoint
      authentication service, message authentication service and
      confidentiality service.  Endpoint authentication service is invoked
      at the time of the pre-association connection establishment phase and
      message authentication is performed whenever the FE or CE receives a
      packet from its peer.
    
</p>
<p>The following are the general security mechanisms that need to be in
      place for ForCES PL.
</p>
<ul class="text">
<li>Security mechanisms are session controlled - that is, once the
        security is turned on depending upon the chosen security level (No
        Security, Authentication, Confidentiality), it will be in effect
        for the entire duration of the session.
</li>
<li>An operator should configure the same security policies for both
        primary and backup FEs and CEs (if available). This will ensure
        uniform operations and avoid unnecessary complexity in policy
        configuration.
</li>
</ul>
<a name="anchor42"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
No Security</h3>

<p>When "No security" is chosen for ForCES protocol communication,
        both endpoint authentication and message authentication service needs
        to be performed by ForCES PL. Both these mechanism are weak and
        do not involve cryptographic operation. An operator can choose "No
        Security" level when the ForCES protocol endpoints are within a single
        box, for example.
</p>
<p>In order to have interoperable and uniform implementation across
        various security levels, each CE and FE endpoint MUST implement this
	level. 
</p>
<p>What is described below (in <a class='info' href='#NS-Endpoint-auth'>Section&nbsp;9.1.1<span> (</span><span class='info'>Endpoint Authentication</span><span>)</span></a>
         and <a class='info' href='#NS-Msg-Auth'>Section&nbsp;9.1.2<span> (</span><span class='info'>Message Authentication</span><span>)</span></a>) are error checks
         and not security procedures. The reader is referred to section 
         <a class='info' href='#PL-TML-sec-svc'>Section&nbsp;9.2<span> (</span><span class='info'>ForCES PL and TML security service</span><span>)</span></a>.
         for security procedures.
	
</p>
<a name="NS-Endpoint-auth"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.1"></a><h3>9.1.1.&nbsp;
Endpoint Authentication</h3>

<p>Each CE and FE PL maintains a list of associations as
	  part its of configuration. This is done via the CEM and 
	  FEM interfaces. An FE MUST connect to only those CEs that 
	  are configured via the FEM; similarly, a CE should accept 
	  the connection and establish associations for the FEs which 
	  are configured via the CEM. The CE should
          validate the FE identifier before accepting the connections during
          the pre-association phase.
</p>
<a name="NS-Msg-Auth"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.2"></a><h3>9.1.2.&nbsp;
Message Authentication</h3>

<p>When a CE or FE initiates a message, the receiving
          endpoint MUST validate the initiator of the message by checking the
          common header CE or FE identifiers. This will ensure proper protocol
          functioning. This extra processing step is recommended even when 
          the underlying TML layer security services exist.
</p>
<a name="PL-TML-sec-svc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
ForCES PL and TML security service</h3>

<p>This section is applicable if an operator wishes to use the TML
        security services. A ForCES TML MUST support one or more security
        services such as endpoint authentication service, message
        authentication service, and confidentiality service, as part of TML
        security layer functions. It is the responsibility of the operator to
        select an appropriate security service and configure security policies
	accordingly. The details of such configuration are outside the 
	scope of the ForCES PL and are dependent on the type of 
	transport protocol and the nature of the connection.
</p>
<p>All these configurations should be done prior to starting the CE
        and FE.
</p>
<p>When certificates-based authentication is being used at the TML,
        the certificate can use a ForCES-specific naming structure as
        certificate names and, accordingly, the security policies can be
        configured at the CE and FE.
</p>
<p> The reader is asked to refer to specific TML documents for details 
        on the security requirements specific to that TML
	
</p>
<a name="anchor43"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.1"></a><h3>9.2.1.&nbsp;
Endpoint authentication service</h3>

<p>When TML security services are enabled, the ForCES TML 
	performs endpoint authentication. Security association is 
	established between
          CE and FE and is transparent to the ForCES PL.
</p>
<a name="anchor44"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.2"></a><h3>9.2.2.&nbsp;
Message authentication service</h3>

<p>This is a TML specific operation and is transparent to the
	ForCES PL. For details, refer to <a class='info' href='#TML_Req'>Section&nbsp;5<span> (</span><span class='info'>TML Requirements</span><span>)</span></a>.
</p>
<a name="anchor45"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.3"></a><h3>9.2.3.&nbsp;
Confidentiality service</h3>

<p>This is a TML specific operation and is transparent to the
	ForCES PL. For details, refer to <a class='info' href='#TML_Req'>Section&nbsp;5<span> (</span><span class='info'>TML Requirements</span><span>)</span></a>.
</p>
<a name="anchor46"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgements</h3>

<p>The authors of this draft would like to acknowledge and thank the
      ForCES Working Group and especially the following: Furquan
	Ansari, Alex Audu, Steven Blake, Shuchi Chawla, Alan DeKok, Ellen
	M. Deleganes, Xiaoyi Guo, Yunfei Guo, Evangelos Haleplidis, Joel
	M. Halpern (who should probably be listed among the authors), Zsolt
	Haraszti, Fenggen Jia, John C. Lin, Alistair Munro, Jeff Pickering,
	T. Sridhlar, Guangming Wang, Chaoping Wu, and Lily L. Yang, for their
	contributions. We would also like to thank David Putzolu, and Patrick
	Droz for their comments and suggestions on the protocol and for their
	infinite patience. We would also like to thank Sue Hares and Alia
	Atlas for extensive reviews of the
      document.
</p>
<p> Alia Atlas has done a wonderful job of shaping the draft to make
      it more readable by providing the IESG feedback.
</p>
<p>The editors have used the xml2rfc <a class='info' href='#RFC2629'>[RFC2629]<span> (</span><span class='info'>Rose, M., &ldquo;Writing I-Ds and RFCs using XML,&rdquo; June&nbsp;1999.</span><span>)</span></a>
      tools in creating this document and are very grateful for the existence
      and quality of these tools. The editor is also grateful to Elwyn Davies
      for his help in correcting the XML source of this document.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="FE-MODEL">[FE-MODEL]</a></td>
<td class="author-text">Yang, L., Halpern, J., Gopal, R., DeKok, A., Haraszti, Z., and S. Blake, &ldquo;ForCES Forwarding Element Model,&rdquo; Feb.&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5226">[RFC5226]</a></td>
<td class="author-text">Narten, T. and H. Alvestrand, &ldquo;<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>,&rdquo; BCP&nbsp;26, RFC&nbsp;5226, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5226.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.2.&nbsp;Informational References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="2PCREF">[2PCREF]</a></td>
<td class="author-text">Gray, J., &ldquo;Notes on database operating systems. In Operating Systems: An
          Advanced Course. Lecture Notes in Computer Science, Vol. 60, pp.
          394-481, Springer-Verlag,&rdquo; 1978.</td></tr>
<tr><td class="author-text" valign="top"><a name="ACID">[ACID]</a></td>
<td class="author-text">Haerder, T. and A. Reuter, &ldquo;Principles of Transaction-Orientated Database
          Recovery,&rdquo; 1983.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2629">[RFC2629]</a></td>
<td class="author-text"><a href="mailto:mrose@not.invisible.net">Rose, M.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2629">Writing I-Ds and RFCs using XML</a>,&rdquo; RFC&nbsp;2629, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2629.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2629.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2629.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3654">[RFC3654]</a></td>
<td class="author-text">Khosravi, H. and T. Anderson, &ldquo;<a href="http://tools.ietf.org/html/rfc3654">Requirements for Separation of IP Control and Forwarding</a>,&rdquo; RFC&nbsp;3654, November&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3654.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3746">[RFC3746]</a></td>
<td class="author-text">Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;<a href="http://tools.ietf.org/html/rfc3746">Forwarding and Control Element Separation (ForCES) Framework</a>,&rdquo; RFC&nbsp;3746, April&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3746.txt">TXT</a>).</td></tr>
</table>

<a name="anchor49"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
IANA Considerations</h3>

<p>Following the policies outlined in "Guidelines for Writing an IANA
      Considerations Section in RFCs" (RFC 5226 <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>),
      the following name spaces are defined in ForCES.
</p>
<ul class="text">
<li>Message Type Name Space <a class='info' href='#Proto_Msg'>Section&nbsp;7<span> (</span><span class='info'>Protocol Construction</span><span>)</span></a>
</li>
<li>Operation Type Name Space <a class='info' href='#OTLV'>Section&nbsp;7.1.6<span> (</span><span class='info'>OPER-TLV</span><span>)</span></a>
</li>
<li>Header Flags <a class='info' href='#Common_Header'>Section&nbsp;6.1<span> (</span><span class='info'>Common Header</span><span>)</span></a>
</li>
<li>TLV Type <a class='info' href='#Proto_Msg'>Section&nbsp;7<span> (</span><span class='info'>Protocol Construction</span><span>)</span></a>
</li>
<li>TLV Result Values <a class='info' href='#RTLV'>Section&nbsp;7.1.7<span> (</span><span class='info'>RESULT TLV</span><span>)</span></a>
</li>
<li>LFB Class ID <a class='info' href='#LFBselectTLV'>Section&nbsp;7.1.5<span> (</span><span class='info'>LFBselect-TLV</span><span>)</span></a>
</li>
<li>Result: Association Setup Response <a class='info' href='#Assoc_Setup_Resp'>Section&nbsp;7.5.2<span> (</span><span class='info'>Association Setup Response Message</span><span>)</span></a>
</li>
<li>Reason: Association Teardown Message <a class='info' href='#Assoc_Tear_Resp'>Section&nbsp;7.5.3<span> (</span><span class='info'>Association Teardown Message</span><span>)</span></a>
</li>
</ul>
<a name="MSGt_Def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Message Type Name Space</h3>

<p>The Message Type is an 8 bit value. The following is the guideline
        for defining the Message Type namespace
</p>
<blockquote class="text"><dl>
<dt>Message Types 0x00 - 0x0F</dt>
<dd> Message Types in
          this range are part of the base ForCES Protocol. Message Types in
          this range are allocated through an IETF consensus action. <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a> <br />
<br />
 Values assigned by this
          specification: <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    0x00               Reserved
    0x01               AssociationSetup
    0x02               AssociationTeardown
    0x03               Config
    0x04               Query
    0x05               EventNotification
    0x06               PacketRedirect
    0x07 - 0x0E        Reserved
    0x0F               Hearbeat
    0x11               AssociationSetupRepsonse
    0x12               Reserved
    0x13               ConfigRepsonse
    0x14               QueryResponse

</pre></div>
</dd>
<dt>Message Types 0x20 - 0x7F</dt>
<dd> Message Types in
          this range are Specification Required <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>
          Message Types using this range must be documented in an RFC or other
          permanent and readily available reference.
</dd>
<dt>Message Types 0x80 - 0xFF</dt>
<dd> Message Types in
          this range are reserved for vendor private extensions and are the
          responsibility of individual vendors. IANA management of this range
          of the Message Type Name Space is unnecessary.
</dd>
</dl></blockquote>
<a name="OPERt_Def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Operation Selection</h3>

<p>The Operation Selection (OPER-TLV) name space is 16 bits long. 
      The following is the guideline for managing the OPER-TLV Name Space.
</p>
<blockquote class="text"><dl>
<dt>OPER-TLV Type 0x0000-0x00FF</dt>
<dd> OPER-TLV
          Types in this range are allocated through an IETF consensus process.
          <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>. <br />
<br />
 Values assigned
          by this specification: <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
              0x0000           Reserved
              0x0001           SET
              0x0002           SET-PROP
              0x0003           SET-RESPONSE
              0x0004           SET-PROP-RESPONSE
              0x0005           DEL
              0x0006           DEL-RESPONSE
              0x0007           GET
              0x0008           GET-PROP
              0x0009           GET-RESPONSE
              0x000A           GET-PROP-RESPONSE
              0x000B           REPORT
              0x000C           COMMIT
              0x000D           COMMIT-RESPONSE
              0x000E           TRCOMP
</pre></div>
</dd>
<dt>OPER-TLV Type 0x0100-0x7FFF</dt>
<dd> OPER-TLV
          Types using this range must be documented in an RFC or other
          permanent and readily available reference. <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</dd>
<dt>OPER-TLV Type 0x8000-0xFFFF</dt>
<dd> OPER-TLV
          Types in this range are reserved for vendor private extensions and
          are the responsibility of individual vendors. IANA management of
          this range of the OPER-TLV Type Name Space is unnecessary.
</dd>
</dl></blockquote>
<a name="anchor50"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Header Flags</h3>

<blockquote class="text"><dl>
<dt></dt>
<dd>The Header flag field is 32 bits long. Header flags are part of
          the ForCES base protocol. Header flags are allocated through an IETF
          consensus action <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</dd>
</dl></blockquote>
<a name="anchor51"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.4"></a><h3>A.4.&nbsp;
TLV Type Name Space</h3>

<p>The TLV Type name space is 16 bits long. The following is the
        guideline for managing the TLV Type Name Space.
</p>
<blockquote class="text"><dl>
<dt>TLV Type 0x0000-0x00FF</dt>
<dd> TLV Types in this
          range are allocated through an IETF consensus process. <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>. <br />
<br />
 Values assigned by
          this specification: <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
              0x0000           Reserved
              0x0001           REDIRECT-TLV
              0x0010           ASResult-TLV
              0x0011           ASTreason-TLV
              0x1000           LFBselect-TLV
              0x0110           PATH-DATA-TLV
              0x0111           KEYINFO-TLV
              0x0112           FULLDATA-TLV
              0x0113           SPARSEDATA-TLV
              0x0114           RESULT-TLV
              0x0115           METADATA-TLV
              0x0116           REDIRECTDATA-TLV
</pre></div>
</dd>
<dt>TLV Type 0x0200-0x7FFF</dt>
<dd> TLV Types using this
          range must be documented in an RFC or other permanent and readily
          available reference <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</dd>
<dt>TLV Type 0x8000-0xFFFF</dt>
<dd> TLV Types in this
          range are reserved for vendor private extensions and are the
          responsibility of individual vendors. IANA management of this range
          of the TLV Type Name Space is unnecessary.
</dd>
</dl></blockquote>
<a name="anchor52"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.5"></a><h3>A.5.&nbsp;
Result-TLV Result Values</h3>

<p>The RESULT-TLV RTesult Value is an 8 bit value. </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
             0x00        E_SUCCESS
             0x01        E_INVALID_HEADER
             0x02        E_LENGTH_MISMATCH
             0x03        E_VERSION_MISMATCH
             0x04        E_INVALID_DESTINATION_PID
             0x05        E_LFB_UNKNOWN
             0x06        E_LFB_NOT_FOUND
             0x07        E_LFB_INSTANCE_ID_NOT_FOUND
             0x08        E_INVALID_PATH
             0x09        E_COMPONENT_DOES_NOT_EXIST
             0x0A        E_EXISTS
             0x0B        E_NOT_FOUND
             0x0C        E_READ_ONLY
             0x0D        E_INVALID_ARRAY_CREATION
             0x0E        E_VALUE_OUT_OF_RANGE
             0x0F        E_CONTENTS_TOO_LONG
             0x10        E_INVALID_PARAMETERS
             0x11        E_INVALID_MESSAGE_TYPE
             0x12        E_E_INVALID_FLAGS
             0x13        E_INVALID_TLV
             0x14        E_EVENT_ERROR
             0x15        E_NOT_SUPPORTED
             0x16        E_MEMORY_ERROR
             0x17        E_INTERNAL_ERROR
             0x18-0xFE   Reserved
             0xFF        E_UNSPECIFIED_ERROR
</pre></div><p>
 All values not assigned in this specification are
        designated as Assignment by Expert review.
</p>
<a name="anchor53"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.6"></a><h3>A.6.&nbsp;
Association Setup Response</h3>

<p>The Association Setup Response name space is 32 bits long. The
        following is the guideline for managing the Association Setup Response
        Name Space.
</p>
<blockquote class="text"><dl>
<dt>Association Setup Response 0x0000-0x00FF</dt>
<dd>
          Association Setup Responses in this range are allocated through an
          IETF consensus process <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>. <br />
<br />
 Values assigned by this specification: <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
       0x0000   Success
       0x0001   FE ID Invalid
       0x0002   Permission Denied
</pre></div>
</dd>
<dt>Association Setup Response 0x0100-0x0FFF</dt>
<dd>
          Association Setup Responses in this range are Specification Required
          <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a> Values using this range must be documented
          in an RFC or other permanent and readily available reference <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</dd>
<dt>Association Setup Response 0x1000-0xFFFFFFFFF</dt>
<dd>
          Association Setup Responses in this range are reserved for vendor
          private extensions and are the responsibility of individual vendors.
          IANA management of this range of the Association Setup Responses
          Name Space is unnecessary.
</dd>
</dl></blockquote>
<a name="anchor54"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.7"></a><h3>A.7.&nbsp;
Association Teardown Message</h3>

<p>The Association Teardown Message name space is 32 bits long. The
        following is the guideline for managing the Association Teardown
        Message Name Space.
</p>
<blockquote class="text"><dl>
<dt>Association Teardown Message 0x00000000-0x0000FFFF</dt>
<dd>
          Association Teardown Messages in this range are allocated through an
          IETF consensus process <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>. <br />
<br />
 Values assigned by this specification: <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        0x00000000        Normal - Teardown by Administrator
        0x00000001        Error  - loss of heartbeats
        0x00000002        Error  - loss of bandwidth
        0x00000003        Error  - Out of Memory
        0x00000004        Error  - Application Crash
        0x000000FF        Error  - Unspecified

</pre></div>
</dd>
<dt>Association Teardown Message 0x00010000-0x7FFFFFFF</dt>
<dd>
          Association Teardown Messages in this range are Specification
          Required <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a> Association Teardown Messages
	  using this range must be documented in an RFC or other
	  permanent and
          readily available references. <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</dd>
<dt>Association Teardown Message 0x80000000-0xFFFFFFFFF</dt>
<dd>
	  Association Teardown Messages in this range are reserved
	  for vendor private extensions and are the responsibility 
	  of individual vendors.
          IANA management of this range of the Association Teardown Message
          Name Space is unnecessary.
</dd>
</dl></blockquote>
<a name="FPL_def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
ForCES Protocol LFB schema</h3>

<p>The schema described below conforms to the LFB schema  described in ForCES Model draft<a class='info' href='#FE-MODEL'>.<span> (</span><span class='info'>Yang, L., Halpern, J., Gopal, R., DeKok, A., Haraszti, Z., and S. Blake, &ldquo;ForCES Forwarding Element Model,&rdquo; Feb.&nbsp;2005.</span><span>)</span></a> [FE&#8209;MODEL]
</p>
<p>
<a class='info' href='#FPL_sum'>Section&nbsp;7.3.1<span> (</span><span class='info'>FE Protocol LFB</span><span>)</span></a> describes the details of the different
components defined in this definition.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

&lt;LFBLibrary xmlns="urn:ietf:params:xml:ns:forces:lfbmodel:1.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    provides="FEPO"&gt;
&lt;!-- XXX  --&gt;
  &lt;dataTypeDefs&gt;
     &lt;dataTypeDef&gt;
        &lt;name&gt;CEHBPolicyValues&lt;/name&gt;
               &lt;synopsis&gt;
                   The possible values of CE heartbeat policy
               &lt;/synopsis&gt;
           &lt;atomic&gt;
           &lt;baseType&gt;uchar&lt;/baseType&gt;
           &lt;specialValues&gt;
              &lt;specialValue value="0"&gt;
                &lt;name&gt;CEHBPolicy0&lt;/name&gt;
                &lt;synopsis&gt;
                     The CE heartbeat policy 0
                &lt;/synopsis&gt;
                &lt;/specialValue&gt;
              &lt;specialValue value="1"&gt;
                 &lt;name&gt;CEHBPolicy1&lt;/name&gt;
                 &lt;synopsis&gt;
                      The CE heartbeat policy 1
                 &lt;/synopsis&gt;
              &lt;/specialValue&gt;
            &lt;/specialValues&gt;
            &lt;/atomic&gt;
      &lt;/dataTypeDef&gt;

      &lt;dataTypeDef&gt;
         &lt;name&gt;FEHBPolicyValues&lt;/name&gt;
              &lt;synopsis&gt;
                  The possible values of FE heartbeat policy
             &lt;/synopsis&gt;
           &lt;atomic&gt;
           &lt;baseType&gt;uchar&lt;/baseType&gt;
           &lt;specialValues&gt;
             &lt;specialValue value="0"&gt;
               &lt;name&gt;FEHBPolicy0&lt;/name&gt;
               &lt;synopsis&gt;
                    The FE heartbeat policy 0
               &lt;/synopsis&gt;
             &lt;/specialValue&gt;
             &lt;specialValue value="1"&gt;
                &lt;name&gt;FEHBPolicy1&lt;/name&gt;
                &lt;synopsis&gt;
                     The FE heartbeat policy 1
                &lt;/synopsis&gt;
               &lt;/specialValue&gt;
            &lt;/specialValues&gt;
            &lt;/atomic&gt;
      &lt;/dataTypeDef&gt;

      &lt;dataTypeDef&gt;
      &lt;name&gt;FERestartPolicyValues&lt;/name&gt;
            &lt;synopsis&gt;
                The possible values of FE restart policy
            &lt;/synopsis&gt;
           &lt;atomic&gt;
           &lt;baseType&gt;uchar&lt;/baseType&gt;
           &lt;specialValues&gt;
              &lt;specialValue value="0"&gt;
                &lt;name&gt;FERestartPolicy0&lt;/name&gt;
                &lt;synopsis&gt;
                     The FE restart policy 0
                &lt;/synopsis&gt;
                &lt;/specialValue&gt;
            &lt;/specialValues&gt;
            &lt;/atomic&gt;
      &lt;/dataTypeDef&gt;

      &lt;dataTypeDef&gt;
      &lt;name&gt;CEFailoverPolicyValues&lt;/name&gt;
            &lt;synopsis&gt;
                The possible values of CE failover policy
            &lt;/synopsis&gt;
           &lt;atomic&gt;
           &lt;baseType&gt;uchar&lt;/baseType&gt;
           &lt;specialValues&gt;
             &lt;specialValue value="0"&gt;
                &lt;name&gt;CEFailoverPolicy0&lt;/name&gt;
                &lt;synopsis&gt;
                     The CE failover policy 0
                &lt;/synopsis&gt;
              &lt;/specialValue&gt;
            &lt;specialValue value="1"&gt;
               &lt;name&gt;CEFailoverPolicy1&lt;/name&gt;
               &lt;synopsis&gt;
                    The CE failover policy 1
               &lt;/synopsis&gt;
             &lt;/specialValue&gt;
            &lt;/specialValues&gt;
            &lt;/atomic&gt;
      &lt;/dataTypeDef&gt;

     &lt;dataTypeDef&gt;
        &lt;name&gt;FEHACapab&lt;/name&gt;
               &lt;synopsis&gt;
                   The supported HA features
               &lt;/synopsis&gt;
           &lt;atomic&gt;
           &lt;baseType&gt;uchar&lt;/baseType&gt;
           &lt;specialValues&gt;
              &lt;specialValue value="0"&gt;
                &lt;name&gt;GracefullRestart&lt;/name&gt;
                &lt;synopsis&gt;
                     The FE supports Graceful Restart
                &lt;/synopsis&gt;
                &lt;/specialValue&gt;
              &lt;specialValue value="1"&gt;
                 &lt;name&gt;HA&lt;/name&gt;
                 &lt;synopsis&gt;
                      The FE supports HA
                 &lt;/synopsis&gt;
              &lt;/specialValue&gt;
            &lt;/specialValues&gt;
            &lt;/atomic&gt;
      &lt;/dataTypeDef&gt;
  &lt;/dataTypeDefs&gt;

  &lt;LFBClassDefs&gt;
    &lt;LFBClassDef LFBClassID="2"&gt;
      &lt;name&gt;FEPO&lt;/name&gt;
      &lt;synopsis&gt;
         The FE Protocol Object
      &lt;/synopsis&gt;
      &lt;version&gt;1.0&lt;/version&gt;

  &lt;components&gt;
        &lt;component componentID="1" access="read-only"&gt;
          &lt;name&gt;CurrentRunningVersion&lt;/name&gt;
          &lt;synopsis&gt;Currently running ForCES version&lt;/synopsis&gt;
          &lt;typeRef&gt;u8&lt;/typeRef&gt;
        &lt;/component&gt;
        &lt;component componentID="2" access="read-only"&gt;
          &lt;name&gt;FEID&lt;/name&gt;
          &lt;synopsis&gt;Unicast FEID&lt;/synopsis&gt;
          &lt;typeRef&gt;uint32&lt;/typeRef&gt;
        &lt;/component&gt;
        &lt;component componentID="3" access="read-write"&gt;
           &lt;name&gt;MulticastFEIDs&lt;/name&gt;
           &lt;synopsis&gt;
              the table of all multicast IDs
           &lt;/synopsis&gt;
           &lt;array type="variable-size"&gt;
            &lt;typeRef&gt;uint32&lt;/typeRef&gt;
           &lt;/array&gt;
        &lt;/component&gt;
        &lt;component componentID="4" access="read-write"&gt;
          &lt;name&gt;CEHBPolicy&lt;/name&gt;
          &lt;synopsis&gt;
           The CE Heartbeat Policy
          &lt;/synopsis&gt;
          &lt;typeRef&gt;CEHBPolicyValues&lt;/typeRef&gt;
        &lt;/component&gt;
        &lt;component componentID="5" access="read-write"&gt;
          &lt;name&gt;CEHDI&lt;/name&gt;
          &lt;synopsis&gt;
            The CE Heartbeat Dead Interval in millisecs
          &lt;/synopsis&gt;
          &lt;typeRef&gt;uint32&lt;/typeRef&gt;
        &lt;/component&gt;
        &lt;component componentID="6" access="read-write"&gt;
          &lt;name&gt;FEHBPolicy&lt;/name&gt;
          &lt;synopsis&gt;
            The FE Heartbeat Policy
          &lt;/synopsis&gt;
          &lt;typeRef&gt;FEHBPolicyValues&lt;/typeRef&gt;
        &lt;/component&gt;
        &lt;component componentID="7" access="read-write"&gt;
          &lt;name&gt;FEHI&lt;/name&gt;
          &lt;synopsis&gt;
            The FE Heartbeat Interval in millisecs
          &lt;/synopsis&gt;
          &lt;typeRef&gt;uint32&lt;/typeRef&gt;
        &lt;/component&gt;
        &lt;component componentID="8" access="read-write"&gt;
          &lt;name&gt;CEID&lt;/name&gt;
          &lt;synopsis&gt;
             The Primary CE this FE is associated with
          &lt;/synopsis&gt;
          &lt;typeRef&gt;uint32&lt;/typeRef&gt;
        &lt;/component&gt;
        &lt;component componentID="9" access="read-write"&gt;
           &lt;name&gt;BackupCEs&lt;/name&gt;
           &lt;synopsis&gt;
              The table of all backup CEs other than the primary
           &lt;/synopsis&gt;
           &lt;array type="variable-size"&gt;
            &lt;typeRef&gt;uint32&lt;/typeRef&gt;
           &lt;/array&gt;
        &lt;/component&gt;
        &lt;component componentID="10" access="read-write"&gt;
          &lt;name&gt;CEFailoverPolicy&lt;/name&gt;
          &lt;synopsis&gt;
            The CE Failover Policy
          &lt;/synopsis&gt;
          &lt;typeRef&gt;CEFailoverPolicyValues&lt;/typeRef&gt;
        &lt;/component&gt;

        &lt;component componentID="11" access="read-write"&gt;
          &lt;name&gt;CEFTI&lt;/name&gt;
          &lt;synopsis&gt;
            The CE Failover Timeout Interval in millisecs
          &lt;/synopsis&gt;
          &lt;typeRef&gt;uint32&lt;/typeRef&gt;
        &lt;/component&gt;
        &lt;component componentID="12" access="read-write"&gt;
          &lt;name&gt;FERestartPolicy&lt;/name&gt;
          &lt;synopsis&gt;
             The FE Restart Policy
          &lt;/synopsis&gt;
          &lt;typeRef&gt;FERestartPolicyValues&lt;/typeRef&gt;
        &lt;/component&gt;
        &lt;component componentID="13" access="read-write"&gt;
          &lt;name&gt;LastCEID&lt;/name&gt;
          &lt;synopsis&gt;
             The Primary CE this FE was last associated with
          &lt;/synopsis&gt;
          &lt;typeRef&gt;uint32&lt;/typeRef&gt;
        &lt;/component&gt;
      &lt;/components&gt;

     &lt;capabilities&gt;
        &lt;capability componentID="30"&gt;
           &lt;name&gt;SupportableVersions&lt;/name&gt;
           &lt;synopsis&gt;
              the table of ForCES versions that FE supports
           &lt;/synopsis&gt;
           &lt;array type="variable-size"&gt;
            &lt;typeRef&gt;u8&lt;/typeRef&gt;
           &lt;/array&gt;
        &lt;/capability&gt;
        &lt;capability componentID="31"&gt;
           &lt;name&gt;HACapabilities&lt;/name&gt;
           &lt;synopsis&gt;
              the table of HA capabilities the FE supports
           &lt;/synopsis&gt;
           &lt;array type="variable-size"&gt;
            &lt;typeRef&gt;FEHACapab&lt;/typeRef&gt;
           &lt;/array&gt;
        &lt;/capability&gt;
      &lt;/capabilities&gt;

      &lt;events baseID="61"&gt;
        &lt;event eventID="1"&gt;
          &lt;name&gt;PrimaryCEDown&lt;/name&gt;
          &lt;synopsis&gt;
              The pimary CE has changed
          &lt;/synopsis&gt;
          &lt;eventTarget&gt;
              &lt;eventField&gt;LastCEID&lt;/eventField&gt;
          &lt;/eventTarget&gt;
          &lt;eventChanged/&gt;
          &lt;eventReports&gt;
             &lt;eventReport&gt;
               &lt;eventField&gt;LastCEID&lt;/eventField&gt;
             &lt;/eventReport&gt;
          &lt;/eventReports&gt;
        &lt;/event&gt;
      &lt;/events&gt;

    &lt;/LFBClassDef&gt;
  &lt;/LFBClassDefs&gt;
&lt;/LFBLibrary&gt;
</pre></div>
<a name="anchor55"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1"></a><h3>B.1.&nbsp;
Capabilities</h3>

<p>Supportable Versions enumerates all ForCES versions that an FE
        supports.
</p>
<p>
		FEHACapab enumerates the HA capabilities of the FE. If the
		FE is not capable of Graceful restarts or
		HA, then it will not be able to participate in
		HA as described in <a class='info' href='#FEPOHA'>Section&nbsp;8.1<span> (</span><span class='info'>Relation with the FE Protocol </span><span>)</span></a>
	
</p>
<a name="anchor56"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.2"></a><h3>B.2.&nbsp;
Components</h3>

<p>All Components are explained in <a class='info' href='#FPL_sum'>Section&nbsp;7.3.1<span> (</span><span class='info'>FE Protocol LFB</span><span>)</span></a>.
</p>
<a name="DataencExam"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
Data Encoding Examples</h3>

<p>In this section a few examples of data encoding are discussed. these
      example, however, do not show any padding.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
==========
Example 1:
==========
</pre></div>
<p>Structure with three fixed-lengthof, mandatory fields.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        struct S {
        uint16 a
        uint16 b
        uint16 c
        }
</pre></div>
<p>(a) Describing all fields using SPARSEDATA-TLV
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        Path-Data TLV
          Path to an instance of S ...
          SPARSEDATA-TLV
            ComponentIDof(a), lengthof(a), valueof(a)
            ComponentIDof(b), lengthof(b), valueof(b)
            ComponentIDof(c), lengthof(c), valueof(c)
</pre></div>
<p>(b) Describing a subset of fields
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        Path-Data TLV
          Path to an instance of S ...
          SPARSEDATA-TLV
            ComponentIDof(a), lengthof(a), valueof(a)
            ComponentIDof(c), lengthof(c), valueof(c)
</pre></div>
<p>Note: Even though there are non-optional components
      in structure S, since one can uniquely identify components, 
      one can selectively send component of structure S (eg in 
      the case of an update from CE to FE).
</p>
<p>(c) Describing all fields using a FULLDATA-TLV
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        Path-Data TLV
          Path to an instance of S ...
          FULLDATA-TLV
            valueof(a)
            valueof(b)
            valueof(c)
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
==========
Example 2:
==========
</pre></div>
<p>Structure with three fixed-lengthof fields, one mandatory, two
      optional.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        struct T {
        uint16 a
        uint16 b (optional)
        uint16 c (optional)
        }
</pre></div>
<p>This example is identical to Example 1, as illustrated below.
</p>
<p>(a) Describing all fields using SPARSEDATA-TLV
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        Path-Data TLV
          Path to an instance of S ...
          SPARSEDATA-TLV
            ComponentIDof(a), lengthof(a), valueof(a)
            ComponentIDof(b), lengthof(b), valueof(b)
            ComponentIDof(c), lengthof(c), valueof(c)
</pre></div>
<p>(b) Describing a subset of fields using SPARSEDATA-TLV
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        Path-Data TLV
          Path to an instance of S ...
          SPARSEDATA-TLV
            ComponentIDof(a), lengthof(a), valueof(a)
            ComponentIDof(c), lengthof(c), valueof(c)
</pre></div>
<p>(c) Describing all fields using a FULLDATA-TLV
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        Path-Data TLV
          Path to an instance of S ...
          FULLDATA-TLV
            valueof(a)
            valueof(b)
            valueof(c)
</pre></div>
<p>Note: FULLDATA-TLV _cannot_ be used unless all fields are being
      described.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
==========
Example 3:
==========
</pre></div>
<p>Structure with a mix of fixed-lengthof and variable-lengthof fields,
      some mandatory, some optional. Note in this case, b is variable 
      sized 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        struct U {
        uint16 a
        string b (optional)
        uint16 c (optional)
        }
</pre></div>
<p>(a) Describing all fields using SPARSEDATA-TLV
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        Path to an instance of U ...
        SPARSEDATA-TLV
          ComponentIDof(a), lengthof(a), valueof(a)
          ComponentIDof(b), lengthof(b), valueof(b)
          ComponentIDof(c), lengthof(c), valueof(c)
</pre></div>
<p>(b) Describing a subset of fields using SPARSEDATA-TLV
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        Path to an instance of U ...
        SPARSEDATA-TLV
          ComponentIDof(a), lengthof(a), valueof(a)
          ComponentIDof(c), lengthof(c), valueof(c)
</pre></div>
<p>(c) Describing all fields using FULLDATA-TLV
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        Path to an instance of U ...
          FULLDATA-TLV
            valueof(a)
            FULLDATA-TLV
              valueof(b)
            valueof(c)
</pre></div>
<p>Note: The variable-length field requires the addition of a 
	 FULLDATA-TLV within the outer FULLDATA-TLV as in the case of 
	 component b above.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
==========
Example 4:
==========
</pre></div>
<p>Structure containing an array of another structure type.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        struct V {
        uint32 x
        uint32 y
        struct U z[]
        }
</pre></div>
<p>(a) Encoding using SPARSEDATA-TLV, with two instances of z[], also
      described with SPARSEDATA-TLV, assuming only the 10th and 15th 
      subscript of z[] are encoded.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        path to instance of V ...
        SPARSEDATA-TLV
        ComponentIDof(x), lengthof(x), valueof(x)
        ComponentIDof(y), lengthof(y), valueof(y)
        ComponentIDof(z), lengthof(all below)
          ComponentID = 10 (i.e index 10 from z[]), lengthof(all below)
              ComponentIDof(a), lengthof(a), valueof(a)
              ComponentIDof(b), lengthof(b), valueof(b)
          ComponentID = 15 (index 15 from z[]), lengthof(all below)
              ComponentIDof(a), lengthof(a), valueof(a)
              ComponentIDof(c), lengthof(c), valueof(c)
</pre></div>
<p>Note the holes in the components of z (10 followed by 15).
      Also note the gap in index 15 with only components a and c 
      appearing but not b.
</p>
<a name="use_cases"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D"></a><h3>Appendix D.&nbsp;
Use Cases</h3>

<p>Assume LFB with following components for the following use cases.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>


foo1, type u32, ID = 1

foo2, type u32, ID = 2

table1: type array, ID = 3
        components are:
        t1, type u32, ID = 1
        t2, type u32, ID = 2  // index into table2
        KEY: nhkey, ID = 1, V = t2

table2: type array, ID = 4
        components are:
        j1, type u32, ID = 1
        j2, type u32, ID = 2
        KEY: akey, ID = 1, V = { j1,j2 }

table3: type array, ID = 5
        components are:
        someid, type u32, ID = 1
        name, type string variable sized, ID = 2

table4: type array, ID = 6
        components are:
        j1, type u32, ID = 1
        j2, type u32, ID = 2
        j3, type u32, ID = 3
        j4, type u32, ID = 4
        KEY: mykey, ID = 1, V = { j1}

table5: type array, ID = 7
        components are:
        p1, type u32, ID = 1
        p2, type array, ID = 2, array components of type-X

Type-X:
        x1, ID 1, type u32
        x2, ID2 , type u32
                KEY: tkey, ID = 1, V = { x1}


</pre></div>
<p>All examples will use valueof(x) to indicate 
      the value of the referenced component x. 
      In the case where F_SEL** are missing (bits equal to 00) then 
      the flags will not show any selection.
</p>
<p>All the examples only show use of FULLDATA-TLV for data encoding;
      although SPARSEDATA-TLV would make more sense in certain occasions,
      the emphasis is on showing the message layout.
      Refer to <a class='info' href='#DataencExam'>Appendix&nbsp;C<span> (</span><span class='info'>Data Encoding Examples</span><span>)</span></a> for examples that show 
      usage of both FULLDATA-TLV and SPARSEDATA-TLV.
</p>
<p>
</p>
<ol class="text">
<li>To get foo1 <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

OPER = GET-TLV
        Path-data TLV: IDCount = 1, IDs = 1
Result:
OPER = GET-RESPONSE-TLV
        Path-data-TLV:
                flags=0, IDCount = 1, IDs = 1
                FULLDATA-TLV L = 4+4, V =  valueof(foo1)

</pre></div>
</li>
<li>To set foo2 to 10 <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
OPER = SET-TLV
        Path-data-TLV:
                flags = 0,  IDCount = 1, IDs = 2
                FULLDATA-TLV: L = 4+4, V=10

Result:
OPER = SET-RESPONSE-TLV
        Path-data-TLV:
                flags = 0,  IDCount = 1, IDs = 2
                RESULT-TLV
</pre></div>
</li>
<li>To dump table2 <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   OPER = GET-TLV
        Path-data-TLV:
                IDCount = 1, IDs = 4
   Result:
   OPER = GET-RESPONSE-TLV
        Path-data-TLV:
                flags = 0, IDCount = 1, IDs = 4
                FULLDATA-TLV: L = XXX, V=
                     a series of: index, valueof(j1), valueof(j2)
                     representing the entire table


</pre></div>

        
<blockquote class="text"><dl>
<dt>Note: </dt>
<dd>One should be able to take a GET-RESPONSE-TLV
          and convert it to a SET-TLV. If the result in the above
          example is sent back in a SET-TLV, (instead of a
          GET-RESPONSE_TLV) then the entire contents of the table will be
          replaced at that point.
</dd>
</dl></blockquote>

</li>
<li>Multiple operations Example. To create entry 0-5 of table2 (Error
        conditions are ignored)
</li><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
OPER = SET-TLV
        Path-data-TLV:
                flags = 0 , IDCount = 1, IDs=4
                PATH-DATA-TLV
                  flags = 0, IDCount = 1, IDs = 0
                  FULLDATA-TLV valueof(j1), valueof(j2) of entry 0
                PATH-DATA-TLV
                  flags = 0, IDCount = 1, IDs = 1
                  FULLDATA-TLV valueof(j1), valueof(j2) of entry 1
                PATH-DATA-TLV
                  flags = 0, IDCount = 1, IDs = 2
                  FULLDATA-TLV valueof(j1), valueof(j2) of entry 2
                PATH-DATA-TLV
                  flags = 0, IDCount = 1, IDs = 3
                  FULLDATA-TLV valueof(j1), valueof(j2) of entry 3
                PATH-DATA-TLV
                  flags = 0, IDCount = 1, IDs = 4
                  FULLDATA-TLV valueof(j1), valueof(j2) of entry 4
                PATH-DATA-TLV
                  flags = 0, IDCount = 1, IDs = 5
                  FULLDATA-TLV valueof(j1), valueof(j2) of entry 5


</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Result:
OPER = SET-RESPONSE-TLV
        Path-data-TLV:
                flags = 0 , IDCount = 1, IDs=4
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 0
                    RESULT-TLV
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 1
                    RESULT-TLV
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 2
                    RESULT-TLV
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 3
                    RESULT-TLV
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 4
                    RESULT-TLV
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 5
                    RESULT-TLV

</pre></div>
<li>Block operations (with holes) example. Replace entry 0,2 of
        table2
</li><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
OPER = SET-TLV
        Path-data TLV:
                flags =  0 , IDCount = 1, IDs=4
                PATH-DATA-TLV
                   flags = 0, IDCount = 1, IDs = 0
                   FULLDATA-TLV containing valueof(j1), valueof(j2) of 0
                PATH-DATA-TLV
                   flags = 0, IDCount = 1, IDs = 2
                   FULLDATA-TLV containing valueof(j1), valueof(j2) of 2

Result:
OPER = SET-TLV
        Path-data TLV:
                flags =  0 , IDCount = 1, IDs=4
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 0
                    RESULT-TLV
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 2
                    RESULT-TLV

</pre></div>
<li>Getting rows example. Get first entry of table2. <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
OPER = GET-TLV
        Path-data TLV:
                IDCount = 2, IDs=4.0

Result:
OPER = GET-RESPONSE-TLV
        Path-data TLV:
                IDCount = 2, IDs=4.0
                 FULLDATA-TLV containing valueof(j1), valueof(j2)
</pre></div>
</li>
<li>Get entry 0-5 of table2. <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

OPER = GET-TLV
        Path-data-TLV:
                flags = 0, IDCount = 1, IDs=4
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 0
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 1
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 2
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 3
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 4
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 5


Result:
OPER = GET-RESPONSE-TLV
        Path-data-TLV:
                flags = 0, IDCount = 1, IDs=4
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 0
                    FULLDATA-TLV containing valueof(j1), valueof(j2)
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 1
                    FULLDATA-TLV containing valueof(j1), valueof(j2)
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 2
                    FULLDATA-TLV containing valueof(j1), valueof(j2)
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 3
                    FULLDATA-TLV containing valueof(j1), valueof(j2)
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 4
                    FULLDATA-TLV containing valueof(j1), valueof(j2)
                PATH-DATA-TLV
                    flags = 0, IDCount = 1, IDs = 5
                    FULLDATA-TLV containing valueof(j1), valueof(j2)

</pre></div>
</li>
<li>Create a row in table2, index 5.
</li><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

OPER = SET-TLV
        Path-data-TLV:
                flags = 0, IDCount = 2, IDs=4.5
                FULLDATA-TLV containing valueof(j1), valueof(j2)

Result:
OPER = SET-RESPONSE-TLV
        Path-data TLV:
                flags = 0, IDCount = 1, IDs=4.5
                RESULT-TLV

</pre></div>
<li>Dump contents of table1.
</li><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

OPER = GET-TLV
        Path-data TLV:
                flags = 0, IDCount = 1, IDs=3

Result:
OPER = GET-RESPONSE-TLV
        Path-data TLV
                flags = 0, IDCount = 1, IDs=3
                FULLDATA-TLV, Length = XXXX
                        (depending on size of table1)
                        index, valueof(t1),valueof(t2)
                        index, valueof(t1),valueof(t2)
                        .
                        .
                        .

</pre></div>
<li>Using Keys. Get row entry from table4 where j1=100. Recall, j1 is a
        defined key for this table and its KeyID is 1.
</li><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>



OPER = GET-TLV
        Path-data-TLV:
                flags = F_SELKEY  IDCount = 1, IDs=6
                KEYINFO-TLV = KeyID=1, KEY_DATA=100

Result:
If j1=100 was at index 10
OPER = GET-RESPONSE-TLV
        Path-data TLV:
                flags = 0, IDCount = 1, IDs=6.10
                FULLDATA-TLV containing
                  valueof(j1), valueof(j2),valueof(j3),valueof(j4)

</pre></div>
<li>Delete row with KEY match (j1=100, j2=200) in table2. Note that
        the j1,j2 pair are a defined key for the table2.
</li><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

OPER = DEL-TLV
        Path-data TLV:
                flags = F_SELKEY  IDCount = 1, IDs=4
                KEYINFO-TLV:  {KeyID =1 KEY_DATA=100,200}

Result:
If (j1=100, j2=200) was at entry 15:
OPER = DELETE-RESPONSE-TLV
        Path-data TLV:
                flags = 0  IDCount = 2, IDs=4.15
                RESULT-TLV

</pre></div>
<li>Dump contents of table3. It should be noted that this table has a
        column with component name that is variable sized. The purpose of this
        use case is to show how such an component is to be encoded.
</li><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

OPER = GET-TLV
        Path-data-TLV:
                flags = 0 IDCount = 1, IDs=5

Result:
OPER = GET-RESPONSE-TLV
     Path-data TLV:
        flags = 0  IDCount = 1, IDs=5
            FULLDATA-TLV, Length = XXXX
               index, someidv, TLV: T=FULLDATA-TLV, L = 4+strlen(namev),
                       V = valueof(v)
               index, someidv, TLV: T=FULLDATA-TLV, L = 4+strlen(namev),
                       V = valueof(v)
               index, someidv, TLV: T=FULLDATA-TLV, L = 4+strlen(namev),
                       V = valueof(v)
               index, someidv, TLV: T=FULLDATA-TLV, L = 4+strlen(namev),
                       V = valueof(v)
                .
                .
                .

</pre></div>
<li>Multiple atomic operations.
</li>
<blockquote class="text"><dl>
<dt>Note 1: </dt>
<dd>This emulates adding a new nexthop entry and
          then atomically updating the L3 entries pointing to an old NH to
          point to a new one. The assumption is both tables are in the same
          LFB
</dd>
<dt>Note2: </dt>
<dd> Observe the two operations on the LFB
          instance, both are SET operations.
</dd>
</dl></blockquote><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

//Operation 1: Add a new entry to table2 index #20.
OPER = SET-TLV
        Path-TLV:
                flags = 0, IDCount = 2,  IDs=4.20
                FULLDATA-TLV, V= valueof(j1),valueof(j2)

// Operation 2: Update table1 entry which
// was pointing with t2 = 10 to now point to 20
OPER = SET-TLV
        Path-data-TLV:
                flags = F_SELKEY, IDCount = 1, IDs=3
                KEYINFO-TLV = KeyID=1 KEY_DATA=10
                Path-data-TLV
                        flags = 0  IDCount = 1, IDs=2
                        FULLDATA-TLV, V= 20

Result:
//first operation, SET
OPER = SET-RESPONSE-TLV
        Path-data-TLV
                flags = 0 IDCount = 3, IDs=4.20
                RESULT-TLV code = success
                        FULLDATA-TLV, V = valueof(j1),valueof(j2)
// second operation SET - assuming entry 16 was updated
OPER = SET-RESPONSE-TLV
        Path-data TLV
                flags = 0 IDCount = 2, IDs=3.16
                Path-Data TLV
                        flags = 0  IDCount = 1, IDs = 2
                        RESULT-TLV code = success
                                FULLDATA-TLV, Length = XXXX v=20
</pre></div>
<li>Selective setting. On table4 -- for indices 1, 3, 5, 7, and 9.
        Replace j1 to 100, j2 to 200, j3 to 300. Leave j4 as is.
</li><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
PER = SET-TLV
    Path-data TLV
        flags = 0, IDCount = 1, IDs = 6
        Path-data TLV
            flags = 0, IDCount = 1, IDs = 1
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 1
                FULLDATA-TLV, Length = XXXX, V = {100}
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 2
                FULLDATA-TLV, Length = XXXX, V = {200}
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 3
                FULLDATA-TLV, Length = XXXX, V = {300}
        Path-data TLV
            flags = 0, IDCount = 1, IDs = 3
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 1
                FULLDATA-TLV, Length = XXXX, V = {100}
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 2
                FULLDATA-TLV, Length = XXXX, V = {200}
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 3
                FULLDATA-TLV, Length = XXXX, V = {300}
        Path-data TLV
            flags = 0, IDCount = 1, IDs = 5
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 1
                FULLDATA-TLV, Length = XXXX, V = {100}
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 2
                FULLDATA-TLV, Length = XXXX, V = {200}
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 3
                FULLDATA-TLV, Length = XXXX, V = {300}
        Path-data TLV
            flags = 0, IDCount = 1, IDs = 7
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 1
                FULLDATA-TLV, Length = XXXX, V = {100}
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 2
                FULLDATA-TLV, Length = XXXX, V = {200}
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 3
                FULLDATA-TLV, Length = XXXX, V = {300}
        Path-data TLV
            flags = 0, IDCount = 1, IDs = 9
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 1
                FULLDATA-TLV, Length = XXXX, V = {100}
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 2
                FULLDATA-TLV, Length = XXXX, V = {200}
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 3
                FULLDATA-TLV, Length = XXXX, V = {300}


response:

OPER = SET-RESPONSE-TLV
    Path-data TLV
        flags = 0, IDCount = 1, IDs = 6
        Path-data TLV
            flags = 0, IDCount = 1, IDs = 1
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 1
                RESULT-TLV
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 2
                RESULT-TLV
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 3
                RESULT-TLV
        Path-data TLV
            flags = 0, IDCount = 1, IDs = 3
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 1
                RESULT-TLV
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 2
                RESULT-TLV
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 3
                RESULT-TLV
        Path-data TLV
            flags = 0, IDCount = 1, IDs = 5
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 1
                RESULT-TLV
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 2
                RESULT-TLV
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 3
                RESULT-TLV
        Path-data TLV
            flags = 0, IDCount = 1, IDs = 7
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 1
                RESULT-TLV
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 2
                RESULT-TLV
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 3
                RESULT-TLV
        Path-data TLV
            flags = 0, IDCount = 1, IDs = 9
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 1
                RESULT-TLV
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 2
                RESULT-TLV
            Path-data TLV
                flags = 0, IDCount = 1, IDs = 3
                RESULT-TLV
</pre></div>
<li>Manipulation of table of table examples. Get x1 from table10 row
        with index 4, inside table5 entry 10
</li><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

operation = GET-TLV
        Path-data-TLV
                flags = 0  IDCount = 5, IDs=7.10.2.4.1

Results:
operation = GET-RESPONSE-TLV
        Path-data-TLV
                flags = 0  IDCount = 5, IDs=7.10.2.4.1
                FULLDATA-TLV: L=XXXX, V = valueof(x1)

</pre></div>
<li>From table5's row 10 table10, get X2s based on on the value of x1
        equaling 10 (recall x1 is KeyID 1)
</li><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
operation = GET-TLV
        Path-data-TLV
                flag = F_SELKEY, IDCount=3, IDS = 7.10.2
                KEYINFO-TLV, KeyID = 1, KEYDATA = 10
                Path-data TLV
                        IDCount = 1, IDS = 2 //select x2

Results:
If x1=10 was at entry 11:
operation = GET-RESPONSE-TLV
        Path-data-TLV
                flag = 0, IDCount=5, IDS = 7.10.2.11
                Path-data TLV
                        flags = 0  IDCount = 1, IDS = 2
                        FULLDATA-TLV: L=XXXX, V = valueof(x2)

</pre></div>
<li>Further example of manipulating a table of tables
</li><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Consider table6 which is defined as:
table6: type array, ID = 8
        components are:
        p1, type u32, ID = 1
        p2, type array, ID = 2, array components of type type-A

type-A:
        a1, type u32, ID 1,
        a2, type array ID2 ,array components of type type-B

type-B:
        b1, type u32, ID 1
        b2, type u32, ID 2

If for example one wanted to set by replacing:
table6.10.p1 to 111
table6.10.p2.20.a1 to 222
table6.10.p2.20.a2.30.b1 to 333

in one message and one operation.

There are two ways to do this:
   a) using nesting
   b) using a flat path data

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

A. Method using nesting
   in one message with a single operation

operation = SET-TLV
        Path-data-TLV
                flags = 0  IDCount = 2, IDs=6.10
                Path-data-TLV
                        flags = 0, IDCount = 1, IDs=1
                        FULLDATA-TLV: L=XXXX,
                                V = {111}
                Path-data-TLV
                        flags = 0  IDCount = 2, IDs=2.20
                        Path-data-TLV
                                flags = 0, IDCount = 1, IDs=1
                                FULLDATA-TLV: L=XXXX,
                                        V = {222}
                        Path-data TLV :
                                flags = 0, IDCount = 3, IDs=2.30.1
                                FULLDATA-TLV: L=XXXX,
                                        V = {333}
Result:
operation = SET-RESPONSE-TLV
        Path-data-TLV
                flags = 0  IDCount = 2, IDs=6.10
                Path-data-TLV
                        flags = 0, IDCount = 1, IDs=1
                        RESULT-TLV
                Path-data-TLV
                        flags = 0  IDCount = 2, IDs=2.20
                        Path-data-TLV
                                flags = 0, IDCount = 1, IDs=1
                                RESULT-TLV
                        Path-data TLV :
                                flags = 0, IDCount = 3, IDs=2.30.1
                                RESULT-TLV

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

B. Method using a flat path data in
   one message with a single operation

operation = SET-TLV
        Path-data TLV :
                flags = 0, IDCount = 3, IDs=6.10.1
                FULLDATA-TLV: L=XXXX,
                        V = {111}
        Path-data TLV :
                flags = 0, IDCount = 5, IDs=6.10.1.20.1
                FULLDATA-TLV: L=XXXX,
                        V = {222}
        Path-data TLV :
                flags = 0, IDCount = 7, IDs=6.10.1.20.1.30.1
                FULLDATA-TLV: L=XXXX,
                        V = {333}
Result:
operation = SET-TLV
        Path-data TLV :
                flags = 0, IDCount = 3, IDs=6.10.1
                RESULT-TLV
        Path-data TLV :
                flags = 0, IDCount = 5, IDs=6.10.1.20.1
                RESULT-TLV
        Path-data TLV :
                flags = 0, IDCount = 7, IDs=6.10.1.20.1.30.1
                RESULT-TLV

</pre></div>
<li>Get a whole LFB (all its components, etc.).
</li>
<blockquote class="text"><dl>
<dt>For example: </dt>
<dd>at startup a CE might well want the
          entire FE OBJECT LFB. So, in a request targeted at class 1, instance
          1, one might find:
</dd>
</dl></blockquote><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

operation = GET-TLV
        Path-data-TLV
                flags = 0  IDCount = 0

result:
operation = GET-RESPONSE-TLV
        Path-data-TLV
                flags = 0  IDCount = 0
                FULLDATA-TLV encoding of the FE Object LFB

</pre></div>
</ol>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ligang Dong</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Zhejiang Gongshang University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">149 Jiaogong Road</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hangzhou  310035</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.R.China</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86-571-88071024</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:donglg@mail.zjgsu.edu.cn">donglg@mail.zjgsu.edu.cn</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Avri Doria</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Lulea University of Technology</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rainbow Way</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Lulea  SE-971 87</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sweden</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+46 73 277 1788</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:avri@ltu.se">avri@ltu.se</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ram Gopal</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">5, Wayside Road</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Burlington, MA  310035</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1-781-993-3685</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ram.gopal@nokia.com">ram.gopal@nokia.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Robert Haas</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">IBM</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Saumerstrasse 4</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">8803 Ruschlikon  </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Switzerland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:rha@zurich.ibm.com">rha@zurich.ibm.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jamal Hadi Salim</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Znyx</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ottawa, Ontario  </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Canada</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hadi@znyx.com">hadi@znyx.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hormuzd M Khosravi</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Intel</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">2111 NE 25th Avenue</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hillsboro, OR  97124</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 503 264 0334</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hormuzd.m.khosravi@intel.com">hormuzd.m.khosravi@intel.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Weiming Wang </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Zhejiang Gongshang University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">149 Jiaogong Road</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hangzhou  310035</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.R.China</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86-571-88057712</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:wmwang@mail.zjgsu.edu.cn">wmwang@mail.zjgsu.edu.cn</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
