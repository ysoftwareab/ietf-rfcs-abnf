<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Dynamically Recreatable Keys</title>
<meta content="Juan A. Garcia-Pardo" name="author">
<meta content="Cyrill Kraehenbuehl" name="author">
<meta content="Benjamin Rothenberger" name="author">
<meta content="Adrian Perrig" name="author">
<meta content="
       DRKey is a pragmatic Internet-scale
key-establishment system that allows any
host to locally obtain a symmetric key to enable a remote service to
perform source-address authentication,
and enables first-packet authentication.
The remote service can itself
locally derive the same key with efficient cryptographic operations. 
       DRKey was developed with path aware networks in mind, but it is also
applicable to today's Internet.
It can be incrementally deployed and it offers incentives to the
parties using it independently of its dissemination in the network. 
    " name="description">
<meta content="xml2rfc 3.12.0" name="generator">
<meta content="draft-garciapardo-panrg-drkey-02" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.7.1
    pycountry 20.7.3
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.27.1
    setuptools 59.6.0
    six 1.16.0
    WeasyPrint 52.5
-->
<link href="/tmp/draft-garciapardo-panrg-drkey-02-c3ura4b7.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">I-D</td>
<td class="right">January 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Garcia-Pardo, et al.</td>
<td class="center">Expires 16 July 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">PANRG</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-garciapardo-panrg-drkey-02</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-01-12" class="published">12 January 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-07-16">16 July 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">J. Garcia-Pardo</div>
<div class="org">ETH Zuerich</div>
</div>
<div class="author">
      <div class="author-name">C. Kraehenbuehl</div>
<div class="org">ETH Zuerich</div>
</div>
<div class="author">
      <div class="author-name">B. Rothenberger</div>
<div class="org">ETH Zuerich</div>
</div>
<div class="author">
      <div class="author-name">A. Perrig</div>
<div class="org">ETH Zuerich</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Dynamically Recreatable Keys</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">DRKey is a pragmatic Internet-scale
key-establishment system that allows any
host to locally obtain a symmetric key to enable a remote service to
perform source-address authentication,
and enables first-packet authentication.
The remote service can itself
locally derive the same key with efficient cryptographic operations.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">DRKey was developed with path aware networks in mind, but it is also
applicable to today's Internet.
It can be incrementally deployed and it offers incentives to the
parties using it independently of its dissemination in the network.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 16 July 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-outline" class="xref">Outline</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-key-derivation" class="xref">Key Derivation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-overview" class="xref">Overview</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-assumptions" class="xref">Assumptions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-key-hierarchy" class="xref">Key Hierarchy</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-key-establishment" class="xref">Key Establishment</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-first-level-key-establishme" class="xref">First Level Key Establishment</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-second-or-third-level-key-e" class="xref">Second or Third Level Key Establishment</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-key-server-discovery" class="xref">Key Server Discovery</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-key-expiration" class="xref">Key Expiration</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-packet-authentication" class="xref">Packet Authentication</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-high-speed-dns-authenticati" class="xref">High-Speed DNS Authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-edns0-authentication-option" class="xref">EDNS(0) Authentication Option</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-deployment" class="xref">Deployment</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-deployment-incentives" class="xref">Deployment Incentives</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-key-server-latency" class="xref">Key-Server Latency</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-network-mobility" class="xref">Network Mobility</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-lighning-filter-system-as-a" class="xref">Lighning Filter System as a DRKey Deployment</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-drkey-and-trust-in-ases" class="xref">DRKey and Trust in ASes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-authentication-within-an-as" class="xref">Authentication within an AS</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-adversary-model" class="xref">Adversary Model</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">In today's Internet,
denial-of-service (DoS)
attacks often use reflection and amplification techniques enabled
by connectionless protocols like DNS or NTP and the possibility
of source-address spoofing.

The main goal of DRKey is to provide a
highly efficient global first-packet authentication system.
DRKey
provides packet authentication at the network layer based on the
network address (i.e., the IP address in the current Internet or the
combination of AS number and local address in SCION),
and not
based on a higher-level identity such as a domain name or
web-server identity.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">To obtain strong guarantees with high efficiency on
a per-packet basis, an authentication system based on symmetric
cryptography is required.
DRKey does not rely on in-band protocols to negotiate
keys, so it is able to authenticate already the first packet received
from a host.
DRKey also does not store the symmetric keys for all potential
senders, as it would be infeasible in an Internet-scale system.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">The core property achieved by DRKey is to enable a service to rapidly
derive a symmetric key to perform network-address authentication for an
arbitrary source host. This enables services such as DNS or NTP
to instantly authenticate the first request originating from a client,
thus providing a defense against reflection-based DoS attacks.
The key can also be used to authenticate the payload of the
request and reply, which is particularly useful for DNS which by
default does not include any authentication.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">The prototype
system enables the server to derive the symmetric key within two
AES operations, which corresponds to 18 ns on a commodity server
platform, and authenticate the first packet within 85 ns on commodity
hardware.
Such speeds cannot be achieved with
protocols based on asymmetric cryptography that require multiple
messages to be exchanged to establish a shared session key.
For
example, DRKey outperforms RSA 1024-based source authentication
by a factor of more than 220, even under the assumption that
the service already knows the client's public key.
In addition to
providing highly efficient network address verification, DRKey can
also be used to authenticate Diffie-Hellman (DH) keys in a protocol
such as TCPcrypt.<a href="#section-1-4" class="pilcrow">¶</a></p>
<div id="outline">
<section id="section-1.1">
        <h3 id="name-outline">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-outline" class="section-name selfRef">Outline</a>
        </h3>
<p id="section-1.1-1">The main ideas behind DRKey are as follows. Autonomous systems
(ASes) can obtain certificates for their AS number and IP
address range from a public-key infrastructure (PKI), i.e., SCION's
control-plane PKI in a SCION deployment or the Resource
Public Key Infrastructure (RPKI) in today's Internet.
DRKey
uses such a PKI to bootstrap its own symmetric-key infrastructure.
DRKey key servers are set up in all deploying ASes and contact
each other on a regular basis to set up symmetric keys between
pairs of ASes. These symmetric keys are then used as a root keys to
efficiently derive a hierarchy of symmetric per-host and per-service
keys. The hardware implementation of the AES block cipher
on most modern CPUs (Intel, AMD, ARM), allows such a key derivation in
about four to seven times faster than a single DDR4 DRAM memory
fetch.
The approach described ensures rapid key derivation on the
server side, whereas a slower key fetch is required by the client
to a local key server. This one-sidedness makes the source
authentication for the receiving side as efficient as possible and
ensures that DRKey does not introduce new DoS attack vectors.
DRKey is incrementally deployable and provides immediate benefits to
deploying entities.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">A fundamental tradeoff in DRKey is the additional trust requirements
of end hosts in their local AS: as the key server is able to
derive the end-to-end symmetric key, this key cannot be used directly
to achieve secrecy between two end hosts. However, 
DRKey keys can be used to authenticate that the source host
indeed belongs to the claimed AS, which suffices to resolve DoS
attacks.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="terminology">
<section id="section-2">
      <h2 id="name-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<span class="break"></span><dl class="dlParallel" id="section-2-1">
        <dt id="section-2-1.1">AS:</dt>
        <dd style="margin-left: 1.5em" id="section-2-1.2">
  Autonomous System. A one-entity managed network.<a href="#section-2-1.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-1.3">SCION:</dt>
        <dd style="margin-left: 1.5em" id="section-2-1.4">
  A Path-Aware inter-networking architecture.<a href="#section-2-1.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-1.5">Network Node:</dt>
        <dd style="margin-left: 1.5em" id="section-2-1.6">
  An entity that processes packets.<a href="#section-2-1.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-1.7">Key Server:</dt>
        <dd style="margin-left: 1.5em" id="section-2-1.8">
  An entity connected to the network, that contains
cryptographic keys, and is able to provide such keys to their
respective hosts, granted they have the required permissions.<a href="#section-2-1.8" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-1.9">End Host:</dt>
        <dd style="margin-left: 1.5em" id="section-2-1.10">
  A node in the network that executes programs in behalf of
users. Users usually have full control of their end hosts.<a href="#section-2-1.10" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-1.11">PRF:</dt>
        <dd style="margin-left: 1.5em" id="section-2-1.12">
  Pseudo Random Function. Function that has a low time complexity
to evaluate, but which inverse is very expensive to obtain, making it
infeasible to compute. PRF may have as parameters a key and a value to
which the function is applied.<a href="#section-2-1.12" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-1.13">DRKey Secret Value:</dt>
        <dd style="margin-left: 1.5em" id="section-2-1.14">
  A sequence of bytes kept in secret by the AS,
inside the Key Server. The validity of the secret value is configurable
per AS, and dictates the validity of other keys derived from it.
The secret value is either random, or derived via a PRF from a random
or secret sequence of bytes only known by the AS. Secret values are
the root of the DRKey key hierarchy.
A secret value for AS A is denoted as <code>SVa</code>. More generally, a secret value
can be bound to a standard protocol p (denoted as <code>SVa^p</code>). Non-standard protocols
do not have their own secret value.<a href="#section-2-1.14" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-1.15">DRKey Key Arrow Notation:</dt>
        <dd style="margin-left: 1.5em" id="section-2-1.16">
  In DRKey, level 1 and level 2 keys exist to allow the 
authentication of the communication
between one source entity <code>a</code> and one destination entity <code>b</code>.
The key is derived by one side and copied to the other.
The side that derives the key is the source of the arrow in the
DRKey key notation.
So the key <code>K_{b-&gt;a}</code> denotes a key that is derived at <code>b</code>'s side
and obtained on <code>a</code>'s side, independently of the flow of the packets.
The source side of the arrow is also called the "fast side",
and the destination, the "slow side".
The fast side is typically a server, and the slow side an end host.<a href="#section-2-1.16" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-1.17">DRKey Level 1 Key:</dt>
        <dd style="margin-left: 1.5em" id="section-2-1.18">
  A key derived from a protocol bound secret value,
by specifying the source and
destination AS IDs of the ASes involved in the communication.
The level 1 key can be derived by applying a PRF
keyed on the secret value, to the identifiers
of the source and destination ASes of the derivation.
A level 1 key between fast side AS A and slow one AS B
is denoted as <code>K_{A-&gt;B}^p</code> for a standard protocol "p",
of <code>K_{A-&gt;B}^*</code> for non-standard ones.<a href="#section-2-1.18" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-1.19">DRKey Level 2 Key:</dt>
        <dd style="margin-left: 1.5em" id="section-2-1.20">
  A key derived from a level 1 key, and used to authenticate
the source of packets from
end-hosts to infrastructure nodes, or to further derive
level 3 keys.
A level 2 key is derived by applying a PRF keyed on the level 1 key to
the identifiers of the source and destination of the communication.
These identifiers can be the AS ID plus the IP address for the
slow side, and the AS ID or the AS ID plus the IP address for
the fast side of the DRKey protected communication.
All level 2 keys are anchored to a protocol, identified by a string.
We distinguish two possible level 2 keys, depending on the fast and slow sides of the key.
(1) A level 2 key between the fast side AS A and
the slow side end host Hb in AS B for standard protocol "p" is denoted
as <code>K_{A-&gt;B:Hb}^p</code>.
(2) A level 2 key between the fast side endhost Ha in AS A and
the slow side AS B for standard protocol "p" is denoted
as <code>K_{A:Ha-&gt;B}^p</code>.
For non-standard protocols the notation is the same but replacing <code>p</code> with <code>*,p</code>.<a href="#section-2-1.20" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-1.21">DRKey Level 3 Key:</dt>
        <dd style="margin-left: 1.5em" id="section-2-1.22">
  A key derived from a level 2 host-to-AS key, used to authenticate
the source of end-host to end-host packets.
A level 2 key between the fast side endhost Ha in AS A and
the slow side end host Hb in AS B for standard protocol "p" is denoted
as <code>K_{A:Ha-&gt;B:Hb}^p</code>.
For non-standard protocols the notation is the same but replacing <code>p</code> with <code>*,p</code>.<a href="#section-2-1.22" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-1.23">MAC:</dt>
        <dd style="margin-left: 1.5em" id="section-2-1.24">
  Message Authentication Code is a sequence of bytes that authenticates
and protects the integrity of a message. Modifying the sender identity
or the content of the message is detected by the MAC.<a href="#section-2-1.24" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="key-derivation">
<section id="section-3">
      <h2 id="name-key-derivation">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-key-derivation" class="section-name selfRef">Key Derivation</a>
      </h2>
<p id="section-3-1">To convey an intuition of the operation of the DRKey system,
a high-level overview is provided first.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="overview">
<section id="section-3.1">
        <h3 id="name-overview">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
        </h3>
<p id="section-3.1-1">The basic use case of DRKey is when a host Ha in AS A desires to
communicate with a server Hb in AS B, and Hb wants to authenticate
the network address of Ha using a symmetric key.
ASes A and B have set up one DRKey key server each,
KSa and KSb respectively. Each AS randomly selects a local secret value,
SVa and SVb, which is only shared with trustworthy entities
(in particular the key servers) in the same AS.
The secret values are never shared outside the AS.

The secret value will serve as the root of a symmetric-key hierarchy,
where keys of a level are derived from keys of the preceding level.
In DRKey, the keys are derived using a CMAC with AES,
which is an efficient pseudorandom function (PRF).
The key derivation used by KSb in the example is:
<code>K_{B-&gt;A} = PRF_{SVb}(A)</code>.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">Thanks to the key-secrecy property of a secure PRF, K_{B-&gt;A} can be
shared with another entity without disclosing SVb.
The arrow notation indicates the secret value used to
derive the key. Thus K_{B-&gt;*} would typically be used if AS B is on
the performance critical side, where <code>*</code> denotes the set of remote ASes.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">To continue with the example, KSa will prefetch keys K_{*-&gt;A} from
key servers in other ASes, including K_{B-&gt;A} from KSb.
In the example, the server Hb is trustworthy,
and can thus obtain the secret value SVb to derive keys quickly.
When Ha wants to authenticate to Hb, it contacts its local key server
KSa and requests the key K_{B:Hb-&gt;A:Ha}, which KSa can locally
derive from K_{B-&gt;A}. Ha can now directly use this symmetric key for
authenticating to Hb.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1-4">The important property of DRKey is that Hb can rapidly derive
H_{B:Hb-&gt;A:Ha} by using SVb and performing two PRF operations.
The one-wayness of the key-derivation function allows a key server
to delegate key derivation to specific entities.
The key derivation process exhibits an asymmetry, meaning that the
delegated entity Hb can directly derive a required key, whereas
host Ha is required to fetch the corresponding key from
its local key server.
As opposed
to other systems that rely on a dedicated server for key generation
and distribution (such as Kerberos), this delegation mechanism
allows entities to directly obtain a symmetric key without
communication to the key server.<a href="#section-3.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="assumptions">
<section id="section-3.2">
        <h3 id="name-assumptions">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-assumptions" class="section-name selfRef">Assumptions</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-3.2-1.1">There exists an AS-level PKI, that authenticates the public
key of an asymmetric key pair for each participating AS E
and certifies its network resources; e.g.
the SCION control-plane PKI certifying AS numbers
for a deployment in SCION and RPKI certifying AS
numbers and IP address ranges for a deployment in today's
Internet.<a href="#section-3.2-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-1.2">To verify the expiration time of keys and messages, DRKey
relies on time synchronization among ASes with a precision on
the order of several seconds. This can be achieved using a secure
time-synchronization protocol such as Roughtime.<a href="#section-3.2-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-1.3">There exists an authentication mechanism
for end hosts within an AS. This is needed for access control.<a href="#section-3.2-1.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="key-hierarchy">
<section id="section-3.3">
        <h3 id="name-key-hierarchy">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-key-hierarchy" class="section-name selfRef">Key Hierarchy</a>
        </h3>
<p id="section-3.3-1">The DRKey key-establishment framework uses a key hierarchy
consisting of four levels:<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3-2.1">0th-Level (AS-internal). On the zeroth level of the hierarchy,
each AS A randomly generates a local AS-specific secret value SVa.
The secret value represents the per-AS basis of the key hierarchy
and is renewed frequently (e.g., daily). In addition, an AS can
generate protocol-specific secret values:
<code>SVa^p = PRF_{SVa}("p")</code>
for a standard protocol p, where "p" is its ASCII encoding.
The purpose of these values is that they can be shared with specific
services, such as DNS servers, that cannot be trusted with SVa
but should still be able to efficiently derive additional keys.
This construction introduces additional communication and storage
overhead, so only widely used protocols such as DNS or NTP would
have their own secret values.
Non-standard arbitrary protocols will not have their own independent secret value,
and thus it won't be shareable among services.
For these protocols, their level 1 keys will be derived from a special
secret value denoted as <code>SVa^*</code>, only used for the derivation purpose.<a href="#section-3.3-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.3-2.2">1st-Level (AS-to-AS). By using key derivation, an AS A can
derive different symmetric keys using a PRF
from the special local secret value SVa^* or a protocol-specific secret
value SVa^p. These derived keys, which are shared between AS A
and a second AS B, form the first level of the key hierarchy and are
called first-level keys:
<code>K_{A-&gt;B}^x = PRF_{SVa^x}(B)</code>.
The input to the PRF is the (globally unique) AS number of AS
B. The value of <code>x</code> will be either <code>p</code> for standard protocols or <code>*</code>
for arbitrary ones.
The first-level keys are periodically exchanged between key servers of
different ASes.<a href="#section-3.3-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.3-2.3">
            <p id="section-3.3-2.3.1">2nd-Level (AS-to-host, host-to-AS). Using the symmetric
keys of the first level of the hierarchy, second-level keys are derived
to provide symmetric keys for authentication (AS-to-host cases) or
further derivation (host-to-AS cases) into the third level keys.
Second-level keys can be established between:<a href="#section-3.3-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3-2.3.2.1">An AS as fast side, and an end-host as slow, for a standard protocol p:
<code>K_{A-&gt;B:Hb}^p = PRF_{K_{A-&gt;B}^p}(0||Hb)</code><a href="#section-3.3-2.3.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-3.3-2.3.2.2">An end-host as fast side, and an AS as slow, for a standard protocol p:
<code>K_{A:Ha-&gt;B}^p = PRF_{K_{A-&gt;B}^p}(1||Ha)</code><a href="#section-3.3-2.3.2.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-3.3-2.3.2.3">An AS as fast side, and an end-host as slow, for a non-standard, arbitrary protocol p:
<code>K_{A-&gt;B:Hb}^{*,p} = PRF_{K_{A-&gt;B}^*}(0||Hb||"p")</code><a href="#section-3.3-2.3.2.3" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-3.3-2.3.2.4">An end-host as fast side, and an AS as slow, for a non-standard, arbitrary protocol p:
<code>K_{A:Ha-&gt;B}^{*,p} = PRF_{K_{A-&gt;B}^*}(1||Ha||"p")</code><a href="#section-3.3-2.3.2.4" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-3.3-2.4">
            <p id="section-3.3-2.4.1">3rd-Level (host-to-host). These keys are derived from the second level host-to-AS, DRKeys.
Depending on the protocol type, we observe two cases:<a href="#section-3.3-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3-2.4.2.1">Standard protocol p: the PRF is keyed on the level 2 host-to-AS drkey:
<code>K_{A:Ha-&gt;B:Hb}^p = PRF_{K_{A:Ha-&gt;B}^p}(Hb)</code><a href="#section-3.3-2.4.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-3.3-2.4.2.2">Non-standard, arbitrary protocol p: the PRF is keyed on the level 2 host-to-AS drkey:
<code>K_{A:Ha-&gt;B:Hb}^{*,p} = PRF_{K_{A:Ha-&gt;B}^{*,p}}(Hb)</code><a href="#section-3.3-2.4.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="key-establishment">
<section id="section-4">
      <h2 id="name-key-establishment">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-key-establishment" class="section-name selfRef">Key Establishment</a>
      </h2>
<p id="section-4-1">There are two types of key establishment: first level, and second or third level
key establishment, depending on the level of the key in the hierarchy.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="level1-establishment">
<section id="section-4.1">
        <h3 id="name-first-level-key-establishme">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-first-level-key-establishme" class="section-name selfRef">First Level Key Establishment</a>
        </h3>
<p id="section-4.1-1">Key exchange is offloaded to
the key servers deployed in each AS. The key servers are not only
responsible for first-level key establishment, they also derive
second-level keys and provide them to hosts within the same AS.
To exchange a first-level key, the key servers of corresponding
ASes perform the key exchange protocol. The key exchange is
initialized by key server KSb by sending the request:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-2">
<pre>
  req = A || B || val_time || TS || [p]
</pre><a href="#section-4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1-3">Where TS denotes a timestamp of the current time and val_time
specifies a point in time at which the requested key is valid. If an
optional protocol p is supplied, the protocol-specific first-level key
<code>K'_{A-&gt;B}^p</code> is requested, otherwise the general <code>K_{A-&gt;B}</code> is.
The requested key may not be valid at the time of request,
either because it already
expired or because it will become valid in the future. For example,
prefetching future keys allows for seamless transition to the new
key.
The request token is signed with B's private key to prove
authenticity of the request.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">Upon receiving the initial request, KSa checks the signature for
authenticity and the timestamp for expiration. If the request has
not yet expired, the key server KSa will reply with an encrypted
and signed first-level key derived from the local secret value SVa
or, if an optional protocol p was supplied in the request, SVa^p:<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-5">
<pre>
  key = PRF_{SVa}(B)
      or
  key = PRF_{SVa^p}(B)

  repl = {A || key}_{PK_B} || exp_time || TS
</pre><a href="#section-4.1-5" class="pilcrow">¶</a>
</div>
<p id="section-4.1-6">The term <code>{A || key}_{PK_B}</code> indicates that the concatenation of A with
the <code>key</code> is encrypted with asymmetric cryptography using B's public
key.
The reply token is signed with A's private key.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<p id="section-4.1-7">Once the requesting key server KSb has received the key, it shares it
among other local key servers to ensure a consistent view. Each key
server can now respond to queries by entities within the same AS
requesting second-level keys. Alternatively, the proposed first-level
key exchange protocol could also make use of TLS 1.3 with client
certificates to secure the key exchange.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1-8">All first-level keys for other ASes are prefetched such that
second-level keys can be derived without delay. However, on-demand key
exchange between ASes is also possible. For example, in case a key
server is missing a first-level key that is required for the derivation
of a second-level key, the key server initiates a key exchange. ASes
that contain a large number of end hosts benefit from prefetching
most first-level keys, as they are likely to communicate with a
large set of destination ASes. In today's Internet there exist around
68000 active ASes. Thus, setting up symmetric keys between all
entities requires minor effort and state.
To avoid explicit revocation, the shared keys are short-lived and
new keys are established frequently (e.g., daily). Subsequent key
exchanges to establish a new first-level key can use the current key
as a first line of defense to avoid signature-flooding attacks.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="second-or-third-level-key-establishment">
<section id="section-4.2">
        <h3 id="name-second-or-third-level-key-e">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-second-or-third-level-key-e" class="section-name selfRef">Second or Third Level Key Establishment</a>
        </h3>
<p id="section-4.2-1">End hosts request a second-level key from their local key server with
the following request format:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">format = {type, requestID, protocol, source, destination}<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">An end host Ha in AS A uses this format for issuing the following
request to its local key server KSa:<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2-4">
<pre>
  format || val_time || TS
</pre><a href="#section-4.2-4" class="pilcrow">¶</a>
</div>
<p id="section-4.2-5">It is assumed that this request and the reply are sent over a secure
channel.
Similar to the first-level key exchange,
val_time specifies a point in time at which the requested key is
valid. The key server only replies with a key to requests with a
valid timestamp and only if the querying host is authorized to use
the key. An authorized host must either be an end point of the
communication that is authenticated using the second-level key or
authorized separately by the AS.<a href="#section-4.2-5" class="pilcrow">¶</a></p>
<p id="section-4.2-6">If the end host requested a third level key, it must now be derived.
It is done so from the obtained second level key.<a href="#section-4.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-server-discovery">
<section id="section-4.3">
        <h3 id="name-key-server-discovery">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-key-server-discovery" class="section-name selfRef">Key Server Discovery</a>
        </h3>
<p id="section-4.3-1">When a key server wants to contact another key server in a remote
AS, it needs to know the IP address of the remote server.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">In the SCION architecture, the concept of service addresses can
be used to anycast to a key server in a specific AS.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">For the regular Internet, RPKI can be used, which connects
Internet resource information to a trust anchor.

As the deployment numbers of
RPKI are growing, the RPKI certificate can be extended
with the IP address of the key server (e.g., by encoding it into the
common name field or creating a separate extension).
Using this mechanism, each AS publishes a list of IP addresses
(or an IP anycast address) that is publicly accessible and shared by
all key servers. The routing infrastructure will direct the packets
to the topologically nearest key server. This mapping from an AS
identifier to an IP address is verifiable through RPKI to prevent
unauthorized announcements of key servers.
In case RPKI has not been fully deployed, key-server discovery
could also work using a DNS entry that maps a domain to IP
addresses of key servers.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-expiration">
<section id="section-4.4">
        <h3 id="name-key-expiration">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-key-expiration" class="section-name selfRef">Key Expiration</a>
        </h3>
<p id="section-4.4-1">Shared symmetric keys are short-lived (i.e., up to one day lifetime)
to avoid the additional complication of explicit key revocation.
However, letting all keys expire at the same time would lead to
peaks in key requests.
Such peaks are avoided by spreading out
key expiration, which in turn leads to spreading out the fetching
requests.
To this end, a deterministic mapping
offset (A, B) -&gt; [0, t) is introduced.
This function uniformly maps the AS identifiers of
the source in AS A and the destination in AS B to a range between
0 and the maximum lifetime t of SVa.
This mapping is computed using a (non-cryptographic) hash function:<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4-2">
<pre>
  offset(A,B) = H(A || B) mod t
</pre><a href="#section-4.4-2" class="pilcrow">¶</a>
</div>
<p id="section-4.4-3">The offset is then used to determine the validity period of a key by
determining the secret value SVa^j that is used to derive K_{A-&gt;B} at
the current sequence j as follows:<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4-4">
<pre>
  [ start(SVa^j) + offset(A, B) , start(SVa^j+1) + offset(A, B) )
</pre><a href="#section-4.4-4" class="pilcrow">¶</a>
</div>
<p id="section-4.4-5">I.e., depending on the destination B, the secret value SVa can be
different, even when chosen for the same point in time.<a href="#section-4.4-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="packet-authentication">
<section id="section-5">
      <h2 id="name-packet-authentication">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-packet-authentication" class="section-name selfRef">Packet Authentication</a>
      </h2>
<p id="section-5-1">The DRKey keys enable source authentication of every packet.
To send DRKey source authenticated packets from end host
Ha located in AS A to endhost Hb located in AS B,
end host Ha first obtains the second level key
K_{B:Hb-&gt;A}^p from the key server located in its AS A, KSa.
With it derives the third level key
K_{B:Hb-&gt;A:Ha}^p, which is used to authenticate.
For a packet pkt, the source Ha then calculates
the authentication tag by computing the MAC keyed on the third level
key K_{B:Hb-&gt;A:Ha}^p, over an immutable part of the packet pkt.
This immutable part of pkt can include parts of the layer-3 and
layer-4 headers, and optionally the layer-4 payload.
It is important to only include immutable fields as the
verification would otherwise fail at the destination.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">The packet received at the destination is used to determine the
source address Ha and source AS.<a href="#section-5-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-3.1">In SCION these are part of the regular header, thus no extra
information is needed other than the tag itself.<a href="#section-5-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-3.2">In the current internet, 4 bytes containing the AS ID, plus the
tag are added to the packet.<a href="#section-5-3.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-5-4">The destination Hb then derives or obtains the key K_{B:Hb-&gt;A:Ha}^p
and uses it with the same MAC function to recalculate the
authentication tag. The tag is then compared to the one present
in the packet.<a href="#section-5-4" class="pilcrow">¶</a></p>
<div id="high-speed-dns-authentication">
<section id="section-5.1">
        <h3 id="name-high-speed-dns-authenticati">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-high-speed-dns-authenticati" class="section-name selfRef">High-Speed DNS Authentication</a>
        </h3>
<p id="section-5.1-1">A protocol specific secret value is used SVb^p, with p = "DNS".
The level 1 key for a slow side A is derived
directly in the DNS server:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-2">
<pre>
  K_{B-&gt;A}^p = PRF_{SVb^p}(A)
</pre><a href="#section-5.1-2" class="pilcrow">¶</a>
</div>
<p id="section-5.1-3">This first level key is exchanged with other AS via the level 1 key
requests, as described in <a href="#level1-establishment" class="xref">Section 4.1</a>.
For a DNS query from a end host Ha, located in AS A,
to a DNS server located in AS B,
the first level key is derived as described above, and then the
second level key is derived:<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-4">
<pre>
  K_{B-&gt;A:Ha}^p = PRF_{K_{B-&gt;A}^p}(0 || Ha)
</pre><a href="#section-5.1-4" class="pilcrow">¶</a>
</div>
<p id="section-5.1-5">How to compute the authentication tag and obtain the AS ID is
described in <a href="#packet-authentication" class="xref">Section 5</a>.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="edns0-authentication-option">
<section id="section-5.2">
        <h3 id="name-edns0-authentication-option">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-edns0-authentication-option" class="section-name selfRef">EDNS(0) Authentication Option</a>
        </h3>
<p id="section-5.2-1">DRKey can use EDNS(0) to avoid breaking the existing DNS resolvers
and authoritative servers.
With a DRKey custom extension that includes the total query/response
length, the source AS number, a timestamp, and the per packet MAC.
The per-packet MAC for DNS queries and responses is computed 
the DNS header and all fields contained in the
extension.
Using the DRKey EDNS(0) option, packet authentication for every
DNS packet introduces 28 bytes of header overhead.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="deployment">
<section id="section-6">
      <h2 id="name-deployment">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-deployment" class="section-name selfRef">Deployment</a>
      </h2>
<p id="section-6-1">DRKey allows incremental deployment, as key servers could be gradually
deployed in each AS.
Already in the incremental deployment phase, DRKey prevents the
addresses of upgraded ASes from being spoofed at other upgraded
destination ASes. Early adopters can immediately profit from
DRKey's security properties.
Authenticating a packet requires packet modification either at
the end host, or at a network appliance such as a middlebox or border
router. Adding the MAC at the end host does not increase the
request size en-route.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">When updating end hosts is not
possible in the short-term, DRKey can be implemented
on a middlebox that computes a per-packet MAC and modifies applicable
bypassing packets.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">Packet verification at the destination
AS can be performed by a middlebox as well.
If a destination does not understand DRKey traffic, it could
fail to process this traffic.
In this case, the sending host contacts
its local key server and asks if the destination AS supports DRKey.
The key server might have previously derived second-level keys for
an end host in the corresponding AS or might forward the query
to a key server in the destination AS.
If an AS
supports DRKey, then it may deploy a middlebox that performs the
DRKey operations in case the end host does not support it.
This
will prevent sending authenticated traffic to a destination host that
does not support DRKey.
In the worst case, the end host could fall
back to legacy traffic.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">In case of operational failures (e.g., a single key server fails), the
end entity will try to contact another key server in the same AS.
If all key servers fail, the system could fall
back to the current system with unauthenticated traffic.<a href="#section-6-4" class="pilcrow">¶</a></p>
<div id="deployment-incentives">
<section id="section-6.1">
        <h3 id="name-deployment-incentives">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-deployment-incentives" class="section-name selfRef">Deployment Incentives</a>
        </h3>
<p id="section-6.1-1">Since DRKey can be deployed on commodity hardware and integrates well
with the current Internet
infrastructure, the deployment obstacle for DRKey is low.
DRKey traffic can be recognized
outside of ASes that have deployed DRKey and can thus be prioritized
by servers.
This means that even when relatively few companies deploy DRKey
to authenticate packets at their services (e.g., popular open DNS
resolvers of Google or Cloudflare), there are strong incentives for
ISPs to deploy DRKey and provide its services to their customers.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-server-latency">
<section id="section-6.2">
        <h3 id="name-key-server-latency">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-key-server-latency" class="section-name selfRef">Key-Server Latency</a>
        </h3>
<p id="section-6.2-1">The initial connection setup depends on
the latency of the connection between the client and the key server.
To lower latency, DRKey's key servers should be positioned in an AS at
a similar location as local DNS resolvers.
As even public resolvers
have an average query latency of less than 20 ms traversing
the Internet, it is expected that the latency of a local
key derivation will be in
the order of a few ms.
In most cases locally fetching a
key will result in a lower latency than a full round-trip between client
and server.
For ASes that are
geographically dispersed, multiple key servers may be deployed
(e.g., co-located with an access router or per point-of-presence).<a href="#section-6.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="network-mobility">
<section id="section-6.3">
        <h3 id="name-network-mobility">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-network-mobility" class="section-name selfRef">Network Mobility</a>
        </h3>
<p id="section-6.3-1">Network mobility allows entities to move
from one AS to another while maintaining communication sessions.
In DRKey, key derivations are based on the current location of
the entity in the Internet. Therefore, as soon as an entity moves to
another AS, it needs to contact the key server of the new AS and
fetch new second-level keys. Because local key derivation is fast
and the latency of obtaining a key is small, the overhead is minimal.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="lighning-filter-system-as-a-drkey-deployment">
<section id="section-6.4">
        <h3 id="name-lighning-filter-system-as-a">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-lighning-filter-system-as-a" class="section-name selfRef">Lighning Filter System as a DRKey Deployment</a>
        </h3>
<p id="section-6.4-1">The Lightning Filter (LF) mechanism is a novel system that is intended
to complement traditional firewalls by enabling cryptographically
authenticated traffic shaping, based on the autonomous system
of the source host of the traffic.
This reduces significantly the load on the traditional firewall
during denial-of-service attacks, and even allows LF to be
the only network defense mechanism for a specific sub-network,
e.g. by securing a DMZ that exposes external services to
untrusted networks.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<p id="section-6.4-2">The core principle of the LF system relies on DRKey, using the
high speed source authentication that DRKey enables. This way,
the system can authenticate each packet, assuring that it came
from the host it claimed to.<a href="#section-6.4-2" class="pilcrow">¶</a></p>
<p id="section-6.4-3">In case a breach is detected, the network administrators can immediately
add the host and/or the origin AS to a blacklist, preventing packets
originating there from reaching past the Lightning Filter.<a href="#section-6.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="drkey-and-trust-in-ases">
<section id="section-7.1">
        <h3 id="name-drkey-and-trust-in-ases">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-drkey-and-trust-in-ases" class="section-name selfRef">DRKey and Trust in ASes</a>
        </h3>
<p id="section-7.1-1">The keys provided by DRKey do
not provide full end-to-end authenticity or secrecy properties: The
source and destination ASes are able to derive the keys and could
thus perform an active attack.
This attack is limited to these two
ASes; active attacks by intermediate ASes are not possible.
DRKey always enables AS-level source authentication and host-level
source authentication under the additional assumption of an honest
source AS.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authentication-within-an-as">
<section id="section-7.2">
        <h3 id="name-authentication-within-an-as">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-authentication-within-an-as" class="section-name selfRef">Authentication within an AS</a>
        </h3>
<p id="section-7.2-1">To achieve secrecy as well as
end-host authentication for communication between end hosts
and key servers, an AS needs an intra-domain end-host and/or
user-authentication system.
Different authentication mechanisms based on the operational
environment are discussed:<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2-2.1">Authentication using TLS. In order to securely exchange second-level
DRKey keys between end hosts and key server, the end host
can establish a secure TLS channel to the key server. The identity
of the communicating parties is authenticated using public-key
cryptography for both the key server and the end host. Thus, the key
server can uniquely identify the end host and verify its legitimacy
to obtain a second-level key.<a href="#section-7.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.2">Deployment in ISPs. If the corresponding AS is an ISP, we assume
that they can identify their customers (e.g., terminal connection
number or router that has been deployed by the ISP). In this case,
only an attacker that is present at the customers local network can
gain access to learn keys.<a href="#section-7.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.3">Company / University. For ASes that are under the control of
companies or universities, login credentials or other local
authentication mechanisms can be used to identify the user. This gives
companies the ability to run their own web servers and have full
control over their key material.<a href="#section-7.2-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-2.4">Mobile Devices. For mobile devices such as smart phones that
are connected to the Internet through a mobile telecommunication
network, clients could be authenticated by the telecom provider, for
example using the International Mobile Equipment Identity (IMEI).<a href="#section-7.2-2.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="adversary-model">
<section id="section-7.3">
        <h3 id="name-adversary-model">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-adversary-model" class="section-name selfRef">Adversary Model</a>
        </h3>
<p id="section-7.3-1">The adversary can deviate from the protocol and
attempt to violate its security goals.
The Dolev-Yao model is assumed,
where the adversary can reside at arbitrary
locations within the network.
The adversary can passively eavesdrop on messages
and also actively tamper with the communication by injecting,
dropping, delaying, or altering packets.
However, the adversary
has no efficient way of breaking cryptographic primitives such as
signatures, pseudorandom functions (PRFs), and message authentication
codes (MACs).
It is assumed that there exists
a secure channel between end hosts and a key server within the
same AS.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2">Assuming the mentioned
capabilities, the goal of the adversary is to obtain cryptographic
keys of other parties to forge authenticated messages.
By compromising an entity, the adversary learns all cryptographic
keys and settings stored.
The adversary can also control how the
entity behaves, including fabrication, replay, and modification of
packets.
Both end hosts and network nodes compromises are considered.<a href="#section-7.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-8-1">This document has no IANA actions.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Juan A. Garcia-Pardo</span></div>
<div dir="auto" class="left"><span class="org">ETH Zuerich</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:juan.garcia@inf.ethz.ch" class="email">juan.garcia@inf.ethz.ch</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Cyrill Kraehenbuehl</span></div>
<div dir="auto" class="left"><span class="org">ETH Zuerich</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:cyrill.kraehenbuehl@inf.ethz.ch" class="email">cyrill.kraehenbuehl@inf.ethz.ch</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Benjamin Rothenberger</span></div>
<div dir="auto" class="left"><span class="org">ETH Zuerich</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:benjamin.rothenberger@inf.ethz.ch" class="email">benjamin.rothenberger@inf.ethz.ch</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Adrian Perrig</span></div>
<div dir="auto" class="left"><span class="org">ETH Zuerich</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:adrian.perrig@inf.ethz.ch" class="email">adrian.perrig@inf.ethz.ch</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
