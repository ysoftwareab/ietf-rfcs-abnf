ehlo           = "EHLO" SP ( Domain / address-literal ) CRLF
                  [[CREF80: [2821]Explained literal removed, here and
                  below, in 04d, 20070511, Issue 19 ]]

helo           = "HELO" SP Domain CRLF

ehlo-ok-rsp    = ( "250" SP Domain [ SP ehlo-greet ] CRLF )
                    [[CREF81: [2821]20050619 Mail from "Richard O.
                    Hammer" <ROHammer@EarthLink.net> 20031223.]]
                    [[CREF82: [2821]20080222 Tony Hansen -- remove extra
                    blank line]] / ( "250-" Domain [ SP ehlo-greet ]
                    CRLF
                    *( "250-" ehlo-line CRLF )
                    "250" SP ehlo-line CRLF )

ehlo-greet     = 1*(%d0-9 / %d11-12 / %d14-127)
                    [[CREF83: [2821]20080222 Tony Hansen -- remove extra
                    blank line]] ; string of any characters other than
                    CR or LF

ehlo-line      = ehlo-keyword *( SP ehlo-param )

ehlo-keyword   = (ALPHA / DIGIT) *(ALPHA / DIGIT / "-")
                    [[CREF84: [2821]20080222 Tony Hansen -- remove extra
                    blank line]] ; additional syntax of ehlo-params
                    depends on
                    ; ehlo-keyword

ehlo-param     = 1*(%d33-126)
                    [[CREF85: [2821]20080222 Tony Hansen -- remove extra
                    blank line]] ; any CHAR excluding <SP> and all
                    ; control characters (US-ASCII 0-31 and 127
                    ; inclusive)







mail = "MAIL FROM:" Reverse-path  [[CREF88: [2821]20050619 Per
                  Bruce Lilly, 20050228 - move the empty path
                  construction to the Reverse-path production.]]
                  [[CREF89: [2821]20080222 Tony Hansen -- add production
                  token]]
                  [SP Mail-parameters] CRLF









rcpt = "RCPT TO:" ( "<Postmaster@" Domain ">" / "<Postmaster>" /
                  Forward-path ) [SP Rcpt-parameters] CRLF [[CREF91:
                  [2821]20080222 Tony Hansen -- add production token]]

                  Note that, in a departure from the usual rules for
                  local-parts, the "Postmaster" string shown above is
                  treated as case-insensitive.

data = "DATA" CRLF





rset = "RSET" CRLF

vrfy = "VRFY" SP String CRLF [[CREF97: [2821]20080222 Tony Hansen
expn = "EXPN" SP String CRLF [[CREF98: [2821]20080222 Tony Hansen
help = "HELP" [ SP String ] CRLF [[CREF99: [2821]20080222 Tony
noop = "NOOP" [ SP String ] CRLF [[CREF101: [2821]20080222 Tony
quit = "QUIT" CRLF [[CREF104: [2821]20080222 Tony Hansen -- add
Reverse-path   = Path / "<>" [[CREF106: [2821]20050619 Per Bruce
                  Lilly, 20050228, to move the empty construction here.
                  Note that this fix is a bit different from the one he
                  suggested which would have removed "path" from the
                  reverse path construction.]]

Forward-path   = Path

Path           = "<" [ A-d-l ":" ] Mailbox ">"

A-d-l          = At-domain *( "," At-domain )
                  ; Note that this form, the so-called "source
                  ; route", MUST BE accepted, SHOULD NOT be
                  ; generated, and SHOULD be ignored.  [[CREF107:
                  [2821]Tony 20080213 #23]]

At-domain      = "@" Domain

Mail-parameters  = esmtp-param *(SP esmtp-param)

Rcpt-parameters  = esmtp-param *(SP esmtp-param)

esmtp-param    = esmtp-keyword ["=" esmtp-value]

esmtp-keyword  = (ALPHA / DIGIT) *(ALPHA / DIGIT / "-")

esmtp-value    = 1*(%d33-60 / %d62-126)
                  ; any CHAR excluding "=", SP, and control
                  ; characters.  If this string is an email address,
                  ; i.e., a Mailbox, then the "xtext" syntax [12]
                  ; SHOULD be used.  [[CREF108: [2821]20070413: -01
                  Issue 13.  Note use of reference here will require
                  some action if 2821ter is moved to full standard
                  before 3461 advances]]

Keyword        = Ldh-str

Argument       = Atom





Domain         = sub-domain *("." sub-domain) [[CREF109: [2821]
                  20050619 Email conversation w/ Frank Ellerman
                  2004.11.12.  Permit trailing period in domain names
                  (required by DNS spec) and mail to TLDs.  ( ( sub-
                  domain 1*("." sub-domain) ["."] ) / sub-domain "." )
                  Change pulled back out per messages from Ned Freed and
                  Yuri Inglikov 20060422]] [[CREF110: [2821]Syntax
                  simplified Tony 20080213 #23]]

sub-domain     = Let-dig [Ldh-str]

Let-dig        = ALPHA / DIGIT

Ldh-str        = *( ALPHA / DIGIT / "-" ) Let-dig

address-literal  = "[" ( IPv4-address-literal /
                  IPv6-address-literal /
                  General-address-literal ) "]"
                  ; See Section 4.1.3

Mailbox        = Local-part "@" ( Domain / address-literal )

Local-part     = Dot-string / Quoted-string
                  ; MAY be case-sensitive


Dot-string     = Atom *("."  Atom)

Atom           = 1*atext

Quoted-string  = DQUOTE 1*QcontentSMTP DQUOTE [[CREF111: [2821]
                  ...SMTP constructions added per email 20080104, Tony
                  20080213 #7a]]

QcontentSMTP   = qtextSMTP / quoted-pairSMTP

quoted-pairSMTP  = %d92 %d32-126
                  ; i.e., backslash followed by any ASCII
                  ; graphic (including itself) or SPace

qtextSMTP      = %d32-33 / %d35-91 / %d93-126
                  ; i.e., within a quoted string, any
                  ; ASCII graphic or space is permitted
                  ; without blackslash-quoting except
                  ; double-quote and the backslash itself.

String         = Atom / Quoted-string






IPv4-address-literal  = Snum 3("."  Snum)

IPv6-address-literal  = "IPv6:" IPv6-addr

General-address-literal  = Standardized-tag ":" 1*dcontent

Standardized-tag  = Ldh-str
                  ; Standardized-tag MUST be specified in a
                  ; Standards-Track RFC and registered with IANA
                  [[CREF114: [2821]reverted to 2821 form 20080707]]

dcontent       = %d33-90 / ; Printable US-ASCII
                  %d94-126 ; excl. "[", "\", "]"

Snum           = 1*3DIGIT
                  ; representing a decimal integer
                  ; value in the range 0 through 255

IPv6-addr      = 6( h16 ":" ) ls32
                  / "::" 5( h16 ":" ) ls32
                  / [ h16 ] "::" 4( h16 ":" ) ls32
                  / [ *1( h16 ":" ) h16 ] "::" 3( h16 ":" ) ls32
                  / [ *2( h16 ":" ) h16 ] "::" 2( h16 ":" ) ls32
                  / [ *3( h16 ":" ) h16 ] "::" h16 ":" ls32
                  / [ *4( h16 ":" ) h16 ] "::" ls32
                  / [ *5( h16 ":" ) h16 ] "::" h16
                  / [ *6( h16 ":" ) h16 ] "::"
                  ; This definition is consistent with the one for
                  ; URIs [47].

ls32           = ( h16 ":" h16 ) / IPv4address
                  ; least-significant 32 bits of address

h16            = 1*4HEXDIG
                  ; 16 bits of address represented in hexadecimal





                  [[CREF115: [5321bis](2821ter) 2821bis Last Call
                  comment]]

Greeting       = ( "220 " (Domain / address-literal)
                  [ SP textstring ] CRLF ) /





                  ( "220-" (Domain / address-literal)
                  [ SP textstring ] CRLF
                  *( "220-" [ textstring ] CRLF )
                  "220" [ SP textstring ] CRLF ) [[CREF125: [2821]Tony
                  Finch 20050415, Issue 15, continuation of Greeting]]
                  [[CREF126: [2821]Changed 'text' to 'textstring' and
                  added production for the latter, JcK 20080504]]

textstring     = 1*(%d09 / %d32-126) ; HT, SP, Printable US-ASCII

Reply-line     = *( Reply-code "-" [ textstring ] CRLF )
                  Reply-code [ SP textstring ] CRLF [[CREF127:
                  [2821]Tony Finch 20050405, Issue 15, allow for
                  continuation and add production for Reply-code]]

Reply-code     = %x32-35 %x30-35 %x30-39 [[CREF128: [2821]??? Frank
                  Ellerman suggests inserting changing "text" above to
                  "Reply-text" and inserting something like Reply-text =
                  1*VCHAR *( 1*WSP 1*VCHAR ) here.  20070405, but need
                  to define VCHAR if going to do so.]] [[CREF129:
                  [2821]Reply-code changed to %32... from %31...  as
                  part of 1yz removal, JcK 20070424]]

hangText="521"><domain> No mail service here.  [[CREF140:
Return-path-line  = "Return-Path:" FWS Reverse-path <CRLF>

Time-stamp-line  = "Received:" FWS Stamp <CRLF>







Stamp          = From-domain By-domain Opt-info [CFWS] [[CREF169:
                  [2821]20050619 Pete Resnick/ "Richard O.  Hammer"
                  <ROHammer@earthlink.net>, 20040222, here and below]]
                  ";"
                  FWS date-time
                  ; where "date-time" is as defined in RFC 5322 [11]
                  ; but the "obs-" forms, especially two-digit
                  ; years, are prohibited in SMTP and MUST NOT be used.

From-domain    = "FROM" FWS Extended-Domain

By-domain      = CFWS "BY" FWS Extended-Domain

Extended-Domain  = Domain /
                  ( Domain FWS "(" TCP-info ")" ) /
                  ( address-literal FWS "(" TCP-info ")" )

TCP-info       = address-literal / ( Domain FWS address-literal )
                  ; Information derived by server from TCP connection
                  ; not client EHLO.

Opt-info       = [Via] [With] [ID] [For]
                  [Additional-Registered-Clauses]
                  [[CREF170: [2821] JcK:20071015 - the additional-...
                  stuff, here and below, added per issue 37 and
                  discussion with Tony.]]

Via            = CFWS "VIA" FWS Link

With           = CFWS "WITH" FWS Protocol

ID             = CFWS "ID" FWS ( Atom / msg-id )
                  ; msg-id is defined in RFC 5322 [11] [[CREF171:
                  [2821]20050619: Should "string" be removed here,
                  leaving only "msg-id", which would be consistent with
                  5322?  Or is the additional flexibility needed for,
                  e.g., gateways ???  See Klensin/ Resnick/ Lilly
                  correspondence of 20010625]] [[CREF172: [2821]Decision
                  20070403, per note from Tony Hansen ("issue 5"):
                  changed "string" to "atom" in -02c ]]

For            = CFWS "FOR" FWS ( Path / Mailbox ) [[CREF173:
                  [2821]If more than one path or mailbox is really
                  permitted, be sure they are separated.  Per Brett
                  Watson <brett@ics.mq.edu.au> 20040304.  Syntax fixed
                  per Hari Hurtta 20070428.  JcK: Reduced to one path,
                  20071012, -05)]]






Additional-Registered-Clauses  = 1* (CFWS Atom FWS String)
                  [[CREF174: [5321bis] 5321 errata #1683, 20090215,
                  Roberto Javier Godoy, rjgodoy@fich.unl.edu.ar]]
                  [[CREF175: [2821] Tony 20071016: We *may* be asked to
                  change String to read something like: ( String / Path
                  / Mailbox / msg-id ) but I'll let people bring it up
                  on the list.  In particular, we can't really support a
                  modified uFor from smtp-ext without Path / Mailbox.]]
                  ; Additional standard clauses may be added in this
                  ; location by future standards and registration with
                  ; IANA.  SMTP servers SHOULD NOT use unregistered
                  ; names.  See Section 8.

Link           = "TCP" / Addtl-Link

Addtl-Link     = Atom
                  ; Additional standard names for links are
                  ; registered with the Internet Assigned Numbers
                  ; Authority (IANA).  "Via" is primarily of value
                  ; with non-Internet transports.  SMTP servers
                  ; SHOULD NOT use unregistered names.

Protocol       = "ESMTP" / "SMTP" / Attdl-Protocol

Addtl-Protocol = Atom
                  ; Additional standard names for protocols are
                  ; registered with the Internet Assigned Numbers
                  ; Authority (IANA) in the "mail parameters"
                  ; registry [9].  SMTP servers SHOULD NOT
                  ; use unregistered names.  [[CREF176: [2821] 6/19/2005
                  Indication of the parameter registry added after RFC
                  3848 was approved, but its keywords have not been
                  added here.  Explicit reference to 3848 added
                  20070401. ]]

