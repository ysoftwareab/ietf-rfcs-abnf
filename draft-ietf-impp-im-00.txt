

IMPP WG                                                       D. Crocker
Internet-Draft                                               Brandenburg
Expires: April 27, 2003                                      A. Diacakis
                                                             F. Mazzoldi
                                                                Net Proj
                                                              C. Huitema
                                                               Microsoft
                                                                G. Klyne
                                                               Baltimore
                                                            J. Rosenberg
                                                               R. Sparks
                                                             dynamicsoft
                                                               H. Sugano
                                                                 Fujitsu
                                                             J. Peterson
                                                                 NeuStar
                                                        October 27, 2002


                   Common Profile: Instant Messaging
                         draft-ietf-impp-im-00

Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at http://
   www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on April 27, 2003.

Copyright Notice

   Copyright (C) The Internet Society (2002).  All Rights Reserved.




Crocker, et al.          Expires April 27, 2003                 [Page 1]

Internet-Draft     Common Profile: Instant Messaging        October 2002


Abstract

   Instant messaging is defined in RFC2778 [12].  Today, numerous
   instant messaging protocols are in use, and little interoperability
   between services based on these protocols has been achieved.  This
   specification defines common semantics and data formats for instant
   messaging to facilitate the creation of gateways between instant
   messaging services.

Table of Contents

   1.    Introduction . . . . . . . . . . . . . . . . . . . . . . . .  3
   2.    Terminology  . . . . . . . . . . . . . . . . . . . . . . . .  3
   3.    Abstract Instant Messaging Service . . . . . . . . . . . . .  4
   3.1   Overview of Instant Messaging Service  . . . . . . . . . . .  4
   3.2   Identification of INSTANT INBOXes  . . . . . . . . . . . . .  5
   3.2.1 Address Resolution . . . . . . . . . . . . . . . . . . . . .  5
   3.3   Format of Instant Messages . . . . . . . . . . . . . . . . .  5
   3.4   The Messaging Service  . . . . . . . . . . . . . . . . . . .  5
   3.4.1 The Message Operation  . . . . . . . . . . . . . . . . . . .  5
   3.4.2 Looping  . . . . . . . . . . . . . . . . . . . . . . . . . .  6
   4.    Security Considerations  . . . . . . . . . . . . . . . . . .  7
   5.    IANA Considerations  . . . . . . . . . . . . . . . . . . . .  7
   5.1   The IM URI Scheme  . . . . . . . . . . . . . . . . . . . . .  7
         Authors' Addresses . . . . . . . . . . . . . . . . . . . . .  8
   A.    IM URL IANA Registration Template  . . . . . . . . . . . . . 10
   A.1   URL scheme name  . . . . . . . . . . . . . . . . . . . . . . 10
   A.2   URL scheme syntax  . . . . . . . . . . . . . . . . . . . . . 11
   A.3   Character encoding considerations  . . . . . . . . . . . . . 11
   A.4   Intended usage . . . . . . . . . . . . . . . . . . . . . . . 11
   A.5   Applications and/or protocols which use this URL scheme
         name . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11
   A.6   Interoperability considerations  . . . . . . . . . . . . . . 11
   A.7   Security considerations  . . . . . . . . . . . . . . . . . . 11
   A.8   Relevant publications  . . . . . . . . . . . . . . . . . . . 12
   A.9   Person & email address to contact for further information  . 12
   A.10  Author/Change controller . . . . . . . . . . . . . . . . . . 12
   A.11  Applications and/or protocols which use this URL scheme
         name . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12
   B.    Issues of Interest . . . . . . . . . . . . . . . . . . . . . 12
   B.1   Address Mapping  . . . . . . . . . . . . . . . . . . . . . . 12
   B.2   Source-Route Mapping . . . . . . . . . . . . . . . . . . . . 12
         References . . . . . . . . . . . . . . . . . . . . . . . . .  7
   C.    Acknowledgments  . . . . . . . . . . . . . . . . . . . . . . 13
         Full Copyright Statement . . . . . . . . . . . . . . . . . . 14






Crocker, et al.          Expires April 27, 2003                 [Page 2]

Internet-Draft     Common Profile: Instant Messaging        October 2002


1. Introduction

   Instant messaging is defined in RFC2778 [12].  Today, numerous
   instant messaging protocols are in use, and little interoperability
   between services based on these protocols has been achieved.  This
   specification defines semantics and data formats for common services
   of Instant Messaging to facilitate the creation of gateways between
   instant messaging services.

   Service behavior is described abstractly in terms of operations
   invoked between the consumer and provider of a service.  Accordingly,
   each IM service must specify how this behavior is mapped onto its own
   protocol interactions.  The choice of strategy is a local matter,
   providing that there is a clear relation between the abstract
   behaviors of the service (as specified in this memo) and how it is
   faithfully realized by a particular instant messaging service.

   The attributes for each operation are defined using an abstract
   syntax.  Although the syntax specifies the range of possible data
   values, each IM service must specify how well-formed instances of the
   abstract representation are encoded as a concrete series of bits.

   For example, one strategy might transmit an instant message as
   textual key/value pairs, another might use a compact binary
   representation, and a third might use nested containers.  The choice
   of strategy is a local matter, providing that there is a clear
   relation between the abstract syntax (as specified in this memo) and
   how it is faithfully encoded by an particular instant messaging
   service.

   In order to provide a means for the preservation of end-to-end
   features (especially security) to pass through instant messaging
   interoperability gateways, this specification also provides
   recommendations for instant messaging document formats that could be
   employed by presence protocols.

2. Terminology

   In this document, the key words "MUST", "MUST NOT", "REQUIRED",
   "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT
   RECOMMENDED", "MAY", and "OPTIONAL" are to be interpreted as
   described in RFC2119 [1] and indicate requirement levels for
   compliant implementations.

   This memos makes use of the vocabulary defined in RFC 2778[9].  Terms
   such as CLOSED, INSTANT INBOX, INSTANT MESSAGE, and OPEN are used in
   the same meaning as defined therein.




Crocker, et al.          Expires April 27, 2003                 [Page 3]

Internet-Draft     Common Profile: Instant Messaging        October 2002


   This document defines operations and attributes of an instant
   messaging service.  In order for a protocol to interface with an
   instant messaging gateway, it must support all of the operations
   described in this document (i.e.  the instant messaging protocol must
   have some message or capability that provides the function described
   by this operation).  Similarly, the attributes defined for these
   operations must correspond to information available in the instant
   messaging protocol in order for the protocol to interface with
   gateways defined by this specification.  Note that these attributes
   provide only the minimum possible information that needs to be
   specified for interoperability - the functions in an instant
   messaging protocol that correspond to the operations described in
   this document can contain additional information that will not be
   mapped by CPIM.

3. Abstract Instant Messaging Service

3.1 Overview of Instant Messaging Service

   When an application wants to send a message to an INSTANT INBOX, it
   invokes the message operation, e.g.,


   +-------+                    +-------+
   |       |                    |       |
   | appl. | -- message ------> |  IM   |
   |       |                    | svc.  |
   +-------+                    +-------+


   The message operation has the following attributes: source,
   destination, and TransID.  'source' and 'destination' identity the
   originator and destination of an instant message, respectively, and
   consist of an INSTANT INBOX identifier (as described in Section 3.2).
   The TransID is a unique identifier used to correlate message
   operations to response operations.

   The message operation also has some content, the instant message
   itself, which may be textual, or which may consist of other data.
   Some further information on content is provided in Section 3.3.

   Upon receiving a message operation, the service immediately responds
   by invoking the response operation containing the same transaction-
   identifier, e.g.,







Crocker, et al.          Expires April 27, 2003                 [Page 4]

Internet-Draft     Common Profile: Instant Messaging        October 2002


   +-------+                    +-------+
   |       |                    |       |
   | appl. | <----- response -- |  IM   |
   |       |                    |  svc. |
   +-------+                    +-------+


   The response operation contains the following attributes: TransID and
   status.  The TransID is used to correlate the response to a
   particular instant message.  Status indicates whether the delivery of
   the message succeeded or failed.

3.2 Identification of INSTANT INBOXes

   An INSTANT INBOX is specified using an instant messaging URI with the
   'im:' URI scheme.  The full syntax of the IM URI scheme is given in
   Appendix A.  An example would be: "im:fred@example.com"

3.2.1 Address Resolution

   A client determines the address of an appropriate system running a
   server by resolving the destination domain name that is part of the
   identifier to either an intermediate relay system or a final target
   system.

   Compliant implementations SHOULD follow the guidelines for
   dereferencing URIs given in [2].

3.3 Format of Instant Messages

   This specification defines an abstract interoperability mechanism for
   instant messaging protocols; the message content definition given
   here pertains to semantics rather than syntax.  However, some
   important properties for interoperability can only be provided if a
   common end-to-end format for instant messaging is employed by the
   interoperating instant messaging protocols.  Implementations
   therefore SHOULD support the format defined in MSGFMT [9].

3.4 The Messaging Service

   Note that the transaction-identifier parameters used with the instant
   messaging service are potentially long-lived.  Accordingly, the
   values generated for this parameter should be unique across a
   significant duration of time.

3.4.1 The Message Operation

   When an application wants to send an INSTANT MESSAGE, it invokes the



Crocker, et al.          Expires April 27, 2003                 [Page 5]

Internet-Draft     Common Profile: Instant Messaging        October 2002


   message operation.

   When the service is informed of the message operation, it performs
   these steps:

   1.  If the source or destination does not refer to a valid INSTANT
       INBOX, a response operation having status "failure" is invoked.

   2.  If access control does not permit the application to request this
       operation, a response operation having status "failure" is
       invoked.

   3.  Otherwise:

          If the service is able to successfully deliver the message, a
          response operation having status "success" is invoked.

          If the service is unable to successfully deliver the message,
          a response operation having status "failure" is invoked.

          If the service must delegate responsibility for delivery, and
          if the delegation will not result in a future authoritative
          indication to the service, a response operation having status
          "indeterminant" is invoked.

          If the service must delegate responsibility for delivery, and
          if the delegation will result in a future authoritative
          indication to the service, then a response operation is
          invoked immediately after the indication is received.

   When the service invokes the response operation, the transID
   parameter is identical to the value found in the message operation
   invoked by the application.

3.4.2 Looping

   The dynamic routing of instant messages can result in looping of a
   message through a relay.  Detection of loops is not always obvious,
   since aliasing and group list expansions can legitimately cause a
   message to pass through a relay more than one time.

   Instant messaging protocols may implement a hop counter or similar
   mechanism that gateways can use to detect loops, but CPIM does not
   require protocols to support any corresponding attribute.  If
   possible, CPIM gateways should translate between such loop-detection
   mechanisms.





Crocker, et al.          Expires April 27, 2003                 [Page 6]

Internet-Draft     Common Profile: Instant Messaging        October 2002


4. Security Considerations

   Detailed security considerations for instant messaging protocols are
   given in RFC2779 (in particular, requirements are given in section
   5.4 and some motivating discussion in 8.1).

   CPIM defines an interoperability function that is employed by
   gateways between instant messaging protocols.  CPIM gateways MUST be
   compliant with the minimum security requirements of the instant
   messaging protocols with which they interface.

   Note that end-to-end security properties (especially confidentiality
   and integrity) between instant messaging user agents that interface
   through a CPIM gateway can only be provided if a common instant
   message format (such as the format described in [9]) is supported by
   the protocols interfacing with the CPIM gateway.

5. IANA Considerations

   The IANA assigns the "im" scheme.

5.1 The IM URI Scheme

   The Instant Messaging (IM) URI scheme designates an Internet
   resource, namely an INSTANT INBOX.

   The syntax of an IM URL is given in Appendix A.

References

   [1]   Bradner, S., "Key words for use in RFCs to indicate requirement
         levels", RFC 2119, March 1997.

   [2]   Crocker, D., Diacakis, A., Mazzoldi, F., Huitema, C., Klyne,
         G., Rosenberg, J., Sparks, R., Sugano, H. and J. Peterson,
         "Address resolution for Instant Messaging and Presence", draft-
         ietf-impp-srv-00 (work in progress), October 2002.

   [3]   Crocker, D., "Standard for the format of ARPA Internet text
         Messages", RFC 822, STD 11, August 1982.

   [4]   Resnick, P., "Internet Message Format", RFC 2822, STD 11, April
         2001.

   [5]   Mockapetris, P., "Domain Names - Concepts and Facilities", RFC
         1034, STD 13, November 1987.

   [6]   Freed, N. and N. Borenstein, "Multipurpose Internet Mail



Crocker, et al.          Expires April 27, 2003                 [Page 7]

Internet-Draft     Common Profile: Instant Messaging        October 2002


         Extensions (MIME) Part One: Format of Internet Message Bodies",
         RFC 2045, November 1996.

   [7]   Callas, J., Donnerhacke, L., Finney, H. and R. Thayer, "OpenPGP
         Message Format", RFC 2440, November 1998.

   [8]   Klyne, G., "XML Coding of RFC822 Messages", draft-klyne-
         message-rfc822-xml-00 (work in progress), November 2001.

   [9]   Atkins, D. and G. Klyne, "Common Presence and Instant
         Messaging: Message Format", draft-ietf-impp-cpim-msgfmt-05
         (work in progress), December 2001.

   [10]  Sugano, H., "CPIM Presence Information Data Format", draft-
         ietf-impp-cpim-pidf-00 (work in progress), August 2001.

   [11]  Ramsdell, B., "S/MIME Version 3 Certificate Handlng", RFC 2632,
         June 1999.

   [12]  Day, M., Rosenberg, J. and H. Sugano, "A Model for Presence and
         Instant Messaging", RFC 2778, February 2000.

   [13]  Day, M., Aggarwal, S. and J. Vincent, "Instant Messaging /
         Presence Protocol Requirements", RFC 2779, February 2000.

   [14]  Gulbrandsen, A., Vixie, P. and L. Esibov, "A DNS RR for
         Specifying the Location of Services (SRV)", RFC 2782, February
         2000.

   [15]  Allocchio, C., "GSTN Address Element Extensions in Email
         Services", RFC 2846, June 2000.


Authors' Addresses

   Dave Crocker
   Brandenburg InternetWorking
   675 Spruce Drive
   Sunnyvale, CA  94086
   US

   Phone: +1 408/246-8253
   EMail: dcrocker@brandenburg.com








Crocker, et al.          Expires April 27, 2003                 [Page 8]

Internet-Draft     Common Profile: Instant Messaging        October 2002


   Athanassios Diacakis
   Network Projects Inc.
   4516 Henry Street
   Suite 113
   Pittsburgh, PA  15213
   US

   Phone: +1 412/681-6950 x202
   EMail: thanos@networkprojects.com


   Florencio Mazzoldi
   Network Projects Inc.
   4516 Henry Street
   Suite 113
   Pittsburgh, PA  15213
   US

   Phone: +1 412/681-6950
   EMail: flo@networkprojects.com


   Christian Huitema
   Microsoft Corporation
   One Microsoft Way
   Redmund, WA  98052-6399
   US

   EMail: huitema@microsoft.com


   Graham Klyne
   Baltimore Technologies
   1310 Waterside
   Arlington Business Park
   Theale, Reading  RG7 4SA
   UK

   Phone: +44 118 903 8000
   EMail: gk@acm.org











Crocker, et al.          Expires April 27, 2003                 [Page 9]

Internet-Draft     Common Profile: Instant Messaging        October 2002


   Jonathan Rosenberg
   dynamicsoft
   200 Executive Drive
   Suite 120
   West Orange, NJ  07052
   US

   EMail: jdrosen@dynamicsoft.com


   Robert Sparks
   dynamicsoft
   200 Executive Drive
   Suite 120
   West Orange, NJ  07052
   US

   EMail: rsparks@dynamicsoft.com


   Hiroyasu Sugano
   Fujitsu Laboratories Ltd.
   200 Executive Drive
   64 Nishiwaki, Ohkubo-cho
   Akashi  674-8555
   JP

   EMail: suga@flab.fujitsu.co.jp


   Jon Peterson
   NeuStar, Inc.
   1800 Sutter St
   Suite 570
   Concord, CA  94520
   US

   Phone: +1 925/363-8720
   EMail: jon.peterson@neustar.biz

Appendix A. IM URL IANA Registration Template

   This section provides the information to register the im: instant
   messaging URL.

A.1 URL scheme name

   im



Crocker, et al.          Expires April 27, 2003                [Page 10]

Internet-Draft     Common Profile: Instant Messaging        October 2002


A.2 URL scheme syntax

   The syntax follows the existing mailto: URL syntax specified in
   RFC2368.  The ABNF is:

   IM-URL         = "im:" [ to ] [ headers ]
   to             =  #mailbox
   headers        =  "?" header *( "&" header )
   header         =  hname "=" hvalue
   hname          =  *urlc
   hvalue         =  *urlc


A.3 Character encoding considerations

   Representation of non-ASCII character sets in local-part strings is
   limited to the standard methods provided as extensions to RFC 2822[1]

A.4 Intended usage

   Use of the im: URL follows closely usage of the mailto: URL.  That
   is, invocation of an IM URL will cause the user's instant messaging
   application to start, with destination address and message headers
   fill-in according to the information supplied in the URL.

A.5 Applications and/or protocols which use this URL scheme name

   It is anticipated that protocols compliant with RFC2779, and meeting
   the interoperability requirements specified here, will make use of
   this URL scheme name.

A.6 Interoperability considerations

   The underlying exchange protocol used to send an instant message may
   vary from service to service.  Therefore complete, Internet-scale
   interoperability cannot be guaranteed.  However, a service conforming
   to this specification permits gateways to achieve interoperability
   sufficient to the requirements of RFC2779.

A.7 Security considerations

   When IM URLs are placed in instant messaging protocols, they convey
   the identity of the sender and/or the recipient.  In some cases,
   anonymous messaging may be desired.  Such a capability is beyond the
   scope of this specification.






Crocker, et al.          Expires April 27, 2003                [Page 11]

Internet-Draft     Common Profile: Instant Messaging        October 2002


A.8 Relevant publications

   RFC2779, RFC2778

A.9 Person & email address to contact for further information

   Jon Peterson [mailto:jon.peterson@neustar.biz]

A.10  Author/Change controller

   This scheme is registered under the IETF tree.  As such, IETF
   maintains change control.

A.11  Applications and/or protocols which use this URL scheme name

   Instant messaging service

Appendix B. Issues of Interest

   This appendix briefly discusses issues that may be of interest when
   designing an interoperation gateway.

B.1 Address Mapping

   When mapping the service described in this memo, mappings that place
   special information into the im: address local-part MUST use the
   meta-syntax defined in RFC 2846[12].

B.2 Source-Route Mapping

   The easiest mapping technique is a form of source- routing and
   usually is the least friendly to humans having to type the string.
   Source-routing also has a history of operational problems.

   Use of source-routing for exchanges between different services is by
   a transformation that places the entire, original address string into
   the im: address local part and names the gateway in the domain part.

   For example, if the destination INSTANT INBOX is "pepp://example.com/
   fred", then, after performing the necessary character conversions,
   the resulting mapping is:

             im:pepp=example.com/fred@relay-domain

   where "relay-domain" is derived from local configuration information.

   Experience shows that it is vastly preferable to hide this mapping
   from end-users - if possible, the underlying software should perform



Crocker, et al.          Expires April 27, 2003                [Page 12]

Internet-Draft     Common Profile: Instant Messaging        October 2002


   the mapping automatically.

Appendix C. Acknowledgments
















































Crocker, et al.          Expires April 27, 2003                [Page 13]

Internet-Draft     Common Profile: Instant Messaging        October 2002


Full Copyright Statement

   Copyright (C) The Internet Society (2002).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.



















Crocker, et al.          Expires April 27, 2003                [Page 14]

