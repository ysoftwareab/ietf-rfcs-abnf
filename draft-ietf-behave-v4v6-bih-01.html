<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Dual Stack Hosts Using "Bump-in-the-Host" (BIH)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Dual Stack Hosts Using &quot;Bump-in-the-Host&quot; (BIH)">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Behave WG</td><td class="header">B. Huang</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">H. Deng</td></tr>
<tr><td class="header">Obsoletes: <a href='http://tools.ietf.org/html/rfc3338'>3338</a>, <a href='http://tools.ietf.org/html/rfc2767'>2767</a></td><td class="header">China Mobile</td></tr>
<tr><td class="header">(if&nbsp;approved)</td><td class="header">T. Savolainen</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Nokia</td></tr>
<tr><td class="header">Expires: April 22, 2011</td><td class="header">October 19, 2010</td></tr>
</table></td></tr></table>
<h1><br />Dual Stack Hosts Using "Bump-in-the-Host" (BIH)<br />draft-ietf-behave-v4v6-bih-01</h1>

<h3>Abstract</h3>

<p>This document describes the "Bump-In-the-Host" (BIH), a host based
      IPv4 to IPv6 protocol translation mechanism that allows a subset of applications
      supporting only IPv4 to communicate with peers that are 
      reachable only with IPv6. A host may be connected to IPv6-only
      or dual-stack access network. Essentially BIH makes the IPv4 
      applications think they talk to IPv4 peers and hence hides 
      the existence of IPv6 from those applications.
       
</p>
<p>     Acknowledgement of previous work
</p>
<p>     This document is an update to and directly derivative from 
   Kazuaki TSHUCHIYA, Hidemitsu HIGUCHI, and Yoshifumi ATARASHI [RFC2767] and 
   from Seungyun
   Lee, Myung-Ki Shin, Yong-Jin Kim, Alain Durand, and Erik Nordmark's
   [RFC3338], which similarly provides a dual stack host means to
   communicate with other IPv6 host using existing IPv4 appliations.
   This document combines and updates both [RFC2767] and [RFC3338].
</p>
<p>     The changes in this document reflect five components
          </p>
<blockquote class="text">
<p>       1. Supporting IPv6 only network connections 
</p>
<p>       2. IPv4 address pool use private address instead of the unassigned IPv4 addresses (0.0.0.1 - 0.0.0.255)
</p>
<p>       3. Extending ENR and address mapper to operate differently 
</p>
<p>       4. Adding an alternative way to implement the ENR 
</p>
<p>       5. Going for standards track instead of experimental/informational
</p>
</blockquote><p>     
        
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on April 22, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Components of the Bump-in-the-Host<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.</a>&nbsp;
Function Mapper<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.2.</a>&nbsp;
Translator<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.3.</a>&nbsp;
Extension Name Resolver<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.3.1.</a>&nbsp;
Reverse DNS lookup<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.4.</a>&nbsp;
Address Mapper<br />
<a href="#anchor8">3.</a>&nbsp;
Behavior and network Examples<br />
<a href="#anchor9">4.</a>&nbsp;
Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">4.1.</a>&nbsp;
Socket API Conversion<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">4.2.</a>&nbsp;
ICMP Message Handling<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">4.3.</a>&nbsp;
IPv4 Address Pool and Mapping Table<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">4.4.</a>&nbsp;
Multi-interface<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">4.5.</a>&nbsp;
Multicast<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">4.6.</a>&nbsp;
DNS cache<br />
<a href="#anchor16">5.</a>&nbsp;
Considerations due ALG requirements<br />
<a href="#anchor17">6.</a>&nbsp;
Security Considerations<br />
<a href="#anchor18">7.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#anchor21">Appendix&nbsp;A.</a>&nbsp;
Implementation option for the ENR<br />
<a href="#app-additional">Appendix&nbsp;B.</a>&nbsp;
API list intercepted by BIH<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>While IPv6 support is being widely introduced throughout the Internet, classes of
         applications are going to remain IPv4-only. This document describes a 
         Bump-in-the-Host (BIH), successor and combination of Bump-in-the-Stack (BIS) 
         <a class='info' href='#RFC2767'>[RFC2767]<span> (</span><span class='info'>Tsuchiya, K., HIGUCHI, H., and Y. Atarashi, &ldquo;Dual Stack Hosts using the &quot;Bump-In-the-Stack&quot; Technique (BIS),&rdquo; February&nbsp;2000.</span><span>)</span></a> and
         Bump-in-the-API (BIA) <a class='info' href='#RFC3338'>[RFC3338]<span> (</span><span class='info'>Lee, S., Shin, M-K., Kim, Y-J., Nordmark, E., and A. Durand, &ldquo;Dual Stack Hosts Using &quot;Bump-in-the-API&quot; (BIA),&rdquo; October&nbsp;2002.</span><span>)</span></a>
         technologies, which enables accommodation of significant set of the legacy IPv4-only
         applications in the IPv6-world.
</p>
<p>Bump-In-the-Host is not recommended to be used in double translation scenarios if the
         server is dual-stack enabled. The class of IPv4-only
         applications the described host-based protocol translation solution provides Internet
         connectivity over IPv6-only network access includes those applications that use DNS for IP address
         resolution and that do not embed IP address literals in protocol payloads. This includes essentially
         all DNS using legacy client-server model applications, which are agnostic on IP address family used by
         the destination, but not other classes of applications. The transition towards IPv6-only Internet
         is made easier by decreasing number of key applications that must be updated to IPv6.
</p>
<p>BIH technique includes two major implementation options: a protocol translator 
         between the IPv4 and the IPv6 stacks of
         a host or between the socket API module and the TCP/IP module. Essentially,
         IPv4 is translated into IPv6 at the socket API level or at the IP level.
</p>
<p>When the BIH is implemented at the socket API layer, and IPv4 applications
        communicate with IPv6 peers, the API translator intercepts the socket API
        functions from IPv4 applications and invokes the IPv6 
        socket API functions to communicate with the IPv6 hosts, and
        vice versa. 
</p>
<p>When the BIH is implemented at the networking layer, the IPv4 packets
        are intercepted and converted to IPv6 using the IP conversion mechanism
         defined in SIIT <a class='info' href='#I-D.ietf-behave-v6v4-xlate'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate]<span> (</span><span class='info'>Li, X., Bao, C., and F. Baker, &ldquo;IP/ICMP Translation Algorithm,&rdquo; September&nbsp;2010.</span><span>)</span></a>.
        The translation has the same benefits and drawbacks as SIIT.
</p>
<p>In order to support communication between IPv4
        applications and the target IPv6 peers, pooled IPv4
        addresses as defined in section 4.3 will be assigned through the extension name resolver.
</p>
<p>The BIH can be used whenever an IPv4-only application needs to 
        communicate with a peer reachable only with IPv6, independently of the
        address families supported by the access network. Hence the access network
        can be IPv6-only or dual-stack capable.
</p>
<p>In the case BIH enabled host has a possibility to choose between IPv4-only path or 
       path including IPv4 to IPv6 protocol translation, the host MUST select IPv4-only path.
       However, lacking IPv4-only path and on request BIH will attempt protocol translation also in the case a
       destination has IPv4 addresses in addition to IPv6.
</p>
<p>     
        The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> .
</p>
<p>     
        This document uses terms defined in <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a> , <a class='info' href='#RFC2893'>[RFC2893]<span> (</span><span class='info'>Gilligan, R. and E. Nordmark, &ldquo;Transition Mechanisms for IPv6 Hosts and Routers,&rdquo; August&nbsp;2000.</span><span>)</span></a> , 
        <a class='info' href='#RFC2767'>[RFC2767]<span> (</span><span class='info'>Tsuchiya, K., HIGUCHI, H., and Y. Atarashi, &ldquo;Dual Stack Hosts using the &quot;Bump-In-the-Stack&quot; Technique (BIS),&rdquo; February&nbsp;2000.</span><span>)</span></a> and <a class='info' href='#RFC3338'>[RFC3338]<span> (</span><span class='info'>Lee, S., Shin, M-K., Kim, Y-J., Nordmark, E., and A. Durand, &ldquo;Dual Stack Hosts Using &quot;Bump-in-the-API&quot; (BIA),&rdquo; October&nbsp;2002.</span><span>)</span></a>. 
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Components of the Bump-in-the-Host</h3>

<p>     
      Figure 1 shows the architecture of the host in which BIH is
      implemented as socket API layer translator, i.e. as the original 
      "Bump-in-the-API".
    
</p><br /><hr class="insert" />
<a name="fig1"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

               +----------------------------------------------+
               | +------------------------------------------+ |
               | |                                          | |
               | |            IPv4 applications             | |
               | |                                          | |
               | +------------------------------------------+ |
               | +------------------------------------------+ |
               | |           Socket API (IPv4, IPv6)        | |
               | +------------------------------------------+ |
               | +-[ API translator]------------------------+ |
               | | +-----------+ +---------+ +------------+ | |
               | | | Ext. Name | | Address | | Function   | | |
               | | | Resolver  | | Mapper  | | Mapper     | | |
               | | +-----------+ +---------+ +------------+ | |
               | +------------------------------------------+ |
               | +--------------------+ +-------------------+ |
               | |                    | |                   | |
               | |    TCP(UDP)/IPv4   | |   TCP(UDP)/IPv6   | |
               | |                    | |                   | |
               | +--------------------+ +-------------------+ |
               +----------------------------------------------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Architecture of the dual stack host using BIH at socket layer&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>     
      Figure 2 shows the architecture of the host in which BIH is
      implemented as network layer translator, i.e. as the original 
      "Bump-in-the-Stack".
    
</p><br /><hr class="insert" />
<a name="fig2"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     +-------------------------------------------------------------+
     |  +-------------------------------------------------------+  |
     |  | IPv4 applications                                     |  |
     |  +-------------------------------------------------------+  |
     |  +-------------------------------------------------------+  |
     |  | TCP/IPv4                                              |  |
     |  |   +---------------------------------------------------+  |
     |  |   |  +-----------+    +---------+  +---------------+     |
     |  |   |  | Extension |    | Address |  |  Translator   |     |
     |  |   |  | Name      |    | Mapper  |  +---------------+     |
     |  |   |  | Resolver  |    |         |  +---------------+     |
     |  |   |  |           |    |         |  |     IPv6      |     |
     |  +---+  +-----------+    +---------+  +---------------+     |
     |  +-------------------------------------------------------+  |
     |  |                  Network card drivers                 |  |
     |  +-------------------------------------------------------+  |
     +-------------------------------------------------------------+
     +-------------------------------------------------------------+
     |                        Network cards                        |
     +-------------------------------------------------------------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Architecture of the dual-stack host using BIH at network layer&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p> Dual stack hosts defined in RFC2893 <a class='info' href='#RFC2893'>[RFC2893]<span> (</span><span class='info'>Gilligan, R. and E. Nordmark, &ldquo;Transition Mechanisms for IPv6 Hosts and Routers,&rdquo; August&nbsp;2000.</span><span>)</span></a> need applications,
      TCP/IP modules and addresses for both IPv4 and IPv6. The proposed
      hosts in this document have an API or network layer translator to communicate with
      other IPv6 hosts using existing IPv4 applications.  The BIH translator
      consists of an extension name resolver, an address mapper, and depending on
      implementation either a function mapper or a protocol translator.
    
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Function Mapper</h3>

<p>     
         Function mapper translates an IPv4 socket API function into an IPv6 socket API
         function, and vice versa.
       
</p>
<p>     
         When detecting IPv4 socket API function calls from IPv4 applications,
         function mapper intercepts the function calls and invokes new IPv6 socket API
         functions which correspond to the IPv4 socket API functions.  Those
         IPv6 API functions are used to communicate with the target IPv6
         peers.  When detecting IPv6 socket API function calls triggered by the data
         received from the IPv6 peers, function mapper works symmetrically in relation to
         the previous case.
       
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Translator</h3>

<p>Translator translates IPv4 into IPv6 and vice versa using the IP conversion
          mechanism defined in SIIT <a class='info' href='#I-D.ietf-behave-v6v4-xlate'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate]<span> (</span><span class='info'>Li, X., Bao, C., and F. Baker, &ldquo;IP/ICMP Translation Algorithm,&rdquo; September&nbsp;2010.</span><span>)</span></a>.
       
</p>
<p>When receiving IPv4 packets from IPv4 applications, translator
          converts IPv4 packet headers into IPv6 packet headers, then, if
          required, fragments the IPv6 packets (because header length of IPv6
          is typically 20 bytes larger than that of IPv4), and sends them to
          IPv6 networks. When receiving IPv6 packets from the IPv6 networks,
          translator works symmetrically to the previous case, except that
          there is no need to fragment the packets.
       
</p>
<p>The translator module has to adjust transport protocol checksums
          when translating between IPv4 and IPv6. In the IPv6 to IPv4 direction
          the translator also has to calculate IPv4 header checksum.
       
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Extension Name Resolver</h3>

<p>     
         Extension Name Resolver returns a proper answer in response to the IPv4 
         application's name resolution request.
       
</p>
<p>     
         In the case of socket API implementation option, when an IPv4 application in
         an IPv6 only network tries to do forward lookup to resolve names via the resolver
         library (e.g. gethostbyname()), BIH intercept the function call and
         instead calls the IPv6 equivalent functions (e.g. getnameinfo()) that
         will resolve both A and AAAA records.
       
</p>
<p>     
         If only AAAA record is available for the name queried, ENR requests the
         address mapper to assign a local IPv4 address corresponding to the IPv6 address, 
         creates an A record for the assigned IPv4 address, and returns the A
         record to the IPv4 application.
       
</p>
<p>     
         If both A and AAAA record are available in the IPv6 only network, 
         ENR does not require address mapper to assign IPv4 address, but instead
         asks address mapper to store relationship between the A and AAAA records, 
         and then directly passes the received A record to the IPv4 application.         
         Note: this is a scenario where a host should use encapsulation instead to 
         avoid protocol translation taking place at a host.
       
</p>
<p>
         If only an A record is available it will be passed unmodified to the 
         application so that the application learns a record exists for the 
         destination. However, the application will not be able to use the 
         address for communications if the host is in IPv6-only access 
         network. If the application tries to send data to such an IPv4 address 
         destination unreachable/host unreachable error will be returned, which 
         allows application to behave accordingly.
       
</p><br /><hr class="insert" />
<a name="Table 1"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     Application | Network  | ENR behaviour
     query       | response |
     ------------+----------+---------------------
        A        |   A      |  &lt;return A record&gt;
        A        |   AAAA   |  &lt;synthesize A record&gt;
        A        |  A/AAAA  |  &lt;return A record&gt;
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: ENR behaviour illustration&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>NOTE: An implementation option is to have ENR support in host's
         (stub) DNS resolver itself as described in [DNS64], in which case
         record synthesis is not needed and advanced functions such as
         DNSSEC are possible. If the ENR is implemented at the network layer, same
         limitations arise as when DNS record synthesis is done on the network.
         A host also has an option to implement recursive DNS server function.
       
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.1"></a><h3>2.3.1.&nbsp;
Reverse DNS lookup</h3>

<p>When an application initiates a reverse DNS query for a PTR record (in-addr.arpa),
           to find a name for an IP address, the ENR MUST check whether the queried IP address
           can be found in the Address Mapper's mapping table and is a local IP address. If 
           an entry is found and the queried address is locally generated, the ENR must initiate 
           corresponding reverse DNS query for the real IPv6 address (ip6.arpa). In the case
           application requested reverse lookup for an address not part of the local IPv4 address
           pool, e.g. a global address, the request shall be forwarded unmodified to the network.
         
</p>
<p>For example, when an application initiates reverse DNS query for a synthesized
           locally valid IPv4 address, the ENR needs to intercept that query. The ENR will 
           ask the address mapper for the IPv6 address that corresponds to the IPv4 address. The
           ENR shall perform reverse lookup procedure for the destination's IPv6 address and return
           the name received as a response to the application that  initiated the IPv4 query.
         
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Address Mapper</h3>

<p>Address mapper ("the mapper" later on), maintains a local IPv4 address
         pool in the case of dual stack network and IPv6 only network. The
         pool consists of private IPv4 addresses as per section 4.3. Also, mapper
         maintains a table consisting of pairs of locally selected
         IPv4 addresses and destinationss' IPv6 addresses.
       
</p>
<p>     
         When the extension name resolver, translator, or the function mapper requests 
         mapper to assign an IPv4 address corresponding to an IPv6 address, mapper selects and
         returns an IPv4 address out of the local pool, and registers a new entry
         into the table.  The registration occurs in the following
         3 cases:
       
</p>
<p>     
         (1) When the extension name resolver gets only an 'AAAA' record for the target
         host name in the dual stack or IPv6 only network and 
         there is no existing mapping entry for the IPv6 address.
         A local IPv4 address will be returned to application and
         mapping for local IPv4 address to real IPv6 address is created.
       
</p>
<p>     
         (2) When the extension name resolver gets both an 'A' record and an 'AAAA' record 
         for the target host name in the IPv6 only network and 
         there is no existing apping entry for the IPv6 address. In this case
         local IPv4 address does not need to be selected, but mapping entry has to be created
         between IPv4 and IPv6 addresses from 'A' and 'AAAA' records. The IPv4 address will be
         returned to an application. Note: this is a scenario 
         where IPv4 communications, native or encapsulated, are preferred over translation.
       
</p>
<p>     
         (3) When the function mapper gets a socket API function call triggered by
         received IPv6 packet and there is no existing mapping entry for the IPv6
         source address (Editor's note: can this ever happen in case of client-server
         nature of BIH?).
       
</p>
<p>
        Other possible combinations are outside of BIH and BIH is not involved in those.
      
</p>
<p>NOTE: There is one exception. When initializing the table the mapper registers 
      a pair of its own IPv4 address and IPv6 address into the table.
     
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Behavior and network Examples</h3>

<p>Figure 4 illustrates the very basic network scenario. An IPv4-only
    application is running on a host attached to IPv6-only Internet and
    is talking to IPv6 enabled server. A communication is made possible
    by bump in the host.
</p>
<p>It is worth noting that while the IPv6 server may additionally have
    IPv4 addresses, those are unreachable for the host not having any
    direct IPv4 connectivity, and hence can be considered irrelevant.
</p><br /><hr class="insert" />
<a name="fig5"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  +----+                                   +-------------+
  | H1 |----------- IPv6 Internet -------- | IPv6 server |
  +----+                                   +-------------+
  v4 only
  application
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Network Scenario #1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>     
    Figure 5 illustrates a possible network scenario where an IPv4-only 
    application is running on a host attached to a dual-stack network,
    but the destination server is running on a private site that is
    numbered with public IPv6 addresses and private IPv4 addresses 
    without port forwarding setup on NAT44. The only means to contact
    to server is to use IPv6.
</p><br /><hr class="insert" />
<a name="fig6"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  +----------------------+  +------------------------------+
  | Dual Stack Internet  |  | IPv4 Private site (Net 10)   |
  |                      |  |                              |
  |                      |  |                 +----------+ |
  |                      |  |                 |          | |
  |  +----+           +---------+             |          | |
  |  | H1 |--------   |  NAT44  |-------------|  Server  | |
  |  +----+           +---------+             |          | |
  | v4 only              |  |                 +----------+ |
  | application          |  |                  Dual Stack  |
  |                      |  |                etc. 10.1.1.1 |
  |                      |  |                 AAAA:2009::1 |
  |                      |  |                              |
  +----------------------+  +------------------------------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: Network Scenario #2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
    Illustrations of host behavior in both implementation options are given here.
    Figure 6 illustrates the setup where BIH is implemented as a bump in the API, and
    figure 7 illustrates the setup where BIH is implemented as a bump in the stack.
    
</p><br /><hr class="insert" />
<a name="fig7"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
"dual stack"                                                "host6"
IPv4    Socket |     [ API Translator ]    | TCP(UDP)/IP          Name
appli-  API    | ENR      Address  Function| (v6/v4)             Server
cation         |          Mapper   Mapper  |
 |        |        |        |        |         |              |       |
&lt;&lt;Resolve an IPv4 address for "host6".&gt;&gt;       |              |       |
 |        |        |        |        |         |              |       |
 |--------|-------&gt;|  Query of 'A' records for host6.         |       |
 |        |        |        |        |         |              |       |
 |        |        |--------|--------|---------|--------------|------&gt;|
 |        |        |  Query of 'A' records and 'AAAA' for host6       |
 |        |        |        |        |         |              |       |
 |        |        |&lt;-------|--------|---------|--------------|-------|
 |        |        |  Reply with the 'AAAA' record.           |       |
 |        |        |        |        |         |              |
 |        |        |&lt;&lt;The 'AAAA' record is resolved.&gt;&gt;        |
 |        |        |        |        |         |              |
 |        |        |+++++++&gt;|  Request one IPv4 address       |
 |        |        |        |  corresponding to the IPv6 address.
 |        |        |        |        |         |              |
 |        |        |        |&lt;&lt;Assign one IPv4 address.&gt;&gt;     |
 |        |        |        |        |         |              |
 |        |        |&lt;+++++++|  Reply with the IPv4 address.   |
 |        |        |        |        |         |              |
 |        |        |&lt;&lt;Create 'A' record for the IPv4 address.&gt;&gt;
 |        |        |        |        |         |              |
 |&lt;-------|--------| Reply with the 'A' record.|              |
 |        |        |        |        |         |              |
 |        |        |        |        |         |              |
&lt;&lt;Call IPv4 Socket API function &gt;&gt;   |         |              |
 |        |        |        |        |         |              |
 |========|========|========|=======&gt;|An IPv4 Socket API function Call
 |        |        |        |        |         |              |
 |        |        |        |&lt;+++++++|  Request IPv6 addresses|
 |        |        |        |        |  corresponding to the  |
 |        |        |        |        |  IPv4 addresses.       |
 |        |        |        |        |         |              |
 |        |        |        |+++++++&gt;| Reply with the IPv6 addresses.
 |        |        |        |        |         |              |
 |        |        |        |        |&lt;&lt;Translate IPv4 into IPv6.&gt;&gt;
 |        |        |        |        |         |              |
 |  An IPv6 Socket API function call.|=========|=============&gt;|
 |        |        |        |        |         |              |
 |        |        |        |        |&lt;&lt;Reply an IPv6 data    |
 |        |        |        |        |  to dual stack.&gt;&gt;      |
 |        |        |        |        |         |              |
 |  An IPv6 Socket API function call.|&lt;========|==============|
 |        |        |        |        |         |              |
 |        |        |        |        |&lt;&lt;Translate IPv6 into IPv4.&gt;&gt;
 |        |        |        |        |         |              |
 |        |        |        |&lt;+++++++|  Request IPv4 addresses|
 |        |        |        |        |  corresponding to the  |
 |        |        |        |        |  IPv6 addresses.       |
 |        |        |        |        |         |              |
 |        |        |        |+++++++&gt;| Reply with the IPv4 addresses.
 |        |        |        |        |         |              |
 |&lt;=======|========|========|========|  An IPv4 Socket function call.
 |        |        |        |        |         |              |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: Example of BIH as API addition&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="fig8"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   "dual stack"                                            "host6"
   IPv4    TCP/    ENR     address  translator  IPv6
   appli-  IPv4            mapper
   cation
     |      |       |         |       |           |         |
   &lt;&lt;Resolve an IPv4 address for "host6".&gt;&gt;       |         |
     |      |       |         |       |           |         |
     |------|------&gt;|  Query of 'A' records for "host6".    | Name
     |      |       |         |       |           |         | Server
     |      |       |---------|-------|-----------|---------|---&gt;|
     |      |       |  Query of 'A' records and 'AAAA' for "host6"
     |      |       |         |       |           |         |    |
     |      |       |&lt;--------|-------|-----------|---------|----|
     |      |       |  Reply only with 'AAAA' record.       |
     |      |       |         |       |           |         |
     |      |       |&lt;&lt;Only 'AAAA' record is resolved.&gt;&gt;    |
     |      |       |         |       |           |         |
     |      |       |--------&gt;|  Request one IPv4 address   |
     |      |       |         |  corresponding to the IPv6 address.
     |      |       |         |       |           |         |
     |      |       |         |&lt;&lt;Assign one IPv4 address.&gt;&gt; |
     |      |       |         |       |           |         |
     |      |       |&lt;--------|  Reply with the IPv4 address.
     |      |       |         |       |           |         |
     |      |       |&lt;&lt;Create 'A' record for the IPv4 address.&gt;&gt;
     |      |       |         |       |           |         |
     |&lt;-----|-------|  Reply with the 'A' record. |         |
     |      |       |         |       |           |         |
     |      |       |         |       |           |         |
   &lt;&lt;Send an IPv4 packet to "host6".&gt;&gt;|           |         |
     |      |       |         |       |           |         |
     |======|=======|=========|======&gt;|  An IPv4 packet.    |
     |      |       |         |       |           |         |
     |      |       |         |&lt;------|  Request IPv6 addresses
     |      |       |         |       |  corresponding to the IPv4
     |      |       |         |       |  addresses.         |
     |      |       |         |       |           |         |
     |      |       |         |------&gt;|  Reply with the IPv6|
     |      |       |         |       |  addresses.         |
     |      |       |         |       |           |         |
     |      |       |         |       |&lt;&lt;Translate IPv4 into IPv6.&gt;&gt;
     |      |       |         |       |           |         |
     |      |       |An IPv6 packet.  |===========|========&gt;|
     |      |       |         |       |           |         |
     |      |       |         |     &lt;&lt;Reply an IPv6 packet to
     |      |       |         |       "dual stack".&gt;&gt;       |
     |      |       |         |       |           |         |
     |      |       |An IPv6 packet.  |&lt;==========|=========|
     |      |       |         |       |           |         |
     |      |       |         |       |&lt;&lt;Translate IPv6 into IPv4.&gt;&gt;
     |      |       |         |       |           |         |
     |&lt;=====|=======|=========|=======|  An IPv4 packet.    |
     |      |       |         |       |           |         |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: Example of BIH at network layer&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Considerations</h3>

<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Socket API Conversion</h3>

<p>
      IPv4 socket API functions are translated into semantically as same
      IPv6 socket API functions as possible and vice versa. See Appendix B for the API
      list intercepted by BIH. However, 
      IPv4 socket API functions are not fully compatible with IPv6 since the IPv6 has new advanced features.
     
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
ICMP Message Handling</h3>

<p>
      When an application needs ICMP messages values (e.g., Type, Code,
      etc.) sent from a network layer, ICMPv4 message values MAY be
      translated into ICMPv6 message values based on SIIT <a class='info' href='#I-D.ietf-behave-v6v4-xlate'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate]<span> (</span><span class='info'>Li, X., Bao, C., and F. Baker, &ldquo;IP/ICMP Translation Algorithm,&rdquo; September&nbsp;2010.</span><span>)</span></a>, and vice
      versa.  It can be implemented using raw socket.
     
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
IPv4 Address Pool and Mapping Table</h3>

<p>     
       The address pool consists of the private IPv4 addresses as per <a class='info' href='#RFC1918'>[RFC1918]<span> (</span><span class='info'>Rekhter, Y., Moskowitz, R., Karrenberg, D., Groot, G., and E. Lear, &ldquo;Address Allocation for Private Internets,&rdquo; February&nbsp;1996.</span><span>)</span></a>.
       This pool can be implemented at different
       granularity in the node e.g., a single pool per node, or at some
       finer granularity such as per user or per process.  However, if a
       number of IPv4 applications communicate with IPv6 hosts, the available address
       spaces may be exhausted.  As a result, it will be impossible for
       IPv4 applications to communicate with IPv6 nodes. It requires smart management
       techniques for address pool.  For example, it is desirable for the
       mapper to free the oldest entry and reuse the IPv4 address or IPv6
       address for creating a new entry.
       In case of a per-node address mapping table, it MAY cause a larger
       risk of running out of address.
     
</p>
<p>
       The RFC1918 address space was chosen because generally legacy
       applications understand that as a private address space. A new dedicated
       address space would run a risk of not being understood by applications as
       private. 127/8 or 169.254/16 are rejected due possible assumptions 
       applications may make when seeing those.
     
</p>
<p>
       The RFC1918 addresses have a risk of conflicting with other interfaces. The 
       conflicts can be mitigated by using least commonly used network number of the
       RFC1918 address space.  Addresses from 172.16/12 prefix are thought to be
       less likely to conflict than addresses from 10/8 or 192.168/16 spaces, hence 
       the used IPv4 addresses are following (Editor's comment: 
       this is first and almost random proposals):
     
</p>
<p>Source addresses: 172.21.112.0/30. Source address have to be
      allocated because applications use getsockname() calls and as in the BIS
      mode an IP address of the IPv4 interface has to be shown. More than
      one address is allocated to allow implementation flexibility, e.g. for
      cases where a host has multiple IPv6 interfaces. The source addresses
      are from different subnet than destination addresses to ensure applications 
      do not do on-link assumptions and do enable NAT traversal functions.
     
</p>
<p>Primary destination addresses: 172.21.80.0/20. Address mapper will
      select destination addresses primarily out of this pool.
     
</p>
<p>Secondary destination addresses: 10.170.160.0/20. Address mapper will
      select destination addresses out of this pool if the node has 
      dual-stack connection conflicting with primary destination addresses.
     
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Multi-interface</h3>

<p>
       In the case of dual-stack destinations BIH must do protocol 
       translation from IPv4 to IPv6 only when the host does not have any 
       IPv4 interfaces, native or tunneled, available for use.
     
</p>
<p>
       It is possible that an IPv4 interface is activated during BIH operation,
       for example if a node moves to a coverage area of IPv4
       enabled network. In such an event BIH must stop initiating protocol
       translation sessions for new connections and BIH may disconnect active sessions. 
       The choice of disconnection is left for implementatations and it may depend
       on whether IPv4 address conflict situation occurs between
       addresses used by BIH and addresses used by new IPv4 interface.
     
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Multicast</h3>

<p>
       Protocol translation for multicast is not supported. 
     
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
DNS cache</h3>

<p>
       When BIH module shuts down, e.g. due IPv4 interface becoming available, BIH must flush 
       node's DNS cache of possible locally generated entries.
     
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Considerations due ALG requirements</h3>

<p>	
        No ALG functionality is specified herein as ALG design is generally not encouraged
        for host based translation and as BIH is intended for applications not including IP 
	addresses in protocol payloads.
       
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>The security consideration of BIH mostly relies on that of <a class='info' href='#I-D.ietf-behave-v6v4-xlate-stateful'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate&#8209;stateful]<span> (</span><span class='info'>Bagnulo, M., Matthews, P., and I. Beijnum, &ldquo;Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers,&rdquo; July&nbsp;2010.</span><span>)</span></a>.
        
</p>
<p>In the socket layer implementation approach the differences are due to the
          address translation occurring at the API and not in the network layer.  
          That is, since the mechanism uses the API translator at the socket API level, 
          hosts can utilize the security of the network layer (e.g., IPSec) when they
          communicate with IPv6 hosts using IPv4 applications via the mechanism.  As well,
          there is no need for DNS ALG as in NAT-PT, so there is no interference with
          DNSSEC either.
        
</p>
<p>In the network layer implementation approach hosts cannot utilize the security
        above network layer when they communicate with IPv6 hosts using IPv4
        applications via BIH and encrypt embedded IP addresses, or when the
        protocol data is encrypted using IP addresses as keys. In these cases it is
        impossible for the mechanism to translate the IPv4 data into IPv6 and
        vice versa. Therefore it is highly desirable to upgrade to the
        applications modified into IPv6 for utilizing the security at
        communication with IPv6 hosts.
        
</p>
<p>
        The use of address pooling may open a denial of service attack
        vulnerability.  So BIH should employ the same sort of protection
        techniques as NAT64 <a class='info' href='#I-D.ietf-behave-v6v4-xlate-stateful'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate&#8209;stateful]<span> (</span><span class='info'>Bagnulo, M., Matthews, P., and I. Beijnum, &ldquo;Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers,&rdquo; July&nbsp;2010.</span><span>)</span></a> does.
        
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Acknowledgments</h3>

<p>The author thanks the discussion from Gang Chen, Dapeng Liu, Bo Zhou, 
        Hong Liu, Tao Sun, Zhen Cao, Feng Cao et al. in the development of this document.
</p>
<p>The efforts of Suresh Krishnan, Mohamed Boucadair, Yiu L. Lee, James Woodyatt, 
        Lorenzo Colitti, Qibo Niu, Pierrick Seite, Dean Cheng, Christian Vogt, Jan M. Melen, 
        and Ed Jankiewizh in reviewing this document are gratefully acknowledged.
</p>
<p>Advice from Dan Wing, Dave Thaler and Magnus Westerlund are greatly appreciated
</p>
<p>The authors of RFC2767 acknowledged WIDE Project, Kazuhiko YAMAMOTO, 
        Jun MURAI, Munechika SUMIKAWA, Ken WATANABE, and Takahisa MIYAMOTO. The authors
        of RFC3338 acknowledged implementation contributions by
        Wanjik Lee (wjlee@arang.miryang.ac.kr) and i2soft Corporation
        (www.i2soft.net).
</p>
<p>The authors of Bump-in-the-Wire (draft-ietf-biw-00.txt, October 2006), 
        P. Moster, L. Chin, and D. Green, are acknowledged. Few ideas and clarifications
        from BIW have been adapted to this document.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-v6v4-xlate">[I-D.ietf-behave-v6v4-xlate]</a></td>
<td class="author-text">Li, X., Bao, C., and F. Baker, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-xlate-23.txt">IP/ICMP Translation Algorithm</a>,&rdquo; draft-ietf-behave-v6v4-xlate-23 (work in progress), September&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-xlate-23.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-v6v4-xlate-stateful">[I-D.ietf-behave-v6v4-xlate-stateful]</a></td>
<td class="author-text">Bagnulo, M., Matthews, P., and I. Beijnum, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-xlate-stateful-12.txt">Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers</a>,&rdquo; draft-ietf-behave-v6v4-xlate-stateful-12 (work in progress), July&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-xlate-stateful-12.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1918">[RFC1918]</a></td>
<td class="author-text"><a href="mailto:yakov@cisco.com">Rekhter, Y.</a>, <a href="mailto:rgm3@is.chrysler.com">Moskowitz, R.</a>, <a href="mailto:Daniel.Karrenberg@ripe.net">Karrenberg, D.</a>, <a href="mailto:GeertJan.deGroot@ripe.net">Groot, G.</a>, and <a href="mailto:lear@sgi.com">E. Lear</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1918">Address Allocation for Private Internets</a>,&rdquo; BCP&nbsp;5, RFC&nbsp;1918, February&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc1918.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2460">[RFC2460]</a></td>
<td class="author-text"><a href="mailto:deering@cisco.com">Deering, S.</a> and <a href="mailto:hinden@iprg.nokia.com">R. Hinden</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>,&rdquo; RFC&nbsp;2460, December&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2460.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2460.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2460.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2767">[RFC2767]</a></td>
<td class="author-text"><a href="mailto:tsuchi@ebina.hitachi.co.jp">Tsuchiya, K.</a>, <a href="mailto:h-higuti@ebina.hitachi.co.jp">HIGUCHI, H.</a>, and <a href="mailto:atarashi@ebina.hitachi.co.jp">Y. Atarashi</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2767">Dual Stack Hosts using the "Bump-In-the-Stack" Technique (BIS)</a>,&rdquo; RFC&nbsp;2767, February&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2767.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2893">[RFC2893]</a></td>
<td class="author-text">Gilligan, R. and E. Nordmark, &ldquo;<a href="http://tools.ietf.org/html/rfc2893">Transition Mechanisms for IPv6 Hosts and Routers</a>,&rdquo; RFC&nbsp;2893, August&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2893.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3338">[RFC3338]</a></td>
<td class="author-text">Lee, S., Shin, M-K., Kim, Y-J., Nordmark, E., and A. Durand, &ldquo;<a href="http://tools.ietf.org/html/rfc3338">Dual Stack Hosts Using "Bump-in-the-API" (BIA)</a>,&rdquo; RFC&nbsp;3338, October&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3338.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2553">[RFC2553]</a></td>
<td class="author-text"><a href="mailto:gilligan@freegate.com">Gilligan, R.</a>, <a href="mailto:set@thumper.bellcore.com">Thomson, S.</a>, <a href="mailto:bound@zk3.dec.com">Bound, J.</a>, and <a href="mailto:rstevens@kohala.com">W. Stevens</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2553">Basic Socket Interface Extensions for IPv6</a>,&rdquo; RFC&nbsp;2553, March&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2553.txt">TXT</a>).</td></tr>
</table>

<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Implementation option for the ENR</h3>

<p>It is not necessary to implement the ENR at the kernel level, but it can be implemented instead
   at the user space by setting the host's default DNS server to point to 127.0.0.1. DNS queries would then always 
   be sent to the ENR, which furthermore ensures both A and AAAA queries are sent to the actual
   DNS server and A queries are always answered and required mappings created. 
</p>
<a name="app-additional"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
API list intercepted by BIH</h3>

<p>The following functions are the API list which SHOULD be intercepted
   by BIH module when implemented at socket layer.
   
</p>
<p>The functions that the application uses to pass addresses into the
   system are:

      </p>
<blockquote class="text">
<p>bind()
</p>
<p>connect()
</p>
<p>sendmsg()
</p>
<p>sendto()
</p>
</blockquote><p>
   
</p>
<p>The functions that return an address from the system to an
   application are:

      </p>
<blockquote class="text">
<p>accept()
</p>
<p>recvfrom()
</p>
<p>recvmsg()
</p>
<p>getpeername()
</p>
<p>getsockname()
</p>
</blockquote><p>
   
</p>
<p>The functions that are related to socket options are:

      </p>
<blockquote class="text">
<p>getsocketopt()
</p>
<p>setsocketopt()
</p>
</blockquote><p>
   
</p>
<p>The functions that are used for conversion of IP addresses embedded
   in application layer protocol (e.g., FTP, DNS, etc.) are:

      </p>
<blockquote class="text">
<p>recv()
</p>
<p>send()
</p>
<p>read()
</p>
<p>write()
</p>
</blockquote><p>
   
</p>
<p>As well, raw sockets for IPv4 and IPv6 MAY be intercepted.
</p>
<p>
   Most of the socket functions require a pointer to the socket address
   structure as an argument.  Each IPv4 argument is mapped into
   corresponding an IPv6 argument, and vice versa.
</p>
<p>According to <a class='info' href='#RFC2553'>[RFC2553]<span> (</span><span class='info'>Gilligan, R., Thomson, S., Bound, J., and W. Stevens, &ldquo;Basic Socket Interface Extensions for IPv6,&rdquo; March&nbsp;1999.</span><span>)</span></a>, the following new IPv6 basic APIs and
   structures are required.
</p><br /><hr class="insert" />
<a name="figappendix1"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      IPv4                     new IPv6
      ------------------------------------------------
      AF_INET                  AF_INET6
      sockaddr_in              sockaddr_in6
      gethostbyname()          getaddrinfo()
      gethostbyaddr()          getnameinfo()
      inet_ntoa()/inet_addr()  inet_pton()/inet_ntop()
      INADDR_ANY               in6addr_any
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>BIH MAY intercept inet_ntoa() and inet_addr() and use the address
   mapper for those.  Doing that enables BIH to support literal IP
   addresses.
</p>
<p>The gethostbyname() call return a list of addresses.  When the name
   resolver function invokes getaddrinfo() and  getaddrinfo() returns
   multiple IP addresses, whether IPv4 or IPv6, they SHOULD all be
   represented in the addresses returned by gethostbyname().  Thus if
   getaddrinfo() returns multiple IPv6 addresses, this implies that
   multiple address mappings will be created; one for each IPv6 address.
   
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bill Huang</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China Mobile</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">53A,Xibianmennei Ave.,</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Xuanwu District,</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing  100053</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:bill.huang@chinamobile.com">bill.huang@chinamobile.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hui Deng</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China Mobile</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">53A,Xibianmennei Ave.,</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Xuanwu District,</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing  100053</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:denghui02@gmail.com">denghui02@gmail.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Teemu Savolainen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hermiankatu 12 D</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">FI-33720 TAMPERE</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:teemu.savolainen@nokia.com">teemu.savolainen@nokia.com</a></td></tr>
</table>
</body></html>
