<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Multi-party Chat Using the Message Session Relay Protocol (MSRP)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Motivations and Requirements">
<link href="#rfc.section.4" rel="Chapter" title="4 Overview of Operation">
<link href="#rfc.section.5" rel="Chapter" title="5 Creating, Joining, and Deleting                      a Chat Room">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Creating a Chat Room">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Joining a Chat Room">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Deleting a Chat Room">
<link href="#rfc.section.6" rel="Chapter" title="6 Sending and Receiving Instant Messages">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Regular Messages">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Private Messages">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 MSRP reports and responses">
<link href="#rfc.section.7" rel="Chapter" title="7 Nicknames">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Using Nicknames within a Conference">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Modifying a Nickname">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Removing a Nickname">
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 Nicknames in Conference Event Packages">
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 Nicknames not supported nor allowed">
<link href="#rfc.section.8" rel="Chapter" title="8 The SDP 'chatroom' attribute">
<link href="#rfc.section.9" rel="Chapter" title="9 Examples">
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 Joining a chat room">
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 Setting up a nickname">
<link href="#rfc.section.9.3" rel="Chapter" title="9.3 Sending a regular message to the chat room">
<link href="#rfc.section.9.4" rel="Chapter" title="9.4 Sending a private message to a participant">
<link href="#rfc.section.9.5" rel="Chapter" title="9.5 Chuncked private message">
<link href="#rfc.section.9.6" rel="Chapter" title="9.6 Nickname in a conference information document">
<link href="#rfc.section.10" rel="Chapter" title="10 IANA Considerations">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 New MSRP Method">
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 New MSRP Header">
<link href="#rfc.section.10.3" rel="Chapter" title="10.3 New MSRP Status Codes">
<link href="#rfc.section.10.4" rel="Chapter" title="10.4 New SDP Attribute">
<link href="#rfc.section.11" rel="Chapter" title="11 Security Considerations">
<link href="#rfc.section.12" rel="Chapter" title="12 Contributors">
<link href="#rfc.section.13" rel="Chapter" title="13 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="14 References">
<link href="#rfc.references.1" rel="Chapter" title="14.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="14.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The Message Session Relay Protocol (MSRP) defines a mechanism for sending instant messages within a peer-to-peer session, negotiated using the Session Initiation Protocol (SIP) and the Session Description Protocol (SDP). This document defines the necessary tools for establishing multi-party chat sessions, or chat rooms, using MSRP." />
  <meta name="description" content="The Message Session Relay Protocol (MSRP) defines a mechanism for sending instant messages within a peer-to-peer session, negotiated using the Session Initiation Protocol (SIP) and the Session Description Protocol (SDP). This document defines the necessary tools for establishing multi-party chat sessions, or chat rooms, using MSRP." />
  <meta name="keywords" content="I-D, Internet-Draft, messaging, message sessions, multi-party" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">A. Niemi</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Nokia</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">M. Garcia-Martin</td>
</tr>
<tr>
<td class="left">Expires: September 08, 2011</td>
<td class="right">Ericsson</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">G.A. Sandbakken, Ed.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">TANDBERG</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">March 07, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Multi-party Chat Using the Message Session Relay Protocol (MSRP)<br />
  <span class="filename">draft-ietf-simple-chat-08</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The Message Session Relay Protocol (MSRP) defines a mechanism for sending instant messages within a peer-to-peer session, negotiated using the Session Initiation Protocol (SIP) and the Session Description Protocol (SDP). This document defines the necessary tools for establishing multi-party chat sessions, or chat rooms, using MSRP.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 08, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<p>This document may contain material from IETF Documents or IETF Contributions published or made publicly available before November 10, 2008.  The person(s) controlling the copyright in some of this material may not have granted the IETF Trust the right to allow modifications of such material outside the IETF Standards Process. Without obtaining an adequate license from the person(s) controlling the copyright in such materials, this document may not be modified outside the IETF Standards Process, and derivative works of it may not be created outside the IETF Standards Process, except to format it for publication as an RFC or to translate it into languages other than English.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Motivations and Requirements</a>
</li>
<li>4.   <a href="#rfc.section.4">Overview of Operation</a>
</li>
<li>5.   <a href="#rfc.section.5">Creating, Joining, and Deleting                      a Chat Room</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Creating a Chat Room</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Joining a Chat Room</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Deleting a Chat Room</a>
</li>
<li>6.   <a href="#rfc.section.6">Sending and Receiving Instant Messages</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Regular Messages</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Private Messages</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">MSRP reports and responses</a>
</li>
<li>7.   <a href="#rfc.section.7">Nicknames</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">Using Nicknames within a Conference</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">Modifying a Nickname</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">Removing a Nickname</a>
</li>
<li>7.4.   <a href="#rfc.section.7.4">Nicknames in Conference Event Packages</a>
</li>
<li>7.5.   <a href="#rfc.section.7.5">Nicknames not supported nor allowed</a>
</li>
<li>8.   <a href="#rfc.section.8">The SDP 'chatroom' attribute</a>
</li>
<li>9.   <a href="#rfc.section.9">Examples</a>
</li>
<li>9.1.   <a href="#rfc.section.9.1">Joining a chat room</a>
</li>
<li>9.2.   <a href="#rfc.section.9.2">Setting up a nickname</a>
</li>
<li>9.3.   <a href="#rfc.section.9.3">Sending a regular message to the chat room</a>
</li>
<li>9.4.   <a href="#rfc.section.9.4">Sending a private message to a participant</a>
</li>
<li>9.5.   <a href="#rfc.section.9.5">Chuncked private message</a>
</li>
<li>9.6.   <a href="#rfc.section.9.6">Nickname in a conference information document</a>
</li>
<li>10.   <a href="#rfc.section.10">IANA Considerations</a>
</li>
<li>10.1.   <a href="#rfc.section.10.1">New MSRP Method</a>
</li>
<li>10.2.   <a href="#rfc.section.10.2">New MSRP Header</a>
</li>
<li>10.3.   <a href="#rfc.section.10.3">New MSRP Status Codes</a>
</li>
<li>10.4.   <a href="#rfc.section.10.4">New SDP Attribute</a>
</li>
<li>11.   <a href="#rfc.section.11">Security Considerations</a>
</li>
<li>12.   <a href="#rfc.section.12">Contributors</a>
</li>
<li>13.   <a href="#rfc.section.13">Acknowledgments</a>
</li>
<li>14.   <a href="#rfc.references">References</a>
</li>
<li>14.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>14.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">The <a href="#RFC4975">Message Session Relay Protocol (MSRP) </a> <cite title="NONE">[RFC4975]</cite> defines a mechanism for sending a series of instant messages within a session. The <a href="#RFC3261">Session Initiation Protocol (SIP)</a> <cite title="NONE">[RFC3261]</cite> in combination with the <a href="#RFC3264">Session Description Protocol (SDP)</a> <cite title="NONE">[RFC3264]</cite> allows for two peers to establish and manage such sessions.  </p>
<p id="rfc.section.1.p.2">In another application of SIP, a user agent can join in a multi-party conversation called a conference that is hosted by a specialized user agent called a focus <a href="#RFC4353">[RFC4353]</a>. Such a conference can naturally involve MSRP sessions.  It is the responsibility of an entity handling the media to relay instant messages received from one participant to the rest of the participants in the conference.  </p>
<p id="rfc.section.1.p.3">Several such systems already exist in the Internet. Participants in a chat room can be identified with a pseudonym or nickname, and decide whether their real identity is disclosed to other participants. Participants can also use a rich set of features such as the ability to send private instant messages to other participants.  </p>
<p id="rfc.section.1.p.4">Similar conferences supporting chat rooms are already available today.  For example, <a href="#RFC2810">Internet Relay Chat (IRC)</a> <cite title="NONE">[RFC2810]</cite>, <a href="#RFC3920">Extensible Messaging and Presence Protocol</a> <cite title="NONE">[RFC3920]</cite> based chat rooms, and many other proprietary systems provide chat room functionality. Specifying equivalent functionality for MSRP-based systems provides competitive features and enables interworking between the systems.  </p>
<p id="rfc.section.1.p.5">This document defines requirements, conventions, and extensions for providing private messages and nickname management in centralized conferences with MSRP. Participants in a chat room can be identified by a pseudonym, and decide if their real identity is disclosed to other participants. This memo uses the <a href="#RFC4353">SIP Conferencing Framework</a> <cite title="NONE">[RFC4353]</cite> as a design basis. It also aims to be compatible with the <a href="#RFC5239">A Framework for Centralized Conferencing</a> <cite title="NONE">[RFC5239]</cite>.  It is expected that future mechanisms will be developed for providing similar functionality in generic conferences, i.e., where the media is not only restricted to MSRP. The mechanisms described in this document provide a future compatible short-term solution for MSRP centralized conferences. </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119, BCP 14</a> <cite title="NONE">[RFC2119]</cite>, and indicate requirement levels for compliant implementations.</p>
<p id="rfc.section.2.p.2">This memo deals with tightly coupled SIP conferences defined in <a href="#RFC4353">SIP Conferencing Framework </a> <cite title="NONE">[RFC4353]</cite> and adopts the terminology from that document. In addition to that terminology, we introduce some new terms: </p>

<dl>
<dt>Nickname: </dt>
<dd style="margin-left: 8">a pseudonym or descriptive name associated to a participant. See <a href="#nicknames">Section 7</a> for details </dd>
<dt>Multi-party chat: </dt>
<dd style="margin-left: 8">an instance of a tightly coupled conference, in which the media exchanged between the participants consist of MSRP based instant messages. Also known as a chat room.</dd>
<dt>Chat Room: </dt>
<dd style="margin-left: 8">a synonym for a multi-party chat.</dd>
<dt>Chat Room URI: </dt>
<dd style="margin-left: 8">a URI that identifies a particular chat room, and is a synonym of a Conference URI defined in <a href="#RFC4353">RFC 4353 </a> <cite title="NONE">[RFC4353]</cite>.</dd>
<dt>Sender: </dt>
<dd style="margin-left: 8">the conference participant that originally created an instant message and sent it to the chat room for delivery.</dd>
<dt>Recipient: </dt>
<dd style="margin-left: 8">the destination conference participant(s). This defaults to the full conference participant list, minus the IM Sender.</dd>
<dt>MSRP switch: </dt>
<dd style="margin-left: 8">a media level entity that is a MSRP endpoint. It is a special MSRP endpoint that receives MSRP messages, and delivers them to the other conference participants. The MSRP switch has a similar role to a conference mixer with the exception that the MSRP switch does not actually "mix" together different input media streams; it merely relays the messages between participants.</dd>
<dt>Private Instant Message: </dt>
<dd style="margin-left: 8">an instant message sent in a chat room intended for a single participant.  A private IM is usually rendered distinctly from the rest of the IMs, indicating that the message was a private communication.  </dd>
<dt>Anonymous URI:</dt>
<dd style="margin-left: 8">a URI concealing the participant's SIP AOR from the other participants in the conference. The allocation of such a URI is out of scope of this specification.  An anonymous URI must be valid for the length of the conference, and will be utilized by the MSRP switch to forward messages to and from anonymous participants.  </dd>
<dt>Conference Event Package:</dt>
<dd style="margin-left: 8">a notification mechanism that allow conference participants to learn conference information including roster and state changes in a conference.  This would typically be <a href="#RFC4575">A Session Initiation Protocol (SIP) Event Package for Conference State</a> <cite title="NONE">[RFC4575]</cite> or <a href="#I-D.ietf-xcon-event-package">Conference Event Package Data Format Extension for Centralized Conferencing</a> <cite title="NONE">[I-D.ietf-xcon-event-package]</cite>.  </dd>
</dl>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#motivation" id="motivation">Motivations and Requirements</a>
</h1>
<p id="rfc.section.3.p.1">Although conference frameworks describing many types of conferencing applications already exist, such as the <a href="#RFC5239">Framework for Centralized Conferencing</a> <cite title="NONE">[RFC5239]</cite> and the <a href="#RFC4353">SIP Conferencing Framework</a> <cite title="NONE">[RFC4353]</cite>, the exact details of session-based instant messaging conferences are not well-defined at the moment.  </p>
<p id="rfc.section.3.p.2">To allow interoperable chat implementations, for both conference-aware, and conference-unaware user agents, certain conventions for MSRP conferences need to be defined. It also seems beneficial to provide a set of features that enhance the baseline multi-party MSRP in order to be able to create systems that have functionality on par with existing chat systems, as well as enable building interworking gateways to these existing chat systems.  </p>
<p id="rfc.section.3.p.3">We define the following requirements:</p>
<p></p>

<dl>
<dt>REQ-1 :</dt>
<dd>A basic requirement is the existence of a multi-party conference, where participants can join and leave the conference and get instant messages exchanged to the rest of the participants.  </dd>
<dt>REQ-2 :</dt>
<dd>A conference participant must be able to determine the identities of the sender and recipient of the received IMs.  </dd>
<dt>REQ-3 :</dt>
<dd>A conference participant must be able to determine the recipient of the received message. For instance, the recipient of the message might be the entire conference or a single participant of the conference (i.e., a private message).  </dd>
<dt>REQ-4 :</dt>
<dd>It must be possible to send a message to a single participant within the conference (i.e., a private instant message).  </dd>
<dt>REQ-5 :</dt>
<dd>A conference participant may have a nickname or pseudonym associated with their real identity.  </dd>
<dt>REQ-6 :</dt>
<dd>It must be possible for a participant to change their nickname during the progress of the conference.  </dd>
<dt>REQ-7 :</dt>
<dd>It must be possible that a participant is only known by an anonymous identity and not their real identity to the rest of the conference.  </dd>
<dt>REQ-8 :</dt>
<dd>It must be possible for the MSRP switch to originate IMs to the conference as an owner or administrator (e.g. message of the day, welcome messages, server is shutting down, etc.) </dd>
<dt>REQ-9 :</dt>
<dd>It must be possible for the conference participants to learn the chat room capabilities described in this document.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#overview" id="overview">Overview of Operation</a>
</h1>
<p id="rfc.section.4.p.1">In order to set up a conference, one must first be created. Users wishing to host a conference themselves can of course do just that; their User Agent (UA) simply morphs from an ordinary UA into a special purpose one called a Focus UA.  Another, commonly used setup is one where a dedicated node in the network functions as a Focus UA.  </p>
<p id="rfc.section.4.p.2">Each chat room has an identity of its own: a SIP URI that participants use to join the conference, e.g. by sending an INVITE request. The conference focus processes the invitations, and as such, maintains SIP dialogs with each participant. In a multi-party chat, or chat room, MSRP is one of the established media streams. Each conference participant establishes an MSRP session with the MSRP switch, which is a special purpose MSRP application. The MSRP sessions can be relayed by one or more MSRP relays, which are specified in <a href="#RFC4976">RFC 4976</a> <cite title="NONE">[RFC4976]</cite>.  This is illustrated in <a href="#scenario">Figure 1</a> </p>
<div id="#rfc.figure.1"></div>
<div id="#scenario"></div>
<pre>
                    
                               MSRP Sessions                    
                       +---------------------------+             
                       |           +-----------+   |             
                   +---+--+    +---+--+        |   |             
                   | SIP  |    | SIP  |        |   |             
                   | MSRP |    | MSRP |     +--+---+----+        
                   |Client|    |Client|     |  MSRP     |        
                   +---+--+    ++-----+     |  Relay    |         
                       |        |           +-----+-----+         
           SIP Dialogs |       /                  |              
                       |      |                   | MSRP Sessions 
                  +----+------+--+                |               
                  | Conference   |        +-------+-----+         
                  | Focus UA     |        |    MSRP     |         
                  |              |........|   Switch    |         
                  |              |        |             |         
                  +---+--------+-+        +-------+-----+         
                      |        \                  |               
          SIP Dialogs |         |                 |  MSRP Sessions
                      |         \                 |              
                   +--+---+    +-+----+     +-----+------+       
                   | SIP  |    | SIP  |     |   MSRP     |
                   | MSRP |    | MSRP |     |   Relay    |
                   |Client|    |Client|     +-+-------+--+
                   +---+--+    +--+---+       |       |
                       |          +-----------+       |
                       +------------------------------+
                                  MSRP sessions

	</pre>
<p id="rfc.section.4.p.3">The MSRP switch is similar to a conference mixer in that it handles media sessions with each of the participants and bridges these streams together. However, unlike a conference mixer, the MSRP switch merely forwards messages between participants but doesn't actually mix the streams in any way. The system is illustrated in <a href="#arch">Figure 2</a>.  </p>
<div id="#rfc.figure.2"></div>
<div id="#arch"></div>
<pre>
                            +------+
                            | MSRP |
                            |Client|
          +------+          +--.---+          +------+
          | MSRP |             |              | MSRP |
          |Client|             |             _|Client|
          +------._            |           ,' +------+
                   `._         |         ,'
                      `.. +----------+ ,'
                         `|          |'
                          |   MSRP   |
                          |  Switch  |
                         ,|          |_
                    _,-'' +----------+ ``-._
          +------.-'            |           `--+------+
          | MSRP |              |              | MSRP |
          |Client|              |              |Client|
          +------+              |              +------+
                            +---'--+
                            | MSRP |
                            |Client|
                            +------+
	</pre>
<p id="rfc.section.4.p.4">Typically conference participants also subscribe to a conference event package to gather information about the conference roster in the form of conference state notifications.  For example, participants can learn about other participants' identities.  </p>
<p id="rfc.section.4.p.5">All messages in the chat room use the <a href="#RFC3862">'Message/CPIM' wrapper content type</a> <cite title="NONE">[RFC3862]</cite>, so that it is possible to distinguish between private and regular messages. When a participant wants to send an instant message to the conference, it constructs an MSRP SEND request and submits it to the MSRP switch including a regular payload (e.g. a Message/CPIM message that contains a text, HTML, an image, etc.). The Message/CPIM To header is set to the chat room URI. The switch then fans out the SEND request to all of the other participants using their existing MSRP sessions.  </p>
<p id="rfc.section.4.p.6">A participant can also send a private instant message addressed to a participant whose identity has been learned, e.g. via a conference event packages&gt;.  In this case the sender creates an MSRP SEND request with a Message/CPIM body whose To header contains not the chat room URI but the recipient's URI. The MSRP switch then forwards the SEND request to the recipient. This specification supports the sending of private messages to one and only one recipient. However, if the recipient is logged from different endpoints, the MSRP switch will distribute the private message to each endpoint the recipient is logged.  </p>
<p id="rfc.section.4.p.7">We extend the current MSRP negotiation that takes place in <a href="#RFC4566">SDP </a> <cite title="NONE">[RFC4566]</cite> to allow participants to learn whether the chat room supports and is willing to accept (e.g. due to local policy restrictions) certain MSRP functions defined in this memo, such as nicknames or private messaging.  </p>
<p id="rfc.section.4.p.8">Naturally, when a participant wishes to leave a chat room, it sends a SIP BYE request to the Focus UA and terminates the SIP dialog with the focus and MSRP sessions with the MSRP switch.  </p>
<p id="rfc.section.4.p.9">This document assumes that each chat room is allocated its own SIP URI. A user joining a chat room sends an INVITE request to that SIP URI, and as a result, a new MSRP session is established between the user and the MSRP switch. It is assumed that an MSRP session is mapped to a chat room. If a user wants to join a second chat room, he creates a different INVITE request, through a different SIP dialog, which leads to the creation of a second MSRP session between the user and the MSRP switch. Notice that these two MSRP sessions can still be multiplexed over the same TCP connection as per regular MSRP procedures. However,  each chat room is associated to a unique MSRP session and a unique SIP dialog.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#chatroom-management" id="chatroom-management">Creating, Joining, and Deleting                      a Chat Room</a>
</h1>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#creating" id="creating">Creating a Chat Room</a>
</h1>
<p id="rfc.section.5.1.p.1">Since we consider a chat room a particular type of conference having MSRP media, the methods defined by the <a href="#RFC4353">SIP Conference Framework </a> <cite title="NONE">[RFC4353]</cite> for creating conferences are directly applicable to a chat room.  </p>
<p id="rfc.section.5.1.p.2">Once a chat room is created, it is identified by a SIP URI, like any other conference.  </p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#joining" id="joining">Joining a Chat Room</a>
</h1>
<p id="rfc.section.5.2.p.1">Participants usually join the conference by sending an INVITE request to the conference URI. As long as the conference policy allows, the INVITE request is accepted by the focus and the user is brought into the conference.  </p>
<p id="rfc.section.5.2.p.2">The MSRP switch needs to be aware of the URIs of the participant (SIP, Tel, or IM URIs) in order to validate messages sent from this participant prior to their forwarding. This information is known to the focus of the conference. Therefore an interface between the focus and the MSRP switch is assumed. However, the interface between the focus and the MSRP switch is outside the scope of this document.  </p>
<p id="rfc.section.5.2.p.3">Conference aware participants will detect that the peer is a focus due to the presence of <a href="#RFC3840">the "isfocus" feature tag </a> <cite title="NONE">[RFC3840]</cite> in the Contact header field of the 200-class response to the INVITE request. Conference unaware participants will not notice it is a focus, and can not apply the additional mechanisms defined in this document.  Participants are also aware that the mixer is an MSRP switch due to the presence of an 'message' media type and either TCP/MSRP or TCP/TLS/MSRP as the protocol field in the <a href="#RFC4566">SDP</a> <cite title="NONE">[RFC4566]</cite> media-line.  </p>
<p id="rfc.section.5.2.p.4">The conference focus of a chat room MUST include support for a <a href="#RFC3862">Message/CPIM</a> <cite title="NONE">[RFC3862]</cite> top-level wrapper for the MSRP messages by setting the 'accept-types' MSRP media line attribute in the SDP offer or answer to include 'Message/CPIM'.  </p>
<p></p>

<ul class="empty"><li>Note that the 'Message/CPIM' wrapper is used to carry the sender information that, otherwise, it will not be available to the recipient. Additionally, 'Message/CPIM' wrapper carries the recipient information (e.g. To and Cc: headers).</li></ul>

<p> </p>
<p id="rfc.section.5.2.p.6">If a participant wants to remain anonymous to the rest of the participants in the conference, the participant's UA must provide an anonymous URI to the conference focus.  The URI will be used in the From and To headers in the 'Message/CPIM' wrapper, and can be learned by the other participants of the conference. Notice that in order for the anonymity mechanism to work, the anonymous URI must not reveal the participant's SIP AOR. The mechanism for acquiring an anonymous URI is outside the scope of this specification.  </p>
<p id="rfc.section.5.2.p.7">The conference focus of a chat room MUST learn the chat room capabilities of each participant that joins the chat room. The conference focus MUST inform the MSRP switch of such support in order to prevent the MSRP switch from distributing private messages to participants who do not support private messaging. The recipient would not be able to render the message as private, and any potential reply would be sent to the whole chat room.  </p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> Deleting a Chat Room</h1>
<p id="rfc.section.5.3.p.1">As with creating a conference, the methods defined by the <a href="#RFC4353">SIP Conference Framework</a> <cite title="NONE">[RFC4353]</cite> for deleting a conference are directly applicable to a chat room.  The MSRP switch will terminate the MSRP sessions with all the participants.  </p>
<p id="rfc.section.5.3.p.2">Deleting a chat room is an action that heavily depends on the policy of the chat room. The policy can determine that the chat room is deleted when the creator leaves the conference, or with any out of band mechanism.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#im" id="im">Sending and Receiving Instant Messages</a>
</h1>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#regular" id="regular">Regular Messages</a>
</h1>
<p id="rfc.section.6.1.p.1">This section describes the conventions used to send and receive instant messages that are addressed to all the participants in the chat room. These are sent over a regular MSRP SEND request that contains a <a href="#RFC3862">Message/CPIM wrapper </a> <cite title="NONE">[RFC3862]</cite> that in turn contains the desired payload (e.g. text, image, video-clip, etc.).  </p>
<p id="rfc.section.6.1.p.2">When a chat room participant wishes to send an instant message to all the other participants in the chat room, it constructs an MSRP SEND request according to the procedures specified in <a href="#RFC4975">RFC 4975</a> <cite title="NONE">[RFC4975]</cite>. The sender MAY choose the desired MSRP report model (e.g., populate the Success-Report and Failure-Report MSRP header fields).  </p>
<p id="rfc.section.6.1.p.3">The SEND request MUST contain a top-level wrapper of type 'Message/CPIM' according to <a href="#RFC3862">RFC 3862</a> <cite title="NONE">[RFC3862]</cite>. The actual instant message payload MUST be included as payload of the 'Message/CPIM' wrapper and MAY be of any type negotiated in the SDP 'accept-types' attribute according to the MSRP rules.  </p>
<p id="rfc.section.6.1.p.4">On sending a regular message the sender MUST populate the To header of the Message/CPIM wrapper with the URI of the chat room. The sender SHOULD populate the From header of the Message/CPIM wrapper with a proper identity by which the user is recognized in the conference. Identities that can be used (among others) are: </p>
<p></p>

<ul>
<li>A <a href="#RFC3261">SIP URI</a> <cite title="NONE">[RFC3261]</cite> representing the participant's address-of-record</li>
<li>A <a href="#RFC3966">tel URI</a> <cite title="NONE">[RFC3966]</cite> representing the participant's telephone number</li>
<li>An <a href="#RFC3860">IM URI</a> <cite title="NONE">[RFC3860]</cite> representing the participant's instant messaging address</li>
<li>An Anonymous URI representing the participant's anonymous address</li>
</ul>

<p> </p>
<p id="rfc.section.6.1.p.6">An MSRP switch that receives a SEND request from a participant SHOULD first verify that the From header field of the Message/CPIM wrapper is correctly populated with a valid URI of a participant. This imposes a requirement for the focus of the conference to inform the MSRP switch the URIs which the participant is known, in order for the MSRP switch to validate messages. <a href="#reports">Section 6.3</a> provides further information with the actions to be taken in case this validation fails.  </p>
<p id="rfc.section.6.1.p.7">If the MSRP switch receives a message containing several To header fields in the Message/CPIM wrapper the MSRP switch MUST reject the MSRP SEND request with a 403 response, as per procedures in <a href="#RFC4975">RFC 4975</a> <cite title="NONE">[RFC4975]</cite>.  </p>
<p id="rfc.section.6.1.p.8">Then the MSRP switch should inspect the To header field of the Message/CPIM wrapper. If the To header field of the Message/CPIM wrapper contains the chat room URI and there are no other To header fields, the MSRP switch can generate a copy of the SEND request to each of the participants in the conference except the sender. The MSRP switch MUST NOT modify the content received in the SEND request. However, the MSRP switch MAY re-chunk any of the outbound MSRP SEND requests.  </p>
<p id="rfc.section.6.1.p.9">Note that the MSRP switch does not need to wait for the reception of the complete MSRP chunk or MSRP message before it starts the distribution to the rest of the participants. Instead, once the MSRP switch has received the headers of the Message/CPIM body it SHOULD start the distribution process. Having the Message/CPIM header only in the first chunk, the MSRP switch MUST track the Message-Id until the last chunk of the message has been distributed.  </p>
<p id="rfc.section.6.1.p.10">An MSRP endpoint that receives a SEND request from the MSRP switch containing a Message/CPIM wrapper SHOULD first inspect the To header field of the Message/CPIM body. If the To header field is set to the chat room URI, it should render it as a regular message that has been distributed to all the participants in the conference. Then the MSRP endpoint SHOULD inspect the From header field of the Message/CPIM body to identify the sender. The From header field will include a URI that identifies the sender. The endpoint might have also received further identity information through a subscription to a conference event package.  </p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#private-messages" id="private-messages">Private Messages</a>
</h1>
<p id="rfc.section.6.2.p.1">This section describes the conventions used to send and receive private instant messages, i.e., instant messages that are addressed to one participant of the chat room rather to all of them. A chat room can signal support for private messages using the chatroom-attribute (see <a href="#chatroom-attribute">Section 8</a> for details).  </p>
<p id="rfc.section.6.2.p.2">When a chat room participant wishes to send a private instant message to a participant the chat room, it follows the same procedures for creating a SEND request as for <a href="#regular">regular messages </a> <cite title="NONE">[regular]</cite>.  The only difference is that the MSRP endpoint MUST populate a single To header of the Message/CPIM with the identity of the intended recipient.  The identity can be SIP, TEL, and IM URIs typically learned from the information received in notifications of a conference event package.  </p>
<p id="rfc.section.6.2.p.3">As for regular messages, an MSRP switch that receives a SEND request from a participant SHOULD first verify that the From header field of the Message/CPIM wrapper is correctly populated with a valid URI (i.e., the URI is a participant of this chat room). <a href="#reports">Section 6.3</a> provides further information with the actions to be taken in case this validation fails.  </p>
<p id="rfc.section.6.2.p.4">If the MSRP switch receives a message containing several To header fields in the Message/CPIM wrapper the MSRP switch MUST reject the MSRP SEND request with a 403 response, as per procedures in <a href="#RFC4975">RFC 4975</a> <cite title="NONE">[RFC4975]</cite>.  </p>
<p id="rfc.section.6.2.p.5">Then the MSRP switch MUST verify that the To header of the Message/CPIM wrapper is a participant of the chat room. If this To header field does not contain the URI of a participant of the chat room or if the To header field cannot be resolved (e.g., caused by a mistyped URI), the MSRP switch MUST reject the request with a 404 response. This new 404 status code indicates a failure to resolve the recipient URI in the To header field of the Message/CPIM wrapper.  </p>
<p></p>

<ul class="empty"><li>Notice the importance of the From and To headers in the Message/CPIM wrapper. If an intermediary modifies these values, the MSRP switch might not be able to identify the source or intended destination of the message, resulting in a rejection of the message.  </li></ul>

<p> </p>
<p id="rfc.section.6.2.p.7">Finally, the MSRP switch MUST verify that the recipient supports private messages. If the recipient does not support private messages, the MSRP switch MUST reject the request with a 428 response.  This new response 428 indicate that the recipient does not support private messages.  Any potential REPORT request that the MSRP switch sends to the sender MUST include a Message/CPIM wrapper containing the original From header field included in the SEND request and the To header field of the original Message/CPIM wrapper.  The MSRP switch MUST NOT forward private messages to a recipient that does not support private messaging.  </p>
<p id="rfc.section.6.2.p.8">If successful, the MSRP switch should search its mapping table to find the MSRP sessions established towards the recipient.  If a match is found the MSRP switch MUST create a SEND request and MUST copy the contents of the sender's message to it.  </p>
<p id="rfc.section.6.2.p.9">An MSRP endpoint that receives a SEND request from the MSRP switch does the same validations as for <a href="#regular">regular messages </a> <cite title="NONE">[regular]</cite>.  If the To header field is different from the chat room URI, the MSRP endpoints know that it is a private message.  It should render who it is from based on the From header of the Message/CPIM wrapper</p>
<p id="rfc.section.6.2.p.10">It is possible that a participant, identified by a SIP Address of Record or other valid URI, joins a conference of instant messages from two or more different SIP UAs. It is RECOMMENDED that the the MSRP switch can map a URI to two or more MSRP sessions.  If the policy of the server allows for this, the MSRP switch MUST copy all messages intended to the recipient through each MSRP session mapped to the recipient's URI.  </p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> <a href="#reports" id="reports">MSRP reports and responses</a>
</h1>
<p id="rfc.section.6.3.p.1">This section discusses the common procedures for regular and private messages with respect to MSRP reports and responses. Any particular procedure affecting only regular messages or only private messages is discussed in the previous <a href="#regular">Section 6.1</a> or <a href="#private-messages">Section 6.2</a>, respectively.  </p>
<p id="rfc.section.6.3.p.2">MSRP switches MUST follow the success report and failure report handling described in section 7 of <a href="#RFC4975">RFC 4975</a> <cite title="NONE">[RFC4975]</cite>, complemented with the procedures described in this section. The MSRP switch MUST act as am MSRP endpoint receiver of the request according to section 5.3 of <a href="#RFC4975">RFC 4975</a> <cite title="NONE">[RFC4975]</cite>.  </p>
<p id="rfc.section.6.3.p.3">If the MSRP switch receives an MSRP SEND request that does not contain a Message/CPIM wrapper, the MSRP switch MUST reject the request with a 415 response (specified in <a href="#RFC4975">RFC 4975</a> <cite title="NONE">[RFC4975]</cite>).  </p>
<p id="rfc.section.6.3.p.4">If the MSRP switch receives an MSRP SEND request where the URI included in the From header field of the Message/CPIM wrapper is not valid, (e.g, because it does not "belong" to the sender of the message or is not a valid participant of the chat room), the MSRP switch MUST reject the request with a 403 response. In non-error cases, the MSRP switch MUST construct responses according to section 7.2 of <a href="#RFC4975">RFC 4975</a> <cite title="NONE">[RFC4975]</cite>.  </p>
<p id="rfc.section.6.3.p.5">When the MSRP swtich forwards a SEND request,  it MAY use any report model in the copies intended for the recipients.  The receiver reports from the recipients MUST NOT be forwarded to the originator of the original SEND request.  This could lead to having the sender receiving multiple reports for a single MSRP request.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#nicknames" id="nicknames">Nicknames</a>
</h1>
<p id="rfc.section.7.p.1">A common characteristic of existing chat room services is that participants have the ability to present themselves with a nickname to the rest of the participants of the conference. It is used for easy reference of participants in the chat room, and can also provide anonymous participants with a meaningful descriptive name.  </p>
<p id="rfc.section.7.p.2">A nickname is a useful construct in many use cases, of which MSRP chat is but one example. It is associated with a URI of which the participant is known to the focus. It is a user selectable appearance of which the participant wants to be known to the other participants. It is not a 'display-name', but it is used somewhat like a display name.  A main difference is that a nickname is unique inside a chat room to allow an unambiguous reference to a participant in the chat.  Nicknames may be long lived, or may be temporary.  Users also need to reserve a nickname prior to its utilization.  </p>
<p id="rfc.section.7.p.3">This memo specifies the nickname as a string.  The nickname string MUST be unambiguous within the scope of the chat room (conference instance).  This scope is similar to having a nickname unique inside a chat room from <a href="#RFC3920">Extensible Messaging and Presence Protocol</a> <cite title="NONE">[RFC3920]</cite>. The chat room may have policies associated with nicknames.  It may not accept nickname strings at all, or a it may provide a wider unambiguous scope like a domain or server, similar to <a href="#RFC2810">Internet Relay Chat (IRC)</a> <cite title="NONE">[RFC2810]</cite>.  </p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#using-nicknames" id="using-nicknames">Using Nicknames within a Conference</a>
</h1>
<p id="rfc.section.7.1.p.1">This memo provides a mechanism to reserve a nickname for a participant for as long as the participant is logged into the chat room.  The mechanism is based on a NICKNAME MSRP method (see below) and a new "Use-Nickname" header. Note that other mechanisms may exist (for example, a web page reservation system), although they are outside the scope of this document.  </p>
<p id="rfc.section.7.1.p.2">A conference participant who has established an MSRP session with the MSRP switch, where the MSRP switch has indicated the support and availability of nicknames with the 'nicknames' token in the 'chatroom' SDP attribute, MAY send a NICKNAME request to the MSRP switch. The NICKNAME request MUST include a new Use&#8209;Nickname header that contains the nickname string that the participant wants to reserve. MSRP NICKNAME requests MUST NOT include Success-Report or Failure-Report header fields.  </p>
<p id="rfc.section.7.1.p.3">The MSRP switch that receives a NICKNAME request containing a nickname in the Use&#8209;Nickname header field SHOULD first verify whether the policy of the chat room allows the nickname functionality. If not allowed, the MSRP switch must reject the request with a 501 response, as per <a href="#RFC4975">RFC 4975</a> <cite title="NONE">[RFC4975]</cite>.  </p>
<p id="rfc.section.7.1.p.4">If the policy of the chat room allows the usage of nicknames, the MSRP switch SHOULD validate that the SIP AOR is entitled to reserve the nickname. The participant's authenticated identity can be derived after a successful SIP Digest Authentication, included in a trusted SIP P-Asserted-Identity header field, included in a valid SIP Identity header field, or derived from any other present or future SIP authentication mechanism.  Once the MSRP switch has validated that the participant is entitled to reserve the nickname, the MSRP switch MUST answer the NICKNAME request with a 200 response as per regular MSRP procedures.  </p>
<p id="rfc.section.7.1.p.5">The reservation of a nickname can fail, e.g. if the NICKNAME request contains a malformed or non-existent Use&#8209;Nickname header field, or if the same nickname has already been reserved by another participant in the conference. The validation can also fail where the sender of the message is not entitled to reserve the nickname. In any of these cases the MSRP switch MUST answer the NICKNAME request with a 423 response. The semantics of the 423 response are: "Nickname usage failed; the nickname is not allocated to this user".  </p>
<p id="rfc.section.7.1.p.6">As indicated earlier, this specification defines a new MSRP header field: "Use-Nickname". The Use&#8209;Nickname header field carries a nickname string, and SHOULD be included in the NICKNAME requests.  </p>
<p id="rfc.section.7.1.p.7">The syntax of the NICKNAME method and the "Use-Nickname" header field is built upon the <a href="#RFC4975">MSRP formal syntax </a> <cite title="NONE">[RFC4975]</cite> </p>
<div id="#rfc.figure.3"></div>
<pre>
            ext-method =/ NICKNAMEm
            NICKNAMEm = %x4E.49.43.4B.4E.41.4D.45 ; NICKNAME in caps
            ext-header =/ Use-Nickname
            ; ext-header is specified in RFC 4975
            Use-Nickname = "Use-Nickname" ":" nickname 
            nickname = quoted-string  
          </pre>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> <a href="#mod-nicknames" id="mod-nicknames">Modifying a Nickname</a>
</h1>
<p id="rfc.section.7.2.p.1">Typically participants will reserve nicknames as soon as they join the chat room. But it is also possible for participants to modify their own nicknames and replace them it a new one at any time during the duration of the MSRP session. Modification of the nickname is not different from the initial reservation and usage of a nickname, thus the NICKNAME method is used as described in <a href="#using-nicknames">Section 7.1</a>.</p>
<p id="rfc.section.7.2.p.2">If a NICKNAME request that attempts to modify the current nickname of the user for some reason fails, the current nickname stays in effect. A new nickname comes into effect and the old one is released only after a NICKNAME request is accepted with a 200 response.  </p>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> Removing a Nickname</h1>
<p id="rfc.section.7.3.p.1">If the participant no longer wants to be known by a nickname in the conference, the participant can follow the method described in <a href="#mod-nicknames">Section 7.2</a>.  The nickname element of the Use&#8209;Nickname header MUST be set to an empty quoted string.  </p>
<h1 id="rfc.section.7.4">
<a href="#rfc.section.7.4">7.4.</a> Nicknames in Conference Event Packages</h1>
<p id="rfc.section.7.4.p.1">Typically the conference focus acts as a notifier of the conference event package. To notify subscribers of the nickname reserved for a given participant, it is RECOMMENDED that conference focus support <a href="#I-D.ietf-xcon-event-package">Conference Event Package Data Format Extension for Centralized Conferencing </a> <cite title="NONE">[I-D.ietf-xcon-event-package]</cite>.  The <a href="#I-D.ietf-xcon-common-data-model">Conference Information Data Model for Centralized Conferencing </a> <cite title="NONE">[I-D.ietf-xcon-common-data-model]</cite> extends the user element from <a href="#RFC4575">RFC 4575</a> <cite title="NONE">[RFC4575]</cite> with a nickname attribute.  </p>
<h1 id="rfc.section.7.5">
<a href="#rfc.section.7.5">7.5.</a> Nicknames not supported nor allowed</h1>
<p id="rfc.section.7.5.p.1">The participants of the conference are identified by the SIP, TEL and IM URI's typically learned from the information received in notifications of the conference event package.  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#chatroom-attribute" id="chatroom-attribute">The SDP 'chatroom' attribute</a>
</h1>
<p id="rfc.section.8.p.1">There are a handful of use cases where a participant would like to learn the chat room capabilities supported by the MSRP switch and the chat room. For example, a participant would like to learn if the MSRP switch supports private messaging, otherwise, the participant may send what he believes is a private instant message addressed to a participant, but since the MSRP switch does not support the functions specified in this memo, the message gets eventually distributed to all the participants of the chat room.  </p>
<p id="rfc.section.8.p.2">The reverse case also exists. A participant, say Alice, whose user agent does not support the extensions defined by this document joins the chat room. The MSRP switch learns that Alice application does not support private messaging nor nicknames. If another participant, say Bob, sends a private message to Alice, the MSRP switch does not distribute it to Alice, because Alice is not able to differentiate it from a regular message sent to the whole roster. Further more, if Alice replied to this message, she would do it to the whole roster. Because of this, the MSRP switch keeps also track of users who do not support the extensions defined in this document.  </p>
<p id="rfc.section.8.p.3">In another scenario, the policy of a chat room may indicate that certain functions are not allowed. For example, the policy may indicate that nicknames or private messages are not allowed.  </p>
<p id="rfc.section.8.p.4">In order to provide the user with a good chat room experience, we define a new 'chatroom' SDP attribute. The 'chatroom' attribute is a media-level attribute that MAY be included in conjunction with and MSRP media stream (i.e., when an m= line in SDP indicates "TCP/MSRP" or "TCP/TLS/MSRP"). The 'chatroom' attribute indicates the intersection of support and chat room local policy allowance for a number of functions specified in this document. Specifically, we provide the means for indicating support to use nicknames and private messaging.  </p>
<p id="rfc.section.8.p.5">The 'chatroom' SDP attribute has the following syntax: </p>
<div id="#rfc.figure.4"></div>
<pre>
          chatroom = chatroom-label ":" chat-token *(SP chat-token)
          chatroom-label = "chatroom"
          chat-token = (nicknames-token | private-msg-token | token)
          nicknames-token = "nicknames"
          private-msg-token = "private-messages"
        </pre>
<p id="rfc.section.8.p.6">A conference focus that includes the 'nicknames' token in the session description is signaling that the MSRP switch supports and the chat room allows to use of the procedures specified in <a href="#nicknames">Section 7</a>. A conference focus that includes the 'private-messages' in the SDP description is signaling that the MSRP switch supports and the chat room allows to use of the procedures specified in <a href="#private-messages">Section 6.2</a>.  </p>
<p id="rfc.section.8.p.7">Example of the 'chatroom' attribute for an MSRP media stream that indicates the acceptance of nicknames and private messages: </p>
<div id="#rfc.figure.5"></div>
<pre>
          a=chatroom:nickname private-messages
      </pre>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#examples" id="examples">Examples</a>
</h1>
<h1 id="rfc.section.9.1">
<a href="#rfc.section.9.1">9.1.</a> <a href="#example-join" id="example-join">Joining a chat room</a>
</h1>
<p><a href="#fig-joining">Figure 6</a> presents a flow diagram where Alice joins a chat room by sending an INVITE request. This INVITE request contains a session description that includes the chatroom extensions defined in this document.</p>
<div id="#rfc.figure.6"></div>
<div id="#fig-joining"></div>
<pre>
Alice               Conference focus
  |                        |
  |F1: (SIP) INVITE        |
  |-----------------------&gt;|
  |F2: (SIP) 200 OK        |
  |&lt;-----------------------|
  |F3: (SIP) ACK           |
  |-----------------------&gt;|
  |                        |
  </pre>
<p id="rfc.section.9.1.p.2">F1: Alice constructs an SDP description that includes an MSRP media stream. She also indicates her support for the chatroom extensions defined in this document. She sends the INVITE request to the chat room server.</p>
<div id="#rfc.figure.7"></div>
<pre>
INVITE sip:chatroom22@chat.example.com SIP/2.0
Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
Max-Forwards: 70
From: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=9fxced76sl
To: Chatroom 22 &lt;sip:chatroom22@chat.example.com&gt;
Call-ID: 3848276298220188511@atlanta.example.com
CSeq: 1 INVITE
Contact: &lt;sip:alice@client.atlanta.example.com;transport=tcp&gt;
Content-Type: application/sdp
Content-Length: [length]

v=0
o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
s=-
c=IN IP4 atlanta.example.com
m=message 7654 TCP/MSRP *
a=accept-types:message/cpim text/plain text/html
a=path:msrp://client.atlanta.example.com:7654/jshA7weztas;tcp
a=chatroom:nickname private-messages
   </pre>
<p id="rfc.section.9.1.p.3">F2: The chat room server accepts the session establishment. It includes the 'isfocus' and other relevant feature tags in the Contact header field of the response. The chat room server also builds an SDP answer that also that forces the reception of messages wrapped in Message/CPIM envelopes. It also includes the the chatroom attribute with the allowed extensions.  </p>
<div id="#rfc.figure.8"></div>
<pre>
SIP/2.0 200 OK
Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
 ;received=192.0.2.101
From: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=9fxced76sl
To: Chatroom 22 &lt;sip:chatroom22@chat.example.com&gt;;tag=8321234356
Call-ID: 3848276298220188511@atlanta.example.com
CSeq: 1 INVITE
Contact: &lt;sip:chatroom22@chat.example.com;transport=tcp&gt; \
          ;methods="INVITE,BYE,OPTIONS,ACK,CANCEL,SUBSCRIBE,NOTIFY" \
          ;automata;isfocus;message;event="conference"
Content-Type: application/sdp
Content-Length: [length]

v=0
o=chat 2890844527 2890844527 IN IP4 chat.example.com
s=-
c=IN IP4 chat.example.com
m=message 12763 TCP/MSRP *
a=accept-types:message/cpim
a=accept-wrapped-types:text/plain text/html *
a=path:msrp://chat.example.com:12763/kjhd37s2s20w2a;tcp
a=chatroom:nickname private-messages
        </pre>
<p id="rfc.section.9.1.p.4">F3: The session established is acknowledged (details not shown).  </p>
<h1 id="rfc.section.9.2">
<a href="#rfc.section.9.2">9.2.</a> <a href="#example-nickname" id="example-nickname">Setting up a nickname</a>
</h1>
<p><a href="#fig-nickname">Figure 9</a> shows an example of Alice setting up a nickname using the conference as provider.  Her first proposal is not accepted because the proposed nickname is already in use. Her second proposal is accepted.</p>
<div id="#rfc.figure.9"></div>
<div id="#fig-nickname"></div>
<pre>
Alice                  MSRP switch
  |                        |
  |F1: (MSRP) NICKNAME     |
  |-----------------------&gt;|
  |F2: (MSRP) 423          |
  |&lt;-----------------------|
  |F3: (MSRP) NICKNAME     |
  |-----------------------&gt;|
  |F4: (MSRP) 200          |
  |&lt;-----------------------|
  |                        |
        </pre>
<p id="rfc.section.9.2.p.2">F1: Alice sends an MSRP NICKNAME request that contains her proposed nicknames in the Set-Nickname header field.</p>
<div id="#rfc.figure.10"></div>
<pre>
MSRP d93kswow NICKNAME
To-Path: msrp://chat.example.com:12763/kjhd37s2s20w2a;tcp
From-Path: msrp://client.atlanta.example.com:7654/jshA7weztas;tcp
Use-Nickname: "Alice the great" 
-------d93kswow$
        </pre>
<p id="rfc.section.9.2.p.3">F2: The MSRP switch analyzes the existing allocation of nicknames and detects that the nickname "Alice the great" is already provided to another participant by the conference.  The MSRP switch answers with a 423 response.</p>
<div id="#rfc.figure.11"></div>
<pre>
MSRP d93kswow 423 Nickname usage failed
To-Path: msrp://client.atlanta.example.com:7654/jshA7weztas;tcp
From-Path: msrp://chat.example.com:12763/kjhd37s2s20w2a;tcp
-------d93kswow$
        </pre>
<p id="rfc.section.9.2.p.4">F3: Alice receives the response. She proposes a new nickname in a second NICKNAME request.</p>
<div id="#rfc.figure.12"></div>
<pre>
MSRP 09swk2d NICKNAME
To-Path: msrp://chat.example.com:12763/kjhd37s2s20w2a;tcp
From-Path: msrp://client.atlanta.example.com:7654/jshA7weztas;tcp
Use-Nickname: "Alice in Wonderland" 
-------09swk2d$
        </pre>
<p id="rfc.section.9.2.p.5">F4: The MSRP switch accepts the nickname proposal and answers with a 200 response.</p>
<div id="#rfc.figure.13"></div>
<pre>
MSRP 09swk2d 200 OK
To-Path: msrp://client.atlanta.example.com:7654/jshA7weztas;tcp
From-Path: msrp://chat.example.com:12763/kjhd37s2s20w2a;tcp
-------09swk2d$
        </pre>
<h1 id="rfc.section.9.3">
<a href="#rfc.section.9.3">9.3.</a> <a href="#example-normal-message" id="example-normal-message">Sending a regular message to the chat room</a>
</h1>
<p><a href="#fig-sending-regular-message">Figure 14</a> depicts a flow diagram where Alice is sending a regular message addressed to the chat room. The MSRP switch distributes the message to the rest of the participants.</p>
<div id="#rfc.figure.14"></div>
<div id="#fig-sending-regular-message"></div>
<pre>
Alice               MSRP switch                   Bob   Charlie
  |                      |                        |       |
  | F1: (MSRP) SEND      |                        |       |
  |---------------------&gt;|  F3: (MSRP) SEND       |       |
  | F2: (MSRP) 200       |-----------------------&gt;|       |
  |&lt;---------------------|  F4: (MSRP) SEND       |       |
  |                      |-------------------------------&gt;|
  |                      |  F5: (MSRP) 200 OK     |       |
  |                      |&lt;-----------------------|       |
  |                      |  F6: (MSRP) 200 OK     |       |
  |                      |&lt;------------------------------ |
  |                      |                        |       |
  |                      |                        |       |
        </pre>
<p id="rfc.section.9.3.p.2">F1: Alice builds a text message and wraps it in a CPIM message. She addresses the CPIM message to the chat room. She encloses the result in an MSRP SEND request and sends it to the MSRP switch via the existing TCP connection.</p>
<div id="#rfc.figure.15"></div>
<pre>
MSRP 3490visdm SEND
To-Path: msrp://chat.example.com:12763/kjhd37s2s20w2a;tcp
From-Path: msrp://client.atlanta.example.com:7654/jshA7weztas;tcp
Message-ID: 99s9s2
Byte-Range: 1-*/*
Content-Type: message/cpim

To: &lt;sip:chatroom22@chat.example.com;transport=tcp&gt;
From: &lt;sip:alice@atlanta.example.com&gt;
DateTime: 2009-03-02T15:02:31-03:00
Content-Type: text/plain

Hello guys, how are you today?
-------3490visdm$
        </pre>
<p id="rfc.section.9.3.p.3">F2: The MSRP switch acknowledges the reception of the SEND request with a 200 (OK) response.</p>
<div id="#rfc.figure.16"></div>
<pre>
MSRP 3490visdm 200 OK
To-Path: msrp://client.atlanta.example.com:7654/jshA7weztas;tcp
From-Path: msrp://chat.example.com:12763/kjhd37s2s20w2a;tcp
Message-ID: 99s9s2
-------3490visdm$
         </pre>
<p id="rfc.section.9.3.p.4">F3: The MSRP switch creates a new MSRP SEND request that contains the received Message/CPIM body and sends it to Bob.</p>
<div id="#rfc.figure.17"></div>
<pre>
MSRP 490ej23 SEND
To-Path: msrp://client.biloxi.example.com:4923/49dufdje2;tcp
From-Path: msrp://chat.example.com:5678/jofofo3;tcp
Message-ID: 304sse2
Byte-Range: 1-*/*
Content-Type: message/cpim

To: &lt;sip:chatroom22@chat.example.com;transport=tcp&gt;
From: &lt;sip:alice@atlanta.example.com&gt;
DateTime: 2009-03-02T15:02:31-03:00
Content-Type: text/plain

Hello guys, how are you today?
-------490ej23$
        </pre>
<p id="rfc.section.9.3.p.5">The rest of the message flows are analogous to the previous. They are not shown here.</p>
<h1 id="rfc.section.9.4">
<a href="#rfc.section.9.4">9.4.</a> <a href="#example-private-message" id="example-private-message">Sending a private message to a participant</a>
</h1>
<p><a href="#fig-sending-private-message">Figure 18</a> depicts a flow diagram where Alice is sending a private message addressed to Bob's SIP AOR. The MSRP switch distributes the message only to Bob.</p>
<div id="#rfc.figure.18"></div>
<div id="#fig-sending-private-message"></div>
<pre>
Alice               MSRP switch                   Bob
  |                      |                        |  
  | F1: (MSRP) SEND      |                        | 
  |---------------------&gt;|  F3: (MSRP) SEND       | 
  | F2: (MSRP) 200       |-----------------------&gt;| 
  |&lt;---------------------|                        | 
  |                      |                        |   
  |                      |                        | 
        </pre>
<p id="rfc.section.9.4.p.2">F1: Alice builds a text message and wraps it in a CPIM message. She addresses the CPIM message to the Bob's URI, which she learned from a notification in the conference event package. She encloses the result in an MSRP SEND request and sends it to the MSRP switch via the existing TCP connection.</p>
<div id="#rfc.figure.19"></div>
<pre>
MSRP 6959ssdf SEND
To-Path: msrp://chat.example.com:12763/kjhd37s2s20w2a;tcp
From-Path: msrp://client.atlanta.example.com:7654/jshA7weztas;tcp
Message-ID: okj3kw
Byte-Range: 1-*/*
Content-Type: message/cpim

To: &lt;sip:bob@example.com&gt;
From: &lt;sip:alice@example.com&gt;
DateTime: 2009-03-02T15:02:31-03:00
Content-Type: text/plain

Hello Bob.
-------6959ssdf$
        </pre>
<p id="rfc.section.9.4.p.3">F2: The MSRP switch acknowledges the reception of the SEND request with a 200 (OK) response.</p>
<div id="#rfc.figure.20"></div>
<pre>
MSRP 6959ssdfm 200 OK
To-Path: msrp://client.atlanta.example.com:7654/jshA7weztas;tcp
From-Path: msrp://chat.example.com:12763/kjhd37s2s20w2a;tcp
Message-ID: okj3kw
-------6959ssdfm$
         </pre>
<p id="rfc.section.9.4.p.4">F3: The MSRP switch creates a new MSRP SEND request that contains the received Message/CPIM body and sends it only to Bob. Bob can distinguish the sender in the From header of the CPIM message. He also identifies this as a private message due to the To CPIM header.</p>
<div id="#rfc.figure.21"></div>
<pre>
MSRP 9v9s2 SEND
To-Path: msrp://client.biloxi.example.com:4923/49dufdje2;tcp
From-Path: msrp://chat.example.com:5678/jofofo3;tcp
Message-ID: d9fghe982
Byte-Range: 1-*/*
Content-Type: message/cpim

To: &lt;sip:bob@example.com&gt;
From: &lt;sip:alice@atlanta.example.com&gt;
DateTime: 2009-03-02T15:02:31-03:00
Content-Type: text/plain

Hello Bob.
-------9v9s2$
        </pre>
<h1 id="rfc.section.9.5">
<a href="#rfc.section.9.5">9.5.</a> <a href="#example-chuncked" id="example-chuncked">Chuncked private message</a>
</h1>
<p id="rfc.section.9.5.p.1">The MSRP message below depicts an example of the private message in <a href="#example-private-message">Section 9.4</a> split in two chuncks. The MSRP switch must wait for the complete set of CPIM headers before distributing the messages.  </p>
<div id="#rfc.figure.22"></div>
<pre>
MSRP 7443ruls SEND
To-Path: msrp://chat.example.com:12763/kjhd37s2s20w2a;tcp
From-Path: msrp://client.atlanta.example.com:7654/jshA7weztas;tcp
Message-ID: aft4to
Byte-Range: 1-*/174
Content-Type: message/cpim

To: &lt;sip:bob@example.com&gt;
From: &lt;sip:anonymousX@example.com&gt;
-------7443ruls$

MSRP 7443ruls SEND
To-Path: msrp://chat.example.com:12763/kjhd37s2s20w2a;tcp
From-Path: msrp://client.atlanta.example.com:7654/jshA7weztas;tcp
Message-ID: aft4to
Byte-Range: 68-174/174
Content-Type: message/cpim

DateTime: 2009-03-02T15:02:31-03:00
Content-Type: text/plain

Hello Bob
-------7443ruls$
        </pre>
<h1 id="rfc.section.9.6">
<a href="#rfc.section.9.6">9.6.</a> <a href="#example-nickname-conference" id="example-nickname-conference">Nickname in a conference information document</a>
</h1>
<p><a href="#fig-nickname-conference">Figure 23</a> depicts two user elements in a conference information document both having the nickname element with a nickname string.  </p>
<div id="#rfc.figure.23"></div>
<div id="#fig-nickname-conference"></div>
<pre>

 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;conference-info
    xmlns="urn:ietf:params:xml:ns:conference-info"
    entity="sip:chatroom22@chat.example.com"
    state="full" version="1"&gt;
   &lt;!--
     CONFERENCE INFO
   --&gt;
    &lt;conference-description&gt;
      &lt;subject&gt;MSRP nickname example&lt;/subject&gt;
     &lt;/conference-description&gt;
   &lt;!--
      CONFERENCE STATE
   --&gt;
    &lt;conference-state&gt;
     &lt;user-count&gt;2&lt;/user-count&gt;
    &lt;/conference-state&gt;
   &lt;!--
     USERS
   --&gt;
    &lt;users&gt;
      &lt;user entity="sip:bob@example.com" state="full"&gt;
        &lt;nickname&gt;Dopey Donkey&lt;/nickname&gt;
     &lt;/user&gt;
   &lt;!--
     USER
   --&gt;
     &lt;user entity="sip:alice@atlanta.example.com" state="full"&gt;
       &lt;nickname&gt;Depressed Donkey&lt;/nickname&gt;
     &lt;/user&gt;
    &lt;/users&gt;
   &lt;/conference-info&gt;

   </pre>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> <a href="#new-msrp-method" id="new-msrp-method">New MSRP Method</a>
</h1>
<p id="rfc.section.10.1.p.1">This specification defines a new MSRP method to be added to the Methods sub-registry of the Message Session Relay Protocol (MSRP) Parameters registry: </p>
<p></p>

<ul class="empty"><li>NICKNAME </li></ul>

<p> </p>
<p id="rfc.section.10.1.p.3">See section <a href="#nicknames">Section 7</a> for details.  </p>
<h1 id="rfc.section.10.2">
<a href="#rfc.section.10.2">10.2.</a> <a href="#new-msrp-header" id="new-msrp-header">New MSRP Header</a>
</h1>
<p id="rfc.section.10.2.p.1">This specification defines a new MSRP header to be added to the Header Field sub-registry of the Message Session Relay Protocol (MSRP) Parameters registry: </p>
<p></p>

<ul class="empty"><li>Use&#8209;Nickname </li></ul>

<p> </p>
<p id="rfc.section.10.2.p.3">See  <a href="#nicknames">Section 7</a> for details.  </p>
<h1 id="rfc.section.10.3">
<a href="#rfc.section.10.3">10.3.</a> <a href="#new-msrp-status-codes" id="new-msrp-status-codes">New MSRP Status Codes</a>
</h1>
<p id="rfc.section.10.3.p.1">This specification defines three new MSRP status codes to be added to the Status-Code sub-registry of the Message Session Relay Protocol (MSRP) parameters registry.  </p>
<p id="rfc.section.10.3.p.2">The 404 status code indicates the failure to resolve the recipient URI in the To header field of the Message/CPIM wrapper in the SEND request, e.g, due to an unknown recipient. See  <a href="#private-messages">Section 6.2</a> for details.  </p>
<p id="rfc.section.10.3.p.3">The 423 response indicates a failure in allocated the requested NICKNAME. This can be caused by a malformed NICKNAME request (e.g., no Use&#8209;Nickname header field), an already allocated nickname, or a policy that prevents the sender to use nicknames. See  <a href="#nicknames">Section 7</a> for details.  </p>
<p id="rfc.section.10.3.p.4">The 428 status code indicates that the recipient of a SEND request does not support private messages. See section <a href="#private-messages">Section 6.2</a> for details.  </p>
<p><a href="#iana-status-codes">Table 1</a> summarizes the IANA registration data with respect to new MSRP status codes: </p>
<div id="#rfc.table.1"></div>
<div id="#iana-status-codes"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>New status codes</caption>
<thead><tr>
<th class="center">Value</th>
<th class="left">Description</th>
<th class="center">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="center">404</td>
<td class="left">Failure to resolve recipient's URI</td>
<td class="center">RFC XXXX</td>
</tr>
<tr>
<td class="center">423</td>
<td class="left">Unable to allocate requested nickname</td>
<td class="center">RFC XXXX</td>
</tr>
<tr>
<td class="center">428</td>
<td class="left">Private messages not supported</td>
<td class="center">RFC XXXX</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.10.4">
<a href="#rfc.section.10.4">10.4.</a> <a href="#new-sdp-attribute" id="new-sdp-attribute">New SDP Attribute</a>
</h1>
<p id="rfc.section.10.4.p.1">This specification defines a new media-level attribute in the Session Description Protocol (SDP) Parameters registry. The registration data is as follows: </p>
<p></p>

<ul class="empty">
<li>Contact: Miguel Garcia &lt;miguel.a.garcia@ericsson.com&gt;</li>
<li>Phone: +34 91 339 1000</li>
<li>Attribute name: chatroom</li>
<li>Long-form attribute name: Chat Room</li>
<li>Type of attribute: media level only </li>
<li>This attribute is not subject to the charset attribute</li>
<li>Description: This attribute identifiers support and local policy allowance for a number of chatroomt related functions</li>
<li>Specification: RFC XXXX</li>
</ul>

<p> </p>
<p id="rfc.section.10.4.p.3">See section <a href="#chatroom-attribute">Section 8</a> for details.  </p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#security" id="security">Security Considerations</a>
</h1>
<p id="rfc.section.11.p.1">This document proposes extensions to the <a href="#RFC4975">Message Session Relay Protocol </a> <cite title="NONE">[RFC4975]</cite>. Therefore, the security considerations of such document apply to this document as well.  </p>
<p id="rfc.section.11.p.2">In general, messages sent to a multi-party session based messaging focus are not deem to expose any security threat. Nevertheless, if a participant wants to avoid eavesdropping from non authorized entities, it should send those messages a <a href="#RFC5246">TLS </a> <cite title="NONE">[RFC5246]</cite> transport connection, as allowed by MSRP. Also the participant should pay attention to the receiver address notifed from the conference event package to make sure a private message isn't sent to the chat room.</p>
<p id="rfc.section.11.p.3">Nicknames will be used to show the appearances of the participants of the conference.  A successful take over of a nickname from a participant might lead to private messages to be sent to the wrong destination.  The recipient's URI will be different from the URI associated to the original owner of the nickname, but the sender might not notice this.  To avoid take overs the MSRP switch MUST make sure that a nickname is unique inside a chat room. Also the security consideration for any authenticated identity mechanisms used to validate the SIP AOR will apply to this document as well.  If a nickname can be reserved if it previously has been used by another participant in the chat room, is up to the policy of the chat room.  </p>
<h1 id="rfc.section.12">
<a href="#rfc.section.12">12.</a> <a href="#contributors" id="contributors">Contributors</a>
</h1>
<p id="rfc.section.12.p.1">This work would have never been possible without the fruitful discussions in the SIMPLE WG mailing list, specially with Brian Rosen (Neustar) and Paul Kyzivat (Cisco), who provided extensive review and improvements throughout the document.  </p>
<h1 id="rfc.section.13">
<a href="#rfc.section.13">13.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a>
</h1>
<p id="rfc.section.13.p.1">The authors want to thank Eva Leppanen, Adamu Haruna, Adam Roach, Matt Lepinski, Mary Barnes, Ben Campbell, Paul Kyzivat, Adrian Georgescu, and Nancy Greene for providing comments.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">14.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">14.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3261">[RFC3261]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3840">[RFC3840]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a> and <a>P. Kyzivat</a>, "<a href="http://tools.ietf.org/html/rfc3840">Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)</a>", RFC 3840, August 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3860">[RFC3860]</b></td>
<td class="top">
<a>Peterson, J.</a>, "<a href="http://tools.ietf.org/html/rfc3860">Common Profile for Instant Messaging (CPIM)</a>", RFC 3860, August 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3862">[RFC3862]</b></td>
<td class="top">
<a>Klyne, G.</a> and <a>D. Atkins</a>, "<a href="http://tools.ietf.org/html/rfc3862">Common Presence and Instant Messaging (CPIM): Message Format</a>", RFC 3862, August 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4566">[RFC4566]</b></td>
<td class="top">
<a>Handley, M.</a>, <a>Jacobson, V.</a> and <a>C. Perkins</a>, "<a href="http://tools.ietf.org/html/rfc4566">SDP: Session Description Protocol</a>", RFC 4566, July 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4575">[RFC4575]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a> and <a>O. Levin</a>, "<a href="http://tools.ietf.org/html/rfc4575">A Session Initiation Protocol (SIP) Event Package for Conference State</a>", RFC 4575, August 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4975">[RFC4975]</b></td>
<td class="top">
<a>Campbell, B.</a>, <a>Mahy, R.</a> and <a>C. Jennings</a>, "<a href="http://tools.ietf.org/html/rfc4975">The Message Session Relay Protocol (MSRP)</a>", RFC 4975, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4976">[RFC4976]</b></td>
<td class="top">
<a>Jennings, C.</a>, <a>Mahy, R.</a> and <a>A.B. Roach</a>, "<a href="http://tools.ietf.org/html/rfc4976">Relay Extensions for the Message Sessions Relay Protocol (MSRP)</a>", RFC 4976, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5239">[RFC5239]</b></td>
<td class="top">
<a>Barnes, M.</a>, <a>Boulton, C.</a> and <a>O. Levin</a>, "<a href="http://tools.ietf.org/html/rfc5239">A Framework for Centralized Conferencing</a>", RFC 5239, June 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-xcon-common-data-model">[I-D.ietf-xcon-common-data-model]</b></td>
<td class="top">
<a>Novo, O</a>, <a>Camarillo, G</a>, <a>Morgan, D</a> and <a>J Urpalainen</a>, "<a href="http://tools.ietf.org/html/draft-ietf-xcon-common-data-model-32">Conference Information Data Model for Centralized Conferencing (XCON)</a>", Internet-Draft draft-ietf-xcon-common-data-model-32, September 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-xcon-event-package">[I-D.ietf-xcon-event-package]</b></td>
<td class="top">
<a>Camarillo, G</a>, <a>Srinivasan, S</a>, <a>Even, R</a> and <a>J Urpalainen</a>, "<a href="http://tools.ietf.org/html/draft-ietf-xcon-event-package-01">Conference Event Package Data Format Extension for Centralized Conferencing (XCON)</a>", Internet-Draft draft-ietf-xcon-event-package-01, September 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">14.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2810">[RFC2810]</b></td>
<td class="top">
<a>Kalt, C.</a>, "<a href="http://tools.ietf.org/html/rfc2810">Internet Relay Chat: Architecture</a>", RFC 2810, April 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3264">[RFC3264]</b></td>
<td class="top">
<a>Rosenberg, J.</a> and <a>H. Schulzrinne</a>, "<a href="http://tools.ietf.org/html/rfc3264">An Offer/Answer Model with Session Description Protocol (SDP)</a>", RFC 3264, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3920">[RFC3920]</b></td>
<td class="top">
<a href="mailto:stpeter@jabber.org" title="Jabber Software Foundation">Saint-Andre, P.</a>, "<a href="http://tools.ietf.org/html/rfc3920">Extensible Messaging and Presence Protocol (XMPP): Core</a>", RFC 3920, October 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3966">[RFC3966]</b></td>
<td class="top">
<a>Schulzrinne, H.</a>, "<a href="http://tools.ietf.org/html/rfc3966">The tel URI for Telephone Numbers</a>", RFC 3966, December 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4353">[RFC4353]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, "<a href="http://tools.ietf.org/html/rfc4353">A Framework for Conferencing with the Session Initiation Protocol (SIP)</a>", RFC 4353, February 2006.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Aki Niemi</span> 
	  <span class="n hidden">
		<span class="family-name">Niemi</span>
	  </span>
	</span>
	<span class="org vcardline">Nokia</span>
	<span class="adr">
	  <span>P.O. Box 407</span>

	  <span class="vcardline">
		<span class="locality">NOKIA GROUP</span>,  
		<span class="region">FIN</span> 
		<span class="code">00045</span>
	  </span>
	  <span class="country-name vcardline">Finland</span>
	</span>
	<span class="vcardline">Phone: +358 50 389 1644</span>

<span class="vcardline">EMail: <a href="mailto:aki.niemi@nokia.com">aki.niemi@nokia.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Miguel A. Garcia-Martin</span> 
	  <span class="n hidden">
		<span class="family-name">Garcia-Martin</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span>Calle Via de los Poblados 13</span>

	  <span class="vcardline">
		<span class="locality">Madrid</span>,  
		<span class="region">ES</span> 
		<span class="code">28033</span>
	  </span>
	  <span class="country-name vcardline">Spain</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:miguel.a.garcia@ericsson.com">miguel.a.garcia@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Geir A. Sandbakken</span> editor
	  <span class="n hidden">
		<span class="family-name">Sandbakken</span>
	  </span>
	</span>
	<span class="org vcardline">TANDBERG</span>
	<span class="adr">
	  <span>Philip Pedersens vei 20</span>

	  <span class="vcardline">
		<span class="locality">N-1366 Lysaker</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Norway</span>
	</span>
	<span class="vcardline">Phone: +47 67 125 125</span>

<span class="vcardline">EMail: <a href="mailto:geir.sandbakken@tandberg.com">geir.sandbakken@tandberg.com</a></span>

<span class="vcardline">URI: <a href="http://www.tandberg.com">http://www.tandberg.com</a></span>

  </address>
</div>

</body>
</html>