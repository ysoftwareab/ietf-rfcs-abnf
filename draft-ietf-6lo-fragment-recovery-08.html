<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>6LoWPAN Selective Fragment Recovery</title>
<meta content="Pascal Thubert" name="author">
<meta content="
       
    " name="description">
<meta content="xml2rfc 2.35.0" name="generator">
<meta content="draft-ietf-6lo-fragment-recovery-08" name="ietf.draft">
<link href="/tmp/draft-ietf-6lo-fragment-recovery-MTiQQL.xml" type="application/rfc+xml" rel="alternate">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Avoid wrapping of URLs in references */
@media screen {
  .references a {
    white-space: nowrap;
  }
}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin: 0 0 0.25em 0;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .sourcecode {
    margin-bottom: 1em;
  }
}</style>
<link href="rfc-local.css" type="text/css" rel="stylesheet">
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Selective RFRAG</td>
<td class="right">November 2019</td>
</tr></thead>
<tfoot><tr>
<td class="left">Thubert</td>
<td class="center">Expires 31 May 2020</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">6lo</dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a href="https://www.rfc-editor.org/rfc/rfc4944" class="eref">4944</a> (if approved)</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2019-11-28" class="published">28 November 2019</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2020-05-31">31 May 2020</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">P. Thubert, <span class="editor">Ed.</span>
</div>
<div class="org">Cisco Systems</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">6LoWPAN Selective Fragment Recovery</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">
        This draft updates RFC 4944 with a simple protocol to recover individual
        fragments across a route-over mesh network, with a minimal flow control
        to protect the network against bloat.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 31 May 2020.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2019 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-terminology" class="xref">Terminology</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-bcp-14" class="xref">BCP 14</a><a href="#section-toc.1-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-new-terms" class="xref">New Terms</a><a href="#section-toc.1-1.2.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-updating-rfc-4944" class="xref">Updating RFC 4944</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-extending-draft-ietf-6lo-mi" class="xref">Extending draft-ietf-6lo-minimal-fragment</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-slack-in-the-first-fragment" class="xref">Slack in the First Fragment</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-gap-between-frames" class="xref">Gap between frames</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-modifying-the-first-fragmen" class="xref">Modifying the First Fragment</a><a href="#section-toc.1-1.4.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-new-dispatch-types-and-head" class="xref">New Dispatch types and headers</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-recoverable-fragment-dispat" class="xref">Recoverable Fragment Dispatch type and Header </a><a href="#section-toc.1-1.5.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-rfrag-acknowledgment-dispat" class="xref">RFRAG Acknowledgment Dispatch type and Header</a><a href="#section-toc.1-1.5.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-fragments-recovery" class="xref">Fragments Recovery</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-forwarding-fragments" class="xref">Forwarding Fragments</a><a href="#section-toc.1-1.6.2.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.6.2.1.2.1">
                    <p id="section-toc.1-1.6.2.1.2.1.1"><a href="#section-6.1.1" class="xref">6.1.1</a>.  <a href="#name-upon-the-first-fragment" class="xref">Upon the first fragment</a><a href="#section-toc.1-1.6.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-toc.1-1.6.2.1.2.2">
                    <p id="section-toc.1-1.6.2.1.2.2.1"><a href="#section-6.1.2" class="xref">6.1.2</a>.  <a href="#name-upon-the-next-fragments" class="xref">Upon the next fragments</a><a href="#section-toc.1-1.6.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-upon-the-rfrag-acknowledgme" class="xref">Upon the RFRAG Acknowledgments</a><a href="#section-toc.1-1.6.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-aborting-the-transmission-o" class="xref">Aborting the Transmission of a Fragmented Packet</a><a href="#section-toc.1-1.6.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-applying-recoverable-fragme" class="xref">Applying Recoverable Fragmentation along a Diverse Path</a><a href="#section-toc.1-1.6.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-management-considerations" class="xref">Management Considerations</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-protocol-parameters" class="xref">Protocol Parameters</a><a href="#section-toc.1-1.7.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-observing-the-network" class="xref">Observing the network</a><a href="#section-toc.1-1.7.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-acknowledgments" class="xref">Acknowledgments</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.12.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-rationale" class="xref">Rationale</a><a href="#section-toc.1-1.13.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-appendix.b" class="xref">Appendix B</a>.  <a href="#name-requirements" class="xref">Requirements</a><a href="#section-toc.1-1.14.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-appendix.c" class="xref">Appendix C</a>.  <a href="#name-considerations-on-flow-cont" class="xref">Considerations On Flow Control</a><a href="#section-toc.1-1.15.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#section-appendix.d" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a><a href="#section-toc.1-1.16.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">

        In most Low Power and Lossy Network (LLN) applications, the bulk of
        the traffic consists of small chunks of data (in the order few bytes
        to a few tens of bytes) at a time.  Given that an
        <span><a href="#IEEE.802.15.4" class="xref"> IEEE Std. 802.15.4 </a> [<a href="#IEEE.802.15.4" class="xref">IEEE.802.15.4</a>]</span>
        frame can carry a payload of 74 bytes or more, fragmentation is
        usually not required.  However, and though this happens only
        occasionally, a number of mission critical applications do require
        the capability to transfer larger chunks of data, for instance to
        support the firmware upgrade of the LLN nodes or the extraction of logs
        from LLN nodes.  In the former case, the large chunk of data is
        transferred to the LLN node, whereas in the latter, the large chunk
        flows away from the LLN node.  In both cases, the size can be on the
        order of 10 kilobytes or more and an end-to-end reliable transport
        is required.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2"><span><a href="#RFC4944" class="xref">"Transmission of IPv6 Packets over IEEE 802.15.4
        Networks"</a> [<a href="#RFC4944" class="xref">RFC4944</a>]</span> defines the original 6LoWPAN datagram fragmentation
        mechanism for LLNs. One critical issue with this original design is that
        routing an IPv6 <span>[<a href="#RFC8200" class="xref">RFC8200</a>]</span> packet across a route-over mesh
        requires to reassemble the full packet at each hop, which may cause
        latency along a path and an overall buffer bloat in the network. The
        <span><a href="#I-D.ietf-6tisch-architecture" class="xref">"6TiSCH Architecture"</a> [<a href="#I-D.ietf-6tisch-architecture" class="xref">I-D.ietf-6tisch-architecture</a>]</span>
        recommends to use a fragment forwarding (FF) technique to alleviate
        those undesirable effects. <span><a href="#I-D.ietf-6lo-minimal-fragment" class="xref">
        "LLN Minimal Fragment Forwarding"</a> [<a href="#I-D.ietf-6lo-minimal-fragment" class="xref">I-D.ietf-6lo-minimal-fragment</a>]</span> specifies the general behavior
        that all FF techniques including this specification follow, and presents
        the associated caveats. In particular, the routing information is fully
        indicated in the first fragment, which is always forwarded first.
        A state is formed and used to forward all the next fragments along the
        same path. The datagram_tag is locally significant to the Layer-2 source
        of the packet and is swapped at each hop.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3"><span><a href="#I-D.ietf-lwig-6lowpan-virtual-reassembly" class="xref">
        "Virtual reassembly buffers in 6LoWPAN"</a> [<a href="#I-D.ietf-lwig-6lowpan-virtual-reassembly" class="xref">I-D.ietf-lwig-6lowpan-virtual-reassembly</a>]</span> (VRB) proposes a FF
        technique that is compatible with <span>[<a href="#RFC4944" class="xref">RFC4944</a>]</span> without the
        need to define a new protocol.
        However, adding that capability alone to the local implementation of the
        original 6LoWPAN fragmentation would not address the inherent fragility
        of fragmentation (see <span>[<a href="#I-D.ietf-intarea-frag-fragile" class="xref">I-D.ietf-intarea-frag-fragile</a>]</span>) in
        particular the issues of resources locked on the receiver and the wasted
        transmissions due to the loss of a single fragment in a whole datagram.
        <span>[<a href="#Kent" class="xref">Kent</a>]</span> compares the unreliable delivery of fragments with
        a mechanism it calls "selective acknowledgements" that recovers the loss
        of a fragment individually. The paper illustrates the benefits that can
        be derived from such a method in figures 1, 2 and 3, pages 6 and 7.
        <span>[<a href="#RFC4944" class="xref">RFC4944</a>]</span> as no selective recovery and the whole datagram
        fails when one fragment is not delivered to the destination 6LoWPAN
        endpoint. Constrained memory resources are blocked on the receiver until
        the receiver times out, possibly causing the loss of subsequent packets
        that can not be received for the lack of buffers.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">
        That problem is exacerbated when forwarding fragments over multiple hops
        since a loss at an intermediate hop will not be discovered by either the
        source or the destination, and the source will keep on sending fragments,
        wasting even more resources in the network and possibly contributing to
        the condition that caused the loss to no avail since the datagram cannot
        arrive in its entirety. RFC 4944 is also missing signaling to abort a
        multi-fragment transmission at any time and from either end, and, if the
        capability to forward fragments is implemented, clean up the related
        state in the network. It is also lacking flow control capabilities to
        avoid participating to a congestion that may in turn cause the loss
        of a fragment and potentially the retransmission of the full datagram.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">
        This specification provides a method to forward fragments across a
        multi-hop route-over mesh, and a selective acknowledgment to recover
        individual fragments between 6LoWPAN endpoints. The method is designed
        to limit congestion loss in the network and addresses the requirements
        that are detailed in <a href="#req" class="xref">Appendix B</a>.<a href="#section-1-5" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-2">
      <h2 id="name-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<div id="bcp">
<section id="section-2.1">
        <h3 id="name-bcp-14">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-bcp-14" class="section-name selfRef">BCP 14</a>
        </h3>
<p id="section-2.1-1">

    The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
    "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
    "OPTIONAL" in this document are to be interpreted as described in BCP 14
    <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span><span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they
    appear in all capitals, as shown here.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="lo">
<section id="section-2.2">
        <h3 id="name-references">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-references" class="section-name selfRef">References</a>
        </h3>
<p id="section-2.2-1">
 In this document, readers will encounter terms and concepts
 that are discussed in <span><a href="#RFC6606" class="xref">"Problem Statement and Requirements for
 IPv6 over Low-Power Wireless Personal Area Network (6LoWPAN)
 Routing" </a> [<a href="#RFC6606" class="xref">RFC6606</a>]</span><a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2"><span><a href="#I-D.ietf-6lo-minimal-fragment" class="xref">
        "LLN Minimal Fragment Forwarding"</a> [<a href="#I-D.ietf-6lo-minimal-fragment" class="xref">I-D.ietf-6lo-minimal-fragment</a>]</span> introduces the generic concept
        of a  Virtual Reassembly Buffer (VRB) and specifies behaviours
        and caveats that are common to a large family of FF techniques
        including this, which fully inherits from that specification.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3">
 Past experience with fragmentation has shown that misassociated or lost
        fragments can lead to poor network behavior and, occasionally, trouble
        at application layer. The reader is encouraged to read
 <span><a href="#RFC4963" class="xref">"IPv4 Reassembly Errors at High Data Rates"</a> [<a href="#RFC4963" class="xref">RFC4963</a>]</span>
        and follow the references for more information.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
<p id="section-2.2-4">
 That experience led to the definition of <span><a href="#RFC8201" class="xref">"Path
        MTU discovery"</a> [<a href="#RFC8201" class="xref">RFC8201</a>]</span> (PMTUD) protocol that limits fragmentation over the
        Internet.<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.2-5">
 Specifically in the case of UDP, valuable additional information can be
        found in <span><a href="#RFC8085" class="xref">"UDP Usage Guidelines for Application
        Designers"</a> [<a href="#RFC8085" class="xref">RFC8085</a>]</span>.<a href="#section-2.2-5" class="pilcrow">¶</a></p>
<p id="section-2.2-6">Readers are expected to be familiar with all the terms and concepts
     that are discussed in <span><a href="#RFC4919" class="xref">"IPv6 over Low-Power
     Wireless Personal Area Networks (6LoWPANs): Overview, Assumptions,
     Problem Statement, and Goals"</a> [<a href="#RFC4919" class="xref">RFC4919</a>]</span> and <span><a href="#RFC4944" class="xref">
     "Transmission of IPv6 Packets over IEEE 802.15.4 Networks"</a> [<a href="#RFC4944" class="xref">RFC4944</a>]</span>.<a href="#section-2.2-6" class="pilcrow">¶</a></p>
<p id="section-2.2-7"><span><a href="#RFC8087" class="xref">
        "The Benefits of Using Explicit Congestion Notification (ECN)"</a> [<a href="#RFC8087" class="xref">RFC8087</a>]</span>
        provides useful information on the potential benefits and pitfalls of
        using ECN.<a href="#section-2.2-7" class="pilcrow">¶</a></p>
<p id="section-2.2-8">Quoting the <span><a href="#RFC3031" class="xref">
        "Multiprotocol Label Switching (MPLS) Architecture"</a> [<a href="#RFC3031" class="xref">RFC3031</a>]</span>: with MPLS,
        'packets are "labeled" before they are forwarded' along a Label Switched
        Path (LSP).
        At subsequent hops, there is no further analysis of the packet's
        network layer header.  Rather, the label is used as an index into a
        table which specifies the next hop, and a new label". The MPLS
        technique is leveraged in the present specification to forward
        fragments that actually
        do not have a network layer header, since the fragmentation occurs below
        IP.<a href="#section-2.2-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="new">
<section id="section-2.3">
        <h3 id="name-new-terms">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-new-terms" class="section-name selfRef">New Terms</a>
        </h3>
<p id="section-2.3-1">
    This specification uses the following terms:<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<dl class="dlParallel" id="section-2.3-2">
          <dt id="section-2.3-2.1">6LoWPAN endpoints:</dt>
          <dd id="section-2.3-2.2">
     The LLN nodes in charge of generating or expanding a 6LoWPAN header
        from/to a full IPv6 packet.
 The 6LoWPAN endpoints are the points where fragmentation and reassembly
        take place.<a href="#section-2.3-2.2" class="pilcrow">¶</a>
</dd>
<dt id="section-2.3-2.3">Compressed Form:</dt>
          <dd id="section-2.3-2.4">
     This specification uses the generic term Compressed Form to refer to
        the format of a datagram after the action of <span>[<a href="#RFC6282" class="xref">RFC6282</a>]</span>
        and possibly <span>[<a href="#RFC8138" class="xref">RFC8138</a>]</span> for RPL <span>[<a href="#RFC6550" class="xref">RFC6550</a>]</span>
        artifacts.<a href="#section-2.3-2.4" class="pilcrow">¶</a>
</dd>
<dt id="section-2.3-2.5">datagram_size:</dt>
          <dd id="section-2.3-2.6">
        The size of the datagram in its Compressed Form before it is fragmented.
        The datagram_size is expressed in a unit that depends on the MAC layer
        technology, by default a byte.<a href="#section-2.3-2.6" class="pilcrow">¶</a>
</dd>
<dt id="section-2.3-2.7">datagram_tag:</dt>
          <dd id="section-2.3-2.8">
        An identifier of a datagram that is locally unique to the Layer-2 sender.
        Associated with the MAC address of the sender, this becomes a globally
        unique identifier for the datagram.<a href="#section-2.3-2.8" class="pilcrow">¶</a>
</dd>
<dt id="section-2.3-2.9">fragment_offset:</dt>
          <dd id="section-2.3-2.10">
        The offset of a particular fragment of a datagram in its Compressed Form.
        The fragment_offset is expressed in a unit that depends on the MAC layer
        technology and is by default a byte.<a href="#section-2.3-2.10" class="pilcrow">¶</a>
</dd>
<dt id="section-2.3-2.11">RFRAG:</dt>
          <dd id="section-2.3-2.12">Recoverable Fragment<a href="#section-2.3-2.12" class="pilcrow">¶</a>
</dd>
<dt id="section-2.3-2.13">RFRAG-ACK:</dt>
          <dd id="section-2.3-2.14">Recoverable Fragment Acknowledgement<a href="#section-2.3-2.14" class="pilcrow">¶</a>
</dd>
<dt id="section-2.3-2.15">RFRAG Acknowledgment Request:</dt>
          <dd id="section-2.3-2.16">An RFRAG with the
       Acknowledgement Request flag ('X' flag) set.<a href="#section-2.3-2.16" class="pilcrow">¶</a>
</dd>
<dt id="section-2.3-2.17">NULL bitmap:</dt>
          <dd id="section-2.3-2.18">Refers to a bitmap with all bits set to zero.<a href="#section-2.3-2.18" class="pilcrow">¶</a>
</dd>
<dt id="section-2.3-2.19">FULL bitmap:</dt>
          <dd id="section-2.3-2.20">Refers to a bitmap with all bits set to one.<a href="#section-2.3-2.20" class="pilcrow">¶</a>
</dd>
<dt id="section-2.3-2.21">Forward:</dt>
          <dd id="section-2.3-2.22">The direction of a LSP path, followed by the RFRAG.<a href="#section-2.3-2.22" class="pilcrow">¶</a>
</dd>
<dt id="section-2.3-2.23">Reverse:</dt>
          <dd id="section-2.3-2.24">The reverse direction of a LSP path, taken by the
       RFRAG-ACK.<a href="#section-2.3-2.24" class="pilcrow">¶</a>
</dd>
</dl>
<p id="section-2.3-3"><a href="#section-2.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
<section id="section-3">
      <h2 id="name-updating-rfc-4944">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-updating-rfc-4944" class="section-name selfRef">Updating RFC 4944</a>
      </h2>
<p id="section-3-1">This specification updates the fragmentation mechanism that is
    specified in <span><a href="#RFC4944" class="xref">"Transmission of IPv6 Packets over
    IEEE 802.15.4 Networks"</a> [<a href="#RFC4944" class="xref">RFC4944</a>]</span> for use in route-over
    LLNs by providing a model where fragments can be forwarded
    end-to-end across a 6LoWPAN LLN, and where fragments that are lost on
    the way can be recovered individually.
    A new format for fragment is introduced and new dispatch types are defined
    in <a href="#dispatch" class="xref">Section 5</a>.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2"><span>[<a href="#RFC8138" class="xref">RFC8138</a>]</span> allows to modify the size of a packet en-route by
    removing the consumed hops in a compressed Routing Header. It results that
    fragment_offset and datagram_size (see <a href="#new" class="xref">Section 2.3</a>) must also be
    modified en-route, whcih is difficult to do in the uncompressed form.
    This specification expresses those fields in the Compressed Form and
    allows to modify them en-route (see <a href="#mod" class="xref">Section 4.3</a>) easily.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">
    Note that consistently with Section 2 of <span>[<a href="#RFC6282" class="xref">RFC6282</a>]</span> for the
    fragmentation mechanism described in Section 5.3 of <span>[<a href="#RFC4944" class="xref">RFC4944</a>]</span>,
    any header that cannot fit within the first fragment MUST NOT be compressed
    when using the fragmentation mechanism described in this specification.<a href="#section-3-3" class="pilcrow">¶</a></p>
</section>
<section id="section-4">
      <h2 id="name-extending-draft-ietf-6lo-mi">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-extending-draft-ietf-6lo-mi" class="section-name selfRef">Extending draft-ietf-6lo-minimal-fragment</a>
      </h2>
<p id="section-4-1">This specification implements the generic FF technique specified in
    <span><a href="#I-D.ietf-6lo-minimal-fragment" class="xref">
    "LLN Minimal Fragment Forwarding"</a> [<a href="#I-D.ietf-6lo-minimal-fragment" class="xref">I-D.ietf-6lo-minimal-fragment</a>]</span> in a fashion that
    enables end-to-end recovery of fragments and some degree of flow control.<a href="#section-4-1" class="pilcrow">¶</a></p>
<section id="section-4.1">
        <h3 id="name-slack-in-the-first-fragment">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-slack-in-the-first-fragment" class="section-name selfRef">Slack in the First Fragment</a>
        </h3>
<p id="section-4.1-1">At the time of this writing,
    <span>[<a href="#I-D.ietf-6lo-minimal-fragment" class="xref">I-D.ietf-6lo-minimal-fragment</a>]</span> allows for refragmenting
    in intermediate nodes, meaning that some bytes from a given fragment may be
    left in the VRB to be added to the next fragment. The reason for this to
    happen would be the need for space in the outgoing fragment that was not
    needed in the incoming fragment, for instance because the 6LoWPAN Header
    Compression is not as efficient on the outgoing link, e.g., if the Interface
    ID (IID) of the source IPv6 address is elided by the originator on the first
    hop because it matches the source MAC address, but cannot be on the next
    hops because the source MAC address changes.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">
    This specification cannot allow this operation since fragments are recovered
    end-to-end based on a sequence number. This means that the fragments that
    contain a 6LoWPAN-compressed header MUST have enough slack to enable a less
    efficient compression in the next hops that still fits in one MAC frame. For
    instance, if the IID of the source IPv6 address is elided by the originator,
    then it MUST compute the fragment_size as if the MTU was 8 bytes less.
    This way, the next hop can restore the source IID to the first fragment
    without impacting the second fragment.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2">
        <h3 id="name-gap-between-frames">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-gap-between-frames" class="section-name selfRef">Gap between frames</a>
        </h3>
<p id="section-4.2-1">This specification introduces a concept of Inter-Frame Gap, which is a
    configurable interval of time between transmissions to a same next hop.
    In the case of half duplex interfaces, this InterFrameGap ensures that the
    next hop has progressed the previous frame and is capable of receiving the
    next one.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">
    In the case of a mesh operating at a single frequency with omnidirectional
    antennas, a larger InterFrameGap is required to protect the frame against
    hidden terminal collisions with the previous frame of a same flow that is
    still progressing along a common path.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">
    The Inter-Frame Gap is useful even for unfragmented datagrams, but it
    becomes a necessity for fragments that are typically generated in a fast
    sequence and are all sent over the exact same path.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
</section>
<div id="mod">
<section id="section-4.3">
        <h3 id="name-modifying-the-first-fragmen">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-modifying-the-first-fragmen" class="section-name selfRef">Modifying the First Fragment</a>
        </h3>
<p id="section-4.3-1">
    The compression of the Hop Limit, of the source and destination addresses
    in the IPv6 Header, and of the Routing Header, may change en-route in a
    Route-Over mesh LLN.
    If the size of the first fragment is modified, then the intermediate node
    MUST adapt the datagram_size to reflect that difference.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">
    The intermediate node MUST also save the difference of datagram_size of the
    first fragment in the VRB and add it to the datagram_size and to the
    fragment_offset of all the subsequent fragments for that datagram.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
<div id="dispatch">
<section id="section-5">
      <h2 id="name-new-dispatch-types-and-head">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-new-dispatch-types-and-head" class="section-name selfRef">New Dispatch types and headers</a>
      </h2>
<p id="section-5-1"> This specification enables the 6LoWPAN fragmentation sublayer to
    provide an MTU up to 2048 bytes to the upper layer, which can be the
    6LoWPAN Header Compression sublayer
    that is defined in the <span><a href="#RFC6282" class="xref">"Compression Format for IPv6
    Datagrams"</a> [<a href="#RFC6282" class="xref">RFC6282</a>]</span> specification. In order to achieve this, this specification
    enables the fragmentation and the reliable transmission of fragments over a
    multihop 6LoWPAN mesh network.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">
     This specification provides a technique that is derived from MPLS to
     forward individual fragments across a 6LoWPAN route-over mesh without
     reassembly at each hop.
     The datagram_tag is used as a label; it is locally unique to the
     node that owns the source MAC address of the fragment, so together
     the MAC address and the label can identify the fragment globally.
     A node may build the datagram_tag in its own locally-significant way,
     as long as the chosen datagram_tag stays unique to the particular datagram
     for the lifetime of that datagram.
     It results that the label does not need to be globally unique but also
     that it must be swapped at each hop as the source MAC address changes.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">This specification extends <span><a href="#RFC4944" class="xref">RFC 4944</a> [<a href="#RFC4944" class="xref">RFC4944</a>]</span>
 with 2 new Dispatch types, for Recoverable Fragment (RFRAG)
    and for the RFRAG Acknowledgment back.

    The new 6LoWPAN Dispatch types are taken from Page 0
    <span>[<a href="#RFC8025" class="xref">RFC8025</a>]</span> as indicated in <a href="#difig" class="xref">Table 1</a>
    in <a href="#ianacon" class="xref">Section 9</a>.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">
 In the following sections, a "datagram_tag" extends the semantics defined in
    <span>[<a href="#RFC4944" class="xref">RFC4944</a>]</span> Section 5.3."Fragmentation Type and Header".
    The datagram_tag is a locally unique identifier for the datagram from the
    perspective of the sender. This means that the datagram_tag identifies a
    datagram uniquely in the network when associated with the source of the
    datagram. As the datagram gets forwarded, the source changes and the
    datagram_tag must be swapped as detailed in
    <span>[<a href="#I-D.ietf-6lo-minimal-fragment" class="xref">I-D.ietf-6lo-minimal-fragment</a>]</span>.<a href="#section-5-4" class="pilcrow">¶</a></p>
<div id="RF2">
<section id="section-5.1">
        <h3 id="name-recoverable-fragment-dispat">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-recoverable-fragment-dispat" class="section-name selfRef">Recoverable Fragment Dispatch type and Header </a>
        </h3>
<p id="section-5.1-1">
 In this specification, if the packet is compressed then the size and offset
    of the fragments are expressed on the Compressed Form of the packet form as
    opposed to the uncompressed - native - packet form.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">
 The format of the fragment header is shown in <a href="#RFfigalt" class="xref">Figure 1</a>.
    It is the same for all fragments. The format has a length and an offset, as
    well as a sequence field. This would be redundant if the offset was computed
    as the product of the sequence by the length, but this is not the case.
    The position of a fragment in the
    reassembly buffer is neither correlated with the value of the sequence
    field nor with the order in which the fragments are received.
    This enables out-of-sequence subfragmenting, e.g., a fragment seq. 5 that is
    retried end-to-end as smaller fragments seq. 5, 13 and 14 due to a change of
    MTU along the path between the 6LoWPAN endpoints.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<span id="name-rfrag-dispatch-type-and-hea"></span><div id="RFfigalt">
<figure id="figure-1">
          <div class="artwork art-text alignCenter" id="section-5.1-3.1">
<pre>
                          1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
                                    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                    |1 1 1 0 1 0 0|E|  datagram_tag |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |X| sequence|   fragment_size   |       fragment_offset         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                                             X set == Ack-Request
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-rfrag-dispatch-type-and-hea" class="selfRef">RFRAG Dispatch type and Header</a>
          </figcaption></figure>
</div>
<p id="section-5.1-4">
    There is no requirement on the receiver to check for contiguity of the
    received fragments, and the sender MUST ensure that when all fragments
    are acknowledged, then the datagram is fully received.
    This may be useful in particular in the case where the MTU changes and a
    fragment sequence is retried with a smaller fragment_size, the remainder of
    the original fragment being retried with new sequence values.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5">
    The first fragment is recognized by a sequence of 0; it carries its
    fragment_size and the datagram_size of the compressed packet before it is
    fragmented, whereas the other fragments carry their fragment_size and
    fragment_offset. The last fragment
    for a datagram is recognized when its fragment_offset and its fragment_size
    add up to the datagram_size.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1-6">
 Recoverable Fragments are sequenced and a bitmap is used in the RFRAG
    Acknowledgment to indicate the received fragments by setting the individual
    bits that correspond to their sequence.<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<dl class="dlParallel" id="section-5.1-7">
          <dt id="section-5.1-7.1">X:</dt>
          <dd id="section-5.1-7.2">1 bit; Ack-Request: when set, the sender requires an
       RFRAG Acknowledgment from the receiver.<a href="#section-5.1-7.2" class="pilcrow">¶</a>
</dd>
<dt id="section-5.1-7.3">E:</dt>
          <dd id="section-5.1-7.4">1 bit; Explicit Congestion Notification; the "E"
       flag is reset by the source of the fragment and set by intermediate
       routers to signal that this fragment experienced congestion along
       its path.<a href="#section-5.1-7.4" class="pilcrow">¶</a>
</dd>
<dt id="section-5.1-7.5">Fragment_size:</dt>
          <dd id="section-5.1-7.6">10 bit unsigned integer; the size of this
       fragment in a unit that depends on the MAC layer technology. Unless
       overridden by a more specific specification, that unit is the octet which
       allows fragments up to 512 bytes.<a href="#section-5.1-7.6" class="pilcrow">¶</a>
</dd>
<dt id="section-5.1-7.7">datagram_tag:</dt>
          <dd id="section-5.1-7.8">8 bits; an identifier of the datagram that
       is locally unique to the sender.<a href="#section-5.1-7.8" class="pilcrow">¶</a>
</dd>
<dt id="section-5.1-7.9">Sequence:</dt>
          <dd id="section-5.1-7.10">5 bit unsigned integer;
       the sequence number of the fragment in the acknowledgement bitmap.
       Fragments are numbered [0..N] where N is in [0..31].
       A Sequence of 0 indicates the first fragment in a datagram, but non-zero
       values are not indicative of the position in the reassembly buffer.<a href="#section-5.1-7.10" class="pilcrow">¶</a>
</dd>
<dt id="section-5.1-7.11">Fragment_offset:</dt>
          <dd id="section-5.1-7.12">
            <p id="section-5.1-7.12.1">16 bit unsigned integer.<a href="#section-5.1-7.12.1" class="pilcrow">¶</a></p>
<p id="section-5.1-7.12.2">
       When the Fragment_offset is set to a non-0 value, its semantics depend
       on the value of the Sequence field as follows:<a href="#section-5.1-7.12.2" class="pilcrow">¶</a></p>
<ul>
<li id="section-5.1-7.12.3.1">
       For a first fragment (i.e. with a Sequence of 0), this field indicates
       the datagram_size of the compressed datagram, to help the receiver
       allocate an adapted buffer for the reception and reassembly operations.
       The fragment may be stored for local reassembly. Alternatively, it may be
       routed based on the destination IPv6 address. In that case, a VRB state
       must be installed as described in <a href="#ff" class="xref">Section 6.1.1</a>.<a href="#section-5.1-7.12.3.1" class="pilcrow">¶</a>
</li>
              <li id="section-5.1-7.12.3.2">
       When the Sequence is not 0, this field indicates the offset of the
       fragment in the Compressed Form of the datagram. The fragment may be
       added to a local reassembly buffer or forwarded based on an existing
       VRB as described in <a href="#nf" class="xref">Section 6.1.2</a>.<a href="#section-5.1-7.12.3.2" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-5.1-7.12.4">
       A Fragment_offset that is set to a value of 0 indicates
       an abort condition and all state regarding the datagram should be
       cleaned up once the processing of the fragment is complete;
       the processing of the fragment depends on whether there is a VRB already
       established for this datagram, and the next hop is still reachable:<a href="#section-5.1-7.12.4" class="pilcrow">¶</a></p>
<ul>
<li id="section-5.1-7.12.5.1">
       if a VRB already exists and is not broken, the fragment is to be
       forwarded along the associated Label Switched Path (LSP)
       as described in <a href="#nf" class="xref">Section 6.1.2</a>, but
       regardless of the value of the Sequence field;<a href="#section-5.1-7.12.5.1" class="pilcrow">¶</a>
</li>
              <li id="section-5.1-7.12.5.2">
       else, if the Sequence is 0, then the fragment is to be routed as
       described in <a href="#ff" class="xref">Section 6.1.1</a> but no state is conserved afterwards.
       In that case, the session if it exists is aborted and the packet is
       also forwarded in an attempt to clean up the next hops as along the
       path indicated by the IPv6 header (possibly including a routing header).<a href="#section-5.1-7.12.5.2" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-5.1-7.12.6">
       If the fragment cannot be forwarded or routed, then an abort RFRAG-ACK
       is sent back to the source as described in <a href="#nf" class="xref">Section 6.1.2</a>.<a href="#section-5.1-7.12.6" class="pilcrow">¶</a></p>
</dd>
</dl>
</section>
</div>
<div id="ackfrag">
<section id="section-5.2">
        <h3 id="name-rfrag-acknowledgment-dispat">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-rfrag-acknowledgment-dispat" class="section-name selfRef">RFRAG Acknowledgment Dispatch type and Header</a>
        </h3>
<p id="section-5.2-1">This specification also defines a 4-octet RFRAG Acknowledgment bitmap
       that is used by the reassembling endpoint
       to confirm selectively the reception of individual fragments.
       A given offset in the bitmap maps one to one with a given sequence number
       and indicates which fragment is acknowledged as follows:<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<span id="name-rfrag-acknowledgment-bitmap"></span><div id="dCack3">
<figure id="figure-2">
          <div class="artwork art-text alignCenter" id="section-5.2-2.1">
<pre>
                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |           RFRAG Acknowledgment Bitmap                         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ^                 ^
     |                 |    bitmap indicating whether:
     |                 +----- Fragment with sequence 9 was received
     +----------------------- Fragment with sequence 0 was received
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-rfrag-acknowledgment-bitmap" class="selfRef">RFRAG Acknowledgment bitmap encoding</a>
          </figcaption></figure>
</div>
<p id="section-5.2-3"><a href="#dCack2" class="xref">Figure 3</a> shows an example Acknowledgment bitmap which
       indicates that all fragments from sequence 0 to 20 were received, except
       for fragments 1, 2 and 16 that were lost and must be retried.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<span id="name-example-rfrag-acknowledgmen"></span><div id="dCack2">
<figure id="figure-3">
          <div class="artwork art-text alignCenter" id="section-5.2-4.1">
<pre>
                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |1|0|0|1|1|1|1|1|1|1|1|1|1|1|1|1|0|1|1|1|1|0|0|0|0|0|0|0|0|0|0|0|
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-example-rfrag-acknowledgmen" class="selfRef">Example RFRAG Acknowledgment  Bitmap</a>
          </figcaption></figure>
</div>
<p id="section-5.2-5">The RFRAG Acknowledgment Bitmap is included in
 a RFRAG Acknowledgment header, as follows:<a href="#section-5.2-5" class="pilcrow">¶</a></p>
<span id="name-rfrag-acknowledgment-dispatc"></span><div id="ackfig">
<figure id="figure-4">
          <div class="artwork art-text alignCenter" id="section-5.2-6.1">
<pre>

                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
                                    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                    |1 1 1 0 1 0 1|E|  datagram_tag |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |          RFRAG Acknowledgment Bitmap (32 bits)                |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

 </pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-rfrag-acknowledgment-dispatc" class="selfRef">RFRAG Acknowledgment Dispatch type and Header</a>
          </figcaption></figure>
</div>
<dl class="dlParallel" id="section-5.2-7">
          <dt id="section-5.2-7.1">E:</dt>
          <dd id="section-5.2-7.2">1 bit; Explicit Congestion Notification Echo<a href="#section-5.2-7.2" class="pilcrow">¶</a>
</dd>
<dt id="section-5.2-7.3"></dt>
          <dd id="section-5.2-7.4">When set, the sender indicates that at least one of the acknowledged fragments
 was received with an Explicit Congestion Notification, indicating that the
 path followed by the fragments is subject to congestion. More in
        <a href="#onECN" class="xref">Appendix C</a>.<a href="#section-5.2-7.4" class="pilcrow">¶</a>
</dd>
<dt id="section-5.2-7.5">RFRAG Acknowledgment Bitmap:</dt>
          <dd id="section-5.2-7.6">An RFRAG Acknowledgment Bitmap, whereby setting the bit at offset x
        indicates that fragment x was received, as shown in <a href="#dCack3" class="xref">Figure 2</a>.
        A NULL bitmap that indicates that the fragmentation process is aborted.
        A FULL bitmap that indicates that the fragmentation process is complete,
        all fragments were received at the reassembly endpoint.<a href="#section-5.2-7.6" class="pilcrow">¶</a>
</dd>
</dl>
</section>
</div>
</section>
</div>
<div id="ffc">
<section id="section-6">
      <h2 id="name-fragments-recovery">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-fragments-recovery" class="section-name selfRef">Fragments Recovery</a>
      </h2>
<p id="section-6-1">
 The Recoverable Fragment header RFRAG is used to transport
    a fragment and optionally request an RFRAG Acknowledgment that will confirm
    the good reception of one or more fragments.
    An RFRAG Acknowledgment is carried as a standalone fragment header (i.e.
    with no 6LoWPAN payload) in a message that is propagated back to the
    6LoWPAN endpoint that was the originator of the fragments.
    To achieve this, each hop that performed an MPLS-like operation on fragments
    reverses that operation for the RFRAG_ACK by sending a frame from the next
    hop to the previous hop as known by its MAC address in the VRB.
    The datagram_tag in the RFRAG_ACK is unique to the receiver and is enough
    information for an intermediate hop to locate the VRB that contains the
    datagram_tag used by the previous hop and the Layer-2 information associated
    to it (interface and MAC address).<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2"> The 6LoWPAN endpoint that fragments the packets at 6LoWPAN level
    (the sender) also controls the amount of
    acknowledgments by setting the Ack-Request flag in the RFRAG packets.
    The sender may set the Ack-Request flag on any fragment to perform
    congestion  control by limiting the number of outstanding fragments, which
    are  the fragments that have been sent but for which reception or loss
    was not positively confirmed by the reassembling endpoint. The maximum
    number of outstanding fragments is the Window-Size. It is configurable and
    may vary in case of ECN notification.
    When the 6LoWPAN endpoint that reassembles the packets at 6LoWPAN level (the
    receiver) receives a fragment with the Ack-Request flag set, it MUST send an
    RFRAG Acknowledgment back to the originator to confirm reception of all the
    fragments it has received so far.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">
    The Ack-Request ('X') set in an RFRAG marks the end of a window. This flag
    MUST be set on the last fragment if the sender wishes to protect the datagram,
    and it MAY be set in any intermediate fragment for the purpose of flow control.
    This ARQ process MUST be protected by a timer, and the fragment that carries the 'X'
    flag MAY be retried upon time out a configurable amount of times (see
    <a href="#protp" class="xref">Section 7.1</a>).
    Upon exhaustion of the retries the sender may either abort the
    transmission of the datagram or retry the datagram from the first
    fragment with an 'X' flag set in order to reestablish a path and discover
    which fragments were received over the old path in the acknowledgment bitmap.
 When the sender of the fragment knows that an underlying link-layer
    mechanism protects the fragments, it may refrain from using the RFRAG
    Acknowledgment mechanism, and never set the Ack-Request bit.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">
    The RFRAG Acknowledgment can optionally carry an ECN indication for flow
    control (see <a href="#onECN" class="xref">Appendix C</a>). The receiver of a fragment with the
    'E' (ECN) flag set MUST echo that information by setting the 'E' (ECN) flag
    in the next RFRAG Acknowledgment.<a href="#section-6-4" class="pilcrow">¶</a></p>
<p id="section-6-5">
 In order to protect the datagram, the sender transfers a controlled number of fragments and flags the last
 fragment of a window with an RFRAG Acknowledgment Request. The receiver MUST
    acknowledge a
 fragment with the acknowledgment request bit set. If any fragment immediately preceeding
 an acknowledgment request is still missing, the receiver MAY intentionally
 delay its acknowledgment to allow in-transit fragments to arrive.
    Because it might defeat the round trip delay computation, delaying the
    acknowledgment should be configurable and not enabled by default.<a href="#section-6-5" class="pilcrow">¶</a></p>
<p id="section-6-6">The receiver MAY issue unsolicited acknowledgments.
    An unsolicited acknowledgment signals to the
 sender endpoint that it can resume sending if it had reached its maximum number
 of outstanding fragments. Another use is to inform that the reassembling
    endpoint aborted the process of an individual datagram.<a href="#section-6-6" class="pilcrow">¶</a></p>
<p id="section-6-7">
    When all the fragments are received, the receiving endpoint reconstructs
    the packet, passes it to the upper layer, sends a RFRAG Acknowledgment on
    the reverse path with a FULL bitmap, and arms a short timer to absorb
    fragments that are still in flight for that datagram without creating a new
    state and abort the communication if it keeps going on beyond a
    reasonable time.<a href="#section-6-7" class="pilcrow">¶</a></p>
<p id="section-6-8">
    Note that acknowledgments might consume precious resources so the use of
    unsolicited acknowledgments should be configurable and not enabled by
    default.<a href="#section-6-8" class="pilcrow">¶</a></p>
<p id="section-6-9">
    An observation is that streamlining forwarding of fragments generally
    reduces the latency over the LLN mesh, providing room for retries within
    existing upper-layer reliability mechanisms.
 The sender protects the transmission over the LLN mesh with a retry timer
    that is computed according to the method detailed in <span>[<a href="#RFC6298" class="xref">RFC6298</a>]</span>.
    It is expected that the upper layer retries obey the recommendations in
    <span><a href="#RFC8085" class="xref">"UDP Usage Guidelines"</a> [<a href="#RFC8085" class="xref">RFC8085</a>]</span>, in which case a single
    round of fragment recovery should fit within the upper layer recovery timers.<a href="#section-6-9" class="pilcrow">¶</a></p>
<p id="section-6-10">Fragments are sent in a round robin fashion: the sender sends all the fragments for a first time
 before it retries any lost fragment; lost fragments are retried in sequence, oldest first.
 This mechanism enables the receiver to acknowledge fragments that were delayed in the network
 before they are retried.<a href="#section-6-10" class="pilcrow">¶</a></p>
<p id="section-6-11">
    When a single frequency is used by contiguous hops, the sender should wait a reasonable amount of time
    between fragments so as to let a fragment progress a few hops and avoid hidden terminal issues.
    This precaution is not required on channel hopping technologies such as Time Slotted Channel Hopping (TSCH)
    <span>[<a href="#RFC6554" class="xref">RFC6554</a>]</span>, where nodes that communicate at Layer-2 are scheduled to send
    and receive respectively, and different hops operate on different channels.<a href="#section-6-11" class="pilcrow">¶</a></p>
<section id="section-6.1">
        <h3 id="name-forwarding-fragments">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-forwarding-fragments" class="section-name selfRef">Forwarding Fragments</a>
        </h3>
<p id="section-6.1-1">
    It is assumed that the first Fragment is large enough to carry the IPv6 header and make
    routing decisions. If that is not so, then this specification MUST NOT be used.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2"> This specification extends the Virtual Reassembly Buffer (VRB) technique
      to forward fragments with no intermediate reconstruction of the entire packet. It inherits operations like datagram_tag Switching and using a
      timer to clean the VRB when the traffic dries up. In more details,
      the first fragment carries the IP header and it is routed all the way
      from the fragmenting endpoint to the reassembling endpoint.
      Upon the first fragment, the routers along the path install a label-switched
      path (LSP), and the following fragments are label-switched along that path.
      As a consequence, the next fragments can only follow the path that was set
      up by the first fragment and cannot follow an alternate route.
      The datagram_tag is used to carry the label, that is swapped at each hop.
      All fragments follow the same path and fragments are delivered in the order
      at which they are sent.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<div id="ff">
<section id="section-6.1.1">
          <h4 id="name-upon-the-first-fragment">
<a href="#section-6.1.1" class="section-number selfRef">6.1.1. </a><a href="#name-upon-the-first-fragment" class="section-name selfRef">Upon the first fragment</a>
          </h4>
<p id="section-6.1.1-1">
 In Route-Over mode, the source and destination MAC addresses in a frame
    change at each hop.  The label that is formed and placed in the
    datagram_tag is associated to the source MAC and only valid (and unique)
    for that source MAC.
    Upon a first fragment (i.e. with a sequence of zero), an intermediate router
    creates a VRB and the associated
    LSP state for the tuple (source MAC address, datagram_tag) and the
    fragment is forwarded along the IPv6 route that matches the destination IPv6
    address in the IPv6 header as prescribed by
    <span>[<a href="#I-D.ietf-6lo-minimal-fragment" class="xref">I-D.ietf-6lo-minimal-fragment</a>]</span>, whereas the receiving
    endpoint allocates a reassembly buffer.<a href="#section-6.1.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1.1-2">
    The LSP state enables to
    match the (previous MAC address, datagram_tag) in an incoming fragment
    to the tuple (next MAC address, swapped datagram_tag) used in the
    forwarded fragment and points at the VRB.
    In addition, the router also forms a Reverse LSP state indexed by the MAC
    address of the next hop and the swapped datagram_tag. This reverse LSP state
    also points at the VRB and enables to match the (next MAC address,
    swapped_datagram_tag) found in an RFRAG Acknowledgment to the tuple
    (previous MAC address, datagram_tag) used when forwarding a Fragment
    Acknowledgment (RFRAG-ACK) back to the sender endpoint.<a href="#section-6.1.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1.1-3">The first fragment may be received a second time, indicating that it did
    not reach the destination and was retried. In that case, it SHOULD follow
    the same path as the first  occurrence. It is up to sending endpoint to abort
    a transmission and then retry it from scratch, which may build an entirely
    new path.<a href="#section-6.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="nf">
<section id="section-6.1.2">
          <h4 id="name-upon-the-next-fragments">
<a href="#section-6.1.2" class="section-number selfRef">6.1.2. </a><a href="#name-upon-the-next-fragments" class="section-name selfRef">Upon the next fragments</a>
          </h4>
<p id="section-6.1.2-1">Upon a next fragment (i.e. with a non-zero sequence), an intermediate router looks up
    a LSP indexed by the tuple (MAC address, datagram_tag) found in the fragment.
    If it is found, the router forwards the fragment using the associated VRB as
    prescribed by <span>[<a href="#I-D.ietf-6lo-minimal-fragment" class="xref">I-D.ietf-6lo-minimal-fragment</a>]</span>.<a href="#section-6.1.2-1" class="pilcrow">¶</a></p>
<p id="section-6.1.2-2"> if the VRB for the tuple is not found, the router builds an RFRAG-ACK
    to abort the transmission of the packet. The resulting message has the
 following information:<a href="#section-6.1.2-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-6.1.2-3.1">The source and destination MAC addresses are swapped from those found
        in the fragment<a href="#section-6.1.2-3.1" class="pilcrow">¶</a>
</li>
            <li id="section-6.1.2-3.2">The datagram_tag set to the datagram_tag found in the fragment<a href="#section-6.1.2-3.2" class="pilcrow">¶</a>
</li>
            <li id="section-6.1.2-3.3">A NULL bitmap is used to signal the abort condition<a href="#section-6.1.2-3.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-6.1.2-4">
 At this point the router is all set and can send the RFRAG-ACK back to
    the previous router. The RFRAG-ACK should normally be forwarded all the way
    to the source using the reverse LSP state in the VRBs in the intermediate
    routers as described in the next section.<a href="#section-6.1.2-4" class="pilcrow">¶</a></p>
<p id="section-6.1.2-5"><span>[<a href="#I-D.ietf-6lo-minimal-fragment" class="xref">I-D.ietf-6lo-minimal-fragment</a>]</span> indicates that the
    receiving endpoint stores
    "the actual packet data from the fragments received so far, in a form that
    makes it possible to detect when the whole packet has been received and can
    be processed or forwarded". How this is computed in implementation specific
    but relies on receiving all the bytes up to the datagram_size indicated in
    the first fragment.
    An implementation may receive overlapping fragments as the result of retries
    after an MTU change.<a href="#section-6.1.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
<div id="ura">
<section id="section-6.2">
        <h3 id="name-upon-the-rfrag-acknowledgme">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-upon-the-rfrag-acknowledgme" class="section-name selfRef">Upon the RFRAG Acknowledgments</a>
        </h3>
<p id="section-6.2-1">Upon an RFRAG-ACK, the router looks up a Reverse LSP indexed by the tuple
    (MAC address, datagram_tag), which are respectively the source MAC address
    of the received frame and the received datagram_tag.
    If it is found, the router forwards the fragment using the associated VRB as
    prescribed by <span>[<a href="#I-D.ietf-6lo-minimal-fragment" class="xref">I-D.ietf-6lo-minimal-fragment</a>]</span>, but using
    the Reverse LSP so that the RFRAG-ACK flows back to the sender endpoint.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">If the Reverse LSP is not found, the router MUST silently drop the RFRAG-ACK message.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2-3">Either way, if the RFRAG-ACK indicates that the fragment was entirely received (FULL bitmap), it arms a short timer, and upon timeout, the VRB and all the associated state are destroyed. Until the timer elapses, fragments of that datagram may still be received, e.g. if the RFRAG-ACK was lost on the way back and the source retried the last fragment. In that
    case, the router forwards the fragment according to the state in the VRB.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<p id="section-6.2-4">
    This specification does not provide a method to discover the number of hops
    or the minimal value of MTU along those hops. But should the minimal MTU
    decrease, it is possible to retry a long fragment (say sequence of 5) with
    first a shorter fragment of the same sequence (5 again) and then one or
    more other fragments with a sequence that was not used before (e.g., 13 and
    14). Note that Path MTU Discovery is out of scope for this document.<a href="#section-6.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-6.3">
        <h3 id="name-aborting-the-transmission-o">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-aborting-the-transmission-o" class="section-name selfRef">Aborting the Transmission of a Fragmented Packet</a>
        </h3>
<p id="section-6.3-1">
 A reset is signaled on the forward path with a pseudo fragment that has the fragment_offset,
 sequence and fragment_size all set to 0, and no data.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">
    When the sender or a router on the way decides that a packet should be dropped and the fragmentation process aborted, it generates a reset pseudo fragment and forwards it down the fragment path.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3">Each router next along the path the way forwards the pseudo fragment based on the VRB state. If an acknowledgment is not requested, the VRB and all associated state are destroyed.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
<p id="section-6.3-4">
 Upon reception of the pseudo fragment, the receiver cleans up all resources for the packet
 associated to the datagram_tag. If an acknowledgment is requested, the receiver responds with a NULL bitmap.<a href="#section-6.3-4" class="pilcrow">¶</a></p>
<p id="section-6.3-5">The other way around, the receiver might need to abort the process of a fragmented packet for internal reasons, for instance if it is out of reassembly buffers, already uses all 256 possible values of the datagram_tag, or if it keeps receiving fragments beyond a reasonable time while it considers that this packet is already fully reassembled and was passed to the upper layer. In that case, the receiver SHOULD indicate so to the sender with a NULL bitmap in a RFRAG Acknowledgment. The RFRAG Acknowledgment is frowarded all the way back to the source of the packet and cleans up all resources on the way.
 Upon an acknowledgment with a NULL bitmap, the sender endpoint MUST abort the transmission of the fragmented datagram with one exception: In the particular case of the first fragment, it MAY decide to retry via an alternate next hop instead.<a href="#section-6.3-5" class="pilcrow">¶</a></p>
</section>
<section id="section-6.4">
        <h3 id="name-applying-recoverable-fragme">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-applying-recoverable-fragme" class="section-name selfRef">Applying Recoverable Fragmentation along a Diverse Path</a>
        </h3>
<p id="section-6.4-1">
    The text above can be read with the assumption of a serial path between a
    source and a destination. Section 4.5.3 of the
    <span><a href="#I-D.ietf-6tisch-architecture" class="xref">"6TiSCH Architecture"</a> [<a href="#I-D.ietf-6tisch-architecture" class="xref">I-D.ietf-6tisch-architecture</a>]</span>
    defines the concept of a Track that can be a complex path between a source
    and a destination with Packet ARQ, Replication, Elimination and Overhearing
    (PAREO) along the Track. This specification can be used along any subset of
    the complex Track where the first fragment is flooded. The last RFRAG
    Acknowledgment is flooded on that same subset in the reverse direction.
    Intermediate RFRAG Acknowledgments can be flooded on any sub-subset of that
    reverse subset that reach back to the source.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<section id="section-7">
      <h2 id="name-management-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-management-considerations" class="section-name selfRef">Management Considerations</a>
      </h2>
<div id="protp">
<section id="section-7.1">
        <h3 id="name-protocol-parameters">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-protocol-parameters" class="section-name selfRef">Protocol Parameters</a>
        </h3>
<p id="section-7.1-1">
    There is no particular configuration on the receiver, as echoing ECN
    is always on. The configuration only applies to the sender, which
    is in control of the transmission. The management system SHOULD be capable
    of providing the parameters below:<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<dl class="dlParallel" id="section-7.1-2">
          <dt id="section-7.1-2.1">MinFragmentSize:</dt>
          <dd id="section-7.1-2.2">
       The MinFragmentSize is the minimum value for the Fragment_Size.<a href="#section-7.1-2.2" class="pilcrow">¶</a>
</dd>
<dt id="section-7.1-2.3">OptFragmentSize:</dt>
          <dd id="section-7.1-2.4">
       The MinFragmentSize is the value for the Fragment_Size that the sender
       should use to start with.<a href="#section-7.1-2.4" class="pilcrow">¶</a>
</dd>
<dt id="section-7.1-2.5">MaxFragmentSize:</dt>
          <dd id="section-7.1-2.6">
       The MaxFragmentSize is the maximum value for the Fragment_Size.
       It MUST be lower than the minimum MTU along the path. A large
       value augments the chances of buffer bloat and transmission loss.
       The value MUST be less than 512 if the unit that is defined
       for the PHY layer is the octet.<a href="#section-7.1-2.6" class="pilcrow">¶</a>
</dd>
<dt id="section-7.1-2.7">UseECN:</dt>
          <dd id="section-7.1-2.8">
       Indicates whether the sender should react to ECN.
       When the sender reacts to ECN the Window_Size will vary between
       MinWindowSize and MaxWindowSize.<a href="#section-7.1-2.8" class="pilcrow">¶</a>
</dd>
<dt id="section-7.1-2.9">MinWindowSize:</dt>
          <dd id="section-7.1-2.10">
       The minimum value of Window_Size that the sender can use.<a href="#section-7.1-2.10" class="pilcrow">¶</a>
</dd>
<dt id="section-7.1-2.11">OptWindowSize:</dt>
          <dd id="section-7.1-2.12">
       The OptWindowSize is the value for the Window_Size that the sender
       should use to start with.<a href="#section-7.1-2.12" class="pilcrow">¶</a>
</dd>
<dt id="section-7.1-2.13">MaxWindowSize:</dt>
          <dd id="section-7.1-2.14">
       The maximum value of Window_Size that the sender can use. The value
       MUSt be less than 32.<a href="#section-7.1-2.14" class="pilcrow">¶</a>
</dd>
<dt id="section-7.1-2.15">InterFrameGap:</dt>
          <dd id="section-7.1-2.16">
       Indicates a minimum amount of time between transmissions. All packets
       to a same destination, and in particular fragments, may be subject to
       receive while transmitting and hidden terminal collisions with the next or the previous transmission as the fragments progress along a same path. The InterFrameGap protects the propagation of one transmission before the next one is triggered and creates a duty cycle that controls the ratio of air time and memory in intermediate nodes that a particular datagram will use.<a href="#section-7.1-2.16" class="pilcrow">¶</a>
</dd>
<dt id="section-7.1-2.17">MinARQTimeOut:</dt>
          <dd id="section-7.1-2.18">
       The maximum amount of time a node should wait for an RFRAG Acknowledgment
       before it takes a next action.<a href="#section-7.1-2.18" class="pilcrow">¶</a>
</dd>
<dt id="section-7.1-2.19">OptARQTimeOut:</dt>
          <dd id="section-7.1-2.20">
       The starting point of the value of the amount  that a sender should wait
       for an RFRAG Acknowledgment before it takes a next action.<a href="#section-7.1-2.20" class="pilcrow">¶</a>
</dd>
<dt id="section-7.1-2.21">MaxARQTimeOut:</dt>
          <dd id="section-7.1-2.22">
       The maximum amount of time a node should wait for an RFRAG Acknowledgment
       before it takes a next action.<a href="#section-7.1-2.22" class="pilcrow">¶</a>
</dd>
<dt id="section-7.1-2.23">MaxFragRetries:</dt>
          <dd id="section-7.1-2.24">
       The maximum number of retries for a particular Fragment.<a href="#section-7.1-2.24" class="pilcrow">¶</a>
</dd>
<dt id="section-7.1-2.25">MaxDatagramRetries:</dt>
          <dd id="section-7.1-2.26">
       The maximum number of retries from scratch for a particular Datagram.<a href="#section-7.1-2.26" class="pilcrow">¶</a>
</dd>
</dl>
<p id="section-7.1-3"><a href="#section-7.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-7.2">
        <h3 id="name-observing-the-network">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-observing-the-network" class="section-name selfRef">Observing the network</a>
        </h3>
<p id="section-7.2-1">The management system should monitor the amount of retries
    and of ECN settings that can be observed from the perspective of the
    both the sender and the receiver, and may tune the optimum size of Fragment_Size and of the Window_Size, OptWindowSize and OptWindowSize respectively, at the sender. The values should be bounded by the expected number of hops and reduced beyond that when the number of datagrams that can
    traverse an intermediate point may exceed its capacity and cause a
    congestion loss. The InterFrameGap is another tool that can be used to
    increase the spacing between fragments of a same datagram and reduce the
    ratio of time when a particular intermediate node holds a fragment of that datagram.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">The considerations in the Security sections of
    <span>[<a href="#I-D.ietf-core-cocoa" class="xref">I-D.ietf-core-cocoa</a>]</span> and
    <span>[<a href="#I-D.ietf-6lo-minimal-fragment" class="xref">I-D.ietf-6lo-minimal-fragment</a>]</span> apply equally to this
    specification.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2"> The process of recovering fragments does not appear to create any opening
    for new threat compared to
 <span><a href="#RFC4944" class="xref"> "Transmission of IPv6 Packets over IEEE 802.15.4 Networks"</a> [<a href="#RFC4944" class="xref">RFC4944</a>]</span>
    beyond the change of size of the datagram_tag. By reducing to 8 bits, the
    tag will wrap faster than with <span>[<a href="#RFC4944" class="xref">RFC4944</a>]</span>.
    But for a constrained network where a node is expected to be able to hold
    only one or a few large packets in memory, 256 is still a large number.
    Also, the acknowledgement mechanism allows ot clean up the state rapidly
    once the packet is fully transmitted or aborted.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">
    The abstract Virtual Recovery Buffer inherited from
    <span>[<a href="#I-D.ietf-6lo-minimal-fragment" class="xref">I-D.ietf-6lo-minimal-fragment</a>]</span> may be used to perform a
    Denial-of-Service (DoS) attack against the intermediate Routers since the
    routers need to maintain a state per flow. The particular VRB implementation
    technique described in
    <span>[<a href="#I-D.ietf-lwig-6lowpan-virtual-reassembly" class="xref">I-D.ietf-lwig-6lowpan-virtual-reassembly</a>]</span> allows to realign
    which data goes in which fragment which causes the intermediate node to
    store a portion of the data, which adds an attack vector that is not present
    with this specification. With this specification, the data that is
    transported in each fragment is conserved and the state to keep does not
    include any data that would not fit in the previous fragment.<a href="#section-8-3" class="pilcrow">¶</a></p>
</section>
<div id="ianacon">
<section id="section-9">
      <h2 id="name-iana-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-9-1">

    This document allocates 4 values in Page 0 for recoverable fragments from the
   "Dispatch Type Field" registry that was created by <span><a href="#RFC4944" class="xref">
 "Transmission of IPv6 Packets over IEEE 802.15.4 Networks"</a> [<a href="#RFC4944" class="xref">RFC4944</a>]</span> and
     reformatted by <span><a href="#RFC8025" class="xref">"6LoWPAN Paging Dispatch"</a> [<a href="#RFC8025" class="xref">RFC8025</a>]</span>.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">
    The suggested values (to be confirmed by IANA) are indicated in
    <a href="#difig" class="xref">Table 1</a>.<a href="#section-9-2" class="pilcrow">¶</a></p>
<span id="name-additional-dispatch-value-b"></span><div id="difig">
<table class="center" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-additional-dispatch-value-b" class="selfRef">Additional Dispatch Value Bit Patterns</a>
        </caption>
<thead>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Bit Pattern</td>
            <td class="text-left" rowspan="1" colspan="1">Page</td>
            <td class="text-center" rowspan="1" colspan="1">Header Type</td>
            <td class="text-left" rowspan="1" colspan="1">Reference</td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">11  10100x</td>
            <td class="text-left" rowspan="1" colspan="1">0</td>
            <td class="text-left" rowspan="1" colspan="1">RFRAG - Recoverable Fragment</td>
            <td class="text-left" rowspan="1" colspan="1">THIS RFC</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">11  10101x</td>
            <td class="text-left" rowspan="1" colspan="1">0</td>
            <td class="text-left" rowspan="1" colspan="1">RFRAG-ACK - RFRAG Acknowledgment</td>
            <td class="text-left" rowspan="1" colspan="1">THIS RFC</td>
          </tr>
        </tbody>
      </table>
</div>
</section>
</div>
<section id="section-10">
      <h2 id="name-acknowledgments">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-10-1">The author wishes to thank Michel Veillette, Dario Tedeschi, Laurent Toutain,
Carles Gomez Montenegro, Thomas Watteyne and Michael Richardson for in-depth
reviews and comments.
Also many thanks to Jonathan Hui, Jay Werb, Christos Polyzois, Soumitri Kolavennu,
Pat Kinney, Margaret Wasserman, Richard Kelsey, Carsten Bormann and
Harry Courtice for their various contributions.<a href="#section-10-1" class="pilcrow">¶</a></p>
</section>
<section id="section-11">
      <h2 id="name-normative-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dt id="RFC4944">[RFC4944]</dt>
      <dd>
<span class="refAuthor">Montenegro, G.</span><span class="refAuthor">, Kushalnagar, N.</span><span class="refAuthor">, Hui, J.</span><span class="refAuthor">, and D. Culler</span>, <span class="refTitle">"Transmission of IPv6 Packets over IEEE 802.15.4 Networks"</span>, <span class="seriesInfo">RFC 4944</span>, <span class="seriesInfo">DOI 10.17487/RFC4944</span>, <time datetime="2007-09">September 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4944">https://www.rfc-editor.org/info/rfc4944</a>&gt;</span>. </dd>
<dt id="RFC6282">[RFC6282]</dt>
      <dd>
<span class="refAuthor">Hui, J., Ed.</span><span class="refAuthor"> and P. Thubert</span>, <span class="refTitle">"Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks"</span>, <span class="seriesInfo">RFC 6282</span>, <span class="seriesInfo">DOI 10.17487/RFC6282</span>, <time datetime="2011-09">September 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6282">https://www.rfc-editor.org/info/rfc6282</a>&gt;</span>. </dd>
<dt id="RFC6554">[RFC6554]</dt>
      <dd>
<span class="refAuthor">Hui, J.</span><span class="refAuthor">, Vasseur, JP.</span><span class="refAuthor">, Culler, D.</span><span class="refAuthor">, and V. Manral</span>, <span class="refTitle">"An IPv6 Routing Header for Source Routes with the Routing Protocol for Low-Power and Lossy Networks (RPL)"</span>, <span class="seriesInfo">RFC 6554</span>, <span class="seriesInfo">DOI 10.17487/RFC6554</span>, <time datetime="2012-03">March 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6554">https://www.rfc-editor.org/info/rfc6554</a>&gt;</span>. </dd>
<dt id="RFC8025">[RFC8025]</dt>
      <dd>
<span class="refAuthor">Thubert, P., Ed.</span><span class="refAuthor"> and R. Cragie</span>, <span class="refTitle">"IPv6 over Low-Power Wireless Personal Area Network (6LoWPAN) Paging Dispatch"</span>, <span class="seriesInfo">RFC 8025</span>, <span class="seriesInfo">DOI 10.17487/RFC8025</span>, <time datetime="2016-11">November 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8025">https://www.rfc-editor.org/info/rfc8025</a>&gt;</span>. </dd>
<dt id="RFC8138">[RFC8138]</dt>
      <dd>
<span class="refAuthor">Thubert, P., Ed.</span><span class="refAuthor">, Bormann, C.</span><span class="refAuthor">, Toutain, L.</span><span class="refAuthor">, and R. Cragie</span>, <span class="refTitle">"IPv6 over Low-Power Wireless Personal Area Network (6LoWPAN) Routing Header"</span>, <span class="seriesInfo">RFC 8138</span>, <span class="seriesInfo">DOI 10.17487/RFC8138</span>, <time datetime="2017-04">April 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8138">https://www.rfc-editor.org/info/rfc8138</a>&gt;</span>. </dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dt id="I-D.ietf-6lo-minimal-fragment">[I-D.ietf-6lo-minimal-fragment]</dt>
    <dd>
<span class="refAuthor">Watteyne, T.</span><span class="refAuthor">, Bormann, C.</span><span class="refAuthor">, and P. Thubert</span>, <span class="refTitle">"6LoWPAN Fragment Forwarding"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-6lo-minimal-fragment-04</span>, <time datetime="2019-09-02">2 September 2019</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-6lo-minimal-fragment-04">https://tools.ietf.org/html/draft-ietf-6lo-minimal-fragment-04</a>&gt;</span>. </dd>
</dl>
</section>
<section id="section-12">
      <h2 id="name-informative-references">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
      </h2>
<dl class="references">
<dt id="RFC8201">[RFC8201]</dt>
      <dd>
<span class="refAuthor">McCann, J.</span><span class="refAuthor">, Deering, S.</span><span class="refAuthor">, Mogul, J.</span><span class="refAuthor">, and R. Hinden, Ed.</span>, <span class="refTitle">"Path MTU Discovery for IP version 6"</span>, <span class="seriesInfo">STD 87</span>, <span class="seriesInfo">RFC 8201</span>, <span class="seriesInfo">DOI 10.17487/RFC8201</span>, <time datetime="2017-07">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8201">https://www.rfc-editor.org/info/rfc8201</a>&gt;</span>. </dd>
<dt id="RFC7567">[RFC7567]</dt>
      <dd>
<span class="refAuthor">Baker, F., Ed.</span><span class="refAuthor"> and G. Fairhurst, Ed.</span>, <span class="refTitle">"IETF Recommendations Regarding Active Queue Management"</span>, <span class="seriesInfo">BCP 197</span>, <span class="seriesInfo">RFC 7567</span>, <span class="seriesInfo">DOI 10.17487/RFC7567</span>, <time datetime="2015-07">July 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7567">https://www.rfc-editor.org/info/rfc7567</a>&gt;</span>. </dd>
<dt id="RFC3031">[RFC3031]</dt>
      <dd>
<span class="refAuthor">Rosen, E.</span><span class="refAuthor">, Viswanathan, A.</span><span class="refAuthor">, and R. Callon</span>, <span class="refTitle">"Multiprotocol Label Switching Architecture"</span>, <span class="seriesInfo">RFC 3031</span>, <span class="seriesInfo">DOI 10.17487/RFC3031</span>, <time datetime="2001-01">January 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3031">https://www.rfc-editor.org/info/rfc3031</a>&gt;</span>. </dd>
<dt id="RFC5681">[RFC5681]</dt>
      <dd>
<span class="refAuthor">Allman, M.</span><span class="refAuthor">, Paxson, V.</span><span class="refAuthor">, and E. Blanton</span>, <span class="refTitle">"TCP Congestion Control"</span>, <span class="seriesInfo">RFC 5681</span>, <span class="seriesInfo">DOI 10.17487/RFC5681</span>, <time datetime="2009-09">September 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5681">https://www.rfc-editor.org/info/rfc5681</a>&gt;</span>. </dd>
<dt id="RFC2914">[RFC2914]</dt>
      <dd>
<span class="refAuthor">Floyd, S.</span>, <span class="refTitle">"Congestion Control Principles"</span>, <span class="seriesInfo">BCP 41</span>, <span class="seriesInfo">RFC 2914</span>, <span class="seriesInfo">DOI 10.17487/RFC2914</span>, <time datetime="2000-09">September 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2914">https://www.rfc-editor.org/info/rfc2914</a>&gt;</span>. </dd>
<dt id="RFC3168">[RFC3168]</dt>
      <dd>
<span class="refAuthor">Ramakrishnan, K.</span><span class="refAuthor">, Floyd, S.</span><span class="refAuthor">, and D. Black</span>, <span class="refTitle">"The Addition of Explicit Congestion Notification (ECN) to IP"</span>, <span class="seriesInfo">RFC 3168</span>, <span class="seriesInfo">DOI 10.17487/RFC3168</span>, <time datetime="2001-09">September 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3168">https://www.rfc-editor.org/info/rfc3168</a>&gt;</span>. </dd>
<dt id="RFC4919">[RFC4919]</dt>
      <dd>
<span class="refAuthor">Kushalnagar, N.</span><span class="refAuthor">, Montenegro, G.</span><span class="refAuthor">, and C. Schumacher</span>, <span class="refTitle">"IPv6 over Low-Power Wireless Personal Area Networks (6LoWPANs): Overview, Assumptions, Problem Statement, and Goals"</span>, <span class="seriesInfo">RFC 4919</span>, <span class="seriesInfo">DOI 10.17487/RFC4919</span>, <time datetime="2007-08">August 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4919">https://www.rfc-editor.org/info/rfc4919</a>&gt;</span>. </dd>
<dt id="RFC4963">[RFC4963]</dt>
      <dd>
<span class="refAuthor">Heffner, J.</span><span class="refAuthor">, Mathis, M.</span><span class="refAuthor">, and B. Chandler</span>, <span class="refTitle">"IPv4 Reassembly Errors at High Data Rates"</span>, <span class="seriesInfo">RFC 4963</span>, <span class="seriesInfo">DOI 10.17487/RFC4963</span>, <time datetime="2007-07">July 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4963">https://www.rfc-editor.org/info/rfc4963</a>&gt;</span>. </dd>
<dt id="RFC6298">[RFC6298]</dt>
      <dd>
<span class="refAuthor">Paxson, V.</span><span class="refAuthor">, Allman, M.</span><span class="refAuthor">, Chu, J.</span><span class="refAuthor">, and M. Sargent</span>, <span class="refTitle">"Computing TCP's Retransmission Timer"</span>, <span class="seriesInfo">RFC 6298</span>, <span class="seriesInfo">DOI 10.17487/RFC6298</span>, <time datetime="2011-06">June 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6298">https://www.rfc-editor.org/info/rfc6298</a>&gt;</span>. </dd>
<dt id="RFC6550">[RFC6550]</dt>
      <dd>
<span class="refAuthor">Winter, T., Ed.</span><span class="refAuthor">, Thubert, P., Ed.</span><span class="refAuthor">, Brandt, A.</span><span class="refAuthor">, Hui, J.</span><span class="refAuthor">, Kelsey, R.</span><span class="refAuthor">, Levis, P.</span><span class="refAuthor">, Pister, K.</span><span class="refAuthor">, Struik, R.</span><span class="refAuthor">, Vasseur, JP.</span><span class="refAuthor">, and R. Alexander</span>, <span class="refTitle">"RPL: IPv6 Routing Protocol for Low-Power and Lossy Networks"</span>, <span class="seriesInfo">RFC 6550</span>, <span class="seriesInfo">DOI 10.17487/RFC6550</span>, <time datetime="2012-03">March 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6550">https://www.rfc-editor.org/info/rfc6550</a>&gt;</span>. </dd>
<dt id="RFC7554">[RFC7554]</dt>
      <dd>
<span class="refAuthor">Watteyne, T., Ed.</span><span class="refAuthor">, Palattella, M.</span><span class="refAuthor">, and L. Grieco</span>, <span class="refTitle">"Using IEEE 802.15.4e Time-Slotted Channel Hopping (TSCH) in the Internet of Things (IoT): Problem Statement"</span>, <span class="seriesInfo">RFC 7554</span>, <span class="seriesInfo">DOI 10.17487/RFC7554</span>, <time datetime="2015-05">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7554">https://www.rfc-editor.org/info/rfc7554</a>&gt;</span>. </dd>
<dt id="RFC8200">[RFC8200]</dt>
      <dd>
<span class="refAuthor">Deering, S.</span><span class="refAuthor"> and R. Hinden</span>, <span class="refTitle">"Internet Protocol, Version 6 (IPv6) Specification"</span>, <span class="seriesInfo">STD 86</span>, <span class="seriesInfo">RFC 8200</span>, <span class="seriesInfo">DOI 10.17487/RFC8200</span>, <time datetime="2017-07">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8200">https://www.rfc-editor.org/info/rfc8200</a>&gt;</span>. </dd>
<dt id="RFC8085">[RFC8085]</dt>
      <dd>
<span class="refAuthor">Eggert, L.</span><span class="refAuthor">, Fairhurst, G.</span><span class="refAuthor">, and G. Shepherd</span>, <span class="refTitle">"UDP Usage Guidelines"</span>, <span class="seriesInfo">BCP 145</span>, <span class="seriesInfo">RFC 8085</span>, <span class="seriesInfo">DOI 10.17487/RFC8085</span>, <time datetime="2017-03">March 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8085">https://www.rfc-editor.org/info/rfc8085</a>&gt;</span>. </dd>
<dt id="RFC8087">[RFC8087]</dt>
      <dd>
<span class="refAuthor">Fairhurst, G.</span><span class="refAuthor"> and M. Welzl</span>, <span class="refTitle">"The Benefits of Using Explicit Congestion Notification (ECN)"</span>, <span class="seriesInfo">RFC 8087</span>, <span class="seriesInfo">DOI 10.17487/RFC8087</span>, <time datetime="2017-03">March 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8087">https://www.rfc-editor.org/info/rfc8087</a>&gt;</span>. </dd>
<dt id="RFC6606">[RFC6606]</dt>
      <dd>
<span class="refAuthor">Kim, E.</span><span class="refAuthor">, Kaspar, D.</span><span class="refAuthor">, Gomez, C.</span><span class="refAuthor">, and C. Bormann</span>, <span class="refTitle">"Problem Statement and Requirements for IPv6 over Low-Power Wireless Personal Area Network (6LoWPAN) Routing"</span>, <span class="seriesInfo">RFC 6606</span>, <span class="seriesInfo">DOI 10.17487/RFC6606</span>, <time datetime="2012-05">May 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6606">https://www.rfc-editor.org/info/rfc6606</a>&gt;</span>. </dd>
<dt id="I-D.ietf-lwig-6lowpan-virtual-reassembly">[I-D.ietf-lwig-6lowpan-virtual-reassembly]</dt>
      <dd>
<span class="refAuthor">Bormann, C.</span><span class="refAuthor"> and T. Watteyne</span>, <span class="refTitle">"Virtual reassembly buffers in 6LoWPAN"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lwig-6lowpan-virtual-reassembly-01</span>, <time datetime="2019-03-11">11 March 2019</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-lwig-6lowpan-virtual-reassembly-01">https://tools.ietf.org/html/draft-ietf-lwig-6lowpan-virtual-reassembly-01</a>&gt;</span>. </dd>
<dt id="I-D.ietf-intarea-frag-fragile">[I-D.ietf-intarea-frag-fragile]</dt>
      <dd>
<span class="refAuthor">Bonica, R.</span><span class="refAuthor">, Baker, F.</span><span class="refAuthor">, Huston, G.</span><span class="refAuthor">, Hinden, R.</span><span class="refAuthor">, Troan, O.</span><span class="refAuthor">, and F. Gont</span>, <span class="refTitle">"IP Fragmentation Considered Fragile"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-intarea-frag-fragile-17</span>, <time datetime="2019-09-30">30 September 2019</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-intarea-frag-fragile-17">https://tools.ietf.org/html/draft-ietf-intarea-frag-fragile-17</a>&gt;</span>. </dd>
<dt id="I-D.ietf-core-cocoa">[I-D.ietf-core-cocoa]</dt>
      <dd>
<span class="refAuthor">Bormann, C.</span><span class="refAuthor">, Betzler, A.</span><span class="refAuthor">, Gomez, C.</span><span class="refAuthor">, and I. Demirkol</span>, <span class="refTitle">"CoAP Simple Congestion Control/Advanced"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-cocoa-03</span>, <time datetime="2018-02-21">21 February 2018</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-core-cocoa-03">https://tools.ietf.org/html/draft-ietf-core-cocoa-03</a>&gt;</span>. </dd>
<dt id="I-D.ietf-6tisch-architecture">[I-D.ietf-6tisch-architecture]</dt>
      <dd>
<span class="refAuthor">Thubert, P.</span>, <span class="refTitle">"An Architecture for IPv6 over the TSCH mode of IEEE 802.15.4"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-6tisch-architecture-28</span>, <time datetime="2019-10-29">29 October 2019</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-6tisch-architecture-28">https://tools.ietf.org/html/draft-ietf-6tisch-architecture-28</a>&gt;</span>. </dd>
<dt id="IEEE.802.15.4">[IEEE.802.15.4]</dt>
      <dd>
<span class="refAuthor">IEEE</span>, <span class="refTitle">"IEEE Standard for Low-Rate Wireless Networks"</span>, <span class="seriesInfo">IEEE Standard 802.15.4</span>, <span class="seriesInfo">DOI 10.1109/IEEE P802.15.4-REVd/D01</span>, <time></time>, <span>&lt;<a href="http://ieeexplore.ieee.org/document/7460875/">http://ieeexplore.ieee.org/document/7460875/</a>&gt;</span>. </dd>
<dt id="Kent">[Kent]</dt>
    <dd>
<span class="refAuthor">Kent, C.</span><span class="refAuthor"> and J. Mogul</span>, <span class="refTitle">""Fragmentation Considered Harmful", In Proc. SIGCOMM '87 Workshop on Frontiers in Computer Communications Technology"</span>, <span class="seriesInfo">DOI 10.1145/55483.55524</span>, <time datetime="1987-08">August 1987</time>, <span>&lt;<a href="http://www.hpl.hp.com/techreports/Compaq-DEC/WRL-87-3.pdf">http://www.hpl.hp.com/techreports/Compaq-DEC/WRL-87-3.pdf</a>&gt;</span>. </dd>
</dl>
</section>
<div id="rationale">
<section id="section-appendix.a">
      <h2 id="name-rationale">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-rationale" class="section-name selfRef">Rationale</a>
      </h2>
<p id="section-appendix.a-1">

   There are a number of uses for large packets in Wireless Sensor Networks. Such usages
   may not be the most typical or represent the largest amount of traffic over the LLN;
   however, the associated functionality can be critical enough to justify extra care for
   ensuring effective transport of large packets across the LLN.<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
<p id="section-appendix.a-2">
   The list of those usages includes:<a href="#section-appendix.a-2" class="pilcrow">¶</a></p>
<dl class="dlParallel" id="section-appendix.a-3">
        <dt id="section-appendix.a-3.1">Towards the LLN node:</dt>
        <dd id="section-appendix.a-3.2">
          <dl class="dlParallel" id="section-appendix.a-3.2.1">
            <dt id="section-appendix.a-3.2.1.1">Firmware update:</dt>
            <dd id="section-appendix.a-3.2.1.2">
        For example, a new version of the LLN node software is downloaded from a system
    manager over unicast or multicast services.
    Such a reflashing operation typically involves updating a large number of similar
    LLN nodes over a relatively short period of time.<a href="#section-appendix.a-3.2.1.2" class="pilcrow">¶</a>
</dd>
<dt id="section-appendix.a-3.2.1.3">Packages of Commands:</dt>
            <dd id="section-appendix.a-3.2.1.4">
        A number of commands or a full configuration can be packaged as a single message
        to ensure consistency and enable atomic execution or complete roll back.
    Until such commands are fully received and interpreted, the intended operation will not take effect.<a href="#section-appendix.a-3.2.1.4" class="pilcrow">¶</a>
</dd>
</dl>
</dd>
<dt id="section-appendix.a-3.3">From the LLN node:</dt>
        <dd id="section-appendix.a-3.4">
          <dl class="dlParallel" id="section-appendix.a-3.4.1">
            <dt id="section-appendix.a-3.4.1.1">Waveform captures:</dt>
            <dd id="section-appendix.a-3.4.1.2">
        A number of consecutive samples are measured at a high rate for a short time and then transferred
    from a sensor to a gateway or an edge server as a single large report.<a href="#section-appendix.a-3.4.1.2" class="pilcrow">¶</a>
</dd>
<dt id="section-appendix.a-3.4.1.3">Data logs:</dt>
            <dd id="section-appendix.a-3.4.1.4">
        LLN nodes may generate large logs of sampled data
        for later extraction. LLN nodes may also generate
        system logs to assist in diagnosing problems on the
        node or network.<a href="#section-appendix.a-3.4.1.4" class="pilcrow">¶</a>
</dd>
<dt id="section-appendix.a-3.4.1.5">Large data packets:</dt>
            <dd id="section-appendix.a-3.4.1.6">
        Rich data types might require more than one fragment.<a href="#section-appendix.a-3.4.1.6" class="pilcrow">¶</a>
</dd>
</dl>
</dd>
</dl>
<p id="section-appendix.a-4">
    Uncontrolled firmware download or waveform upload can easily result in a massive
    increase of the traffic and saturate the network.<a href="#section-appendix.a-4" class="pilcrow">¶</a></p>
<p id="section-appendix.a-5">
    When a fragment is lost in transmission, the lack of recovery in
           the original fragmentation system of RFC 4944 implies that all
           fragments would need to be resent, further contributing
        to the congestion that caused the initial loss,
           and potentially leading to congestion collapse.<a href="#section-appendix.a-5" class="pilcrow">¶</a></p>
<p id="section-appendix.a-6">
    This saturation may lead to excessive radio interference, or random early discard
    (leaky bucket) in relaying nodes. Additional queuing and memory congestion may
    result while waiting for a low power next hop to emerge from its sleeping state.<a href="#section-appendix.a-6" class="pilcrow">¶</a></p>
<p id="section-appendix.a-7">
     Considering that RFC 4944
 defines an MTU is 1280 bytes and that in most incarnations
 (but 802.15.4g) a IEEE Std. 802.15.4 frame can limit the MAC payload
 to as few as 74 bytes, a packet might be fragmented into at
     least 18 fragments at the 6LoWPAN shim layer.  Taking into
     account the worst-case header overhead for 6LoWPAN
     Fragmentation and Mesh Addressing headers will increase
     the number of required fragments to around 32.  This level
     of fragmentation is much higher than that traditionally
     experienced over the Internet with IPv4 fragments.  At the
     same time, the use of radios increases the probability of
     transmission loss and Mesh-Under techniques compound that
     risk over multiple hops.<a href="#section-appendix.a-7" class="pilcrow">¶</a></p>
<p id="section-appendix.a-8">
     Mechanisms such as TCP or application-layer segmentation
     could be used to support end-to-end reliable transport. One
     option to support bulk data transfer over a frame-size-constrained
 LLN is to set the Maximum Segment Size to fit within the link
     maximum frame size. Doing so, however, can add significant header
     overhead to each 802.15.4 frame.


        In addition, deploying such a mechanism requires that the end-to-end
        transport is aware of the delivery properties of the underlying LLN,
        which is a layer violation, and difficult to achieve from the far end of
        the IPv6 network.<a href="#section-appendix.a-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="req">
<section id="section-appendix.b">
      <h2 id="name-requirements">
<a href="#section-appendix.b" class="section-number selfRef">Appendix B. </a><a href="#name-requirements" class="section-name selfRef">Requirements</a>
      </h2>
<p id="section-appendix.b-1">
 For one-hop communications, a number of Low Power and Lossy Network (LLN)
        link-layers propose a local acknowledgment mechanism that is enough to
 detect and recover the loss of fragments. In a multihop environment, an
        end-to-end fragment recovery mechanism might be a good complement to a
 hop-by-hop MAC level recovery.
     This draft introduces a simple protocol to recover individual fragments
        between 6LoWPAN endpoints that may be multiple hops away.
        The method addresses the following requirements of a LLN:<a href="#section-appendix.b-1" class="pilcrow">¶</a></p>
<dl class="dlParallel" id="section-appendix.b-2">
        <dt id="section-appendix.b-2.1">Number of fragments</dt>
        <dd id="section-appendix.b-2.2">The recovery mechanism must support highly fragmented packets, with a maximum of 32 fragments per packet.<a href="#section-appendix.b-2.2" class="pilcrow">¶</a>
</dd>
<dt id="section-appendix.b-2.3">Minimum acknowledgment overhead</dt>
        <dd id="section-appendix.b-2.4"> Because the radio is half duplex, and because of silent time spent in the
    various medium access mechanisms, an acknowledgment consumes roughly as many resources as data fragment.<a href="#section-appendix.b-2.4" class="pilcrow">¶</a>
</dd>
<dt id="section-appendix.b-2.5"></dt>
        <dd id="section-appendix.b-2.6">The new end-to-end fragment recovery mechanism should be able to acknowledge multiple fragments in a single message and
 not require an acknowledgment at all if fragments are already protected at a lower layer.<a href="#section-appendix.b-2.6" class="pilcrow">¶</a>
</dd>
<dt id="section-appendix.b-2.7">Controlled latency</dt>
        <dd id="section-appendix.b-2.8">The recovery mechanism must succeed or give up within the time boundary imposed by the recovery process
    of the Upper Layer Protocols.<a href="#section-appendix.b-2.8" class="pilcrow">¶</a>
</dd>
<dt id="section-appendix.b-2.9">Optional congestion control</dt>
        <dd id="section-appendix.b-2.10"> The aggregation of multiple concurrent flows may lead to the saturation of the radio network and congestion collapse.<a href="#section-appendix.b-2.10" class="pilcrow">¶</a>
</dd>
<dt id="section-appendix.b-2.11"></dt>
        <dd id="section-appendix.b-2.12">The recovery mechanism should provide means for controlling the number of fragments in transit over the LLN.<a href="#section-appendix.b-2.12" class="pilcrow">¶</a>
</dd>
</dl>
<p id="section-appendix.b-3"><a href="#section-appendix.b-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="onECN">
<section id="section-appendix.c">
      <h2 id="name-considerations-on-flow-cont">
<a href="#section-appendix.c" class="section-number selfRef">Appendix C. </a><a href="#name-considerations-on-flow-cont" class="section-name selfRef">Considerations On Flow Control</a>
      </h2>
<p id="section-appendix.c-1">Considering that a multi-hop LLN can be a very sensitive environment
 due to the limited queuing capabilities of a
 large population of its nodes, this draft recommends a simple and
 conservative approach to Congestion Control, based on TCP congestion avoidance.<a href="#section-appendix.c-1" class="pilcrow">¶</a></p>
<p id="section-appendix.c-2"> Congestion on the forward path is assumed in case of packet loss, and
    packet loss is assumed upon time out. The draft allows to control the number
    of outstanding fragments, that have been transmitted but for which an
   acknowledgment was not received yet. It must be noted that the number of
   outstanding fragments should not exceed the number of hops in the network,
   but the way to figure the number of hops is out of scope
   for this document.<a href="#section-appendix.c-2" class="pilcrow">¶</a></p>
<p id="section-appendix.c-3"> Congestion on the forward path can also be indicated by an Explicit
    Congestion Notification (ECN) mechanism.
 Though whether and how ECN <span>[<a href="#RFC3168" class="xref">RFC3168</a>]</span> is carried out over the
    LoWPAN is out of scope, this draft provides a way for the destination
    endpoint to echo an ECN indication back to the source endpoint in an
    acknowledgment message as represented in
 <a href="#ackfig" class="xref">Figure 4</a> in <a href="#ackfrag" class="xref">Section 5.2</a>.<a href="#section-appendix.c-3" class="pilcrow">¶</a></p>
<p id="section-appendix.c-4">It must be noted that congestion and collision are different topics.
   In particular, when a mesh operates on a same channel over multiple hops,
   then the forwarding of a fragment over a certain hop may collide with the
   forwarding of a next fragment that is following over a previous hop but in a
   same interference domain. This draft enables an end-to-end flow control,
   but leaves it to the sender stack to pace individual fragments within a
   transmit window, so that a given fragment is sent only when the previous
   fragment has had a chance to progress beyond the interference domain of this
   hop. In the case of
   <span><a href="#I-D.ietf-6tisch-architecture" class="xref">6TiSCH</a> [<a href="#I-D.ietf-6tisch-architecture" class="xref">I-D.ietf-6tisch-architecture</a>]</span>, which operates
   over the
   <span><a href="#RFC7554" class="xref">TimeSlotted Channel Hopping</a> [<a href="#RFC7554" class="xref">RFC7554</a>]</span> (TSCH)
   mode of operation of IEEE802.14.5, a fragment is forwarded over a different
   channel at a different time and it makes full sense to transmit the next fragment as
   soon as the previous fragment has had its chance to be forwarded at the next
   hop.<a href="#section-appendix.c-4" class="pilcrow">¶</a></p>
<p id="section-appendix.c-5"> From the standpoint of a source 6LoWPAN endpoint, an outstanding
    fragment is a fragment that was
 sent but for which no explicit acknowledgment was received yet.
 This means that the fragment might be on the way, received but not yet
    acknowledged, or the acknowledgment might be on the way back. It is also
    possible that either the fragment or the acknowledgment was lost on the
    way.<a href="#section-appendix.c-5" class="pilcrow">¶</a></p>
<p id="section-appendix.c-6">From the sender standpoint,
 all outstanding fragments might still be in the network and contribute to its congestion.
 There is an assumption, though, that after a certain amount of time, a frame is either received
    or lost, so it is not causing congestion anymore. This amount of time can be estimated based on the round trip
 delay between the 6LoWPAN endpoints. The method detailed in <span>[<a href="#RFC6298" class="xref">RFC6298</a>]</span> is recommended for that computation.<a href="#section-appendix.c-6" class="pilcrow">¶</a></p>
<p id="section-appendix.c-7">The reader is encouraged to read through <span><a href="#RFC2914" class="xref">"Congestion Control Principles"</a> [<a href="#RFC2914" class="xref">RFC2914</a>]</span>.
 Additionally <span>[<a href="#RFC7567" class="xref">RFC7567</a>]</span> and <span>[<a href="#RFC5681" class="xref">RFC5681</a>]</span> provide deeper information on why this
 mechanism is needed and how TCP handles Congestion Control. Basically, the goal here is to
 manage the amount of fragments present in the network; this is achieved by to reducing the number of outstanding
 fragments over a congested path by throttling the sources.<a href="#section-appendix.c-7" class="pilcrow">¶</a></p>
<p id="section-appendix.c-8"><a href="#ffc" class="xref">Section 6</a> describes how the sender decides how many fragments are (re)sent before
 an acknowledgment is required, and how the sender adapts that number to the network conditions.<a href="#section-appendix.c-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.d">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Pascal Thubert (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems, Inc</span></div>
<div dir="auto" class="left"><span class="street-address">Building D, 45 Allee des Ormes - BP1200</span></div>
<div dir="auto" class="left">
<span class="postal-code">06254</span> <span class="locality">MOUGINS - Sophia Antipolis</span>
</div>
<div dir="auto" class="left"><span class="country-name">France</span></div>
<div class="tel">
<span>Phone:</span>
<a href="tel:+33%20497%2023%2026%2034" class="tel">+33 497 23 26 34</a>
</div>
<div class="email">
<span>Email:</span>
<a href="mailto:pthubert@cisco.com" class="email">pthubert@cisco.com</a>
</div>
</address>
</section>
</div>
<script>var toc = document.getElementById("toc");
var tocToggle = toc.querySelector("h2");
var tocNav = toc.querySelector("nav");

// mobile menu toggle
tocToggle.onclick = function(event) {
    if (window.innerWidth < 1024) {
 var tocNavDisplay = tocNav.currentStyle ? tocNav.currentStyle.display : getComputedStyle(tocNav, null).display;
 if (tocNavDisplay == "none") {
     tocNav.style.display = "block";
 } else {
     tocNav.style.display = "none";
 }
    }
}

// toc anchor scroll to anchor
tocNav.addEventListener("click", function (event) {
    event.preventDefault();
    if (event.target.nodeName == 'A') {
 if (window.innerWidth < 1024) {
     tocNav.style.display = "none";
 }
 var href = event.target.getAttribute("href");
 var anchorId = href.substr(1);
 var anchor =  document.getElementById(anchorId);
 anchor.scrollIntoView(true);
 window.history.pushState("","",href);
    }
});

// switch toc mode when window resized
window.onresize = function () {
    if (window.innerWidth < 1024) {
 tocNav.style.display = "none";
    } else {
 tocNav.style.display = "block";
    }
}
</script>
</body>
</html>
