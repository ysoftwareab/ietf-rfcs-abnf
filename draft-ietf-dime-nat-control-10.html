<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Diameter Network Address and Port Translation Control Application</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Conventions">
<link href="#rfc.section.3" rel="Chapter" title="3 Deployment Framework">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Deployment Scenario">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Diameter NAPT Control Application Overview">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Deployment Scenarios For DNCA">
<link href="#rfc.section.4" rel="Chapter" title="4 DNCA Session Establishment and Management">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Session Establishment">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Session Re-Authorization">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Session and Binding Query">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Session Termination">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Session Abort">
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 Failure cases of the DNCA Diameter peers">
<link href="#rfc.section.5" rel="Chapter" title="5 Use of the Diameter Base Protocol">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Securing Diameter Messages ">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Accounting Functionality">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Use of Sessions">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Routing Considerations">
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Advertising Application Support">
<link href="#rfc.section.6" rel="Chapter" title="6 DNCA Commands">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 NAT-Control Request (NCR) Command">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 NAT-Control Answer (NCA) Command">
<link href="#rfc.section.7" rel="Chapter" title="7 NAT Control Application Session State Machine">
<link href="#rfc.section.8" rel="Chapter" title="8 DNCA AVPs">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Reused Base Protocol AVPs">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Additional Result-Code AVP Values">
<link href="#rfc.section.8.2.1" rel="Chapter" title="8.2.1 Success">
<link href="#rfc.section.8.2.2" rel="Chapter" title="8.2.2 Transient Failures">
<link href="#rfc.section.8.2.3" rel="Chapter" title="8.2.3 Permanent Failures ">
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 Reused NASREQ Diameter Application AVPs">
<link href="#rfc.section.8.4" rel="Chapter" title="8.4 Reused AVPs from RFC 4675 ">
<link href="#rfc.section.8.5" rel="Chapter" title="8.5 Reused AVPs from Diameter QoS Application">
<link href="#rfc.section.8.6" rel="Chapter" title="8.6 Reused AVPs from ETSI ES 283 034, e4 Diameter Application">
<link href="#rfc.section.8.7" rel="Chapter" title="8.7 DNCA Defined AVPs">
<link href="#rfc.section.8.7.1" rel="Chapter" title="8.7.1 NC-Request-Type AVP">
<link href="#rfc.section.8.7.2" rel="Chapter" title="8.7.2 NAT-Control-Install AVP">
<link href="#rfc.section.8.7.3" rel="Chapter" title="8.7.3 NAT-Control-Remove AVP">
<link href="#rfc.section.8.7.4" rel="Chapter" title="8.7.4 NAT-Control-Definition AVP">
<link href="#rfc.section.8.7.5" rel="Chapter" title="8.7.5 NAT-Internal-Address AVP">
<link href="#rfc.section.8.7.6" rel="Chapter" title="8.7.6 NAT-External-Address AVP">
<link href="#rfc.section.8.7.7" rel="Chapter" title="8.7.7 Max-NAT-Bindings">
<link href="#rfc.section.8.7.8" rel="Chapter" title="8.7.8 NAT-Control-Binding-Template AVP">
<link href="#rfc.section.8.7.9" rel="Chapter" title="8.7.9 Duplicate-Session-Id AVP">
<link href="#rfc.section.8.7.10" rel="Chapter" title="8.7.10 NAT-External-Port-Style AVP">
<link href="#rfc.section.9" rel="Chapter" title="9 Accounting Commands">
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 NAT Control Accounting Messages">
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 NAT Control Accounting AVPs">
<link href="#rfc.section.9.2.1" rel="Chapter" title="9.2.1 NAT-Control-Record">
<link href="#rfc.section.9.2.2" rel="Chapter" title="9.2.2 NAT-Control-Binding-Status">
<link href="#rfc.section.9.2.3" rel="Chapter" title="9.2.3 Current-NAT-Bindings">
<link href="#rfc.section.10" rel="Chapter" title="10 AVP Occurrence Table">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 DNCA AVP Table for NAT Control Initial and Update Requests">
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 DNCA AVP Table for Session Query request">
<link href="#rfc.section.10.3" rel="Chapter" title="10.3 DNCA AVP Table for Accounting Message">
<link href="#rfc.section.11" rel="Chapter" title="11 IANA Considerations">
<link href="#rfc.section.11.1" rel="Chapter" title="11.1 Application Identifier">
<link href="#rfc.section.11.2" rel="Chapter" title="11.2 Command Codes">
<link href="#rfc.section.11.3" rel="Chapter" title="11.3 AVP Codes">
<link href="#rfc.section.11.4" rel="Chapter" title="11.4 Result-Code AVP Values ">
<link href="#rfc.section.11.5" rel="Chapter" title="11.5 NC-Request-Type AVP">
<link href="#rfc.section.11.6" rel="Chapter" title="11.6 NAT-External-Port-Style AVP">
<link href="#rfc.section.11.7" rel="Chapter" title="11.7 NAT-Control-Binding-Status AVP">
<link href="#rfc.section.12" rel="Chapter" title="12 Security Considerations">
<link href="#rfc.section.13" rel="Chapter" title="13 Examples">
<link href="#rfc.section.13.1" rel="Chapter" title="13.1 DNCA Session Establishment Example">
<link href="#rfc.section.13.2" rel="Chapter" title="13.2 DNCA Session Update with Port Style Example">
<link href="#rfc.section.13.3" rel="Chapter" title="13.3 DNCA Session Query Example">
<link href="#rfc.section.13.4" rel="Chapter" title="13.4 DNCA Session Termination Example">
<link href="#rfc.section.14" rel="Chapter" title="14 Acknowledgements">
<link href="#rfc.section.15" rel="Chapter" title="15 Change History (to be removed prior to publication as an RFC) ">
<link href="#rfc.references" rel="Chapter" title="16 References">
<link href="#rfc.references.1" rel="Chapter" title="16.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="16.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document describes the framework, messages, and procedures for the Diameter Network address and port translation Control Application.  This Diameter application allows per endpoint control of Network Address Translators and Network Address and Port Translators, which are added to networks to cope with IPv4-address space depletion. This Diameter application allows external devices to configure and manage a Network Address Translator device - expanding the existing Diameter-based AAA and policy control capabilities with a Network Address Translators and Network Address and Port Translators control component. These external devices can be network elements in the data plane such as a Network Access Server, or can be more centralized control plane devices such as AAA-servers. This Diameter application establishes a context to commonly identify and manage endpoints on a gateway or server, and a Network Address Translator and Network Address and Port Translator device. This includes, for example, the control of the total number of Network Address Translator bindings allowed or the allocation of a specific Network Address Translator binding for a particular endpoint. In addition, it allows Network Address Translator devices to provide information relevant to accounting purposes." />
  <meta name="description" content="This document describes the framework, messages, and procedures for the Diameter Network address and port translation Control Application.  This Diameter application allows per endpoint control of Network Address Translators and Network Address and Port Translators, which are added to networks to cope with IPv4-address space depletion. This Diameter application allows external devices to configure and manage a Network Address Translator device - expanding the existing Diameter-based AAA and policy control capabilities with a Network Address Translators and Network Address and Port Translators control component. These external devices can be network elements in the data plane such as a Network Access Server, or can be more centralized control plane devices such as AAA-servers. This Diameter application establishes a context to commonly identify and manage endpoints on a gateway or server, and a Network Address Translator and Network Address and Port Translator device. This includes, for example, the control of the total number of Network Address Translator bindings allowed or the allocation of a specific Network Address Translator binding for a particular endpoint. In addition, it allows Network Address Translator devices to provide information relevant to accounting purposes." />
  <meta name="keywords" content="diameter" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Internet Engineering Task Force</td>
<td class="right">F. Brockners</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">S. Bhandari</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Cisco</td>
</tr>
<tr>
<td class="left">Expires: March 05, 2012</td>
<td class="right">V. Singh</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">V. Fajardo</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Telcordia Technologies</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">September 02, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Diameter Network Address and Port Translation Control Application<br />
  <span class="filename">draft-ietf-dime-nat-control-10</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes the framework, messages, and procedures for the Diameter Network address and port translation Control Application.  This Diameter application allows per endpoint control of Network Address Translators and Network Address and Port Translators, which are added to networks to cope with IPv4-address space depletion. This Diameter application allows external devices to configure and manage a Network Address Translator device - expanding the existing Diameter-based AAA and policy control capabilities with a Network Address Translators and Network Address and Port Translators control component. These external devices can be network elements in the data plane such as a Network Access Server, or can be more centralized control plane devices such as AAA-servers. This Diameter application establishes a context to commonly identify and manage endpoints on a gateway or server, and a Network Address Translator and Network Address and Port Translator device. This includes, for example, the control of the total number of Network Address Translator bindings allowed or the allocation of a specific Network Address Translator binding for a particular endpoint. In addition, it allows Network Address Translator devices to provide information relevant to accounting purposes.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on March 05, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Conventions</a>
</li>
<li>3.   <a href="#rfc.section.3">Deployment Framework</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Deployment Scenario</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Diameter NAPT Control Application Overview</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Deployment Scenarios For DNCA</a>
</li>
<li>4.   <a href="#rfc.section.4">DNCA Session Establishment and Management</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Session Establishment</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Session Re-Authorization</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Session and Binding Query</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Session Termination</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Session Abort</a>
</li>
<li>4.6.   <a href="#rfc.section.4.6">Failure cases of the DNCA Diameter peers</a>
</li>
<li>5.   <a href="#rfc.section.5">Use of the Diameter Base Protocol</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Securing Diameter Messages </a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Accounting Functionality</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Use of Sessions</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">Routing Considerations</a>
</li>
<li>5.5.   <a href="#rfc.section.5.5">Advertising Application Support</a>
</li>
<li>6.   <a href="#rfc.section.6">DNCA Commands</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">NAT-Control Request (NCR) Command</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">NAT-Control Answer (NCA) Command</a>
</li>
<li>7.   <a href="#rfc.section.7">NAT Control Application Session State Machine</a>
</li>
<li>8.   <a href="#rfc.section.8">DNCA AVPs</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">Reused Base Protocol AVPs</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">Additional Result-Code AVP Values</a>
</li>
<li>8.2.1.   <a href="#rfc.section.8.2.1">Success</a>
</li>
<li>8.2.2.   <a href="#rfc.section.8.2.2">Transient Failures</a>
</li>
<li>8.2.3.   <a href="#rfc.section.8.2.3">Permanent Failures </a>
</li>
<li>8.3.   <a href="#rfc.section.8.3">Reused NASREQ Diameter Application AVPs</a>
</li>
<li>8.4.   <a href="#rfc.section.8.4">Reused AVPs from RFC 4675 </a>
</li>
<li>8.5.   <a href="#rfc.section.8.5">Reused AVPs from Diameter QoS Application</a>
</li>
<li>8.6.   <a href="#rfc.section.8.6">Reused AVPs from ETSI ES 283 034, e4 Diameter Application</a>
</li>
<li>8.7.   <a href="#rfc.section.8.7">DNCA Defined AVPs</a>
</li>
<li>8.7.1.   <a href="#rfc.section.8.7.1">NC-Request-Type AVP</a>
</li>
<li>8.7.2.   <a href="#rfc.section.8.7.2">NAT-Control-Install AVP</a>
</li>
<li>8.7.3.   <a href="#rfc.section.8.7.3">NAT-Control-Remove AVP</a>
</li>
<li>8.7.4.   <a href="#rfc.section.8.7.4">NAT-Control-Definition AVP</a>
</li>
<li>8.7.5.   <a href="#rfc.section.8.7.5">NAT-Internal-Address AVP</a>
</li>
<li>8.7.6.   <a href="#rfc.section.8.7.6">NAT-External-Address AVP</a>
</li>
<li>8.7.7.   <a href="#rfc.section.8.7.7">Max-NAT-Bindings</a>
</li>
<li>8.7.8.   <a href="#rfc.section.8.7.8">NAT-Control-Binding-Template AVP</a>
</li>
<li>8.7.9.   <a href="#rfc.section.8.7.9">Duplicate-Session-Id AVP</a>
</li>
<li>8.7.10.   <a href="#rfc.section.8.7.10">NAT-External-Port-Style AVP</a>
</li>
<li>9.   <a href="#rfc.section.9">Accounting Commands</a>
</li>
<li>9.1.   <a href="#rfc.section.9.1">NAT Control Accounting Messages</a>
</li>
<li>9.2.   <a href="#rfc.section.9.2">NAT Control Accounting AVPs</a>
</li>
<li>9.2.1.   <a href="#rfc.section.9.2.1">NAT-Control-Record</a>
</li>
<li>9.2.2.   <a href="#rfc.section.9.2.2">NAT-Control-Binding-Status</a>
</li>
<li>9.2.3.   <a href="#rfc.section.9.2.3">Current-NAT-Bindings</a>
</li>
<li>10.   <a href="#rfc.section.10">AVP Occurrence Table</a>
</li>
<li>10.1.   <a href="#rfc.section.10.1">DNCA AVP Table for NAT Control Initial and Update Requests</a>
</li>
<li>10.2.   <a href="#rfc.section.10.2">DNCA AVP Table for Session Query request</a>
</li>
<li>10.3.   <a href="#rfc.section.10.3">DNCA AVP Table for Accounting Message</a>
</li>
<li>11.   <a href="#rfc.section.11">IANA Considerations</a>
</li>
<li>11.1.   <a href="#rfc.section.11.1">Application Identifier</a>
</li>
<li>11.2.   <a href="#rfc.section.11.2">Command Codes</a>
</li>
<li>11.3.   <a href="#rfc.section.11.3">AVP Codes</a>
</li>
<li>11.4.   <a href="#rfc.section.11.4">Result-Code AVP Values </a>
</li>
<li>11.5.   <a href="#rfc.section.11.5">NC-Request-Type AVP</a>
</li>
<li>11.6.   <a href="#rfc.section.11.6">NAT-External-Port-Style AVP</a>
</li>
<li>11.7.   <a href="#rfc.section.11.7">NAT-Control-Binding-Status AVP</a>
</li>
<li>12.   <a href="#rfc.section.12">Security Considerations</a>
</li>
<li>13.   <a href="#rfc.section.13">Examples</a>
</li>
<li>13.1.   <a href="#rfc.section.13.1">DNCA Session Establishment Example</a>
</li>
<li>13.2.   <a href="#rfc.section.13.2">DNCA Session Update with Port Style Example</a>
</li>
<li>13.3.   <a href="#rfc.section.13.3">DNCA Session Query Example</a>
</li>
<li>13.4.   <a href="#rfc.section.13.4">DNCA Session Termination Example</a>
</li>
<li>14.   <a href="#rfc.section.14">Acknowledgements</a>
</li>
<li>15.   <a href="#rfc.section.15">Change History (to be removed prior to publication as an RFC) </a>
</li>
<li>16.   <a href="#rfc.references">References</a>
</li>
<li>16.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>16.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">Internet service providers deploy Network Address Translators (NATs) and Network Address and Port Translators (NAPTs) <a href="#RFC3022">[RFC3022]</a> in their networks. A key motivation for doing so is the depletion of available public IPv4 addresses. This document defines a Diameter application allowing providers to control the behavior of NAT and NAPT devices that implement IPv4-to-IPv4 network address and port translation <a href="#RFC2663">[RFC2663]</a> as well as stateful IPv6-to-IPv4 address family translation translation as defined in <a href="#RFC2663">[RFC2663]</a>, <a href="#RFC6145">[RFC6145]</a>, and <a href="#RFC6146">[RFC6146]</a>. The use of a Diameter application allows for simple integration into the existing Authentication, Authorization and Accounting (AAA) environment of a provider.</p>
<p id="rfc.section.1.p.2">The Diameter Network address and port translation Control Application (DNCA) offers the following capabilities:</p>
<p></p>

<ol>
<li>Limits or defines the number of NAPT/NAT bindings made available to an individual end point or user. The main motivation for restricting the number of bindings on a per end point basis is to protect the service of the service provider against denial of service attacks. If multiple end points share a single public IP address, these end points can share fate. If one end point would (either intentionally, or due to mis-behavior, mis-configuration, mal-ware, etc.) be able to consume all available bindings for a given single public IP address, service would be hampered (or might even become unavailable) for those other end points sharing the same public IP address. The efficiency of a NAPT deployment depends on the maximum number of bindings an end point could use. Given that the typical number of bindings an end point uses depends on the type of end point (e.g. a personal computer of a broadband user is expected to use a higher number of bindings than a simple mobile phone) and a NAPT device is often shared by different types of end points, it is desirable to actively manage the maximum number of bindings. This requirement is specified in REQ-3 of <a href="#I-D.ietf-behave-lsn-requirements">[I-D.ietf-behave-lsn-requirements]</a>
</li>
<li>Supports the allocation of specific NAPT/NAT bindings. Two types of specific bindings can be distinguished:<ul>
<li>Allocation of a pre-defined NAT binding: Both the internal and external IP address and port pair are specified within the request. Some deployment cases, such as access to a web-server within a user&#8217;s home network with IP address and port, benefit from statically configured bindings.</li>
<li>Allocation of an external IP address for a given internal IP address: The allocated external IP address is reported back to the requestor. In some deployment scenarios, the application requires immediate knowledge of the allocated binding for a given internal IP address but does not control the allocation of the external IP address; for example, SIP-proxy server deployments.</li>
</ul>
</li>
<li>Defines the external address pool(s) to be used for allocating an external IP address: External address pools can either be pre-assigned at the NAPT/NAT device, or specified within a request.  If pre-assigned address pools are used, a request needs to include a reference to identify the pool. Otherwise, the request contains a description of the IP address pool(s) to be used; for example, a list of IP-subnets. Such external address pools can be used to select the external IP address in NAPT/NAT bindings for multiple subscribers.</li>
<li>Generates reports and accounting records: Reports established bindings for a particular user. The collected information is used by accounting systems for statistical purposes.</li>
<li>Queries and retrieves details about bindings on demand: This feature complements the previously mentioned accounting functionality (see item 4). This feature can be used by an entity to find NAT-bindings belonging to one or multiple end points on the NAT-device. The entity is not required to create a DNCA control session to perform the query.</li>
<li>Identifies a subscriber or endpoint on multiple network devices (NAT/NAPT device, the AAA-server, or the Network Access Server (NAS)): Endpoint identification is facilitated through a Global Endpoint ID. Endpoints are identified through a single or a set of classifiers, such as IP address, Virtual Local Area Network (VLAN) identifier, or interface identifier which uniquely identify the traffic associated with a particular global endpoint.</li>
</ol>
<p id="rfc.section.1.p.4">With the above capabilities, DNCA qualifies as a MIDCOM protocol <a href="#RFC3303">[RFC3303]</a>, <a href="#RFC3304">[RFC3304]</a>, <a href="#RFC5189">[RFC5189]</a> for middle boxes which perform NAT. The MIDCOM protocol evaluation <a href="#RFC4097">[RFC4097]</a> evaluated Diameter as a candidate protocol for MIDCOM. DNCA provides the extensions to the Diameter base protocol <a href="#RFC3588">[RFC3588]</a> following the MIDCOM protocol requirements, such as the support of NAT-specific rule transport, support for oddity of mapped ports, as well as support for consecutive range port numbers. DNCA adds to the MIDCOM protocol capabilities in that it allows to maintain the reference to an end point representing a user or subscriber in the control operation, enabling the control of the behavior of a NAT-device on a per end point basis.  Following the requirements of different operators and deployments, different management protocols are employed. Examples include e.g. SNMP <a href="#RFC3411">[RFC3411]</a> and NETCONF <a href="#RFC6241">[RFC6241]</a> which can both be used for device configuration. Similarly, DNCA is complementing existing MIDCOM implementations, offering a MIDCOM protocol option for operators with an operational environment that is Diameter-focused which desire to use Diameter to perform per end point NAT control. </p>
<p id="rfc.section.1.p.5">This document is structured as follows: Section 2 lists terminology, while Section 3 provides an introduction to DNCA and its overall deployment framework. Sections 4 to 8 cover DNCA specifics, with Section 4 describing session management, Section 5 the use of the Diameter base protocol, Section 6 new commands, Section 7 Attribute Value Pairs(AVPs) used, and Section 8 accounting aspects. Section 9 presents AVP occurrence tables. IANA and security considerations are addressed in Sections 10 and 11.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#Conventions" id="Conventions">Conventions</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.2.p.2">Abbreviations used in this document:</p>
<p></p>

<ul class="empty">
<li>AAA: Authentication, Authorization, Accounting</li>
<li>DNCA: Diameter Network address and port translation Control Application</li>
<li>NAPT: Network Address and Port Translation, see also <a href="#RFC3022">[RFC3022]</a>
</li>
<li>NAT: Network Address Translation (NAT and NAPT are used in this document interchangeably)</li>
<li>NAT-binding or binding: Association of two IP address/port pairs (with one IP address typically being private and the other one public) to facilitate NAT</li>
<li>NAT Binding Predefined template: Is a policy template or configuration that is predefined at the NAT-device. It may contain NAT-bindings, IP-address pools for allocating the external IP-address of a NAT-binding, the maximum number of allowed NAT-bindings for end-points, etc.</li>
<li>NAT-device: Network Address Translator or Network Address and Port Translator: An entity performing NAT or NAPT.</li>
<li>NAT-controller: Entity controlling the behavior of a NAT-device.</li>
<li>NAS: Network Access Server</li>
<li>NCR: NAT Control Request</li>
<li>NCA: NAT Control Answer</li>
<li>NAT44: IPv4 to IPv4 network address and port translation, see <a href="#RFC2663">[RFC2663]</a>
</li>
<li>NAT64: IPv6 to IPv4 address family translation, see <a href="#RFC6145">[RFC6145]</a> and <a href="#RFC6146">[RFC6146]</a>
</li>
<li>PPP: Point-to-Point Protocol <a href="#RFC1661">[RFC1661]</a>
</li>
</ul>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#framework" id="framework">Deployment Framework</a>
</h1>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Deployment Scenario</h1>
<p><a href="#fig-network-deployment">Figure 1</a> shows a typical network deployment for IPv4-Internet access. A user&#8217;s IPv4 host gains access to the Internet though a NAS, which facilitates the authentication of the endpoint and configures the user&#8217;s connection according to the authorization and configuration data received from the AAA-server upon successful authentication. Public IPv4 addresses are used throughout the network.</p>
<div id="#rfc.figure.1"></div>
<div id="#fig-network-deployment"></div>
<pre>
                      +---------+
                      |         |
                      |   AAA   |
                      |         |
                      +---------+
                           |
                           |
                           |
                           |
 +---------+          +---------+             +----------+
 |  IPv4   |          |         |             |  IPv4    |
 |  Host   |----------|   NAS   |-------------| Internet |
 |         |          |         |             |          |
 +---------+          +---------+             +----------+

 &lt;-------------------- Public IPv4 ----------------------&gt;
</pre>
<p><a href="#fig-NAT-deployment">Figure 2</a> depicts the deployment scenario where a service provider places a NAT between the host and the public Internet. The objective is to provide the customer with connectivity to the public IPv4 Internet. The NAT-device performs network address and port (and optionally address family) translation, depending on whether the access network uses private IPv4 addresses or public IPv6 addresses, to public IPv4 addresses. Note that there may be more than one NAS, NAT-device, or AAA-entity in a deployment, although the figures only depict one entity each for clarity.</p>
<p id="rfc.section.3.1.p.3">If the NAT-device would be put in place without any endpoint awareness, the service offerings of the service provider could be impacted as detailed in <a href="#I-D.ietf-behave-lsn-requirements">[I-D.ietf-behave-lsn-requirements]</a>. This includes cases like:</p>
<p></p>

<ul>
<li>Provisioning static NAT bindings for particular endpoints</li>
<li>Using different public IP address pools for different set of endpoints (for example, residential or business customers)</li>
<li>Reporting allocated bindings on a per endpoint basis</li>
<li>Integrate control of the NAT-device into the already existing per endpoint management infrastructure of the service provider</li>
</ul>
<div id="#rfc.figure.2"></div>
<div id="#fig-NAT-deployment"></div>
<pre>
                +---------+
                |         |
                |   AAA   |
                |         |
                +---------+
                     |
                     |
                     |
                     |
  +--------+    +---------+    +--------+    +----------+
  |        |    |         |    |        |    |          |
  |  Host  |----|   NAS   |----|  NAT-  |----| IPv4-    |
  |        |    |         |    | device |    | Internet |
  +--------+    +---------+    +--------+    +----------+

For NAT44 deployments (IPv4 host):
     &lt;----- Private IPv4 ----------&gt;&lt;--- Public IPv4 ---&gt;

For NAT64 deployments (IPv6 host):
     &lt;----- Public  IPv6 ----------&gt;&lt;--- Public IPv4 ---&gt;
</pre>
<p><a href="#fig-NAT-deployment">Figure 2</a> shows a typical deployment for IPv4-Internet access involving a NAT-device within the service provider network. The figure describes two scenarios: One where an IPv4-host (with a private IPv4 address) accesses the IPv4-Internet, as well as one where an IPv6-host accesses the IPv4-Internet.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Diameter NAPT Control Application Overview</h1>
<p id="rfc.section.3.2.p.1">DNCA runs between two DNCA Diameter peers. One DNCA Diameter peer resides within the NAT-device, the other DNCA Diameter peer resides within a NAT-controller (discussed in Section 3.3). DNCA allows per endpoint control and management of NAT within the NAT-device. Based on Diameter, DNCA integrates well with the suite of Diameter applications deployed for per endpoint authentication, authorization, accounting, and policy control in service provider networks.</p>
<p id="rfc.section.3.2.p.2">DNCA offers:</p>

<ul>
<li>Request and answer commands to control the allowed number of NAT bindings per endpoint to request the allocation of specific bindings for an endpoint, to define the address pool to be used for an endpoint.</li>
<li>Provides per endpoint reporting of the allocated NAT bindings.</li>
<li>Provides unique identification of an endpoint on NAT-device, AAA-server and NAS, to simplify correlation of accounting data streams.</li>
</ul>
<p id="rfc.section.3.2.p.3">DNCA allows controlling the behavior of a NAT-device on a per endpoint basis during initial session establishment and at later stages by providing an update procedure for already established sessions. Using DNCA, per endpoint NAT binding information can be retrieved either using accounting mechanisms or through an explicit session query to the NAT.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> Deployment Scenarios For DNCA</h1>
<p id="rfc.section.3.3.p.1">DNCA can be deployed in different ways. DNCA supports deployments with "n" NAT-controllers and "m" NAT-devices, with n and m equal to or greater than 1. For DNCA, the session representing a particular endpoint is atomic. Any deployment MUST ensure that for every given endpoint only a single NAT-controller and only a single NAT-device are active at any point in time. This is to ensure that NAT-devices controlled by multiple NAT-controllers do not receive conflicting control requests for a particular endpoint, or would be unclear which NAT-controller to send accounting information to.</p>
<p id="rfc.section.3.3.p.2">Two common deployment scenarios are outlined in <a href="#fig-NAT-integrated-deployment">Figure 3</a> (&#8220;integrated deployment&#8221;) and <a href="#fig-NAT-autonomous-deployment">Figure 4</a> (&#8220;autonomous deployment&#8221;). Per the note above, multiple instances of NAT-controllers and NAT-devices could be deployed. The figures only show single instances for reasons of clarity. The two shown scenarios differ in which entity fulfills the role of the NAT-controller. Within the figures (C) denotes the network element performing the role of the NAT-controller.</p>
<p id="rfc.section.3.3.p.3">The integrated deployment approach hides the existence of the NAT-device from external servers, such as the AAA-server. It is suited for environments where minimal changes to the existing AAA deployment are desired. The NAS and the NAT-device are Diameter peers supporting the DNCA. The Diameter peer within the NAS, performing the role of the NAT-controller, initiates and manages sessions with the NAT-device, exchanges NAT specific configuration information and handles reporting and accounting information. The NAS receives reporting and accounting information from the NAT-device. With this information, the NAS can provide a single accounting record for the endpoint. A system correlating the accounting information received from the NAS and NAT-device would not be needed.</p>
<p id="rfc.section.3.3.p.4">An example network attachment for an integrated NAT deployment can be described as follows: An endpoint connects to the network, with the NAS being the point of attachment. After successful authentication, the NAS receives endpoint related authorization data from the AAA-server. A portion of the authorization data applies to per endpoint configuration on the NAS itself, another portion describes authorization and configuration information for NAT control aimed at the NAT-device. The NAS initiates a DNCA session to the NAT-device and sends relevant authorization and configuration information for the particular endpoint to the NAT-device. This can comprise NAT-bindings, which have to be pre-established for the endpoint, or management related configuration, such as the maximum number of NAT-bindings allowed for the endpoint. The NAT-device sends its per endpoint accounting information to the NAS, which aggregates the accounting information received from the NAT-device with its local accounting information for the endpoint into a single accounting stream towards the AAA-server.</p>
<div id="#rfc.figure.3"></div>
<div id="#fig-NAT-integrated-deployment"></div>
<pre>
                +---------+
                |         |
                |   AAA   |
                |         |
                +---------+
                     |
                     |
                     |
  +--------+    +---------+    +--------+    +----------+
  |        |    |   (C)   |    |        |    |          |
  |  Host  |----|   NAS   |----|  NAT-  |----| IPv4-    |
  |        |    |         |    | device |    | Internet |
  +--------+    +---------+    +--------+    +----------+

For NAT44 deployments (IPv4 host):
     &lt;----- Private IPv4 ----------&gt;&lt;--- Public IPv4 ---&gt;

For NAT64 deployments (IPv6 host):
     &lt;----- Public  IPv6 ----------&gt;&lt;--- Public IPv4 ---&gt;
</pre>
<p><a href="#fig-NAT-integrated-deployment">Figure 3</a> shows examples of integrated deployments. The figure describes two scenarios: One where an IPv4-host (with a private IPv4 address) accesses the IPv4-Internet, as well as one where an IPv6-host accesses the IPv4-Internet.</p>
<p id="rfc.section.3.3.p.6">The autonomous deployment approach decouples user management on the NAS and NAT-device. In the autonomous deployment approach, the AAA-system and the NAT-device are the Diameter peers running the DNCA.  The AAA-system also serves as NAT-controller. It manages the connection to the NAT-device, controls the per endpoint configuration, and also receives accounting and reporting information from the NAT-device. Different from the integrated deployment scenario, the autonomous deployment scenario does not &#8220;hide&#8221; the existence of the NAT-device from the AAA infrastructure. Here two accounting streams are received by the AAA-server for one particular endpoint, one from the NAS, and one from the NAT-device.</p>
<div id="#rfc.figure.4"></div>
<div id="#fig-NAT-autonomous-deployment"></div>
<pre>
                +---------+
                |   (C)   |
                |   AAA   |---------
                |         |         |
                +---------+         |
                     |              |
                     |              |
                     |              |
  +--------+    +---------+    +---------+    +----------+
  |  IPv4/ |    |         |    |         |    |  IPv4    |
  |  IPv6  |----|   NAS   |----|  NAT-   |----| Internet |
  |  Host  |    |         |    | device  |    |          |
  +--------+    +---------+    +---------+    +----------+

For NAT44 deployments (IPv4 host):
     &lt;----- Private IPv4 ----------&gt;&lt;--- Public IPv4 ---&gt;

For NAT64 deployments (IPv6 host):
     &lt;----- Public  IPv6 ----------&gt;&lt;--- Public IPv4 ---&gt;</pre>
<p><a href="#fig-NAT-autonomous-deployment">Figure 4</a> shows examples of autonomous deployments. The figure describes two scenarios: One where an IPv4-host (with a private IPv4 address) accesses the IPv4-Internet, as well as one where an IPv6-host accesses the IPv4-Internet.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#sec-dnca" id="sec-dnca">DNCA Session Establishment and Management</a>
</h1>
<p id="rfc.section.4.p.1">Note that this section forward references some of the commands and AVPs defined for DNCA. Please refer to <a href="#sec-dnca-commands">Section 6</a> and <a href="#sec-dnca-avps">Section 8</a> for details. DNCA runs between a Diameter peer residing in a NAT-controller and a Diameter peer residing in a NAT-device. The Diameter peer within the NAT-controller is always the control requesting entity: It initiates, updates, or terminates the sessions. Sessions are initiated when the NAT-controller learns about a new endpoint (i.e., host) that requires a NAT service. This could for example be due to the entity hosting the NAT-controller receiving authentication, authorization, or accounting requests for or from the endpoint. Alternate methods that could trigger session setup include local configuration, receipt of a packet from a formerly unknown IP-address, etc.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Session Establishment</h1>
<p id="rfc.section.4.1.p.1">The DNCA Diameter peer within the NAT-controller establishes a session with the DNCA Diameter peer within the NAT-device to control the behavior of the NAT function within the NAT-device. During session establishment, the DNCA Diameter peer within the NAT-controller passes along configuration information to DNCA Diameter peer within the NAT-device. The session configuration information comprises the maximum number of bindings allowed for the endpoint associated with this session, a set of pre-defined NAT bindings to be established for this endpoint, or a description of the address pool, that external addresses are to be allocated from.</p>
<p id="rfc.section.4.1.p.2">The DNCA Diameter peer within the NAT-controller generates a NAT-Control Request (NCR) message to the DNCA Diameter peer within the NAT-device with NC-Request-Type AVP set to INITIAL_REQUEST to initiate a Diameter NAT control session. On receipt of a NCR the DNCA Diameter peer within the NAT-device sets up a new session for the endpoint associated with the endpoint classifier(s) contained in the NCR. The DNCA Diameter peer within the NAT-device notifies its DNCA Diameter peer within the NAT-controller about successful session setup using a NAT-Control Answer (NCA) message with Result-Code set to DIAMETER_SUCCESS. <a href="#fig-session-establishment">Figure 5</a> shows the initial protocol interaction between the two DNCA Diameter peers.</p>
<p id="rfc.section.4.1.p.3">The initial NAT-Control-Request MAY contain configuration information for the session, which specifies the behavior of the NAT-device for the session. The configuration information that MAY be included, comprises: </p>

<ul>
<li>A list of NAT bindings, which should be pre-allocated for the session; for example, in case a user requires a fixed external IP-address/port pair for one of his applications.</li>
<li>The maximum number of NAT-bindings allowed for an endpoint.</li>
<li>A description of the external IP-address pool(s) to be used for the session.</li>
<li>A reference to a NAT Binding Predefined template on the NAT-device, which is applied to the session. Such a NAT Binding Predefined template on the NAT-device may contain, for example, the name of the IP-address pool that external IP-addresses should be allocated from, the maximum number of bindings permitted for the endpoint, etc.</li>
</ul>
<p id="rfc.section.4.1.p.4">In certain cases, the NAT-device may not be able to perform the tasks requested within the NCR. These include the following: </p>

<ul>
<li>If a DNCA Diameter peer within the NAT-device receives a NCR from a DNCA Diameter peer within a NAT-controller with NC-Request-Type AVP set to INITIAL_REQUEST that identifies an already existing session; that is, DNCA Diameter peer and endpoint identifier match an already existing session, the DNCA Diameter peer within the NAT-device MUST return an NCA with Result-Code set to SESSION_EXISTS, and provide the Session-Id of the existing session in the Duplicate-Session-Id AVP.</li>
<li>If a DNCA Diameter peer within the NAT-device receives a NCR from a DNCA Diameter peer within a NAT-controller with NC-Request-Type AVP set to INITIAL_REQUEST that matches more than one of the already existing sessions; that is, DNCA Diameter peer and endpoint identifier match already existing sessions, the DNCA Diameter peer within the NAT-device MUST return an NCA with Result-Code set to INSUFFICIENT-CLASSIFIERS. In case a DNCA Diameter peer receives a NCA that reports Insufficient-Classifiers, it MAY choose to retry establishing a new session using additional or more specific classifiers.</li>
<li>If the NCR contains a NAT Binding Predefined template not defined on the NAT-device, the DNCA Diameter peer within the NAT-device MUST return an NCA with Result-Code AVP set to UNKNOWN_BINDING_TEMPLATE_NAME.</li>
<li>In case the NAT-device is unable to establish all of the bindings requested in the NCR, the DNCA Diameter peer MUST return an NCA with Result-Code set to BINDING_FAILURE. A DNCA Diameter peer within a NAT-device MUST treat a NCR as an atomic operation; hence none of the requested bindings will be established by the NAT-device. Either all requested actions within a NCR MUST be completed successfully, or the entire request fails.</li>
<li>If a NAT-device does not have sufficient resources to process a request, the DNCA Diameter peer MUST return an NCA with Result-Code set to RESOURCE_FAILURE.</li>
<li>In case Max-NAT-Binding, NAT-Control-Definition as well as NAT-Control-Binding-Template are included in the NCR, and the values in Max-NAT-Binding and NAT-Control-Definition contradict those specified in the pre-provisioned template on the NAT-device which NAT-Control-Binding-Template references, Max-NAT-Binding and NAT-Control-Definition MUST override the values specified in the template that NAT-Control-Binding-Template refers to.</li>
</ul>
<div id="#rfc.figure.5"></div>
<div id="#fig-session-establishment"></div>
<pre>
NAT-controller (DNCA Diameter peer)   NAT-device (DNCA Diameter peer)
            |                                           |
            |                                           |
            |                                           |
         Trigger                                        |
            |                                           |
            |                   NCR                     |
            |------------------------------------------&gt;|
            |                                           |
            |                                           |
            |                                           |
            |                                           |
            |                                 If Able to comply
            |                                 with Request then
            |                                 Create session state
            |                                           |
            |                                           |
            |                     NCA                   |
            |&lt;------------------------------------------|
            |                                           |
            |                                           |</pre>
<p id="rfc.section.4.1.p.5">Note: The DNCA Diameter peer within the NAT-device creates session state only if it is able to comply with the NCR. On success it will reply with an NCA with Result-Code set to DIAMETER_SUCCESS.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Session Re-Authorization</h1>
<p id="rfc.section.4.2.p.1">Session re-authorization is performed if the NAT-controller desires to change the behavior of the NAT-device for an existing session.  Session re-authorization could be used, for example, to change the number of allowed bindings for a particular session, or establish or remove a pre-defined binding.</p>
<p id="rfc.section.4.2.p.2">The DNCA Diameter peer within the NAT-controller generates a NCR message to the DNCA Diameter peer within the NAT-device with NC-Request-Type AVP set to UPDATE_REQUEST upon receiving a trigger signal. If the session is updated successfully, the DNCA Diameter peer within the NAT-device notifies the DNCA Diameter peer within the NAT-controller about the successful session update using a NAT-Control Answer (NCA) message with Result-Code set to DIAMETER_SUCCESS. <a href="#fig-session-re-auth">Figure 6</a> shows the protocol interaction between the two DNCA Diameter peers.</p>
<p id="rfc.section.4.2.p.3">In certain cases, the NAT-device may not be able to perform the tasks requested within the NCR. These include the following: </p>

<ul>
<li>If DNCA Diameter peer within a NAT-device receives an NCR update or query request for a non-existent session, it MUST set Result-Code in the answer to DIAMETER_UNKNOWN_SESSION_ID.</li>
<li>If the NCR contains a NAT Binding Predefined template not defined on the NAT-device, an NCA with Result-Code AVP set to UNKNOWN_BINDING_TEMPLATE_NAME MUST be returned.</li>
<li>If the NAT-device cannot establish the requested binding because the maximum number of allowed bindings has been reached for the endpoint classifier, an NCA with Result-Code AVP set to MAXIMUM_BINDINGS_REACHED_FOR_ENDPOINT MUST be returned to the DNCA Diameter peer.</li>
<li>If the NAT-device cannot establish some or all of the bindings requested in an NCR, but has not yet reached the maximum number of allowed bindings for the endpoint, an NCA with Result-Code set to BINDING_FAILURE MUST be returned. As already noted, the DNCA Diameter peer in a NAT-device MUST treat an NCR as an atomic operation. Hence none of the requested bindings will be established by the NAT-device in case of failure. Actions requested within a NCR are either all successful or all fail.</li>
<li>If the NAT-device does not have sufficient resources to process a request, an NCA with Result-Code set to RESOURCE_FAILURE MUST be returned.</li>
<li>If an NCR redefines the maximum number of NAT-bindings allowed for the endpoint, the new value MUST override any previously defined limit on NAT bindings. It depends on the implementation of the NAT-device on how the NAT-device copes with a case where the new value is lower than the actual number of allocated bindings.  The NAT-device MAY refrain from enforcing the new limit immediately (that is, actively remove bindings), but rather disallows the establishment of new bindings until the current number of bindings is lower than the newly established maximum number of allowed bindings.</li>
<li>If an NCR specifies a new NAT Binding Predefined template on the NAT-device, the NAT Binding Predefined template overrides any previously defined rule for the session.</li>
<li>In case Max-NAT-Binding, NAT-Control-Definition as well as NAT-Control-Binding-Template are included in the NCR, and the values in Max-NAT-Binding and NAT-Control-Definition contradict those specified in the pre-provisioned template on the NAT-device which NAT-Control-Binding-Template references, Max-NAT-Binding and NAT-Control-Definition MUST override the values specified in the template that the NAT-Control-Binding-Template refers to.</li>
</ul>

<p>Note: Already established bindings for the session SHOULD NOT be affected in case the tasks requested within the NCR cannot be completed.</p>
<div id="#rfc.figure.6"></div>
<div id="#fig-session-re-auth"></div>
<pre>
NAT-controller (DNCA Diameter peer)   NAT-device (DNCA Diameter peer)
            |                                           |
            |                                           |
            |                                           |
     Change of session                                  |
        attributes                                      |
            |                                           |
            |                   NCR                     |
            |------------------------------------------&gt;|
            |                                           |
            |                                           |
            |                                   If able to comply 
            |                                   with the request:
            |                                  Update session state
            |                                           |
            |                                           |
            |                     NCA                   |
            |&lt;------------------------------------------|
            |                                           |</pre>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> Session and Binding Query</h1>
<p id="rfc.section.4.3.p.1">A Session and NAT-binding query MAY be used by the DNCA Diameter peer within the NAT-controller to either retrieve information on the current bindings for a particular session at the NAT-device or discover the session identifier for a particular external IP address/port pair.</p>
<p id="rfc.section.4.3.p.2">A DNCA Diameter peer within the NAT-controller starts a session query by sending an NCR message with NC-Request-Type AVP set to QUERY_REQUEST. <a href="#fig-session-query">Figure 7</a> shows the protocol interaction between the DNCA Diameter peers.</p>
<p id="rfc.section.4.3.p.3">Two types of query requests exist. The first type of query request uses the session ID as input parameter to the query. It is to allow the DNCA Diameter peer within the NAT-controller to retrieve the current set of bindings for a specific session. The second type of query request is used to retrieve the session identifiers, along with the associated bindings, matching a criteria. This enables the DNCA Diameter peer within the NAT-controller to find those sessions, which utilize a specific external IP-address.</p>
<p></p>

<ol>
<li>Request a list of currently allocated NAT bindings for a particular session: On receiving a NCR, the NAT-device SHOULD look up the session information for the session ID contained in the NCR, and report all currently active NAT-bindings for the session using an NCA message with Result-Code set to DIAMETER_SUCCESS. In this case the NCR MUST NOT contain a NAT-Control-Definition AVP.  Each NAT-binding is reported in a NAT-Control-Definition AVP. In case the session ID is unknown, the DNCA Diameter peer within the NAT-device MUST return an NCA message with Result-Code set to DIAMETER_UNKNOWN_SESSION_ID.</li>
<li>Retrieve session IDs and internal IP address/port pairs for one or multiple external IP-address/port pairs: If the DNCA Diameter peer within the NAT-controller wishes to retrieve the session ID(s) for one or multiple external IP-address/port pairs, it MUST include the external IP-address/port pair(s) as part of the NAT-Control-Definition AVP of the NCR. The external IP-address/port pair(s) are pre-known to the controller via configuration, AAA interactions, or other means. The session ID is not included in the NCR or the NCA for this type of a query. The DNCA Diameter peer within the NAT-device SHOULD report the NAT-bindings and associated session IDs corresponding to the external IP-address/port pairs in an NCA message using one or multiple instances of the NAT-Control-Definition AVP. The Result-Code is set to DIAMETER_SUCCESS. In case an external IP-address/port pair has no associated existing NAT-binding, the NAT-Control-Definition AVP contained in the reply just contains the NAT-External-Address AVP.</li>
</ol>
<div id="#rfc.figure.7"></div>
<div id="#fig-session-query"></div>
<pre>
NAT-controller (DNCA Diameter peer)   NAT-device (DNCA Diameter peer)
            |                                           |
            |                                           |
            |                                           |
  DNCA Session Established                              |
            |                                           |
            |                   NCR                     |
            |------------------------------------------&gt;|
            |                                           |
            |                                           |
            |                                           |
            |                                           |
            |                          Look up corresponding session
            |                            and associated NAT-bindings
            |                                           |
            |                   NCA                     |
            |&lt;------------------------------------------|
            |                                           |
            |                                           |
            |                                           |</pre>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#sec-dnca-sess-term" id="sec-dnca-sess-term">Session Termination</a>
</h1>
<p id="rfc.section.4.4.p.1">Similar to session initiation, session tear down MUST be initiated by the DNCA Diameter peer within the NAT-controller. The DNCA Diameter peer sends a Session Terminate Request (STR) message to its peer within the NAT-device upon receiving a trigger signal. The source of the trigger signal is outside the scope of this document. As part of STR message processing the DNCA Diameter peer within the NAT-device MAY send an accounting stop record reporting all bindings. All the NAT-bindings belonging to the session are removed and the session state is cleaned up. The DNCA Diameter peer within the NAT-device MUST notify its DNCA Diameter peer in the NAT-controller about successful session termination using a Session Terminate Answer (STA) message with Result-Code set to DIAMETER_SUCCESS. <a href="#fig-session-terminate">Figure 8</a> shows the protocol interaction between the two DNCA Diameter peers.</p>
<p id="rfc.section.4.4.p.2">If a DNCA Diameter peer within a NAT-device receives a STR and fails to find a matching session, the DNCA Diameter peer MUST return a STA with Result-Code set to DIAMETER_UNKNOWN_SESSION_ID.</p>
<div id="#rfc.figure.8"></div>
<div id="#fig-session-terminate"></div>
<pre>
NAT-controller (DNCA Diameter peer)   NAT-device (DNCA Diameter peer)
            |                                            |
            |                                            |
         Trigger                                         |
            |                                            |
            |                   STR                      |
            |-------------------------------------------&gt;|
            |                                            |
            |                                            |
            |                                            |
            |                                            |
            |                                            |
            |           Send accounting stop             |
            |&lt;-------------------------------------------|
            |       reporting all session bindings       |
            |                                            |
            |                                            |
            |                                  Remove NAT-bindings
            |                                       of session   
            |                                            |
            |                                  Terminate session /
            |                                 Remove session state
            |                                            |
            |                                            |
            |                                            |
            |                  STA                       |
            |&lt;-------------------------------------------|
            |                                            |
            |                                            |</pre>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> Session Abort</h1>
<p id="rfc.section.4.5.p.1">An Abort-Session-Request (ASR) message is sent from the DNCA Diameter peer within the NAT-device to the DNCA Diameter peer within the NAT-controller when it is unable to maintain a session due to resource limitations. The DNCA Diameter peer within the NAT-controller MUST acknowledge successful session abort using a Abort Session Answer (ASA) message with Result-Code set to DIAMETER_SUCCESS. <a href="#fig-session-abort">Figure 9</a> shows the protocol interaction between the DNCA Diameter peers. The DNCA Diameter peers will start a session termination procedure as described in <a href="#sec-dnca-sess-term">Section 4.4</a> following an ASA with Result-Code set to DIAMETER_SUCCESS.</p>
<p id="rfc.section.4.5.p.2">If the DNCA Diameter peer within a NAT-controller receives an ASR but fails to find a matching session, it MUST return an ASA with Result-Code set to DIAMETER_UNKNOWN_SESSION_ID. If the DNCA Diameter peer within the NAT-controller is unable to comply with the ASR for any other reason, an ASA with Result-Code set to DIAMETER_UNABLE_TO_COMPLY MUST be returned.</p>
<div id="#rfc.figure.9"></div>
<div id="#fig-session-abort"></div>
<pre>
NAT-controller (DNCA Diameter peer)   NAT-device (DNCA Diameter peer)
            |                                            |
            |                                            |
            |                                         Trigger
            |                                            |
            |                   ASR                      |
            |&lt;-------------------------------------------|
            |                                            |
            |                                            |
            |                                            |
            |                  ASA                       |
            |-------------------------------------------&gt;|
            |                                            |
            |                                            |
            |                                            |
            |           On successful ASA                |
            |&lt;------Session Termination Procedure-------&gt;|</pre>
<h1 id="rfc.section.4.6">
<a href="#rfc.section.4.6">4.6.</a> Failure cases of the DNCA Diameter peers</h1>
<p id="rfc.section.4.6.p.1">This document does not specify the behavior in case the NAT-device and NAT-controller, or their respective DNCA Diameter peers are out of sync or lose state. This could happen for example if one of the entities restarts, in case of a (temporary) loss of network connectivity etc. Example failure cases include the following:</p>
<p></p>

<ul>
<li>NAT-controller and the DNCA Diameter peer within the NAT-controller lose state (e.g., due to a restart). In this case, <ul>
<li>the DNCA Diameter peer within the NAT-device MAY receive an NCR with NC-Request-Type AVP set to INITIAL_REQUEST that matches an existing session of the DNCA Diameter peer within the NAT-device. The DNCA Diameter peer within the NAT-device MUST return Result-Code that contains Duplicate-Session-Id AVP to report the Session-ID of the existing session. The DNCA Diameter peer within the NAT-controller MAY send an explicit Session Terminate Request (STR) for the older session, which was lost.</li>
<li>a DNCA Diameter peer MAY receive accounting records for a session that does not exist. The DNCA Diameter peer sends an accounting answer with Result-Code set to DIAMETER_UNKNOWN_SESSION_ID in response. On receiving the response, the DNCA Diameter peer SHOULD clear the session and remove associated session state.</li>
</ul>
</li>
<li>NAT-device and the DNCA Diameter peer within NAT-device lose state. In such a case, the DNCA Diameter peer MAY receive a NCR with NC-Request-Type AVP set to UPDATE_REQUEST for a non-existent session. The DNCA Diameter peer MUST return an NCA with Result-Code set to DIAMETER_UNKNOWN_SESSION_ID.</li>
<li>The DNCA Diameter peer within the NAT-controller is unreachable, for example detected by Diameter device watchdog messages (as defined in Section 5.5 of <a href="#RFC3588">[RFC3588]</a>), or down and accounting requests from the DNCA Diameter peer fail to get a response. The mechanism to ensure that a DNCA Diameter peer within the NAT-controller no longer has associated state for a session which was cleared or removed by the DNCA Diameter peer within the NAT-device is beyond the scope of this document.</li>
<li>The DNCA Diameter peer within the NAT-device is unreachable or down and NCR fails to get a response. Handling of this case depends on the actual service offering of the service provider.  The service provider could for example choose to stop offering connectivity service.</li>
</ul>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#sec-diameter-base-use" id="sec-diameter-base-use">Use of the Diameter Base Protocol</a>
</h1>
<p id="rfc.section.5.p.1">The Diameter Base Protocol defined by <a href="#RFC3588">[RFC3588]</a> applies with the clarifications listed in the present specification.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#sec-diameter-messages" id="sec-diameter-messages">Securing Diameter Messages </a>
</h1>
<p id="rfc.section.5.1.p.1">For secure transport of Diameter messages, the recommendations in <a href="#RFC3588">[RFC3588]</a> apply.</p>
<p id="rfc.section.5.1.p.2">DNCA Diameter peers SHOULD verify their identity during the Capabilities Exchange Request procedure.</p>
<p id="rfc.section.5.1.p.3">A DNCA Diameter peer within the NAT-device SHOULD verify that a DNCA Diameter peer that issues a NCR command is allowed to do so based on: </p>

<ul>
<li>The identity of the DNCA Diameter peer</li>
<li>The type of NCR Command</li>
<li>The content of the NCR Command</li>
<li>Any combination of the above</li>
</ul>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Accounting Functionality</h1>
<p id="rfc.section.5.2.p.1">Accounting functionality (accounting session state machine, related command codes and AVPs) is defined in <a href="#sec-accounting">Section 9</a> below.</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> Use of Sessions</h1>
<p id="rfc.section.5.3.p.1">Each DNCA session MUST have a globally unique Session-ID as defined in <a href="#RFC3588">[RFC3588]</a>, which MUST NOT be changed during the lifetime of a DNCA session. The Diameter Session-ID serves as the global endpoint identifier. The DNCA Diameter peers maintain state associated with the Session-ID. This globally unique Session-ID is used for updating, accounting, and terminating the session. A DNCA session MUST NOT have more than one outstanding request at any given instant. A DNCA Diameter peer sends an Abort-Session-Request as defined in <a href="#RFC3588">[RFC3588]</a> if it is unable to maintain sessions due to resource limitation.</p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> Routing Considerations</h1>
<p id="rfc.section.5.4.p.1">It is assumed that the DNCA Diameter peer within a NAT-controller knows the DiameterIdentity of the Diameter peer within a NAT-device for a given endpoint. Both the Destination-Realm and Destination-Host AVPs are present in the request from a DNCA Diameter peer within a NAT-controller to a DNCA Diameter peer within a NAT-device.</p>
<h1 id="rfc.section.5.5">
<a href="#rfc.section.5.5">5.5.</a> Advertising Application Support</h1>
<p id="rfc.section.5.5.p.1">Diameter nodes conforming to this specification MUST advertise support for DNCA by including the value of TBD in the Auth-Application-Id of the Capabilities-Exchange-Request and Capabilities-Exchange-Answer command<a href="#RFC3588">[RFC3588]</a>.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#sec-dnca-commands" id="sec-dnca-commands">DNCA Commands</a>
</h1>
<p id="rfc.section.6.p.1">The following commands are used to establish, maintain and query NAT-bindings.</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#sec-dnca-ncr" id="sec-dnca-ncr">NAT-Control Request (NCR) Command</a>
</h1>
<p id="rfc.section.6.1.p.1">The NAT-Control Request (NCR) command, indicated by the command field set to TBD and the "R" bit set in the Command Flags field, is sent from the DNCA Diameter peer within the NAT-controller to the DNCA Diameter peer within the NAT-device in order to install NAT-bindings.</p>
<p id="rfc.section.6.1.p.2">User-Name, Logical-Access-Id, Physical-Access-ID, Framed-IP-Address, Framed-IPv6-Prefix, Framed-Interface-Id, EGRESS-VLANID, NAS-Port-ID, Address-Realm, Calling-Station-ID AVPs serve as identifiers for the endpoint.</p>
<p id="rfc.section.6.1.p.3">Message format:</p>
<div id="#rfc.figure.10"></div>
<pre>   &lt; NC-Request &gt; ::= &lt; Diameter Header: TBD, REQ, PXY&gt;
                    [ Session-Id ]
                    { Auth-Application-Id }
                    { Origin-Host }
                    { Origin-Realm }
                    { Destination-Realm }
                    { Destination-Host }
                    { NC-Request-Type }
                    [ Origin-State-Id ]
                 *1 [ NAT-Control-Remove ]
                 *1 [ NAT-Control-Install ]
                    [ User-Name ]
                    [ Logical-Access-Id ]
                    [ Physical-Access-ID ]
                    [ Framed-IP-Address ]
                    [ Framed-IPv6-Prefix ]
                    [ Framed-Interface-Id ]
                    [ EGRESS-VLANID]
                    [ NAS-Port-ID]
                    [ Address-Realm ]
                    [ Calling-Station-ID ]
                  * [ Proxy-Info ]
                  * [ Route-Record ]
                  * [ AVP ]
</pre>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#sec-dnca-nca" id="sec-dnca-nca">NAT-Control Answer (NCA) Command</a>
</h1>
<p id="rfc.section.6.2.p.1">The NAT-Control-Answer (NCA) command, indicated by the Command-Code field set to TBD and the "R" bit cleared in the Command Flags field, is sent by the DNCA Diameter peer within the NAT-device in response to NAT-Control-Request command.</p>
<p id="rfc.section.6.2.p.2">Message format:</p>
<div id="#rfc.figure.11"></div>
<pre>   &lt;NC-Answer&gt; ::= &lt; Diameter Header: TBD, PXY &gt;
                   [ Session-Id ]
                   { Origin-Host }
                   { Origin-Realm }
                   { Result-Code }
                   [ NC-Request-Type ]
                 * [ NAT-Control-Definition ]
                   [ Current-NAT-Bindings   ]
                   [ Origin-State-Id ]
                   [ Error-Message ]
                   [ Error-Reporting-Host ]
                 * [ Failed-AVP ]
                 * [ Proxy-Info ]
                   [ Duplicate-Session-ID ]
                 * [ Redirect-Host]
                   [ Redirect-Host-Usage ]
                   [ Redirect-Max-Cache-Time ]
                 * [ Proxy-Info ]
                 * [ Route-Record ]
                 * [ Failed-AVP ]
                 * [ AVP ]

</pre>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> NAT Control Application Session State Machine</h1>
<p id="rfc.section.7.p.1">This section contains a set of finite state machines, representing the life cycle of a DNCA session, which MUST be observed by all implementations of the DNCA Diameter application. The DNCA Diameter peers are stateful and the state machine maintained is similar to the stateful Client and Server authorization state machine described in <a href="#RFC3588">[RFC3588]</a>. When a session is moved to the Idle state, any resources that were allocated for the particular session must be released. Any event not listed in the state machines MUST be considered as an error condition, and an answer, if applicable, MUST be returned to the originator of the message.</p>
<p id="rfc.section.7.p.2">In the state table, the event 'Failure to send NCR' means that the DNCA Diameter peer within the NAT-controller is unable to send the NCR command to the desired destination. This could be due to the peer being down, or due to the peer sending back the transient failure or temporary protocol error notification DIAMETER_TOO_BUSY or DIAMETER_LOOP_DETECTED in the Result-Code AVP of an NCA.</p>
<p id="rfc.section.7.p.3">In the state table "FAILED NCA" means that the DNCA Diameter peer within the NAT-device was not able to honor the corresponding NCR. This can happen due to any transient and permanent error at the NAT-device or its associated DNCA Diameter peer within indicated by the following error Result-Code values: RESOURCE_FAILURE, UNKNOWN_BINDING_TEMPLATE_NAME, BINDING_FAILURE, MAXIMUM_BINDINGS_REACHED_FOR_ENDPOINT, SESSION_EXISTS, INSUFFICIENT_CLASSIFIERS.</p>
<p id="rfc.section.7.p.4">The following state machine is observed by a DNCA Diameter peer within a NAT-controller. The state machine description uses the term "access session" to describe the connectivity service offered to the endpoint or host. "Access session" should not be confused with the Diameter session ID.</p>
<div id="#rfc.figure.12"></div>
<pre>          DNCA Diameter peer within a NAT-controller
   State     Event                          Action     New State
   -------------------------------------------------------------
   Idle      New endpoint detected that     Send       Pending
             requires NAT Control           NCR
                                            Initial 
                                            Request

   Idle      ASR Received                   Send ASA   Idle
             for unknown session            with
                                            Result-Code
                                            = UNKNOWN_
                                            SESSION_ID

   Pending   Successful NCA                 Setup      Open
             received                       complete

   Pending   Successful NCA                 Send STR   Discon
             received
             but peer unable to provide
             service

   Pending   Error processing successful    Send STR   Discon
             NCA

   Pending   Failed                         Clean up   Idle
             NCA received

   Open      NAT control                    Send       Open
             update required                NCR Update
                                            Request

   Open      Successful                                Open
             NCA received  

   Open      Failed                         Clean up   Idle
             NCA received                  
             

   Open      Access session end detected    Send STR   Discon
             

   Open      ASR Received,                  Send ASA   Discon
             access session will be         with
             terminated                     Result-Code
                                            = SUCCESS,
                                            Send STR

   Open      ASR Received,                  Send ASA   Open
             access session will not        with
             be terminated                  Result-Code
                                            != SUCCESS
   
   Discon    ASR Received                   Send ASA   Idle

   Discon    STA Received                   Discon.    Idle
                                            user/device</pre>
<p></p>
<p id="rfc.section.7.p.6">The following state machine is observed by a DNCA Diameter peer within a NAT-device.</p>
<div id="#rfc.figure.13"></div>
<pre>
          DNCA Diameter peer within a NAT-device
   State     Event                          Action     New State
   -------------------------------------------------------------
   Idle      NCR Query request              Send       Idle
             received, and                  successful
             able to provide requested      NCA 
             NAT Binding report             

   Idle      NCR received                   Send       Open
             and able to                    successful
             provide requested              NCA
             NAT control service

   Idle      NCR request                    Send       Idle
             received, and                  failed 
             unable to provide requested    NCA
             NAT control service
     
   Open      NCR  request                   Send       Open
             received, and                  successful
             able to provide requested      NCA
             NAT control service       

   Open      NCR request                    Send       Idle
             received, and                  failed 
             unable to provide requested    NCA,
             NAT control service            Clean up

   Open      Unable to continue             Send ASR   Discon
             providing requested
             NAT control service

   Discon    Failure to send ASR            Wait,      Discon
                                            resend ASR

   Discon    ASR successfully sent and      Clean up   Idle
             ASA Received with Result-Code

   Not       ASA Received                   None       No change
   Discon

   Any       STR Received                   Send STA,  Idle
                                            Clean up</pre>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#sec-dnca-avps" id="sec-dnca-avps">DNCA AVPs</a>
</h1>
<p></p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> Reused Base Protocol AVPs</h1>
<p id="rfc.section.8.1.p.1">The following table describes the AVPs reused from Diameter Base Protocol <a href="#RFC3588">[RFC3588]</a>; their AVP Code values, types, and possible flag values; and whether the AVP MAY be encrypted.The <a href="#RFC3588">[RFC3588]</a> specifies the AVP Flag rules for AVPs in section 4.5. The Diameter AVP rules are defined in the <a href="#RFC3588">[RFC3588]</a>, section 4.</p>
<div id="#rfc.figure.14"></div>
<div id="#tab-avps-from-diameter-base"></div>
<pre>                                                +---------+
                                                |  AVP    |
                                                |  Flag   | 
                                                |  rules  |
+-----------------------------------------------|-----+---+---------+
|                           AVP                 |     |   |         |
| Attribute Name            Code     Data Type  |MUST |MAY|   Encr  |
+-----------------------------------------------+-----+---+---------+
|Acct-Interim-Interval      85       Unsigned32 | M   | P |    Y    |
|Auth-Application-Id        258      Unsigned32 | M   | P |    N    |
|Destination-Host           293      DiamIdent  | M   | P |    N    |
|Destination-Realm          283      DiamIdent  | M   | P |    N    |
|Error-Message              281      UTF8String | M   | P |    N    |
|Error-Reporting-Host       294      DiamIdent  | M   | P |    N    |
|Failed-AVP                 279      Grouped    | M   | P |    N    |
|Origin-Host                264      DiamIdent  | M   | P |    N    |
|Origin-Realm               296      DiamIdent  | M   | P |    N    |
|Origin-State-Id            278      Unsigned32 | M   | P |    N    |
|Proxy-Info                 284      Grouped    | M   | P |    N    |
|Result-Code                268      Unsigned32 | M   | P |    N    |
|Route-Record               282      DiamIdent  | M   |   |    N    |
|Session-Id                 263      UTF8String | M   | P |    Y    |
|User-Name                  1        UTF8String | M   | P |    Y    |
+-----------------------------------------------+-----+---+---------+</pre>
<p>Table 1: DIAMETER AVPs used from Diameter base</p>
<p id="rfc.section.8.1.p.2">The Auth-Application-Id AVP (AVP Code 258) is assigned by IANA to Diameter applications. The value of the Auth-Application-Id for the Diameter NAT Control Application is TBD.</p>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> <a href="#sec_result-codes" id="sec_result-codes">Additional Result-Code AVP Values</a>
</h1>
<p id="rfc.section.8.2.p.1">This section defines new values for the Result-Code AVP which SHALL be supported by all Diameter implementations that conform to the present document.</p>
<h1 id="rfc.section.8.2.1">
<a href="#rfc.section.8.2.1">8.2.1.</a> Success</h1>
<p id="rfc.section.8.2.1.p.1">No new Result-Code AVP value is defined within this category.</p>
<h1 id="rfc.section.8.2.2">
<a href="#rfc.section.8.2.2">8.2.2.</a> <a href="#sec_result-code-transient" id="sec_result-code-transient">Transient Failures</a>
</h1>
<p id="rfc.section.8.2.2.p.1">Result-Code AVP values that fall within the transient failures category are those used to inform a peer that the request could not be satisfied at the time that it was received. The request may be able to be satisfied in the future.</p>
<p id="rfc.section.8.2.2.p.2">The following new values of the Result-Code AVP are defined:</p>
<p></p>

<ul class="empty"><li>RESOURCE_FAILURE (TBD)<ul class="empty"><li>The DNCA Diameter peer within the NAT-device indicates that the binding could not be installed or a new session could not be created due to resource shortage.</li></ul>
</li></ul>
<h1 id="rfc.section.8.2.3">
<a href="#rfc.section.8.2.3">8.2.3.</a> <a href="#sec_result-code-permanent" id="sec_result-code-permanent">Permanent Failures </a>
</h1>
<p id="rfc.section.8.2.3.p.1">The Result-Code AVP values, which fall within the permanent failures category are used to inform the peer that the request failed, and should not be attempted again. The request may be able to be satisfied in the future.</p>
<p id="rfc.section.8.2.3.p.2">The following new values of the Result-Code AVP are defined:</p>
<p></p>

<ul class="empty">
<li>UNKNOWN_BINDING_TEMPLATE_NAME (TBD)<ul class="empty"><li>The DNCA Diameter peer within the NAT-device indicates that the binding could not be installed or a new session could not be created because the specified NAT-Control-Binding-Template AVP, that refers to a predefined policy template in the NAT-device, is unknown.</li></ul>
<p>BINDING_FAILURE (TBD)</p>
<ul class="empty"><li>DNCA indicates that the requested binding(s) could not be installed. For example: Requested ports are already in use.</li></ul>
</li>
<li>MAXIMUM_BINDINGS_REACHED_FOR_ENDPOINT (TBD)<ul class="empty"><li>The DNCA Diameter peer within the NAT-device denies the request because the maximum number of allowed bindings has been reached for the specified endpoint classifier.</li></ul>
</li>
<li>SESSION_EXISTS (TBD)<ul class="empty"><li>The DNCA Diameter peer within the NAT-device denies request to initialize a new session, if it already has a DNCA session that uses the same set of classifiers as indicated by the DNCA Diameter peer within the NAT-controller in the new session initialization request.</li></ul>
</li>
<li>INSUFFICIENT_CLASSIFIERS (TBD)<ul class="empty"><li>The DNCA Diameter peer within the NAT-device requests to initialize a new session, if the classifiers in the request match more than one of the existing sessions on the DNCA Diameter peer within the NAT-device.</li></ul>
</li>
</ul>
<h1 id="rfc.section.8.3">
<a href="#rfc.section.8.3">8.3.</a> Reused NASREQ Diameter Application AVPs</h1>
<p id="rfc.section.8.3.p.1">The following table describes the AVPs reused from the Diameter Network Access Server Application <a href="#RFC4005">[RFC4005]</a>; their AVP Code values, types, and possible flag values; and whether the AVP MAY be encrypted.The <a href="#RFC3588">[RFC3588]</a> specifies the AVP Flag rules for AVPs in section 4.5. The Diameter AVP rules are defined in the <a href="#RFC3588">[RFC3588]</a>, section 4.</p>
<div id="#rfc.figure.15"></div>
<div id="#tab-avps-from-nasreq"></div>
<pre>                                       +---------------------+
                                       |    AVP Flag rules   |
+------------------+------+------------|----+-----+----+-----|----+
|                  | AVP  |            |    |     |SHLD| MUST|    |
| Attribute Name   | Code |  Value Type|MUST| MAY | NOT|  NOT|Encr|
|------------------|------|------------|----+-----+----+-----|----|
| NAS-Port         |   5  | Unsigned32 | M  |  P  |    |  V  | Y  |
| NAS-Port-Id      |  87  | UTF8String | M  |  P  |    |  V  | Y  |
| Calling-Station- |  31  | UTF8String | M  |  P  |    |  V  | Y  |
|   Id             |      |            |    |     |    |     |    |
| Framed-IP-Address|   8  | OctetString| M  |  P  |    |  V  | Y  |
| Framed-IP-Netmask|   9  | OctetString| M  |  P  |    |  V  | Y  |
| Framed-Interface-|  96  | Unsigned64 | M  |  P  |    |  V  | Y  |
|   Id             |      |            |    |     |    |     |    |
| Framed-IPv6-     |  97  | OctetString| M  |  P  |    |  V  | Y  |
|  Prefix          |      |            |    |     |    |     |    |
+------------------+------+------------|----+-----+----+-----|----+</pre>
<p>Table 2: Reused NASREQ Diameter application AVPs</p>
<h1 id="rfc.section.8.4">
<a href="#rfc.section.8.4">8.4.</a> Reused AVPs from RFC 4675 </h1>
<p id="rfc.section.8.4.p.1">The following table describes the AVPs reused from "RADIUS Attributes for Virtual LAN and Priority Support" specification <a href="#RFC4675">[RFC4675]</a>; their AVP Code values, types, and possible flag values; and whether the AVP MAY be encrypted.The <a href="#RFC3588">[RFC3588]</a> specifies the AVP Flag rules for AVPs in section 4.5. The Diameter AVP rules are defined in the <a href="#RFC3588">[RFC3588]</a>, section 4.</p>
<div id="#rfc.figure.16"></div>
<div id="#tab-avps-from-rfc4675"></div>
<pre>                                       +---------------------+
                                       |    AVP Flag rules   |
+------------------+------+------------|----+-----+----+-----|----+
|                  | AVP  |            |    |     |SHLD| MUST|    |
| Attribute Name   | Code |  Value Type|MUST| MAY | NOT|  NOT|Encr|
|------------------|------|------------|----+-----+----+-----|----|
| Egress-VLANID    |  56  | OctetString| M  |  P  |    |  V  | Y  |
+------------------+------+------------|----+-----+----+-----|----+</pre>
<p>Table 3: Reused attributes from RFC 4675</p>
<h1 id="rfc.section.8.5">
<a href="#rfc.section.8.5">8.5.</a> Reused AVPs from Diameter QoS Application</h1>
<p id="rfc.section.8.5.p.1">The following table describes the AVPs reused from the Traffic Classification and Quality of Service (QoS) Attributes for Diameter <a href="#RFC5777">[RFC5777]</a>; their AVP Code values, types, and possible flag values; and whether the AVP MAY be encrypted.The <a href="#RFC3588">[RFC3588]</a> specifies the AVP Flag rules for AVPs in section 4.5. The Diameter AVP rules are defined in the <a href="#RFC3588">[RFC3588]</a>, section 4.</p>
<div id="#rfc.figure.17"></div>
<div id="#tab-avps-from-diameter-qos"></div>
<pre>                                                +---------+
                                                |  AVP    |
                                                |  Flag   | 
                                                |  rules  |
+-----------------------------------------------|-----+---+---------+
|                           AVP                 |     |   |         |
| Attribute Name            Code     Data Type  |MUST |MAY|   Encr  |
+-----------------------------------------------+-----+---+---------+
|Port                       530     Integer32   |  M  | P |    Y    |
|Protocol                   513     Enumerated  |  M  | P |    Y    |
|Direction                  514     Enumerated  |  M  | P |    Y    |
+-----------------------------------------------+-----+---+---------+
</pre>
<p>Table 4: Reused QoS-attributes</p>
<h1 id="rfc.section.8.6">
<a href="#rfc.section.8.6">8.6.</a> Reused AVPs from ETSI ES 283 034, e4 Diameter Application</h1>
<p id="rfc.section.8.6.p.1">The following table describes the AVPs reused from the Diameter e4 Application <a href="#ETSIES283034">[ETSIES283034]</a>; their AVP Code values, types, and possible flag values; and whether the AVP MAY be encrypted.The <a href="#RFC3588">[RFC3588]</a> specifies the AVP Flag rules for AVPs in section 4.5. The Diameter AVP rules are defined in the <a href="#RFC3588">[RFC3588]</a>, section 4. The Vendor-ID field in these AVP header will be set to ETSI (13019).</p>
<div id="#rfc.figure.18"></div>
<div id="#tab-avps-from-diameter-e4"></div>
<pre>                                                +---------+
                                                |  AVP    |
                                                |  Flag   | 
                                                |  rules  |
+-----------------------------------------------|-----+---+---------+
|                           AVP                 |     |   |         |
| Attribute Name            Code     Data Type  |MUST |MAY|   Encr  |
+-----------------------------------------------+-----+---+---------+
|Address-Realm              301     OctetString | M,V |   |    Y    |
|Logical-Access-Id          302     OctetString |   V | M |    Y    |
|Physical-Access-ID         313     UTF8String  |   V | M |    Y    |
+-----------------------------------------------+-----+---+---------+
</pre>
<p>Table 5: Reused AVPs from Diameter e4 application</p>
<h1 id="rfc.section.8.7">
<a href="#rfc.section.8.7">8.7.</a> <a href="#tab-new-avps" id="tab-new-avps">DNCA Defined AVPs</a>
</h1>
<p id="rfc.section.8.7.p.1">The following table describes the new Diameter AVPs defined in this document; their AVP Code values, types, and possible flag values; and whether the AVP MAY be encrypted.The <a href="#RFC3588">[RFC3588]</a> specifies the AVP Flag rules for AVPs in section 4.5. The Diameter AVP rules are defined in the <a href="#RFC3588">[RFC3588]</a>, section 4.  The AVPs defined here MUST NOT have the V bit in the AVP Flag set.</p>
<div id="#rfc.figure.19"></div>
<pre>                                                +---------+
                                                |  AVP    |
                                                |  Flag   | 
                                                |  rules  |
+-----------------------------------------------|-----+---+---------+
|                           AVP                 |     |   |         |
| Attribute Name            Code     Data Type  |MUST |MAY|   Encr  |
+-----------------------------------------------+-----+---+---------+
|NC-Request-Type        TBD  8.7.1   Enumerated | M   | P |    Y    |
|NAT-Control-Install    TBD  8.7.2   Grouped    | M   | P |    Y    |
|NAT-Control-Remove     TBD  8.7.3   Grouped    | M   | P |    Y    |
|NAT-Control-Definition TBD  8.7.4   Grouped    | M   | P |    Y    |
|NAT-Internal-Address   TBD  8.7.5   Grouped    | M   | P |    Y    |
|NAT-External-Address   TBD  8.7.6   Grouped    | M   | P |    Y    |
|Max-NAT-Bindings       TBD  8.7.7   Unsigned32 | M   | P |    Y    |
|NAT-Control-           TBD  8.7.8   OctetString| M   | P |    Y    |
| Binding-Template                              |     |   |         |
|Duplicate-             TBD  8.7.9   UTF8String | M   | P |    Y    |
| Session-ID                                    |     |   |         |
|NAT-External-Port-     TBD  8.7.10  Enumerated | M   | P |    Y    |
| Style                                         |     |   |         |
|NAT-Control-Record     TBD  9.2.1   Grouped    | M   | P |    Y    |
|NAT-Control-           TBD  9.2.2   Enumerated | M   | P |    Y    |
| Binding-Status                                |     |   |         |
|Current-NAT-Bindings   TBD  9.2.3   Unsigned32 | M   | P |    Y    |
+-----------------------------------------------+-----+---+---------+
</pre>
<p>Table 6: New Diameter AVPs</p>
<h1 id="rfc.section.8.7.1">
<a href="#rfc.section.8.7.1">8.7.1.</a> <a href="#avp_NC-Request-Type" id="avp_NC-Request-Type">NC-Request-Type AVP</a>
</h1>
<p id="rfc.section.8.7.1.p.1">The NC-Request-Type AVP (AVP Code TBD) is of type Enumerated and contains the reason for sending the NAT-Control-Request command. It shall be present in all NAT-Control-Request messages.</p>
<p id="rfc.section.8.7.1.p.2">The following values are defined: </p>

<ul class="empty">
<li>INITIAL_REQUEST (1)<ul class="empty"><li>An Initial Request is to initiate a Diameter NAT control session between the DNCA Diameter peers.</li></ul>
<p>UPDATE_REQUEST (2)</p>
<ul class="empty"><li>An Update Request is used to update bindings previously installed on a given access session, to add new binding on a given access session, or to remove one or several binding(s) activated on a given access session.</li></ul>
</li>
<li>QUERY_REQUEST (3)<ul class="empty"><li>Query Request is used to query a NAT-device about the currently installed bindings for an endpoint classifier.</li></ul>
</li>
</ul>
<h1 id="rfc.section.8.7.2">
<a href="#rfc.section.8.7.2">8.7.2.</a> <a href="#avp_NAT-Control-Install" id="avp_NAT-Control-Install">NAT-Control-Install AVP</a>
</h1>
<p id="rfc.section.8.7.2.p.1">The NAT-Control AVP (AVP code TBD) is of type Grouped, and it is used to activate or install NAT bindings. It also contains Max-NAT-Bindings that defines the maximum number of NAT bindings allowed for an end point and the NAT-Control-Binding-Template that references a predefined template on the NAT-device that may contain static binding, a maximum number of bindings allowed, an IP-address pool from which external binding addresses should be allocated, etc.  If the NAT-External-Port-Style AVP is present, then the NAT-device MUST select the external ports for the NAT-Bindings as per the style specified. The NAT-External-Port-Style is applicable for NAT-Bindings defined by the NAT-Control-Definition AVPs whose NAT-External-Address or Port AVPs within the NAT-External-Address are unspecified.</p>
<p id="rfc.section.8.7.2.p.2">AVP format:</p>
<div id="#rfc.figure.20"></div>
<pre>  NAT-Control-Install ::= &lt; AVP Header: TBD &gt;
                           * [ NAT-Control-Definition ]
                             [ NAT-Control-Binding-Template ]
                             [ Max-NAT-Bindings ]
                             [ NAT-External-Port-Style ]
                           * [ AVP ]</pre>
<h1 id="rfc.section.8.7.3">
<a href="#rfc.section.8.7.3">8.7.3.</a> <a href="#avp_NAT-Control-Remove" id="avp_NAT-Control-Remove">NAT-Control-Remove AVP</a>
</h1>
<p id="rfc.section.8.7.3.p.1">The NAT-Control-Remove AVP (AVP code TBD) is of type Grouped, and it is used to deactivate or remove NAT-bindings. At least one of the two AVPs (NAT-Control-Definition AVP, NAT-Control-Binding-Template AVP) SHOULD be present in the NAT-Control-Remove AVP.</p>
<p id="rfc.section.8.7.3.p.2">AVP format:</p>
<div id="#rfc.figure.21"></div>
<pre>  NAT-Control-Remove ::= &lt; AVP Header: TBD &gt;
                          * [ NAT-Control-Definition ]
                            [ NAT-Control-Binding-Template ]
                          * [ AVP ]</pre>
<h1 id="rfc.section.8.7.4">
<a href="#rfc.section.8.7.4">8.7.4.</a> <a href="#avp_NAT-Control-Definition" id="avp_NAT-Control-Definition">NAT-Control-Definition AVP</a>
</h1>
<p id="rfc.section.8.7.4.p.1">The NAT-Control-Definition AVP (AVP code TBD) is of type Grouped, and it describes a binding.</p>
<p id="rfc.section.8.7.4.p.2">The NAT-Control-Definition AVP uniquely identifies the binding between the DNCA Diameter peers.</p>
<p id="rfc.section.8.7.4.p.3">If both the NAT-Internal-Address and NAT-External-Address AVP(s) are supplied, it is a pre-defined binding.</p>
<p id="rfc.section.8.7.4.p.4">If the NAT-External-Address AVP is not specified then the NAT-device MUST select the external port as per the NAT-External-Port-Style AVP, if present in the NAT-Control-Definition AVP.</p>
<p id="rfc.section.8.7.4.p.5">The Protocol AVP describes the transport protocol for the binding. The NAT-Control-Definition AVP can contain either zero or one Protocol AVP. If the Protocol AVP is omitted and if both internal and external IP-address are specified then the binding reserves the IP-addresses for all transport protocols.</p>
<p id="rfc.section.8.7.4.p.6">The Direction AVP is of type Enumerated. It specifies the direction for the binding. The values of the enumeration applicable in this context are: "IN","OUT". If Direction AVP is OUT or absent, the NAT-Internal-Address refers to the IP-address of the endpoint that needs to be translated. If Direction AVP is "IN", NAT-Internal-Address is the destination IP-address that has to be translated.</p>
<p id="rfc.section.8.7.4.p.7">AVP format:</p>
<div id="#rfc.figure.22"></div>
<pre>  NAT-Control-Definition ::= &lt; AVP Header: TBD &gt;
                              { NAT-Internal-Address }
                              [ Protocol ]
                              [ Direction ]
                              [ NAT-External-Address ]
                              [ Session-Id ]
                            * [ AVP ]</pre>
<h1 id="rfc.section.8.7.5">
<a href="#rfc.section.8.7.5">8.7.5.</a> <a href="#avp_NAT-Internal-Address" id="avp_NAT-Internal-Address">NAT-Internal-Address AVP</a>
</h1>
<p id="rfc.section.8.7.5.p.1">The NAT-Internal-Address AVP (AVP code TBD) is of type Grouped.  It describes the internal IP-address and port for a binding.  Framed-IPV6-Prefix and Framed-IP-Address AVPs are mutually exclusive.</p>
<p id="rfc.section.8.7.5.p.2">AVP format:</p>
<div id="#rfc.figure.23"></div>
<pre>  NAT-Internal-Address ::= &lt; AVP Header: TBD &gt;
                            [ Framed-IP-Address ]
                            [ Framed-IPv6-Prefix ]
                            [ Port]
                          * [ AVP ]</pre>
<h1 id="rfc.section.8.7.6">
<a href="#rfc.section.8.7.6">8.7.6.</a> <a href="#avp_NAT-External-Address" id="avp_NAT-External-Address">NAT-External-Address AVP</a>
</h1>
<p id="rfc.section.8.7.6.p.1">The NAT-External-Address AVP (AVP code TBD) is of type Grouped, and it describes the external IP-address and port for a binding.  Framed-IP-Netmask AVP can only be specified when the Framed-IP-Address AVP is present. The external IP-address specified in this attribute can be reused for multiple endpoints by specifying the same address in the respective NAT-External-Address AVPs. If the external IP-address is not specified and the NAT-External-Port-Style AVP is specified in the NAT-Control-Definition AVP then the NAT-device MUST select external port as per the NAT-External-Port-Style AVP.</p>
<p id="rfc.section.8.7.6.p.2">AVP format:</p>
<div id="#rfc.figure.24"></div>
<pre>  NAT-External-Address ::= &lt; AVP Header: TBD &gt;
                            [ Framed-IP-Address ]
                            [ Framed-IP-Netmask ]
                            [ Port ]
                          * [ AVP ]</pre>
<h1 id="rfc.section.8.7.7">
<a href="#rfc.section.8.7.7">8.7.7.</a> <a href="#avp_Max-NAT-Bindings" id="avp_Max-NAT-Bindings">Max-NAT-Bindings</a>
</h1>
<p id="rfc.section.8.7.7.p.1">The Max-NAT-Bindings AVP (AVP code TBD) is of type Unsigned32. It indicates the maximum number of NAT-bindings allowed for a particular endpoint.</p>
<h1 id="rfc.section.8.7.8">
<a href="#rfc.section.8.7.8">8.7.8.</a> <a href="#avp_NAT-Control-Binding-Rule" id="avp_NAT-Control-Binding-Rule">NAT-Control-Binding-Template AVP</a>
</h1>
<p id="rfc.section.8.7.8.p.1">The NAT-Control-Binding-Template AVP (AVP code TBD) is of type OctetString. It defines a name for a policy template that is predefined at the NAT-device. Details on the contents and structure of the template and configuration are outside the scope of this document. The policy to which this AVP refers to may contain NAT-bindings, IP-address pool for allocating the external IP-address of a NAT-binding, and maximum number of allowed NAT-bindings. Such policy template can be reused by specifying the same NAT-Control-Binding-Template AVP in the corresponding NAT-Control-Install AVPs of multiple endpoints.</p>
<h1 id="rfc.section.8.7.9">
<a href="#rfc.section.8.7.9">8.7.9.</a> <a href="#avp_Duplicate-Session-Id" id="avp_Duplicate-Session-Id">Duplicate-Session-Id AVP</a>
</h1>
<p id="rfc.section.8.7.9.p.1">The Duplicate-Session-Id AVP (AVP Code TBD) is of type UTF8String. It is used to report errors and contains the Session-Id of an existing session.</p>
<h1 id="rfc.section.8.7.10">
<a href="#rfc.section.8.7.10">8.7.10.</a> <a href="#avp_NAT-External-Port-Style" id="avp_NAT-External-Port-Style">NAT-External-Port-Style AVP</a>
</h1>
<p id="rfc.section.8.7.10.p.1">The NAT-External-Port-Style AVP (AVP Code TBD) is of type Enumerated and contains the style to be followed while selecting the external port for a NAT-Binding relative to the internal port.</p>
<p id="rfc.section.8.7.10.p.2">The following values are defined: </p>

<ul class="empty"><li>FOLLOW_INTERNAL_PORT_STYLE (1)<ul class="empty"><li>External port numbers selected MUST follow the same sequence and oddity as the internal ports of the NAT-bindings. The port odditity is required to support protocols like RTP and RTCP as defined in <a href="#RFC3550">[RFC3550]</a>. If for example the internal port in a requested NAT-binding is odd numbered then the external port allocated MUST also be odd numbered, and vice versa for an even numbered port. In addition, the sequence of port numbering is maintained: If internal ports are consecutive, then the NAT-device MUST choose consecutive external ports for the NAT-bindings.</li></ul>
</li></ul>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#sec-accounting" id="sec-accounting">Accounting Commands</a>
</h1>
<p id="rfc.section.9.p.1">The DNCA reuses session based accounting as defined in the Diameter Base Protocol<a href="#RFC3588">[RFC3588]</a> to report the bindings per endpoint. This reporting is achieved by sending Diameter Accounting Requests (ACR) [Start, Interim and Stop] from the DNCA Diameter peer within the NAT-device to its associated DNCA Diameter peer within the NAT-controller.</p>
<p id="rfc.section.9.p.2">The DNCA Diameter peer within the NAT-device sends an ACR Start on receiving a NCR with NC-Request-Type AVP set to INITIAL_REQUEST for a session or on creation of the first binding for a session requested in an earlier NCR. DNCA may send ACR Interim updates, if required, either due to a change in bindings resulting from a NCR with NC-Request-Type AVP set to UPDATE_REQUEST, or periodically as specified in Acct-Interim-Interval by the DNCA Diameter peer within the NAT-controller, or when it creates or tears down bindings. An ACR Stop is sent by the DNCA Diameter peer within the NAT-device on receiving STR.</p>
<p id="rfc.section.9.p.3">The function of correlating the multiple bindings used by an endpoint at any given time is relegated to the post processor.</p>
<p id="rfc.section.9.p.4">The DNCA Diameter peer within the NAT-device may trigger an interim accounting record when the maximum number of bindings, if received in an NCR, is reached.</p>
<h1 id="rfc.section.9.1">
<a href="#rfc.section.9.1">9.1.</a> NAT Control Accounting Messages</h1>
<p id="rfc.section.9.1.p.1">The ACR and ACA messages are reused as defined in the Diameter Base Protocol <a href="#RFC3588">[RFC3588]</a> for exchanging endpoint NAT binding details between the DNCA Diameter peers. The DNCA Application IDs is used in the accounting commands. ACR contains one or more optional NAT-Control-Record AVPs to report the bindings. The NAT-device indicates the number of allocated NAT bindings to the NAT-controller using the Current-NAT-Bindings AVP. This number needs to match the number of bindings identified as active within the NAT-Control-Record AVP.</p>
<h1 id="rfc.section.9.2">
<a href="#rfc.section.9.2">9.2.</a> NAT Control Accounting AVPs</h1>
<p id="rfc.section.9.2.p.1">In addition to AVPs for ACR specified in <a href="#RFC3588">[RFC3588]</a>, the DNCA Diameter peer within the NAT-device must add the NAT-Control-Record AVP.</p>
<h1 id="rfc.section.9.2.1">
<a href="#rfc.section.9.2.1">9.2.1.</a> <a href="#avp_NAT-Control-Record" id="avp_NAT-Control-Record">NAT-Control-Record</a>
</h1>
<p id="rfc.section.9.2.1.p.1">The NAT-Control-Record AVP (AVP code TBD) is of type Grouped. It describes a binding and its status. If NAT-Control-Binding-Status is set to Created, Event-Timestamp indicates the binding creation time.  If NAT-Control-Binding-Status is set to Removed, Event-Timestamp indicates the binding removal time. If NAT-Control-Binding-Status is active, Event-Timestamp need not be present; if a value is present, it indicates that binding is active at the given time.</p>
<div id="#rfc.figure.25"></div>
<pre>  NAT-Control-Record ::= &lt; AVP Header: TBD &gt;
                         { NAT-Control-Definition }
                         { NAT-Control-Binding-Status } 
                         [ Event-Timestamp ]</pre>
<h1 id="rfc.section.9.2.2">
<a href="#rfc.section.9.2.2">9.2.2.</a> <a href="#avp_NAT-Control-Binding-Status" id="avp_NAT-Control-Binding-Status">NAT-Control-Binding-Status</a>
</h1>
<p id="rfc.section.9.2.2.p.1">The NAT-Control-Binding-Status AVP (AVP code TBD) is of type enumerated. It indicates the status of the binding - created, removed, or active.</p>
<p id="rfc.section.9.2.2.p.2">The following values are defined: </p>

<ul class="empty">
<li>Created (1)<ul class="empty"><li>NAT binding is created.</li></ul>
</li>
<li>Active (2)<ul class="empty"><li>NAT binding is active.</li></ul>
</li>
<li>Removed (3)<ul class="empty"><li>NAT binding was removed.</li></ul>
</li>
</ul>
<h1 id="rfc.section.9.2.3">
<a href="#rfc.section.9.2.3">9.2.3.</a> <a href="#avp_Current-NAT-Bindings" id="avp_Current-NAT-Bindings">Current-NAT-Bindings</a>
</h1>
<p id="rfc.section.9.2.3.p.1">The Current-NAT-Bindings AVP (AVP code TBD) is of type Unsigned32. It indicates the number of NAT bindings active on the NAT-device.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#sec-avp-occurence-table" id="sec-avp-occurence-table">AVP Occurrence Table</a>
</h1>
<p id="rfc.section.10.p.1">The following sections present the AVPs defined in this document and specify the Diameter messages in which they can be present. Note: AVPs that can only be present within a Grouped AVP are not represented in this table.</p>
<p id="rfc.section.10.p.2">The table uses the following symbols:</p>
<p></p>

<ul class="empty"><li><dl>
<dt>0</dt>
<dd style="margin-left: 10">The AVP MUST NOT be present in the message.</dd>
<dt>0+</dt>
<dd style="margin-left: 10">Zero or more instances of the AVP can be present in the message.</dd>
<dt>0-1</dt>
<dd style="margin-left: 10">Zero or one instance of the AVP can be present in the message. It is considered an error if there is more than one instance of the AVP.</dd>
<dt>1</dt>
<dd style="margin-left: 10">One instance of the AVP MUST be present in the message.</dd>
<dt>1+</dt>
<dd style="margin-left: 10">At least one instance of the AVP MUST be present in the message.</dd>
</dl></li></ul>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> DNCA AVP Table for NAT Control Initial and Update Requests</h1>
<p id="rfc.section.10.1.p.1">The following table lists DNCA specific AVPs that have to be present in NCRs and NCAs with NC-Request-Type set to INITIAL_REQUEST or UPDATE_REQUEST.</p>
<div id="#rfc.figure.26"></div>
<pre>                                    +-------------------+
                                    |  Command Code     |
+-----------------------------------+-------------------+
| Attribute Name                        NCR    NCA      |
+-------------------------------------------------------+
|NC-Request-Type                         1      1       |
|NAT-Control-Install                     0-1    0       |
|NAT-Control-Remove                      0-1    0       |
|NAT-Control-Definition                  0      0       |
|Current-NAT-Bindings                    0      0       |
|Duplicate-Session-Id                    0      0-1     |
+-------------------------------------------------------+</pre>
<p id="rfc.section.10.1.p.2">Note that any combination of "NAT-Control-Install" and "NAT-Control-Remove" AVPs could be present in an update or initial requests. Consider the following examples:</p>
<p></p>

<ul class="empty">
<li>Neither "NAT-Control-Install AVP" nor "NAT-Control-Remove AVP" are present: This could for example be the case if the NAT-controller would only want to receive accounting information, but not control NAT-bindings.</li>
<li>Only "NAT-Control-Install AVP" is present: This could for example be the case if a new NAT-binding is installed for an existing session.</li>
<li>Only "NAT-Control-Remove AVP" is present: This could for example be the case if a new NAT-binding is removed from an existing session.</li>
<li>Both, "NAT-Control-Install AVP" and "NAT-Control-Remove AVP" are present: This could for example be the case if a formerly created NAT-binding is removed and a new NAT-binding is established within the same request.</li>
</ul>
<h1 id="rfc.section.10.2">
<a href="#rfc.section.10.2">10.2.</a> DNCA AVP Table for Session Query request</h1>
<p id="rfc.section.10.2.p.1">The following table lists DNCA specific AVPs that have to be present in NCRs and NCAs with NC-Request-Type set to QUERY_REQUEST.</p>
<div id="#rfc.figure.27"></div>
<pre>                                    +-------------------+
                                    |  Command Code     |
+-----------------------------------+-------------------+
| Attribute Name                        NCR    NCA      |
+-------------------------------------------------------+
|NC-Request-Type                         1      1       |
|NAT-Control-Install                     0      0       |
|NAT-Control-Remove                      0      0       |
|NAT-Control-Definition                  0      0+      |
|Current-NAT-Bindings                    0      1       |
|Duplicate-Session-Id                    0      0       |
+-------------------------------------------------------+</pre>
<h1 id="rfc.section.10.3">
<a href="#rfc.section.10.3">10.3.</a> DNCA AVP Table for Accounting Message</h1>
<p id="rfc.section.10.3.p.1">The following table lists DNCA specific AVPs, which may or may not be present in ACR and ACA messages.</p>
<div id="#rfc.figure.28"></div>
<pre>                                    +-------------------+
                                    |  Command Code     |
+-----------------------------------+-------------------+
| Attribute Name                        ACR    ACA      |
+-------------------------------------------------------+
|NAT-Control-Record                      0+     0       |
|Current-NAT-Bindings                    1      0       |
+-------------------------------------------------------+
</pre>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.11.p.1">This section contains the namespaces that have either been created in this specification, or the values assigned to existing namespaces managed by IANA.</p>
<p id="rfc.section.11.p.2">In the subsections below, when we speak about review by a Designated Expert, please note that the designated expert will be assigned by the IESG. Initially, such Expert discussions take place on the AAA WG mailing list.</p>
<h1 id="rfc.section.11.1">
<a href="#rfc.section.11.1">11.1.</a> Application Identifier</h1>
<p id="rfc.section.11.1.p.1">This specification assigns the value &lt;TBD&gt;, 'Diameter NAT Control Application', to the Application Identifier namespace defined in <a href="#RFC3588">[RFC3588]</a>. See <a href="#sec-dnca">Section 4</a> for more information.</p>
<h1 id="rfc.section.11.2">
<a href="#rfc.section.11.2">11.2.</a> Command Codes</h1>
<p id="rfc.section.11.2.p.1">This specification uses the value &lt;TBD&gt; from the Command code namespace defined in <a href="#RFC3588">[RFC3588]</a> for the NAT-Control-Request (NCR), NAT-Control-Answer (NCA) commands. See <a href="#sec-dnca-ncr">Section 6.1</a> and <a href="#sec-dnca-nca">Section 6.2</a> for more information on these commands.</p>
<h1 id="rfc.section.11.3">
<a href="#rfc.section.11.3">11.3.</a> AVP Codes</h1>
<p id="rfc.section.11.3.p.1">This specification assigns the values &lt;TBD&gt; from the AVP code namespace defined in <a href="#RFC3588">[RFC3588]</a>. See <a href="#tab-new-avps">Section 8.7</a> for the assignment of the namespace in this specification.</p>
<h1 id="rfc.section.11.4">
<a href="#rfc.section.11.4">11.4.</a> Result-Code AVP Values </h1>
<p id="rfc.section.11.4.p.1">This specification assigns the values &lt;TBD&gt; (4xxx, 5xxx, 5xxx, 5xxx, 5xxx,5xxx) from the Result-Code AVP value namespace defined in <a href="#RFC3588">[RFC3588]</a>. See <a href="#sec_result-codes">Section 8.2</a> for the assignment of the namespace in this specification.</p>
<h1 id="rfc.section.11.5">
<a href="#rfc.section.11.5">11.5.</a> NC-Request-Type AVP</h1>
<p id="rfc.section.11.5.p.1">As defined in <a href="#avp_NC-Request-Type">Section 8.7.1</a>, the NC-Request-Type AVP includes Enumerated type values 1 - 3. IANA has created and is maintaining a namespace for this AVP. All remaining values are available for assignment by a Designated Expert <a href="#RFC5226">[RFC5226]</a>.</p>
<h1 id="rfc.section.11.6">
<a href="#rfc.section.11.6">11.6.</a> NAT-External-Port-Style AVP</h1>
<p id="rfc.section.11.6.p.1">As defined in <a href="#avp_NAT-External-Port-Style">Section 8.7.10</a>, the NAT-External-Port-Style AVP includes Enumerated type value 1. IANA has created and is maintaining a namespace for this AVP. All remaining values are available for assignment by a Designated Expert <a href="#RFC5226">[RFC5226]</a>.</p>
<h1 id="rfc.section.11.7">
<a href="#rfc.section.11.7">11.7.</a> NAT-Control-Binding-Status AVP</h1>
<p id="rfc.section.11.7.p.1">As defined in <a href="#avp_NC-Request-Type">Section 8.7.1</a>, the NAT-Control-Binding-Status AVP includes Enumerated type values 1 - 3.  IANA has created and is maintaining a namespace for this AVP. All remaining values are available for assignment by a Designated Expert <a href="#RFC5226">[RFC5226]</a>.</p>
<h1 id="rfc.section.12">
<a href="#rfc.section.12">12.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.12.p.1">This document describes procedures for controlling NAT related attributes and parameters by an entity, which is non-local to the device performing NAT. This section discusses security considerations for DNCA.  This includes the interactions between the Diameter peers within a NAT-controller and a NAT-device as well as general considerations for NAT-control in a service provider network.</p>
<p id="rfc.section.12.p.2">Security between a NAT-controller and a NAT-device has a number of components: authentication, authorization, integrity, and confidentiality.</p>
<p id="rfc.section.12.p.3">Authentication refers to confirming the identity of an originator for all datagrams received from the originator. Lack of authentication of Diameter messages between the Diameter peers can jeopardize the fundamental service of the peering network elements. A consequence of not authenticating the message sender by the recipient would be that an attacker could spoof the identity of a "legitimate" authorizing entity in order to change the behavior of the receiver. An attacker could for example launch a denial of service attack by setting the maximum number of bindings for a session on the NAT-device to zero; provision bindings on a NAT-device which include IP-addresses already in use in other parts of the network; or request session termination of the Diameter session and hamper a user's connectivity. Lack of authentication of a NAT-device to a NAT-controller could lead to situations where the NAT-device could provide a wrong view of the resources (i.e. NAT-bindings). In addition, NAT Binding Predefined template on the NAT-device could be configured differently than expected by the NAT-controller. Failing of any of the two DNCA Diameter peers to provide the required credentials should be subject to logging. The corresponding logging infrastructure of the operator SHOULD be built in a way that it can mitigate potential denial of service attacks resulting from large amounts of logging events. This could include proper dimensioning of the logging infrastructure combined with policing the maximum amount of logging events accepted by the logging system to a threshold which the system is known to be able to handle.</p>
<p id="rfc.section.12.p.4">Authorization refers to whether a particular authorizing entity is authorized to signal a network element requests for one or more applications, adhering to a certain policy profile. Failing the authorization process might indicate a resource theft attempt or failure due to administrative and/or credential deficiencies. In either case, the network element should take the proper measures to log such attempts.</p>
<p id="rfc.section.12.p.5">Integrity is required to ensure that a Diameter message exchanged between the Diameter peers has not been maliciously altered by intermediate devices. The result of a lack of data integrity enforcement in an untrusted environment could be that an impostor will alter the messages exchanged between the peers. This could cause a change of behavior of the peers, including the potential of a denial of service.</p>
<p id="rfc.section.12.p.6">Confidentiality protection of Diameter messages ensures that the signaling data is accessible only to the authorized entities. When signaling messages between the DNCA Diameter peers traverse untrusted networks, lack of confidentiality will allow eavesdropping and traffic analysis.</p>
<p id="rfc.section.12.p.7">Diameter offers security mechanisms to deal with the functionality demanded above. DNCA makes use of the capabilities offered by Diameter and the underlying transport protocols to deliver these requirements (see <a href="#sec-diameter-messages">Section 5.1</a>). If the DNCA communication traverses untrusted networks, messages between DNCA Diameter peers SHOULD be secured using either IPsec or TLS. Please refer to <a href="#RFC3588">[RFC3588]</a>, section 13 for details. DNCA Diameter peers SHOULD perform bilateral authentication, authorization as well as procedures to ensure integrity and confidentiality of the information exchange.</p>
<p id="rfc.section.12.p.8">DNCA Diameter peers SHOULD have a mutual trust setup. This document does not specify a mechanisms for authorization between the DNCA Diameter peers. The DNCA Diameter peers SHOULD be provided with sufficient information to make an authorization decision. The information can come from various sources, for example the peering devices could store local authentication policy, listing the identities of authorized peers.</p>
<p id="rfc.section.12.p.9">Any mechanism or protocol providing control of a NAT-device, and DNCA is an example of such a control mechanism, could allow for misuse of the NAT-device given that it enables the definition of per-destination or per-source rules. Misuse could include anti-competitive practices among providers, censorship, crime, etc. NAT-control could be used as a tool for preventing or redirecting access to particular sites. For instance, by controlling the NAT bindings, one could ensure that end points aren't able to receive particular flows, or that those flows are redirected to a relay that snoops or tampers with traffic instead of directly forwarding the traffic to the intended end point. In addition one could set up a binding in a way that the source IP address used is one of a relay so that traffic coming back can be snooped on or interfered with.  The protections on DNCA and its Diameter protocol exchanges don't prevent such abuses of NAT-control. A service provider deploying DNCA needs to make sure that higher layer processes and procedures are put in place which allow them to detect and mitigate misuses.</p>
<h1 id="rfc.section.13">
<a href="#rfc.section.13">13.</a> Examples</h1>
<p id="rfc.section.13.p.1">This section shows example DNCA message content and exchange.</p>
<h1 id="rfc.section.13.1">
<a href="#rfc.section.13.1">13.1.</a> DNCA Session Establishment Example</h1>
<p><a href="#fig-session-establishment-example">Figure 29</a> depicts a typical call flow for DNCA session establishment.</p>
<p id="rfc.section.13.1.p.2">In this example, the NAT-controller:</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>requests a maximum of 100 NAT-bindings for the end point.</li>
<li>defines a static binding for a TCP connection which associates the internal IP-Address:Port 192.0.2.1:80 with the external IP-Address:Port 198.51.100.1:80 for the end point.</li>
<li>requests the use of a preconfigured template called "local-policy" while creating NAT-bindings for the end point.</li>
</ol>
<div id="#rfc.figure.29"></div>
<div id="#fig-session-establishment-example"></div>
<pre>end point             NAT-Controller (within NAS)           NAT-device 
   |                            |                               |
   |                            |                               |
   |      1. Trigger            |                               |
   |---------------------------&gt;|                               |
   |       +-------------------------------------+              |
   |       |  2. Determine that NAT control      |              |
   |       |     is required for the end point   |              |  
   |       +-------------------------------------+              |
   |                            |                               |
   |                            |                               |
   |                           ...................................
   |                           .|   3. Diameter Base CER/CEA    |.
   |                           .|&lt;-----------------------------&gt;|.
   |                           ...................................
   |                            |                               |
   |                            |                               |
   |                            |         4.  NCR               |
   |                            |------------------------------&gt;|
   |                            |                               |
   |                            |                     5. DNCA session  
   |                            |                        established      
   |                            |                               | 
   |                            |         6.  NCA               |
   |                            |&lt;------------------------------|  
   |                            |                               |
   |                            |                               |
   |                  7. Data traffic                           |
   |-----------------------------------------------------------&gt;| 
   |                            |                               |
   |                            |                               |
   |                            |                    8. NAT Bindings
   |                            |                     created as per
   |                            |                   directives in the
   |                            |                       DNCA session   
   |                            |                               |

</pre>
<p id="rfc.section.13.1.p.4">Detailed description of the steps shown in <a href="#fig-session-establishment-example">Figure 29</a>:</p>
<div id="#rfc.figure.30"></div>
<div id="#fig-NAT-session-establish-example"></div>
<pre>   &lt; NC-Request &gt; ::= &lt; Diameter Header: TBD, REQ, PXY&gt;
                    Session-Id =  "natC.example.com:33041;23432;"
                    Auth-Application-Id = &lt;DNCA Application ID&gt;
                    Origin-Host = "natC.example.com"  
                    Origin-Realm = "example.com"
                    Destination-Realm = "example.com"
                    Destination-Host = "nat-device.example.com"
                    NC-Request-Type = INITIAL_REQUEST
                    User-Name = "subscriber_example1"
                    Framed-IP-Address = "192.0.2.1"
                    NAT-Control-Install = {
                         NAT-Control-Definition = {
                            Protocol = TCP
                            Direction = OUT
                            NAT-Internal-Address = {
                                 Framed-IP-Address = "192.0.2.1"
                                 Port = 80
                            }
                            NAT-External-Address = {
                                 Framed-IP-Address = "198.51.100.1"
                                 Port = 80
                            }
                         }
                         Max-NAT-Bindings = 100
                         NAT-Control-Binding-Template = "local-policy"
                   }</pre>
<div id="#rfc.figure.31"></div>
<pre>   &lt;NC-Answer&gt; ::= &lt; Diameter Header: TBD, PXY &gt;
                    Session-Id =  "natC.example.com:33041;23432;"
                    Origin-Host = "nat-device.example.com"  
                    Origin-Realm = "example.com"
                    NC-Request-Type = INITIAL_REQUEST
                    Result-Code = DIAMETER_SUCCESS

</pre>
<p></p>

<ol>
<li>The NAT-controller (co-located with the NAS here) creates state for an end point based on a trigger. This could for example be the successful establishment of a Point-to-Point Protocol (PPP) <a href="#RFC1661">[RFC1661]</a> access session.</li>
<li>Based on the configuration of the DNCA Diameter peer within the NAT-controller, the NAT-controller determines that NAT-control is required and is to be enforced at a NAT-device.</li>
<li>If there is no Diameter session already established with the DNCA Diameter peer within NAT-device, a Diameter connection is established and Diameter Base CER/CEA are exchanged.</li>
<li>The NAT-Controller creates an NCR message (see below) and sends it to the NAT-device. This example shows IPv4 to IPv4 address and port translation. For IPv6 to IPv4 translation, the Framed-IP-Address AVP would be replaced by the Framed-IPv6-Address AVP with the value set to the IPv6 address of the end point.  </li>
<li>The NAT-device establishes a DNCA session as it is able to comply with the request.</li>
<li>The NAT-device sends an NCA to indicate the successful completion of the request. </li>
<li>The end point sends packets that reach the NAT-device.</li>
<li>The NAT-device performs NAT for traffic received from the end point with source address 192.0.2.1. Traffic with source IP-address 192.0.2.1 and port 80 are translated to the external IP-address 198.51.100.1 and port 80. Traffic with source IP-address 192.0.2.1 and a source port different from 80 will be translated to IP-address 198.51.100.1 and a port chosen by the NAT-device. Note that this example assumes that the NAT-device follows typical binding allocation rules for end points, in that only a single external IP-address is used for all traffic received from a single IP-address of an end point. The NAT-device will allow a maximum of 100 NAT-bindings be created for the end point.</li>
</ol>
<h1 id="rfc.section.13.2">
<a href="#rfc.section.13.2">13.2.</a> DNCA Session Update with Port Style Example</h1>
<p id="rfc.section.13.2.p.1">This section gives an example for a DNCA session update: A new set of NAT-bindings is requested for an existing session. The request contains a directive ( the "NAT-External-Port-Style" AVP set to FOLLOW_INTERNAL_PORT_STYLE) that directs the NAT-device to maintain port-sequence and port-oddity for the newly created NAT-bindings. In the example shown, the internal ports are UDP port 1036 and 1037. The NAT-device follows the directive selects the external ports accordingly. The NAT-device would for example create a mapping of 192.0.2.1:1036 to 198.51.100.1:5056 and 192.0.2.1:1037 to 198.51.100.1:5057, thereby maintaining port oddity (1036-&gt;5056, 1037-&gt;5057) and sequence ( the consecutive internal ports 1036 and 1037 map to the consecutive external ports 5056 and 5057).</p>
<div id="#rfc.figure.32"></div>
<div id="#fig-NAT-session-update-example"></div>
<pre>   &lt; NC-Request &gt; ::= &lt; Diameter Header: TBD, REQ, PXY&gt;
                    Session-Id =  "natC.example.com:33041;23432;"
                    Auth-Application-Id = &lt;DNCA Application ID&gt;
                    Origin-Host = "natC.example.com"  
                    Origin-Realm = "example.com"
                    Destination-Realm = "example.com"
                    Destination-Host = "nat-device.example.com"
                    NC-Request-Type = UPDATE_REQUEST
                    NAT-Control-Install = {
                        NAT-Control-Definition = {
                            Protocol = UDP
                            Direction = OUT
                            NAT-Internal-Address = {
                                 Framed-IP-Address = "192.0.2.1"
                                 Port = 1035
                            }
                        }
                        NAT-Control-Definition = {
                            Protocol = UDP
                            Direction = OUT
                            NAT-Internal-Address = {
                                 Framed-IP-Address = "192.0.2.1"
                                 Port = 1036
                            }
                        }
                        NAT-External-Port-
                               Style = FOLLOW_INTERNAL_PORT_STYLE
                    }</pre>
<h1 id="rfc.section.13.3">
<a href="#rfc.section.13.3">13.3.</a> DNCA Session Query Example</h1>
<p id="rfc.section.13.3.p.1">This section shows an example for DNCA session query for a subscriber whose internal IP-Address is 192.0.2.1.</p>
<div id="#rfc.figure.33"></div>
<div id="#fig-NAT-session-query-example"></div>
<pre>   &lt; NC-Request &gt; ::= &lt; Diameter Header: TBD, REQ, PXY&gt;
                    Auth-Application-Id = &lt;DNCA Application ID&gt;
                    Origin-Host = "natC.example.com"  
                    Origin-Realm = "example.com"
                    Destination-Realm = "example.com"
                    Destination-Host = "nat-device.example.com"
                    NC-Request-Type = QUERY_REQUEST
                    Framed-IP-Address = "192.0.2.1"</pre>
<p id="rfc.section.13.3.p.2">The NAT-device constructs an NCA to report all currently active NAT-bindings whose internal address is 192.0.2.1.</p>
<div id="#rfc.figure.34"></div>
<div id="#fig-NAT-session-query-answer-example"></div>
<pre>      &lt;NC-Answer&gt; ::= &lt; Diameter Header: TBD, PXY &gt;
                    Origin-Host = "nat-device.example.com"  
                    Origin-Realm = "example.com"
                    NC-Request-Type = QUERY_REQUEST
                    NAT-Control-Definition = {
                            Protocol = TCP
                            Direction = OUT
                            NAT-Internal-Address = {
                                Framed-IP-Address = "192.0.2.1"
                                Port = 80
                               }
                            NAT-External-Address = {
                                 Framed-IP-Address = "198.51.100.1"
                                 Port = 80
                               }
                            Session-Id = "natC.example.com:33041;23432;"
                    }
                    NAT-Control-Definition = {
                            Protocol = TCP
                            Direction = OUT
                            NAT-Internal-Address = {
                                Framed-IP-Address = "192.0.2.1"
                                Port = 1036
                               }
                            NAT-External-Address = {
                                 Framed-IP-Address = "198.51.100.1"
                                 Port = 5056
                               }
                            Session-Id = "natC.example.com:33041;23432;"
                    }
                    NAT-Control-Definition = {
                            Protocol = TCP
                            Direction = OUT
                            NAT-Internal-Address = {
                                Framed-IP-Address = "192.0.2.1"
                                Port = 1037
                               }
                            NAT-External-Address = {
                                 Framed-IP-Address = "198.51.100.1"
                                 Port = 5057
                               }
                            Session-Id = "natC.example.com:33041;23432;"
                    }   </pre>
<h1 id="rfc.section.13.4">
<a href="#rfc.section.13.4">13.4.</a> DNCA Session Termination Example</h1>
<p id="rfc.section.13.4.p.1">In this example the NAT-controller decides to terminate the previously established DNCA session. This could for example be the case as a result of an access session (e.g. a PPP session) associated with an end point been torn down.</p>
<div id="#rfc.figure.35"></div>
<div id="#fig-session-teardown-example"></div>
<pre>
    NAT-Controller                            NAT-device 
          |                                       |
          |                                       |
 +--------------+                                 |
 |  1. Trigger  |                                 |
 +--------------+                                 |
          |                                       |
          |                                       | 
          |             2.  STR                   |
          |--------------------------------------&gt;|
          |                                       |
          |                             3. DNCA session 
          |                                   lookup 
          |             4.  ACR                   |
          |&lt;--------------------------------------|
          |                                       |
          |             5.  ACA                   |
          |--------------------------------------&gt;|  
          |                                       |
          |                                       |  
          |                             6. DNCA bindings
          |                            and session cleanup 
          |                                       |
          |             7.  STA                   |
          |&lt;--------------------------------------|  
          |                                       |</pre>
<p id="rfc.section.13.4.p.2">The following steps describe the sequence of events for tearing down the DNCA session in the example above:</p>
<div id="#rfc.figure.36"></div>
<div id="#fig-NAT-session-termination-example"></div>
<pre>   &lt; STR &gt;     ::= &lt; Diameter Header: 275, REQ, PXY&gt;
                    Session-Id =  "natC.example.com:33041;23432;"
                    Auth-Application-Id = &lt;DNCA Application ID&gt;
                    Origin-Host = "natC.example.com"  
                    Origin-Realm = "example.com"
                    Destination-Realm = "example.com"
                    Destination-Host = "nat-device.example.com"
                    Termination-Cause = DIAMETER_LOGOUT
</pre>
<div id="#rfc.figure.37"></div>
<div id="#fig-NAT-session-accounting-request-example"></div>
<pre>   &lt; ACR &gt;     ::= &lt; Diameter Header: 271, REQ, PXY&gt;
                    Session-Id =  "natC.example.com:33041;23432;"
                    Auth-Application-Id = &lt;DNCA Application ID&gt;
                    Origin-Host = "nat-device.example.com"  
                    Origin-Realm = "example.com"
                    Destination-Realm = "example.com"
                    Destination-Host = "natC.example.com"
                    Accounting-Record-Type = STOP_RECORD
                    Accounting-Record-Number = 1
                    NAT-Control-Record = {
                        NAT-Control-Definition = {
                            Protocol = TCP
                            Direction = OUT
                            NAT-Internal-Address = {
                                Framed-IP-Address = "192.0.2.1"
                                Port = 5001
                               }
                            NAT-External-Address = {
                                 Framed-IP-Address = "198.51.100.1"
                                 Port = 7777
                               }
                           }
                          NAT-Control-Binding-Status = Removed
                       }

</pre>
<div id="#rfc.figure.38"></div>
<pre>   &lt;ACA&gt;      ::= &lt; Diameter Header: 271, PXY &gt;
                    Session-Id =  "natC.example.com:33041;23432;"
                    Origin-Host = "natC.example.com"  
                    Origin-Realm = "example.com"
                    Result-Code = DIAMETER_SUCCESS
                    Accounting-Record-Type = STOP_RECORD
                    Accounting-Record-Number = 1

</pre>
<div id="#rfc.figure.39"></div>
<pre>   &lt;STA&gt;      ::= &lt; Diameter Header: TBD, PXY &gt;
                    Session-Id =  "natC.example.com:33041;23432;"
                    Origin-Host = "nat-device.example.com"  
                    Origin-Realm = "example.com"
                    Result-Code = DIAMETER_SUCCESS
</pre>
<p></p>

<ol>
<li>The NAT-controller receives a trigger that a DNCA session associated with a specific end point should be terminated. An example event could be the termination of the PPP <a href="#RFC1661">[RFC1661]</a> access session to an end point in a NAS.  The NAS correspondingly triggers the NAT-controller request tear-down of the associated DNCA session.</li>
<li>The NAT-controller creates the required NCR message and sends it to the NAT-device: </li>
<li>The NAT-device looks up the DNCA session based on the Session-Id AVP and finds a previously established active session.</li>
<li>The NAT-device reports all NAT-bindings established for that subscriber using an ACR: </li>
<li>The NAT-controller receives and processes the ACR as per its configuration. It responds with an ACA to the NAT-device. </li>
<li>On receipt of the ACA the NAT-device cleans up all NAT-bindings and associated session state for the end point.</li>
<li>NAT-device sends an STA. On receipt of the STA the NAT-controller will clean up the corresponding session state.  </li>
</ol>
<h1 id="rfc.section.14">
<a href="#rfc.section.14">14.</a> Acknowledgements</h1>
<p id="rfc.section.14.p.1">The authors would like to thank Jari Arkko, Wesley Eddy, Stephen Farrell, Miguel A. Garcia, David Harrington, Jouni Korhonen, Matt Lepinski, Avi Lior, Chris Metz, Pallavi Mishra, Lionel Morand, Robert Sparks, Martin Stiemerling, Dave Thaler, Hannes Tschofenig, Sean Turner, Shashank Vikram, Greg Weber, and Glen Zorn for their input on this document.</p>
<h1 id="rfc.section.15">
<a href="#rfc.section.15">15.</a> Change History (to be removed prior to publication as an RFC) </h1>
<p id="rfc.section.15.p.1">Changes from -00 to -01</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>new values for Result-Code AVP used - instead of Experimental-Result AVP</li>
<li>added support for transport specific binding (UDP/TCP)</li>
<li>added support for twice-NAT</li>
<li>clarified the use of the two different types of query-requests</li>
</ol>
<p id="rfc.section.15.p.3">Changes from -01 to -02</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>Reference to pull mode removed, session initiation event clarified in section 4.1</li>
<li>added Redirect-* AVPs in NCA command</li>
<li>Removed reference to Called-Station-Id AVP in NCR command</li>
<li>Editorial changes</li>
<li>added support for bindings providing AFT (NAT64)</li>
</ol>

<p>Changes from -02 to -03</p>

<ol style="list-style-type: lower-alpha"><li>Editorial changes</li></ol>

<p>Changes from -03 to -04</p>

<ol style="list-style-type: lower-alpha">
<li>Editorial changes suggested in WG last call review</li>
<li>Removed NCR Request type terminate and replaced with STR</li>
<li>All references to Auth-Session-State are removed and a new section to describe FSM for Manager and Agent has been added</li>
<li>Clarified reuse of External address and address pools among multiple subscribers</li>
</ol>

<p>Changes from -04 to -05</p>

<ol style="list-style-type: lower-alpha"><li>Removed references to Large Scale NAT as per review comments</li></ol>

<p>Changes from -05 to -06</p>

<ol style="list-style-type: lower-alpha"><li>Editorial changes</li></ol>

<p>Changes from -06 to -07</p>

<ol style="list-style-type: lower-alpha">
<li>Added a note in section 4.3 stating the state of pre-existing bindings on update failure</li>
<li>Security considerations are made consistent between sections 5.1 and 12</li>
<li>Editorial changes</li>
</ol>

<p>Changes from -07 to -08</p>

<ol style="list-style-type: lower-alpha">
<li>Added section 4.6 to describe session abort</li>
<li>Editorial changes</li>
<li>Nomenclature change: From DNCA Agent/Manager to DNCA Diameter peers identifying the location where they reside (NAT-controller or NAT-device)</li>
<li>IANA consideration Section format changes</li>
<li>Updated security section (included considerations directly, rather than referring to Diameter QoS similarities).</li>
</ol>
<p id="rfc.section.15.p.5">Changes from -08 to -09</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>expanded on the need for an SP controlling the maximum number of bindings of an end point (see introduction section)</li>
<li>added a paragraph in the security section outlining general mis-uses of NAT-control (non specific to DNCA), with DNCA being an example of such a NAT-control protocol</li>
<li>editorial changes</li>
</ol>

<p>Changes from -09 to -10</p>

<ol style="list-style-type: lower-alpha">
<li>Section 4 and security considerations updated with RFC 2119 language</li>
<li>NAT-External-Port-Style AVP added to aid external port oddity requirement as per MIDCOM framework</li>
<li>NAT related RFCs added in normative reference</li>
<li>Section 13 added to provide example DNCA message exchange flows</li>
<li>Added a description to provide DNCA comparison with MIDCOM</li>
<li>n:1 deployment model for NAT-controllers and NAT-devices explicitly specified</li>
<li>editorial changes as per IESG DISCUSS comments</li>
</ol>
<h1 id="rfc.references">
<a href="#rfc.references">16.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">16.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3588">[RFC3588]</b></td>
<td class="top">
<a>Calhoun, P.</a>, <a>Loughney, J.</a>, <a>Guttman, E.</a>, <a>Zorn, G.</a> and <a>J. Arkko</a>, "<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>", RFC 3588, September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4675">[RFC4675]</b></td>
<td class="top">
<a>Congdon, P.</a>, <a>Sanchez, M.</a> and <a>B. Aboba</a>, "<a href="http://tools.ietf.org/html/rfc4675">RADIUS Attributes for Virtual LAN and Priority Support</a>", RFC 4675, September 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5777">[RFC5777]</b></td>
<td class="top">
<a>Korhonen, J.</a>, <a>Tschofenig, H.</a>, <a>Arumaithurai, M.</a>, <a>Jones, M.</a> and <a>A. Lior</a>, "<a href="http://tools.ietf.org/html/rfc5777">Traffic Classification and Quality of Service (QoS) Attributes for Diameter</a>", RFC 5777, February 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5226">[RFC5226]</b></td>
<td class="top">
<a>Narten, T.</a> and <a>H. Alvestrand</a>, "<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>", BCP 26, RFC 5226, May 2008.</td>
</tr>
<tr>
<td class="reference"><b id="ETSIES283034">[ETSIES283034]</b></td>
<td class="top">
<a>ETSI, </a>, "<a>Telecommunications and Internet Converged Services and Protocols for Advanced Networks (TISPAN),Network Attachment Sub-System (NASS),e4 interface based on the Diameter protocol.</a>", September 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4005">[RFC4005]</b></td>
<td class="top">
<a>Calhoun, P.</a>, <a>Zorn, G.</a>, <a>Spence, D.</a> and <a>D. Mitton</a>, "<a href="http://tools.ietf.org/html/rfc4005">Diameter Network Access Server Application</a>", RFC 4005, August 2005.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">16.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC6241">[RFC6241]</b></td>
<td class="top">
<a>Enns, R.</a>, <a>Bjorklund, M.</a>, <a>Schoenwaelder, J.</a> and <a>A. Bierman</a>, "<a href="http://tools.ietf.org/html/rfc6241">Network Configuration Protocol (NETCONF)</a>", RFC 6241, June 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6146">[RFC6146]</b></td>
<td class="top">
<a>Bagnulo, M.</a>, <a>Matthews, P.</a> and <a>I. van Beijnum</a>, "<a href="http://tools.ietf.org/html/rfc6146">Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers</a>", RFC 6146, April 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6145">[RFC6145]</b></td>
<td class="top">
<a>Li, X.</a>, <a>Bao, C.</a> and <a>F. Baker</a>, "<a href="http://tools.ietf.org/html/rfc6145">IP/ICMP Translation Algorithm</a>", RFC 6145, April 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3411">[RFC3411]</b></td>
<td class="top">
<a>Harrington, D.</a>, <a>Presuhn, R.</a> and <a>B. Wijnen</a>, "<a href="http://tools.ietf.org/html/rfc3411">An Architecture for Describing Simple Network Management Protocol (SNMP) Management Frameworks</a>", STD 62, RFC 3411, December 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3022">[RFC3022]</b></td>
<td class="top">
<a>Srisuresh, P.</a> and <a>K. Egevang</a>, "<a href="http://tools.ietf.org/html/rfc3022">Traditional IP Network Address Translator (Traditional NAT)</a>", RFC 3022, January 2001.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-behave-lsn-requirements">[I-D.ietf-behave-lsn-requirements]</b></td>
<td class="top">
<a>Perreault, S</a>, <a>Yamagata, I</a>, <a>Miyakawa, S</a>, <a>Nakagawa, A</a> and <a>H Ashida</a>, "<a href="http://tools.ietf.org/html/draft-ietf-behave-lsn-requirements-03">Common requirements for Carrier Grade NAT (CGN)</a>", Internet-Draft draft-ietf-behave-lsn-requirements-03, August 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5189">[RFC5189]</b></td>
<td class="top">
<a>Stiemerling, M.</a>, <a>Quittek, J.</a> and <a>T. Taylor</a>, "<a href="http://tools.ietf.org/html/rfc5189">Middlebox Communication (MIDCOM) Protocol Semantics</a>", RFC 5189, March 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3550">[RFC3550]</b></td>
<td class="top">
<a>Schulzrinne, H.</a>, <a>Casner, S.</a>, <a>Frederick, R.</a> and <a>V. Jacobson</a>, "<a href="http://tools.ietf.org/html/rfc3550">RTP: A Transport Protocol for Real-Time Applications</a>", STD 64, RFC 3550, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2663">[RFC2663]</b></td>
<td class="top">
<a href="mailto:srisuresh@lucent.com" title="Lucent Technologies">Srisuresh, P.</a> and <a href="mailto:holdrege@lucent.com" title="Lucent Technologiesv">M. Holdrege</a>, "<a href="http://tools.ietf.org/html/rfc2663">IP Network Address Translator (NAT) Terminology and Considerations</a>", RFC 2663, August 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3303">[RFC3303]</b></td>
<td class="top">
<a>Srisuresh, P.</a>, <a>Kuthan, J.</a>, <a>Rosenberg, J.</a>, <a>Molitor, A.</a> and <a>A. Rayhan</a>, "<a href="http://tools.ietf.org/html/rfc3303">Middlebox communication architecture and framework</a>", RFC 3303, August 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3304">[RFC3304]</b></td>
<td class="top">
<a>Swale, R.P.</a>, <a>Mart, P.A.</a>, <a>Sijben, P.</a>, <a>Brim, S.</a> and <a>M. Shore</a>, "<a href="http://tools.ietf.org/html/rfc3304">Middlebox Communications (midcom) Protocol Requirements</a>", RFC 3304, August 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4097">[RFC4097]</b></td>
<td class="top">
<a>Barnes, M.</a>, "<a href="http://tools.ietf.org/html/rfc4097">Middlebox Communications (MIDCOM) Protocol Evaluation</a>", RFC 4097, June 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1661">[RFC1661]</b></td>
<td class="top">
<a href="mailto:Bill.Simpson@um.cc.umich.edu" title="Daydreamer, Computer Systems Consulting Services">Simpson, W.</a>, "<a href="http://tools.ietf.org/html/rfc1661">The Point-to-Point Protocol (PPP)</a>", STD 51, RFC 1661, July 1994.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Frank Brockners</span> 
	  <span class="n hidden">
		<span class="family-name">Brockners</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco</span>
	<span class="adr">
	  <span>Hansaallee 249, 3rd Floor</span>

	  <span class="vcardline">
		<span class="locality">DUESSELDORF</span>,  
		<span class="region">NORDRHEIN-WESTFALEN</span> 
		<span class="code">40549</span>
	  </span>
	  <span class="country-name vcardline">Germany</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:fbrockne@cisco.com">fbrockne@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Shwetha Bhandari</span> 
	  <span class="n hidden">
		<span class="family-name">Bhandari</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco</span>
	<span class="adr">
	  <span>Cessna Business Park, Sarjapura Marathalli Outer Ring Road</span>

	  <span class="vcardline">
		<span class="locality">Bangalore, KARNATAKA 560 087</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">India</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:shwethab@cisco.com">shwethab@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Vaneeta Singh</span> 
	  <span class="n hidden">
		<span class="family-name">Singh</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  <span>18, Cambridge Road</span>

	  <span class="vcardline">
		<span class="locality">Bangalore 560008</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">India</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:vaneeta.singh@gmail.com">vaneeta.singh@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Victor Fajardo</span> 
	  <span class="n hidden">
		<span class="family-name">Fajardo</span>
	  </span>
	</span>
	<span class="org vcardline">Telcordia Technologies</span>
	<span class="adr">
	  <span>1 Telcordia Drive #1S-222</span>

	  <span class="vcardline">
		<span class="locality">Piscataway, NJ 08854</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:vf0213@gmail.com">vf0213@gmail.com</a></span>

  </address>
</div>

</body>
</html>