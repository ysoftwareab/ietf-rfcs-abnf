<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Session Recording Protocol</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Definitions">
<link href="#rfc.section.3" rel="Chapter" title="3 Scope">
<link href="#rfc.section.4" rel="Chapter" title="4 Overview of operations">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Delivering recorded media">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Delivering recording metadata">
<link href="#rfc.section.5" rel="Chapter" title="5 Initiating a Recording Session">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Procedures at the SRC">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Procedures at the SRS">
<link href="#rfc.section.6" rel="Chapter" title="6 SDP Handling">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Procedures at the SRC">
<link href="#rfc.section.6.1.1" rel="Chapter" title="6.1.1 Handling media stream updates">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Procedures at the SRS">
<link href="#rfc.section.7" rel="Chapter" title="7 RTP Handling">
<link href="#rfc.section.8" rel="Chapter" title="8 Metadata">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Procedures at the SRC">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Procedures at the SRS">
<link href="#rfc.section.8.2.1" rel="Chapter" title="8.2.1 Formal Syntax">
<link href="#rfc.section.9" rel="Chapter" title="9 Persistent Recording">
<link href="#rfc.section.10" rel="Chapter" title="10 Extensions for Recording-aware User Agents">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 Procedures at the record-aware user agent">
<link href="#rfc.section.10.1.1" rel="Chapter" title="10.1.1 Recording preference">
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 Procedures at the SRC">
<link href="#rfc.section.10.2.1" rel="Chapter" title="10.2.1 Recording indication">
<link href="#rfc.section.10.2.2" rel="Chapter" title="10.2.2 Recording preference">
<link href="#rfc.section.11" rel="Chapter" title="11 IANA Considerations">
<link href="#rfc.section.11.1" rel="Chapter" title="11.1 Registration of Option Tags">
<link href="#rfc.section.11.1.1" rel="Chapter" title="11.1.1 siprec Option Tag">
<link href="#rfc.section.11.1.2" rel="Chapter" title="11.1.2 record-aware Option Tag">
<link href="#rfc.section.11.2" rel="Chapter" title="11.2 Registration of media feature tags">
<link href="#rfc.section.11.2.1" rel="Chapter" title="11.2.1 src feature tag">
<link href="#rfc.section.11.2.2" rel="Chapter" title="11.2.2 srs feature tag">
<link href="#rfc.section.11.3" rel="Chapter" title="11.3 New Content-Disposition Parameter Registrations">
<link href="#rfc.section.11.4" rel="Chapter" title="11.4 Media Type Registration">
<link href="#rfc.section.11.4.1" rel="Chapter" title="11.4.1 Registration of MIME Type application/rs-metadata">
<link href="#rfc.section.11.4.2" rel="Chapter" title="11.4.2 Registration of MIME Type application/rs-metadata-request">
<link href="#rfc.section.11.5" rel="Chapter" title="11.5 SDP Attributes">
<link href="#rfc.section.11.5.1" rel="Chapter" title="11.5.1 'record' SDP Attribute">
<link href="#rfc.section.11.5.2" rel="Chapter" title="11.5.2 'recordpref' SDP Attribute">
<link href="#rfc.section.12" rel="Chapter" title="12 Security Considerations">
<link href="#rfc.section.12.1" rel="Chapter" title="12.1 Authentication and Authorization">
<link href="#rfc.section.13" rel="Chapter" title="13 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="14 References">
<link href="#rfc.references.1" rel="Chapter" title="14.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="14.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document specifies the use of the Session Initiation Protocol (SIP), the Session Description Protocol (SDP), and the Real Time Protocol (RTP) for delivering real-time media and metadata from a Communication Session (CS) to a recording device.  The Session Recording Protocol specifies the use of SIP, SDP, and RTP to establish a Recording Session (RS) from the Session Recording Client (SRC), which is on the path of the CS, to a Session Recording Server (SRS) at the recording device." />
  <meta name="description" content="This document specifies the use of the Session Initiation Protocol (SIP), the Session Description Protocol (SDP), and the Real Time Protocol (RTP) for delivering real-time media and metadata from a Communication Session (CS) to a recording device.  The Session Recording Protocol specifies the use of SIP, SDP, and RTP to establish a Recording Session (RS) from the Session Recording Client (SRC), which is on the path of the CS, to a Session Recording Server (SRS) at the recording device." />
  <meta name="keywords" content="siprec" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">SIPREC</td>
<td class="right">L.P. Portman, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">NICE Systems</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">H. Lum, Ed.</td>
</tr>
<tr>
<td class="left">Expires: May 03, 2012</td>
<td class="right">Genesys, Alcatel-Lucent</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">A. Johnston</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Avaya</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">A. Hutton</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Siemens Enterprise Communications</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 31, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Session Recording Protocol<br />
  <span class="filename">draft-ietf-siprec-protocol-02</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies the use of the Session Initiation Protocol (SIP), the Session Description Protocol (SDP), and the Real Time Protocol (RTP) for delivering real-time media and metadata from a Communication Session (CS) to a recording device.  The Session Recording Protocol specifies the use of SIP, SDP, and RTP to establish a Recording Session (RS) from the Session Recording Client (SRC), which is on the path of the CS, to a Session Recording Server (SRS) at the recording device.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 03, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Definitions</a>
</li>
<li>3.   <a href="#rfc.section.3">Scope</a>
</li>
<li>4.   <a href="#rfc.section.4">Overview of operations</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Delivering recorded media</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Delivering recording metadata</a>
</li>
<li>5.   <a href="#rfc.section.5">Initiating a Recording Session</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Procedures at the SRC</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Procedures at the SRS</a>
</li>
<li>6.   <a href="#rfc.section.6">SDP Handling</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Procedures at the SRC</a>
</li>
<li>6.1.1.   <a href="#rfc.section.6.1.1">Handling media stream updates</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Procedures at the SRS</a>
</li>
<li>7.   <a href="#rfc.section.7">RTP Handling</a>
</li>
<li>8.   <a href="#rfc.section.8">Metadata</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">Procedures at the SRC</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">Procedures at the SRS</a>
</li>
<li>8.2.1.   <a href="#rfc.section.8.2.1">Formal Syntax</a>
</li>
<li>9.   <a href="#rfc.section.9">Persistent Recording</a>
</li>
<li>10.   <a href="#rfc.section.10">Extensions for Recording-aware User Agents</a>
</li>
<li>10.1.   <a href="#rfc.section.10.1">Procedures at the record-aware user agent</a>
</li>
<li>10.1.1.   <a href="#rfc.section.10.1.1">Recording preference</a>
</li>
<li>10.2.   <a href="#rfc.section.10.2">Procedures at the SRC</a>
</li>
<li>10.2.1.   <a href="#rfc.section.10.2.1">Recording indication</a>
</li>
<li>10.2.2.   <a href="#rfc.section.10.2.2">Recording preference</a>
</li>
<li>11.   <a href="#rfc.section.11">IANA Considerations</a>
</li>
<li>11.1.   <a href="#rfc.section.11.1">Registration of Option Tags</a>
</li>
<li>11.1.1.   <a href="#rfc.section.11.1.1">siprec Option Tag</a>
</li>
<li>11.1.2.   <a href="#rfc.section.11.1.2">record-aware Option Tag</a>
</li>
<li>11.2.   <a href="#rfc.section.11.2">Registration of media feature tags</a>
</li>
<li>11.2.1.   <a href="#rfc.section.11.2.1">src feature tag</a>
</li>
<li>11.2.2.   <a href="#rfc.section.11.2.2">srs feature tag</a>
</li>
<li>11.3.   <a href="#rfc.section.11.3">New Content-Disposition Parameter Registrations</a>
</li>
<li>11.4.   <a href="#rfc.section.11.4">Media Type Registration</a>
</li>
<li>11.4.1.   <a href="#rfc.section.11.4.1">Registration of MIME Type application/rs-metadata</a>
</li>
<li>11.4.2.   <a href="#rfc.section.11.4.2">Registration of MIME Type application/rs-metadata-request</a>
</li>
<li>11.5.   <a href="#rfc.section.11.5">SDP Attributes</a>
</li>
<li>11.5.1.   <a href="#rfc.section.11.5.1">'record' SDP Attribute</a>
</li>
<li>11.5.2.   <a href="#rfc.section.11.5.2">'recordpref' SDP Attribute</a>
</li>
<li>12.   <a href="#rfc.section.12">Security Considerations</a>
</li>
<li>12.1.   <a href="#rfc.section.12.1">Authentication and Authorization</a>
</li>
<li>13.   <a href="#rfc.section.13">Acknowledgements</a>
</li>
<li>14.   <a href="#rfc.references">References</a>
</li>
<li>14.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>14.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#Introduction" id="Introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">This document specifies the mechanism to record a Communication Session (CS) by delivering real-time media and metadata from the CS to a recording device.  In accordance to the architecture <a href="#I-D.ietf-siprec-architecture">[I-D.ietf-siprec-architecture]</a>, the Session Recording Protocol specifies the use of SIP, SDP, and RTP to establish a Recording Session (RS) from the Session Recording Client (SRC), which is on the path of the CS, to a Session Recording Server (SRS) at the recording device.</p>
<p id="rfc.section.1.p.2">SIP is also used to deliver metadata to the recording device, as specified in <a href="#I-D.ietf-siprec-metadata">[I-D.ietf-siprec-metadata]</a>.  Metadata is information that describes recorded media and the CS to which they relate.</p>
<p id="rfc.section.1.p.3">The Session Recording Protocol intends to satisfy the SIP-based Media Recording requirements listed in <a href="#RFC6341">[RFC6341]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#Definitions" id="Definitions">Definitions</a>
</h1>
<p id="rfc.section.2.p.1">This document refers to the core definitions provided in the architecture document <a href="#I-D.ietf-siprec-architecture">[I-D.ietf-siprec-architecture]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Scope</h1>
<p id="rfc.section.3.p.1">The scope of the Session Recording Protocol includes the establishment of the recording sessions and the reporting of the metadata.  The scope also includes extensions supported by User Agents participating in the CS such as indication of recording.  The user agents need not be recording-aware in order to participate in a CS being recorded.</p>
<p id="rfc.section.3.p.2">The following items, which are not an exhaustive list, do not represent the protocol itself and are considered out of the scope of the Session Recording Protocol:</p>
<p></p>

<ul>
<li>Delivering recorded media in real-time as the CS media</li>
<li>Specifications of criteria to select a specific CS to be recorded or triggers to record a certain CS in the future</li>
<li>Recording policies that determine whether the CS should be recorded and whether parts of the CS are to be recorded</li>
<li>Retention policies that determine how long a recording is stored</li>
<li>Searching and accessing the recorded media and metadata</li>
<li>Policies governing how CS users are made aware of recording</li>
<li>Delivering additional recording session metadata through non-SIP mechanism</li>
</ul>

<p> </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#Overview" id="Overview">Overview of operations</a>
</h1>
<p id="rfc.section.4.p.1">This section is informative and provides a description of recording operations.</p>
<p id="rfc.section.4.p.2">As mentioned in the architecture document <a href="#I-D.ietf-siprec-architecture">[I-D.ietf-siprec-architecture]</a>, there are a number of types of call flows based on the location of the Session Recording Client.  The following sample call flows provide a quick overview of the operations between the SRC and the SRS.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Delivering recorded media</h1>
<p id="rfc.section.4.1.p.1">When a SIP Back-to-back User Agent (B2BUA) with SRC functionality routes a call from UA(A) to UA(B), the SRC has access to the media path between the user agents.  When the SRC is aware that it should be recording the conversation, the SRC can cause the B2BUA to bridge the media between UA(A) and UA(B).  The SRC then establishes the Recording Session with the SRS and sends replicated media towards the SRS.</p>
<p id="rfc.section.4.1.p.2">An endpoint may also have SRC functionality, where the endpoint itself establishes the Recording Session to the SRS.  Since the endpoint has access to the media in the Communication Session, the endpoint can send replicated media towards the SRS.</p>
<p id="rfc.section.4.1.p.3">The following is a sample call flow that shows the SRC establishing a recording session towards the SRS.  The call flow is essentially identical when the SRC is a B2BUA or as the endpoint itself.  Note that the SRC can choose when to establish the Recording Session independent of the Communication Session, even though the following call flow suggests that the SRC is establishing the Recording Session (message #5) after the Communication Session is established.</p>
<div id="#rfc.figure.1"></div>
<pre>

UA A           SRC                    UA B                    SRS
 |(1)CS INVITE  |                       |                      |
 |-------------&gt;|                       |                      |
 |              |(2)CS INVITE           |                      |
 |              |----------------------&gt;|                      |
 |              |           (3) 200 OK  |                      |
 |              |&lt;----------------------|                      |
 |   (4) 200 OK |                       |                      |
 |&lt;-------------|                       |                      |
 |              |(5)RS INVITE with SDP  |                      |
 |              |---------------------------------------------&gt;|
 |              |                       |  (6) 200 OK with SDP |
 |              |&lt;---------------------------------------------|
 |(7)CS RTP     |                       |                      |
 |=============&gt;|======================&gt;|                      |
 |&lt;=============|&lt;======================|                      |
 |              |(8)RS RTP              |                      |
 |              |=============================================&gt;|
 |              |=============================================&gt;|
 |(9)CS BYE     |                       |                      |
 |-------------&gt;|                       |                      |
 |              |(10)CS BYE             |                      |
 |              |----------------------&gt;|                      |
 |              |(11)RS BYE             |                      |
 |              |---------------------------------------------&gt;|
 |              |                       |                      |

         Figure 1: Basic Recording Call flow
								 
	</pre>
<p id="rfc.section.4.1.p.4">The above call flow can also apply to the case of a centralized conference with a mixer.  For clarity, ACKs to INVITEs and 200 OKs to BYEs are not shown.  The conference focus can provide the SRC functionality since the conference focus has access to all the media from each conference participant.  When a recording is requested, the SRC delivers the metadata and the media streams to the SRS.  Since the conference focus has access to a mixer, the SRC may choose to mix the media streams from all participants as a single mixed media stream towards the SRS.</p>
<p id="rfc.section.4.1.p.5">An SRC can use a single recording session to record multiple communication sessions.  Every time the SRC wants record a new call, the SRC updates the recording session with a new SDP offer to add new recorded streams to the recording session, and correspondingly also update the metadata for the new call.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Delivering recording metadata</h1>
<p id="rfc.section.4.2.p.1">The SRC is responsible for the delivery of metadata to the SRS.  The SRC may provide an initial metadata snapshot about recorded media streams in the initial INVITE content in the recording session.  Subsequent metadata updates can be represented as a stream of events in UPDATE or reINVITE requests sent by the SRC.  These metadata updates are normally incremental updates to the initial metadata snapshot to optimize on the size of updates, however, the SRC may also decide to send a new metadata snapshot anytime.</p>
<p id="rfc.section.4.2.p.2">Metadata is transported in the body of INVITE or UPDATE messages.  Certain metadata, such as the attributes of the recorded media stream are located in the SDP of the recording session. </p>
<p id="rfc.section.4.2.p.3">The SRS has the ability to send a request to the SRC to request for a new metadata snapshot update from the SRC.  This can happen when the SRS fails to understand the current stream of incremental updates for whatever reason, for example, when SRS loses the current state due to internal failure.  The SRS may optionally attach a reason along with the snapshot request.  This request allows both SRC and SRS to restart the states with a new metadata snapshot so that further metadata incremental updates will be based on the latest metadata snapshot.  Similar to the metadata content, the metadata snapshot request is transported as content in UPDATE or INVITE sent by the SRS in the recording session.</p>
<div id="#rfc.figure.2"></div>
<pre>

  SRC                                                   SRS
   |                                                     |
   |(1) INVITE (metadata snapshot)                       |
   |----------------------------------------------------&gt;|
   |                                           (2)200 OK |
   |&lt;----------------------------------------------------|
   |(3) ACK                                              |
   |----------------------------------------------------&gt;|
   |(4) RTP                                              |
   |====================================================&gt;|
   |====================================================&gt;|
   |(5) UPDATE (metadata update 1)                       |
   |----------------------------------------------------&gt;|
   |                                          (6) 200 OK |
   |&lt;----------------------------------------------------|
   |(7) UPDATE (metadata update 2)                       |
   |----------------------------------------------------&gt;|
   |                                          (8) 200 OK |
   |&lt;----------------------------------------------------|
   |              (9) UPDATE (metadata snapshot request) |
   |&lt;----------------------------------------------------|
   |                                        (10) 200 OK  |
   |----------------------------------------------------&gt;|
   |      (11) INVITE (metadata snapshot 2 + SDP offer)  |
   |----------------------------------------------------&gt;|
   |                            (12) 200 OK (SDP answer) |
   |&lt;----------------------------------------------------|
   | (13) UPDATE (metadata update 1 based on snapshot 2) |
   |----------------------------------------------------&gt;|
   |                                         (14) 200 OK |
   |&lt;----------------------------------------------------|
   
       Figure 3: Delivering metadata via SIP UPDATE
								 
	</pre>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Initiating a Recording Session</h1>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Procedures at the SRC</h1>
<p id="rfc.section.5.1.p.1">The SRC can initiate a recording session by sending a SIP INVITE request to the SRS.  In this case, the From header MUST contain the identity of the SRC, and the To header MUST contain the identity of the SRS.  Participants information is not recorded in the From or To header; they are included in the metadata.</p>
<p id="rfc.section.5.1.p.2">The SRC MUST include the 'src' feature tag in the Contact URI, defined in this specification as an extension to <a href="#RFC3840">[RFC3840]</a>, for all recording sessions.  An SRS uses the presence of the 'src' feature tag in dialog creating and modifying requests and responses to confirm that the dialog being created is for the purpose of a Recording Session.  In addition, a registrar could discover that a UA is an SRC based on the presence of this feature tag in a registration.  Other SIP Recording extensions and behaviors can be triggered by the presence of this feature tag.</p>
<p id="rfc.section.5.1.p.3">Since SIP Caller Preferences extensions are optional to implement for routing proxies, there is no guarantee that a recording session will be routed to an SRC or SRS.  A new options tag is introduced: "siprec". As per <a href="#RFC3261">[RFC3261]</a>, only an SRC or an SRS can accept this option tag in a recording session.  An SRC SHOULD include the "siprec" option tag in the Require header when initiating a Recording Session so that other types of user agents can simply reject the INVITE request with a 420 Bad Extension.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Procedures at the SRS</h1>
<p id="rfc.section.5.2.p.1">The SRS can initiate a recording session by sending a SIP INVITE request to the SRC.  In this case, the From header MUST contain the identity of the SRS, and the To header MUST contain the identity of the SRC.</p>
<p id="rfc.section.5.2.p.2">The SRS MUST include the 'srs' feature tag in the Contact URI, as per <a href="#RFC3840">[RFC3840]</a>, for all recording sessions.  An SRC uses the presence of this feature tag in dialog creating and modifying requests and responses to confirm that the dialog being created is for the purpose of a Recording Session (REQ-30).  In addition, a registrar could discover that a UA is an SRS based on the presence of this feature tag in a registration.  Other SIP Recording extensions and behaviors can be triggered by the presence of this feature tag.</p>
<p id="rfc.section.5.2.p.3">An SRS SHOULD include the "siprec" option tag in the Require header as per <a href="#RFC3261">[RFC3261]</a> when initiating a Recording Session so that other types of user agents can simply reject the INVITE request with a 420 Bad Extension.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> SDP Handling</h1>
<p id="rfc.section.6.p.1">The SRC and SRS follows the SDP offer/answer model in <a href="#RFC3264">[RFC3264]</a>. The rest of this section describes conventions used in a recording session.</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> Procedures at the SRC</h1>
<p id="rfc.section.6.1.p.1">Since the SRC does not expect to receive media from the SRS, the SRC typically sets each media stream of the SDP offer to only send media, by qualifying them with the a=sendonly attribute, according to the procedures in <a href="#RFC3264">[RFC3264]</a>.</p>
<p id="rfc.section.6.1.p.2">The SRC sends recorded streams of participants to the SRS, and the SRC MUST provide a label attribute (a=label), as per <a href="#RFC4574">[RFC4574]</a>, on each media stream in order to identify the recorded stream with the rest of the metadata.  The a=label attribute identifies each recorded media stream, and the label name is mapped to the Media Stream Reference in the metadata in <a href="#I-D.ietf-siprec-metadata">[I-D.ietf-siprec-metadata]</a>.  Note that a recorded stream is different than a CS stream; the metadata provides a list of participants that contributes to each recorded stream.</p>
<p id="rfc.section.6.1.p.3">The following is an example of SDP with both audio and video recorded streams.  Note that the following example contain unfolded lines longer than 72 characters.  These are captured between &lt;allOneLine&gt; tags.</p>
<div id="#rfc.figure.3"></div>
<pre>
	
    v=0
    o=SRS 2890844526 2890844526 IN IP4 198.51.100.1
    s=-
    c=IN IP4 198.51.100.1
    t=0 0
    m=audio 12240 RTP/AVP 0 4 8
    a=sendonly
    a=label:1
    m=video 22456 RTP/AVP 98
    a=rtpmap:98 H264/90000
    &lt;allOneLine&gt;
    a=fmtp:98 profile-level-id=42A01E;
              sprop-parameter-sets=Z0IACpZTBYmI,aMljiA==
    &lt;/allOneLine&gt;
    a=sendonly
    a=label:2
    m=audio 12242 RTP/AVP 0 4 8
    a=sendonly
    a=label:3
    m=audio 22458 RTP/AVP 98
    a=rtpmap:98 H264/90000
    &lt;allOneLine&gt;
    a=fmtp:98 profile-level-id=42A01E;
              sprop-parameter-sets=Z0IACpZTBYmI,aMljiA==
    &lt;/allOneLine&gt;
    a=sendonly
    a=label:4

    Figure 4: Sample SDP with audio and video streams

    </pre>
<h1 id="rfc.section.6.1.1">
<a href="#rfc.section.6.1.1">6.1.1.</a> Handling media stream updates</h1>
<p id="rfc.section.6.1.1.p.1">Over the lifetime of a recording session, the SRC can add and remove recorded streams from the recording session for various reasons.  For example, when a CS stream is added or removed from the CS, or when a CS is created or terminated if a recording session handles multiple CSes.  To remove a recorded stream from the recording session, the SRC sends a new SDP offer where the port of the media stream to be removed is set to zero, according to the procedures in <a href="#RFC3264">[RFC3264]</a>.  To add a recorded stream to the recording session, the SRC sends a new SDP offer by adding a new media stream description or by reusing an old media stream which had been previously disabled, according to the procedures in <a href="#RFC3264">[RFC3264]</a>.</p>
<p id="rfc.section.6.1.1.p.2">The SRC can temporarily discontinue streaming and collection of recorded media from the SRC to the SRS for reason such as masking the recording.  In this case, the SRC sends a new SDP offer and sets the media stream to inactive (a=inactive) for each recorded stream to be paused, as per the procedures in <a href="#RFC3264">[RFC3264]</a>.  To resume streaming and collection of recorded media, the SRC sends a new SDP offer and sets the media streams with a=sendonly attribute.  Note that when a CS stream is muted/unmuted, this information is conveyed in the metadata by the SRC.  The SRC SHOULD not modify the media stream with a=inactive for mute since this operation is reserved for pausing the RS media.</p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> Procedures at the SRS</h1>
<p id="rfc.section.6.2.p.1">The SRS only receives RTP streams from the SRC, the SDP answer normally sets each media stream to receive media, by setting them with the a=recvonly attribute, according to the procedures of <a href="#RFC3264">[RFC3264]</a>.  When the SRS is not ready to receive a recorded stream, the SRS sets the media stream as inactive in the SDP offer or answer by setting it with a=inactive attribute, according to the procedures of <a href="#RFC3264">[RFC3264]</a>.  When the SRS is ready to receive recorded streams, the SRS sends a new SDP offer and sets the media streams with a=recvonly attribute.</p>
<p id="rfc.section.6.2.p.2">The following sequence diagram shows an example where the SRS is initially not ready to receive recorded streams, and later updates the recording session when the SRS is ready to record.</p>
<div id="#rfc.figure.4"></div>
<pre>

  SRC                                                   SRS
   |                                                     |
   |(1) INVITE (SDP offer)                               |
   |----------------------------------------------------&gt;|
   |                                           [not ready to record]
   |                         (2)200 OK with SDP inactive |
   |&lt;----------------------------------------------------|
   |(3) ACK                                              |
   |----------------------------------------------------&gt;|
   |                      ...                            |
   |                                             [ready to record]
   |                     (4) re-INVITE with SDP recvonly |
   |&lt;----------------------------------------------------|
   |(5)200 OK with SDP sendonly                          |
   |----------------------------------------------------&gt;|
   |                                             (6) ACK |
   |&lt;----------------------------------------------------|
   |(7) RTP                                              |
   |====================================================&gt;|
   |                      ...                            |
   |(8) BYE                                              |
   |----------------------------------------------------&gt;|
   |                                             (9) OK  |
   |&lt;----------------------------------------------------|
    
	   Figure 5: SRS to offer with a=inactive

    </pre>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> RTP Handling</h1>
<p id="rfc.section.7.p.1">This is a placeholder section to specify any protocol impacts or recommendations for RTP usage in the session recording protocol.  The details are listed in <a href="#I-D.eckel-siprec-rtp-rec">[I-D.eckel-siprec-rtp-rec]</a></p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Metadata</h1>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> Procedures at the SRC</h1>
<p id="rfc.section.8.1.p.1">The SRC is responsible to deliver metadata to the SRS in a recording session.  Metadata can be provided by the SRC in the initial INVITE request when establishing the recording session, and subsequent metadata updates can be provided by the SRC in reINVITE and UPDATE requests and responses in the recording session.</p>
<p id="rfc.section.8.1.p.2">Certain metadata attributes are contained in the SDP, and others are contained in a new content type "application/rs-metadata".  The format of the metadata is described as part of the mechanism in <a href="#I-D.ietf-siprec-metadata">[I-D.ietf-siprec-metadata]</a>.  A new "disposition-type" of Content-Disposition is defined for the purpose of carrying metadata and the value is "recording-session".  The "recording-session" value indicates that the "application/rs-metadata" content contains metadata to be handled by the SRS, and the disposition can be carried in either INVITE or UPDATE requests or responses sent by the SRC.</p>
<p id="rfc.section.8.1.p.3">Metadata sent by the SRC can be categorized as either a full metadata snapshot or partial update.  A full metadata snapshot describes all the recorded streams and all metadata associated with the recording session.  When the SRC sends a full metadata snapshot, the SRC MUST send an INVITE request with an SDP offer and the "recording-session" disposition.  A partial update represents an incremental update since the last metadata update sent by the SRC.  A partial update sent by the SRC can be an INVITE request or response with an SDP offer, or an INVITE/UPDATE request or response containing a "recording-session" disposition, or an INVITE request containing both an SDP offer and the "recording-session" disposition.</p>
<p id="rfc.section.8.1.p.4">The following is an example of a full metadata snapshot sent by the SRC in the initial INVITE request:</p>
<div id="#rfc.figure.5"></div>
<pre>

    INVITE sip:recorder@example.com SIP/2.0
    Via: SIP/2.0/TCP src.example.com;branch=z9hG4bKdf6b622b648d9
    From: &lt;sip:2000@example.com&gt;;tag=35e195d2-947d-4585-946f-098392474
    To: &lt;sip:recorder@example.com&gt;
    Call-ID: d253c800-b0d1ea39-4a7dd-3f0e20a
    CSeq: 101 INVITE
    Max-Forwards: 70
    Require: siprec
    Accept: application/sdp, application/rs-metadata, 
      application/rs-metadata-request
    Contact: &lt;sip:2000@src.example.com&gt;;src
    Content-Type: multipart/mixed;boundary=foobar
    Content-Length: [length]
    
    --foobar
    Content-Type: application/sdp
    
    v=0
    o=SRS 2890844526 2890844526 IN IP4 198.51.100.1
    s=-
    c=IN IP4 198.51.100.1
    t=0 0
    m=audio 12240 RTP/AVP 0 4 8
    a=sendonly
    a=label:1

    --foobar
    Content-Type: application/rs-metadata
    Content-Disposition: recording-session
    
    [metadata content]

        Figure 6: Sample INVITE request for the recording session

	</pre>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> Procedures at the SRS</h1>
<p id="rfc.section.8.2.p.1">The SRS receives metadata updates from the SRC in INVITE and UPDATE requests.  Since the SRC can send partial updates based on the previous update, the SRS needs to keep track of the sequence of updates from the SRC.</p>
<p id="rfc.section.8.2.p.2">In the case of an internal failure at the SRS, the SRS may fail to recognize a partial update from the SRC.  The SRS may be able to recover from the internal failure by requesting for a full metadata snapshot from the SRC.  Certain errors, such syntax errors or semantic errors in the metadata information, are likely caused by an error on the SRC side, and it is likely the same error will occur again even when a full metadata snapshot is requested.  In order to avoid repeating the same error, it is RECOMMENDED that the SRS terminate the recording session when a syntax error or semantic error is detected in the metadata.</p>
<p id="rfc.section.8.2.p.3">When the SRS requires a full metadata snapshot, the SRS sends a metadata snapshot request to the SRC in an INVITE/UPDATE request or in an INVITE/UPDATE response.  The metadata snapshot request is contained the content with the disposition type "recording-session".  The format of the content is "application/rs-metadata-request", and the body format is chosen to be a simple text-based format.  The following shows an example:</p>
<div id="#rfc.figure.6"></div>
<pre>

    UPDATE sip:2000@src.exmaple.com SIP/2.0
    Via: SIP/2.0/UDP srs.example.com;branch=z9hG4bKdf6b622b648d9
    To: &lt;sip:2000@exmaple.com&gt;;tag=35e195d2-947d-4585-946f-098392474
    From: &lt;sip:recorder@example.com&gt;;tag=1234567890
    Call-ID: d253c800-b0d1ea39-4a7dd-3f0e20a
    CSeq: 1 UPDATE
    Max-Forwards: 70
    Require: siprec
    Contact: &lt;sip:recorder@srs.example.com&gt;;srs
    Accept: appliation/sdp, application/rs-metadata
    Content-Disposition: recording-session
    Content-Type: application/rs-metadata-request
    Content-Length: [length]
    
    SRS internal error

        Figure 7: Metadata Request

    </pre>
<p id="rfc.section.8.2.p.4">The SRS MAY include the reason why a metadata snapshot request is being made to the SRC in the reason line.  This reason line is free form text, mainly designed for logging purposes on the SRC side.  The processing of the content by the SRC is entirely optional since the content is for logging only, and the snapshot request itself is indicated by the use of the application/rs-metadata-request content type.</p>
<p id="rfc.section.8.2.p.5">When the SRC receives the request for a metadata snapshot, the SRC MUST provide a full metadata snapshot in a separate INVITE transaction, along with an SDP offer.  All subsequent metadata updates sent by the SRC MUST be based on the new metadata snapshot.</p>
<h1 id="rfc.section.8.2.1">
<a href="#rfc.section.8.2.1">8.2.1.</a> Formal Syntax</h1>
<p id="rfc.section.8.2.1.p.1">The formal syntax for the application/rs-metadata-request MIME is described below using the augmented Backus-Naur Form (BNF) as described in <a href="#RFC2234">[RFC2234]</a>.</p>
<p id="rfc.section.8.2.1.p.2">snapshot-request = srs-reason-line CRLF</p>
<p id="rfc.section.8.2.1.p.3">srs-reason-line  = [TEXT-UTF8-TRIM]</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Persistent Recording</h1>
<p id="rfc.section.9.p.1">Persistent recording is a specific use case outlined in REQ-005 or Use Case 4 in <a href="#RFC6341">[RFC6341]</a>, where a recording session can be established in the absence of a communication session.  The SRC continuously sends recorded media to the SRS in the absence of a CS for certain allocated devices; allocated devices can include a specific physical device, a specific person or contact registered, or a set of trunks or ports of a gateway.  To continuously record, the SRC adds recorded streams into the recording session for all devices with persistent recording.  By allocating recorded streams and continuously sending recorded media to the SRS, the SRC does not have to prepare new recorded streams with new SDP offer when a new communication session is created and also does not impact the timing of the CS.  The SRC only needs to update the metadata when new communication sessions are created.</p>
<p id="rfc.section.9.p.2">When there is no communication sessions running on the devices with persistent recording, there is no recorded media to stream from the SRC to the SRS.  In certain environments where Network Address Translator (NAT) is used, typically a minimum of flow activity is required to maintain the NAT binding for each port opened.  In order not to lose the NAT bindings for the RTP/RTCP ports opened for the recorded streams, the SRC and SRS SHOULD follow the recommendations provided in <a href="#RFC6263">[RFC6263]</a> to maintain the NAT bindings.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Extensions for Recording-aware User Agents</h1>
<p id="rfc.section.10.p.1">The following sections describe the SIP and SDP extensions for recording-aware user agents.</p>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> Procedures at the record-aware user agent</h1>
<p id="rfc.section.10.1.p.1">A recording-aware UA SHOULD indicate that it can accept reporting of recording indication provided by the SRC.  A new option tag "record-aware" is introduced to indicate such awareness.  The recording-aware UA SHOULD include the "record-aware" option tag in the Supported header when initiating or establishing a CS.  A recording-aware UA that has indicated recording awareness MUST provide at recording indication to the end user through an appropriate user interface an indication whether recording is on or off for a given medium based on the most recently received a=record SDP attribute for that medium.</p>
<p id="rfc.section.10.1.p.2">Some user agents that are automatons (eg. IVR, media server, PSTN gateway) may not have a user interface to render recording indication.  When such user agent indicates recording awareness, the UA SHOULD render recording indication through other means, such as passing an inband tone on the PSTN gateway, putting the recording indication in a log file, or raising an application event in a VoiceXML dialog.  These user agents MAY also choose not to indicate recording awareness, thereby relying on whatever mechanism an SRC chooses to indicate recording, such as playing a tone inband.</p>
<h1 id="rfc.section.10.1.1">
<a href="#rfc.section.10.1.1">10.1.1.</a> Recording preference</h1>
<p id="rfc.section.10.1.1.p.1">A recording-aware UA involved in a CS MAY request the CS to be recorded or not recorded.  This indication of recording preference can be sent at session establishment time or during the session.</p>
<p id="rfc.section.10.1.1.p.2">A new SDP attribute "recordpref" is introduced.  The SDP attribute appears at the media level and can appear in an SDP offer or answer.  The recording indication applies to the specified media stream only.  The following is the ABNF of the recordpref attribute:</p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 8">recordpref-attr      = "a=recordpref:" pref</dd>
<dt></dt>
<dd style="margin-left: 8">pref       = "on" / "off" / "pause" / "nopreference"</dd>
</dl>

<p> </p>
<p></p>

<dl>
<dt>on</dt>
<dd style="margin-left: 8">Request for recording if it has not already been started. If the recording is currently paused, request to resume recording.</dd>
<dt>off</dt>
<dd style="margin-left: 8">Request for no recording. If recording has already been started, then this preference indicates a request to stop recording.</dd>
<dt>pause</dt>
<dd style="margin-left: 8">Request to pause recording if recording is currently in progress.</dd>
<dt>nopreference</dt>
<dd style="margin-left: 8">To indicate that the UA has no preference on recording. While the absence of this attribute indirectly implies the lack of preference, using this value allows the UA to explicitly state no preference to being recorded.</dd>
</dl>
<h1 id="rfc.section.10.2">
<a href="#rfc.section.10.2">10.2.</a> Procedures at the SRC</h1>
<p id="rfc.section.10.2.p.1">When a UA has indicated that it is recording-aware through the "record-aware" option tag, the SRC MUST provide recording indications in a new SDP attribute described in the following section.  In the absence of the "record-aware" option tag, meaning that the UA is not recording-aware, an SRC MUST provide recording indications, where SRC is required to do so based on policies, through other means such as playing a tone inband.</p>
<h1 id="rfc.section.10.2.1">
<a href="#rfc.section.10.2.1">10.2.1.</a> Recording indication</h1>
<p id="rfc.section.10.2.1.p.1">While there are existing mechanisms for providing an indication that a CS is being recorded, these mechanisms are usually delivered on the CS media streams such as playing an in-band tone or an announcement to the participants.  A new SDP attribute is introduced to allow a recording-aware UA to render recording indication at the user interface.</p>
<p id="rfc.section.10.2.1.p.2">The 'record' SDP attribute appears at the media level in either SDP offer or answer.  The recording indication applies to the specified media stream only, for example, only the audio portion of the call is recorded in an audio/video call.  The following is the ABNF of the 'record' attribute:</p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 8">attribute          /= record-attr</dd>
<dt></dt>
<dd style="margin-left: 8">; attribute defined in RFC 4566</dd>
<dt></dt>
<dd style="margin-left: 8">record-attr      = "record:" indication</dd>
<dt></dt>
<dd style="margin-left: 8">indication       = "on" / "off" / "paused"</dd>
</dl>

<p> </p>
<p></p>

<dl>
<dt>on</dt>
<dd style="margin-left: 8">Recording is in progress.</dd>
<dt>off</dt>
<dd style="margin-left: 8">No recording is in progress.</dd>
<dt>paused</dt>
<dd style="margin-left: 8">Recording is in progress by media is paused.</dd>
</dl>

<p> </p>
<p id="rfc.section.10.2.1.p.5">The recording attribute is a declaration by an endpoint in the CS to indicate whether recording is taking place.  For example, if a UA (A) is initiating a call to UA (B) and UA (A) is also an SRC that is performing the recording, then UA (A) provides the recording indication in the SDP offer with a=record:on.  When UA (B) receives the SDP offer, UA (B) will see that recording is happening on the other endpoint of this session.  If UA (B) does not wish to perform recording itself, UA (B) provides the recording indication as a=record:off in the SDP answer.</p>
<p id="rfc.section.10.2.1.p.6">Whenever the recording indication needs to change, such as termination of recording, then the UA MUST initiate a reINVITE to update the SDP attribute to a=record:off.  The following call flow shows an example of the offer/answer with the recording indication attribute.</p>
<div id="#rfc.figure.7"></div>
<pre>

 UA A                                                   UA B
 (SRC)                                                   |
   |                                                     |
   |                [SRC recording starts]               |
   |(1) INVITE (SDP offer + a=record:on)                 |
   |----------------------------------------------------&gt;|
   |                                 200 OK (SDP answer) |
   |&lt;----------------------------------------------------|
   |(3) ACK                                              |
   |----------------------------------------------------&gt;|
   |(4) RTP                                              |
   |&lt;===================================================&gt;|
   |               [SRC stops recording]                 |
   |(5) re-INVITE (SDP + a=record:off)                   |
   |----------------------------------------------------&gt;|
   |                      (6) 200 OK (SDP + a=record:off)|
   |&lt;----------------------------------------------------|
   |                                             (6) ACK |
   |----------------------------------------------------&gt;|
    
	   Figure 8: Recording indication example

	</pre>
<p id="rfc.section.10.2.1.p.7">If a call is traversed through one or more SIP B2BUA, and it happens that there are more than one SRC in the call path, the recording indication attribute does not provide any hint as to which SRC is performing the recording, meaning the endpoint only knows that the call is being recorded.  This attribute is also not used as an indication to negotiate which SRC in the call path will perform recording and is not used as a request to start/stop recording if there are multiple SRCs in the call path.  </p>
<h1 id="rfc.section.10.2.2">
<a href="#rfc.section.10.2.2">10.2.2.</a> Recording preference</h1>
<p id="rfc.section.10.2.2.p.1">When the SRC receives the a=recordpref SDP in an SDP offer or answer, the SRC MAY choose to honor such request to record the request based on local policy on the SRC.  When the SRC honors the request, the SRC MUST also update the recording indication to reflect the current state of the recording (on/off/paused).</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<h1 id="rfc.section.11.1">
<a href="#rfc.section.11.1">11.1.</a> Registration of Option Tags</h1>
<p id="rfc.section.11.1.p.1">This specification registers two option tags. The required information for this registration, as specified in <a href="#RFC3261">[RFC3261]</a>, is as follows.</p>
<h1 id="rfc.section.11.1.1">
<a href="#rfc.section.11.1.1">11.1.1.</a> siprec Option Tag</h1>
<p></p>

<ul class="empty">
<li>Name: siprec</li>
<li>Description: This option tag is for identifying the SIP session for the purpose of recording session only.  This is typically not used in a Supported header.  When present in a Require header in a request, it indicates that the UAS MUST be either a SRC or SRS capable of handling the contexts of a recording session.</li>
</ul>

<p> </p>
<h1 id="rfc.section.11.1.2">
<a href="#rfc.section.11.1.2">11.1.2.</a> record-aware Option Tag</h1>
<p></p>

<ul class="empty">
<li>Name: record-aware</li>
<li>Description: This option tag is to indicate the ability for the user agent to receive recording indicators in media level SDP.  When present in a Supported header, it indicates that the UA can receive recording indicators in media level SDP.</li>
</ul>

<p> </p>
<h1 id="rfc.section.11.2">
<a href="#rfc.section.11.2">11.2.</a> Registration of media feature tags</h1>
<p id="rfc.section.11.2.p.1">This document registers two new media feature tags in the SIP tree per the process defined in <a href="#RFC2506">[RFC2506]</a> and <a href="#RFC3840">[RFC3840]</a> </p>
<h1 id="rfc.section.11.2.1">
<a href="#rfc.section.11.2.1">11.2.1.</a> src feature tag</h1>
<p></p>

<ul class="empty">
<li>Media feature tag name: sip.src</li>
<li>ASN.1 Identifier: 25</li>
<li>Summary of the media feature indicated by this tag: This feature tag indicates that the user agent is a Session Recording Client for the purpose for Recording Session.</li>
<li>Values appropriate for use with this feature tag: boolean</li>
<li>The feature tag is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This feature tag is only useful for a Recording Session.</li>
<li>Examples of typical use: Routing the request to a Session Recording Server.</li>
<li>Security Considerations: Security considerations for this media feature tag are discussed in Section 11.1 of RFC 3840.</li>
</ul>

<p> </p>
<h1 id="rfc.section.11.2.2">
<a href="#rfc.section.11.2.2">11.2.2.</a> srs feature tag</h1>
<p></p>

<ul class="empty">
<li>Media feature tag name: sip.srs</li>
<li>ASN.1 Identifier: 26</li>
<li>Summary of the media feature indicated by this tag: This feature tag indicates that the user agent is a Session Recording Server for the purpose for Recording Session.</li>
<li>Values appropriate for use with this feature tag: boolean</li>
<li>The feature tag is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This feature tag is only useful for a Recording Session.</li>
<li>Examples of typical use: Routing the request to a Session Recording Client.</li>
<li>Security Considerations: Security considerations for this media feature tag are discussed in Section 11.1 of RFC 3840.</li>
</ul>

<p> </p>
<h1 id="rfc.section.11.3">
<a href="#rfc.section.11.3">11.3.</a> New Content-Disposition Parameter Registrations</h1>
<p id="rfc.section.11.3.p.1">This document registers a new "disposition-type" value in Content-Disposition header: recording-session.</p>
<p id="rfc.section.11.3.p.2">recording-session   the body describes the metadata information about the recording session</p>
<h1 id="rfc.section.11.4">
<a href="#rfc.section.11.4">11.4.</a> Media Type Registration</h1>
<h1 id="rfc.section.11.4.1">
<a href="#rfc.section.11.4.1">11.4.1.</a> Registration of MIME Type application/rs-metadata</h1>
<p id="rfc.section.11.4.1.p.1">This document registers the application/rs-metadata MIME media type in order to describe the recording session metadata. This media type is defined by the following information:</p>
<p id="rfc.section.11.4.1.p.2">Media type name: application</p>
<p id="rfc.section.11.4.1.p.3">Media subtype name: rs-metadata</p>
<p id="rfc.section.11.4.1.p.4">Required parameters: none</p>
<p id="rfc.section.11.4.1.p.5">Options parameters: none</p>
<h1 id="rfc.section.11.4.2">
<a href="#rfc.section.11.4.2">11.4.2.</a> Registration of MIME Type application/rs-metadata-request</h1>
<p id="rfc.section.11.4.2.p.1">This document registers the application/rs-metadata-request MIME media type in order to describe a recording session metadata snapshot request. This media type is defined by the following information:</p>
<p id="rfc.section.11.4.2.p.2">Media type name: application</p>
<p id="rfc.section.11.4.2.p.3">Media subtype name: rs-metadata-request</p>
<p id="rfc.section.11.4.2.p.4">Required parameters: none</p>
<p id="rfc.section.11.4.2.p.5">Options parameters: none</p>
<h1 id="rfc.section.11.5">
<a href="#rfc.section.11.5">11.5.</a> SDP Attributes</h1>
<p id="rfc.section.11.5.p.1">This document registers the following new SDP attributes.</p>
<h1 id="rfc.section.11.5.1">
<a href="#rfc.section.11.5.1">11.5.1.</a> 'record' SDP Attribute</h1>
<p id="rfc.section.11.5.1.p.1">Contact names: Leon Portman leon.portman@nice.com, Henry Lum henry.lum@genesyslab.com</p>
<p id="rfc.section.11.5.1.p.2">Attribute name: record</p>
<p id="rfc.section.11.5.1.p.3">Long form attribute name: Recording Indication</p>
<p id="rfc.section.11.5.1.p.4">Type of attribute: media level</p>
<p id="rfc.section.11.5.1.p.5">Subject to charset: no</p>
<p id="rfc.section.11.5.1.p.6">This attribute provides the recording indication for the session or media stream.</p>
<p id="rfc.section.11.5.1.p.7">Allowed attribute values: on, off, paused</p>
<h1 id="rfc.section.11.5.2">
<a href="#rfc.section.11.5.2">11.5.2.</a> 'recordpref' SDP Attribute</h1>
<p id="rfc.section.11.5.2.p.1">Contact names: Leon Portman leon.portman@nice.com, Henry Lum henry.lum@genesyslab.com</p>
<p id="rfc.section.11.5.2.p.2">Attribute name: recordpref</p>
<p id="rfc.section.11.5.2.p.3">Long form attribute name: Recording Preference</p>
<p id="rfc.section.11.5.2.p.4">Type of attribute: media level</p>
<p id="rfc.section.11.5.2.p.5">Subject to charset: no</p>
<p id="rfc.section.11.5.2.p.6">This attribute provides the recording indication for the session or media stream.</p>
<p id="rfc.section.11.5.2.p.7">Allowed attribute values: on, off, pause, nopreference</p>
<h1 id="rfc.section.12">
<a href="#rfc.section.12">12.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.12.p.1">The recording session is fundamentally a standard SIP dialog <a href="#RFC3261">[RFC3261]</a>, therefore, the recording session can reuse any of the existing SIP security mechanism available for securing the recorded media as well as metadata.  Other security considerations are outlined in the use cases and requirements document <a href="#RFC6341">[RFC6341]</a>.</p>
<h1 id="rfc.section.12.1">
<a href="#rfc.section.12.1">12.1.</a> <a href="#authentication" id="authentication">Authentication and Authorization</a>
</h1>
<p id="rfc.section.12.1.p.1">The recording session reuses the SIP mechanism to challenge requests that is based on HTTP authentication.  The mechanism relies on 401 and 407 SIP responses as well as other SIP header fields for carrying challenges and credentials.</p>
<p id="rfc.section.12.1.p.2">The SRS may have its own set of recording policies to authorize recording requests from the SRC.  The use of recording policies is outside the scope of the Session Recording Protocol.</p>
<h1 id="rfc.section.13">
<a href="#rfc.section.13">13.</a> <a href="#acknowledgement" id="acknowledgement">Acknowledgements</a>
</h1>
<p id="rfc.section.13.p.1">We want to thank John Elwell, Paul Kyzivat, Partharsarathi R, Ram Mohan R, Charles Eckel, Hadriel Kaplan, Adam Roach, Miguel Garcia for their valuable comments and inputs to this document.</p>
<h1 id="rfc.references">
<a href="#rfc.references">14.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">14.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2506">[RFC2506]</b></td>
<td class="top">
<a href="mailto:koen@win.tue.nl" title="Technische Universiteit Eindhoven">Holtman, K.</a>, <a href="mailto:andy_mutz@hp.com" title="Hewlett-Packard Company">Mutz, A.</a> and <a href="mailto:hardie@equinix.com" title="Equinix">T. Hardie</a>, "<a href="http://tools.ietf.org/html/rfc2506">Media Feature Tag Registration Procedure</a>", BCP 31, RFC 2506, March 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2234">[RFC2234]</b></td>
<td class="top">
<a href="mailto:dcrocker@imc.org" title="Internet Mail Consortium">Crocker, D.</a> and <a href="mailto:paulo@turnpike.com" title="Demon Internet Ltd.">P. Overell</a>, "<a href="http://tools.ietf.org/html/rfc2234">Augmented BNF for Syntax Specifications: ABNF</a>", RFC 2234, November 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2804">[RFC2804]</b></td>
<td class="top">
<a>IAB</a><a>IESG</a>, "<a href="http://tools.ietf.org/html/rfc2804">IETF Policy on Wiretapping</a>", RFC 2804, May 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3261">[RFC3261]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3264">[RFC3264]</b></td>
<td class="top">
<a>Rosenberg, J.</a> and <a>H. Schulzrinne</a>, "<a href="http://tools.ietf.org/html/rfc3264">An Offer/Answer Model with Session Description Protocol (SDP)</a>", RFC 3264, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4574">[RFC4574]</b></td>
<td class="top">
<a>Levin, O.</a> and <a>G. Camarillo</a>, "<a href="http://tools.ietf.org/html/rfc4574">The Session Description Protocol (SDP) Label Attribute</a>", RFC 4574, August 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3840">[RFC3840]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a> and <a>P. Kyzivat</a>, "<a href="http://tools.ietf.org/html/rfc3840">Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)</a>", RFC 3840, August 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3841">[RFC3841]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a> and <a>P. Kyzivat</a>, "<a href="http://tools.ietf.org/html/rfc3841">Caller Preferences for the Session Initiation Protocol (SIP)</a>", RFC 3841, August 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6341">[RFC6341]</b></td>
<td class="top">
<a>Rehor, K.</a>, <a>Portman, L.</a>, <a>Hutton, A.</a> and <a>R. Jain</a>, "<a href="http://tools.ietf.org/html/rfc6341">Use Cases and Requirements for SIP-Based Media Recording (SIPREC)</a>", RFC 6341, August 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-siprec-metadata">[I-D.ietf-siprec-metadata]</b></td>
<td class="top">
<a>R, R</a>, <a>Ravindran, P</a> and <a>P Kyzivat</a>, "<a href="http://tools.ietf.org/html/draft-ietf-siprec-metadata-05">Session Initiation Protocol (SIP) Recording Metadata</a>", Internet-Draft draft-ietf-siprec-metadata-05, October 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">14.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-siprec-architecture">[I-D.ietf-siprec-architecture]</b></td>
<td class="top">
<a>Hutton, A</a>, <a>Portman, L</a>, <a>Jain, R</a> and <a>K Rehor</a>, "<a href="http://tools.ietf.org/html/draft-ietf-siprec-architecture-03">An Architecture for Media Recording using the Session Initiation Protocol</a>", Internet-Draft draft-ietf-siprec-architecture-03, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.eckel-siprec-rtp-rec">[I-D.eckel-siprec-rtp-rec]</b></td>
<td class="top">
<a>Eckel, C</a>, "<a href="http://tools.ietf.org/html/draft-eckel-siprec-rtp-rec-03">Real-time Transport Protocol (RTP) Recommendations for SIPREC</a>", Internet-Draft draft-eckel-siprec-rtp-rec-03, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4508">[RFC4508]</b></td>
<td class="top">
<a>Levin, O.</a> and <a>A. Johnston</a>, "<a href="http://tools.ietf.org/html/rfc4508">Conveying Feature Tags with the Session Initiation Protocol (SIP) REFER Method</a>", RFC 4508, May 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4579">[RFC4579]</b></td>
<td class="top">
<a>Johnston, A.</a> and <a>O. Levin</a>, "<a href="http://tools.ietf.org/html/rfc4579">Session Initiation Protocol (SIP) Call Control - Conferencing for User Agents</a>", BCP 119, RFC 4579, August 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6263">[RFC6263]</b></td>
<td class="top">
<a>Marjou, X.</a> and <a>A. Sollaud</a>, "<a href="http://tools.ietf.org/html/rfc6263">Application Mechanism for Keeping Alive the NAT Mappings Associated with RTP / RTP Control Protocol (RTCP) Flows</a>", RFC 6263, June 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Leon Portman</span> editor
	  <span class="n hidden">
		<span class="family-name">Portman</span>
	  </span>
	</span>
	<span class="org vcardline">NICE Systems</span>
	<span class="adr">
	  <span>8 Hapnina</span>

	  <span class="vcardline">
		<span class="locality">Ra'anana</span>,  
		<span class="region"></span>
		<span class="code">43017</span>
	  </span>
	  <span class="country-name vcardline">Israel</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:leon.portman@nice.com">leon.portman@nice.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Henry Lum</span> editor
	  <span class="n hidden">
		<span class="family-name">Lum</span>
	  </span>
	</span>
	<span class="org vcardline">Genesys, Alcatel-Lucent</span>
	<span class="adr">
	  <span>1380 Rodick Road, Suite 200</span>

	  <span class="vcardline">
		<span class="locality">Markham</span>,  
		<span class="region">Ontario</span> 
		<span class="code">L3R4G5</span>
	  </span>
	  <span class="country-name vcardline">Canada</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:henry.lum@genesyslab.com">henry.lum@genesyslab.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Alan Johnston</span> 
	  <span class="n hidden">
		<span class="family-name">Johnston</span>
	  </span>
	</span>
	<span class="org vcardline">Avaya</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">St. Louis</span>,  
		<span class="region">MO</span> 
		<span class="code">63124</span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:alan.b.johnston@gmail.com">alan.b.johnston@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Andrew Hutton</span> 
	  <span class="n hidden">
		<span class="family-name">Hutton</span>
	  </span>
	</span>
	<span class="org vcardline">Siemens Enterprise Communications</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:andrew.hutton@siemens-enterprise.com%20">andrew.hutton@siemens-enterprise.com </a></span>

  </address>
</div>

</body>
</html>