<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Extensible Messaging and Presence Protocol (XMPP): Core</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Extensible Messaging and Presence Protocol (XMPP): Core">
<meta name="keywords" content="Extensible Messaging and Presence Protocol, XMPP, Jabber, Messaging, Instant Messaging, Presence, Extensible Markup Language, XML">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">P. Saint-Andre, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">XMPP Standards Foundation</td></tr>
<tr><td class="header">Obsoletes: <a href='http://tools.ietf.org/html/rfc3920'>3920</a> (if&nbsp;approved)</td><td class="header">July 01, 2008</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: January 2, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Extensible Messaging and Presence Protocol (XMPP): Core<br />draft-saintandre-rfc3920bis-06</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on January 2, 2009.</p>

<h3>Abstract</h3>

<p>This document defines the core features of the Extensible Messaging and Presence Protocol (XMPP), a technology for streaming Extensible Markup Language (XML) elements for the purpose of exchanging structured information in close to real time between any two or more network-aware entities.  XMPP provides a generalized, extensible framework for incrementally exchanging XML data, upon which a variety of applications can be built.  The framework includes methods for stream setup and teardown, channel encryption, authentication of a client to a server and of one server to another server, and primitives for push-style messages, publication of network availability information ("presence"), and request-response interactions.  This document also specifies the format for XMPP addresses, which are fully internationalizable.
</p>
<p>This document obsoletes RFC 3920.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-overview">1.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-summary">1.2.</a>&nbsp;
Functional Summary<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-conventions">1.3.</a>&nbsp;
Conventions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-ack">1.4.</a>&nbsp;
Acknowledgements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-discuss">1.5.</a>&nbsp;
Discussion Venue<br />
<a href="#arch">2.</a>&nbsp;
Architecture<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#arch-overview">2.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#arch-server">2.2.</a>&nbsp;
Server<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#arch-client">2.3.</a>&nbsp;
Client<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#arch-network">2.4.</a>&nbsp;
Network<br />
<a href="#addressing">3.</a>&nbsp;
Addresses<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#addressing-overview">3.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#addressing-domain">3.2.</a>&nbsp;
Domain Identifier<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#addressing-node">3.3.</a>&nbsp;
Node Identifier<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#addressing-resource">3.4.</a>&nbsp;
Resource Identifier<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#addressing-determination">3.5.</a>&nbsp;
Determination of Addresses<br />
<a href="#tcp">4.</a>&nbsp;
TCP Binding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tcp-scope">4.1.</a>&nbsp;
Scope<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tcp-resolution">4.2.</a>&nbsp;
Hostname Resolution<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tcp-c2s">4.3.</a>&nbsp;
Client-to-Server Communication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tcp-s2s">4.4.</a>&nbsp;
Server-to-Server Communication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-reconnect">4.5.</a>&nbsp;
Reconnection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tcp-other">4.6.</a>&nbsp;
Other Bindings<br />
<a href="#streams">5.</a>&nbsp;
XML Streams<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-overview">5.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-security">5.2.</a>&nbsp;
Stream Security<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-attr">5.3.</a>&nbsp;
Stream Attributes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-attr-from">5.3.1.</a>&nbsp;
from<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-attr-to">5.3.2.</a>&nbsp;
to<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-attr-id">5.3.3.</a>&nbsp;
id<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-attr-xmllang">5.3.4.</a>&nbsp;
xml:lang<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-attr-version">5.3.5.</a>&nbsp;
version<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-attr-summary">5.3.6.</a>&nbsp;
Summary of Stream Attributes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-ns">5.4.</a>&nbsp;
Namespace Declarations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-features">5.5.</a>&nbsp;
Stream Features<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-restart">5.6.</a>&nbsp;
Restarts During Stream Negotiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-close">5.7.</a>&nbsp;
Closing a Stream<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-close-witherror">5.7.1.</a>&nbsp;
With Stream Error<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-close-withouterror">5.7.2.</a>&nbsp;
Without Stream Error<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-close-idle">5.7.3.</a>&nbsp;
Handling of Idle Streams<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error">5.8.</a>&nbsp;
Stream Errors<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-rules">5.8.1.</a>&nbsp;
Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-rules-unrecoverable">5.8.1.1.</a>&nbsp;
Stream Errors Are Unrecoverable<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-rules-setup">5.8.1.2.</a>&nbsp;
Stream Errors Can Occur During Setup<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-rules-host">5.8.1.3.</a>&nbsp;
Stream Errors When the Host is Unspecified or Unknown<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-syntax">5.8.2.</a>&nbsp;
Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions">5.8.3.</a>&nbsp;
Defined Stream Error Conditions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-bad-format">5.8.3.1.</a>&nbsp;
bad-format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-bad-namespace-prefix">5.8.3.2.</a>&nbsp;
bad-namespace-prefix<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-conflict">5.8.3.3.</a>&nbsp;
conflict<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-connection-timeout">5.8.3.4.</a>&nbsp;
connection-timeout<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-host-gone">5.8.3.5.</a>&nbsp;
host-gone<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-host-unknown">5.8.3.6.</a>&nbsp;
host-unknown<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-improper-addressing">5.8.3.7.</a>&nbsp;
improper-addressing<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-internal-server-error">5.8.3.8.</a>&nbsp;
internal-server-error<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-invalid-from">5.8.3.9.</a>&nbsp;
invalid-from<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-invalid-id">5.8.3.10.</a>&nbsp;
invalid-id<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-invalid-namespace">5.8.3.11.</a>&nbsp;
invalid-namespace<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-invalid-xml">5.8.3.12.</a>&nbsp;
invalid-xml<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-not-authorized">5.8.3.13.</a>&nbsp;
not-authorized<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-policy-violation">5.8.3.14.</a>&nbsp;
policy-violation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-remote-connection-failed">5.8.3.15.</a>&nbsp;
remote-connection-failed<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-resource-constraint">5.8.3.16.</a>&nbsp;
resource-constraint<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-restricted-xml">5.8.3.17.</a>&nbsp;
restricted-xml<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-see-other-host">5.8.3.18.</a>&nbsp;
see-other-host<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-system-shutdown">5.8.3.19.</a>&nbsp;
system-shutdown<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-undefined-condition">5.8.3.20.</a>&nbsp;
undefined-condition<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-unsupported-encoding">5.8.3.21.</a>&nbsp;
unsupported-encoding<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-unsupported-stanza-type">5.8.3.22.</a>&nbsp;
unsupported-stanza-type<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-unsupported-version">5.8.3.23.</a>&nbsp;
unsupported-version<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-conditions-xml-not-well-formed">5.8.3.24.</a>&nbsp;
xml-not-well-formed<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-error-app">5.8.4.</a>&nbsp;
Application-Specific Conditions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#streams-example">5.9.</a>&nbsp;
Simplified Stream Examples<br />
<a href="#tls">6.</a>&nbsp;
STARTTLS Negotiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-overview">6.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-rules">6.2.</a>&nbsp;
Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-rules-data">6.2.1.</a>&nbsp;
Data Formatting<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-rules-order">6.2.2.</a>&nbsp;
Order of Negotiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-process">6.3.</a>&nbsp;
Process<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-process-stream">6.3.1.</a>&nbsp;
Exchange of Stream Headers and Stream Features<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-process-initiate">6.3.2.</a>&nbsp;
Initiation of STARTTLS Negotiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-process-initiate-command">6.3.2.1.</a>&nbsp;
STARTTLS Command<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-process-initiate-failure">6.3.2.2.</a>&nbsp;
Failure Case<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-process-initiate-proceed">6.3.2.3.</a>&nbsp;
Proceed Case<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-process-neg">6.3.3.</a>&nbsp;
TLS Negotiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-process-neg-rules">6.3.3.1.</a>&nbsp;
Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-process-neg-failure">6.3.3.2.</a>&nbsp;
TLS Failure<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-process-neg-success">6.3.3.3.</a>&nbsp;
TLS Success<br />
<a href="#sasl">7.</a>&nbsp;
SASL Negotiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-overview">7.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-rules">7.2.</a>&nbsp;
Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-rules-preferences">7.2.1.</a>&nbsp;
Mechanism Preferences<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-rules-offers">7.2.2.</a>&nbsp;
Mechanism Offers<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-rules-data">7.2.3.</a>&nbsp;
Data Formatting<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-rules-layers">7.2.4.</a>&nbsp;
Security Layers<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-rules-username">7.2.5.</a>&nbsp;
Simple Usernames<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-rules-authzid">7.2.6.</a>&nbsp;
Authorization Identities<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-rules-rountrips">7.2.7.</a>&nbsp;
Round Trips<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-process">7.3.</a>&nbsp;
Process<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-process-stream">7.3.1.</a>&nbsp;
Exchange of Stream Headers and Stream Features<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-process-neg-initiate">7.3.2.</a>&nbsp;
Initiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-process-neg-challengeresponse">7.3.3.</a>&nbsp;
Challenge-Response Sequence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-process-neg-abort">7.3.4.</a>&nbsp;
Abort<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-process-neg-failure">7.3.5.</a>&nbsp;
Failure<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-process-neg-success">7.3.6.</a>&nbsp;
Success<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-errors">7.4.</a>&nbsp;
SASL Errors<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-errors-aborted">7.4.1.</a>&nbsp;
aborted<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-errors-account-disabled">7.4.2.</a>&nbsp;
account-disabled<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-errors-credentials-expired">7.4.3.</a>&nbsp;
credentials-expired<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-errors-encryption-required">7.4.4.</a>&nbsp;
encryption-required<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-errors-incorrect-encoding">7.4.5.</a>&nbsp;
incorrect-encoding<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-errors-invalid-authzid">7.4.6.</a>&nbsp;
invalid-authzid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-errors-invalid-mechanism">7.4.7.</a>&nbsp;
invalid-mechanism<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-errors-malformed-request">7.4.8.</a>&nbsp;
malformed-request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-errors-mechanism-too-weak">7.4.9.</a>&nbsp;
mechanism-too-weak<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-errors-not-authorized">7.4.10.</a>&nbsp;
not-authorized<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-errors-temporary-auth-failure">7.4.11.</a>&nbsp;
temporary-auth-failure<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-errors-transition-needed">7.4.12.</a>&nbsp;
transition-needed<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sasl-def">7.5.</a>&nbsp;
SASL Definition<br />
<a href="#bind">8.</a>&nbsp;
Resource Binding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-overview">8.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-feature">8.2.</a>&nbsp;
Advertising Support<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-generation">8.3.</a>&nbsp;
Generation of Resource Identifiers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-servergen">8.4.</a>&nbsp;
Server-Generated Resource Identifier<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-servergen-success">8.4.1.</a>&nbsp;
Success Case<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-servergen-error">8.4.2.</a>&nbsp;
Error Cases<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-servergen-error-resourceconstraint">8.4.2.1.</a>&nbsp;
Resource Constraint<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-servergen-error-notallowed">8.4.2.2.</a>&nbsp;
Not Allowed<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-clientsubmit">8.5.</a>&nbsp;
Client-Submitted Resource Identifier<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-clientsubmit-success">8.5.1.</a>&nbsp;
Success Case<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-clientsubmit-error">8.5.2.</a>&nbsp;
Error Cases<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-clientsubmit-error-badrequest">8.5.2.1.</a>&nbsp;
Bad Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-clientsubmit-error-conflict">8.5.2.2.</a>&nbsp;
Conflict<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-clientsubmit-retries">8.5.3.</a>&nbsp;
Retries<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-multi">8.6.</a>&nbsp;
Binding Multiple Resources<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-multi-support">8.6.1.</a>&nbsp;
Support<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-multi-bind">8.6.2.</a>&nbsp;
Binding an Additional Resource<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-multi-unbind">8.6.3.</a>&nbsp;
Unbinding a Resource<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-multi-unbind-success">8.6.3.1.</a>&nbsp;
Success Case<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-multi-unbind-error">8.6.3.2.</a>&nbsp;
Error Cases<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bind-multi-from">8.6.4.</a>&nbsp;
From Addresses<br />
<a href="#stanzas">9.</a>&nbsp;
XML Stanzas<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-attributes">9.1.</a>&nbsp;
Common Attributes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-attributes-to">9.1.1.</a>&nbsp;
to<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-attributes-to-c2s">9.1.1.1.</a>&nbsp;
Client-to-Server Streams<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-attributes-to-s2s">9.1.1.2.</a>&nbsp;
Server-to-Server Streams<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-attributes-from">9.1.2.</a>&nbsp;
from<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-attributes-from-c2s">9.1.2.1.</a>&nbsp;
Client-to-Server Streams<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-attributes-from-s2s">9.1.2.2.</a>&nbsp;
Server-to-Server Streams<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-attributes-id">9.1.3.</a>&nbsp;
id<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-attributes-type">9.1.4.</a>&nbsp;
type<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-attributes-lang">9.1.5.</a>&nbsp;
xml:lang<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-semantics">9.2.</a>&nbsp;
Basic Semantics<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-semantics-message">9.2.1.</a>&nbsp;
Message Semantics<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-semantics-presence">9.2.2.</a>&nbsp;
Presence Semantics<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-semantics-iq">9.2.3.</a>&nbsp;
IQ Semantics<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error">9.3.</a>&nbsp;
Stanza Errors<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-rules">9.3.1.</a>&nbsp;
Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-syntax">9.3.2.</a>&nbsp;
Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions">9.3.3.</a>&nbsp;
Defined Conditions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-bad-request">9.3.3.1.</a>&nbsp;
bad-request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-conflict">9.3.3.2.</a>&nbsp;
conflict<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-feature-not-implemented">9.3.3.3.</a>&nbsp;
feature-not-implemented<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-forbidden">9.3.3.4.</a>&nbsp;
forbidden<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-gone">9.3.3.5.</a>&nbsp;
gone<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-internal-server-error">9.3.3.6.</a>&nbsp;
internal-server-error<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-item-not-found">9.3.3.7.</a>&nbsp;
item-not-found<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-jid-malformed">9.3.3.8.</a>&nbsp;
jid-malformed<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-not-acceptable">9.3.3.9.</a>&nbsp;
not-acceptable<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-not-allowed">9.3.3.10.</a>&nbsp;
not-allowed<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-not-authorized">9.3.3.11.</a>&nbsp;
not-authorized<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-not-modified">9.3.3.12.</a>&nbsp;
not-modified<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-payment-required">9.3.3.13.</a>&nbsp;
payment-required<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-recipient-unavailable">9.3.3.14.</a>&nbsp;
recipient-unavailable<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-redirect">9.3.3.15.</a>&nbsp;
redirect<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-registration-required">9.3.3.16.</a>&nbsp;
registration-required<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-remote-server-not-found">9.3.3.17.</a>&nbsp;
remote-server-not-found<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-remote-server-timeout">9.3.3.18.</a>&nbsp;
remote-server-timeout<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-resource-constraint">9.3.3.19.</a>&nbsp;
resource-constraint<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-service-unavailable">9.3.3.20.</a>&nbsp;
service-unavailable<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-subscription-required">9.3.3.21.</a>&nbsp;
subscription-required<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-undefined-condition">9.3.3.22.</a>&nbsp;
undefined-condition<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-unexpected-request">9.3.3.23.</a>&nbsp;
unexpected-request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-conditions-unknown-sender">9.3.3.24.</a>&nbsp;
unknown-sender<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-error-app">9.3.4.</a>&nbsp;
Application-Specific Conditions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stanzas-extended">9.4.</a>&nbsp;
Extended Content<br />
<a href="#examples">10.</a>&nbsp;
Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#examples-c2s">10.1.</a>&nbsp;
Client-to-Server<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#examples-c2s-tls">10.1.1.</a>&nbsp;
TLS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#examples-c2s-sasl">10.1.2.</a>&nbsp;
SASL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#examples-c2s-bind">10.1.3.</a>&nbsp;
Resource Binding<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#examples-c2s-stanzas">10.1.4.</a>&nbsp;
Stanza Exchange<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#examples-c2s-close">10.1.5.</a>&nbsp;
Close<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#examples-s2s">10.2.</a>&nbsp;
Server-to-Server Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#examples-s2s-tls">10.2.1.</a>&nbsp;
TLS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#examples-s2s-sasl">10.2.2.</a>&nbsp;
SASL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#examples-s2s-stanzas">10.2.3.</a>&nbsp;
Stanza Exchange<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#examples-s2s-close">10.2.4.</a>&nbsp;
Close<br />
<a href="#rules">11.</a>&nbsp;
Server Rules for Processing XML Stanzas<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-noto">11.1.</a>&nbsp;
No 'to' Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-noto-overview">11.1.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-noto-message">11.1.2.</a>&nbsp;
Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-noto-presence">11.1.3.</a>&nbsp;
Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-noto-IQ">11.1.4.</a>&nbsp;
IQ<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-local">11.2.</a>&nbsp;
Local Domain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-local-domain">11.2.1.</a>&nbsp;
Mere Domain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-local-domainresource">11.2.2.</a>&nbsp;
Domain with Resource<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-local-node">11.2.3.</a>&nbsp;
Node at Domain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-local-node-nosuchuser">11.2.3.1.</a>&nbsp;
No Such User<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-local-node-barejid">11.2.3.2.</a>&nbsp;
Bare JID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-local-node-fulljid">11.2.3.3.</a>&nbsp;
Full JID<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-foreign">11.3.</a>&nbsp;
Foreign Domain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-foreign-existing">11.3.1.</a>&nbsp;
Existing Stream<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-foreign-nostream">11.3.2.</a>&nbsp;
No Existing Stream<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-foreign-error">11.3.3.</a>&nbsp;
Error Handling<br />
<a href="#xml">12.</a>&nbsp;
XML Usage<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xml-restrictions">12.1.</a>&nbsp;
Restrictions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xml-ns">12.2.</a>&nbsp;
XML Namespace Names and Prefixes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xml-ns-stream">12.2.1.</a>&nbsp;
Streams Namespace<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xml-ns-default">12.2.2.</a>&nbsp;
Default Namespace<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xml-ns-extended">12.2.3.</a>&nbsp;
Extended Namespaces<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xml-wellformed">12.3.</a>&nbsp;
Well-Formedness<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xml-validation">12.4.</a>&nbsp;
Validation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xml-declaration">12.5.</a>&nbsp;
Inclusion of Text Declaration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xml-encoding">12.6.</a>&nbsp;
Character Encoding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xml-whitespace">12.7.</a>&nbsp;
Whitespace<br />
<a href="#compliance">13.</a>&nbsp;
Compliance Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#compliance-server">13.1.</a>&nbsp;
Servers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#compliance-client">13.2.</a>&nbsp;
Clients<br />
<a href="#i18n">14.</a>&nbsp;
Internationalization Considerations<br />
<a href="#security">15.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-high">15.1.</a>&nbsp;
High Security<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-certificates">15.2.</a>&nbsp;
Certificates<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-certificates-generation">15.2.1.</a>&nbsp;
Certificate Generation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-certificates-generation-server">15.2.1.1.</a>&nbsp;
Server Certificates<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-certificates-generation-client">15.2.1.2.</a>&nbsp;
Client Certificates<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-certificates-generation-oid">15.2.1.3.</a>&nbsp;
ASN.1 Object Identifier<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-certificates-validation">15.2.2.</a>&nbsp;
Certificate Validation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-certificates-validation-s2s">15.2.2.1.</a>&nbsp;
Server-to-Server Streams<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-certificates-validation-c2s">15.2.2.2.</a>&nbsp;
Client-to-Server Streams<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-certificates-validation-extensions">15.2.2.3.</a>&nbsp;
Use of Certificates in XMPP Extensions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-client">15.3.</a>&nbsp;
Client-to-Server Communication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-server">15.4.</a>&nbsp;
Server-to-Server Communication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-layers">15.5.</a>&nbsp;
Order of Layers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-channel">15.6.</a>&nbsp;
Lack of SASL Channel Binding to TLS<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-mandatory">15.7.</a>&nbsp;
Mandatory-to-Implement Technologies<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-firewalls">15.8.</a>&nbsp;
Firewalls<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-base64">15.9.</a>&nbsp;
Use of base64 in SASL<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-stringprep">15.10.</a>&nbsp;
Stringprep Profiles<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-spoofing">15.11.</a>&nbsp;
Address Spoofing<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-forging">15.11.1.</a>&nbsp;
Address Forging<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-mimicking">15.11.2.</a>&nbsp;
Address Mimicking<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-dos">15.12.</a>&nbsp;
Denial of Service<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-leak">15.13.</a>&nbsp;
Presence Leaks<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security-harvesting">15.14.</a>&nbsp;
Directory Harvesting<br />
<a href="#iana">16.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-ns-tls">16.1.</a>&nbsp;
XML Namespace Name for TLS Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-ns-sasl">16.2.</a>&nbsp;
XML Namespace Name for SASL Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-ns-streams">16.3.</a>&nbsp;
XML Namespace Name for Stream Errors<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-ns-bind">16.4.</a>&nbsp;
XML Namespace Name for Resource Binding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-ns-stanzas">16.5.</a>&nbsp;
XML Namespace Name for Stanza Errors<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-nodeprep">16.6.</a>&nbsp;
Nodeprep Profile of Stringprep<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-resourceprep">16.7.</a>&nbsp;
Resourceprep Profile of Stringprep<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-gssapi">16.8.</a>&nbsp;
GSSAPI Service Name<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-ports">16.9.</a>&nbsp;
Port Numbers<br />
<a href="#rfc.references1">17.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">17.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">17.2.</a>&nbsp;
Informative References<br />
<a href="#nodeprep">Appendix&nbsp;A.</a>&nbsp;
Nodeprep<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#nodeprep-intro">A.1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#nodeprep-character">A.2.</a>&nbsp;
Character Repertoire<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#nodeprep-mapping">A.3.</a>&nbsp;
Mapping<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#nodeprep-normalization">A.4.</a>&nbsp;
Normalization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#nodeprep-prohibited">A.5.</a>&nbsp;
Prohibited Output<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#nodeprep-bidirectional">A.6.</a>&nbsp;
Bidirectional Characters<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#nodeprep-notes">A.7.</a>&nbsp;
Notes<br />
<a href="#resourceprep">Appendix&nbsp;B.</a>&nbsp;
Resourceprep<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#resourceprep-introduction">B.1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#resourceprep-character">B.2.</a>&nbsp;
Character Repertoire<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#resourceprep-mapping">B.3.</a>&nbsp;
Mapping<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#resourceprep-normalization">B.4.</a>&nbsp;
Normalization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#resourceprep-prohibited">B.5.</a>&nbsp;
Prohibited Output<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#resourceprep-bidirectional">B.6.</a>&nbsp;
Bidirectional Characters<br />
<a href="#schema">Appendix&nbsp;C.</a>&nbsp;
XML Schemas<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#schemas-streams">C.1.</a>&nbsp;
Streams Namespace<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#schemas-streamerror">C.2.</a>&nbsp;
Stream Error Namespace<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#schemas-starttls">C.3.</a>&nbsp;
STARTTLS Namespace<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#schemas-sasl">C.4.</a>&nbsp;
SASL Namespace<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#schemas-bind">C.5.</a>&nbsp;
Resource Binding Namespace<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#schemas-stanzaerror">C.6.</a>&nbsp;
Stanza Error Namespace<br />
<a href="#contact">Appendix&nbsp;D.</a>&nbsp;
Contact Addresses<br />
<a href="#provisioning">Appendix&nbsp;E.</a>&nbsp;
Account Provisioning<br />
<a href="#diffs">Appendix&nbsp;F.</a>&nbsp;
Differences From RFC 3920<br />
<a href="#copying">Appendix&nbsp;G.</a>&nbsp;
Copying Conditions<br />
<a href="#rfc.index">&#167;</a>&nbsp;
Index<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<a name="intro-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Overview</h3>

<p>The Extensible Messaging and Presence Protocol (XMPP) is an application profile of the Extensible Markup Language <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a> for streaming XML data in close to real time between any two (or more) network-aware entities.  XMPP is typically used to exchange messages, share presence information, and engage in structured request-response interactions.  The basic syntax and semantics of XMPP were developed originally within the Jabber open-source community, mainly in 1999.  In late 2002, the XMPP Working Group was chartered with developing an adaptation of the core Jabber protocol that would be suitable as an IETF instant messaging (IM) and presence technology.  As a result of work by the XMPP WG, <a class='info' href='#RFC3920'>[RFC3920]<span> (</span><span class='info'>Saint-Andre, P., Ed., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a> and <a class='info' href='#RFC3921'>[RFC3921]<span> (</span><span class='info'>Saint-Andre, P., Ed., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a> were  published in October 2004, representing the most complete definition of XMPP at that time.
</p>
<p>As a result of extensive implementation and deployment experience with XMPP since 2004, as well as more formal interoperability testing carried out under the auspices of the XMPP Standards Foundation (XSF), this document reflects consensus from the XMPP developer community regarding XMPP's core XML streaming technology.  In particular, this document incorporates the following backward-compatible changes from RFC 3920:
</p>
<p>
        </p>
<ul class="text">
<li>Corrections and errata
</li>
<li>Additional examples throughout
</li>
<li>Clarifications and more complete specification of matters that were underspecified
</li>
<li>Modifications to reflect updated technologies for which XMPP is a using protocol, e.g., Transport Layer Security (TLS) and the Simple Authentication and Security Layer (SASL)
</li>
<li>Definition of several additional stream, stanza, and SASL error conditions
</li>
<li>Removal of the deprecated DIGEST-MD5 SASL mechanism <a class='info' href='#DIGEST-MD5'>[DIGEST&#8209;MD5]<span> (</span><span class='info'>Leach, P. and C. Newman, &ldquo;Using Digest Authentication as a SASL Mechanism,&rdquo; May&nbsp;2000.</span><span>)</span></a> as a mandatory-to-implement technology
</li>
<li>Addition of TLS plus the SASL PLAIN mechanism <a class='info' href='#PLAIN'>[PLAIN]<span> (</span><span class='info'>Zeilenga, K., &ldquo;The PLAIN Simple Authentication and Security Layer (SASL) Mechanism,&rdquo; August&nbsp;2006.</span><span>)</span></a> as a mandatory-to-implement technology
</li>
<li>Definition of optional support for multiple resources over the same connection
</li>
<li>Transfer of historical documentation for the server dialback protocol from this specification to a separate specification
</li>
</ul><p>
      
</p>
<p>Therefore, this document defines the core features of XMPP 1.0 and obsoletes RFC 3920.
</p>
<p></p>
<blockquote class="text">
<p>Note: <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a> defines the XMPP features needed to provide the basic instant messaging and presence functionality that is described in <a class='info' href='#IMP-REQS'>[IMP&#8209;REQS]<span> (</span><span class='info'>Day, M., Aggarwal, S., and J. Vincent, &ldquo;Instant Messaging / Presence Protocol Requirements,&rdquo; February&nbsp;2000.</span><span>)</span></a>.
</p>
</blockquote>

<a name="intro-summary"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Functional Summary</h3>

<p>This non-normative section provides a developer-friendly, functional summary of XMPP; refer to the sections that follow for a normative definition of XMPP.
</p>
<p>The purpose of XMPP is to enable the exchange of relatively small pieces of structured data (called "XML stanzas") over a network between any two (or more) entities.  XMPP is implemented using a client-server architecture, wherein a client must connect to a server in order to gain access to the network and thus be allowed to exchange XML stanzas with other entities (which may be associated with other servers).  The process whereby a client connects to a server, exchanges XML stanzas, and ends the connection is:
</p>
<p>
        </p>
<ol class="text">
<li>Determine the hostname and port at which to connect
</li>
<li>Open a TCP connection
</li>
<li>Open an XML stream
</li>
<li>Complete TLS negotiation for channel encryption (recommended)
</li>
<li>Complete SASL negotiation for authentication
</li>
<li>Bind a resource to the stream
</li>
<li>Exchange an unbounded number of XML stanzas with other entities on the network
</li>
<li>Close the XML stream
</li>
<li>Close the TCP connection
</li>
</ol><p>
      
</p>
<p>Within XMPP, one server may optionally connect to another server to enable inter-domain or inter-server communication.  For this to happen, the two servers must negotiate a connection between themselves and then exchange XML stanzas; the process for doing so is:
</p>
<p>
        </p>
<ol class="text">
<li>Determine the hostname and port at which to connect
</li>
<li>Open a TCP connection
</li>
<li>Open an XML stream
</li>
<li>Complete TLS negotiation for channel encryption (recommended)
</li>
<li>Complete SASL negotiation for authentication *
</li>
<li>Exchange an unbounded number of XML stanzas both directly for the servers and indirectly on behalf of entities associated with each server (e.g., connected clients)
</li>
<li>Close the XML stream
</li>
<li>Close the TCP connection
</li>
</ol><p>
      
</p>
<p></p>
<blockquote class="text">
<p>* Note: Depending on local service policies, it is possible that a deployed server will use the older server dialback protocol to provide weak identity verification in cases where SASL negotiation would not result in strong authentication (e.g., because TLS negotiation was not mandated by the peer server, or because the certificate presented by the peer server during TLS negotiation is self-signed and thus provides only weak identity); for details, see <a class='info' href='#XEP-0220'>[XEP&#8209;0220]<span> (</span><span class='info'>Saint-Andre, P. and J. Miller, &ldquo;Server Dialback,&rdquo; June&nbsp;2008.</span><span>)</span></a>.
</p>
</blockquote>

<p>In the sections following discussion of XMPP architecture and XMPP addresses, this document specifies how clients connect to servers and specifies the basic semantics of XML stanzas.  However, this document does not define the "payloads" of the XML stanzas that might be exchanged once a connection is successfully established; instead, those payloads are defined by various XMPP extensions.  For example, <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a> defines extensions for basic instant messaging and presence functionality.  In addition, various specifications produced in the XSF's XEP series <a class='info' href='#XEP-0001'>[XEP&#8209;0001]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;XMPP Extension Protocols,&rdquo; December&nbsp;2006.</span><span>)</span></a> define extensions for a wide range of more advanced functionality.
</p>
<a name="intro-conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Conventions</h3>

<p>The following capitalized keywords are to be interpreted as described in <a class='info' href='#TERMS'>[TERMS]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".
</p>
<p>The term "whitespace" is used to refer to any character that matches production [3] content of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>.
</p>
<p>Following the "XML Notation" used in <a class='info' href='#IRI'>[IRI]<span> (</span><span class='info'>Duerst, M. and M. Suignard, &ldquo;Internationalized Resource Identifiers (IRIs),&rdquo; January&nbsp;2005.</span><span>)</span></a> to represent characters that cannot be rendered in ASCII-only documents, some examples in this document use the form "&amp;#x...." as a notational device to represent Unicode characters (e.g., the string "&amp;#x0159;" stands for the Unicode character LATIN SMALL LETTER R WITH CARON).
</p>
<p>In examples, lines have been wrapped for improved readability, "[...]" means elision, and the following prepended strings are used (these prepended strings are not to be sent over the wire):
</p>
<p>
        </p>
<ul class="text">
<li>C: = a client
</li>
<li>E: = any XMPP entity
</li>
<li>I: = an initiating entity
</li>
<li>P: = a peer server
</li>
<li>R: = a receiving entity
</li>
<li>S: = a server
</li>
<li>S1: = server1
</li>
<li>S2: = server2
</li>
</ul><p>
      
</p>
<a name="intro-ack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
Acknowledgements</h3>

<p>The editor of this document finds it impossible to appropriately acknowledge the feedback he has received publicly and privately regarding the core XMPP protocols.  However, thanks are due to the many developers who have provided bug reports, requests for clarification, and suggestions for improvement since the publication of RFC 3920.  The editor has endeavored to address all such feedback, but is solely responsible for any remaining errors and ambiguities.
</p>
<a name="intro-discuss"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.5"></a><h3>1.5.&nbsp;
Discussion Venue</h3>

<p>The document editor and the broader XMPP developer community welcome discussion and comments related to the topics presented in this document.  The preferred forum is the &lt;standards@xmpp.org&gt; mailing list, for which archives and subscription information are available at &lt;<a href='http://mail.jabber.org/mailman/listinfo/standards'>http://mail.jabber.org/mailman/listinfo/standards</a>&gt;.
</p>
<a name="arch"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Architecture</h3>

<a name="arch-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Overview</h3>

<p>XMPP assumes a client-server architecture, wherein a client utilizing XMPP accesses a server (normally over a <a class='info' href='#TCP'>[TCP]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> connection) and servers can also communicate with each other over TCP connections.
</p>
<p>A simplified architectural diagram for a typical deployment is shown here, where the entities have the following significance:
</p>
<p>
        </p>
<ul class="text">
<li>romeo@example.net -- an XMPP user.
</li>
<li>example.net -- an XMPP server.
</li>
<li>im.example.com -- an XMPP server.
</li>
<li>juliet@im.example.com -- an XMPP user.
</li>
</ul><p>
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  example.net ---------------- im.example.com
     |                                |
     |                                |
romeo@example.net           juliet@im.example.com

</pre></div>
<p></p>
<blockquote class="text">
<p>Note: Architectures that employ <a class='info' href='#streams'>XML streams<span> (</span><span class='info'>XML Streams</span><span>)</span></a> and <a class='info' href='#stanzas'>XML stanzas<span> (</span><span class='info'>XML Stanzas</span><span>)</span></a> but that establish peer-to-peer connections directly between clients using technologies based on <a class='info' href='#LINKLOCAL'>[LINKLOCAL]<span> (</span><span class='info'>Cheshire, S., Aboba, B., and E. Guttman, &ldquo;Dynamic Configuration of IPv4 Link-Local Addresses,&rdquo; May&nbsp;2005.</span><span>)</span></a> have been deployed, but such architectures are not XMPP and are best described as "XMPP-like"; for details, see <a class='info' href='#XEP-0174'>[XEP&#8209;0174]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Link-Local Messaging,&rdquo; June&nbsp;2007.</span><span>)</span></a>.  In addition, XML streams can be established end-to-end over any reliable transport, including extensions to XMPP itself; for details, see <a class='info' href='#XEP-0246'>[XEP&#8209;0246]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;End-to-End XML Streams,&rdquo; June&nbsp;2008.</span><span>)</span></a>.
</p>
</blockquote>

<a name="arch-server"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Server</h3>

<p>A SERVER is an entity whose primary responsibilities are to:
</p>
<p>
        </p>
<ul class="text">
<li>Manage <a class='info' href='#streams'>XML streams<span> (</span><span class='info'>XML Streams</span><span>)</span></a> with local clients and deliver <a class='info' href='#stanzas'>XML stanzas<span> (</span><span class='info'>XML Stanzas</span><span>)</span></a> to those clients over the negotiated XML streams.
</li>
<li>Subject to local service policies on server-to-server communication, manage <a class='info' href='#streams'>XML streams<span> (</span><span class='info'>XML Streams</span><span>)</span></a> with foreign servers and route <a class='info' href='#stanzas'>XML stanzas<span> (</span><span class='info'>XML Stanzas</span><span>)</span></a> to those servers over the negotiated XML streams.
</li>
</ul><p>
      
</p>
<p>Depending on the application, the secondary responsibilities of an XMPP server may include:
</p>
<p>
        </p>
<ul class="text">
<li>Storing XML data that is used by clients (e.g., contact lists for users of XMPP-based instant messaging and presence applications as defined in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a>); in this case, the relevant XML stanza is handled directly by the server itself on behalf of the client and is not routed to a foreign server or delivered to a local entity.
</li>
<li>Hosting local services that also use XMPP as the basis for communication but that provide additional functionality beyond that defined in this document or in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a>; examples include multi-user conferencing services as specified in <a class='info' href='#XEP-0045'>[XEP&#8209;0045]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Multi-User Chat,&rdquo; April&nbsp;2007.</span><span>)</span></a> and publish-subscribe services as specified in <a class='info' href='#XEP-0060'>[XEP&#8209;0060]<span> (</span><span class='info'>Millard, P., Saint-Andre, P., and R. Meijer, &ldquo;Publish-Subscribe,&rdquo; September&nbsp;2007.</span><span>)</span></a>.
</li>
</ul><p>
      
</p>
<a name="arch-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Client</h3>

<p>A CLIENT is an entity that establishes an XML stream with a server by authenticating using the credentials of a local account and that then completes <a class='info' href='#bind'>resource binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a> in order to enable delivery of XML stanzas via the server to the client.  A client then uses XMPP to communicate with its server, other clients, and any other accessible entities on a network.  Multiple clients may connect simultaneously to a server on behalf of a local account, where each client is differentiated by the resource identifier portion of an XMPP address (e.g., &lt;node@domain/home&gt; vs. &lt;node@domain/work&gt;), as defined under <a class='info' href='#addressing'>Section&nbsp;3<span> (</span><span class='info'>Addresses</span><span>)</span></a> and <a class='info' href='#bind'>Section&nbsp;8<span> (</span><span class='info'>Resource Binding</span><span>)</span></a>.  The RECOMMENDED port for TCP connections between a client and a server is 5222, as registered with the IANA (see <a class='info' href='#iana-ports'>Section&nbsp;16.9<span> (</span><span class='info'>Port Numbers</span><span>)</span></a>).
</p>
<a name="arch-network"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Network</h3>

<p>Because each server is identified by a network address and because server-to-server communication is a straightforward extension of the client-to-server protocol, in practice the system consists of a network of servers that inter-communicate.  Thus, for example, &lt;juliet@im.example.com&gt; is able to exchange messages, presence, and other information with &lt;romeo@example.net&gt;.  This pattern is familiar from messaging protocols (such as <a class='info' href='#SMTP'>[SMTP]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; April&nbsp;2001.</span><span>)</span></a>) that make use of network addressing standards.  Communication between any two servers is OPTIONAL.  The RECOMMENDED port for TCP connections between servers is 5269, as registered with the IANA (see <a class='info' href='#iana-ports'>Section&nbsp;16.9<span> (</span><span class='info'>Port Numbers</span><span>)</span></a>).
</p>
<a name="addressing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Addresses</h3>

<a name="addressing-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Overview</h3>

<p><a name='anchor3'></a>An ENTITY is anything that is network-addressable and that can communicate using XMPP.  <a name='anchor4'></a>For historical reasons, the native address of an XMPP entity is called a JABBER IDENTIFIER or JID.  A valid JID contains a set of ordered elements formed of an XMPP node identifier, domain identifier, and resource identifier.
</p>
<p>The syntax for a JID is defined as follows using the Augmented Backus-Naur Form as specified in <a class='info' href='#ABNF'>[ABNF]<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; October&nbsp;2005.</span><span>)</span></a>.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   jid             = [ node "@" ] domain [ "/" resource ]
   node            = 1*(nodepoint)
                     ; a "nodepoint" is a UTF-8 encoded Unicode code
                     ; point that satisfies the Nodeprep profile of
                     ; stringprep
   domain          = fqdn / address-literal / idnlabel
   fqdn            = (idnlabel 1*("." idnlabel))
                     ; an "idnlabel" is an internationalized label
                     ; as described in RFC 3490
   address-literal = IPv4address / IPv6address
                     ; the "IPv4address" and "IPv6address" rules are
                     ; defined in Appendix B of RFC 2373
   resource        = 1*(resourcepoint)
                     ; a "resourcepoint" is a UTF-8 encoded Unicode
                     ; code point that satisfies the Resourceprep
                     ; profile of stringprep
</pre></div>
<p></p>
<blockquote class="text">
<p>Note: The "IPv4address" and "IPv6address" rules are indeed provided in <a class='info' href='#RFC2373'>[RFC2373]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;IP Version 6 Addressing Architecture,&rdquo; July&nbsp;1998.</span><span>)</span></a> and were removed from <a class='info' href='#IPv6'>[IPv6]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;IP Version 6 Addressing Architecture,&rdquo; February&nbsp;2006.</span><span>)</span></a>, which superseded RFC 2373.
</p>
</blockquote>

<p>All JIDs are based on the foregoing structure.  One common use of this structure is to identify a messaging and presence account, the server that hosts the account, and a connected resource (e.g., a specific device) in the form of &lt;node@domain/resource&gt;.  However, node types other than clients are possible; for example, a specific chat room offered by a multi-user conference service (see <a class='info' href='#XEP-0045'>[XEP&#8209;0045]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Multi-User Chat,&rdquo; April&nbsp;2007.</span><span>)</span></a>) could be addressed as &lt;room@service&gt; (where "room" is the name of the chat room and "service" is the hostname of the multi-user conference service) and a specific occupant of such a room could be addressed as &lt;room@service/nick&gt; (where "nick" is the occupant's room nickname).  Many other JID types are possible (e.g., &lt;domain/resource&gt; could be a server-side script or service).
</p>
<p>Each allowable portion of a JID (node identifier, domain identifier, and resource identifier) MUST NOT be more than 1023 bytes in length, resulting in a maximum total size (including the '@' and '/' separators) of 3071 bytes.
</p>
<p></p>
<blockquote class="text">
<p>Note: While the format of a JID is consistent with <a class='info' href='#URI'>[URI]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>, an entity's address on an XMPP network MUST be represented as a JID (without a URI scheme) and not a <a class='info' href='#URI'>[URI]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> or <a class='info' href='#IRI'>[IRI]<span> (</span><span class='info'>Duerst, M. and M. Suignard, &ldquo;Internationalized Resource Identifiers (IRIs),&rdquo; January&nbsp;2005.</span><span>)</span></a> as specified in <a class='info' href='#XMPP-URI'>[XMPP&#8209;URI]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Internationalized Resource Identifiers (IRIs) and Uniform Resource Identifiers (URIs) for the Extensible Messaging and Presence Protocol (XMPP),&rdquo; February&nbsp;2008.</span><span>)</span></a>; the latter specification is provided only for identification and interaction outside the context of the XMPP wire protocol itself.
</p>
</blockquote>

<a name="addressing-domain"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Domain Identifier</h3>

<p><a name='anchor5'></a>The DOMAIN IDENTIFIER portion of a JID is that portion after the '@' character (if any) and before the '/' character (if any); it is the primary identifier and is the only REQUIRED element of a JID (a mere domain identifier is a valid JID).  Typically a domain identifier identifies the "home" server to which clients connect for XML routing and data management functionality.  However, it is not necessary for an XMPP domain identifier to identify an entity that provides core XMPP server functionality (e.g., a domain identifier can identity an entity such as a multi-user conference service, a publish-subscribe service, or a user directory).
</p>
<p></p>
<blockquote class="text">
<p>Note: A single server can service multiple domain identifiers, i.e., multiple local domains; this is typically referred to as virtual hosting.
</p>
</blockquote>

<p>The domain identifier for every server or service that will communicate over a network SHOULD be a fully qualified domain name (see <a class='info' href='#DNS'>[DNS]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a>); while the domain identifier MAY be either an Internet Protocol (IPv4 or IPv6) address or a text label that is resolvable on a local network (commonly called an "unqualified hostname"), it is possible that domain identifiers that are IP addresses will not be acceptable to other services for the sake of interdomain communication.  Furthermore, domain identifiers that are unqualified hostnames MUST NOT be used on public networks but MAY be used on private networks.
</p>
<p></p>
<blockquote class="text">
<p>Note: If the domain identifier includes a final character considered to be a label separator (dot) by <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> or <a class='info' href='#STD13'>[STD13]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a>, this character MUST be stripped from the domain identifier before the JID of which it is a part is used for the purpose of routing an XML stanza, comparing against another JID, or constructing an <a class='info' href='#XMPP-URI'>[XMPP&#8209;URI]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Internationalized Resource Identifiers (IRIs) and Uniform Resource Identifiers (URIs) for the Extensible Messaging and Presence Protocol (XMPP),&rdquo; February&nbsp;2008.</span><span>)</span></a>; in particular, the character MUST be stripped before any other canonicalization steps are taken, such as application of the <a class='info' href='#NAMEPREP'>[NAMEPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),&rdquo; March&nbsp;2003.</span><span>)</span></a> profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> or completion of the ToASCII operation as described in <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>.
</p>
</blockquote>

<p>A domain identifier MUST be an "internationalized domain name" as defined in <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>, that is, "a domain name in which every label is an internationalized label".  When preparing a text label (consisting of a sequence of Unicode code points) for representation as an internationalized label in the process of constructing an XMPP domain identifier or comparing two XMPP domain identifiers, an application MUST ensure that for each text label it is possible to apply without failing the ToASCII operation specified in <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> with the UseSTD3ASCIIRules flag set (thus forbidding ASCII code points other than letters, digits, and hyphens).  If the ToASCII operation can be applied without failing, then the label is an internationalized label.  An internationalized domain name (and therefore an XMPP domain identifier) is constructed from its constituent internationalized labels by following the rules specified in <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>.
</p>
<p></p>
<blockquote class="text">
<p>Note: The ToASCII operation includes application of the <a class='info' href='#NAMEPREP'>[NAMEPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),&rdquo; March&nbsp;2003.</span><span>)</span></a> profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> and encoding using the algorithm specified in <a class='info' href='#PUNYCODE'>[PUNYCODE]<span> (</span><span class='info'>Costello, A., &ldquo;Punycode: A Bootstring encoding of Unicode for Internationalized Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>; for details, see <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>.  Although the output of the ToASCII operation is not used in XMPP, it MUST be possible to apply that operation without failing.
</p>
</blockquote>

<a name="addressing-node"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Node Identifier</h3>

<p><a name='anchor6'></a>The NODE IDENTIFIER portion of a JID is an optional secondary identifier placed before the domain identifier and separated from the latter by the '@' character.  Typically a node identifier uniquely identifies the entity requesting and using network access provided by a server (i.e., a local account), although it can also represent other kinds of entities (e.g., a chat room associated with a multi-user conference service).  The entity represented by an XMPP node identifier is addressed within the context of a specific domain.
</p>
<p>A node identifier MUST be formatted such that the Nodeprep profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> can be applied without failing (see <a class='info' href='#nodeprep'>Appendix&nbsp;A<span> (</span><span class='info'>Nodeprep</span><span>)</span></a>).  Before comparing two node identifiers, an application MUST first ensure that the Nodeprep profile has been applied to each identifier (the profile need not be applied each time a comparison is made, as long as it has been applied before comparison).
</p>
<a name="addressing-resource"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Resource Identifier</h3>

<p><a name='anchor7'></a>The RESOURCE IDENTIFIER portion of a JID is an optional tertiary identifier placed after the domain identifier and separated from the latter by the '/' character.  A resource identifier can modify either a &lt;node@domain&gt; address or a mere &lt;domain&gt; address.  Typically a resource identifier uniquely identifies a specific connection (e.g., a device or location) or object (e.g., a participant in a multi-user conference room) belonging to the entity associated with an XMPP node identifier at a local domain.
</p>
<p><a name='anchor8'></a>When an XMPP address does not include a resource identifier (i.e., when it is of the form &lt;domain&gt; or &lt;node@domain&gt;), it is referred to as a BARE JID.  <a name='anchor9'></a>When an XMPP address includes a resource identifier (i.e., when it is of the form &lt;domain/resource&gt; or &lt;node@domain/resource&gt;), is referred to as a FULL JID.
</p>
<p>A resource identifier MUST be formatted such that the Resourceprep profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> can be applied without failing (see <a class='info' href='#resourceprep'>Appendix&nbsp;B<span> (</span><span class='info'>Resourceprep</span><span>)</span></a>).  Before comparing two resource identifiers, an application MUST first ensure that the Resourceprep profile has been applied to each identifier (the profile need not be applied each time a comparison is made, as long as it has been applied before comparison).
</p>
<p></p>
<blockquote class="text">
<p>Note: For historical reasons, the term "resource identifier" is used in XMPP to refer to the optional portion of an XMPP address that follows the domain identifier and the "/" separator character; this use of the term "resource identifier" is not to be confused with the meanings of "resource" and "identifier" provided in Section 1.1 of <a class='info' href='#URI'>[URI]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>.
</p>
</blockquote>

<p>XMPP entities SHOULD consider resource identifiers to be opaque strings and SHOULD NOT impute meaning to any given resource identifier.  In paticular, the use of the '/' character as a separator between the domain identifier and the resource identifier does not imply that resource identifiers are hierarchical in the say that, say, HTTP addresses are hierarchical; thus for example an XMPP address of the form &lt;node@domain/foo/bar&gt; does not identify a resource "bar" that exists below a resource "foo" in a hierarchy of resources associated with the entity "node@domain".
</p>
<a name="addressing-determination"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Determination of Addresses</h3>

<p>After the parties to an XML stream have completed the appropriate aspects of stream negotiation (typically <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a> and, if appropriate, <a class='info' href='#bind'>resource binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a>) the receiving entity for a stream MUST determine the initiating entity's JID.
</p>
<p>For server-to-server communication, the initiating server's JID MUST be the authorization identity (as defined by <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a>), either (1) as directly communicated by the initiating server during <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a> or (2) as derived by the receiving server from the authentication identity if no authorization identity was specified during <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>.  (For information about the determination of addresses in the absence of SASL negotiation when the older server dialback protocol is used, see <a class='info' href='#XEP-0220'>[XEP&#8209;0220]<span> (</span><span class='info'>Saint-Andre, P. and J. Miller, &ldquo;Server Dialback,&rdquo; June&nbsp;2008.</span><span>)</span></a>.)
</p>
<p>For client-to-server communication, the client's bare JID (&lt;node@domain&gt;) MUST be the authorization identity (as defined by <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a>), either (1) as directly communicated by the client during <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a> or (2) as derived by the server from the authentication identity if no authorization identity was specified during <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>.  The resource identifier portion of the full JID (&lt;node@domain/resource&gt;) MUST be the resource identifier negotiated by the client and server during <a class='info' href='#bind'>resource binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a>.
</p>
<p>The receiving entity MUST ensure that the resulting JID (including node identifier, domain identifier, resource identifier, and separator characters) conforms to the rules and formats defined earlier in this section; to meet this restriction, the receiving entity MAY replace the JID sent by the initiating entity with the canonicalized JID as determined by the receiving entity.
</p>
<a name="tcp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
TCP Binding</h3>

<a name="tcp-scope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Scope</h3>

<p>As XMPP is defined in this specification, an initiating entity (client or server) MUST open a Transmission Control Protocol <a class='info' href='#TCP'>[TCP]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> connection at the receiving entity (server) before it negotiates XML streams with the receiving entity.  The rules specified in the following sections apply to the TCP binding.
</p>
<a name="tcp-resolution"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Hostname Resolution</h3>

<p>Before opening the TCP connection, the initiating entity first MUST resolve the Domain Name System (DNS) hostname associated with the receiving entity and determine the appropriate TCP port for communication with the receiving entity.  The process is:
</p>
<p>
        </p>
<ol class="text">
<li>Attempt to resolve the hostname using a <a class='info' href='#DNS-SRV'>[DNS&#8209;SRV]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> Service of "xmpp-client" (for client-to-server connections) or "xmpp-server" (for server-to-server connections) and a Proto of "tcp", resulting in resource records such as "_xmpp-client._tcp.example.net." or "_xmpp-server._tcp.im.example.com.".  The result of the SRV lookup will be one or more combinations of a port and hostname; the initiating entity MUST resolve one of the hostnames in order to determine an IP address at which to connect.
</li>
<li>If the SRV lookup fails, the fallback SHOULD be a normal IPv4 or IPv6 address record resolution to determine the IP address, where the port used is the "xmpp-client" port of 5222 for client-to-server connections or the "xmpp-server" port 5269 for server-to-server connections.
</li>
<li>For client-to-server connections, the fallback MAY be a <a class='info' href='#DNS-TXT'>[DNS&#8209;TXT]<span> (</span><span class='info'>Rosenbaum, R., &ldquo;Using the Domain Name System To Store Arbitrary String Attributes,&rdquo; May&nbsp;1993.</span><span>)</span></a> lookup for alternative connection methods, for example as described in <a class='info' href='#XEP-0156'>[XEP&#8209;0156]<span> (</span><span class='info'>Hildebrand, J. and P. Saint-Andre, &ldquo;Discovering Alternative XMPP Connection Methods,&rdquo; June&nbsp;2007.</span><span>)</span></a>.
</li>
</ol><p>
      
</p>
<p></p>
<blockquote class="text">
<p>Note: Many XMPP servers are implemented in such a way that they can host additional services (beyond those defined in this specification and <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a>) at hostnames that are subdomains of the hostname of the main XMPP service (e.g., conference.example.net for a <a class='info' href='#XEP-0045'>[XEP&#8209;0045]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Multi-User Chat,&rdquo; April&nbsp;2007.</span><span>)</span></a> service associated with the example.net XMPP service) or subdomains of the first-level domain of the underlying host (e.g., muc.example.com for a <a class='info' href='#XEP-0045'>[XEP&#8209;0045]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Multi-User Chat,&rdquo; April&nbsp;2007.</span><span>)</span></a> service associated with the im.example.com XMPP service).  If an entity from a remote domain wishes to use such additional services, it would generate an appropriate XML stanza and the remote domain itself would attempt to resolve the service's hostname via an SRV lookup on resource records such as "_xmpp-server._tcp.conference.example.net." or "_xmpp-server._tcp.muc.example.com.".  Therefore if a service wishes to enable entities from remote domains to access these additional services, it needs to advertise the appropriate "_xmpp-server" SRV records in addition to the "_xmpp-server" record for its main XMPP service.
</p>
</blockquote>

<a name="tcp-c2s"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Client-to-Server Communication</h3>

<p>Because a client is subordinate to a server and therefore a client authenticates to the server but the server does not necessarily authenticate to the client, it is necessary to have only one TCP connection between client and server.  Thus the server MUST allow the client to share a single TCP connection for XML stanzas sent from client to server and from server to client (i.e., the inital stream and response stream as specified under <a class='info' href='#streams'>Section&nbsp;5<span> (</span><span class='info'>XML Streams</span><span>)</span></a>).
</p>
<a name="tcp-s2s"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Server-to-Server Communication</h3>

<p>Because two servers are peers and therefore each peer must authenticate with the other, the servers MUST use two TCP connections: one for XML stanzas sent from the first server to the second server and another (initiated by the second server) for XML stanzas from the second server to the first server.
</p>
<p>This rule applies only to <a class='info' href='#stanzas'>XML stanzas<span> (</span><span class='info'>XML Stanzas</span><span>)</span></a>.  Therefore during <a class='info' href='#tls'>STARTTLS negotiation<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a> and <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a> the servers would use one TCP connection, but after stream setup that TCP connection would be used only for the initiating server to send XML stanzas to the receiving server.  In order for the receiving server to send XML stanzas to the initiating server, the receiving server would need to reverse the roles and negotiate an XML stream from the receiving server to the initiating server.
</p>
<a name="streams-reconnect"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Reconnection</h3>

<p>It can happen that an XMPP server goes offline while servicing TCP connections from local clients and from other servers.  Because the number of such connections can be quite large, the reconnection algorithm employed by entities that seek to reconnect can have a significant impact on software and network performance.  The following guidelines are RECOMMENDED:
</p>
<p>
        </p>
<ul class="text">
<li>The time to live (TTL) specified in Domain Name System records MUST be honored, even if DNS results are cached; if the TTL has not expired, an entity that seeks to reconnect MUST NOT re-resolve the server hostname before reconnecting.
</li>
<li>The time that expires before an entity first seeks to reconnect MUST be randomized (e.g., so that all clients do not attempt to reconnect exactly 30 seconds after being disconnected).
</li>
<li>If the first reconnection attempt does not succeed, an entity MUST back off increasingly on the time between subsequent reconnection attempts.
</li>
</ul><p>
      
</p>
<p></p>
<blockquote class="text">
<p>Note: Because it is possible that a disconnected entity cannot determine the cause of disconnection (e.g., because there was no explicit stream error) or does not require a new stream for immediate communication (e.g., because the stream was idle and therefore timed out), it SHOULD NOT assume that is needs to reconnect immediately.
</p>
</blockquote>

<a name="tcp-other"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
Other Bindings</h3>

<p>There is no necessary coupling of an XML stream to a TCP connection.  For example, two entities could connect to each other via another transport, such as <a class='info' href='#HTTP'>[HTTP]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a> as specified in <a class='info' href='#XEP-0124'>[XEP&#8209;0124]<span> (</span><span class='info'>Paterson, I., Smith, D., and P. Saint-Andre, &ldquo;Bidirectional-streams Over Synchronous HTTP (BOSH),&rdquo; February&nbsp;2007.</span><span>)</span></a> and <a class='info' href='#XEP-0206'>[XEP&#8209;0206]<span> (</span><span class='info'>Paterson, I., &ldquo;XMPP Over BOSH,&rdquo; June&nbsp;2007.</span><span>)</span></a>.  Although this specification neither encourages nor discourages other bindings, it defines only a binding of XMPP to TCP.
</p>
<a name="streams"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
XML Streams</h3>

<a name="streams-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Overview</h3>

<p>Two fundamental concepts make possible the rapid, asynchronous exchange of relatively small payloads of structured information between presence-aware entities: XML streams and XML stanzas.  These terms are defined as follows.
</p>
<p>
        </p>
<blockquote class="text"><dl>
<dt>Definition of XML Stream:</dt>
<dd><a name='anchor10'></a>An XML STREAM is a container for the exchange of XML elements between any two entities over a network.  The start of an XML stream is denoted unambiguously by an opening STREAM HEADER (i.e., an XML &lt;stream&gt; tag with appropriate attributes and namespace declarations), while the end of the XML stream is denoted unambiguously by a closing XML &lt;/stream&gt; tag.  During the life of the stream, the entity that initiated it can send an unbounded number of XML elements over the stream, either elements used to negotiate the stream (e.g., to complete <a class='info' href='#tls'>TLS negotiation<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a> or <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>) or XML stanzas.  <a name='anchor11'></a>The INITIAL STREAM is negotiated from the initiating entity (typically a client or server) to the receiving entity (typically a server), and can be seen as corresponding to the initiating entity's "connection" or "session" with the receiving entity.  <a name='anchor12'></a>The initial stream enables unidirectional communication from the initiating entity to the receiving entity; in order to enable information exchange from the receiving entity to the initiating entity, the receiving entity MUST negotiate a stream in the opposite direction (the RESPONSE STREAM).
</dd>
<dt>Definition of XML Stanza:</dt>
<dd><a name='anchor13'></a>An XML STANZA is a discrete semantic unit of structured information that is sent from one entity to another over an XML stream, and is the basic unit of meaning in XMPP.  An XML stanza exists at the direct child level of the root &lt;stream/&gt; element; the start of any XML stanza is denoted unambiguously by the element start tag at depth=1 of the XML stream (e.g., &lt;presence&gt;), and the end of any XML stanza is denoted unambiguously by the corresponding close tag at depth=1 (e.g., &lt;/presence&gt;).  The only XML stanzas defined herein are the &lt;message/&gt;, &lt;presence/&gt;, and &lt;iq/&gt; elements qualified by the default namespace for the stream, as described under <a class='info' href='#stanzas'>Section&nbsp;9<span> (</span><span class='info'>XML Stanzas</span><span>)</span></a>; for example, an XML element sent for the purpose of <a class='info' href='#tls'>TLS negotiation<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a> or <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a> is not considered to be an XML stanza, nor is a stream error or a stream feature.  An XML stanza MAY contain child elements (with accompanying attributes, elements, and XML character data) as necessary in order to convey the desired information, which MAY be qualified by any XML namespace (see <a class='info' href='#XML-NAMES'>[XML&#8209;NAMES]<span> (</span><span class='info'>Bray, T., Hollander, D., and A. Layman, &ldquo;Namespaces in XML,&rdquo; January&nbsp;1999.</span><span>)</span></a> as well as <a class='info' href='#stanzas-extended'>Section&nbsp;9.4<span> (</span><span class='info'>Extended Content</span><span>)</span></a> herein).
</dd>
</dl></blockquote><p>
      
</p>
<p>Consider the example of a client's connection to a server.  In order to connect to a server, a client initiates an XML stream by sending a stream header to the server, optionally preceded by a text declaration specifying the XML version and the character encoding supported (see <a class='info' href='#xml-declaration'>Section&nbsp;12.5<span> (</span><span class='info'>Inclusion of Text Declaration</span><span>)</span></a> and <a class='info' href='#xml-encoding'>Section&nbsp;12.6<span> (</span><span class='info'>Character Encoding</span><span>)</span></a>).  Subject to local policies and service provisioning, the server then replies with a second XML stream back to the client, again optionally preceded by a text declaration.  Once the client has completed <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a> and <a class='info' href='#bind'>resource binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a>, the client can send an unbounded number of XML stanzas over the stream.  When the client desires to close the stream, it simply sends a closing &lt;/stream&gt; tag to the server  as further described under <a class='info' href='#streams-close'>Section&nbsp;5.7<span> (</span><span class='info'>Closing a Stream</span><span>)</span></a>.
</p>
<p>In essence, then, an XML stream acts as an envelope for all the XML stanzas sent during a connection.  We can represent this in a simplistic fashion as follows.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+--------------------+
| &lt;stream&gt;           |
|--------------------|
| &lt;presence&gt;         |
|   &lt;show/&gt;          |
| &lt;/presence&gt;        |
|--------------------|
| &lt;message to='foo'&gt; |
|   &lt;body/&gt;          |
| &lt;/message&gt;         |
|--------------------|
| &lt;iq to='bar'&gt;      |
|   &lt;query/&gt;         |
| &lt;/iq&gt;              |
|--------------------|
| &lt;iq from='bar'&gt;    |
|   &lt;query/&gt;         |
| &lt;/iq&gt;              |
|--------------------|
| [ ... ]            |
|--------------------|
| &lt;/stream&gt;          |
+--------------------+
</pre></div>
<p></p>
<blockquote class="text">
<p>Note: Those who are accustomed to thinking of XML in a document-centric manner may wish to view a client's connection to a server as consisting of two open-ended XML documents: one from the client to the server and one from the server to the client.  On this analogy, the two XML streams can be considered equivalent to two "documents" (matching production [1] content of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>) that are built up through the accumulation of XML stanzas, the root &lt;stream/&gt; element can be considered equivalent to the "document entity" for each "document" (as described in Section 4.8 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>), and the XML stanzas sent over the streams can be considered equivalent to "fragments" of the "documents" as described in <a class='info' href='#XML-FRAG'>[XML&#8209;FRAG]<span> (</span><span class='info'>Grosso, P. and D. Veillard, &ldquo;XML Fragment Interchange,&rdquo; February&nbsp;2001.</span><span>)</span></a>.  However, this perspective is merely an analogy; XMPP does not deal in documents and fragments but in streams and stanzas.
</p>
</blockquote>

<a name="streams-security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Stream Security</h3>

<p>For the purpose of stream security, both Transport Layer Security (see <a class='info' href='#tls'>Section&nbsp;6<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a>) and the Simple Authentication and Security Layer (see <a class='info' href='#sasl'>Section&nbsp;7<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>) are mandatory to implement.  Use of these technologies results in high security as described under <a class='info' href='#security-high'>Section&nbsp;15.1<span> (</span><span class='info'>High Security</span><span>)</span></a>.
</p>
<p>The initial stream and the response stream MUST be secured separately, although security in both directions MAY be established via mechanisms that provide mutual authentication.
</p>
<p>The initiating entity MUST NOT attempt to send <a class='info' href='#stanzas'>XML stanzas<span> (</span><span class='info'>XML Stanzas</span><span>)</span></a> over the stream before the stream has been authenticated.  However, if it does attempt to do so, the receiving entity MUST NOT accept such stanzas and MUST return a &lt;not-authorized/&gt; stream error.  This rule applies to XML stanzas only (i.e., &lt;message/&gt;, &lt;presence/&gt;, and &lt;iq/&gt; elements qualified by the default namespace) and not to XML elements used for stream negotiation (e.g., elements used to complete <a class='info' href='#tls'>TLS negotiation<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a> or <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>).
</p>
<a name="streams-attr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Stream Attributes</h3>

<p>The attributes of the root &lt;stream/&gt; element are defined in the following sections.
</p>
<p></p>
<blockquote class="text">
<p>Note: The attributes of the root &lt;stream/&gt; element are not prepended by a 'stream:' prefix because, in accordance with Section 5.3 of <a class='info' href='#XML-NAMES'>[XML&#8209;NAMES]<span> (</span><span class='info'>Bray, T., Hollander, D., and A. Layman, &ldquo;Namespaces in XML,&rdquo; January&nbsp;1999.</span><span>)</span></a>, the default namespace does not apply to attribute names.
</p>
</blockquote>

<a name="streams-attr-from"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.1"></a><h3>5.3.1.&nbsp;
from</h3>

<p>The 'from' attribute communicates an XMPP identity of the entity sending the stream element.
</p>
<p></p>
<blockquote class="text">
<p>Note: It is possible for an entity to have more than one XMPP identity (e.g., in the case of a server that provides virtual hosting).  It is also possible that an entity does not know the XMPP identity of the principal controlling the entity (e.g., because the XMPP identity is assigned at a level other than the XMPP application layer, as in the General Security Service Application Program Interface <a class='info' href='#GSS-API'>[GSS&#8209;API]<span> (</span><span class='info'>Linn, J., &ldquo;Generic Security Service Application Program Interface Version 2, Update 1,&rdquo; January&nbsp;2000.</span><span>)</span></a>).
</p>
</blockquote>

<p>For initial stream headers in client-to-server communication, if the client knows the XMPP identity of the principal controlling the client (typically an account name of the form &lt;node@domain&gt;), then it MUST include the 'from' attribute and MUST set its value to that identity.  If the client does not know the XMPP identity of the principal controlling the client, then it MUST NOT include the 'from' attribute.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>For initial stream headers in server-to-server communication, a server MUST include the 'from' attribute and MUST set its value to a hostname serviced by the initiating entity.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='example.net'
       to='im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:server'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>For response stream headers in both client-to-server and server-to-server communication, the receiving entity MUST include the 'from' attribute and MUST set its value to a hostname serviced by the receiving entity (which MAY be a hostname other than that specified in the 'to' attribute of the initial stream header).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>Whether or not the 'from' attribute is included, each entity MUST verify the identity of the other entity before exchanging XML stanzas with it (see <a class='info' href='#security-client'>Section&nbsp;15.3<span> (</span><span class='info'>Client-to-Server Communication</span><span>)</span></a> and <a class='info' href='#security-server'>Section&nbsp;15.4<span> (</span><span class='info'>Server-to-Server Communication</span><span>)</span></a>).
</p>
<p></p>
<blockquote class="text">
<p>Note: It is possible that implementations based on an earlier revision of this specification will not include the 'from' address on stream headers; an entity SHOULD be liberal in accepting such stream headers.
</p>
</blockquote>

<a name="streams-attr-to"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.2"></a><h3>5.3.2.&nbsp;
to</h3>

<p>For initial stream headers in both client-to-server and server-to-server communication, the initiating entity MUST include the 'to' attribute and MUST set its value to a hostname that the initiating entity knows or expects the receiving entity to service.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>For response stream headers in client-to-server communication, if the client included a 'from' attribute in the initial stream header then the server MUST include a 'to' attribute in the response stream header and MUST set its value to the bare JID specified in the 'from' attribute of the initial stream header.  If the client did not include a 'from' attribute in the initial stream header then the server MUST NOT include a 'to' attribute in the response stream header.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>For response stream headers in server-to-server communication, the receiving entity MUST include a 'to' attribute in the response stream header and MUST set its value to the hostname specified in the 'from' attribute of the initial stream header.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='g4qSvGvBxJ+xeAd7QKezOQJFFlw='
       to='example.net'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:server'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>Whether or not the 'to' attribute is included, each entity MUST verify the identity of the other entity before exchanging XML stanzas with it (see <a class='info' href='#security-client'>Section&nbsp;15.3<span> (</span><span class='info'>Client-to-Server Communication</span><span>)</span></a> and <a class='info' href='#security-server'>Section&nbsp;15.4<span> (</span><span class='info'>Server-to-Server Communication</span><span>)</span></a>).
</p>
<p></p>
<blockquote class="text">
<p>Note: It is possible that implementations based on an earlier revision of this specification will not include the 'from' address on stream headers; an entity SHOULD be liberal in accepting such stream headers.
</p>
</blockquote>

<a name="streams-attr-id"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.3"></a><h3>5.3.3.&nbsp;
id</h3>

<p><a name='anchor14'></a>The 'id' attribute communicates a unique identifier for the stream.  This identifier is called a STREAM ID.  The stream ID MUST be generated by the receiving entity when it sends a response stream header, MUST BE unique within the receiving application (normally a server), and MUST be both unpredictable and nonrepeating because it can be security-critical (see <a class='info' href='#RANDOM'>[RANDOM]<span> (</span><span class='info'>Eastlake, D., Schiller, J., and S. Crocker, &ldquo;Randomness Requirements for Security,&rdquo; June&nbsp;2005.</span><span>)</span></a> for recommendations regarding randomness for security purposes).
</p>
<p>For initial stream headers, the initiating entity MUST NOT include the 'id' attribute; however, if the 'id' attribute is included, the receiving entity MUST silently ignore it.
</p>
<p>For response stream headers, the receiving entity MUST include the 'id' attribute.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<a name="streams-attr-xmllang"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.4"></a><h3>5.3.4.&nbsp;
xml:lang</h3>

<p>The 'xml:lang' attribute communicates an entity's preferred or default language for any human-readable XML character data to be sent over the stream.  The syntax of this attribute is defined in Section 2.12 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>; in particular, the value of the 'xml:lang' attribute MUST conform to the NMTOKEN datatype (as defined in Section 2.3 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>) and MUST conform to the language identifier format defined in <a class='info' href='#LANGTAGS'>[LANGTAGS]<span> (</span><span class='info'>Phillips, A. and M. Davis, &ldquo;Tags for Identifying Languages,&rdquo; September&nbsp;2006.</span><span>)</span></a>.
</p>
<p>For initial stream headers, the initiating entity SHOULD include the 'xml:lang' attribute.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>For response stream headers, the receiving entity MUST include the 'xml:lang' attribute.  If the initiating entity included an 'xml:lang' attribute in its initial stream header and the receiving entity supports that language in the human-readable XML character data that it generates and sends to the initiating entity (e.g., in the &lt;text/&gt; element for stream and stanza errors), the value of the 'xml:lang' attribute MUST be identifier for the initiating entity's preferred language; if the receiving entity supports a language that closely matches the initiating entity's preferred language (e.g., "de" instead of "de-CH"), then the value of the 'xml:lang' attribute SHOULD be the identifier for the matching language but MAY be the identifier for the default language of the receiving entity; if the receiving entity does not support the initiating entity's preferred language or a closely matching language (or the initiating entity did not include the 'xml:lang' attribute in its initial stream header), then the value of the 'xml:lang' attribute MUST be the identifier for the default language of the receiving entity.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>If the initiating entity included the 'xml:lang' attribute in its initial stream header, the receiving entity SHOULD remember that value as the default xml:lang for all stanzas sent by the initiating entity.  As described under <a class='info' href='#stanzas-attributes-lang'>Section&nbsp;9.1.5<span> (</span><span class='info'>xml:lang</span><span>)</span></a>, the initiating entity MAY include the 'xml:lang' attribute in any XML stanzas it sends over the stream.  If the initiating entity does not include the 'xml:lang' attribute in any such stanza, the receiving entity SHOULD add the 'xml:lang' attribute to the stanza, whose value MUST be the identifier for the language preferred by the initiating entity (even if the receiving entity does not support that language for human-readable XML character data it generates and sends to the initiating entity, such as in stream or stanza errors).  If the initiating entity includes the 'xml:lang' attribute in any such stanza, the receiving entity MUST NOT modify or delete it.
</p>
<a name="streams-attr-version"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.5"></a><h3>5.3.5.&nbsp;
version</h3>

<p>The inclusion of the version attribute set to a value of at least "1.0" signals support for the stream-related protocols defined in this specification, including (<a class='info' href='#tls'>TLS negotiation<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a>, <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>, <a class='info' href='#streams-features'>Section&nbsp;5.5<span> (</span><span class='info'>Stream Features</span><span>)</span></a>, and <a class='info' href='#streams-error'>stream errors<span> (</span><span class='info'>Stream Errors</span><span>)</span></a>.
</p>
<p>The version of XMPP specified herein is "1.0"; in particular, XMPP 1.0 encapsulates the stream-related protocols as well as the basic semantics of the three defined XML stanza types (&lt;message/&gt;, &lt;presence/&gt;, and &lt;iq/&gt;).
</p>
<p>The numbering scheme for XMPP versions is "&lt;major&gt;.&lt;minor&gt;".  The major and minor numbers MUST be treated as separate integers and each number MAY be incremented higher than a single digit.  Thus, "XMPP 2.4" would be a lower version than "XMPP 2.13", which in turn would be lower than "XMPP 12.3".  Leading zeros (e.g., "XMPP 6.01") MUST be ignored by recipients and MUST NOT be sent.
</p>
<p>The major version number will be incremented only if the stream and stanza formats or required actions have changed so dramatically that an older version entity would not be able to interoperate with a newer version entity if it simply ignored the elements and attributes it did not understand and took the actions specified in the older specification.
</p>
<p>The minor version number will be incremented only if significant new capabilities have been added to the core protocol (e.g., a newly defined value of the 'type' attribute for message, presence, or IQ stanzas).  The minor version number MUST be ignored by an entity with a smaller minor version number, but MAY be used for informational purposes by the entity with the larger minor version number (e.g., the entity with the larger minor version number would simply note that its correspondent would not be able to understand that value of the 'type' attribute and therefore would not send it).
</p>
<p>The following rules apply to the generation and handling of the 'version' attribute within stream headers:
</p>
<p>
          </p>
<ol class="text">
<li>The initiating entity MUST set the value of the 'version' attribute in the initial stream header to the highest version number it supports (e.g., if the highest version number it supports is that defined in this specification, it MUST set the value to "1.0").
</li>
<li>The receiving entity MUST set the value of the 'version' attribute in the response stream header to either the value supplied by the initiating entity or the highest version number supported by the receiving entity, whichever is lower.  The receiving entity MUST perform a numeric comparison on the major and minor version numbers, not a string match on "&lt;major&gt;.&lt;minor&gt;".
</li>
<li>If the version number included in the response stream header is at least one major version lower than the version number included in the initial stream header and newer version entities cannot interoperate with older version entities as described, the initiating entity SHOULD generate an &lt;unsupported-version/&gt; stream error.
</li>
<li>If either entity receives a stream header with no 'version' attribute, the entity MUST consider the version supported by the other entity to be "0.9" and SHOULD NOT include a 'version' attribute in the response stream header.
</li>
</ol><p>
        
</p>
<a name="streams-attr-summary"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.6"></a><h3>5.3.6.&nbsp;
Summary of Stream Attributes</h3>

<p>The following table summarizes the attributes of the root &lt;stream/&gt; element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+----------+--------------------------+-------------------------+
|          | initiating to receiving  | receiving to initiating |
+----------+--------------------------+-------------------------+
| to       | JID of receiver          | JID of initiator        |
| from     | JID of initiator         | JID of receiver         |
| id       | silently ignored         | stream identifier       |
| xml:lang | default language         | default language        |
| version  | XMPP 1.0+ supported      | XMPP 1.0+ supported     |
+----------+--------------------------+-------------------------+
</pre></div>
<a name="streams-ns"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Namespace Declarations</h3>

<p>The stream element MUST possess both a streams namespace declaration and a default namespace declaration (as "namespace declaration" is defined in <a class='info' href='#XML-NAMES'>[XML&#8209;NAMES]<span> (</span><span class='info'>Bray, T., Hollander, D., and A. Layman, &ldquo;Namespaces in XML,&rdquo; January&nbsp;1999.</span><span>)</span></a>).  For detailed information regarding the streams namespace and default namespace, see <a class='info' href='#xml-ns'>Section&nbsp;12.2<span> (</span><span class='info'>XML Namespace Names and Prefixes</span><span>)</span></a>.
</p>
<a name="streams-features"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
Stream Features</h3>

<p>If the initiating entity includes the 'version' attribute set to a value of at least "1.0" in the initial stream header, after sending the response stream header the receiving entity MUST send a &lt;features/&gt; child element (prefixed by the streams namespace prefix) to the initiating entity in order to announce any stream-level features that can be negotiated or capabilities that otherwise need to be advertised.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
R: &lt;stream:features&gt;
     &lt;starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'&gt;
       &lt;required/&gt;
     &lt;/starttls&gt;
   &lt;/stream:features&gt;
</pre></div>
<p>Stream features are used mainly to advertise <a class='info' href='#tls'>TLS negotiation<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a>, <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>, and <a class='info' href='#bind'>resource binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a>; however, stream features also can be used to advertise features associated with various XMPP extensions.  If an entity does not understand or support a feature that has been advertised, it MUST silently ignore the associated feature advertisement.
</p>
<p>If it is necessary for a feature to be successfully negotiated before the initiating entity is allowed to proceed with the sending of XML stanzas or with further steps of the stream negotiation, the advertisement of that feature MUST include an empty &lt;required/&gt; child element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;stream:features&gt;
     &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;required/&gt;
     &lt;/bind&gt;
   &lt;/stream:features&gt;
</pre></div>
<p>If successful negotiation of a feature is discretionary, the advertisement of that feature MUST include an empty &lt;optional/&gt; child element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;stream:features&gt;
     &lt;session xmlns='urn:ietf:params:xml:ns:xmpp-session'&gt;
       &lt;optional/&gt;
     &lt;/session&gt;
   &lt;/stream:features&gt;
</pre></div>
<p></p>
<blockquote class="text">
<p>Note: Implementations based on an earlier revision of this specification do not include the &lt;optional/&gt; child element and they include the &lt;required/&gt; child element only in the case of the STARTTLS feature.  Entities MUST accept stream feature advertisements without the child elements, and SHOULD consider consider negotiation of such features to be discretionary.
</p>
</blockquote>

<p>If it is necessary for a feature to be successfully negotiated before the initiating entity is allowed to proceed with the sending a non-security-related feature or with further steps of the stream negotiation, the receiving entity SHOULD NOT advertise any other stream features until the mandatory feature has been successfully negotiated; however, if the mandatory feature is security-critical (e.g., STARTTLS or SASL) then the receiving entity MUST NOT advertise any other stream features until the security-critical feature has been successfully negotiated.
</p>
<p>The order of child elements contained in any given &lt;features/&gt; element is not significant.
</p>
<p>After completing negotiation of any stream feature (even stream features that do not require a stream restart), the receiving entity MUST send an updated list of stream features to the initiating entity.  However, if there are no features to be advertised then the receiving entity MUST send an empty &lt;features/&gt; element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

R: &lt;stream:features/&gt;
</pre></div>
<p>At any time after stream establishment, the receiving entity MAY send additional or modified stream feature advertisements (e.g., because a new feature has been enabled).
</p>
<a name="streams-restart"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.6"></a><h3>5.6.&nbsp;
Restarts During Stream Negotiation</h3>

<p>Certain stream features require the initiating entity to send a new initial stream header on successful negotiation of the feature (e.g., after successful negotiation of TLS or SASL).  Both parties MUST consider the previous stream to be replaced on successful feature negotiation but MUST NOT terminate the underlying TCP connection; instead, the parties MUST reuse the existing connection, which might be in a new state (e.g., encrypted as a result of TLS negotiation).  When the receiving entity receives the new initial stream header, it MUST generate a new stream ID (instead of re-using the old stream ID) before sending a new response stream header.
</p>
<a name="streams-close"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.7"></a><h3>5.7.&nbsp;
Closing a Stream</h3>

<p>An XML stream between two entities can be closed because a stream error has occurred or in some cases in the absence of an error.  Where feasible, it is preferable to close a stream only if a stream error has occurred.
</p>
<p>A stream is closed by sending a closing &lt;/stream&gt; tag over the TCP connection.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;/stream:stream&gt;
</pre></div>
<p>After an entity sends a closing stream tag, it MUST NOT send further data over that stream.
</p>
<a name="streams-close-witherror"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.7.1"></a><h3>5.7.1.&nbsp;
With Stream Error</h3>

<p>If a stream error has occurred, the entity that detects the error MUST close the stream as described under <a class='info' href='#streams-error-rules'>Section&nbsp;5.8.1<span> (</span><span class='info'>Rules</span><span>)</span></a>.
</p>
<a name="streams-close-withouterror"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.7.2"></a><h3>5.7.2.&nbsp;
Without Stream Error</h3>

<p>At any time after XML streams have been negotiated between two entities, either entity MAY close its stream to the other party in the absence of a stream error by sending a closing stream tag.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
P: &lt;/stream:stream&gt;
</pre></div>
<p>The entity that sends the closing stream tag SHOULD wait for the other party to also close its stream.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;/stream:stream&gt;
</pre></div>
<p>However, the entity that sends the first closing stream tag MAY consider both streams to be void if the other party does not send its closing stream tag within a reasonable amount of time (where the definition of "reasonable" is a matter of implementation or deployment).
</p>
<p>After the entity that sent the first closing stream tag receives a reciprocal closing stream tag from the other party (or if it considers the stream to be void after a reasonable amount of time), it MUST terminate the underlying TCP connection or connections.
</p>
<a name="streams-close-idle"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.7.3"></a><h3>5.7.3.&nbsp;
Handling of Idle Streams</h3>

<p>An XML stream can become idle, i.e., neither entity has sent XMPP traffic over the stream for some period of time.  A server MAY close an idle stream with a local client or remote server, preferably through use of the &lt;connection-timeout/&gt; stream error.  The idle timeout period is a matter of implementation and local service policy;  however, it is RECOMMENDED to be liberal in accepting idle streams, since experience has shown that doing so improves the reliability of communications over XMPP networks.  In particular, it is typically more efficient to maintain a stream between two servers than it is to aggressively timeout such a stream, especially with regard to synchronization of presence information as described in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a>; therefore it is RECOMMENDED to maintain such a stream since experience has shown that server-to-server streams are cyclical and typically need to be re-established every 24 to 48 hours if they are timed out.
</p>
<p>An XML stream can appear idle at the XMPP level because the undelying TCP connection has become idle (e.g., a client's network connection has been lost).  The typical method for detecting an idle TCP connection is to send a space character (U+0020) over the TCP connection between XML stanzas, which is allowed for XML streams as described under <a class='info' href='#xml-whitespace'>Section&nbsp;12.7<span> (</span><span class='info'>Whitespace</span><span>)</span></a>.  <a name='anchor15'></a>The sending of such a space character is called a WHITESPACE PING.  The time between such whitespace pings is a matter of implementation and local service policy; however, it is RECOMMENDED that these pings be sent not more than once every 60 seconds.
</p>
<a name="streams-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8"></a><h3>5.8.&nbsp;
Stream Errors</h3>

<p>The root stream element MAY contain an &lt;error/&gt; child element that is prefixed by the streams namespace prefix.  The error child shall be sent by a compliant entity if it perceives that a stream-level error has occurred.
</p>
<a name="streams-error-rules"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.1"></a><h3>5.8.1.&nbsp;
Rules</h3>

<p>The following rules apply to stream-level errors.
</p>
<a name="streams-error-rules-unrecoverable"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.1.1"></a><h3>5.8.1.1.&nbsp;
Stream Errors Are Unrecoverable</h3>

<p>Stream-level errors are unrecoverable.  Therefore, if an error occurs at the level of the stream, the entity that detects the error MUST send a &lt;error/&gt; element with an appropriate child element that specifies the error condition and at the same time send a closing &lt;/stream&gt; tag.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;message&gt;&lt;body&gt;&lt;/message&gt;

S: &lt;stream:error&gt;
     &lt;xml-not-well-formed
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<p>The entity that generates the stream error then SHOULD immediately terminate the underlying TCP connection, although it MAY wait until after it receives a closing &lt;/stream&gt; tag from the entity to which it sent the stream error.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-rules-setup"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.1.2"></a><h3>5.8.1.2.&nbsp;
Stream Errors Can Occur During Setup</h3>

<p>If the error is triggered by the initial stream header, the receiving entity MUST still send the opening &lt;stream&gt; tag, include the &lt;error/&gt; element as a child of the stream element, and send the closing &lt;/stream&gt; tag (preferably all at the same time).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://wrong.namespace.example.org/'&gt;

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'
   &lt;stream:error&gt;
     &lt;invalid-namespace
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-rules-host"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.1.3"></a><h3>5.8.1.3.&nbsp;
Stream Errors When the Host is Unspecified or Unknown</h3>

<p>If the initiating entity provides no 'to' attribute or provides an unknown host in the 'to' attribute and the error occurs during stream setup, the receiving entity MUST provide an authoritative hostname in the 'from' attribute of the stream header sent before termination.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='unknown.host.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
   &lt;stream:error&gt;
     &lt;host-unknown
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.2"></a><h3>5.8.2.&nbsp;
Syntax</h3>

<p>The syntax for stream errors is as follows, where "defined-condition" is a placeholder for one of the conditions defined under <a class='info' href='#streams-error-conditions'>Section&nbsp;5.8.3<span> (</span><span class='info'>Defined Stream Error Conditions</span><span>)</span></a>.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:error&gt;
  &lt;defined-condition xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
  [&lt;text xmlns='urn:ietf:params:xml:ns:xmpp-streams'
        xml:lang='langcode'&gt;
    [ ... descriptive text ... ]
  &lt;/text&gt;]
  [application-specific condition element]
&lt;/stream:error&gt;
</pre></div>
<p>The &lt;error/&gt; element:
</p>
<p></p>
<ul class="text">
<li>MUST contain a child element corresponding to one of the <a class='info' href='#streams-error-conditions'>defined stream error conditions<span> (</span><span class='info'>Defined Stream Error Conditions</span><span>)</span></a>; this element MUST be qualified by the 'urn:ietf:params:xml:ns:xmpp-streams' namespace.
</li>
<li>MAY contain a &lt;text/&gt; child element containing XML character data that describes the error in more detail; this element MUST be qualified by the 'urn:ietf:params:xml:ns:xmpp-streams' namespace and SHOULD possess an 'xml:lang' attribute specifying the natural language of the XML character data.
</li>
<li>MAY contain a child element for an application-specific error condition; this element MUST be qualified by an application-defined namespace, and its structure is defined by that namespace (see <a class='info' href='#streams-error-app'>Section&nbsp;5.8.4<span> (</span><span class='info'>Application-Specific Conditions</span><span>)</span></a>).
</li>
</ul>

<p>The &lt;text/&gt; element is OPTIONAL.  If included, it MUST be used only to provide descriptive or diagnostic information that supplements the meaning of a defined condition or application-specific condition.  It MUST NOT be interpreted programmatically by an application.  It MUST NOT be used as the error message presented to a human user, but MAY be shown in addition to the error message associated with the defined condition element (and, optionally, the application-specific condition element).
</p>
<a name="streams-error-conditions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3"></a><h3>5.8.3.&nbsp;
Defined Stream Error Conditions</h3>

<p>The following stream-level error conditions are defined.
</p>
<a name="streams-error-conditions-bad-format"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.1"></a><h3>5.8.3.1.&nbsp;
bad-format</h3>

<p>The entity has sent XML that cannot be processed.
</p>
<p>(In the following example, the client sends an XMPP message that is not well-formed XML.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;message&gt;
     &lt;body&gt;No closing body tag!
   &lt;/message&gt;

S: &lt;stream:error&gt;
     &lt;bad-format
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<p>This error MAY be used instead of the more specific XML-related errors, such as &lt;bad-namespace-prefix/&gt;, &lt;invalid-xml/&gt;, &lt;restricted-xml/&gt;, &lt;unsupported-encoding/&gt;, and &lt;xml-not-well-formed/&gt;.  However, the more specific errors are RECOMMENDED.
</p>
<a name="streams-error-conditions-bad-namespace-prefix"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.2"></a><h3>5.8.3.2.&nbsp;
bad-namespace-prefix</h3>

<p>The entity has sent a namespace prefix that is unsupported, or has sent no namespace prefix on an element that requires such a prefix (see <a class='info' href='#xml-ns'>Section&nbsp;12.2<span> (</span><span class='info'>XML Namespace Names and Prefixes</span><span>)</span></a>).
</p>
<p>(In the following example, the client specifies a namespace prefix of "foobar" for the XML streams namespace.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='1.0'
       xmlns='jabber:client'
       xmlns:foobar='http://etherx.jabber.org/streams'&gt;

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
   &lt;stream:error&gt;
     &lt;bad-namespace-prefix
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-conflict"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.3"></a><h3>5.8.3.3.&nbsp;
conflict</h3>

<p>The server is either (1) closing the existing stream for this entity because a new stream has been initiated that conflicts with the existing stream, or (2) is refusing a new stream for this entity because allowing the new stream would conflict with an existing stream (e.g., because the server allows only a certain number of connections from the same IP address).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='1.0'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
   &lt;stream:error&gt;
     &lt;conflict
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-connection-timeout"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.4"></a><h3>5.8.3.4.&nbsp;
connection-timeout</h3>

<p>The entity has not generated any traffic over the stream for some period of time (configurable according to a local service policy) and therefore the connection is being dropped.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
P: &lt;stream:error&gt;
     &lt;connection-timeout
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-host-gone"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.5"></a><h3>5.8.3.5.&nbsp;
host-gone</h3>

<p>The value of the 'to' attribute provided in the initial stream header corresponds to a hostname that is no longer serviced by the receiving entity.
</p>
<p>(In the following example, the peer specifies a 'to' address of "foo.im.example.com" when connecting to the "im.example.com" server, but the server no longer hosts a service at that address.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
P: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='example.net'
       to='foo.im.example.com'
       version='1.0'
       xmlns='jabber:server'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='g4qSvGvBxJ+xeAd7QKezOQJFFlw='
       to='example.net'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:server'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
   &lt;stream:error&gt;
     &lt;host-gone
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-host-unknown"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.6"></a><h3>5.8.3.6.&nbsp;
host-unknown</h3>

<p>The value of the 'to' attribute provided in the initial stream header does not correspond to a hostname that is serviced by the receiving entity.
</p>
<p>(In the following example, the peer specifies a 'to' address of "example.org" when connecting to the "im.example.com" server, but the server knows nothing of that address.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
P: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='example.net'
       to='example.org'
       version='1.0'
       xmlns='jabber:server'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='g4qSvGvBxJ+xeAd7QKezOQJFFlw='
       to='example.net'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:server'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
   &lt;stream:error&gt;
     &lt;host-unknown
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-improper-addressing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.7"></a><h3>5.8.3.7.&nbsp;
improper-addressing</h3>

<p>A stanza sent between two servers lacks a 'to' or 'from' attribute, the 'from' or 'to' attribute has no value, or the value is not a valid XMPP address.
</p>
<p>(In the following example, the peer sends a stanza without a 'to' address.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
P: &lt;message from='juliet@im.example.com'&gt;
     &lt;body&gt;Wherefore art thou?&lt;/body&gt;
   &lt;/message&gt;

S: &lt;stream:error&gt;
     &lt;improper-addressing
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-internal-server-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.8"></a><h3>5.8.3.8.&nbsp;
internal-server-error</h3>

<p>The server has experienced a misconfiguration or an otherwise-undefined internal error that prevents it from servicing the stream.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;stream:error&gt;
     &lt;internal-server-error
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-invalid-from"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.9"></a><h3>5.8.3.9.&nbsp;
invalid-from</h3>

<p>The JID or hostname provided in a 'from' address is not a valid JID or does not match an authorized JID or validated domain as negotiated between servers via SASL or server dialback, or as negotiated between a client and a server via authentication and resource binding.
</p>
<p>(In the following example, a peer that has authenticated only as "example.net" attempts to send a stanza from an address at "example.org".)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
P: &lt;message from='romeo@example.org' to='juliet@im.example.com'&gt;
     &lt;body&gt;Neither, fair saint, if either thee dislike.&lt;/body&gt;
   &lt;/message&gt;

S: &lt;stream:error&gt;
     &lt;invalid-from
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-invalid-id"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.10"></a><h3>5.8.3.10.&nbsp;
invalid-id</h3>

<p>The stream ID or server dialback ID is invalid or does not match an ID previously provided.
</p>
<p>(In the following example, the server dialback ID is invalid; see <a class='info' href='#XEP-0220'>[XEP&#8209;0220]<span> (</span><span class='info'>Saint-Andre, P. and J. Miller, &ldquo;Server Dialback,&rdquo; June&nbsp;2008.</span><span>)</span></a>.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
P: &lt;db:verify
       from='example.net'
       to='im.example.com'
       id='unknown-id'
       type='invalid'/&gt;

S: &lt;stream:error&gt;
     &lt;invalid-id
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-invalid-namespace"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.11"></a><h3>5.8.3.11.&nbsp;
invalid-namespace</h3>

<p>The streams namespace name is something other than "http://etherx.jabber.org/streams" (see <a class='info' href='#xml-ns'>Section&nbsp;12.2<span> (</span><span class='info'>XML Namespace Names and Prefixes</span><span>)</span></a>) or the default namespace is not supported (e.g., something other than "jabber:client" or "jabber:server").
</p>
<p>(In the following example, the client specifies a streams namespace of 'http://wrong.namespace.example.org/'.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='1.0'
       xmlns='jabber:client'
       xmlns:stream='http://wrong.namespace.example.org/'&gt;

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
   &lt;stream:error&gt;
     &lt;invalid-namespace
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-invalid-xml"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.12"></a><h3>5.8.3.12.&nbsp;
invalid-xml</h3>

<p>The entity has sent invalid XML over the stream to a server that performs validation (see <a class='info' href='#xml-validation'>Section&nbsp;12.4<span> (</span><span class='info'>Validation</span><span>)</span></a>).
</p>
<p>(In the following example, the peer attempts to send an IQ stanza of type "subscribe" but the XML schema defines no such value for the 'type' attribute.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
P: &lt;iq from='example.net'
       id='some-id'
       to='im.example.com'
       type='subscribe'&gt;
     &lt;ping xmlns='urn:xmpp:ping'/&gt;
   &lt;/iq&gt;

S: &lt;stream:error&gt;
     &lt;invalid-xml
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-not-authorized"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.13"></a><h3>5.8.3.13.&nbsp;
not-authorized</h3>

<p>The entity has attempted to send XML stanzas before the stream has been authenticated, or otherwise is not authorized to perform an action related to stream negotiation; the receiving entity MUST NOT process the offending stanza before sending the stream error.
</p>
<p>(In the following example, the client attempts to send XML stanzas before authenticating with the server.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='1.0'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'

C: &lt;message to='romeo@example.net'&gt;
     &lt;body&gt;Wherefore art thou?&lt;/body&gt;
   &lt;/message&gt;

S: &lt;stream:error&gt;
     &lt;not-authorized
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-policy-violation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.14"></a><h3>5.8.3.14.&nbsp;
policy-violation</h3>

<p>The entity has violated some local service policy (e.g., the stanza exceeds a configured size limit); the server MAY choose to specify the policy in the &lt;text/&gt; element or in an application-specific condition element.
</p>
<p>(In the following example, the client sends an XMPP message that is too large according to the server's local service policy.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;message to='juliet@im.example.com' id='foo'&gt;
     &lt;body&gt;[ ... the-emacs-manual ... ]&lt;/body&gt;
   &lt;/message&gt;

S: &lt;stream:error&gt;
     &lt;policy-violation
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;

S: &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-remote-connection-failed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.15"></a><h3>5.8.3.15.&nbsp;
remote-connection-failed</h3>

<p>The server is unable to properly connect to a remote entity that is required for authentication or authorization, such as a remote authentication database or (in server dialback) the authoritative server.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='1.0'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
   &lt;stream:error&gt;
     &lt;remote-connection-failed
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-resource-constraint"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.16"></a><h3>5.8.3.16.&nbsp;
resource-constraint</h3>

<p>The server lacks the system resources necessary to service the stream.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='1.0'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
   &lt;stream:error&gt;
     &lt;resource-constraint
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-restricted-xml"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.17"></a><h3>5.8.3.17.&nbsp;
restricted-xml</h3>

<p>The entity has attempted to send restricted XML features such as a comment, processing instruction, DTD subset, or XML entity reference (see <a class='info' href='#xml-restrictions'>Section&nbsp;12.1<span> (</span><span class='info'>Restrictions</span><span>)</span></a>).
</p>
<p>(In the following example, the client sends an XMPP message containing an XML comment.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;message to='juliet@im.example.com'&gt;
     &lt;!--&lt;subject/&gt;--&gt;
     &lt;body&gt;This message has no subject.&lt;/body&gt;
   &lt;/message&gt;

S: &lt;stream:error&gt;
     &lt;restricted-xml
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-see-other-host"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.18"></a><h3>5.8.3.18.&nbsp;
see-other-host</h3>

<p>The server will not provide service to the initiating entity but is redirecting traffic to another host; the XML character data of the &lt;see-other-host/&gt; element returned by the server SHOULD specify the alternate hostname or IP address at which to connect, which SHOULD be a valid domain identifier but may also include a port number; if no port is specified, the initiating entity SHOULD perform a <a class='info' href='#DNS-SRV'>[DNS&#8209;SRV]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> lookup on the provided domain identifier but MAY assume that it can connect to that domain identifier at the standard XMPP ports (i.e., 5222 for client-to-server connections and 5269 for server-to-server connections).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='1.0'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;
   &lt;stream:error&gt;
     &lt;see-other-host
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'&gt;
       im.example.com:9090
     &lt;/see-other-host&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-system-shutdown"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.19"></a><h3>5.8.3.19.&nbsp;
system-shutdown</h3>

<p>The server is being shut down and all active streams are being closed.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;stream:error&gt;
     &lt;system-shutdown
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-undefined-condition"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.20"></a><h3>5.8.3.20.&nbsp;
undefined-condition</h3>

<p>The error condition is not one of those defined by the other conditions in this list; this error condition SHOULD be used only in conjunction with an application-specific condition.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;stream:error&gt;
     &lt;undefined-condition
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
     &lt;app-error xmlns='http://example.com/ns'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-unsupported-encoding"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.21"></a><h3>5.8.3.21.&nbsp;
unsupported-encoding</h3>

<p>The initiating entity has encoded the stream in an encoding that is not supported by the server (see <a class='info' href='#xml-encoding'>Section&nbsp;12.6<span> (</span><span class='info'>Character Encoding</span><span>)</span></a>) or has otherwise improperly encoded the stream (e.g., by violating the rules of the UTF-8 encoding).
</p>
<p>(In the following example, the client attempts to encode data using UTF-16 instead of UTF-8.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0' encoding='UTF-16'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='1.0'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'
   &lt;stream:error&gt;
     &lt;unsupported-encoding
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-unsupported-stanza-type"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.22"></a><h3>5.8.3.22.&nbsp;
unsupported-stanza-type</h3>

<p>The initiating entity has sent a first-level child of the stream that is not supported by the server or consistent with the default namespace.
</p>
<p>(In the following example, the client attempts to send an XML stanza of &lt;pubsub/&gt; when the default namespace is "jabber:client".)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;pubsub&gt;
     &lt;publish node='princely_musings'&gt;
       &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
         &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
           &lt;title&gt;Soliloquy&lt;/title&gt;
           &lt;summary&gt;
To be, or not to be: that is the question:
Whether 'tis nobler in the mind to suffer
The slings and arrows of outrageous fortune,
Or to take arms against a sea of troubles,
And by opposing end them?
           &lt;/summary&gt;
           &lt;link rel='alternate' type='text/html'
                 href='http://denmark.lit/2003/12/13/atom03'/&gt;
           &lt;id&gt;tag:denmark.lit,2003:entry-32397&lt;/id&gt;
           &lt;published&gt;2003-12-13T18:30:02Z&lt;/published&gt;
           &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
         &lt;/entry&gt;
       &lt;/item&gt;
     &lt;/publish&gt;
   &lt;/pubsub&gt;

S: &lt;stream:error&gt;
     &lt;unsupported-stanza-type
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-unsupported-version"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.23"></a><h3>5.8.3.23.&nbsp;
unsupported-version</h3>

<p>The value of the 'version' attribute provided by the initiating entity in the stream header specifies a version of XMPP that is not supported by the server; the server MAY specify the version(s) it supports in the &lt;text/&gt; element.
</p>
<p>(In the following example, the client specifies an XMPP version of "11.0" but the server supports only version "1.0" and "1.1".)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='11.0'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'
   &lt;stream:error&gt;
     &lt;unsupported-version
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
     &lt;text xmlns='urn:ietf:params:xml:ns:xmpp-streams'&gt;
       1.0, 1.1
     &lt;/text&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-conditions-xml-not-well-formed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3.24"></a><h3>5.8.3.24.&nbsp;
xml-not-well-formed</h3>

<p>The initiating entity has sent XML that violates the well-formedness rules of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a> or <a class='info' href='#XML-NAMES'>[XML&#8209;NAMES]<span> (</span><span class='info'>Bray, T., Hollander, D., and A. Layman, &ldquo;Namespaces in XML,&rdquo; January&nbsp;1999.</span><span>)</span></a>.
</p>
<p>(In the following example, the client sends an XMPP message that is not well-formed XML.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;message&gt;
     &lt;body&gt;No closing body tag!
   &lt;/message&gt;

S: &lt;stream:error&gt;
     &lt;xml-not-well-formed
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-error-app"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.4"></a><h3>5.8.4.&nbsp;
Application-Specific Conditions</h3>

<p>As noted, an application MAY provide application-specific stream error information by including a properly-namespaced child in the error element.  The application-specific element SHOULD supplement or further qualify a defined element.  Thus the &lt;error/&gt; element will contain two or three child elements.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;message&gt;
     &lt;body&gt;
       My keyboard layout is:

       QWERTYUIOP{}|
       ASDFGHJKL:"
       ZXCVBNM&lt;&gt;?
     &lt;/body&gt;
   &lt;/message&gt;

S: &lt;stream:error&gt;
     &lt;xml-not-well-formed
         xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
     &lt;text xml:lang='en' xmlns='urn:ietf:params:xml:ns:xmpp-streams'&gt;
       Some special application diagnostic information!
     &lt;/text&gt;
     &lt;escape-your-data xmlns='http://example.com/ns'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;
</pre></div>
<a name="streams-example"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9"></a><h3>5.9.&nbsp;
Simplified Stream Examples</h3>

<p>This section contains two simplified examples of a stream-based connection between a client and a server; these examples are included for the purpose of illustrating the concepts introduced thus far.
</p>
<p>A basic connection:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

[ ... channel encryption ... ]

[ ... authentication ... ]

[ ... resource binding ... ]

C:   &lt;message from='juliet@im.example.com/balcony'
              to='romeo@example.net'
              xml:lang='en'&gt;
       &lt;body&gt;Art thou not Romeo, and a Montague?&lt;/body&gt;
     &lt;/message&gt;

S:   &lt;message from='romeo@example.net/orchard'
              to='juliet@im.example.com/balcony'
              xml:lang='en'&gt;
       &lt;body&gt;Neither, fair saint, if either thee dislike.&lt;/body&gt;
     &lt;/message&gt;

C: &lt;/stream:stream&gt;

S: &lt;/stream:stream&gt;
</pre></div>
<p>A connection gone bad:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='juliet@im.example.com'
       to='im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='im.example.com'
       id='++TR84Sm6A3hnt3Q065SnAbbk3Y='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

[ ... channel encryption ... ]

[ ... authentication ... ]

[ ... resource binding ... ]


C:   &lt;message from='juliet@im.example.com/balcony'
              to='romeo@example.net'
              xml:lang='en'&gt;
       &lt;body&gt;No closing body tag!
     &lt;/message&gt;

S: &lt;stream:error&gt;
    &lt;xml-not-well-formed
        xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
   &lt;/stream:stream&gt;

</pre></div>
<p>More detailed examples are provided under <a class='info' href='#examples'>Section&nbsp;10<span> (</span><span class='info'>Examples</span><span>)</span></a>.
</p>
<a name="tls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
STARTTLS Negotiation</h3>

<a name="tls-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Overview</h3>

<p>XMPP includes a method for securing the stream from tampering and eavesdropping.  This channel encryption method makes use of the Transport Layer Security <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.1,&rdquo; April&nbsp;2006.</span><span>)</span></a> protocol, specifically a "STARTTLS" extension that is modelled after similar extensions for the <a class='info' href='#IMAP'>[IMAP]<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a>, <a class='info' href='#POP3'>[POP3]<span> (</span><span class='info'>Myers, J. and M. Rose, &ldquo;Post Office Protocol - Version 3,&rdquo; May&nbsp;1996.</span><span>)</span></a>, and <a class='info' href='#ACAP'>[ACAP]<span> (</span><span class='info'>Newman, C. and J. Myers, &ldquo;ACAP -- Application Configuration Access Protocol,&rdquo; November&nbsp;1997.</span><span>)</span></a> protocols as described in <a class='info' href='#USINGTLS'>[USINGTLS]<span> (</span><span class='info'>Newman, C., &ldquo;Using TLS with IMAP, POP3 and ACAP,&rdquo; June&nbsp;1999.</span><span>)</span></a>.  The XML namespace name for the STARTTLS extension is 'urn:ietf:params:xml:ns:xmpp-tls'.
</p>
<p>Support for STARTTLS is REQUIRED in XMPP client and server implementations.  An administrator of a given deployment MAY require the use of TLS for client-to-server communication, server-to-server communication, or both.  A deployed client SHOULD use TLS to secure its stream with a server prior to attempting the completion of <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>, and deployed servers SHOULD use TLS between two domains for the purpose of securing server-to-server communication.
</p>
<a name="tls-rules"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Rules</h3>

<a name="tls-rules-data"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.1"></a><h3>6.2.1.&nbsp;
Data Formatting</h3>

<p>During STARTTLS negotiation, the entities MUST NOT send any whitespace within the root stream element as separators between XML elements (i.e., from the last character of the &lt;starttls/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-tls' namespace at depth=1 of the stream as sent by the initiating entity until the last character of the &lt;proceed/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-tls' namespace at depth=1 of the stream as sent by the receiving entity).  This prohibition helps to ensure proper security layer byte precision.  Any such whitespace shown in the STARTTLS examples provided in this document is included only for the sake of readability.
</p>
<a name="tls-rules-order"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.2"></a><h3>6.2.2.&nbsp;
Order of Negotiation</h3>

<p>If the initiating entity chooses to use TLS, STARTTLS negotiation MUST be completed before proceeding to <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>; this order of negotiation is required to help safeguard authentication information sent during SASL negotiation, as well as to make it possible to base the use of the SASL EXTERNAL mechanism on a certificate (or other credentials) provided during prior TLS negotiation.
</p>
<a name="tls-process"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Process</h3>

<a name="tls-process-stream"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.1"></a><h3>6.3.1.&nbsp;
Exchange of Stream Headers and Stream Features</h3>

<p>The initiating entity resolves the hostname of the receiving entity as specified under <a class='info' href='#tcp'>Section&nbsp;4<span> (</span><span class='info'>TCP Binding</span><span>)</span></a>, opens a TCP connection to the advertised port at the resolved IP address, and sends an initial stream header to the receiving entity; if the initiating entity is capable of STARTTLS negotiation, it MUST include the 'version' attribute set to a value of at least "1.0" in the initial stream header.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;stream:stream
     from='juliet@im.example.com'
     to='im.example.com'
     version='1.0'
     xml:lang='en'
     xmlns='jabber:client'
     xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>The receiving entity MUST send a response stream header to the initiating entity over the TCP connection opened by the initiating entity; if the receiving entity is capable of STARTTLS negotiation, it MUST include the 'version' attribute set to a value of at least "1.0" in the response stream header.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;stream:stream
     from='im.example.com'
     id='t7AMCin9zjMNwQKDnplntZPIDEI='
     to='juliet@im.example.com'
     version='1.0'
     xml:lang='en'
     xmlns='jabber:client'
     xmlns:stream='http://etherx.jabber.org/streams'
</pre></div>
<p>The receiving entity then MUST send stream features to the initiating entity.  If the receiving entity supports TLS, the stream features MUST include an advertisement for support of STARTTLS negotiation, i.e., a &lt;starttls/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-tls' namespace.
</p>
<p>If the receiving entity considers STARTTLS negotiation to be discretionary, the &lt;starttls/&gt; element MUST contain an empty &lt;optional/&gt; child element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;stream:features&gt;
     &lt;starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'&gt;
       &lt;optional/&gt;
     &lt;/starttls&gt;
   &lt;/stream:features&gt;
</pre></div>
<p>If the receiving entity considers STARTTLS negotiation to be mandatory, the &lt;starttls/&gt; element MUST contain an empty &lt;required/&gt; child element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;stream:features&gt;
     &lt;starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'&gt;
       &lt;required/&gt;
     &lt;/starttls&gt;
   &lt;/stream:features&gt;
</pre></div>
<a name="tls-process-initiate"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.2"></a><h3>6.3.2.&nbsp;
Initiation of STARTTLS Negotiation</h3>

<a name="tls-process-initiate-command"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.2.1"></a><h3>6.3.2.1.&nbsp;
STARTTLS Command</h3>

<p>In order to begin the STARTTLS negotiation, the initiating entity issues the STARTTLS command (i.e., a &lt;starttls/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-tls' namespace) to instruct the receiving entity that it wishes to begin a STARTTLS negotiation to secure the stream.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;
</pre></div>
<p>The receiving entity MUST reply with either a &lt;proceed/&gt; element (proceed case) or a &lt;failure/&gt; element (failure case) qualified by the 'urn:ietf:params:xml:ns:xmpp-tls' namespace.
</p>
<a name="tls-process-initiate-failure"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.2.2"></a><h3>6.3.2.2.&nbsp;
Failure Case</h3>

<p>If the failure case occurs, the receiving entity MUST return a &lt;failure/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-tls' namespace, terminate the XML stream, and terminate the underlying TCP connection.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;

R: &lt;/stream:stream&gt;
</pre></div>
<p>Causes for the failure case include but are not limited to:
</p>
<p>
            </p>
<ol class="text">
<li>The initiating entity has sent a malformed STARTTLS command.
</li>
<li>The receiving entity does not offer STARTTLS negotiation either temporarily or permanently.
</li>
<li>The receiving entity cannot complete STARTTLS negotiation because of an internal error.
</li>
</ol><p>
          
</p>
<p></p>
<blockquote class="text">
<p>Note: STARTTLS failure is not triggered by TLS errors such as bad certificate or unknown certificate authority; those errors are generated and handled during the TLS negotiation itself as described in <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.1,&rdquo; April&nbsp;2006.</span><span>)</span></a>.
</p>
</blockquote>

<p>If the failure case occurs, the initiating entity MAY attempt to reconnect as explained under <a class='info' href='#streams-reconnect'>Section&nbsp;4.5<span> (</span><span class='info'>Reconnection</span><span>)</span></a>.
</p>
<a name="tls-process-initiate-proceed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.2.3"></a><h3>6.3.2.3.&nbsp;
Proceed Case</h3>

<p>If the proceed case occurs, the receiving entity MUST return a &lt;proceed/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-tls' namespace.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;proceed xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;
</pre></div>
<p>The receiving entity MUST consider the TLS negotiation to have begun immediately after sending the closing '&gt;' character of the &lt;proceed/&gt; element to the initiating entity.  The initiating entity MUST consider the TLS negotiation to have begun immediately after receiving the closing '&gt;' character of the &lt;proceed/&gt; element from the receiving entity.
</p>
<p>The entities now proceed to TLS negotiation as explained in the next section.
</p>
<a name="tls-process-neg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.3"></a><h3>6.3.3.&nbsp;
TLS Negotiation</h3>

<a name="tls-process-neg-rules"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.3.1"></a><h3>6.3.3.1.&nbsp;
Rules</h3>

<p>In order to complete TLS negotiation over the TCP connection, the entities MUST follow the process defined in <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.1,&rdquo; April&nbsp;2006.</span><span>)</span></a>.
</p>
<p>The following rules apply:
</p>
<p>
            </p>
<ol class="text">
<li>The entities MUST NOT send any further XML data until the TLS negotiation has either failed or succeeded.
</li>
<li>The receiving entity MUST present a certificate.
</li>
<li>The receiving entity SHOULD send a certificate request to the initiating entity so that mutual authentication will be possible.
</li>
<li>The initiating entity MUST validate the certificate to determine if the TLS negotiation shall succeed; see <a class='info' href='#security-certificates-validation'>Section&nbsp;15.2.2<span> (</span><span class='info'>Certificate Validation</span><span>)</span></a> regarding certificate validation procedures.
</li>
<li>The receiving entity SHOULD choose which certificate to present based on the 'to' attribute of the initial stream header.
</li>
</ol><p>
          
</p>
<p></p>
<blockquote class="text">
<p>Note: See <a class='info' href='#security-mandatory'>Section&nbsp;15.7<span> (</span><span class='info'>Mandatory-to-Implement Technologies</span><span>)</span></a> regarding ciphers that MUST be supported for TLS; naturally, other ciphers MAY be supported as well.
</p>
</blockquote>

<a name="tls-process-neg-failure"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.3.2"></a><h3>6.3.3.2.&nbsp;
TLS Failure</h3>

<p>If the TLS negotiation results in failure, the receiving entity MUST terminate the TCP connection.
</p>
<p>The receiving entity MUST NOT send a closing &lt;/stream&gt; tag before terminating the TCP connection, since the receiving entity and initiating entity MUST consider the original stream to be replaced upon failure of the TLS negotiation.
</p>
<a name="tls-process-neg-success"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.3.3"></a><h3>6.3.3.3.&nbsp;
TLS Success</h3>

<p>If the TLS negotiation is successful, then the entities MUST proceed as follows.
</p>
<p>
            </p>
<ol class="text">
<li>The receiving entity MUST discard any knowledge obtained in an insecure manner from the initiating entity before TLS took effect.
</li>
<li>The initiating entity MUST discard any knowledge obtained in an insecure manner from the receiving entity before TLS took effect.
</li>
<li>The initiating entity MUST send a new initial stream header to the receiving entity over the encrypted connection.
                <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;stream:stream
     from='juliet@im.example.com'
     to='im.example.com'
     version='1.0'
     xml:lang='en'
     xmlns='jabber:client'
     xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>Note: The initiating entity MUST NOT send a closing &lt;/stream&gt; tag before sending the new initial stream header, since the receiving entity and initiating entity MUST consider the original stream to be replaced upon success of the TLS negotiation.
</p>
              
</li>
<li>The receiving entity MUST respond with a new response stream header over the encrypted connection.
                <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;stream:stream
     from='im.example.com'
     id='vgKi/bkYME8OAj4rlXMkpucAqe4='
     to='juliet@im.example.com'
     version='1.0'
     xml:lang='en'
     xmlns='jabber:client'
     xmlns:stream='http://etherx.jabber.org/streams'
</pre></div>
              
</li>
<li>The receiving entity also MUST send stream features to the initiating entity, which MUST NOT include the STARTTLS feature but which SHOULD include the SASL stream feature as described under <a class='info' href='#sasl'>Section&nbsp;7<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>.
                <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;stream:features&gt;
     &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
       &lt;mechanism&gt;EXTERNAL&lt;/mechanism&gt;
       &lt;mechanism&gt;PLAIN&lt;/mechanism&gt;
       &lt;required/&gt;
     &lt;/mechanisms&gt;
   &lt;/stream:features&gt;
</pre></div>
              
</li>
</ol><p>
          
</p>
<a name="sasl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
SASL Negotiation</h3>

<a name="sasl-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Overview</h3>

<p>XMPP includes a method for authenticating a stream by means of an XMPP-specific profile of the Simple Authentication and Security Layer protocol (see <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a>).  SASL provides a generalized method for adding authentication support to connection-based protocols, and XMPP uses an XML namespace profile of SASL that conforms to the profiling requirements of <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a>.
</p>
<p>Support for SASL negotiation is REQUIRED in XMPP client and server implementations.
</p>
<a name="sasl-rules"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Rules</h3>

<a name="sasl-rules-preferences"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.1"></a><h3>7.2.1.&nbsp;
Mechanism Preferences</h3>

<p>Any entity that will act as a SASL client or a SASL server MUST maintain an ordered list of its preferred SASL mechanisms according to the client or server, where the list is ordered by the perceived strength of the mechanisms.  A server MUST offer and a client MUST try SASL mechanisms in the order of their perceived strength.  For example, if the server offers the ordered list "PLAIN DIGEST-MD5 GSSAPI" or "DIGEST-MD5 GSSAPI PLAIN" but the client's ordered list is "GSSAPI DIGEST-MD5", the client shall try GSSAPI first and then DIGEST-MD5 but shall never try PLAIN (since PLAIN is not on its list).
</p>
<a name="sasl-rules-offers"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.2"></a><h3>7.2.2.&nbsp;
Mechanism Offers</h3>

<p>If the receiving entity considers <a class='info' href='#tls'>TLS negotiation<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a> to be mandatory before use of a particular SASL authentication mechanism will be acceptable, the receiving entity MUST NOT advertise that mechanism in its list of available SASL authentication mechanisms prior to successful TLS negotiation.
</p>
<p>If during prior TLS negotiation the initiating entity presented a certificate that is acceptable to the receiving entity for purposes of strong identity verification in accordance with local service policies, the receiving entity MUST offer the SASL EXTERNAL mechanism to the initiating entity during SASL negotiation (refer to <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a>) and SHOULD prefer that mechanism.  However, the EXTERNAL mechanism MAY be offered under other circumstances as well.
</p>
<p>See <a class='info' href='#security-mandatory'>Section&nbsp;15.7<span> (</span><span class='info'>Mandatory-to-Implement Technologies</span><span>)</span></a> regarding mechanisms that MUST be supported; naturally, other SASL mechanisms MAY be supported as well.  Best practices for the use of several SASL mechanisms in the context of XMPP are described in <a class='info' href='#XEP-0175'>[XEP&#8209;0175]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Best Practices for Use of SASL ANONYMOUS,&rdquo; September&nbsp;2006.</span><span>)</span></a> and <a class='info' href='#XEP-0178'>[XEP&#8209;0178]<span> (</span><span class='info'>Saint-Andre, P. and P. Millard, &ldquo;Best Practices for Use of SASL EXTERNAL with Certificates,&rdquo; February&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="sasl-rules-data"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.3"></a><h3>7.2.3.&nbsp;
Data Formatting</h3>

<p>The following data formattting rules apply to the SASL negotiation:
</p>
<p>
          </p>
<ol class="text">
<li>During SASL negotiation, the entities MUST NOT send any whitespace within the root stream element as separators between XML elements (i.e., from the last character of the &lt;auth/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace at depth=1 of the stream as sent by the initiating entity until the last character of the &lt;success/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace at depth=1 of the stream as sent by the receiving entity).  This prohibition helps to ensure proper security layer byte precision.  Any such whitespace shown in the SASL examples provided in this document is included only for the sake of readability.
</li>
<li>Any XML character data contained within the XML elements MUST be encoded using base64, where the encoding adheres to the definition in Section 4 of <a class='info' href='#BASE64'>[BASE64]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; October&nbsp;2006.</span><span>)</span></a> and where the padding bits are set to zero.
</li>
<li>As formally specified in the XML schema for the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace under <a class='info' href='#schemas-sasl'>Appendix&nbsp;C.4<span> (</span><span class='info'>SASL Namespace</span><span>)</span></a>, the receiving entity MAY include one or more application-specific child elements inside the &lt;mechanisms/&gt; element to provide information that may be needed by the initiating entity in order to complete successful SASL negotiation using one or more of the offered mechanisms; however, the syntax and semantics of all such elements are out of scope for this specification.
</li>
</ol><p>
        
</p>
<a name="sasl-rules-layers"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.4"></a><h3>7.2.4.&nbsp;
Security Layers</h3>

<p>Upon successful SASL negotiation that involves negotiation of a security layer, the initiating entity MUST discard any knowledge obtained from the receiving entity that was not obtained via the SASL negotiation.
</p>
<p>Upon successful SASL negotiation that involves negotiation of a security layer, the receiving entity MUST discard any knowledge obtained from the initiating entity that was not obtained via the SASL negotiation.  The receiving entity MUST also include an updated list of SASL mechanisms with the stream features it sends after SASL negotiation so that the initiating entity is able to detect any changes to the list of mechanisms supported by the receiving entity.
</p>
<a name="sasl-rules-username"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.5"></a><h3>7.2.5.&nbsp;
Simple Usernames</h3>

<p>It is possible that provision of a "simple username" is supported by the selected SASL mechanism (e.g., this is supported by the DIGEST-MD5 and CRAM-MD5 mechanisms but not by the EXTERNAL and GSSAPI mechanisms).  The simple username provided during authentication MUST be as follows:
</p>
<p>
          </p>
<blockquote class="text"><dl>
<dt>Client-to-server communication:</dt>
<dd>The initiating entity's registered account name, i.e., a user name or node name as described under <a class='info' href='#addressing-node'>Section&nbsp;3.3<span> (</span><span class='info'>Node Identifier</span><span>)</span></a> (this is not a bare JID of the form &lt;node@domain&gt; but only the node portion of the JID).  The simple username MUST adhere to the <a class='info' href='#nodeprep'>Nodeprep<span> (</span><span class='info'>Nodeprep</span><span>)</span></a> profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</dd>
<dt>Server-to-server communication:</dt>
<dd>The initiating entity's sending domain, i.e., IP address or fully qualified domain name as contained in an XMPP domain identifier.  The simple username MUST adhere to the <a class='info' href='#NAMEPREP'>[NAMEPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),&rdquo; March&nbsp;2003.</span><span>)</span></a> profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</dd>
</dl></blockquote><p>
        
</p>
<a name="sasl-rules-authzid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.6"></a><h3>7.2.6.&nbsp;
Authorization Identities</h3>

<p>If the initiating entity wishes to act on behalf of another entity and the selected SASL mechanism supports transmission of an authorization identity, the initiating entity MUST provide an authorization identity during SASL negotiation.  If the initiating entity does not wish to act on behalf of another entity, it MUST NOT provide an authorization identity.  As specified in <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a>, the initiating entity MUST NOT provide an authorization identity unless the authorization identity is different from the default authorization identity derived from the authentication identity.  If provided, the value of the authorization identity MUST be a bare JID of the form &lt;domain&gt; (i.e., an XMPP domain identifier only) for servers and a bare JID of the form &lt;node@domain&gt; (i.e., node identifier and domain identifier) for clients.
</p>
<a name="sasl-rules-rountrips"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.7"></a><h3>7.2.7.&nbsp;
Round Trips</h3>

<p><a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a> specifies that a using protocol such as XMPP can define two methods by which the protocol can save round trips where allowed for the SASL mechanism:
</p>
<p>
          </p>
<ol class="text">
<li>When the SASL client (the XMPP "initiating entity") requests an authentication exchange, it can include "initial response" data with its request.  In XMPP this is done by including the initial response as the XML character data of the &lt;auth/&gt; element.
</li>
<li>At the end of the authentication exchange, the SASL server (the XMPP "receiving entity") can include "additional data with success".  In XMPP this is done by including the additional data as the XML character data of the &lt;success/&gt; element.
</li>
</ol><p>
        
</p>
<p>For the sake of protocol efficiency, it is RECOMMENDED for XMPP clients and servers to use these methods, however they MUST support the less efficient modes as well.
</p>
<a name="sasl-process"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Process</h3>

<p>The process for SASL negotiation is as follows.
</p>
<a name="sasl-process-stream"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1"></a><h3>7.3.1.&nbsp;
Exchange of Stream Headers and Stream Features</h3>

<p>If SASL negotiation follows successful <a class='info' href='#tls'>STARTTLS negotation<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a>, then the SASL negotiation occurs over the encrypted stream that has already been negotiated.  If not, the initiating entity resolves the hostname of the receiving entity as specified under <a class='info' href='#tcp'>Section&nbsp;4<span> (</span><span class='info'>TCP Binding</span><span>)</span></a>, opens a TCP connection to the advertised port at the resolved IP address, and sends an initial stream header to the receiving entity; if the initiating entity is capable of STARTTLS negotiation, it MUST include the 'version' attribute set to a value of at least "1.0" in the initial stream header.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;stream:stream
     from='juliet@im.example.com'
     to='im.example.com'
     version='1.0'
     xml:lang='en'
     xmlns='jabber:client'
     xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>The receiving entity MUST send a response stream header to the initiating entity; if the receiving entity is capable of SASL negotiation, it MUST include the 'version' attribute set to a value of at least "1.0" in the response stream header.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;stream:stream
     from='im.example.com'
     id='vgKi/bkYME8OAj4rlXMkpucAqe4='
     to='juliet@im.example.com'
     version='1.0'
     xml:lang='en'
     xmlns='jabber:client'
     xmlns:stream='http://etherx.jabber.org/streams'
</pre></div>
<p>The receiving entity also MUST send stream features to the initiating entity.  If the receiving entity supports SASL, the stream features MUST include an advertisement for support of SASL negotiation, i.e., a &lt;mechanisms/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace.
</p>
<p>The &lt;mechanisms/&gt; element MUST contain one &lt;mechanism/&gt; child element for each authentication mechanism the receiving entity offers to the initiating entity.  The order of &lt;mechanism/&gt; elements in the XML indicates the preference order of the SASL mechanisms according to the receiving entity; however the initiating entity MUST maintain its own preference order independent of the preference order of the receiving entity.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;stream:features&gt;
     &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
       &lt;mechanism&gt;EXTERNAL&lt;/mechanism&gt;
       &lt;mechanism&gt;PLAIN&lt;/mechanism&gt;
       &lt;required/&gt;
     &lt;/mechanisms&gt;
   &lt;/stream:features&gt;
</pre></div>
<p>If the receiving entity considers SASL negotiation to be discretionary, the &lt;mechanisms/&gt; element MUST contain an empty &lt;optional/&gt; child element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;stream:features&gt;
     &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
       &lt;mechanism&gt;EXTERNAL&lt;/mechanism&gt;
       &lt;mechanism&gt;PLAIN&lt;/mechanism&gt;
       &lt;optional/&gt;
     &lt;/mechanisms&gt;
   &lt;/stream:features&gt;
</pre></div>
<p>If the receiving entity considers SASL negotiation to be mandatory, the &lt;mechanisms/&gt; element MUST contain an empty &lt;required/&gt; child element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;stream:features&gt;
     &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
       &lt;mechanism&gt;EXTERNAL&lt;/mechanism&gt;
       &lt;mechanism&gt;PLAIN&lt;/mechanism&gt;
       &lt;required/&gt;
     &lt;/mechanisms&gt;
   &lt;/stream:features&gt;
</pre></div>
<a name="sasl-process-neg-initiate"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.2"></a><h3>7.3.2.&nbsp;
Initiation</h3>

<p>In order to begin the SASL negotiation, the initiating entity sends an &lt;auth/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace and includes an appropriate value for the 'mechanism' attribute.  This element MAY contain XML character data (in SASL terminology, the "initial response") if the mechanism supports or requires it; if the initiating entity needs to send a zero-length initial response, it MUST transmit the response as a single equals sign character ("="), which indicates that the response is present but contains no data.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
         mechanism='PLAIN'&gt;UjBtMzBSMGNrcw==&lt;/auth&gt;
</pre></div>
<a name="sasl-process-neg-challengeresponse"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.3"></a><h3>7.3.3.&nbsp;
Challenge-Response Sequence</h3>

<p>If necessary, the receiving entity challenges the initiating entity by sending a &lt;challenge/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace; this element MAY contain XML character data (which MUST be generated in accordance with the definition of the SASL mechanism chosen by the initiating entity).
</p>
<p>The initiating entity responds to the challenge by sending a &lt;response/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace; this element MAY contain XML character data (which MUST be generated in accordance with the definition of the SASL mechanism chosen by the initiating entity).
</p>
<p>If necessary, the receiving entity sends more challenges and the initiating entity sends more responses.
</p>
<p>This series of challenge/response pairs continues until one of three things happens:
</p>
<p>
          </p>
<ul class="text">
<li>The initiating entity aborts the handshake.
</li>
<li>The receiving entity reports failure of the handshake.
</li>
<li>The receiving entity reports success of the handshake.
</li>
</ul><p>
        
</p>
<p>These scenarios are described in the following sections.
</p>
<a name="sasl-process-neg-abort"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.4"></a><h3>7.3.4.&nbsp;
Abort</h3>

<p>The initiating entity aborts the handshake by sending an &lt;abort/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;abort xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/&gt;
</pre></div>
<p>Upon receiving an &lt;abort/&gt; element, the receiving entity MUST return a &lt;failure/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace and containing an &lt;aborted/&gt; child element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/&gt;
     &lt;aborted/&gt;
   &lt;/failure&gt;
</pre></div>
<a name="sasl-process-neg-failure"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.5"></a><h3>7.3.5.&nbsp;
Failure</h3>

<p>The receiving entity reports failure of the handshake by sending a &lt;failure/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace (the particular cause of failure MUST be communicated in an appropriate child element of the &lt;failure/&gt; element as defined under <a class='info' href='#sasl-errors'>Section&nbsp;7.4<span> (</span><span class='info'>SASL Errors</span><span>)</span></a>).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     &lt;not-authorized/&gt;
   &lt;/failure&gt;
</pre></div>
<p>Where appropriate for the chosen SASL mechanism, the receiving entity SHOULD allow a configurable but reasonable number of retries (at least 2 and no more than 5); this enables the initiating entity (e.g., an end-user client) to tolerate incorrectly-provided credentials (e.g., a mistyped password) without being forced to reconnect.
</p>
<p>If the initiating entity attempts a reasonable number of retries with the same SASL mechanism and all attempts fail, it MAY fall back to the next mechanism in its ordered list by sending a new &lt;auth/&gt; request to the receiving entity.  If there are no remaining mechanisms in its list, the initiating entity SHOULD instead send an &lt;abort/&gt; element to the receiving entity.
</p>
<p>If the initiating entity exceeds the number of retries, the receiving entity MUST return a stream error (which SHOULD be &lt;policy-violation/&gt; but MAY be &lt;not-authorized/&gt;).
</p>
<a name="sasl-process-neg-success"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.6"></a><h3>7.3.6.&nbsp;
Success</h3>

<p>The receiving entity reports success of the handshake by sending a &lt;success/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace; this element MAY contain XML character data (in SASL terminology, "additional data with success") if the chosen SASL mechanism supports or requires it; if the receiving entity needs to send additional data of zero length, it MUST transmit the data as a single equals sign character ("=").
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;success xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/&gt;
</pre></div>
<p>Upon receiving the &lt;success/&gt; element, the initiating entity MUST initiate a new stream over the existing TCP connection by sending a new initial stream header to the receiving entity.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;stream:stream
     from='juliet@im.example.com'
     to='im.example.com'
     version='1.0'
     xml:lang='en'
     xmlns='jabber:client'
     xmlns:stream='http://etherx.jabber.org/streams'
</pre></div>
<p></p>
<blockquote class="text">
<p>Note: The initiating entity MUST NOT send a closing &lt;/stream&gt; tag before sending the new initial stream header, since the receiving entity and initiating entity MUST consider the original stream to be replaced upon sending or receiving the &lt;success/&gt; element.
</p>
</blockquote>

<p>Upon receiving the new initial stream header from the initiating entity, the receiving entity MUST respond by sending a new response XML stream header to the initiating entity.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;stream:stream
     from='im.example.com'
     id='gPybzaOzBmaADgxKXu9UClbprp0='
     to='juliet@im.example.com'
     version='1.0'
     xml:lang='en'
     xmlns='jabber:client'
     xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>The receiving entity MUST also send stream features, containing any further available features or containing no features (via an empty &lt;features/&gt; element).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;stream:features&gt;
     &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;required/&gt;
     &lt;/bind&gt;
   &lt;/stream:features&gt;
</pre></div>
<p>As noted, if the successful SASL negotiation involved negotiation of a security layer, the receiving entity MUST also include an updated list of SASL mechanisms with the stream features so that the initiating entity is able to detect any changes to the list of mechanisms supported by the receiving entity.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
R: &lt;stream:features&gt;
     &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
       &lt;mechanism&gt;EXTERNAL&lt;/mechanism&gt;
       &lt;mechanism&gt;PLAIN&lt;/mechanism&gt;
       &lt;optional/&gt;
     &lt;/mechanisms&gt;
     &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;required/&gt;
     &lt;/bind&gt;
   &lt;/stream:features&gt;
</pre></div>
<a name="sasl-errors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
SASL Errors</h3>

<p>The syntax of SASL errors is as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
  &lt;defined-condition/&gt;
  [&lt;text xml:lang='langcode'&gt;
      OPTIONAL descriptive text
  &lt;/text&gt;]
&lt;/failure&gt;
</pre></div>
<p>Where "defined-condition" is one of the SASL-related error conditions defined in the following sections.
</p>
<p>Inclusion of a defined condition is REQUIRED.
</p>
<p>Inclusion of the &lt;text/&gt; element is OPTIONAL, and can be used to provide application-specific information about the error condition, which information MAY be displayed to a human but only as a supplement to the defined condition.
</p>
<a name="sasl-errors-aborted"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.1"></a><h3>7.4.1.&nbsp;
aborted</h3>

<p>The receiving entity acknowledges an &lt;abort/&gt; element sent by the initiating entity; sent in reply to the &lt;abort/&gt; element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;abort xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/&gt;

R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     &lt;aborted/&gt;
   &lt;/failure&gt;
</pre></div>
<a name="sasl-errors-account-disabled"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.2"></a><h3>7.4.2.&nbsp;
account-disabled</h3>

<p>The account of the initiating entity has been temporarily disabled; sent in reply to an &lt;auth/&gt; element (with or without initial response data) or a &lt;response/&gt; element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
         mechanism='PLAIN'&gt;UjBtMzBSMGNrcw==&lt;/auth&gt;

R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     &lt;account-disabled/&gt;
     &lt;text xml:lang='en'&gt;Call 212-555-1212 for assistance.&lt;/text&gt;
   &lt;/failure&gt;
</pre></div>
<a name="sasl-errors-credentials-expired"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.3"></a><h3>7.4.3.&nbsp;
credentials-expired</h3>

<p>The authentication failed because the initiating entity provided credentials that have expired; sent in reply to a &lt;response/&gt; element or an &lt;auth/&gt; element with initial response data.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     [ ... ]
   &lt;/response&gt;

R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     &lt;credentials-expired/&gt;
   &lt;/failure&gt;
</pre></div>
<a name="sasl-errors-encryption-required"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.4"></a><h3>7.4.4.&nbsp;
encryption-required</h3>

<p>The mechanism requested by the initiating entity cannot be used unless the underlying stream is encrypted; sent in reply to an &lt;auth/&gt; element (with or without initial response data).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
         mechanism='PLAIN'&gt;UjBtMzBSMGNrcw==&lt;/auth&gt;

R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     &lt;encryption-required/&gt;
   &lt;/failure&gt;
</pre></div>
<a name="sasl-errors-incorrect-encoding"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.5"></a><h3>7.4.5.&nbsp;
incorrect-encoding</h3>

<p>The data provided by the initiating entity could not be processed because the <a class='info' href='#BASE64'>[BASE64]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; October&nbsp;2006.</span><span>)</span></a> encoding is incorrect (e.g., because the encoding does not adhere to the definition in Section 4 of <a class='info' href='#BASE64'>[BASE64]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; October&nbsp;2006.</span><span>)</span></a>); sent in reply to a &lt;response/&gt; element or an &lt;auth/&gt; element with initial response data.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
         mechanism='DIGEST-MD5'&gt;[ ... ]&lt;/auth&gt;

R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     &lt;incorrect-encoding/&gt;
   &lt;/failure&gt;
</pre></div>
<a name="sasl-errors-invalid-authzid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.6"></a><h3>7.4.6.&nbsp;
invalid-authzid</h3>

<p>The authzid provided by the initiating entity is invalid, either because it is incorrectly formatted or because the initiating entity does not have permissions to authorize that ID; sent in reply to a &lt;response/&gt; element or an &lt;auth/&gt; element with initial response data.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     [ ... ]
   &lt;/response&gt;

R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     &lt;invalid-authzid/&gt;
   &lt;/failure&gt;
</pre></div>
<a name="sasl-errors-invalid-mechanism"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.7"></a><h3>7.4.7.&nbsp;
invalid-mechanism</h3>

<p>The initiating entity did not provide a mechanism or requested a mechanism that is not supported by the receiving entity; sent in reply to an &lt;auth/&gt; element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
         mechanism='CRAM-MD5'/&gt;

R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     &lt;invalid-mechanism/&gt;
   &lt;/failure&gt;
</pre></div>
<a name="sasl-errors-malformed-request"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.8"></a><h3>7.4.8.&nbsp;
malformed-request</h3>

<p>The request is malformed (e.g., the &lt;auth/&gt; element includes initial response data but the mechanism does not allow that, or the data sent violates the syntax for the specified SASL mechanism); sent in reply to an &lt;abort/&gt;, &lt;auth/&gt;, &lt;challenge/&gt;, or &lt;response/&gt; element.
</p>
<p>(In the following example, the XML character data of the &lt;auth/&gt; element contains more than 255 UTF-8-encoded Unicode characters and therefore violates the "token" production for the SASL ANONYMOUS mechanism as specified in <a class='info' href='#ANONYMOUS'>[ANONYMOUS]<span> (</span><span class='info'>Zeilenga, K., &ldquo;Anonymous Simple Authentication and Security Layer (SASL) Mechanism,&rdquo; June&nbsp;2006.</span><span>)</span></a>.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
         mechanism='ANONYMOUS'&gt;[ ... some-long-token ... ]&lt;/auth&gt;

R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     &lt;malformed-request/&gt;
   &lt;/failure&gt;
</pre></div>
<a name="sasl-errors-mechanism-too-weak"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.9"></a><h3>7.4.9.&nbsp;
mechanism-too-weak</h3>

<p>The mechanism requested by the initiating entity is weaker than server policy permits for that initiating entity; sent in reply to an &lt;auth/&gt; element (with or without initial response data).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
         mechanism='PLAIN'&gt;UjBtMzBSMGNrcw==&lt;/auth&gt;

R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     &lt;mechanism-too-weak/&gt;
   &lt;/failure&gt;
</pre></div>
<a name="sasl-errors-not-authorized"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.10"></a><h3>7.4.10.&nbsp;
not-authorized</h3>

<p>The authentication failed because the initiating entity did not provide proper credentials; sent in reply to a &lt;response/&gt; element or an &lt;auth/&gt; element with initial response data.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     [ ... ]
   &lt;/response&gt;

R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     &lt;not-authorized/&gt;
   &lt;/failure&gt;
</pre></div>
<p></p>
<blockquote class="text">
<p>Note: This error condition includes but is not limited to the case of incorrect credentials or an unknown username.  In order to discourage directory harvest attacks, no differentiation is made between incorrect credentials and an unknown username.
</p>
</blockquote>

<a name="sasl-errors-temporary-auth-failure"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.11"></a><h3>7.4.11.&nbsp;
temporary-auth-failure</h3>

<p>The authentication failed because of a temporary error condition within the receiving entity, and the initiating entity should try again later; sent in reply to an &lt;auth/&gt; element or a &lt;response/&gt; element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     [ ... ]
   &lt;/response&gt;

R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     &lt;temporary-auth-failure/&gt;
   &lt;/failure&gt;
</pre></div>
<a name="sasl-errors-transition-needed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.12"></a><h3>7.4.12.&nbsp;
transition-needed</h3>

<p>The authentication failed because the mechanism cannot be used until the initiating entity provides (for one time only) a plaintext password so that the receiving entity can build a hashed password for use in future authentication attempts; sent in reply to an &lt;auth/&gt; element with or without initial response data.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
I: &lt;auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
         mechanism='CRAM-MD5'&gt;[ ... ]&lt;/auth&gt;

R: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     &lt;transition-needed/&gt;
   &lt;/failure&gt;
</pre></div>
<p></p>
<blockquote class="text">
<p>Note: An XMPP client MUST treat a &lt;transition-needed/&gt; error with extreme caution, SHOULD NOT provide a plaintext password over an XML stream that is not encrypted via Transport Layer Security, and MUST warn a human user before allowing the user to provide a plaintext password over an unencrypted connection.
</p>
</blockquote>

<a name="sasl-def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5"></a><h3>7.5.&nbsp;
SASL Definition</h3>

<p>The profiling requirements of <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a> require that the following information be supplied by the definition of a using protocol.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>service name:</dt>
<dd>"xmpp"
</dd>
<dt>initiation sequence:</dt>
<dd>After the initiating entity provides an opening XML stream header and the receiving entity replies in kind, the receiving entity provides a list of acceptable authentication methods.  The initiating entity chooses one method from the list and sends it to the receiving entity as the value of the 'mechanism' attribute possessed by an &lt;auth/&gt; element, optionally including an initial response to avoid a round trip.
</dd>
<dt>exchange sequence:</dt>
<dd>Challenges and responses are carried through the exchange of &lt;challenge/&gt; elements from receiving entity to initiating entity and &lt;response/&gt; elements from initiating entity to receiving entity.  The receiving entity reports failure by sending a &lt;failure/&gt; element and success by sending a &lt;success/&gt; element; the initiating entity aborts the exchange by sending an &lt;abort/&gt; element.  Upon successful negotiation, both sides consider the original XML stream to be closed and new stream headers are sent by both entities.
</dd>
<dt>security layer negotiation:</dt>
<dd>The security layer takes effect immediately after sending the closing '&gt;' character of the &lt;success/&gt; element for the receiving entity, and immediately after receiving the closing '&gt;' character of the &lt;success/&gt; element for the initiating entity.  The order of layers is first <a class='info' href='#TCP'>[TCP]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>, then <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.1,&rdquo; April&nbsp;2006.</span><span>)</span></a>, then <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a>, then XMPP.
</dd>
<dt>use of the authorization identity:</dt>
<dd>The authorization identity may be used in XMPP to denote the non-default &lt;node@domain&gt; of a client or the sending &lt;domain&gt; of a server; an empty string is equivalent to an absent authorization identity.
</dd>
</dl></blockquote>

<a name="bind"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Resource Binding</h3>

<a name="bind-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Overview</h3>

<p>After a client authenticates with a server, it MUST bind a specific resource to the stream so that the server can properly address the client (see <a class='info' href='#addressing'>Section&nbsp;3<span> (</span><span class='info'>Addresses</span><span>)</span></a>).  That is, there MUST be an XMPP resource identifier associated with the bare JID (&lt;node@domain&gt;) of the client, so that the address for use over that stream is a full JID of the form &lt;node@domain/resource&gt;.  This ensures that the server can deliver XML stanzas to and receive XML stanzas from the client (see <a class='info' href='#rules'>Section&nbsp;11<span> (</span><span class='info'>Server Rules for Processing XML Stanzas</span><span>)</span></a>).
</p>
<p><a name='anchor16'></a>After a client has bound a resource to the stream, it is referred to as a CONNECTED RESOURCE.  A server SHOULD allow an entity to maintain multiple connected resources simultaneously, where each connected resource is differentiated by a distinct resource identifier; however, a server MUST enable the administrator of an XMPP service to limit the number of connected resources in order to prevent certain denial of service attacks as described under <a class='info' href='#security-dos'>Section&nbsp;15.12<span> (</span><span class='info'>Denial of Service</span><span>)</span></a>.
</p>
<p>If, before completing the resource binding step, the client attempts to send an outbound XML stanza (i.e., a stanza not directed to the server itself or to the client's own account), the server MUST NOT process the stanza and MUST either ignore the stanza or return a &lt;not-authorized/&gt; stream error to the client.
</p>
<p>Support for resource binding is REQUIRED in XMPP client and server implementations.
</p>
<a name="bind-feature"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Advertising Support</h3>

<p>Upon sending a new response stream header to the client after successful SASL negotiation, the server MUST include a &lt;bind/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-bind' namespace in the stream features it presents to the client; this &lt;bind/&gt; element MUST include an empty &lt;required/&gt; element to explicitly indicate that it is mandatory for the client to complete resource binding at this stage of the stream negotiation process.
</p>
<p></p>
<blockquote class="text">
<p>Note: The server MUST NOT include the resource binding stream feature until after successful SASL negotiation.
</p>
</blockquote>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;stream:stream
       from='im.example.com'
       id='gPybzaOzBmaADgxKXu9UClbprp0='
       to='juliet@im.example.com'
       version='1.0'
       xml:lang='en'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'&gt;

S: &lt;stream:features&gt;
     &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;required/&gt;
     &lt;/bind&gt;
   &lt;/stream:features&gt;
</pre></div>
<p>Upon being so informed that resource binding is required, the client MUST bind a resource to the stream as described in the following sections.
</p>
<a name="bind-generation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
Generation of Resource Identifiers</h3>

<p>A resource identifier MUST at a minimum be unique among the connected resources for that &lt;node@domain&gt;.  Enforcement of this policy is the responsibility of the server.
</p>
<p>A resource identifier can be security-critical.  For example, if a malicious entity can guess a client's resource identifier then it may be able to determine if the client (and therefore the controlling principal) is online or offline, thus resulting in a presence leak as described under <a class='info' href='#security-leak'>Section&nbsp;15.13<span> (</span><span class='info'>Presence Leaks</span><span>)</span></a>.  Traditionally, XMPP resource identifiers have been generated by clients in ways that are not secure (e.g., hardcoding the resource identifier to the name of the client or to a common location such as "home" or "work").  However, for the sake of proper security, a resource identifier SHOULD be random (see <a class='info' href='#RANDOM'>[RANDOM]<span> (</span><span class='info'>Eastlake, D., Schiller, J., and S. Crocker, &ldquo;Randomness Requirements for Security,&rdquo; June&nbsp;2005.</span><span>)</span></a>).  It is RECOMMENDED that the resource identifier incorporate a Universally Unique Identifier (UUID), for which the format specified in <a class='info' href='#UUID'>[UUID]<span> (</span><span class='info'>Leach, P., Mealling, M., and R. Salz, &ldquo;A Universally Unique IDentifier (UUID) URN Namespace,&rdquo; July&nbsp;2005.</span><span>)</span></a> is RECOMMENDED.
</p>
<p>The use of a suitably random resource identifier can be ensured in the following ways:
</p>
<p>
        </p>
<ol class="text">
<li>If the client asks the server to generate a resource identifier, the identifier MUST be random.
</li>
<li>If the client generates a resource identifier, the identifer SHOULD be random.  However, the client MAY allow a human user to explicitly configure the client so that the user can set the resource identifier to be a human-friendly text string; in this case the client MUST warn the user that doing so might result in the potential for presence leaks and SHOULD warn the user that the user's preferred resource identifier MAY be overridden or modified by the server.
</li>
<li>If the server modifies the client-generated resource identifier, it SHOULD do so in such a way that the modified resource identifier preserves the user's preferred text (say, "home") but appends suitably random text (e.g., "4db06f06-1ea4-11dc-aca3-000bcd821bfb"), resulting in a resource identifier that combines both the user-preferred text and random text (e.g., "home 4db06f06-1ea4-11dc-aca3-000bcd821bfb").
</li>
</ol><p>
      
</p>
<a name="bind-servergen"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
Server-Generated Resource Identifier</h3>

<p>A server that supports resource binding MUST be able to generate an XMPP resource identifier on behalf of a client.
</p>
<a name="bind-servergen-success"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4.1"></a><h3>8.4.1.&nbsp;
Success Case</h3>

<p>A client requests a server-generated resource identifier by sending an IQ stanza of type "set" (see <a class='info' href='#stanzas-semantics-iq'>Section&nbsp;9.2.3<span> (</span><span class='info'>IQ Semantics</span><span>)</span></a>) containing an empty &lt;bind/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-bind' namespace.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq id='bind_1' type='set'&gt;
    &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'/&gt;
   &lt;/iq&gt;
</pre></div>
<p>Once the server has generated an XMPP resource identifier for the client, it MUST return an IQ stanza of type "result" to the client, which MUST include a &lt;jid/&gt; child element that specifies the full JID for the connected resource as determined by the server.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq id='bind_1' type='result'&gt;
    &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
      &lt;jid&gt;
        juliet@im.example.com/4db06f06-1ea4-11dc-aca3-000bcd821bfb
      &lt;/jid&gt;
    &lt;/bind&gt;
   &lt;/iq&gt;
</pre></div>
<a name="bind-servergen-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4.2"></a><h3>8.4.2.&nbsp;
Error Cases</h3>

<p>When a client asks the server to generate a resource identifer during resource binding, the following stanza error conditions are possible:
</p>
<p>
          </p>
<ul class="text">
<li>The account has reached a limit on the number of simultaneous connected resources allowed.
</li>
<li>The client is otherwise not allowed to bind a resource to the stream.
</li>
</ul><p>
        
</p>
<a name="bind-servergen-error-resourceconstraint"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4.2.1"></a><h3>8.4.2.1.&nbsp;
Resource Constraint</h3>

<p>If the account has reached a limit on the number of simultaneous connected resources allowed, the server MUST return a &lt;resource-constraint/&gt; error.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq id='bind_2' type='error'&gt;
     &lt;error type='cancel'&gt;
       &lt;resource-constraint
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<a name="bind-servergen-error-notallowed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4.2.2"></a><h3>8.4.2.2.&nbsp;
Not Allowed</h3>

<p>If the client is otherwise not allowed to bind a resource to the stream, the server MUST return a &lt;not-allowed/&gt; error.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq id='bind_2' type='error'&gt;
     &lt;error type='cancel'&gt;
       &lt;not-allowed
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<a name="bind-clientsubmit"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5"></a><h3>8.5.&nbsp;
Client-Submitted Resource Identifier</h3>

<p>Instead of asking the server to generate a resource identifier on its behalf, a client MAY attempt to submit a resource identifier that it has generated or that the controlling user has provided.
</p>
<a name="bind-clientsubmit-success"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5.1"></a><h3>8.5.1.&nbsp;
Success Case</h3>

<p>A client asks its server to accept a client-submitted resource identifier by sending an IQ stanza of type "set" containing a &lt;bind/&gt; element with a child &lt;resource/&gt; element containing non-zero-length XML character data.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq id='bind_2' type='set'&gt;
     &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;resource&gt;balcony&lt;/resource&gt;
     &lt;/bind&gt;
   &lt;/iq&gt;
</pre></div>
<p>The server MUST either accept the client-submitted resource identifier or generate a random resource identifier for the client.
</p>
<p>If the server accept the client-submitted resource identifier, it MUST return an IQ stanza of type "result" to the client, including a &lt;jid/&gt; child element that specifies the full JID for the connected resource and contains without modification the client-submitted text.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq id='bind_2' type='result'&gt;
    &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
      &lt;jid&gt;juliet@im.example.com/balcony&lt;/jid&gt;
    &lt;/bind&gt;
   &lt;/iq&gt;
</pre></div>
<p>If the server generates a resource identifier on behalf of the client, it MUST so generate the resource identifier, which SHOULD incorporate the human-friendly text submitted by the client.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq id='bind_2' type='result'&gt;
    &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
      &lt;jid&gt;
   juliet@im.example.com/balcony 4db06f06-1ea4-11dc-aca3-000bcd821bfb
      &lt;/jid&gt;
    &lt;/bind&gt;
   &lt;/iq&gt;
</pre></div>
<a name="bind-clientsubmit-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5.2"></a><h3>8.5.2.&nbsp;
Error Cases</h3>

<p>When a client attempts to submit its own XMPP resource identifier during resource binding, the following stanza error conditions are possible in addition to those described under <a class='info' href='#bind-servergen-error'>Section&nbsp;8.4.2<span> (</span><span class='info'>Error Cases</span><span>)</span></a>:
</p>
<p>
          </p>
<ul class="text">
<li>The provided resource identifier cannot be processed by the server, e.g. because it is not in accordance with the <a class='info' href='#resourceprep'>Resourceprep<span> (</span><span class='info'>Resourceprep</span><span>)</span></a> profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>).
</li>
<li>The provided resource identifier is already in use.
</li>
</ul><p>
        
</p>
<a name="bind-clientsubmit-error-badrequest"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5.2.1"></a><h3>8.5.2.1.&nbsp;
Bad Request</h3>

<p>If the provided resource identifier cannot be processed by the server, the server MAY return a &lt;bad-request/&gt; error (but SHOULD instead apply the <a class='info' href='#resourceprep'>Resourceprep<span> (</span><span class='info'>Resourceprep</span><span>)</span></a> profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> or otherwise process the resource identifier so that it is in conformance).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq id='bind_2' type='error'&gt;
     &lt;error type='modify'&gt;
       &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<a name="bind-clientsubmit-error-conflict"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5.2.2"></a><h3>8.5.2.2.&nbsp;
Conflict</h3>

<p>If there is already a connected resource of the same name, the server MUST do one of the following:
</p>
<p>
            </p>
<ol class="text">
<li>Not accept the resource identifier provided by the client but instead override it with an XMPP resource identifier that the server generates.
</li>
<li>Terminate the current resource and allow the newly-requested resource.
</li>
<li>Disallow the newly-requested resource and maintain the current resource.
</li>
</ol><p>
          
</p>
<p>Which of these the server does is up to the implementation, although it is RECOMMENDED to implement case #1.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq id='bind_2' type='result'&gt;
    &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
      &lt;jid&gt;
   juliet@im.example.com/balcony 4db06f06-1ea4-11dc-aca3-000bcd821bfb
      &lt;/jid&gt;
    &lt;/bind&gt;
   &lt;/iq&gt;
</pre></div>
<p>In case #2, the server MUST send a &lt;conflict/&gt; stream error to the current resource and return an IQ stanza of type "result" (indicating success) to the newly-requested resource.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq id='bind_2' type='result'/&gt;
</pre></div>
<p>In case #3, the server MUST send a &lt;conflict/&gt; stanza error to the newly-requested resource but maintain the XML stream for that connection so that the newly-requested resource has an opportunity to negotiate a non-conflicting resource identifier before sending another request for resource binding.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq id='bind_2' type='error'&gt;
     &lt;error type='modify'&gt;
       &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<a name="bind-clientsubmit-retries"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5.3"></a><h3>8.5.3.&nbsp;
Retries</h3>

<p>If an error occurs when a client submits a resource identifier, the server SHOULD allow a configurable but reasonable number of retries (at least 2 and no more than 5); this enables the client to tolerate incorrectly-provided resource identifiers (e.g., bad data formats or duplicate text strings) without being forced to reconnect.
</p>
<p>After the client has reached the retry limit, the server MUST return a &lt;policy-violation/&gt; stream error to the client.
</p>
<a name="bind-multi"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6"></a><h3>8.6.&nbsp;
Binding Multiple Resources</h3>

<p>A server MAY support binding of multiple resources to the same stream.  This functionality is desirable in certain environments (e.g., for devices that are unable to open more than one TCP connection or when a machine runs a local XMPP client daemon that is used by multiple applications).
</p>
<a name="bind-multi-support"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6.1"></a><h3>8.6.1.&nbsp;
Support</h3>

<p>If a server supports binding of multiple resources to a stream, it MUST enable a client to unbind resources.  A server that supports unbinding MUST also support binding of multiple resources.  Thus a client can discover whether a server supports binding of multiple resources by determining if the server advertises a stream feature of &lt;unbind/&gt;, as follows.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;stream:features&gt;
     &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;required/&gt;
     &lt;/bind&gt;
     &lt;unbind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;optional/&gt;
     &lt;/unbind&gt;
   &lt;/stream:features&gt;
</pre></div>
<p>If a server supports binding of mulitple resources, it MUST also send the unbind feature advertisement after resource binding has been completed.
</p>
<a name="bind-multi-bind"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6.2"></a><h3>8.6.2.&nbsp;
Binding an Additional Resource</h3>

<p>A connected client binds an additional resource by following the protocol for binding of the original resource, i.e., by sending an IQ stanza of type "set" containing a &lt;bind/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-bind' namespace (either empty to request server generation of the resource identifier or containing a &lt;resource/&gt; element with XML character data to request a client-submitted resource identifier).
</p>
<a name="bind-multi-unbind"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6.3"></a><h3>8.6.3.&nbsp;
Unbinding a Resource</h3>

<a name="bind-multi-unbind-success"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6.3.1"></a><h3>8.6.3.1.&nbsp;
Success Case</h3>

<p>A client unbinds a resource by sending an IQ stanza of type "set" containing an &lt;unbind/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-bind' namespace, which in turn contains a child element of &lt;resource/&gt; whose XML character data specifies the resource to be unbound:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq id='unbind_1' type='set'&gt;
     &lt;unbind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;resource&gt;someresource&lt;/resource&gt;
     &lt;/unbind&gt;
   &lt;/iq&gt;
</pre></div>
<p>If no error occurs, the server MUST unbind the resource and no longer accept stanzas whose 'from' address specifies the full JID associated with that resource.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq id='unbind_1' type='result'/&gt;
</pre></div>
<p>When a client unbinds the only resource associated with the stream, the server SHOULD close the stream and terminate the TCP connection.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq id='unbind_1' type='result'/&gt;

S: &lt;/stream:stream&gt;
</pre></div>
<a name="bind-multi-unbind-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6.3.2"></a><h3>8.6.3.2.&nbsp;
Error Cases</h3>

<a name="bind-multi-unbind-badrequest"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6.3.2.1"></a><h3>8.6.3.2.1.&nbsp;
Unbind Not Supported</h3>

<p>If the server understands the 'urn:ietf:params:xml:ns:xmpp-bind' namespace but does not understand the &lt;unbind/&gt; element, it MUST return a stanza error, which MUST be &lt;feature-not-implemented/&gt;.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq id='unbind_1' type='error'&gt;
     &lt;error type='modify'&gt;
       &lt;feature-not-implemented
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<a name="bind-multi-unbind-itemnotfound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6.3.2.2"></a><h3>8.6.3.2.2.&nbsp;
No Such Resource</h3>

<p>If there is no such resource for that stream, the server MUST return an error of &lt;item-not-found/&gt;.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq id='unbind_1' type='error'&gt;
     &lt;error type='cancel'&gt;
       &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<a name="bind-multi-from"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6.4"></a><h3>8.6.4.&nbsp;
From Addresses</h3>

<p>When a client binds multiple resources to the same stream, proper management of 'from' addresses is imperative.  In particular, a client MUST specify a 'from' address on every stanza it sends over a stream to which it has bound multiple resources, where the 'from' address is the full JID (&lt;node@domain.tld/resource&gt;) associated with the relevant resource.  If a client does not specify a 'from' address on a stanza it sends over a stream to which it has bound multiple resources, the server MUST return the stanza to the client with an &lt;unknown-sender/&gt; stanza error.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;message to='romeo@example.net'&gt;
     &lt;body&gt;Wherefore art thou?&lt;/body&gt;
   &lt;/message&gt;

S: &lt;message from='romeo@example.net'
            type='error'&gt;
     &lt;body&gt;Wherefore art thou?&lt;/body&gt;
     &lt;error type='modify'&gt;
       &lt;unknown-sender xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/message&gt;
</pre></div>
<p>Naturally, the rules regarding validation of asserted 'from' addresses still apply (see <a class='info' href='#rules'>Section&nbsp;11<span> (</span><span class='info'>Server Rules for Processing XML Stanzas</span><span>)</span></a>).
</p>
<a name="stanzas"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
XML Stanzas</h3>

<p>After a client has connected to a server or two servers have connected to each other, either party can send XML stanzas over the negotiated stream.  Three kinds of XML stanza are defined for the 'jabber:client' and 'jabber:server' namespaces: &lt;message/&gt;, &lt;presence/&gt;, and &lt;iq/&gt;.  In addition, there are five common attributes for these stanza types.  These common attributes, as well as the basic semantics of the three stanza types, are defined herein; more detailed information regarding the syntax of XML stanzas for instant messaging and presence applications is provided in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a>, and for other applications in the relevant XMPP extension specifications.
</p>
<p>A server MUST NOT process a partial stanza and MUST NOT attach meaning to the transmission timing of any part of a stanza (before receipt of the close tag).
</p>
<p>Support for the XML stanza syntax and semantics defined herein is REQUIRED in XMPP client and server implementations.
</p>
<a name="stanzas-attributes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
Common Attributes</h3>

<p>The following five attributes are common to message, presence, and IQ stanzas.
</p>
<a name="stanzas-attributes-to"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.1"></a><h3>9.1.1.&nbsp;
to</h3>

<p>The 'to' attribute specifies the JID of the intended recipient for the stanza.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;message to='romeo@example.net'&gt;
  &lt;body&gt;Art thou not Romeo, and a Montague?&lt;/body&gt;
&lt;/message&gt;
</pre></div>
<p>For information about server processing of inbound and outbound XML stanzas based on the nature of the 'to' address, refer to <a class='info' href='#rules'>Section&nbsp;11<span> (</span><span class='info'>Server Rules for Processing XML Stanzas</span><span>)</span></a>.
</p>
<a name="stanzas-attributes-to-c2s"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.1.1"></a><h3>9.1.1.1.&nbsp;
Client-to-Server Streams</h3>

<p>The following rules apply to inclusion of the 'to' attribute in the context of XML streams qualified by the 'jabber:client' namespace (i.e., client-to-server streams).
</p>
<p>
            </p>
<ol class="text">
<li>A stanza with a specific intended recipient MUST possess a 'to' attribute whose value is an XMPP address.
</li>
<li>A stanza sent from a client to a server for direct processing by the server on behalf of the client (e.g., presence sent to the server for broadcasting to other entities) MUST NOT possess a 'to' attribute.
</li>
</ol><p>
          
</p>
<a name="stanzas-attributes-to-s2s"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.1.2"></a><h3>9.1.1.2.&nbsp;
Server-to-Server Streams</h3>

<p>The following rules apply to inclusion of the 'to' attribute in the context of XML streams qualified by the 'jabber:server' namespace (i.e., server-to-server streams).
</p>
<p>
            </p>
<ol class="text">
<li>A stanza MUST possess a 'to' attribute whose value is an XMPP address; if a server receives a stanza that does not meet this restriction, it MUST generate an &lt;improper-addressing/&gt; stream error.
</li>
<li>The domain identifier portion of the JID in the 'to' atttribute MUST match a hostname serviced by the receiving server; if a server receives a stanza that does not meet this restriction, it MUST generate a &lt;host-unknown/&gt; or &lt;host-gone/&gt; stream error.
</li>
</ol><p>
          
</p>
<a name="stanzas-attributes-from"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.2"></a><h3>9.1.2.&nbsp;
from</h3>

<p>The 'from' attribute specifies the JID of the sender.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;message from='juliet@im.example.com/balcony'
         to='romeo@example.net'&gt;
  &lt;body&gt;Art thou not Romeo, and a Montague?&lt;/body&gt;
&lt;/message&gt;
</pre></div>
<a name="stanzas-attributes-from-c2s"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.2.1"></a><h3>9.1.2.1.&nbsp;
Client-to-Server Streams</h3>

<p>The following rules apply to the 'from' attribute in the context of XML streams qualified by the 'jabber:client' namespace (i.e., client-to-server streams).
</p>
<p>
            </p>
<ol class="text">
<li>When the server receives an XML stanza from a client and the stanza does not include a 'from' attribute, the server MUST add a 'from' attribute to the stanza, where the value of the 'from' attribute is the full JID (&lt;node@domain/resource&gt;) determined by the server for the connected resource that generated the stanza (see <a class='info' href='#addressing-determination'>Section&nbsp;3.5<span> (</span><span class='info'>Determination of Addresses</span><span>)</span></a>), or the bare JID (&lt;node@domain&gt;) in the case of subscription-related presence stanzas (see <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a>); the only exception to this rule occurs when multiple resources are bound to the same stream as described under <a class='info' href='#bind-multi'>Section&nbsp;8.6<span> (</span><span class='info'>Binding Multiple Resources</span><span>)</span></a>.
</li>
<li>When the server receives an XML stanza from a client and the stanza includes a 'from' attribute, the server MUST either (a) validate that the value of the 'from' attribute provided by the client is that of a connected resource for the associated entity or (b) override the provided 'from' attribute by adding a 'from' attribute as specified under Rule #1.
</li>
<li>When the server generates a stanza from the server for delivery to the client on behalf of the account of the connected client (e.g., in the context of data storage services provided by the server on behalf of the client), the stanza MUST either (a) not include a 'from' attribute or (b) include a 'from' attribute whose value is the account's bare JID (&lt;node@domain&gt;).
</li>
<li>When the server generates a stanza from the server itself for delivery to the client, the stanza MUST include a 'from' attribute whose value is the bare JID (i.e., &lt;domain&gt;) of the server.
</li>
<li>A server MUST NOT send to the client a stanza without a 'from' attribute if the stanza was not generated by the server (e.g., if it was generated by another client or another server); therefore, when a client receives a stanza that does not include a 'from' attribute, it MUST assume that the stanza is from the server to which the client is connected.
</li>
</ol><p>
          
</p>
<a name="stanzas-attributes-from-s2s"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.2.2"></a><h3>9.1.2.2.&nbsp;
Server-to-Server Streams</h3>

<p>The following rules apply to the 'from' attribute in the context of XML streams qualified by the 'jabber:server' namespace (i.e., server-to-server streams).
</p>
<p>
            </p>
<ol class="text">
<li>A stanza MUST possess a 'from' attribute whose value is an XMPP address; if a server receives a stanza that does not meet this restriction, it MUST generate an &lt;improper-addressing/&gt; stream error.
</li>
<li>The domain identifier portion of the JID contained in the 'from' attribute MUST match the hostname of the sending server (or any validated domain thereof) as communicated in the SASL negotiation (see <a class='info' href='#sasl'>Section&nbsp;7<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>), server dialback (see <a class='info' href='#XEP-0220'>[XEP&#8209;0220]<span> (</span><span class='info'>Saint-Andre, P. and J. Miller, &ldquo;Server Dialback,&rdquo; June&nbsp;2008.</span><span>)</span></a>, or similar means; if a server receives a stanza that does not meet this restriction, it MUST generate an &lt;invalid-from/&gt; stream error.
</li>
</ol><p>
          
</p>
<p>Enforcement of these rules helps to prevent certain denial of service attacks as described under <a class='info' href='#security-dos'>Section&nbsp;15.12<span> (</span><span class='info'>Denial of Service</span><span>)</span></a>.
</p>
<a name="stanzas-attributes-id"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.3"></a><h3>9.1.3.&nbsp;
id</h3>

<p>The 'id' attribute MAY be used by a sending entity for internal tracking of stanzas that it sends and receives (especially for tracking the request-response interaction inherent in the semantics of IQ stanzas).  The value of the 'id' attribute MAY be unique globally, within a domain, or within a stream.  The semantics of IQ stanzas impose additional restrictions; see <a class='info' href='#stanzas-semantics-iq'>Section&nbsp;9.2.3<span> (</span><span class='info'>IQ Semantics</span><span>)</span></a>.
</p>
<a name="stanzas-attributes-type"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.4"></a><h3>9.1.4.&nbsp;
type</h3>

<p>The 'type' attribute specifies the purpose or context of the message, presence, or IQ stanza.  The particular allowable values for the 'type' attribute vary depending on whether the stanza is a message, presence, or IQ stanza.  The defined values for message and presence stanzas are specific to instant messaging and presence applications and therefore are specified in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a>, whereas the values for IQ stanzas specify the role of an IQ stanza in a structured request-response exchange and therefore are specified under <a class='info' href='#stanzas-semantics-iq'>Section&nbsp;9.2.3<span> (</span><span class='info'>IQ Semantics</span><span>)</span></a>.  The only 'type' value common to all three stanzas is "error"; see <a class='info' href='#stanzas-error'>Section&nbsp;9.3<span> (</span><span class='info'>Stanza Errors</span><span>)</span></a>.
</p>
<a name="stanzas-attributes-lang"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.5"></a><h3>9.1.5.&nbsp;
xml:lang</h3>

<p>A stanza SHOULD possess an 'xml:lang' attribute (as defined in Section 2.12 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>) if the stanza contains XML character data that is intended to be presented to a human user (as explained in <a class='info' href='#CHARSET'>[CHARSET]<span> (</span><span class='info'>Alvestrand, H., &ldquo;IETF Policy on Character Sets and Languages,&rdquo; January&nbsp;1998.</span><span>)</span></a>, "internationalization is for humans").  The value of the 'xml:lang' attribute specifies the default language of any such human-readable XML character data.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;presence from='romeo@example.net/orchard' xml:lang='en'&gt;
  &lt;show&gt;dnd&lt;/show&gt;
  &lt;status&gt;Wooing Juliet&lt;/status&gt;
&lt;/presence&gt;
</pre></div>
<p>The value of the 'xml:lang' attribute MAY be overridden by the 'xml:lang' attribute of a specific child element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;presence from='romeo@example.net/orchard' xml:lang='en'&gt;
  &lt;show&gt;dnd&lt;/show&gt;
  &lt;status&gt;Wooing Juliet&lt;/status&gt;
  &lt;status xml:lang='cs'&gt;Dvo&amp;#x0159;&amp;#x00ED;m se Julii&lt;/status&gt;
&lt;/presence
</pre></div>
<p>If an outbound stanza generated by a client does not possess an 'xml:lang' attribute, the client's server SHOULD add an 'xml:lang' attribute whose value is that specified for the stream as defined under <a class='info' href='#streams-attr-xmllang'>Section&nbsp;5.3.4<span> (</span><span class='info'>xml:lang</span><span>)</span></a>.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;presence from='romeo@example.net/orchard'&gt;
     &lt;show&gt;dnd&lt;/show&gt;
     &lt;status&gt;Wooing Juliet&lt;/status&gt;
   &lt;/presence&gt;

S: &lt;presence from='romeo@example.net/orchard'
             to='juliet@im.example.com'
             xml:lang='en'&gt;
     &lt;show&gt;dnd&lt;/show&gt;
     &lt;status&gt;Wooing Juliet&lt;/status&gt;
   &lt;/presence&gt;
</pre></div>
<p>If an inbound stanza received received by a client or server does not possess an 'xml:lang' attribute, an implementation MUST assume that the default language is that specified for the stream as defined under <a class='info' href='#streams-attr-xmllang'>Section&nbsp;5.3.4<span> (</span><span class='info'>xml:lang</span><span>)</span></a>.
</p>
<p>The value of the 'xml:lang' attribute MUST conform to the NMTOKEN datatype (as defined in Section 2.3 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>) and MUST conform to the format defined in <a class='info' href='#LANGTAGS'>[LANGTAGS]<span> (</span><span class='info'>Phillips, A. and M. Davis, &ldquo;Tags for Identifying Languages,&rdquo; September&nbsp;2006.</span><span>)</span></a>.
</p>
<p>A server MUST NOT modify or delete 'xml:lang' attributes on stanzas it receives from other entities.
</p>
<a name="stanzas-semantics"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
Basic Semantics</h3>

<a name="stanzas-semantics-message"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.1"></a><h3>9.2.1.&nbsp;
Message Semantics</h3>

<p><a name='anchor17'></a>The &lt;message/&gt; stanza can be seen as a "push" mechanism whereby one entity pushes information to another entity, similar to the communications that occur in a system such as email.  All message stanzas SHOULD possess a 'to' attribute that specifies the intended recipient of the message; upon receiving such a stanza, a server SHOULD route or deliver it to the intended recipient (see <a class='info' href='#rules'>Section&nbsp;11<span> (</span><span class='info'>Server Rules for Processing XML Stanzas</span><span>)</span></a> for general routing and delivery rules related to XML stanzas).
</p>
<a name="stanzas-semantics-presence"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.2"></a><h3>9.2.2.&nbsp;
Presence Semantics</h3>

<p><a name='anchor18'></a>The &lt;presence/&gt; stanza can be seen as a specialized broadcast or "publish-subscribe" mechanism, whereby multiple entities receive information (in this case, network availability information) about an entity to which they have subscribed.  In general, a publishing entity (client) SHOULD send a presence stanza with no 'to' attribute, in which case the server to which the entity is connected SHOULD broadcast or multiplex that stanza to all subscribed entities.  However, a publishing entity MAY also send a presence stanza with a 'to' attribute, in which case the server SHOULD route or deliver that stanza to the intended recipient.  See <a class='info' href='#rules'>Section&nbsp;11<span> (</span><span class='info'>Server Rules for Processing XML Stanzas</span><span>)</span></a> for general routing and delivery rules related to XML stanzas, and <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a> for rules specific to presence applications.
</p>
<a name="stanzas-semantics-iq"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.3"></a><h3>9.2.3.&nbsp;
IQ Semantics</h3>

<p><a name='anchor19'></a>Info/Query, or IQ, is a request-response mechanism, similar in some ways to the Hypertext Transfer Protocol <a class='info' href='#HTTP'>[HTTP]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>.  The semantics of IQ enable an entity to make a request of, and receive a response from, another entity.  The data content of the request and response is defined by the schema or other structural definition associated with the XML namespace that qualifies the direct child element of the IQ element (see <a class='info' href='#stanzas-extended'>Section&nbsp;9.4<span> (</span><span class='info'>Extended Content</span><span>)</span></a>), and the interaction is tracked by the requesting entity through use of the 'id' attribute.  Thus, IQ interactions follow a common pattern of structured data exchange such as get/result or set/result (although an error may be returned in reply to a request if appropriate):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Requesting                  Responding
  Entity                      Entity
----------                  ----------
    |                            |
    | &lt;iq id='1' type='get'&gt;     |
    |   [ ... payload ... ]      |
    | &lt;/iq&gt;                      |
    | -------------------------&gt; |
    |                            |
    | &lt;iq id='1' type='result'&gt;  |
    |   [ ... payload ... ]      |
    | &lt;/iq&gt;                      |
    | &lt;------------------------- |
    |                            |
    | &lt;iq id='2' type='set'&gt;     |
    |   [ ... payload ... ]      |
    | &lt;/iq&gt;                      |
    | -------------------------&gt; |
    |                            |
    | &lt;iq id='2' type='error'&gt;   |
    |   [ ... condition ... ]    |
    | &lt;/iq&gt;                      |
    | &lt;------------------------- |
    |                            |
</pre></div>
<p>To enforce these semantics, the following rules apply:
</p>
<p></p>
<ol class="text">
<li>The 'id' attribute is REQUIRED for IQ stanzas.
</li>
<li>The 'type' attribute is REQUIRED for IQ stanzas.  The value MUST be one of the following (if the value is other than one of the following strings, the recipient or an intermediate router MUST return a stanza error of &lt;bad-request/&gt;):
            
<ul class="text">
<li>get -- The stanza is a request for information or requirements.
</li>
<li>set -- The stanza provides required data, sets new values, or replaces existing values.
</li>
<li>result -- The stanza is a response to a successful get or set request.
</li>
<li>error -- An error has occurred regarding processing or delivery of a previously-sent get or set request (see <a class='info' href='#stanzas-error'>Section&nbsp;9.3<span> (</span><span class='info'>Stanza Errors</span><span>)</span></a>).
</li>
</ul>
          
</li>
<li>An entity that receives an IQ request of type "get" or "set" MUST reply with an IQ response of type "result" or "error".  The response MUST preserve the 'id' attribute of the request.
</li>
<li>An entity that receives a stanza of type "result" or "error" MUST NOT respond to the stanza by sending a further IQ response of type "result" or "error"; however, the requesting entity MAY send another request (e.g., an IQ of type "set" to provide required information discovered through a get/result pair).
</li>
<li>An IQ stanza of type "get" or "set" MUST contain exactly one child element, which specifies the semantics of the particular request.
</li>
<li>An IQ stanza of type "result" MUST include zero or one child elements.
</li>
<li>An IQ stanza of type "error" MAY include the child element contained in the associated "get" or "set" and MUST include an &lt;error/&gt; child; for details, see <a class='info' href='#stanzas-error'>Section&nbsp;9.3<span> (</span><span class='info'>Stanza Errors</span><span>)</span></a>.
</li>
</ol>

<a name="stanzas-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3"></a><h3>9.3.&nbsp;
Stanza Errors</h3>

<p>Stanza-related errors are handled in a manner similar to <a class='info' href='#streams-error'>stream errors<span> (</span><span class='info'>Stream Errors</span><span>)</span></a>.  Unlike stream errors, stanza errors are recoverable; therefore they do not result in termination of the XML stream and underlying TCP connection.  <a name='anchor20'></a>Instead, the entity that discovers the error condition returns an ERROR STANZA to the sender, i.e., a stanza of the same kind (message, presence, or IQ) whose 'type' attribute is set to a value of "error" and which contains an &lt;error/&gt; child element that specifies the error condition.  The specified error condition provides a hint regarding actions that the sender can take to remedy the error if possible.
</p>
<a name="stanzas-error-rules"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.1"></a><h3>9.3.1.&nbsp;
Rules</h3>

<p>The following rules apply to stanza errors:
</p>
<p></p>
<ol class="text">
<li>The receiving or processing entity that detects an error condition in relation to a stanza SHOULD return an error stanza (and MUST do so for IQ stanzas).
</li>
<li>The entity that generates an error stanza MAY include the original XML sent so that the sender can inspect and, if necessary, correct the XML before attempting to resend.
</li>
<li>An error stanza MUST contain an &lt;error/&gt; child element.
</li>
<li>An &lt;error/&gt; child MUST NOT be included if the 'type' attribute has a value other than "error" (or if there is no 'type' attribute).
</li>
<li>An entity that receives an error stanza MUST NOT respond to the stanza with a further error stanza; this helps to prevent looping.
</li>
</ol>

<a name="stanzas-error-syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.2"></a><h3>9.3.2.&nbsp;
Syntax</h3>

<p>The syntax for stanza-related errors is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stanza-kind from='intended-recipient' to='sender' type='error'&gt;
  [OPTIONAL to include sender XML here]
  &lt;error type='error-type'&gt;
    &lt;defined-condition xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    [&lt;text xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'
          xml:lang='langcode'&gt;
      OPTIONAL descriptive text
    &lt;/text&gt;]
    [OPTIONAL application-specific condition element]
  &lt;/error&gt;
&lt;/stanza-kind&gt;
</pre></div>
<p>The "stanza-kind" MUST be one of message, presence, or iq.
</p>
<p>The "error-type MUST be one of the following:
</p>
<p>
          </p>
<ul class="text">
<li>auth -- retry after providing credentials
</li>
<li>cancel -- do not retry (the error cannot be remedied)
</li>
<li>continue -- proceed (the condition was only a warning)
</li>
<li>modify -- retry after changing the data sent
</li>
<li>wait -- retry after waiting (the error is temporary)
</li>
</ul><p>
        
</p>
<p>The &lt;error/&gt; element:
</p>
<p></p>
<ul class="text">
<li>MUST contain a child element corresponding to one of the stanza error conditions defined under <a class='info' href='#stanzas-error-conditions'>Section&nbsp;9.3.3<span> (</span><span class='info'>Defined Conditions</span><span>)</span></a>; this element MUST be qualified by the 'urn:ietf:params:xml:ns:xmpp-stanzas' namespace.
</li>
<li>MAY contain a &lt;text/&gt; child element containing XML character data that describes the error in more detail; this element MUST be qualified by the 'urn:ietf:params:xml:ns:xmpp-stanzas' namespace and SHOULD possess an 'xml:lang' attribute specifying the natural language of the XML character data.
</li>
<li>MAY contain a child element for an application-specific error condition; this element MUST be qualified by an application-specific namespace that defines the syntax and semantics of the element.
</li>
</ul>

<p>The &lt;text/&gt; element is OPTIONAL.  If included, it MUST be used only to provide descriptive or diagnostic information that supplements the meaning of a defined condition or application-specific condition.  It MUST NOT be interpreted programmatically by an application.  It MUST NOT be used as the error message presented to a human user, but MAY be shown in addition to the error message associated with the defined condition element (and, optionally, the application-specific condition element).
</p>
<a name="stanzas-error-conditions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3"></a><h3>9.3.3.&nbsp;
Defined Conditions</h3>

<p>The following conditions are defined for use in stanza errors.
</p>
<a name="stanzas-error-conditions-bad-request"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.1"></a><h3>9.3.3.1.&nbsp;
bad-request</h3>

<p>The sender has sent a stanza containing XML that does not conform to the appropriate schema or that cannot be processed (e.g., an IQ stanza that includes an unrecognized value of the 'type' attribute, or an element that is qualified by a recognized namespace but that violates the defined syntax for the element); the associated error type SHOULD be "modify".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@im.example.com/balcony'
       id='some-id'
       to='im.example.com'
       type='subscribe'&gt;
     &lt;ping xmlns='urn:xmpp:ping'/&gt;
   &lt;/iq&gt;

S: &lt;iq from='im.example.com'
       id='some-id'
       to='juliet@im.example.com/balcony'
       type='error'&gt;
     &lt;error type='modify'&gt;
       &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<a name="stanzas-error-conditions-conflict"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.2"></a><h3>9.3.3.2.&nbsp;
conflict</h3>

<p>Access cannot be granted because an existing resource exists with the same name or address; the associated error type SHOULD be "cancel".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq id='bind_2' type='set'&gt;
     &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;resource&gt;balcony&lt;/resource&gt;
     &lt;/bind&gt;
   &lt;/iq&gt;

S: &lt;iq id='bind_2' type='error'&gt;
     &lt;error type='cancel'&gt;
       &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<a name="stanzas-error-conditions-feature-not-implemented"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.3"></a><h3>9.3.3.3.&nbsp;
feature-not-implemented</h3>

<p>The feature represented in the XML stanza is not implemented by the intended recipient or an intermediate server and therefore the stanza cannot be processed (e.g., the entity understands the namespace but does not recognize the element name); the associated error type SHOULD be "cancel" or "modify".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@im.example.com/balcony'
       id='subscriptions1'
       to='pubsub.example.com'
       type='get'&gt;
     &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
       &lt;subscriptions/&gt;
     &lt;/pubsub&gt;
   &lt;/iq&gt;

E: &lt;iq from='pubsub.example.com
       id='subscriptions1'
       to='juliet@im.example.com/balcony'
       type='error'&gt;
     &lt;error type='cancel'&gt;
       &lt;feature-not-implemented
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
       &lt;unsupported
           xmlns='http://jabber.org/protocol/pubsub#errors'
           feature='retrieve-subscriptions'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<a name="stanzas-error-conditions-forbidden"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.4"></a><h3>9.3.3.4.&nbsp;
forbidden</h3>

<p>The requesting entity does not possess the required permissions to perform the action; the associated error type SHOULD be "auth".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;presence
       from='juliet@im.example.com/balcony'
       to='characters@muc.example.com/JulieC'&gt;
     &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
   &lt;/presence&gt;

E: &lt;presence
       from='characters@muc.example.com/JulieC'
       to='juliet@im.example.com/balcony'
       type='error'&gt;
     &lt;error type='auth'&gt;
       &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/presence&gt;
</pre></div>
<a name="stanzas-error-conditions-gone"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.5"></a><h3>9.3.3.5.&nbsp;
gone</h3>

<p>The recipient or server can no longer be contacted at this address, typically on a permanent basis, and no updated address is available for forwarding or redirection; the associated error type SHOULD be "cancel" or "modify" and the error stanza SHOULD include a new address as the XML character data of the &lt;gone/&gt; element (which MUST be a URI or IRI at which the entity can be contacted, typically an XMPP IRI as specified in <a class='info' href='#XMPP-URI'>[XMPP&#8209;URI]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Internationalized Resource Identifiers (IRIs) and Uniform Resource Identifiers (URIs) for the Extensible Messaging and Presence Protocol (XMPP),&rdquo; February&nbsp;2008.</span><span>)</span></a>).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;presence
       from='juliet@im.example.com/balcony'
       to='characters@muc.example.com/JulieC'&gt;
     &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
   &lt;/presence&gt;

E: &lt;presence
       from='characters@muc.example.com/JulieC'
       to='juliet@im.example.com/balcony'
       type='error'&gt;
     &lt;error type='modify'&gt;
       &lt;gone xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'&gt;
         xmpp:conference.example.com
       &lt;/gone&gt;
     &lt;/error&gt;
   &lt;/presence&gt;
</pre></div>
<a name="stanzas-error-conditions-internal-server-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.6"></a><h3>9.3.3.6.&nbsp;
internal-server-error</h3>

<p>The server could not process the stanza because of a misconfiguration or an otherwise-undefined internal server error; the associated error type SHOULD be "wait" or "cancel".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;presence
       from='juliet@im.example.com/balcony'
       to='characters@muc.example.com/JulieC'&gt;
     &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
   &lt;/presence&gt;

E: &lt;presence
       from='characters@muc.example.com/JulieC'
       to='juliet@im.example.com/balcony'
       type='error'&gt;
     &lt;error type='wait'&gt;
       &lt;internal-server-error
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/presence&gt;
</pre></div>
<a name="stanzas-error-conditions-item-not-found"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.7"></a><h3>9.3.3.7.&nbsp;
item-not-found</h3>

<p>The addressed JID or item requested cannot be found; the associated error type SHOULD be "cancel" or "modify".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq id='unbind_1' type='set'&gt;
     &lt;unbind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;resource&gt;someresource&lt;/resource&gt;
     &lt;/unbind&gt;
   &lt;/iq&gt;

S: &lt;iq id='unbind_1' type='error'&gt;
     &lt;error type='cancel'&gt;
       &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<p></p>
<blockquote class="text">
<p>Note: An application MUST NOT return this error if doing so would provide information about the intended recipient's network availability to an entity that is not authorized to know such information; instead it MUST return a &lt;service-unavailable/&gt; error.
</p>
</blockquote>

<a name="stanzas-error-conditions-jid-malformed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.8"></a><h3>9.3.3.8.&nbsp;
jid-malformed</h3>

<p>The sending entity has provided or communicated an XMPP address (e.g., a value of the 'to' attribute) or aspect thereof (e.g., an XMPP resource identifier) that does not adhere to the syntax defined under <a class='info' href='#addressing'>Section&nbsp;3<span> (</span><span class='info'>Addresses</span><span>)</span></a>; the associated error type SHOULD be "modify".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;presence
       from='juliet@im.example.com/balcony'
       to='ch@r@cters@muc.example.com/JulieC'&gt;
     &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
   &lt;/presence&gt;

E: &lt;presence
       from='ch@r@cters@muc.example.com/JulieC'
       to='juliet@im.example.com/balcony'
       type='error'&gt;
     &lt;error type='modify'&gt;
       &lt;jid-malformed
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/presence&gt;
</pre></div>
<a name="stanzas-error-conditions-not-acceptable"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.9"></a><h3>9.3.3.9.&nbsp;
not-acceptable</h3>

<p>The recipient or server understands the request but is refusing to process it because it does not meet criteria defined by the recipient or server (e.g., a local policy regarding stanza size limits or acceptable words in messages); the associated error type SHOULD be "modify".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;message to='juliet@im.example.com' id='foo'&gt;
     &lt;body&gt;[ ... the-emacs-manual ... ]&lt;/body&gt;
   &lt;/message&gt;

S: &lt;message from='juliet@im.example.com' id='foo'&gt;
     &lt;error type='modify'&gt;
       &lt;not-acceptable
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/message&gt;
</pre></div>
<a name="stanzas-error-conditions-not-allowed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.10"></a><h3>9.3.3.10.&nbsp;
not-allowed</h3>

<p>The recipient or server does not allow any entity to perform the action (e.g., sending to entities at a blacklisted domain); the associated error type SHOULD be "cancel".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;presence
       from='juliet@im.example.com/balcony'
       to='characters@muc.example.com/JulieC'&gt;
     &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
   &lt;/presence&gt;

E: &lt;presence
       from='characters@muc.example.com/JulieC'
       to='juliet@im.example.com/balcony'&gt;
     &lt;error type='cancel'&gt;
       &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/presence&gt;
</pre></div>
<a name="stanzas-error-conditions-not-authorized"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.11"></a><h3>9.3.3.11.&nbsp;
not-authorized</h3>

<p>The sender must provide proper credentials before being allowed to perform the action, or has provided improper credentials; the associated error type SHOULD be "auth".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;presence
       from='juliet@im.example.com/balcony'
       to='characters@muc.example.com/JulieC'&gt;
     &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
   &lt;/presence&gt;

E: &lt;presence
       from='characters@muc.example.com/JulieC'
       to='juliet@im.example.com/balcony'&gt;
     &lt;error type='auth'&gt;
       &lt;not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/presence&gt;
</pre></div>
<a name="stanzas-error-conditions-not-modified"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.12"></a><h3>9.3.3.12.&nbsp;
not-modified</h3>

<p>The item requested has not changed since it was last requested; the associated error type SHOULD be "continue".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@capulet.com/balcony'
       id='roster2'
       type='get'&gt;
    &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
         &lt;header name='If-None-Match'&gt;
           some-long-opaque-string
         &lt;/header&gt;
       &lt;/headers&gt;
    &lt;/query&gt;
   &lt;/iq&gt;

S: &lt;iq type='error'
       to='juliet@capulet.com/balcony'
       id='roster2'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
         &lt;header name='If-None-Match'&gt;
           some-long-opaque-string
         &lt;/header&gt;
       &lt;/headers&gt;
     &lt;/query&gt;
     &lt;error type='modify'&gt;
       &lt;not-modified xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<a name="stanzas-error-conditions-payment-required"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.13"></a><h3>9.3.3.13.&nbsp;
payment-required</h3>

<p>The requesting entity is not authorized to access the requested service because payment is required; the associated error type SHOULD be "auth".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='romeo@example.net/foo'
       id='items1'
       to='pubsub.example.com'
       type='get'&gt;
     &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
       &lt;items node='my_musings'/&gt;
     &lt;/pubsub&gt;
   &lt;/iq&gt;

E: &lt;iq from='pubsub.example.com'
       id='items1'
       to='romeo@example.net/foo'
       type='error'&gt;
     &lt;error type='auth'&gt;
       &lt;payment-required
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<a name="stanzas-error-conditions-recipient-unavailable"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.14"></a><h3>9.3.3.14.&nbsp;
recipient-unavailable</h3>

<p>The intended recipient is temporarily unavailable; the associated error type SHOULD be "wait".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;presence
       from='juliet@im.example.com/balcony'
       to='characters@muc.example.com/JulieC'&gt;
     &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
   &lt;/presence&gt;

E: &lt;presence
       from='characters@muc.example.com/JulieC'
       to='juliet@im.example.com/balcony'&gt;
     &lt;error type='wait'&gt;
       &lt;recipient-unavailable
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/presence&gt;
</pre></div>
<p></p>
<blockquote class="text">
<p>Note: An application MUST NOT return this error if doing so would provide information about the intended recipient's network availability to an entity that is not authorized to know such information; instead it MUST return a &lt;service-unavailable/&gt; error.
</p>
</blockquote>

<a name="stanzas-error-conditions-redirect"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.15"></a><h3>9.3.3.15.&nbsp;
redirect</h3>

<p>The recipient or server is redirecting requests for this information to another entity, typically in a temporary fashion (the &lt;gone/&gt; condition is used for permanent addressing failures); the associated error type SHOULD be "modify" and the error stanza SHOULD contain the alternate address in the XML character data of the &lt;redirect/&gt; element (which MUST be a URI or IRI at which the entity can be contacted, typically an XMPP IRI as specified in <a class='info' href='#XMPP-URI'>[XMPP&#8209;URI]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Internationalized Resource Identifiers (IRIs) and Uniform Resource Identifiers (URIs) for the Extensible Messaging and Presence Protocol (XMPP),&rdquo; February&nbsp;2008.</span><span>)</span></a>).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;presence
       from='juliet@im.example.com/balcony'
       to='characters@muc.example.com/JulieC'&gt;
     &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
   &lt;/presence&gt;

E: &lt;presence
       from='characters@muc.example.com/JulieC'
       to='juliet@im.example.com/balcony'
       type='error'&gt;
     &lt;error type='modify'&gt;
       &lt;redirect xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'&gt;
         xmpp:characters@conference.example.org
       &lt;/redirect&gt;
     &lt;/error&gt;
   &lt;/presence&gt;
</pre></div>
<a name="stanzas-error-conditions-registration-required"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.16"></a><h3>9.3.3.16.&nbsp;
registration-required</h3>

<p>The requesting entity is not authorized to access the requested service because prior registration is required; the associated error type SHOULD be "auth".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;presence
       from='juliet@im.example.com/balcony'
       to='characters@muc.example.com/JulieC'&gt;
     &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
   &lt;/presence&gt;

E: &lt;presence
       from='characters@muc.example.com/JulieC'
       to='juliet@im.example.com/balcony'&gt;
     &lt;error type='auth'&gt;
       &lt;registration-required
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/presence&gt;
</pre></div>
<a name="stanzas-error-conditions-remote-server-not-found"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.17"></a><h3>9.3.3.17.&nbsp;
remote-server-not-found</h3>

<p>A remote server or service specified as part or all of the JID of the intended recipient does not exist; the associated error type SHOULD be "cancel".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;presence
       from='juliet@im.example.com/balcony'
       to='characters@muc.example.com/JulieC'&gt;
     &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
   &lt;/presence&gt;

E: &lt;presence
       from='characters@muc.example.com/JulieC'
       to='juliet@im.example.com/balcony'&gt;
     &lt;error type='wait'&gt;
       &lt;remote-server-not-found
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/presence&gt;
</pre></div>
<a name="stanzas-error-conditions-remote-server-timeout"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.18"></a><h3>9.3.3.18.&nbsp;
remote-server-timeout</h3>

<p>A remote server or service specified as part or all of the JID of the intended recipient (or required to fulfill a request) could not be contacted within a reasonable amount of time; the associated error type SHOULD be "wait".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;presence
       from='juliet@im.example.com/balcony'
       to='characters@muc.example.com/JulieC'&gt;
     &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;
   &lt;/presence&gt;

E: &lt;presence
       from='characters@muc.example.com/JulieC'
       to='juliet@im.example.com/balcony'&gt;
     &lt;error type='wait'&gt;
       &lt;remote-server-timeout
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/presence&gt;
</pre></div>
<a name="stanzas-error-conditions-resource-constraint"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.19"></a><h3>9.3.3.19.&nbsp;
resource-constraint</h3>

<p>The server or recipient lacks the system resources necessary to service the request; the associated error type SHOULD be "wait".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='romeo@example.net/foo'
       id='items1'
       to='pubsub.example.com'
       type='get'&gt;
     &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
       &lt;items node='my_musings'/&gt;
     &lt;/pubsub&gt;
   &lt;/iq&gt;

E: &lt;iq from='pubsub.example.com'
       id='items1'
       to='romeo@example.net/foo'
       type='error'&gt;
     &lt;error type='wait'&gt;
       &lt;resource-constraint
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<a name="stanzas-error-conditions-service-unavailable"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.20"></a><h3>9.3.3.20.&nbsp;
service-unavailable</h3>

<p>The server or recipient does not currently provide the requested service; the associated error type SHOULD be "cancel".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;message from='romeo@example.net/foo'
            to='juliet@im.example.com'&gt;
     &lt;body&gt;Hello?&lt;/body&gt;
   &lt;/message&gt;

S: &lt;message from='juliet@im.example.com/foo'
            to='romeo@example.net'&gt;
     &lt;error type='cancel'&gt;
       &lt;service-unavailable
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/message&gt;
</pre></div>
<p>An application MUST return a &lt;service-unavailable/&gt; error instead of &lt;item-not-found/&gt; or &lt;recipient-unavailable/&gt; if sending one of the latter errors would provide information about the intended recipient's network availability to an entity that is not authorized to know such information.
</p>
<a name="stanzas-error-conditions-subscription-required"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.21"></a><h3>9.3.3.21.&nbsp;
subscription-required</h3>

<p>The requesting entity is not authorized to access the requested service because a prior subscription is required; the associated error type SHOULD be "auth".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;message
       from='romeo@example.net/orchard'
       to='playbot@shakespeare.example.com'
     &lt;body&gt;help&lt;/body&gt;
   &lt;/message&gt;

E: &lt;message
      from='playbot@shakespeare.example.com'
      to='romeo@example.net/orchard'
      type='error'&gt;
     &lt;error type='auth'&gt;
       &lt;subscription-required
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/message&gt;
</pre></div>
<a name="stanzas-error-conditions-undefined-condition"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.22"></a><h3>9.3.3.22.&nbsp;
undefined-condition</h3>

<p>The error condition is not one of those defined by the other conditions in this list; any error type may be associated with this condition, and it SHOULD be used only in conjunction with an application-specific condition.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;message
       from='northumberland@shakespeare.lit'
       id='richard2-4.1.247'
       to='kingrichard@royalty.england.lit'&gt;
     &lt;body&gt;My lord, dispatch; read o'er these articles.&lt;/body&gt;
     &lt;amp xmlns='http://jabber.org/protocol/amp'&gt;
       &lt;rule action='notify'
             condition='deliver'
             value='stored'/&gt;
     &lt;/amp&gt;

S: &lt;message from='example.org'
            id='amp1'
            to='northumberland@example.net/field'
            type='error'&gt;
     &lt;amp xmlns='http://jabber.org/protocol/amp'
          from='kingrichard@example.org'
          status='error'
          to='northumberland@example.net/field'&gt;
       &lt;rule action='error'
             condition='deliver'
             value='stored'/&gt;
     &lt;/amp&gt;
     &lt;error type='modify'&gt;
       &lt;undefined-condition
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
       &lt;failed-rules xmlns='http://jabber.org/protocol/amp#errors'&gt;
         &lt;rule action='error'
               condition='deliver'
               value='stored'/&gt;
       &lt;/failed-rules&gt;
     &lt;/error&gt;
   &lt;/message&gt;
</pre></div>
<a name="stanzas-error-conditions-unexpected-request"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.23"></a><h3>9.3.3.23.&nbsp;
unexpected-request</h3>

<p>The recipient or server understood the request but was not expecting it at this time (e.g., the request was out of order); the associated error type SHOULD be "wait" or "modify".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='romeo@example.net/foo'
       id='unsub1'
       to='pubsub.example.com'
       type='set'&gt;
     &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
        &lt;unsubscribe
            node='my_musings'
            jid='romeo@example.net'/&gt;
     &lt;/pubsub&gt;
   &lt;/iq&gt;

E: &lt;iq from='pubsub.example.com'
       id='unsub1'
       to='romeo@example.net/foo'
       type='error'&gt;
     &lt;error type='cancel'&gt;
       &lt;unexpected-request
           xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
       &lt;not-subscribed
           xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<a name="stanzas-error-conditions-unknown-sender"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3.24"></a><h3>9.3.3.24.&nbsp;
unknown-sender</h3>

<p>The stanza 'from' address specified by a connected client is not valid for the stream (e.g., the stanza does not include a 'from' address when multiple resources are bound to the stream as described under <a class='info' href='#bind-multi-from'>Section&nbsp;8.6.4<span> (</span><span class='info'>From Addresses</span><span>)</span></a>); the associated error type SHOULD be "modify".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;message to='romeo@example.net'&gt;
     &lt;body&gt;Wherefore art thou?&lt;/body&gt;
   &lt;/message&gt;

S: &lt;message from='romeo@example.net'
            type='error'&gt;
     &lt;body&gt;Wherefore art thou?&lt;/body&gt;
     &lt;error type='modify'&gt;
       &lt;unknown-sender xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/message&gt;
</pre></div>
<a name="stanzas-error-app"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.4"></a><h3>9.3.4.&nbsp;
Application-Specific Conditions</h3>

<p>As noted, an application MAY provide application-specific stanza error information by including a properly-namespaced child in the error element.  The application-specific element SHOULD supplement or further qualify a defined element.  Thus, the &lt;error/&gt; element will contain two or three child elements.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;iq id='some-id' type='error'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;too-many-parameters xmlns='http://example.com/ns'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;message type='error' id='another-id'&gt;
  &lt;error type='modify'&gt;
    &lt;undefined-condition
          xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;text xml:lang='en'
          xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'&gt;
      [ ... application-specific information ... ]
    &lt;/text&gt;
    &lt;too-many-parameters xmlns='http://example.com/ns'/&gt;
  &lt;/error&gt;
&lt;/message&gt;
</pre></div>
<p>An entity that receives an application-specific error condition it does not understand MUST ignore the condition.
</p>
<a name="stanzas-extended"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.4"></a><h3>9.4.&nbsp;
Extended Content</h3>

<p><a name='anchor21'></a>While the message, presence, and IQ stanzas provide basic semantics for messaging, availability, and request-response interactions, XMPP uses XML namespaces (see <a class='info' href='#XML-NAMES'>[XML&#8209;NAMES]<span> (</span><span class='info'>Bray, T., Hollander, D., and A. Layman, &ldquo;Namespaces in XML,&rdquo; January&nbsp;1999.</span><span>)</span></a> to extend the basic stanza syntax for the purpose of providing additional functionality.  Thus a message or presence stanza MAY contain one or more optional child elements specifying content that extends the meaning of the message (e.g., an XHTML-formatted version of the message body as described in <a class='info' href='#XEP-0071'>[XEP&#8209;0071]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;XHTML-IM,&rdquo; August&nbsp;2007.</span><span>)</span></a>), and an IQ stanza of type "get" or "set" MUST contain one such child element.  This child element MAY have any name and MUST possess a namespace declaration (other than "jabber:client", "jabber:server", or "http://etherx.jabber.org/streams") that defines all data contained within the child element.  Such a child element is said to be EXTENDED CONTENT and its namespace name is said to be an EXTENDED NAMESPACE.
</p>
<p>Support for any given extended namespace is OPTIONAL on the part of any implementation.  If an entity does not understand such a namespace, the entity's expected behavior depends on whether the entity is (1) the recipient or (2) an entity that is routing the stanza to the recipient.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Recipient:</dt>
<dd>If a recipient receives a stanza that contains a child element it does not understand, it MUST silently ignore that particular XML data, i.e., it MUST not process it or present it to a user or associated application (if any).  In particular:
          
<ul class="text">
<li>If an entity receives a message or presence stanza that contains XML data qualified by a namespace it does not understand, the portion of the stanza that qualified by the unknown namespace MUST be ignored.
</li>
<li>If an entity receives a message stanza whose only child element is qualified by a namespace it does not understand, it MUST ignore the entire stanza.
</li>
<li>If an entity receives an IQ stanza of type "get" or "set" containing a child element qualified by a namespace it does not understand, the entity MUST return an IQ stanza of type "error" with an error condition of &lt;service-unavailable/&gt;.
</li>
</ul>
        
</dd>
<dt>Router:</dt>
<dd>If a routing entity (typically a server) handles a stanza that contains a child element it does not understand, it MUST ignore the associated XML data by routing or delivering it untouched to the recipient.
</dd>
</dl></blockquote>

<a name="examples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Examples</h3>

<a name="examples-c2s"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1"></a><h3>10.1.&nbsp;
Client-to-Server</h3>

<p>The following examples show the XMPP data flow for a client negotiating an XML stream with a server, exchanging XML stanzas, and closing the negotiated stream.  The server is "im.example.com", the server requires use of TLS, the client authenticates via the SASL PLAIN mechanism as "juliet@im.example.com", and the client binds a client-submitted resource to the stream.  It is assumed that before sending the initial stream header, the client has already resolved an SRV record of _xmpp-client._tcp.im.example.com and has opened a TCP connection to the advertised port at the resolved IP address.
</p>
<p></p>
<blockquote class="text">
<p>Note: The alternate steps shown are provided only to illustrate the protocol for failure cases; they are not exhaustive and would not necessarily be triggered by the data sent in the examples.
</p>
</blockquote>

<a name="examples-c2s-tls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1.1"></a><h3>10.1.1.&nbsp;
TLS</h3>

<p>Step 1: Client initiates stream to server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;stream:stream
     from='juliet@im.example.com'
     to='im.example.com'
     version='1.0'
     xml:lang='en'
     xmlns='jabber:client'
     xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>Step 2: Server responds by sending a response stream header to client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;stream:stream
     from='im.example.com'
     id='t7AMCin9zjMNwQKDnplntZPIDEI='
     to='juliet@im.example.com'
     version='1.0'
     xml:lang='en'
     xmlns='jabber:client'
     xmlns:stream='http://etherx.jabber.org/streams'
</pre></div>
<p>Step 3: Server sends stream features to client (STARTTLS extension only at this point):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;stream:features&gt;
     &lt;starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'&gt;
       &lt;required/&gt;
     &lt;/starttls&gt;
   &lt;/stream:features&gt;
</pre></div>
<p>Step 4: Client sends STARTTLS command to server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;
</pre></div>
<p>Step 5: Server informs client that it is allowed to proceed:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;proceed xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;
</pre></div>
<p>Step 5 (alt): Server informs client that STARTTLS negotiation has failed and closes both XML stream and TCP connection:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;

S: &lt;/stream:stream&gt;
</pre></div>
<p>Step 6: Client and server attempt to complete TLS negotiation over the existing TCP connection (see <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.1,&rdquo; April&nbsp;2006.</span><span>)</span></a> for details).
</p>
<p>Step 7: If TLS negotiation is successful, client initiates a new stream to server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;stream:stream
     from='juliet@im.example.com'
     to='im.example.com'
     version='1.0'
     xml:lang='en'
     xmlns='jabber:client'
     xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>Step 7 (alt): If TLS negotiation is unsuccessful, server closes TCP connection.
</p>
<a name="examples-c2s-sasl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1.2"></a><h3>10.1.2.&nbsp;
SASL</h3>

<p>Step 8: Server responds by sending a stream header to client along with any available stream features:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;stream:stream
     from='im.example.com'
     id='vgKi/bkYME8OAj4rlXMkpucAqe4='
     to='juliet@im.example.com'
     version='1.0'
     xml:lang='en'
     xmlns='jabber:client'
     xmlns:stream='http://etherx.jabber.org/streams'

S: &lt;stream:features&gt;
     &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
       &lt;mechanism&gt;DIGEST-MD5&lt;/mechanism&gt;
       &lt;mechanism&gt;PLAIN&lt;/mechanism&gt;
       &lt;required/&gt;
     &lt;/mechanisms&gt;
   &lt;/stream:features&gt;
</pre></div>
<p>Step 9: Client selects an authentication mechanism, in this case <a class='info' href='#PLAIN'>[PLAIN]<span> (</span><span class='info'>Zeilenga, K., &ldquo;The PLAIN Simple Authentication and Security Layer (SASL) Mechanism,&rdquo; August&nbsp;2006.</span><span>)</span></a>:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
         mechanism='PLAIN'&gt;UjBtMzBSMGNrcw==&lt;/auth&gt;
</pre></div>
<p>Step 10: Server informs client of success:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;success xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;=&lt;/success&gt;
</pre></div>
<p>Step 10 (alt): Server returns error to client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
     &lt;not-authorized/&gt;
   &lt;/failure&gt;
</pre></div>
<p>Step 11: Client initiates a new stream to server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;stream:stream
     from='juliet@im.example.com'
     to='im.example.com'
     version='1.0'
     xml:lang='en'
     xmlns='jabber:client'
     xmlns:stream='http://etherx.jabber.org/streams'
</pre></div>
<a name="examples-c2s-bind"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1.3"></a><h3>10.1.3.&nbsp;
Resource Binding</h3>

<p>Step 12: Server responds by sending a stream header to client along with supported features (in this case resource binding):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;stream:stream
     from='im.example.com'
     id='gPybzaOzBmaADgxKXu9UClbprp0='
     to='juliet@im.example.com'
     version='1.0'
     xml:lang='en'
     xmlns='jabber:client'
     xmlns:stream='http://etherx.jabber.org/streams'&gt;

S: &lt;stream:features&gt;
     &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;required/&gt;
     &lt;/bind&gt;
   &lt;/stream:features&gt;
</pre></div>
<p>Upon being so informed that resource binding is mandatory, the client needs to bind a resource to the stream; here we assume that the client submits a human-readable text string.
</p>
<p>Step 13: Client binds a resource:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq id='bind_1' type='set'&gt;
     &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       balcony
     &lt;/bind&gt;
   &lt;/iq&gt;
</pre></div>
<p>Step 14: Server accepts submitted resource identifier and informs client of successful resource binding:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq id='bind_1' type='result'&gt;
     &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;jid&gt;
         juliet@im.example.com/balcony
       &lt;/jid&gt;
     &lt;/bind&gt;
   &lt;/iq&gt;
</pre></div>
<a name="examples-c2s-stanzas"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1.4"></a><h3>10.1.4.&nbsp;
Stanza Exchange</h3>

<p>Now the client is allowed to send XML stanzas over the negotiated stream.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;message from='juliet@im.example.com/balcony'
            to='romeo@example.net'
            xml:lang='en'&gt;
     &lt;body&gt;Art thou not Romeo, and a Montague?&lt;/body&gt;
   &lt;/message&gt;
</pre></div>
<p>If necessary, sender's server negotiates XML streams with intended recipient's server (see <a class='info' href='#examples-s2s'>Section&nbsp;10.2<span> (</span><span class='info'>Server-to-Server Examples</span><span>)</span></a>).
</p>
<p>The intended recipient replies and the message is delivered to the client.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
E: &lt;message from='romeo@example.net/orchard'
            to='juliet@im.example.com/balcony'
            xml:lang='en'&gt;
     &lt;body&gt;Neither, fair saint, if either thee dislike.&lt;/body&gt;
   &lt;/message&gt;
</pre></div>
<p>The client may send and receive an unbounded number of subsequent XML stanzas over the stream.
</p>
<a name="examples-c2s-close"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1.5"></a><h3>10.1.5.&nbsp;
Close</h3>

<p>Desiring to send no further messages, the client closes the stream.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;/stream:stream&gt;
</pre></div>
<p>Consistent with the recommended stream closing handshake, the server closes the stream as well:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;/stream:stream&gt;
</pre></div>
<p>Client now terminates the underlying TCP connection.
</p>
<a name="examples-s2s"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2"></a><h3>10.2.&nbsp;
Server-to-Server Examples</h3>

<p>The following examples show the data flow for a server negotiating an XML stream with another server, exchanging XML stanzas, and closing the negotiated stream.  The initiating server ("Server1") is im.example.com; the receiving server ("Server2") is example.net and it requires use of TLS; im.example.com presents a certificate and authenticates via the SASL EXTERNAL mechanism.  It is assumed that before sending the initial stream header, Server1 has already resolved an SRV record of _xmpp-server._tcp.example.net and has opened a TCP connection to the advertised port at the resolved IP address.
</p>
<p></p>
<blockquote class="text">
<p>Note: The alternate steps shown are provided only to illustrate the protocol for failure cases; they are not exhaustive and would not necessarily be triggered by the data sent in the examples.
</p>
</blockquote>

<a name="examples-s2s-tls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2.1"></a><h3>10.2.1.&nbsp;
TLS</h3>

<p>Step 1: Server1 initiates stream to Server2:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S1: &lt;stream:stream
      from='im.example.com'
      to='example.net'
      version='1.0'
      xmlns='jabber:server'
      xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>Step 2: Server2 responds by sending a response stream header to Server1:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S2: &lt;stream:stream
      from='example.net'
      id='hTiXkW+ih9k2SqdGkk/AZi0OJ/Q='
      to='im.example.com'
      version='1.0'
      xmlns='jabber:server'
      xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>Step 3: Server2 sends stream features to Server1:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S2: &lt;stream:features&gt;
      &lt;starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'&gt;
        &lt;required/&gt;
      &lt;/starttls&gt;
    &lt;/stream:features&gt;
</pre></div>
<p>Step 4: Server1 sends the STARTTLS command to Server2:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S1: &lt;starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;
</pre></div>
<p>Step 5: Server2 informs Server1 that it is allowed to proceed:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S2: &lt;proceed xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;
</pre></div>
<p>Step 5 (alt): Server2 informs Server1 that STARTTLS negotiation has failed and closes stream:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S2: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;

S2: &lt;/stream:stream&gt;
</pre></div>
<p>Step 6: Server1 and Server2 attempt to complete TLS negotiation via TCP (see <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.1,&rdquo; April&nbsp;2006.</span><span>)</span></a> for details).
</p>
<p>Step 7: If TLS negotiation is successful, Server1 initiates a new stream to Server2:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S1: &lt;stream:stream
      from='im.example.com'
      to='example.net'
      version='1.0'
      xmlns='jabber:server'
      xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>Step 7 (alt): If TLS negotiation is unsuccessful, Server2 closes TCP connection.
</p>
<a name="examples-s2s-sasl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2.2"></a><h3>10.2.2.&nbsp;
SASL</h3>

<p>Step 8: Server2 sends a response stream header to Server1 along with available stream features (including a preference for the SASL EXTERNAL mechanism):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S2: &lt;stream:stream
      from='example.net'
      id='RChdjlgj/TIBcbT9Keu31zDihH4='
      to='im.example.com'
      version='1.0'
      xmlns='jabber:server'
      xmlns:stream='http://etherx.jabber.org/streams'&gt;

S2: &lt;stream:features&gt;
      &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
        &lt;mechanism&gt;EXTERNAL&lt;/mechanism&gt;
        &lt;required/&gt;
      &lt;/mechanisms&gt;
    &lt;/stream:features&gt;
</pre></div>
<p>Step 9: Server1 selects the EXTERNAL mechanism, in this case with an authorization identity encoded according to <a class='info' href='#BASE64'>[BASE64]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; October&nbsp;2006.</span><span>)</span></a>:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S1: &lt;auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
          mechanism='EXTERNAL'/&gt;eG1wcC5leGFtcGxlLmNvbQ&lt;/auth&gt;
</pre></div>
<p>The decoded authorization identity is "im.example.com".
</p>
<p>Step 10: Server2 determines that the authorization identity provided by Server1 matches the information in the presented certificate and therefore returns success:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S2: &lt;success xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/&gt;
</pre></div>
<p>Step 10 (alt): Server2 informs Server1 of failed authentication:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S2: &lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
      &lt;not-authorized/&gt;
    &lt;/failure&gt;

S2: &lt;/stream:stream&gt;
</pre></div>
<p>Step 11: Server1 initiates a new stream to Server2:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S1: &lt;stream:stream
      from='im.example.com'
      to='example.net'
      version='1.0'
      xmlns='jabber:server'
      xmlns:stream='http://etherx.jabber.org/streams'&gt;
</pre></div>
<p>Step 12: Server2 responds by sending a stream header to Server1 along with any additional features (or, in this case, an empty features element):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S2: &lt;stream:stream
      from='example.net'
      id='MbbV2FeojySpUIP6J91qaa+TWHM='
      to='im.example.com'
      version='1.0'
      xmlns='jabber:server'
      xmlns:stream='http://etherx.jabber.org/streams'&gt;

S2: &lt;stream:features/&gt;
</pre></div>
<a name="examples-s2s-stanzas"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2.3"></a><h3>10.2.3.&nbsp;
Stanza Exchange</h3>

<p>Now Server1 is allowed to send XML stanzas to Server2 over the negotiated stream; here we assume that the transferred stanzas are those shown earlier for client-to-server communication, albeit over a server-to-server stream qualified by the 'jabber:server' namespace.
</p>
<p>Server1 sends XML stanza to Server2:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S1: &lt;message from='juliet@im.example.com/balcony'
             to='romeo@example.net'
             xml:lang='en'&gt;
    &lt;body&gt;Art thou not Romeo, and a Montague?&lt;/body&gt;
   &lt;/message&gt;
</pre></div>
<p>The intended recipient replies and the message is delivered from Server2 to Server1.
</p>
<p>Server2 sends XML stanza to Server1:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S2: &lt;message from='romeo@example.net/orchard'
             to='juliet@im.example.com/balcony'
             xml:lang='en'&gt;
      &lt;body&gt;Neither, fair saint, if either thee dislike.&lt;/body&gt;
    &lt;/message&gt;
</pre></div>
<a name="examples-s2s-close"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2.4"></a><h3>10.2.4.&nbsp;
Close</h3>

<p>Desiring to send no further messages, Server1 closes the stream.  (In practice, the stream would most likely remain open for some time, since Server1 and Server2 do not immediately know if the stream will be needed for further communication.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S1: &lt;/stream:stream&gt;
</pre></div>
<p>Consistent with the recommended stream closing handshake, Server2 closes the stream as well:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S2: &lt;/stream:stream&gt;
</pre></div>
<p>Server1 now terminates the underlying TCP connection.
</p>
<a name="rules"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Server Rules for Processing XML Stanzas</h3>

<p>An XMPP server MUST ensure in-order processing of XML stanzas between any two entities.  This includes stanzas sent by a client to its server for direct processing by the server (e.g., in-order processing of a roster get and initial presence as described in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a>).
</p>
<p>Beyond the requirement for in-order processing, each server implementation will contain its own logic for processing stanzas it receives.  Such logic determines whether the server needs to ROUTE a given stanza to another domain, DELIVER it to a local entity (typically a connected client associated with a local account), or HANDLE it directly within the server itself.  The following rules apply.
</p>
<p></p>
<blockquote class="text">
<p>Note: Particular XMPP applications MAY specify delivery rules that modify or supplement the following rules; for example, a set of delivery rules for instant messaging and presence applications is defined in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a>.
</p>
</blockquote>

<a name="rules-noto"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1"></a><h3>11.1.&nbsp;
No 'to' Address</h3>

<a name="rules-noto-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1.1"></a><h3>11.1.1.&nbsp;
Overview</h3>

<p>If the stanza possesses no 'to' attribute, the server MUST handle it directly on behalf of the entity that sent it, where the meaning of "handle it directly" depends on whether the stanza is message, presence, or IQ.  Because all stanzas received from other servers MUST possess a 'to' attribute, this rule applies only to stanzas received from a local entity (such as a client) that is connected to the server.
</p>
<a name="rules-noto-message"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1.2"></a><h3>11.1.2.&nbsp;
Message</h3>

<p>If the server receives a message stanza with no 'to' attribute, it MUST treat the message as if the 'to' address were the bare JID &lt;node@domain&gt; of the sending entity.
</p>
<a name="rules-noto-presence"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1.3"></a><h3>11.1.3.&nbsp;
Presence</h3>

<p>If the server receives a presence stanza with no 'to' attribute, it MUST broadcast it to the entities that are subscribed to the sending entity's presence, if applicable (<a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a> defines the semantics of such broadcasting for presence applications).
</p>
<a name="rules-noto-IQ"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1.4"></a><h3>11.1.4.&nbsp;
IQ</h3>

<p>If the server receives an IQ stanza with no 'to' attribute, it MUST process the stanza on behalf of the account from which received the stanza, as follows:
</p>
<p>
          </p>
<ol class="text">
<li>If the IQ stanza is of type "get" or "set" and the server understands the namespace that qualifies the payload, the server MUST handle the stanza on behalf of the sending entity or return an appropriate error to the sending entity.  While the meaning of "handle" is determined by the semantics of the qualifying namespace, in general the server shall respond to the IQ stanza of type "get" or "set" by returning an appropriate IQ stanza of type "result" or "error", responding as if the server were the bare JID of the sending entity.  As an example, if the sending entity sends an IQ stanza of type "get" where the payload is qualified by the 'jabber:iq:roster' namespace (as described in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a>), then the server shall return the roster associated with the sending entity's bare JID to the particular resource of the sending entity that requested the roster.
</li>
<li>If the IQ stanza is of type "get" or "set" and the server does not understand the namespace that qualifies the payload, the server MUST return an error to the sending entity, which MUST be &lt;service-unavailable/&gt;.
</li>
<li>If the IQ stanza is of type "error" or "result", the server MUST handle the error or result as appropriate for the request-response interaction, responding as if the server were the bare JID of the sending entity.
</li>
</ol><p>
        
</p>
<a name="rules-local"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2"></a><h3>11.2.&nbsp;
Local Domain</h3>

<p>If the hostname of the domain identifier portion of the JID contained in the 'to' attribute matches one of the configured hostnames of the server itself, the server MUST first determine if the hostname is serviced by the server or by a specialized local service.  If the latter, the server MUST route the stanza to that service.  If the former, the server MUST proceed as follows.
</p>
<a name="rules-local-domain"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2.1"></a><h3>11.2.1.&nbsp;
Mere Domain</h3>

<p>If the JID contained in the 'to' attribute is of the form &lt;domain&gt;, then the server MUST either handle the stanza as appropriate for the stanza kind or return an error stanza to the sender.
</p>
<a name="rules-local-domainresource"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2.2"></a><h3>11.2.2.&nbsp;
Domain with Resource</h3>

<p>If the JID contained in the 'to' attribute is of the form &lt;domain/resource&gt;, then the server MUST either handle the stanza as appropriate for the stanza kind or return an error stanza to the sender.
</p>
<a name="rules-local-node"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2.3"></a><h3>11.2.3.&nbsp;
Node at Domain</h3>

<p></p>
<blockquote class="text">
<p>Note: For addresses of this type, more detailed rules in the context of instant messaging and presence applications are provided in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a>.
</p>
</blockquote>

<a name="rules-local-node-nosuchuser"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2.3.1"></a><h3>11.2.3.1.&nbsp;
No Such User</h3>

<p>If there is no local account associated with the &lt;node@domain&gt;, how the stanza shall be processed depends on the stanza type.
</p>
<p>
            </p>
<ul class="text">
<li>For a message stanza, the server MUST return a &lt;service-unavailable/&gt; stanza error to the sender.
</li>
<li>For a presence stanza, the server SHOULD silently discard the stanza.
</li>
<li>For an IQ stanza, the server MUST return a &lt;service-unavailable/&gt; stanza error to the sender.
</li>
</ul><p>
          
</p>
<a name="rules-local-node-barejid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2.3.2"></a><h3>11.2.3.2.&nbsp;
Bare JID</h3>

<p>If the JID contained in the 'to' attribute is of the form &lt;node@domain&gt;, how the stanza shall be processed depends on the stanza type.
</p>
<p>
            </p>
<ul class="text">
<li>For a message stanza, if there exists at least one connected resource for the node the server SHOULD deliver it to at least one of the connected resources.  If there exists no connected resource, the server MUST either return an error or store the message offline for delivery when the account next has a connected resource.
</li>
<li>For a presence stanza, if there exists at least one connected resource for the node the server SHOULD deliver it to at least one of the connected resources.  If there exists no connected resource, the server MUST silently discard the stanza.
</li>
<li>For an IQ stanza, the server MUST handle it directly on behalf of the intended recipient.
</li>
</ul><p>
          
</p>
<a name="rules-local-node-fulljid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2.3.3"></a><h3>11.2.3.3.&nbsp;
Full JID</h3>

<p>If the JID contained in the 'to' attribute is of the form &lt;node@domain/resource&gt; and there is no connected resource that exactly matches the full JID, the stanza shall be processed as if the JID were of the form &lt;node@domain&gt;.
</p>
<p>If the JID contained in the 'to' attribute is of the form &lt;node@domain/resource&gt; and there is a connected resource that exactly matches the full JID, the server SHOULD deliver the stanza to that connected resource.
</p>
<a name="rules-foreign"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.3"></a><h3>11.3.&nbsp;
Foreign Domain</h3>

<p>If the hostname of the domain identifier portion of the JID contained in the 'to' attribute does not match one of the configured hostnames of the server itself, the server SHOULD attempt to route the stanza to the foreign domain (subject to local service provisioning and security policies regarding inter-domain communication, since such communication is optional for any given deployment).  There are two possible cases.
</p>
<a name="rules-foreign-existing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.3.1"></a><h3>11.3.1.&nbsp;
Existing Stream</h3>

<p>If a server-to-server stream already exists between the two domains, the sender's server shall attempt to route the stanza to the authoritative server for the foreign domain over the existing stream.
</p>
<a name="rules-foreign-nostream"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.3.2"></a><h3>11.3.2.&nbsp;
No Existing Stream</h3>

<p>If there exists no server-to-server stream between the two domains, the sender's server shall proceed as follows:
</p>
<p>
          </p>
<ol class="text">
<li>Resolve the hostname of the foreign domain (as defined under <a class='info' href='#security-server'>Section&nbsp;15.4<span> (</span><span class='info'>Server-to-Server Communication</span><span>)</span></a>).
</li>
<li>Negotiate a server-to-server stream between the two domains (as defined under <a class='info' href='#tls'>Section&nbsp;6<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a> and <a class='info' href='#sasl'>Section&nbsp;7<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>).
</li>
<li>Route the stanza to the authoritative server for the foreign domain over the newly-established stream.
</li>
</ol><p>
        
</p>
<a name="rules-foreign-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.3.3"></a><h3>11.3.3.&nbsp;
Error Handling</h3>

<p>If routing of a stanza to the intended recipient's server is unsuccessful, the sender's server MUST return an error to the sender.  If resolution of the foreign domain is unsuccessful, the stanza error MUST be &lt;remote-server-not-found/&gt;.  If resolution succeeds but streams cannot be negotiated, the stanza error MUST be &lt;remote-server-timeout/&gt;.
</p>
<p>If stream negotiation with the intended recipient's server is successful but the foreign server cannot deliver the stanza to the recipient, the foreign server shall return an appropriate error to the sender by way of the sender's server.
</p>
<a name="xml"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
XML Usage</h3>

<a name="xml-restrictions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
Restrictions</h3>

<p>The Extensible Messaging and Presence Protocol (XMPP) defines a class of data objects called XML streams as well as the behavior of computer programs that process XML streams.  XMPP is an application profile or restricted form of the Extensible Markup Language <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>, and a complete XML stream (including start and end stream tags) is a conforming XML document.
</p>
<p>However, XMPP does not deal with XML documents but with XML streams.  Because XMPP does not require the parsing of arbitrary and complete XML documents, there is no requirement that XMPP needs to support the full feature set of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>.  In particular, the following features of XML are prohibited in XMPP:
</p>
<p>
        </p>
<ul class="text">
<li>comments (as defined in Section 2.5 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>)
</li>
<li>processing instructions (Section 2.6 therein)
</li>
<li>internal or external DTD subsets (Section 2.8 therein)
</li>
<li>internal or external entity references (Section 4.2 therein) with the exception of predefined entities (Section 4.6 therein)
</li>
</ul><p>
      
</p>
<p>An XMPP implementation MUST behave as follow with regard to these features:
</p>
<p>
        </p>
<ol class="text">
<li>An XMPP implementation MUST NOT inject characters matching such features into an XML stream.
</li>
<li>If an XMPP implementation receives characters matching such features over an XML stream, it MUST return a stream error, which SHOULD be &lt;restricted-xml/&gt; but MAY be &lt;bad-format/&gt;.
</li>
</ol><p>
      
</p>
<a name="xml-ns"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
XML Namespace Names and Prefixes</h3>

<p>XML namespaces (see <a class='info' href='#XML-NAMES'>[XML&#8209;NAMES]<span> (</span><span class='info'>Bray, T., Hollander, D., and A. Layman, &ldquo;Namespaces in XML,&rdquo; January&nbsp;1999.</span><span>)</span></a>) are used within XMPP streams to create strict boundaries of data ownership.  The basic function of namespaces is to separate different vocabularies of XML elements that are structurally mixed together.  Ensuring that XMPP streams are namespace-aware enables any allowable XML to be structurally mixed with any data element within XMPP.  XMPP-specific rules for XML namespace names and prefixes are defined in the following subsections.
</p>
<a name="xml-ns-stream"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2.1"></a><h3>12.2.1.&nbsp;
Streams Namespace</h3>

<p>A streams namespace declaration is REQUIRED in all XML stream headers and the name of the streams namespace MUST be 'http://etherx.jabber.org/streams'.  If this rule is violated, the entity that receives the offending stream header MUST return a stream error to the sending entity, which SHOULD be &lt;invalid-namespace/&gt; but MAY be &lt;bad-format/&gt;.
</p>
<p>The element names of the &lt;stream/&gt; element and its &lt;features/&gt; and &lt;error/&gt; children MUST be qualified by the streams namespace prefix in all instances.  If this rule is violated, the entity that receives the offending element MUST return a stream error to the sending entity, which SHOULD be &lt;bad-format/&gt;.
</p>
<p>An implementation SHOULD generate only the 'stream:' prefix for these elements, and for historical reasons MAY accept only the 'stream:' prefix.  If an entity receives a stream header with a streams namespace prefix it does not accept, it MUST return a stream error to the sending entity, which SHOULD be &lt;bad-namespace-prefix/&gt; but MAY be &lt;bad-format/&gt;.
</p>
<a name="xml-ns-default"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2.2"></a><h3>12.2.2.&nbsp;
Default Namespace</h3>

<p>A default namespace declaration is REQUIRED and defines the allowable first-level children of the root stream element.  This namespace declaration MUST be the same for the initial stream and the response stream so that both streams are qualified consistently.  The default namespace declaration applies to the stream and all first-level child element sent within a stream unless explicitly qualified by the streams namespace or another namespace.
</p>
<p>A server implementation MUST support the following two default namespaces:
</p>
<p>
          </p>
<ul class="text">
<li>jabber:client -- this default namespace is declared when the stream is used for communication between a client and a server
</li>
<li>jabber:server -- this default namespace is declared when the stream is used for communication between two servers
</li>
</ul><p>
        
</p>
<p>A client implementation MUST support the 'jabber:client' default namespace.
</p>
<p>If an implementation accepts a stream that is qualified by the 'jabber:client' or 'jabber:server' namespace, it MUST support the <a class='info' href='#stanzas-attributes'>common attributes<span> (</span><span class='info'>Common Attributes</span><span>)</span></a> and <a class='info' href='#stanzas-semantics'>basic semantics<span> (</span><span class='info'>Basic Semantics</span><span>)</span></a> of all three core stanza types (message, presence, and IQ).
</p>
<p>For historical reasons, an implementation MAY refuse to support any other default namespaces.  If an entity receives a stream header with a default namespace it does not support, it MUST return an &lt;invalid-namespace/&gt; stream error.
</p>
<p>An implementation MUST NOT generate namespace prefixes for elements qualified by the default namespace if the default namespace is 'jabber:client' or 'jabber:server'.
</p>
<p></p>
<blockquote class="text">
<p>Note: The 'jabber:client' and 'jabber:server' namespaces are nearly identical but are used in different contexts (client-to-server communication for 'jabber:client' and server-to-server communication for 'jabber:server').  The only difference between the two is that the 'to' and 'from' attributes are OPTIONAL on stanzas sent over XML streams qualified by the 'jabber:client' namespace, whereas they are REQUIRED on stanzas sent over XML streams qualified by the 'jabber:server' namespace.
</p>
</blockquote>

<p>An implementation MAY support a default namespace other than "jabber:client" or "jabber:server".  However, because such namespaces would define applications other than XMPP, they are to be defined in separate specifications.
</p>
<a name="xml-ns-extended"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2.3"></a><h3>12.2.3.&nbsp;
Extended Namespaces</h3>

<p>An EXTENDED NAMESPACE is an XML namespace that qualifies extended content as defined under <a class='info' href='#stanzas-extended'>Section&nbsp;9.4<span> (</span><span class='info'>Extended Content</span><span>)</span></a>.  For example, in the following stanza, the extended namespace is 'jabber:iq:roster':
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;iq from='juliet@capulet.com/balcony'
    id='roster1'
    type='get'&gt;
 &lt;query xmlns='jabber:iq:roster'/&gt;
&lt;/iq&gt;
</pre></div>
<p>An XML stanza MAY contain XML data qualified by more than one extended namespace, either at the direct child level of the stanza (for presence and message stanzas) or in any mix of levels (for all stanzas).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;presence from='juliet@capulet.com/balcony'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     node='http://exodus.jabberstudio.org/caps'
     ver='0.9'/&gt;
  &lt;x xmlns='vcard-temp:x:update'&gt;
    &lt;photo&gt;sha1-hash-of-image&lt;/photo&gt;
  &lt;/x&gt;
&lt;/presence&gt;
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;message to='juliet@capulet.com'&gt;
  &lt;body&gt;Hello?&lt;/body&gt;
  &lt;html xmlns='http://jabber.org/protocol/xhtml-im'&gt;
    &lt;body xmlns='http://www.w3.org/1999/xhtml'&gt;
      &lt;p style='font-weight:bold'&gt;Hello?&lt;/t&gt;
    &lt;/body&gt;
  &lt;/html&gt;
&lt;/message&gt;
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;iq from='juliet@capulet.com/balcony'
    id='roster2'
    type='get'&gt;
 &lt;query xmlns='jabber:iq:roster'&gt;
    &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
      &lt;header name='If-None-Match'&gt;some-long-opaque-string&lt;/header&gt;
    &lt;/headers&gt;
 &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
<p>An implementation SHOULD NOT generate namespace prefixes for elements qualified by content (as opposed to stream) namespaces other than the default namespace.  However, if included, the namespace declarations for those prefixes MUST be included on the stanza root or a child thereof, not at the level of the stream element (this helps to ensure that any such namespace declaration is routed and delivered with the stanza, instead of assumed from the stream).
</p>
<a name="xml-wellformed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3"></a><h3>12.3.&nbsp;
Well-Formedness</h3>

<p>A XMPP entity MUST NOT accept XML data from another entity if that data is not well-formed in accordance with both the definition of "well-formed" in Section 2.1 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a> and the definition of "namespace-well-formed" in Section 7 of <a class='info' href='#XML-NAMES'>[XML&#8209;NAMES]<span> (</span><span class='info'>Bray, T., Hollander, D., and A. Layman, &ldquo;Namespaces in XML,&rdquo; January&nbsp;1999.</span><span>)</span></a>.  In an XMPP entity receives XML data that is not well-formed, it MUST return an &lt;xml-not-well-formed/&gt; stream error and close the stream over which the data was received.
</p>
<a name="xml-validation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.4"></a><h3>12.4.&nbsp;
Validation</h3>

<p>A server is not responsible for ensuring that XML data delivered to a client or routed to another server is valid, in accordance with the definition of "valid" provided in Section 2.8 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>.  An implementation MAY choose to accept or provide only validated data, but such behavior is OPTIONAL.  A client SHOULD NOT rely on the ability to send data that does not conform to the schemas, and SHOULD ignore any non-conformant elements or attributes on the incoming XML stream.
</p>
<p></p>
<blockquote class="text">
<p>Note: The terms "valid" and "well-formed" are distinct in XML.
</p>
</blockquote>

<a name="xml-declaration"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.5"></a><h3>12.5.&nbsp;
Inclusion of Text Declaration</h3>

<p>Implementations SHOULD send a text declaration before sending a stream header.  Applications MUST follow the rules provided in <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a> regarding the circumstances under which a text declaration is included.
</p>
<a name="xml-encoding"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.6"></a><h3>12.6.&nbsp;
Character Encoding</h3>

<p>Implementations MUST support the UTF-8 transformation of Universal Character Set <a class='info' href='#UCS2'>[UCS2]<span> (</span><span class='info'>International Organization for Standardization, &ldquo;Information Technology - Universal Multiple-octet coded Character Set (UCS) - Amendment 2: UCS Transformation Format 8 (UTF-8),&rdquo; October&nbsp;1996.</span><span>)</span></a> characters, as required by <a class='info' href='#CHARSET'>[CHARSET]<span> (</span><span class='info'>Alvestrand, H., &ldquo;IETF Policy on Character Sets and Languages,&rdquo; January&nbsp;1998.</span><span>)</span></a> and defined in <a class='info' href='#UTF-8'>[UTF&#8209;8]<span> (</span><span class='info'>Yergeau, F., &ldquo;UTF-8, a transformation format of ISO 10646,&rdquo; November&nbsp;2003.</span><span>)</span></a>.  Implementations MUST NOT attempt to use any other encoding.  If one party to an XML stream detects that the other party has attempted to send XML data with an encoding other than UTF-8, it MUST return a stream error, which SHOULD be &lt;unsupported-encoding/&gt; by MAY be &lt;bad-format/&gt;.
</p>
<a name="xml-whitespace"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.7"></a><h3>12.7.&nbsp;
Whitespace</h3>

<p>Except where explicitly disallowed (e.g., during <a class='info' href='#tls'>TLS negotiation<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a> and <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>), either entity MAY send whitespace within the root stream element as separators between XML stanzas or between any other first-level elements sent over the stream.  One common use for sending such whitespace is explained under <a class='info' href='#streams-close-idle'>Section&nbsp;5.7.3<span> (</span><span class='info'>Handling of Idle Streams</span><span>)</span></a>.
</p>
<a name="compliance"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Compliance Requirements</h3>

<p>This section summarizes the specific aspects of the Extensible Messaging and Presence Protocol that MUST be supported by servers and clients in order to be considered compliant implementations, as well as additional protocol aspects that SHOULD be supported.  For compliance purposes, we draw a distinction between core protocols (which MUST be supported by any server or client, regardless of the specific application) and instant messaging and presence protocols (which MUST be supported only by instant messaging and presence applications built on top of the core protocols).  Compliance requirements that apply to all servers and clients are specified in this section; compliance requirements for instant messaging and presence applications are specified in the corresponding section of <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a>.
</p>
<a name="compliance-server"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.1"></a><h3>13.1.&nbsp;
Servers</h3>

<p>A server MUST support the following core protocols in order to be considered compliant:
</p>
<p></p>
<ul class="text">
<li>Conformance with <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> for domain identifiers, the <a class='info' href='#nodeprep'>Nodeprep<span> (</span><span class='info'>Nodeprep</span><span>)</span></a> profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> for node identifiers, and the <a class='info' href='#resourceprep'>Resourceprep<span> (</span><span class='info'>Resourceprep</span><span>)</span></a> profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> for resource identifiers, as well as enforcement thereof for clients that authenticate with the server
</li>
<li><a class='info' href='#streams'>XML streams<span> (</span><span class='info'>XML Streams</span><span>)</span></a>, including <a class='info' href='#tls'>TLS negotiation<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a>, <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>, <a class='info' href='#streams-features'>stream features<span> (</span><span class='info'>Stream Features</span><span>)</span></a>, and <a class='info' href='#bind'>Resource Binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a>
</li>
<li>The basic semantics of the three defined stanza types (i.e., &lt;message/&gt;, &lt;presence/&gt;, and &lt;iq/&gt;)
</li>
<li>Generation (and, where appropriate, handling) of error syntax and semantics related to streams, TLS, SASL, and XML stanzas
</li>
</ul>

<p>For backward compatibility with the large deployed base of XMPP servers, server developers are advised to implement the server dialback protocol first specified in <a class='info' href='#RFC3920'>[RFC3920]<span> (</span><span class='info'>Saint-Andre, P., Ed., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a> and now documented in <a class='info' href='#XEP-0220'>[XEP&#8209;0220]<span> (</span><span class='info'>Saint-Andre, P. and J. Miller, &ldquo;Server Dialback,&rdquo; June&nbsp;2008.</span><span>)</span></a>, since that protocol is widely used for weak identity verification of peer servers in the absence of domain certificates.
</p>
<a name="compliance-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.2"></a><h3>13.2.&nbsp;
Clients</h3>

<p>A client MUST support the following core protocols in order to be considered compliant:
</p>
<p></p>
<ul class="text">
<li><a class='info' href='#streams'>XML streams<span> (</span><span class='info'>XML Streams</span><span>)</span></a>, including <a class='info' href='#tls'>TLS negotiation<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a>, <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>, <a class='info' href='#streams-features'>stream features<span> (</span><span class='info'>Stream Features</span><span>)</span></a>, and <a class='info' href='#bind'>Resource Binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a>
</li>
<li>The basic semantics of the three defined stanza types (i.e., &lt;message/&gt;, &lt;presence/&gt;, and &lt;iq/&gt;)
</li>
<li>Handling (and, where appropriate, generation) of error syntax and semantics related to streams, TLS, SASL, and XML stanzas
</li>
</ul>

<p>In addition, a client SHOULD support the following core protocols:
</p>
<p></p>
<ul class="text">
<li>Conformance with <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> for domain identifiers, the <a class='info' href='#nodeprep'>Nodeprep<span> (</span><span class='info'>Nodeprep</span><span>)</span></a> profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> for node identifiers, and the <a class='info' href='#resourceprep'>Resourceprep<span> (</span><span class='info'>Resourceprep</span><span>)</span></a> profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> for resource identifiers.
</li>
</ul>

<a name="i18n"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
Internationalization Considerations</h3>

<p>As specified under <a class='info' href='#xml-encoding'>Section&nbsp;12.6<span> (</span><span class='info'>Character Encoding</span><span>)</span></a>, XML streams MUST be encoded in UTF-8.
</p>
<p>As specified under <a class='info' href='#streams-attr'>Section&nbsp;5.3<span> (</span><span class='info'>Stream Attributes</span><span>)</span></a>, an XML stream SHOULD include an 'xml:lang' attribute specifying the default language for any XML character data that is intended to be presented to a human user.  As specified under <a class='info' href='#stanzas-attributes-lang'>Section&nbsp;9.1.5<span> (</span><span class='info'>xml:lang</span><span>)</span></a>, an XML stanza SHOULD include an 'xml:lang' attribute if the stanza contains XML character data that is intended to be presented to a human user.  A server SHOULD apply the default 'xml:lang' attribute to stanzas it routes or delivers on behalf of connected entities, and MUST NOT modify or delete 'xml:lang' attributes on stanzas it receives from other entities.
</p>
<p>As specified under <a class='info' href='#addressing'>Section&nbsp;3<span> (</span><span class='info'>Addresses</span><span>)</span></a>, a server MUST support and enforce <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> for domain identifiers, the <a class='info' href='#nodeprep'>Nodeprep<span> (</span><span class='info'>Nodeprep</span><span>)</span></a> profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> for node identifiers, and the <a class='info' href='#resourceprep'>Resourceprep<span> (</span><span class='info'>Resourceprep</span><span>)</span></a> profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> for resource identifiers; this enables XMPP addresses to include a wide variety of Unicode characters outside the US-ASCII range.
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15"></a><h3>15.&nbsp;
Security Considerations</h3>

<a name="security-high"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.1"></a><h3>15.1.&nbsp;
High Security</h3>

<p>For the purposes of XMPP communication (client-to-server and server-to-server), the term "high security" refers to the use of security technologies that provide both mutual authentication and integrity checking; in particular, when using certificate-based authentication to provide high security, a chain-of-trust SHOULD be established out-of-band, although a shared certification authority signing certificates could allow a previously unknown certificate to establish trust in-band.  See <a class='info' href='#security-certificates'>Section&nbsp;15.2<span> (</span><span class='info'>Certificates</span><span>)</span></a> regarding certificate validation procedures.
</p>
<p>Implementations MUST support high security.  Service provisioning should use high security, subject to local security policies.
</p>
<a name="security-certificates"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2"></a><h3>15.2.&nbsp;
Certificates</h3>

<p>Channel encryption of an XML stream using Transport Layer Security as described under <a class='info' href='#tls'>Section&nbsp;6<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a>, and in some cases also authentication as described under <a class='info' href='#sasl'>Section&nbsp;7<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>, is commonly based on a digital certificate presented by the receiving entity (or, in the case of mutual authentication, both the receiving entity and the initiating entity).  This section describes best practices regarding the generation of digital certificates to be presented by XMPP entities and the verification of digital certificates presented by XMPP entities.
</p>
<a name="security-certificates-generation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.1"></a><h3>15.2.1.&nbsp;
Certificate Generation</h3>

<a name="security-certificates-generation-server"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.1.1"></a><h3>15.2.1.1.&nbsp;
Server Certificates</h3>

<p>In a digital certificate to be presented by an XMPP server (i.e., a SERVER CERTIFICATE), it is RECOMMENDED for the certificate to include one or more JIDs (i.e., domain identifiers) associated with domains serviced at the server.  The representations described in the following sections are RECOMMENDED.  These representations are provided in preference order.
</p>
<a name="security-certificates-generation-server-srvname"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.1.1.1"></a><h3>15.2.1.1.1.&nbsp;
SRVName</h3>

<p>A server's domain identifier SHOULD be represented as an SRVName, i.e., as an otherName field of type "id-on-dnsSRV" as specified in <a class='info' href='#X509-SRV'>[X509&#8209;SRV]<span> (</span><span class='info'>Santesson, S., &ldquo;Internet X.509 Public Key Infrastructure Subject Alternative Name for Expression of Service Name,&rdquo; August&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="security-certificates-generation-server-dnsname"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.1.1.2"></a><h3>15.2.1.1.2.&nbsp;
dNSName</h3>

<p>A server's domain identifier SHOULD be represented as a dNSName, i.e., as a subjectAltName extension of type dNSName.
</p>
<p>The dNSName MAY contain the wildcard character '*'.  The wildcard character applies only to the left-most domain name component or component fragment and matches any single component or component fragment.  For instance, a dNSName of *.example.com matches foo.example.com but not bar.foo.example.com or example.com itself; similarly, a dNSName of im*.example.net matches im1.example.net and im2.example.net but not chat.example.net or example.net itself.
</p>
<a name="security-certificates-generation-server-xmppaddr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.1.1.3"></a><h3>15.2.1.1.3.&nbsp;
XmppAddr</h3>

<p>A server's domain identifier MAY be represented as an XmppAddr, i.e., as a UTF8String within an otherName entity inside the subjectAltName, using the <a class='info' href='#ASN.1'>[ASN.1]<span> (</span><span class='info'>CCITT, &ldquo;Recommendation X.208: Specification of Abstract Syntax Notation One (ASN.1),&rdquo; 1988.</span><span>)</span></a> Object Identifier "id-on-xmppAddr" specified under <a class='info' href='#security-certificates-generation-oid'>Section&nbsp;15.2.1.3<span> (</span><span class='info'>ASN.1 Object Identifier</span><span>)</span></a>.  In server certificates, this representation is included only for the sake of backward-compatibility.
</p>
<a name="security-certificates-generation-server-cn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.1.1.4"></a><h3>15.2.1.1.4.&nbsp;
Common Name</h3>

<p>A server's domain identifier SHOULD NOT be represented as a Common Name; instead, the Common Name field SHOULD be reserved for representation of a human-friendly name.
</p>
<a name="security-certificates-generation-server-examples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.1.1.5"></a><h3>15.2.1.1.5.&nbsp;
Examples</h3>

<p>For our first (relatively simple) example, consider a company called "Example Products, Inc."  It hosts an XMPP service at "im.example.com" (i.e., user addresses at the service are of the form "user@im.example.com"), and SRV lookups for the xmpp-client and xmpp-server services at "im.example.com" yield one machine, called "x.example.com", as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
_xmpp-client._tcp.im.example.com. 400 IN SRV 20 0 5222 x.example.com
_xmpp-server._tcp.im.example.com. 400 IN SRV 20 0 5269 x.example.com
</pre></div>
<p>The certificate presented by x.example.com contains the following representations:
</p>
<p>
              </p>
<ul class="text">
<li>An otherName type of SRVName (id-on-dnsSRV) containing an IA5String (ASCII) string of: "_xmpp-client.im.example.com"
</li>
<li>An otherName type of SRVName (id-on-dnsSRV) containing an IA5String (ASCII) string of: "_xmpp-server.im.example.com"
</li>
<li>A dNSName containing an ASCII string of "im.example.com"
</li>
<li>An otherName type of XmppAddr (id-on-xmppAddr) containing a UTF8 string of: "im.example.com"
</li>
<li>A CN containing an ASCII string of "Example Products, Inc."
</li>
</ul><p>
            
</p>
<p>For our second (more complex) example, consider an ISP called "Example Internet Services".  It hosts an XMPP service at "example.net" (i.e., user addresses at the service are of the form "user@example.net"), but SRV lookups for the xmpp-client and xmpp-server services at "example.net" yield two machines ("x1.example.net" and "x2.example.net"), as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
_xmpp-client._tcp.example.net. 68400 IN SRV 20 0 5222 x1.example.net.
_xmpp-client._tcp.example.net. 68400 IN SRV 20 0 5222 x2.example.net.
_xmpp-server._tcp.example.net. 68400 IN SRV 20 0 5269 x1.example.net.
_xmpp-server._tcp.example.net. 68400 IN SRV 20 0 5269 x2.example.net.
</pre></div>
<p>Example Internet Services also hosts chatrooms at chat.example.net, and provides an xmpp-server SRV record for that service as well (thus enabling entity from foreign domains to access that service).  It also may provide other such services in the future, so it wishes to represent a wildcard in its certificate to handle such growth.
</p>
<p>The certificate presented by either x1.example.net or x2.example.net contains the following representations:
</p>
<p>
              </p>
<ul class="text">
<li>An otherName type of SRVName (id-on-dnsSRV) containing an IA5String (ASCII) string of: "_xmpp-client.example.net"
</li>
<li>An otherName type of SRVName (id-on-dnsSRV) containing an IA5String (ASCII) string of: "_xmpp-server.example.net"
</li>
<li>An otherName type of SRVName (id-on-dnsSRV) containing an IA5String (ASCII) string of: "_xmpp-server.chat.example.net"
</li>
<li>A dNSName containing an ASCII string of "example.net"
</li>
<li>A dNSName containing an ASCII string of "*.example.net"
</li>
<li>An otherName type of XmppAddr (id-on-xmppAddr) containing a UTF8 string of: "example.net"
</li>
<li>An otherName type of XmppAddr (id-on-xmppAddr) containing a UTF8 string of: "chat.example.net"
</li>
<li>A CN containing an ASCII string of "Example Internet Services"
</li>
</ul><p>
            
</p>
<a name="security-certificates-generation-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.1.2"></a><h3>15.2.1.2.&nbsp;
Client Certificates</h3>

<p>In a digital certificate to be presented by an XMPP client controlled by a human user (i.e., a CLIENT CERTIFICATE), it is RECOMMENDED for the certificate to include one or more JIDs associated with an XMPP user.  If included, a JID MUST be represented as an XmppAddr, i.e., as a UTF8String within an otherName entity inside the subjectAltName, using the <a class='info' href='#ASN.1'>[ASN.1]<span> (</span><span class='info'>CCITT, &ldquo;Recommendation X.208: Specification of Abstract Syntax Notation One (ASN.1),&rdquo; 1988.</span><span>)</span></a> Object Identifier "id-on-xmppAddr" specified under <a class='info' href='#security-certificates-generation-oid'>Section&nbsp;15.2.1.3<span> (</span><span class='info'>ASN.1 Object Identifier</span><span>)</span></a>.
</p>
<a name="security-certificates-generation-oid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.1.3"></a><h3>15.2.1.3.&nbsp;
ASN.1 Object Identifier</h3>

<p>The <a class='info' href='#ASN.1'>[ASN.1]<span> (</span><span class='info'>CCITT, &ldquo;Recommendation X.208: Specification of Abstract Syntax Notation One (ASN.1),&rdquo; 1988.</span><span>)</span></a> Object Identifier "id-on-xmppAddr" (also called an XmppAddr) is defined as follows.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
id-pkix OBJECT IDENTIFIER ::= { iso(1) identified-organization(3)
        dod(6) internet(1) security(5) mechanisms(5) pkix(7) }

id-on  OBJECT IDENTIFIER ::= { id-pkix 8 }  -- other name forms

id-on-xmppAddr  OBJECT IDENTIFIER ::= { id-on 5 }

XmppAddr ::= UTF8String
</pre></div>
<p>As an alternative to the "id-on-xmppAddr" notation, this Object Identifier MAY be represented in dotted display format (i.e., "1.3.6.1.5.5.7.8.5") or in the Uniform Resource Name notation specified in <a class='info' href='#URN-OID'>[URN&#8209;OID]<span> (</span><span class='info'>Mealling, M., &ldquo;A URN Namespace of Object Identifiers,&rdquo; February&nbsp;2001.</span><span>)</span></a> (i.e., "urn:oid:1.3.6.1.5.5.7.8.5").
</p>
<p>Thus for example the JID "juliet@im.example.com" as included in a certificate could be formatted in any of the following three ways:
</p>
<p>
            </p>
<blockquote class="text"><dl>
<dt>id-on-xmppAddr:</dt>
<dd>subjectAltName=otherName:id-on-xmppAddr;UTF8:juliet@im.example.com
</dd>
<dt>dotted display format:</dt>
<dd>subjectAltName=otherName:1.3.6.1.5.5.7.8.5;UTF8:juliet@im.example.com
</dd>
<dt>URN notation:</dt>
<dd>subjectAltName=otherName:urn:oid:1.3.6.1.5.5.7.8.5;UTF8:juliet@im.example.com
</dd>
</dl></blockquote><p>
          
</p>
<p>Use of the "id-on-xmppAddr" format is RECOMMENDED in the generation of certificates, but all three formats MUST be supported for the purpose of certificate validation.
</p>
<a name="security-certificates-validation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.2"></a><h3>15.2.2.&nbsp;
Certificate Validation</h3>

<p>When an XMPP entity is presented with a server certificate or client certificate by a peer for the purpose of encryption or authentication of XML streams as described under <a class='info' href='#tls'>Section&nbsp;6<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a> and <a class='info' href='#sasl'>Section&nbsp;7<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>, the entity MUST validate the certificate to determine if the certificate shall be considered a TRUSTED CERTIFICATE, i.e., a certificate that is acceptable for encryption and/or authentication in accordance with the XMPP entity's local service policies or configured settings.
</p>
<p>For both server certificates and client certificates, the validating entity MUST verify the integrity of the certificate, MUST verify that the certificate has been properly signed by the issuing Certificate Authority, and MUST support certificate revocation messages.  An implementation MUST enable a human user to view information about the full chain of certificates.
</p>
<p>The following sections describe certificate validation rules for server-to-server and client-to-server streams.
</p>
<a name="security-certificates-validation-s2s"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.2.1"></a><h3>15.2.2.1.&nbsp;
Server-to-Server Streams</h3>

<p>When an XMPP entity (client or server) validates a certificate presented by an XMPP server, there are three possible cases, as discussed in the following sections.
</p>
<a name="security-certificates-validation-server-case1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.2.1.1"></a><h3>15.2.2.1.1.&nbsp;
Case #1</h3>

<p>If the server certificate appears to be certified by a chain of certificates terminating in a trust anchor (as described in Section 6.1 of <a class='info' href='#X509'>[X509]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>), the entity MUST check the certificate for any instances of the SRVName, dNSName, and XmppAddr (in that order of preference) as described under <a class='info' href='#security-certificates-generation-server-srvname'>Section&nbsp;15.2.1.1.1<span> (</span><span class='info'>SRVName</span><span>)</span></a>, <a class='info' href='#security-certificates-generation-server-dnsname'>Section&nbsp;15.2.1.1.2<span> (</span><span class='info'>dNSName</span><span>)</span></a>, and <a class='info' href='#security-certificates-generation-server-xmppaddr'>Section&nbsp;15.2.1.1.3<span> (</span><span class='info'>XmppAddr</span><span>)</span></a>.  There are three possible sub-cases:
</p>
<p>
              </p>
<blockquote class="text"><dl>
<dt>Sub-Case #1:</dt>
<dd>The entity finds at least one SRVName, dNSName, or XmppAddr that matches the hostname to which it attempted to connect; the entity MUST use this represented domain identifier as the validated identity of the XMPP server.  The server certificate MUST be checked against the hostname as provided by the entity (client or server), not the hostname as resolved via the Domain Name System; e.g., if a user specifies a hostname of "example.net" but a <a class='info' href='#DNS-SRV'>[DNS&#8209;SRV]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> lookup returns "x1.example.net", the certificate MUST be checked as "example.net".  A user-oriented client MAY provide a configuration setting that enables a human user to explicitly specify a hostname to be checked for connection purposes.
</dd>
<dt>Sub-Case #2:</dt>
<dd>The entity finds no SRVName, dNSName, or XmppAddr that matches the hostname to which it attempted to connect and a human user has not permanently accepted the certificate during a previous connection attempt; the entity MUST NOT use the represented domain identifier (if any) as the validated identity of the XMPP server.  Instead, if the connecting entity is a user-oriented client then it MUST either (1) automatically terminate the connection with a bad certificate error or (2) show the certificate (including the entire certificate chain) to the user and give the user the choice of terminating the connecting or accepting the certificate temporarily (i.e., for this connection attempt only) or permanently (i.e., for all future connection attempts) and then continuing with the connection; if a user permanently accepts a certificate in this way, the client MUST cache the certificate (or some non-forgeable representation such as a hash) and in future connection attempts behave as in Sub-Case #3.  (It is the resposibility of the human user to verify the hash or fingerprint of the certificate with the peer over a trusted communication layer.)  If the connecting entity is an XMPP server or an automated client, the application SHOULD terminate the connection (with a bad certificate error) and log the error to an appropriate audit log; an XMPP server or automated client MAY provide a configuration setting that disables this check, but MUST provide a setting that enables the check.
</dd>
<dt>Sub-Case #3:</dt>
<dd>The entity finds no SRVName, dNSName, or XmppAddr that matches the hostname to which it attempted to connect but a human user has permanently accepted the certificate during a previous connection attempt; the entity MUST verify that the cached certificate was presented and MUST notify the user if the certificate has changed.
</dd>
</dl></blockquote><p>
            
</p>
<a name="security-certificates-validation-server-case2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.2.1.2"></a><h3>15.2.2.1.2.&nbsp;
Case #2</h3>

<p>If the server certificate is certified by a Certificate Authority not known to the entity, the entity MUST proceed as under Case #1, Sub-Case #2 or Case #1, Sub-Case #3 as appropriate.
</p>
<a name="security-certificates-validation-server-case3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.2.1.3"></a><h3>15.2.2.1.3.&nbsp;
Case #3</h3>

<p>If the server certificate is self-signed, the entity MUST proceed as under Case #1, Sub-Case #2 or Case #1, Sub-Case #3 as appropriate.
</p>
<a name="security-certificates-validation-c2s"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.2.2"></a><h3>15.2.2.2.&nbsp;
Client-to-Server Streams</h3>

<p>When an XMPP server validates a certificate presented by a client, there are three possible cases, as discussed in the following sections.
</p>
<a name="security-certificates-validation-client-case1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.2.2.1"></a><h3>15.2.2.2.1.&nbsp;
Case #1</h3>

<p>If the client certificate appears to be certified by a chain of certificates terminating in a trust anchor (as described in Section 6.1 of <a class='info' href='#X509'>[X509]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>), the server MUST check the certificate for any instances of the XmppAddr as described under <a class='info' href='#security-certificates-generation-oid'>Section&nbsp;15.2.1.3<span> (</span><span class='info'>ASN.1 Object Identifier</span><span>)</span></a>.  There are three possible sub-cases:
</p>
<p>
              </p>
<blockquote class="text"><dl>
<dt>Sub-Case #1:</dt>
<dd>The server finds one XmppAddr for which the domain identifier portion of the represented JID matches one of the configured hostnames of the server itself; the server SHOULD use this represented JID as the validated identity of the client.
</dd>
<dt>Sub-Case #2:</dt>
<dd>The server finds more than one XmppAddr for which the domain identifier portion of the represented JID matches one of the configured hostnames of the server itself; the server SHOULD use one of these represented JIDs as the validated identity of the client, choosing among them according to local service policies or based on the 'to' address of the initial stream header.
</dd>
<dt>Sub-Case #3:</dt>
<dd>The server finds no XmppAddrs, or finds at least one XmppAddr but the domain identifier portion of the represented JID does not match one of the configured hostnames of the server itself; the server MUST NOT use the represented JID (if any) as the validated identity of the client but instead MUST either validate the identity of the client using other means.
</dd>
</dl></blockquote><p>
            
</p>
<a name="security-certificates-validation-client-case2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.2.2.2"></a><h3>15.2.2.2.2.&nbsp;
Case #2</h3>

<p>If the client certificate is certified by a Certificate Authority not known to the server, the server MUST proceed as under Case #1, Sub-Case #3.
</p>
<a name="security-certificates-validation-client-case3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.2.2.3"></a><h3>15.2.2.2.3.&nbsp;
Case #3</h3>

<p>If the client certificate is self-signed, the server MUST proceed as under Case #1, Sub-Case #3.
</p>
<a name="security-certificates-validation-extensions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2.2.3"></a><h3>15.2.2.3.&nbsp;
Use of Certificates in XMPP Extensions</h3>

<p>Certificates MAY be used in extensions to XMPP for the purpose of application-layer encryption or authentication above the level of XML streams (e.g., for end-to-end encryption).  Such extensions shall define their own certificate handling rules, which at a minimum SHOULD be consistent with the rules specified herein but MAY specify additional rules.
</p>
<a name="security-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.3"></a><h3>15.3.&nbsp;
Client-to-Server Communication</h3>

<p>A compliant client implementation MUST support both TLS and SASL for connections to a server.
</p>
<p>The TLS protocol for encrypting XML streams (defined under <a class='info' href='#tls'>Section&nbsp;6<span> (</span><span class='info'>STARTTLS Negotiation</span><span>)</span></a>) provides a reliable mechanism for helping to ensure the confidentiality and data integrity of data exchanged between two entities.
</p>
<p>The SASL protocol for authenticating XML streams (defined under <a class='info' href='#sasl'>Section&nbsp;7<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>) provides a reliable mechanism for validating that a client connecting to a server is who it claims to be.
</p>
<p>Client-to-server communication MUST NOT proceed until the DNS hostname asserted by the server has been resolved as specified under <a class='info' href='#tcp'>Section&nbsp;4<span> (</span><span class='info'>TCP Binding</span><span>)</span></a>.  If there is a mismatch between the hostname to which a client attempted to connect (e.g., "example.net") and the hostname to which the client actually connects (e.g., "x1.example.net"), the client MUST warn a human user about the mismatch and the human user MUST approve the connection before the client proceeds; however, the client MAY also allow the user to add the presented hostname to a configured set of accepted hostnames to expedite future connections.
</p>
<p>A client's IP address and method of access MUST NOT be made public by a server, nor are any connections other than the original server connection required.  This helps to protect the client's server from direct attack or identification by third parties.
</p>
<a name="security-server"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.4"></a><h3>15.4.&nbsp;
Server-to-Server Communication</h3>

<p>A compliant server implementation MUST support both TLS and SASL for inter-domain communication.
</p>
<p>Because service provisioning is a matter of policy, it is optional for any given domain to communicate with other domains, and server-to-server communication may be disabled by the administrator of any given deployment.  If a particular domain enables inter-domain communication, it should enable high security.
</p>
<p>Administrators may want to require use of SASL for server-to-server communication to ensure both authentication and confidentiality (e.g., on an organization's private network).  Compliant implementations SHOULD support SASL for this purpose.
</p>
<p>Server-to-server communication MUST NOT proceed until the DNS hostnames asserted by both servers have been resolved as specified under <a class='info' href='#tcp'>Section&nbsp;4<span> (</span><span class='info'>TCP Binding</span><span>)</span></a>.
</p>
<a name="security-layers"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.5"></a><h3>15.5.&nbsp;
Order of Layers</h3>

<p>The order of layers in which protocols MUST be stacked is:
</p>
<p></p>
<ol class="text">
<li>TCP
</li>
<li>TLS
</li>
<li>SASL
</li>
<li>XMPP
</li>
</ol>

<p>The rationale for this order is that <a class='info' href='#TCP'>[TCP]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> is the base connection layer used by all of the protocols stacked on top of TCP, <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.1,&rdquo; April&nbsp;2006.</span><span>)</span></a> is often provided at the operating system layer, <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a> is often provided at the application layer, and XMPP is the application itself.
</p>
<a name="security-channel"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.6"></a><h3>15.6.&nbsp;
Lack of SASL Channel Binding to TLS</h3>

<p>The SASL framework itself does not provide a method for binding SASL authentication to a security layer providing confidentiality and integrity protection that was negotiated at a lower layer.  Such a binding is known as a "channel binding" (see <a class='info' href='#CHANNEL'>[CHANNEL]<span> (</span><span class='info'>Williams, N., &ldquo;On the Use of Channel Bindings to Secure Channels,&rdquo; November&nbsp;2007.</span><span>)</span></a>).  Some SASL mechanisms provide channel bindings.  However, if a SASL mechanism does not provide a channel binding, then the mechanism cannot provide a way to verify that the source and destination end points to which the lower layer's security is bound are equivalent to the end points that SASL is authenticating; furthermore, if the end points are not identical, then the lower layer's security cannot be trusted to protect data transmitted between the SASL-authenticated entities.  In such a situation, a SASL security layer SHOULD be negotiated that effectively ignores the presence of the lower-layer security.
</p>
<a name="security-mandatory"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.7"></a><h3>15.7.&nbsp;
Mandatory-to-Implement Technologies</h3>

<p>At a minimum, all implementations MUST support the following mechanisms:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>for confidentiality only:</dt>
<dd>TLS (using the TLS_RSA_WITH_3DES_EDE_CBC_SHA cipher)
</dd>
<dt>for both confidentiality and authentication:</dt>
<dd>TLS plus the SASL PLAIN mechanism (See <a class='info' href='#PLAIN'>[PLAIN]<span> (</span><span class='info'>Zeilenga, K., &ldquo;The PLAIN Simple Authentication and Security Layer (SASL) Mechanism,&rdquo; August&nbsp;2006.</span><span>)</span></a>) for password-based authentication and TLS plus the SASL EXTERNAL mechanism (see Appendix A of <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a>) for non-password-based authentication (using the TLS_RSA_WITH_3DES_EDE_CBC_SHA cipher supporting peer certificates)
</dd>
</dl></blockquote>

<p>Naturally, implementations MAY support other ciphers with TLS and MAY support other SASL mechanisms.
</p>
<p></p>
<blockquote class="text">
<p>Note: The use of TLS plus SASL PLAIN replaces the SASL DIGEST-MD5 mechanism as XMPP's mandatory-to-implement password-based method for authentication.  For backward-compatibility, implementations are encouraged to continue supporting the SASL DIGEST-MD5 mechanism as specified in <a class='info' href='#DIGEST-MD5'>[DIGEST&#8209;MD5]<span> (</span><span class='info'>Leach, P. and C. Newman, &ldquo;Using Digest Authentication as a SASL Mechanism,&rdquo; May&nbsp;2000.</span><span>)</span></a>.
</p>
</blockquote>

<a name="security-firewalls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.8"></a><h3>15.8.&nbsp;
Firewalls</h3>

<p>Communication using XMPP normally occurs over TCP connections on port 5222 (client-to-server) or port 5269 (server-to-server), as registered with the IANA (see <a class='info' href='#iana'>Section&nbsp;16<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>).  Use of these well-known ports allows administrators to easily enable or disable XMPP activity through existing and commonly-deployed firewalls.
</p>
<a name="security-base64"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.9"></a><h3>15.9.&nbsp;
Use of base64 in SASL</h3>

<p>Both the client and the server MUST verify any base64 data received during <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>.  An implementation MUST reject (not ignore) any characters that are not explicitly allowed by the base64 alphabet; this helps to guard against creation of a covert channel that could be used to "leak" information.
</p>
<p>An implementation MUST NOT break on invalid input and MUST reject any sequence of base64 characters containing the pad ('=') character if that character is included as something other than the last character of the data (e.g., "=AAA" or "BBBB=CCC"); this helps to guard against buffer overflow attacks and other attacks on the implementation.
</p>
<p>While base 64 encoding visually hides otherwise easily recognized information (such as passwords), it does not provide any computational confidentiality.
</p>
<p>All uses of base 64 encoding MUST follow the definition in Section 4 of <a class='info' href='#BASE64'>[BASE64]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; October&nbsp;2006.</span><span>)</span></a> and padding bits MUST be set to zero.
</p>
<a name="security-stringprep"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.10"></a><h3>15.10.&nbsp;
Stringprep Profiles</h3>

<p>XMPP makes use of the <a class='info' href='#NAMEPREP'>[NAMEPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),&rdquo; March&nbsp;2003.</span><span>)</span></a> profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> for processing of domain identifiers; for security considerations related to Nameprep, refer to the appropriate section of <a class='info' href='#NAMEPREP'>[NAMEPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),&rdquo; March&nbsp;2003.</span><span>)</span></a>.
</p>
<p>In addition, XMPP defines two profiles of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>: <a class='info' href='#nodeprep'>Nodeprep<span> (</span><span class='info'>Nodeprep</span><span>)</span></a> for node identifiers and <a class='info' href='#resourceprep'>Resourceprep<span> (</span><span class='info'>Resourceprep</span><span>)</span></a> for resource identifiers.
</p>
<p>The Unicode and ISO/IEC 10646 repertoires have many characters that look similar.  In many cases, users of security protocols might perform visual matching, such as when comparing the names of trusted third parties.  Because it is impossible to map similar-looking characters without a great deal of context (such as knowing the fonts used), stringprep does nothing to map similar-looking characters together, nor to prohibit some characters because they look like others.
</p>
<p>A node identifier can be employed as one part of an entity's address in XMPP.  One common usage is as the username of an instant messaging user; another is as the name of a multi-user conference room; and many other kinds of entities could use node identifiers as part of their addresses.  The security of such services could be compromised based on different interpretations of the internationalized node identifier; for example, a user entering a single internationalized node identifier could access another user's account information, or a user could gain access to a hidden or otherwise restricted chat room or service.
</p>
<p>A resource identifier can be employed as one part of an entity's address in XMPP.  One common usage is as the name for an instant messaging user's connected resource; another is as the nickname of a user in a multi-user conference room; and many other kinds of entities could use resource identifiers as part of their addresses.  The security of such services could be compromised based on different interpretations of the internationalized resource identifier; for example, a user could attempt to initiate multiple connections with the same name, or a user could send a message to someone other than the intended recipient in a multi-user conference room.
</p>
<a name="security-spoofing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.11"></a><h3>15.11.&nbsp;
Address Spoofing</h3>

<p>As discussed in <a class='info' href='#XEP-0165'>[XEP&#8209;0165]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Best Practices to Prevent JID Mimicking,&rdquo; July&nbsp;2007.</span><span>)</span></a>, there are two forms of address spoofing: forging and mimicking.
</p>
<a name="security-forging"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.11.1"></a><h3>15.11.1.&nbsp;
Address Forging</h3>

<p>In the context of XMPP technologies, address forging occurs when an entity is able to generate an XML stanza whose 'from' address does not correspond to the account credentials with which the entity authenticated onto the network (or an authorization identity provided during <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>SASL Negotiation</span><span>)</span></a>).  For example, address forging occurs if an entity that authenticated as "juliet@im.example.com" is able to send XML stanzas from "nurse@im.example.com" or "romeo@example.net".
</p>
<p>Address forging is difficult in XMPP systems, given the requirement for sending servers to stamp 'from' addresses and for receiving servers to verify sending domains via server-to-server authentication.  However, address forging is not impossible, since a rogue server could forge JIDs at the sending domain by ignoring the stamping requirement.  A rogue server could even forge JIDs at other domains by means of a DNS poisoning attack if <a class='info' href='#DNSSEC'>[DNSSEC]<span> (</span><span class='info'>Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;DNS Security Introduction and Requirements,&rdquo; March&nbsp;2005.</span><span>)</span></a> is not used.  This specification does not define methods for discovering or counteracting such rogue servers.
</p>
<a name="security-mimicking"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.11.2"></a><h3>15.11.2.&nbsp;
Address Mimicking</h3>

<p>Address mimicking occus when an entity provides legitimate authentication credentials for and sends XML stanzas from an account whose JID appears to a human user to be the same as another JID.  For example, in some XMPP clients the address "paypa1@example.org" (spelled with the number one as the final character of the node identifier) may appear to be the same as "paypal@example.org (spelled with the lower-case version of the letter "L"), especially on casual visual inspection; this phenomenon is sometimes called "typejacking".  A more sophisticated example of address mimicking might involve the use of characters from outside the US-ASCII range, such as the Cherokee characters U+13DA U+13A2 U+13B5 U+13AC U+13A2 U+13AC U+13D2 instead of the US-ASCII characters "STPETER".
</p>
<p>In some examples of address mimicking, it is unlikely that the average user could tell the difference between the real JID and the fake JID.  (Naturally, there is no way to distinguish with full certainty which is the fake JID and which is the real JID; in some communication contexts, the JID with Cherokee characters may be the real JID and the JID with US-ASCII characters may thus appear to be the fake JID.)  Because JIDs can contain almost any Unicode character, it may be relatively easy to mimic some JIDs in XMPP systems.  The possibility of address mimicking introduces security vulnerabilities of the kind that have also plagued the World Wide Web, specifically the phenomenon known as phishing.
</p>
<p>Mimicked addresses that involve characters from only one character set or from the character set typically employed by a particular user are not easy to combat (e.g., the simple typejacking attack previously described, which relies on a surface similarity between the characters "1" and "l" in some presentations).  However, mimicked addresses that involve characters from more than one character set, or from a character set not typically employed by a particular user, can be mitigated somewhat through intelligent presentation.  In particular, every human user of an XMPP technology presumably has a preferred language (or, in some cases, a small set of preferred languages), which an XMPP application SHOULD gather either explicitly from the user or implicitly via the operating system of the user's device.  Furthermore, every language has a range (or a small set of ranges) of characters normally used to represent that language in textual form.  Therefore, an XMPP application SHOULD warn the user when presenting a JID that uses characters outside the normal range of the user's preferred language(s).  This recommendation is not intended to discourage communication across language communities; instead, it recognizes the existence of such language communities and encourages due caution when presenting unfamiliar character sets to human users.
</p>
<p>For more detailed recommendations regarding prevention of address mimicking in XMPP systems, refer to <a class='info' href='#XEP-0165'>[XEP&#8209;0165]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Best Practices to Prevent JID Mimicking,&rdquo; July&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="security-dos"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.12"></a><h3>15.12.&nbsp;
Denial of Service</h3>

<p><a class='info' href='#DOS'>[DOS]<span> (</span><span class='info'>Handley, M., Rescorla, E., and IAB, &ldquo;Internet Denial-of-Service Considerations,&rdquo; December&nbsp;2006.</span><span>)</span></a> defines denial of service as follows:
</p>
<p>
        </p>
<blockquote class="text"><dl>
<dt></dt>
<dd>A Denial-of-Service (DoS) attack is an attack in which one or more machines target a victim and attempt to prevent the victim from doing useful work. The victim can be a network server, client or router, a network link or an entire network, an individual Internet user or a company doing business using the Internet, an Internet Service Provider (ISP), country, or any combination of or variant on these.
</dd>
</dl></blockquote><p>
      
</p>
<p><a class='info' href='#XEP-0205'>[XEP&#8209;0205]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Best Practices to Discourage Denial of Service Attacks,&rdquo; July&nbsp;2007.</span><span>)</span></a> provides a detailed discussion of potential denial of service attacks against XMPP systems and best practices for preventing such attacks.  The recommendations include:
</p>
<p>
        </p>
<ol class="text">
<li>A server implementation SHOULD enable a server administrator to limit the number of TCP connections that it will accept from a given IP address at any one time.  If an entity attempts to connect but the maximum number of TCP connections has been reached, the receiving server MUST NOT allow the new connection to proceed.
</li>
<li>A server implementation SHOULD enable a server administrator to limit the number of TCP connection attempts that it will accept from a given IP address in a given time period.  (While it is possible to limit the number of connections at the TCP layer rather than at the XMPP application layer, care must be taken in doing so since limits at the TCP layer might result in an inability to access non-XMPP services.)  If an entity attempts to connect but the maximum number of connections has been reached, the receiving server MUST NOT allow the new connection to proceed.
</li>
<li>A server MUST NOT process XML stanzas from clients that have not yet provided appropriate authentication credentials and MUST NOT process XML stanzas from peer servers whose identity it has not either authenticated via SASL or weakly verified via server dialback (see <a class='info' href='#XEP-0220'>[XEP&#8209;0220]<span> (</span><span class='info'>Saint-Andre, P. and J. Miller, &ldquo;Server Dialback,&rdquo; June&nbsp;2008.</span><span>)</span></a>).
</li>
<li>A server implementation SHOULD enable a server administrator to limit the number of connected resources it will allow an account to bind at any one time.  If a client attempts to bind a resource but it has already reached the configured number of allowable resources, the receiving server MUST return a &lt;resource-constraint/&gt; stanza error.
</li>
<li>A server implementation SHOULD enable a server administrator to limit the size of stanzas it will accept from a connected client or peer server.  If a connected resource or peer server sends a stanza that violates the upper limit, the receiving server SHOULD NOT process the stanza and instead SHOULD return a &lt;not-allowed/&gt; stanza error.  Alternatively (e.g., if the sender has sent an egregiously large stanza), the server MAY instead return a &lt;policy-violation/&gt; stream error.
</li>
<li>A server implementation SHOULD enable a server administrator to limit the number of XML stanzas that a connected client may send to distinct recipients within a given time period.  If a connected client sends too many stanzas to distinct recipients in a given time period, the receiving server SHOULD NOT process the stanza and instead SHOULD return an &lt;unexpected-request/&gt; stanza error.
</li>
<li>A server implementation SHOULD enable a server administrator to limit the amount of bandwidth it will allow a connected client or peer server to use in a given time period.
</li>
<li>A server implementation MAY enable a server administrator to limit the types of stanzas (based on the extended content "payload") that it will allow a connected resource or peer server send over an active connection.  Such limits and restrictions are a matter of deployment policy.
</li>
<li>A server implementation MAY refuse to route or deliver any stanza that it considers to be abusive, with or without returning an error to the sender.
</li>
</ol><p>
      
</p>
<p>For more detailed recommendations regarding denial of service attacks in XMPP systems, refer to <a class='info' href='#XEP-0205'>[XEP&#8209;0205]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Best Practices to Discourage Denial of Service Attacks,&rdquo; July&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="security-leak"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.13"></a><h3>15.13.&nbsp;
Presence Leaks</h3>

<p>One of the core aspects of XMPP is presence, i.e., widespread information about the network availability of XMPP entities.  Although presence is discussed more fully in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a>, it is important to note that an XMPP server MUST NOT disclose an entity's presence to entities that are not authorized to know that information (such a disclosure is called a PRESENCE LEAK).  In particular at the core XMPP level, real-time addressing and network availability is associated with a specific connected resource; therefore, any disclosure of a connected resource's full JID comprises a presence leak.  To help prevent such a presence leak, a server MUST NOT return different stanza errors if a potential attacker sends XML stanzas to the entity's bare JID (&lt;node@domain&gt;) or full JID (&lt;node@domain/resource&gt;).
</p>
<a name="security-harvesting"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.14"></a><h3>15.14.&nbsp;
Directory Harvesting</h3>

<p>To help prevent directory harvesting attacks, a server MUST NOT return different stanza errors if a potential attacker sends XML stanzas to an existing entity or a nonexistent entity.
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16"></a><h3>16.&nbsp;
IANA Considerations</h3>

<p>The following sections update the registrations provided in <a class='info' href='#RFC3920'>[RFC3920]<span> (</span><span class='info'>Saint-Andre, P., Ed., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a>.
</p>
<a name="iana-ns-tls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16.1"></a><h3>16.1.&nbsp;
XML Namespace Name for TLS Data</h3>

<p>A URN sub-namespace for STARTTLS negotiation data in the Extensible Messaging and Presence Protocol (XMPP) is defined as follows.  (This namespace name adheres to the format defined in <a class='info' href='#XML-REG'>[XML&#8209;REG]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.)
</p>
<p></p>
<blockquote class="text"><dl>
<dt>URI:</dt>
<dd>urn:ietf:params:xml:ns:xmpp-tls
</dd>
<dt>Specification:</dt>
<dd>XXXX
</dd>
<dt>Description:</dt>
<dd>This is the XML namespace name for STARTTLS negotiation data in the Extensible Messaging and Presence Protocol (XMPP) as defined by XXXX.
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, XMPP Working Group, &lt;xmppwg@xmpp.org&gt;
</dd>
</dl></blockquote>

<a name="iana-ns-sasl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16.2"></a><h3>16.2.&nbsp;
XML Namespace Name for SASL Data</h3>

<p>A URN sub-namespace for SASL negotiation data in the Extensible Messaging and Presence Protocol (XMPP) is defined as follows.  (This namespace name adheres to the format defined in <a class='info' href='#XML-REG'>[XML&#8209;REG]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.)
</p>
<p></p>
<blockquote class="text"><dl>
<dt>URI:</dt>
<dd>urn:ietf:params:xml:ns:xmpp-sasl
</dd>
<dt>Specification:</dt>
<dd>XXXX
</dd>
<dt>Description:</dt>
<dd>This is the XML namespace name for SASL negotiation data in the Extensible Messaging and Presence Protocol (XMPP) as defined by XXXX.
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, XMPP Working Group, &lt;xmppwg@xmpp.org&gt;
</dd>
</dl></blockquote>

<a name="iana-ns-streams"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16.3"></a><h3>16.3.&nbsp;
XML Namespace Name for Stream Errors</h3>

<p>A URN sub-namespace for stream error data in the Extensible Messaging and Presence Protocol (XMPP) is defined as follows.  (This namespace name adheres to the format defined in <a class='info' href='#XML-REG'>[XML&#8209;REG]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.)
</p>
<p></p>
<blockquote class="text"><dl>
<dt>URI:</dt>
<dd>urn:ietf:params:xml:ns:xmpp-streams
</dd>
<dt>Specification:</dt>
<dd>XXXX
</dd>
<dt>Description:</dt>
<dd>This is the XML namespace name for stream error data in the Extensible Messaging and Presence Protocol (XMPP) as defined by XXXX.
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, XMPP Working Group, &lt;xmppwg@xmpp.org&gt;
</dd>
</dl></blockquote>

<a name="iana-ns-bind"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16.4"></a><h3>16.4.&nbsp;
XML Namespace Name for Resource Binding</h3>

<p>A URN sub-namespace for resource binding in the Extensible Messaging and Presence Protocol (XMPP) is defined as follows.  (This namespace name adheres to the format defined in <a class='info' href='#XML-REG'>[XML&#8209;REG]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.)
</p>
<p></p>
<blockquote class="text"><dl>
<dt>URI:</dt>
<dd>urn:ietf:params:xml:ns:xmpp-bind
</dd>
<dt>Specification:</dt>
<dd>XXXX
</dd>
<dt>Description:</dt>
<dd>This is the XML namespace name for resource binding in the Extensible Messaging and Presence Protocol (XMPP) as defined by XXXX.
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, XMPP Working Group, &lt;xmppwg@xmpp.org&gt;
</dd>
</dl></blockquote>

<a name="iana-ns-stanzas"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16.5"></a><h3>16.5.&nbsp;
XML Namespace Name for Stanza Errors</h3>

<p>A URN sub-namespace for stanza error data in the Extensible Messaging and Presence Protocol (XMPP) is defined as follows.  (This namespace name adheres to the format defined in <a class='info' href='#XML-REG'>[XML&#8209;REG]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.)
</p>
<p></p>
<blockquote class="text"><dl>
<dt>URI:</dt>
<dd>urn:ietf:params:xml:ns:xmpp-stanzas
</dd>
<dt>Specification:</dt>
<dd>XXXX
</dd>
<dt>Description:</dt>
<dd>This is the XML namespace name for stanza error data in the Extensible Messaging and Presence Protocol (XMPP) as defined by XXXX.
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, XMPP Working Group, &lt;xmppwg@xmpp.org&gt;
</dd>
</dl></blockquote>

<a name="iana-nodeprep"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16.6"></a><h3>16.6.&nbsp;
Nodeprep Profile of Stringprep</h3>

<p>The Nodeprep profile of stringprep is defined under <a class='info' href='#nodeprep'>Nodeprep<span> (</span><span class='info'>Nodeprep</span><span>)</span></a>.  The IANA has registered Nodeprep in the stringprep profile registry.
</p>
<p>Name of this profile:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Nodeprep
</dd>
</dl></blockquote>

<p>RFC in which the profile is defined:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>XXXX
</dd>
</dl></blockquote>

<p>Indicator whether or not this is the newest version of the profile:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>This is the first version of Nodeprep
</dd>
</dl></blockquote>

<a name="iana-resourceprep"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16.7"></a><h3>16.7.&nbsp;
Resourceprep Profile of Stringprep</h3>

<p>The Resourceprep profile of stringprep is defined under <a class='info' href='#resourceprep'>Resourceprep<span> (</span><span class='info'>Resourceprep</span><span>)</span></a>.  The IANA has registered Resourceprep in the stringprep profile registry.
</p>
<p>Name of this profile:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Resourceprep
</dd>
</dl></blockquote>

<p>RFC in which the profile is defined:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>XXXX
</dd>
</dl></blockquote>

<p>Indicator whether or not this is the newest version of the profile:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>This is the first version of Resourceprep
</dd>
</dl></blockquote>

<a name="iana-gssapi"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16.8"></a><h3>16.8.&nbsp;
GSSAPI Service Name</h3>

<p>The IANA has registered "xmpp" as a <a class='info' href='#GSS-API'>GSSAPI<span> (</span><span class='info'>Linn, J., &ldquo;Generic Security Service Application Program Interface Version 2, Update 1,&rdquo; January&nbsp;2000.</span><span>)</span></a> [GSS&#8209;API] service name, as defined under <a class='info' href='#sasl-def'>Section&nbsp;7.5<span> (</span><span class='info'>SASL Definition</span><span>)</span></a>.
</p>
<a name="iana-ports"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16.9"></a><h3>16.9.&nbsp;
Port Numbers</h3>

<p>The IANA has registered "xmpp-client" and "xmpp-server" as keywords for <a class='info' href='#TCP'>[TCP]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> ports 5222 and 5269 respectively.
</p>
<p>These ports SHOULD be used for client-to-server and server-to-server communications respectively, but other ports MAY be used.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.17"></a><h3>17.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>17.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ABNF">[ABNF]</a></td>
<td class="author-text"><a href="mailto:dcrocker@bbiw.net">Crocker, D.</a> and <a href="mailto:paulo@turnpike.com">P. Overell</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc4234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; RFC&nbsp;4234, October&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc4234.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="BASE64">[BASE64]</a></td>
<td class="author-text">Josefsson, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>,&rdquo; RFC&nbsp;4648, October&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4648.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="CHARSET">[CHARSET]</a></td>
<td class="author-text"><a href="mailto:Harald.T.Alvestrand@uninett.no">Alvestrand, H.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2277">IETF Policy on Character Sets and Languages</a>,&rdquo; BCP&nbsp;18, RFC&nbsp;2277, January&nbsp;1998 (<a href="ftp://ftp.isi.edu/in-notes/rfc2277.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2277.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2277.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="DNS">[DNS]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1035, November&nbsp;1987 (<a href="ftp://ftp.isi.edu/in-notes/rfc1035.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="DNS-SRV">[DNS-SRV]</a></td>
<td class="author-text"><a href="mailto:arnt@troll.no">Gulbrandsen, A.</a>, Vixie, P., and <a href="mailto:levone@microsoft.com">L. Esibov</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>,&rdquo; RFC&nbsp;2782, February&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2782.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IDNA">[IDNA]</a></td>
<td class="author-text">Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;<a href="http://tools.ietf.org/html/rfc3490">Internationalizing Domain Names in Applications (IDNA)</a>,&rdquo; RFC&nbsp;3490, March&nbsp;2003 (<a href="ftp://ftp.isi.edu/in-notes/rfc3490.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IPv6">[IPv6]</a></td>
<td class="author-text">Hinden, R. and S. Deering, &ldquo;<a href="http://tools.ietf.org/html/rfc4291">IP Version 6 Addressing Architecture</a>,&rdquo; RFC&nbsp;4291, February&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4291.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="LANGTAGS">[LANGTAGS]</a></td>
<td class="author-text">Phillips, A. and M. Davis, &ldquo;<a href="http://tools.ietf.org/html/rfc4646">Tags for Identifying Languages</a>,&rdquo; BCP&nbsp;47, RFC&nbsp;4646, September&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4646.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="NAMEPREP">[NAMEPREP]</a></td>
<td class="author-text">Hoffman, P. and M. Blanchet, &ldquo;<a href="http://tools.ietf.org/html/rfc3491">Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN)</a>,&rdquo; RFC&nbsp;3491, March&nbsp;2003 (<a href="ftp://ftp.isi.edu/in-notes/rfc3491.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="PLAIN">[PLAIN]</a></td>
<td class="author-text">Zeilenga, K., &ldquo;<a href="http://tools.ietf.org/html/rfc4616">The PLAIN Simple Authentication and Security Layer (SASL) Mechanism</a>,&rdquo; RFC&nbsp;4616, August&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4616.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RANDOM">[RANDOM]</a></td>
<td class="author-text">Eastlake, D., Schiller, J., and S. Crocker, &ldquo;<a href="http://tools.ietf.org/html/rfc4086">Randomness Requirements for Security</a>,&rdquo; BCP&nbsp;106, RFC&nbsp;4086, June&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc4086.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2373">[RFC2373]</a></td>
<td class="author-text"><a href="mailto:hinden@iprg.nokia.com">Hinden, R.</a> and <a href="mailto:deering@cisco.com">S. Deering</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2373">IP Version 6 Addressing Architecture</a>,&rdquo; RFC&nbsp;2373, July&nbsp;1998 (<a href="ftp://ftp.isi.edu/in-notes/rfc2373.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2373.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SASL">[SASL]</a></td>
<td class="author-text">Melnikov, A. and K. Zeilenga, &ldquo;<a href="http://tools.ietf.org/html/rfc4422">Simple Authentication and Security Layer (SASL)</a>,&rdquo; RFC&nbsp;4422, June&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4422.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="STRINGPREP">[STRINGPREP]</a></td>
<td class="author-text">Hoffman, P. and M. Blanchet, &ldquo;<a href="http://tools.ietf.org/html/rfc3454">Preparation of Internationalized Strings ("stringprep")</a>,&rdquo; RFC&nbsp;3454, December&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3454.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="TCP">[TCP]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc793">Transmission Control Protocol</a>,&rdquo; STD&nbsp;7, RFC&nbsp;793, September&nbsp;1981 (<a href="ftp://ftp.isi.edu/in-notes/rfc793.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="TERMS">[TERMS]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="TLS">[TLS]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc4346">The Transport Layer Security (TLS) Protocol Version 1.1</a>,&rdquo; RFC&nbsp;4346, April&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4346.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="UCS2">[UCS2]</a></td>
<td class="author-text">International Organization for Standardization, &ldquo;Information Technology - Universal Multiple-octet coded Character Set (UCS) - Amendment 2: UCS Transformation Format 8 (UTF-8),&rdquo; ISO&nbsp;Standard 10646-1 Addendum 2, October&nbsp;1996.</td></tr>
<tr><td class="author-text" valign="top"><a name="UNICODE">[UNICODE]</a></td>
<td class="author-text">The Unicode Consortium, &ldquo;The Unicode Standard, Version 3.2.0,&rdquo; 2000.<p>
The Unicode Standard, Version 3.2.0 is defined by The Unicode Standard, Version 3.0 (Reading, MA, Addison-Wesley, 2000. ISBN 0-201-61633-5), as amended by the Unicode Standard Annex #27: Unicode 3.1 (http://www.unicode.org/reports/tr27/) and by the Unicode Standard Annex #28: Unicode 3.2 (http://www.unicode.org/reports/tr28/).
</p>
</td></tr>
<tr><td class="author-text" valign="top"><a name="UTF-8">[UTF-8]</a></td>
<td class="author-text">Yergeau, F., &ldquo;<a href="http://tools.ietf.org/html/rfc3629">UTF-8, a transformation format of ISO 10646</a>,&rdquo; STD&nbsp;63, RFC&nbsp;3629, November&nbsp;2003 (<a href="ftp://ftp.isi.edu/in-notes/rfc3629.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="UUID">[UUID]</a></td>
<td class="author-text"><a href="mailto:paulle@microsoft.com">Leach, P.</a>, <a href="mailto:michael@refactored-networks.com">Mealling, M.</a>, and <a href="mailto:rsalz@datapower.com">R. Salz</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc4122">A Universally Unique IDentifier (UUID) URN Namespace</a>,&rdquo; RFC&nbsp;4122, July&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc4122.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc4122.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc4122.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="X509">[X509]</a></td>
<td class="author-text">Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;<a href="http://tools.ietf.org/html/rfc3280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>,&rdquo; RFC&nbsp;3280, April&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3280.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="X509-SRV">[X509-SRV]</a></td>
<td class="author-text">Santesson, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4985">Internet X.509 Public Key Infrastructure Subject Alternative Name for Expression of Service Name</a>,&rdquo; RFC&nbsp;4985, August&nbsp;2007 (<a href="ftp://ftp.isi.edu/in-notes/rfc4985.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XML">[XML]</a></td>
<td class="author-text">Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;<a href="http://www.w3.org/TR/2006/REC-xml-20060816">Extensible Markup Language (XML) 1.0 (Fourth Edition)</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xml-20060816, August&nbsp;2006 (<a href="http://www.w3.org/TR/2006/REC-xml-20060816">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XML-NAMES">[XML-NAMES]</a></td>
<td class="author-text"><a href="mailto:tbray@textuality.com">Bray, T.</a>, <a href="mailto:dmh@corp.hp.com">Hollander, D.</a>, and <a href="mailto:andrewl@microsoft.com">A. Layman</a>, &ldquo;<a href="http://www.w3.org/TR/REC-xml-names">Namespaces in XML</a>,&rdquo; W3C&nbsp;REC-xml-names, January&nbsp;1999.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>17.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ACAP">[ACAP]</a></td>
<td class="author-text"><a href="mailto:chris.newman@innosoft.com">Newman, C.</a> and <a href="mailto:jgmyers@netscape.com">J. Myers</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2244">ACAP -- Application Configuration Access Protocol</a>,&rdquo; RFC&nbsp;2244, November&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2244.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="ANONYMOUS">[ANONYMOUS]</a></td>
<td class="author-text">Zeilenga, K., &ldquo;<a href="http://tools.ietf.org/html/rfc4505">Anonymous Simple Authentication and Security Layer (SASL) Mechanism</a>,&rdquo; RFC&nbsp;4505, June&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4505.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="ASN.1">[ASN.1]</a></td>
<td class="author-text">CCITT, &ldquo;Recommendation X.208: Specification of Abstract Syntax Notation One (ASN.1),&rdquo; 1988.</td></tr>
<tr><td class="author-text" valign="top"><a name="CHANNEL">[CHANNEL]</a></td>
<td class="author-text">Williams, N., &ldquo;<a href="http://tools.ietf.org/html/rfc5056">On the Use of Channel Bindings to Secure Channels</a>,&rdquo; RFC&nbsp;5056, November&nbsp;2007 (<a href="ftp://ftp.isi.edu/in-notes/rfc5056.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="DIGEST-MD5">[DIGEST-MD5]</a></td>
<td class="author-text">Leach, P. and C. Newman, &ldquo;<a href="http://tools.ietf.org/html/rfc2831">Using Digest Authentication as a SASL Mechanism</a>,&rdquo; RFC&nbsp;2831, May&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2831.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="DNSSEC">[DNSSEC]</a></td>
<td class="author-text">Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;<a href="http://tools.ietf.org/html/rfc4033">DNS Security Introduction and Requirements</a>,&rdquo; RFC&nbsp;4033, March&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc4033.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="DNS-TXT">[DNS-TXT]</a></td>
<td class="author-text"><a href="mailto:rosenbaum@lkg.dec.com">Rosenbaum, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1464">Using the Domain Name System To Store Arbitrary String Attributes</a>,&rdquo; RFC&nbsp;1464, May&nbsp;1993 (<a href="ftp://ftp.isi.edu/in-notes/rfc1464.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="DOS">[DOS]</a></td>
<td class="author-text">Handley, M., Rescorla, E., and IAB, &ldquo;<a href="http://tools.ietf.org/html/rfc4732">Internet Denial-of-Service Considerations</a>,&rdquo; RFC&nbsp;4732, December&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4732.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="GSS-API">[GSS-API]</a></td>
<td class="author-text"><a href="mailto:jlinn@rsasecurity.com">Linn, J.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2743">Generic Security Service Application Program Interface Version 2, Update 1</a>,&rdquo; RFC&nbsp;2743, January&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2743.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="HTTP">[HTTP]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999 (<a href="ftp://ftp.isi.edu/in-notes/rfc2616.txt">TXT</a>, <a href="ftp://ftp.isi.edu/in-notes/rfc2616.ps">PS</a>, <a href="ftp://ftp.isi.edu/in-notes/rfc2616.pdf">PDF</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IMAP">[IMAP]</a></td>
<td class="author-text">Crispin, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3501">INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1</a>,&rdquo; RFC&nbsp;3501, March&nbsp;2003 (<a href="ftp://ftp.isi.edu/in-notes/rfc3501.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IMP-REQS">[IMP-REQS]</a></td>
<td class="author-text"><a href="mailto:mday@alum.mit.edu">Day, M.</a>, <a href="mailto:sonuag@microsoft.com">Aggarwal, S.</a>, and <a href="mailto:jesse@intonet.com">J. Vincent</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2779">Instant Messaging / Presence Protocol Requirements</a>,&rdquo; RFC&nbsp;2779, February&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2779.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IRI">[IRI]</a></td>
<td class="author-text">Duerst, M. and M. Suignard, &ldquo;<a href="http://tools.ietf.org/html/rfc3987">Internationalized Resource Identifiers (IRIs)</a>,&rdquo; RFC&nbsp;3987, January&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc3987.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="LINKLOCAL">[LINKLOCAL]</a></td>
<td class="author-text">Cheshire, S., Aboba, B., and E. Guttman, &ldquo;<a href="http://tools.ietf.org/html/rfc3927">Dynamic Configuration of IPv4 Link-Local Addresses</a>,&rdquo; RFC&nbsp;3927, May&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc3927.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="MAILBOXES">[MAILBOXES]</a></td>
<td class="author-text"><a href="mailto:dcrocker@imc.org">Crocker, D.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2142">MAILBOX NAMES FOR COMMON SERVICES, ROLES AND FUNCTIONS</a>,&rdquo; RFC&nbsp;2142, May&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2142.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2142.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2142.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="POP3">[POP3]</a></td>
<td class="author-text"><a href="mailto:jgm+@cmu.edu">Myers, J.</a> and <a href="mailto:mrose@dbc.mtview.ca.us">M. Rose</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1939">Post Office Protocol - Version 3</a>,&rdquo; STD&nbsp;53, RFC&nbsp;1939, May&nbsp;1996 (<a href="ftp://ftp.isi.edu/in-notes/rfc1939.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="PUNYCODE">[PUNYCODE]</a></td>
<td class="author-text">Costello, A., &ldquo;<a href="http://tools.ietf.org/html/rfc3492">Punycode: A Bootstring encoding of Unicode for Internationalized Domain Names in Applications (IDNA)</a>,&rdquo; RFC&nbsp;3492, March&nbsp;2003 (<a href="ftp://ftp.isi.edu/in-notes/rfc3492.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3920">[RFC3920]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P., Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3920">Extensible Messaging and Presence Protocol (XMPP): Core</a>,&rdquo; RFC&nbsp;3920, October&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3920.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3920.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3920.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3921">[RFC3921]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P., Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3921">Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence</a>,&rdquo; RFC&nbsp;3921, October&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3921.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3921.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3921.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SMTP">[SMTP]</a></td>
<td class="author-text">Klensin, J., &ldquo;<a href="http://tools.ietf.org/html/rfc2821">Simple Mail Transfer Protocol</a>,&rdquo; RFC&nbsp;2821, April&nbsp;2001 (<a href="ftp://ftp.isi.edu/in-notes/rfc2821.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="STD13">[STD13]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1035, November&nbsp;1987 (<a href="ftp://ftp.isi.edu/in-notes/rfc1035.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="URI">[URI]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com">Fielding, R.</a>, and <a href="mailto:LMM@acm.org">L. Masinter</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>,&rdquo; STD&nbsp;66, RFC&nbsp;3986, January&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc3986.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3986.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3986.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="URN-OID">[URN-OID]</a></td>
<td class="author-text">Mealling, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3061">A URN Namespace of Object Identifiers</a>,&rdquo; RFC&nbsp;3061, February&nbsp;2001 (<a href="ftp://ftp.isi.edu/in-notes/rfc3061.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="USINGTLS">[USINGTLS]</a></td>
<td class="author-text"><a href="mailto:chris.newman@innosoft.com">Newman, C.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2595">Using TLS with IMAP, POP3 and ACAP</a>,&rdquo; RFC&nbsp;2595, June&nbsp;1999 (<a href="ftp://ftp.isi.edu/in-notes/rfc2595.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0001">[XEP-0001]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0001.html">XMPP Extension Protocols</a>,&rdquo; XSF XEP&nbsp;0001, December&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0045">[XEP-0045]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0045.html">Multi-User Chat</a>,&rdquo; XSF XEP&nbsp;0045, April&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0060">[XEP-0060]</a></td>
<td class="author-text"><a href="mailto:">Millard, P.</a>, <a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, and <a href="mailto:ralphm@ik.nu">R. Meijer</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0060.html">Publish-Subscribe</a>,&rdquo; XSF XEP&nbsp;0060, September&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0071">[XEP-0071]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0071.html">XHTML-IM</a>,&rdquo; XSF XEP&nbsp;0071, August&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0077">[XEP-0077]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0077.html">In-Band Registration</a>,&rdquo; XSF XEP&nbsp;0077, January&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0124">[XEP-0124]</a></td>
<td class="author-text"><a href="mailto:ian.paterson@clientside.co.uk">Paterson, I.</a>, <a href="mailto:dizzyd@jabber.org">Smith, D.</a>, and <a href="mailto:stpeter@jabber.org">P. Saint-Andre</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0124.html">Bidirectional-streams Over Synchronous HTTP (BOSH)</a>,&rdquo; XSF XEP&nbsp;0124, February&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0156">[XEP-0156]</a></td>
<td class="author-text"><a href="mailto:jhildebrand@jabber.com">Hildebrand, J.</a> and <a href="mailto:stpeter@jabber.org">P. Saint-Andre</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0156.html">Discovering Alternative XMPP Connection Methods</a>,&rdquo; XSF XEP&nbsp;0156, June&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0165">[XEP-0165]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0165.html">Best Practices to Prevent JID Mimicking</a>,&rdquo; XSF XEP&nbsp;0165, July&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0174">[XEP-0174]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0174.html">Link-Local Messaging</a>,&rdquo; XSF XEP&nbsp;0174, June&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0175">[XEP-0175]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0175.html">Best Practices for Use of SASL ANONYMOUS</a>,&rdquo; XSF XEP&nbsp;0175, September&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0178">[XEP-0178]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a> and <a href="mailto:">P. Millard</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0178.html">Best Practices for Use of SASL EXTERNAL with Certificates</a>,&rdquo; XSF XEP&nbsp;0178, February&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0205">[XEP-0205]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0205.html">Best Practices to Discourage Denial of Service Attacks</a>,&rdquo; XSF XEP&nbsp;0205, July&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0206">[XEP-0206]</a></td>
<td class="author-text"><a href="mailto:ian.paterson@clientside.co.uk">Paterson, I.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0206.html">XMPP Over BOSH</a>,&rdquo; XSF XEP&nbsp;0206, June&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0220">[XEP-0220]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a> and <a href="mailto:jeremie@jabber.org">J. Miller</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0220.html">Server Dialback</a>,&rdquo; XSF XEP&nbsp;0220, June&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0246">[XEP-0246]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0246.html">End-to-End XML Streams</a>,&rdquo; XSF XEP&nbsp;0246, June&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="XML-FRAG">[XML-FRAG]</a></td>
<td class="author-text">Grosso, P. and D. Veillard, &ldquo;<a href="http://www.w3.org/TR/2001/CR-xml-fragment-20010212">XML Fragment Interchange</a>,&rdquo; World Wide Web Consortium CR&nbsp;CR-xml-fragment-20010212, February&nbsp;2001 (<a href="http://www.w3.org/TR/2001/CR-xml-fragment-20010212">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XML-REG">[XML-REG]</a></td>
<td class="author-text">Mealling, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3688">The IETF XML Registry</a>,&rdquo; BCP&nbsp;81, RFC&nbsp;3688, January&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3688.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XML-SCHEMA">[XML-SCHEMA]</a></td>
<td class="author-text">Thompson, H., Maloney, M., Mendelsohn, N., and D. Beech, &ldquo;<a href="http://www.w3.org/TR/2004/REC-xmlschema-1-20041028">XML Schema Part 1: Structures Second Edition</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xmlschema-1-20041028, October&nbsp;2004 (<a href="http://www.w3.org/TR/2004/REC-xmlschema-1-20041028">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP-IM">[XMPP-IM]</a></td>
<td class="author-text">Saint-Andre, P., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-saintandre-rfc3921bis-05.txt">Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence</a>,&rdquo; draft-saintandre-rfc3921bis-05 (work in progress), June&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-saintandre-rfc3921bis-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP-URI">[XMPP-URI]</a></td>
<td class="author-text">Saint-Andre, P., &ldquo;<a href="http://tools.ietf.org/html/rfc5122">Internationalized Resource Identifiers (IRIs) and Uniform Resource Identifiers (URIs) for the Extensible Messaging and Presence Protocol (XMPP)</a>,&rdquo; RFC&nbsp;5122, February&nbsp;2008 (<a href="ftp://ftp.isi.edu/in-notes/rfc5122.txt">TXT</a>).</td></tr>
</table>

<a name="nodeprep"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Nodeprep</h3>

<a name="nodeprep-intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Introduction</h3>

<p>This appendix defines the "Nodeprep" profile of stringprep.  As such, it specifies processing rules that will enable users to enter internationalized node identifiers in the Extensible Messaging and Presence Protocol (XMPP) and have the highest chance of getting the content of the strings correct.  (An XMPP node identifier is the optional portion of an XMPP address that precedes an XMPP domain identifier and the '@' separator; it is often but not exclusively associated with an instant messaging username.)  These processing rules are intended only for XMPP node identifiers and are not intended for arbitrary text or any other aspect of an XMPP address.
</p>
<p>This profile defines the following, as required by <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>:
</p>
<p></p>
<ul class="text">
<li>The intended applicability of the profile: internationalized node identifiers within XMPP
</li>
<li>The character repertoire that is the input and output to stringprep: Unicode 3.2, specified in Section 2 of this Appendix
</li>
<li>The mappings used: specified in Section 3
</li>
<li>The Unicode normalization used: specified in Section 4
</li>
<li>The characters that are prohibited as output: specified in Section 5
</li>
<li>Bidirectional character handling: specified in Section 6
</li>
</ul>

<a name="nodeprep-character"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Character Repertoire</h3>

<p>This profile uses Unicode 3.2 with the list of unassigned code points being Table A.1, both defined in Appendix A of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="nodeprep-mapping"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Mapping</h3>

<p>This profile specifies mapping using the following tables from <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Table B.1
</dd>
<dt></dt>
<dd>Table B.2
</dd>
</dl></blockquote>

<a name="nodeprep-normalization"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.4"></a><h3>A.4.&nbsp;
Normalization</h3>

<p>This profile specifies the use of Unicode normalization form KC, as described in <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="nodeprep-prohibited"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.5"></a><h3>A.5.&nbsp;
Prohibited Output</h3>

<p>This profile specifies the prohibition of using the following tables from <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Table C.1.1
</dd>
<dt></dt>
<dd>Table C.1.2
</dd>
<dt></dt>
<dd>Table C.2.1
</dd>
<dt></dt>
<dd>Table C.2.2
</dd>
<dt></dt>
<dd>Table C.3
</dd>
<dt></dt>
<dd>Table C.4
</dd>
<dt></dt>
<dd>Table C.5
</dd>
<dt></dt>
<dd>Table C.6
</dd>
<dt></dt>
<dd>Table C.7
</dd>
<dt></dt>
<dd>Table C.8
</dd>
<dt></dt>
<dd>Table C.9
</dd>
</dl></blockquote>

<p>In addition, the following additional Unicode characters are also prohibited:
</p>
<p>
          </p>
<blockquote class="text"><dl>
<dt></dt>
<dd>U+0022 (QUOTATION MARK)
</dd>
<dt></dt>
<dd>U+0026 (AMPERSAND)
</dd>
<dt></dt>
<dd>U+0027 (APOSTROPHE)
</dd>
<dt></dt>
<dd>U+002F (SOLIDUS)
</dd>
<dt></dt>
<dd>U+003A (COLON)
</dd>
<dt></dt>
<dd>U+003C (LESS-THAN SIGN)
</dd>
<dt></dt>
<dd>U+003E (GREATER-THAN SIGN)
</dd>
<dt></dt>
<dd>U+0040 (COMMERCIAL AT)
</dd>
</dl></blockquote><p>
        
</p>
<a name="nodeprep-bidirectional"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.6"></a><h3>A.6.&nbsp;
Bidirectional Characters</h3>

<p>This profile specifies checking bidirectional strings, as described in Section 6 of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="nodeprep-notes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.7"></a><h3>A.7.&nbsp;
Notes</h3>

<p>Because the additional characters prohibited by Nodeprep are prohibited after normalization, an implementation MUST NOT enable a human user to input any Unicode code point whose decomposition includes those characters; such code points include but are not necessarily limited to the following (refer to <a class='info' href='#UNICODE'>[UNICODE]<span> (</span><span class='info'>The Unicode Consortium, &ldquo;The Unicode Standard, Version 3.2.0,&rdquo; 2000.</span><span>)</span></a> for complete information).
</p>
<p>
          </p>
<ul class="text">
<li>U+2100 (ACCOUNT OF)
</li>
<li>U+2101 (ADDRESSED TO THE SUBJECT)
</li>
<li>U+2105 (CARE OF)
</li>
<li>U+2106 (CADA UNA)
</li>
<li>U+226E (NOT LESS-THAN)
</li>
<li>U+226F (NOT GREATER-THAN)
</li>
<li>U+2A74 (DOUBLE COLON EQUAL)
</li>
<li>U+FE13 (SMALL COLON)
</li>
<li>U+FE60 (SMALL AMPERSAND)
</li>
<li>U+FE64 (SMALL LESS-THAN SIGN)
</li>
<li>U+FE65 (SMALL GREATER-THAN SIGN)
</li>
<li>U+FE6B (SMALL COMMERCIAL AT)
</li>
<li>U+FF02 (FULLWIDTH QUOTATION MARK)
</li>
<li>U+FF06 (FULLWIDTH AMPERSAND)
</li>
<li>U+FF07 (FULLWIDTH APOSTROPHE)
</li>
<li>U+FF0F (FULLWIDTH SOLIDUS)
</li>
<li>U+FF1A (FULLWIDTH COLON)
</li>
<li>U+FF1C (FULLWIDTH LESS-THAN SIGN)
</li>
<li>U+FF1E (FULLWIDTH GREATER-THAN SIGN)
</li>
<li>U+FF20 (FULLWIDTH COMMERCIAL AT)
</li>
</ul><p>
        
</p>
<a name="resourceprep"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Resourceprep</h3>

<a name="resourceprep-introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1"></a><h3>B.1.&nbsp;
Introduction</h3>

<p>This appendix defines the "Resourceprep" profile of stringprep.  As such, it specifies processing rules that will enable users to enter internationalized resource identifiers in the Extensible Messaging and Presence Protocol (XMPP) and have the highest chance of getting the content of the strings correct.  (An XMPP resource identifier is the optional portion of an XMPP address that follows an XMPP domain identifier and the '/' separator.)  These processing rules are intended only for XMPP resource identifiers and are not intended for arbitrary text or any other aspect of an XMPP address.
</p>
<p>This profile defines the following, as required by <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>:
</p>
<p></p>
<ul class="text">
<li>The intended applicability of the profile: internationalized resource identifiers within XMPP
</li>
<li>The character repertoire that is the input and output to stringprep: Unicode 3.2, specified in Section 2 of this Appendix
</li>
<li>The mappings used: specified in Section 3
</li>
<li>The Unicode normalization used: specified in Section 4
</li>
<li>The characters that are prohibited as output: specified in Section 5
</li>
<li>Bidirectional character handling: specified in Section 6
</li>
</ul>

<a name="resourceprep-character"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.2"></a><h3>B.2.&nbsp;
Character Repertoire</h3>

<p>This profile uses Unicode 3.2 with the list of unassigned code points being Table A.1, both defined in Appendix A of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="resourceprep-mapping"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.3"></a><h3>B.3.&nbsp;
Mapping</h3>

<p>This profile specifies mapping using the following tables from <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Table B.1
</dd>
</dl></blockquote>

<a name="resourceprep-normalization"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.4"></a><h3>B.4.&nbsp;
Normalization</h3>

<p>This profile specifies the use of Unicode normalization form KC, as described in <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="resourceprep-prohibited"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.5"></a><h3>B.5.&nbsp;
Prohibited Output</h3>

<p>This profile specifies the prohibition of using the following tables from <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Table C.1.2
</dd>
<dt></dt>
<dd>Table C.2.1
</dd>
<dt></dt>
<dd>Table C.2.2
</dd>
<dt></dt>
<dd>Table C.3
</dd>
<dt></dt>
<dd>Table C.4
</dd>
<dt></dt>
<dd>Table C.5
</dd>
<dt></dt>
<dd>Table C.6
</dd>
<dt></dt>
<dd>Table C.7
</dd>
<dt></dt>
<dd>Table C.8
</dd>
<dt></dt>
<dd>Table C.9
</dd>
</dl></blockquote>

<a name="resourceprep-bidirectional"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.6"></a><h3>B.6.&nbsp;
Bidirectional Characters</h3>

<p>This profile specifies checking bidirectional strings, as described in Section 6 of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="schema"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
XML Schemas</h3>

<p>Because validation of XML streams and stanzas is optional, the following XML schemas are provided for descriptive purposes only.  These schemas are not normative.
</p>
<p>The following schemas formally define various XML namespaces used in the core XMPP protocols, in conformance with <a class='info' href='#XML-SCHEMA'>[XML&#8209;SCHEMA]<span> (</span><span class='info'>Thompson, H., Maloney, M., Mendelsohn, N., and D. Beech, &ldquo;XML Schema Part 1: Structures Second Edition,&rdquo; October&nbsp;2004.</span><span>)</span></a>.  For schemas defining the 'jabber:client' and 'jabber:server' namespaces, refer to <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and  Presence,&rdquo; June&nbsp;2008.</span><span>)</span></a>.
</p>
<a name="schemas-streams"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.1"></a><h3>C.1.&nbsp;
Streams Namespace</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://etherx.jabber.org/streams'
    xmlns='http://etherx.jabber.org/streams'
    elementFormDefault='unqualified'&gt;

  &lt;xs:import namespace='jabber:client'/&gt;
  &lt;xs:import namespace='jabber:server'/&gt;
  &lt;xs:import namespace='urn:ietf:params:xml:ns:xmpp-sasl'/&gt;
  &lt;xs:import namespace='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
  &lt;xs:import namespace='urn:ietf:params:xml:ns:xmpp-tls'/&gt;

  &lt;xs:element name='stream'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence xmlns:client='jabber:client'
                   xmlns:server='jabber:server'&gt;
        &lt;xs:element ref='features' minOccurs='0' maxOccurs='1'/&gt;
        &lt;xs:any namespace='urn:ietf:params:xml:ns:xmpp-tls'
                minOccurs='0'
                maxOccurs='unbounded'/&gt;
        &lt;xs:any namespace='urn:ietf:params:xml:ns:xmpp-sasl'
                minOccurs='0'
                maxOccurs='unbounded'/&gt;
        &lt;xs:choice minOccurs='0' maxOccurs='1'&gt;
          &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
            &lt;xs:element ref='client:message'/&gt;
            &lt;xs:element ref='client:presence'/&gt;
            &lt;xs:element ref='client:iq'/&gt;
          &lt;/xs:choice&gt;
          &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
            &lt;xs:element ref='server:message'/&gt;
            &lt;xs:element ref='server:presence'/&gt;
            &lt;xs:element ref='server:iq'/&gt;
            &lt;xs:element ref='db:result'/&gt;
            &lt;xs:element ref='db:verify'/&gt;
          &lt;/xs:choice&gt;
        &lt;/xs:choice&gt;
        &lt;xs:element ref='error' minOccurs='0' maxOccurs='1'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='from' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='id' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='to' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='version' type='xs:decimal' use='optional'/&gt;
      &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='features'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:any namespace='##other'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='error'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence  xmlns:err='urn:ietf:params:xml:ns:xmpp-streams'&gt;
        &lt;xs:group   ref='err:streamErrorGroup'/&gt;
        &lt;xs:element ref='err:text'
                    minOccurs='0'
                    maxOccurs='1'/&gt;
        &lt;xs:any     namespace='##other'
                    minOccurs='0'
                    maxOccurs='1'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="schemas-streamerror"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.2"></a><h3>C.2.&nbsp;
Stream Error Namespace</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:ietf:params:xml:ns:xmpp-streams'
    xmlns='urn:ietf:params:xml:ns:xmpp-streams'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='bad-format' type='empty'/&gt;
  &lt;xs:element name='bad-namespace-prefix' type='empty'/&gt;
  &lt;xs:element name='conflict' type='empty'/&gt;
  &lt;xs:element name='connection-timeout' type='empty'/&gt;
  &lt;xs:element name='host-gone' type='empty'/&gt;
  &lt;xs:element name='host-unknown' type='empty'/&gt;
  &lt;xs:element name='improper-addressing' type='empty'/&gt;
  &lt;xs:element name='internal-server-error' type='empty'/&gt;
  &lt;xs:element name='invalid-from' type='empty'/&gt;
  &lt;xs:element name='invalid-id' type='empty'/&gt;
  &lt;xs:element name='invalid-namespace' type='empty'/&gt;
  &lt;xs:element name='invalid-xml' type='empty'/&gt;
  &lt;xs:element name='not-authorized' type='empty'/&gt;
  &lt;xs:element name='policy-violation' type='empty'/&gt;
  &lt;xs:element name='remote-connection-failed' type='empty'/&gt;
  &lt;xs:element name='resource-constraint' type='empty'/&gt;
  &lt;xs:element name='restricted-xml' type='empty'/&gt;
  &lt;xs:element name='see-other-host' type='xs:string'/&gt;
  &lt;xs:element name='system-shutdown' type='empty'/&gt;
  &lt;xs:element name='undefined-condition' type='empty'/&gt;
  &lt;xs:element name='unsupported-encoding' type='empty'/&gt;
  &lt;xs:element name='unsupported-stanza-type' type='empty'/&gt;
  &lt;xs:element name='unsupported-version' type='empty'/&gt;
  &lt;xs:element name='xml-not-well-formed' type='empty'/&gt;

  &lt;xs:group name='streamErrorGroup'&gt;
    &lt;xs:choice&gt;
      &lt;xs:element ref='bad-format'/&gt;
      &lt;xs:element ref='bad-namespace-prefix'/&gt;
      &lt;xs:element ref='conflict'/&gt;
      &lt;xs:element ref='connection-timeout'/&gt;
      &lt;xs:element ref='host-gone'/&gt;
      &lt;xs:element ref='host-unknown'/&gt;
      &lt;xs:element ref='improper-addressing'/&gt;
      &lt;xs:element ref='internal-server-error'/&gt;
      &lt;xs:element ref='invalid-from'/&gt;
      &lt;xs:element ref='invalid-id'/&gt;
      &lt;xs:element ref='invalid-namespace'/&gt;
      &lt;xs:element ref='invalid-xml'/&gt;
      &lt;xs:element ref='not-authorized'/&gt;
      &lt;xs:element ref='policy-violation'/&gt;
      &lt;xs:element ref='remote-connection-failed'/&gt;
      &lt;xs:element ref='resource-constraint'/&gt;
      &lt;xs:element ref='restricted-xml'/&gt;
      &lt;xs:element ref='see-other-host'/&gt;
      &lt;xs:element ref='system-shutdown'/&gt;
      &lt;xs:element ref='undefined-condition'/&gt;
      &lt;xs:element ref='unsupported-encoding'/&gt;
      &lt;xs:element ref='unsupported-stanza-type'/&gt;
      &lt;xs:element ref='unsupported-version'/&gt;
      &lt;xs:element ref='xml-not-well-formed'/&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:group&gt;

  &lt;xs:element name='text'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:string'&gt;
          &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="schemas-starttls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.3"></a><h3>C.3.&nbsp;
STARTTLS Namespace</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:ietf:params:xml:ns:xmpp-tls'
    xmlns='urn:ietf:params:xml:ns:xmpp-tls'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='starttls'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' maxOccurs='1'&gt;
        &lt;xs:element name='optional' type='empty'/&gt;
        &lt;xs:element name='required' type='empty'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='proceed' type='empty'/&gt;

  &lt;xs:element name='failure' type='empty'/&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="schemas-sasl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.4"></a><h3>C.4.&nbsp;
SASL Namespace</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:ietf:params:xml:ns:xmpp-sasl'
    xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='mechanisms'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name='mechanism'
                    minOccurs='1'
                    maxOccurs='unbounded'
                    type='xs:NMTOKEN'/&gt;
        &lt;xs:choice minOccurs='0' maxOccurs='1'&gt;
          &lt;xs:element name='optional' type='empty'/&gt;
          &lt;xs:element name='required' type='empty'/&gt;
        &lt;/xs:choice&gt;
        &lt;xs:any namespace='##other'
                minOccurs='0'
                minOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='abort' type='empty'/&gt;

  &lt;xs:element name='auth'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:string'&gt;
          &lt;xs:attribute name='mechanism'
                        type='xs:NMTOKEN'
                        use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='challenge' type='xs:string'/&gt;

  &lt;xs:element name='response' type='xs:string'/&gt;

  &lt;xs:element name='success' type='xs:string'/&gt;

  &lt;xs:element name='failure'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:choice minOccurs='0'&gt;
          &lt;xs:element name='aborted' type='empty'/&gt;
          &lt;xs:element name='account-disabled' type='empty'/&gt;
          &lt;xs:element name='credentials-expired' type='empty'/&gt;
          &lt;xs:element name='encryption-required' type='empty'/&gt;
          &lt;xs:element name='incorrect-encoding' type='empty'/&gt;
          &lt;xs:element name='invalid-authzid' type='empty'/&gt;
          &lt;xs:element name='invalid-mechanism' type='empty'/&gt;
          &lt;xs:element name='malformed-request' type='empty'/&gt;
          &lt;xs:element name='mechanism-too-weak' type='empty'/&gt;
          &lt;xs:element name='not-authorized' type='empty'/&gt;
          &lt;xs:element name='temporary-auth-failure' type='empty'/&gt;
          &lt;xs:element name='transition-needed' type='empty'/&gt;
        &lt;/xs:choice&gt;
        &lt;xs:element ref='text' minOccurs='0' maxOccurs='1'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='text'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:string'&gt;
          &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="schemas-bind"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.5"></a><h3>C.5.&nbsp;
Resource Binding Namespace</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:ietf:params:xml:ns:xmpp-bind'
    xmlns='urn:ietf:params:xml:ns:xmpp-bind'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='bind'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice&gt;
        &lt;xs:choice&gt;
          &lt;xs:element name='resource' type='resourceType'/&gt;
          &lt;xs:element name='jid' type='fullJIDType'/&gt;
        &lt;/xs:choice&gt;
        &lt;xs:choice&gt;
          &lt;xs:element name='optional' type='empty'/&gt;
          &lt;xs:element name='required' type='empty'/&gt;
        &lt;/xs:choice&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='unbind'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice&gt;
        &lt;xs:choice&gt;
          &lt;xs:element name='resource' type='resourceType'/&gt;
        &lt;/xs:choice&gt;
        &lt;xs:choice&gt;
          &lt;xs:element name='optional' type='empty'/&gt;
          &lt;xs:element name='required' type='empty'/&gt;
        &lt;/xs:choice&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='fullJIDType'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:minLength value='8'/&gt;
      &lt;xs:maxLength value='3071'/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name='resourceType'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:minLength value='1'/&gt;
      &lt;xs:maxLength value='1023'/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="schemas-stanzaerror"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.6"></a><h3>C.6.&nbsp;
Stanza Error Namespace</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:ietf:params:xml:ns:xmpp-stanzas'
    xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='bad-request' type='empty'/&gt;
  &lt;xs:element name='conflict' type='empty'/&gt;
  &lt;xs:element name='feature-not-implemented' type='empty'/&gt;
  &lt;xs:element name='forbidden' type='empty'/&gt;
  &lt;xs:element name='gone' type='xs:string'/&gt;
  &lt;xs:element name='internal-server-error' type='empty'/&gt;
  &lt;xs:element name='item-not-found' type='empty'/&gt;
  &lt;xs:element name='jid-malformed' type='empty'/&gt;
  &lt;xs:element name='not-acceptable' type='empty'/&gt;
  &lt;xs:element name='not-allowed' type='empty'/&gt;
  &lt;xs:element name='not-authorized' type='empty'/&gt;
  &lt;xs:element name='not-modified' type='empty'/&gt;
  &lt;xs:element name='payment-required' type='empty'/&gt;
  &lt;xs:element name='recipient-unavailable' type='empty'/&gt;
  &lt;xs:element name='redirect' type='xs:string'/&gt;
  &lt;xs:element name='registration-required' type='empty'/&gt;
  &lt;xs:element name='remote-server-not-found' type='empty'/&gt;
  &lt;xs:element name='remote-server-timeout' type='empty'/&gt;
  &lt;xs:element name='resource-constraint' type='empty'/&gt;
  &lt;xs:element name='service-unavailable' type='empty'/&gt;
  &lt;xs:element name='subscription-required' type='empty'/&gt;
  &lt;xs:element name='undefined-condition' type='empty'/&gt;
  &lt;xs:element name='unexpected-request' type='empty'/&gt;
  &lt;xs:element name='unknown-sender' type='empty'/&gt;

  &lt;xs:group name='stanzaErrorGroup'&gt;
    &lt;xs:choice&gt;
      &lt;xs:element ref='bad-request'/&gt;
      &lt;xs:element ref='conflict'/&gt;
      &lt;xs:element ref='feature-not-implemented'/&gt;
      &lt;xs:element ref='forbidden'/&gt;
      &lt;xs:element ref='gone'/&gt;
      &lt;xs:element ref='internal-server-error'/&gt;
      &lt;xs:element ref='item-not-found'/&gt;
      &lt;xs:element ref='jid-malformed'/&gt;
      &lt;xs:element ref='not-acceptable'/&gt;
      &lt;xs:element ref='not-authorized'/&gt;
      &lt;xs:element ref='not-allowed'/&gt;
      &lt;xs:element ref='not-modified'/&gt;
      &lt;xs:element ref='payment-required'/&gt;
      &lt;xs:element ref='recipient-unavailable'/&gt;
      &lt;xs:element ref='redirect'/&gt;
      &lt;xs:element ref='registration-required'/&gt;
      &lt;xs:element ref='remote-server-not-found'/&gt;
      &lt;xs:element ref='remote-server-timeout'/&gt;
      &lt;xs:element ref='resource-constraint'/&gt;
      &lt;xs:element ref='service-unavailable'/&gt;
      &lt;xs:element ref='subscription-required'/&gt;
      &lt;xs:element ref='undefined-condition'/&gt;
      &lt;xs:element ref='unexpected-request'/&gt;
      &lt;xs:element ref='unknown-sender'/&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:group&gt;

  &lt;xs:element name='text'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:string'&gt;
          &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="contact"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D"></a><h3>Appendix D.&nbsp;
Contact Addresses</h3>

<p>Consistent with <a class='info' href='#MAILBOXES'>[MAILBOXES]<span> (</span><span class='info'>Crocker, D., &ldquo;MAILBOX NAMES FOR COMMON SERVICES, ROLES AND FUNCTIONS,&rdquo; May&nbsp;1997.</span><span>)</span></a>, an organization that offers an XMPP service SHOULD provide an Internet mailbox of "XMPP" for inquiries related to that service, where the host portion of the resulting mailto URI MUST be the organization's domain, not necessarily the domain of the XMPP service itself (e.g., the XMPP service might be offered at im.example.com but the Internet mailbox should be &lt;xmpp.example.com&gt;).
</p>
<a name="provisioning"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.E"></a><h3>Appendix E.&nbsp;
Account Provisioning</h3>

<p>Account provisioning is out of scope for this specification.  Possible methods for account provisioning include account creation by a server administrator and in-band account registration using the 'jabber:iq:register' namespace as documented in <a class='info' href='#XEP-0077'>[XEP&#8209;0077]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;In-Band Registration,&rdquo; January&nbsp;2006.</span><span>)</span></a>.
</p>
<a name="diffs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.F"></a><h3>Appendix F.&nbsp;
Differences From RFC 3920</h3>

<p>Based on consensus derived from implementation and deployment experience as well as formal interoperability testing, the following substantive modifications were made from RFC 3920.
</p>
<p>
        </p>
<ul class="text">
<li>Corrected the ABNF syntax for JIDs to prevent zero-length node identifiers, domain identifiers, and resource identifiers.
</li>
<li>Corrected the nameprep processing rules to require use of the UseSTD3ASCIIRules flag.
</li>
<li>Recommended or mandated use of the 'from' and 'to' attributes on stream headers.
</li>
<li>More fully specified stream closing handshake.
</li>
<li>Specified recommended stream reconnection algorithm.
</li>
<li>Specified return of &lt;restricted-xml/&gt; stream error in response to receipt of prohibited XML features.
</li>
<li>Specified that SASL mechanisms must be sent both before and after negotiation of SASL security layers.
</li>
<li>Specified that TLS plus SASL PLAIN is a mandatory-to-implement technology for client-to-server connections, since implementation of SASL EXTERNAL is uncommon in XMPP clients, in part because underlying security features such as end-user X.509 certificates are not yet widely deployed.
</li>
<li>Added the &lt;account-disabled/&gt;, &lt;credentials-expired/&gt;, &lt;encryption-required/&gt;, &lt;malformed-request/&gt;, and &lt;transition-needed/&gt; SASL error conditions to handle error flows mistakenly left out of RFC 3920 or discussed in RFC 4422 but not in RFC 2222.
</li>
<li>More fully specified binding of multiple resources to the same stream.
</li>
<li>Added the &lt;unknown-sender/&gt; stanza error condition to provide appropriate handling of stanzas when multiple resources are bound to the same stream.
</li>
<li>Added the &lt;not-modified/&gt; stanza error condition to enable potential ETags usage.
</li>
<li>Removed unnecessary requirement for escaping of characters that map to certain predefined entities, which do not need to be escaped in XML.
</li>
<li>More clearly specified well-formedness requirements.
</li>
<li>Moved historical documentation of the server dialback protocol from this specification to a separate specification maintained by the XMPP Standards Foundation.
</li>
</ul><p>
      
</p>
<p>In addition, numerous changes of an editorial nature were made in order to more fully specify and clearly explain XMPP.
</p>
<a name="copying"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.G"></a><h3>Appendix G.&nbsp;
Copying Conditions</h3>

<p>Regarding this entire document or any portion of it, the author makes no guarantees and is not responsible for any damage resulting from its use.  The author grants irrevocable permission to anyone to use, modify, and distribute it in any way that does not diminish the rights of anyone else to use, modify, and distribute it, provided that redistributed derivative works do not contain misleading author or version information.  Derivative works need not be licensed under similar terms.
</p><a name="rfc.index"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Index</h3>
<table>
<tr><td><strong>B</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor8">Bare JID</a></td></tr>
<tr><td><strong>C</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor16">Connected Resource</a></td></tr>
<tr><td><strong>D</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor5">Domain Identifier</a></td></tr>
<tr><td><strong>E</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor3">Entity</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor20">Error Stanza</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor21">Extended Content</a></td></tr>
<tr><td><strong>F</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor9">Full JID</a></td></tr>
<tr><td><strong>I</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor11">Initial Stream</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor19">IQ Stanza</a></td></tr>
<tr><td><strong>J</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor4">Jabber Identifier</a></td></tr>
<tr><td><strong>M</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor17">Message Stanza</a></td></tr>
<tr><td><strong>N</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor6">Node Identifier</a></td></tr>
<tr><td><strong>P</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor18">Presence Stanza</a></td></tr>
<tr><td><strong>R</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor7">Resource Identifier</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor12">Response Stream</a></td></tr>
<tr><td><strong>S</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor14">Stream ID</a></td></tr>
<tr><td><strong>W</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor15">Whitespace Ping</a></td></tr>
<tr><td><strong>X</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor13">XML Stanza</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor10">XML Stream</a></td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Peter Saint-Andre (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">XMPP Standards Foundation</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">stpeter@jabber.org</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="https://stpeter.im/">https://stpeter.im/</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
