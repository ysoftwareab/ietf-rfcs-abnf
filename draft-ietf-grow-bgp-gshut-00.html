<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Graceful BGP session shutdown</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Graceful BGP session shutdown">
<meta name="keywords" content="I-D, Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header"> Pierre Francois</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Universite catholique de Louvain</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header"> Bruno Decraene</td></tr>
<tr><td class="header">Expires: December 17, 2009</td><td class="header">France Telecom</td></tr>
<tr><td class="header">&nbsp;</td><td class="header"> Cristel Pelsser</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">NTT Corporation</td></tr>
<tr><td class="header">&nbsp;</td><td class="header"> Clarence Filsfils</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Cisco Systems</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">June 15, 2009</td></tr>
</table></td></tr></table>
<h1><br />Graceful BGP session shutdown<br />draft-ietf-grow-bgp-gshut-00</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on December 17, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This draft describes operational procedures aimed at reducing the
		amount of traffic lost during planned maintenances of
		routers, involving the shutdown of BGP peering
		sessions.
	
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<a href="#sec.loss">3.</a>&nbsp;
Packet loss upon manual eBGP session shutdown<br />
<a href="#sec.practices">4.</a>&nbsp;
Practices to avoid packet losses<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">4.1.</a>&nbsp;
Improving availability of alternate paths<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">4.2.</a>&nbsp;
Graceful shutdown procedures for eBGP sessions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.outbound">4.2.1.</a>&nbsp;
Outbound traffic<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.inbound">4.2.2.</a>&nbsp;
Inbound traffic<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.3.</a>&nbsp;
Graceful shutdown procedures for iBGP sessions<br />
<a href="#sec.forwarding">5.</a>&nbsp;
Forwarding modes and forwarding loops<br />
<a href="#sec.policies">6.</a>&nbsp;
Dealing with Internet policies<br />
<a href="#sec.applicability">7.</a>&nbsp;
Effect of the g-shut procedure on the convergence<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">7.1.</a>&nbsp;
Maintenance of an eBGP session<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">7.1.1.</a>&nbsp;
Propagation on the other eBGP sessions of the g-shut initiator<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">7.1.2.</a>&nbsp;
Propagation on the other iBGP sessions of the g-shut initiator<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">7.1.3.</a>&nbsp;
Propagation of updates in an iBGP full-mesh<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.corner">7.1.4.</a>&nbsp;
Propagation of updates from iBGP to iBGP in a RR hierarchy<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">7.2.</a>&nbsp;
Maintenance of an iBGP session<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">7.3.</a>&nbsp;
Applicability of the g-shut procedure<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">7.4.</a>&nbsp;
Summary of operations<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">7.4.1.</a>&nbsp;
Pre-configuration<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">7.4.2.</a>&nbsp;
Operations at maintenance time<br />
<a href="#anchor19">8.</a>&nbsp;
Link Up cases<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">8.1.</a>&nbsp;
Unreachability local to the ASBR<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">8.2.</a>&nbsp;
iBGP convergence<br />
<a href="#anchor22">9.</a>&nbsp;
Alternative techniques with limited applicability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.loc-pref.infilter">9.1.</a>&nbsp;
In-filter reconfiguration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.med-poison">9.2.</a>&nbsp;
Multi Exit Discriminator tweaking<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.igp-poison">9.3.</a>&nbsp;
IGP distance Poisoning<br />
<a href="#anchor23">10.</a>&nbsp;
IANA considerations<br />
<a href="#anchor24">11.</a>&nbsp;
Security Considerations<br />
<a href="#anchor25">12.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">13.</a>&nbsp;
References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> Routing changes in BGP can be caused by planned, manual,
	maintenance operations. This document discusses operational
	procedures to be applied in order to reduce or eliminate
	losses of packets during the maintenance. These losses come
	from the transient lack of reachability during the BGP
	convergence following the shutdown of an eBGP peering session
	between two Autonomous System Border Routers (ASBR).
</p>
<p> This document presents procedures for the cases where the
	forwarding plane is impacted by the maintenance, hence when
	the use of Graceful Restart does not apply.
</p>
<p> The procedures described in this document can be applied
	to reduce or avoid packet loss for outbound and inbound
	traffic flows initially forwarded along the peering link to be
	shut down.  These procedures allow routers to keep using old
	paths until alternate ones are learned, ensuring that routers
	always have a valid route available during the convergence
	process.
</p>
<p> The goal of the document is to meet the requirements
	described in <a class='info' href='#REQS'>[REQS]<span> (</span><span class='info'>Decraene, B., Francois, P., Pelsser, C., and Z. Ahmad, &ldquo;Requirements for the graceful shutdown of BGP sessions,&rdquo; May&nbsp;2009.</span><span>)</span></a> at best, without
	changing the BGP protocol or BGP implementations.
</p>
<p> Still, it explains why reserving a community value for
	the purpose of BGP session graceful shutdown would reduce the
	management overhead bound with the solution. It would also
	allow vendors to provide an automatic graceful shutdown mechanism that
	does not require any configuration at maintenance time. 
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p> g-shut initiator : a router on which the session shutdown
	is performed for the maintenance. 
</p>
<p> g-shut neighbor : a router that peers with the g-shut
	initiator via (one of) the session(s) to be shut down.
</p>
<p> Note that for the link-up case, we will refer to these
	nodes as g-no-shut initiator, and g-no-shut neighbor.
</p>
<p> Initiator AS : the Autonomous System of the g-shut initiator.
</p>
<p> Neighbor AS : the Autonomous System of the g-shut neighbor.
</p>
<p> Affected path / Nominal / pre-convergence path : a BGP path via the peering link(s)
		undergoing the maintenance. This path will no longer exist
		after the shutdown.
</p>
<p> Affected prefix : a prefix initially reached via an affected path.
</p>
<p> Affected router : a router having an affected prefix.
</p>
<p> Backup / alternate / post-convergence path : a path toward an affected
		prefix that will be selected as the best path by an affected
		router, when the link is shut down and the BGP
		convergence is completed.
</p>
<p> Transient alternate path : a path towards an affected prefix that
		may be transiently selected as best by an affected router
		during the convergence process but that is not a
		post-convergence path.  
</p>
<p> Loss of Connectivity (LoC) : the state when a router has
	no path towards an affected prefix.
</p>
<a name="sec.loss"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Packet loss upon manual eBGP session shutdown</h3>

<p> Packets can be lost during a manual shutdown of an eBGP
	session for two reasons. 
</p>
<p> First, routers involved in the convergence process can
	transiently lack of paths towards an affected prefix, and drop traffic
	destined to this prefix. This is because alternate paths can
	be hidden by nodes of an AS. This happens when the paths are
	not selected as best by the ASBR that receive them on an eBGP
	session, or by Route Reflectors that do not propagate them
	further in the iBGP topology because they do not select them
	as best. 
</p>
<p> Second, within the AS, routers' FIB can be transiently
	inconsistent during the BGP convergence and packets towards
	affected prefixes can loop and be dropped. Note that these
	loops only happen when ASBR-to-ASBR encapsulation is not used
	within the AS.
</p>
<p> This document only addresses the first reason. 
</p>
<a name="sec.practices"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Practices to avoid packet losses</h3>

<p>This section describes means for an ISP to reduce the
	transient loss of packets upon a manual shutdown of a BGP
	session. 
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Improving availability of alternate paths</h3>

<p>All solutions that increase the availability of alternate
	BGP paths in routers performing packet lookups in BGP tables <a class='info' href='#BestExternal'>[BestExternal]<span> (</span><span class='info'>Marques, P., Fernando, R., Chen, E., and P. Mohapatra, &ldquo;Advertisement of the best-external route to IBGP,&rdquo; July&nbsp;2008.</span><span>)</span></a> <a class='info' href='#AddPath'>[AddPath]<span> (</span><span class='info'>D. Walton, A. Retana, and E. Chen, &ldquo;Advertisement of Multiple Paths in BGP,&rdquo; .</span><span>)</span></a> help in
	reducing the LoC bound with manual shutdown of eBGP sessions.
	
</p>
<p>One solution increasing diversity in such a way that, at
	any single step of the convergence process following the eBGP
	session shutdown, a BGP router does not receive a message
	withdrawing the only path it currently knows for a given NLRI,
	allows for a simplified g-shut procedure. This simplified
	procedure would only tackle potential LoC for the inbound
	traffic.
</p>
<p>Using advertise-best-external <a class='info' href='#BestExternal'>[BestExternal]<span> (</span><span class='info'>Marques, P., Fernando, R., Chen, E., and P. Mohapatra, &ldquo;Advertisement of the best-external route to IBGP,&rdquo; July&nbsp;2008.</span><span>)</span></a>
	on ASBRs and RRs helps in avoiding lack of alternate paths in route
	reflectors upon a convergence. Hence it reduces the LoC
	duration for the outbound traffic of the ISP upon an eBGP
	Session shutdown by reducing the iBGP path hunting.
</p>
<p>Still it does not ensure that BGP routers will always have
	at least one path towards affected prefixes during the
	convergence following the event. This property may be verified
	in future revisions of <a class='info' href='#BestExternal'>[BestExternal]<span> (</span><span class='info'>Marques, P., Fernando, R., Chen, E., and P. Mohapatra, &ldquo;Advertisement of the best-external route to IBGP,&rdquo; July&nbsp;2008.</span><span>)</span></a>, notably
	of its Section 4, hence the current proposal will be updated
	accordingly.
</p>
<p>Increasing diversity with <a class='info' href='#AddPath'>[AddPath]<span> (</span><span class='info'>D. Walton, A. Retana, and E. Chen, &ldquo;Advertisement of Multiple Paths in BGP,&rdquo; .</span><span>)</span></a> might lead
	to the respect of this property, depending on the path
	propagation decision process that add-path compliant routers
	would use. 
</p>
<p>Note that the LoC for the inbound traffic of the maintained
	router, induced by a lack of alternate path propagation within
	the iBGP topology of a neighboring AS is not under the control
	of the operator performing the maintenance, hence the
	procedure described in <a class='info' href='#sec.inbound'>Section&nbsp;4.2.2<span> (</span><span class='info'>Inbound traffic</span><span>)</span></a> should be applied
	upon the maintenance, even if not required for the outbound traffic.
	
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Graceful shutdown procedures for eBGP sessions</h3>

<p> This section aims at describing a procedure to be
		applied to reduce the LoC with readily available BGP
		features, and without assuming a particular iBGP design
		in the Initiator and Neighbor ASes.
</p>
<a name="sec.outbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Outbound traffic</h3>

<p>This section discusses a mean to render the
			affected paths less desirable by the BGP
			decision process of affected routers, still
			allowing these to be used during the
			convergence while alternate paths are
			propagated to the affected routers.
</p>
<p>A decrease of the local-pref value
				of the affected paths can be issued in
				order to render the affected paths
				less preferable, at the highest
				possible level of the BGP Decision
				Process.
</p>
<p>This operation can be performed by
				reconfiguring the out-filters
				associated with the iBGP sessions
				established by the g-shut initiator.
				
</p>
<p> The modification of the filters
				MUST supplant any other rule affecting
				the local-pref value of the old
				paths.
</p>
<p> Compared to using an in-filter of
				the eBGP session to be shut down, the
				modification of the out-filters will
				not let the g-shut initiator switch to
				another path, as the input to the BGP
				decision process of that router does
				not change. As a consequence, the g-shut
				initiator will not send a withdraw
				message over its iBGP sessions when it
				receives an alternate path over an iBGP
				session. It will however modify the
				local-pref of the affected paths so
				that upstream routers will switch to
				alternate ones.
</p>
<p> When the actual shutdown of the
				session is performed, the g-shut
				initiator will itself switch to the
				alternate paths.
</p>
<a name="sec.inbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Inbound traffic</h3>

<p> The solution described for the outbound traffic can be
	  applied at the neighbor AS. This can be done either
	  "manually" or by using a community value dedicated to this
	  task.
</p>
<a name="sec.phone"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.1"></a><h3>4.2.2.1.&nbsp;
Phone call</h3>

<p> The operator performing the maintenance of
			the eBGP session can contact the operator at
			the other side of the peering link, and let
			him apply the procedure described above for
			its own outbound traffic.
</p>
<a name="sec.community"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.2"></a><h3>4.2.2.2.&nbsp;
Community tagging</h3>

<p> A community value (referred to as GSHUT
			community in this document) can be agreed upon
			by neighboring ASes. A path tagged with this
			community must be considered as soon to be
			affected by a maintenance operation. 
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.2.1"></a><h3>4.2.2.2.1.&nbsp;
Pre-Configuration</h3>

<p> A g-shut neighbor is pre-configured to set
			a low local-pref value for the paths received
			over eBGP sessions which are tagged with the
			GSHUT community.
</p>
<p>This rule must supplant any other rule
			affecting the local-pref value of the
			paths. 
</p>
<p>This local-pref reconfiguration SHOULD be
			performed at the out-filters of the iBGP
			sessions of the g-shut neighbor. That is, the
			g-shut neighbor does not take into account
			this low local-pref in its own BGP best path
			selection. As described in <a class='info' href='#sec.outbound'>Section&nbsp;4.2.1<span> (</span><span class='info'>Outbound traffic</span><span>)</span></a> this avoids sending the withdraw messages
			that can lead to LoC.  
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.2.2"></a><h3>4.2.2.2.2.&nbsp;
Operational action upon maintenance</h3>

<p>Upon the manual shutdown, the
				output filter associated with the
				maintained eBGP session will be
				modified on the g-shut initiator so as
				to tag all the paths advertised over
				the session with the GSHUT community.
				
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.2.3"></a><h3>4.2.2.2.3.&nbsp;
Transitivity of the community</h3>

<p>If the GSHUT community is an
				extended community, it SHOULD be set
				non transitive.
</p>
<p>If a normal community is used, this
				community SHOULD be removed from the
				path by the ASBR of the peer receiving
				it. If not, the GSHUT community MAY be
				removed from the path by all the ASBRs of
				the neighboring AS, before propagating the path
				to other peers.
</p>
<p>Not propagating the community
				further in the Internet reduces the
				amount of BGP churn and avoids
				rerouting in distant ASes that would
				also recognize this community value.
				In other words, it helps concealing
				the convergence at the maintenance
				location. 
</p>
<p> There are cases where an
				interdomain exploration is to be
				performed to recover the reachability,
				e.g., in the case of a shutdown in
				confederations where the alternate
				paths will be found in another AS of
				the confederation. In such scenarios,
				the community value SHOULD be allowed
				to transit through the confederation
				but MAY be removed from the paths
				advertised outside of the
				confederation.
</p>
<p> When the local-pref value of a
				path is conserved upon its propagation
				from one AS of the confederation to
				the other, there is no need to have
				the GSHUT community be propagated
				throughout that confederation. 
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.2.4"></a><h3>4.2.2.2.4.&nbsp;
Easing the configuration for G-SHUT</h3>

<p>From a configuration burden viewpoint, it
			  would be much easier to reserve a value for
			  the GSHUT community.
</p>
<p> First, on the g-shut initiator, an
			  operator would have a single configuration
			  rule to be applied at the maintenance time,
			  which would not depend on the identity of
			  its peer. This would make the maintenance
			  operations less error prone.
</p>
<p>Second, on the g-shut neighbor, a simple
			  filter related to g-shut can be applied to
			  all iBGP sessions. Additionnaly, this filter
			  doesn't need to be updated each time
			  neighboring ASes are added or removed.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Graceful shutdown procedures for iBGP sessions</h3>

<p>If the iBGP topology is viable after the
		maintenance of the session, i.e, if all BGP speakers
		of the AS have an iBGP signaling path for all prefixes
		advertised on this g-shut iBGP session, then the
		shutdown of an iBGP session does not lead to transient
		unreachability. 
</p>
<p>However, in the case of a shutdown of a router, a
		reconfiguration of the out-filters of the g-shut
		initiator should be performed to set a low local-pref
		value for the paths originated by the g-shut initiator
		(e.g, BGP aggregates redistributed from other
		protocols, including static routes).
</p>
<p>This behavior is equivalent to the recommended
		behavior for paths "redistributed" from eBGP sessions
		to iBGP sessions in the case of the shutdown of an
		ASBR. 
</p>
<a name="sec.forwarding"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Forwarding modes and forwarding loops</h3>

<p>If the AS applying the solution does not rely on
	encapsulation to forward packets from the Ingress Border
	Router to the Egress Border Router, then transient forwarding
	loops and consequent packet losses can occur during the
	convergence process, even if the procedure described above is
	applied. Hence if zero LoC is required, encapsulation is
	required between ASBRs of the AS.

</p>
<p> Using the out-filter reconfiguration avoids the forwarding
	loops between the g-shut initiator and its directly connected
	upstream neighbors. Indeed, when this reconfiguration is
	applied, the g-shut initiator keeps using its own external
	path and lets the upstream routers converge to the alternate
	ones. During this phase, no forwarding loops can occur between
	the g-shut initiator and its upstream neighbors as the g-shut
	initiator keeps using the affected paths via its eBGP peering
	links. When all the upstream routers have switched to
	alternate paths, the transition performed by the g-shut
	initiator when the session is actually shut down, will be
	loopfree.  Transient forwarding loops between other routers
	will not be avoided with this procedure. 
</p>
<a name="sec.policies"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Dealing with Internet policies</h3>

<p>A side gain of the maintenance solution is that it can also
	reduce the churn implied by a shutdown of an eBGP session.
</p>
<p>For this, it is recommended to apply the filters modifying
	the local-pref value of the paths to values strictly lower but
	as close as possible to the local-pref values of the
	post-convergence paths.  
</p>
<p> For example, if an eBGP link is shut down between a
	provider and one of its customers, and another link
	with this customer remains active, then the value of the
	local-pref of the old paths SHOULD be decreased to the
	smallest possible value of the 'customer' local_pref range,
	minus 1.  Thus, routers will not transiently switch to paths
	received from shared-cost peers or providers, which could lead
	to the propagation of withdraw messages over eBGP sessions with
	shared-cost peers and providers.
</p>
<p> Proceeding like this reduces both BGP churn and traffic
	shifting as routers will less likely switch to transient
	paths.
</p>
<p> In the above example, it also prevents transient
	unreachabilities in the neighboring AS that are due to the
	sending of "abrupt" withdraw messages to shared-cost peers and
	providers.
</p>
<a name="sec.applicability"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Effect of the g-shut procedure on the convergence</h3>

<p> This section describes the effect of applying the solution.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Maintenance of an eBGP session</h3>

<p> This section describes the effect of applying the solution for the shutdown of an eBGP session. 
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.1"></a><h3>7.1.1.&nbsp;
Propagation on the other eBGP sessions of the g-shut initiator</h3>

<p>Nothing is propagated on the other eBGP sessions
				when the out-filters reconfiguration step is
				applied.  The reconfiguration is indeed only
				defined for its iBGP sessions.
</p>
<p>The reconfiguration of the iBGP out-filters will
				trigger the reception of alternate paths at the
				g-shut initiator. As the eBGP in-filters have
				not been modified at that step, the old paths
				are still preferred by the g-shut initiator.
			
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.2"></a><h3>7.1.2.&nbsp;
Propagation on the other iBGP sessions of the g-shut initiator</h3>

<p>During the out-filter reconfiguration, path updates are propagated
				with a reduced local-pref value for the
				affected paths.  As a consequence, Route
				Reflectors and distant ASBRs select and propagate
				alternate paths through the iBGP topology as
				they no longer select the old paths as best.  
</p>
<p> When the shut-down is performed, for each affected prefix, the g-shut initiator propagates on its iBGP sessions:
</p>
<p> . The alternate path, if the best path was received over an eBGP sessions.
</p>
<p> . A withdraw, if the best path was received over an iBGP sessions.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.3"></a><h3>7.1.3.&nbsp;
Propagation of updates in an iBGP full-mesh</h3>

<p> No transient LoC can occur if a reconfiguration of
				the iBGP out-filters on the g-shut initiator
				is performed.
</p>
<a name="sec.corner"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.4"></a><h3>7.1.4.&nbsp;
Propagation of updates from iBGP to iBGP in a RR hierarchy</h3>

<p>Upon the reception of the update of a
			primary path with a lower local-pref value
			from a client, a Route Reflector RR1 will either
			propagate the update, or select an alternate
			path, depending on the fact that the updated
			primary path is still the best one w.r.t. the state of
			the Adj-Rib-In of RR1.

			
<p>If the updated primary path is still the
			best, then the RR will propagate an update for
			this path to the iBGP neighbors to which it
			previously advertised the path. Hence it
			cannot cause transient lack of path in the
			Adj-Rib-In of its iBGP neighbors.
			
</p>

			
<p>If an alternate path is picked, and this
			path was also originated by a client of RR1,
			an update will also be propagated to the same
			neighbors as the one to which the primary path
			was initially propagated. Hence it cannot
			cause transient lack of path in the Adj-Rib-In
			of its iBGP neighbors.
</p>

			
<p> If an alternate path is picked, and this
			path was received from a member of its
			Route-Reflector iBGP full-mesh, then a
			withdraw message is sent.  As the alternate
			path has been sent over each session of the
			iBGP full-mesh, the propagation of a withdraw
			for the primary path of RR1 is done to routers
			that are expected to know the alternate path
			picked by RR1.
</p>

			
<p>The following example describes a situation
			where some corner case timings could lead to transient unreachability from some
			members of the iBGP full-mesh.
</p>
			<br />


			
				
<blockquote class="text">
<p>
</p>
<p>1. A Route Reflector RR1 only knew about
			the primary path upon the shutdown.
</p>
<p> 
</p>
<p>2. A member of its RR full-mesh, RR2,
			propagates an update of the old path with a
			lower local-pref.
</p>
<p> 
</p>
<p>3. Another member of its RR full-mesh, RR3
			processes the update, selects an alternate
			path, and propagates an update in the
			mesh.
</p>
<p> 
</p>
<p>4. RR2 receives the alternate path, selects
			it as best, and hence withdraws the updated
			old path on the iBGP sessions of the mesh.
</p>
<p> 
</p>
<p>5. If for any reason, RR1 receives and
			processes the withdraw generated in step 4
			before processing the update generated in step
			3, RR1 transiently suffers from unreachability
			for the affected prefix. 
</p>
</blockquote>

<p>In such corner cases, the solution improves
			the iBGP convergence behavior/LoC but does not
			ensure 0 packet loss, as we cannot define a
			simple solution relying only on a
			reconfiguration of the filters of the g-shut
			initiator. Improving the availability of
			alternate paths in Route Reflectors, using
			<a class='info' href='#BestExternal'>[BestExternal]<span> (</span><span class='info'>Marques, P., Fernando, R., Chen, E., and P. Mohapatra, &ldquo;Advertisement of the best-external route to IBGP,&rdquo; July&nbsp;2008.</span><span>)</span></a>, or <a class='info' href='#AddPath'>[AddPath]<span> (</span><span class='info'>D. Walton, A. Retana, and E. Chen, &ldquo;Advertisement of Multiple Paths in BGP,&rdquo; .</span><span>)</span></a>, seems to be the most
			pragmatic solution to these corner cases. 
</p>
<p> The use of <a class='info' href='#BestExternal'>[BestExternal]<span> (</span><span class='info'>Marques, P., Fernando, R., Chen, E., and P. Mohapatra, &ldquo;Advertisement of the best-external route to IBGP,&rdquo; July&nbsp;2008.</span><span>)</span></a>
			in the iBGP full-mesh between RRs can solve
			these corner cases by ensuring that within an
			AS, the advertisement of a new path is not
			translated into the withdraw of a former
			path.
</p>
<p> Indeed, "best-external" ensures that an
			ASBR does not withdraw a previously advertised
			(eBGP) path when it receives an additional,
			preferred path over an iBGP session. Also,
			"best-intra-cluster" ensures that a RR does
			not withdraw a previously advertised (iBGP)
			path to its non clients (e.g. other RRs in a
			mesh of RR) when it receives a new, preferred
			path over an iBGP session.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Maintenance of an iBGP session</h3>

<p>If the shutdown does not temper with the
		viability of the iBGP topology, the described
		procedure is sufficient to avoid LoC.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Applicability of the g-shut procedure</h3>

<p> The applicability of the procedure described in
		this draft to the cases presented in <a class='info' href='#REQS'>[REQS]<span> (</span><span class='info'>Decraene, B., Francois, P., Pelsser, C., and Z. Ahmad, &ldquo;Requirements for the graceful shutdown of BGP sessions,&rdquo; May&nbsp;2009.</span><span>)</span></a> can be shown by combining the
		effects described in this section. A complete case by
		case analysis will be provided in the next versions of
		the draft. 
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
Summary of operations</h3>

<p>This section summarizes the configurations and actions to be
performed to support the g-shut procedure for eBGP peering links. 
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.1"></a><h3>7.4.1.&nbsp;
Pre-configuration</h3>

<p> On each ASBR supporting the g-shut procedure, set-up an out-filter applied on all iBGP sessions
     of the ASBR, that :
</p>
<p> . sets the local-pref of the paths tagged with the g-shut community to a low value
</p>
<p> . removes the g-shut community from the path.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.2"></a><h3>7.4.2.&nbsp;
Operations at maintenance time</h3>

<p> On the g-shut initiator : 
</p>
<p> . Apply an in-filter on the maintained BGP session to tag the paths received over the session with the g-shut community. 
</p>
<p> . Apply an out-filter on the maintained BGP session to tag the paths propagated over the session with the g-shut community.
</p>
<p> . Wait for convergence to happen.
</p>
<p> . Perform a BGP session shutdown. 
</p>
<p>
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Link Up cases</h3>

<p>We identify two potential causes for transient packet losses upon
  an eBGP link up event. The first one is local to the g-shut initiator,
  the second one is due to the BGP convergence following the injection of new
  best paths within the iBGP topology. 
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Unreachability local to the ASBR</h3>

<p>An ASBR that selects as best a path received over a newly
    brought up eBGP session may transiently drop traffic. This can
    typically happen when the nexthop attribute differs from the IP
    address of the eBGP peer, and the receiving ASBR has not yet
    resolved the MAC address associated with the IP address of that
    "third party" nexthop. 
</p>
<p>A BGP speaker implementation could avoid such losses by
    ensuring that "third party" nexthops are resolved before
    installing paths using these in the RIB.
</p>
<p>If the link up event corresponds to an eBGP session that is being manually
    brought up, over an already up multi-access link, then the
    operator can ping third party nexthops that are expected to be
    used before actually bringing the session up, or ping directed
    broadcast the subnet IP address of the link. By proceeding like
    this, the MAC addresses associated with these third party nexthops
    will be resolved by the g-no-shut initiator.
    
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
iBGP convergence</h3>

<p> Similar corner cases as described in <a class='info' href='#sec.corner'>Section&nbsp;7.1.4<span> (</span><span class='info'>Propagation of updates from iBGP to iBGP in a RR hierarchy</span><span>)</span></a> for the link down case, can occur during an eBGP link up event.
</p>
<p>A typical example for such transient unreachability for a given
    prefix is the following :
</p>
<p></p>
<blockquote class="text">
<p>1. A Route Reflector, RR1, is initially advertising the
	  current best path to the members of its iBGP RR
	  full-mesh. It propagated that path within its RR
	  full-mesh. Another route reflector of the full-mesh, RR2,
	  knows only that path towards the prefix.
	  
</p>
<p>2. A third Route Reflector of the RR full-mesh, RR3
	  receives a new best path orginated by the "g-no-shut"
	  initiator, being one of its RR clients. RR3 selects it as
	  best, and propagates an UPDATE within its RR full-mesh,
	  i.e., to RR1 and RR2.
	  
</p>
<p>3. RR1 receives that path, reruns its decision process,
	  and picks this new path as best. As a result, RR1 withdraws
	  its previously announced best-path on the iBGP sessions of its RR full-mesh.
	  
</p>
<p>4. If, for any reason, RR3 processes the withdraw
	  generated in step 3, before processing the update generated
	  in step 2, RR3 transiently suffers from unreachability for
	  the affected prefix. 
</p>
</blockquote><p>
	
</p>
<p> The use of <a class='info' href='#BestExternal'>[BestExternal]<span> (</span><span class='info'>Marques, P., Fernando, R., Chen, E., and P. Mohapatra, &ldquo;Advertisement of the best-external route to IBGP,&rdquo; July&nbsp;2008.</span><span>)</span></a> among the RR of
	the iBGP full-mesh can solve these corner cases by ensuring
	that within an AS, the advertisement of a new route is not
	translated into the withdraw of a former route.
</p>
<p> Indeed, "best-external" ensures that an ASBR does not
	withdraw a previously advertised (eBGP) path when it receives
	an additional, preferred path over an iBGP session. Also,
	"best-intra-cluster" ensures that a RR does not withdraw a
	previously advertised (iBGP) path to its non clients
	(e.g. other RRs in a mesh of RR) when it receives a new,
	preferred path over an iBGP session.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Alternative techniques with limited applicability</h3>

<p>A few alternative techniques have been considered to provide
  g-shut capabilities but have been rejected due to their limited
  applicability.  This section describe them for possible
  reference.
</p>
<a name="sec.loc-pref.infilter"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
In-filter reconfiguration</h3>

<p>An In-filter reconfiguration on the eBGP session undergoing the
    maintenance could be performed instead of out-filter
    reconfigurations on the iBGP sessions of the g-shut initiator.
</p>
<p>Upon the application of the maintenance procedure, if the
    g-shut initiator has an alternate path in its Adj-Rib-In, it will
    switch to it directly.
</p>
<p>If this new path was advertised by an eBGP neighbor of the
    g-shut initiator, the g-shut initiator will send a BGP Path Update
    message advertising the new path over its iBGP and eBGP sessions.
</p>
<p>If this new path was received over an iBGP session, the g-shut
    initiator will select that path and withdraw the previously
    advertised path over its non-client iBGP sessions. There can be
    iBGP topologies where the iBGP peers of the g-shut initiator do
    not know an alternate path, and hence may drop traffic.
</p>
<p> Also, applying an In-filter reconfiguration on the eBGP session undergoing the maintenance 
may lead to transient LoC, in full-mesh iBGP topologies if 
</p>
<p>
		</p>
<blockquote class="text">
<p> a. An ASBR of the
					initiator AS, ASBR1 did not
					initially select its own
					external path as best, and
					
</p>
<p> 
</p>
<p> b. An ASBR of the
					initiator AS, ASBR2 advertises
					a new path along its
					iBGP sessions upon the
					reception of ASBR1's update
					following the in-filter
					reconfiguration on the g-shut
					initiator, and
</p>
<p> 
</p>
<p> c. ASBR1 receives the
					update message, runs its
					Decision Process and hence
					withdraws its
					external path after having
					selected ASBR2's path as best,
					and
</p>
<p> 
</p>
<p> d. An impacted router of the AS processes the
					withdraw of ASBR1 before processing
					the update from ASBR2.
</p>
</blockquote><p>
			
</p>
<p> Applying a reconfiguration of the out-filters prevents
	such transient unreachabilities.
</p>
<p> Indeed, when the g-shut initiator propagates an update of
	the old path first, the withdraw from ASBR2 does
	not trigger unreachability in other nodes, as the old path is
	still available. Indeed, even though it receives alternate
	paths, the g-shut initiator keeps using its old path as best
	as the in-filter of the maintained eBGP session has not been
	modified yet. 
</p>
<p> Applying the out-filter reconfiguration also prevents
	packet loops between the g-shut initiator and its direct
	neighbors when encapsulation is not used between the ASBRs of
	the AS.
</p>
<a name="sec.med-poison"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
Multi Exit Discriminator tweaking</h3>

<p> The MED attribute of the paths to be avoided can be
				increased so as to force the routers in the
				neighboring AS to select other paths. 
</p>
<p> The solution only works if the alternate paths are
				as good as the initial ones with respect to the
				Local-Pref value and the AS Path Length value.
				In the other cases, increasing the MED value
				will not have an impact on the decision process
				of the routers in the neighboring AS.  
</p>
<a name="sec.igp-poison"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3"></a><h3>9.3.&nbsp;
IGP distance Poisoning</h3>

<p> The distance to the BGP nexthop corresponding to the maintained session 
				can be increased in the IGP so that the old paths will be less preferred
				during the application of the IGP distance tie-break rule. However, this
				solution only works for the paths whose
				alternates are as good as the old paths with
				respect to their Local-Pref value, their AS
				Path length, and their MED value.
</p>
<p> Also, this poisoning cannot be applied
			when nexthop self is used as there is no
			nexthop specific to the maintained session to
			poison in the IGP.
			
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
IANA considerations</h3>

<p>Applying the g-shut procedure is rendered much easier with a
reserved g-shut community value.  Hence this draft suggests to reserve
a community value, e.g., 0xFFFF0000, for this purpose. 
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Security Considerations</h3>

<p> By providing the g-shut service to a neighboring AS, an ISP provides
	means to this neighbor to lower the local-pref value assigned to the paths received
	from this neighbor. 
</p>
<p> The neighbor could abuse the technique and do inbound traffic
	engineering by declaring some prefixes as undergoing a maintenance so as to
	switch traffic to another peering link.
</p>
<p>If this behavior is not tolerated by the ISP, it SHOULD monitor the use
	of the g-shut community by this neighbor.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Acknowledgments</h3>

<p>The authors wish to thank Olivier Bonaventure and Pradosh Mohapatra
for their useful comments on this work.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.&nbsp;References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="AddPath">[AddPath]</a></td>
<td class="author-text">D. Walton, A. Retana, and E. Chen, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-walton-bgp-add-paths-06.txt.txt">Advertisement of Multiple Paths in BGP</a>,&rdquo; draft-walton-bgp-add-paths-06.txt (work in progress).</td></tr>
<tr><td class="author-text" valign="top"><a name="BestExternal">[BestExternal]</a></td>
<td class="author-text">Marques, P., Fernando, R., Chen, E., and P. Mohapatra, &ldquo;Advertisement of the best-external route to IBGP,&rdquo; &nbsp;draft-marques-idr-best-external-00.txt, July&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="REQS">[REQS]</a></td>
<td class="author-text">Decraene, B., Francois, P., Pelsser, C., and Z. Ahmad, &ldquo;Requirements for the graceful shutdown of BGP sessions,&rdquo; &nbsp;draft-ietf-grow-bgp-graceful-shutdown-requirements-00.txt , May&nbsp;2009.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Pierre Francois</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Universite catholique de Louvain</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Place Ste Barbe, 2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Louvain-la-Neuve  1348</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">BE</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:pierre.francois@uclouvain.be">pierre.francois@uclouvain.be</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://inl.info.ucl.ac.be/pfr">http://inl.info.ucl.ac.be/pfr</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bruno Decraene</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France Telecom</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">38-40 rue du General Leclerc</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">92794 Issi Moulineaux cedex 9  </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">FR</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:bruno.decraene@orange-ftgroup.com">bruno.decraene@orange-ftgroup.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cristel Pelsser</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NTT Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">9-11, Midori-Cho 3 Chrome</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Musashino-Shi, Tokyo  180-8585</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">JP</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:pelsser.cristel@lab.ntt.co.jp">pelsser.cristel@lab.ntt.co.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Clarence Filsfils</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">De kleetlaan 6a</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Diegem  1831</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">BE</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:cfilsfil@cisco.com">cfilsfil@cisco.com</a></td></tr>
</table>
</body></html>
