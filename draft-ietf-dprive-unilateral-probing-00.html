<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Unilateral Opportunistic Deployment of Encrypted Recursive-to-Authoritative DNS</title>
<meta content="Daniel Kahn Gillmor" name="author">
<meta content="Joey Salazar" name="author">
<meta content="
       This draft sets out steps that DNS servers (recursive resolvers and authoritative servers) can take unilaterally (without any coordination with other peers) to defend DNS query privacy against a passive network monitor.
The steps in this draft can be defeated by an active attacker, but should be simpler and less risky to deploy than more powerful defenses.
The draft also introduces (but does not try to specify) the semantics of signalling that would permit defense against an active attacker. 
       The goal of this draft is to simplify and speed deployment of opportunistic encrypted transport in the recursive-to-authoritative hop of the DNS ecosystem.
With wider easy deployment of the underlying transport on an opportunistic basis, we hope to facilitate the future specification of stronger cryptographic protections against more powerful attacks. 
    " name="description">
<meta content="xml2rfc 3.12.3" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-dprive-unilateral-probing-00" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.3
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.8.0
    MarkupSafe 2.0.1
    pycountry 22.1.10
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.27.1
    setuptools 59.6.0
    six 1.16.0
    WeasyPrint 52.5
-->
<link href="/tmp/dprive-unilateral-probing-00-2vompvve.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Unilateral Encrypted Authoritative DNS</td>
<td class="right">March 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Gillmor &amp; Salazar</td>
<td class="center">Expires 8 September 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">dprive</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-dprive-unilateral-probing-00</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-03-07" class="published">7 March 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-09-08">8 September 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">D.K. Gillmor</div>
<div class="org">ACLU</div>
</div>
<div class="author">
      <div class="author-name">J. Salazar</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Unilateral Opportunistic Deployment of Encrypted Recursive-to-Authoritative DNS</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This draft sets out steps that DNS servers (recursive resolvers and authoritative servers) can take unilaterally (without any coordination with other peers) to defend DNS query privacy against a passive network monitor.
The steps in this draft can be defeated by an active attacker, but should be simpler and less risky to deploy than more powerful defenses.
The draft also introduces (but does not try to specify) the semantics of signalling that would permit defense against an active attacker.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">The goal of this draft is to simplify and speed deployment of opportunistic encrypted transport in the recursive-to-authoritative hop of the DNS ecosystem.
With wider easy deployment of the underlying transport on an opportunistic basis, we hope to facilitate the future specification of stronger cryptographic protections against more powerful attacks.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo-4">
<a href="#name-status-of-this-memo-4" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 8 September 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice-4">
<a href="#name-copyright-notice-4" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents-4">
<a href="#name-table-of-contents-4" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction-3" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-requirements-language-3" class="xref">Requirements Language</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-terminology-3" class="xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-priorities" class="xref">Priorities</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-minimizing-negative-impacts" class="xref">Minimizing Negative Impacts</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-protocol-choices" class="xref">Protocol Choices</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-guidance-for-authoritative-" class="xref">Guidance for Authoritative Servers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-pooled-authoritative-server" class="xref">Pooled Authoritative Servers Behind a Single IP Address</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-authentication" class="xref">Authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-server-name-indication" class="xref">Server Name Indication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-resource-exhaustion" class="xref">Resource Exhaustion</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-guidance-for-recursive-reso" class="xref">Guidance for recursive resolvers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-overall-recursive-resolver-" class="xref">Overall recursive resolver Settings</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-recursive-resolver-requirem" class="xref">Recursive Resolver Requirements</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-authoritative-server-encryp" class="xref">Authoritative Server Encrypted Transport Connection State</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="xref">4.3.1</a>.  <a href="#name-separate-state-for-each-of-" class="xref">Separate State for Each of the Recursive Resolver's Own IP Addresses</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-maintaining-authoritative-s" class="xref">Maintaining Authoritative State by IP Address</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-probing-policy" class="xref">Probing Policy</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.1">
                    <p id="section-toc.1-1.4.2.5.2.1.1"><a href="#section-4.5.1" class="xref">4.5.1</a>.  <a href="#name-sending-a-query-over-do53" class="xref">Sending a query over Do53</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.2">
                    <p id="section-toc.1-1.4.2.5.2.2.1"><a href="#section-4.5.2" class="xref">4.5.2</a>.  <a href="#name-receiving-a-response-over-d" class="xref">Receiving a response over Do53</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.3">
                    <p id="section-toc.1-1.4.2.5.2.3.1"><a href="#section-4.5.3" class="xref">4.5.3</a>.  <a href="#name-initiating-a-connection-ove" class="xref">Initiating a connection over encrypted transport</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.4">
                    <p id="section-toc.1-1.4.2.5.2.4.1"><a href="#section-4.5.4" class="xref">4.5.4</a>.  <a href="#name-establishing-an-encrypted-t" class="xref">Establishing an encrypted transport connection</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.5">
                    <p id="section-toc.1-1.4.2.5.2.5.1"><a href="#section-4.5.5" class="xref">4.5.5</a>.  <a href="#name-failing-to-establish-an-enc" class="xref">Failing to establish an encrypted transport connection</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.6">
                    <p id="section-toc.1-1.4.2.5.2.6.1"><a href="#section-4.5.6" class="xref">4.5.6</a>.  <a href="#name-encrypted-transport-failure" class="xref">Encrypted transport failure</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.7">
                    <p id="section-toc.1-1.4.2.5.2.7.1"><a href="#section-4.5.7" class="xref">4.5.7</a>.  <a href="#name-handling-clean-shutdown-of-" class="xref">Handling clean shutdown of encrypted transport connection</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.8">
                    <p id="section-toc.1-1.4.2.5.2.8.1"><a href="#section-4.5.8" class="xref">4.5.8</a>.  <a href="#name-sending-a-query-over-encryp" class="xref">Sending a query over encrypted transport</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.9">
                    <p id="section-toc.1-1.4.2.5.2.9.1"><a href="#section-4.5.9" class="xref">4.5.9</a>.  <a href="#name-receiving-a-response-over-e" class="xref">Receiving a response over encrypted transport</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.10">
                    <p id="section-toc.1-1.4.2.5.2.10.1"><a href="#section-4.5.10" class="xref">4.5.10</a>. <a href="#name-resource-exhaustion-2" class="xref">Resource Exhaustion</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.11">
                    <p id="section-toc.1-1.4.2.5.2.11.1"><a href="#section-4.5.11" class="xref">4.5.11</a>. <a href="#name-maintaining-connections" class="xref">Maintaining connections</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-signalling-for-stronger-def" class="xref">Signalling for Stronger Defense</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-combining-signals-with-oppo" class="xref">Combining Signals with Opportunistic Probing</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-iana-considerations-4" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-privacy-considerations" class="xref">Privacy Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-server-name-indication-3" class="xref">Server Name Indication</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-considerations-4" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-acknowledgements-3" class="xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-references-4" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-normative-references-3" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-informative-references-3" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-document-considerations" class="xref">Document Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#appendix-A.1" class="xref">A.1</a>.  <a href="#name-document-history" class="xref">Document History</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1.2.1">
                    <p id="section-toc.1-1.11.2.1.2.1.1"><a href="#appendix-A.1.1" class="xref">A.1.1</a>.  <a href="#name-substantive-changes-from-01" class="xref">Substantive changes from -01 to -02</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1.2.2">
                    <p id="section-toc.1-1.11.2.1.2.2.1"><a href="#appendix-A.1.2" class="xref">A.1.2</a>.  <a href="#name-substantive-changes-from-00" class="xref">Substantive changes from -00 to -01</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-B" class="xref"></a><a href="#name-authors-addresses-3" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction-3">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction-3" class="section-name selfRef">Introduction</a>
      </h2>
<div id="requirements-language">
<section id="section-1.1">
        <h3 id="name-requirements-language-3">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-requirements-language-3" class="section-name selfRef">Requirements Language</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 (<span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> and <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span>) when, and only when, they appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-1.2">
        <h3 id="name-terminology-3">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-terminology-3" class="section-name selfRef">Terminology</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-1.2-1.1">"unilateral" means capable of opportunistic probing deployment without external coordination with any of the other parties<a href="#section-1.2-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-1.2">Do53 refers to traditional cleartext DNS over port 53 (<span>[<a href="#RFC1035" class="xref">RFC1035</a>]</span>)<a href="#section-1.2-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-1.3">DoQ refers to DNS-over-QUIC (<span>[<a href="#I-D.ietf-dprive-dnsoquic" class="xref">I-D.ietf-dprive-dnsoquic</a>]</span>)<a href="#section-1.2-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-1.4">DoT refers to DNS-over-TLS (<span>[<a href="#RFC7858" class="xref">RFC7858</a>]</span>)<a href="#section-1.2-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-1.5">DoH refers to DNS-over-HTTPS (<span>[<a href="#RFC8484" class="xref">RFC8484</a>]</span>)<a href="#section-1.2-1.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-1.6">Encrypted transports refers to DoQ, DoT, and DoH collectively<a href="#section-1.2-1.6" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="priorities">
<section id="section-2">
      <h2 id="name-priorities">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-priorities" class="section-name selfRef">Priorities</a>
      </h2>
<p id="section-2-1">This document aims to provide guidance to implementers who want to simply enable protection against passive network observers.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">In particular, it focuses on mechanisms that can be adopted unilaterally by recursive resolvers and authoritative servers, without any explicit coordination with the other parties.
This guidance provides opportunistic security (see <span>[<a href="#RFC7435" class="xref">RFC7435</a>]</span>) -- encrypting things that would otherwise be in the clear, without interfering with or weakening stronger forms of security.<a href="#section-2-2" class="pilcrow">¶</a></p>
<div id="minimizing-negative-impacts">
<section id="section-2.1">
        <h3 id="name-minimizing-negative-impacts">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-minimizing-negative-impacts" class="section-name selfRef">Minimizing Negative Impacts</a>
        </h3>
<p id="section-2.1-1">It also aims to minimize potentially negative impacts caused by the probing of encrypted transports -- for the systems that adopt these guidelines, for the parties that they communicate with in the "second hump" of the DNS camel, and for uninvolved third parties.
The negative impacts that we specifically try to minimize are:<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-2.1">excessive bandwidth use<a href="#section-2.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-2.2">excessive computational resources (CPU and memory in particular)<a href="#section-2.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-2.3">amplification attacks (where DNS resolution infrastructure is wielded as part of a DoS attack)<a href="#section-2.1-2.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="protocol-choices">
<section id="section-2.2">
        <h3 id="name-protocol-choices">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-protocol-choices" class="section-name selfRef">Protocol Choices</a>
        </h3>
<p id="section-2.2-1">While this document focuses specifically on strategies used by DNS servers, it does not go into detail on the specific protocols used, as those protocols --- in particular, DoT and DoQ --- are described in other documents.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">This document does not pursue the use of DoH in this context, because a DoH client needs to know the path part of a DoH endpoint URL, and there are currently no mechanisms for a DNS resolver to predict the path on its own, in an opportunistic or unilateral fashion, without incurring in excessive use of resources.
For instance, a recursive resolver in theory could guess the full path to a queried IP address by trying all the URL paths that the client has in records and see if one of those works, but even though it can be expected that this would work 99% of the time with fewer than 100 probes, this technique would likely incur in excessive resource consumption potentially leading to vulnerabilities and amplification attacks.
The authors of this draft particularly welcome ideas and contributions from the community that lead to a suitable mechanism for unilaterally probing for DoH-capable authoritative servers, for later consideration in this or other drafts.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="authoritative-guidance">
<section id="section-3">
      <h2 id="name-guidance-for-authoritative-">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-guidance-for-authoritative-" class="section-name selfRef">Guidance for Authoritative Servers</a>
      </h2>
<p id="section-3-1">An authoritative server SHOULD implement and deploy  DNS-over-TLS (DoT) on TCP port 853.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">An authoritative server MAY implement and deploy DNS-over-QUIC (DoQ) on UDP port 853.<a href="#section-3-2" class="pilcrow">¶</a></p>
<div id="authoritative-pools">
<section id="section-3.1">
        <h3 id="name-pooled-authoritative-server">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-pooled-authoritative-server" class="section-name selfRef">Pooled Authoritative Servers Behind a Single IP Address</a>
        </h3>
<p id="section-3.1-1">Some authoritative DNS servers are structured as a pool of authoritatives standing behind a load-balancer that runs on a single IP address, forwarding queries to members of the pool.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">In such a deployment, individual members of the pool typically get updated independently from each other.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">A recursive resolver following the guidance in <a href="#recursive-guidance" class="xref">Section 4</a> that interacts with such a pool likely does not know that it is a pool.
If some members of the pool are updated to follow this guidance while others are not, the recursive client might see the pool as a single authoritative server that sometimes offers and sometimes refuses encrypted transport.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1-4">To avoid incurring additional minor timeouts for such a recursive resolver, the pool operator SHOULD either:<a href="#section-3.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-5.1">ensure that all members of the pool enable the same encrypted transport(s) within the span of a few seconds, or<a href="#section-3.1-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-5.2">ensure that the load balancer maps client requests to pool members based on client IP addresses.<a href="#section-3.1-5.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.1-6">Similar concerns apply to authoritative servers responding from an anycast IP address.
As long as the pool of servers is in a heterogenous state, any flapping route that switches a given client IP address to a different responder risks incurring an additional timeout.
Frequent changes of routing for anycast listening IP addresses are also likely to cause problems for TLS, TCP, or QUIC connection state as well, so stable routes are important to ensure that the service remains available and responsive.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authentication">
<section id="section-3.2">
        <h3 id="name-authentication">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-authentication" class="section-name selfRef">Authentication</a>
        </h3>
<p id="section-3.2-1">For unilateral deployment, an authoritative server does not need to offer any particular form of authentication.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">The simplest deployment would simply provide a self-issued, regularly-updated X.509 certificate.
This mechanism is supported by many TLS and QUIC clients, and will be acceptable for any opportunistic connection.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">Possible alternate forms of server authentication include:<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-4.1">an X.509 Certificate issued by a widely-known certification authority associated with the common NS names used for this authoritative server<a href="#section-3.2-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-4.2">DANE authentication (potentially including the TLS handshake)<a href="#section-3.2-4.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="authoritative-sni">
<section id="section-3.3">
        <h3 id="name-server-name-indication">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-server-name-indication" class="section-name selfRef">Server Name Indication</a>
        </h3>
<p id="section-3.3-1">An authoritative DNS server that wants to handle unilateral queries MAY rely on Server Name Indication (SNI) to select alternate server credentials.
However, such a server MUST NOT serve resource records that differ based on SNI (or on the lack of SNI) provided by the client, as a probing recursive resolver that offers SNI might or might not have used the right server name to get the records it's looking for.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authoritative-resource-exhaustion">
<section id="section-3.4">
        <h3 id="name-resource-exhaustion">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-resource-exhaustion" class="section-name selfRef">Resource Exhaustion</a>
        </h3>
<p id="section-3.4-1">A well-behaved recursive resolver may keep an encrypted connection open to an authoritative server, to amortize the costs of connection setup for both parties.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<p id="section-3.4-2">However, some authoritative servers may have insufficient resources available to keep many connections open concurrently.<a href="#section-3.4-2" class="pilcrow">¶</a></p>
<p id="section-3.4-3">To keep resources under control, authoritative servers should proactively manage their encrypted connections.
Section 6.5 of <span>[<a href="#I-D.ietf-dprive-dnsoquic" class="xref">I-D.ietf-dprive-dnsoquic</a>]</span> ("Connection Handling") offers useful guidance for servers managing DoQ connections.
Section 3.4 of <span>[<a href="#RFC7858" class="xref">RFC7858</a>]</span> offers useful guidance for servers managing DoT connections.<a href="#section-3.4-3" class="pilcrow">¶</a></p>
<p id="section-3.4-4">An authoritative server facing unforseen resource exhaustion SHOULD cleanly close open connections from recursive resolvers based on the authoritative's preferred prioritization.<a href="#section-3.4-4" class="pilcrow">¶</a></p>
<p id="section-3.4-5">In the case of unanticipated resource exhaustion, a reasonable prioritization scheme would be to close connections in this order, until resources are back in control:<a href="#section-3.4-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.4-6.1">connections with no outstanding queries, ordered by idle time (longest idle time gets closed first)<a href="#section-3.4-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.4-6.2">connections with outstanding queries, ordered by age of outstanding query (oldest outstanding query gets closed first)<a href="#section-3.4-6.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.4-7">When resources are especially tight, the authoritative server may also decline to accept new connections over encrypted transport.<a href="#section-3.4-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="recursive-guidance">
<section id="section-4">
      <h2 id="name-guidance-for-recursive-reso">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-guidance-for-recursive-reso" class="section-name selfRef">Guidance for recursive resolvers</a>
      </h2>
<p id="section-4-1">This section outlines a probing policy suitable for unilateral adoption by any recursive resolver.
Following this policy should not result in failed resolutions or significant delay.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="overall-recursive-resolver-settings">
<section id="section-4.1">
        <h3 id="name-overall-recursive-resolver-">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-overall-recursive-resolver-" class="section-name selfRef">Overall recursive resolver Settings</a>
        </h3>
<p id="section-4.1-1">A recursive resolver implementing this draft must set system-wide values for some default parameters.
These parameters may be set independently for each supported encrypted transport, though a simple implementation may keep the parameters constant across encrypted transports.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<span id="name-recursive-resolver-system-p"></span><table class="center" id="table-1">
          <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-recursive-resolver-system-p" class="selfRef">recursive resolver system parameters per encrypted transport</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Name</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Suggested Default</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>persistence</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">How long should the recursive resolver remember successful encrypted transport connections?</td>
              <td class="text-left" rowspan="1" colspan="1">3 days (259200 seconds)</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>damping</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">How long should the recursive resolver remember unsuccessful encrypted transport connections?</td>
              <td class="text-left" rowspan="1" colspan="1">1 day (86400 seconds)</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>timeout</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">How long should the recursive resolver wait for an initiated encrypted connection to complete?</td>
              <td class="text-left" rowspan="1" colspan="1">4 seconds</td>
            </tr>
          </tbody>
        </table>
<p id="section-4.1-3">This document uses the notation <code>E-foo</code> to refer to the <code>foo</code> parameter for the encrypted transport <code>E</code>.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">For example <code>DoT-persistence</code> would indicate the length of time that the recursive resolver will remember that an authoritative server had a successful connection over <code>DoT</code>.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">This document also assumes that the resolver maintains a list of outstanding cleartext queries destined for the authoritative resolver's IP address <code>X</code>.
This list is referred to as <code>Do53-queries[X]</code>.
This document does not attempt to describe the specific operation of sending and receiving cleartext DNS queries (Do53) for a recursive resolver.
Instead it describes a "bolt-on" mechanism that extends the recursive resolver's operation on a few simple hooks into the recursive resolver's existing handling of Do53.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1-6">Implementers or deployers of DNS recursive resolvers that follow the strategies in this document are encouraged to report their preferred values of these parameters.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="recursive-resolver-requirements">
<section id="section-4.2">
        <h3 id="name-recursive-resolver-requirem">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-recursive-resolver-requirem" class="section-name selfRef">Recursive Resolver Requirements</a>
        </h3>
<p id="section-4.2-1">To follow this guidance, a recursive resolver MUST implement at least one of either DoT or DoQ in its capacity as a client of authoritative nameservers.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">A recursive resolver SHOULD implement the client side of DNS-over-TLS (DoT).
A recursive resolver MAY implement the client side of DNS-over-QUIC (DoQ).<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">DoT queries from the recursive resolver MUST target TCP port 853, with an ALPN of <code>dot</code>.
DoQ queries from the recursive resolver MUST target UDP port 853, with an ALPN of <code>doq</code>.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">While this document focuses on the recursive-to-authoritative hop, a recursive resolver implementing these strategies SHOULD also accept queries from its clients over some encrypted transport (current common transports are DoH or DoT).<a href="#section-4.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authoritative-server-encrypted-transport-connection-state">
<section id="section-4.3">
        <h3 id="name-authoritative-server-encryp">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-authoritative-server-encryp" class="section-name selfRef">Authoritative Server Encrypted Transport Connection State</a>
        </h3>
<p id="section-4.3-1">The recursive resolver SHOULD keep a record of the state for each authoritative server it contacts, indexed by the IP address of the authoritative server and the encrypted transports supported by the recursive resolver.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">Each record should contain the following fields for each supported encrypted transport, each of which would initially be <code>null</code>:<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<span id="name-recursive-resolver-state-pe"></span><table class="center" id="table-2">
          <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-recursive-resolver-state-pe" class="selfRef">recursive resolver state per authoritative IP, per encrypted transport</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Name</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Retain Across Reset</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>session</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">The associated state of any existing, established session (the structure of this value is dependent on the encrypted transport implementation).  If <code>session</code> is not <code>null</code>, it may be in one of two states: <code>pending</code> or <code>established</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>initiated</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Timestamp of most recent connection attempt</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>completed</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Timestamp of most recent completed handshake</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>status</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Enumerated value of <code>success</code> or <code>fail</code> or <code>timeout</code>, associated with the <code>completed</code> handshake</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>resumptions</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">A stack of resumption tickets (and associated parameters) that could be used to resume a prior successful connection</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>queries</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">A queue of queries intended for this authoritative server, each of which has additional status <code>early</code>, <code>unsent</code>, or <code>sent</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>last-activity</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">A timestamp of the most recent activity on the connection</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
            </tr>
          </tbody>
        </table>
<p id="section-4.3-4">Note that the <code>session</code> fields in aggregate constitute a pool of open connections to different servers.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<p id="section-4.3-5">With the exception of the <code>session</code>, <code>queries</code>, and <code>last-activity</code> fields, this cache information should be kept across restart of the server unless explicitly cleared by administrative action.<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<p id="section-4.3-6">This document uses the notation <code>E-foo[X]</code> to indicate the value of field <code>foo</code> for encrypted transport <code>E</code> to IP address <code>X</code>.<a href="#section-4.3-6" class="pilcrow">¶</a></p>
<p id="section-4.3-7">For example, <code>DoT-initiated[192.0.2.4]</code> represents the timestamp when the most recent DoT connection packet was sent to IP address 192.0.2.4.<a href="#section-4.3-7" class="pilcrow">¶</a></p>
<div id="resolver-binding">
<section id="section-4.3.1">
          <h4 id="name-separate-state-for-each-of-">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-separate-state-for-each-of-" class="section-name selfRef">Separate State for Each of the Recursive Resolver's Own IP Addresses</a>
          </h4>
<p id="section-4.3.1-1">Note that the recursive resolver should record this per-authoritative-IP state for each IP address it uses as it sends its queries.
For example, if a recursive resolver can send a packet to authoritative servers from IP addresses <code>192.0.2.100</code> and <code>192.0.2.200</code>, it should keep two distinct sets of per-authoritative-IP state, one for each source address it uses.
Keeping these state tables distinct for each source address makes it possible for a pooled authoritative server behind a load balancer to do a partial rollout while minimizing accidental timeouts (see <a href="#authoritative-pools" class="xref">Section 3.1</a>).<a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="maintaining-authoritative-state-by-ip-address">
<section id="section-4.4">
        <h3 id="name-maintaining-authoritative-s">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-maintaining-authoritative-s" class="section-name selfRef">Maintaining Authoritative State by IP Address</a>
        </h3>
<p id="section-4.4-1">In designing a probing strategy, the recursive resolver could record its knowledge about any given authoritative server with different strategies, including at least:<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-2.1">the authoritative server's IP address,<a href="#section-4.4-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-2.2">the authoritative server's name (the NS record used), or<a href="#section-4.4-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-2.3">the zone that contains the record being looked up.<a href="#section-4.4-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.4-3">This draft encourages the first strategy, to minimize timeouts or accidental delays.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4-4">A timeout (accidental delay) is most likely to happen when the recursive client believes that the authoritative server offers encrypted transport, but the actual server reached declines encrypted transport (or worse, filters the incoming traffic and does not even respond with an ICMP port closed message).<a href="#section-4.4-4" class="pilcrow">¶</a></p>
<p id="section-4.4-5">By associating state with the IP address, the recursive client is most able to avoid reaching a heterogenous deployment.<a href="#section-4.4-5" class="pilcrow">¶</a></p>
<p id="section-4.4-6">For example, consider an authoritative server named <code>ns0.example.com</code> that is served by two installations (with two <code>A</code> records), one at <code>192.0.2.7</code> that follows this guidance, and one at <code>192.0.2.8</code> that is a legacy (cleartext port 53-only) deployment.
A recursive client who associates state with the <code>NS</code> name and reaches <code>.7</code> first will "learn" that <code>ns0.example.com</code> supports encrypted transport.
A subsequent query over encrypted transport dispatched to <code>.8</code> would fail, potentially delaying the response.<a href="#section-4.4-6" class="pilcrow">¶</a></p>
<p id="section-4.4-7">By associating the state with the authoritative IP address, the client can minimize the number of accidental delays introduced (see also <a href="#resolver-binding" class="xref">Section 4.3.1</a> and <a href="#authoritative-pools" class="xref">Section 3.1</a>).<a href="#section-4.4-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="probing-policy">
<section id="section-4.5">
        <h3 id="name-probing-policy">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-probing-policy" class="section-name selfRef">Probing Policy</a>
        </h3>
<p id="section-4.5-1">When a recursive resolver discovers the need for an authoritative lookup to an authoritative DNS server using IP address <code>X</code>, it retrieves the records associated with <code>X</code> from its cache.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<p id="section-4.5-2">The following sections presume that the time of the discovery of the need for lookup is time <code>T0</code>.<a href="#section-4.5-2" class="pilcrow">¶</a></p>
<p id="section-4.5-3">If any of the records discussed here are absent, they are treated as <code>null</code>.<a href="#section-4.5-3" class="pilcrow">¶</a></p>
<p id="section-4.5-4">The recursive resolver must know to decide whether to initially send a query over Do53, or over any of the supported encrypted transports (DoT or DoQ).<a href="#section-4.5-4" class="pilcrow">¶</a></p>
<p id="section-4.5-5">Note that a resolver might initiate this query via any or all of the known transports.
When multiple queries are sent, the initial packets for each connection can be sent concurrently, similar to "Happy Eyeballs" (<span>[<a href="#RFC8305" class="xref">RFC8305</a>]</span>).
However, unlike Happy Eyeballs, when one transport succeeds, the other connections do not need to be terminated, but can instead be continued to establish whether the IP address <code>X</code> is capable of corresponding on the relevant transport.<a href="#section-4.5-5" class="pilcrow">¶</a></p>
<div id="sending-a-query-over-do53">
<section id="section-4.5.1">
          <h4 id="name-sending-a-query-over-do53">
<a href="#section-4.5.1" class="section-number selfRef">4.5.1. </a><a href="#name-sending-a-query-over-do53" class="section-name selfRef">Sending a query over Do53</a>
          </h4>
<p id="section-4.5.1-1">For any of the supported encrypted transports <code>E</code>, if either of the following holds true, the resolver SHOULD NOT send a query to <code>X</code> over Do53:<a href="#section-4.5.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.1-2.1">
              <code>E-session[X]</code> is in the <code>established</code> state, or<a href="#section-4.5.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.1-2.2">
              <code>E-status[X]</code> is <code>success</code>, and <code>(T - E-completed[X]) &lt; persistence</code><a href="#section-4.5.1-2.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.5.1-3">Otherwise, if there is no outstanding session for any encrypted transport, and the last successful encrypted transport connection was long ago, the resolver sends a query to <code>X</code> over Do53.
When it does so, it inserts a handle for the query in <code>Do53-queries[X]</code>.<a href="#section-4.5.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="receiving-a-response-over-do53">
<section id="section-4.5.2">
          <h4 id="name-receiving-a-response-over-d">
<a href="#section-4.5.2" class="section-number selfRef">4.5.2. </a><a href="#name-receiving-a-response-over-d" class="section-name selfRef">Receiving a response over Do53</a>
          </h4>
<p id="section-4.5.2-1">When a successful response <code>R</code> is received in cleartext from authoritative server <code>X</code> for a query <code>Q</code> that was sent over Do53, the recursive resolver should:<a href="#section-4.5.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.1">
              <p id="section-4.5.2-2.1.1">If <code>Q</code> is in <code>Do53-queries[X]</code>:<a href="#section-4.5.2-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.1.2.1">Return <code>R</code> to the requesting client<a href="#section-4.5.2-2.1.2.1" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.5.2-2.2">Remove <code>Q</code> from <code>Do53-queries[X]</code><a href="#section-4.5.2-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.2-2.3">
              <p id="section-4.5.2-2.3.1">For each supported encrypted transport <code>E</code>:<a href="#section-4.5.2-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.3.2.1">
                  <p id="section-4.5.2-2.3.2.1.1">If <code>Q</code> is in <code>E-queries[X]</code>:<a href="#section-4.5.2-2.3.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.3.2.1.2.1">Remove <code>Q</code> from <code>E-queries[X]</code><a href="#section-4.5.2-2.3.2.1.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
              </ul>
</li>
          </ul>
<p id="section-4.5.2-3">But if <code>R</code> is unsuccessful (e.g. <code>SERVFAIL</code>):<a href="#section-4.5.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-4.1">
              <p id="section-4.5.2-4.1.1">If <code>Q</code> is in <code>Do53-queries[X]</code>:<a href="#section-4.5.2-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-4.1.2.1">Remove <code>Q</code> from <code>Do53-queries[X]</code><a href="#section-4.5.2-4.1.2.1" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.5.2-4.2">
              <p id="section-4.5.2-4.2.1">if <code>Q</code> is not in any of <code>*-queries[X]</code>:<a href="#section-4.5.2-4.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-4.2.2.1">Return <code>SERVFAIL</code> to the client<a href="#section-4.5.2-4.2.2.1" class="pilcrow">¶</a>
</li>
              </ul>
</li>
          </ul>
</section>
</div>
<div id="initiating-a-connection-over-encrypted-transport">
<section id="section-4.5.3">
          <h4 id="name-initiating-a-connection-ove">
<a href="#section-4.5.3" class="section-number selfRef">4.5.3. </a><a href="#name-initiating-a-connection-ove" class="section-name selfRef">Initiating a connection over encrypted transport</a>
          </h4>
<p id="section-4.5.3-1">If any <code>E-session[X]</code> is in the <code>established</code>, the recursive resolver SHOULD NOT initiate a new connection to <code>X</code> over any other transport, but should instead send a query through the existing session (see <a href="#sending" class="xref">Section 4.5.8</a>).
FIXME: What if there's a preferred transport, but the <code>established</code> session does not correspond to that preferred transport?<a href="#section-4.5.3-1" class="pilcrow">¶</a></p>
<p id="section-4.5.3-2">Otherwise, the timer should examine and possibly refresh its state for encrypted transport <code>E</code> to authoritative IP address <code>X</code>:<a href="#section-4.5.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.3-3.1">if <code>E-session[X]</code> is in state <code>pending</code>, and<a href="#section-4.5.3-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.3-3.2">
              <p id="section-4.5.3-3.2.1"><code>T - E-initiated[X] &gt; E-timeout</code>, then<a href="#section-4.5.3-3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.3-3.2.2.1">set <code>E-session[X]</code> to <code>null</code> and<a href="#section-4.5.3-3.2.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.5.3-3.2.2.2">set <code>E-status[X]</code> to <code>timeout</code><a href="#section-4.5.3-3.2.2.2" class="pilcrow">¶</a>
</li>
              </ul>
</li>
          </ul>
<p id="section-4.5.3-4">When resources are available to attempt a new encrypted transport, the resolver should only initiate a new connection to <code>X</code> over <code>E</code> as long as one of the following holds true:<a href="#section-4.5.3-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.3-5.1">
              <code>E-status[X]</code> is <code>success</code>, or<a href="#section-4.5.3-5.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.3-5.2">
              <code>E-status[X]</code> is <code>fail</code> or <code>timeout</code> and <code>(T - E-completed[X]) &gt; damping</code>, or<a href="#section-4.5.3-5.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.3-5.3">
              <code>E-status[X]</code> is <code>null</code> and <code>E-initiated[X]</code> is <code>null</code><a href="#section-4.5.3-5.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.5.3-6">When initiating a session to <code>X</code> over encrypted transport <code>E</code>, if <code>E-resumptions[X]</code> is not empty, one ticket should be popped off the stack and used to try to resume a previous session.
Otherwise, the initial Client Hello handshake should not try to resume any session.<a href="#section-4.5.3-6" class="pilcrow">¶</a></p>
<p id="section-4.5.3-7">When initiating a connection, the resolver should take the following steps:<a href="#section-4.5.3-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.3-8.1">set <code>E-initiated[X]</code> to <code>T0</code><a href="#section-4.5.3-8.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.3-8.2">store a handle for the new session (which should have <code>pending</code> state)  in <code>E-session[X]</code><a href="#section-4.5.3-8.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.3-8.3">insert a handle for the query that prompted this connection in <code>E-queries[X]</code>, with status <code>unsent</code> or <code>early</code>, as appropriate (see below).<a href="#section-4.5.3-8.3" class="pilcrow">¶</a>
</li>
          </ul>
<div id="early-data">
<section id="section-4.5.3.1">
            <h5 id="name-early-data">
<a href="#section-4.5.3.1" class="section-number selfRef">4.5.3.1. </a><a href="#name-early-data" class="section-name selfRef">Early Data</a>
            </h5>
<p id="section-4.5.3.1-1">Modern encrypted transports like TLS 1.3 offer the chance to store "early data" from the client into the initial Client Hello in some contexts.
A resolver that initiates a connection over a encrypted transport according to this guidance in a context where early data is possible SHOULD send the DNS query that prompted the connection in the early data, according to the sending guidance in <a href="#sending" class="xref">Section 4.5.8</a>.<a href="#section-4.5.3.1-1" class="pilcrow">¶</a></p>
<p id="section-4.5.3.1-2">If it does so, the status of <code>Q</code> in <code>E-queries[X]</code> should be set to <code>early</code> instead of <code>unsent</code>.<a href="#section-4.5.3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="resumption-tickets">
<section id="section-4.5.3.2">
            <h5 id="name-resumption-tickets">
<a href="#section-4.5.3.2" class="section-number selfRef">4.5.3.2. </a><a href="#name-resumption-tickets" class="section-name selfRef">Resumption Tickets</a>
            </h5>
<p id="section-4.5.3.2-1">When initiating a new connection (whether by resuming an old session or not), the recursive resolver SHOULD request a session resumption ticket from the authoritative server.
If the authoritative server supplies a resumption ticket, the recursive resolver pushes it into the stack at <code>E-resumptions[X]</code>.<a href="#section-4.5.3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="recursive-sni">
<section id="section-4.5.3.3">
            <h5 id="name-server-name-indication-2">
<a href="#section-4.5.3.3" class="section-number selfRef">4.5.3.3. </a><a href="#name-server-name-indication-2" class="section-name selfRef">Server Name Indication</a>
            </h5>
<p id="section-4.5.3.3-1">For modern encrypted transports like TLS 1.3, most client implementations expect to send a Server Name Indication (SNI) in the Client Hello.<a href="#section-4.5.3.3-1" class="pilcrow">¶</a></p>
<p id="section-4.5.3.3-2">There are two complications with selecting or sending SNI in this unilateral probing:<a href="#section-4.5.3.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.3.3-3.1">Some authoritative servers are known by more than one name; selecting a single name to use for a given connection may be difficult or impossible.<a href="#section-4.5.3.3-3.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.5.3.3-3.2">In most configurations, the contents of the SNI field is exposed on the wire to a passive adversary.
This potentially reveals additional information about which query is being made, based on the NS of the query itself.<a href="#section-4.5.3.3-3.2" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-4.5.3.3-4">To avoid additional leakage and complexity, a recursive resolver following this guidance SHOULD NOT send SNI to the authoritative when attempting encrypted transport.<a href="#section-4.5.3.3-4" class="pilcrow">¶</a></p>
<p id="section-4.5.3.3-5">If the recursive resolver needs to send SNI to the authoritative for some reason not found in this document, it is RECOMMENDED that it implements Encrypted Client Hello (<span>[<a href="#I-D.ietf-tls-esni" class="xref">I-D.ietf-tls-esni</a>]</span>) to reduce leakage.<a href="#section-4.5.3.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authoritative-server-authentication">
<section id="section-4.5.3.4">
            <h5 id="name-authoritative-server-authen">
<a href="#section-4.5.3.4" class="section-number selfRef">4.5.3.4. </a><a href="#name-authoritative-server-authen" class="section-name selfRef">Authoritative Server Authentication</a>
            </h5>
<p id="section-4.5.3.4-1">A recursive resolver following this guidance MAY attempt to verify the server's identity by X.509 certificate or DANE.
When doing so, the identity would presumably be based on the NS name used for a given query.<a href="#section-4.5.3.4-1" class="pilcrow">¶</a></p>
<p id="section-4.5.3.4-2">However, since this probing policy is unilateral and opportunistic, the client connecting under this policy MUST accept any certificate presented by the server.
If the client cannot verify the server's identity, it MAY use that information for reporting, logging, or other analysis purposes.
But it MUST NOT reject the connection due to the authentication failure, as the result would be falling back to cleartext, which would leak the content of the session to a passive network monitor.<a href="#section-4.5.3.4-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="establishing-an-encrypted-transport-connection">
<section id="section-4.5.4">
          <h4 id="name-establishing-an-encrypted-t">
<a href="#section-4.5.4" class="section-number selfRef">4.5.4. </a><a href="#name-establishing-an-encrypted-t" class="section-name selfRef">Establishing an encrypted transport connection</a>
          </h4>
<p id="section-4.5.4-1">When an encrypted transport connection actually completes (e.g., the TLS handshake completes) at time <code>T1</code>, the resolver sets <code>E-completed[X]</code> to <code>T1</code> and does the following:<a href="#section-4.5.4-1" class="pilcrow">¶</a></p>
<p id="section-4.5.4-2">If the handshake completed successfully:<a href="#section-4.5.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.4-3.1">update <code>E-session[X]</code> so that it is in state <code>established</code><a href="#section-4.5.4-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.4-3.2">set <code>E-status[X]</code> to <code>success</code><a href="#section-4.5.4-3.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.4-3.3">
              <p id="section-4.5.4-3.3.1">for each query <code>Q</code> in <code>E-queries[X]</code>:<a href="#section-4.5.4-3.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.4-3.3.2.1">
                  <p id="section-4.5.4-3.3.2.1.1">if early data was accepted and <code>Q</code> is <code>early</code>,<a href="#section-4.5.4-3.3.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.4-3.3.2.1.2.1">set the status of <code>Q</code> to <code>sent</code><a href="#section-4.5.4-3.3.2.1.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
                <li class="normal" id="section-4.5.4-3.3.2.2">
                  <p id="section-4.5.4-3.3.2.2.1">otherwise:<a href="#section-4.5.4-3.3.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.4-3.3.2.2.2.1">send <code>Q</code> through the session (see <a href="#sending" class="xref">Section 4.5.8</a>), and set the status of <code>Q</code> to <code>sent</code><a href="#section-4.5.4-3.3.2.2.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.5.4-3.4">set <code>E-last-activity[X]</code> to <code>T1</code><a href="#section-4.5.4-3.4" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="failing-to-establish-an-encrypted-transport-connection">
<section id="section-4.5.5">
          <h4 id="name-failing-to-establish-an-enc">
<a href="#section-4.5.5" class="section-number selfRef">4.5.5. </a><a href="#name-failing-to-establish-an-enc" class="section-name selfRef">Failing to establish an encrypted transport connection</a>
          </h4>
<p id="section-4.5.5-1">If, at time <code>T2</code> an encrypted transport handshake completes with a failure (e.g. a TLS alert),<a href="#section-4.5.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.5-2.1">set <code>E-session[X]</code> to <code>null</code><a href="#section-4.5.5-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.5-2.2">set <code>E-status[X]</code> to <code>fail</code><a href="#section-4.5.5-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.5-2.3">set <code>E-completed[X]</code> to <code>T2</code><a href="#section-4.5.5-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.5-2.4">
              <p id="section-4.5.5-2.4.1">for each query <code>Q</code> in <code>E-queries[X]</code>:<a href="#section-4.5.5-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.5-2.4.2.1">if <code>Q</code> is not present in any other <code>*-queries[X]</code> or in <code>Do53-queries[X]</code>, add <code>Q</code> to <code>Do53-queries[X]</code> and send query <code>Q</code> to <code>X</code> over Do53.<a href="#section-4.5.5-2.4.2.1" class="pilcrow">¶</a>
</li>
              </ul>
</li>
          </ul>
<p id="section-4.5.5-3">Note that this failure will trigger the recursive resolver to fall back to cleartext queries to the authoritative server at IP address <code>X</code>.
It will retry encrypted transport to <code>X</code> once the <code>damping</code> timer has elapsed.<a href="#section-4.5.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="encrypted-transport-failure">
<section id="section-4.5.6">
          <h4 id="name-encrypted-transport-failure">
<a href="#section-4.5.6" class="section-number selfRef">4.5.6. </a><a href="#name-encrypted-transport-failure" class="section-name selfRef">Encrypted transport failure</a>
          </h4>
<p id="section-4.5.6-1">Once established, an encrypted transport might fail for a number of reasons (e.g., decryption failure, or improper protocol sequence).<a href="#section-4.5.6-1" class="pilcrow">¶</a></p>
<p id="section-4.5.6-2">If this happens:<a href="#section-4.5.6-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.6-3.1">set <code>E-session[X]</code> to <code>null</code><a href="#section-4.5.6-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.6-3.2">set <code>E-status[X]</code> to <code>fail</code><a href="#section-4.5.6-3.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.6-3.3">
              <p id="section-4.5.6-3.3.1">for each query <code>Q</code> in <code>E-queries[X]</code>:<a href="#section-4.5.6-3.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.6-3.3.2.1">if <code>Q</code> is not present in any other <code>*-queries[X]</code> or in <code>Do53-queries[X]</code>, add <code>Q</code> to <code>Do53-queries[X]</code> and send query <code>Q</code> to <code>X</code> over Do53.
FIXME: should a resumption ticket be used here for this previously successful connection?<a href="#section-4.5.6-3.3.2.1" class="pilcrow">¶</a>
</li>
              </ul>
</li>
          </ul>
<p id="section-4.5.6-4">Note that this failure will trigger the recursive resolver to fall back to cleartext queries to the authoritative server at IP address <code>X</code>.
It will retry encrypted transport to <code>X</code> once the <code>damping</code> timer has elapsed.<a href="#section-4.5.6-4" class="pilcrow">¶</a></p>
<p id="section-4.5.6-5">FIXME: are there specific forms of failure that we might handle differently?
For example, What if a TCP timeout closes an idle DoT connection?
What if a QUIC stream ends up timing out but other streams on the same QUIC connection are going through?
Do the described scenarios cover the case when an encrypted transport's port is made unavailable/closed?<a href="#section-4.5.6-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="handling-clean-shutdown-of-encrypted-transport-connection">
<section id="section-4.5.7">
          <h4 id="name-handling-clean-shutdown-of-">
<a href="#section-4.5.7" class="section-number selfRef">4.5.7. </a><a href="#name-handling-clean-shutdown-of-" class="section-name selfRef">Handling clean shutdown of encrypted transport connection</a>
          </h4>
<p id="section-4.5.7-1">At time <code>T3</code>, the recursive resolver may find that authoritative server <code>X</code> cleanly closes an existing outstanding connection (most likely due to resource exhaustion, see <a href="#authoritative-resource-exhaustion" class="xref">Section 3.4</a>).<a href="#section-4.5.7-1" class="pilcrow">¶</a></p>
<p id="section-4.5.7-2">When this happens:<a href="#section-4.5.7-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.7-3.1">set <code>E-session[X]</code> to <code>null</code><a href="#section-4.5.7-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.7-3.2">
              <p id="section-4.5.7-3.2.1">for each query <code>Q</code> in <code>E-queries[X]</code>:<a href="#section-4.5.7-3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.7-3.2.2.1">if <code>Q</code> is not present in any other <code>*-queries[X]</code> or in <code>Do53-queries[X]</code>, add <code>Q</code> to <code>Do53-queries[X]</code> and send query <code>Q</code> to <code>X</code> over Do53.<a href="#section-4.5.7-3.2.2.1" class="pilcrow">¶</a>
</li>
              </ul>
</li>
          </ul>
<p id="section-4.5.7-4">Note that this premature shutdown will trigger the recursive resolver to fall back to cleartext queries to the authoritative server at IP address <code>X</code>.
Any subsequent query to <code>X</code> will retry the encrypted connection promptly.<a href="#section-4.5.7-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sending">
<section id="section-4.5.8">
          <h4 id="name-sending-a-query-over-encryp">
<a href="#section-4.5.8" class="section-number selfRef">4.5.8. </a><a href="#name-sending-a-query-over-encryp" class="section-name selfRef">Sending a query over encrypted transport</a>
          </h4>
<p id="section-4.5.8-1">When sending a query to an authoritative server over encrypted transport at time <code>T4</code>, the recursive resolver should take a few reasonable steps to ensure privacy and efficiency.<a href="#section-4.5.8-1" class="pilcrow">¶</a></p>
<p id="section-4.5.8-2">When sending query <code>Q</code>, the recursive resolver should ensure that its state in <code>E-queries[X]</code> is set to <code>sent</code>.<a href="#section-4.5.8-2" class="pilcrow">¶</a></p>
<p id="section-4.5.8-3">The recursive resolver also sets <code>E-last-activity[X]</code> to <code>T4</code>.<a href="#section-4.5.8-3" class="pilcrow">¶</a></p>
<p id="section-4.5.8-4">In addition, the recursive resolver should consider the following guidance:<a href="#section-4.5.8-4" class="pilcrow">¶</a></p>
<div id="avoid-edns-client-subnet">
<section id="section-4.5.8.1">
            <h5 id="name-avoid-edns-client-subnet">
<a href="#section-4.5.8.1" class="section-number selfRef">4.5.8.1. </a><a href="#name-avoid-edns-client-subnet" class="section-name selfRef">Avoid EDNS client subnet</a>
            </h5>
<p id="section-4.5.8.1-1">To protect the privacy of the client, the recursive resolver SHOULD NOT send EDNS(0) Client Subnet information to the authoritative server (<span>[<a href="#RFC7871" class="xref">RFC7871</a>]</span>) unless explicitly authorized to do so by the client.<a href="#section-4.5.8.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pad-to-standard-policy">
<section id="section-4.5.8.2">
            <h5 id="name-pad-to-standard-policy">
<a href="#section-4.5.8.2" class="section-number selfRef">4.5.8.2. </a><a href="#name-pad-to-standard-policy" class="section-name selfRef">Pad to standard policy</a>
            </h5>
<p id="section-4.5.8.2-1">To increase the anonymity set for each query, the recursive resolver SHOULD use EDNS(0) padding according to policies described in <span>[<a href="#RFC8467" class="xref">RFC8467</a>]</span>.<a href="#section-4.5.8.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="send-queries-in-separate-channels">
<section id="section-4.5.8.3">
            <h5 id="name-send-queries-in-separate-ch">
<a href="#section-4.5.8.3" class="section-number selfRef">4.5.8.3. </a><a href="#name-send-queries-in-separate-ch" class="section-name selfRef">Send queries in separate channels</a>
            </h5>
<p id="section-4.5.8.3-1">When multiple queries are multiplexed on a single encrypted transport to a single authoritative server, the recursive resolver MUST offer distinct query ID fields for every outstanding query on a connection, and MUST be capable of receiving responses out of order.<a href="#section-4.5.8.3-1" class="pilcrow">¶</a></p>
<p id="section-4.5.8.3-2">To the extent that the encrypted transport can avoid head-of-line blocking (e.g. QUIC can use a separate stream per query) the recursive resolver SHOULD avoid head-of-line blocking.<a href="#section-4.5.8.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="receiving-a-response-over-encrypted-transport">
<section id="section-4.5.9">
          <h4 id="name-receiving-a-response-over-e">
<a href="#section-4.5.9" class="section-number selfRef">4.5.9. </a><a href="#name-receiving-a-response-over-e" class="section-name selfRef">Receiving a response over encrypted transport</a>
          </h4>
<p id="section-4.5.9-1">When a response <code>R</code> for query <code>Q</code> arrives at the recursive resolver over encrypted transport <code>E</code> from authoritative server with IP address <code>X</code> at time <code>T5</code>, if <code>Q</code> is in <code>E-queries[X]</code>, the recursive resolver takes the following steps:<a href="#section-4.5.9-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.9-2.1">Remove <code>R</code> from <code>E-queries[X]</code><a href="#section-4.5.9-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.9-2.2">Set <code>E-last-activity[X]</code> to <code>T5</code><a href="#section-4.5.9-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.9-2.3">
              <p id="section-4.5.9-2.3.1">If <code>R</code> is successful:<a href="#section-4.5.9-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.9-2.3.2.1">send <code>R</code> to the requesting client<a href="#section-4.5.9-2.3.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.5.9-2.3.2.2">
                  <p id="section-4.5.9-2.3.2.2.1">For each supported encrypted transport <code>N</code> other than <code>E</code>:<a href="#section-4.5.9-2.3.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.9-2.3.2.2.2.1">
                      <p id="section-4.5.9-2.3.2.2.2.1.1">If <code>Q</code> is in <code>N-queries[X]</code>:<a href="#section-4.5.9-2.3.2.2.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.9-2.3.2.2.2.1.2.1">Remove <code>Q</code> from <code>N-queries[X]</code><a href="#section-4.5.9-2.3.2.2.2.1.2.1" class="pilcrow">¶</a>
</li>
                      </ul>
</li>
                  </ul>
</li>
                <li class="normal" id="section-4.5.9-2.3.2.3">
                  <p id="section-4.5.9-2.3.2.3.1">If <code>Q</code> is in <code>Do53-queries[X]</code>:<a href="#section-4.5.9-2.3.2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.9-2.3.2.3.2.1">Remove <code>Q</code> from <code>Do53-queries[X]</code><a href="#section-4.5.9-2.3.2.3.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.5.9-2.4">
              <p id="section-4.5.9-2.4.1">Otherwise (<code>R</code> is unsuccessful, e.g., <code>SERVFAIL</code>):<a href="#section-4.5.9-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.9-2.4.2.1">
                  <p id="section-4.5.9-2.4.2.1.1">If <code>Q</code> is not in <code>Do53-queries[X]</code> or any other <code>*-queries[X]</code>:<a href="#section-4.5.9-2.4.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.9-2.4.2.1.2.1">Return <code>SERVFAIL</code> to the requesting client
FIXME: What response should be sent to the clients in the case that extended DNS errors are used in an authoritative's response?<a href="#section-4.5.9-2.4.2.1.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
              </ul>
</li>
          </ul>
</section>
</div>
<div id="recursive-resource-exhaustion">
<section id="section-4.5.10">
          <h4 id="name-resource-exhaustion-2">
<a href="#section-4.5.10" class="section-number selfRef">4.5.10. </a><a href="#name-resource-exhaustion-2" class="section-name selfRef">Resource Exhaustion</a>
          </h4>
<p id="section-4.5.10-1">To keep resources under control, a recursive resolver should proactively manage outstanding encrypted connections.
Section 6.5 of <span>[<a href="#I-D.ietf-dprive-dnsoquic" class="xref">I-D.ietf-dprive-dnsoquic</a>]</span> ("Connection Handling") offers useful guidance for clients managing DoQ connections.
Section 3.4 of <span>[<a href="#RFC7858" class="xref">RFC7858</a>]</span> offers useful guidance for clients managing DoT connections.<a href="#section-4.5.10-1" class="pilcrow">¶</a></p>
<p id="section-4.5.10-2">Even with sensible connection managment, a recursive resolver doing unilateral probing may find resources unexpectedly scarce, and may need to close some outstanding connections.<a href="#section-4.5.10-2" class="pilcrow">¶</a></p>
<p id="section-4.5.10-3">In such a situation, the recursive resolver SHOULD use a reasonable prioritization scheme to close outstanding connections.<a href="#section-4.5.10-3" class="pilcrow">¶</a></p>
<p id="section-4.5.10-4">One reasonable prioritization scheme would be:<a href="#section-4.5.10-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.10-5.1">close outstanding <code>established</code> sessions based on <code>E-last-activity[X]</code> (oldest timestamp gets closed first)<a href="#section-4.5.10-5.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.5.10-6">Note that when resources are limited, a recursive resolver following this guidance may also choose not to initiate new connections for encrypted transport.<a href="#section-4.5.10-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="maintaining-connections">
<section id="section-4.5.11">
          <h4 id="name-maintaining-connections">
<a href="#section-4.5.11" class="section-number selfRef">4.5.11. </a><a href="#name-maintaining-connections" class="section-name selfRef">Maintaining connections</a>
          </h4>
<p id="section-4.5.11-1">Some recursive resolvers looking to amortize connection costs, and to minimize latency MAY choose to synthesize queries to a particular resolver to keep a encrypted transport session active.<a href="#section-4.5.11-1" class="pilcrow">¶</a></p>
<p id="section-4.5.11-2">A recursive resolver that adopts this approach should try to align the synthesized queries with other optimizations.
For example, a recursive resolver that "pre-fetches" a particular resource record to keep its cache "hot" can send that query over an established encrypted transport session.<a href="#section-4.5.11-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="signalling-for-stronger-defense">
<section id="section-5">
      <h2 id="name-signalling-for-stronger-def">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-signalling-for-stronger-def" class="section-name selfRef">Signalling for Stronger Defense</a>
      </h2>
<p id="section-5-1">This draft <em>does not</em> contemplate the specification of any form of coordinated signalling between authoritative servers and recursive resolvers, as such measures would not be unilateral.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">However, the draft highlights the needs of a signaling mechanism for stronger defense.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">We highlight the following questions for other specifications to solve:<a href="#section-5-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-4.1">
          <p id="section-5-4.1.1">What does the signal need to contain?<a href="#section-5-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-4.1.2.1">type of transport? (DoQ? DoT? DoH?)<a href="#section-5-4.1.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5-4.1.2.2">error reporting if secure, authenticated connection fails (how to report? similar to TLSRPT?)<a href="#section-5-4.1.2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5-4.1.2.3">whether to hard-fail if encrypted communication isn't available<a href="#section-5-4.1.2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5-4.1.2.4">cryptographic authentication of authoritative server (e.g. pubkeys) vs. names vs. domain?<a href="#section-5-4.1.2.4" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="section-5-4.2">
          <p id="section-5-4.2.1">How should the signal be presented?<a href="#section-5-4.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-4.2.2.1">SVCB RR or "surprising" DS RR<a href="#section-5-4.2.2.1" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="section-5-4.3">
          <p id="section-5-4.3.1">How should the signal be scoped?<a href="#section-5-4.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-4.3.2.1">per-nameserver (by NS), per-nameserver (by IP address, via <code>in-addr.arpa</code>), or per-domain?<a href="#section-5-4.3.2.1" class="pilcrow">¶</a>
</li>
          </ul>
</li>
      </ul>
<div id="combining-signals-with-opportunistic-probing">
<section id="section-5.1">
        <h3 id="name-combining-signals-with-oppo">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-combining-signals-with-oppo" class="section-name selfRef">Combining Signals with Opportunistic Probing</a>
        </h3>
<p id="section-5.1-1">FIXME: How do the signals get combined with the above opportunistic probing policy?
Can we specify that without needing to specify the signalling mechanism itself?<a href="#section-5.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-6">
      <h2 id="name-iana-considerations-4">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations-4" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">IANA does not need to do anything for implementers to adopt the guidance found in this draft.<a href="#section-6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="privacy-considerations">
<section id="section-7">
      <h2 id="name-privacy-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy Considerations</a>
      </h2>
<div id="sni-considerations">
<section id="section-7.1">
        <h3 id="name-server-name-indication-3">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-server-name-indication-3" class="section-name selfRef">Server Name Indication</a>
        </h3>
<p id="section-7.1-1">A recursive resolver querying an authoritative server over DoT or DoQ that sends Server Name Indication (SNI) in the clear in the cryptographic handshake leaks information about the intended query to a passive network observer.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">In particular, if two different zones refer to the same nameserver IP addresses via differently-named NS records, a passive network observer can distinguish queries to one zone from the queries to the other.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1-3">Omitting SNI entirely, or using ECH to hide the intended SNI, avoids this additional leakage.
However, a series of queries that leak this information is still an improvement over the all-cleartext status quo at the time of this document.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-8">
      <h2 id="name-security-considerations-4">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations-4" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">The guidance in this draft provides defense against passive network monitors for most queries.
It does not defend against active attackers.
It can also leak some queries and their responses due to "happy eyeballs" optimizations when the resolver's cache is cold.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">Implementation of the guidance in this draft should increase deployment of opportunistic encrypted DNS transport between recursive resolvers and authoritative servers at little operational risk.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">However, implementers should not rely on the guidance in this draft for robust defense against active attackers, but should treat it as a stepping stone en route to stronger defense.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4">In particular, a recursive resolver following this guidance can easily be forced by an active attacker to fall back to cleartext DNS queries.
Or, an active attacker could position itself as a machine-in-the-middle, which the recursive resolver would not defend against or detect due to lack of server authentication.
Defending against these attacks without risking additional unexpected protocol failures would require signalling and coordination that are out of scope for this draft.<a href="#section-8-4" class="pilcrow">¶</a></p>
<p id="section-8-5">This guidance is only one part of operating a privacy-preserving DNS ecosystem.
A privacy-preserving recursive resolver should adopt other practices as well, such as QNAME minimization, local root zone, etc, to reduce the overall leakage of query information that could infringe on the client's privacy.<a href="#section-8-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="acknowledgements">
<section id="section-9">
      <h2 id="name-acknowledgements-3">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-acknowledgements-3" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-9-1">Many people contributed to the development of this draft beyond the authors, including
Brian Dickson,
Christian Huitema,
Eric Nygren,
Jim Reid,
Kris Shrishak,
Paul Hoffman,
Ralf Weber,
Robert Evans,
and the DPRIVE working group.<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-10">
      <h2 id="name-references-4">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references-4" class="section-name selfRef">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references-3">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references-3" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references-3">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references-3" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC1035">[RFC1035]</dt>
        <dd>
<span class="refAuthor">Mockapetris, P.</span>, <span class="refTitle">"Domain names - implementation and specification"</span>, <span class="seriesInfo">STD 13</span>, <span class="seriesInfo">RFC 1035</span>, <span class="seriesInfo">DOI 10.17487/RFC1035</span>, <time datetime="1987-11" class="refDate">November 1987</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1035">https://www.rfc-editor.org/info/rfc1035</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-dprive-dnsoquic">[I-D.ietf-dprive-dnsoquic]</dt>
        <dd>
<span class="refAuthor">Huitema, C.</span>, <span class="refAuthor">Dickinson, S.</span>, and <span class="refAuthor">A. Mankin</span>, <span class="refTitle">"DNS over Dedicated QUIC Connections"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-dprive-dnsoquic-10</span>, <time datetime="2022-02-28" class="refDate">28 February 2022</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-dprive-dnsoquic-10.txt">https://www.ietf.org/archive/id/draft-ietf-dprive-dnsoquic-10.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-tls-esni">[I-D.ietf-tls-esni]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refAuthor">Oku, K.</span>, <span class="refAuthor">Sullivan, N.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"TLS Encrypted Client Hello"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-esni-14</span>, <time datetime="2022-02-13" class="refDate">13 February 2022</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-tls-esni-14.txt">https://www.ietf.org/archive/id/draft-ietf-tls-esni-14.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7435">[RFC7435]</dt>
        <dd>
<span class="refAuthor">Dukhovni, V.</span>, <span class="refTitle">"Opportunistic Security: Some Protection Most of the Time"</span>, <span class="seriesInfo">RFC 7435</span>, <span class="seriesInfo">DOI 10.17487/RFC7435</span>, <time datetime="2014-12" class="refDate">December 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7435">https://www.rfc-editor.org/info/rfc7435</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7858">[RFC7858]</dt>
        <dd>
<span class="refAuthor">Hu, Z.</span>, <span class="refAuthor">Zhu, L.</span>, <span class="refAuthor">Heidemann, J.</span>, <span class="refAuthor">Mankin, A.</span>, <span class="refAuthor">Wessels, D.</span>, and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Specification for DNS over Transport Layer Security (TLS)"</span>, <span class="seriesInfo">RFC 7858</span>, <span class="seriesInfo">DOI 10.17487/RFC7858</span>, <time datetime="2016-05" class="refDate">May 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7858">https://www.rfc-editor.org/info/rfc7858</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7871">[RFC7871]</dt>
        <dd>
<span class="refAuthor">Contavalli, C.</span>, <span class="refAuthor">van der Gaast, W.</span>, <span class="refAuthor">Lawrence, D.</span>, and <span class="refAuthor">W. Kumari</span>, <span class="refTitle">"Client Subnet in DNS Queries"</span>, <span class="seriesInfo">RFC 7871</span>, <span class="seriesInfo">DOI 10.17487/RFC7871</span>, <time datetime="2016-05" class="refDate">May 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7871">https://www.rfc-editor.org/info/rfc7871</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8305">[RFC8305]</dt>
        <dd>
<span class="refAuthor">Schinazi, D.</span> and <span class="refAuthor">T. Pauly</span>, <span class="refTitle">"Happy Eyeballs Version 2: Better Connectivity Using Concurrency"</span>, <span class="seriesInfo">RFC 8305</span>, <span class="seriesInfo">DOI 10.17487/RFC8305</span>, <time datetime="2017-12" class="refDate">December 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8305">https://www.rfc-editor.org/info/rfc8305</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8467">[RFC8467]</dt>
        <dd>
<span class="refAuthor">Mayrhofer, A.</span>, <span class="refTitle">"Padding Policies for Extension Mechanisms for DNS (EDNS(0))"</span>, <span class="seriesInfo">RFC 8467</span>, <span class="seriesInfo">DOI 10.17487/RFC8467</span>, <time datetime="2018-10" class="refDate">October 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8467">https://www.rfc-editor.org/info/rfc8467</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8484">[RFC8484]</dt>
      <dd>
<span class="refAuthor">Hoffman, P.</span> and <span class="refAuthor">P. McManus</span>, <span class="refTitle">"DNS Queries over HTTPS (DoH)"</span>, <span class="seriesInfo">RFC 8484</span>, <span class="seriesInfo">DOI 10.17487/RFC8484</span>, <time datetime="2018-10" class="refDate">October 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8484">https://www.rfc-editor.org/info/rfc8484</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="document-considerations">
<section id="appendix-A">
      <h2 id="name-document-considerations">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-document-considerations" class="section-name selfRef">Document Considerations</a>
      </h2>
<p id="appendix-A-1">[ RFC Editor: please remove this section before publication ]<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">This document is currently edited as markdown.
Minor editorial changes can be suggested via merge requests at https://gitlab.com/dkg/dprive-unilateral-probing or by e-mail to the editor.
Please direct all significant commentary to the public IETF DPRIVE mailing list: dprive@ietf.org<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3">The authors' latest draft can be read online in <a href="https://dkg.gitlab.io/dprive-unilateral-probing/">html</a> or <a href="https://dkg.gitlab.io/dprive-unilateral-probing/unilateral-probing.pdf">pdf</a> or <a href="https://dkg.gitlab.io/dprive-unilateral-probing/unilateral-probing.txt">text</a> formats.<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<div id="document-history">
<section id="appendix-A.1">
        <h3 id="name-document-history">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-document-history" class="section-name selfRef">Document History</a>
        </h3>
<div id="substantive-changes-from-01-to-02">
<section id="appendix-A.1.1">
          <h4 id="name-substantive-changes-from-01">
<a href="#appendix-A.1.1" class="section-number selfRef">A.1.1. </a><a href="#name-substantive-changes-from-01" class="section-name selfRef">Substantive changes from -01 to -02</a>
          </h4>
<ul class="normal">
<li class="normal" id="appendix-A.1.1-1.1">Clarify that deployment to a pool does not need to be strictly simultaneous<a href="#appendix-A.1.1-1.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.1.1-1.2">Explain why authoritatives need to serve the same records regardless of SNI<a href="#appendix-A.1.1-1.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.1.1-1.3">Defer to external, protocol-specific references for resource management<a href="#appendix-A.1.1-1.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.1.1-1.4">Clarify that probed connections must not fail due to authentication failure<a href="#appendix-A.1.1-1.4" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="substantive-changes-from-00-to-01">
<section id="appendix-A.1.2">
          <h4 id="name-substantive-changes-from-00">
<a href="#appendix-A.1.2" class="section-number selfRef">A.1.2. </a><a href="#name-substantive-changes-from-00" class="section-name selfRef">Substantive changes from -00 to -01</a>
          </h4>
<ul class="normal">
<li class="normal" id="appendix-A.1.2-1.1">Fallback to cleartext when encrypted transport fails.<a href="#appendix-A.1.2-1.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.1.2-1.2">Reduce default <code>timeout</code> to 4s<a href="#appendix-A.1.2-1.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.1.2-1.3">Clarify SNI guidance: OK for selecting server credentials, not OK for changing answers<a href="#appendix-A.1.2-1.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.1.2-1.4">Document ALPN and port numbers<a href="#appendix-A.1.2-1.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.1.2-1.5">Justify sorting recursive resolver state by authoritative IP address<a href="#appendix-A.1.2-1.5" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses-3">
<a href="#name-authors-addresses-3" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Daniel Kahn Gillmor</span></div>
<div dir="auto" class="left"><span class="org">American Civil Liberties Union</span></div>
<div dir="auto" class="left"><span class="street-address">125 Broad St.</span></div>
<div dir="auto" class="left">
<span class="locality">New York, NY</span>,  <span class="postal-code">10004</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:dkg@fifthhorseman.net" class="email">dkg@fifthhorseman.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Joey Salazar</span></div>
<div dir="auto" class="left"><span class="locality">Alajuela</span></div>
<div dir="auto" class="left"><span class="postal-code">20201</span></div>
<div dir="auto" class="left"><span class="country-name">Costa Rica</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:joeygsal@gmail.com" class="email">joeygsal@gmail.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
